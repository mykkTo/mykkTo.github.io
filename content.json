{"meta":{"title":"jack","subtitle":"jackã®åšå®¢","description":"java | è½¯ä»¶å¼€å‘ | ç®€ä¹¦ä½œè€…","author":"jack","url":"https://mykkto.github.io","root":"/"},"pages":[{"title":"404","date":"2019-08-10T08:41:10.000Z","updated":"2022-01-06T14:09:33.725Z","comments":true,"path":"404.html","permalink":"https://mykkto.github.io/404.html","excerpt":"","text":""},{"title":"","date":"2022-01-06T14:09:33.869Z","updated":"2022-01-06T14:09:33.869Z","comments":true,"path":"baidu_verify_xxxxxxx.html","permalink":"https://mykkto.github.io/baidu_verify_xxxxxxx.html","excerpt":"","text":"wvlc3L96QK"},{"title":"","date":"2022-01-06T14:09:33.871Z","updated":"2022-01-06T14:09:33.871Z","comments":true,"path":"google1xxxxxxx0.html","permalink":"https://mykkto.github.io/google1xxxxxxx0.html","excerpt":"","text":"google-site-verification: google110e5e5e14c8dcf0.html"},{"title":"æ”¾æ¾ä¸€ä¸‹","date":"2019-08-10T08:41:10.000Z","updated":"2022-01-06T14:09:33.745Z","comments":true,"path":"List/index.html","permalink":"https://mykkto.github.io/List/index.html","excerpt":"","text":"å½±éŸ³èµ„æºå…±äº«"},{"title":"categories","date":"2019-10-24T16:00:00.000Z","updated":"2022-01-06T14:09:33.869Z","comments":true,"path":"categories/index.html","permalink":"https://mykkto.github.io/categories/index.html","excerpt":"","text":""},{"title":"ç»Ÿè®¡","date":"2020-10-31T02:11:28.000Z","updated":"2022-01-06T14:09:33.869Z","comments":true,"path":"census/index.html","permalink":"https://mykkto.github.io/census/index.html","excerpt":"","text":""},{"title":"å‹é“¾","date":"2019-07-19T08:42:10.000Z","updated":"2022-01-06T14:09:33.871Z","comments":true,"path":"friends/index.html","permalink":"https://mykkto.github.io/friends/index.html","excerpt":"","text":""},{"title":"ç•™è¨€æ¿","date":"2022-01-06T15:45:01.231Z","updated":"2022-01-06T15:45:01.231Z","comments":true,"path":"contact/index.html","permalink":"https://mykkto.github.io/contact/index.html","excerpt":"","text":"ç•…æ‰€æ¬²è¨€ åœ¨è¿™é‡Œå¯ä»¥ç•™ä¸‹ä½ çš„è¶³è¿¹ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹ç•™è¨€ï¼Œæ¬¢è¿äº¤æ¢å‹é“¾ï¼Œä¸€èµ·äº¤æµå­¦ä¹ ï¼ å‹é“¾ jackã®å‹é“¾ä¿¡æ¯ åšå®¢åç§°: jckã®åšå®¢ åšå®¢ç½‘å€: https://mykkto.github.io/"},{"title":"èµ„æºåˆ†äº«","date":"2019-07-19T08:40:27.000Z","updated":"2022-01-06T14:09:33.872Z","comments":true,"path":"resource/index.html","permalink":"https://mykkto.github.io/resource/index.html","excerpt":"","text":""},{"title":"about","date":"2019-10-24T16:00:00.000Z","updated":"2022-01-06T14:09:33.867Z","comments":true,"path":"about/index.html","permalink":"https://mykkto.github.io/about/index.html","excerpt":"","text":""},{"title":"archives","date":"2019-10-24T16:00:00.000Z","updated":"2022-01-06T14:09:33.867Z","comments":true,"path":"archives/index.html","permalink":"https://mykkto.github.io/archives/index.html","excerpt":"","text":""},{"title":"tags","date":"2019-07-19T08:40:27.000Z","updated":"2022-01-06T14:09:33.873Z","comments":true,"path":"tags/index.html","permalink":"https://mykkto.github.io/tags/index.html","excerpt":"","text":""},{"title":"ç›¸å†Œ","date":"2022-01-08T15:55:11.896Z","updated":"2022-01-06T14:09:33.734Z","comments":true,"path":"List/galleries/index.html","permalink":"https://mykkto.github.io/List/galleries/index.html","excerpt":"","text":""},{"title":"è§†é¢‘","date":"2019-08-10T08:41:10.000Z","updated":"2022-01-06T14:09:33.745Z","comments":true,"path":"List/movies/index.html","permalink":"https://mykkto.github.io/List/movies/index.html","excerpt":"","text":""},{"title":"å¬å¬éŸ³ä¹","date":"2019-07-19T08:40:27.000Z","updated":"2022-01-06T14:09:33.746Z","comments":true,"path":"List/music/index.html","permalink":"https://mykkto.github.io/List/music/index.html","excerpt":"","text":""},{"title":"å¬å¬éŸ³ä¹","date":"2019-07-19T08:40:27.000Z","updated":"2022-01-06T14:09:33.747Z","comments":true,"path":"List/tools/index.html","permalink":"https://mykkto.github.io/List/tools/index.html","excerpt":"","text":""},{"title":"ä¹–å·§å°ç‹—","date":"2022-01-06T14:09:33.734Z","updated":"2022-01-06T14:09:33.734Z","comments":true,"path":"List/galleries/ä¹–å·§å°ç‹—/index.html","permalink":"https://mykkto.github.io/List/galleries/%E4%B9%96%E5%B7%A7%E5%B0%8F%E7%8B%97/index.html","excerpt":"","text":""},{"title":"äºŒæ¬¡å…ƒé£","date":"2022-01-06T14:09:33.735Z","updated":"2022-01-06T14:09:33.735Z","comments":true,"path":"List/galleries/äºŒæ¬¡å…ƒé£/index.html","permalink":"https://mykkto.github.io/List/galleries/%E4%BA%8C%E6%AC%A1%E5%85%83%E9%A3%8E/index.html","excerpt":"","text":""},{"title":"åŠ¨æ¼«äººç‰©","date":"2022-01-06T14:09:33.736Z","updated":"2022-01-06T14:09:33.736Z","comments":true,"path":"List/galleries/åŠ¨æ¼«äººç‰©/index.html","permalink":"https://mykkto.github.io/List/galleries/%E5%8A%A8%E6%BC%AB%E4%BA%BA%E7%89%A9/index.html","excerpt":"","text":""},{"title":"åŠ¨æ¼«æ’ç”»","date":"2022-01-06T14:09:33.737Z","updated":"2022-01-06T14:09:33.737Z","comments":true,"path":"List/galleries/åŠ¨æ¼«æ’ç”»/index.html","permalink":"https://mykkto.github.io/List/galleries/%E5%8A%A8%E6%BC%AB%E6%8F%92%E7%94%BB/index.html","excerpt":"","text":""},{"title":"åŸå¸‚é£å…‰","date":"2022-01-06T14:09:33.739Z","updated":"2022-01-06T14:09:33.739Z","comments":true,"path":"List/galleries/åŸå¸‚é£å…‰/index.html","permalink":"https://mykkto.github.io/List/galleries/%E5%9F%8E%E5%B8%82%E9%A3%8E%E5%85%89/index.html","excerpt":"","text":""},{"title":"ç‚«é…·è·‘è½¦","date":"2022-01-08T15:55:21.871Z","updated":"2022-01-06T14:09:33.742Z","comments":true,"path":"List/galleries/ç‚«é…·è·‘è½¦/index.html","permalink":"https://mykkto.github.io/List/galleries/%E7%82%AB%E9%85%B7%E8%B7%91%E8%BD%A6/index.html","excerpt":"","text":""},{"title":"æ¸…æ–°èŠ±å‰","date":"2022-01-06T14:09:33.740Z","updated":"2022-01-06T14:09:33.740Z","comments":true,"path":"List/galleries/æ¸…æ–°èŠ±å‰/index.html","permalink":"https://mykkto.github.io/List/galleries/%E6%B8%85%E6%96%B0%E8%8A%B1%E5%8D%89/index.html","excerpt":"","text":""},{"title":"å‘†èŒçŒ«å’ª","date":"2022-01-06T14:09:33.738Z","updated":"2022-01-06T14:09:33.738Z","comments":true,"path":"List/galleries/å‘†èŒçŒ«å’ª/index.html","permalink":"https://mykkto.github.io/List/galleries/%E5%91%86%E8%90%8C%E7%8C%AB%E5%92%AA/index.html","excerpt":"","text":""},{"title":"åŠ¨æ¼«é£æ™¯","date":"2022-01-06T14:09:33.738Z","updated":"2022-01-06T14:09:33.738Z","comments":true,"path":"List/galleries/åŠ¨æ¼«é£æ™¯/index.html","permalink":"https://mykkto.github.io/List/galleries/%E5%8A%A8%E6%BC%AB%E9%A3%8E%E6%99%AF/index.html","excerpt":"","text":""},{"title":"ç’€ç’¨æ˜Ÿç©º","date":"2022-01-06T14:09:33.743Z","updated":"2022-01-06T14:09:33.743Z","comments":true,"path":"List/galleries/ç’€ç’¨æ˜Ÿç©º/index.html","permalink":"https://mykkto.github.io/List/galleries/%E7%92%80%E7%92%A8%E6%98%9F%E7%A9%BA/index.html","excerpt":"","text":""},{"title":"ç”œç¾é£Ÿå“","date":"2022-01-06T14:09:33.743Z","updated":"2022-01-06T14:09:33.743Z","comments":true,"path":"List/galleries/ç”œç¾é£Ÿå“/index.html","permalink":"https://mykkto.github.io/List/galleries/%E7%94%9C%E7%BE%8E%E9%A3%9F%E5%93%81/index.html","excerpt":"","text":""},{"title":"è‡ªç„¶é£æ™¯","date":"2022-01-06T14:09:33.744Z","updated":"2022-01-06T14:09:33.744Z","comments":true,"path":"List/galleries/è‡ªç„¶é£æ™¯/index.html","permalink":"https://mykkto.github.io/List/galleries/%E8%87%AA%E7%84%B6%E9%A3%8E%E6%99%AF/index.html","excerpt":"","text":""}],"posts":[{"title":"redissonç”Ÿäº§åœºæ™¯ï¼ˆç²‰ä¸æŠ•ç¨¿ï¼‰","slug":"22-ä¸“æ /yjc/yjc02-2023_redissonå¤šé”","date":"2023-07-24T02:07:11.000Z","updated":"2023-11-13T05:31:40.863Z","comments":true,"path":"posts/1adcd5ea.html","link":"","permalink":"https://mykkto.github.io/posts/1adcd5ea.html","excerpt":"","text":"åœºæ™¯ä¸€ï¼šè¿‘æœŸé¡¹ç›®ä¸Šé¢æœ‰ä¸ªåŠŸèƒ½å‡ºç°bug. æ‰¹é‡ç™»è®°æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹åç§°æœ‰å¿…é¡»å”¯ä¸€æ€§ åœ¨æ‰¹é‡ç™»è®°éƒ½ä¼šæ ¡éªŒæ¨¡å‹åç§°ä¸èƒ½é‡å¤ï¼Œæµ‹è¯•çš„åŒå¿—åœ¨æµ‹è¯•ä¸çŸ¥é“ä¸æ˜¯ç³»ç»Ÿå¡è¿˜æ˜¯æ€ä¹ˆäº†ï¼ŒæˆåŠŸæ·»åŠ äº†åŒåçš„æ¨¡å‹åç§°ä½†æ˜¯ä¸åŒæ‰¹æ¬¡å·ã€‚ä½†æ˜¯åœ¨æµç¨‹åŠç»“çš„æ—¶å€™æµç¨‹çš„çŠ¶æ€æ›´æ–°åˆ°æ•°æ®åº“å…¶è¿˜æ˜¯ä¼šè°ƒç”¨é‚£ä¸ªæ‰¹é‡ç™»è®°æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æœ‰æ ¡éªŒæ¨¡å‹å”¯ä¸€æ€§ï¼Œå¯¼è‡´è¿™ä¸ªæ¯”ä¸šåŠ¡ä¸èƒ½é¡ºåˆ©èµ°å®Œæµç¨‹ã€‚ ç”±äºé¡¹ç›®æ˜¯é›†ç¾¤çš„æ‰€ä»¥ã€‚å°±è¿™é‡Œå·²ç»æ’é™¤jvmå±‚é¢çš„ä¸Šé”æƒ…å†µã€‚è€ƒè™‘çš„æ˜¯åˆ†å¸ƒå¼é”çš„ã€‚ç¬”è€…è¿˜æ˜¯é€šè¿‡å¤šæ–¹é¢çš„é€‰æ‹©æœ€ ç¬¬ä¸€è¦æ‰¹é‡ç”Ÿæˆå¤šä¸ªå¯¹è±¡é”ï¼Œç¬¬äºŒåŒä¸€æ‰¹æ¬¡çš„é”ä¹Ÿä¸èƒ½åŒåã€‚é‚£ä¹ˆåˆ†å¸ƒå¼é”ä½¿ç”¨çš„ç»“æ„æ­£hashæ•°æ®ç»“æ„: ç»ˆé€‰æ‹©redissonæ¡†æ¶çš„é”ã€‚æ¥å®Œæˆæœ¬é¡¹ç›®éœ€æ±‚çš„ç¼ºé™·ã€‚ 1ã€ä¸¤ç§å¼•å…¥æ–¹å¼æ–¹å¼ä¸€æ¨è &lt;!-- https://mvnrepository.com/artifact/org.redisson/redisson-spring-boot-starter --&gt; &lt;dependency&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.17.1&lt;/version&gt; &lt;/dependency&gt; æ–¹å¼äºŒ &lt;!-- åŸç”Ÿ--&gt; &lt;dependency&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson&lt;/artifactId&gt; &lt;version&gt;3.17.1&lt;/version&gt; &lt;/dependency&gt; 2ã€ç‰ˆæœ¬å†²çªå¤„ç†ç‰ˆæœ¬å†²çªè¿˜æœ‰åšå¦‚ä¸‹å¤„ç†ï¼ˆè¿™é‡Œæ’é™¤çš„ç‰ˆæœ¬è¦æ ¹æ® å…·ä½“ä½¿ç”¨bootçš„ç‰ˆæœ¬å’Œspring-boot-starter-data-rediså»è€ƒè™‘ï¼‰ &lt;!--redisson--&gt; &lt;dependency&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.13.6&lt;/version&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson-spring-data-23&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson-spring-data-21&lt;/artifactId&gt; &lt;version&gt;3.13.6&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; 3ã€å¼•å…¥redissonä¾èµ–åªéœ€å¼•å…¥redisson-spring-boot-starterå°±å¯ä»¥äº†ï¼Œä¸è¿‡è¿™é‡Œéœ€è¦æ³¨æ„springbootä¸redissonçš„ç‰ˆæœ¬ï¼Œå› ä¸ºå®˜æ–¹æ¨èredissonç‰ˆæœ¬ä¸springbootç‰ˆæœ¬é…åˆä½¿ç”¨ã€‚ç‰ˆæœ¬ä¸åŒ¹é…ä¼šå¯¼è‡´è¿™ç§é—®é¢˜ã€‚ å°† Redisson ä¸ Spring Boot åº“é›†æˆã€‚å–å†³äºSpring Data Redisæ¨¡å—ï¼Œæ”¯æŒ Spring Boot 1.3.x - 2.4.x è¿™å¥è¯æ˜¯å®˜æ–¹è¯´çš„ï¼Œä¸è¿‡ç°åœ¨çš„2.5.xä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œåªéœ€è¦æ³¨æ„springbootæœ€ä½ç‰ˆæœ¬ä¸è¦ä½äº1.3.xå³å¯ã€‚ redisson-spring-data module name Spring Boot version redisson-spring-data-16 1.3.x redisson-spring-data-17 1.4.x redisson-spring-data-18 1.5.x redisson-spring-data-20 2.0.x redisson-spring-data-21 2.1.x redisson-spring-data-22 2.2.x redisson-spring-data-23 2.3.x redisson-spring-data-24 2.4.x 4ã€redisson çš„é…ç½®server: port: 8088 spring.redis: enable: true # Connection URL, will override host, port and password (user will be ignored), e.g. redis://user:password@example.com:6379 url: redis://127.0.0.1:6379 timeout: 2000 # è¿æ¥æˆ–è¯»å–è¶…æ—¶æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ database: 7 redisson: # è¿™é‡ŒæŒ‡å®š é…ç½®è·¯å¾„ file: classpath:redisson.yml jedis: pool: max-active: 8 # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-wait: 800 # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-idle: 8 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ min-idle: 2 # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ spring: #============== redis =================== redis: host: 127.0.0.1 port: 6379 ngsoc: redis-lock: maxRetryTimes: 30 delayTime: 3000 1234567891011121314151617181920212223242526 # å•èŠ‚ç‚¹é…ç½® singleServerConfig: # è¿æ¥ç©ºé—²è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’ idleConnectionTimeout: 10000 # è¿æ¥è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’ connectTimeout: 10000 # å‘½ä»¤ç­‰å¾…è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’ timeout: 3000 # å‘½ä»¤å¤±è´¥é‡è¯•æ¬¡æ•°,å¦‚æœå°è¯•è¾¾åˆ° retryAttemptsï¼ˆå‘½ä»¤å¤±è´¥é‡è¯•æ¬¡æ•°ï¼‰ ä»ç„¶ä¸èƒ½å°†å‘½ä»¤å‘é€è‡³æŸä¸ªæŒ‡å®šçš„èŠ‚ç‚¹æ—¶ï¼Œå°†æŠ›å‡ºé”™è¯¯ã€‚ # å¦‚æœå°è¯•åœ¨æ­¤é™åˆ¶ä¹‹å†…å‘é€æˆåŠŸï¼Œåˆ™å¼€å§‹å¯ç”¨ timeoutï¼ˆå‘½ä»¤ç­‰å¾…è¶…æ—¶ï¼‰ è®¡æ—¶ã€‚ retryAttempts: 3 # å‘½ä»¤é‡è¯•å‘é€æ—¶é—´é—´éš”ï¼Œå•ä½ï¼šæ¯«ç§’ retryInterval: 1500 # å¯†ç  #password: redis.shbeta # å•ä¸ªè¿æ¥æœ€å¤§è®¢é˜…æ•°é‡ subscriptionsPerConnection: 5 # å®¢æˆ·ç«¯åç§° #clientName: axin # # èŠ‚ç‚¹åœ°å€ address: redis://127.0.0.1:6379 # å‘å¸ƒå’Œè®¢é˜…è¿æ¥çš„æœ€å°ç©ºé—²è¿æ¥æ•° subscriptionConnectionMinimumIdleSize: 1 # å‘å¸ƒå’Œè®¢é˜…è¿æ¥æ± å¤§å° subscriptionConnectionPoolSize: 50 # æœ€å°ç©ºé—²è¿æ¥æ•° connectionMinimumIdleSize: 32 # è¿æ¥æ± å¤§å° connectionPoolSize: 64 # æ•°æ®åº“ç¼–å· database: 6 # DNSç›‘æµ‹æ—¶é—´é—´éš”ï¼Œå•ä½ï¼šæ¯«ç§’ dnsMonitoringInterval: 5000 # çº¿ç¨‹æ± æ•°é‡,é»˜è®¤å€¼: å½“å‰å¤„ç†æ ¸æ•°é‡ * 2 #threads: 0 # Nettyçº¿ç¨‹æ± æ•°é‡,é»˜è®¤å€¼: å½“å‰å¤„ç†æ ¸æ•°é‡ * 2 #nettyThreads: 0 # ç¼–ç  codec: !&lt;org.redisson.codec.JsonJacksonCodec&gt; {} # ä¼ è¾“æ¨¡å¼ transportMode : \"NIO\" # é›†ç¾¤é…ç½®æ–¹å¼ clusterServersConfig: idleConnectionTimeout: 10000 connectTimeout: 10000 timeout: 3000 retryAttempts: 3 retryInterval: 1500 failedSlaveReconnectionInterval: 3000 failedSlaveCheckInterval: 60000 password: null subscriptionsPerConnection: 5 clientName: null loadBalancer: !&lt;org.redisson.connection.balancer.RoundRobinLoadBalancer&gt; {} subscriptionConnectionMinimumIdleSize: 1 subscriptionConnectionPoolSize: 50 slaveConnectionMinimumIdleSize: 24 slaveConnectionPoolSize: 64 masterConnectionMinimumIdleSize: 24 masterConnectionPoolSize: 64 readMode: \"SLAVE\" subscriptionMode: \"SLAVE\" nodeAddresses: - \"redis://127.0.0.1:7004\" - \"redis://127.0.0.1:7001\" - \"redis://127.0.0.1:7000\" scanInterval: 1000 pingConnectionInterval: 0 keepAlive: false tcpNoDelay: false threads: 16 nettyThreads: 32 codec: !&lt;org.redisson.codec.MarshallingCodec&gt; {} transportMode: \"NIO\" ä»¥ä¸Šé…ç½®å‚è€ƒç½‘ç»œçš„ã€‚ä½†ç¬”è€…è¿˜åœ¨ä½¿ç”¨configé…ç½®ç±»çš„æ–¹å¼å®ç°é…ç½®ã€‚è¿™æ ·ä¸ç”¨ç»´æŠ¤é‚£ä¹ˆå¤šé…ç½®æ–‡ä»¶ã€‚ //å•æœºæ¨¡å¼ @Configuration public class RedissionConfig { @Value(\"${spring.redis.host}\") private String redisHost; @Value(\"${spring.redis.password}\") private String password; private int port = 6379; @Bean public RedissonClient getRedisson() { Config config = new Config(); //è¿™é‡Œå•æœºæ¨¡å¼ï¼ŒåæœŸå¯ä»¥æŒ‡å®šé›†ç¾¤æ¨¡å¼é…ç½® config.useSingleServer(). setAddress(\"redis://\" + redisHost + \":\" + port). setPassword(password); config.setCodec(new JsonJacksonCodec()); return Redisson.create(config); } } //é›†ç¾¤æ¨¡å¼ @Configuration public class RedissionConfig { Config config = new Config(); config.useClusterServers() .setScanInterval(2000) // cluster state scan interval in milliseconds .addNodeAddress(\"127.0.0.1:7000\", \"127.0.0.1:7001\") .addNodeAddress(\"127.0.0.1:7002\"); config.setCodec(new JsonJacksonCodec()); return Redisson.create(config); } } 5ã€é”å¤±æ•ˆé—®é¢˜åˆ†å¸ƒå¼é”çš„å’Œ@Transactional å¤±æ•ˆé—®é¢˜ ç”±äºåˆ†å¸ƒå¼åœ¨äº‹åŠ¡å†…ï¼Œå½“äº‹åŠ¡æœªæäº¤ä½†æ˜¯é”è¢«é‡Šæ”¾äº†ï¼Œäº‹åŠ¡æœªæäº¤ã€‚å…¶ä»–çº¿ç¨‹è¿›æ¥æ¥äº†è¯»å–åˆ°è„æ•°æ®ã€‚ å¤„ç†æ–¹æ¡ˆå¯ä»¥åœ¨ // ä¼ªä»£ç  @Transactional public void update(int id) { boolean lock = redisLock.lock(id); if (!lock) { throw new RuntimeException(\"å½“å‰äººæ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•\"); } /* ä¸šåŠ¡ä»£ç åœ¨è¯¥åŒºåŸŸ */ redisLock.unlock(id); } æˆ‘ä»¬å¯ä»¥åœ¨updateæ–¹æ³•ä¹‹å‰å°±åŠ ä¸Šé”ï¼Œåœ¨è¿˜æ²¡æœ‰å¼€äº‹åŠ¡ä¹‹å‰å°±åŠ é”ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œä»è€Œä¸ä¼šå‡ºç°è„è¯»å’Œæ•°æ®ä¸ä¸€è‡´æ€§ç­‰æƒ…å†µ. //ä¼ªä»£ç  @RequestMapping(\"/execute\") public void execute(int id) { boolean lock = redisLock.lock(id); if (!lock) { throw new RuntimeException(\"å½“å‰äººæ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•\"); } service.update(id); redisLock.unlock(id); } //ä¼ªä»£ç  @Transactional public void update(int id) { /* ä¸šåŠ¡ä»£ç åœ¨è¯¥åŒºåŸŸ */ } 6ã€è¿æ’é”çš„ä½¿ç”¨ //ä¼ªä»£ç  public ResultVO&lt;Object&gt; testMultLock(List&lt;String&gt;lockkey) { List&lt;RLocks&gt; rLocks=lockkey.strem().map(lock-&gt;{ retuen redissonClient.getLock(lock); }).collent(collent.toList) RLocks[]arr =RLocks[rLocks.size()] RLocks[] keys =rLocks.toArray(arr); RedissonMultiLock multiLock = new RedissonMultiLock(keys); try { // æ‰€æœ‰çš„é”éƒ½ä¸Šé”æˆåŠŸæ‰ç®—æˆåŠŸ multiLock.lock(); //è¿™ä¸ªæ˜¯å¯ä»¥è§¦å‘çœ‹é—¨ç‹— çš„æ—¶å€™ ç»­æœŸ log.info(\"{}ï¼šè·å¾—é”ï¼Œå¼€å§‹æ‰§è¡Œä¸šåŠ¡\", threadName); TimeUnit.SECONDS.sleep(3); log.info(\"{}ï¼šæ‰§è¡Œç»“æŸ\", threadName); return ResultUtils.success(); } catch (Exception e) { log.error(\"testMultLock exception:\", e); return ResultUtils.sysError(); } finally { // æ³¨æ„ï¼šä¸èƒ½ä½¿ç”¨isLocked()å’ŒisHeldByCurrentThread()æ–¹æ³•ï¼Œä¼šæŠ›å‡ºUnsupportedOperationExceptionå¼‚å¸¸ multiLock.unlock(); log.info(\"{}ï¼šé‡Šæ”¾é”æˆåŠŸ\", threadName); } } å‚è€ƒåšæ–‡â†“https://www.bookstack.cn/read/redisson-doc-cn/config.md#master-slave-mode https://blog.csdn.net/heihei_linlin/article/details/126529597 https://www.cnblogs.com/maohuidong/p/16638941.html https://blog.csdn.net/s_156/article/details/130847610 https://www.cnblogs.com/devise/p/10847575.html https://blog.csdn.net/weixin_39977988/article/details/129187364 https://blog.csdn.net/Ying_ph/article/details/131204423 https://blog.csdn.net/Number_oneEngineer/article/details/126119081?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-126119081-blog-130185705.235^v38^pc_relevant_anti_t3&amp;spm=1001.2101.3001.4242.2&amp;utm_relevant_index=4 https://blog.csdn.net/s_156/article/details/130847610","categories":[{"name":"ä¸“åˆŠç¯‡","slug":"ä¸“åˆŠç¯‡","permalink":"https://mykkto.github.io/categories/%E4%B8%93%E5%88%8A%E7%AF%87/"}],"tags":[{"name":"é”","slug":"é”","permalink":"https://mykkto.github.io/tags/%E9%94%81/"},{"name":"redisson","slug":"redisson","permalink":"https://mykkto.github.io/tags/redisson/"}],"author":"æ¨æ±Ÿé•¿"},{"title":"Dorisæ“ä½œæŒ‡å—","slug":"13-å¤§æ•°æ®/02-doris/01_doris","date":"2023-06-19T08:19:12.000Z","updated":"2023-06-11T03:13:58.413Z","comments":true,"path":"posts/a6683734.html","link":"","permalink":"https://mykkto.github.io/posts/a6683734.html","excerpt":"","text":"ä¸€ã€å‰è¨€ç«™é•¿æœ€è¿‘å…¥èŒäº†ä¸€å®¶åšæ•°æ®ä¸­å°çš„é¡¹ç›®ï¼Œæ•°æ®åº“ç”¨åˆ°çš„æ˜¯Doris ,äºæ˜¯æ¥æ‰‹é¢„ç ”ï¼Œ ç›®å‰ä¸»è¦å†™ä¸€äº›åŸºç¡€ç”¨æ³•ï¼Œåç»­å¦‚æœé¡¹ç›®åˆæ‰©å±•ï¼Œä¹Ÿè¿˜åœ¨åšè¿™å—åŠç›¸å…³ï¼Œæ–‡ç« ä¼šæœ‰è¿›é˜¶å’Œä¸°å¯Œçš„åœ°æ–¹ã€‚ ä¸€ã€æ­å»º1ã€æ¦‚è¦é…ç½®ä¸€ä¸ªFE+ä¸‰ä¸ªBEçš„é›†ç¾¤ï¼Œä½¿ç”¨ç‰ˆæœ¬1.1.5 ä¸‹è½½FEå’ŒBEåŒ… å‡†å¤‡FEå’ŒBEç¯å¢ƒ é…ç½®FE é…ç½®BE åœ¨FEä¸­æ·»åŠ BE ä»¥ä¸‹æ˜¯ä¸€å°ä¸»æœºåœ¨dockerä¸Šéƒ¨ç½²å¤šä¸ªå®¹å™¨ï¼ˆfe be ï¼‰ 2ã€æ­¥éª¤1-1ã€ä¸‹è½½FEå’ŒBEåŒ…ä»å®˜æ–¹ä¸‹è½½å·²ç»ç¼–è¯‘å¥½çš„åŒ…ï¼š dorisä¸‹è½½ æ³¨æ„ï¼šè¿™è¾¹å¦‚æœCPUæ˜¯ inter E5ç³»åˆ—çš„ï¼šè¦é€‰æ‹© no avx2 1-2ã€å‡†å¤‡FEå’ŒBEç¯å¢ƒ é…ç½®FEå’ŒBEçš„ç›®å½•ç»“æ„ï¼› æŠŠç¬¬ä¸€æ­¥çš„å‹ç¼©åŒ…è§£å‹åæ”¾åœ¨å¯¹åº”çš„FEå’ŒBEï¼› host&gt; mkdir docker host&gt; mv apache-doris-fe-1.1.5-bin docker/doris/fe host&gt; mv apache-doris-be-1.1.5-bin-x86_64 docker/doris/be-01 host&gt; mv apache-doris-be-1.1.2-bin-x86_64 docker/doris/be-02 host&gt; mv apache-doris-be-1.1.5-bin-x86_64 docker/doris/be-03 host&gt; tar -zxvf apache-doris-be-1.1.5-bin-x86_64.tar.gz -C be-01 æŸ¥çœ‹è§£å‹çš„ç›®å½•ç»“æ„ï¼š å…¶ä¸­æ¯ä¸ªfe ,be01 02 03 ä¸‹éƒ½æœ‰å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆé…ç½®æ–‡ä»¶ç­‰ï¼Œç”¨äºåç»­docker æŒ‚è½½æ˜ å°„ [root@oowp1nvi6nozrayx ~]# tree /root/docker -L 4 /root/docker â””â”€â”€ doris â”œâ”€â”€ apache-doris-be-1.1.5-bin-x86_64.tar.gz â”œâ”€â”€ apache-doris-fe-1.1.5-bin.tar.gz â”œâ”€â”€ be-01 â”‚ â””â”€â”€ apache-doris-be-1.1.5-bin-x86_64 â”‚ â”œâ”€â”€ bin â”‚ â”œâ”€â”€ conf â”‚ â”œâ”€â”€ lib â”‚ â”œâ”€â”€ LICENSE-dist.txt â”‚ â”œâ”€â”€ licenses â”‚ â”œâ”€â”€ log â”‚ â”œâ”€â”€ NOTICE.txt â”‚ â”œâ”€â”€ storage â”‚ â””â”€â”€ www â”œâ”€â”€ be-02 â”‚ â””â”€â”€ apache-doris-be-1.1.5-bin-x86_64 â”‚ â”œâ”€â”€ bin â”‚ â”œâ”€â”€ conf â”‚ â”œâ”€â”€ lib â”‚ â”œâ”€â”€ LICENSE-dist.txt â”‚ â”œâ”€â”€ licenses â”‚ â”œâ”€â”€ log â”‚ â”œâ”€â”€ NOTICE.txt â”‚ â”œâ”€â”€ storage â”‚ â””â”€â”€ www â”œâ”€â”€ be-03 â”‚ â””â”€â”€ apache-doris-be-1.1.5-bin-x86_64 â”‚ â”œâ”€â”€ bin â”‚ â”œâ”€â”€ conf â”‚ â”œâ”€â”€ lib â”‚ â”œâ”€â”€ LICENSE-dist.txt â”‚ â”œâ”€â”€ licenses â”‚ â”œâ”€â”€ log â”‚ â”œâ”€â”€ NOTICE.txt â”‚ â”œâ”€â”€ storage â”‚ â””â”€â”€ www â””â”€â”€ fe â””â”€â”€ apache-doris-fe-1.1.5-bin â”œâ”€â”€ apache_hdfs_broker â”œâ”€â”€ audit_loader â”œâ”€â”€ bin â”œâ”€â”€ conf â”œâ”€â”€ doris-meta â”œâ”€â”€ lib â”œâ”€â”€ LICENSE-dist.txt â”œâ”€â”€ licenses â”œâ”€â”€ log â”œâ”€â”€ NOTICE.txt â”œâ”€â”€ spark-dpp â””â”€â”€ webroot 40 directories, 10 files 1-3ã€é…ç½®FE1ã€å¯åŠ¨FE Docker è¿è¡Œå‘½ä»¤ï¼ˆæ¢è¡Œæ˜¯ä¸ºäº†ç¾è§‚ï¼Œè‡ªå·±æ‹·è´è¯·åˆä¸ºä¸€è¡Œï¼‰ï¼š docker run -it -d --name=doris-fe -p 18030:8030 -p 19030:9030 -v /root/docker/doris/fe/apache-doris-fe-1.1.5-bin:/opt/doris/fe -v /root/docker/doris/fe/apache-doris-fe-1.1.5-bin/doris-meta:/opt/doris/doris-meta apache/doris:build-env-for-1.1.0 host&gt; docker run -it -d --name=doris-fe -p 18030:8030 -p 19030:9030 -v /root/docker/doris/fe/apache-doris-fe-1.1.5-bin:/opt/doris/fe -v /root/docker/doris/fe/apache-doris-fe-1.1.5-bin/doris-meta:/opt/doris/doris-meta apache/doris:build-env-for-1.1.0 2ã€è¿›å…¥FEè¿›è¡Œé…ç½® host&gt; docker exec -it doris-fe /bin/bash # æŸ¥çœ‹FEçš„ipåœ°å€ fe&gt; cat /etc/hosts # é…ç½®FEçš„ç½‘ç»œ fe&gt; vi /opt/doris/fe/conf/fe.conf # å–æ¶ˆä¸‹é¢è¡Œçš„æ³¨é‡Šå¹¶æŠŠè¿™é‡Œçš„ipç½‘æ®µé…ç½®æˆä¸Šé¢æŸ¥çœ‹çš„ipåœ°å€ç½‘æ®µ vi&gt; priority_networks = 172.17.0.0/16 å…¶ä¸­ cat /etc/hosts çœ‹åˆ°çš„IP ç”¨äºåé¢å† FE mysql ä¸­é…ç½®BE å½“ä¸‹çš„ priority_networks é…ç½®æˆç½‘æ®µçš„ /16 ä¸è¦ä¸¢æ‰ 3ã€é…ç½®FEçš„JDKï¼š å®¹å™¨å†…éƒ¨çš„å·²ç»æœ‰äº†JDK11 ï¼Œæ‰€ä»¥æ— éœ€ä¸‹è½½ï¼Œç›´æ¥é…ç½® ä»¥ä¸‹æ˜¯3æ¡å‘½ä»¤ç›´æ¥åˆå¹¶ fe&gt; alternatives --set java java-11-openjdk.x86_64 &amp;&amp; alternatives --set javac java-11-openjdk.x86_64 &amp;&amp; export JAVA_HOME=/usr/lib/jvm/java-11 4ã€é…ç½®FEçš„ç¯å¢ƒå˜é‡ï¼š fe&gt; vi /etc/profile.d/doris.sh export DORIS_HOME=/opt/doris/fe/ export PATH=$PATH:$DORIS_HOME/bin # ä¿å­˜åé€€å‡ºvi fe&gt; source /etc/profile.d/doris.sh 5ã€å¯åŠ¨FE fe&gt; start_fe.sh --daemon 6ã€éªŒè¯FE è®¿é—®FEç½‘ç«™ http://localhost:18030 ï¼Œç™»å½•è´¦å·adminï¼Œå¯†ç ä¸ºç©ºã€‚ 1-4ã€é…ç½®BE1ã€å¯åŠ¨BE Docker docker run --privileged -it -d --name=doris-be-01 -p 9061:9060 -v /root/docker/doris/be-01/apache-doris-be-1.1.5-bin-x86_64:/opt/doris/be apache/doris:build-env-for-1.1.0 host&gt; docker run --privileged -it -d --name=doris-be-01 -p 9061:9060 -v /root/docker/doris/be-01/apache-doris-be-1.1.5-bin-x86_64:/opt/doris/be apache/doris:build-env-for-1.1.0 â€“privileged è¿™é‡Œæ·»åŠ äº†ç‰¹æƒæ¨¡å¼ï¼Œè·Ÿé…ç½®/etc/sysctl.confçš„vm.max_map_count=2000000ç›¸å…³ã€‚ â€“name=doris-be-01 å¤šä¸ªbeå¯¹åº”çš„åå­—ä¸åŒï¼šdoris-be-02ã€doris-be-03 -p 9061:9060 å¤šä¸ªbeå¯¹åº”çš„ç«¯å£ä¸åŒï¼Œ9062:9060ã€9063:9060 2ã€è¿›å…¥BEè¿›è¡Œç½‘ç»œé…ç½® host&gt; docker exec -it doris-be-01 /bin/bash # æŸ¥çœ‹FEçš„ipåœ°å€ be&gt; cat /etc/hosts # é…ç½®BEçš„ç½‘ç»œ be&gt; vi /opt/doris/be/conf/be.conf # å–æ¶ˆä¸‹é¢è¡Œçš„æ³¨é‡Šå¹¶æŠŠè¿™é‡Œçš„ipç½‘æ®µé…ç½®æˆä¸Šé¢æŸ¥çœ‹çš„ipåœ°å€ç½‘æ®µ vi&gt; priority_networks = 172.17.0.0/16 3ã€é…ç½®BEçš„JDKï¼š be&gt; alternatives --set java java-11-openjdk.x86_64 be&gt; alternatives --set javac java-11-openjdk.x86_64 be&gt; export JAVA_HOME=/usr/lib/jvm/java-11 alternatives --set java java-11-openjdk.x86_64 &amp;&amp; alternatives --set javac java-11-openjdk.x86_64 &amp;&amp; export JAVA_HOME=/usr/lib/jvm/java-11 4ã€é…ç½®BEçš„ç¯å¢ƒå˜é‡ï¼š be&gt; vi /etc/profile.d/doris.sh export DORIS_HOME=/opt/doris/be/ export PATH=$PATH:$DORIS_HOME/bin # ä¿å­˜åé€€å‡ºvi be&gt; source /etc/profile.d/doris.sh 5ã€é…ç½®vm.max_map_count be&gt; vi /etc/sysctl.conf vi&gt; vm.max_map_count=2000000 # ä¿å­˜é€€å‡ºvi # ç”Ÿæ•ˆ be&gt; sysctl -p # æŸ¥çœ‹ç»“æœ be&gt; sysctl -a | grep vm.max_map_count 6ã€å¯åŠ¨BE be&gt; start_be.sh --daemon 1-5ã€åŒç†ç»§ç»­ 1-4 æ­¥éª¤ï¼Œé…ç½®å’Œè¿è¡Œå…¶ä½™BEï¼šè¿è¡Œdoris-be-02ï¼š host&gt; docker run --privileged -it -d --name=doris-be-02 -p 9062:9060 -v /root/docker/doris/be-02/apache-doris-be-1.1.5-bin-x86_64:/opt/doris/be apache/doris:build-env-for-1.1.0 è¿è¡Œdoris-be-03ï¼š host&gt; docker run --privileged -it -d --name=doris-be-03 -p 9063:9060 -v /root/docker/doris/be-03/apache-doris-be-1.1.5-bin-x86_64:/opt/doris/be apache/doris:build-env-for-1.1.0 1-6ã€åœ¨FEä¸­æ·»åŠ BE1ã€åœ¨FEç¯å¢ƒä¸­å®‰è£… mysqlå®¢æˆ·ç«¯ï¼š fe&gt; yum install mysql 2ã€ç„¶åè¿›å…¥é€šè¿‡mysqlå®¢æˆ·ç«¯è¿›å…¥dorisé…ç½®backendsï¼š fe&gt; mysql -h 127.0.0.1 -P9030 -uroot # 9050ä¸ºbeçš„å¿ƒè·³ç«¯å£heartbeat_service_port # æ‰©å®¹ mysql&gt; ALTER SYSTEM ADD BACKEND \"172.17.0.3:9050\"; mysql&gt; ALTER SYSTEM ADD BACKEND \"172.17.0.4:9050\"; mysql&gt; ALTER SYSTEM ADD BACKEND \"172.17.0.5:9050\"; # ç¼©å®¹ mysql&gt; ALTER SYSTEM DECOMMISSION BACKEND \"172.17.0.4:9050\"; # æŸ¥è¯¢èŠ‚ç‚¹çŠ¶æ€ Aliveå±æ€§trueå³ä¸ºæ­£å¸¸ mysql&gt; show PROC '/backends'; 3ã€ä¹Ÿå¯ä»¥é€šè¿‡FEç½‘ç«™æŸ¥çœ‹ï¼š 3ã€é›†æˆspringbootæ¡ˆä¾‹https://gitee.com/TK_LIMR/springcloud2021To2021 äºŒã€æ“ä½œ1ã€DDL1ã€ç®€å•æ¡ˆä¾‹fe&gt; mysql -h 127.0.0.1 -P9030 -uroot mysql&gt; create database db_test; mysql&gt; use db_test; mysql&gt; create table tbl_user_sync ( _id varchar(32) default '', user_name varchar(32) default '' ) duplicate key(_id) distributed by hash(_id) buckets 10 properties(\"replication_num\"=\"1\"); mysql&gt; insert into tbl_user_sync values('1','bob'); mysql&gt; select * from tbl_user_sync; +------+-------------+ | _id | user_name | +------+-------------+ | 1 | bob | +------+-------------+ 2ã€3ã€4ã€5ã€ä¸‰ã€1ã€2ã€3ã€4ã€5ã€å‚è€ƒæ–‡ç«  â†“æ­å»ºï¼šhttps://blog.csdn.net/tirestay/article/details/129621893 å»ºæ¨¡ï¼šhttps://zhuanlan.zhihu.com/p/533329686","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"https://mykkto.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://mykkto.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"docker","slug":"docker","permalink":"https://mykkto.github.io/tags/docker/"},{"name":"doris","slug":"doris","permalink":"https://mykkto.github.io/tags/doris/"}],"author":"mykk"},{"title":"Scalaè¯­è¨€å…¥æ‰‹çº²è¦ï¼ˆå®Œç»“ï¼‰","slug":"13-å¤§æ•°æ®/00-scala/01_scala","date":"2023-04-02T04:11:10.000Z","updated":"2023-11-16T03:37:26.407Z","comments":true,"path":"posts/6dd7f78f.html","link":"","permalink":"https://mykkto.github.io/posts/6dd7f78f.html","excerpt":"","text":"å‰è¨€1ã€é—²èŠæœ€è¿‘åšä¸»åœ¨å‡†å¤‡è½¬å¤§æ•°æ®ï¼Œäºæ˜¯å­¦ä¹ Flink,å»å¹´22å¹´5æœˆæœ‰æ–‡ç« ï¼Œä¸è¿‡æ›´æ–°åˆ° DataStream Api ç”¨æ³•ï¼Œæ—¶é—´è¯­ä¹‰å’Œçª—å£ç­‰ç­‰è¿˜æ²¡æœ‰æ›´æ–°ï¼Œ ç›®å‰åˆçˆ±ä¸Šäº† Scala ï¼Œä¼—æ‰€å‘¨çŸ¥Flink æˆ–è€…æ˜¯ Spark è¿™äº›æµæ‰¹è®¡ç®—æ¡†æ¶çš„ç¿˜æ¥šéƒ½æœ‰å®ƒçš„èº«å½±ï¼Œå³ä½¿ä¸åœ¨å¤§æ•°æ®ï¼Œåœ¨java é¡¹ç›®å¼€å‘ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼› scala å’Œ java ï¼Œå°±åƒ C and C++ ,å…¶å® scala ä¹Ÿå¯ä»¥ç§°ä¸º java ++ ï¼Œå®ƒçš„è¯­æ³•ç®€å•ï¼Œå¼€å‘é«˜æ•ˆï¼Œå…¶å®å³ä½¿ä½ æ˜¯javaå¼€å‘ä¹Ÿå¯ä»¥ç©ä»– ä»Šå¤©åšä¸»å¼€äº†è¿™ä¸ªä¸“æ ï¼Œå°±æ˜¯æƒ³æäº†æ··åˆå¼€å‘ï¼Œä¸‹åˆæäº†åŠå¤©ç»ˆäºæå®š SpringBoot (scala + java) çš„jar æ‰“åŒ…éƒ¨ç½² maven é¡¹ç›® å½“ç„¶äº†ï¼Œè¿™ä¸ªä¸“æ ä¹Ÿä¼šæ˜¯å®Œæ•´çš„ scala å­¦ä¹ æ•™ç¨‹ï¼ å®Œç»“æ’’èŠ±ï¼~ æ¸©é¦¨æç¤ºï¼Œæœ€å¥½æ˜¯æœ‰javaåŸºç¡€ï¼Œå› ä¸ºå¤§å¤šæ•°æ¡ˆä¾‹æ˜¯å’Œjava å¯¹æ¯” 2ã€SpringBoot(Scala and Java)1ã€å‡†å¤‡å¼€å‘ç¯å¢ƒé¦–å…ˆ jdk8 å°±ä¸è¯´äº†ï¼Œé»˜è®¤ä½ å·²ç»å®‰è£…äº†ï¼Œç›®å‰æä¾›çš„æ˜¯scala å®‰è£… æ³¨æ„ï¼šå½“å‰é€‚é…ç‰ˆæœ¬ JDK1.8 ï¼ŒSdk 2.12.11 1ã€é…ç½®ç¯å¢ƒå˜é‡,å…³äºSDK è¯„è®ºåŒºè§ ğŸ‘‡ 2ã€æµ‹è¯• 3ã€idea ä¸­ scala ç‰ˆæœ¬æ’ä»¶åœ°å€ https://plugins.jetbrains.com/plugin/1347-scala/versions/stable 4ã€é¡¹ç›®é…ç½®ç­‰éœ€è¦é…ç½® 2ã€ç¼–ç pom æ–‡ä»¶ &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;org.example&lt;/groupId&gt; &lt;artifactId&gt;scalaTest01&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;properties&gt; &lt;scala.version&gt;2.12.11&lt;/scala.version&gt; &lt;!-- &lt;spark.version&gt;3.0.1&lt;/spark.version&gt;--&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;version&gt;2.2.7.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;!-- å› ä¸ºæˆ‘ä»¬éœ€è¦ä½¿ç”¨Scalaä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åŠ å…¥scala-libraryä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;org.scala-lang&lt;/groupId&gt; &lt;artifactId&gt;scala-library&lt;/artifactId&gt; &lt;version&gt;2.12.11&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;!-- main æ–¹æ³•å…¥å£ï¼Œå¯ä»¥æ˜¯java ä¹Ÿå¯ä»¥æ˜¯ scala ,Springboot é¡¹ç›®çš„è¯åˆ™æ˜¯ä¸»å¯åŠ¨å™¨ --&gt; &lt;mainClass&gt;com.JavaDemo&lt;/mainClass&gt; &lt;includeSystemScope&gt;true&lt;/includeSystemScope&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.scala-tools&lt;/groupId&gt; &lt;artifactId&gt;maven-scala-plugin&lt;/artifactId&gt; &lt;version&gt;2.15.2&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;scala-compile-first&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;compile&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;includes&gt; &lt;include&gt;**/*.scala&lt;/include&gt; &lt;/includes&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;compile&lt;/goal&gt; &lt;!-- &lt;goal&gt;testCompile&lt;/goal&gt;--&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;jvmArgs&gt; &lt;!-- éœ€è¦çš„é…ç½® --&gt; &lt;jvmArg&gt;-Xss8m&lt;/jvmArg&gt; &lt;/jvmArgs&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;execution&gt; &lt;id&gt;scala-test-compile&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;testCompile&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;2.3.2&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; æ³¨æ„ï¼šscala å’Œ java è¦åˆ†å¼€ï¼Œä¸ç„¶ç¼–è¯‘ä¼šå‡ºé—®é¢˜ 1ã€JavaDemo.java ï¼Œjavaä»£ç è°ƒç”¨ scala package com; import com.kk.chapter01.Car; public class JavaDemo { public static void main(String[] args) { Car car = new Car (2009); System.out.println(car); car.drive(10); System.out.println(\"java:\"+car); } } 2ã€Car.scala (Object) package com.kk.chapter01 class Car(val year: Int) { private[this] var miles: Int = 0 def drive(distance: Int) { miles += distance println(\"scala:\" + miles) } override def toString(): String = \"year:\" + year + \" miles:\" + miles } 3ã€TestScala$.scala (class) package com.kk.chapter01 object TestScala { def main(args: Array[String]): Unit = { var str1: String = new String(\"hello\") var str2: String = \"hello\" println(str1 == str2) var age: Int = 25 var sal: Float = 3.2f var height: Double = 176.51 // æ ¼å¼åŒ–å­—ç¬¦ä¸² printf(\"åå­—--%s å¹´é¾„%d è–ªèµ„%f èº«é«˜%f\", str1, age, sal, height) println() // scala æ”¯æŒä½¿ç”¨ $è¾“å‡ºå†…å®¹ï¼Œç¼–è¯‘å™¨ä¼šè§£æå¯¹åº” $å˜é‡ println(s\"å½“ä¸‹çš„ä¿¡æ¯ï¼š\\n$str1,\\tå¹´é¾„ï¼š$age\\tè–ªèµ„ï¼š$sal\\tèº«é«˜ï¼š$height\") // æ·»åŠ è®¡ç®—å†…å®¹ println(s\"å½“ä¸‹çš„ä¿¡æ¯ï¼š\\n$str1,\\tå¹´é¾„ï¼š$age\\tè–ªèµ„ï¼š${sal * 1.2}\\tèº«é«˜ï¼š$height\") } } æ ¸å¿ƒï¼šæ‰“åŒ…æ³¨æ„ï¼šé¡ºåºå¿…é¡»è¦è¿™æ ·ï¼Œclean(maven) -&gt; ç¼–è¯‘ï¼ˆé‚£ä¸ªé”¤å­æ•²ä¸€ä¸‹ï¼‰ -&gt; package(maven) ç¬¬ä¸€æ­¥ï¼Œclear ä¿è¯æ¸…ç©º ç¬¬äºŒæ­¥ï¼Œç¼–è¯‘ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæŠŠjava and scala ç¼–è¯‘å®Œæˆ ç¬¬ä¸‰æ­¥ï¼Œç¡®è®¤äº†ï¼Œç¼–è¯‘å‡º scala and java çš„ class æ‰æ‰“åŒ…æ‰ä¼šæˆåŠŸï¼Œæ³¨æ„åŒ…å†…è¦æœ‰ lib åŒ…å« scalaçš„ä¾èµ– ä¸€ã€æ•°æ®ç±»å‹1ã€å˜é‡å’Œå¸¸é‡1ã€æ³¨é‡ŠScala æ³¨é‡Šä½¿ç”¨å’Œ Java å®Œå…¨ä¸€æ · åŸºæœ¬è¯­æ³• ( 1 )å•è¡Œæ³¨é‡Šï¼š// ( 2 )å¤šè¡Œæ³¨é‡Šï¼š/* */ ( 3 )æ–‡æ¡£æ³¨é‡Šï¼š/** * */ 2ã€å˜é‡å’Œå¸¸é‡ï¼ˆ1ï¼‰Java å˜é‡å’Œå¸¸é‡è¯­æ³• å˜é‡ç±»å‹ å˜é‡åç§° = åˆå§‹å€¼ int a = 10 final å¸¸é‡ç±»å‹ å¸¸é‡åç§° = åˆå§‹å€¼ final int b = 20 ï¼ˆ2ï¼‰scala ä¸­çš„è¯­æ³• var å˜é‡å [: å˜é‡ç±»å‹] = åˆå§‹å€¼ var a:Int = 10 val å¸¸é‡å [: å¸¸é‡ç±»å‹] = åˆå§‹å€¼ val b:Int = 20 æ³¨æ„ ï¼šèƒ½ç”¨å¸¸é‡çš„åœ°æ–¹ä¸ç”¨å˜é‡ 3ã€æ ‡è¯†ç¬¦å‘½åè§„èŒƒScala ä¸­çš„æ ‡è¯†ç¬¦å£°æ˜ï¼ŒåŸºæœ¬å’Œ Java æ˜¯ä¸€è‡´çš„ ï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šä¼šæœ‰æ‰€å˜åŒ–ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§è§„åˆ™ï¼š â€‹ ( 1 )ä»¥å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿å¼€å¤´ï¼Œåæ¥å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ â€‹ ( 2 )ä»¥æ“ä½œç¬¦å¼€å¤´ï¼Œä¸”åªåŒ…å«æ“ä½œç¬¦(+ - * / # !ç­‰) â€‹ ( 3 )ç”¨åå¼•å·`â€¦.`åŒ…æ‹¬çš„ä»»æ„å­—ç¬¦ä¸²ï¼Œå³ä½¿æ˜¯ Scala å…³é”®å­—( 39 ä¸ª)ä¹Ÿå¯ä»¥ â€¢ package, import, class, object, trait, extends, with, type, for â€¢ private, protected, abstract, sealed, final, implicit, lazy, override â€¢ try, catch, finally, throw â€¢ if, else, match, case, do, while, for, return, yield â€¢ def, val, var â€¢ this, super â€¢ new â€¢ true, false, null 4ã€å­—ç¬¦ä¸²è¾“å‡º1ã€åŸºæœ¬è¯­æ³• â€‹ ( 1 )å­—ç¬¦ä¸²ï¼Œé€šè¿‡+å·è¿æ¥ â€‹ ( 2 ) printf ç”¨æ³•ï¼šå­—ç¬¦ä¸²ï¼Œé€šè¿‡%ä¼ å€¼ã€‚ â€‹ ( 3 )å­—ç¬¦ä¸²æ¨¡æ¿ (æ’å€¼å­—ç¬¦ä¸²) ï¼šé€šè¿‡$è·å–å˜é‡å€¼ package com.kk.demo1 object Test01 { def main(args: Array[String]): Unit = { var name: String = \"jinlian\" var age: Int = 18 // ( 1 )å­—ç¬¦ä¸²ï¼Œé€šè¿‡+å·è¿æ¥ println(name + \" \" + age) // ( 2 ) printf ç”¨æ³•å­—ç¬¦ä¸²ï¼Œé€šè¿‡%ä¼ å€¼ã€‚ printf(\"name=%s age=%d\\n\", name, age) // ( 3 )å­—ç¬¦ä¸²ï¼Œé€šè¿‡$å¼•ç”¨ //å¤šè¡Œå­—ç¬¦ä¸²ï¼Œåœ¨ Scalaä¸­ï¼Œåˆ©ç”¨ä¸‰ä¸ªåŒå¼•å·åŒ…å›´å¤šè¡Œå­—ç¬¦ä¸²å°±å¯ä»¥å®ç°ã€‚ // è¾“å…¥çš„å†…å®¹ï¼Œå¸¦æœ‰ç©ºæ ¼ã€\\t ä¹‹ç±»ï¼Œå¯¼è‡´æ¯ä¸€è¡Œçš„å¼€å§‹ä½ç½®ä¸èƒ½æ•´æ´å¯¹é½ã€‚ // åº”ç”¨ scala çš„ stripMargin æ–¹æ³•ï¼Œåœ¨ scala ä¸­ stripMargin é»˜è®¤ // æ˜¯ â€œ|â€ä½œä¸ºè¿æ¥ç¬¦ï¼Œ//åœ¨å¤šè¡Œæ¢è¡Œçš„è¡Œå¤´å‰é¢åŠ ä¸€ä¸ªâ€œ|â€ç¬¦å·å³å¯ã€‚ val s = \"\"\" |select |from , | user |where name=\"zhangsan\" \"\"\".stripMargin println(s) //å¦‚æœéœ€è¦å¯¹å˜é‡è¿›è¡Œè¿ç®—ï¼Œé‚£ä¹ˆå¯ä»¥åŠ ${} val s1 = s\"\"\" |select | name, | age |from user |where name=\"$name\" and age=${age + 2} \"\"\".stripMargin println(s1) val s2 = s\"name=$name\" println(s2) } } è¾“å‡ºï¼š jinlian 18 name=jinlian age=18 select from , user where name=\"zhangsan\" select name, age from user where name=\"jinlian\" and age=20 name=jinlian 5ã€é”®ç›˜è¾“å…¥1ã€åŸºæœ¬è¯­æ³• StdIn.readLine()ã€StdIn.readShort()ã€StdIn.readDouble() package com.kk.demo1 import scala.io.StdIn object Test02 { def main(args: Array[String]): Unit = { // 1 è¾“å…¥å§“å println(\"input name:\") var name = StdIn.readLine() // 2 è¾“å…¥å¹´é¾„ println(\"input age:\") var age = StdIn.readShort() // 3 è¾“å…¥è–ªæ°´ println(\"input sal:\") var sal = StdIn.readDouble() // 4 æ‰“å° println(\"name=\" + name) println(\"age=\" + age) println(\"sal=\" + sal) } } è¾“å‡º input name: å¤§æ ¹ input age: 18 input sal: 18000.6 name=å¤§æ ¹ age=18 sal=18000.6 2ã€æ•°æ®ç±»å‹1ã€æ•´æ•°å‹ æ•°æ®ç±»å‹ æè¿° Byte [1] 8 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -128 åˆ° 127 Short [2] 16 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -32768 åˆ° 32767 Int [4] 32 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -2147483648 åˆ° 2147483647 Long [8] 64 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -9223372036854775808 åˆ°9223372036854775807 = 2 çš„(64-1)æ¬¡æ–¹-1 Scala ç¨‹åºä¸­å˜é‡å¸¸å£°æ˜ä¸º Int å‹ ï¼Œé™¤éä¸è¶³ä»¥è¡¨ç¤ºå¤§æ•°ï¼Œæ‰ä½¿ç”¨ Long 2ã€æµ®ç‚¹å‹ æ•°æ®ç±»å‹ æè¿° Float [4] 32 ä½, IEEE 754 æ ‡å‡†çš„å•ç²¾åº¦æµ®ç‚¹æ•° Double [8] 64 ä½ IEEE 754 æ ‡å‡†çš„åŒç²¾åº¦æµ®ç‚¹æ•° Scala çš„æµ®ç‚¹å‹å¸¸é‡é»˜è®¤ä¸º Double å‹ï¼Œå£°æ˜ Float å‹å¸¸é‡ï¼Œé¡»ååŠ â€˜fâ€™æˆ–â€˜Fâ€™ package com.kk.demo2 object Test01 { def main(args: Array[String]): Unit = { // å»ºè®®ï¼Œåœ¨å¼€å‘ä¸­éœ€è¦é«˜ç²¾åº¦å°æ•°æ—¶ï¼Œè¯·é€‰æ‹© Double var n7 = 2.2345678912f var n8 = 2.2345678912 println(\"n7=\" + n7) println(\"n8=\" + n8) } } è¾“å‡º n7=2.2345679 n8=2.2345678912 3ã€å­—ç¬¦å‹å­—ç¬¦ç±»å‹å¯ä»¥è¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œå­—ç¬¦ç±»å‹æ˜¯ Char 1ã€åŸºæœ¬è¯­æ³• â€‹ ( 1 )å­—ç¬¦å¸¸é‡æ˜¯ç”¨å•å¼•å· ' ' æ‹¬èµ·æ¥çš„å•ä¸ªå­—ç¬¦ã€‚ â€‹ ( 2 ) \\t ï¼šä¸€ä¸ªåˆ¶è¡¨ä½ï¼Œå®ç°å¯¹é½çš„åŠŸèƒ½ â€‹ ( 3 ) \\n ï¼šæ¢è¡Œç¬¦ â€‹ ( 4 ) \\ ï¼šè¡¨ç¤º\\ â€‹ ( 5 ) \" ï¼šè¡¨ç¤º\" 4ã€å¸ƒå°”å‹â€‹ ( 1 ) Booolean ç±»å‹æ•°æ®åªå…è®¸å–å€¼ true å’Œ false â€‹ ( 2 ) boolean ç±»å‹å  1 ä¸ªå­—èŠ‚ 5ã€Unitã€Nullã€Nothing (é‡ç‚¹) æ•°æ®ç±»å‹ æè¿° Unit è¡¨ç¤ºæ— å€¼ï¼Œå’Œå…¶ä»–è¯­è¨€ä¸­ void ç­‰åŒã€‚ç”¨ä½œä¸è¿”å›ä»»ä½•ç»“æœçš„æ–¹æ³•çš„ç»“æœç±»å‹ã€‚ Unit åªæœ‰ä¸€ä¸ªå®ä¾‹å€¼ï¼Œå†™æˆ()ã€‚ Null null , Null ç±»å‹åªæœ‰ä¸€ä¸ªå®ä¾‹å€¼ null Nothing Nothing ç±»å‹åœ¨Scala çš„ç±»å±‚çº§æœ€ä½ç«¯ï¼›å®ƒæ˜¯ä»»ä½•å…¶ä»–ç±»å‹çš„å­ç±»å‹ã€‚ å½“ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç¡®å®šæ²¡æœ‰æ­£å¸¸çš„è¿”å›å€¼ï¼Œå¯ä»¥ç”¨Nothing æ¥æŒ‡å®šè¿”å›ç±» å‹ï¼Œè¿™æ ·æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠè¿”å›çš„å€¼(å¼‚å¸¸)èµ‹ç»™å…¶å®ƒçš„å‡½æ•°æˆ–è€…å˜é‡(å…¼å®¹æ€§) 1ã€Unit package com.kk.demo2 object Test02 { def main(args: Array[String]): Unit = { def sayOK: Unit = { } print(sayOK) } } è¾“å‡º ï¼ˆï¼‰ 2ã€Null Null ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œ Null ç±»ä¼¼äº Java ä¸­çš„ null å¼•ç”¨ã€‚Null å¯ä»¥èµ‹å€¼ç»™ä»»æ„å¼•ç”¨ç±»å‹ï¼Œä½†æ˜¯ä¸èƒ½èµ‹å€¼ç»™å€¼ç±»å‹ var cat = new Cat(); cat = null // æ­£ç¡® var n1: Int = null // é”™è¯¯ 3ã€Nothing å¯ä»¥ä½œä¸ºæ²¡æœ‰æ­£å¸¸è¿”å›å€¼çš„æ–¹æ³•çš„è¿”å›ç±»å‹ï¼Œéå¸¸ç›´è§‚çš„å‘Šè¯‰ä½ è¿™ä¸ªæ–¹æ³•ä¸ä¼šæ­£å¸¸è¿”å›ï¼Œè€Œä¸”ç”±äº Nothing æ˜¯å…¶ä»–ä»»æ„ç±»å‹çš„å­ç±»ï¼Œä»–è¿˜èƒ½è·Ÿè¦æ±‚è¿”å›å€¼çš„æ–¹æ³•å…¼å®¹ def main(args: Array[String]): Unit = { def test(): Nothing = { throw new Exception() } test } è¾“å‡º Exception in thread \"main\" java.lang.Exception at com.com.demo2.Test02$.test$1(Test02.scala:6) at com.com.demo2.Test02$.main(Test02.scala:9) at com.com.demo2.Test02.main(Test02.scala) 3ã€ç±»å‹è½¬æ¢1ã€ç±»å‹è‡ªåŠ¨è½¬æ¢è‡ªåŠ¨ç±»å‹è½¬æ¢(éšå¼è½¬æ¢),ç±»å‹è‡ªåŠ¨æå‡ 2ã€å¼ºåˆ¶ç±»å‹è½¬æ¢è‡ªåŠ¨ç±»å‹è½¬æ¢çš„é€†è¿‡ç¨‹ï¼Œå°†ç²¾åº¦å¤§çš„æ•°å€¼ç±»å‹è½¬æ¢ä¸ºç²¾åº¦å°çš„æ•°å€¼ç±»å‹ã€‚ä½¿ç”¨æ—¶è¦åŠ ä¸Šå¼ºåˆ¶è½¬å‡½æ•°ï¼Œä½†å¯èƒ½é€ æˆç²¾åº¦é™ä½æˆ–æº¢å‡ºï¼Œæ ¼å¤–è¦æ³¨æ„ã€‚ è¯­æ³• Java : int num = (int)2.5 Scala : var num : Int = 2.7.toInt 3ã€æ•°å€¼ç±»å‹å’Œ String ç±»å‹é—´è½¬æ¢def main(args: Array[String]): Unit = { // ( 1 )åŸºæœ¬ç±»å‹è½¬ String ç±»å‹(è¯­æ³•ï¼šå°†åŸºæœ¬ç±»å‹çš„å€¼+\"\" å³å¯) var str1 : String = true + \"\" var str2: String = 4.5 + \"\" var str3: String = 100 + \"\" // ( 2 ) String ç±»å‹è½¬åŸºæœ¬æ•°å€¼ç±»å‹(è¯­æ³•ï¼šè°ƒç”¨ç›¸å…³ API ) var s1: String = \"12\" var n1: Byte = s1.toByte var n2: Short = s1.toShort var n3: Int = s1.toInt var n4: Long = s1.toLong } äºŒã€è¿ç®—ç¬¦1ã€ç®—æœ¯è¿ç®—ç¬¦ è¿ç®—ç¬¦ è¿ç®— èŒƒä¾‹ ç»“æœ + æ­£å· +3 3 - è´Ÿå· b=4; -b -4 + åŠ  5+5 10 - å‡ 6-4 2 * ä¹˜ 3*4 12 / é™¤ 5/5 1 % å–æ¨¡(å–ä½™) 7%5 2 + å­—ç¬¦ä¸²ç›¸åŠ  â€œHeâ€+â€lloâ€ â€œHelloâ€ 2ã€æ¯”è¾ƒï¼ˆå…³ç³»ï¼‰è¿ç®—ç¬¦ è¿ç®—ç¬¦ è¿ç®— èŒƒä¾‹ ç»“æœ == ç›¸ç­‰äº 4==3 false != ä¸ç­‰äº 4 ï¼=3 true &lt; å°äº 4&lt;3 false &gt; å¤§äº 4&gt;3 true &lt;= å°äºç­‰äº 4&lt;=3 false &gt;= å¤§äºç­‰äº 4&gt;=3 true Java ï¼š ==æ¯”è¾ƒä¸¤ä¸ªå˜é‡æœ¬èº«çš„å€¼ï¼Œå³ä¸¤ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€ ï¼› equals æ¯”è¾ƒå­—ç¬¦ä¸²ä¸­æ‰€åŒ…å«çš„å†…å®¹æ˜¯å¦ç›¸åŒã€‚ public static void main(String[] args) { String s1 = \"abc\"; String s2 = new String(\"abc\"); System.out.println(s1 == s2); System.out.println(s1.equals(s2)); } è¾“å‡ºç»“æœï¼š false true Scala ï¼š==æ›´åŠ ç±»ä¼¼äº Java ä¸­çš„ equals ï¼Œå‚ç…§ jd å·¥å…· def main(args: Array[String]): Unit = { val s1 = \"abc\" val s2 = new String(\"abc\") println(s1 == s2) println(s1.eq(s2)) } è¾“å‡ºç»“æœï¼š true false 3ã€é€»è¾‘è¿ç®—ç¬¦ è¿ç®—ç¬¦ æè¿° å®ä¾‹ &amp;&amp; é€»è¾‘ä¸ (A &amp;&amp; B) è¿ç®—ç»“æœä¸º false || é€»è¾‘æˆ– (A || B) è¿ç®—ç»“æœä¸º true ! é€»è¾‘é !(A &amp;&amp; B) è¿ç®—ç»“æœä¸º true 4ã€èµ‹å€¼è¿ç®—ç¬¦ è¿ç®—ç¬¦ æè¿° å®ä¾‹ = ç®€å•çš„èµ‹å€¼è¿ç®—ç¬¦ï¼Œå°†ä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼èµ‹ç»™ä¸€ä¸ªå·¦å€¼ C = A + B å°† A + B è¡¨è¾¾å¼ç»“æœèµ‹å€¼ç»™ C += ç›¸åŠ åå†èµ‹å€¼ C += A ç­‰äº C = C + A -= ç›¸å‡åå†èµ‹å€¼ C -= A ç­‰äº C = C - A *= ç›¸ä¹˜åå†èµ‹å€¼ C *= A ç­‰äº C = C * A /= ç›¸é™¤åå†èµ‹å€¼ C /= A ç­‰äº C = C / A %= æ±‚ä½™åå†èµ‹å€¼ C %= A ç­‰äº C = C % A &lt;&lt;= å·¦ç§»åèµ‹å€¼ C &lt;&lt;= 2 ç­‰äº C = C &lt;&lt; 2 &gt;&gt;= å³ç§»åèµ‹å€¼ C &gt;&gt;= 2 ç­‰äº C = C &gt;&gt; 2 &amp;= æŒ‰ä½ä¸åèµ‹å€¼ C &amp;= 2 ç­‰äº C = C &amp; 2 ^= æŒ‰ä½å¼‚æˆ–åèµ‹å€¼ C ^= 2 ç­‰äº C = C ^ 2 |= æŒ‰ä½æˆ–åèµ‹å€¼ C |= 2 ç­‰äº C = C | 2 5ã€ä½è¿ç®—ç¬¦ è¿ç®—ç¬¦ æè¿° å®ä¾‹ &amp; æŒ‰ä½ä¸è¿ç®—ç¬¦ (a &amp; b) è¾“å‡ºç»“æœ 12 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0000 1100 | æŒ‰ä½æˆ–è¿ç®—ç¬¦ (a | b) è¾“å‡ºç»“æœ 61 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0011 1101 ^ æŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦ (a ^ b) è¾“å‡ºç»“æœ 49 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0011 0001 ~ æŒ‰ä½å–åè¿ç®—ç¬¦ (~a ) è¾“å‡ºç»“æœ -61 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 1100 0011 ï¼Œ åœ¨ä¸€ä¸ªæœ‰ç¬¦å·äºŒè¿›åˆ¶æ•°çš„è¡¥ç å½¢å¼ã€‚ &lt;&lt; å·¦ç§»åŠ¨è¿ç®—ç¬¦ a &lt;&lt; 2 è¾“å‡ºç»“æœ 240 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0011 0000 &gt;&gt; å³ç§»åŠ¨è¿ç®—ç¬¦ a &gt;&gt; 2 è¾“å‡ºç»“æœ 15 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0000 1111 &gt;&gt;&gt; æ— ç¬¦å·å³ç§» a &gt;&gt;&gt;2 è¾“å‡ºç»“æœ 15, äºŒè¿›åˆ¶è§£é‡Š: 0000 1111 6ã€è¿ç®—ç¬¦æœ¬è´¨åœ¨ Scala ä¸­å…¶å®æ˜¯æ²¡æœ‰è¿ç®—ç¬¦çš„ ï¼Œæ‰€æœ‰è¿ç®—ç¬¦éƒ½æ˜¯æ–¹æ³•ã€‚ 1 ) å½“è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œç‚¹.å¯ä»¥çœç•¥ 2 ) å¦‚æœå‡½æ•°å‚æ•°åªæœ‰ä¸€ä¸ªï¼Œæˆ–è€…æ²¡æœ‰å‚æ•° ï¼Œ()å¯ä»¥çœç•¥ ä¸‰ã€æµç¨‹æ§åˆ¶1ã€åˆ†æ”¯æ§åˆ¶if else å•åˆ†æ”¯ï¼ŒåŒåˆ†æ”¯ï¼Œå¤šåˆ†æ”¯ï¼ŒåµŒå¥—åˆ†æ”¯ å…¶å®å’Œjavaä¸€æ ·ï¼Œä¸åŒçš„æ˜¯å¯ä»¥è¿”å› 1ã€è¾“å…¥å¹´é¾„ï¼Œæ‰“å°å¹´çºªï¼Œè¿”å›String var age = StdIn.readInt() val res :String = if (age &lt; 18){ \"ç«¥å¹´\" }else if(age&gt;=18 &amp;&amp; age&lt;30){ \"ä¸­å¹´\" }else{ \"è€å¹´\" } println(res) 2ã€Scala ä¸­è¿”å›å€¼ç±»å‹ä¸ä¸€è‡´ï¼Œå–å®ƒä»¬å…±åŒçš„ç¥–å…ˆç±»å‹ var age = StdIn.readInt() val res: Any = if (age &lt; 18) { \"ç«¥å¹´\" } else if (age &gt;= 18 &amp;&amp; age &lt; 30) { \"ä¸­å¹´\" } else { 100 } println(res) 3ã€ä¸‰å…ƒè¿ç®—å®ç° var age = StdIn.readInt() val res: Any = if (age &lt; 18) \"ç«¥å¹´\" else \"æˆå¹´\" \"ä¸èµ·ä½œç”¨\" println(res) 1ã€Switch åˆ†æ”¯ç»“æ„åœ¨ Scala ä¸­æ²¡æœ‰ Switch ï¼Œè€Œæ˜¯ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥å¤„ç† æ¨¡å¼åŒ¹é…æ¶‰ä¸‹é¢çš„ç« èŠ‚æè¿° 2ã€å¾ªç¯æ§åˆ¶ï¼ˆforï¼‰1ã€èŒƒå›´æ•°æ®å¾ªç¯ï¼ˆToï¼‰è¾“å‡º 1-3 ï¼ˆåŒ…å«1 and 3ï¼‰ï¼Œå‰åé—­åˆåŒºé—´ for (i &lt;- 1 to 3) { print(i + \" \") } è¾“å‡ºï¼š1 2 3 2ã€èŒƒå›´æ•°æ®å¾ªç¯(Until)è¾“å‡º 1-3 ï¼ˆåŒ…å«1 ä¸åŒ…å« 3ï¼‰,å‰é—­åˆåå¼€ for (i &lt;- 1 until 5 + 1) { println(\" \" + i) } è¾“å‡ºï¼š1 2 3 4 5 3ã€å¾ªç¯å®ˆå«å¾ªç¯å®ˆå«ï¼Œå³å¾ªç¯ä¿æŠ¤å¼(ä¹Ÿç§°æ¡ä»¶åˆ¤æ–­å¼ï¼Œå®ˆå«)ã€‚ä¿æŠ¤å¼ä¸º true åˆ™è¿›å…¥å¾ªç¯ ä½“å†…éƒ¨ï¼Œä¸º false åˆ™è·³è¿‡ï¼Œç±»ä¼¼äº continue for (i &lt;- 1 to 3 if i != 2) { print(i + \" \") } // --------ç­‰ä»·äº--------- for (i &lt;- 1 to 3) { if (i != 2) print(i + \" \") } è¾“å‡ºï¼š1 3 4ã€å¾ªç¯æ­¥é•¿è¾“å‡º 1 åˆ° 10 ä»¥å†…çš„æ‰€æœ‰å¥‡æ•° for (i &lt;- 1 to 10 by 2) { println(\"i=\" + i) } è¾“å‡ºï¼š1 3 5 7 9 5ã€åµŒå¥—å¾ªç¯è¯´æ˜ ï¼šæ²¡æœ‰å…³é”®å­—ï¼Œæ‰€ä»¥èŒƒå›´åä¸€å®šè¦åŠ  ï¼›æ¥éš”æ–­é€»è¾‘ for (i &lt;- 1 to 3; j &lt;- 1 to 3) { println(\" i =\" + i + \" j = \" + j) } // --------ç­‰ä»·äº--------- for (i &lt;- 1 to 3) { for (j &lt;- 1 to 3) { println(\"i =\" + i + \" j=\" + j) } } è¾“å‡ºï¼š i =1 j=1 i =1 j=2 i =1 j=3 i =2 j=1 i =2 j=2 i =2 j=3 i =3 j=1 i =3 j=2 i =3 j=3 6ã€å¼•å…¥å˜é‡â€‹ ( 1 ) for æ¨å¯¼å¼ä¸€è¡Œä¸­æœ‰å¤šä¸ªè¡¨è¾¾å¼æ—¶ï¼Œæ‰€ä»¥è¦åŠ  ; æ¥éš”æ–­é€»è¾‘ â€‹ ( 2 ) for æ¨å¯¼å¼æœ‰ä¸€ä¸ªä¸æˆæ–‡çš„çº¦å®šï¼šå½“ for æ¨å¯¼å¼ä»…åŒ…å«å•ä¸€è¡¨è¾¾å¼æ—¶ä½¿ç”¨åœ†æ‹¬å·ï¼Œå½“åŒ…å«å¤šä¸ªè¡¨è¾¾å¼æ—¶ï¼Œä¸€èˆ¬æ¯è¡Œä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¹¶ç”¨èŠ±æ‹¬å·ä»£æ›¿åœ†æ‹¬å· for {i &lt;- 1 to 3 j = 4 - i} { println(\"i=\" + i + \" j=\" + j) } // --------ç­‰ä»·äº--------- for (i &lt;- 1 to 3) { var j = 4 - i println(\"i=\" + i + \" j=\" + j) } è¾“å‡ºï¼š i=1 j=3 i=2 j=2 i=3 j=1 7ã€å¾ªç¯è¿”å›å€¼è¯´æ˜ï¼šå°†éå†è¿‡ç¨‹ä¸­å¤„ç†çš„ç»“æœè¿”å›åˆ°ä¸€ä¸ªæ–° Vector é›†åˆä¸­ï¼Œä½¿ç”¨ yield å…³é”®å­— æ³¨æ„ ï¼šå¼€å‘ä¸­å¾ˆå°‘ä½¿ç”¨ var res = for (i &lt;- 1 to 10) yield { i * 2 } println(res) è¾“å‡ºï¼š Vector(2, 4, 6, 8, 10, 12, 14, 16, 18, 20) 8ã€å€’å™æ‰“å°å¦‚æœæƒ³å€’åºæ‰“å°ä¸€ç»„æ•°æ®ï¼Œå¯ä»¥ç”¨ reverse for (i &lt;- 1 to 10 reverse) { print(i) } è¾“å‡ºï¼š 10 9 8 7 6 5 4 3 2 1 3ã€å¾ªç¯æ§åˆ¶ï¼ˆwhileï¼‰1ã€whiledef main(args: Array[String]): Unit = { var i = 0 while (i &lt; 10) { println(\" \" + i) i += 1 } } 2ã€do..whiledef main(args: Array[String]): Unit = { var i = 0 do { println(\" \" + i) i += 1 } while (i &lt; 10) } 4ã€å¾ªç¯ä¸­æ–­1ã€å¼‚å¸¸æ–¹å¼ä¸­æ–­def main(args: Array[String]): Unit = { try{ for (elem &lt;- 1 to 10 ){ println(elem) if ï¼ˆelem ==5) throw new RuntimeException } }catch { case e =&gt; } } 2ã€break æ–¹å¼def main(args: Array[String]): Unit = { breakable { for (elem &lt;- 1 to 10) { println(elem) if (elem == 5) break } } } 3ã€continuedef main(args: Array[String]): Unit = { for (elem &lt;- 1 to 10) { breakable { if (elem == 5) { break() } println(elem) } } } 5ã€å¤šé‡å¾ªç¯ä¹ä¹ä¹˜æ³•è¡¨:åµŒå¥—å’Œå¤šé‡ä¸€æ ·ï¼Œæ— éæ˜¯for å¥— for def main(args: Array[String]): Unit = { for (i&lt;- 1 to 9;j &lt;- 1 to i)print(j + \"*\" + i + \"=\" + (i * j) + \"\\t\") } å››ã€å‡½æ•°å¼ç¼–ç¨‹1ã€åŸºæœ¬å‡½æ•°1ã€åŸºæœ¬è¯­æ³• def main(args: Array[String]): Unit = { def test(arg1: String): Unit ={ print(arg1) } // è°ƒç”¨ test(\"hello scala\") } 2ã€å‡½æ•°å’Œæ–¹æ³•çš„åŒºåˆ«1ã€æ ¸å¿ƒæ¦‚å¿µ â€‹ ( 1 )ä¸ºå®ŒæˆæŸä¸€åŠŸèƒ½çš„ç¨‹åºè¯­å¥çš„é›†åˆï¼Œç§°ä¸ºå‡½æ•° â€‹ ( 2 )ç±»ä¸­çš„å‡½æ•°ç§°ä¹‹æ–¹æ³• 2ã€åŒºåˆ« â€‹ ( 1 ) Scala è¯­è¨€å¯ä»¥åœ¨ä»»ä½•çš„è¯­æ³•ç»“æ„ä¸­å£°æ˜ä»»ä½•çš„è¯­æ³• â€‹ ( 2 )å‡½æ•°æ²¡æœ‰é‡è½½å’Œé‡å†™çš„æ¦‚å¿µï¼›æ–¹æ³•å¯ä»¥è¿›è¡Œé‡è½½å’Œé‡å†™ â€‹ ( 3 ) Scala ä¸­å‡½æ•°å¯ä»¥åµŒå¥—å®šä¹‰ def main(args: Array[String]): Unit = { // (2)æ–¹æ³•å¯ä»¥è¿›è¡Œé‡è½½å’Œé‡å†™ï¼Œç¨‹åºå¯ä»¥æ‰§è¡Œ def main(): Unit = { } def main(args: Array[String]): Unit = { // ( 1 ) Scala è¯­è¨€å¯ä»¥åœ¨ä»»ä½•çš„è¯­æ³•ç»“æ„ä¸­å£°æ˜ä»»ä½•çš„è¯­æ³• import java.util.Date new Date() // (2)å‡½æ•°æ²¡æœ‰é‡è½½å’Œé‡å†™çš„æ¦‚å¿µï¼Œç¨‹åºæŠ¥é”™ def test(): Unit = { println(\"æ— å‚ï¼Œæ— è¿”å›å€¼\") } test() def test(name: String): Unit = { println() } // ( 3 ) Scala ä¸­å‡½æ•°å¯ä»¥åµŒå¥—å®šä¹‰ def test2(): Unit = { def test3(name: String): Unit = { println(\"å‡½æ•°å¯ä»¥åµŒå¥—å®šä¹‰\") } } } } 3ã€å‡½æ•°çš„å®šä¹‰â€‹ ( 1 )å‡½æ•° 1 ï¼šæ— å‚ï¼Œæ— è¿”å›å€¼ â€‹ ( 2 )å‡½æ•° 2 ï¼šæ— å‚ï¼Œæœ‰è¿”å›å€¼ â€‹ ( 3 )å‡½æ•° 3 ï¼šæœ‰å‚ï¼Œæ— è¿”å›å€¼ â€‹ ( 4 )å‡½æ•° 4 ï¼šæœ‰å‚ï¼Œæœ‰è¿”å›å€¼ â€‹ ( 5 )å‡½æ•° 5 ï¼šå¤šå‚ï¼Œæ— è¿”å›å€¼ â€‹ ( 6 )å‡½æ•° 6 ï¼šå¤šå‚ï¼Œæœ‰è¿”å›å€¼ def main(args: Array[String]): Unit = { // å‡½æ•° 1 ï¼šæ— å‚ï¼Œæ— è¿”å›å€¼ def test1(): Unit = { println(\"æ— å‚ï¼Œæ— è¿”å›å€¼\") } test1() // å‡½æ•° 2 ï¼šæ— å‚ï¼Œæœ‰è¿”å›å€¼ def test2(): String = { return \"æ— å‚ï¼Œæœ‰è¿”å›å€¼\" } println(test2()) // å‡½æ•° 3 ï¼šæœ‰å‚ï¼Œæ— è¿”å›å€¼ def test3(s: String): Unit = { println(s) } test3(\"jinlian\") // å‡½æ•° 4 ï¼šæœ‰å‚ï¼Œæœ‰è¿”å›å€¼ def test4(s: String): String = { return s + \"æœ‰å‚ï¼Œæœ‰è¿”å›å€¼\" } println(test4(\"hello \")) // å‡½æ•° 5 ï¼šå¤šå‚ï¼Œæ— è¿”å›å€¼ def test5(name: String, age: Int): Unit = { println(s\"$name, $age\") } test5(\"dalang\", 40) } 4ã€å‡½æ•°çš„å‚æ•°â€‹ ( 1 )å¯å˜å‚æ•° â€‹ ( 2 )å¦‚æœå‚æ•°åˆ—è¡¨ä¸­å­˜åœ¨å¤šä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå¯å˜å‚æ•°ä¸€èˆ¬æ”¾ç½®åœ¨æœ€å â€‹ ( 3 )å‚æ•°é»˜è®¤å€¼ï¼Œä¸€èˆ¬å°†æœ‰é»˜è®¤å€¼çš„å‚æ•°æ”¾ç½®åœ¨å‚æ•°åˆ—è¡¨çš„åé¢ â€‹ ( 4 )å¸¦åå‚æ•° def main(args: Array[String]): Unit = { // ( 1 )å¯å˜å‚æ•° def test(s: String*): Unit = { println(s) } // æœ‰è¾“å…¥å‚æ•°ï¼šè¾“å‡º Array test(\"Hello\", \"Scala\") // æ— è¾“å…¥å‚æ•°ï¼šè¾“å‡º List() test() // ( 2 )å¦‚æœå‚æ•°åˆ—è¡¨ä¸­å­˜åœ¨å¤šä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå¯å˜å‚æ•°ä¸€èˆ¬æ”¾ç½®åœ¨æœ€å def test2(name: String, s: String*): Unit = { println(name + \",\" + s) } test2(\"jinlian\", \"dalang\", \"ximenqing\") // (3)å‚æ•°é»˜è®¤å€¼ def test3(name: String, age: Int = 30): Unit = { println(s\"$name, $age\") } // å¦‚æœå‚æ•°ä¼ é€’äº†å€¼ï¼Œé‚£ä¹ˆä¼šè¦†ç›–é»˜è®¤å€¼ test3(\"jinlian\", 20) // å¦‚æœå‚æ•°æœ‰é»˜è®¤å€¼ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå¯ä»¥çœç•¥è¿™ä¸ªå‚æ•° test3(\"dalang\") // ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°†æœ‰é»˜è®¤å€¼çš„å‚æ•°æ”¾ç½®åœ¨å‚æ•°åˆ—è¡¨çš„åé¢ def test4(sex: String = \"ç”·\", name: String): Unit = { println(s\"$name, $sex\") } // Scala å‡½æ•°ä¸­å‚æ•°ä¼ é€’æ˜¯ï¼Œä»å·¦åˆ°å³ test4(\"wusong\") // ( 4 )å¸¦åå‚æ•° test4(name = \"ximenqing\") } 5ã€å‡½æ•°è‡³ç®€åŸåˆ™(é‡ç‚¹)å‡½æ•°è‡³ç®€åŸåˆ™ï¼šèƒ½çœåˆ™çœï¼Œå¤§é“è‡³ç®€ â€‹ ( 1 ) return å¯ä»¥çœç•¥ï¼ŒScala ä¼šä½¿ç”¨å‡½æ•°ä½“çš„æœ€åä¸€è¡Œä»£ç ä½œä¸ºè¿”å›å€¼ â€‹ ( 2 )å¦‚æœå‡½æ•°ä½“åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¯ä»¥çœç•¥èŠ±æ‹¬å· â€‹ ( 3 )è¿”å›å€¼ç±»å‹å¦‚æœèƒ½å¤Ÿæ¨æ–­å‡ºæ¥ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥( :å’Œè¿”å›å€¼ç±»å‹ä¸€èµ·çœç•¥) â€‹ ( 4 )å¦‚æœæœ‰ return ï¼Œåˆ™ä¸èƒ½çœç•¥è¿”å›å€¼ç±»å‹ï¼Œå¿…é¡»æŒ‡å®š â€‹ ( 5 )å¦‚æœå‡½æ•°æ˜ç¡®å£°æ˜ unit ï¼Œé‚£ä¹ˆå³ä½¿å‡½æ•°ä½“ä¸­ä½¿ç”¨ return å…³é”®å­—ä¹Ÿä¸èµ·ä½œç”¨ â€‹ ( 6 ) Scala å¦‚æœæœŸæœ›æ˜¯æ— è¿”å›å€¼ç±»å‹ï¼Œå¯ä»¥çœç•¥ç­‰å· â€‹ ( 7 )å¦‚æœå‡½æ•°æ— å‚ï¼Œä½†æ˜¯å£°æ˜äº†å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆè°ƒç”¨æ—¶ï¼Œå°æ‹¬å·ï¼Œå¯åŠ å¯ä¸åŠ  â€‹ ( 8 )å¦‚æœå‡½æ•°æ²¡æœ‰å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆå°æ‹¬å·å¯ä»¥çœç•¥ï¼Œè°ƒç”¨æ—¶å°æ‹¬å·å¿…é¡»çœç•¥ â€‹ ( 9 )å¦‚æœä¸å…³å¿ƒåç§°ï¼Œåªå…³å¿ƒé€»è¾‘å¤„ç†ï¼Œé‚£ä¹ˆå‡½æ•°å(def)å¯ä»¥çœç•¥ def main(args: Array[String]): Unit = { // ( 0 )å‡½æ•°æ ‡å‡†å†™æ³• def f(s: String): String = { return s + \" jinlian\" } println(f(\"Hello\")) //( 1 ) return å¯ä»¥çœç•¥,Scala ä¼šä½¿ç”¨å‡½æ•°ä½“çš„æœ€åä¸€è¡Œä»£ç ä½œä¸ºè¿”å›å€¼ def f1(s: String): String = { s + \" jinlian\" } println(f1(\"Hello\")) // ( 2 )å¦‚æœå‡½æ•°ä½“åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¯ä»¥çœç•¥èŠ±æ‹¬å· def f2(s: String): String = s + \" jinlian\" // ( 3 )è¿”å›å€¼ç±»å‹å¦‚æœèƒ½å¤Ÿæ¨æ–­å‡ºæ¥ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥( :å’Œè¿”å›å€¼ç±»å‹ä¸€èµ·çœç•¥ def f3(s: String) = s + \" jinlian\" println(f3(\"Hello3\")) // ( 4 )å¦‚æœæœ‰ return ï¼Œåˆ™ä¸èƒ½çœç•¥è¿”å›å€¼ç±»å‹ï¼Œå¿…é¡»æŒ‡å®šã€‚ def f4(): String = { return \"ximenqing4\" } println(f4()) // ( 5 )å¦‚æœå‡½æ•°æ˜ç¡®å£°æ˜ unit ï¼Œé‚£ä¹ˆå³ä½¿å‡½æ•°ä½“ä¸­ä½¿ç”¨ return å…³é”®å­—ä¹Ÿ ä¸èµ·ä½œç”¨ def f5(): Unit = { return \"dalang5\" } println(f5()) // ( 6 ) Scala å¦‚æœæœŸæœ›æ˜¯æ— è¿”å›å€¼ç±»å‹,å¯ä»¥çœç•¥ç­‰å· // å°†æ— è¿”å›å€¼çš„å‡½æ•°ç§°ä¹‹ä¸ºè¿‡ç¨‹ def f6() { \"dalang6\" } println(f6()) // ( 7 )å¦‚æœå‡½æ•°æ— å‚ï¼Œä½†æ˜¯å£°æ˜äº†å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆè°ƒç”¨æ—¶ï¼Œå°æ‹¬å·ï¼Œå¯åŠ å¯ä¸åŠ  def f7() = \"dalang7\" println(f7()) println(f7) // ( 8 )å¦‚æœå‡½æ•°æ²¡æœ‰å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆå°æ‹¬å·å¯ä»¥çœç•¥,è°ƒç”¨æ—¶å°æ‹¬å·å¿…é¡»çœç•¥ def f8 = \"dalang\" //println(f8()) println(f8) // ( 9 )å¦‚æœä¸å…³å¿ƒåç§°ï¼Œåªå…³å¿ƒé€»è¾‘å¤„ç†ï¼Œé‚£ä¹ˆå‡½æ•°å( def )å¯ä»¥çœç•¥ // æœ‰å…¥å‚çœç•¥è¿”å›å€¼ def f9 = (x: String) =&gt; { println(\"wusong\"+x) } // å…¥å‚æ˜¯å‡½æ•° // æ–¹å¼ä¸€ï¼š def f10(f: String =&gt; Unit) = { f(\"11\") } f10(f9) // æ–¹å¼äºŒï¼š println(f10((x: String) =&gt; { println(\"wusong\"+x) })) } 2ã€é«˜çº§å‡½æ•°1ã€é«˜é˜¶ç”¨æ³•1ã€å‡½æ•°å¯ä»¥ä½œä¸ºå€¼è¿›è¡Œä¼ é€’ // å®šä¹‰å‡½æ•° def foo(): Unit = { print(\"foo\") } def foo2(): Int = { print(\"foo\") 1 } def main(args: Array[String]): Unit = { // ( 1 )è°ƒç”¨ foo å‡½æ•°ï¼ŒæŠŠè¿”å›å€¼ç»™å˜é‡ f var result01 = foo // ( 2 )åœ¨è¢«è°ƒç”¨å‡½æ•° foo åé¢åŠ ä¸Š _ ï¼Œç›¸å½“äºæŠŠå‡½æ•° foo å½“æˆä¸€ä¸ªæ•´ä½“ï¼Œ ä¼ é€’ç»™å˜é‡ f1 var result02 = foo _ // ( 3 )å¦‚æœæ˜ç¡®å˜é‡ç±»å‹ï¼Œé‚£ä¹ˆä¸ä½¿ç”¨ä¸‹åˆ’çº¿ä¹Ÿå¯ä»¥å°†å‡½æ•°ä½œä¸ºæ•´ä½“ä¼ é€’ç»™å˜é‡ var result03: () =&gt; Int = foo2 } 2ã€å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ def main(args: Array[String]): Unit = { // å®šä¹‰å‚æ•°å‡½æ•°ï¼ˆå‡½æ•°ç­¾åï¼‰ def add (a:Int,b:Int):Int = a+b // å®šä¹‰è°ƒç”¨å‡½æ•° def fun1(f: (Int, Int) =&gt; Int): Int = { f(2, 3) } // å°† addå‡½æ•°ä½œä¸ºå‚æ•° ä¼ é€’ fun1(add) } 3ã€å‡½æ•°å¯ä»¥ä½œä¸ºå‡½æ•°è¿”å›å€¼è¿”å› def main(args: Array[String]): Unit = { def fun1() = { def fun2() = {} fun2 _ } var f = fun1() // ç®€åŒ–äº† fun1()() fun1() } 2ã€åŒ¿åå‡½æ•°æ²¡æœ‰åå­—çš„å‡½æ•°å°±æ˜¯åŒ¿åå‡½æ•°ã€‚ (x:Int)=&gt;{å‡½æ•°ä½“} x ï¼šè¡¨ç¤ºè¾“å…¥å‚æ•°ç±»å‹ ï¼›Int ï¼šè¡¨ç¤ºè¾“å…¥å‚æ•°ç±»å‹ ï¼›å‡½æ•°ä½“ï¼š è¡¨ç¤ºå…·ä½“ä»£ç é€»è¾‘ éœ€æ±‚ 1 ï¼šä¼ é€’çš„å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•° â€‹ ( 1 )å‚æ•°çš„ç±»å‹å¯ä»¥çœç•¥ï¼Œä¼šæ ¹æ®å½¢å‚è¿›è¡Œè‡ªåŠ¨çš„æ¨å¯¼ â€‹ ( 2 )ç±»å‹çœç•¥ä¹‹å ï¼Œå‘ç°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œåˆ™åœ†æ‹¬å·å¯ä»¥çœç•¥ ï¼›å…¶ä»–æƒ…å†µï¼šæ²¡æœ‰å‚æ•°å’Œå‚ æ•°è¶…è¿‡ 1 çš„æ°¸è¿œä¸èƒ½çœç•¥åœ†æ‹¬å·ã€‚ â€‹ ( 3 )åŒ¿åå‡½æ•°å¦‚æœåªæœ‰ä¸€è¡Œï¼Œ åˆ™å¤§æ‹¬å·ä¹Ÿå¯ä»¥çœç•¥ â€‹ ( 4 )å¦‚æœå‚æ•°åªå‡ºç°ä¸€æ¬¡ï¼Œåˆ™å‚æ•°çœç•¥ä¸”åé¢å‚æ•°å¯ä»¥ç”¨_ä»£æ›¿ def main(args: Array[String]): Unit = { // ( 1 )å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼šå‚æ•°åŒ…å«æ•°æ®å’Œé€»è¾‘å‡½æ•° def operation(arr :Array[Int],op:Int =&gt;Int)={ for (elem &lt;- arr)yield op (elem) } // ( 2 )å®šä¹‰é€»è¾‘å‡½æ•° def op(ele:Int):Int = { ele+1 } // ( 3 )æ ‡å‡†å‡½æ•°è°ƒç”¨ var arr = operation(Array(1,2,3,4),op) print(arr.mkString(\",\")) // ( 4 )é‡‡ç”¨åŒ¿åå‡½æ•° var arr1 = operation(Array(1,2,3,4),(ele:Int)=&gt;{ ele+1 }) print(arr1.mkString(\",\")) // 1ã€å‚æ•°çš„ç±»å‹å¯ä»¥çœç•¥ï¼Œä¼šæ ¹æ®å½¢å‚è¿›è¡Œè‡ªåŠ¨çš„æ¨å¯¼ var array1 = operation(Array(1,2,3),(ele)=&gt;{ ele+1 }) print(array1.mkString(\",\")) // 2ã€ç±»å‹çœç•¥ä¹‹åï¼Œå‘ç°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œåˆ™åœ†æ‹¬å·å¯ä»¥çœç•¥ï¼› // å…¶ä»–æƒ…å†µï¼šæ²¡æœ‰å‚æ•°å’Œå‚æ•°è¶…è¿‡ 1 çš„æ°¸è¿œä¸èƒ½çœç•¥åœ†æ‹¬å· var array2 = operation(Array(1,2,3),ele=&gt;{ ele+1 }) print(array2.mkString(\",\")) // 3ã€åŒ¿åå‡½æ•°å¦‚æœåªæœ‰ä¸€è¡Œï¼Œåˆ™å¤§æ‹¬å·ä¹Ÿå¯ä»¥çœç•¥ var array3 = operation(Array(1,2,3),ele=&gt; ele+1) print(array3.mkString(\",\")) // 4ã€å¦‚æœå‚æ•°åªå‡ºç°ä¸€æ¬¡ï¼Œåˆ™å‚æ•°çœç•¥ä¸”åé¢å‚æ•°å¯ä»¥ç”¨_ä»£æ›¿ var array4 = operation(Array(1,2,3),_+1) print(array4.mkString(\",\")) } éœ€æ±‚ 2 ï¼šä¼ é€’çš„å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•° def main(args: Array[String]): Unit = { // å®šä¹‰å‡½æ•° def calculator(a: Int, b: Int, op: (Int, Int) =&gt; Int): Int = { op(a, b) } // ( 1 )æ ‡å‡†ç‰ˆ println(calculator(2, 3, (x: Int, y: Int) =&gt; { x + y })) // ( 2 )å¦‚æœåªæœ‰ä¸€è¡Œï¼Œåˆ™å¤§æ‹¬å·ä¹Ÿå¯ä»¥çœç•¥ println(calculator(2, 3, (x: Int, y: Int) =&gt; x + y)) // ( 3 )å‚æ•°çš„ç±»å‹å¯ä»¥çœç•¥ï¼Œä¼šæ ¹æ®å½¢å‚è¿›è¡Œè‡ªåŠ¨çš„æ¨å¯¼ println(calculator(2, 3, (x, y) =&gt; x + y)) // ( 4 )å¦‚æœå‚æ•°åªå‡ºç°ä¸€æ¬¡ï¼Œåˆ™å‚æ•°çœç•¥ä¸”åé¢å‚æ•°å¯ä»¥ç”¨_ä»£æ›¿ println(calculator(2, 3, _+_)) } 3ã€é«˜é˜¶å‡½æ•°æ¡ˆä¾‹éœ€æ±‚ ï¼šæ¨¡æ‹Ÿ Map æ˜ å°„ã€Filter è¿‡æ»¤ã€ Reduce èšåˆ def main(args: Array[String]): Unit = { // ( 1 ) map æ˜ å°„ def map(arr: Array[Int], op: Int =&gt; Int) = { for (elem &lt;- arr) yield op(elem) } val arr = map(Array(1, 2, 3), x =&gt; x * x) // println(arr.mkString(\",\")) // ( 2 ) filter è¿‡æ»¤ã€‚æœ‰å‚æ•°ï¼Œä¸”å‚æ•°å†åé¢åªä½¿ç”¨ä¸€æ¬¡ï¼Œåˆ™å‚æ•°çœç•¥ä¸”åé¢å‚æ•°ç”¨_è¡¨ç¤º def filter(arr: Array[Int], op: Int =&gt; Boolean) = { var arr1: ArrayBuffer[Int] = ArrayBuffer[Int]() for (elem &lt;- arr if op(elem)) arr1.append(elem) arr1.toArray } var arr1 = filter(Array(1, 2, 3, 4, 5), _ % 2 == 1) println(arr1.mkString(\",\")) } 4ã€å‡½æ•°æŸ¯é‡ŒåŒ–&amp;é—­åŒ…é—­åŒ… ï¼šå‡½æ•°å¼ç¼–ç¨‹çš„æ ‡é… é—­åŒ… ï¼šå¦‚æœä¸€ä¸ªå‡½æ•°ï¼Œè®¿é—®åˆ°äº†å®ƒçš„å¤–éƒ¨(å±€éƒ¨)å˜é‡çš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å’Œä»–æ‰€å¤„çš„ ç¯å¢ƒï¼Œç§°ä¸ºé—­åŒ… å‡½æ•°æŸ¯é‡ŒåŒ– ï¼šæŠŠä¸€ä¸ªå‚æ•°åˆ—è¡¨çš„å¤šä¸ªå‚æ•°ï¼Œå˜æˆå¤šä¸ªå‚æ•°åˆ—è¡¨ã€‚ def main(args: Array[String]): Unit = { def f1 = { var a: Int = 10 def f2(b: Int) = { a + b } f2 _ } // åœ¨è°ƒç”¨æ—¶ï¼Œf1 å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå±€éƒ¨å˜é‡ a åº”è¯¥éšç€æ ˆç©ºé—´é‡Šæ”¾æ‰ var f = f1 // ä½†æ˜¯åœ¨æ­¤å¤„ï¼Œå˜é‡ a å…¶å®å¹¶æ²¡æœ‰é‡Šæ”¾ï¼Œè€Œæ˜¯åŒ…å«åœ¨äº† f2 å‡½æ•°çš„å†…éƒ¨ï¼Œå½¢ æˆäº†é—­åˆçš„æ•ˆæœ print(f(3)) // println(f1()(3)) // å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œå…¶å®å°±æ˜¯å°†å¤æ‚çš„å‚æ•°é€»è¾‘å˜å¾—ç®€å•åŒ–,å‡½æ•°æŸ¯é‡ŒåŒ–ä¸€å®šå­˜åœ¨é—­åŒ… def f3()(b: Int) = { var a: Int = 10 a + b } println(f3()(3)) } 5ã€é€’å½’ä¸€ä¸ªå‡½æ•°/æ–¹æ³•åœ¨å‡½æ•°/æ–¹æ³•ä½“å†…åˆè°ƒç”¨äº†æœ¬èº«ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºé€’å½’è°ƒç”¨ def main(args: Array[String]): Unit = { // é˜¶ä¹˜ // é€’å½’ç®—æ³• // 1) æ–¹æ³•è°ƒç”¨è‡ªèº« // 2) æ–¹æ³•å¿…é¡»è¦æœ‰è·³å‡ºçš„é€»è¾‘ // 3) æ–¹æ³•è°ƒç”¨è‡ªèº«æ—¶ï¼Œä¼ é€’çš„å‚æ•°åº”è¯¥æœ‰è§„å¾‹ // 4) scala ä¸­çš„é€’å½’å¿…é¡»å£°æ˜å‡½æ•°è¿”å›å€¼ç±»å‹ def test(i: Int): Int = { if (i == 1) 1 else i * test(i - 1) } print(test(5)) } 6ã€æ§åˆ¶æŠ½è±¡Java åªæœ‰å€¼è°ƒç”¨ ï¼›Scala æ—¢æœ‰å€¼è°ƒç”¨ï¼Œåˆæœ‰åè°ƒç”¨ã€‚ 1ã€å€¼è°ƒç”¨ï¼šæŠŠè®¡ç®—åçš„å€¼ä¼ é€’è¿‡å» def main(args: Array[String]): Unit = { def f = () =&gt;{ println(\"f.....\") 10 } foo(f() ) } def foo(a:Int):Unit={ println(a) } 2ã€åè°ƒç”¨ï¼šæŠŠä»£ç ä¼ é€’è¿‡å» def main(args: Array[String]): Unit = { def f = () =&gt; { println(\"fã€‚ã€‚ã€‚\") 10 } def foo(a: =&gt; Int): Unit = { println(a) } foo(f()) // ( 1 )ä¼ é€’ä»£ç å— foo({ 10 }) // ( 2 ) å°æ‹¬å·å¯ä»¥çœç•¥ foo { 10 } } 3ã€è‡ªå®šä¹‰ä¸€ä¸ª while def main(args: Array[String]): Unit = { def myWhile(flag: =&gt;Boolean)(op: =&gt;Unit):Unit={ if (flag){ op myWhile(flag)(op) } } var i:Int = 1 myWhile(i&lt;=10){ print(\" \"+i) i +=1 } } 7ã€æƒ°æ€§åŠ è½½å½“å‡½æ•°è¿”å›å€¼è¢«å£°æ˜ä¸º lazyæ—¶ ï¼Œå‡½æ•°çš„æ‰§è¡Œå°†è¢«æ¨è¿Ÿ ï¼Œç›´åˆ°æˆ‘ä»¬é¦–æ¬¡å¯¹æ­¤å–å€¼ï¼Œè¯¥å‡½ æ•°æ‰ä¼šæ‰§è¡Œã€‚è¿™ç§å‡½æ•°æˆ‘ä»¬ç§°ä¹‹ä¸ºæƒ°æ€§å‡½æ•°ã€‚ def main(args: Array[String]): Unit = { def sum(n1:Int,n2:Int):Int = { print(\"sum è¢«æ‰§è¡Œ\") n1+n2 } // lazy ä¸èƒ½ä¿®é¥° var ç±»å‹çš„å˜é‡ lazy val res = sum(1,2) //println(res) } æ³¨æ„ ï¼šlazy ä¸èƒ½ä¿®é¥° var ç±»å‹çš„å˜é‡ 3ã€ScalaåŒ…äº”ã€ç±»å’Œå¯¹è±¡Scala çš„é¢å‘å¯¹è±¡æ€æƒ³å’Œ Java çš„é¢å‘å¯¹è±¡æ€æƒ³å’Œæ¦‚å¿µæ˜¯ä¸€è‡´çš„ã€‚ Scala ä¸­è¯­æ³•å’Œ Java ä¸åŒ ï¼Œè¡¥å……äº†æ›´å¤šçš„åŠŸèƒ½ã€‚ 1ã€ScalaåŒ… Scala åŒ…çš„ä¸‰å¤§ä½œç”¨(å’Œ Java ä¸€æ ·) â€‹ ( 1 )åŒºåˆ†ç›¸åŒåå­—çš„ç±» â€‹ ( 2 )å½“ç±»å¾ˆå¤šæ—¶ï¼Œå¯ä»¥å¾ˆå¥½çš„ç®¡ç†ç±» â€‹ ( 3 )æ§åˆ¶è®¿é—®èŒƒå›´ 1ã€åŒ…å‘½åè§„åˆ™ï¼š åªèƒ½åŒ…å«æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ã€å°åœ†ç‚¹. ï¼Œä½†ä¸èƒ½ç”¨æ•°å­—å¼€å¤´ï¼Œä¹Ÿä¸è¦ä½¿ç”¨å…³é”®å­—ã€‚ è§„èŒƒï¼š com.å…¬å¸å.é¡¹ç›®å.ä¸šåŠ¡æ¨¡å—å 2ã€åŒ…ç®¡ç†é£æ ¼Scala æœ‰ä¸¤ç§åŒ…çš„ç®¡ç†é£æ ¼ ä¸€ç§æ–¹å¼å’Œ Java çš„åŒ…ç®¡ç†é£æ ¼ç›¸åŒï¼Œæ¯ä¸ªæºæ–‡ä»¶ä¸€ä¸ªåŒ…(åŒ… åå’Œæºæ–‡ä»¶æ‰€åœ¨è·¯å¾„ä¸è¦æ±‚å¿…é¡»ä¸€è‡´ ) é€šè¿‡åµŒå¥—çš„é£æ ¼è¡¨ç¤ºå±‚çº§å…³ç³» package com { package kk { package scala { } } } ç¬¬äºŒç§é£æ ¼æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š â€‹ ( 1 )ä¸€ä¸ªæºæ–‡ä»¶ä¸­å¯ä»¥å£°æ˜å¤šä¸ª package â€‹ ( 2 )å­åŒ…ä¸­çš„ç±»å¯ä»¥ç›´æ¥è®¿é—®çˆ¶åŒ…ä¸­çš„å†…å®¹ï¼Œè€Œæ— éœ€å¯¼åŒ… package com { import com.kk.Inner //çˆ¶åŒ…è®¿é—®å­åŒ…éœ€è¦å¯¼åŒ… object Outer { val out: String = \"out\" def main(args: Array[String]): Unit = { println(Inner.in) } } package kk { object Inner { val in: String = \"in\" def main(args: Array[String]): Unit = { println(Outer.out) //å­åŒ…è®¿é—®çˆ¶åŒ…æ— éœ€å¯¼åŒ… } } } } package other { } 3ã€åŒ…å¯¹è±¡åœ¨ Scala ä¸­å¯ä»¥ä¸ºæ¯ä¸ªåŒ…å®šä¹‰ä¸€ä¸ªåŒåçš„åŒ…å¯¹è±¡ ï¼Œå®šä¹‰åœ¨åŒ…å¯¹è±¡ä¸­çš„æˆå‘˜ ï¼Œä½œä¸ºå…¶å¯¹åº”åŒ…ä¸‹æ‰€æœ‰ class å’Œ object çš„å…±äº«å˜é‡ ï¼Œå¯ä»¥è¢«ç›´æ¥è®¿é—® package object com { val name = \"mykk\" def testMenthod()={} } åµŒå¥—åŒ…ç®¡ç† package com { object Outer { val out: String = \"out\" def main(args: Array[String]): Unit = { println(name) } } } package object com { val name = \"mykk\" } 4ã€å¯¼åŒ…è¯´æ˜1 ) å’Œ Java ä¸€æ · ï¼Œå¯ä»¥åœ¨é¡¶éƒ¨ä½¿ç”¨ import å¯¼å…¥ ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­çš„æ‰€æœ‰ç±»éƒ½å¯ä»¥ä½¿ç”¨ã€‚ 2 ) å±€éƒ¨å¯¼å…¥ï¼šä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Œä»€ä¹ˆæ—¶å€™å¯¼å…¥ã€‚ åœ¨å…¶ä½œç”¨èŒƒå›´å†…éƒ½å¯ä»¥ä½¿ç”¨ 3 ) é€šé…ç¬¦å¯¼å…¥ï¼šimport java.util._ 4 ) ç»™ç±»èµ·åï¼š import java.util. {ArrayList=&gt;JL} 5 ) å¯¼å…¥ç›¸åŒåŒ…çš„å¤šä¸ªç±»ï¼šimport java.util. {HashSet, ArrayList} 6 )å±è”½ç±»ï¼š import java.util. {ArrayList =&gt;,} 7 ) å¯¼å…¥åŒ…çš„ç»å¯¹è·¯å¾„ï¼š new _root_.java.util.HashMap package java { package util { class HashMap { } } } import com.kk.Fruit å¼•å…¥ com.kk åŒ…ä¸‹ Fruit (class å’Œ object) import com.kk._ å¼•å…¥ com.kk ä¸‹çš„æ‰€æœ‰æˆå‘˜ import com.kk.Fruit._ å¼•å…¥ Fruit(object)çš„æ‰€æœ‰æˆå‘˜ import com.kk. {Fruit,Vegetable} å¼•å…¥ com.kk ä¸‹çš„ Fruit å’Œ Vegetable import com.kk. {Fruit=&gt;Shuiguo} å¼•å…¥ com.kk åŒ…ä¸‹çš„ Fruit å¹¶æ›´åä¸º Shuiguo import com.kk. {Fruit=&gt;Shuiguo,_} å¼•å…¥ com.kk åŒ…ä¸‹çš„æ‰€æœ‰æˆå‘˜ï¼Œå¹¶å°† Fruit æ›´åä¸º Shuiguo import com.kk. {Fruit=&gt;,} å¼•å…¥ com.kkåŒ…ä¸‹å±è”½ Fruit ç±» new _root_.java.util.HashMap å¼•å…¥çš„ Java çš„ç»å¯¹è·¯å¾„ Scala ä¸­çš„ä¸‰ä¸ªé»˜è®¤å¯¼å…¥åˆ†åˆ«æ˜¯ import java.lang._ import scala._ import scala.Predef. 2ã€ç±»å’Œå¯¹è±¡ç±» ï¼šå¯ä»¥çœ‹æˆä¸€ä¸ªæ¨¡æ¿ å¯¹è±¡ ï¼šè¡¨ç¤ºå…·ä½“çš„äº‹ç‰© 1ã€å®šä¹‰ç±»ä¸€èˆ¬ ï¼Œä¸€ä¸ª.java æœ‰ä¸€ä¸ª public ç±» Scala ä¸­æ²¡æœ‰public ï¼Œä¸€ä¸ª.scala ä¸­å¯ä»¥å†™å¤šä¸ªç±» // ( 1 ) Scala è¯­æ³•ä¸­ï¼Œç±»å¹¶ä¸å£°æ˜ä¸º public ï¼Œæ‰€æœ‰è¿™äº›ç±»éƒ½å…·æœ‰å…¬æœ‰å¯è§æ€§(å³é»˜ è®¤å°±æ˜¯ public ) class Person { } // ( 2 )ä¸€ä¸ª Scala æºæ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªç±» class Teacher { } 2ã€å±æ€§[**ä¿®é¥°ç¬¦]**var|val å±æ€§åç§° [ ï¼šç±»å‹]= å±æ€§å€¼ æ³¨ ï¼šBean å±æ€§(@BeanPropetry)ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆè§„èŒƒçš„ setXxx/getXxx æ–¹æ³• package com.kk1.demo6 import scala.beans.BeanProperty class Person { var name: String = \"bobo\" //å®šä¹‰å±æ€§ var age: Int = _ // _è¡¨ç¤ºç»™å±æ€§ä¸€ä¸ªé»˜è®¤å€¼ //Bean å±æ€§( @BeanProperty) @BeanProperty var sex: String = \"ç”·\" def main(args: Array[String]): Unit = { var person = new Person() println(person.name) person.setSex(\"å¥³\") println(person.getSex) } } 3ã€æ–¹æ³• class Person { def sum(n1: Int, n2: Int): Int = { n1 + n2 } def main(args: Array[String]): Unit = { def main(args: Array[String]): Unit = { val person = new Person() println(person.sum(10, 20)) } } } 4ã€åˆ›å»ºå¯¹è±¡val | var å¯¹è±¡å [ ï¼šç±»å‹] = new ç±»å‹() â€‹ ( 1 ) val ä¿®é¥°å¯¹è±¡ï¼Œä¸èƒ½æ”¹å˜å¯¹è±¡çš„å¼•ç”¨( å³ï¼šå†…å­˜åœ°å€) ï¼Œå¯ä»¥æ”¹å˜å¯¹è±¡å±æ€§çš„å€¼ã€‚ â€‹ ( 2 ) var ä¿®é¥°å¯¹è±¡ï¼Œ å¯ä»¥ä¿®æ”¹å¯¹è±¡çš„å¼•ç”¨å’Œä¿®æ”¹å¯¹è±¡çš„å±æ€§å€¼ â€‹ ( 3 ) è‡ªåŠ¨æ¨å¯¼å˜é‡ç±»å‹ä¸èƒ½å¤šæ€ï¼Œæ‰€ä»¥å¤šæ€éœ€è¦æ˜¾ç¤ºå£°æ˜ 5ã€æ„é€ å™¨å’Œ Java ä¸€æ ·ï¼ŒScala æ„é€ å¯¹è±¡ä¹Ÿéœ€è¦è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥æœ‰ä»»æ„å¤šä¸ªæ„é€ æ–¹æ³•ã€‚ Scala ç±»çš„æ„é€ å™¨åŒ…æ‹¬ï¼šä¸»æ„é€ å™¨å’Œè¾…åŠ©æ„é€ å™¨ è¯­æ³•ï¼š class ç±»å(å½¢å‚åˆ—è¡¨) { // ä¸»æ„é€ å™¨ // ç±»ä½“ def this(å½¢å‚åˆ—è¡¨) { // è¾…åŠ©æ„é€ å™¨ } def this(å½¢å‚åˆ—è¡¨) { //è¾…åŠ©æ„é€ å™¨å¯ä»¥æœ‰å¤šä¸ª... } } è¯´æ˜ï¼š â€‹ ( 1 )è¾…åŠ©æ„é€ å™¨ ï¼Œå‡½æ•°çš„åç§° this ï¼Œå¯ä»¥æœ‰å¤šä¸ª ï¼Œç¼–è¯‘å™¨é€šè¿‡å‚æ•°çš„ä¸ªæ•°åŠç±»å‹æ¥åŒºåˆ† â€‹ ( 2 )è¾…åŠ©æ„é€ æ–¹æ³•ä¸èƒ½ç›´æ¥æ„å»ºå¯¹è±¡ ï¼Œå¿…é¡»ç›´æ¥æˆ–è€…é—´æ¥è°ƒç”¨ä¸»æ„é€ æ–¹æ³• â€‹ ( 3 )æ„é€ å™¨è°ƒç”¨å…¶ä»–å¦å¤–çš„æ„é€ å™¨ï¼Œ è¦æ±‚è¢«è°ƒç”¨æ„é€ å™¨å¿…é¡»æå‰å£°æ˜ package com.kk1.demo6 class Person { var name: String = _ var age: Int = _ def this(age: Int) { this() this.age = age println(\"è¾…åŠ©æ„é€ å™¨\") } def this(age: Int, name: String) { this(age) this.name = name } println(\"ä¸»æ„é€ å™¨\") } object Person { def main(args: Array[String]): Unit = { val person2 = new Person(18) } } 6ã€æ„é€ å™¨å‚æ•°Scala ç±»çš„ä¸»æ„é€ å™¨å‡½æ•°çš„å½¢å‚åŒ…æ‹¬ä¸‰ç§ç±»å‹ï¼šæœªç”¨ä»»ä½•ä¿®é¥°ã€ var ä¿®é¥°ã€ val ä¿®é¥° â€‹ ( 1 )æœªç”¨ä»»ä½•ä¿®é¥°ç¬¦ä¿®é¥°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ â€‹ ( 2 ) var ä¿®é¥°å‚æ•°ï¼Œä½œä¸ºç±»çš„æˆå‘˜å±æ€§ä½¿ç”¨ï¼Œå¯ä»¥ä¿®æ”¹ â€‹ ( 3 ) val ä¿®é¥°å‚æ•°ï¼Œä½œä¸ºç±»åªè¯»å±æ€§ä½¿ç”¨ï¼Œä¸èƒ½ä¿®æ”¹ def main(args: Array[String]): Unit = { var person = new Person( 18, \"ç”·\") // ( 1 )æœªç”¨ä»»ä½•ä¿®é¥°ç¬¦ä¿®é¥°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ printf(person.name) // ( 2 ) var ä¿®é¥°å‚æ•°ï¼Œä½œä¸ºç±»çš„æˆå‘˜å±æ€§ä½¿ç”¨ï¼Œå¯ä»¥ä¿®æ”¹ person.age = 19 println(person.age) // ( 3 ) val ä¿®é¥°å‚æ•°ï¼Œä½œä¸ºç±»çš„åªè¯»å±æ€§ä½¿ç”¨ï¼Œä¸èƒ½ä¿®æ”¹ person.sex = \"å¥³\" println(person.sex) } 3ã€ä¸‰ç‰¹æ€§java ä¸‰ç‰¹æ€§å’Œscalaä¸‰ç‰¹æ€§æ˜¯ä¸€æ ·çš„ï¼Œåˆ†åˆ«æ˜¯ï¼šå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ 1ã€å°è£…å°è£…å°±æ˜¯æŠŠæŠ½è±¡å‡ºçš„æ•°æ®å’Œå¯¹æ•°æ®çš„æ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œæ•°æ®è¢«ä¿æŠ¤åœ¨å†…éƒ¨ï¼Œç¨‹åºçš„å…¶å®ƒ éƒ¨åˆ†åªæœ‰é€šè¿‡è¢«æˆæƒçš„æ“ä½œ(æˆå‘˜æ–¹æ³•)ï¼Œæ‰èƒ½å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚ Java å°è£…æ“ä½œå¦‚ä¸‹ï¼Œ â€‹ ( 1 )å°†å±æ€§è¿›è¡Œç§æœ‰åŒ– â€‹ ( 2 )æä¾›ä¸€ä¸ªå…¬å…±çš„ set æ–¹æ³•ï¼Œç”¨äºå¯¹å±æ€§èµ‹å€¼ â€‹ ( 3 )æä¾›ä¸€ä¸ªå…¬å…±çš„ get æ–¹æ³•ï¼Œç”¨äºè·å–å±æ€§çš„å€¼ Scala ä¸­çš„ public å±æ€§ï¼Œåº•å±‚å®é™…ä¸º private ï¼Œå¹¶é€šè¿‡ get æ–¹æ³•(obj.field())å’Œ set æ–¹æ³• (obj.field_=(value))å¯¹å…¶è¿›è¡Œæ“ä½œã€‚æ‰€ä»¥ Scala å¹¶ä¸æ¨èå°†å±æ€§è®¾ä¸º private ï¼Œå†ä¸ºå…¶è®¾ç½® public çš„ get å’Œ set æ–¹æ³•çš„åšæ³•ã€‚ä½†ç”±äºå¾ˆå¤š Java æ¡†æ¶éƒ½åˆ©ç”¨åå°„è°ƒç”¨ getXXX å’Œ setXXX æ–¹ æ³•ï¼Œæœ‰æ—¶å€™ä¸ºäº†å’Œè¿™äº›æ¡†æ¶å…¼å®¹ï¼Œä¹Ÿä¼šä¸º Scala çš„å±æ€§è®¾ç½® getXXX å’Œ setXXX æ–¹æ³•(é€šè¿‡ @BeanProperty æ³¨è§£å®ç°)ã€‚ è®¿é—®æƒé™ï¼š åœ¨ Java ä¸­ï¼Œè®¿é—®æƒé™åˆ†ä¸ºï¼špublicï¼Œprivateï¼Œprotected å’Œé»˜è®¤ã€‚åœ¨ Scala ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ç±»ä¼¼çš„ä¿®é¥°ç¬¦è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚ä½†æ˜¯ä½¿ç”¨ä¸Šæœ‰åŒºåˆ«ã€‚ ï¼ˆ1ï¼‰Scala ä¸­å±æ€§å’Œæ–¹æ³•çš„é»˜è®¤è®¿é—®æƒé™ä¸º publicï¼Œä½† Scala ä¸­æ—  public å…³é”®å­—ã€‚ ï¼ˆ2ï¼‰private ä¸ºç§æœ‰æƒé™ï¼Œåªåœ¨ç±»çš„å†…éƒ¨å’Œä¼´ç”Ÿå¯¹è±¡ä¸­å¯ç”¨ã€‚ ï¼ˆ3ï¼‰protected ä¸ºå—ä¿æŠ¤æƒé™ï¼ŒScala ä¸­å—ä¿æŠ¤æƒé™æ¯” Java ä¸­æ›´ä¸¥æ ¼ï¼ŒåŒç±»ã€å­ç±»å¯ä»¥è®¿é—®ï¼ŒåŒåŒ…æ— æ³•è®¿é—® ï¼ˆ4ï¼‰private[åŒ…å]å¢åŠ åŒ…è®¿é—®æƒé™ï¼ŒåŒ…åä¸‹çš„å…¶ä»–ç±»ä¹Ÿå¯ä»¥ä½¿ç”¨ package com.kk1.demo6 class Person { private var name: String = \"bobo\" protected var age: Int = 18 private[demo6] var sex: String = \"ç”·\" def say(): Unit = { println(name) } } object Person { def main(args: Array[String]): Unit = { val person = new Person person.say() println(person.name) println(person.age) } } class Teacher extends Person { def test(): Unit = { this.age this.sex } } class Animal { def test: Unit = { new Person().sex } } 2ã€ç»§æ‰¿å’Œå¤šæ€ç»§æ‰¿ï¼š class å­ç±»å extends çˆ¶ç±»å { ç±»ä½“ } å­ç±»ç»§æ‰¿çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³• scala æ˜¯å•ç»§æ‰¿ ç»§æ‰¿çš„è°ƒç”¨é¡ºåºï¼šçˆ¶ç±»æ„é€ å™¨-&gt;å­ç±»æ„é€ å™¨ åŠ¨æ€ç»‘å®šï¼šScala ä¸­å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯åŠ¨æ€ç»‘å®šï¼Œè€Œ Java ä¸­åªæœ‰æ–¹æ³•ä¸ºåŠ¨æ€ç»‘å®š é‡å†™ï¼šjava å’Œ scalaåŒºåˆ« class Person { val name: String = \"person\" def hello(): Unit = { println(\"hello person\") } } class Teacher extends Person { override val name: String = \"teacher\" override def hello(): Unit = { println(\"hello teacher\") } } object Test { def main(args: Array[String]): Unit = { val teacher: Teacher = new Teacher() println(teacher.name) teacher.hello() val teacher1: Person = new Teacher println(teacher1.name) teacher1.hello() } } scala æ‰“å° teacher hello teacher teacher hello teacher java æ‰“å° teacher hello teacher person hello teacher 4ã€æŠ½è±¡ç±»1ã€å±æ€§å’Œæ–¹æ³•1ã€åŸºæœ¬è¯­æ³• ( 1 )å®šä¹‰æŠ½è±¡ç±»ï¼š abstract class Person{} //é€šè¿‡ abstract å…³é”®å­—æ ‡è®°æŠ½è±¡ç±» â€‹ ( 2 )å®šä¹‰æŠ½è±¡å±æ€§ï¼šval|var name:String //ä¸€ä¸ªå±æ€§æ²¡æœ‰åˆå§‹åŒ–ï¼Œå°±æ˜¯æŠ½è±¡å±æ€§ â€‹ ( 3 )å®šä¹‰æŠ½è±¡æ–¹æ³•ï¼šdef hello():String //åªå£°æ˜è€Œæ²¡æœ‰å®ç°çš„æ–¹æ³•ï¼Œå°±æ˜¯æŠ½è±¡æ–¹æ³• 2ã€ç»§æ‰¿ &amp; é‡å†™ â€‹ ( 1 ) å¦‚æœçˆ¶ç±»ä¸ºæŠ½è±¡ç±»ï¼Œé‚£ä¹ˆå­ç±»éœ€è¦å°†æŠ½è±¡çš„å±æ€§å’Œæ–¹æ³•å®ç°ï¼Œå¦åˆ™å­ç±»ä¹Ÿéœ€å£°æ˜ ä¸ºæŠ½è±¡ç±» â€‹ ( 2 ) é‡å†™éæŠ½è±¡æ–¹æ³•éœ€è¦ç”¨ override ä¿®é¥°ï¼Œé‡å†™æŠ½è±¡æ–¹æ³•åˆ™å¯ä»¥ä¸åŠ  overrideã€‚ â€‹ ( 3 ) å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ä½¿ç”¨ super å…³é”®å­— â€‹ ( 4 ) å­ç±»å¯¹æŠ½è±¡å±æ€§è¿›è¡Œå®ç°ï¼Œçˆ¶ç±»æŠ½è±¡å±æ€§å¯ä»¥ç”¨ var ä¿®é¥°ï¼› ï¼ˆ 5 ï¼‰å­ç±»å¯¹éæŠ½è±¡å±æ€§é‡å†™ ï¼Œçˆ¶ç±»éæŠ½è±¡å±æ€§åªæ”¯æŒ val ç±»å‹ï¼Œè€Œä¸æ”¯æŒ var 2ã€åŒ¿åå­ç±»å’Œ Java ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡åŒ…å«å¸¦æœ‰å®šä¹‰æˆ–é‡å†™çš„ä»£ç å—çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªåŒ¿åçš„å­ç±» abstract class Person { val name: String def hello(): Unit } object Test { def main(args: Array[String]): Unit = { val person = new Person { override val name: String = \"teacher\" override def hello(): Unit = println(\"hello teacher\") } } 5ã€å•ä¾‹å¯¹è±¡ï¼ˆä¼´ç”Ÿå¯¹è±¡ï¼‰Scalaè¯­è¨€æ˜¯å®Œå…¨é¢å‘å¯¹è±¡çš„è¯­è¨€ ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰é™æ€çš„æ“ä½œ ( å³åœ¨Scalaä¸­æ²¡æœ‰é™æ€çš„æ¦‚å¿µ) ã€‚ä½†æ˜¯ä¸ºäº†èƒ½å¤Ÿå’ŒJavaè¯­è¨€äº¤äº’(å› ä¸ºJavaä¸­æœ‰é™æ€æ¦‚å¿µ)ï¼Œå°±äº§ç”Ÿäº†ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡æ¥æ¨¡æ‹Ÿç±»å¯¹è±¡ ï¼Œè¯¥å¯¹è±¡ä¸ºå•ä¾‹å¯¹è±¡ã€‚è‹¥å•ä¾‹å¯¹è±¡åä¸ç±»åä¸€è‡´ï¼Œåˆ™ç§°è¯¥å•ä¾‹å¯¹è±¡è¿™ä¸ªç±»çš„ä¼´ç”Ÿå¯¹è±¡ ï¼Œè¿™ä¸ªç±»çš„æ‰€æœ‰â€œé™æ€â€å†…å®¹éƒ½å¯ä»¥æ”¾ç½®åœ¨å®ƒçš„ä¼´ç”Ÿå¯¹è±¡ä¸­å£°æ˜ 1ã€å•ä¾‹å¯¹è±¡è¯­æ³•object TestScala { val context:String=\"obj\" } â€‹ ( 1 )å•ä¾‹å¯¹è±¡é‡‡ç”¨ object å…³é”®å­—å£°æ˜ â€‹ ( 2 )å•ä¾‹å¯¹è±¡å¯¹åº”çš„ç±»ç§°ä¹‹ä¸ºä¼´ç”Ÿç±» ï¼Œä¼´ç”Ÿå¯¹è±¡çš„åç§°åº”è¯¥å’Œä¼´ç”Ÿç±»åä¸€è‡´ã€‚ â€‹ ( 3 )å•ä¾‹å¯¹è±¡ä¸­çš„å±æ€§å’Œæ–¹æ³•éƒ½å¯ä»¥é€šè¿‡ä¼´ç”Ÿå¯¹è±¡å(ç±»å)ç›´æ¥è°ƒç”¨è®¿é—®ã€‚ //ï¼ˆ1ï¼‰ä¼´ç”Ÿå¯¹è±¡é‡‡ç”¨ object å…³é”®å­—å£°æ˜ object Person { var country: String = \"China\" } //ï¼ˆ2ï¼‰ä¼´ç”Ÿå¯¹è±¡å¯¹åº”çš„ç±»ç§°ä¹‹ä¸ºä¼´ç”Ÿç±»ï¼Œä¼´ç”Ÿå¯¹è±¡çš„åç§°åº”è¯¥å’Œä¼´ç”Ÿç±»åä¸€è‡´ã€‚ class Person { var name: String = \"bobo\" } object Test { def main(args: Array[String]): Unit = { //ï¼ˆ3ï¼‰ä¼´ç”Ÿå¯¹è±¡ä¸­çš„å±æ€§å’Œæ–¹æ³•éƒ½å¯ä»¥é€šè¿‡ä¼´ç”Ÿå¯¹è±¡åï¼ˆç±»åï¼‰ç›´æ¥è°ƒç”¨è®¿é—®ã€‚ println(Person.country) } } è¾“å‡ºï¼šChina 2ã€apply æ–¹æ³•â€‹ ( 1 )é€šè¿‡ä¼´ç”Ÿå¯¹è±¡çš„ apply æ–¹æ³•ï¼Œå®ç°ä¸ä½¿ç”¨ new æ–¹æ³•åˆ›å»ºå¯¹è±¡ â€‹ ( 2 )å¦‚æœæƒ³è®©ä¸»æ„é€ å™¨å˜æˆç§æœ‰çš„ï¼Œå¯ä»¥åœ¨()ä¹‹å‰åŠ ä¸Šprivate â€‹ ( 3 ) apply æ–¹æ³•å¯ä»¥é‡è½½ â€‹ ( 4 ) Scala ä¸­ obj(arg)**çš„è¯­å¥å®é™…æ˜¯åœ¨è°ƒç”¨è¯¥å¯¹è±¡çš„ **apply æ–¹æ³•ï¼Œå³ obj.apply(arg)ã€‚ç”¨ä»¥ç»Ÿä¸€é¢å‘å¯¹è±¡ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹çš„é£æ ¼ â€‹ ( 5 )å½“ä½¿ç”¨ new å…³é”®å­—æ„å»ºå¯¹è±¡æ—¶ï¼Œè°ƒç”¨çš„å…¶å®æ˜¯ç±»çš„æ„é€ æ–¹æ³•ï¼Œå½“ç›´æ¥ä½¿ç”¨ç±»åæ„ å»ºå¯¹è±¡æ—¶ï¼Œè°ƒç”¨çš„å…¶å®æ—¶ä¼´ç”Ÿå¯¹è±¡çš„ apply æ–¹æ³• package com.kk1.demo7 //ï¼ˆ2ï¼‰å¦‚æœæƒ³è®©ä¸»æ„é€ å™¨å˜æˆç§æœ‰çš„ï¼Œå¯ä»¥åœ¨()ä¹‹å‰åŠ ä¸Š private class Person private(cName: String) { var name: String = cName+\"_qq\" } object Person { def apply(): Person = { println(\"apply ç©ºå‚è¢«è°ƒç”¨\") new Person(\"xx\") } def apply(name: String): Person = { println(\"apply æœ‰å‚è¢«è°ƒç”¨\") new Person(name) } } object Test { def main(args: Array[String]): Unit = { //ï¼ˆ1ï¼‰é€šè¿‡ä¼´ç”Ÿå¯¹è±¡çš„ apply æ–¹æ³•ï¼Œå®ç°ä¸ä½¿ç”¨ new å…³é”®å­—åˆ›å»ºå¯¹è±¡ã€‚ val p1 = Person() println(\"p1.name=\" + p1.name) val p2 = Person(\"bobo\") println(\"p2.name=\" + p2.name) } } è¾“å‡ºï¼š-------------------------- apply ç©ºå‚è¢«è°ƒç”¨ p1.name=xx_qq apply æœ‰å‚è¢«è°ƒç”¨ p2.name=bobo_qq 6ã€ç‰¹è´¨ï¼ˆTraitï¼‰ Scala è¯­è¨€ä¸­ï¼Œé‡‡ç”¨ç‰¹è´¨ trait (ç‰¹å¾)æ¥ä»£æ›¿æ¥å£çš„æ¦‚å¿µ ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¤šä¸ªç±»å…·æœ‰ç›¸åŒçš„ç‰¹è´¨(ç‰¹å¾)æ—¶ï¼Œå°±å¯ä»¥å°†è¿™ä¸ªç‰¹è´¨(ç‰¹å¾)ç‹¬ç«‹å‡ºæ¥ï¼Œé‡‡ç”¨å…³é”®å­— trait å£°æ˜ Scala ä¸­çš„ trait ä¸­å³å¯ä»¥æœ‰æŠ½è±¡å±æ€§å’Œæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æœ‰å…·ä½“çš„å±æ€§å’Œæ–¹æ³• ï¼Œä¸€ä¸ªç±»å¯ä»¥æ··å…¥(mixin)å¤šä¸ªç‰¹è´¨ã€‚ç±»ä¼¼äº Java ä¸­çš„æŠ½è±¡ç±» Scala å¼•å…¥ trait ç‰¹å¾ï¼Œç¬¬ä¸€å¯ä»¥æ›¿ä»£ Java çš„æ¥å£ï¼Œç¬¬äºŒä¸ªä¹Ÿæ˜¯å¯¹å•ç»§æ‰¿æœºåˆ¶çš„ä¸€ç§è¡¥å…… 1ã€ç‰¹è´¨å£°æ˜é€šè¿‡æŸ¥çœ‹å­—èŠ‚ç ï¼Œå¯ä»¥çœ‹åˆ°ç‰¹è´¨=æŠ½è±¡ç±»+æ¥å£ 1ã€è¯­æ³• trait ç‰¹è´¨å { trait ä¸»ä½“ } 2ã€æ¡ˆä¾‹ trait PersonTrait { // å£°æ˜å±æ€§ var name: String = _ // å£°æ˜æ–¹æ³• def eat(): Unit = { } // æŠ½è±¡å±æ€§ var age: Int // æŠ½è±¡æ–¹æ³• def say(): Unit } 2ã€ç‰¹è´¨åŸºæœ¬è¯­æ³•ä¸€ä¸ªç±»å…·æœ‰æŸç§ç‰¹è´¨ï¼ˆç‰¹å¾ï¼‰ï¼Œå°±æ„å‘³ç€è¿™ä¸ªç±»æ»¡è¶³äº†è¿™ä¸ªç‰¹è´¨ï¼ˆç‰¹å¾ï¼‰çš„æ‰€æœ‰è¦ç´ ï¼Œ æ‰€ä»¥åœ¨ä½¿ç”¨æ—¶ï¼Œä¹Ÿé‡‡ç”¨äº† extends å…³é”®å­—ï¼Œå¦‚æœæœ‰å¤šä¸ªç‰¹è´¨æˆ–å­˜åœ¨çˆ¶ç±»ï¼Œé‚£ä¹ˆéœ€è¦é‡‡ç”¨ with å…³é”®å­—è¿æ¥ 1ã€è¯­æ³• æ²¡æœ‰çˆ¶ç±»**ï¼šclass ç±»å **extends ç‰¹è´¨ 1 with ç‰¹è´¨ 2 with ç‰¹è´¨ 3 â€¦ æœ‰çˆ¶ç±»**ï¼šclass ç±»å **extends çˆ¶ç±» with ç‰¹è´¨ 1 with ç‰¹è´¨ 2 with ç‰¹è´¨ 3â€¦ 2ã€è¯´æ˜ ï¼ˆ1ï¼‰ç±»å’Œç‰¹è´¨çš„å…³ç³»ï¼šä½¿ç”¨ç»§æ‰¿çš„å…³ç³»ã€‚ ï¼ˆ2ï¼‰å½“ä¸€ä¸ªç±»å»ç»§æ‰¿ç‰¹è´¨æ—¶ï¼Œç¬¬ä¸€ä¸ªè¿æ¥è¯æ˜¯ extendsï¼Œåé¢æ˜¯ withã€‚ ï¼ˆ3ï¼‰å¦‚æœä¸€ä¸ªç±»åœ¨åŒæ—¶ç»§æ‰¿ç‰¹è´¨å’Œçˆ¶ç±»æ—¶ï¼Œåº”å½“æŠŠçˆ¶ç±»å†™åœ¨ extends åã€‚ 3ã€æ¡ˆä¾‹ æ‰€æœ‰çš„ Java æ¥å£éƒ½å¯ä»¥å½“åš Scala ç‰¹è´¨ä½¿ç”¨ åŠ¨æ€æ··å…¥ï¼šå¯çµæ´»çš„æ‰©å±•ç±»çš„åŠŸèƒ½ åŠ¨æ€æ··å…¥ï¼šåˆ›å»ºå¯¹è±¡æ—¶æ··å…¥ traitï¼Œè€Œæ— éœ€ä½¿ç±»æ··å…¥è¯¥ trait å¦‚æœæ··å…¥çš„ trait ä¸­æœ‰æœªå®ç°çš„æ–¹æ³•ï¼Œåˆ™éœ€è¦å®ç° package com.kk1.demo7 trait PersonTrait { // å£°æ˜å±æ€§ var name: String = _ // å£°æ˜æ–¹æ³• def eat(): Unit = { } // æŠ½è±¡å±æ€§ var age: Int // æŠ½è±¡æ–¹æ³• def say(): Unit } trait SexTrait { var sex: String } //ï¼ˆ2ï¼‰ä¸€ä¸ªç±»å¯ä»¥å®ç°/ç»§æ‰¿å¤šä¸ªç‰¹è´¨ //ï¼ˆ3ï¼‰æ‰€æœ‰çš„ Java æ¥å£éƒ½å¯ä»¥å½“åš Scala ç‰¹è´¨ä½¿ç”¨ class Teacher extends PersonTrait with java.io.Serializable { override def say(): Unit = { println(\"say\") } override var age: Int = _ } object TestTrait { def main(args: Array[String]): Unit = { val teacher = new Teacher teacher.say() teacher.eat() //ï¼ˆ4ï¼‰åŠ¨æ€æ··å…¥ï¼šå¯çµæ´»çš„æ‰©å±•ç±»çš„åŠŸèƒ½ val t2 = new Teacher with SexTrait { override var sex: String = \"ç”·\" } //è°ƒç”¨æ··å…¥ trait çš„å±æ€§ println(t2.sex) } } --------------------------- è¾“å‡ºï¼š say ç”· 3ã€ç‰¹è´¨å åŠ ç”±äºä¸€ä¸ªç±»å¯ä»¥æ··å…¥å¤šä¸ª traitï¼Œä¸” trait ä¸­å¯ä»¥æœ‰å…·ä½“çš„å±æ€§å’Œæ–¹æ³•ï¼Œè‹¥æ··å…¥çš„ç‰¹è´¨ä¸­å…·æœ‰ç›¸åŒçš„æ–¹æ³•ï¼ˆæ–¹æ³•åï¼Œå‚æ•°åˆ—è¡¨ï¼Œè¿”å›å€¼å‡ç›¸åŒï¼‰ï¼Œå¿…ç„¶ä¼šå‡ºç°ç»§æ‰¿å†²çªé—®é¢˜ã€‚ å†²çªåˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š ç¬¬ä¸€ç§ï¼Œä¸€ä¸ªç±»ï¼ˆSubï¼‰æ··å…¥çš„ä¸¤ä¸ª traitï¼ˆTraitAï¼ŒTraitBï¼‰ä¸­å…·æœ‰ç›¸åŒçš„å…·ä½“æ–¹æ³•ï¼Œä¸”ä¸¤ä¸ª trait ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè§£å†³è¿™ç±»å†²çªé—®é¢˜ï¼Œç›´æ¥åœ¨ç±»ï¼ˆSubï¼‰ä¸­é‡å†™å†²çªæ–¹æ³• ç¬¬äºŒç§ï¼Œä¸€ä¸ªç±»ï¼ˆSubï¼‰æ··å…¥çš„ä¸¤ä¸ª traitï¼ˆTraitAï¼ŒTraitBï¼‰ä¸­å…·æœ‰ç›¸åŒçš„å…·ä½“æ–¹æ³•ï¼Œä¸”ä¸¤ä¸ª trait ç»§æ‰¿è‡ªç›¸åŒçš„ traitï¼ˆTraitCï¼‰ï¼ŒåŠæ‰€è°“çš„â€œé’»çŸ³é—®é¢˜â€ï¼Œè§£å†³è¿™ç±»å†²çªé—®é¢˜ï¼ŒScala é‡‡ç”¨äº†ç‰¹è´¨å åŠ çš„ç­–ç•¥ æ‰€è°“çš„ç‰¹è´¨å åŠ ï¼Œå°±æ˜¯å°†æ··å…¥çš„å¤šä¸ª trait ä¸­çš„å†²çªæ–¹æ³•å åŠ èµ·æ¥ï¼Œæ¡ˆä¾‹å¦‚ä¸‹ï¼š package com.kk1.demo7 trait Surname { def describe(): String = { \"kang\" } } trait Name1 extends Surname { override def describe(): String = { \"jie-\" + super.describe() } } trait Name2 extends Surname { override def describe(): String = { \"kun-\" + super.describe() } } class MyBall extends Name2 with Name1 { override def describe(): String = { \"my name is \" + super.describe() } } object TestTrait { def main(args: Array[String]): Unit = { println(new MyBall().describe()) } } ------- è¾“å‡ºï¼š my name is jie-kun-kang 4ã€ç‰¹è´¨è‡ªèº«ç±»å‹è‡ªèº«ç±»å‹å¯å®ç°ä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ class User(val name: String, val age: Int) trait Dao { def insert(user: User) = { println(\"insert into database :\" + user.name) } } trait APP { _: Dao =&gt; def login(user: User): Unit = { println(\"login :\" + user.name) insert(user) } } object MyApp extends APP with Dao { def main(args: Array[String]): Unit = { login(new User(\"mykk\", 18)) } } ------------------------------ è¾“å‡ºï¼š login :mykk insert into database :mykk å…ˆæ‰“å°äº†ç»§æ‰¿çš„ï¼Œåœ¨æ‰“å°äº†å®ç°çš„ 5ã€ç‰¹è´¨å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«1.ä¼˜å…ˆä½¿ç”¨ç‰¹è´¨ã€‚ä¸€ä¸ªç±»æ‰©å±•å¤šä¸ªç‰¹è´¨æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†å´åªèƒ½æ‰©å±•ä¸€ä¸ªæŠ½è±¡ç±» 2.å¦‚æœä½ éœ€è¦æ„é€ å‡½æ•°å‚æ•°ï¼Œä½¿ç”¨æŠ½è±¡ç±»ã€‚å› ä¸ºæŠ½è±¡ç±»å¯ä»¥å®šä¹‰å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œè€Œç‰¹è´¨ä¸è¡Œï¼ˆæœ‰æ— å‚æ„é€ ï¼‰ 7ã€æ‰©å±•1ã€ç±»å‹æ£€æŸ¥å’Œè½¬æ¢æœ‰ç‚¹ç±»ä¼¼äºåå°„çš„é‚£å‡ ä¸ªä½œç”¨ ï¼ˆ1ï¼‰obj.isInstanceOf[T]ï¼šåˆ¤æ–­ obj æ˜¯ä¸æ˜¯ T ç±»å‹ ï¼ˆ2ï¼‰obj.asInstanceOf[T]ï¼šå°† obj å¼ºè½¬æˆ T ç±»å‹ ï¼ˆ3ï¼‰classOf è·å–å¯¹è±¡çš„ç±»å class Person { } object Person { def main(args: Array[String]): Unit = { val person = new Person //ï¼ˆ1ï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæŸä¸ªç±»å‹çš„å®ä¾‹ val bool: Boolean = person.isInstanceOf[Person] if (bool) { //ï¼ˆ2ï¼‰å°†å¯¹è±¡è½¬æ¢ä¸ºæŸä¸ªç±»å‹çš„å®ä¾‹ val p1: Person = person.asInstanceOf[Person] println(p1) } //ï¼ˆ3ï¼‰è·å–ç±»çš„ä¿¡æ¯ val pClass: Class[Person] = classOf[Person] println(pClass) } } 2ã€æšä¸¾ç±»å’Œåº”ç”¨ç±»1ã€è¯´æ˜ æšä¸¾ç±»ï¼šéœ€è¦ç»§æ‰¿ Enumeration åº”ç”¨ç±»ï¼šéœ€è¦ç»§æ‰¿ App 2ã€æ¡ˆä¾‹ object Test { def main(args: Array[String]): Unit = { println(Color.RED) } } // æšä¸¾ç±» object Color extends Enumeration { val RED = Value(1, \"red\") val YELLOW = Value(2, \"yellow\") val BLUE = Value(3, \"blue\") } // åº”ç”¨ç±»ï¼šå¯ä»¥ç›´æ¥æ‰“å°ï¼Œåƒmainæ–¹æ³• object Test20 extends App { println(\"xxxxxxxxxxx\"); } 3ã€Type å®šä¹‰æ–°ç±»å‹ä½¿ç”¨ type å…³é”®å­—å¯ä»¥å®šä¹‰æ–°çš„æ•°æ®æ•°æ®ç±»å‹åç§°ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ç±»å‹çš„ä¸€ä¸ªåˆ«å object Test { def main(args: Array[String]): Unit = { type S = String var v: S = \"abc\" def test(): S = \"xyz\" } } å…­ã€é›†åˆ1ã€Scala çš„é›†åˆæœ‰ä¸‰å¤§ç±»ï¼šåºåˆ— Seqã€é›† Setã€æ˜ å°„ Mapï¼Œæ‰€æœ‰çš„é›†åˆéƒ½æ‰©å±•è‡ª Iterable ç‰¹è´¨ã€‚ 2ã€å¯¹äºå‡ ä¹æ‰€æœ‰çš„é›†åˆç±»ï¼ŒScala éƒ½åŒæ—¶æä¾›äº†å¯å˜å’Œä¸å¯å˜çš„ç‰ˆæœ¬ï¼Œåˆ†åˆ«ä½äºä»¥ä¸‹ä¸¤ä¸ªåŒ… ä¸å¯å˜é›†åˆï¼šscala.collection.immutable å¯å˜é›†åˆï¼š scala.collection.mutable 3ã€Scala ä¸å¯å˜é›†åˆï¼Œå°±æ˜¯æŒ‡è¯¥é›†åˆå¯¹è±¡ä¸å¯ä¿®æ”¹ï¼Œæ¯æ¬¡ä¿®æ”¹å°±ä¼šè¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œä¸ä¼šå¯¹åŸå¯¹è±¡è¿›è¡Œä¿®æ”¹ã€‚ç±»ä¼¼äº java ä¸­çš„ String å¯¹è±¡ 4ã€å¯å˜é›†åˆï¼Œå°±æ˜¯è¿™ä¸ªé›†åˆå¯ä»¥ç›´æ¥å¯¹åŸå¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸ä¼šè¿”å›æ–°çš„å¯¹è±¡ã€‚ç±»ä¼¼äº java ä¸­ StringBuilder å¯¹è±¡ 1ï¼‰Setã€Map æ˜¯ Java ä¸­ä¹Ÿæœ‰çš„é›†åˆ 2ï¼‰Seq æ˜¯ Java æ²¡æœ‰çš„ï¼Œæˆ‘ä»¬å‘ç° List å½’å±åˆ° Seq äº†ï¼Œå› æ­¤è¿™é‡Œçš„ List å°±å’Œ Java ä¸æ˜¯åŒä¸€ä¸ª æ¦‚å¿µäº† 3ï¼‰æˆ‘ä»¬å‰é¢çš„ for å¾ªç¯æœ‰ä¸€ä¸ª 1 to 3ï¼Œå°±æ˜¯ IndexedSeq ä¸‹çš„ Range 4ï¼‰String ä¹Ÿæ˜¯å±äº IndexedSeq 5ï¼‰æˆ‘ä»¬å‘ç°ç»å…¸çš„æ•°æ®ç»“æ„æ¯”å¦‚ Queue å’Œ Stack è¢«å½’å±åˆ° LinearSeq(çº¿æ€§åºåˆ—) 6ï¼‰Scala ä¸­çš„ Map ä½“ç³»æœ‰ä¸€ä¸ª SortedMapï¼Œè¯´æ˜ Scala çš„ Map å¯ä»¥æ”¯æŒæ’åº IndexedSeq å’Œ LinearSeq çš„åŒºåˆ«ï¼š IndexedSeq æ˜¯é€šè¿‡ç´¢å¼•æ¥æŸ¥æ‰¾å’Œå®šä½ï¼Œå› æ­¤é€Ÿåº¦å¿«ï¼Œæ¯”å¦‚ String å°±æ˜¯ä¸€ä¸ªç´¢å¼•é›†åˆï¼Œé€šè¿‡ç´¢å¼•å³å¯å®šä½ LinearSeq æ˜¯çº¿å‹çš„ï¼Œå³æœ‰å¤´å°¾çš„æ¦‚å¿µï¼Œè¿™ç§æ•°æ®ç»“æ„ä¸€èˆ¬æ˜¯é€šè¿‡éå†æ¥æŸ¥æ‰¾ 1ã€æ•°ç»„1ã€ä¸å¯å˜æ•°ç»„1ã€æ–¹å¼ä¸€ï¼šval arr1 = new Array[Int](10) package com.kk1.demo7 object Test01 extends App { // 1ã€å®šä¹‰æ•°ç»„ val arr1 = new Array[Int](10) println(arr1.length) // 2ã€èµ‹å€¼ arr1(1) = 2 arr1.update(2, 3) // 3ã€éå† 1 println(arr1.mkString(\",\")) // éå† 2 for (i &lt;- arr1) print(i + \",\") println() // éå† 3 //arr1.foreach(print) arr1.foreach(x =&gt; print(x + \",\")) // 4ã€å¢åŠ å…ƒç´ (ç”±äºåˆ›å»ºçš„æ˜¯ä¸å¯å˜æ•°ç»„ï¼Œå¢åŠ å…ƒç´ ï¼Œå…¶å®æ˜¯äº§ç”Ÿæ–°çš„æ•°ç»„ print(arr1) var arr2: Array[Int] = arr1 :+ 5 print(arr2) } 2ã€æ–¹å¼äºŒï¼š val arr1 = Array(1, 2,\"mykk\") arr1.foreach(print) 2ã€å¯å˜æ•°ç»„ï¼ˆ1ï¼‰[Any]å­˜æ”¾ä»»æ„æ•°æ®ç±»å‹ ï¼ˆ2ï¼‰ArrayBuffer æ˜¯æœ‰åºçš„é›†åˆ ï¼ˆ3ï¼‰ArrayBuffer éœ€è¦å¼•å…¥ scala.collection.mutable.ArrayBuffer ï¼ˆ4ï¼‰å¢åŠ å…ƒç´ ä½¿ç”¨çš„æ˜¯ append æ–¹æ³•()ï¼Œæ”¯æŒå¯å˜å‚æ•° package com.kk1.demo7 import scala.collection.mutable.ArrayBuffer object Test02 extends App { // 1ã€å®šä¹‰ val arr1 = ArrayBuffer[Any](1, 2, 3) // 2ã€éå† for (i &lt;- arr1) print(\" \" + i) println() println(\"arr1.hash=\" + arr1.hashCode()) // 3ã€å¢åŠ å…ƒç´  arr1.+=(4) // è¿½åŠ æ•°æ® arr1.append(5, 6) // å‘æ•°ç»„æœ€åè¿½åŠ æ•°æ® arr1.insert(0, 7, 8) // å‘æŒ‡å®šçš„ä½ç½®æ’å…¥æ•°æ® println(\"arr1.hash=\" + arr1.hashCode()) for (i &lt;- arr1) print(\" \" + i) println() // 4ã€ä¿®æ”¹å…ƒç´  arr1(1) = 9 //ä¿®æ”¹ç¬¬ 2 ä¸ªå…ƒç´ çš„å€¼ } -------------------------- è¾“å‡ºï¼š 1 2 3 arr1.hash=387518613 arr1.hash=-253706129 7 8 1 2 3 4 5 6 3ã€ä¸å¯å˜ &amp; å¯å˜è½¬æ¢arr1.toBuffer //ä¸å¯å˜æ•°ç»„è½¬å¯å˜æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªï¼Œæœ¬èº«ä¸å˜ arr2.toArray //å¯å˜æ•°ç»„è½¬ä¸å¯å˜æ•°ç»„ ï¼Œè¿”å›ä¸€ä¸ªï¼Œæœ¬èº«ä¸å˜ 4ã€å¤šç»´æ•°ç»„1ã€å®šä¹‰ val arr = Array.ofDim[Double](3,4) 2ã€æ¡ˆä¾‹ äºŒç»´æ•°ç»„ä¸­æœ‰ä¸‰ä¸ªä¸€ç»´æ•°ç»„ï¼Œæ¯ä¸ªä¸€ç»´æ•°ç»„ä¸­æœ‰å››ä¸ªå…ƒç´  object DimArray extends App { //ï¼ˆ1ï¼‰åˆ›å»ºäº†ä¸€ä¸ªäºŒç»´æ•°ç»„, æœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ï¼Œå«æœ‰ 4 ä¸ªå…ƒç´ ä¸€ç»´æ•°ç»„() var arr = Array.ofDim[Int](3, 4) //ï¼ˆ2ï¼‰éå†äºŒç»´æ•°ç»„ for (i &lt;- arr) { for (j &lt;- i) { print(j + \" \") } println() } } 2ã€Listé›†åˆ1ã€ä¸å¯å˜Listï¼ˆ1ï¼‰List é»˜è®¤ä¸ºä¸å¯å˜é›†åˆ ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ª Listï¼ˆæ•°æ®æœ‰é¡ºåºï¼Œå¯é‡å¤ï¼‰ ï¼ˆ3ï¼‰é›†åˆé—´åˆå¹¶ï¼šå°†ä¸€ä¸ªæ•´ä½“æ‹†æˆä¸€ä¸ªä¸€ä¸ªçš„ä¸ªä½“ï¼Œç§°ä¸ºæ‰å¹³åŒ– ï¼ˆ4ï¼‰ç©ºé›†åˆå…ƒç´  Nil package com.kk1.demo7 object TestList1 extends App { //ï¼ˆ1ï¼‰List é»˜è®¤ä¸ºä¸å¯å˜é›†åˆ //ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ª Listï¼ˆæ•°æ®æœ‰é¡ºåºï¼Œå¯é‡å¤ï¼‰ val list: List[Int] = List(1, 2, 3, 4, 3) list.foreach(x =&gt; print(x + \" \")) println() // ç©ºé›†åˆ Nil val list0 = 1 :: 2 :: 3 :: 4 :: Nil list0.foreach(x =&gt; print(x + \" \")) println() // å¢åŠ å…ƒç´  val list1 = 5 :: 6 :: list // ::çš„è¿ç®—è§„åˆ™ä»å³å‘å·¦ list1.foreach(x =&gt; print(x + \" \")) // æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ ä½ç½® val list2 = list.+:(0) list2.foreach(x =&gt; print(x + \" \")) println() //å–æŒ‡å®šæ•°æ® println(list(0)) } 2ã€å¯å˜ ListBufferpackage com.kk1.demo7 import scala.collection.mutable.ListBuffer object TestList2 extends App { // åˆ›å»ºå¯å˜é›†åˆ var buffer = ListBuffer(1,2,3,4) // å‘é›†åˆä¸­æ·»åŠ æ•°æ® buffer.+=(5) buffer.append(6) buffer.insert(1,77)// åœ¨æ¸¸æ ‡1ä½ç½®å‰é¢åŠ å…¥77 // buffer.foreach(println) // ä¿®æ”¹ buffer(1) = 66 buffer.update(0,2) buffer.foreach(x =&gt;{print(x+\" \")}) println() // åˆ é™¤ // buffer.-=(5) // buffer.remove(5) buffer.foreach(x =&gt;{print(x+\" \")}) } 3ã€Seté›†åˆé»˜è®¤æƒ…å†µä¸‹ï¼ŒScala ä½¿ç”¨çš„æ˜¯ä¸å¯å˜é›†åˆï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å¯å˜é›†åˆï¼Œéœ€è¦å¼• scala.collection.mutable.Set åŒ… 1ã€ä¸å¯å˜Setï¼ˆ1ï¼‰Set é»˜è®¤æ˜¯ä¸å¯å˜é›†åˆï¼Œæ•°æ®æ— åº ï¼ˆ2ï¼‰æ•°æ®ä¸å¯é‡å¤ object SetTest01 extends App { //ï¼ˆ1ï¼‰Set é»˜è®¤æ˜¯ä¸å¯å˜é›†åˆï¼Œæ•°æ®æ— åº val set = Set(1, 2, 3, 4, 5, 6) //ï¼ˆ2ï¼‰æ•°æ®ä¸å¯é‡å¤ val set1 = Set(1, 2, 3, 4, 5, 6, 3) //ï¼ˆ3ï¼‰éå†é›†åˆ for (x &lt;- set1) { print(x+\" \") } } è¾“å‡ºï¼š---------------------------- 5 1 6 2 3 4 2ã€å¯å˜Setåˆ›å»ºå¯å˜é›†åˆ mutable.Set object SetTest02 extends App { //ï¼ˆ1ï¼‰åˆ›å»ºå¯å˜é›†åˆ val set = mutable.Set(1, 2, 3, 4, 5, 6) //ï¼ˆ3ï¼‰é›†åˆæ·»åŠ å…ƒç´  set += 8 //ï¼ˆ4ï¼‰å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Set val ints = set.+(9) println(ints) println(set) //ï¼ˆ5ï¼‰åˆ é™¤æ•°æ® set -= (5) // å»æ‰5è¿™ä¸ªå…ƒç´  println(set.mkString(\",\")) } è¾“å‡ºï¼š------------------------------ Set(9, 1, 5, 2, 6, 3, 4, 8) Set(1, 5, 2, 6, 3, 4, 8) 1,2,6,3,4,8 4ã€Mapé›†åˆ1ã€ä¸å¯å˜Mapå¦‚æœ key ä¸å­˜åœ¨ï¼Œè¿”å› è‡ªå®šä¹‰ æ¯”å¦‚ 0 package com.kk1.demo7 object MapTest1 extends App { //ï¼ˆ1ï¼‰åˆ›å»ºä¸å¯å˜é›†åˆ Map val map = Map(\"a\" -&gt; 1, \"b\" -&gt; 2, \"c\" -&gt; 3) //ï¼ˆ3ï¼‰è®¿é—®æ•°æ® for (elem &lt;- map.keys) { // ä½¿ç”¨ get è®¿é—® map é›†åˆçš„æ•°æ®ï¼Œä¼šè¿”å›ç‰¹æ®Šç±»å‹ Option(é€‰é¡¹):æœ‰å€¼ï¼ˆSomeï¼‰ï¼Œæ— å€¼(None) print(elem + \"=\" + map.get(elem).get + \" \") } println //ï¼ˆ4ï¼‰å¦‚æœ key ä¸å­˜åœ¨ï¼Œè¿”å› 0 println(map.get(\"d\").getOrElse(1)) println(map.getOrElse(\"d\", 0)) //ï¼ˆ2ï¼‰å¾ªç¯æ‰“å° map.foreach((kv) =&gt; { print(kv+\" \") }) } è¾“å‡ºï¼š-------------------------- a=1 b=2 c=3 1 0 (a,1) (b,2) (c,3) 2ã€å¯å˜Mappackage com.kk1.demo7 import scala.collection.mutable object MapTest2 extends App { //ï¼ˆ1ï¼‰åˆ›å»ºå¯å˜é›†åˆ val map = mutable.Map(\"a\" -&gt; 1, \"b\" -&gt; 2, \"c\" -&gt; 3) //ï¼ˆ3ï¼‰å‘é›†åˆå¢åŠ æ•°æ® map.+=(\"d\" -&gt; 4) // å°†æ•°å€¼ 4 æ·»åŠ åˆ°é›†åˆï¼Œå¹¶æŠŠé›†åˆä¸­åŸå€¼ 1 è¿”å› val maybeInt: Option[Int] = map.put(\"a\", 4) println(maybeInt.getOrElse(0)) // è®¾ç½®çš„0æ˜¯å¤±è´¥çš„å€¼ï¼ŒæˆåŠŸçš„æ˜¯1 //ï¼ˆ4ï¼‰åˆ é™¤æ•°æ® map.-=(\"b\", \"c\") //ï¼ˆ5ï¼‰ä¿®æ”¹æ•°æ® map.update(\"d\", 5) map(\"d\") = 5 //ï¼ˆ2ï¼‰æ‰“å°é›†åˆ map.foreach((kv) =&gt; { print(kv + \" \") }) } è¾“å‡ºï¼š-------------------------------------- 1 (d,5) (a,4) 5ã€å…ƒç»„1ã€æ¦‚è¿°å…ƒç»„ä¹Ÿæ˜¯å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥å­˜æ”¾å„ç§ç›¸åŒæˆ–ä¸åŒç±»å‹çš„æ•°æ®ã€‚è¯´çš„ç®€å•ç‚¹ï¼Œå°±æ˜¯å°†å¤šä¸ªæ— å…³çš„æ•°æ®å°è£…ä¸ºä¸€ä¸ªæ•´ä½“ï¼Œç§°ä¸ºå…ƒç»„ æ³¨æ„ï¼šå…ƒç»„ä¸­æœ€å¤§åªèƒ½æœ‰ 22 ä¸ªå…ƒç´  2ã€æ¡ˆä¾‹ï¼ˆ1ï¼‰å£°æ˜å…ƒç»„çš„æ–¹å¼ï¼š(å…ƒç´  1ï¼Œå…ƒç´  2ï¼Œå…ƒç´  3) ï¼ˆ2ï¼‰è®¿é—®å…ƒç»„ ï¼ˆ3ï¼‰Map ä¸­çš„é”®å€¼å¯¹å…¶å®å°±æ˜¯å…ƒç»„,åªä¸è¿‡å…ƒç»„çš„å…ƒç´ ä¸ªæ•°ä¸º 2ï¼Œç§°ä¹‹ä¸ºå¯¹å¶ package com.kk1.demo7 object TestTuple extends App { //ï¼ˆ1ï¼‰å£°æ˜å…ƒç»„çš„æ–¹å¼ï¼š(å…ƒç´  1ï¼Œå…ƒç´  2ï¼Œå…ƒç´  3) //å£°æ˜ä¸€ä¸ª3å…ƒç»„ val tuple: (Int, String, Boolean) = (40, \"mykk\", true) //ï¼ˆ2ï¼‰è®¿é—®å…ƒç»„ //ï¼ˆ2.1ï¼‰é€šè¿‡å…ƒç´ çš„é¡ºåºè¿›è¡Œè®¿é—®ï¼Œè°ƒç”¨æ–¹å¼ï¼š_é¡ºåºå· println(tuple._1) println(tuple._2) println(tuple._3) //ï¼ˆ2.2ï¼‰é€šè¿‡ç´¢å¼•è®¿é—®æ•°æ® println(tuple.productElement(0)) //ï¼ˆ2.3ï¼‰é€šè¿‡è¿­ä»£å™¨è®¿é—®æ•°æ® for (elem &lt;- tuple.productIterator) { print(elem + \" \") } //ï¼ˆ3ï¼‰Map ä¸­çš„é”®å€¼å¯¹å…¶å®å°±æ˜¯å…ƒç»„,åªä¸è¿‡å…ƒç»„çš„å…ƒç´ ä¸ªæ•°ä¸º 2ï¼Œç§°ä¹‹ä¸ºå¯¹å¶ val map = Map(\"a\" -&gt; 1, \"b\" -&gt; 2, \"c\" -&gt; 3) val map1 = Map((\"a\", 1), (\"b\", 2), (\"c\", 3)) map.foreach(tuple =&gt; { println(tuple._1 + \"=\" + tuple._2) }) } è¾“å‡ºï¼š-------------------- 40 mykk true 40 40 mykk true a=1 b=2 c=3 6ã€é˜Ÿåˆ—Scala ä¹Ÿæä¾›äº†é˜Ÿåˆ—ï¼ˆQueueï¼‰çš„æ•°æ®ç»“æ„ï¼Œé˜Ÿåˆ—çš„ç‰¹ç‚¹å°±æ˜¯å…ˆè¿›å…ˆå‡ºã€‚è¿›é˜Ÿå’Œå‡ºé˜Ÿçš„æ–¹æ³•åˆ†åˆ«ä¸º enqueue å’Œ dequeue package com.kk1.demo7 import scala.collection.mutable object TestQueue extends App { val queue = new mutable.Queue[String]() queue.enqueue(\"a\", \"b\", \"c\") println(queue.dequeue()) println(queue.dequeue()) println(queue.dequeue()) } 7ã€å¹¶è¡Œé›†åˆScala ä¸ºäº†å……åˆ†ä½¿ç”¨å¤šæ ¸ CPUï¼Œæä¾›äº†å¹¶è¡Œé›†åˆï¼ˆæœ‰åˆ«äºå‰é¢çš„ä¸²è¡Œé›†åˆï¼‰ï¼Œç”¨äºå¤šæ ¸ç¯å¢ƒçš„å¹¶è¡Œè®¡ç®— package com.kk1.demo7 object TestPar extends App { val result1 = (0 to 100).map { case _ =&gt; Thread.currentThread().getName } val result2 = (0 to 100).par.map { case _ =&gt; Thread.currentThread().getName } println(result1) println(result2) } 8ã€é›†åˆå¸¸ç”¨å‡½æ•°1ã€åŸºæœ¬å±æ€§å’Œå¸¸ç”¨æ“ä½œï¼ˆ1ï¼‰è·å–é›†åˆé•¿åº¦ ï¼ˆ2ï¼‰è·å–é›†åˆå¤§å° ï¼ˆ3ï¼‰å¾ªç¯éå† ï¼ˆ4ï¼‰è¿­ä»£å™¨ ï¼ˆ5ï¼‰ç”Ÿæˆå­—ç¬¦ä¸² ï¼ˆ6ï¼‰æ˜¯å¦åŒ…å« val list: List[Int] = List(1, 2, 3, 4, 5, 6, 7) //ï¼ˆ1ï¼‰è·å–é›†åˆé•¿åº¦ println(list.length) //ï¼ˆ2ï¼‰è·å–é›†åˆå¤§å°,ç­‰åŒäº length println(list.size) //ï¼ˆ3ï¼‰å¾ªç¯éå† list.foreach(println) //ï¼ˆ4ï¼‰è¿­ä»£å™¨ for (elem &lt;- list.iterator) { println(elem) } //ï¼ˆ5ï¼‰ç”Ÿæˆå­—ç¬¦ä¸² println(list.mkString(\",\")) //ï¼ˆ6ï¼‰æ˜¯å¦åŒ…å« println(list.contains(3)) 2ã€è¡ç”Ÿé›†åˆï¼ˆ1ï¼‰è·å–é›†åˆçš„å¤´ ï¼ˆ2ï¼‰è·å–é›†åˆçš„å°¾ï¼ˆä¸æ˜¯å¤´çš„å°±æ˜¯å°¾ï¼‰ ï¼ˆ3ï¼‰é›†åˆæœ€åä¸€ä¸ªæ•°æ® ï¼ˆ4ï¼‰é›†åˆåˆå§‹æ•°æ®ï¼ˆä¸åŒ…å«æœ€åä¸€ä¸ªï¼‰ ï¼ˆ5ï¼‰åè½¬ ï¼ˆ6ï¼‰å–å‰ï¼ˆåï¼‰n ä¸ªå…ƒç´  ï¼ˆ7ï¼‰å»æ‰å‰ï¼ˆåï¼‰n ä¸ªå…ƒç´  ï¼ˆ8ï¼‰å¹¶é›† ï¼ˆ9ï¼‰äº¤é›† ï¼ˆ10ï¼‰å·®é›† ï¼ˆ11ï¼‰æ‹‰é“¾ ï¼ˆ12ï¼‰æ»‘çª— val list1: List[Int] = List(1, 2, 3, 4, 5, 6, 7) val list2: List[Int] = List(4, 5, 6, 7, 8, 9, 10) //ï¼ˆ1ï¼‰è·å–é›†åˆçš„å¤´ println(list1.head) //ï¼ˆ2ï¼‰è·å–é›†åˆçš„å°¾ï¼ˆä¸æ˜¯å¤´çš„å°±æ˜¯å°¾ï¼‰ println(list1.tail) //ï¼ˆ3ï¼‰é›†åˆæœ€åä¸€ä¸ªæ•°æ® println(list1.last) //ï¼ˆ4ï¼‰é›†åˆåˆå§‹æ•°æ®ï¼ˆä¸åŒ…å«æœ€åä¸€ä¸ªï¼‰ println(list1.init) //ï¼ˆ5ï¼‰åè½¬ println(list1.reverse) //ï¼ˆ6ï¼‰å–å‰ï¼ˆåï¼‰n ä¸ªå…ƒç´  println(list1.take(3)) println(list1.takeRight(3)) //ï¼ˆ7ï¼‰å»æ‰å‰ï¼ˆåï¼‰n ä¸ªå…ƒç´  println(list1.drop(3)) println(list1.dropRight(3)) //ï¼ˆ8ï¼‰å¹¶é›† println(list1.union(list2)) //ï¼ˆ9ï¼‰äº¤é›† println(list1.intersect(list2)) //ï¼ˆ10ï¼‰å·®é›† println(list1.diff(list2)) //ï¼ˆ11ï¼‰æ‹‰é“¾ æ³¨:å¦‚æœä¸¤ä¸ªé›†åˆçš„å…ƒç´ ä¸ªæ•°ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆä¼šå°†åŒç­‰æ•°é‡çš„æ•°æ®è¿›è¡Œæ‹‰é“¾ï¼Œå¤šä½™çš„æ•°æ®çœç•¥ä¸ç”¨ println(list1.zip(list2)) //ï¼ˆ12ï¼‰æ»‘çª— list1.sliding(2, 5).foreach(println) è¾“å‡º------------------------------ 1 List(2, 3, 4, 5, 6, 7) 7 List(1, 2, 3, 4, 5, 6) List(7, 6, 5, 4, 3, 2, 1) List(1, 2, 3) List(5, 6, 7) List(4, 5, 6, 7) List(1, 2, 3, 4) List(1, 2, 3, 4, 5, 6, 7, 4, 5, 6, 7, 8, 9, 10) List(4, 5, 6, 7) List(1, 2, 3) æ‹‰é“¾ï¼Œå°±æ˜¯å°†Aé›†åˆ0å…ƒç´ å’ŒBé›†åˆ0å…ƒç´ ç»„åˆæˆkey value,ä»¥æ­¤ç±»æ¨ List((1,4), (2,5), (3,6), (4,7), (5,8), (6,9), (7,10)) æ»‘çª—ï¼Œ2-5åŒºé—´ä¹‹å¤–çš„åŒºé—´ï¼Œä»ä¸­é—´å‰ªæˆä¸¤æ®µ List(1, 2) List(6, 7) 3ã€é›†åˆè®¡ç®—ç®€å•å‡½æ•°ï¼ˆ1ï¼‰æ±‚å’Œ ï¼ˆ2ï¼‰æ±‚ä¹˜ç§¯ ï¼ˆ3ï¼‰æœ€å¤§å€¼ ï¼ˆ4ï¼‰æœ€å°å€¼ ï¼ˆ5ï¼‰æ’åº val list: List[Int] = List(1, 5, -3, 4, 2, -7, 6) //ï¼ˆ1ï¼‰æ±‚å’Œ println(list.sum) //ï¼ˆ2ï¼‰æ±‚ä¹˜ç§¯ println(list.product) //ï¼ˆ3ï¼‰æœ€å¤§å€¼ println(list.max) //ï¼ˆ4ï¼‰æœ€å°å€¼ println(list.min) //ï¼ˆ5ï¼‰æ’åº // ï¼ˆ5.1ï¼‰æŒ‰ç…§å…ƒç´ å¤§å°æ’åº println(list.sortBy(x =&gt; x)) // ï¼ˆ5.2ï¼‰æŒ‰ç…§å…ƒç´ çš„ç»å¯¹å€¼å¤§å°æ’åº println(list.sortBy(x =&gt; x.abs)) // ï¼ˆ5.3ï¼‰æŒ‰å…ƒç´ å¤§å°å‡åºæ’åº println(list.sortWith((x, y) =&gt; x &lt; y)) // ï¼ˆ5.4ï¼‰æŒ‰å…ƒç´ å¤§å°é™åºæ’åº println(list.sortWith((x, y) =&gt; x &gt; y)) è¾“å‡º---------------------------------- 8 5040 6 -7 List(-7, -3, 1, 2, 4, 5, 6) List(1, 2, -3, 4, 5, 6, -7) List(-7, -3, 1, 2, 4, 5, 6) List(6, 5, 4, 2, 1, -3, -7) ï¼ˆ1ï¼‰sorted å¯¹ä¸€ä¸ªé›†åˆè¿›è¡Œè‡ªç„¶æ’åºï¼Œé€šè¿‡ä¼ é€’éšå¼çš„ Ordering ï¼ˆ2ï¼‰sortBy å¯¹ä¸€ä¸ªå±æ€§æˆ–å¤šä¸ªå±æ€§è¿›è¡Œæ’åºï¼Œé€šè¿‡å®ƒçš„ç±»å‹ ï¼ˆ3ï¼‰sortWith åŸºäºå‡½æ•°çš„æ’åºï¼Œé€šè¿‡ä¸€ä¸ª comparator å‡½æ•°ï¼Œå®ç°è‡ªå®šä¹‰æ’åºçš„é€»è¾‘ 4ã€é›†åˆè®¡ç®—é«˜çº§å‡½æ•°ï¼ˆ1ï¼‰è¿‡æ»¤ éå†ä¸€ä¸ªé›†åˆå¹¶ä»ä¸­è·å–æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„å…ƒç´ ç»„æˆä¸€ä¸ªæ–°çš„é›†åˆ ï¼ˆ2ï¼‰è½¬åŒ–/æ˜ å°„ï¼ˆmapï¼‰ å°†é›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜ å°„åˆ°æŸä¸€ä¸ªå‡½æ•° ï¼ˆ3ï¼‰æ‰å¹³åŒ– ï¼ˆ4ï¼‰æ‰å¹³åŒ–+æ˜ å°„ æ³¨ï¼šflatMap ç›¸å½“äºå…ˆè¿›è¡Œ map æ“ä½œï¼Œåœ¨è¿›è¡Œ flatten æ“ä½œ é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ çš„å­å…ƒç´ æ˜ å°„åˆ°æŸä¸ªå‡½æ•°å¹¶è¿”å›æ–°é›†åˆ ï¼ˆ5ï¼‰**åˆ†ç»„(group)**ï¼šæŒ‰ç…§æŒ‡å®šçš„è§„åˆ™å¯¹é›†åˆçš„å…ƒç´ è¿›è¡Œåˆ†ç»„ ï¼ˆ6ï¼‰ç®€åŒ–ï¼ˆå½’çº¦ï¼‰ ï¼ˆ7ï¼‰æŠ˜å  val list: List[Int] = List(1, 2, 3, 4, 5, 6, 7, 8, 9) val nestedList: List[List[Int]] = List(List(1, 2, 3), List(4, 5, 6), List(7, 8, 9)) val wordList: List[String] = List(\"hello world\", \"hello mykk\", \"hello scala\") //ï¼ˆ1ï¼‰è¿‡æ»¤ println(list.filter(x =&gt; x % 2 == 0)) //ï¼ˆ2ï¼‰è½¬åŒ–/æ˜ å°„ println(list.map(x =&gt; x + 1)) //ï¼ˆ3ï¼‰æ‰å¹³åŒ–,å¹³é“ºï¼šç±»ä¼¼äºæŠŠæ‰€æœ‰çš„å¶å­èŠ‚ç‚¹æ”¾åˆ°åŒä¸€çº§ println(nestedList.flatten) //ï¼ˆ4ï¼‰æ‰å¹³åŒ–+æ˜ å°„ æ³¨ï¼šflatMap ç›¸å½“äºå…ˆè¿›è¡Œ map æ“ä½œï¼Œåœ¨è¿›è¡Œ flattenæ“ä½œ println(wordList.flatMap(x =&gt; x.split(\" \"))) //ï¼ˆ5ï¼‰åˆ†ç»„ println(list.groupBy(x =&gt; x % 2)) è¾“å‡º--------------------------------- List(2, 4, 6, 8) List(2, 3, 4, 5, 6, 7, 8, 9, 10) List(1, 2, 3, 4, 5, 6, 7, 8, 9) List(hello, world, hello, mykk, hello, scala) Map(1 -&gt; List(1, 3, 5, 7, 9), 0 -&gt; List(2, 4, 6, 8)) Reduce ç®€åŒ–ï¼ˆå½’çº¦ï¼‰ ï¼šé€šè¿‡æŒ‡å®šçš„é€»è¾‘å°†é›†åˆä¸­çš„æ•°æ®è¿›è¡Œèšåˆï¼Œä»è€Œå‡å°‘æ•°æ®ï¼Œæœ€ç»ˆè·å–ç»“æœ val list = List(1, 2, 3, 4) // å°†æ•°æ®ä¸¤ä¸¤ç»“åˆï¼Œå®ç°è¿ç®—è§„åˆ™ val i: Int = list.reduce((x, y) =&gt; x - y) println(\"i = \" + i) // ä»æºç çš„è§’åº¦ï¼Œreduce åº•å±‚è°ƒç”¨çš„å…¶å®å°±æ˜¯ reduceLeft //val i1 = list.reduceLeft((x,y) =&gt; x-y) // ((4-3)-2-1) = -2 val i2 = list.reduceRight((x, y) =&gt; x - y) println(i2) è¾“å‡º--------------------------------- i = -8 -2 **Fold æ–¹æ³•(æŠ˜å )**ï¼šåŒ–ç®€çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ val list = List(1, 2, 3, 4) // fold æ–¹æ³•ä½¿ç”¨äº†å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œå­˜åœ¨ä¸¤ä¸ªå‚æ•°åˆ—è¡¨ // ç¬¬ä¸€ä¸ªå‚æ•°åˆ—è¡¨ä¸º ï¼š é›¶å€¼ï¼ˆåˆå§‹å€¼ï¼‰ // ç¬¬äºŒä¸ªå‚æ•°åˆ—è¡¨ä¸ºï¼š ç®€åŒ–è§„åˆ™ // fold åº•å±‚å…¶å®ä¸º foldLeft //åœ¨å…ƒç´ 1ä¹‹å‰ï¼Œæ”¾ä¸€ä¸ª0åˆå§‹å€¼è®¡ç®— val i = list.foldLeft(0)((x, y) =&gt; x - y) // (0-1)-2)-3)-4 println(i) println(\"æ¨å¯¼è¿‡ç¨‹\") // val i1 = list.foldRight(10)((x, y) =&gt; x - y) val i1 = list.foldRight(10)((x, y) =&gt; { println(\" x= \" + x + \" ,y=\" + y) x - y }) // 10æ”¾åœ¨å€’æ•°ç¬¬äºŒä¸ª println(i1) è¾“å‡º--------------------------------- -10 æ¨å¯¼è¿‡ç¨‹ x= 4 ,y=10 x= 3 ,y=-6 x= 2 ,y=9 x= 1 ,y=-7 8 æ¡ˆä¾‹ï¼šä¸¤ä¸ªé›†åˆåˆå¹¶ package com.kk1.demo7 import scala.collection.mutable object TestFold extends App { // ä¸¤ä¸ª Map çš„æ•°æ®åˆå¹¶ val map1 = mutable.Map(\"a\" -&gt; 1, \"b\" -&gt; 2, \"c\" -&gt; 3) val map2 = mutable.Map(\"a\" -&gt; 4, \"b\" -&gt; 5, \"d\" -&gt; 6) val map3: mutable.Map[String, Int] = map2.foldLeft(map1) { (map, kv) =&gt; { val k = kv._1 val v = kv._2 print(map.toString()+\",\") print(kv.toString()+\",\") print(\"map.getOrElse(k, 0)=\"+map.getOrElse(k, 0)+\",\") map(k) = map.getOrElse(k, 0) + v println( \"map(k)\" + map(k)) map } } println(map3) } è¾“å‡º--------------------------------- Map(b -&gt; 2, a -&gt; 1, c -&gt; 3),(b,5),map.getOrElse(k, 0)=2,map(k)7 Map(b -&gt; 7, a -&gt; 1, c -&gt; 3),(d,6),map.getOrElse(k, 0)=0,map(k)6 Map(b -&gt; 7, d -&gt; 6, a -&gt; 1, c -&gt; 3),(a,4),map.getOrElse(k, 0)=1,map(k)5 Map(b -&gt; 7, d -&gt; 6, a -&gt; 5, c -&gt; 3) 5ã€æ™®é€š WordCount æ¡ˆä¾‹æ¡ˆä¾‹ï¼šå•è¯è®¡æ•°ï¼šå°†é›†åˆä¸­å‡ºç°çš„ç›¸åŒçš„å•è¯ï¼Œè¿›è¡Œè®¡æ•°ï¼Œå–è®¡æ•°æ’åå‰ä¸‰çš„ç»“æœ package com.kk1.demo7 object TestWordCount extends App { // å•è¯è®¡æ•°ï¼šå°†é›†åˆä¸­å‡ºç°çš„ç›¸åŒçš„å•è¯ï¼Œè¿›è¡Œè®¡æ•°ï¼Œå–è®¡æ•°æ’åå‰ä¸‰çš„ç»“æœ val stringList = List(\"Hello Scala Hbase kafka\", \"Hello scala Hbase\", \"Hello Scala\", \"Hello \") // 1ã€æ‰“æ•£ï¼šå°†æ¯ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªä¸€ä¸ªå•è¯ val wordList: List[String] = stringList.flatMap(str =&gt; str.split(\" \")) println(wordList) // 2ã€å°†ç›¸åŒçš„å•è¯æ”¾ç½®åœ¨ä¸€èµ· val wordToWordsMap: Map[String, List[String]] = wordList.groupBy(word =&gt; word) println(wordToWordsMap.keys) println(wordToWordsMap.values) // 3ã€å¯¹ç›¸åŒçš„å•è¯è¿›è¡Œè®¡æ•° val wordToCountMap: Map[String, Int] = wordToWordsMap.map(tuple =&gt; (tuple._1, tuple._2.size)) println(wordToCountMap) // 4ã€å¯¹è®¡æ•°å®Œæˆåçš„ç»“æœè¿›è¡Œæ’åºï¼ˆé™åºï¼‰ val sortList: List[(String, Int)] = wordToCountMap.toList.sortWith { (left, right) =&gt; { left._2 &gt; right._2 } } println(sortList) } è¾“å‡º--------------------------------- List(Hello, Scala, Hbase, kafka, Hello, scala, Hbase, Hello, Scala, Hello) Set(Hbase, Scala, kafka, Hello, scala) HashMap.HashMapValues(List(Hbase, Hbase), List(Scala, Scala), List(kafka), List(Hello, Hello, Hello, Hello), List(scala)) Map(Hbase -&gt; 2, Scala -&gt; 2, kafka -&gt; 1, Hello -&gt; 4, scala -&gt; 1) List((Hello,4), (Hbase,2), (Scala,2), (kafka,1), (scala,1)) 6ã€å¤æ‚ WordCount æ¡ˆä¾‹æ¡ˆä¾‹ï¼šå’Œä¸Šé¢ä¸€æ ·ï¼Œå†™æ³•ä¸ä¸€æ · package com.kk1.demo7 object TestWordCount extends App { val tupleList = List((\"Hello Scala Spark World \", 4), (\"Hello Scala Spark\", 3), (\"Hello Scala\", 2), (\"Hello \", 1)) // é‡å¤å¤åˆ¶ å‚æ•°1ä¸ªæ•°ä¸º å‚æ•°2ä¸ª // val stringList: List[String] = tupleList.map(t =&gt; (t._1 + \"\") * t._2) // println(stringList) val wordToCountList: List[(String, Int)] = tupleList.flatMap { t =&gt; { // val strings = t._1.split(\" \") strings.map(word =&gt; (word, t._2)) } } println(wordToCountList) val wordToTupleMap: Map[String, List[(String, Int)]] = wordToCountList.groupBy(t =&gt; t._1) println(wordToTupleMap.keys) println(wordToTupleMap.values) val stringToInts: Map[String, List[Int]] = wordToTupleMap.mapValues { datas =&gt; datas.map(t =&gt; t._2) } println(stringToInts) // é”™è¯¯çš„ val count1: Map[String, Int] = stringToInts.map(tuple =&gt; (tuple._1, tuple._2.size)) // æ­£ç¡®çš„ val count2: Map[String, Int] = stringToInts.map(tuple =&gt; (tuple._1, tuple._2.reduce((x, y) =&gt; x + y))) println(count2) } ä¸ƒã€æ¨¡å¼åŒ¹é…Scala ä¸­çš„æ¨¡å¼åŒ¹é…ç±»ä¼¼äº Java ä¸­çš„ switch è¯­æ³• 1ã€åŸºæœ¬è¯­æ³•æ¨¡å¼åŒ¹é…è¯­æ³•ä¸­ï¼Œé‡‡ç”¨ match å…³é”®å­—å£°æ˜ï¼Œæ¯ä¸ªåˆ†æ”¯é‡‡ç”¨ case å…³é”®å­—è¿›è¡Œå£°æ˜ï¼Œå½“éœ€ è¦åŒ¹é…æ—¶ï¼Œä¼šä»ç¬¬ä¸€ä¸ª case åˆ†æ”¯å¼€å§‹ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œé‚£ä¹ˆæ‰§è¡Œå¯¹åº”çš„é€»è¾‘ä»£ç ï¼Œå¦‚æœåŒ¹é…ä¸æˆåŠŸï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªåˆ†æ”¯è¿›è¡Œåˆ¤æ–­ã€‚å¦‚æœæ‰€æœ‰ case éƒ½ä¸åŒ¹é…ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œ case _åˆ†æ”¯ï¼Œç±»ä¼¼äº Java ä¸­ default è¯­å¥ã€‚ package com.kk1.demo7 object TestMatchCase extends App { var a: Int = 10 var b: Int = 20 var operator: Char = '-' var result = operator match { case '+' =&gt; a + b case '-' =&gt; a - b case '*' =&gt; a * b case '/' =&gt; a / b case _ =&gt; \"string\" } println(result) } ï¼ˆ1ï¼‰å¦‚æœæ‰€æœ‰ case éƒ½ä¸åŒ¹é…ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œ case _ åˆ†æ”¯ï¼Œç±»ä¼¼äº Java ä¸­ default è¯­å¥ï¼Œ è‹¥æ­¤æ—¶æ²¡æœ‰ case _ åˆ†æ”¯ï¼Œé‚£ä¹ˆä¼šæŠ›å‡º MatchErrorã€‚ ï¼ˆ2ï¼‰æ¯ä¸ª case ä¸­ï¼Œä¸éœ€è¦ä½¿ç”¨ break è¯­å¥ï¼Œè‡ªåŠ¨ä¸­æ–­ caseã€‚ ï¼ˆ3ï¼‰match case è¯­å¥å¯ä»¥åŒ¹é…ä»»ä½•ç±»å‹ï¼Œè€Œä¸åªæ˜¯å­—é¢é‡ã€‚ ï¼ˆ4ï¼‰=&gt; åé¢çš„ä»£ç å—ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª case è¯­å¥ä¹‹å‰çš„ä»£ç æ˜¯ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œï¼Œå¯ä»¥ ä½¿ç”¨{}æ‹¬èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ä¸æ‹¬ 2ã€æ¨¡å¼å®ˆå«å¦‚æœæƒ³è¦è¡¨è¾¾åŒ¹é…æŸä¸ªèŒƒå›´çš„æ•°æ®ï¼Œå°±éœ€è¦åœ¨æ¨¡å¼åŒ¹é…ä¸­å¢åŠ æ¡ä»¶å®ˆå« def abs(x: Int) = x match { case i: Int if i &gt;= 0 =&gt; i case j: Int if j &lt; 0 =&gt; -j case _ =&gt; \"type illegal\" } println(abs(-5)) 3ã€æ¨¡å¼åŒ¹é…ç±»å‹1ã€åŒ¹é…å¸¸é‡Scala ä¸­ï¼Œæ¨¡å¼åŒ¹é…å¯ä»¥åŒ¹é…æ‰€æœ‰çš„å­—é¢é‡ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ï¼Œæ•°å­—ï¼Œå¸ƒå°”å€¼ç­‰ç­‰ println(describe(5))// è¾“å…¥å®šä¹‰çš„ä»¥å¤–ï¼Œæ¯”å¦‚6ï¼Œåˆ™ä¼šå¼‚å¸¸ def describe(x: Any) = x match { case 5 =&gt; \"Int five\" case \"hello\" =&gt; \"String hello\" case true =&gt; \"Boolean true\" case '+' =&gt; \"Char +\" } 2ã€åŒ¹é…ç±»å‹éœ€è¦è¿›è¡Œç±»å‹åˆ¤æ–­æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‰æ–‡æ‰€å­¦çš„ isInstanceOf[T]å’Œ asInstanceOf[T]ï¼Œä¹Ÿå¯ä½¿ ç”¨æ¨¡å¼åŒ¹é…å®ç°åŒæ ·çš„åŠŸèƒ½ def describe(x: Any) = x match { case i: Int =&gt; \"Int\" case s: String =&gt; \"String hello\" case m: List[_] =&gt; \"List\" case c: Array[Int] =&gt; \"Array[Int]\" case someThing =&gt; \"something else \" + someThing } //æ³›å‹æ“¦é™¤ println(describe(List(1, 2, 3, 4, 5))) println(describe(List(\"abc\"))) //æ•°ç»„ä¾‹å¤–ï¼Œå¯ä¿ç•™æ³›å‹ println(describe(Array(1, 2, 3, 4, 5, 6))) println(describe(Array(\"abc\"))) è¾“å‡º----------------------------------------- List List Array[Int] something else [Ljava.lang.String;@38082d64 3ã€åŒ¹é…æ•°ç»„scala æ¨¡å¼åŒ¹é…å¯ä»¥å¯¹é›†åˆè¿›è¡Œç²¾ç¡®çš„åŒ¹é…ï¼Œä¾‹å¦‚åŒ¹é…åªæœ‰ä¸¤ä¸ªå…ƒç´ çš„ã€ä¸”ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º 0 çš„æ•°ç»„ for (arr &lt;- Array(Array(0), Array(1, 0), Array(0, 1, 0), Array(1, 1, 0), Array(1, 1, 0, 1), Array(\"hello\", 90))) { // å¯¹ä¸€ä¸ªæ•°ç»„é›†åˆè¿›è¡Œéå† val result = arr match { case Array(0) =&gt; \"0\" //åŒ¹é… Array(0) è¿™ä¸ªæ•°ç»„ case Array(x, y) =&gt; x + \",\" + y //åŒ¹é…æœ‰ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ ï¼Œ ç„¶åå°†å°†å…ƒç´ å€¼èµ‹ç»™å¯¹åº”çš„ x, y case Array(0, _*) =&gt; \"ä»¥ 0 å¼€å¤´çš„æ•°ç»„\" //åŒ¹é…ä»¥ 0 å¼€å¤´å’Œæ•°ç»„ case _ =&gt; \"something else\" } println(\"result = \" + result) } è¾“å‡º----------------------------------------- result = 0 result = 1,0 result = ä»¥ 0 å¼€å¤´çš„æ•°ç»„ result = something else result = something else result = hello,90 4ã€åŒ¹é…åˆ—è¡¨æ–¹å¼ä¸€ï¼š //list æ˜¯ä¸€ä¸ªå­˜æ”¾ List é›†åˆçš„æ•°ç»„ //å¦‚æœè¦åŒ¹é… List(88) è¿™æ ·çš„åªå«æœ‰ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨,å¹¶åŸå€¼è¿”å›.åº”è¯¥æ€ä¹ˆå†™ for (list &lt;- Array(List(0), List(1, 0), List(0, 0, 0), List(1, 0, 0), List(88))) { val result = list match { case List(0) =&gt; \"0\" //åŒ¹é… List(0) case List(x, y) =&gt; x + \",\" + y //åŒ¹é…æœ‰ä¸¤ä¸ªå…ƒç´ çš„ List case List(0, _*) =&gt; \"0 ...\" // case data =&gt; data // å¦‚æœæ”¾åœ¨ case _å‰åˆ™æ­¤è¾“å‡ºï¼Œåº•ä¸‹ä¸è¾“å‡º,åˆ™å¯ä»¥è¾“å‡º88 case _ =&gt; \"something else\" } println(result) } è¾“å‡º----------------------------------------- 0 1,0 0 ... something else something else æ–¹å¼äºŒï¼š val list: List[Int] = List(1, 2, 5, 6, 7) list match { case first :: second :: rest =&gt; println(first + \"-\" + second + \"-\" + rest) // case first :: second =&gt; println(first + \"-\" + second) // case first =&gt; println(first) case _ =&gt; println(\"something else\") } è¾“å‡º----------------------------------------- 1-2-List(5, 6, 7) 5ã€åŒ¹é…å…ƒç»„ //å¯¹ä¸€ä¸ªå…ƒç»„é›†åˆè¿›è¡Œéå† for (tuple &lt;- Array((0, 1), (1, 0), (1, 1), (1, 0, 2))) { val result = tuple match { case (0, _) =&gt; \"0 ...\" //æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ 0 çš„å…ƒç»„ case (y, 0) =&gt; \"\" + y + \"0\" // åŒ¹é…åä¸€ä¸ªå…ƒç´ æ˜¯ 0 çš„å¯¹å¶å…ƒç»„ case (a, b) =&gt; \"\" + a + \" \" + b case _ =&gt; \"something else\" //é»˜è®¤ } println(result) } è¾“å‡º----------------------------------------- 0 ... 10 1 1 something else æ‰©å±•ï¼š package com.kk1.demo7 object TestMatchCase extends App { //ç‰¹æ®Šçš„æ¨¡å¼åŒ¹é… 1 ï¼šæ‰“å°å…ƒç»„ç¬¬ä¸€ä¸ªå…ƒç´  for (elem &lt;- Array((\"a\", 1), (\"b\", 2), (\"c\", 3))) { print(elem._1 + \" \") // ç©ºæ ¼é—´éš”å¼€ } println for ((word, count) &lt;- Array((\"a\", 1), (\"b\", 2), (\"c\", 3))) { print(word + \" \") // ç©ºæ ¼é—´éš”å¼€ } println for ((word, _) &lt;- Array((\"a\", 1), (\"b\", 2), (\"c\", 3))) { print(word + \" \") // ç©ºæ ¼é—´éš”å¼€ } for ((\"a\", count) &lt;- Array((\"a\", 1), (\"b\", 2), (\"c\", 3))) { print(count + \" \") // ç©ºæ ¼é—´éš”å¼€ } println println(\"--------------\") //ç‰¹æ®Šçš„æ¨¡å¼åŒ¹é… 2 ï¼šç»™å…ƒç»„å…ƒç´ å‘½å var (id, name, age): (Int, String, Int) = (100, \"zs\", 20) println((id, name, age)) println(\"--------------\") //ç‰¹æ®Šçš„æ¨¡å¼åŒ¹é… 3 ï¼šéå†é›†åˆä¸­çš„å…ƒç»„ï¼Œç»™ count * 2 var list: List[(String, Int)] = List((\"a\", 1), (\"b\", 2), (\"c\", 3)) //println(list.map(t =&gt; (t._1, t._2 * 2))) println( list.map { case (word, count) =&gt; (word, count * 2) } ) var list1 = List((\"a\", (\"a\", 1)), (\"b\", (\"b\", 2)), (\"c\", (\"c\", 3))) println( list1.map { case (groupkey, (word, count)) =&gt; (word, count * 2) } ) } è¾“å‡º----------------------------------------- a b c a b c a b c 1 -------------- (100,zs,20) -------------- List((a,2), (b,4), (c,6)) List((a,2), (b,4), (c,6)) 6ã€åŒ¹é…å¯¹è±¡åŠæ ·ä¾‹ç±» val user = User(â€œzhangsanâ€,11)ï¼Œè¯¥è¯­å¥åœ¨æ‰§è¡Œæ—¶ï¼Œå®é™…è°ƒç”¨çš„æ˜¯ User ä¼´ç”Ÿå¯¹è±¡ä¸­çš„ apply æ–¹æ³•ï¼Œå› æ­¤ä¸ç”¨ new å…³é”®å­—å°±èƒ½æ„é€ å‡ºç›¸åº”çš„å¯¹è±¡ å½“å°† User(â€œzhangsanâ€, 11)**å†™åœ¨ case åæ—¶[case User(â€œzhangsanâ€, 11) =&gt; â€œyesâ€]ï¼Œä¼šé»˜è®¤è°ƒç”¨ **unapply æ–¹æ³•(å¯¹è±¡æå–å™¨)ï¼Œuser ä½œä¸º unapply æ–¹æ³•çš„å‚æ•°ï¼Œunapply æ–¹æ³•å°† user å¯¹è±¡çš„ name å’Œ age å±æ€§æå–å‡ºæ¥ï¼Œä¸ User(â€œzhangsanâ€, 11)ä¸­çš„å±æ€§å€¼è¿›è¡ŒåŒ¹é… case ä¸­å¯¹è±¡çš„ unapply æ–¹æ³•(æå–å™¨)è¿”å› Someï¼Œä¸”æ‰€æœ‰å±æ€§å‡ä¸€è‡´ï¼Œæ‰ç®—åŒ¹é…æˆåŠŸ, å±æ€§ä¸ä¸€è‡´ï¼Œæˆ–è¿”å› Noneï¼Œåˆ™åŒ¹é…å¤±è´¥ è‹¥åªæå–å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œåˆ™æå–å™¨ä¸º unapply(obj:Obj):Option[**T]** è‹¥æå–å¯¹è±¡çš„å¤šä¸ªå±æ€§ï¼Œåˆ™æå–å™¨ä¸º unapply(obj:Obj):Option[(T1,T2,T3â€¦)] è‹¥æå–å¯¹è±¡çš„å¯å˜ä¸ªå±æ€§ï¼Œåˆ™æå–å™¨ä¸º unapplySeq(obj:Obj):Option[**Seq[T]]** package com.kk1.demo7 class User(val name: String, val age: Int) object User { def apply(name: String, age: Int): User = new User(name, age) def unapply(user: User): Option[(String, Int)] = { if (user == null) None else Some(user.name, user.age) } } object TestMatchUnapply { def main(args: Array[String]): Unit = { val user: User = User(\"zhangsan\", 11) val result = user match { case User(\"zhangsan\", 11) =&gt; \"yes\" case _ =&gt; \"no\" } println(result) } } è¾“å‡º----------------------------------------- yes ç®€åŒ–å†™æ³•ï¼š case class User(val name: String, val age: Int) object TestMatchUnapply { def main(args: Array[String]): Unit = { val user: User = User(\"zhangsan\", 11) val result = user match { case User(\"zhangsan\", 11) =&gt; \"yes\" case _ =&gt; \"no\" } println(result) } } 4ã€å˜é‡å£°æ˜ä¸­çš„æ¨¡å¼åŒ¹é…package com.kk1.demo7 object TestMatchCase extends App { case class Person(name: String, age: Int) val (x, y) = (1, 2) println(s\"x=$x,y=$y\") val Array(first, second, _*) = Array(1, 7, 2, 9) println(s\"first=$first,second=$second\") val Person(name, age) = Person(\"zhangsan\", 16) println(s\"name=$name,age=$age\") } è¾“å‡º----------------------------------------- x=1,y=2 first=1,second=7 name=zhangsan,age=16 5ã€for è¡¨è¾¾å¼ä¸­çš„æ¨¡å¼åŒ¹é… val map = Map(\"A\" -&gt; 1, \"B\" -&gt; 0, \"C\" -&gt; 3) for ((k, v) &lt;- map) { //ç›´æ¥å°† map ä¸­çš„ k-v éå†å‡ºæ¥ println(k + \" -&gt; \" + v) //3 ä¸ª } println(\"----------------------\") //éå† value=0 çš„ k-v ,å¦‚æœ v ä¸æ˜¯ 0,è¿‡æ»¤ for ((k, 0) &lt;- map) { println(k + \" --&gt; \" + 0) // B-&gt;0 } println(\"----------------------\") //if v == 0 æ˜¯ä¸€ä¸ªè¿‡æ»¤çš„æ¡ä»¶ for ((k, v) &lt;- map if v &gt;= 1) { println(k + \" ---&gt; \" + v) // A-&gt;1 å’Œ c-&gt;33 } è¾“å‡º----------------------------------------- A -&gt; 1 B -&gt; 0 C -&gt; 3 ---------------------- B --&gt; 0 ---------------------- A ---&gt; 1 C ---&gt; 3 å…«ã€å¼‚å¸¸è¯­æ³•å¤„ç†ä¸Šå’Œ Java ç±»ä¼¼ï¼Œä½†æ˜¯åˆä¸å°½ç›¸åŒ try { var n = 10 / 0 } catch { case ex: ArithmeticException =&gt; { // å‘ç”Ÿç®—æœ¯å¼‚å¸¸ println(\"å‘ç”Ÿç®—æœ¯å¼‚å¸¸\") ex.printStackTrace() } case ex: Exception =&gt; { // å¯¹å¼‚å¸¸å¤„ç† println(\"å‘ç”Ÿäº†å¼‚å¸¸ 1\") println(\"å‘ç”Ÿäº†å¼‚å¸¸ 2\") } } finally { println(\"finally\") } è¾“å‡º----------------------------------------- å‘ç”Ÿç®—æœ¯å¼‚å¸¸ finally java.lang.ArithmeticException: / by zero at com.kk1.demo7.TestMatchCase$.delayedEndpoint$com$kk1$demo7$TestMatchCase$1(TestMatchCase.scala:6) ã€‚ã€‚ã€‚ã€‚ã€‚ ä¸ç®¡æœ‰æ²¡æœ‰å¼‚å¸¸æ•è·ï¼Œéƒ½ä¼šæ‰§è¡Œ finallyï¼Œå› æ­¤é€šå¸¸å¯ä»¥åœ¨ finally ä»£ç å—ä¸­é‡Šæ”¾èµ„æº å¯ä»¥æœ‰å¤šä¸ª catchï¼Œåˆ†åˆ«æ•è·å¯¹åº”çš„å¼‚å¸¸ï¼Œè¿™æ—¶éœ€è¦æŠŠèŒƒå›´å°çš„å¼‚å¸¸ç±»å†™åœ¨å‰é¢ï¼Œ æŠŠèŒƒå›´å¤§çš„å¼‚å¸¸ç±»å†™åœ¨åé¢ï¼Œå¦åˆ™ç¼–è¯‘é”™è¯¯ Scala æ²¡æœ‰ â€œcheckedï¼ˆç¼–è¯‘æœŸï¼‰â€å¼‚å¸¸ ç”¨ throw å…³é”®å­—ï¼ŒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ã€‚æ‰€æœ‰å¼‚å¸¸éƒ½æ˜¯ Throwable çš„å­ç±»å‹ã€‚throw è¡¨ è¾¾å¼æ˜¯æœ‰ç±»å‹çš„ï¼Œå°±æ˜¯ Nothingï¼Œå› ä¸º Nothing æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ï¼Œæ‰€ä»¥ throw è¡¨è¾¾å¼å¯ä»¥ç”¨åœ¨éœ€è¦ç±»å‹çš„åœ°æ–¹ def test():Nothing = { throw new Exception(\"ä¸å¯¹\") } java æä¾›äº† throws å…³é”®å­—æ¥å£°æ˜å¼‚å¸¸ã€‚å¯ä»¥ä½¿ç”¨æ–¹æ³•å®šä¹‰å£°æ˜å¼‚å¸¸ã€‚å®ƒå‘è°ƒç”¨è€…å‡½æ•°æä¾›äº†æ­¤æ–¹æ³•å¯èƒ½å¼•å‘æ­¤å¼‚å¸¸çš„ä¿¡æ¯ã€‚å®ƒæœ‰åŠ©äºè°ƒç”¨å‡½æ•°å¤„ç†å¹¶å°†è¯¥ä»£ç åŒ…å«åœ¨ try-catch å—ä¸­ï¼Œä»¥é¿å…ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ã€‚åœ¨ Scala ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ throws æ³¨è§£æ¥å£°æ˜å¼‚å¸¸ def main(args: Array[String]): Unit = { f11() } @throws(classOf[NumberFormatException]) def f11() = { \"abc\".toInt } è¾“å‡º----------------------------------------- Exception in thread \"main\" java.lang.NumberFormatException: For input string: \"abc\" ã€‚ã€‚ã€‚ã€‚ã€‚ ä¹ã€éšå¼è½¬æ¢å½“ç¼–è¯‘å™¨ç¬¬ä¸€æ¬¡ç¼–è¯‘å¤±è´¥çš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰çš„ç¯å¢ƒä¸­æŸ¥æ‰¾èƒ½è®©ä»£ç ç¼–è¯‘é€šè¿‡çš„æ–¹æ³•ï¼Œç”¨äºå°†ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œå®ç°äºŒæ¬¡ç¼–è¯‘ 1ã€éšå¼å‡½æ•°å£°æ˜ï¼šimplicit è¯´æ˜ï¼šéšå¼è½¬æ¢å¯ä»¥åœ¨ä¸ä¿®æ”¹ä»»ä½•ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ‰©å±•æŸä¸ªç±»çš„åŠŸèƒ½ éœ€æ±‚ï¼šé€šè¿‡éšå¼è½¬åŒ–ä¸º Int ç±»å‹å¢åŠ æ–¹æ³• package com.kk.demo7 class MyRichInt(val self: Int) { def myMax(i: Int): Int = { if (self &lt; i) i else self } def myMin(i: Int): Int = { if (self &lt; i) self else i } } object TestImplicitFunction { // ä½¿ç”¨ implicit å…³é”®å­—å£°æ˜çš„å‡½æ•°ç§°ä¹‹ä¸ºéšå¼å‡½æ•° implicit def convert(arg: Int): MyRichInt = { new MyRichInt(arg) } def main(args: Array[String]): Unit = { // å½“æƒ³è°ƒç”¨å¯¹è±¡åŠŸèƒ½æ—¶ï¼Œå¦‚æœç¼–è¯‘é”™è¯¯ï¼Œ // é‚£ä¹ˆç¼–è¯‘å™¨ä¼šå°è¯•åœ¨å½“å‰ä½œç”¨åŸŸèŒƒå›´å†…æŸ¥æ‰¾èƒ½è°ƒç”¨å¯¹åº”åŠŸèƒ½çš„è½¬æ¢è§„åˆ™ï¼Œ // è¿™ä¸ªè°ƒç”¨è¿‡ç¨‹æ˜¯ç”±ç¼–è¯‘å™¨å®Œæˆçš„ï¼Œ // æ‰€ä»¥ç§°ä¹‹ä¸ºéšå¼è½¬æ¢ã€‚ ä¹Ÿç§°ä¹‹ä¸ºè‡ªåŠ¨è½¬æ¢ println(2.myMax(6)) } } è¾“å‡º----------------------------------------- 6 2ã€éšå¼å‚æ•°æ™®é€šæ–¹æ³•æˆ–è€…å‡½æ•°ä¸­çš„å‚æ•°å¯ä»¥é€šè¿‡ implicit å…³é”®å­—å£°æ˜ä¸ºéšå¼å‚æ•°ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œ å°±å¯ä»¥ä¼ å…¥è¯¥å‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç›¸åº”çš„ä½œç”¨åŸŸå¯»æ‰¾ç¬¦åˆæ¡ä»¶çš„éšå¼å€¼ åŒä¸€ä¸ªä½œç”¨åŸŸä¸­ï¼Œç›¸åŒç±»å‹çš„éšå¼å€¼åªèƒ½æœ‰ä¸€ä¸ª ç¼–è¯‘å™¨æŒ‰ç…§éšå¼å‚æ•°çš„ç±»å‹å»å¯»æ‰¾å¯¹åº”ç±»å‹çš„éšå¼å€¼ï¼Œä¸éšå¼å€¼çš„åç§°æ— å…³ éšå¼å‚æ•°ä¼˜å…ˆäºé»˜è®¤å‚æ•° object TestImplicitParameter { implicit val str: String = \"hello world!\" def hello(implicit arg: String = \"good bey world!\"): Unit = { println(arg) } def main(args: Array[String]): Unit = { hello } } è¾“å‡º----------------------------------------- hello world! 3ã€éšå¼ç±»åœ¨ Scala2.10 åæä¾›äº†éšå¼ç±»ï¼Œå¯ä»¥ä½¿ç”¨ implicit å£°æ˜ç±»ï¼Œéšå¼ç±»çš„éå¸¸å¼ºå¤§ï¼ŒåŒæ ·å¯ä»¥æ‰©å±•ç±»çš„åŠŸèƒ½ï¼Œåœ¨é›†åˆä¸­éšå¼ç±»ä¼šå‘æŒ¥é‡è¦çš„ä½œç”¨ å…¶æ‰€å¸¦çš„æ„é€ å‚æ•°æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ª éšå¼ç±»å¿…é¡»è¢«å®šä¹‰åœ¨â€œç±»â€æˆ–â€œä¼´ç”Ÿå¯¹è±¡â€æˆ–â€œåŒ…å¯¹è±¡â€é‡Œï¼Œå³éšå¼ç±»ä¸èƒ½æ˜¯é¡¶çº§çš„ object TestImplicitClass { implicit class MyRichInt(arg: Int) { def myMax(i: Int): Int = { if (arg &lt; i) i else arg } def myMin(i: Int) = { if (arg &lt; i) arg else i } } def main(args: Array[String]): Unit = { println(1.myMax(3)) } } åã€æ³›å‹1ã€åå˜å’Œé€†å˜1ã€è¯­æ³• class MyList[+T]{ //åå˜ } class MyList[-T]{ //é€†å˜ } class MyList[T] //ä¸å˜ 2ã€è¯´æ˜ åå˜ï¼šSon æ˜¯ Father çš„å­ç±»ï¼Œåˆ™ MyList[Son] ä¹Ÿä½œä¸º MyList[Father]çš„â€œå­ç±»â€ é€†å˜ï¼šSon æ˜¯ Father çš„å­ç±»ï¼Œåˆ™ MyList[Son]ä½œä¸º MyList[Father]çš„â€œçˆ¶ç±»â€ ä¸å˜ï¼šSon æ˜¯ Father çš„å­ç±»ï¼Œåˆ™ MyList[Father]ä¸ MyList[Son]â€œæ— çˆ¶å­å…³ç³»â€ //æ³›å‹æ¨¡æ¿ // class MyList&lt;T&gt;{} //ä¸å˜ // class MyList[T]{} //åå˜ class MyList[+T] {} //é€†å˜ // class MyList[-T]{} class Parent {} class Child extends Parent {} class SubChild extends Child {} object Scala_TestGeneric { def main(args: Array[String]): Unit = { var s: MyList[Child] = new MyList[SubChild] } } 2ã€æ³›å‹ä¸Šä¸‹é™1ã€è¯­æ³• Class PersonList[T &lt;: Person]{ //æ³›å‹ä¸Šé™ } Class PersonList[T &gt;: Person]{ //æ³›å‹ä¸‹é™ } 2ã€è¯´æ˜ï¼šæ³›å‹çš„ä¸Šä¸‹é™çš„ä½œç”¨æ˜¯å¯¹ä¼ å…¥çš„æ³›å‹è¿›è¡Œé™å®š class Parent {} class Child extends Parent {} class SubChild extends Child {} object Scala_TestGeneric { def main(args: Array[String]): Unit = { test(classOf[SubChild]) //test[Child](new SubChild) } //æ³›å‹é€šé…ç¬¦ä¹‹ä¸Šé™ def test[A &lt;: Child](a:Class[A]): Unit ={ println(a) } //æ³›å‹é€šé…ç¬¦ä¹‹ä¸‹é™ // def test[A &gt;: Child](a:Class[A]): Unit ={ // println(a) // } //æ³›å‹é€šé…ç¬¦ä¹‹ä¸‹é™ å½¢å¼æ‰©å±• def test[A &gt;: Child](a:A): Unit ={ println(a.getClass.getName) } } è¾“å‡º----------------------------------------- class com.kk.demo7.SubChild 3ã€ä¸Šä¸‹æ–‡é™å®š1ã€è¯­æ³• def f[A : B](a: A) = println(a) //ç­‰åŒäº def f[A](a:A)(implicit arg:B[A])=println(a) 2ã€è¯´æ˜ ä¸Šä¸‹æ–‡é™å®šæ˜¯å°†æ³›å‹å’Œéšå¼è½¬æ¢çš„ç»“åˆäº§ç‰©ï¼Œä»¥ä¸‹ä¸¤è€…åŠŸèƒ½ç›¸åŒï¼Œä½¿ç”¨ä¸Šä¸‹æ–‡é™å®š[A : Ordering]ä¹‹åï¼Œæ–¹æ³•å†…æ— æ³•ä½¿ç”¨éšå¼å‚æ•°åè°ƒç”¨éšå¼å‚æ•°ï¼Œéœ€è¦é€šè¿‡ implicitly[Ordering[A]] ï¼Œè·å–éšå¼å˜é‡ï¼Œå¦‚æœæ­¤æ—¶æ— æ³•æŸ¥æ‰¾åˆ°å¯¹åº”ç±»å‹çš„éšå¼å˜é‡ï¼Œä¼šå‘ç”Ÿå‡ºé”™è¯¯ def f[A:Ordering](a:A,b:A) =implicitly[Ordering[A]].compare(a,b) def f[A](a: A, b: A)(implicit ord: Ordering[A]) = ord.compare(a, b) å‚è€ƒæ–‡ç«  â†“springbootæ··åˆåŒè¯­è¨€å¼€å‘é—®é¢˜ï¼š https://www.cnblogs.com/zlslch/p/8553958.html https://www.jianshu.com/p/6d241e5dbe7e https://blog.csdn.net/u014331143/article/details/127609845 SpringMVCå‚è€ƒï¼šhttps://vimsky.com/examples/detail/scala-class-org.springframework.beans.factory.annotation.Autowired.html é›†åˆï¼š https://blog.csdn.net/chaohui2638457321/article/details/121904744 https://blog.csdn.net/shuyv/article/details/121254677","categories":[{"name":"è®¡ç®—æœºè¯­è¨€","slug":"è®¡ç®—æœºè¯­è¨€","permalink":"https://mykkto.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"https://mykkto.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"},{"name":"spark","slug":"spark","permalink":"https://mykkto.github.io/tags/spark/"},{"name":"scala","slug":"scala","permalink":"https://mykkto.github.io/tags/scala/"}],"author":"mykk"},{"title":"é¢è¯•é¢˜-03(å…³äºCloud)","slug":"05-é¢è¯•é¢˜/02-å¤§å‚é¢è¯•é¢˜/é¢è¯•é¢˜_03","date":"2023-02-15T14:28:51.000Z","updated":"2023-12-10T13:25:12.074Z","comments":true,"path":"posts/45f5cab5.html","link":"","permalink":"https://mykkto.github.io/posts/45f5cab5.html","excerpt":"","text":"å‰è¨€ï¼šé¸£è°¢ç»™ç«™é•¿æŠ•ç¨¿é—®é¢˜çš„åŒè¡Œæœ‹å‹ï¼Œå±…å¤šéƒ½æ˜¯å°ä¼™ä¼´é¢è¯•è¢«é—®åˆ°çš„é—®é¢˜ï¼Œä»¥åŠæ‰©å±• æœ¬ç« é’ˆå¯¹ ä¸­é«˜å¼€å²—ä½é¢˜ç›®ç”„é€‰ï¼Œå¦‚æœ‰ä¸è¶³è¿˜è¯·è¯„è®ºåŒºæŒ‡æ•™ï¼Œæ„Ÿè°¢ï¼ ç›®å½•ï¼š ä½ æœ‰è¿‡SpringCloud ï¼Ÿ æ³¨å†Œä¸­å¿ƒ é‚£å‡ æ¬¾ï¼Ÿå¯¹æ¯”ï¼Ÿ æœåŠ¡å‘ç°æµç¨‹ï¼ŒåŸç†ï¼Ÿ ç†”æ–­å™¨ é‚£å‡ æ¬¾ï¼Ÿå¯¹æ¯”ï¼Ÿ MySQL æ‰§è¡Œæµç¨‹ï¼ˆ5.7 ï¼‰ ä¸€ã€ä½ æœ‰è¿‡SpringCloud ï¼Ÿå½“ç„¶ï¼Œå¦‚æœæŒ‰ç…§å‚å•†åˆ†ä¸ºä¸¤ç§ï¼šNetflix å’Œ alibaba ï¼›å¦‚æœæŒ‰ç…§æŠ€æœ¯æ ˆåˆ™åˆ†ä¸ºï¼Œæ³¨å†Œä¸­å¿ƒã€é…ç½®ä¸­å¿ƒã€ç½‘å…³ã€ç†”æ–­å™¨ã€æœåŠ¡è°ƒç”¨ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€é“¾è·¯è¿½è¸ªç­‰ï¼Œä¸è¿‡æ ¸å¿ƒçš„ç»„ä»¶æœ‰äº”å¤§ï¼Œcloudæ˜¯ eureka,feign,ribbon,hystrix,zuulï¼Œalibbaba:nacos,sentinel,gateway. ç¤¾åŒºæ´»è·ƒï¼Œä½ åœ¨ç”Ÿäº§ä¸Šé‡åˆ°çš„é—®é¢˜ä¸æ˜¯ç¬¬ä¸€ä¸ªé‡åˆ°ï¼Œæ•™ç¨‹å¤š 1ã€å¸¸è§„é¢˜ï¼ˆæ”¾æ¾ç‰ˆï¼‰1.Nacoså¦‚ä½•æ”¯æ’‘é˜¿é‡Œå†…éƒ¨æ•°åä¸‡æœåŠ¡æ³¨å†Œå‹åŠ›Nacoså†…éƒ¨æ¥æ”¶åˆ°æ³¨å†Œçš„è¯·æ±‚æ—¶ï¼Œä¸ä¼šç«‹å³å†™æ•°æ®ï¼Œè€Œæ˜¯å°†æœåŠ¡æ³¨å†Œçš„ä»»åŠ¡æ”¾å…¥ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—å°±ç«‹å³å“åº”ç»™å®¢æˆ·ç«¯ã€‚ç„¶ååˆ©ç”¨çº¿ç¨‹æ± è¯»å–é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå¼‚æ­¥æ¥å®Œæˆå®ä¾‹æ›´æ–°ï¼Œä»è€Œæé«˜å¹¶å‘å†™èƒ½åŠ›ã€‚ 2.Nacoså¦‚ä½•é¿å…å¹¶å‘è¯»å†™å†²çªé—®é¢˜Nacosåœ¨æ›´æ–°å®ä¾‹åˆ—è¡¨æ—¶ï¼Œä¼šé‡‡ç”¨CopyOnWriteæŠ€æœ¯ï¼Œé¦–å…ˆå°†æ—§çš„å®ä¾‹åˆ—è¡¨æ‹·è´ä¸€ä»½ï¼Œç„¶åæ›´æ–°æ‹·è´çš„å®ä¾‹åˆ—è¡¨ï¼Œå†ç”¨æ›´æ–°åçš„å®ä¾‹åˆ—è¡¨æ¥è¦†ç›–æ—§çš„å®ä¾‹åˆ—è¡¨ã€‚ è¿™æ ·åœ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¸ä¼šå¯¹è¯»å®ä¾‹åˆ—è¡¨çš„è¯·æ±‚äº§ç”Ÿå½±å“ï¼Œä¹Ÿä¸ä¼šå‡ºç°è„è¯»é—®é¢˜äº†ã€‚ 3.Nacosä¸Eurekaçš„åŒºåˆ«æœ‰å“ªäº› å®ä¾‹ç±»å‹ï¼šNacosçš„å®ä¾‹æœ‰æ°¸ä¹…å’Œä¸´æ—¶å®ä¾‹ä¹‹åˆ†ï¼›è€ŒEurekaåªæ”¯æŒä¸´æ—¶å®ä¾‹ å¥åº·æ£€æµ‹ï¼šNacoså¯¹ä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼æ£€æµ‹ï¼Œå¯¹æ°¸ä¹…å®ä¾‹é‡‡ç”¨ä¸»åŠ¨è¯·æ±‚æ¥æ£€æµ‹ï¼›Eurekaåªæ”¯æŒå¿ƒè·³æ¨¡å¼ æœåŠ¡å‘ç°ï¼šNacosæ”¯æŒå®šæ—¶æ‹‰å–å’Œè®¢é˜…æ¨é€ä¸¤ç§æ¨¡å¼ï¼›Eurekaåªæ”¯æŒå®šæ—¶æ‹‰å–æ¨¡å¼ CAPç†è®ºï¼šeurekaåªæ”¯æŒAPï¼Œnacosæ”¯æŒCPå’ŒAPä¸¤ç§ nacosæ˜¯æ ¹æ®é…ç½®è¯†åˆ«CPæˆ–APæ¨¡å¼,å¦‚æœæ³¨å†ŒNacosçš„clientèŠ‚ç‚¹æ³¨å†Œæ—¶æ˜¯ephemeral=trueå³ä¸ºä¸´æ—¶èŠ‚ç‚¹,é‚£ä¹ˆNaocsé›†ç¾¤å¯¹è¿™ä¸ªclientèŠ‚ç‚¹æ•ˆæœå°±æ˜¯AP,åä¹‹åˆ™æ˜¯CP,å³ä¸æ˜¯ä¸´æ—¶èŠ‚ç‚¹ #falseä¸ºæ°¸ä¹…å®ä¾‹ï¼Œtrueè¡¨ç¤ºä¸´æ—¶å®ä¾‹å¼€å¯ï¼Œæ³¨å†Œä¸ºä¸´æ—¶å®ä¾‹ spring.cloud.nacos.discovery.ephemeral=true è¿æ¥æ–¹å¼ï¼š nacosä½¿ç”¨çš„æ˜¯nettyå’ŒæœåŠ¡ç›´æ¥è¿›è¡Œè¿æ¥,å±äºé•¿è¿æ¥ eurekaæ˜¯ä½¿ç”¨å®šæ—¶å‘é€å’ŒæœåŠ¡è¿›è¡Œè”ç³»,å±äºçŸ­è¿æ¥ 4.Sentinelçš„é™æµä¸Gatewayçš„é™æµæœ‰ä»€ä¹ˆå·®åˆ«é™æµç®—æ³•å¸¸è§çš„æœ‰ä¸‰ç§å®ç°ï¼šæ»‘åŠ¨æ—¶é—´çª—å£ã€ä»¤ç‰Œæ¡¶ç®—æ³•ã€æ¼æ¡¶ç®—æ³•ã€‚Gatewayåˆ™é‡‡ç”¨äº†åŸºäºRediså®ç°çš„ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚ è€ŒSentinelå†…éƒ¨å´æ¯”è¾ƒå¤æ‚ï¼š é»˜è®¤é™æµæ¨¡å¼æ˜¯åŸºäºæ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³• æ’é˜Ÿç­‰å¾…çš„é™æµæ¨¡å¼åˆ™åŸºäºæ¼æ¡¶ç®—æ³• è€Œçƒ­ç‚¹å‚æ•°é™æµåˆ™æ˜¯åŸºäºä»¤ç‰Œæ¡¶ç®—æ³• 5.Sentinelçš„çº¿ç¨‹éš”ç¦»ä¸Hystixçš„çº¿ç¨‹éš”ç¦»æœ‰ä»€ä¹ˆå·®åˆ«Hystixé»˜è®¤æ˜¯åŸºäºçº¿ç¨‹æ± å®ç°çš„çº¿ç¨‹éš”ç¦»ï¼Œæ¯ä¸€ä¸ªè¢«éš”ç¦»çš„ä¸šåŠ¡éƒ½è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹è¿‡å¤šä¼šå¸¦æ¥é¢å¤–çš„CPUå¼€é”€ï¼Œæ€§èƒ½ä¸€èˆ¬ï¼Œä½†æ˜¯éš”ç¦»æ€§æ›´å¼ºã€‚ Sentinelæ˜¯åŸºäºä¿¡å·é‡ï¼ˆè®¡æ•°å™¨ï¼‰å®ç°çš„çº¿ç¨‹éš”ç¦»ï¼Œä¸ç”¨åˆ›å»ºçº¿ç¨‹æ± ï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œä½†æ˜¯éš”ç¦»æ€§ä¸€èˆ¬ã€‚ 1ã€æ³¨å†Œä¸­å¿ƒ ====Eureka=====åŒ…å«2ä¸ªç»„ä»¶ï¼šeureka server å’Œeureka client æ³¨å†Œä¸­å¿ƒï¼ŒåŒ…å«äº†æœåŠ¡å‘ç°ã€æ²»ç†ç­‰åŠŸèƒ½ã€‚@EnableEurekaServerï¼Œä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼› @EnableEurekaClientï¼Œä½œä¸ºæœåŠ¡çš„æä¾›è€…ã€æˆ–æ¶ˆè´¹è€…ã€‚ä¸‹é¢åˆ†æä¸‹æœåŠ¡å‘ç°å’Œæ²»ç†ã€‚ 1ã€æ³¨å†ŒæœåŠ¡äºå‘ç°æµç¨‹ï¼ˆeurekaï¼‰ å½“EurekaClientå¯åŠ¨åï¼Œé¦–å…ˆä¼šæ‰§è¡ŒæœåŠ¡æ³¨å†Œã€‚ EurekaClientå°†æœåŠ¡ä¿¡æ¯å°è£…æˆInstanceInfoå¯¹è±¡ï¼Œé€šè¿‡EurekaHttpClientè°ƒç”¨registeræ–¹æ³•å‘é€POSTè¯·æ±‚æ‰§è¡ŒæœåŠ¡æ³¨å†Œ EurekaServeræä¾›äº†åŸºäºJerseyçš„Resté£æ ¼çš„æ¥å£ï¼Œåœ¨ApplicationResourceç±»ä¸­æä¾›äº†addInstanceæ–¹æ³•ç”¨æ¥æ¥æ”¶æ³¨å†Œä¿¡æ¯ã€‚å¦‚æœæ³¨å†ŒæœåŠ¡å™¨ä¿¡æ¯é€šè¿‡æ ¡éªŒï¼Œå°†æœåŠ¡ä¿¡æ¯ä¿å­˜è‡³æœ¬åœ°æ³¨å†Œè¡¨ã€‚æ•°æ®ç»“æ„ä¸ºåŒå±‚ConcurrentHashMapï¼Œå¤–å±‚mapï¼škeyæ˜¯åº”ç”¨åï¼Œå†…å±‚mapï¼škeyæ˜¯åº”ç”¨å®ä¾‹ä¿¡æ¯ç¼–å·ï¼Œvalueæ˜¯InstanceInfo EurekaClientæ¥æ”¶å¹¶è§£ææ³¨å†Œç»“æœï¼Œåˆ¤æ–­httpResponseçš„statusCodeï¼Œå¦‚æœæ˜¯204åˆ™ä»£è¡¨æ³¨å†ŒæˆåŠŸ è°ƒç”¨replicateToPeersæ–¹æ³•å°†æ­¤æ¬¡æ³¨å†Œä¿¡æ¯å¤åˆ¶åˆ°å¯¹ç­‰çš„EurekaèŠ‚ç‚¹ å®¢æˆ·ç«¯æ³¨å†Œï¼šEurekaå®¢æˆ·ç«¯åœ¨å¯åŠ¨æ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªå¿ƒè·³çš„å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯ä¼šå¯¹å®¢æˆ·ç«¯å¿ƒè·³åšå‡ºå“åº”ï¼Œå¦‚æœå“åº”çŠ¶æ€ç ä¸º404æ—¶ï¼Œè¡¨ç¤ºæœåŠ¡ç«¯æ²¡æœ‰è¯¥å®¢æˆ·ç«¯çš„æœåŠ¡ä¿¡æ¯ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯åˆ™ä¼šå‘æœåŠ¡ç«¯å‘é€æ³¨å†Œè¯·æ±‚ã€‚ æœåŠ¡ç«¯å¦‚ä½•ä¿å­˜å®¢æˆ·ç«¯æ³¨å†Œä¿¡æ¯ï¼šå®¢æˆ·ç«¯é€šè¿‡Jerseyæ¡†æ¶ï¼Œå°†è‡ªå·±çš„æ³¨å†Œä¿¡æ¯å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¿å­˜åœ¨ä¸€ä¸ªConcurrentHashMapå¯¹è±¡ä¸­ã€‚ å®¢æˆ·ç«¯å¦‚ä½•æ‹‰å–æœåŠ¡ç«¯å·²ä¿å­˜çš„æœåŠ¡ä¿¡æ¯ï¼šå®¢æˆ·ç«¯é€šè¿‡ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å®šæ—¶å‘æœåŠ¡ç«¯æ‹‰å–ä¿¡æ¯ï¼Œæ¯æ¬¡æ‹‰å–ååˆ·æ–°æœ¬åœ°å·²ä¿å­˜çš„ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨æ—¶ç›´æ¥ä»æœ¬åœ°è·å–ã€‚ 2ã€Eurekaå¿ƒè·³æœºåˆ¶å¿ƒè·³æœºåˆ¶ å®¢æˆ·ç«¯æ¯éš”30sæƒ³æœåŠ¡ç«¯å‘é€ä¸€æ¬¡å¿ƒè·³ï¼Œå‘Šè¯‰æœåŠ¡ç«¯è‡ªå·±è¿˜æ´»ç€ã€‚ æœåŠ¡å‰”é™¤æœºåˆ¶ å¦‚æœå¼€äº†è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å®¢æˆ·ç«¯åŒ…æ‹¬æ²¡æœ‰é•¿æ—¶é—´æ²¡æœ‰å‘é€å¿ƒè·³çš„å®¢æˆ·ç«¯éƒ½ä¸ä¼šè¢«å‰”é™¤ã€‚æ²¡å¼€è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œæ³¨å†Œåˆ°eurekaçš„æœåŠ¡å¯èƒ½ç”±äºå†…å­˜æº¢å‡ºæˆ–ç½‘ç»œæ•…éšœç­‰åŸå› ä½¿å¾—æœåŠ¡ä¸èƒ½æ­£å¸¸çš„å·¥ä½œï¼Œè€ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒå¹¶æœªæ”¶åˆ°â€œæœåŠ¡ä¸‹çº¿â€çš„è¯·æ±‚ã€‚æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ¨å¯åŠ¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œé»˜è®¤æ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤ä¸º60ç§’ï¼‰å°†å½“å‰æ¸…å•ä¸­è¶…æ—¶ï¼ˆé»˜è®¤ä¸º90ç§’ï¼‰æ²¡æœ‰ç»­çº¦çš„æœåŠ¡å‰”é™¤ï¼Œè¿™ä¸ªæ“ä½œè¢«ç§°ä¸ºå¤±æ•ˆå‰”é™¤ Eurekaä¸ºä»€ä¹ˆè¦é‡‡ç”¨è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„CAPç†è®ºä¸­ï¼ŒEurekaé‡‡ç”¨çš„APï¼Œä¹Ÿå°±æ˜¯Eureakä¿è¯äº†æœåŠ¡çš„å¯ç”¨æ€§ï¼ˆAï¼‰ï¼Œè€Œèˆå¼ƒäº†æ•°æ®çš„ä¸€è‡´æ€§ï¼ˆCï¼‰ã€‚å½“ç½‘ç»œå‘ç”Ÿåˆ†åŒºæ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šè®¯å°†ä¼šç»ˆæ­¢ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯åœ¨ä¸€å®šçš„æ—¶é—´å†…å°†æ”¶ä¸åˆ°å¤§éƒ¨åˆ†çš„å®¢æˆ·ç«¯çš„ä¸€ä¸ªå¿ƒè·³ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™å°†è¿™äº›æ”¶ä¸åˆ°å¿ƒè·³ 3ã€Eurekaå®šæ—¶ä»»åŠ¡æ‹‰å–æœåŠ¡å™¨æ³¨å†Œå®ä¾‹ è¯¥ä»»åŠ¡é€šè¿‡ ScheduledExecutorService æ¥å®ç°ä»»åŠ¡è°ƒåº¦ï¼Œæ‰§è¡Œå‘¨æœŸé»˜è®¤ä¸º 60 ç§’ä¸€æ¬¡ è·å–çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œå…¨é‡è·å–å’Œå¢é‡è·å–ã€‚ç¬¬ä¸€æ¬¡å…¨é‡è·å–ï¼Œåç»­å¢é‡è·å–ï¼›è·å–åˆ°æœåŠ¡å™¨æ³¨å†Œå®ä¾‹ä¿¡æ¯åï¼Œä¿å­˜ã€æˆ–æ›´æ–°åˆ°æœ¬åœ° ç»­çº¦è¯¥ä»»åŠ¡é€šè¿‡ ScheduledExecutorService æ¥å®ç°ä»»åŠ¡è°ƒåº¦ï¼Œé»˜è®¤å‘¨æœŸä¸º 30 ç§’ä¸€æ¬¡ï¼Œé€šè¿‡ renew() æ–¹æ³•å‘èµ·ç»­çº¦è¯·æ±‚ã€‚å°† AppNameã€AppIdã€ä»¥åŠInstanceInfoä½œä¸ºå‚æ•°ï¼Œé€šè¿‡EurekaHttpClientå‘é€Httpè¯·æ±‚ EurekaServer é€šè¿‡ renewLease() æ–¹æ³•æ¥æ”¶ç»­çº¦è¯·æ±‚é¦–å…ˆæ ¹æ®AppNameä»æ³¨å†Œè¡¨ä¸­è·å–å¯¹åº”çš„æœåŠ¡ä¿¡æ¯ï¼Œå¹¶æ›´æ–°ä¸€äº›å±æ€§å¦‚renewsLastMinã€lastUpdateTimestampEurekaServer è¿”å›ç»“æœï¼Œ200 æˆ–è€… 404ï¼ŒEurekaClient æ¥æ”¶ç»­çº¦ç»“æœï¼›å¦‚æœæ˜¯ 404 åˆ™å‘èµ·ä¸€æ¬¡ register è¯·æ±‚ï¼›å¦‚æœæ˜¯ 200 åˆ™è¡¨ç¤ºç»­çº¦æˆåŠŸ =====Nacos=====1ã€Nacos ä¸­çš„ä¿æŠ¤é˜ˆå€¼ä½œç”¨å‡å¦‚ç°åœ¨æœ‰ä¸€ä¸ªæœåŠ¡ï¼Œæœ¬æ¥æœ‰10ä¸ªå®ä¾‹ï¼Œä½†æ˜¯ç°åœ¨æŒ‚æ‰äº†8ä¸ªï¼Œå‰©ä¸‹2ä¸ªæ­£å¸¸å®ä¾‹ï¼Œæ­¤æ—¶æœ¬æ¥ç”±10ä¸ªå®ä¾‹å¤„ç†çš„æµé‡ï¼Œå°±å…¨éƒ¨äº¤ç»™è¿™ä¸ªä¸¤ä¸ªæ­£å¸¸å®ä¾‹æ¥å¤„ç†äº†ï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªå®ä¾‹å¾ˆæœ‰å¯èƒ½æ˜¯å¤„ç†ä¸è¿‡æ¥çš„ï¼Œæœ€ç»ˆå¯¼è‡´è¢«å‹å®ï¼Œä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼› Nacosæä¾›äº†ä¿æŠ¤é˜ˆå€¼è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æŸä¸ªæœåŠ¡è®¾ç½®ä¸€ä¸ª0-1çš„é˜ˆå€¼ï¼Œæ¯”å¦‚0.5ï¼Œé‚£å°±è¡¨ç¤ºï¼Œä¸€æ—¦å®ä¾‹ä¸­åªå‰©ä¸‹ä¸€åŠçš„å¥åº·å®ä¾‹äº†ï¼Œæ¯”å¦‚10ä¸ªå®ä¾‹ï¼Œåªå‰©ä¸‹5ä¸ªå¥åº·å®ä¾‹äº†ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…åœ¨è¿›è¡ŒæœåŠ¡å‘ç°æ—¶ï¼Œåˆ™ä¼šæŠŠè¯¥æœåŠ¡çš„æ‰€æœ‰å®ä¾‹ï¼Œä¹ŸåŒ…æ‹¬ä¸å¥åº·çš„å®ä¾‹éƒ½æ‹‰å–åˆ°æœ¬åœ°ï¼Œç„¶åå†ä»æ‰€æœ‰å®ä¾‹ä¸­è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œé€‰å‡ºä¸€ä¸ªå®ä¾‹è¿›è¡Œè°ƒç”¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€‰å‡ºæ¥çš„å³å¯èƒ½æ˜¯ä¸€ä¸ªå¥åº·çš„å®ä¾‹ï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‚æ‰çš„å®ä¾‹ï¼Œä½†æ˜¯é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¾ˆå¥½çš„ä¿æŠ¤çš„å‰©ä¸‹çš„å¥åº·å®ä¾‹ï¼Œè‡³å°‘ä¿è¯äº†ä¸€éƒ¨åˆ†è¯·æ±‚èƒ½æ­£å¸¸çš„è®¿é—®ï¼Œè€Œä¸è‡³äºæ‰€æœ‰è¯·æ±‚éƒ½ä¸èƒ½æ­£å¸¸è®¿é—®ï¼Œè¿™å°±æ˜¯Nacosä¸­çš„ä¿æŠ¤é˜ˆå€¼ï¼ŒåŒæ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨Spring Cloud Tencentä¸­å«å…¨æ­»å…¨æ´»ã€‚ 2ã€Nacosä¸­çš„è´Ÿè½½å‡è¡¡Nacosçš„è´Ÿè½½å‡è¡¡æŒ‡çš„æ˜¯ï¼Œåœ¨è¿›è¡ŒæœåŠ¡å‘ç°æ—¶è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¼šæ ¹æ®æœåŠ¡åä»Nacosä¸­æ‹‰å–æ‰€æœ‰çš„å®ä¾‹ä¿¡æ¯ï¼Œæ‹‰å–å®ä¾‹æ—¶ï¼Œæ ¹æ®éšæœºç­–ç•¥åªæ‹‰å–åˆ°æ‰€æœ‰å®ä¾‹ä¸­çš„æŸä¸€ä¸ªï¼Œè¿™å°±æ˜¯Nacosä¸­çš„è´Ÿè½½å‡è¡¡ï¼Œå®ƒè·ŸRibbonçš„è´Ÿè½½å‡è¡¡å¹¶ä¸å†²çªï¼Œå¯ä»¥ç†è§£ä¸ºRibbonçš„è´Ÿè½½å‡è¡¡æ˜¯å‘ç”Ÿåœ¨Nacosçš„è´Ÿè½½å‡è¡¡ä¹‹åçš„ 3ã€Nacosçš„å°±è¿‘è®¿é—®æ˜¯ä»€ä¹ˆåœ¨Nacosä¸­ï¼Œä¸€ä¸ªæœåŠ¡å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥ç»™å®ä¾‹è®¾ç½®cluster-nameï¼Œå°±æ˜¯å¯ä»¥å†è¿›ä¸€æ­¥çš„ç»™æ‰€æœ‰å®ä¾‹åˆ’åˆ†é›†ç¾¤ï¼Œé‚£å¦‚æœç°åœ¨æŸä¸ªæœåŠ¡Aæƒ³è¦è°ƒç”¨æœåŠ¡Bï¼Œé‚£ä¹ˆNaocsä¼šçœ‹è°ƒç”¨æœåŠ¡Açš„å®ä¾‹æ˜¯å±äºå“ªä¸ªé›†ç¾¤çš„ï¼Œå¹¶ä¸”è°ƒç”¨æœåŠ¡Bæ—¶ï¼Œé‚£å°±ä¼šè°ƒç”¨åŒæ ·é›†ç¾¤ä¸‹çš„æœåŠ¡Bå®ä¾‹ï¼Œæ ¹æ®cluster-nameæ¥åˆ¤æ–­ä¸¤ä¸ªå®ä¾‹æ˜¯ä¸æ˜¯åŒä¸€ä¸ªé›†ç¾¤ï¼Œè¿™å°±æ˜¯Nacosçš„å°±è¿‘è®¿é—® 4ã€Nacosä¸­ä¿è¯çš„æ˜¯CPè¿˜æ˜¯APé€šå¸¸æˆ‘ä»¬è¯´ï¼ŒNacosæŠ€èƒ½ä¿è¯CPï¼Œä¹Ÿèƒ½ä¿è¯APï¼Œå…·ä½“çœ‹å¦‚ä½•é…ç½®ï¼Œä½†å…¶å®åªä¸è¿‡æ˜¯Nacosä¸­çš„æ³¨å†Œä¸­å¿ƒèƒ½ä¿è¯CPæˆ–APï¼ŒNacosä¸­çš„é…ç½®ä¸­å¿ƒå…¶å®æ²¡ä»€ä¹ˆCPæˆ–APï¼Œå› ä¸ºé…ç½®ä¸­å¿ƒçš„æ•°æ®æ˜¯å­˜åœ¨ä¸€ä¸ªMysqlä¸­çš„ï¼Œåªæœ‰æ³¨å†Œä¸­å¿ƒçš„æ•°æ®éœ€è¦è¿›è¡Œé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„åŒæ­¥ï¼Œä»è€Œæ¶‰åŠåˆ°æ˜¯CPè¿˜æ˜¯APï¼Œå¦‚æœæ³¨å†Œçš„èŠ‚ç‚¹æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±æ˜¯APï¼Œå¦‚æœæ˜¯éä¸´æ—¶èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±æ˜¯CPï¼Œé»˜è®¤æ˜¯ä¸´æ—¶èŠ‚ç‚¹ã€‚ 5ã€å¦‚ä½•ç†è§£Nacosä¸­çš„å‘½åç©ºé—´åœ¨Nacosä¸­ï¼Œä¸ç®¡æ˜¯é…ç½®è¿˜æ˜¯æœåŠ¡ï¼Œéƒ½æ˜¯å±äºæŸä¸€ä¸ªå‘½åç©ºé—´ä¸­çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯pulibcçš„ï¼Œå¯ä»¥åœ¨Nacosä¸­æ–°å¢å‘½åç©ºé—´ï¼Œä¹Ÿå°±ç›¸å½“äºå¼€è¾Ÿäº†å¦å¤–ä¸€å¥—å­˜æ”¾æœåŠ¡å’Œé…ç½®çš„åœ°æ–¹ï¼Œå‘½åç©ºé—´ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œå®Œå…¨ä¸å†²çªçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Nacosä¸­çš„å‘½åç©ºé—´æ¥å®ç°ä¸åŒç¯å¢ƒã€ä¸åŒç§Ÿæˆ·ä¹‹é—´çš„æœåŠ¡æ³¨å†Œå’Œé…ç½® 6ã€ä½ è§‰å¾—æ³¨å†Œä¸­å¿ƒåº”è¯¥æ˜¯CPè¿˜æ˜¯APå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ³¨å†Œä¸­å¿ƒåº”è¯¥æ˜¯APï¼›å¦‚æœæ³¨å†Œä¸­å¿ƒæ˜¯CPçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œå®ä¾‹æˆ–ç§»é™¤å®ä¾‹æ—¶ï¼Œéƒ½è¦ç­‰å¾…æ³¨å†Œä¸­å¿ƒé›†ç¾¤ä¸­çš„æ•°æ®è¾¾åˆ°ä¸€è‡´åï¼Œæ‰ç®—æ³¨å†Œæˆ–ç§»é™¤æˆåŠŸï¼Œè€Œè¿™æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œéšç€ä¸šåŠ¡åº”ç”¨è§„æ¨¡çš„å¢å¤§ï¼Œåº”ç”¨é¢‘ç¹çš„ä¸Šä¸‹çº¿ï¼Œä¼šå½±å“åˆ°æœåŠ¡å‘ç°çš„æ•ˆç‡ä»¥åŠæœåŠ¡è°ƒç”¨äº†ï¼› è€Œå¦‚æœæ³¨å†Œä¸­å¿ƒæ˜¯APçš„ï¼Œé‚£ä¹ˆæ³¨å†Œä¸­å¿ƒé›†ç¾¤ä¸ç®¡å‡ºç°äº†ä»€ä¹ˆæƒ…å†µï¼Œå°±ç®—é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´æ•°æ®å‡ºç°äº†ä¸ä¸€è‡´ï¼Œå¯¹äºä¸šåŠ¡åº”ç”¨è€Œè¨€ï¼Œå¯èƒ½æ‹‰å–åˆ°äº†ä¸€ä¸ªå·²ç»ä¸‹çº¿äº†çš„æœåŠ¡èŠ‚ç‚¹ï¼Œä½†æ˜¯å¾®æœåŠ¡æ¡†æ¶æˆ–ç»„ä»¶éƒ½æä¾›äº†æœåŠ¡å®¹é”™å’Œé‡è¯•åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚ è€Œå¦‚æœæ˜¯APï¼Œå¯¹äºæ³¨å†Œä¸­å¿ƒè€Œè¨€å°±ä¸éœ€è¦æ¶ˆè€—å¤ªå¤šå®æ—¶æ€§æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§äº†ï¼Œæ—¢ä¿è¯æœ€ç»ˆä¸€è‡´æ€§å°±å¯ä»¥äº†ï¼Œè¿™æ ·æ³¨å†Œä¸­å¿ƒçš„å‹åŠ›ä¼šå°ä¸€ç‚¹ï¼› Zookeeperï¼ˆCPï¼‰æ¥ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œä½†æ˜¯å¦‚æœé›†ç¾¤ä¸­å¦‚æœå¤§å¤šæ•°èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œå°±ç®—è¿˜å‰©ä¸‹ä¸€äº›ZookeeperèŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸èƒ½æä¾›æœåŠ¡çš„ï¼Œæ‰€ä»¥è¿™ä¸ªä¹Ÿä¸å¤ªåˆé€‚ï¼Œæ‰€ä»¥ç»¼åˆæ¥çœ‹ï¼Œæ³¨å†Œä¸­å¿ƒåº”è¯¥ä¿è¯APä¼šæ›´å¥½ï¼Œå°±åƒEurakaã€Nacosä»–ä»¬é»˜è®¤ä¿è¯çš„å°±æ˜¯APã€‚ ===Zookeeper====1ã€æ˜¯ä»€ä¹ˆzookeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒå·¥å…·ï¼Œä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚ 2ã€8å¤§åº”ç”¨åœºæ™¯ï¼ˆ1ï¼‰æ•°æ®å‘å¸ƒä¸è®¢é˜…ï¼ˆé…ç½®ä¸­å¿ƒï¼‰ å‘å¸ƒä¸è®¢é˜…å³æ‰€è°“çš„é…ç½®ç®¡ç†ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å°†æ•°æ®å‘å¸ƒåˆ°ZooKeeperèŠ‚ç‚¹ä¸Šï¼Œä¾›è®¢é˜…è€…åŠ¨æ€è·å– æ•°æ®ï¼Œå®ç°é…ç½®ä¿¡æ¯çš„é›†ä¸­å¼ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°ã€‚ä¾‹å¦‚å…¨å±€çš„é…ç½®ä¿¡æ¯ï¼Œåœ°å€åˆ—è¡¨ç­‰å°±éå¸¸é€‚åˆä½¿ ç”¨ã€‚ æ•°æ®å‘å¸ƒ/è®¢é˜…çš„ä¸€ä¸ªå¸¸è§çš„åœºæ™¯æ˜¯é…ç½®ä¸­å¿ƒï¼Œå‘å¸ƒè€…æŠŠæ•°æ®å‘å¸ƒåˆ° ZooKeeper çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—çš„ èŠ‚ç‚¹ä¸Šï¼Œä¾›è®¢é˜…è€…è¿›è¡Œæ•°æ®è®¢é˜…ï¼Œè¾¾åˆ°åŠ¨æ€è·å–æ•°æ®çš„ç›®çš„ã€‚ å…¨å±€é…ç½®ä¿¡æ¯é€šå¸¸æœ‰3ä¸ªç‰¹æ€§ï¼š æ•°æ®é‡å° æ•°æ®å†…å®¹å˜åŒ–é¢‘ç¹ é›†ç¾¤ä¸­å„æœºå™¨é…ç½®å…±äº«ã€ä¸€è‡´ ZooKeeper é‡‡ç”¨çš„æ˜¯æ¨æ‹‰ç»“åˆçš„æ–¹å¼ã€‚ æ¨: æœåŠ¡ç«¯ä¼šæ¨ç»™æ³¨å†Œäº†ç›‘æ§èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ Wathcer äº‹ä»¶é€šçŸ¥ æ‹‰: å®¢æˆ·ç«¯è·å¾—é€šçŸ¥åï¼Œç„¶åä¸»åŠ¨åˆ°æœåŠ¡ç«¯æ‹‰å–æœ€æ–°çš„æ•°æ® ï¼ˆ2ï¼‰åˆ†å¸ƒå¼é” å¤„äºä¸åŒèŠ‚ç‚¹ä¸Šä¸åŒçš„æœåŠ¡ï¼Œå®ƒä»¬å¯èƒ½éœ€è¦é¡ºåºçš„è®¿é—®ä¸€äº›èµ„æºï¼Œè¿™é‡Œéœ€è¦ä¸€æŠŠåˆ†å¸ƒå¼çš„é”ã€‚ åˆ†å¸ƒå¼é”å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼šå†™é”ã€è¯»é”ã€æ—¶åºé”ã€‚ å†™é”ï¼šåœ¨zkä¸Šåˆ›å»ºçš„ä¸€ä¸ªä¸´æ—¶çš„æ— ç¼–å·çš„èŠ‚ç‚¹ã€‚ç”±äºæ˜¯æ— åºç¼–å·ï¼Œåœ¨åˆ›å»ºæ—¶ä¸ä¼šè‡ªåŠ¨ç¼–å·ï¼Œå¯¼è‡´åª èƒ½å®¢æˆ·ç«¯æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¾—åˆ°é”ï¼Œç„¶åè¿›è¡Œå†™å…¥ã€‚ è¯»é”ï¼šåœ¨zkä¸Šåˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æœ‰ç¼–å·çš„èŠ‚ç‚¹ï¼Œè¿™æ ·å³ä½¿ä¸‹æ¬¡æœ‰å®¢æˆ·ç«¯åŠ å…¥æ˜¯åŒæ—¶åˆ›å»ºç›¸åŒçš„èŠ‚ç‚¹ æ—¶ï¼Œä»–ä¹Ÿä¼šè‡ªåŠ¨ç¼–å·ï¼Œä¹Ÿå¯ä»¥è·å¾—é”å¯¹è±¡ï¼Œç„¶åå¯¹å…¶è¿›è¡Œè¯»å–ã€‚ æ—¶åºé”ï¼šåœ¨zkä¸Šåˆ›å»ºçš„ä¸€ä¸ªä¸´æ—¶çš„æœ‰ç¼–å·çš„èŠ‚ç‚¹æ ¹æ®ç¼–å·çš„å¤§å°æ§åˆ¶é”ã€‚ ï¼ˆ3ï¼‰è´Ÿè½½å‡è¡¡ è¿™é‡Œè¯´çš„è´Ÿè½½å‡è¡¡æ˜¯æŒ‡è½¯è´Ÿè½½å‡è¡¡ã€‚åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä¸ºäº†ä¿è¯é«˜å¯ç”¨æ€§ï¼Œé€šå¸¸åŒä¸€ä¸ªåº”ç”¨æˆ–åŒä¸€ä¸ªæœåŠ¡çš„æä¾›æ–¹éƒ½ä¼šéƒ¨ç½²å¤šä»½ï¼Œè¾¾åˆ°å¯¹ç­‰æœåŠ¡ã€‚è€Œæ¶ˆè´¹è€…å°±éœ€è¦åœ¨è¿™äº›å¯¹ç­‰çš„æœåŠ¡å™¨ä¸­é€‰æ‹©ä¸€ä¸ªæ¥æ‰§è¡Œç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œå…¶ä¸­æ¯”è¾ƒå…¸å‹çš„æ˜¯æ¶ˆæ¯ä¸­é—´ä»¶ä¸­çš„ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶ä¸­å‘å¸ƒè€…å’Œè®¢é˜…è€…çš„è´Ÿè½½å‡è¡¡ï¼Œlinkedin å¼€æºçš„ KafkaMQ å’Œé˜¿é‡Œå¼€æºçš„ metaq éƒ½æ˜¯é€šè¿‡ zookeeper æ¥åšåˆ°ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…çš„è´Ÿè½½å‡è¡¡ã€‚è¿™é‡Œä»¥metaqä¸ºä¾‹å¦‚è®²ä¸‹ï¼š ç”Ÿäº§è€…è´Ÿè½½å‡è¡¡ï¼šmetaq å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™å¿…é¡»é€‰æ‹©ä¸€å° broker ä¸Šçš„ä¸€ä¸ªåˆ†åŒºæ¥å‘é€æ¶ˆæ¯ï¼Œå› æ­¤metaq åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæŠŠæ‰€æœ‰ brokerå’Œå¯¹åº”çš„åˆ†åŒºä¿¡æ¯å…¨éƒ¨æ³¨å†Œåˆ°ZKæŒ‡å®šèŠ‚ç‚¹ä¸Šï¼Œé»˜è®¤çš„ç­–ç•¥æ˜¯ä¸€ä¸ªä¾æ¬¡è½®è¯¢çš„è¿‡ç¨‹ï¼Œç”Ÿäº§è€…åœ¨é€šè¿‡ZKè·å–åˆ†åŒºåˆ—è¡¨ä¹‹åï¼Œä¼šæŒ‰ç…§ brokerIdå’Œpartitionçš„é¡ºåºæ’åˆ—ç»„ç»‡æˆä¸€ä¸ªæœ‰åºçš„åˆ†åŒºåˆ—è¡¨ï¼Œå‘é€çš„æ—¶å€™æŒ‰ç…§ä»å¤´åˆ°å°¾å¾ªç¯å¾€å¤çš„æ–¹å¼é€‰æ‹©ä¸€ä¸ªåˆ†åŒºæ¥å‘é€æ¶ˆæ¯ã€‚ æ¶ˆè´¹è´Ÿè½½å‡è¡¡ï¼š åœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ä¼šæ¶ˆè´¹ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºä¸­çš„æ¶ˆæ¯ï¼Œä½†æ˜¯ä¸€ä¸ªåˆ†åŒºåªä¼šç”±ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ¶ˆè´¹ã€‚MetaQçš„æ¶ˆè´¹ç­–ç•¥æ˜¯ï¼š æ¯ä¸ªåˆ†åŒºé’ˆå¯¹åŒä¸€ä¸ªgroupåªæŒ‚è½½ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚ å¦‚æœåŒä¸€ä¸ªgroupçš„æ¶ˆè´¹è€…æ•°ç›®å¤§äºåˆ†åŒºæ•°ç›®ï¼Œåˆ™å¤šå‡ºæ¥çš„æ¶ˆè´¹è€…å°†ä¸å‚ä¸æ¶ˆè´¹ã€‚ å¦‚æœåŒä¸€ä¸ªgroupçš„æ¶ˆè´¹è€…æ•°ç›®å°äºåˆ†åŒºæ•°ç›®ï¼Œåˆ™æœ‰éƒ¨åˆ†æ¶ˆè´¹è€…éœ€è¦é¢å¤–æ‰¿æ‹…æ¶ˆè´¹ä»»åŠ¡ã€‚ åœ¨æŸä¸ªæ¶ˆè´¹è€…æ•…éšœæˆ–è€…é‡å¯ç­‰æƒ…å†µä¸‹ï¼Œå…¶ä»–æ¶ˆè´¹è€…ä¼šæ„ŸçŸ¥åˆ°è¿™ä¸€å˜åŒ–ï¼ˆé€šè¿‡ zookeeper watchæ¶ˆè´¹è€…åˆ—è¡¨ï¼‰ï¼Œç„¶åé‡æ–°è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä¿è¯æ‰€æœ‰çš„åˆ†åŒºéƒ½æœ‰æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€‚ ï¼ˆ4ï¼‰å‘½åæœåŠ¡ ä½œä¸ºåˆ†å¸ƒå¼å‘½åæœåŠ¡ï¼Œå‘½åæœåŠ¡æ˜¯æŒ‡é€šè¿‡æŒ‡å®šçš„åå­—æ¥è·å–èµ„æºæˆ–è€…æœåŠ¡çš„åœ°å€ï¼Œåˆ©ç”¨ZooKeeper åˆ›å»ºä¸€ä¸ªå…¨å±€çš„è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„å°±å¯ä»¥ä½œä¸ºä¸€ä¸ªåå­—ï¼ŒæŒ‡å‘é›†ç¾¤ä¸­çš„é›†ç¾¤ï¼Œæä¾›çš„æœåŠ¡çš„åœ°å€ï¼Œæˆ–è€…ä¸€ä¸ªè¿œç¨‹çš„å¯¹è±¡ç­‰ç­‰ ï¼ˆ5ï¼‰åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ Zookeeperä¸­ç‰¹æœ‰çš„Watcheræ³¨å†Œäºå¼‚æ­¥é€šçŸ¥æœºåˆ¶ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¸åŒæœºå™¨ï¼Œç”šè‡³ä¸åŒç³»ç»Ÿä¹‹é—´çš„åè°ƒä¸é€šçŸ¥ï¼Œä»è€Œå®ç°å¯¹æ•°æ®å˜æ›´çš„å®æ—¶å¤„ç†ã€‚é€šå¸¸çš„åšæ³•æ˜¯ä¸åŒçš„å®¢æˆ·ç«¯éƒ½å¯¹Zookeeperä¸Šçš„åŒä¸€ä¸ªæ•°æ®èŠ‚ç‚¹è¿›è¡ŒWatcheræ³¨å†Œï¼Œç›‘å¬æ•°æ®èŠ‚ç‚¹çš„å˜åŒ–ï¼ˆåŒ…æ‹¬èŠ‚ç‚¹æœ¬èº«å’Œå­èŠ‚ç‚¹ï¼‰ï¼Œè‹¥æ•°æ®èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆæ‰€æœ‰è®¢é˜…çš„å®¢æˆ·ç«¯éƒ½èƒ½å¤Ÿæ¥æ”¶åˆ°ç›¸åº”çš„Watcheré€šçŸ¥ï¼Œå¹¶ä½œå‡ºç›¸åº”å¤„ç†ã€‚ åœ¨ç»å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿæœºå™¨é—´çš„é€šä¿¡æ— å¤–ä¹å¿ƒè·³æ£€æµ‹ã€å·¥ä½œè¿›åº¦æ±‡æŠ¥å’Œç³»ç»Ÿè°ƒåº¦ã€‚è¿™ä¸‰ç§ç±»å‹çš„æœºå™¨é€šä¿¡æ–¹å¼éƒ½å¯ä»¥ä½¿ç”¨zookeeperæ¥å®ç°ï¼š 1ã€å¿ƒè·³æ£€æµ‹ï¼Œä¸åŒæœºå™¨é—´éœ€è¦æ£€æµ‹åˆ°å½¼æ­¤æ˜¯å¦åœ¨æ­£å¸¸è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨Zookeeperå®ç°æœºå™¨é—´çš„å¿ƒè·³æ£€æµ‹ï¼ŒåŸºäºå…¶ä¸´æ—¶èŠ‚ç‚¹ç‰¹æ€§ï¼ˆä¸´æ—¶èŠ‚ç‚¹çš„ç”Ÿå­˜å‘¨æœŸæ˜¯å®¢æˆ·ç«¯ä¼šè¯ï¼Œå®¢æˆ·ç«¯è‹¥å½“å³åï¼Œå…¶ä¸´æ—¶èŠ‚ç‚¹è‡ªç„¶ä¸å†å­˜åœ¨ï¼‰ï¼Œå¯ä»¥è®©ä¸åŒæœºå™¨éƒ½åœ¨Zookeeperçš„ä¸€ä¸ªæŒ‡å®šèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸´æ—¶å­èŠ‚ç‚¹ï¼Œä¸åŒçš„æœºå™¨ä¹‹é—´å¯ä»¥æ ¹æ®è¿™ä¸ªä¸´æ—¶å­èŠ‚ç‚¹æ¥åˆ¤æ–­å¯¹åº”çš„å®¢æˆ·ç«¯æœºå™¨æ˜¯å¦å­˜æ´»ã€‚é€šè¿‡Zookeeperå¯ä»¥å¤§å¤§å‡å°‘ç³»ç»Ÿè€¦åˆã€‚ 2ã€å·¥ä½œè¿›åº¦æ±‡æŠ¥ï¼Œé€šå¸¸ä»»åŠ¡è¢«åˆ†å‘åˆ°ä¸åŒæœºå™¨åï¼Œéœ€è¦å®æ—¶åœ°å°†è‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œè¿›åº¦æ±‡æŠ¥ç»™åˆ†å‘ç³»ç»Ÿï¼Œå¯ä»¥åœ¨Zookeeperä¸Šé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªä»»åŠ¡å®¢æˆ·ç«¯éƒ½åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸‹é¢åˆ›å»ºä¸´æ—¶å­èŠ‚ç‚¹ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥åˆ¤æ–­æœºå™¨æ˜¯å¦å­˜æ´»ï¼ŒåŒæ—¶å„ä¸ªæœºå™¨å¯ä»¥å°†è‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œè¿›åº¦å†™åˆ°è¯¥ä¸´æ—¶èŠ‚ç‚¹ä¸­å»ï¼Œä»¥ä¾¿ä¸­å¿ƒç³»ç»Ÿèƒ½å¤Ÿå®æ—¶è·å–ä»»åŠ¡çš„æ‰§è¡Œè¿›åº¦ã€‚ 3ã€ç³»ç»Ÿè°ƒåº¦ï¼ŒZookeeperèƒ½å¤Ÿå®ç°å¦‚ä¸‹ç³»ç»Ÿè°ƒåº¦æ¨¡å¼ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿç”±æ§åˆ¶å°å’Œä¸€äº›å®¢æˆ·ç«¯ç³»ç»Ÿä¸¤éƒ¨åˆ†æ„æˆï¼Œæ§åˆ¶å°çš„èŒè´£å°±æ˜¯éœ€è¦å°†ä¸€äº›æŒ‡ä»¤ä¿¡æ¯å‘é€ç»™æ‰€æœ‰çš„å®¢æˆ·ç«¯ï¼Œä»¥æ§åˆ¶ä»–ä»¬è¿›è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ï¼Œåå°ç®¡ç†äººå‘˜åœ¨æ§åˆ¶å°ä¸Šåšä¸€äº›æ“ä½œï¼Œå®é™…ä¸Šå°±æ˜¯ä¿®æ”¹Zookeeperä¸ŠæŸäº›èŠ‚ç‚¹çš„æ•°æ®ï¼ŒZookeeperå¯ä»¥æŠŠæ•°æ®å˜æ›´ä»¥æ—¶é—´é€šçŸ¥çš„å½¢å¼å‘é€ç»™è®¢é˜…å®¢æˆ·ç«¯ã€‚ ï¼ˆ6ï¼‰é›†ç¾¤ç®¡ç† Zookeeperçš„ä¸¤å¤§ç‰¹æ€§ï¼ˆèŠ‚ç‚¹ç‰¹æ€§å’Œwatcheræœºåˆ¶ï¼‰ï¼š 1ã€å®¢æˆ·ç«¯å¦‚æœå¯¹Zookeeperçš„æ•°æ®èŠ‚ç‚¹æ³¨å†ŒWatcherç›‘å¬ï¼Œé‚£ä¹ˆå½“è¯¥æ•°æ®åŠè¯¶å•å†…å®¹æˆ–æ˜¯å…¶å­èŠ‚ç‚¹åˆ—è¡¨å‘ç”Ÿå˜æ›´æ—¶ï¼ŒZookeeperæœåŠ¡å™¨å°±ä¼šå‘è®¢é˜…çš„å®¢æˆ·ç«¯å‘é€å˜æ›´é€šçŸ¥ã€‚ 2ã€å¯¹åœ¨Zookeeperä¸Šåˆ›å»ºçš„ä¸´æ—¶èŠ‚ç‚¹ï¼Œä¸€æ—¦å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ä¼šè¯å¤±æ•ˆï¼Œé‚£ä¹ˆä¸´æ—¶èŠ‚ç‚¹ä¹Ÿä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚ æœºå™¨åœ¨çº¿ç‡æœ‰è¾ƒé«˜è¦æ±‚çš„åœºæ™¯ï¼Œèƒ½å¤Ÿå¿«é€Ÿå¯¹é›†ç¾¤ä¸­æœºå™¨å˜åŒ–ä½œå‡ºå“åº”ã€‚è¿™æ ·çš„åœºæ™¯ä¸­ï¼Œå¾€å¾€æœ‰ä¸€ä¸ªç›‘æ§ç³»ç»Ÿï¼Œå®æ—¶æ£€æµ‹é›†ç¾¤æœºå™¨æ˜¯å¦å­˜æ´»ã€‚è¿‡å»çš„åšæ³•é€šå¸¸æ˜¯ï¼šç›‘æ§ç³»ç»Ÿé€šè¿‡æŸç§æ‰‹æ®µï¼ˆæ¯”å¦‚pingï¼‰å®šæ—¶æ£€æµ‹æ¯ä¸ªæœºå™¨ï¼Œæˆ–è€…æ¯ä¸ªæœºå™¨è‡ªå·±å®šæ—¶å‘ç›‘æ§ç³»ç»Ÿæ±‡æŠ¥â€œæˆ‘è¿˜æ´»ç€â€ã€‚è¿™ç§åšæ³•å¯è¡Œï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„é—®é¢˜ï¼š é›†ç¾¤ä¸­æœºå™¨æœ‰å˜åŠ¨çš„æ—¶å€™ï¼Œç‰µè¿ä¿®æ”¹çš„ä¸œè¥¿æ¯”è¾ƒå¤šã€‚ æœ‰ä¸€å®šçš„å»¶æ—¶ã€‚ åˆ©ç”¨ZooKeeperæœ‰ä¸¤ä¸ªç‰¹æ€§ï¼Œå°±å¯ä»¥å®æ—¶å¦ä¸€ç§é›†ç¾¤æœºå™¨å­˜æ´»æ€§ç›‘æ§ç³»ç»Ÿã€‚å¯ä»¥å®ç°é›†ç¾¤æœºå™¨å­˜æ´»ç›‘æ§ç³»ç»Ÿï¼Œè‹¥ç›‘æ§ç³»ç»Ÿåœ¨/clusterServersèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€ä¸ªWatcherç›‘å¬ï¼Œé‚£ä¹ˆä½†å‡¡è¿›è¡ŒåŠ¨æ€æ·»åŠ æœºå™¨çš„æ“ä½œï¼Œå°±ä¼šåœ¨/clusterServersèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼š/clusterServers/[Hostname]ï¼Œè¿™æ ·ï¼Œç›‘æ§ç³»ç»Ÿå°±èƒ½å¤Ÿå®æ—¶ç›‘æµ‹æœºå™¨çš„å˜åŠ¨æƒ…å†µã€‚ ä¸‹é¢é€šè¿‡åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†ç³»ç»Ÿçš„å…¸å‹åº”ç”¨æ¥å­¦ä¹ Zookeeperå¦‚ä½•å®ç°é›†ç¾¤ç®¡ç†ã€‚ åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†ç³»ç»Ÿçš„æ ¸å¿ƒå·¥ä½œå°±æ˜¯æ”¶é›†åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šçš„ç³»ç»Ÿæ—¥å¿—ï¼Œåœ¨å…¸å‹çš„æ—¥å¿—ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸­ï¼Œæ•´ä¸ªæ—¥å¿—ç³»ç»Ÿä¼šæŠŠæ‰€æœ‰éœ€è¦æ”¶é›†çš„æ—¥å¿—æœºå™¨åˆ†ä¸ºå¤šä¸ªç»„åˆ«ï¼Œæ¯ä¸ªç»„åˆ«å¯¹åº”ä¸€ä¸ªæ”¶é›†å™¨ï¼Œè¿™ä¸ªæ”¶é›†å™¨å…¶å®å°±æ˜¯ä¸€ä¸ªåå°æœºå™¨ï¼Œç”¨äºæ”¶é›†æ—¥å¿—ï¼Œå¯¹äºå¤§è§„æ¨¡çš„åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†ç³»ç»Ÿåœºæ™¯ï¼Œé€šå¸¸éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š 1ã€å˜åŒ–çš„æ—¥å¿—æºæœºå™¨ 2ã€å˜åŒ–çš„æ”¶é›†å™¨æœºå™¨ æ— è®ºæ˜¯æ—¥å¿—æºæœºå™¨è¿˜æ˜¯æ”¶é›†å™¨æœºå™¨çš„å˜æ›´ï¼Œæœ€ç»ˆéƒ½å¯ä»¥å½’ç»“ä¸ºå¦‚ä½•å¿«é€Ÿã€åˆç†ã€åŠ¨æ€åœ°ä¸ºæ¯ä¸ªæ”¶é›†å™¨åˆ†é…å¯¹åº”çš„æ—¥å¿—æºæœºå™¨ã€‚ aã€æ³¨å†Œæ”¶é›†å™¨æœºå™¨ï¼Œåœ¨Zookeeperä¸Šåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ”¶é›†å™¨çš„æ ¹èŠ‚ç‚¹ï¼Œä¾‹å¦‚/logs/collectorçš„æ”¶é›†å™¨èŠ‚ç‚¹ï¼Œæ¯ä¸ªæ”¶é›†å™¨æœºå™¨å¯åŠ¨æ—¶éƒ½ä¼šåœ¨æ”¶é›†å™¨èŠ‚ç‚¹ä¸‹åˆ›å»ºè‡ªå·±çš„èŠ‚ç‚¹ï¼Œå¦‚/logs/collector/[Hostname] bã€ä»»åŠ¡åˆ†å‘ï¼Œæ‰€æœ‰æ”¶é›†å™¨æœºå™¨éƒ½åˆ›å»ºå®Œå¯¹åº”èŠ‚ç‚¹åï¼Œç³»ç»Ÿæ ¹æ®æ”¶é›†å™¨èŠ‚ç‚¹ä¸‹å­èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œå°†æ‰€æœ‰æ—¥å¿—æºæœºå™¨åˆ†æˆå¯¹åº”çš„è‹¥å¹²ç»„ï¼Œç„¶åå°†åˆ†ç»„åçš„æœºå™¨åˆ—è¡¨åˆ†åˆ«å†™åˆ°è¿™äº›æ”¶é›†å™¨æœºå™¨åˆ›å»ºçš„å­èŠ‚ç‚¹ï¼Œå¦‚/logs/collector/host1ï¼ˆæŒä¹…èŠ‚ç‚¹ï¼‰ä¸Šå»ã€‚è¿™æ ·ï¼Œæ”¶é›†å™¨æœºå™¨å°±èƒ½å¤Ÿæ ¹æ®è‡ªå·±å¯¹åº”çš„æ”¶é›†å™¨èŠ‚ç‚¹ä¸Šè·å–æ—¥å¿—æºæœºå™¨åˆ—è¡¨ï¼Œè¿›è€Œå¼€å§‹è¿›è¡Œæ—¥å¿—æ”¶é›†å·¥ä½œã€‚ cã€çŠ¶æ€æ±‡æŠ¥ï¼Œå®Œæˆä»»åŠ¡åˆ†å‘åï¼Œæœºå™¨éšæ—¶ä¼šå®•æœºï¼Œæ‰€ä»¥éœ€è¦æœ‰ä¸€ä¸ªæ”¶é›†å™¨çš„çŠ¶æ€æ±‡æŠ¥æœºåˆ¶ï¼Œæ¯ä¸ªæ”¶é›†å™¨æœºå™¨ä¸Šåˆ›å»ºå®ŒèŠ‚ç‚¹åï¼Œè¿˜éœ€è¦å†å¯¹åº”å­èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªçŠ¶æ€å­èŠ‚ç‚¹ï¼Œå¦‚/logs/collector/host/statusï¼ˆä¸´æ—¶èŠ‚ç‚¹ï¼‰ï¼Œæ¯ä¸ªæ”¶é›†å™¨æœºå™¨éƒ½éœ€è¦å®šæœŸå‘è¯¥ç»“ç‚¹å†™å…¥è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯ï¼Œè¿™å¯çœ‹åšæ˜¯å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œé€šå¸¸æ”¶é›†å™¨æœºå™¨éƒ½ä¼šå†™å…¥æ—¥å¿—æ”¶é›†çŠ¶æ€ä¿¡æ¯ï¼Œæ—¥å¿—ç³»ç»Ÿé€šè¿‡åˆ¤æ–­çŠ¶æ€å­èŠ‚ç‚¹æœ€åçš„æ›´æ–°æ—¶é—´æ¥ç¡®å®šæ”¶é›†å™¨æœºå™¨æ˜¯å¦å­˜æ´»ã€‚ dã€åŠ¨æ€åˆ†é…ï¼Œè‹¥æ”¶é›†å™¨æœºå™¨å®•æœºï¼Œåˆ™éœ€è¦åŠ¨æ€è¿›è¡Œæ”¶é›†ä»»åŠ¡çš„åˆ†é…ï¼Œæ”¶é›†ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­å…³æ³¨/logs/collectorèŠ‚ç‚¹ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹çš„å˜æ›´ï¼Œä¸€æ—¦æœ‰æœºå™¨åœæ­¢æ±‡æŠ¥æˆ–æœ‰æ–°æœºå™¨åŠ å…¥ï¼Œå°±å¼€å§‹è¿›è¡Œä»»åŠ¡çš„é‡æ–°åˆ†é…ï¼Œæ­¤æ—¶é€šå¸¸ç”±ä¸¤ç§åšæ³•ï¼š 1ã€å…¨å±€åŠ¨æ€åˆ†é…ï¼Œå½“æ”¶é›†å™¨æœºå™¨å®•æœºæˆ–æœ‰æ–°çš„æœºå™¨åŠ å…¥ï¼Œç³»ç»Ÿæ ¹æ®æ–°çš„æ”¶é›†å™¨æœºå™¨åˆ—è¡¨ï¼Œç«‹å³å¯¹æ‰€æœ‰çš„æ—¥å¿—æºæœºå™¨é‡æ–°è¿›è¡Œä¸€æ¬¡åˆ†ç»„ï¼Œç„¶åå°†å…¶åˆ†é…ç»™å‰©ä¸‹çš„æ”¶é›†å™¨æœºå™¨ã€‚ 2ã€å±€éƒ¨åŠ¨æ€åˆ†é…ï¼Œæ¯ä¸ªæ”¶é›†å™¨æœºå™¨åœ¨æ±‡æŠ¥è‡ªå·±æ—¥å¿—æ”¶é›†çŠ¶æ€çš„åŒæ—¶ï¼Œä¹Ÿä¼šæŠŠè‡ªå·±çš„è´Ÿè½½æ±‡æŠ¥ä¸Šå»ï¼Œå¦‚æœä¸€ä¸ªæœºå™¨å®•æœºäº†ï¼Œé‚£ä¹ˆæ—¥å¿—ç³»ç»Ÿå°±ä¼šæŠŠä¹‹å‰åˆ†é…ç»™è¿™ä¸ªæœºå™¨çš„ä»»åŠ¡é‡æ–°åˆ†é…åˆ°é‚£äº›è´Ÿè½½è¾ƒä½çš„æœºå™¨ï¼ŒåŒæ ·ï¼Œå¦‚æœæœ‰æ–°æœºå™¨åŠ å…¥ï¼Œä¼šä»é‚£äº›è´Ÿè½½é«˜çš„æœºå™¨ä¸Šè½¬ç§»ä¸€éƒ¨åˆ†ä»»åŠ¡ç»™æ–°æœºå™¨ ï¼ˆ8ï¼‰åˆ†å¸ƒå¼é˜Ÿåˆ— åˆ†å¸ƒå¼é˜Ÿåˆ—åˆ†ä¸ºä¸¤ç§ï¼š 1ã€å½“ä¸€ä¸ªé˜Ÿåˆ—çš„æˆå‘˜éƒ½èšé½æ—¶ï¼Œè¿™ä¸ªé˜Ÿåˆ—æ‰å¯ç”¨ï¼Œå¦åˆ™ä¸€ç›´ç­‰å¾…æ‰€æœ‰æˆå‘˜åˆ°è¾¾ï¼Œè¿™ç§æ˜¯åŒæ­¥é˜Ÿ åˆ—ã€‚ aï¼‰ä¸€ä¸ªjobç”±å¤šä¸ªtaskç»„æˆï¼Œåªæœ‰æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œjobæ‰è¿è¡Œå®Œæˆã€‚ bï¼‰å¯ä¸ºjobåˆ›å»ºä¸€ä¸ª/jobç›®å½•ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸‹ï¼Œä¸ºæ¯ä¸ªå®Œæˆçš„taskåˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„Znodeï¼Œä¸€æ—¦ ä¸´æ—¶èŠ‚ç‚¹æ•°ç›®è¾¾åˆ°taskæ€»æ•°ï¼Œåˆ™è¡¨æ˜jobè¿è¡Œå®Œæˆã€‚ 2ã€é˜Ÿåˆ—æŒ‰ç…§FIFOæ–¹å¼è¿›è¡Œå…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œï¼Œä¾‹å¦‚å®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹ã€‚ 3ã€Zookeeperçš„å·¥ä½œåŸç†Zookeeperçš„æ ¸å¿ƒæ˜¯åŸå­å¹¿æ’­ï¼Œè¿™ä¸ªæœºåˆ¶ä¿è¯äº†å„ä¸ªServerä¹‹é—´çš„åŒæ­¥ã€‚å®ç°è¿™ä¸ªæœºåˆ¶çš„åè®®å«åš Zabåè®®ã€‚ Zabåè®®æœ‰ä¸¤ç§æ¨¡å¼ï¼Œå®ƒä»¬ åˆ†åˆ«æ˜¯æ¢å¤æ¨¡å¼ï¼ˆé€‰ä¸»ï¼‰å’Œå¹¿æ’­æ¨¡å¼ï¼ˆåŒæ­¥ï¼‰ã€‚ Zookeeper æ˜¯é€šè¿‡ Zab åè®®æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚Zabåè®®è¦æ±‚æ¯ä¸ª Leader éƒ½è¦ç»å†ä¸‰ä¸ªé˜¶æ®µï¼šå‘ç°ï¼ŒåŒæ­¥ï¼Œå¹¿æ’­ã€‚ å½“æœåŠ¡å¯åŠ¨æˆ–è€…åœ¨é¢†å¯¼è€…å´©æºƒåï¼ŒZabå°±è¿›å…¥äº†æ¢å¤æ¨¡å¼ï¼Œå½“é¢†å¯¼è€…è¢«é€‰ä¸¾å‡ºæ¥ï¼Œä¸”å¤§å¤šæ•°Server å®Œæˆäº†å’Œ leaderçš„çŠ¶æ€åŒæ­¥ä»¥åï¼Œæ¢å¤æ¨¡å¼å°±ç»“æŸäº†ã€‚çŠ¶æ€åŒæ­¥ä¿è¯äº†leaderå’ŒServerå…·æœ‰ç›¸åŒçš„ ç³»ç»ŸçŠ¶æ€ã€‚ ä¸ºäº†ä¿è¯äº‹åŠ¡çš„é¡ºåºä¸€è‡´æ€§ï¼Œzookeeperé‡‡ç”¨äº†é€’å¢çš„äº‹åŠ¡idå·ï¼ˆzxidï¼‰æ¥æ ‡è¯†äº‹åŠ¡ã€‚æ‰€æœ‰çš„æè®® ï¼ˆproposalï¼‰éƒ½åœ¨è¢«æå‡ºçš„æ—¶å€™åŠ ä¸Šäº†zxidã€‚å®ç°ä¸­zxidæ˜¯ä¸€ä¸ª64ä½çš„æ•°å­—ï¼Œå®ƒé«˜32ä½æ˜¯epochç”¨ æ¥æ ‡è¯†leaderå…³ç³»æ˜¯å¦æ”¹å˜ï¼Œæ¯æ¬¡ä¸€ä¸ªleaderè¢«é€‰å‡ºæ¥ï¼Œå®ƒéƒ½ä¼šæœ‰ä¸€ä¸ªæ–°çš„epochï¼ˆçºªå…ƒï¼‰ï¼Œæ ‡è¯†å½“å‰å±äºé‚£ä¸ªleaderçš„ç»Ÿæ²»æ—¶æœŸã€‚ä½32ä½ç”¨äºé€’å¢è®¡æ•°ã€‚ epochï¼šå¯ä»¥ç†è§£ä¸ºçš‡å¸çš„å¹´å·ï¼Œå½“æ–°çš„çš‡å¸leaderäº§ç”Ÿåï¼Œå°†æœ‰ä¸€ä¸ªæ–°çš„epochå¹´å·ã€‚ æ¯ä¸ªServeråœ¨å·¥ä½œè¿‡ç¨‹ä¸­æœ‰ä¸‰ç§çŠ¶æ€ï¼š LOOKINGï¼šå½“å‰Serverä¸çŸ¥é“leaderæ˜¯è°ï¼Œæ­£åœ¨æœå¯»ã€‚ LEADINGï¼šå½“å‰Serverå³ä¸ºé€‰ä¸¾å‡ºæ¥çš„leaderã€‚ FOLLOWINGï¼šleaderå·²ç»é€‰ä¸¾å‡ºæ¥ï¼Œå½“å‰Serverä¸ä¹‹åŒæ­¥ã€‚ 4ã€Zookeeper çš„é€šçŸ¥æœºåˆ¶æ˜¯Zookeeper å…è®¸å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯çš„æŸä¸ª znode æ³¨å†Œä¸€ä¸ª Watcher ç›‘å¬ï¼Œå½“æœåŠ¡ç«¯çš„ä¸€äº›æŒ‡å®šäº‹ä»¶ è§¦å‘äº†è¿™ä¸ª Watcher ï¼ŒæœåŠ¡ç«¯ä¼šå‘æŒ‡å®šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªäº‹ä»¶é€šçŸ¥æ¥å®ç°åˆ†å¸ƒå¼çš„é€šçŸ¥åŠŸèƒ½ï¼Œç„¶åå®¢ æˆ·ç«¯æ ¹æ® Watcher é€šçŸ¥çŠ¶æ€å’Œäº‹ä»¶ç±»å‹åšå‡ºä¸šåŠ¡ä¸Šçš„æ”¹å˜ã€‚ å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š å®¢æˆ·ç«¯æ³¨å†Œ Watcher 1ã€è°ƒç”¨ getDataã€getChildrenã€exist ä¸‰ä¸ª API ï¼Œä¼ å…¥Watcher å¯¹è±¡ã€‚ 2ã€æ ‡è®°è¯·æ±‚ request ï¼Œå°è£… Watcher åˆ° WatchRegistration ã€‚ 3ã€å°è£…æˆ Packet å¯¹è±¡ï¼Œå‘æœåŠ¡ç«¯å‘é€ request ã€‚ 4ã€æ”¶åˆ°æœåŠ¡ç«¯å“åº”åï¼Œå°† Watcher æ³¨å†Œåˆ° ZKWatcherManager ä¸­è¿›è¡Œç®¡ç†ã€‚ 5ã€ è¯·æ±‚è¿”å›ï¼Œå®Œæˆæ³¨å†Œã€‚ æœåŠ¡ç«¯å¤„ç† Watcher 1ã€æœåŠ¡ç«¯æ¥æ”¶ Watcher å¹¶å­˜å‚¨ã€‚ 2ã€Watcher è§¦å‘ 3ã€è°ƒç”¨ process æ–¹æ³•æ¥è§¦å‘ Watcher ã€‚ å®¢æˆ·ç«¯å›è°ƒ Watcher 1ï¼Œå®¢æˆ·ç«¯ SendThread çº¿ç¨‹æ¥æ”¶äº‹ä»¶é€šçŸ¥ï¼Œäº¤ç”± EventThread çº¿ç¨‹å›è°ƒWatcher ã€‚ 2ï¼Œå®¢æˆ·ç«¯ çš„ Watcher æœºåˆ¶åŒæ ·æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸€æ—¦è¢«è§¦å‘åï¼Œè¯¥ Watcher å°±å¤±æ•ˆäº†ã€‚ client ç«¯ä¼šå¯¹æŸä¸ª znode å»ºç«‹ä¸€ä¸ª watcher äº‹ä»¶ï¼Œå½“è¯¥ znode å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™äº› client ä¼šæ”¶ åˆ° zk çš„é€šçŸ¥ï¼Œç„¶å client å¯ä»¥æ ¹æ® znode å˜åŒ–æ¥åšå‡ºä¸šåŠ¡ä¸Šçš„æ”¹å˜ç­‰ã€‚ 5ã€Zookeeper å¯¹èŠ‚ç‚¹çš„ watch ç›‘å¬é€šçŸ¥æ˜¯æ°¸ä¹…çš„å—ä¸€æ¬¡æ€§çš„ã€‚æ— è®ºæ˜¯æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œä¸€æ—¦ä¸€ä¸ª Watcher è¢«è§¦å‘ï¼Œ Zookeeper éƒ½ä¼šå°†å…¶ä» ç›¸åº”çš„å­˜å‚¨ä¸­ç§»é™¤ã€‚è¿™æ ·çš„è®¾è®¡æœ‰æ•ˆçš„å‡è½»äº†æœåŠ¡ç«¯çš„å‹åŠ›ï¼Œä¸ç„¶å¯¹äºæ›´æ–°éå¸¸é¢‘ç¹çš„èŠ‚ç‚¹ï¼ŒæœåŠ¡ ç«¯ä¼šä¸æ–­çš„å‘å®¢æˆ·ç«¯å‘é€äº‹ä»¶é€šçŸ¥ï¼Œæ— è®ºå¯¹äºç½‘ç»œè¿˜æ˜¯æœåŠ¡ç«¯çš„å‹åŠ›éƒ½éå¸¸å¤§ã€‚ 6ã€Zookeeper é›†ç¾¤ä¸­æœ‰å“ªäº›è§’è‰² 7ã€Zookeeper é›†ç¾¤ä¸­Serveræœ‰å“ªäº›å·¥ä½œçŠ¶æ€LOOKING å¯»æ‰¾ Leader çŠ¶æ€ï¼›å½“æœåŠ¡å™¨å¤„äºè¯¥çŠ¶æ€æ—¶ï¼Œå®ƒä¼šè®¤ä¸ºå½“å‰é›†ç¾¤ä¸­æ²¡æœ‰ Leader ï¼Œå› æ­¤éœ€è¦è¿›å…¥ Leader é€‰ä¸¾çŠ¶æ€ FOLLOWING è·Ÿéšè€…çŠ¶æ€ï¼›è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Follower LEADING é¢†å¯¼è€…çŠ¶æ€ï¼›è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Leader OBSERVING è§‚å¯Ÿè€…çŠ¶æ€ï¼›è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Observer 8ã€9ã€10ã€11ã€12ã€13ã€14ã€15ã€16ã€17ã€18ã€2ã€ç†”æ–­å™¨1ã€å¯¹æ¯”å›¾3ã€ç½‘å…³4ã€5ã€äºŒã€Mysqlé«˜çº§é¢åŸºé«˜çº§ç‰¹æ€§æœ¬å‘¨æ•´ç†å¤§çº²ï¼š1ã€æ‰§è¡Œæµç¨‹ï¼ˆ5.7 and 8.0 æš‚ä¸æ•´ç†ï¼‰ï¼Œé€»è¾‘æ¶æ„ï¼ˆä¸‰å±‚ï¼‰ï¼›å›¾ã€æ¦‚è¿°ï¼Œç™½è¯æ€»ç»“2ã€å­˜å‚¨å¼•æ“ï¼ˆInnoDB MyISAM ï¼ˆæ ¸å¿ƒå¯¹æ¯”å›¾ï¼‰â€¦è¾¹ç¼˜5ç§ç®€è¿°-äº†è§£ï¼‰ï¼›è£…é€¼ï¼šé˜¿é‡Œè‡ªå®šä¹‰å¼•æ“ï¼šXtradb3ã€ç´¢å¼•è¿­ä»£è®¾è®¡ï¼ˆæ˜¯éèšç°‡ç´¢å¼•ï¼ŒäºŒçº§ã€è”åˆç´¢å¼•ï¼‰ï¼Œç´¢å¼•ä½¿ç”¨å¸¸è§ï¼ˆ11 yes 7 notï¼‰ï¼›è¾¹ç¼˜æ‰€ä»¥ä½ æ¥å£å¯¹æ¯”ï¼ˆHASHã€AVLã€Bã€B+ï¼‰ã€Explainè°ƒä¼˜é˜¿é‡Œã€ä¸‰èŒƒå¼ ERæ¨¡å‹Nã€äº‹åŠ¡ï¼ˆæ˜¾å¼ã€éšå¼ï¼‰ï¼Œé”ï¼ˆè¡¨é”ï¼šSé”ã€Xé”ã€æ„å‘é”ã€è‡ªå¢é”ã€å…ƒæ•°æ®é”ï¼›è¡Œé”ï¼šè®°å½•é”ã€é—´éš™é”ã€ä¸´é”®é”ã€æ’å…¥æ„å‘é”ï¼›ä¹è§‚æ‚²è§‚é”â€¦..ï¼‰ æ‰©å±•å¾…å®šï¼Ÿ 1| ç²¾ç®€1ã€æ‰§è¡Œæµç¨‹SQLæµç¨‹ sqlè¯­å¥ -&gt; æŸ¥è¯¢ç¼“å­˜ -&gt; è§£æå™¨ -&gt; ä¼˜åŒ–å™¨ -&gt; æ‰§è¡Œå™¨ å®Œæ•´æµç¨‹ å®¢æˆ·ç«¯ç¨‹åº connectors &gt;&gt; è¿æ¥æ±  &gt;&gt; SQLæ¥å£ &gt;&gt; è§£æå™¨ &gt;&gt; ä¼˜åŒ–å™¨ &gt;&gt; æŸ¥è¯¢ç¼“å­˜ &gt;&gt; æ’ä»¶å¼å­˜å‚¨å¼•æ“ &gt;&gt; Fileï¼ˆæ–‡ä»¶ç³»ç»Ÿ/æ—¥å¿—æ–‡ä»¶ï¼‰ å®¢æˆ·ç«¯ç¨‹åº : åŒ…æ‹¬ä¸€äº›mysqlå·¥å…·å¦‚ï¼šnative æˆ–è€…è¯­è¨€å·¥å…·å¦‚ï¼šphp ã€go ã€python è¿æ¥æ±  : æä¾›å¤šä¸ªç”¨æˆ·å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº¤äº’çš„çº¿ç¨‹ SQLæ¥å£ : æ¥æ”¶sqlå‘½ä»¤ï¼Œè¿”å›æŸ¥è¯¢ç»“æœ è§£æå™¨ : è¿›è¡Œsqlè¯­æ³•çš„è§£æã€è¯­æ„è§£æã€ç”Ÿæˆè¯­æ³•æ ‘ ä¼˜åŒ–å™¨ : mysqlæ ¸å¿ƒç»„ä»¶ï¼Œå¯¹sqlå‘½ä»¤è¿›è¡Œä¼˜åŒ– ç¼“å­˜ : ä»¥key -&gt; valueæ–¹å¼ç¼“å­˜æŸ¥è¯¢ç»“æœ (å¦‚æœæŸ¥è¯¢sqlæŒ‡ä»¤æœ‰ç¼“å­˜ç›´æ¥åœ¨SQLæ¥å£éƒ¨åˆ†è¿”å›ç¼“å­˜ç»“æœ) å­˜å‚¨å¼•æ“ : ä¸åº•å±‚æ–‡ä»¶è¿›è¡Œäº¤äº’ï¼ŒæŸ¥è¯¢æ•°æ®æ–‡ä»¶ç³»ç»Ÿã€æ—¥å¿—æ–‡ä»¶ç­‰ mysql serverä¸‰å±‚æ¶æ„ 1ã€è¿æ¥å±‚ mysqlæœåŠ¡å™¨æœ‰ä¸“é—¨çš„tcpè¿æ¥æ± é™åˆ¶æœ€å¤§è¿æ¥æ•°ï¼Œé‡‡ç”¨é•¿è¿æ¥æ¨¡å¼å¤ç”¨tcpè¿æ¥ï¼Œè¿›è¡Œè¿æ¥äº¤äº’ 2ã€æœåŠ¡å±‚ Interface æ¥å£ è§£æå™¨ æŸ¥è¯¢ä¼˜åŒ–å™¨ æŸ¥è¯¢ç¼“å­˜ç»„ä»¶ 3ã€å¼•æ“å±‚ æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“å±‚ï¼ŒçœŸæ­£çš„è´Ÿè´£äº†mysqlä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼Œå¯¹ç‰©ç†æœåŠ¡å™¨çº§åˆ«ç»´æŠ¤çš„åº•å±‚æ•°æ®æ‰§è¡Œæ“ä½œï¼ŒæœåŠ¡å™¨é€šè¿‡apiä¸å­˜å‚¨å¼•æ“é€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰çš„åŠŸèƒ½ä¸åŒï¼Œæ”¯æŒäºŒå¼€å¼•æ“ã€é˜¿é‡Œï¼šXtradbã€‘ 2ã€èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•å¯¹æ¯”ï¼š èšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯è¡Œæ•°æ®ï¼›è€Œéèšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯èšç°‡ç´¢å¼•ï¼ˆé€šå¸¸æ˜¯ä¸»é”® IDï¼‰ã€‚ èšç°‡ç´¢å¼•æŸ¥è¯¢æ•ˆç‡æ›´é«˜ï¼Œè€Œéèšç°‡ç´¢å¼•éœ€è¦è¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œå› æ­¤æ€§èƒ½ä¸å¦‚èšç°‡ç´¢å¼•ã€‚ èšç°‡ç´¢å¼•ä¸€èˆ¬ä¸ºä¸»é”®ç´¢å¼•ï¼Œè€Œä¸»é”®ä¸€ä¸ªè¡¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªï¼Œå› æ­¤èšç°‡ç´¢å¼•ä¸€ä¸ªè¡¨ä¸­ä¹Ÿåªèƒ½æœ‰ä¸€ä¸ªï¼Œè€Œéèšç°‡ç´¢å¼•åˆ™æ²¡æœ‰æ•°é‡ä¸Šçš„é™åˆ¶ èšç°‡ç´¢å¼• id å¯¹åº”çš„ B+ æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨ student ä¸­éèšç°‡ç´¢å¼• class_id å¯¹åº” B+ æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 3ã€å­˜å‚¨å¼•æ“å¯¹æ¯”å›¾ï¼š MyISAM ä¸ InnoDBä¸¤ç§å¼•æ“ä¸­ç´¢å¼•çš„åŒºåˆ« â‘  åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®ä¸»é”®å€¼å¯¹èšç°‡ç´¢å¼•è¿›è¡Œä¸€æ¬¡æŸ¥æ‰¾å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œè€Œåœ¨MyISAMä¸­å´éœ€è¦è¿›è¡Œä¸€æ¬¡å›è¡¨æ“ä½œï¼Œæ„å‘³ç€MyISAMä¸­å»ºç«‹çš„ç´¢å¼•ç›¸å½“äºå…¨éƒ¨éƒ½æ˜¯äºŒçº§ç´¢å¼•ã€‚ â‘¡ InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ï¼Œè€ŒMyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚ â‘¢ InnoDBçš„éèšç°‡ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼ï¼Œè€ŒMyISAMç´¢å¼•è®°å½•çš„æ˜¯åœ°å€ã€‚æ¢å¥è¯è¯´ï¼ŒInnoDBçš„æ‰€æœ‰éèšç°‡ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚ â‘£ MyISAMçš„å›è¡¨æ“ä½œæ˜¯ååˆ†å¿«é€Ÿçš„ï¼Œå› ä¸ºæ˜¯æ‹¿ç€åœ°å€åç§»é‡ç›´æ¥åˆ°æ–‡ä»¶ä¸­å–æ•°æ®çš„ï¼Œåè§‚InnoDBæ˜¯é€šè¿‡è·å–ä¸»é”®ä¹‹åå†å»èšç°‡ç´¢å¼•é‡Œæ‰¾è®°å½•ï¼Œè™½ç„¶è¯´ä¹Ÿä¸æ…¢ï¼Œä½†è¿˜æ˜¯æ¯”ä¸ä¸Šç›´æ¥ç”¨åœ°å€å»è®¿é—®ã€‚ â‘¤ InnoDBè¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆMyISAMå¯ä»¥æ²¡æœ‰ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥éç©ºä¸”å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ã€‚å¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å‹ã€‚ è¡¥å……1ï¼šInnoDBçš„é€»è¾‘ç»“æ„å›¾ï¼š 4ã€ä¸ºä»€ä¹ˆè¦†ç›–ç´¢å¼•ä¸ç”¨å›è¡¨ä¸€çº§ç´¢å¼•ï¼šèšç°‡ç´¢å¼•å³ä¸»é”®ç´¢å¼•äºŒçº§ç´¢å¼•ï¼šéèšç°‡ç´¢å¼• ä¸€çº§B+Treeï¼šå¶å­èŠ‚ç‚¹ä¿å­˜ç€é”®ï¼ˆidçš„å€¼ï¼‰å’Œæ•°æ®ï¼ˆå…¨éƒ¨å­—æ®µçš„å€¼ï¼‰äºŒçº§B+Treeï¼šå¶å­èŠ‚ç‚¹ä¿å­˜ç€é”®ï¼ˆç´¢å¼•å­—æ®µçš„å€¼ï¼‰å’Œæ•°æ®ï¼ˆä¸»é”®ç´¢å¼•å€¼ï¼‰ æŸ¥è¯¢ ä¸€çº§ç´¢å¼•ï¼Œæ ¹æ®ä¸€çº§B+TreeæŸ¥è¯¢åˆ°æ•°æ®ï¼Œç›´æ¥è¿”å›æ•°æ®æŸ¥è¯¢ äºŒçº§ç´¢å¼•ï¼Œæ ¹æ®äºŒçº§B+TreeæŸ¥è¯¢åˆ°å¯¹åº”çš„èšç°‡ç´¢å¼•ï¼Œå†æ ¹æ®èšç°‡ç´¢å¼•åœ¨ä¸€çº§B+Treeé‡ŒæŸ¥è¯¢åˆ°ç›¸åº”æ•°æ® æŸ¥è¯¢ ä¸€çº§ç´¢å¼•åªéœ€è¦æ‰«æä¸€æ¬¡B+Treeã€‚æŸ¥è¯¢ äºŒçº§ç´¢å¼•éœ€è¦æ‰«æä¸¤æ¬¡B+Treeã€‚æ ¹æ®äºŒçº§B+Treeæ‰«æçš„ç»“æœï¼Œå†å»ä¸€çº§B+Treeé‡Œè¿›è¡Œæ‰«æå°±å«å›è¡¨æ“ä½œã€‚ å¦‚æœä½¿ç”¨ç»„åˆç´¢å¼•ï¼Œå°±å¯ä»¥åˆ©ç”¨è¦†ç›–ç´¢å¼•é¿å…å›è¡¨æ“ä½œä¾‹å¦‚ï¼šè¡¨ä¸€å…±æœ‰äº”ä¸ªå­—æ®µï¼šaï¼ˆä¸»é”®ç´¢å¼•ï¼‰ï¼Œb_c_dï¼ˆç»„åˆç´¢å¼•ï¼‰ï¼Œeï¼ˆæ²¡æœ‰ç´¢å¼•ï¼‰ å¦‚æœç”¨æˆ·æŸ¥è¯¢æ—¶åªæŸ¥ b,c,d ä¾‹ï¼šSELECT b, c, d FROM table WHERE b = 3 AND c = 7 AND d = 5; å› ä¸ºæŸ¥è¯¢çš„å­—æ®µ b,c,dçš„å€¼ï¼ˆB+Treeé‡Œçš„é”®ï¼‰ å·²ç»åœ¨B+Treeé‡Œäº†ï¼Œæ‰€ä»¥å°±å¯ä»¥ç›´æ¥è¿”å›ï¼Œä¸ç”¨å†æ‹¿èšç°‡ç´¢å¼•å»ä¸€çº§B+Treeé‡Œè¿›è¡ŒæŸ¥è¯¢å¦‚æœæŸ¥è¯¢å­—æ®µä¸º a,b,c,d å› ä¸ºaä¸ºä¸»é”®ç´¢å¼•ï¼Œä¹Ÿä¿å­˜å†äºŒçº§B+Treeçš„å¶å­èŠ‚ç‚¹é‡Œï¼Œæ‰€ä»¥ä¹Ÿä¸ç”¨å›è¡¨æŸ¥è¯¢å¦‚æœæŸ¥è¯¢å­—æ®µä¸º a,b,c,d,e å› ä¸ºeæ²¡æœ‰åœ¨è¿™ä¸ªäºŒçº§B+Treeé‡Œï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œå›è¡¨æ“ä½œï¼Œæ‹¿ç€ä¸»é”®ç´¢å¼•å†å»ä¸€çº§B+Treeé‡Œè¿›è¡ŒæŸ¥è¯¢ã€‚ 5ã€B+treeæ—¶é—´å¤æ‚åº¦ï¼šO(logN) B+Treeæ˜¯B-Treeçš„å˜ç§ï¼Œæˆ‘ä»¬ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼‰ä¸º4é˜¶ï¼ˆ4æŒ‡é’ˆ3keyï¼‰çš„b+treeä¸ºä¾‹ æœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°ï¼ŒB+Tree ä¸ B-Treeç›¸æ¯”ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç‚¹åŒºåˆ«ï¼š æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹ã€‚ å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚ éå¶å­èŠ‚ç‚¹ä»…ä»…èµ·åˆ°ç´¢å¼•æ•°æ®ä½œç”¨ï¼Œå…·ä½“çš„æ•°æ®éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ã€‚ MySQLç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„B+Treeè¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸB+Treeçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œåˆ©äºæ’åºã€‚ 6ã€SQLä¼˜åŒ–ï¼ˆæ…¢SQLä¼˜åŒ–ï¼‰ç¬¬ä¸€æ­¥ï¼šå¯ä»¥ç”¨ explain æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ å¸¸è§æ¡ˆä¾‹ä¼˜åŒ–ï¼š 1-1ã€insert insert into tb_test values(1,'tom'); insert into tb_test values(2,'cat'); insert into tb_test values(3,'jerry'); ä¼˜åŒ–ï¼Œé€šè¿‡æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡ start transaction; insert into tb_test values(1,'Tom'),(2,'Cat'),(3,'Jerry'); insert into tb_test values(4,'Tom'),(5,'Cat'),(6,'Jerry'); insert into tb_test values(7,'Tom'),(8,'Cat'),(9,'Jerry'); commit; 1-2ã€å¤§æ‰¹é‡æ’å…¥æ•°æ® -- å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒåŠ ä¸Šå‚æ•° -â€“local-infile mysql â€“-local-infile -u root -p -- è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º1ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³ set global local_infile = 1; -- æ‰§è¡ŒloadæŒ‡ä»¤å°†å‡†å¤‡å¥½çš„æ•°æ®ï¼ŒåŠ è½½åˆ°è¡¨ç»“æ„ä¸­ load data local infile '/root/sql1.log' into table tb_user fields terminated by ',' lines terminated by '\\n' ; ä¸»é”®é¡ºåºæ’å…¥æ€§èƒ½é«˜äºä¹±åºæ’å…¥ 2-1ã€ä¸»é”®ä¼˜åŒ– æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦ã€‚ æ’å…¥æ•°æ®æ—¶ï¼Œå°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨AUTO_INCREMENTè‡ªå¢ä¸»é”®ã€‚ï¼ˆå•è°ƒé€’å¢ï¼Œé«˜å¹¶å‘IDï¼šé›ªèŠ±ç®—æ³•ï¼‰ å°½é‡ä¸è¦ä½¿ç”¨UUIDåšä¸»é”®æˆ–è€…æ˜¯å…¶ä»–è‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å·ã€‚ ä¸šåŠ¡æ“ä½œæ—¶ï¼Œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹ã€‚ 3-1ã€order by ä¼˜åŒ– æ ¹æ®æ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œå¤šå­—æ®µæ’åºæ—¶ï¼Œä¹Ÿéµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚ å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼• å¤šå­—æ®µæ’åº, ä¸€ä¸ªå‡åºä¸€ä¸ªé™åºï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„è”åˆç´¢å¼•åœ¨åˆ›å»ºæ—¶çš„è§„åˆ™ï¼ˆASC/DESCï¼‰ å¦‚æœä¸å¯é¿å…çš„å‡ºç°filesortï¼Œå¤§æ•°æ®é‡æ’åºæ—¶ï¼Œå¯ä»¥é€‚å½“å¢å¤§æ’åºç¼“å†²åŒºå¤§å° sort_buffer_size(é»˜è®¤256k ç§‘æ™®ï¼š 1ã€æœ€å·¦å‰ç¼€æ³•åˆ™ï¼ˆæœ€å·¦åŸåˆ™ï¼‰ï¼š æ¯”å¦‚ï¼Œage å­—æ®µæœ‰ç´¢å¼•ï¼Œphone æ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ’åºçš„æ—¶å€™ï¼Œå…ˆå†™age å†™åœ¨å·¦è¾¹ 2ã€Using filesort and Using index MySQLçš„æ’åºï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š Using filesort : é€šè¿‡è¡¨çš„ç´¢å¼•æˆ–å…¨è¡¨æ‰«æï¼Œè¯»å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œç„¶ååœ¨æ’åºç¼“å†²åŒºsort bufferä¸­å®Œæˆæ’åºæ“ä½œï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å« FileSort æ’åºã€‚ Using index : é€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜ã€‚ å¯¹äºä»¥ä¸Šçš„ä¸¤ç§æ’åºæ–¹å¼ï¼ŒUsing indexçš„æ€§èƒ½é«˜ï¼Œè€ŒUsing filesortçš„æ€§èƒ½ä½ï¼Œæˆ‘ä»¬åœ¨ä¼˜åŒ–æ’åºæ“ä½œæ—¶ï¼Œå°½é‡è¦ä¼˜åŒ–ä¸º Using indexã€‚ 3ã€è¦†ç›–ç´¢å¼•ï¼š å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå‡å°‘select *ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•å‘¢ï¼Ÿè¦†ç›–ç´¢å¼•æ˜¯æŒ‡æŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œä¸”éœ€è¦è¿”å›çš„åˆ—ï¼Œåœ¨è¯¥ç´¢å¼•ä¸­å·²ç»å…¨éƒ¨èƒ½å¤Ÿæ‰¾åˆ° 4-1ã€ group by ** **ä¼˜åŒ– åœ¨åˆ†ç»„æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥æé«˜æ•ˆç‡ åˆ†ç»„æ“ä½œæ—¶ï¼Œç´¢å¼•çš„ä½¿ç”¨ä¹Ÿæ˜¯æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„ 5-1ã€limit ** **ä¼˜åŒ– ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»º è¦†ç›–ç´¢å¼• èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•åŠ å­æŸ¥è¯¢å½¢å¼è¿›è¡Œä¼˜åŒ– explain select * from tb_sku t , (select id from tb_sku order by id limit 2000000,10) a where t.id = a.id; 6-1ã€count ä¼˜åŒ– æŒ‰ç…§æ•ˆç‡æ’åºçš„è¯ï¼Œcount(å­—æ®µ) &lt; count(ä¸»é”® id) &lt; count(1) â‰ˆ count(*)ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨ count(*)ã€‚ 7-1ã€update ä¼˜åŒ– æˆ‘ä»¬ä¸»è¦éœ€è¦æ³¨æ„ä¸€ä¸‹updateè¯­å¥æ‰§è¡Œæ—¶çš„æ³¨æ„äº‹é¡¹ã€‚(åŠ ç´¢å¼•çš„å­—æ®µ) update course set name = 'javaEE' where id = 1 ; å½“æˆ‘ä»¬åœ¨æ‰§è¡Œåˆ é™¤çš„SQLè¯­å¥æ—¶ï¼Œä¼šé”å®šidä¸º1è¿™ä¸€è¡Œçš„æ•°æ®ï¼Œç„¶åäº‹åŠ¡æäº¤ä¹‹åï¼Œè¡Œé”é‡Šæ”¾ã€‚ ä½†æ˜¯å½“æˆ‘ä»¬åœ¨æ‰§è¡Œå¦‚ä¸‹SQLæ—¶ã€‚(æœªåŠ ç´¢å¼•çš„å­—æ®µ) update course set name = 'SpringBoot' where name = 'PHP' ; å½“æˆ‘ä»¬å¼€å¯å¤šä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œä¸Šè¿°çš„SQLæ—¶ï¼Œæˆ‘ä»¬å‘ç°è¡Œé”å‡çº§ä¸ºäº†è¡¨é”ã€‚ å¯¼è‡´è¯¥updateè¯­å¥çš„æ€§èƒ½å¤§å¤§é™ä½ã€‚ InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•åŠ çš„é” ,å¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™ä¼šä»è¡Œé”å‡çº§ä¸ºè¡¨é” ã€‚ 7ã€ç´¢å¼•å¤±æ•ˆ1ã€ç´¢å¼•åˆ—è¿ç®— 2ã€å­—ç¬¦ä¸²ä¸åŠ å¼•å· æˆ‘ä»¬ä¼šæ˜æ˜¾çš„å‘ç°ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ï¼Œå¯¹äºæŸ¥è¯¢ç»“æœï¼Œæ²¡ä»€ä¹ˆå½±å“ï¼Œä½†æ˜¯æ•°æ®åº“å­˜åœ¨éšå¼ç±»å‹è½¬æ¢ï¼Œç´¢å¼•å°†å¤±æ•ˆ 3ã€æ¨¡ç³ŠæŸ¥è¯¢ åœ¨likeæ¨¡ç³ŠæŸ¥è¯¢ä¸­ï¼Œåœ¨å…³é”®å­—åé¢åŠ %ï¼Œç´¢å¼•å¯ä»¥ç”Ÿæ•ˆã€‚è€Œå¦‚æœåœ¨å…³é”®å­—å‰é¢åŠ äº†%ï¼Œç´¢å¼•å°†ä¼šå¤±æ•ˆã€‚ 4ã€or è¿æ¥æ¡ä»¶ å½“orè¿æ¥çš„æ¡ä»¶ï¼Œå·¦å³ä¸¤ä¾§å­—æ®µéƒ½æœ‰ç´¢å¼•æ—¶ï¼Œç´¢å¼•æ‰ä¼šç”Ÿæ•ˆ 5ã€æ•°æ®åˆ†å¸ƒå½±å“ ï¼ˆ1ï¼‰åŸºæœ¬æ•°å€¼ï¼Œæ•°æ®ä¸åŒ MySQLåœ¨æŸ¥è¯¢æ—¶ï¼Œä¼šè¯„ä¼°ä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡ä¸èµ°å…¨è¡¨æ‰«æçš„æ•ˆç‡ï¼Œå¦‚æœèµ°å…¨è¡¨æ‰«ææ›´å¿«ï¼Œåˆ™æ”¾å¼ƒç´¢å¼•ï¼Œèµ°å…¨è¡¨æ‰«æã€‚ å› ä¸ºç´¢å¼•æ˜¯ç”¨æ¥ç´¢å¼•å°‘é‡æ•°æ®çš„ï¼Œå¦‚æœé€šè¿‡ç´¢å¼•æŸ¥è¯¢è¿”å›å¤§æ‰¹é‡çš„æ•°æ®ï¼Œåˆ™è¿˜ä¸å¦‚èµ°å…¨è¡¨æ‰«ææ¥çš„å¿«ï¼Œæ­¤æ—¶ç´¢å¼•å°±ä¼šå¤±æ•ˆ ï¼ˆ2ï¼‰is null ã€ is not null æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åšä¸€ä¸ªæ“ä½œå°†professionå­—æ®µå€¼å…¨éƒ¨æ›´æ–°ä¸ºnullï¼Œå†æ¬¡çœ‹ä¸‹æ‰§è¡Œè®¡åˆ’ æœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°ï¼Œä¸€æ¨¡ä¸€æ ·çš„SQLè¯­å¥ï¼Œå…ˆåæ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œç»“æœæŸ¥è¯¢è®¡åˆ’æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§ ç°è±¡ï¼Œè¿™æ˜¯å’Œæ•°æ®åº“çš„æ•°æ®åˆ†å¸ƒæœ‰å…³ç³»ã€‚æŸ¥è¯¢æ—¶MySQLä¼šè¯„ä¼°ï¼Œèµ°ç´¢å¼•å¿«ï¼Œè¿˜æ˜¯å…¨è¡¨æ‰«æå¿«ï¼Œå¦‚æœå…¨è¡¨æ‰«ææ›´å¿«ï¼Œåˆ™æ”¾å¼ƒç´¢å¼•èµ°å…¨è¡¨æ‰«æã€‚ å› æ­¤ï¼Œis null ã€is not nullæ˜¯å¦èµ°ç´¢å¼•ï¼Œå¾—å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œå¹¶ä¸æ˜¯å›ºå®šçš„ ï¼ˆ3ï¼‰æ€»ç»“ï¼š æ•°æ®åˆ†å¸ƒä¼šæ ¹æ®ç´¢å¼•æ•°æ®é‡å’Œå…¨è¡¨æ‰«æå¿«æ…¢æ¯”è¾ƒï¼Œå“ªä¸ªå¿«èµ°å“ªé‡Œ 8ã€ç´¢å¼•è®¾è®¡åŸåˆ™ é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼Œä¸”æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹çš„è¡¨å»ºç«‹ç´¢å¼•ã€‚ é’ˆå¯¹äºå¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼ˆwhereï¼‰ã€æ’åºï¼ˆorder byï¼‰ã€åˆ†ç»„ï¼ˆgroup byï¼‰æ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼• å°½é‡é€‰æ‹©åŒºåˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•ï¼Œå°½é‡å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜ã€‚ (eg:0,1é‚£ç§çŠ¶æ€ä¸è¦å»ºç«‹ å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå­—æ®µçš„é•¿åº¦è¾ƒé•¿ï¼Œå¯ä»¥é’ˆå¯¹äºå­—æ®µçš„ç‰¹ç‚¹ï¼Œå»ºç«‹å‰ç¼€ç´¢å¼•ã€‚ å°½é‡ä½¿ç”¨è”åˆç´¢å¼•ï¼Œå‡å°‘å•åˆ—ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•å¾ˆå¤šæ—¶å€™å¯ä»¥è¦†ç›–ç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œé¿å…å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡ï¼Œç´¢å¼•å¹¶ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•ç»“æ„çš„ä»£ä»·ä¹Ÿå°±è¶Šå¤§ï¼Œä¼šå½±å“å¢åˆ æ”¹çš„æ•ˆç‡ã€‚ 2|é”å’Œäº‹åŠ¡1ã€äº‹åŠ¡Aå¼€å¯æ‰§è¡Œæ›´æ–°aï¼Œäº‹åŠ¡Bå¼€å¯æ‰§è¡Œåˆ é™¤äº‹åŠ¡bå¹¶ä¸”æäº¤Bäº‹åŠ¡ï¼Œæ­¤æ—¶å†æäº¤Aäº‹åŠ¡ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆ2ã€äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‰ã€MQæ‰§è¡Œæµç¨‹ ã€æ¶ˆæ¯å¯é æ€§æŠ•é€’ï¼ˆç°æœ‰ä¼ä¸šå°è£…äº†ã€‚ã€‚ã€‚ï¼‰-å°æ€»ç»“ã€ 1ã€å¸¸è§„1ã€ä»€ä¹ˆæ˜¯MQï¼Œä¼˜ç¼ºç‚¹æ¶ˆæ¯é˜Ÿåˆ— å¼‚æ­¥å¤„ç†ï¼Œæé«˜ååé‡ åº”ç”¨è§£è€¦ï¼Œæ¯”å¦‚å‘é€çŸ­ä¿¡ æµé‡å‰Šå³°ï¼Œå¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦æ§åˆ¶è¯·æ±‚é‡ å¢åŠ ç³»ç»Ÿå¤æ‚åº¦ï¼Œéœ€è¦ä¿è¯æ¶ˆæ¯ä¸é‡å¤æ¶ˆè´¹ï¼Œä¿è¯ä¸€è‡´æ€§ï¼Œæ¶ˆæ¯å¯é æ€§ 2ã€ä»€ä¹ˆæ˜¯RabbitMqï¼Ÿä¸ºä»€ä¹ˆç”¨ï¼Ÿåº”ç”¨åœºæ™¯ï¼ŸåŸºäºerlangè¯­è¨€å¼€å‘ï¼ŒåŸºäºAMQPåè®®çš„æ¶ˆæ¯ä¸­é—´ä»¶ ç¤¾åŒºæ´»è·ƒï¼Œå›½å†…ä½¿ç”¨çš„å…¬å¸ä¹Ÿå¤šï¼Œååé‡ä¸‡çº§åˆ°åä¸‡çº§åˆ«ï¼Œå®Œå–„çš„ç®¡ç†ç•Œé¢ã€‚æˆç†Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ åº”ç”¨åœºæ™¯ï¼šæœåŠ¡é—´å¼‚æ­¥é€šä¿¡ï¼Œé¡ºåºæ¶ˆè´¹ï¼Œå®šæ—¶ä»»åŠ¡ï¼Œè¯·æ±‚å‰Šå³° 3ã€RabbitMQåŸºæœ¬æ¦‚å¿µ?Exchange äº¤æ¢æœº Queue æ¶ˆæ¯é˜Ÿåˆ— Binding ç»‘å®šï¼Œå°†äº¤æ¢æœºå’Œé˜Ÿåˆ—æŒ‰è·¯ç”±è§„åˆ™ç»‘å®šèµ·æ¥ Routing Key è·¯ç”±å…³é”®å­—ï¼Œexchangeæ ¹æ®è¿™ä¸ªå…³é”®å­—è¿›è¡Œæ¶ˆæ¯æŠ•é€’ VHost ç›¸å½“äºæŸä¸ªæ•°æ®åº“ Producer æ¶ˆæ¯ç”Ÿäº§è€… Consumer æ¶ˆæ¯æ¶ˆè´¹è€… 4ã€RabbitMqå·¥ä½œæ¨¡å¼ï¼Ÿ ç®€å•æ¨¡å¼ HelloWorld ï¼šä¸€ä¸ªç”Ÿäº§è€…ã€ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰ã€‚ å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ Work Queue ï¼šä¸€ä¸ªç”Ÿäº§è€…ã€å¤šä¸ªæ¶ˆè´¹è€…ï¼ˆç«äº‰å…³ç³»ï¼‰ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰ã€‚ å‘å¸ƒè®¢é˜…æ¨¡å¼ Publish/subscribe ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º fanout çš„äº¤æ¢æœºï¼Œå¹¶ä¸”äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šå°†æ¶ˆæ¯å‘é€åˆ°ç»‘å®šçš„é˜Ÿåˆ—ã€‚ è·¯ç”±æ¨¡å¼ Routing ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º direct çš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®š routing keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ® routing key å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚ é€šé…ç¬¦æ¨¡å¼ Topic ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º topic çš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®šé€šé…ç¬¦æ–¹å¼çš„ routing keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ® routing key å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚ 5ã€RabbitMqå¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åºæ€§?ä¸€ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€… 6ã€RabbitMqå¦‚ä½•ä¿è¯æ¶ˆè´¹ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹ï¼Ÿæ ¹æ®ä¸šåŠ¡æ¥ï¼Œæ¯”å¦‚è®¢å•æœ‰çŠ¶æ€ã€‚æˆ–è€…å®šä¹‰å”¯ä¸€æ ‡è¯†ï¼Œæ¶ˆè´¹åç¼“å­˜åˆ°redisã€‚åœ¨æ­¤æ¶ˆè´¹æ—¶å€™åˆ¤æ–­ä¸€ä¸‹redisã€‚ 7ã€RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§?ç”Ÿäº§è€…ä¸¢å¤±æ¶ˆæ¯ï¼š 1.ä½¿ç”¨äº‹åŠ¡æœºåˆ¶ï¼Œç‰ºç‰²æ€§èƒ½ 2.ä½¿ç”¨confirmæ¨¡å¼ï¼Œå‘é€æˆåŠŸä¹‹åï¼Œä¼šè¿”å›ackåˆ°ç”Ÿäº§è€… æ¶ˆæ¯é˜Ÿåˆ—ä¸¢å¤±æ¶ˆæ¯ï¼š 1.æ¶ˆæ¯æŒä¹…åŒ– Exchange è®¾ç½®æŒä¹…åŒ– ,Queue è®¾ç½®æŒä¹…åŒ–ï¼Œdurableè®¾ç½®ä¸ºtrue MessageæŒä¹…åŒ–å‘é€ï¼šå‘é€æ¶ˆæ¯è®¾ç½®å‘é€æ¨¡å¼deliveryMode=2ï¼Œä»£è¡¨æŒä¹…åŒ–æ¶ˆæ¯ æ¶ˆè´¹è€…ä¸¢å¤±æ¶ˆæ¯ 1.ACKç¡®è®¤æœºåˆ¶ æ¶ˆè´¹è€…ç¡®è®¤æ¶ˆè´¹åï¼ŒRabbitMqæ‰ä¼šå°†æ¶ˆæ¯åˆ é™¤ 8ã€RabbitMQéƒ¨ç½²æ–¹å¼?1.å•æœºæ¨¡å¼ 2.æ™®é€šé›†ç¾¤(ä¸»ä») 3.é•œåƒé›†ç¾¤ 9ã€ä»€ä¹ˆæ˜¯RocketMQï¼Ÿjavaå¼€å‘ï¼Œé¢å‘äº’è”ç½‘é›†ç¾¤åŒ–ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œå¯¹åœ¨çº¿ä¸šåŠ¡çš„å“åº”æ—¶å»¶åšäº†å¾ˆå¤šçš„ä¼˜åŒ–ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥åšåˆ°æ¯«ç§’çº§çš„å“åº”ï¼Œæ¯ç§’é’Ÿå¤§æ¦‚èƒ½å¤„ç†å‡ åä¸‡æ¡æ¶ˆæ¯ 10ã€RocketMqå®ç°æ¶ˆæ¯äº‹åŠ¡çš„æµç¨‹ï¼Ÿ1.æœåŠ¡Aå‘é€ä¸€ä¸ªåŠäº‹åŠ¡æ¶ˆæ¯(half æ¶ˆæ¯)åˆ°RocketMqä¸­,ä¿è¯æœåŠ¡Aå’ŒRocketMqæ­£å¸¸é€šä¿¡,æ— æ³•æ­£å¸¸é€šä¿¡åˆ™å›æ»š,æ­£å¸¸åˆ™å¼€å§‹æœ¬åœ°äº‹åŠ¡ï¼Œå¤„ç†æœ¬åœ°ä¸šåŠ¡é€»è¾‘å¹¶æäº¤äº‹åŠ¡. 2.äº‹åŠ¡æäº¤æˆåŠŸåˆ™å‘RocketMqå‘é€æäº¤ï¼Œè¡¨ç¤ºå°† half æ¶ˆæ¯æäº¤ï¼Œå°† half æ¶ˆæ¯å†™å…¥åˆ°ç£ç›˜.äº‹åŠ¡æäº¤å¤±è´¥åˆ™å‘RocketMqå‘é€å›æ»šï¼Œåˆ é™¤ half æ¶ˆæ¯. 3.å¦‚æœRocketMqæŒ‡å®šæ—¶é—´æ²¡æœ‰æ”¶åˆ°æäº¤æˆ–è€…å›æ»šæ¶ˆæ¯ï¼Œå°†å°è¯•è°ƒç”¨æœåŠ¡Aæä¾›çš„ä¸€ä¸ªæ¥å£æ¥åˆ¤æ–­half æ¶ˆæ¯å¯¹äºçš„ä¸šåŠ¡æ˜¯å¦æˆåŠŸï¼ŒæˆåŠŸåˆ™æŒä¹…åŒ–ï¼Œå¤±è´¥åˆ™åˆ é™¤ 4.æœåŠ¡Bæ¶ˆè´¹RocketMqä¸­çš„æ¶ˆæ¯ï¼Œå¤„ç†æœ¬åœ°ä¸šåŠ¡ï¼Œæäº¤äº‹åŠ¡ 11ã€RocketMqçš„half æ¶ˆæ¯æ˜¯ä»€ä¹ˆï¼Ÿhalfæ¶ˆæ¯åªæœ‰è¢«æäº¤åæ‰ä¼šè¢«æ¶ˆè´¹è€…æ¶ˆè´¹ 12ã€ä¸ºä»€ä¹ˆè¦å…ˆå‘é€ half æ¶ˆæ¯ï¼Ÿä¸ºäº†ä¿è¯æœåŠ¡ A å’Œ RocketMqä¹‹é—´æ˜¯å¦èƒ½æ­£å¸¸é€šä¿¡ 13ã€å¦‚æœæœåŠ¡ A æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿæœ¬åœ°äº‹åŠ¡è¿›è¡Œå›æ»šï¼Œåœ¨å‘ RocketMqå‘é€ rollback æ“ä½œã€‚ 14ã€æœåŠ¡ B æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿå¯ä»¥è¿›è¡Œå¤šæ¬¡é‡è¯•ï¼Œç›´åˆ°æˆåŠŸã€‚å¦‚æœé‡è¯•å¤šæ¬¡åï¼Œè¿˜æ˜¯æäº¤å¤±è´¥ï¼Œé‚£ä¹ˆ MQ ä¼šåœ¨ä¸€å®šæ—¶é—´åï¼Œç»§ç»­å°†è¿™æ¡æ¶ˆæ¯æ¨é€ç»™æœåŠ¡ Bï¼ŒæœåŠ¡ B å°±å¯ä»¥ç»§ç»­æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶æäº¤äº†ï¼Œç›´åˆ°æˆåŠŸã€‚ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ 15ã€å¦‚ä½•ä¿è¯RocketMqæ¶ˆæ¯ä¸ä¸¢å¤±?ç”Ÿäº§é˜¶æ®µåªè¦å‘é€è¿”å›okçŠ¶æ€å°±ä»£è¡¨æˆåŠŸ, å¼‚æ­¥å‘é€åœ¨å›è°ƒä¸­å¯ä»¥æ£€æŸ¥å‘é€çŠ¶æ€okå°±ä»£è¡¨æˆåŠŸ, å­˜å‚¨é˜¶æ®µä¿®æ”¹åˆ·ç›˜ç­–ç•¥ä¸ºåŒæ­¥åˆ·ç›˜ã€‚é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥åˆ·ç›˜çš„ã€‚ é›†ç¾¤éƒ¨ç½²ï¼Œä¸€ä¸»å¤šä»ã€‚é»˜è®¤å¼‚æ­¥å¤åˆ¶ï¼Œè®¾ç½®åŒæ­¥å¤åˆ¶ï¼Œç‰ºç‰²æ€§èƒ½ ä¸»èŠ‚ç‚¹è®¾ç½®åŒæ­¥å¤åˆ¶ brokerRole=SYNC_MASTER 2ã€è¿›é˜¶1ã€Rabbitmq æ‰§è¡Œæµç¨‹ Brokerï¼šæ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Serverå°±æ˜¯ Message Broker Virtual hostï¼šå‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠ AMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºç½‘ ç»œä¸­çš„ namespace æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ª RabbitMQ server æä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤š ä¸ªvhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ vhost åˆ›å»º exchangeï¼queue ç­‰ Connectionï¼špublisherï¼consumer å’Œ broker ä¹‹é—´çš„ TCP è¿æ¥ Channelï¼šå¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ª Connectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹ TCP Connection çš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channel æ˜¯åœ¨ connection å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ ç¨‹ï¼Œé€šå¸¸æ¯ä¸ªthreadåˆ›å»ºå•ç‹¬çš„ channel è¿›è¡Œé€šè®¯ï¼ŒAMQP method åŒ…å«äº†channel id å¸®åŠ©å®¢æˆ·ç«¯å’Œ message broker è¯†åˆ« channelï¼Œæ‰€ä»¥ channel ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channel ä½œä¸ºè½»é‡çº§çš„ Connection æå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹ TCP connection çš„å¼€é”€ Exchangeï¼šmessage åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œåˆ†å‘æ¶ˆæ¯åˆ° queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šdirect (point-to-point), topic (publish-subscribe) and fanout (multicast) Queueï¼šæ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾… consumer å–èµ° Bindingï¼šexchange å’Œ queue ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbinding ä¸­å¯ä»¥åŒ…å« routing keyã€‚Binding ä¿¡æ¯è¢«ä¿å­˜åˆ° exchange ä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äº message çš„åˆ†å‘ä¾æ® 2ã€MQæ¶ˆæ¯å¯é æ€§æŠ•é€’0ã€ä¸»è¦å®ç°æ­¥éª¤ ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ æŒä¹…åŒ–ï¼ˆäº¤æ¢æœºï¼Œé˜Ÿåˆ—ï¼Œæ¶ˆæ¯ï¼‰ å¤±è´¥é‡è¯•æœºåˆ¶ æ¶ˆæ¯å †ç§¯é—®é¢˜ 1ã€ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤ ï¼ˆ1ï¼‰publisher-comfirmï¼šæ¶ˆæ¯æˆåŠŸå‘é€åˆ°exchangeï¼Œè¿”å›ackæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæ²¡æœ‰åˆ°è¾¾äº¤æ¢æœºï¼Œè¿”å›nackæ¶ˆæ¯ï¼Œå‘é€è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰æ”¶åˆ°å›æ‰§ ï¼ˆ2ï¼‰æ¶ˆæ¯æˆåŠŸå‘é€åˆ°exchangeï¼Œä½†æ²¡æœ‰è·¯ç”±åˆ°queueï¼Œå›è°ƒReturnCallback ï¼ˆ3ï¼‰ç¡®è®¤æœºåˆ¶å‘é€æ¶ˆæ¯æ—¶ï¼Œéœ€è¦ç»™æ¯ä¸ªæ¶ˆæ¯è®¾ç½®ä¸€ä¸ªå…¨å±€å”¯ä¸€idï¼Œä»¥åŒºåˆ†ä¸åŒæ¶ˆæ¯ï¼Œé¿å…ackå†²çª 2ã€æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ RabbitMQæ˜¯é˜…åå³ç„šæœºåˆ¶ï¼ŒRabbitMQç¡®è®¤æ¶ˆæ¯è¢«æ¶ˆè´¹è€…æ¶ˆè´¹åä¼šç«‹åˆ»åˆ é™¤ã€‚ è€ŒRabbitMQæ˜¯é€šè¿‡æ¶ˆè´¹è€…å›æ‰§æ¥ç¡®è®¤æ¶ˆè´¹è€…æ˜¯å¦æˆåŠŸå¤„ç†æ¶ˆæ¯çš„ï¼šæ¶ˆè´¹è€…è·å–æ¶ˆæ¯åï¼Œåº”è¯¥å‘RabbitMQå‘é€ACKå›æ‰§ï¼Œè¡¨æ˜è‡ªå·±å·²ç»å¤„ç†æ¶ˆæ¯ã€‚ è®¾æƒ³è¿™æ ·çš„åœºæ™¯ï¼š 1ï¼‰RabbitMQæŠ•é€’æ¶ˆæ¯ç»™æ¶ˆè´¹è€… 2ï¼‰æ¶ˆè´¹è€…è·å–æ¶ˆæ¯åï¼Œè¿”å›ACKç»™RabbitMQ 3ï¼‰RabbitMQåˆ é™¤æ¶ˆæ¯ 4ï¼‰æ¶ˆè´¹è€…å®•æœºï¼Œæ¶ˆæ¯å°šæœªå¤„ç† è¿™æ ·ï¼Œæ¶ˆæ¯å°±ä¸¢å¤±äº†ã€‚å› æ­¤æ¶ˆè´¹è€…è¿”å›ACKçš„æ—¶æœºéå¸¸é‡è¦ã€‚ è€ŒSpringAMQPåˆ™å…è®¸é…ç½®ä¸‰ç§ç¡®è®¤æ¨¡å¼ï¼š â€¢manualï¼šæ‰‹åŠ¨ackï¼Œéœ€è¦åœ¨ä¸šåŠ¡ä»£ç ç»“æŸåï¼Œè°ƒç”¨apiå‘é€ackã€‚ â€¢autoï¼šè‡ªåŠ¨ackï¼Œç”±springç›‘æµ‹listenerä»£ç æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰å¼‚å¸¸åˆ™è¿”å›ackï¼›æŠ›å‡ºå¼‚å¸¸åˆ™è¿”å›nack â€¢noneï¼šå…³é—­ackï¼ŒMQå‡å®šæ¶ˆè´¹è€…è·å–æ¶ˆæ¯åä¼šæˆåŠŸå¤„ç†ï¼Œå› æ­¤æ¶ˆæ¯æŠ•é€’åç«‹å³è¢«åˆ é™¤ ç”±æ­¤å¯çŸ¥ï¼š noneæ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯æŠ•é€’æ˜¯ä¸å¯é çš„ï¼Œå¯èƒ½ä¸¢å¤± autoæ¨¡å¼ç±»ä¼¼äº‹åŠ¡æœºåˆ¶ï¼Œå‡ºç°å¼‚å¸¸æ—¶è¿”å›nackï¼Œæ¶ˆæ¯å›æ»šåˆ°mqï¼›æ²¡æœ‰å¼‚å¸¸ï¼Œè¿”å›ack manualï¼šè‡ªå·±æ ¹æ®ä¸šåŠ¡æƒ…å†µï¼Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¯¥ack ä¸€èˆ¬ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨é»˜è®¤çš„autoå³å¯ 3ã€æŒä¹…åŒ– ï¼ˆ1ï¼‰äº¤æ¢æœºæŒä¹…åŒ– RabbitMQä¸­äº¤æ¢æœºé»˜è®¤æ˜¯éæŒä¹…åŒ–çš„ï¼Œmqé‡å¯åå°±ä¸¢å¤±ã€‚ SpringAMQPä¸­å¯ä»¥é€šè¿‡ä»£ç æŒ‡å®šäº¤æ¢æœºæŒä¹…åŒ–ï¼š @Bean public DirectExchange simpleExchange(){ // ä¸‰ä¸ªå‚æ•°ï¼šäº¤æ¢æœºåç§°ã€æ˜¯å¦æŒä¹…åŒ–ã€å½“æ²¡æœ‰queueä¸å…¶ç»‘å®šæ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤ return new DirectExchange(\"simple.direct\", true, false); } äº‹å®ä¸Šï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç”±SpringAMQPå£°æ˜çš„äº¤æ¢æœºéƒ½æ˜¯æŒä¹…åŒ–çš„ã€‚ å¯ä»¥åœ¨RabbitMQæ§åˆ¶å°çœ‹åˆ°æŒä¹…åŒ–çš„äº¤æ¢æœºéƒ½ä¼šå¸¦ä¸ŠDçš„æ ‡ç¤ºï¼š ï¼ˆ2ï¼‰é˜Ÿåˆ—æŒä¹…åŒ– RabbitMQä¸­é˜Ÿåˆ—é»˜è®¤æ˜¯éæŒä¹…åŒ–çš„ï¼Œmqé‡å¯åå°±ä¸¢å¤±ã€‚ SpringAMQPä¸­å¯ä»¥é€šè¿‡ä»£ç æŒ‡å®šäº¤æ¢æœºæŒä¹…åŒ–ï¼š @Bean public Queue simpleQueue(){ // ä½¿ç”¨QueueBuilderæ„å»ºé˜Ÿåˆ—ï¼Œdurableå°±æ˜¯æŒä¹…åŒ–çš„ return QueueBuilder.durable(\"simple.queue\").build(); } äº‹å®ä¸Šï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç”±SpringAMQPå£°æ˜çš„é˜Ÿåˆ—éƒ½æ˜¯æŒä¹…åŒ–çš„ã€‚ å¯ä»¥åœ¨RabbitMQæ§åˆ¶å°çœ‹åˆ°æŒä¹…åŒ–çš„é˜Ÿåˆ—éƒ½ä¼šå¸¦ä¸ŠDçš„æ ‡ç¤ºï¼š ï¼ˆ3ï¼‰æ¶ˆæ¯æŒä¹…åŒ– åˆ©ç”¨SpringAMQPå‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥è®¾ç½®æ¶ˆæ¯çš„å±æ€§ï¼ˆMessagePropertiesï¼‰ï¼ŒæŒ‡å®šdelivery-modeï¼š 1ï¼šéæŒä¹…åŒ– 2ï¼šæŒä¹…åŒ– é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringAMQPå‘å‡ºçš„ä»»ä½•æ¶ˆæ¯éƒ½æ˜¯æŒä¹…åŒ–çš„ï¼Œä¸ç”¨ç‰¹æ„æŒ‡å®šã€‚ 4ã€å¤±è´¥é‡è¯•æœºåˆ¶ æ­¥éª¤ï¼š æœ¬åœ°é‡è¯•æœºåˆ¶ -ã€‹ æ­»ä¿¡é˜Ÿåˆ— 4-1ã€æœ¬åœ°é‡è¯• æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Springçš„retryæœºåˆ¶ï¼Œåœ¨æ¶ˆè´¹è€…å‡ºç°å¼‚å¸¸æ—¶åˆ©ç”¨æœ¬åœ°é‡è¯•ï¼Œè€Œä¸æ˜¯æ— é™åˆ¶çš„requeueåˆ°mqé˜Ÿåˆ—ã€‚ ä¿®æ”¹consumeræœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹ï¼š spring: rabbitmq: listener: simple: retry: enabled: true # å¼€å¯æ¶ˆè´¹è€…å¤±è´¥é‡è¯• initial-interval: 1000ms # åˆå§‹çš„å¤±è´¥ç­‰å¾…æ—¶é•¿ä¸º1ç§’ multiplier: 1 # å¤±è´¥çš„ç­‰å¾…æ—¶é•¿å€æ•°ï¼Œä¸‹æ¬¡ç­‰å¾…æ—¶é•¿ = multiplier * last-interval max-attempts: 3 # æœ€å¤§é‡è¯•æ¬¡æ•° stateless: true # trueæ— çŠ¶æ€ï¼›falseæœ‰çŠ¶æ€ã€‚å¦‚æœä¸šåŠ¡ä¸­åŒ…å«äº‹åŠ¡ï¼Œè¿™é‡Œæ”¹ä¸ºfalse ç»“è®ºï¼š å¼€å¯æœ¬åœ°é‡è¯•æ—¶ï¼Œæ¶ˆæ¯å¤„ç†è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ä¼šrequeueåˆ°é˜Ÿåˆ—ï¼Œè€Œæ˜¯åœ¨æ¶ˆè´¹è€…æœ¬åœ°é‡è¯• é‡è¯•è¾¾åˆ°æœ€å¤§æ¬¡æ•°åï¼ŒSpringä¼šè¿”å›ackï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒ 4-2ã€å¤±è´¥ç­–ç•¥ åœ¨ä¹‹å‰çš„æµ‹è¯•ä¸­ï¼Œè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™æ˜¯ç”±Springå†…éƒ¨æœºåˆ¶å†³å®šçš„ã€‚ åœ¨å¼€å¯é‡è¯•æ¨¡å¼åï¼Œé‡è¯•æ¬¡æ•°è€—å°½ï¼Œå¦‚æœæ¶ˆæ¯ä¾ç„¶å¤±è´¥ï¼Œåˆ™éœ€è¦æœ‰MessageRecoveryæ¥å£æ¥å¤„ç†ï¼Œå®ƒåŒ…å«ä¸‰ç§ä¸åŒçš„å®ç°ï¼š RejectAndDontRequeueRecovererï¼šé‡è¯•è€—å°½åï¼Œç›´æ¥rejectï¼Œä¸¢å¼ƒæ¶ˆæ¯ã€‚é»˜è®¤å°±æ˜¯è¿™ç§æ–¹å¼ ImmediateRequeueMessageRecovererï¼šé‡è¯•è€—å°½åï¼Œè¿”å›nackï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ RepublishMessageRecovererï¼šé‡è¯•è€—å°½åï¼Œå°†å¤±è´¥æ¶ˆæ¯æŠ•é€’åˆ°æŒ‡å®šçš„äº¤æ¢æœºï¼ˆæ­»ä¿¡ï¼Œæƒ°æ€§ï¼Œå¼‚å¸¸äº¤æ¢æœºï¼‰ æ¯”è¾ƒä¼˜é›…çš„ä¸€ç§å¤„ç†æ–¹æ¡ˆæ˜¯RepublishMessageRecovererï¼Œå¤±è´¥åå°†æ¶ˆæ¯æŠ•é€’åˆ°ä¸€ä¸ªæŒ‡å®šçš„ï¼Œä¸“é—¨å­˜æ”¾å¼‚å¸¸æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œåç»­ç”±äººå·¥é›†ä¸­å¤„ç†ã€‚ 1ï¼‰åœ¨consumeræœåŠ¡ä¸­å®šä¹‰å¤„ç†å¤±è´¥æ¶ˆæ¯çš„äº¤æ¢æœºå’Œé˜Ÿåˆ— @Bean public DirectExchange errorMessageExchange(){ return new DirectExchange(\"error.direct\"); } @Bean public Queue errorQueue(){ return new Queue(\"error.queue\", true); } @Bean public Binding errorBinding(Queue errorQueue, DirectExchange errorMessageExchange){ return BindingBuilder.bind(errorQueue).to(errorMessageExchange).with(\"error\"); } 2ï¼‰å®šä¹‰ä¸€ä¸ªRepublishMessageRecovererï¼Œå…³è”é˜Ÿåˆ—å’Œäº¤æ¢æœº @Bean public MessageRecoverer republishMessageRecoverer(RabbitTemplate rabbitTemplate){ return new RepublishMessageRecoverer(rabbitTemplate, \"error.direct\", \"error\"); } 4-3ã€æ­»ä¿¡é˜Ÿåˆ— ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä¼šæˆä¸ºæ­»ä¿¡ï¼Ÿ æ¶ˆæ¯è¢«æ¶ˆè´¹è€…rejectæˆ–è€…è¿”å›nack ï¼Œæ‹’ç» æ¶ˆæ¯è¶…æ—¶æœªæ¶ˆè´¹ï¼ˆTTLï¼‰ æ™®é€šé˜Ÿåˆ—æ»¡äº†ï¼ˆå¯æŒ‡å®šåˆ°æ­»ä¿¡ï¼Œä¸æ˜¯ä¸€å®šæ­»ä¿¡ä¹Ÿå¯ä»¥æ˜¯æƒ°æ€§ï¼‰ å¦‚æœè¿™ä¸ªåŒ…å«æ­»ä¿¡çš„é˜Ÿåˆ—é…ç½®äº†dead-letter-exchangeå±æ€§ï¼ŒæŒ‡å®šäº†ä¸€ä¸ªäº¤æ¢æœºï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¸­çš„æ­»ä¿¡å°±ä¼šæŠ•é€’åˆ°è¿™ä¸ªäº¤æ¢æœºä¸­ï¼Œè€Œè¿™ä¸ªäº¤æ¢æœºç§°ä¸ºæ­»ä¿¡äº¤æ¢æœºï¼ˆDead Letter Exchangeï¼Œæ£€æŸ¥DLXï¼‰ é˜Ÿåˆ—å°†æ­»ä¿¡æŠ•é€’ç»™æ­»ä¿¡äº¤æ¢æœºæ—¶ï¼Œå¿…é¡»çŸ¥é“ä¸¤ä¸ªä¿¡æ¯ï¼š æ­»ä¿¡äº¤æ¢æœºåç§° æ­»ä¿¡äº¤æ¢æœºä¸æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šçš„RoutingKey è¿™æ ·æ‰èƒ½ç¡®ä¿æŠ•é€’çš„æ¶ˆæ¯èƒ½åˆ°è¾¾æ­»ä¿¡äº¤æ¢æœºï¼Œå¹¶ä¸”æ­£ç¡®çš„è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚ 4-4ã€æ­»ä¿¡ä½œä¸ºé‡è¯•æœºåˆ¶ç­–ç•¥ åœ¨å¤±è´¥é‡è¯•ç­–ç•¥ä¸­ï¼Œé»˜è®¤çš„RejectAndDontRequeueRecovererä¼šåœ¨æœ¬åœ°é‡è¯•æ¬¡æ•°è€—å°½åï¼Œå‘é€rejectç»™RabbitMQï¼Œæ¶ˆæ¯å˜æˆæ­»ä¿¡ï¼Œè¢«ä¸¢å¼ƒã€‚ æˆ‘ä»¬å¯ä»¥ç»™simple.queueæ·»åŠ ä¸€ä¸ªæ­»ä¿¡äº¤æ¢æœºï¼Œç»™æ­»ä¿¡äº¤æ¢æœºç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ã€‚è¿™æ ·æ¶ˆæ¯å˜æˆæ­»ä¿¡åä¹Ÿä¸ä¼šä¸¢å¼ƒï¼Œè€Œæ˜¯æœ€ç»ˆæŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœºï¼Œè·¯ç”±åˆ°ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—ã€‚ // å£°æ˜æ™®é€šçš„ simple.queueé˜Ÿåˆ—ï¼Œå¹¶ä¸”ä¸ºå…¶æŒ‡å®šæ­»ä¿¡äº¤æ¢æœºï¼šdl.direct @Bean public Queue simpleQueue2(){ return QueueBuilder.durable(\"simple.queue\") // æŒ‡å®šé˜Ÿåˆ—åç§°ï¼Œå¹¶æŒä¹…åŒ– .deadLetterExchange(\"dl.direct\") // æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº .build(); } // å£°æ˜æ­»ä¿¡äº¤æ¢æœº dl.direct @Bean public DirectExchange dlExchange(){ return new DirectExchange(\"dl.direct\", true, false); } // å£°æ˜å­˜å‚¨æ­»ä¿¡çš„é˜Ÿåˆ— dl.queue @Bean public Queue dlQueue(){ return new Queue(\"dl.queue\", true); } // å°†æ­»ä¿¡é˜Ÿåˆ— ä¸ æ­»ä¿¡äº¤æ¢æœºç»‘å®š @Bean public Binding dlBinding(){ return BindingBuilder.bind(dlQueue()).to(dlExchange()).with(\"simple\"); } æ¶ˆè´¹è€…ç¡®è®¤æ¨¡å¼: auto acknowledge-mode: auto ç‰¹å¾: å½“æ¶ˆæ¯ä¸èƒ½è¢«æ¶ˆè´¹æ—¶,ä¼šé‡æ–°å…¥é˜Ÿ,å†æ¬¡æŠ•é€’ç»™æ¶ˆè´¹è€…è¿›è¡Œè¢«æ¶ˆè´¹ default-requeue-rejected: false # æ‹’ç»æ¶ˆæ¯é‡æ–°å…¥é˜Ÿ,å¦‚æœé˜Ÿåˆ—ç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœºåˆ™æ¶ˆæ¯ä¼šæŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœºå¹¶è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ— æœ¬åœ°é‡è¯•ï¼šåº•ä¸‹æ˜¯ä¸‰ç§æ–¹æ¡ˆï¼Œä¸æ˜¯ä¸‰ä¸ªæ­¥éª¤ï¼Œéœ€è¦æ³¨æ„ â€‹ å½“æœ¬åœ°é‡è¯•æ¬¡æ•°è€—å°½æ—¶,å¦‚æœå½“å‰é˜Ÿåˆ—æ²¡æœ‰ç»‘å®šæ­»ä¿¡äº¤æ¢æœºæˆ–é”™è¯¯é˜Ÿåˆ—,åˆ™æ¶ˆæ¯ä¸¢å¼ƒâ€‹ å¦‚æœæä¾›äº†å¼‚å¸¸é˜Ÿåˆ—,åˆ™æ¶ˆæ¯æŠ•é€’åˆ°å¼‚å¸¸å¯¹è±¡â€‹ å¦‚æœé˜Ÿåˆ—ç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœº,åˆ™æ¶ˆæ¯ä»¥æ­»ä¿¡çš„å½¢å¼å­˜æ”¾åˆ°æ­»ä¿¡é˜Ÿåˆ— 5ã€æƒ°æ€§é˜Ÿåˆ— 5-1ã€å †ç§¯é—®é¢˜ å½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦è¶…è¿‡äº†æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå°±ä¼šå¯¼è‡´é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å †ç§¯ï¼Œç›´åˆ°é˜Ÿåˆ—å­˜å‚¨æ¶ˆæ¯è¾¾åˆ°ä¸Šé™ã€‚ä¹‹åå‘é€çš„æ¶ˆæ¯å°±ä¼šæˆä¸ºæ­»ä¿¡ï¼Œå¯èƒ½ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™å°±æ˜¯æ¶ˆæ¯å †ç§¯é—®é¢˜ã€‚ è§£å†³æ¶ˆæ¯å †ç§¯æ€è·¯ï¼š å¢åŠ æ›´å¤šæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è¯´çš„work queueæ¨¡å¼ åœ¨æ¶ˆè´¹è€…å†…å¼€å¯çº¿ç¨‹æ± åŠ å¿«æ¶ˆæ¯å¤„ç†é€Ÿåº¦ æ‰©å¤§é˜Ÿåˆ—å®¹ç§¯ï¼Œæé«˜å †ç§¯ä¸Šé™ 5-2ã€æƒ°æ€§é˜Ÿåˆ— ä»RabbitMQçš„3.6.0ç‰ˆæœ¬å¼€å§‹ï¼Œå°±å¢åŠ äº†Lazy Queuesçš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯æƒ°æ€§é˜Ÿåˆ—ã€‚æƒ°æ€§é˜Ÿåˆ—çš„ç‰¹å¾å¦‚ä¸‹ï¼š æ¥æ”¶åˆ°æ¶ˆæ¯åç›´æ¥å­˜å…¥ç£ç›˜è€Œéå†…å­˜ æ¶ˆè´¹è€…è¦æ¶ˆè´¹æ¶ˆæ¯æ—¶æ‰ä¼šä»ç£ç›˜ä¸­è¯»å–å¹¶åŠ è½½åˆ°å†…å­˜ æ”¯æŒæ•°ç™¾ä¸‡æ¡çš„æ¶ˆæ¯å­˜å‚¨ 5-2-1ã€åŸºäºå‘½ä»¤è¡Œè®¾ç½®lazy-queue è€Œè¦è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—ä¸ºæƒ°æ€§é˜Ÿåˆ—ï¼Œåªéœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—æ—¶ï¼ŒæŒ‡å®šx-queue-modeå±æ€§ä¸ºlazyå³å¯ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå°†ä¸€ä¸ªè¿è¡Œä¸­çš„é˜Ÿåˆ—ä¿®æ”¹ä¸ºæƒ°æ€§é˜Ÿåˆ—ï¼š rabbitmqctl set_policy Lazy \"^simple.queue$\" '{\"queue-mode\":\"lazy\"}' --apply-to queues å‘½ä»¤è§£è¯»ï¼š rabbitmqctl ï¼šRabbitMQçš„å‘½ä»¤è¡Œå·¥å…· set_policy ï¼šæ·»åŠ ä¸€ä¸ªç­–ç•¥ Lazy ï¼šç­–ç•¥åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰ \"^lazy-queue$\" ï¼šç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é˜Ÿåˆ—çš„åå­— '{\"queue-mode\":\"lazy\"}' ï¼šè®¾ç½®é˜Ÿåˆ—æ¨¡å¼ä¸ºlazyæ¨¡å¼ --apply-to queuesï¼šç­–ç•¥çš„ä½œç”¨å¯¹è±¡ï¼Œæ˜¯æ‰€æœ‰çš„é˜Ÿåˆ— 5-2-2ã€åŸºäº@Beanå£°æ˜lazy-queue 5-2-3ã€åŸºäº@RabbitListenerå£°æ˜LazyQueue å°ç»“ï¼š æ¶ˆæ¯å †ç§¯é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Ÿ é˜Ÿåˆ—ä¸Šç»‘å®šå¤šä¸ªæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦ ä½¿ç”¨æƒ°æ€§é˜Ÿåˆ—ï¼Œå¯ä»¥å†mqä¸­ä¿å­˜æ›´å¤šæ¶ˆæ¯ æƒ°æ€§é˜Ÿåˆ—çš„ä¼˜ç‚¹æœ‰å“ªäº›ï¼Ÿ åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯ä¸Šé™é«˜ æ²¡æœ‰é—´æ­‡æ€§çš„page-outï¼Œæ€§èƒ½æ¯”è¾ƒç¨³å®š æƒ°æ€§é˜Ÿåˆ—çš„ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿ åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯æ—¶æ•ˆæ€§ä¼šé™ä½ æ€§èƒ½å—é™äºç£ç›˜çš„IO å››ã€Redisç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€åå¤§æ•°æ®ç»“æ„ 1ã€å¸¸è§„ï¼ˆæ”¾æ¾ç‰ˆï¼‰1ã€redisæœ‰å“ªäº›æ•°æ®ç»“æ„?å­—ç¬¦ä¸²Stringã€å­—å…¸Hashã€åˆ—è¡¨Listã€é›†åˆSetã€æœ‰åºé›†åˆSortedSet HyperLogLog ï¼šç½‘ç«™çš„UVç»Ÿè®¡ Geoï¼šè·å–ä½ç½®çš„è·ç¦» Bitmap:ä½å›¾ Streamï¼šæ¶ˆæ¯é˜Ÿåˆ— 2ã€ä¸ºä»€ä¹ˆè¦ç”¨redis?å¯ä»¥åšç¼“å­˜ï¼Œè€—æ—¶é—´çš„sqlï¼Œä¸”ä¸é¢‘ç¹å˜åŠ¨çš„å¯ä»¥ç¼“å­˜åˆ°redisï¼Œæé«˜å“åº”é€Ÿåº¦ æé«˜å¹¶å‘ï¼Œå¤§é‡çš„è¯·æ±‚å…ˆè¯·æ±‚åˆ°redisï¼Œè€Œä¸æ˜¯ç›´æ¥è¯·æ±‚åˆ°æ•°æ®åº“ å¯ä»¥åšåˆ†å¸ƒå¼é”ã€‚ 3ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”ï¼Ÿsetnxæ¥è·å–é”ï¼Œexpireæ¥æ·»åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢èµ„æºå ç”¨è¿‡ä¹… 4ã€æ‰¾å‡ºredisä¸­ä»¥æŸä¸ªå‰ç¼€å¼€å¤´çš„å¤§é‡çš„keyï¼Ÿkeys xx* ä½¿ç”¨keysä¼šé€ æˆé˜»å¡ scan 0 match key1111* count 20 ä¸ä¼šé€ æˆé˜»å¡ 5ã€å¦‚ä½•ä½¿ç”¨redisåšæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿlistç»“æ„ä½œä¸ºé˜Ÿåˆ—ï¼Œrpushç”Ÿäº§æ¶ˆæ¯ï¼Œlpopæ¶ˆè´¹æ¶ˆæ¯ï¼Œéœ€è¦è‡ªå·±å®ç°é˜»å¡ã€‚blpopæ²¡æœ‰æ¶ˆæ¯ä¼šé˜»å¡ï¼Œç­‰åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚ 6ã€å¤§é‡çš„keyåœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿrediså¯èƒ½ä¼šå‡ºç°å¡é¡¿ç°è±¡ï¼Œå¹¶å‘é‡å¤§å¯èƒ½å‡ºç°ç¼“å­˜é›ªå´©ï¼Œå¯ä»¥åœ¨è¿‡æœŸæ—¶é—´æ·»åŠ ä¸€ä¸ªéšæœºæ•° 7ã€ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Œç¼“å­˜å‡»ç©¿ï¼Ÿç¼“å­˜ç©¿é€ï¼šå¯¹ç©ºå€¼ç¼“å­˜ï¼Œè®¾ç½®å¯è®¿é—®çš„åå•ï¼ˆç™½åå•ï¼‰ï¼Œé‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ ç¼“å­˜å‡»ç©¿: ä¸€ä¸ªkeyè¿‡æœŸæ—¶ï¼Œå¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ã€‚åŠ äº’æ–¥é”å’Œçƒ­ç‚¹æ•°æ®ä¸è¿‡æœŸã€‚ 8ã€redisçš„çº¿ç¨‹æ¨¡å‹ï¼Ÿredisä½¿ç”¨æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„ï¼Œé‡‡ç”¨ioå¤šè·¯å¤ç”¨ç¨‹åºç›‘å¬å¤šä¸ªsocketï¼Œ å°†äº§ç”Ÿäº‹ä»¶çš„socketå‹å…¥å†…å­˜é˜Ÿåˆ—ï¼Œäº‹ä»¶åˆ†æ´¾å™¨æ ¹æ®äº‹ä»¶ç±»å‹é€‰æ‹©å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚ 9ã€redis ä¸ºä»€ä¹ˆä½¿ç”¨å•è¿›ç¨‹ã€å•çº¿ç¨‹ä¹Ÿå¾ˆå¿«?1.åŸºäºå†…å­˜çš„æ“ä½œ 2.ä½¿ç”¨äº† I/O å¤šè·¯å¤ç”¨æ¨¡å‹ 3.å•çº¿ç¨‹å¯ä»¥é¿å…ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ 10ã€redisè¿‡æœŸç­–ç•¥?å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤ã€‚ å®šæœŸåˆ é™¤ï¼šæ¯éš”ä¸€æ®µæ—¶é—´åˆ é™¤ æƒ°æ€§åˆ é™¤ï¼šè·å–çš„æ—¶å€™åˆ¤æ–­æ˜¯å¦è¿‡æœŸ 11ã€redisçš„å†…å­˜æ·˜æ±°æœºåˆ¶ï¼Ÿ noeviction: å½“å†…å­˜ä¸è¶³æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ allkeys-lruï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ keyï¼ˆè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼‰ã€‚ allkeys-randomï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œéšæœºç§»é™¤æŸä¸ª keyã€‚ volatile-lruï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ keyã€‚ volatile-randomï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ª keyã€‚ volatile-ttlï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œæœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„ key ä¼˜å…ˆç§»é™¤ 12ã€redis çš„æŒä¹…åŒ–æœ‰å“ªå‡ ç§æ–¹å¼ï¼ŸRdbï¼šrdbä¼šå‘¨æœŸæ€§å¯¹redisçš„æ•°æ®è¿›è¡ŒæŒä¹…åŒ– Aofï¼šå°†æ¯æ¡å†™å…¥å‘½ä»¤å†™å…¥æ—¥å¿—ä¸­ï¼Œåœ¨redisé‡å¯çš„æ—¶å€™é€šè¿‡æ—¥å¿—æ–‡ä»¶é‡æ„æ•°æ® Rdbä¼šäº§ç”Ÿå¤šä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶ä»£è¡¨æŸä¸€ä¸ªæ—¶åˆ»çš„redisæ•°æ®ã€‚å¯¹äºaofæ¥è¯´ï¼ŒåŸºäºrdbæ¢å¤æ•°æ®ä¼šæ›´å¿«ã€‚ redis æ•…éšœRdbä¼šä¸¢å¤±æ›´å¤šçš„æ•°æ®ï¼ŒRdbå¿«ç…§éƒ½æ˜¯éš”5åˆ†é’Ÿæˆ–è€…æ›´é•¿æ—¶é—´ç”Ÿæˆï¼Œè€Œaofæ¯éš”ä¸€ç§’å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥åªä¼šä¸¢å¤±ä¸€ç§’é’Ÿçš„æ•°æ®ã€‚ 13ã€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´ï¼Ÿè¯»çš„æ—¶å€™å…ˆè¯»ç¼“å­˜ï¼Œæ²¡æœ‰çš„è¯è¯»æ•°æ®åº“ï¼Œæ”¾å…¥ç¼“å­˜ï¼Œè¿”å›ç»“æœã€‚æ›´æ–°çš„æ—¶å€™å…ˆæ›´æ–°æ•°æ®åº“ï¼Œç„¶ååˆ é™¤ç¼“å­˜ã€‚ ä¸ºä»€ä¹ˆæ˜¯åˆ é™¤è€Œä¸æ˜¯æ›´æ–°? å› ä¸ºæ›´æ–°å¯èƒ½æ˜¯æ›´æ–°ä¸€ä¸ªæˆ–å‡ ä¸ªå­—æ®µï¼Œç¼“å­˜å¯èƒ½ç¼“å­˜çš„æ˜¯ä¸€ä¸ªç»“æœé›†ã€‚ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œåœ¨åˆ é™¤ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜åˆ é™¤å¤±è´¥ï¼Ÿ è§£å†³æ–¹æ¡ˆ:å…ˆåˆ é™¤ç¼“å­˜ï¼Œåœ¨åˆ é™¤æ•°æ®åº“ï¼Œåˆ é™¤æ•°æ®åº“å¤±è´¥é‚£æ•°æ®è¿˜æ˜¯æ²¡å˜ã€‚ 14ã€redis çš„å¹¶å‘ç«äº‰é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿäº†è§£redis äº‹åŠ¡çš„ CAS æ–¹æ¡ˆå—ï¼Ÿå¤šä¸ªå®¢æˆ·ç«¯åŒäº‹å†™ä¸€ä¸ªkeyï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´ rediså¤©ç„¶æ”¯æŒä¹è§‚é” watch ç›‘æ§keyï¼Œmultiå¼€å§‹äº‹åŠ¡,åœ¨æ‰§è¡Œexecå‘½ä»¤å‰å€¼è¢«ä¿®æ”¹åˆ™ä¼šå›æ»šã€‚ 15ã€Redis çš„ LRU ç®—æ³•æ€ä¹ˆå®ç°çš„?æ‹¿åˆ°nä¸ªkeyï¼Œå’Œç¼“å†²æ± ä¸­çš„keyæ¯”è¾ƒæœ€å¤§ç©ºé—²æ—¶é—´ï¼Œæ¯”ç¼“å­˜æ± çš„keyæœ€å¤§ç©ºé—²æ—¶é—´è¿˜å¤§ï¼Œåˆ™æ›¿æ¢ç¼“å­˜æ± çš„keyï¼Œç„¶åä»ç¼“å­˜æ± ä¸­ç§»é™¤æœ€å¤§ç©ºé—²æ—¶é—´çš„keyã€‚ 16ã€Redis æ€ä¹ˆä¿è¯é«˜å¯ç”¨ã€æœ‰å“ªäº›é›†ç¾¤æ¨¡å¼ï¼Ÿä¸»ä»ï¼Œå“¨å…µï¼Œé›†ç¾¤ 1.ä¸»ä»å¤åˆ¶ 1.å¼€å¯é…ç½® åœ¨ slave ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šslaveof åœ¨ slave é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ï¼šslaveof ä½¿ç”¨å¯åŠ¨å‘½ä»¤ï¼šâ€“slaveof 2.å»ºç«‹å¥—æ¥å­—(socket)è¿æ¥ 3.å‘é€PINGå‘½ä»¤ 4.èº«ä»½éªŒè¯ 5.å‘é€CAPA(åŒæ­¥å¤åˆ¶çš„èƒ½åŠ›) 6.æ•°æ®åŒæ­¥ 7.å‘½ä»¤ä¼ æ’­ å‡ºç°æ•…éšœéœ€è¦æ‰‹åŠ¨æ›´æ”¹é…ç½® 2.å“¨å…µ å“¨å…µï¼ˆSentinelï¼‰ æ˜¯ Redis çš„é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆï¼Œç”±å¤šä¸ªå“¨å…µç›‘æ§ä¸»æœåŠ¡å™¨ã€‚ç›‘æ§çš„ä¸»æœåŠ¡å™¨æ•…éšœçš„æ—¶å€™ï¼Œå¯ä»¥å°†ä»æœåŠ¡å™¨å‡çº§ä¸ºä¸»æœåŠ¡å™¨ 3.é›†ç¾¤ å“¨å…µæ¨¡å¼çš„ç¼ºç‚¹å°±æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½æ”¾åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œæ— æ³•æ¯”è¾ƒå¥½çš„è¿›è¡Œæ°´å¹³æ‰©å±•ã€‚ é›†ç¾¤æ¨¡å¼ï¼š å»ä¸­å¿ƒåŒ–ï¼Œå°†æ•°æ®æŒ‰æ§½å­˜å‚¨åˆ†å¸ƒåœ¨å¤šä¸ª Redis èŠ‚ç‚¹ä¸Šã€‚é›†ç¾¤å…±æœ‰ 16384 ä¸ªæ§½ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å¤„ç†éƒ¨åˆ†æ§½ã€‚ æ‰€æœ‰çš„ Redis èŠ‚ç‚¹å½¼æ­¤äº’è”ï¼Œé€šè¿‡ PING-PONG æœºåˆ¶æ¥è¿›è¡ŒèŠ‚ç‚¹é—´çš„å¿ƒè·³æ£€æµ‹ã€‚ ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œä»èŠ‚ç‚¹å‘æ‰€æœ‰æœ‰æŠ•ç¥¨çš„ä¸»èŠ‚ç‚¹å‘èµ·é€‰ä¸¾ï¼Œè·å¾—ç¥¨æ•°&gt;2n+1åˆ™å‡çº§ä¸ºä¸»èŠ‚ç‚¹. 2ã€äºŒé˜¶ï¼ˆæ•£è£…ï¼‰â€”â€”â€”æ¦‚è¿°â€”â€”â€”-1ã€Redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ è¯»å†™æ€§èƒ½ä¼˜å¼‚ï¼Œ Redisèƒ½è¯»çš„é€Ÿåº¦æ˜¯110000æ¬¡/sï¼Œå†™çš„é€Ÿåº¦æ˜¯81000æ¬¡/sã€‚ æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œæ”¯æŒAOFå’ŒRDBä¸¤ç§æŒä¹…åŒ–æ–¹å¼ã€‚ æ”¯æŒäº‹åŠ¡ï¼ŒRedisçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼ŒåŒæ—¶Redisè¿˜æ”¯æŒå¯¹å‡ ä¸ªæ“ä½œåˆå¹¶åçš„åŸå­æ€§æ‰§è¡Œã€‚ æ•°æ®ç»“æ„ä¸°å¯Œï¼Œé™¤äº†æ”¯æŒstringç±»å‹çš„valueå¤–è¿˜æ”¯æŒhashã€setã€zsetã€listç­‰æ•°æ®ç»“æ„ã€‚ æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œä¸»æœºä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æœºï¼Œå¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚ ç¼ºç‚¹ æ•°æ®åº“å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œä¸èƒ½ç”¨ä½œæµ·é‡æ•°æ®çš„é«˜æ€§èƒ½è¯»å†™ï¼Œå› æ­¤Redisé€‚åˆçš„åœºæ™¯ä¸»è¦å±€é™åœ¨è¾ƒå°æ•°æ®é‡çš„é«˜æ€§èƒ½æ“ä½œå’Œè¿ç®—ä¸Šã€‚ Redis ä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œä¸»æœºä»æœºçš„å®•æœºéƒ½ä¼šå¯¼è‡´å‰ç«¯éƒ¨åˆ†è¯»å†™è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…æœºå™¨é‡å¯æˆ–è€…æ‰‹åŠ¨åˆ‡æ¢å‰ç«¯çš„IPæ‰èƒ½æ¢å¤ã€‚ ä¸»æœºå®•æœºï¼Œå®•æœºå‰æœ‰éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»æœºï¼Œåˆ‡æ¢IPåè¿˜ä¼šå¼•å…¥æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ Redis è¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ä¸ºé¿å…è¿™ä¸€é—®é¢˜ï¼Œè¿ç»´äººå‘˜åœ¨ç³»ç»Ÿä¸Šçº¿æ—¶å¿…é¡»ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œè¿™å¯¹èµ„æºé€ æˆäº†å¾ˆå¤§çš„æµªè´¹ã€‚ 2ã€ä¸ºä»€ä¹ˆè¦ç”¨ Redis /ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ä¸»è¦ä»â€œé«˜æ€§èƒ½â€å’Œâ€œé«˜å¹¶å‘â€è¿™ä¸¤ç‚¹æ¥çœ‹å¾…è¿™ä¸ªé—®é¢˜ã€‚ é«˜æ€§èƒ½ï¼šå‡å¦‚ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æ•°æ®åº“ä¸­çš„æŸäº›æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šæ¯”è¾ƒæ…¢ï¼Œå› ä¸ºæ˜¯ä»ç¡¬ç›˜ä¸Šè¯»å–çš„ã€‚å°†è¯¥ç”¨æˆ·è®¿é—®çš„æ•°æ®å­˜åœ¨æ•°ç¼“å­˜ä¸­ï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡å†è®¿é—®è¿™äº›æ•°æ®çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–äº†ã€‚æ“ä½œç¼“å­˜å°±æ˜¯ç›´æ¥æ“ä½œå†…å­˜ï¼Œæ‰€ä»¥é€Ÿåº¦ç›¸å½“å¿«ã€‚å¦‚æœæ•°æ®åº“ä¸­çš„å¯¹åº”æ•°æ®æ”¹å˜çš„ä¹‹åï¼ŒåŒæ­¥æ”¹å˜ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å³å¯ï¼ é«˜å¹¶å‘ï¼šç›´æ¥æ“ä½œç¼“å­˜èƒ½å¤Ÿæ‰¿å—çš„è¯·æ±‚æ˜¯è¿œè¿œå¤§äºç›´æ¥è®¿é—®æ•°æ®åº“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠæ•°æ®åº“ä¸­çš„éƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç¼“å­˜ä¸­å»ï¼Œè¿™æ ·ç”¨æˆ·çš„ä¸€éƒ¨åˆ†è¯·æ±‚ä¼šç›´æ¥åˆ°ç¼“å­˜è¿™é‡Œè€Œä¸ç”¨ç»è¿‡æ•°æ®åº“ã€‚ï¼ˆç”¨æˆ·ä¼šè¯ä¿¡æ¯ï¼Œå­—å…¸æ•°æ®ï¼Œç½‘å…³é»‘ç™½åå•â€¦ï¼‰ 3ã€ä¸ºä»€ä¹ˆè¦ç”¨ Redis è€Œä¸ç”¨ map/guava åšç¼“å­˜?ç¼“å­˜åˆ†ä¸ºæœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ã€‚ä»¥ Java ä¸ºä¾‹ï¼Œä½¿ç”¨è‡ªå¸¦çš„ map æˆ–è€… guava å®ç°çš„æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œæœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯è½»é‡ä»¥åŠå¿«é€Ÿï¼Œç”Ÿå‘½å‘¨æœŸéšç€ jvm çš„é”€æ¯è€Œç»“æŸï¼Œå¹¶ä¸”åœ¨å¤šå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½éœ€è¦å„è‡ªä¿å­˜ä¸€ä»½ç¼“å­˜ï¼Œç¼“å­˜ä¸å…·æœ‰ä¸€è‡´æ€§ã€‚ ä½¿ç”¨ redis æˆ– memcached ä¹‹ç±»çš„ç§°ä¸ºåˆ†å¸ƒå¼ç¼“å­˜ï¼Œåœ¨å¤šå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œå„å®ä¾‹å…±ç”¨ä¸€ä»½ç¼“å­˜æ•°æ®ï¼Œç¼“å­˜å…·æœ‰ä¸€è‡´æ€§ã€‚ç¼ºç‚¹æ˜¯éœ€è¦ä¿æŒ redis æˆ– memcachedæœåŠ¡çš„é«˜å¯ç”¨ï¼Œæ•´ä¸ªç¨‹åºæ¶æ„ä¸Šè¾ƒä¸ºå¤æ‚ã€‚ 4ã€Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«1ã€å®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œéå¸¸å¿«é€Ÿã€‚æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äº HashMapï¼ŒHashMap çš„ä¼˜åŠ¿å°±æ˜¯æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼› 2ã€æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•ï¼ŒRedis ä¸­çš„æ•°æ®ç»“æ„æ˜¯ä¸“é—¨è¿›è¡Œè®¾è®¡çš„ï¼› 3ã€é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€— CPUï¼Œä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ï¼› 4ã€ä½¿ç”¨å¤šè·¯ I/O å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡ IOï¼› 5ã€ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ï¼ŒRedis ç›´æ¥è‡ªå·±æ„å»ºäº† VM æœºåˆ¶ ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ï¼› â€”â€“æ•°æ®ç»“æ„â€”-1ã€åº”ç”¨åœºæ™¯ è®¡æ•°å™¨ å¯ä»¥å¯¹ String è¿›è¡Œè‡ªå¢è‡ªå‡è¿ç®—ï¼Œä»è€Œå®ç°è®¡æ•°å™¨åŠŸèƒ½ã€‚Redis è¿™ç§å†…å­˜å‹æ•°æ®åº“çš„è¯»å†™æ€§èƒ½éå¸¸é«˜ï¼Œå¾ˆé€‚åˆå­˜å‚¨é¢‘ç¹è¯»å†™çš„è®¡æ•°é‡ã€‚ ç¼“å­˜ å°†çƒ­ç‚¹æ•°æ®æ”¾åˆ°å†…å­˜ä¸­ï¼Œè®¾ç½®å†…å­˜çš„æœ€å¤§ä½¿ç”¨é‡ä»¥åŠæ·˜æ±°ç­–ç•¥æ¥ä¿è¯ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚ ä¼šè¯ç¼“å­˜ å¯ä»¥ä½¿ç”¨ Redis æ¥ç»Ÿä¸€å­˜å‚¨å¤šå°åº”ç”¨æœåŠ¡å™¨çš„ä¼šè¯ä¿¡æ¯ã€‚å½“åº”ç”¨æœåŠ¡å™¨ä¸å†å­˜å‚¨ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼Œä¹Ÿå°±ä¸å†å…·æœ‰çŠ¶æ€ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥è¯·æ±‚ä»»æ„ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ï¼Œä»è€Œæ›´å®¹æ˜“å®ç°é«˜å¯ç”¨æ€§ä»¥åŠå¯ä¼¸ç¼©æ€§ã€‚ å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰ é™¤åŸºæœ¬çš„ä¼šè¯tokenä¹‹å¤–ï¼ŒRedisè¿˜æä¾›å¾ˆç®€ä¾¿çš„FPCå¹³å°ã€‚ä»¥Magentoä¸ºä¾‹ï¼ŒMagentoæä¾›ä¸€ä¸ªæ’ä»¶æ¥ä½¿ç”¨Redisä½œä¸ºå…¨é¡µç¼“å­˜åç«¯ã€‚æ­¤å¤–ï¼Œå¯¹WordPressçš„ç”¨æˆ·æ¥è¯´ï¼ŒPantheonæœ‰ä¸€ä¸ªéå¸¸å¥½çš„æ’ä»¶ wp-redisï¼Œè¿™ä¸ªæ’ä»¶èƒ½å¸®åŠ©ä½ ä»¥æœ€å¿«é€Ÿåº¦åŠ è½½ä½ æ›¾æµè§ˆè¿‡çš„é¡µé¢ã€‚ æŸ¥æ‰¾è¡¨ ä¾‹å¦‚ DNS è®°å½•å°±å¾ˆé€‚åˆä½¿ç”¨ Redis è¿›è¡Œå­˜å‚¨ã€‚æŸ¥æ‰¾è¡¨å’Œç¼“å­˜ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åˆ©ç”¨äº† Redis å¿«é€Ÿçš„æŸ¥æ‰¾ç‰¹æ€§ã€‚ä½†æ˜¯æŸ¥æ‰¾è¡¨çš„å†…å®¹ä¸èƒ½å¤±æ•ˆï¼Œè€Œç¼“å­˜çš„å†…å®¹å¯ä»¥å¤±æ•ˆï¼Œå› ä¸ºç¼“å­˜ä¸ä½œä¸ºå¯é çš„æ•°æ®æ¥æºã€‚ æ¶ˆæ¯é˜Ÿåˆ—(å‘å¸ƒ/è®¢é˜…åŠŸèƒ½) List æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¯ä»¥é€šè¿‡ lpush å’Œ rpop å†™å…¥å’Œè¯»å–æ¶ˆæ¯ã€‚ä¸è¿‡æœ€å¥½ä½¿ç”¨ Kafkaã€RabbitMQ ç­‰æ¶ˆæ¯ä¸­é—´ä»¶ã€‚ åˆ†å¸ƒå¼é”å®ç° åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ— æ³•ä½¿ç”¨å•æœºç¯å¢ƒä¸‹çš„é”æ¥å¯¹å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„è¿›ç¨‹è¿›è¡ŒåŒæ­¥ã€‚å¯ä»¥ä½¿ç”¨ Redis è‡ªå¸¦çš„ SETNX å‘½ä»¤å®ç°åˆ†å¸ƒå¼é”ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ RedLock åˆ†å¸ƒå¼é”å®ç°ã€‚ å…¶å®ƒ Set å¯ä»¥å®ç°äº¤é›†ã€å¹¶é›†ç­‰æ“ä½œï¼Œä»è€Œå®ç°å…±åŒå¥½å‹ç­‰åŠŸèƒ½ã€‚ZSet å¯ä»¥å®ç°æœ‰åºæ€§æ“ä½œï¼Œä»è€Œå®ç°æ’è¡Œæ¦œç­‰åŠŸèƒ½ã€‚ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ä¸¤ç§åˆ†ç‚¹ä¸Šä¸ºåŠŸèƒ½ï¼Œä¸‹ä¸ºç»“æ„â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ expireï¼šè®¾ç½®keyçš„è¿‡æœŸæ—¶é—´ persistï¼šè®¾ç½®keyæ°¸ä¹…æœ‰æ•ˆ 5ç§åŸºç¡€æ•°æ®ç±»å‹ï¼šStringã€Listã€Setã€Zsetã€Hashã€‚ ä¸‰ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼š HyperLogLogsï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰ï¼Œ Bitmaps (ä½å›¾) ï¼Œ geospatial ï¼ˆåœ°ç†ä½ç½®) Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼š åº•å±‚æ•°æ®ç»“æ„ï¼šSDSå³åŠ¨æ€å­—ç¬¦ä¸²ï¼Œæœ€å¤§å®¹é‡512Mï¼Œæ¯æ¬¡æœ€å¤šæ‰©å®¹1Mï¼Œæ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„æ€æ˜¯redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚jpgå›¾ç‰‡æˆ–åºåˆ—åŒ–çš„å¯¹è±¡åº”ç”¨åœºæ™¯ï¼šåˆ†å¸ƒå¼é”ã€è®¡æ•°å™¨(å¦‚è®¿é—®æ¬¡æ•°ã€ç‚¹èµè½¬å‘æ•°é‡)å¸¸ç”¨æ–¹æ³•ï¼šset ã€getã€strlen ã€incr ã€ decr ã€setnxã€setexã€exists listï¼ˆåŒå‘åˆ—è¡¨ï¼‰ï¼š ç‰¹ç‚¹ï¼šå•å€¼å¤šé”®ï¼Œç”¨æ¥å­˜å‚¨å¤šä¸ªæœ‰åºçš„å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªåˆ—è¡¨æœ€å¤šå¯ä»¥å­˜å‚¨2^32-1ä¸ªå…ƒç´ ã€‚å¯ä»¥å®ç°é˜Ÿåˆ—å’Œæ ˆåº•å±‚æ•°æ®ç»“æ„ï¼šå¿«è¡¨åº”ç”¨åœºæ™¯ï¼šæ¶ˆæ¯é˜Ÿåˆ— ã€æ–‡ç« åˆ—è¡¨å¸¸ç”¨æ–¹æ³•ï¼šlpush ã€lrang ã€rpush ã€lpop ã€rpop ã€llenã€lindexã€rpoplpushã€linsert Hashï¼ˆå“ˆå¸Œï¼‰ï¼š åº•å±‚æ•°æ®ç»“æ„ï¼šå‹ç¼©åˆ—è¡¨ã€å“ˆå¸Œè¡¨ã€‚ç‰¹ç‚¹ï¼šæŒ‡vï¼ˆå€¼ï¼‰æœ¬èº«åˆæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆk-vï¼‰ç»“æ„åº”ç”¨åœºæ™¯ï¼šç¼“å­˜ç”¨æˆ·ä¿¡æ¯ã€è´­ç‰©è½¦ç­‰ã€‚å¸¸ç”¨æ–¹æ³•ï¼šhset ã€hget ã€hkeys ã€hvals ã€hmset ã€hmget ã€hgetAll ã€hlen ã€hdel ã€hsetnx ã€hexists setï¼ˆé›†åˆï¼‰ï¼š ç‰¹ç‚¹ï¼šç”¨æ¥ä¿å­˜å¤šä¸ªçš„å­—ç¬¦ä¸²å…ƒç´ ï¼Œä½†æ˜¯ä¸å…è®¸é‡å¤å…ƒç´ ï¼Œå…ƒç´ æ˜¯æ— åºçš„ã€‚å¯ä»¥å®ç°å¹¶é›†ã€äº¤é›†ã€å·®é›†çš„æ“ä½œåº•å±‚æ•°æ®ç»“æ„ï¼šå“ˆå¸Œè¡¨ã€æ•´æ•°é›†åº”ç”¨åœºæ™¯ï¼šæŠ½å¥–ã€å…±åŒå…³æ³¨ã€QQå†…æ¨ç­‰ã€‚å¸¸ç”¨æ–¹æ³•ï¼šsadd ã€smembers ã€sismember ã€scard ã€srem ã€srandmemberã€spopã€smoveã€sdiffã€sinterã€sunion zsetï¼ˆæœ‰åºé›†åˆï¼‰ï¼š ç‰¹ç‚¹ï¼šæœ‰åºä¸é‡å¤çš„é›†åˆã€‚å’Œ set ç›¸â½sorted set å¢åŠ äº†â¼€ä¸ªæƒé‡å‚æ•° scoreï¼Œå¯ä»¥æ ¹æ®scoreè¿›è¡Œæ’åºï¼Œä½†scoreæ˜¯å¯ä»¥é‡å¤çš„ï¼Œvalueæ˜¯ä¸å¯ä»¥é‡å¤çš„ã€‚åº•å±‚æ•°æ®ç»“æ„ï¼šå‹ç¼©åˆ—è¡¨ã€è·³è¡¨åº”ç”¨åœºæ™¯ï¼šæ’è¡Œæ¦œã€æŠ–éŸ³çƒ­æœå¸¸ç”¨æ–¹æ³•ï¼šzadd ã€zrange ã€zrangebyscore(æŒ‰scoreä»å°åˆ°å¤§) ã€zrem ã€zcard ã€zcount ã€zrevrange(æŒ‰scoreä»å¤§åˆ°å°ï¼‰ â€”â€“æŒä¹…åŒ–â€”-1ã€Redis çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼ŸRedis æä¾›ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ RDBï¼ˆé»˜è®¤ï¼‰ å’Œ AOF æœºåˆ¶: RDBï¼šæ˜¯Redis DataBaseç¼©å†™å¿«ç…§ RDBæ˜¯Redisé»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ã€‚æŒ‰ç…§ä¸€å®šçš„æ—¶é—´å°†å†…å­˜çš„æ•°æ®ä»¥å¿«ç…§çš„å½¢å¼ä¿å­˜åˆ°ç¡¬ç›˜ä¸­ï¼Œå¯¹åº”äº§ç”Ÿçš„æ•°æ®æ–‡ä»¶ä¸ºdump.rdbã€‚é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„saveå‚æ•°æ¥å®šä¹‰å¿«ç…§çš„å‘¨æœŸã€‚ ä¼˜ç‚¹ï¼š 1ã€åªæœ‰ä¸€ä¸ªæ–‡ä»¶ dump.rdbï¼Œæ–¹ä¾¿æŒä¹…åŒ–ã€‚ 2ã€å®¹ç¾æ€§å¥½ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä¿å­˜åˆ°å®‰å…¨çš„ç£ç›˜ã€‚ 3ã€æ€§èƒ½æœ€å¤§åŒ–ï¼Œfork å­è¿›ç¨‹æ¥å®Œæˆå†™æ“ä½œï¼Œè®©ä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤ï¼Œæ‰€ä»¥æ˜¯ IO æœ€å¤§åŒ–ã€‚ä½¿ç”¨å•ç‹¬å­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¸»è¿›ç¨‹ä¸ä¼šè¿›è¡Œä»»ä½• IO æ“ä½œï¼Œä¿è¯äº† redis çš„é«˜æ€§èƒ½ 4.ç›¸å¯¹äºæ•°æ®é›†å¤§æ—¶ï¼Œæ¯” AOF çš„å¯åŠ¨æ•ˆç‡æ›´é«˜ã€‚ ç¼ºç‚¹ï¼š 1ã€æ•°æ®å®‰å…¨æ€§ä½ã€‚RDB æ˜¯é—´éš”ä¸€æ®µæ—¶é—´è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ä¹‹é—´ redis å‘ç”Ÿæ•…éšœï¼Œä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼æ›´é€‚åˆæ•°æ®è¦æ±‚ä¸ä¸¥è°¨çš„æ—¶å€™) 2ã€AOFï¼ˆAppend-only file)æŒä¹…åŒ–æ–¹å¼ï¼šæ˜¯æŒ‡æ‰€æœ‰çš„å‘½ä»¤è¡Œè®°å½•ä»¥ redis å‘½ä»¤è¯· æ±‚åè®®çš„æ ¼å¼å®Œå…¨æŒä¹…åŒ–å­˜å‚¨)ä¿å­˜ä¸º aof æ–‡ä»¶ã€‚ AOFï¼šæŒä¹…åŒ– AOFæŒä¹…åŒ–(å³Append Only FileæŒä¹…åŒ–)ï¼Œåˆ™æ˜¯å°†Redisæ‰§è¡Œçš„æ¯æ¬¡å†™å‘½ä»¤è®°å½•åˆ°å•ç‹¬çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå½“é‡å¯Redisä¼šé‡æ–°å°†æŒä¹…åŒ–çš„æ—¥å¿—ä¸­æ–‡ä»¶æ¢å¤æ•°æ®ã€‚ å½“ä¸¤ç§æ–¹å¼åŒæ—¶å¼€å¯æ—¶ï¼Œæ•°æ®æ¢å¤Redisä¼šä¼˜å…ˆé€‰æ‹©AOFæ¢å¤ã€‚ ä¼˜ç‚¹ï¼š å®‰å…¨ï¼Œæ‰€æœ‰å†™å…¥çš„æ•°æ®éƒ½ä¸ä¼šä¸¢å¤±ã€‚ AOFæ–‡ä»¶æ˜“è¯»ï¼Œå¯ä¿®æ”¹ã€‚ è¯¦æƒ…äº†è§£ï¼š 1ã€æ•°æ®å®‰å…¨ï¼Œaof æŒä¹…åŒ–å¯ä»¥é…ç½® appendfsync å±æ€§ï¼Œæœ‰ alwaysï¼Œæ¯è¿›è¡Œä¸€æ¬¡ å‘½ä»¤æ“ä½œå°±è®°å½•åˆ° aof æ–‡ä»¶ä¸­ä¸€æ¬¡ã€‚ 2ã€é€šè¿‡ append æ¨¡å¼å†™æ–‡ä»¶ï¼Œå³ä½¿ä¸­é€”æœåŠ¡å™¨å®•æœºï¼Œå¯ä»¥é€šè¿‡ redis-check-aof å·¥å…·è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ 3ã€AOF æœºåˆ¶çš„ rewrite æ¨¡å¼ã€‚AOF æ–‡ä»¶æ²¡è¢« rewrite ä¹‹å‰ï¼ˆæ–‡ä»¶è¿‡å¤§æ—¶ä¼šå¯¹å‘½ä»¤ è¿›è¡Œåˆå¹¶é‡å†™ï¼‰ï¼Œå¯ä»¥åˆ é™¤å…¶ä¸­çš„æŸäº›å‘½ä»¤ï¼ˆæ¯”å¦‚è¯¯æ“ä½œçš„ flushallï¼‰ ç¼ºç‚¹ï¼š 1ã€AOF æ–‡ä»¶æ¯” RDB æ–‡ä»¶å¤§ï¼Œä¸”æ¢å¤é€Ÿåº¦æ…¢ã€‚ 2ã€æ•°æ®é›†å¤§çš„æ—¶å€™ï¼Œæ¯” rdb å¯åŠ¨æ•ˆç‡ä½ã€‚ ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ AOFæ–‡ä»¶æ¯”RDBæ›´æ–°é¢‘ç‡é«˜ï¼Œä¼˜å…ˆä½¿ç”¨AOFè¿˜åŸæ•°æ®ã€‚ AOFæ¯”RDBæ›´å®‰å…¨ä¹Ÿæ›´å¤§ RDBæ€§èƒ½æ¯”AOFå¥½ å¦‚æœä¸¤ä¸ªéƒ½é…äº†ä¼˜å…ˆåŠ è½½AOF 2ã€å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–æ–¹å¼ ä¸€èˆ¬æ¥è¯´ï¼Œ å¦‚æœæƒ³è¾¾åˆ°è¶³ä»¥åª²ç¾PostgreSQLçš„æ•°æ®å®‰å…¨æ€§ï¼Œä½ åº”è¯¥åŒæ—¶ä½¿ç”¨ä¸¤ç§æŒä¹…åŒ–åŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ Redis é‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼Œå› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´ã€‚ å¦‚æœä½ éå¸¸å…³å¿ƒä½ çš„æ•°æ®ï¼Œ ä½†ä»ç„¶å¯ä»¥æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆä½ å¯ä»¥åªä½¿ç”¨RDBæŒä¹…åŒ–ã€‚ æœ‰å¾ˆå¤šç”¨æˆ·éƒ½åªä½¿ç”¨AOFæŒä¹…åŒ–ï¼Œä½†å¹¶ä¸æ¨èè¿™ç§æ–¹å¼ï¼Œå› ä¸ºå®šæ—¶ç”ŸæˆRDBå¿«ç…§ï¼ˆsnapshotï¼‰éå¸¸ä¾¿äºè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œ å¹¶ä¸” RDB æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦æ¯”AOFæ¢å¤çš„é€Ÿåº¦è¦å¿«ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨RDBè¿˜å¯ä»¥é¿å…AOFç¨‹åºçš„bugã€‚ å¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼ã€‚ 3ã€RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹ å¦‚æœRedisè¢«å½“åšç¼“å­˜ä½¿ç”¨ï¼Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œå®ç°åŠ¨æ€æ‰©å®¹ç¼©å®¹ã€‚ å¦‚æœRedisè¢«å½“åšä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨ä½¿ç”¨ï¼Œå¿…é¡»ä½¿ç”¨å›ºå®šçš„keys-to-nodesæ˜ å°„å…³ç³»ï¼ŒèŠ‚ç‚¹çš„æ•°é‡ä¸€æ—¦ç¡®å®šä¸èƒ½å˜åŒ–ã€‚å¦åˆ™çš„è¯(å³RedisèŠ‚ç‚¹éœ€è¦åŠ¨æ€å˜åŒ–çš„æƒ…å†µï¼‰ï¼Œå¿…é¡»ä½¿ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œæ•°æ®å†å¹³è¡¡çš„ä¸€å¥—ç³»ç»Ÿï¼Œè€Œå½“å‰åªæœ‰Redisé›†ç¾¤å¯ä»¥åšåˆ°è¿™æ ·ã€‚ â€”è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â€”1ã€Redisçš„è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒRedisæ˜¯key-valueæ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®Redisä¸­ç¼“å­˜çš„keyçš„è¿‡æœŸæ—¶é—´ã€‚Redisçš„è¿‡æœŸç­–ç•¥å°±æ˜¯æŒ‡å½“Redisä¸­ç¼“å­˜çš„keyè¿‡æœŸäº†ï¼ŒRediså¦‚ä½•å¤„ç†ã€‚ è¿‡æœŸç­–ç•¥é€šå¸¸æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š å®šæ—¶è¿‡æœŸï¼šæ¯ä¸ªè®¾ç½®è¿‡æœŸæ—¶é—´çš„keyéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œåˆ°è¿‡æœŸæ—¶é—´å°±ä¼šç«‹å³æ¸…é™¤ã€‚è¯¥ç­–ç•¥å¯ä»¥ç«‹å³æ¸…é™¤è¿‡æœŸçš„æ•°æ®ï¼Œå¯¹å†…å­˜å¾ˆå‹å¥½ï¼›ä½†æ˜¯ä¼šå ç”¨å¤§é‡çš„CPUèµ„æºå»å¤„ç†è¿‡æœŸçš„æ•°æ®ï¼Œä»è€Œå½±å“ç¼“å­˜çš„å“åº”æ—¶é—´å’Œååé‡ã€‚ æƒ°æ€§è¿‡æœŸï¼šåªæœ‰å½“è®¿é—®ä¸€ä¸ªkeyæ—¶ï¼Œæ‰ä¼šåˆ¤æ–­è¯¥keyæ˜¯å¦å·²è¿‡æœŸï¼Œè¿‡æœŸåˆ™æ¸…é™¤ã€‚è¯¥ç­–ç•¥å¯ä»¥æœ€å¤§åŒ–åœ°èŠ‚çœCPUèµ„æºï¼Œå´å¯¹å†…å­˜éå¸¸ä¸å‹å¥½ã€‚æç«¯æƒ…å†µå¯èƒ½å‡ºç°å¤§é‡çš„è¿‡æœŸkeyæ²¡æœ‰å†æ¬¡è¢«è®¿é—®ï¼Œä»è€Œä¸ä¼šè¢«æ¸…é™¤ï¼Œå ç”¨å¤§é‡å†…å­˜ã€‚ å®šæœŸè¿‡æœŸï¼šæ¯éš”ä¸€å®šçš„æ—¶é—´ï¼Œä¼šæ‰«æä¸€å®šæ•°é‡çš„æ•°æ®åº“çš„expireså­—å…¸ä¸­ä¸€å®šæ•°é‡çš„keyï¼Œå¹¶æ¸…é™¤å…¶ä¸­å·²è¿‡æœŸçš„keyã€‚è¯¥ç­–ç•¥æ˜¯å‰ä¸¤è€…çš„ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆã€‚é€šè¿‡è°ƒæ•´å®šæ—¶æ‰«æçš„æ—¶é—´é—´éš”å’Œæ¯æ¬¡æ‰«æçš„é™å®šè€—æ—¶ï¼Œå¯ä»¥åœ¨ä¸åŒæƒ…å†µä¸‹ä½¿å¾—CPUå’Œå†…å­˜èµ„æºè¾¾åˆ°æœ€ä¼˜çš„å¹³è¡¡æ•ˆæœã€‚(expireså­—å…¸ä¼šä¿å­˜æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyçš„è¿‡æœŸæ—¶é—´æ•°æ®ï¼Œå…¶ä¸­ï¼Œkeyæ˜¯æŒ‡å‘é”®ç©ºé—´ä¸­çš„æŸä¸ªé”®çš„æŒ‡é’ˆï¼Œvalueæ˜¯è¯¥é”®çš„æ¯«ç§’ç²¾åº¦çš„UNIXæ—¶é—´æˆ³è¡¨ç¤ºçš„è¿‡æœŸæ—¶é—´ã€‚é”®ç©ºé—´æ˜¯æŒ‡è¯¥Redisé›†ç¾¤ä¸­ä¿å­˜çš„æ‰€æœ‰é”®ã€‚) Redisä¸­åŒæ—¶ä½¿ç”¨äº†æƒ°æ€§è¿‡æœŸå’Œå®šæœŸè¿‡æœŸä¸¤ç§è¿‡æœŸç­–ç•¥ã€‚ 2ã€å¯¹è¿‡æœŸçš„æ•°æ®æ€ä¹ˆå¤„ç†å‘¢?é™¤äº†ç¼“å­˜æœåŠ¡å™¨è‡ªå¸¦çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥ä¹‹å¤–ï¼ˆRedisé»˜è®¤çš„æœ‰6ä¸­ç­–ç•¥å¯ä¾›é€‰æ‹©ï¼‰ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰çš„ç¼“å­˜æ·˜æ±°ï¼Œå¸¸è§çš„ç­–ç•¥æœ‰ä¸¤ç§ï¼š å®šæ—¶å»æ¸…ç†è¿‡æœŸçš„ç¼“å­˜ï¼› å½“æœ‰ç”¨æˆ·è¯·æ±‚è¿‡æ¥æ—¶ï¼Œå†åˆ¤æ–­è¿™ä¸ªè¯·æ±‚æ‰€ç”¨åˆ°çš„ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸçš„è¯å°±å»åº•å±‚ç³»ç»Ÿå¾—åˆ°æ–°æ•°æ®å¹¶æ›´æ–°ç¼“å­˜ã€‚ ä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼Œç¬¬ä¸€ç§çš„ç¼ºç‚¹æ˜¯ç»´æŠ¤å¤§é‡ç¼“å­˜çš„keyæ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œç¬¬äºŒç§çš„ç¼ºç‚¹å°±æ˜¯æ¯æ¬¡ç”¨æˆ·è¯·æ±‚è¿‡æ¥éƒ½è¦åˆ¤æ–­ç¼“å­˜å¤±æ•ˆï¼Œé€»è¾‘ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼å…·ä½“ç”¨å“ªç§æ–¹æ¡ˆï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„åº”ç”¨åœºæ™¯æ¥æƒè¡¡ã€‚ â€”å†…å­˜ç›¸å…³â€”1ã€MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®rediså†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šæ–½è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚ 2ã€Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æ˜¯æŒ‡åœ¨Redisçš„ç”¨äºç¼“å­˜çš„å†…å­˜ä¸è¶³æ—¶ï¼Œæ€ä¹ˆå¤„ç†éœ€è¦æ–°å†™å…¥ä¸”éœ€è¦ç”³è¯·é¢å¤–ç©ºé—´çš„æ•°æ®ã€‚ å…¨å±€çš„é”®ç©ºé—´é€‰æ‹©æ€§ç§»é™¤ noevictionï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚ allkeys-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚ï¼ˆè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼‰ allkeys-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚ è®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´é€‰æ‹©æ€§ç§»é™¤ volatile-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚ volatile-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚ volatile-ttlï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œæœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„keyä¼˜å…ˆç§»é™¤ã€‚ æ€»ç»“ Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥çš„é€‰å–å¹¶ä¸ä¼šå½±å“è¿‡æœŸçš„keyçš„å¤„ç†ã€‚å†…å­˜æ·˜æ±°ç­–ç•¥ç”¨äºå¤„ç†å†…å­˜ä¸è¶³æ—¶çš„éœ€è¦ç”³è¯·é¢å¤–ç©ºé—´çš„æ•°æ®ï¼›è¿‡æœŸç­–ç•¥ç”¨äºå¤„ç†è¿‡æœŸçš„ç¼“å­˜æ•°æ®ã€‚ 3ã€Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆå¦‚æœè¾¾åˆ°è®¾ç½®çš„ä¸Šé™ï¼ŒRedisçš„å†™å‘½ä»¤ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼ˆä½†æ˜¯è¯»å‘½ä»¤è¿˜å¯ä»¥æ­£å¸¸è¿”å›ã€‚ï¼‰æˆ–è€…ä½ å¯ä»¥é…ç½®å†…å­˜æ·˜æ±°æœºåˆ¶ï¼Œå½“Redisè¾¾åˆ°å†…å­˜ä¸Šé™æ—¶ä¼šå†²åˆ·æ‰æ—§çš„å†…å®¹ã€‚ 4ã€Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–å¯ä»¥å¥½å¥½åˆ©ç”¨Hash,list,sorted set,setç­‰é›†åˆç±»å‹æ•°æ®ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹å¾ˆå¤šå°çš„Key-Valueå¯ä»¥ç”¨æ›´ç´§å‡‘çš„æ–¹å¼å­˜æ”¾åˆ°ä¸€èµ·ã€‚å°½å¯èƒ½ä½¿ç”¨æ•£åˆ—è¡¨ï¼ˆhashesï¼‰ï¼Œæ•£åˆ—è¡¨ï¼ˆæ˜¯è¯´æ•£åˆ—è¡¨é‡Œé¢å­˜å‚¨çš„æ•°å°‘ï¼‰ä½¿ç”¨çš„å†…å­˜éå¸¸å°ï¼Œæ‰€ä»¥ä½ åº”è¯¥å°½å¯èƒ½çš„å°†ä½ çš„æ•°æ®æ¨¡å‹æŠ½è±¡åˆ°ä¸€ä¸ªæ•£åˆ—è¡¨é‡Œé¢ã€‚æ¯”å¦‚ä½ çš„webç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ï¼Œä¸è¦ä¸ºè¿™ä¸ªç”¨æˆ·çš„åç§°ï¼Œå§“æ°ï¼Œé‚®ç®±ï¼Œå¯†ç è®¾ç½®å•ç‹¬çš„keyï¼Œè€Œæ˜¯åº”è¯¥æŠŠè¿™ä¸ªç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯å­˜å‚¨åˆ°ä¸€å¼ æ•£åˆ—è¡¨é‡Œé¢ è¡¥å……ï¼šä½†æ˜¯æ³¨æ„ keyç²’åº¦è¦è¶³å¤Ÿç»†ï¼ˆxxx-yy-zzz-***ï¼‰ â€”çº¿ç¨‹æ¨¡å‹â€”1ã€Redisçº¿ç¨‹æ¨¡å‹RedisåŸºäºReactoræ¨¡å¼å¼€å‘äº†ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼Œè¿™ä¸ªå¤„ç†å™¨è¢«ç§°ä¸ºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚å®ƒçš„ç»„æˆç»“æ„ä¸º4éƒ¨åˆ†ï¼šå¤šä¸ªå¥—æ¥å­—ã€IOå¤šè·¯å¤ç”¨ç¨‹åºã€æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ã€äº‹ä»¶å¤„ç†å™¨ã€‚å› ä¸ºæ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨é˜Ÿåˆ—çš„æ¶ˆè´¹æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥Redisæ‰å«å•çº¿ç¨‹æ¨¡å‹ã€‚ æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ï¼ˆmultiplexingï¼‰ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œ å¹¶æ ¹æ®å¥—æ¥å­—ç›®å‰æ‰§è¡Œçš„ä»»åŠ¡æ¥ä¸ºå¥—æ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ã€‚ å½“è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡å¥½æ‰§è¡Œè¿æ¥åº”ç­”ï¼ˆacceptï¼‰ã€è¯»å–ï¼ˆreadï¼‰ã€å†™å…¥ï¼ˆwriteï¼‰ã€å…³é—­ï¼ˆcloseï¼‰ç­‰æ“ä½œæ—¶ï¼Œ ä¸æ“ä½œç›¸å¯¹åº”çš„æ–‡ä»¶äº‹ä»¶å°±ä¼šäº§ç”Ÿï¼Œ è¿™æ—¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šè°ƒç”¨å¥—æ¥å­—ä¹‹å‰å…³è”å¥½çš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚ è™½ç„¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œï¼Œ ä½†é€šè¿‡ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ¥ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œ æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ—¢å®ç°äº†é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œ åˆå¯ä»¥å¾ˆå¥½åœ°ä¸ redis æœåŠ¡å™¨ä¸­å…¶ä»–åŒæ ·ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„æ¨¡å—è¿›è¡Œå¯¹æ¥ï¼Œ è¿™ä¿æŒäº† Redis å†…éƒ¨å•çº¿ç¨‹è®¾è®¡çš„ç®€å•æ€§ã€‚ â€”â€“äº‹åŠ¡â€”â€“Redis äº‹åŠ¡çš„æœ¬è´¨æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚äº‹åŠ¡æ”¯æŒä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæŒ‰ç…§é¡ºåºä¸²è¡ŒåŒ–æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åºåˆ—ä¸­ã€‚ æ€»ç»“è¯´ï¼šredisäº‹åŠ¡å°±æ˜¯ä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤ã€‚ 0ã€ç«™é•¿ç®€ä¹¦ï¼Œredisäº‹åŠ¡ï¼ˆè¿˜æœ‰luaç§’æ€æ¡ˆä¾‹ï¼‰https://www.jianshu.com/p/879efff5f7b4 ä»è¾“å…¥Multiå‘½ä»¤å¼€å§‹(å¼€å¯äº‹åŠ¡)ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œç›´åˆ°è¾“å…¥Execåï¼ŒRedisä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œã€‚ ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡discardæ¥æ”¾å¼ƒç»„é˜Ÿ ï¼ˆ1ï¼‰ç»„é˜Ÿæ¡ˆä¾‹ 127.0.0.1:6379&gt; multi OK 127.0.0.1:6379(TX)&gt; set k1 v1 QUEUED 127.0.0.1:6379(TX)&gt; set k2 v2 QUEUED 127.0.0.1:6379(TX)&gt; exec 1) OK 2) OK ï¼ˆ2ï¼‰æ”¾å¼ƒç»„é˜Ÿ 127.0.0.1:6379&gt; multi OK 127.0.0.1:6379(TX)&gt; set k1 v1 QUEUED 127.0.0.1:6379(TX)&gt; set k2 v2 QUEUED 127.0.0.1:6379(TX)&gt; discard 1) OK ï¼ˆ3ï¼‰ä»»ä½•ä¸€ä¸ªç»„é˜Ÿå¤±è´¥ï¼Œéƒ½ä¸ä¼šæ‰§è¡Œ 127.0.0.1:6379&gt; multi OK 127.0.0.1:6379(TX)&gt; set k1 v1 QUEUED 127.0.0.1:6379(TX)&gt; set k2 v2 QUEUED 127.0.0.1:6379(TX)&gt; set k3 (error) ERR wrong number of arguments for 'set' command 127.0.0.1:6379(TX)&gt; exec (error) EXECABORT Transaction discarded because of previous errors. 3ã€äº‹åŠ¡çš„é”™è¯¯å¤„ç† ï¼ˆ1ï¼‰ç»„é˜Ÿä¸­æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆã€‚ï¼ˆå°±æ˜¯ä¸Šé¢3çš„æ“ä½œï¼‰ ï¼ˆ2ï¼‰å¦‚æœæ‰§è¡Œé˜¶æ®µæŸä¸ªå‘½ä»¤æŠ¥å‡ºäº†é”™è¯¯ï¼Œåˆ™åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œå…¶ä»–çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šå›æ»šã€‚ æ¡ˆä¾‹ï¼šå­—ç¬¦ä¸²+1 127.0.0.1:6379&gt; multi OK 127.0.0.1:6379(TX)&gt; set k1 v1 QUEUED 127.0.0.1:6379(TX)&gt; incr k1 QUEUED 127.0.0.1:6379(TX)&gt; exec 1) OK 2) (error) ERR value is not an integer or out of range 1ã€ç›¸å…³å‘½ä»¤ MULTI ï¼šå¼€å¯äº‹åŠ¡ï¼Œredisä¼šå°†åç»­çš„å‘½ä»¤é€ä¸ªæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åä½¿ç”¨EXECå‘½ä»¤æ¥åŸå­åŒ–æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ç³»åˆ—ã€‚ EXECï¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œå‘½ä»¤ã€‚ DISCARDï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚ WATCHï¼šç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªkey,å¦‚æœäº‹åŠ¡åœ¨æ‰§è¡Œå‰ï¼Œè¿™ä¸ªkey(æˆ–å¤šä¸ªkey)è¢«å…¶ä»–å‘½ä»¤ä¿®æ”¹ï¼Œåˆ™äº‹åŠ¡è¢«ä¸­æ–­ï¼Œä¸ä¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„ä»»ä½•å‘½ä»¤ã€‚ UNWATCHï¼šå–æ¶ˆWATCHå¯¹æ‰€æœ‰keyçš„ç›‘è§†ã€‚ 2ã€æ‰§è¡Œçš„3ä¸ªé˜¶æ®µ å¼€å¯ï¼šä»¥MULTIå¼€å§‹ä¸€ä¸ªäº‹åŠ¡ å…¥é˜Ÿï¼šå°†å¤šä¸ªå‘½ä»¤å…¥é˜Ÿåˆ°äº‹åŠ¡ä¸­ï¼Œæ¥åˆ°è¿™äº›å‘½ä»¤å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ”¾åˆ°ç­‰å¾…æ‰§è¡Œçš„äº‹åŠ¡é˜Ÿåˆ—é‡Œé¢ æ‰§è¡Œï¼šç”±EXECå‘½ä»¤è§¦å‘äº‹åŠ¡ 3ã€Redis å¯¹ ACIDçš„æ”¯æŒæ€§ç†è§£ åŸå­æ€§atomicity Rediså®˜æ–¹æ–‡æ¡£ç»™çš„ç†è§£æ˜¯ï¼ŒRedisçš„äº‹åŠ¡æ˜¯åŸå­æ€§çš„ï¼šæ‰€æœ‰çš„å‘½ä»¤ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚è€Œä¸æ˜¯å®Œå…¨æˆåŠŸã€‚ ä¸€è‡´æ€§consistency redisäº‹åŠ¡å¯ä»¥ä¿è¯å‘½ä»¤å¤±è´¥çš„æƒ…å†µä¸‹å¾—ä»¥å›æ»šï¼Œæ•°æ®èƒ½æ¢å¤åˆ°æ²¡æœ‰æ‰§è¡Œä¹‹å‰çš„æ ·å­ï¼Œæ˜¯ä¿è¯ä¸€è‡´æ€§çš„ï¼Œé™¤éredisè¿›ç¨‹æ„å¤–ç»ˆç»“ã€‚ éš”ç¦»æ€§Isolation redisäº‹åŠ¡æ˜¯ä¸¥æ ¼éµå®ˆéš”ç¦»æ€§çš„ï¼ŒåŸå› æ˜¯redisæ˜¯å•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å¼(v6.0ä¹‹å‰ï¼‰ï¼Œå¯ä»¥ä¿è¯å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘½ä»¤æ‰“æ–­ã€‚ä½†æ˜¯ï¼ŒRedisä¸åƒå…¶å®ƒç»“æ„åŒ–æ•°æ®åº“æœ‰éš”ç¦»çº§åˆ«è¿™ç§è®¾è®¡ã€‚ æŒä¹…æ€§Durability redisäº‹åŠ¡æ˜¯ä¸ä¿è¯æŒä¹…æ€§çš„ï¼Œè¿™æ˜¯å› ä¸ºredisæŒä¹…åŒ–ç­–ç•¥ä¸­ä¸ç®¡æ˜¯RDBè¿˜æ˜¯AOFéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä¸ä¿è¯æŒä¹…æ€§æ˜¯å‡ºäºå¯¹æ€§èƒ½çš„è€ƒè™‘ã€‚ 4ã€Redisäº‹åŠ¡æ”¯æŒéš”ç¦»æ€§å—Redis æ˜¯å•è¿›ç¨‹ç¨‹åºï¼Œå¹¶ä¸”å®ƒä¿è¯åœ¨æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œä¸ä¼šå¯¹äº‹åŠ¡è¿›è¡Œä¸­æ–­ï¼Œäº‹åŠ¡å¯ä»¥è¿è¡Œç›´åˆ°æ‰§è¡Œå®Œæ‰€æœ‰äº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¸ºæ­¢ã€‚å› æ­¤ï¼ŒRedis çš„äº‹åŠ¡æ˜¯æ€»æ˜¯å¸¦æœ‰éš”ç¦»æ€§çš„ã€‚ 5ã€Redisäº‹åŠ¡ä¿è¯åŸå­æ€§å—ï¼Œæ”¯æŒå›æ»šå—Redisä¸­ï¼Œå•æ¡å‘½ä»¤æ˜¯åŸå­æ€§æ‰§è¡Œçš„ï¼Œä½†äº‹åŠ¡ä¸ä¿è¯åŸå­æ€§ï¼Œä¸”æ²¡æœ‰å›æ»šã€‚äº‹åŠ¡ä¸­ä»»æ„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶ä½™çš„å‘½ä»¤ä»ä¼šè¢«æ‰§è¡Œã€‚ 6ã€Redisäº‹åŠ¡å…¶ä»–å®ç° åŸºäºLuaè„šæœ¬ï¼ŒRediså¯ä»¥ä¿è¯è„šæœ¬å†…çš„å‘½ä»¤ä¸€æ¬¡æ€§ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œï¼Œå…¶åŒæ—¶ä¹Ÿä¸æä¾›äº‹åŠ¡è¿è¡Œé”™è¯¯çš„å›æ»šï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœéƒ¨åˆ†å‘½ä»¤è¿è¡Œé”™è¯¯ï¼Œå‰©ä¸‹çš„å‘½ä»¤è¿˜æ˜¯ä¼šç»§ç»­è¿è¡Œå®Œ åŸºäºä¸­é—´æ ‡è®°å˜é‡ï¼Œé€šè¿‡å¦å¤–çš„æ ‡è®°å˜é‡æ¥æ ‡è¯†äº‹åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œè¯»å–æ•°æ®æ—¶å…ˆè¯»å–è¯¥æ ‡è®°å˜é‡åˆ¤æ–­æ˜¯å¦äº‹åŠ¡æ‰§è¡Œå®Œæˆã€‚ä½†è¿™æ ·ä¼šéœ€è¦é¢å¤–å†™ä»£ç å®ç°ï¼Œæ¯”è¾ƒç¹ç â€”â€”é›†ç¾¤æ–¹æ¡ˆâ€”â€”-1ã€ä¸»ä»å¤åˆ¶å•æœºçš„ redisï¼Œèƒ½å¤Ÿæ‰¿è½½çš„ QPS å¤§æ¦‚å°±åœ¨ä¸Šä¸‡åˆ°å‡ ä¸‡ä¸ç­‰ã€‚å¯¹äºç¼“å­˜æ¥è¯´ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨æ¥æ”¯æ’‘è¯»é«˜å¹¶å‘çš„ã€‚å› æ­¤æ¶æ„åšæˆä¸»ä»(master-slave)æ¶æ„ï¼Œä¸€ä¸»å¤šä»ï¼Œä¸»è´Ÿè´£å†™ï¼Œå¹¶ä¸”å°†æ•°æ®å¤åˆ¶åˆ°å…¶å®ƒçš„ slave èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»ã€‚æ‰€æœ‰çš„è¯»è¯·æ±‚å…¨éƒ¨èµ°ä»èŠ‚ç‚¹ã€‚è¿™æ ·ä¹Ÿå¯ä»¥å¾ˆè½»æ¾å®ç°æ°´å¹³æ‰©å®¹ï¼Œæ”¯æ’‘è¯»é«˜å¹¶å‘ã€‚ redis replication -&gt; ä¸»ä»æ¶æ„ -&gt; è¯»å†™åˆ†ç¦» -&gt; æ°´å¹³æ‰©å®¹æ”¯æ’‘è¯»é«˜å¹¶å‘ redis replication çš„æ ¸å¿ƒæœºåˆ¶ redis é‡‡ç”¨å¼‚æ­¥æ–¹å¼å¤åˆ¶æ•°æ®åˆ° slave èŠ‚ç‚¹ï¼Œä¸è¿‡ redis2.8 å¼€å§‹ï¼Œslave node ä¼šå‘¨æœŸæ€§åœ°ç¡®è®¤è‡ªå·±æ¯æ¬¡å¤åˆ¶çš„æ•°æ®é‡ï¼› ä¸€ä¸ª master node æ˜¯å¯ä»¥é…ç½®å¤šä¸ª slave node çš„ï¼› slave node ä¹Ÿå¯ä»¥è¿æ¥å…¶ä»–çš„ slave nodeï¼› slave node åšå¤åˆ¶çš„æ—¶å€™ï¼Œä¸ä¼š block(é˜»å¡) master node çš„æ­£å¸¸å·¥ä½œï¼›ï¼ˆå¼‚æ­¥æ‰€ä»¥ä¸ä¼šblockï¼‰ slave node åœ¨åšå¤åˆ¶çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼š block å¯¹è‡ªå·±çš„æŸ¥è¯¢æ“ä½œï¼Œå®ƒä¼šç”¨æ—§çš„æ•°æ®é›†æ¥æä¾›æœåŠ¡ï¼›ä½†æ˜¯å¤åˆ¶å®Œæˆçš„æ—¶å€™ï¼Œéœ€è¦åˆ é™¤æ—§æ•°æ®é›†ï¼ŒåŠ è½½æ–°æ•°æ®é›†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šæš‚åœå¯¹å¤–æœåŠ¡äº†ï¼› slave node ä¸»è¦ç”¨æ¥è¿›è¡Œæ¨ªå‘æ‰©å®¹ï¼Œåšè¯»å†™åˆ†ç¦»ï¼Œæ‰©å®¹çš„ slave node å¯ä»¥æé«˜è¯»çš„ååé‡ã€‚ æ³¨æ„ï¼Œå¦‚æœé‡‡ç”¨äº†ä¸»ä»æ¶æ„ï¼Œé‚£ä¹ˆå»ºè®®å¿…é¡»å¼€å¯ master node çš„æŒä¹…åŒ–ï¼Œä¸å»ºè®®ç”¨ slave node ä½œä¸º master node çš„æ•°æ®çƒ­å¤‡ï¼Œå› ä¸ºé‚£æ ·çš„è¯ï¼Œå¦‚æœä½ å…³æ‰ master çš„æŒä¹…åŒ–ï¼Œå¯èƒ½åœ¨ master å®•æœºé‡å¯çš„æ—¶å€™æ•°æ®æ˜¯ç©ºçš„ï¼Œç„¶åå¯èƒ½ä¸€ç»è¿‡å¤åˆ¶ï¼Œ slave node çš„æ•°æ®ä¹Ÿä¸¢äº†ã€‚ å¦å¤–ï¼Œmaster çš„å„ç§å¤‡ä»½æ–¹æ¡ˆï¼Œä¹Ÿéœ€è¦åšã€‚ä¸‡ä¸€æœ¬åœ°çš„æ‰€æœ‰æ–‡ä»¶ä¸¢å¤±äº†ï¼Œä»å¤‡ä»½ä¸­æŒ‘é€‰ä¸€ä»½ rdb å»æ¢å¤ masterï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿å¯åŠ¨çš„æ—¶å€™ï¼Œæ˜¯æœ‰æ•°æ®çš„ï¼Œå³ä½¿é‡‡ç”¨äº†åç»­è®²è§£çš„é«˜å¯ç”¨æœºåˆ¶ï¼Œslave node å¯ä»¥è‡ªåŠ¨æ¥ç®¡ master nodeï¼Œä½†ä¹Ÿå¯èƒ½ sentinel è¿˜æ²¡æ£€æµ‹åˆ° master failureï¼Œmaster node å°±è‡ªåŠ¨é‡å¯äº†ï¼Œè¿˜æ˜¯å¯èƒ½å¯¼è‡´ä¸Šé¢æ‰€æœ‰çš„ slave node æ•°æ®è¢«æ¸…ç©ºã€‚ ä½œç”¨ï¼š æ•°æ®å†—ä½™ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚ æ•…éšœæ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚ è´Ÿè½½å‡è¡¡ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚ é«˜å¯ç”¨åŸºçŸ³ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€ã€‚ ä¸»ä»åº“ä¹‹é—´é‡‡ç”¨çš„æ˜¯è¯»å†™åˆ†ç¦»çš„æ–¹å¼ã€‚ è¯»æ“ä½œï¼šä¸»åº“ã€ä»åº“éƒ½å¯ä»¥æ¥æ”¶ï¼› å†™æ“ä½œï¼šé¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œç„¶åï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“ å…¨é‡ï¼ˆåŒæ­¥ï¼‰å¤åˆ¶ï¼šæ¯”å¦‚ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ å¢é‡ï¼ˆåŒæ­¥ï¼‰å¤åˆ¶ï¼šåªä¼šæŠŠä¸»ä»åº“ç½‘ç»œæ–­è¿æœŸé—´ä¸»åº“æ”¶åˆ°çš„å‘½ä»¤ï¼ŒåŒæ­¥ç»™ä»åº“ Redis å…¨é‡å¤åˆ¶çš„ä¸‰ä¸ªé˜¶æ®µï¼ˆredis ä¸»ä»å¤åˆ¶çš„æ ¸å¿ƒåŸç†ï¼‰ï¼š å½“å¯åŠ¨ä¸€ä¸ª slave node çš„æ—¶å€™ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ª PSYNC å‘½ä»¤ç»™ master nodeã€‚ å¦‚æœè¿™æ˜¯ slave node åˆæ¬¡è¿æ¥åˆ° master nodeï¼Œé‚£ä¹ˆä¼šè§¦å‘ä¸€æ¬¡ full resynchronization å…¨é‡å¤åˆ¶ã€‚æ­¤æ—¶ master ä¼šå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œå¼€å§‹ç”Ÿæˆä¸€ä»½ RDB å¿«ç…§æ–‡ä»¶ï¼Œ åŒæ—¶è¿˜ä¼šå°†ä»å®¢æˆ·ç«¯ client æ–°æ”¶åˆ°çš„æ‰€æœ‰å†™å‘½ä»¤ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚RDB æ–‡ä»¶ç”Ÿæˆå®Œæ¯•åï¼Œ master ä¼šå°†è¿™ä¸ª RDB å‘é€ç»™ slaveï¼Œslave ä¼šå…ˆå†™å…¥æœ¬åœ°ç£ç›˜ï¼Œç„¶åå†ä»æœ¬åœ°ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œ æ¥ç€ master ä¼šå°†å†…å­˜ä¸­ç¼“å­˜çš„å†™å‘½ä»¤å‘é€åˆ° slaveï¼Œslave ä¹Ÿä¼šåŒæ­¥è¿™äº›æ•°æ®ã€‚ slave node å¦‚æœè·Ÿ master node æœ‰ç½‘ç»œæ•…éšœï¼Œæ–­å¼€äº†è¿æ¥ï¼Œä¼šè‡ªåŠ¨é‡è¿ï¼Œè¿æ¥ä¹‹å master node ä»…ä¼šå¤åˆ¶ç»™ slave éƒ¨åˆ†ç¼ºå°‘çš„æ•°æ®ã€‚ æ‰€æœ‰çš„slaveèŠ‚ç‚¹æ•°æ®çš„å¤åˆ¶å’ŒåŒæ­¥éƒ½ç”±masterèŠ‚ç‚¹æ¥å¤„ç†ï¼Œä¼šç…§æˆmasterèŠ‚ç‚¹å‹åŠ›å¤ªå¤§ï¼Œä½¿ç”¨ä¸»ä»ä»ç»“æ„æ¥è§£å†³ é˜¿Kç«™é•¿æç¤ºï¼›ä¸€ä¸‹3é˜¶æ®µçœ‹ä¸‹ç†è§£å°±å¥½ï¼Œé¢è¯•ä¸Šé¢è¿™äº›ç‚¹å›ç­” ç¬¬ä¸€é˜¶æ®µï¼šä¸»ä»åº“é—´å»ºç«‹è¿æ¥ã€åå•†åŒæ­¥çš„è¿‡ç¨‹ï¼Œä¸»è¦æ˜¯ä¸ºå…¨é‡å¤åˆ¶åšå‡†å¤‡ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œä»åº“å’Œä¸»åº“å»ºç«‹èµ·è¿æ¥ï¼Œå¹¶å‘Šè¯‰ä¸»åº“å³å°†è¿›è¡ŒåŒæ­¥ï¼Œä¸»åº“ç¡®è®¤å›å¤åï¼Œä¸»ä»åº“é—´å°±å¯ä»¥å¼€å§‹åŒæ­¥äº†ã€‚ å…·ä½“æ¥è¯´ï¼Œä»åº“ç»™ä¸»åº“å‘é€ psync å‘½ä»¤ï¼Œè¡¨ç¤ºè¦è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¸»åº“æ ¹æ®è¿™ä¸ªå‘½ä»¤çš„å‚æ•°æ¥å¯åŠ¨å¤åˆ¶ã€‚psync å‘½ä»¤åŒ…å«äº†ä¸»åº“çš„ runID å’Œå¤åˆ¶è¿›åº¦ offset ä¸¤ä¸ªå‚æ•°ã€‚runIDï¼Œæ˜¯æ¯ä¸ª Redis å®ä¾‹å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªéšæœº IDï¼Œç”¨æ¥å”¯ä¸€æ ‡è®°è¿™ä¸ªå®ä¾‹ã€‚å½“ä»åº“å’Œä¸»åº“ç¬¬ä¸€æ¬¡å¤åˆ¶æ—¶ï¼Œå› ä¸ºä¸çŸ¥é“ä¸»åº“çš„ runIDï¼Œæ‰€ä»¥å°† runID è®¾ä¸ºâ€œï¼Ÿâ€ã€‚offsetï¼Œæ­¤æ—¶è®¾ä¸º -1ï¼Œè¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶ã€‚ä¸»åº“æ”¶åˆ° psync å‘½ä»¤åï¼Œä¼šç”¨ FULLRESYNC å“åº”å‘½ä»¤å¸¦ä¸Šä¸¤ä¸ªå‚æ•°ï¼šä¸»åº“ runID å’Œä¸»åº“ç›®å‰çš„å¤åˆ¶è¿›åº¦ offsetï¼Œè¿”å›ç»™ä»åº“ã€‚ä»åº“æ”¶åˆ°å“åº”åï¼Œä¼šè®°å½•ä¸‹è¿™ä¸¤ä¸ªå‚æ•°ã€‚è¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼ŒFULLRESYNC å“åº”è¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶é‡‡ç”¨çš„å…¨é‡å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»åº“ä¼šæŠŠå½“å‰æ‰€æœ‰çš„æ•°æ®éƒ½å¤åˆ¶ç»™ä»åº“ã€‚ ç¬¬äºŒé˜¶æ®µï¼šä¸»åº“å°†æ‰€æœ‰æ•°æ®åŒæ­¥ç»™ä»åº“ã€‚ä»åº“æ”¶åˆ°æ•°æ®åï¼Œåœ¨æœ¬åœ°å®Œæˆæ•°æ®åŠ è½½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¾èµ–äºå†…å­˜å¿«ç…§ç”Ÿæˆçš„ RDB æ–‡ä»¶ã€‚ å…·ä½“æ¥è¯´ï¼Œä¸»åº“æ‰§è¡Œ bgsave å‘½ä»¤ï¼Œç”Ÿæˆ RDB æ–‡ä»¶ï¼Œæ¥ç€å°†æ–‡ä»¶å‘ç»™ä»åº“ã€‚ä»åº“æ¥æ”¶åˆ° RDB æ–‡ä»¶åï¼Œä¼šå…ˆæ¸…ç©ºå½“å‰æ•°æ®åº“ï¼Œç„¶ååŠ è½½ RDB æ–‡ä»¶ã€‚è¿™æ˜¯å› ä¸ºä»åº“åœ¨é€šè¿‡ replicaof å‘½ä»¤å¼€å§‹å’Œä¸»åº“åŒæ­¥å‰ï¼Œå¯èƒ½ä¿å­˜äº†å…¶ä»–æ•°æ®ã€‚ä¸ºäº†é¿å…ä¹‹å‰æ•°æ®çš„å½±å“ï¼Œä»åº“éœ€è¦å…ˆæŠŠå½“å‰æ•°æ®åº“æ¸…ç©ºã€‚åœ¨ä¸»åº“å°†æ•°æ®åŒæ­¥ç»™ä»åº“çš„è¿‡ç¨‹ä¸­ï¼Œä¸»åº“ä¸ä¼šè¢«é˜»å¡ï¼Œä»ç„¶å¯ä»¥æ­£å¸¸æ¥æ”¶è¯·æ±‚ã€‚å¦åˆ™ï¼ŒRedis çš„æœåŠ¡å°±è¢«ä¸­æ–­äº†ã€‚ä½†æ˜¯ï¼Œè¿™äº›è¯·æ±‚ä¸­çš„å†™æ“ä½œå¹¶æ²¡æœ‰è®°å½•åˆ°åˆšåˆšç”Ÿæˆçš„ RDB æ–‡ä»¶ä¸­ã€‚ä¸ºäº†ä¿è¯ä¸»ä»åº“çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¸»åº“ä¼šåœ¨å†…å­˜ä¸­ç”¨ä¸“é—¨çš„ replication bufferï¼Œè®°å½• RDB æ–‡ä»¶ç”Ÿæˆåæ”¶åˆ°çš„æ‰€æœ‰å†™æ“ä½œã€‚ ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼šä¸»åº“ä¼šæŠŠç¬¬äºŒé˜¶æ®µæ‰§è¡Œè¿‡ç¨‹ä¸­æ–°æ”¶åˆ°çš„å†™å‘½ä»¤ï¼Œå†å‘é€ç»™ä»åº“ã€‚å…·ä½“çš„æ“ä½œæ˜¯ï¼Œå½“ä¸»åº“å®Œæˆ RDB æ–‡ä»¶å‘é€åï¼Œå°±ä¼šæŠŠæ­¤æ—¶ replication buffer ä¸­çš„ä¿®æ”¹æ“ä½œå‘ç»™ä»åº“ï¼Œä»åº“å†é‡æ–°æ‰§è¡Œè¿™äº›æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸»ä»åº“å°±å®ç°åŒæ­¥äº†ã€‚ Redis å¢é‡å¤åˆ¶çš„æµç¨‹ï¼š Redis ä¸ºä»€ä¹ˆä¸»ä»å…¨é‡å¤åˆ¶ä½¿ç”¨RDBè€Œä¸ä½¿ç”¨AOFï¼Ÿ 1ã€RDBæ–‡ä»¶å†…å®¹æ˜¯ç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆä¸åŒæ•°æ®ç±»å‹æ•°æ®åšäº†é’ˆå¯¹æ€§ä¼˜åŒ–ï¼‰ï¼Œæ–‡ä»¶å¾ˆå°ã€‚è€ŒAOFæ–‡ä»¶è®°å½•çš„æ˜¯æ¯ä¸€æ¬¡å†™æ“ä½œçš„å‘½ä»¤ï¼Œå†™æ“ä½œè¶Šå¤šæ–‡ä»¶ä¼šå˜å¾—å¾ˆå¤§ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬å¾ˆå¤šå¯¹åŒä¸€ä¸ªkeyçš„å¤šæ¬¡å†—ä½™æ“ä½œã€‚åœ¨ä¸»ä»å…¨é‡æ•°æ®åŒæ­¥æ—¶ï¼Œä¼ è¾“RDBæ–‡ä»¶å¯ä»¥å°½é‡é™ä½å¯¹ä¸»åº“æœºå™¨ç½‘ç»œå¸¦å®½çš„æ¶ˆè€—ï¼Œä»åº“åœ¨åŠ è½½RDBæ–‡ä»¶æ—¶ï¼Œä¸€æ˜¯æ–‡ä»¶å°ï¼Œè¯»å–æ•´ä¸ªæ–‡ä»¶çš„é€Ÿåº¦ä¼šå¾ˆå¿«ï¼ŒäºŒæ˜¯å› ä¸ºRDBæ–‡ä»¶å­˜å‚¨çš„éƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œä»åº“ç›´æ¥æŒ‰ç…§RDBåè®®è§£æè¿˜åŸæ•°æ®å³å¯ï¼Œé€Ÿåº¦ä¼šéå¸¸å¿«ï¼Œè€ŒAOFéœ€è¦ä¾æ¬¡é‡æ”¾æ¯ä¸ªå†™å‘½ä»¤ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šç»å†å†—é•¿çš„å¤„ç†é€»è¾‘ï¼Œæ¢å¤é€Ÿåº¦ç›¸æ¯”RDBä¼šæ…¢å¾—å¤šï¼Œæ‰€ä»¥ä½¿ç”¨RDBè¿›è¡Œä¸»ä»å…¨é‡å¤åˆ¶çš„æˆæœ¬æœ€ä½ã€‚ 2ã€å‡è®¾è¦ä½¿ç”¨AOFåšå…¨é‡å¤åˆ¶ï¼Œæ„å‘³ç€å¿…é¡»æ‰“å¼€AOFåŠŸèƒ½ï¼Œæ‰“å¼€AOFå°±è¦é€‰æ‹©æ–‡ä»¶åˆ·ç›˜çš„ç­–ç•¥ï¼Œé€‰æ‹©ä¸å½“ä¼šä¸¥é‡å½±å“Redisæ€§èƒ½ã€‚è€ŒRDBåªæœ‰åœ¨éœ€è¦å®šæ—¶å¤‡ä»½å’Œä¸»ä»å…¨é‡å¤åˆ¶æ•°æ®æ—¶æ‰ä¼šè§¦å‘ç”Ÿæˆä¸€æ¬¡å¿«ç…§ã€‚è€Œåœ¨å¾ˆå¤šä¸¢å¤±æ•°æ®ä¸æ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ï¼Œå…¶å®æ˜¯ä¸éœ€è¦å¼€å¯AOFçš„ã€‚ Redis ä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰ä»åº“çš„ä»åº“çš„è®¾è®¡ï¼Ÿ ä¸€æ¬¡å…¨é‡å¤åˆ¶ä¸­ï¼Œå¯¹äºä¸»åº“æ¥è¯´ï¼Œéœ€è¦å®Œæˆä¸¤ä¸ªè€—æ—¶çš„æ“ä½œï¼šç”Ÿæˆ RDB æ–‡ä»¶å’Œä¼ è¾“ RDB æ–‡ä»¶ã€‚ å¦‚æœä»åº“æ•°é‡å¾ˆå¤šï¼Œè€Œä¸”éƒ½è¦å’Œä¸»åº“è¿›è¡Œå…¨é‡å¤åˆ¶çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä¸»åº“å¿™äº fork å­è¿›ç¨‹ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œè¿›è¡Œæ•°æ®å…¨é‡å¤åˆ¶ã€‚fork è¿™ä¸ªæ“ä½œä¼šé˜»å¡ä¸»çº¿ç¨‹å¤„ç†æ­£å¸¸è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ä¸»åº“å“åº”åº”ç”¨ç¨‹åºçš„è¯·æ±‚é€Ÿåº¦å˜æ…¢ã€‚æ­¤å¤–ï¼Œä¼ è¾“ RDB æ–‡ä»¶ä¹Ÿä¼šå ç”¨ä¸»åº“çš„ç½‘ç»œå¸¦å®½ï¼ŒåŒæ ·ä¼šç»™ä¸»åº“çš„èµ„æºä½¿ç”¨å¸¦æ¥å‹åŠ›ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰å¥½çš„è§£å†³æ–¹æ³•å¯ä»¥åˆ†æ‹…ä¸»åº“å‹åŠ›å‘¢ï¼Ÿ å…¶å®æ˜¯æœ‰çš„ï¼Œè¿™å°±æ˜¯â€œä¸» - ä» - ä»â€æ¨¡å¼ã€‚ åœ¨åˆšæ‰ä»‹ç»çš„ä¸»ä»åº“æ¨¡å¼ä¸­ï¼Œæ‰€æœ‰çš„ä»åº“éƒ½æ˜¯å’Œä¸»åº“è¿æ¥ï¼Œæ‰€æœ‰çš„å…¨é‡å¤åˆ¶ä¹Ÿéƒ½æ˜¯å’Œä¸»åº“è¿›è¡Œçš„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡â€œä¸» - ä» - ä»â€æ¨¡å¼å°†ä¸»åº“ç”Ÿæˆ RDB å’Œä¼ è¾“ RDB çš„å‹åŠ›ï¼Œä»¥çº§è”çš„æ–¹å¼åˆ†æ•£åˆ°ä»åº“ä¸Šã€‚ ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨éƒ¨ç½²ä¸»ä»é›†ç¾¤çš„æ—¶å€™ï¼Œå¯ä»¥æ‰‹åŠ¨é€‰æ‹©ä¸€ä¸ªä»åº“ï¼ˆæ¯”å¦‚é€‰æ‹©å†…å­˜èµ„æºé…ç½®è¾ƒé«˜çš„ä»åº“ï¼‰ï¼Œç”¨äºçº§è”å…¶ä»–çš„ä»åº“ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å†é€‰æ‹©ä¸€äº›ä»åº“ï¼ˆä¾‹å¦‚ä¸‰åˆ†ä¹‹ä¸€çš„ä»åº“ï¼‰ï¼Œåœ¨è¿™äº›ä»åº“ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè®©å®ƒä»¬å’Œåˆšæ‰æ‰€é€‰çš„ä»åº“ï¼Œå»ºç«‹èµ·ä¸»ä»å…³ç³»ã€‚ replicaof æ‰€é€‰ä»åº“çš„IP 6379 è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›ä»åº“å°±ä¼šçŸ¥é“ï¼Œåœ¨è¿›è¡ŒåŒæ­¥æ—¶ï¼Œä¸ç”¨å†å’Œä¸»åº“è¿›è¡Œäº¤äº’äº†ï¼Œåªè¦å’Œçº§è”çš„ä»åº“è¿›è¡Œå†™æ“ä½œåŒæ­¥å°±è¡Œäº†ï¼Œè¿™å°±å¯ä»¥å‡è½»ä¸»åº“ä¸Šçš„å‹åŠ›ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2ã€å“¨å…µæ¨¡å¼å“¨å…µçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸»èŠ‚ç‚¹çš„è‡ªåŠ¨æ•…éšœè½¬ç§»ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªå…¸å‹çš„å“¨å…µé›†ç¾¤ç›‘æ§çš„é€»è¾‘å›¾ï¼šï¼ˆè‡ªåŠ¨åŒ–ä¸»ä»æ¶æ„ï¼‰ å“¨å…µçš„ä½œç”¨ï¼š ç›‘æ§ï¼ˆMonitoringï¼‰ï¼šå“¨å…µä¼šä¸æ–­åœ°æ£€æŸ¥ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚ è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆAutomatic failoverï¼‰ï¼šå½“ä¸»èŠ‚ç‚¹ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µä¼šå¼€å§‹è‡ªåŠ¨æ•…éšœè½¬ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆä¸»èŠ‚ç‚¹çš„å…¶ä¸­ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶è®©å…¶ä»–ä»èŠ‚ç‚¹æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚ é…ç½®æä¾›è€…ï¼ˆConfiguration providerï¼‰ï¼šå®¢æˆ·ç«¯åœ¨åˆå§‹åŒ–æ—¶ï¼Œé€šè¿‡è¿æ¥å“¨å…µæ¥è·å¾—å½“å‰RedisæœåŠ¡çš„ä¸»èŠ‚ç‚¹åœ°å€ã€‚ é€šçŸ¥ï¼ˆNotificationï¼‰ï¼šå“¨å…µå¯ä»¥å°†æ•…éšœè½¬ç§»çš„ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚ å…¶ä¸­ï¼Œç›‘æ§å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½ï¼Œä½¿å¾—å“¨å…µå¯ä»¥åŠæ—¶å‘ç°ä¸»èŠ‚ç‚¹æ•…éšœå¹¶å®Œæˆè½¬ç§»ï¼›è€Œé…ç½®æä¾›è€…å’Œé€šçŸ¥åŠŸèƒ½ï¼Œåˆ™éœ€è¦åœ¨ä¸å®¢æˆ·ç«¯çš„äº¤äº’ä¸­æ‰èƒ½ä½“ç°ã€‚ 3ã€é›†ç¾¤æ¨¡å¼redis é›†ç¾¤æ¨¡å¼çš„å·¥ä½œåŸç†èƒ½è¯´ä¸€ä¸‹ä¹ˆï¼Ÿåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œredis çš„ key æ˜¯å¦‚ä½•å¯»å€çš„ï¼Ÿåˆ†å¸ƒå¼å¯»å€éƒ½æœ‰å“ªäº›ç®—æ³•ï¼Ÿäº†è§£ä¸€è‡´æ€§ hash ç®—æ³•å—ï¼Ÿ ç®€ä»‹ Redis Clusteræ˜¯ä¸€ç§æœåŠ¡ç«¯Shardingï¼ˆåˆ†ç‰‡ï¼‰æŠ€æœ¯ï¼Œ3.0ç‰ˆæœ¬å¼€å§‹æ­£å¼æä¾›ã€‚Redis Clusterå¹¶æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hashï¼Œè€Œæ˜¯é‡‡ç”¨slot(æ§½)çš„æ¦‚å¿µï¼Œä¸€å…±åˆ†æˆ16384ä¸ªæ§½ã€‚å°†è¯·æ±‚å‘é€åˆ°ä»»æ„èŠ‚ç‚¹ï¼Œæ¥æ”¶åˆ°è¯·æ±‚çš„èŠ‚ç‚¹ä¼šå°†æŸ¥è¯¢è¯·æ±‚å‘é€åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œ æ–¹æ¡ˆè¯´æ˜ é€šè¿‡å“ˆå¸Œçš„æ–¹å¼ï¼Œå°†æ•°æ®åˆ†ç‰‡ï¼Œæ¯ä¸ªèŠ‚ç‚¹å‡åˆ†å­˜å‚¨ä¸€å®šå“ˆå¸Œæ§½(å“ˆå¸Œå€¼)åŒºé—´çš„æ•°æ®ï¼Œé»˜è®¤åˆ†é…äº†16384 ä¸ªæ§½ä½ æ¯ä»½æ•°æ®åˆ†ç‰‡ä¼šå­˜å‚¨åœ¨å¤šä¸ªäº’ä¸ºä¸»ä»çš„å¤šèŠ‚ç‚¹ä¸Š æ•°æ®å†™å…¥å…ˆå†™ä¸»èŠ‚ç‚¹ï¼Œå†åŒæ­¥åˆ°ä»èŠ‚ç‚¹(æ”¯æŒé…ç½®ä¸ºé˜»å¡åŒæ­¥) åŒä¸€åˆ†ç‰‡å¤šä¸ªèŠ‚ç‚¹é—´çš„æ•°æ®ä¸ä¿æŒä¸€è‡´æ€§ è¯»å–æ•°æ®æ—¶ï¼Œå½“å®¢æˆ·ç«¯æ“ä½œçš„keyæ²¡æœ‰åˆ†é…åœ¨è¯¥èŠ‚ç‚¹ä¸Šæ—¶ï¼Œredisä¼šè¿”å›è½¬å‘æŒ‡ä»¤ï¼ŒæŒ‡å‘æ­£ç¡®çš„èŠ‚ç‚¹ æ‰©å®¹æ—¶æ—¶éœ€è¦éœ€è¦æŠŠæ—§èŠ‚ç‚¹çš„æ•°æ®è¿ç§»ä¸€éƒ¨åˆ†åˆ°æ–°èŠ‚ç‚¹ åœ¨ redis cluster æ¶æ„ä¸‹ï¼Œæ¯ä¸ª redis è¦æ”¾å¼€ä¸¤ä¸ªç«¯å£å·ï¼Œæ¯”å¦‚ä¸€ä¸ªæ˜¯ 6379ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ åŠ 1w çš„ç«¯å£å·ï¼Œæ¯”å¦‚ 16379ã€‚ 16379 ç«¯å£å·æ˜¯ç”¨æ¥è¿›è¡ŒèŠ‚ç‚¹é—´é€šä¿¡çš„ï¼Œä¹Ÿå°±æ˜¯ cluster bus çš„ä¸œè¥¿ï¼Œcluster bus çš„é€šä¿¡ï¼Œç”¨æ¥è¿›è¡Œæ•…éšœæ£€æµ‹ã€é…ç½®æ›´æ–°ã€æ•…éšœè½¬ç§»æˆæƒã€‚cluster bus ç”¨äº†å¦å¤–ä¸€ç§äºŒè¿›åˆ¶çš„åè®®ï¼Œgossip åè®®ï¼Œç”¨äºèŠ‚ç‚¹é—´è¿›è¡Œé«˜æ•ˆçš„æ•°æ®äº¤æ¢ï¼Œå ç”¨æ›´å°‘çš„ç½‘ç»œå¸¦å®½å’Œå¤„ç†æ—¶é—´ã€‚ åŸºæœ¬é€šä¿¡åŸç†ï¼ŒèŠ‚ç‚¹é—´çš„å†…éƒ¨é€šä¿¡æœºåˆ¶ï¼š é›†ç¾¤å…ƒæ•°æ®çš„ç»´æŠ¤æœ‰ä¸¤ç§æ–¹å¼ï¼šé›†ä¸­å¼ã€Gossip åè®®ã€‚redis cluster èŠ‚ç‚¹é—´é‡‡ç”¨ gossip åè®®è¿›è¡Œé€šä¿¡ã€‚ åˆ†å¸ƒå¼å¯»å€ç®—æ³•: hash ç®—æ³•ï¼ˆå¤§é‡ç¼“å­˜é‡å»ºï¼‰ ä¸€è‡´æ€§ hash ç®—æ³•ï¼ˆè‡ªåŠ¨ç¼“å­˜è¿ç§»ï¼‰+ è™šæ‹ŸèŠ‚ç‚¹ï¼ˆè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼‰ redis cluster çš„ hash slot ç®—æ³• ä¼˜ç‚¹ æ— ä¸­å¿ƒæ¶æ„ï¼Œæ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œå¯¹ä¸šåŠ¡é€æ˜ å…·å¤‡Sentinelçš„ç›‘æ§å’Œè‡ªåŠ¨Failover(æ•…éšœè½¬ç§»)èƒ½åŠ› å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ é«˜æ€§èƒ½ï¼Œå®¢æˆ·ç«¯ç›´è¿redisæœåŠ¡ï¼Œå…å»äº†proxyä»£ç†çš„æŸè€— ç¼ºç‚¹ è¿ç»´ä¹Ÿå¾ˆå¤æ‚ï¼Œæ•°æ®è¿ç§»éœ€è¦äººå·¥å¹²é¢„ åªèƒ½ä½¿ç”¨0å·æ•°æ®åº“ ä¸æ”¯æŒæ‰¹é‡æ“ä½œ(pipelineç®¡é“æ“ä½œ) åˆ†å¸ƒå¼é€»è¾‘å’Œå­˜å‚¨æ¨¡å—è€¦åˆç­‰ 3-1ã€åŸºäºå®¢æˆ·ç«¯åˆ†é…Redis Shardingæ˜¯Redis Clusterå‡ºæ¥ä¹‹å‰ï¼Œä¸šç•Œæ™®éä½¿ç”¨çš„å¤šRediså®ä¾‹é›†ç¾¤æ–¹æ³•ã€‚å…¶ä¸»è¦æ€æƒ³æ˜¯é‡‡ç”¨å“ˆå¸Œç®—æ³•å°†Redisæ•°æ®çš„keyè¿›è¡Œæ•£åˆ—ï¼Œé€šè¿‡hashå‡½æ•°ï¼Œç‰¹å®šçš„keyä¼šæ˜ å°„åˆ°ç‰¹å®šçš„RedisèŠ‚ç‚¹ä¸Šã€‚Java rediså®¢æˆ·ç«¯é©±åŠ¨jedisï¼Œæ”¯æŒRedis ShardingåŠŸèƒ½ï¼Œå³ShardedJedisä»¥åŠç»“åˆç¼“å­˜æ± çš„ShardedJedisPool ä¼˜ç‚¹ ä¼˜åŠ¿åœ¨äºéå¸¸ç®€å•ï¼ŒæœåŠ¡ç«¯çš„Rediså®ä¾‹å½¼æ­¤ç‹¬ç«‹ï¼Œç›¸äº’æ— å…³è”ï¼Œæ¯ä¸ªRediså®ä¾‹åƒå•æœåŠ¡å™¨ä¸€æ ·è¿è¡Œï¼Œéå¸¸å®¹æ˜“çº¿æ€§æ‰©å±•ï¼Œç³»ç»Ÿçš„çµæ´»æ€§å¾ˆå¼º ç¼ºç‚¹ ç”±äºshardingå¤„ç†æ”¾åˆ°å®¢æˆ·ç«¯ï¼Œè§„æ¨¡è¿›ä¸€æ­¥æ‰©å¤§æ—¶ç»™è¿ç»´å¸¦æ¥æŒ‘æˆ˜ã€‚ å®¢æˆ·ç«¯shardingä¸æ”¯æŒåŠ¨æ€å¢åˆ èŠ‚ç‚¹ã€‚æœåŠ¡ç«¯Rediså®ä¾‹ç¾¤æ‹“æ‰‘ç»“æ„æœ‰å˜åŒ–æ—¶ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦æ›´æ–°è°ƒæ•´ã€‚è¿æ¥ä¸èƒ½å…±äº«ï¼Œå½“åº”ç”¨è§„æ¨¡å¢å¤§æ—¶ï¼Œèµ„æºæµªè´¹åˆ¶çº¦ä¼˜åŒ– 3-2ã€åŸºäºä»£ç†æœåŠ¡å™¨åˆ†ç‰‡å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°ä¸€ä¸ªä»£ç†ç»„ä»¶ï¼Œä»£ç†è§£æå®¢æˆ·ç«¯çš„æ•°æ®ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘è‡³æ­£ç¡®çš„èŠ‚ç‚¹ï¼Œæœ€åå°†ç»“æœå›å¤ç»™å®¢æˆ·ç«¯ ç‰¹å¾ é€æ˜æ¥å…¥ï¼Œä¸šåŠ¡ç¨‹åºä¸ç”¨å…³å¿ƒåç«¯Rediså®ä¾‹ï¼Œåˆ‡æ¢æˆæœ¬ä½ Proxy çš„é€»è¾‘å’Œå­˜å‚¨çš„é€»è¾‘æ˜¯éš”ç¦»çš„ ä»£ç†å±‚å¤šäº†ä¸€æ¬¡è½¬å‘ï¼Œæ€§èƒ½æœ‰æ‰€æŸè€— ä¸šç•Œå¼€æºæ–¹æ¡ˆ Twtterå¼€æºçš„Twemproxy è±Œè±†èšå¼€æºçš„Codis 4ã€ç”Ÿäº§ç¯å¢ƒä¸­çš„ redis æ˜¯æ€ä¹ˆéƒ¨ç½²çš„redis clusterï¼Œ10 å°æœºå™¨ï¼Œ5 å°æœºå™¨éƒ¨ç½²äº† redis ä¸»å®ä¾‹ï¼Œå¦å¤– 5 å°æœºå™¨éƒ¨ç½²äº† redis çš„ä»å®ä¾‹ï¼Œæ¯ä¸ªä¸»å®ä¾‹æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œ5 ä¸ªèŠ‚ç‚¹å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„è¯»å†™é«˜å³°qpså¯èƒ½å¯ä»¥è¾¾åˆ°æ¯ç§’ 5 ä¸‡ï¼Œ5 å°æœºå™¨æœ€å¤šæ˜¯ 25 ä¸‡è¯»å†™è¯·æ±‚/sã€‚ æœºå™¨æ˜¯ä»€ä¹ˆé…ç½®ï¼Ÿ32G å†…å­˜+ 8 æ ¸ CPU + 1T ç£ç›˜ï¼Œä½†æ˜¯åˆ†é…ç»™ redis è¿›ç¨‹çš„æ˜¯10gå†…å­˜ï¼Œä¸€èˆ¬çº¿ä¸Šç”Ÿäº§ç¯å¢ƒï¼Œredis çš„å†…å­˜å°½é‡ä¸è¦è¶…è¿‡ 10gï¼Œè¶…è¿‡ 10g å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚ 5 å°æœºå™¨å¯¹å¤–æä¾›è¯»å†™ï¼Œä¸€å…±æœ‰ 50g å†…å­˜ã€‚ å› ä¸ºæ¯ä¸ªä¸»å®ä¾‹éƒ½æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œæ‰€ä»¥æ˜¯é«˜å¯ç”¨çš„ï¼Œä»»ä½•ä¸€ä¸ªä¸»å®ä¾‹å®•æœºï¼Œéƒ½ä¼šè‡ªåŠ¨æ•…éšœè¿ç§»ï¼Œredis ä»å®ä¾‹ä¼šè‡ªåŠ¨å˜æˆä¸»å®ä¾‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ã€‚ ä½ å¾€å†…å­˜é‡Œå†™çš„æ˜¯ä»€ä¹ˆæ•°æ®ï¼Ÿæ¯æ¡æ•°æ®çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿå•†å“æ•°æ®ï¼Œæ¯æ¡æ•°æ®æ˜¯ 10kbã€‚100 æ¡æ•°æ®æ˜¯ 1mbï¼Œ10 ä¸‡æ¡æ•°æ®æ˜¯ 1gã€‚å¸¸é©»å†…å­˜çš„æ˜¯ 200 ä¸‡æ¡å•†å“æ•°æ®ï¼Œå ç”¨å†…å­˜æ˜¯ 20gï¼Œä»…ä»…ä¸åˆ°æ€»å†…å­˜çš„ 50%ã€‚ç›®å‰é«˜å³°æœŸæ¯ç§’å°±æ˜¯ 3500 å·¦å³çš„è¯·æ±‚é‡ã€‚ å…¶å®å¤§å‹çš„å…¬å¸ï¼Œä¼šæœ‰åŸºç¡€æ¶æ„çš„ team è´Ÿè´£ç¼“å­˜é›†ç¾¤çš„è¿ç»´ã€‚ 5ã€è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µRedisé›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hash,è€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µï¼ŒRedisé›†ç¾¤æœ‰16384ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªkeyé€šè¿‡CRC16æ ¡éªŒåå¯¹16384å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ï¼Œé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½ã€‚ 6ã€Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼ŸRediså¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œè¿™æ„å‘³è¿™åœ¨å®é™…ä¸­é›†ç¾¤åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹å¯èƒ½ä¼šä¸¢å¤±å†™æ“ä½œã€‚ 7ã€ä¸‰ç§é›†ç¾¤æ¨¡å¼æ€»ç»“è¯¦æƒ…çœ‹ç«™é•¿ç®€ä¹¦ï¼š ä¸»ä»ï¼Œå“¨å…µï¼šhttps://www.jianshu.com/p/f6f386a62b7d é›†ç¾¤ï¼šhttps://www.jianshu.com/p/d875a53b0167 å› ä¸º Redis é›†ç¾¤æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¸»ä»å¤åˆ¶ï¼Œä¸€ç§æ˜¯ Redis Clusterï¼Œæˆ‘ä¸æ¸…æ¥šæ‚¨ é—®çš„æ˜¯å“ªä¸€ç§ã€‚ æŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œæˆ‘è®¤ä¸ºæ‚¨å¯èƒ½è¯´çš„æ˜¯ Redis å“¨å…µé›†ç¾¤å’Œ Redis Cluster çš„åŒºåˆ«ã€‚ å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥ä» 3 ä¸ªæ–¹é¢æ¥å›ç­” ï¼ŒRedis å“¨å…µé›†ç¾¤æ˜¯åŸºäºä¸»ä»å¤åˆ¶æ¥å®ç°çš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å®ç°è¯»å†™åˆ†ç¦»ï¼Œåˆ†æ‹… Redis è¯»æ“ä½œçš„å‹åŠ› ï¼Œè€Œ Redis Cluster é›†ç¾¤çš„ Slave èŠ‚ç‚¹åªæ˜¯å®ç°å†·å¤‡æœºåˆ¶ï¼Œå®ƒåªæœ‰åœ¨ Master å®•æœº ä¹‹åæ‰ä¼šå·¥ä½œã€‚ Redis å“¨å…µé›†ç¾¤æ— æ³•åœ¨çº¿æ‰©å®¹ï¼Œæ‰€ä»¥å®ƒçš„å¹¶å‘å‹åŠ›å—é™äºå•ä¸ªæœåŠ¡å™¨çš„èµ„æºé…ç½®ã€‚ Redis Cluster æä¾›äº†åŸºäº Slot æ§½çš„æ•°æ®åˆ†ç‰‡æœºåˆ¶ï¼Œå¯ä»¥å®ç°åœ¨çº¿æ‰©å®¹æå‡å†™æ•° æ®çš„æ€§èƒ½ä»é›†ç¾¤æ¶æ„ä¸Šæ¥è¯´ï¼ŒRedis å“¨å…µé›†ç¾¤æ˜¯ä¸€ä¸»å¤šä»ï¼Œ è€Œ Redis Cluster æ˜¯å¤šä¸»å¤šä» â€”-åˆ†åŒºâ€”â€“1ã€Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡å¯ä»¥åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨éƒ¨ç½²å¤šä¸ªRedisçš„å®ä¾‹ï¼Œå¹¶æŠŠä»–ä»¬å½“ä½œä¸åŒçš„æœåŠ¡å™¨æ¥ä½¿ç”¨ï¼Œåœ¨æŸäº›æ—¶å€™ï¼Œæ— è®ºå¦‚ä½•ä¸€ä¸ªæœåŠ¡å™¨æ˜¯ä¸å¤Ÿçš„ï¼Œ æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å¤šä¸ªCPUï¼Œä½ å¯ä»¥è€ƒè™‘ä¸€ä¸‹åˆ†ç‰‡ï¼ˆshardï¼‰ 2ã€ä¸ºä»€ä¹ˆè¦åšRedisåˆ†åŒºåˆ†åŒºå¯ä»¥è®©Redisç®¡ç†æ›´å¤§çš„å†…å­˜ï¼ŒRediså°†å¯ä»¥ä½¿ç”¨æ‰€æœ‰æœºå™¨çš„å†…å­˜ã€‚å¦‚æœæ²¡æœ‰åˆ†åŒºï¼Œä½ æœ€å¤šåªèƒ½ä½¿ç”¨ä¸€å°æœºå™¨çš„å†…å­˜ã€‚åˆ†åŒºä½¿Redisçš„è®¡ç®—èƒ½åŠ›é€šè¿‡ç®€å•åœ°å¢åŠ è®¡ç®—æœºå¾—åˆ°æˆå€æå‡ï¼ŒRedisçš„ç½‘ç»œå¸¦å®½ä¹Ÿä¼šéšç€è®¡ç®—æœºå’Œç½‘å¡çš„å¢åŠ è€Œæˆå€å¢é•¿ã€‚ 3ã€ä½ çŸ¥é“æœ‰å“ªäº›Redisåˆ†åŒºå®ç°æ–¹æ¡ˆ å®¢æˆ·ç«¯åˆ†åŒºå°±æ˜¯åœ¨å®¢æˆ·ç«¯å°±å·²ç»å†³å®šæ•°æ®ä¼šè¢«å­˜å‚¨åˆ°å“ªä¸ªredisèŠ‚ç‚¹æˆ–è€…ä»å“ªä¸ªredisèŠ‚ç‚¹è¯»å–ã€‚å¤§å¤šæ•°å®¢æˆ·ç«¯å·²ç»å®ç°äº†å®¢æˆ·ç«¯åˆ†åŒºã€‚ ä»£ç†åˆ†åŒº æ„å‘³ç€å®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€ç»™ä»£ç†ï¼Œç„¶åä»£ç†å†³å®šå»å“ªä¸ªèŠ‚ç‚¹å†™æ•°æ®æˆ–è€…è¯»æ•°æ®ã€‚ä»£ç†æ ¹æ®åˆ†åŒºè§„åˆ™å†³å®šè¯·æ±‚å“ªäº›Rediså®ä¾‹ï¼Œç„¶åæ ¹æ®Redisçš„å“åº”ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚rediså’Œmemcachedçš„ä¸€ç§ä»£ç†å®ç°å°±æ˜¯Twemproxy æŸ¥è¯¢è·¯ç”±(Query routing) çš„æ„æ€æ˜¯å®¢æˆ·ç«¯éšæœºåœ°è¯·æ±‚ä»»æ„ä¸€ä¸ªrediså®ä¾‹ï¼Œç„¶åç”±Rediså°†è¯·æ±‚è½¬å‘ç»™æ­£ç¡®çš„RedisèŠ‚ç‚¹ã€‚Redis Clusterå®ç°äº†ä¸€ç§æ··åˆå½¢å¼çš„æŸ¥è¯¢è·¯ç”±ï¼Œä½†å¹¶ä¸æ˜¯ç›´æ¥å°†è¯·æ±‚ä»ä¸€ä¸ªredisèŠ‚ç‚¹è½¬å‘åˆ°å¦ä¸€ä¸ªredisèŠ‚ç‚¹ï¼Œè€Œæ˜¯åœ¨å®¢æˆ·ç«¯çš„å¸®åŠ©ä¸‹ç›´æ¥redirectedåˆ°æ­£ç¡®çš„redisèŠ‚ç‚¹ã€‚ 4ã€Redisåˆ†åŒºæœ‰ä»€ä¹ˆç¼ºç‚¹ æ¶‰åŠå¤šä¸ªkeyçš„æ“ä½œé€šå¸¸ä¸ä¼šè¢«æ”¯æŒã€‚ä¾‹å¦‚ä½ ä¸èƒ½å¯¹ä¸¤ä¸ªé›†åˆæ±‚äº¤é›†ï¼Œå› ä¸ºä»–ä»¬å¯èƒ½è¢«å­˜å‚¨åˆ°ä¸åŒçš„Rediså®ä¾‹ï¼ˆå®é™…ä¸Šè¿™ç§æƒ…å†µä¹Ÿæœ‰åŠæ³•ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨äº¤é›†æŒ‡ä»¤ï¼‰ã€‚ åŒæ—¶æ“ä½œå¤šä¸ªkey,åˆ™ä¸èƒ½ä½¿ç”¨Redisäº‹åŠ¡. åˆ†åŒºä½¿ç”¨çš„ç²’åº¦æ˜¯keyï¼Œä¸èƒ½ä½¿ç”¨ä¸€ä¸ªéå¸¸é•¿çš„æ’åºkeyå­˜å‚¨ä¸€ä¸ªæ•°æ®é›†ï¼ˆThe partitioning granularity is the key, so it is not possible to shard a dataset with a single huge key like a very big sorted setï¼‰ å½“ä½¿ç”¨åˆ†åŒºçš„æ—¶å€™ï¼Œæ•°æ®å¤„ç†ä¼šéå¸¸å¤æ‚ï¼Œä¾‹å¦‚ä¸ºäº†å¤‡ä»½ä½ å¿…é¡»ä»ä¸åŒçš„Rediså®ä¾‹å’Œä¸»æœºåŒæ—¶æ”¶é›†RDB / AOFæ–‡ä»¶ã€‚ åˆ†åŒºæ—¶åŠ¨æ€æ‰©å®¹æˆ–ç¼©å®¹å¯èƒ½éå¸¸å¤æ‚ã€‚Redisé›†ç¾¤åœ¨è¿è¡Œæ—¶å¢åŠ æˆ–è€…åˆ é™¤RedisèŠ‚ç‚¹ï¼Œèƒ½åšåˆ°æœ€å¤§ç¨‹åº¦å¯¹ç”¨æˆ·é€æ˜åœ°æ•°æ®å†å¹³è¡¡ï¼Œä½†å…¶ä»–ä¸€äº›å®¢æˆ·ç«¯åˆ†åŒºæˆ–è€…ä»£ç†åˆ†åŒºæ–¹æ³•åˆ™ä¸æ”¯æŒè¿™ç§ç‰¹æ€§ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ç§é¢„åˆ†ç‰‡çš„æŠ€æœ¯ä¹Ÿå¯ä»¥è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ â€”â€“åˆ†å¸ƒå¼é—®é¢˜â€”â€“1ã€Rediså®ç°åˆ†å¸ƒå¼é”ï¼ˆç«™é•¿çš„ç®€ä¹¦ï¼‰https://www.jianshu.com/p/2e995df9ccbc åˆ†å¸ƒå¼é”ä¸»æµçš„å®ç°æ–¹æ¡ˆï¼š åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é” åŸºäºç¼“å­˜ï¼ˆRedisç­‰ï¼‰ åŸºäºZookeeperæ¯ä¸€ç§åˆ†å¸ƒå¼é”è§£å†³æ–¹æ¡ˆéƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š æ€§èƒ½ï¼šredisæœ€é«˜ å¯é æ€§ï¼šzookeeperæœ€é«˜è¿™é‡Œï¼Œæˆ‘ä»¬å°±åŸºäºrediså®ç°åˆ†å¸ƒå¼é”ã€‚ ï¼ˆ1ï¼‰redis:å‘½ä»¤ï¼šsetnx è®¾ç½®é”ï¼šsetnx key val è®¾ç½®æˆåŠŸï¼Œè¿”å› 1 ã€‚è®¾ç½®å¤±è´¥ï¼Œè¿”å› 0 ï¼›ä½¿ç”¨SETNXå‘½ä»¤è·å–é”ï¼Œè‹¥è¿”å›0ï¼ˆkeyå·²å­˜åœ¨ï¼Œé”å·²å­˜åœ¨ï¼‰åˆ™è·å–å¤±è´¥ï¼Œåä¹‹è·å–æˆåŠŸ 127.0.0.1:6379&gt; setnx username vv1 (integer) 1 127.0.0.1:6379&gt; setnx username vv2 (integer) 0 127.0.0.1:6379&gt; setnx username vv1 (integer) 0 127.0.0.1:6379&gt; setnx username vv1 (integer) 0 delè§£é™¤é” 127.0.0.1:6379&gt; del username (integer) 1 127.0.0.1:6379&gt; setnx username vv2 (integer) 1 127.0.0.1:6379&gt; setnx username vv2 (integer) 0 127.0.0.1:6379&gt; setnx username vv2 (integer) 0 expireè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ŒttlæŸ¥çœ‹è¿‡æœŸæ—¶é—´ 127.0.0.1:6379&gt; expire username 19 (integer) 1 127.0.0.1:6379&gt; ttl username (integer) 14 127.0.0.1:6379&gt; ttl username (integer) 12 127.0.0.1:6379&gt; ttl username (integer) 11 127.0.0.1:6379&gt; ttl username (integer) 11 127.0.0.1:6379&gt; ttl username (integer) 9 ttl ä¸º -2 å·²ç»è¿‡æœŸï¼Œ-1 æ˜¯æ°¸ä¹…ç”Ÿæ•ˆ 127.0.0.1:6379&gt; ttl username (integer) -2 127.0.0.1:6379&gt; setnx username vv2 (integer) 1 127.0.0.1:6379&gt; setnx username vv2 (integer) 0 127.0.0.1:6379&gt; setnx username vv2 (integer) 0 â˜… æ—¢ä¸Šé”åˆè®¾ç½®è¿‡æœŸæ—¶é—´( nx ä¸Šé”ï¼Œex è¿‡æœŸæ—¶é—´) 127.0.0.1:6379&gt; set age 10 nx ex 11 OK 127.0.0.1:6379&gt; ttl age (integer) 7 127.0.0.1:6379&gt; ttl age (integer) 5 ä½¿ç”¨SETNXå®ŒæˆåŒæ­¥é”çš„æµç¨‹åŠäº‹é¡¹å¦‚ä¸‹ï¼š ä½¿ç”¨SETNXå‘½ä»¤è·å–é”ï¼Œè‹¥è¿”å›0ï¼ˆkeyå·²å­˜åœ¨ï¼Œé”å·²å­˜åœ¨ï¼‰åˆ™è·å–å¤±è´¥ï¼Œåä¹‹è·å–æˆåŠŸ ä¸ºäº†é˜²æ­¢è·å–é”åç¨‹åºå‡ºç°å¼‚å¸¸ï¼Œå¯¼è‡´å…¶ä»–çº¿ç¨‹/è¿›ç¨‹è°ƒç”¨SETNXå‘½ä»¤æ€»æ˜¯è¿”å›0è€Œè¿›å…¥æ­»é”çŠ¶æ€ï¼Œéœ€è¦ä¸ºè¯¥keyè®¾ç½®ä¸€ä¸ªâ€œåˆç†â€çš„è¿‡æœŸæ—¶é—´ é‡Šæ”¾é”ï¼Œä½¿ç”¨DELå‘½ä»¤å°†é”æ•°æ®åˆ é™¤ å…¶å®æœ€ä½³æ–¹æ¡ˆæ˜¯ï¼šRedissionæ¡†æ¶å®ç°åˆ†å¸ƒå¼é” 2ã€å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜æ‰€è°“ Redis çš„å¹¶å‘ç«äº‰ Key çš„é—®é¢˜ä¹Ÿå°±æ˜¯å¤šä¸ªç³»ç»ŸåŒæ—¶å¯¹ä¸€ä¸ª key è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯æœ€åæ‰§è¡Œçš„é¡ºåºå’Œæˆ‘ä»¬æœŸæœ›çš„é¡ºåºä¸åŒï¼Œè¿™æ ·ä¹Ÿå°±å¯¼è‡´äº†ç»“æœçš„ä¸åŒï¼ æ¨èä¸€ç§æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼é”ï¼ˆzookeeper å’Œ redis éƒ½å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ï¼‰ã€‚ï¼ˆå¦‚æœä¸å­˜åœ¨ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜ï¼Œä¸è¦ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œè¿™æ ·ä¼šå½±å“æ€§èƒ½ï¼‰ åŸºäºzookeeperä¸´æ—¶æœ‰åºèŠ‚ç‚¹å¯ä»¥å®ç°çš„åˆ†å¸ƒå¼é”ã€‚å¤§è‡´æ€æƒ³ä¸ºï¼šæ¯ä¸ªå®¢æˆ·ç«¯å¯¹æŸä¸ªæ–¹æ³•åŠ é”æ—¶ï¼Œåœ¨zookeeperä¸Šçš„ä¸è¯¥æ–¹æ³•å¯¹åº”çš„æŒ‡å®šèŠ‚ç‚¹çš„ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç¬æ—¶æœ‰åºèŠ‚ç‚¹ã€‚åˆ¤æ–­æ˜¯å¦è·å–é”çš„æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€è¦åˆ¤æ–­æœ‰åºèŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ä¸€ä¸ªã€‚å½“é‡Šæ”¾é”çš„æ—¶å€™ï¼Œåªéœ€å°†è¿™ä¸ªç¬æ—¶èŠ‚ç‚¹åˆ é™¤å³å¯ã€‚åŒæ—¶ï¼Œå…¶å¯ä»¥é¿å…æœåŠ¡å®•æœºå¯¼è‡´çš„é”æ— æ³•é‡Šæ”¾ï¼Œè€Œäº§ç”Ÿçš„æ­»é”é—®é¢˜ã€‚å®Œæˆä¸šåŠ¡æµç¨‹åï¼Œåˆ é™¤å¯¹åº”çš„å­èŠ‚ç‚¹é‡Šæ”¾é”ã€‚ åœ¨å®è·µä¸­ï¼Œå½“ç„¶æ˜¯ä»ä»¥å¯é æ€§ä¸ºä¸»ã€‚æ‰€ä»¥é¦–æ¨Zookeeperã€‚ 3ã€åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ—¢ç„¶Redisæ˜¯å¦‚æ­¤çš„è½»é‡ï¼ˆå•å®ä¾‹åªä½¿ç”¨1Må†…å­˜ï¼‰ï¼Œä¸ºé˜²æ­¢ä»¥åçš„æ‰©å®¹ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯ä¸€å¼€å§‹å°±å¯åŠ¨è¾ƒå¤šå®ä¾‹ã€‚å³ä¾¿ä½ åªæœ‰ä¸€å°æœåŠ¡å™¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±è®©Redisä»¥åˆ†å¸ƒå¼çš„æ–¹å¼è¿è¡Œï¼Œä½¿ç”¨åˆ†åŒºï¼Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ªå®ä¾‹ã€‚ ä¸€å¼€å§‹å°±å¤šè®¾ç½®å‡ ä¸ªRediså®ä¾‹ï¼Œä¾‹å¦‚32æˆ–è€…64ä¸ªå®ä¾‹ï¼Œå¯¹å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´è¿™æ“ä½œèµ·æ¥å¯èƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯ä»é•¿ä¹…æ¥çœ‹åšè¿™ç‚¹ç‰ºç‰²æ˜¯å€¼å¾—çš„ã€‚ è¿™æ ·çš„è¯ï¼Œå½“ä½ çš„æ•°æ®ä¸æ–­å¢é•¿ï¼Œéœ€è¦æ›´å¤šçš„RedisæœåŠ¡å™¨æ—¶ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯ä»…ä»…å°†Rediså®ä¾‹ä»ä¸€å°æœåŠ¡è¿ç§»åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨è€Œå·²ï¼ˆè€Œä¸ç”¨è€ƒè™‘é‡æ–°åˆ†åŒºçš„é—®é¢˜ï¼‰ã€‚ä¸€æ—¦ä½ æ·»åŠ äº†å¦ä¸€å°æœåŠ¡å™¨ï¼Œä½ éœ€è¦å°†ä½ ä¸€åŠçš„Rediså®ä¾‹ä»ç¬¬ä¸€å°æœºå™¨è¿ç§»åˆ°ç¬¬äºŒå°æœºå™¨ã€‚ 4ã€ä»€ä¹ˆæ˜¯ RedLockRedis å®˜æ–¹ç«™æå‡ºäº†ä¸€ç§æƒå¨çš„åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”çš„æ–¹å¼åå« Redlockï¼Œæ­¤ç§æ–¹å¼æ¯”åŸå…ˆçš„å•èŠ‚ç‚¹çš„æ–¹æ³•æ›´å®‰å…¨ã€‚å®ƒå¯ä»¥ä¿è¯ä»¥ä¸‹ç‰¹æ€§ï¼š å®‰å…¨ç‰¹æ€§ï¼šäº’æ–¥è®¿é—®ï¼Œå³æ°¸è¿œåªæœ‰ä¸€ä¸ª client èƒ½æ‹¿åˆ°é” é¿å…æ­»é”ï¼šæœ€ç»ˆ client éƒ½å¯èƒ½æ‹¿åˆ°é”ï¼Œä¸ä¼šå‡ºç°æ­»é”çš„æƒ…å†µï¼Œå³ä½¿åŸæœ¬é”ä½æŸèµ„æºçš„ client crash äº†æˆ–è€…å‡ºç°äº†ç½‘ç»œåˆ†åŒº å®¹é”™æ€§ï¼šåªè¦å¤§éƒ¨åˆ† Redis èŠ‚ç‚¹å­˜æ´»å°±å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡ â€”â€”ç¼“å­˜å¼‚å¸¸â€”â€”1ã€çƒ­ç‚¹keyç¼“å­˜ä¸­çš„ä¸€ä¸ªKey(æ¯”å¦‚ä¸€ä¸ªä¿ƒé”€å•†å“)ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹è¿‡æœŸçš„æ—¶å€™ï¼Œæ°å¥½åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å¯¹è¿™ä¸ªKeyæœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚ è§£å†³æ–¹æ¡ˆ å¯¹ç¼“å­˜æŸ¥è¯¢åŠ é”ï¼Œå¦‚æœKEYä¸å­˜åœ¨ï¼Œå°±åŠ é”ï¼Œç„¶åæŸ¥DBå…¥ç¼“å­˜ï¼Œç„¶åè§£é”ï¼›å…¶ä»–è¿›ç¨‹å¦‚æœå‘ç°æœ‰é”å°±ç­‰å¾…ï¼Œç„¶åç­‰è§£é”åè¿”å›æ•°æ®æˆ–è€…è¿›å…¥DBæŸ¥è¯¢ â€”â€”â€”å…¶ä»–â€”â€”â€”1ã€ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§ä¸‰ç§æ–¹å¼ï¼šï¼ˆè¯¦æƒ…å¯ä»¥çœ‹ä¸€ä¸‹å‚è€ƒåšå®¢ï¼Œè¿™é‡Œç«™é•¿åšäº†å‡æ³•ï¼‰ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼ˆä¸»ï¼‰ ä¸€ã€å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ å®¹æ˜“å‡ºç°è„è¯» ä»¥åŠæµªè´¹æ€§èƒ½ï¼ˆä¸æ¨èï¼‰ äºŒã€å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ 1ã€å­˜åœ¨é—®é¢˜ï¼š è¯¥æ–¹æ¡ˆä¼šå¯¼è‡´ä¸ä¸€è‡´çš„åŸå› æ˜¯ï¼šåŒæ—¶æœ‰ä¸€ä¸ªè¯·æ±‚Aè¿›è¡Œæ›´æ–°æ“ä½œï¼Œå¦ä¸€ä¸ªè¯·æ±‚Bè¿›è¡ŒæŸ¥è¯¢æ“ä½œã€‚é‚£ä¹ˆä¼šå‡ºç°å¦‚ä¸‹æƒ…å½¢ï¼š ï¼ˆ1ï¼‰è¯·æ±‚Aè¿›è¡Œå†™æ“ä½œå‰ï¼Œå…ˆåˆ é™¤ç¼“å­˜ ï¼ˆ2ï¼‰è¯·æ±‚BæŸ¥è¯¢å‘ç°ç¼“å­˜ä¸å­˜åœ¨ ï¼ˆ3ï¼‰è¯·æ±‚Bå»æ•°æ®åº“æŸ¥è¯¢å¾—åˆ°æ—§å€¼ ï¼ˆ4ï¼‰è¯·æ±‚Bå°†æ—§å€¼å†™å…¥ç¼“å­˜ ï¼ˆ5ï¼‰è¯·æ±‚Aå°†æ–°å€¼å†™å…¥æ•°æ®åº“ ä¸Šè¿°æƒ…å†µå°±ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„æƒ…å½¢å‡ºç°ã€‚è€Œä¸”ï¼Œå¦‚æœä¸é‡‡ç”¨ç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ç­–ç•¥ï¼Œè¯¥æ•°æ®æ°¸è¿œéƒ½æ˜¯è„æ•°æ®ã€‚ 2ã€è§£å†³æ–¹æ¡ˆï¼šå»¶æ—¶åŒåˆ ç­–ç•¥ï¼šæ€§èƒ½å·®ï¼Œååé‡é™ä½ public void write(String key,Object data){ â€‹ redis.delKey(key); â€‹ db.updateData(data); â€‹ Thread.sleep(1000); â€‹ redis.delKey(key); â€‹ } è½¬åŒ–ä¸ºä¸­æ–‡æè¿°å°±æ˜¯ï¼š ï¼ˆ1ï¼‰å…ˆæ·˜æ±°ç¼“å­˜ ï¼ˆ2ï¼‰å†å†™æ•°æ®åº“ ï¼ˆ3ï¼‰ä¼‘çœ 1ç§’ï¼Œå†æ¬¡æ·˜æ±°ç¼“å­˜ ä¸‰ã€å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜ï¼š â€‹ æ–¹æ¡ˆä¸€ï¼šMQ æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š ï¼ˆ1ï¼‰æ›´æ–°æ•°æ®åº“æ•°æ®ï¼› ï¼ˆ2ï¼‰ç¼“å­˜å› ä¸ºç§ç§é—®é¢˜åˆ é™¤å¤±è´¥ ï¼ˆ3ï¼‰å°†éœ€è¦åˆ é™¤çš„keyå‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ— ï¼ˆ4ï¼‰è‡ªå·±æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å¾—éœ€è¦åˆ é™¤çš„key ï¼ˆ5ï¼‰ç»§ç»­é‡è¯•åˆ é™¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸ â€‹ ç„¶è€Œï¼Œè¯¥æ–¹æ¡ˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå¯¹ä¸šåŠ¡çº¿ä»£ç é€ æˆå¤§é‡çš„ä¾µå…¥ã€‚äºæ˜¯æœ‰äº†æ–¹æ¡ˆäºŒï¼Œåœ¨æ–¹æ¡ˆäºŒä¸­ï¼Œå¯åŠ¨ä¸€ä¸ªè®¢é˜…ç¨‹åºå»è®¢é˜…æ•°æ®åº“çš„binlogï¼Œè·å¾—éœ€è¦æ“ä½œçš„æ•°æ®ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¦èµ·ä¸€æ®µç¨‹åºï¼Œè·å¾—è¿™ä¸ªè®¢é˜…ç¨‹åºä¼ æ¥çš„ä¿¡æ¯ï¼Œè¿›è¡Œåˆ é™¤ç¼“å­˜æ“ä½œã€‚ â€‹ æ–¹æ¡ˆäºŒï¼šCanal æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ï¼ˆ1ï¼‰æ›´æ–°æ•°æ®åº“æ•°æ® ï¼ˆ2ï¼‰æ•°æ®åº“ä¼šå°†æ“ä½œä¿¡æ¯å†™å…¥binlogæ—¥å¿—å½“ä¸­ ï¼ˆ3ï¼‰è®¢é˜…ç¨‹åºæå–å‡ºæ‰€éœ€è¦çš„æ•°æ®ä»¥åŠkey ï¼ˆ4ï¼‰å¦èµ·ä¸€æ®µéä¸šåŠ¡ä»£ç ï¼Œè·å¾—è¯¥ä¿¡æ¯ ï¼ˆ5ï¼‰å°è¯•åˆ é™¤ç¼“å­˜æ“ä½œï¼Œå‘ç°åˆ é™¤å¤±è´¥ ï¼ˆ6ï¼‰å°†è¿™äº›ä¿¡æ¯å‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ— ï¼ˆ7ï¼‰é‡æ–°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å¾—è¯¥æ•°æ®ï¼Œé‡è¯•æ“ä½œ å¤‡æ³¨è¯´æ˜ï¼šä¸Šè¿°çš„è®¢é˜…binlogç¨‹åºåœ¨mysqlä¸­æœ‰ç°æˆçš„ä¸­é—´ä»¶å«canalï¼Œå¯ä»¥å®Œæˆè®¢é˜…binlogæ—¥å¿—çš„åŠŸèƒ½ã€‚å¦å¤–ï¼Œé‡è¯•æœºåˆ¶ï¼Œåšä¸»æ˜¯é‡‡ç”¨çš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ã€‚å¦‚æœå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œç›´æ¥åœ¨ç¨‹åºä¸­å¦èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å»é‡è¯•å³å¯ï¼Œè¿™äº›å¤§å®¶å¯ä»¥çµæ´»è‡ªç”±å‘æŒ¥ï¼Œåªæ˜¯æä¾›ä¸€ä¸ªæ€è·¯ã€‚ 2ã€å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ä½¿ç”¨keysæŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ã€‚ å¯¹æ–¹æ¥ç€è¿½é—®ï¼šå¦‚æœè¿™ä¸ªredisæ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨keysæŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ è¿™ä¸ªæ—¶å€™ä½ è¦å›ç­”rediså…³é”®çš„ä¸€ä¸ªç‰¹æ€§ï¼šredisçš„å•çº¿ç¨‹çš„ã€‚keysæŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨scanæŒ‡ä»¤ï¼ŒscanæŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨keysæŒ‡ä»¤é•¿ã€‚ 3ã€ä½¿ç”¨Redisåšè¿‡å¼‚æ­¥é˜Ÿåˆ—å—ï¼Œæ˜¯å¦‚ä½•å®ç°çš„ä½¿ç”¨listç±»å‹ä¿å­˜æ•°æ®ä¿¡æ¯ï¼Œrpushç”Ÿäº§æ¶ˆæ¯ï¼Œlpopæ¶ˆè´¹æ¶ˆæ¯ï¼Œå½“lpopæ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥sleepä¸€æ®µæ—¶é—´ï¼Œç„¶åå†æ£€æŸ¥æœ‰æ²¡æœ‰ä¿¡æ¯ï¼Œå¦‚æœä¸æƒ³sleepçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨blpop, åœ¨æ²¡æœ‰ä¿¡æ¯çš„æ—¶å€™ï¼Œä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°ä¿¡æ¯çš„åˆ°æ¥ã€‚rediså¯ä»¥é€šè¿‡pub/subä¸»é¢˜è®¢é˜…æ¨¡å¼å®ç°ä¸€ä¸ªç”Ÿäº§è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ï¼Œå½“ç„¶ä¹Ÿå­˜åœ¨ä¸€å®šçš„ç¼ºç‚¹ï¼Œå½“æ¶ˆè´¹è€…ä¸‹çº¿æ—¶ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ã€‚ 4ã€Rediså¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—ä½¿ç”¨sortedsetï¼Œä½¿ç”¨æ—¶é—´æˆ³åšscore, æ¶ˆæ¯å†…å®¹ä½œä¸ºkey,è°ƒç”¨zaddæ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨zrangbyscoreè·å–nç§’ä¹‹å‰çš„æ•°æ®åšè½®è¯¢å¤„ç†ã€‚ 5ã€Rediså›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œ ä¸€ä¸ªå®¢æˆ·ç«¯è¿è¡Œäº†æ–°çš„å‘½ä»¤ï¼Œæ·»åŠ äº†æ–°çš„æ•°æ®ã€‚ Redisæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœå¤§äºmaxmemoryçš„é™åˆ¶ï¼Œ åˆ™æ ¹æ®è®¾å®šå¥½çš„ç­–ç•¥è¿›è¡Œå›æ”¶ã€‚ ä¸€ä¸ªæ–°çš„å‘½ä»¤è¢«æ‰§è¡Œï¼Œç­‰ç­‰ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¸æ–­åœ°ç©¿è¶Šå†…å­˜é™åˆ¶çš„è¾¹ç•Œï¼Œé€šè¿‡ä¸æ–­è¾¾åˆ°è¾¹ç•Œç„¶åä¸æ–­åœ°å›æ”¶å›åˆ°è¾¹ç•Œä»¥ä¸‹ã€‚ å¦‚æœä¸€ä¸ªå‘½ä»¤çš„ç»“æœå¯¼è‡´å¤§é‡å†…å­˜è¢«ä½¿ç”¨ï¼ˆä¾‹å¦‚å¾ˆå¤§çš„é›†åˆçš„äº¤é›†ä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„é”®ï¼‰ï¼Œä¸ç”¨å¤šä¹…å†…å­˜é™åˆ¶å°±ä¼šè¢«è¿™ä¸ªå†…å­˜ä½¿ç”¨é‡è¶…è¶Šã€‚ 6ã€Rediså›æ”¶ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•LRUç®—æ³•ï¼Œä¸å…·ä½“å±•å¼€äº† äº”ã€åˆ†å¸ƒå¼äº‹åŠ¡1ã€å¸¸è§„ï¼ˆæ”¾æ¾è§£å‹ç‰ˆï¼‰1ã€äº‹åŠ¡çš„ç‰¹æ€§1.åŸå­æ€§ è¦ä¹ˆä¸€èµ·æˆåŠŸè¦ä¹ˆä¸€èµ·å¤±è´¥ 2.ä¸€è‡´æ€§ äº‹åŠ¡æ‰§è¡Œå‰åæ•°æ®ä¿æŒä¸€è‡´æ€§çŠ¶æ€ 3.éš”ç¦»æ€§ å¤šä¸ªäº‹åŠ¡ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œäº’ç›¸ä¸å½±å“ 4.æŒä¹…æ€§ äº‹åŠ¡ä¸€æ—¦æäº¤æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ 2ã€åˆ†å¸ƒå¼äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”çš„åŒºåˆ«åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯è§£å†³æµç¨‹åŒ–çš„é—®é¢˜ï¼Œåˆ†å¸ƒå¼é”æ˜¯è§£å†³èµ„æºå ç”¨é—®é¢˜ 3ã€mysqlå¦‚ä½•å®ç°æœ¬åœ°äº‹åŠ¡1.é€šè¿‡æ•°æ®åº“é”çš„æœºåˆ¶ï¼Œä¿éšœäº‹åŠ¡çš„éš”ç¦»æ€§ï¼› 2.é€šè¿‡ Redo Logï¼ˆé‡åšæ—¥å¿—ï¼‰æ¥ï¼Œä¿éšœäº‹åŠ¡çš„æŒä¹…æ€§ï¼› 3.é€šè¿‡ Undo Log ï¼ˆæ’¤é”€æ—¥å¿—ï¼‰æ¥ï¼Œä¿éšœäº‹åŠ¡çš„åŸå­æ€§ï¼› 4.é€šè¿‡ Undo Log ï¼ˆæ’¤é”€æ—¥å¿—ï¼‰æ¥ï¼Œä¿éšœäº‹åŠ¡çš„ä¸€è‡´æ€§ï¼› 4ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡åˆ†å¸ƒå¼äº‹åŠ¡ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸Šä¸€æ¬¡å¤§çš„æ“ä½œç”±å¤šä¸ªå°çš„æ“ä½œå®Œæˆï¼Œæ¯ä¸ªå°æ“ä½œéƒ½åœ¨ä¸åŒçš„åº”ç”¨æ‰§è¡Œï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯è¦ä¿è¯è¿™äº›æ“ä½œè¦ä¹ˆå¤±è´¥ï¼Œè¦ä¹ˆæˆåŠŸ 5ã€ä»€ä¹ˆæ˜¯capå®šç†webæœåŠ¡æ— æ³•åŒæ—¶æ»¡è¶³capå®šç† c ä¸€è‡´æ€§æ€§(Consistency):æ›´æ–°æ“ä½œæˆåŠŸå¹¶è¿”å›å®¢æˆ·ç«¯å®Œæˆåï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œä¸èƒ½å­˜åœ¨ä¸­é—´çŠ¶æ€ã€‚ a å¯ç”¨æ€§(Availability):ç³»ç»Ÿæä¾›çš„æœåŠ¡å¿…é¡»ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚ p åˆ†åŒºå®¹é”™æ€§(Partition tolerance):å³ä½¿å‡ºç°å•ä¸ªç»„ä»¶æ— æ³•å¯ç”¨ï¼Œæ“ä½œä¾ç„¶å¯ä»¥å®Œæˆ 6ã€ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§æ•°æ®æ›´æ–°æˆåŠŸè¿”å›å®¢æˆ·ç«¯ä¹‹åï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ä¿æŒä¸€è‡´ï¼Œæ²¡æœ‰ä¸­é—´çŠ¶æ€ å¼ºä¸€è‡´æ€§ï¼šæ—¶åˆ»ä¿è¯æ•°æ®ä¸€è‡´æ€§ æœ€ç»ˆä¸€è‡´æ€§ï¼šä¸€æ®µæ—¶é—´åä¿è¯æ•°æ®ä¸€è‡´æ€§ å¼±ä¸€è‡´æ€§ï¼šå…è®¸å­˜åœ¨éƒ¨åˆ†æ•°æ®ä¸ä¸€è‡´ 7ã€ä¸ºä»€ä¹ˆåˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•åŒæ—¶ä¿è¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿè€Œè¨€ï¼Œåˆ†åŒºå®¹é”™æ€§æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„è¦æ±‚ï¼Œå› æ­¤åŸºæœ¬ä¸Šæˆ‘ä»¬åœ¨è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ—¶å€™åªèƒ½ä»ä¸€è‡´æ€§ï¼ˆCï¼‰å’Œå¯ç”¨æ€§ï¼ˆAï¼‰ä¹‹é—´è¿›è¡Œå–èˆ 8ã€ä»€ä¹ˆæ˜¯baseå®šç†capå®šç†çš„aå’Œpçš„å»¶ä¼¸ï¼Œé€šè¿‡ç‰ºç‰²ä¸€è‡´æ€§æ¥è·å¾—å¯ç”¨æ€§ï¼Œå¹¶å…è®¸æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æœ€ç»ˆè¾¾åˆ°ä¸€è‡´çŠ¶æ€ 9ã€ä»€ä¹ˆæ˜¯åˆšæ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡åˆšæ€§äº‹åŠ¡ï¼šé€šå¸¸æ— ä¸šåŠ¡æ”¹é€ ï¼Œå¼ºä¸€è‡´æ€§ï¼ŒåŸç”Ÿæ”¯æŒå›æ»š/éš”ç¦»æ€§ï¼Œä½å¹¶å‘ï¼Œé€‚åˆçŸ­äº‹åŠ¡ XA åè®®ï¼ˆ2PCã€JTAã€JTSï¼‰ã€3PCï¼Œä½†ç”±äºåŒæ­¥é˜»å¡ï¼Œå¤„ç†æ•ˆç‡ä½ï¼Œä¸é€‚åˆå¤§å‹ç½‘ç«™åˆ†å¸ƒå¼åœºæ™¯ æŸ”æ€§äº‹åŠ¡ï¼šä¸è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œè€Œæ˜¯è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œå…è®¸æœ‰ä¸­é—´çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯Baseç†è®º TCC/FMTã€Sagaï¼ˆçŠ¶æ€æœºæ¨¡å¼ã€Aopæ¨¡å¼ï¼‰ã€æœ¬åœ°äº‹åŠ¡æ¶ˆæ¯ã€æ¶ˆæ¯äº‹åŠ¡ï¼ˆåŠæ¶ˆæ¯ï¼‰ 10ã€ä»€ä¹ˆæ˜¯XAXA ï¼Œå¼ºä¸€è‡´æ€§ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®ä¸€ç›´é”ä½çŠ¶æ€ï¼Œå³ä»prepareåˆ°commitã€rollbackçš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒTMä¸€ç›´æŠŠæŒæŠ˜æ•°æ®åº“çš„é”ï¼Œå¦‚æœæœ‰å…¶ä»–äººè¦ä¿®æ”¹æ•°æ®åº“çš„è¯¥æ¡æ•°æ®ï¼Œå°±å¿…é¡»ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œå­˜åœ¨é•¿äº‹åŠ¡é£é™©ã€‚ 11ã€åˆ†å¸ƒå¼äº‹åŠ¡æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆä¸€ã€2pcï¼šäºŒé˜¶æ®µæäº¤ï¼Œå¼ºä¸€è‡´æ€§è®¾è®¡ï¼Œå¼•å…¥ä¸€ä¸ªäº‹åŠ¡åè°ƒè€…çš„è§’è‰²æ¥åè°ƒç®¡ç†å„å‚ä¸è€…ï¼ˆä¹Ÿå¯ç§°ä¹‹ä¸ºå„æœ¬åœ°èµ„æºï¼‰çš„æäº¤å’Œå›æ»šï¼ŒäºŒé˜¶æ®µåˆ†åˆ«æŒ‡çš„æ˜¯å‡†å¤‡å’Œæäº¤ä¸¤ä¸ªé˜¶æ®µã€‚åŒæ­¥é˜»å¡ï¼Œå­˜åœ¨é•¿äº‹åŠ¡é£é™© ã€å‡†å¤‡æäº¤é˜¶æ®µ-æäº¤é˜¶æ®µã€‘ äºŒã€3pcï¼šåœ¨2pcä¹‹åå¤šåŠ å…¥é¢„æäº¤é˜¶æ®µï¼Œå’Œè¶…æ—¶ã€‚é¢„æäº¤é˜¶æ®µä¸»è¦æ˜¯è¯¢é—®äº‹åŠ¡å‚ä¸è€…æ˜¯å¦èƒ½æ­£å¸¸æœ‰æ¡ä»¶çš„æ‰§è¡Œ ã€å‡†å¤‡æäº¤é˜¶æ®µ-é¢„æäº¤é˜¶æ®µ-æäº¤é˜¶æ®µã€‘ ä¸‰ã€Tccï¼š2PC å’Œ 3PC éƒ½æ˜¯æ•°æ®åº“å±‚é¢çš„ï¼Œè€Œ TCC æ˜¯ä¸šåŠ¡å±‚é¢çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œéœ€è¦è‡ªå·±å®ç°Try - Confirm - Cancelä¸‰ä¸ªæ–¹æ³•ï¼Œå­˜åœ¨ä»£ç å…¥ä¾µä¸šåŠ¡ç´§è€¦åˆé—®é¢˜ Try æŒ‡çš„æ˜¯é¢„ç•™ï¼Œå³èµ„æºçš„é¢„ç•™å’Œé”å®šï¼Œæ³¨æ„æ˜¯é¢„ç•™ã€‚ Confirm æŒ‡çš„æ˜¯ç¡®è®¤æ“ä½œï¼Œè¿™ä¸€æ­¥å…¶å®å°±æ˜¯çœŸæ­£çš„æ‰§è¡Œäº†ã€‚ Cancel æŒ‡çš„æ˜¯æ’¤é”€æ“ä½œï¼Œå¯ä»¥ç†è§£ä¸ºæŠŠé¢„ç•™é˜¶æ®µçš„åŠ¨ä½œæ’¤é”€äº†ã€‚ å››ã€æ¶ˆæ¯äº‹åŠ¡ï¼šRocketMQå¾ˆå¥½æ”¯æŒæ¶ˆæ¯äº‹åŠ¡,æœ¬åœ°æ‰§è¡Œäº‹åŠ¡å‰å‘é€æ¶ˆæ¯ï¼Œæœ¬åœ°äº‹åŠ¡å¤±è´¥åˆ™ä¸¢å¼ƒæ¶ˆæ¯ï¼Œæœ¬åœ°æ‰§è¡ŒæˆåŠŸï¼Œæ¶ˆæ¯è®¢é˜…æ–¹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼ŒæˆåŠŸä¹‹åæ¶ˆè´¹æ¶ˆæ¯ã€‚ 12ã€2pcå’Œ3pcçš„åŒºåˆ«3pcå¤šåŠ å…¥é¢„æäº¤é˜¶æ®µï¼Œå’Œè¶…æ—¶ 13ã€Seata çš„atæ¨¡å¼ Seata ATåˆ†ä¸ºä¸¤é˜¶æ®µï¼Œä¸»è¦é€»è¾‘å…¨éƒ¨åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œç¬¬äºŒé˜¶æ®µä¸»è¦åšå›æ»šæˆ–æ—¥å¿—æ¸…ç†çš„å·¥ä½œã€‚ ä¼šåœ¨æ¯ä¸ªæ•°æ®åº“ä¸­ç»´æŠ¤undo_logè¡¨ @GlobalTransactional æ³¨è§£è¡¨ç¤ºå¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡ 14ã€2pcå’ŒSeataçš„atåŒºåˆ«atæ¨¡å¼æ˜¯å¢å¼ºç‰ˆçš„2pcï¼Œç¬¬ä¸€é˜¶æ®µä¸šåŠ¡æ•°æ®å’Œå›æ»šæ—¥å¿—è®°å½•åœ¨åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­æäº¤,æäº¤ä¹‹åå°±ä¼šé‡Šæ”¾èµ„æº 15ã€Seataçš„å››ç§æ¨¡å¼2ã€è¿›é˜¶1ã€è®¾è®¡ï¼š1ID+3ç»„ä»¶ï¼ˆseataï¼‰1ã€IDå…¨å±€å”¯ä¸€çš„äº‹åŠ¡IDï¼šTransaction ID XID 2ã€ç»„ä»¶Transaction Coordinator (TC)ã€ç¨‹åºå‘˜ã€‘ äº‹åŠ¡åè°ƒå™¨ï¼Œç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»šï¼› Transaction Manager (TM)ã€ç»ç†ã€‘ æ§åˆ¶å…¨å±€äº‹åŠ¡çš„è¾¹ç•Œï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›æ»šçš„å†³è®®ï¼› Resource Manager (RM)ã€ç”¨æˆ·ã€‘ æ§åˆ¶åˆ†æ”¯äº‹åŠ¡ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œã€çŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æ¥æ”¶äº‹åŠ¡åè°ƒå™¨çš„æŒ‡ä»¤ï¼Œé©±åŠ¨åˆ†æ”¯ï¼ˆæœ¬åœ°ï¼‰äº‹åŠ¡çš„æäº¤å’Œå›æ»š XIDã€ç¨‹åºã€‘ 2ã€å¤„ç†è¿‡ç¨‹ ATæ¨¡å¼ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š ä¸€é˜¶æ®µï¼š è§£æSQLï¼Œè·å–SQLç±»å‹ï¼ˆCRUDï¼‰ã€è¡¨ä¿¡æ¯ã€æ¡ä»¶(where) ç­‰ç›¸å…³ä¿¡æ¯æŸ¥è¯¢å‰é•œåƒ(æ”¹å˜ä¹‹å‰çš„æ•°æ®)ï¼Œæ ¹æ®è§£æå¾—åˆ°çš„æ¡ä»¶ä¿¡æ¯ï¼Œç”ŸæˆæŸ¥è¯¢è¯­å¥ï¼Œå®šä½æ•°æ®æ‰§è¡Œä¸šåŠ¡SQLï¼Œæ›´æ–°æ•°æ®æŸ¥è¯¢åé•œåƒï¼ˆæ”¹å˜åçš„æ•°æ®ï¼‰ï¼Œæ ¹æ®å‰é•œåƒçš„ç»“æœï¼Œé€šè¿‡ä¸»é”®éƒ½ç»™ä½ ä¸ºæ•°æ®æ’å…¥å›æ»šæ—¥å¿—ï¼Œå°†å‰åé•œåƒæ•°æ®ä»¥åŠä¸šåŠ¡SQLç­‰ä¿¡æ¯ï¼Œç»„ç»‡æˆä¸€æ¡å›æ»šæ—¥å¿—è®°å½•ï¼Œæ’å…¥åˆ°undo Logè¡¨ä¸­æäº¤å‰ï¼Œå‘TCæ³¨å†Œåˆ†æ”¯ï¼Œç”³è¯·å…¨å±€é”æœ¬åœ°äº‹åŠ¡æäº¤ï¼Œä¸šåŠ¡æ•°æ®çš„æ›´ç»†è…»å’Œç”Ÿæˆçš„undoLogä¸€èµ·æäº¤å°†æœ¬åœ°äº‹åŠ¡æäº¤çš„ç»“æœé€šçŸ¥ç»™TC äºŒé˜¶æ®µï¼š å¦‚æœTCæ”¶åˆ°çš„æ˜¯å›æ»šè¯·æ±‚ å¼€å¯æœ¬åœ°äº‹åŠ¡ï¼Œé€šè¿‡XIDå’ŒBranchIDæŸ¥æ‰¾åˆ°å¯¹åº”çš„undo Logè®°å½•æ ¹æ®undoLogä¸­çš„å‰é•œåƒå’Œä¸šåŠ¡SQLçš„ç›¸å…³ä¿¡æ¯ç”Ÿæˆå¹¶æ‰§è¡Œå›æ»šè¯­å¥æäº¤æœ¬åœ°äº‹åŠ¡ï¼Œå°†æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœï¼ˆåˆ†æ”¯äº‹åŠ¡å›æ»šçš„ä¿¡æ¯ï¼‰é€šçŸ¥ç»™TCå¦‚æœæ²¡é—®é¢˜ï¼Œæ‰§è¡Œæäº¤æ“ä½œ æ”¶åˆ°TCåˆ†æ”¯æäº¤è¯·æ±‚ï¼Œå°†è¯·æ±‚æ”¾å…¥åˆ°ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„é˜Ÿåˆ—ä¸­ï¼Œé©¬ä¸Šè¿”å›æäº¤æˆåŠŸçš„ç»“æœç»™TCå¼‚æ­¥ä»»åŠ¡é˜¶æ®µçš„åˆ†æ”¯æäº¤è¯·æ±‚åˆ é™¤undoLogä¸­è®°å½• 3ã€åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹å¼1ã€å…­ã€Spring1ã€çƒ­èº«é¢˜1.ä»€ä¹ˆæ˜¯spring?ä¸€ä¸ªè½»é‡çº§å¼€æºæ¡†æ¶ï¼Œç®€åŒ–å¼€å‘ã€‚æ ¸å¿ƒæ˜¯iocæ§åˆ¶åè½¬å’Œaopé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚ ç®€åŒ–å¼€å‘: é€šè¿‡åˆ‡é¢å’Œæ¨¡æ¿å‡å°‘é‡å¤æ€§ä»£ç ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥åˆ›å»ºå¯¹è±¡ï¼Œå®ç°æ¾è€¦åˆ 2.ä»€ä¹ˆæ˜¯iocå’Œaopï¼Ÿiocæ§åˆ¶åè½¬ï¼Œå®ç°å¯¹è±¡çš„è€¦åˆå…³ç³»çš„ç®¡ç†ï¼Œå°†å¯¹è±¡çš„ä¾èµ–å…³ç³»äº¤ç»™iocç®¡ç†ã€‚ aopé¢å‘åˆ‡é¢ç¼–ç¨‹,åŠ¨æ€éä¾µå…¥çš„æ–¹å¼å¢å¼ºæœåŠ¡ã€‚ 3.aopçš„å®ç°æœºåˆ¶ï¼Ÿé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ï¼Œä¸¤è€…åŒºåˆ«æ˜¯é™æ€ä»£ç†æ˜¯äº‹å…ˆå·²ç»å®šä¹‰å¥½çš„ï¼ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™åˆ›å»ºçš„ åŠ¨æ€ä»£ç†ï¼šåˆ†ä¸ºjdkåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†ã€‚ 4.jdkåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†çš„åŒºåˆ«?jdkåŠ¨æ€ä»£ç†é€šè¿‡å®ç°è¢«ä»£ç†å¯¹è±¡çš„æ¥å£ï¼ŒcglibåŠ¨æ€ä»£ç†é€šè¿‡ç»§æ‰¿è¢«ä»£ç†å¯¹è±¡å®ç° jdkåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†å®ç°æ¥å£çš„ç±»ï¼ŒcglibåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ²¡æœ‰è¢«finalä¿®é¥°çš„ç±»å’Œæ–¹æ³• jdkåŠ¨æ€ä»£ç†é€šè¿‡åå°„æœºåˆ¶å®ç°ï¼ŒcglibåŠ¨æ€ä»£ç†é€šè¿‡fastClassæœºåˆ¶å®ç° 5.aopæœ‰å“ªäº›é€šçŸ¥ç±»å‹ï¼Ÿå‰ç½®é€šçŸ¥ Before Advice:åœ¨æ–¹æ³•å‰åˆ‡å…¥ åç½®é€šçŸ¥ After Advice:åœ¨æ–¹æ³•ååˆ‡å…¥ æ­£å¸¸è¿”å›é€šçŸ¥ After Returning Advice:åœ¨æ–¹æ³•è¿”å›ååˆ‡å…¥ï¼ŒæŠ›å‡ºå¼‚å¸¸åˆ™ä¸ä¼šåˆ‡å…¥ å¼‚å¸¸é€šçŸ¥ After Throwing Advice:æŠ›å‡ºå¼‚å¸¸æ—¶åˆ‡å…¥ ç¯ç»•é€šçŸ¥ Around Advice:åœ¨æ–¹æ³•æ‰§è¡Œå‰ååˆ‡å…¥ï¼Œå¯ä»¥ä¸­æ–­æˆ–å¿½ç•¥åŸæœ‰æµç¨‹çš„æ‰§è¡Œ 6.aopæœ‰å“ªäº›è¿ç”¨åœºæ™¯?1.å…¨å±€å¼‚å¸¸å¤„ç† 2.é˜²æ­¢æ¥å£é‡å¤æäº¤ 3.æ¥å£å¹‚ç­‰æ€§ 4.æ—¥å¿—è®°å½• 5.äº‹åŠ¡ 7.aopçš„å®ç°ï¼Ÿ@Aspectå®šä¹‰åˆ‡é¢ç±» @Pointcutå®šä¹‰åˆ‡å…¥ç‚¹ å®šä¹‰é€šçŸ¥ç±»å‹ @Befor @After @Arounr @AfterReturning @AfterThrowing 8.springæœ‰å“ªäº›ä¼˜ç¼ºç‚¹?1.iocå°†å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–äº¤ç»™iocå®¹å™¨ï¼Œæ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘ 2.aopé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œéå…¥ä¾µæ–¹å¼å¢å¼ºæœåŠ¡ï¼Œå‡å°‘é‡å¤ä»£ç  3.å£°æ˜å¼äº‹åŠ¡ï¼Œæ–¹ä¾¿æµ‹è¯• 4.æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶ ç¼ºç‚¹ï¼šé…ç½®ç¹çï¼Œä¾èµ–åå°„å½±å“æ€§èƒ½ï¼Œå…¥é—¨æ—¶é—´é•¿ 9.springæœ‰å“ªäº›æ¨¡å—ç»„æˆï¼Ÿ1.spring jdbc 2.spring core 3.sping beans 4.spring aop 5.spring web 6.spring test 10.springæ¡†æ¶ç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ1.å·¥å‚æ¨¡å¼ 2.å•ä¾‹æ¨¡å¼ 3.æ¨¡æ¿æ–¹æ³• 4.ä»£ç†æ¨¡å¼ ç­‰ 11.springä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶? ä¸Šä¸‹æ–‡æ›´æ–°äº‹ä»¶ï¼ˆContextRefreshedEventï¼‰ï¼šåœ¨è°ƒç”¨ConfigurableApplicationContext æ¥å£ä¸­çš„refresh()æ–¹æ³•æ—¶è¢«è§¦å‘ã€‚ ä¸Šä¸‹æ–‡å¼€å§‹äº‹ä»¶ï¼ˆContextStartedEventï¼‰ï¼šå½“å®¹å™¨è°ƒç”¨ConfigurableApplicationContextçš„Start()æ–¹æ³•å¼€å§‹/é‡æ–°å¼€å§‹å®¹å™¨æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚ ä¸Šä¸‹æ–‡åœæ­¢äº‹ä»¶ï¼ˆContextStoppedEventï¼‰ï¼šå½“å®¹å™¨è°ƒç”¨ConfigurableApplicationContextçš„Stop()æ–¹æ³•åœæ­¢å®¹å™¨æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚ ä¸Šä¸‹æ–‡å…³é—­äº‹ä»¶ï¼ˆContextClosedEventï¼‰ï¼šå½“ApplicationContextè¢«å…³é—­æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚å®¹å™¨è¢«å…³é—­æ—¶ï¼Œå…¶ç®¡ç†çš„æ‰€æœ‰å•ä¾‹Beanéƒ½è¢«é”€æ¯ã€‚ è¯·æ±‚å¤„ç†äº‹ä»¶ï¼ˆRequestHandledEventï¼‰ï¼šåœ¨Webåº”ç”¨ä¸­ï¼Œå½“ä¸€ä¸ªhttpè¯·æ±‚ï¼ˆrequestï¼‰ç»“æŸè§¦å‘è¯¥äº‹ä»¶ã€‚å¦‚æœä¸€ä¸ªbeanå®ç°äº†ApplicationListeneræ¥å£ï¼Œå½“ä¸€ä¸ªApplicationEvent è¢«å‘å¸ƒä»¥åï¼Œbeanä¼šè‡ªåŠ¨è¢«é€šçŸ¥ã€‚ 12.BeanFactory å’Œ ApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸBeanFactory æ˜¯åŸºç¡€iocå®¹å™¨ï¼Œæ‹¥æœ‰åŸºæœ¬çš„iocå®¹å™¨åŠŸèƒ½ ApplicationContext æ˜¯BeanFactory çš„å­ç±»ï¼Œæ‹¥æœ‰BeanFactory çš„å…¨éƒ¨åŠŸèƒ½ã€‚è¿˜æ‰©å±•äº†å…¶ä»–åŠŸèƒ½:å›½é™…åŒ– BeanFactory é‡‡ç”¨å»¶è¿ŸåŠ è½½beanï¼ŒApplicationContextä¸€æ¬¡æ€§åŠ è½½bean BeanFactoryå’ŒApplicationContextéƒ½æ”¯æŒ BeanPostProcessorã€BeanFactoryPostProcessorã€‚ BeanFactory éœ€è¦æ‰‹åŠ¨æ³¨å†Œã€‚ApplicationContextè‡ªåŠ¨æ³¨å†Œ 13.springæœ‰å“ªäº›ä¾èµ–æ³¨å…¥æ–¹å¼?1.æ„é€ å™¨æ³¨å…¥ 2.setæ³¨å…¥ æ„é€ å™¨å‚æ•°å®ç°å¼ºåˆ¶ä¾èµ–ï¼Œsetteræ–¹æ³•å®ç°å¯é€‰ä¾èµ– 14.ä»€ä¹ˆæ˜¯spring beans?å°±æ˜¯java å¯¹è±¡,å®ƒä»¬è¢«Spring IOCå®¹å™¨åˆå§‹åŒ–ï¼Œè£…é…ï¼Œç®¡ç†ã€‚ 15.ä¸€ä¸ªspring beanå®šä¹‰åŒ…å«ä»€ä¹ˆ?beançš„åˆ›å»º, ç”Ÿå‘½å‘¨æœŸï¼Œä¾èµ– 16.spring beançš„ä½œç”¨åŸŸ?é€šçŸ¥è®¾ç½®beançš„ scopeå±æ€§æ¥å®šä¹‰beançš„ä½œç”¨åŸŸ,ä½œç”¨åŸŸç±»å‹æœ‰: 1.singleton : beanåœ¨æ¯ä¸ªiocå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚ 2.prototypeï¼šä¸€ä¸ªbeançš„å®šä¹‰å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ã€‚(å¼€é”€å¤§) 3.requestï¼šæ¯æ¬¡httpè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªbean(åŸºäºwebçš„Spring ApplicationContextæƒ…å½¢ä¸‹æœ‰æ•ˆ) 4.sessionï¼šåœ¨ä¸€ä¸ªHTTP Sessionä¸­ï¼Œä¸€ä¸ªbeanå®šä¹‰å¯¹åº”ä¸€ä¸ªå®ä¾‹ã€‚(åŸºäºwebçš„Spring ApplicationContextæƒ…å½¢ä¸‹æœ‰æ•ˆ) 5.global-sessionï¼šåœ¨ä¸€ä¸ªå…¨å±€çš„HTTP Sessionä¸­ï¼Œä¸€ä¸ªbeanå®šä¹‰å¯¹åº”ä¸€ä¸ªå®ä¾‹ã€‚(åŸºäºwebçš„Spring ApplicationContextæƒ…å½¢ä¸‹æœ‰æ•ˆ) 17.spring ä¸­çš„å•ä¾‹beanæ˜¯çº¿ç¨‹å®‰å…¨ä¹ˆ?ä¸æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œå¤§éƒ¨åˆ†å•ä¾‹beanæ˜¯æ— çŠ¶æ€çš„ï¼Œæ¯”å¦‚ dao ç±»ï¼ŒæŸç§ç¨‹åº¦æ¥è¯´ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚ 18.spring beançš„ç”Ÿå‘½å‘¨æœŸ?1.å®ä¾‹åŒ–ï¼Œåˆ›å»ºbeanå¯¹è±¡ 2.å±æ€§å¡«å…… 3.åˆå§‹åŒ– 3.1.å®ç°äº†xxxAwareç±»å‹çš„æ¥å£ï¼Œé€šè¿‡ä¸åŒç±»å‹çš„Awareæ¥å£æ‹¿åˆ°Springå®¹å™¨çš„èµ„æº 3.1.1.ç®€å•çš„awareç±»å‹æ¥å£ BeanNameAware BeanClassLoaderAware BeanFactoryAware 3.2.å®ç°äº†beanPostProcessoræ¥å£ï¼Œåˆ™ä¼šåœ¨åˆå§‹åŒ–å‰åå›è°ƒpostProcessBeforeInitialzationå’ŒpostProcessAfterInitializationæ–¹æ³• 3.3.é…ç½®äº†init-mothodæ–¹æ³•ï¼Œåˆ™ä¼šæ‰§è¡Œé…ç½®çš„æ–¹æ³• 4.é”€æ¯ 4.1.beanå®ç°äº†DisposableBeanï¼Œåˆ™ä¼šå›è°ƒdestroyæ–¹æ³• 4.2.é…ç½®äº†destroy-methodæ–¹æ³•ï¼Œåˆ™ä¼šæ‰§è¡Œé…ç½®çš„æ–¹æ³• 19.@Autowiredå’Œ@Resource?1.@Autowiredé»˜è®¤æŒ‰ç±»å‹è£…é…ï¼ŒæŸ¥è¯¢ç»“æœä¸ºä¸€ä¸ªæ—¶ï¼Œç›´æ¥è£…é…ã€‚æŸ¥è¯¢ç»“æœä¸ºå¤šä¸ªæ—¶ï¼ŒæŒ‰åç§°è£…é…ã€‚æŸ¥è¯¢ä¸åˆ°åˆ™æŠ¥é”™ã€‚ä¸æŠ¥é”™åˆ™è®¾ç½®å±æ€§required=falseã€‚å¯ä»¥é…å’Œ@Qualifier æŒ‰åå­—è£…é… 2.@Resourceé»˜è®¤æŒ‰åå­—è£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŒ‰ç…§ç±»å‹è£…é…ã€‚æŒ‡å®šnameå±æ€§åˆ™æŒ‰åç§°è£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ¥é”™ã€‚æŒ‡å®štypeåˆ™æŒ‰ç…§ç±»å‹è£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ¥é”™ 20.FactoryBean å’Œ BeanFactoryæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸBeanFactory æ˜¯ Bean çš„å·¥å‚ï¼Œ ApplicationContext çš„çˆ¶ç±»ï¼ŒIOC å®¹å™¨çš„æ ¸å¿ƒï¼Œè´Ÿè´£ç”Ÿäº§å’Œç®¡ç† Bean å¯¹è±¡ã€‚ FactoryBean æ˜¯ Beanï¼Œå¯ä»¥é€šè¿‡å®ç° FactoryBean æ¥å£å®šåˆ¶å®ä¾‹åŒ– Bean çš„é€»è¾‘ï¼Œé€šè¿‡ä»£ç†ä¸€ä¸ªBeanå¯¹è±¡ï¼Œå¯¹æ–¹æ³•å‰ååšä¸€äº›æ“ä½œã€‚ 21.Spring å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿspringé€šè¿‡ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–: singletonObjects ä¸€çº§ç¼“å­˜ï¼Œç”¨äºä¿å­˜å®ä¾‹åŒ–ã€æ³¨å…¥ã€åˆå§‹åŒ–å®Œæˆçš„beanå®ä¾‹ earlySingletonObjects äºŒçº§ç¼“å­˜ï¼Œç”¨äºä¿å­˜å®ä¾‹åŒ–å®Œæˆçš„beanå®ä¾‹ singletonFactories ä¸‰çº§ç¼“å­˜ï¼Œç”¨äºä¿å­˜beanåˆ›å»ºå·¥å‚ï¼Œä»¥ä¾¿äºåé¢æ‰©å±•æœ‰æœºä¼šåˆ›å»ºä»£ç†å¯¹è±¡ã€‚ 22.ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼ŸäºŒçº§ç¼“å­˜ä¸è¡Œä¹ˆ?ä¸‰çº§ç¼“å­˜æ˜¯ä¸ºäº†ä¿è¯ä¸ç®¡ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ å¦‚æœä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œå¤šçº¿ç¨‹æƒ…å†µä¸‹å¯èƒ½è·å–çš„å¯¹è±¡ä¸ä¸€è‡´ 23.springè§£å†³å¾ªç¯ä¾èµ–çš„æ–¹æ³•?ä½¿ç”¨@Lazyæ³¨è§£ï¼Œå»¶è¿ŸåŠ è½½ ä½¿ç”¨@DependsOnæ³¨è§£ï¼ŒæŒ‡å®šåŠ è½½å…ˆåå…³ç³» 24.springçš„äº‹åŠ¡ä¼ æ’­æ–¹å¼ï¼Ÿrequired å½“å‰æ²¡æœ‰äº‹åŠ¡åˆ™åˆ›å»ºäº‹åŠ¡ï¼Œå­˜åœ¨äº‹åŠ¡åˆ™åŠ å…¥ã€‚ requires_new ä¸ç®¡æœ‰æ²¡äº‹åŠ¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡æ‰§è¡Œã€‚ supports å­˜åœ¨äº‹åŠ¡åˆ™åŠ å…¥ï¼Œä¸å­˜åœ¨åˆ™å·²éäº‹åŠ¡åªæƒ³ã€‚ not_supported ä»¥éäº‹åŠ¡æ‰§è¡Œï¼Œå­˜åœ¨äº‹åŠ¡åˆ™æŒ‚èµ· mandatory å­˜åœ¨äº‹åŠ¡åˆ™åŠ å…¥ï¼Œä¸å­˜åœ¨åˆ™æŠ¥é”™ never ä»¥éäº‹åŠ¡æ‰§è¡Œï¼Œå­˜åœ¨äº‹åŠ¡åˆ™æŠ¥é”™ nested å­˜åœ¨äº‹åŠ¡åˆ™åµŒå¥—äº‹åŠ¡æ‰§è¡Œ 25.spring äº‹åŠ¡çš„éš”ç¦»çº§åˆ«?default ä½¿ç”¨æ•°æ®åº“è®¾ç½®çš„ read_uncommitted è¯»æœªæäº¤(å‡ºç°å¹»è¯»ã€è„è¯»ã€ä¸å¯é‡å¤è¯») read_committed è¯»å·²æäº¤,è¯»çš„éƒ½æ˜¯åˆ«çš„äº‹åŠ¡å·²æäº¤çš„ï¼ˆä¼šé€ æˆå¹»è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰sql serveré»˜è®¤çº§åˆ« repeatable_read å¯é‡å¤è¯»ï¼Œä¿è¯å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œå…¶å€¼éƒ½å’Œäº‹åŠ¡å¼€å§‹æ—¶å€™çš„å†…å®¹æ˜¯ä¸€è‡´ï¼Œç¦æ­¢è¯»å–åˆ°åˆ«çš„äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼ˆä¼šé€ æˆå¹»è¯») serializable ä¸²è¡Œï¼Œä»£ä»·æœ€é«˜æœ€å¯é çš„éš”ç¦»çº§åˆ«ï¼Œè¯¥éš”ç¦»çº§åˆ«èƒ½é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚ è„è¯» ï¼šè¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡èƒ½å¤Ÿè¯»å–å¦ä¸€ä¸ªäº‹åŠ¡ä¸­è¿˜æœªæäº¤çš„æ•°æ®ã€‚ ä¸å¯é‡å¤è¯» ï¼šæ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ å¹»è¯» ï¼šæŒ‡åŒä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢è¿”å›çš„ç»“æœé›†ä¸ä¸€æ ·ã€‚ 26 .ä»€ä¹ˆæ˜¯spring mvc?åŸºäºjavaå®ç°äº†mvcè®¾è®¡æ¨¡å¼è¯·æ±‚é©±åŠ¨ç±»å‹çš„è½»é‡çº§æ¡†æ¶ï¼ŒæŠŠæ¨¡å‹ï¼Œè§†å›¾ï¼Œæ§åˆ¶å™¨åˆ†ç¦»å‡ºæ¥ã€‚å°†webå±‚è¿›è¡ŒèŒè´£è§£è€¦ï¼Œç®€åŒ–å¼€å‘ 27.spring mvcå·¥ä½œåŸç†ï¼Ÿ1.ç”¨æˆ·å‘é€è¯·æ±‚åˆ°å‰ç«¯æ§åˆ¶å™¨(DispatcherServlet) 2.å‰ç«¯æ§åˆ¶å™¨è°ƒç”¨å¤„ç†å™¨æ˜ å°„å™¨(HandlerMapping) 3.å¤„ç†å™¨æ˜ å°„å™¨æ ¹æ®urlæ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨ï¼ˆHandlerï¼‰ï¼Œç”Ÿæˆå¤„ç†å™¨å¯¹è±¡ï¼Œå¦‚æœæœ‰æ‹¦æˆªå™¨ä¸€èµ·è¿”å›ç»™å‰ç«¯æ§åˆ¶å™¨ 4.å‰ç«¯æ§åˆ¶å™¨è°ƒç”¨å¤„ç†å™¨é€‚é…å™¨ï¼ˆHandlerAdapterï¼‰ï¼Œç»è¿‡é€‚é…å™¨è°ƒç”¨åç«¯æ§åˆ¶å™¨ 5.æ‰§è¡Œå®Œæ¯•åè¿”å›ModelAndViewï¼Œå¤„ç†å™¨é€‚é…å™¨å°†ç»“æœè¿”å›å‰ç«¯æ§åˆ¶å™¨ 6.å‰ç«¯æ§åˆ¶å™¨ä¼ ç»™è¯•å›¾è§£æå™¨ï¼ˆViewResolverï¼‰è¿›è¡Œè§£æ,è¿”å›å…·ä½“çš„è§†å›¾(view)ï¼Œè¿›è¡Œæ¸²æŸ“è¿”å›ç»™ç”¨æˆ· 28.spring iocå®¹å™¨æ„å»ºæµç¨‹?1.è·å–ä¸€ä¸ªæ–°çš„beanå·¥å‚ï¼Œé€šå¸¸æ˜¯applicationContext 2.åŠ è½½å’Œè§£æspringé…ç½®æ–‡ä»¶ï¼Œè§£æbeanå¯¹è±¡å°è£…æˆbeanDefinitionæ”¾åˆ°æœ¬åœ°ç¼“å­˜ 3.å®ä¾‹åŒ–å’Œè°ƒç”¨beanFactoryPostProcessorçš„BeanDefinitionRegistryPostProcessorçš„æ‰©å±•æ–¹æ³• 4.å®ä¾‹åŒ–beanPostProcessor,åŠ è½½åˆ°beanFactoryä¸­ã€‚åœ¨beançš„åˆå§‹åŒ–å‰åè§¦å‘æ‰©å±•ç‚¹postProcessBeforeInitialization() / postProcessAfterInitialization() 5.å®ä¾‹åŒ–æ‰€æœ‰å‰©ä½™çš„beanï¼ŒåŒ…æ‹¬åˆ›å»ºbeanï¼Œå±æ€§å¡«å……ï¼Œåˆå§‹åŒ– 6.å®Œæˆå®¹å™¨åˆ·æ–°ï¼Œæ¨é€ä¸Šä¸‹æ–‡åˆ·æ–°äº‹ä»¶(contextRefresEvent)åˆ°ç›‘å¬å™¨ 29.spring bootå¯åŠ¨æµç¨‹ï¼Ÿ1.åˆ›å»ºspringApplicationå®ä¾‹ä»¥åŠåˆå§‹åŒ– 2.é€šè¿‡SpringFactoriesLoaderåŠ è½½ç›‘å¬å™¨,å‘å¸ƒEventPublishingRunListener.starting()äº‹ä»¶ï¼› 3.åˆ›å»ºå’Œé…ç½®Environmentï¼Œè§¦å‘ConfigFileApplicationListenerç›‘å¬å™¨,åŠ è½½application.properties/ymlé…ç½®æ–‡ä»¶ 4.åˆ›å»ºApplicationContext,å®¹å™¨åˆ·æ–°çš„äº‹å‰å‡†å¤‡ï¼Œå®¹å™¨åˆ·æ–°(iocå®¹å™¨åˆ›å»ºæµç¨‹)ï¼Œå‘å¸ƒä¸Šä¸‹æ–‡åˆ·æ–°å®Œæ¯•äº‹ä»¶ 5.å‘å¸ƒSpringBootç¨‹åºå·²å¯åŠ¨äº‹ä»¶ApplicationStartedEvent 6.è°ƒç”¨ApplicationRunnerå’ŒCommandLineRunner 7.æœ€åå‘å¸ƒrefreshå®Œæ¯•ã€runneræ‰§è¡Œå®Œæ¯•çš„äº‹ä»¶ 30.springäº‹åŠ¡å®ç°çš„åŸç†?é€šè¿‡aop+threadLocal+try/catchå®ç°: åŠ¨æ€ä»£ç†ï¼šåŸºæœ¬æ‰€æœ‰è¦è¿›è¡Œé€»è¾‘å¢å¼ºçš„åœ°æ–¹éƒ½ä¼šç”¨åˆ°åŠ¨æ€ä»£ç†ï¼ŒAOP åº•å±‚ä¹Ÿæ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å®ç°ã€‚ ThreadLocalï¼šä¸»è¦ç”¨äºçº¿ç¨‹é—´çš„èµ„æºéš”ç¦»ï¼Œä»¥æ­¤å®ç°ä¸åŒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®æºã€éš”ç¦»çº§åˆ«ç­‰ç­‰ã€‚ try/catchï¼šæœ€ç»ˆæ˜¯æ‰§è¡Œ commit è¿˜æ˜¯ rollbackï¼Œæ˜¯æ ¹æ®ä¸šåŠ¡é€»è¾‘å¤„ç†æ˜¯å¦æŠ›å‡ºå¼‚å¸¸æ¥å†³å®šã€‚ 31.springå¸¸è§çš„æ‰©å±•ç‚¹?1.BeanFactoryPostProcessor postProcessBeanFactory æ–¹æ³•ï¼Œåœ¨åŠ è½½å®Œ Bean å®šä¹‰ä¹‹åï¼Œåˆ›å»º Bean å®ä¾‹ä¹‹å‰è¢«è§¦å‘ï¼Œé€šå¸¸ä½¿ç”¨è¯¥æ‰©å±•ç‚¹æ¥åŠ è½½ä¸€äº›è‡ªå·±çš„ bean å®šä¹‰ã€‚ 2.BeanPostProcessor postProcessBeforeInitialization æ–¹æ³•ï¼Œæ‰§è¡Œ bean çš„åˆå§‹åŒ–æ–¹æ³•å‰è¢«è§¦å‘ï¼› postProcessAfterInitialization æ–¹æ³•ï¼Œæ‰§è¡Œ bean çš„åˆå§‹åŒ–æ–¹æ³•åè¢«è§¦å‘ã€‚ 2.InitializingBean afterPropertiesSet æ–¹æ³•ï¼Œåœ¨ bean çš„å±æ€§å¡«å……ä¹‹åï¼Œåˆå§‹åŒ–æ–¹æ³•ï¼ˆinit-methodï¼‰ä¹‹å‰è¢«è§¦å‘ 3.DisposableBean destroy æ–¹æ³•ï¼Œåœ¨ bean çš„é”€æ¯é˜¶æ®µè¢«è§¦å‘ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨åŸºæœ¬ç­‰åŒäº destroy-methodï¼Œä¸»ç”¨ç”¨äºæ‰§è¡Œé”€æ¯ç›¸å…³æ“ä½œã€‚ 32.springbootå¦‚ä½•å®ç°è‡ªåŠ¨è£…é…?å¯åŠ¨ç±»ä¸­@SpringbootApplicaiton æ³¨è§£æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª@EnableAutoConfigurationæ³¨è§£ã€‚ è¿™ä¸ªæ³¨è§£ç±»ä¸­ä½¿ç”¨@Importæ³¨è§£åŠ è½½EnableAutoConfigurationImportSelectorç±»ã€‚è¿™ä¸ªç±»æ˜¯åœ¨spring-autoConfigåŒ…ä¸­ã€‚ä»–ä¼šåŠ è½½åŒ…ä¸­çš„spring.factoriesæ–‡ä»¶å†…å®šä¹‰çš„autoconfigurationç±»ã€‚ 33.å¦‚ä½•è‡ªå·±å®ç°ä¸€ä¸ªstarter?starterç®€å•æ¥è¯´å°±æ˜¯å°†ä¸€ä¸ªç¹ççš„æ“ä½œæ‰“åŒ…æˆä¸€ä¸ªjarï¼Œè®©ä½ ç›´æ¥åŠ å…¥è¿™ä¸ªä¾èµ–ï¼Œçœå»ç¹ççš„æ­¥éª¤ åˆ›å»ºä¸€ä¸ªstarteré¡¹ç›® åˆ›å»ºä¸€ä¸ªConfigurationPropertiesç”¨äºä¿å­˜ä½ çš„é…ç½®ä¿¡æ¯ï¼ˆ åˆ›å»ºä¸€ä¸ªAutoConfigurationï¼Œå¼•ç”¨å®šä¹‰å¥½çš„é…ç½®ä¿¡æ¯ï¼›åœ¨AutoConfigurationä¸­å®ç°æ‰€æœ‰starteråº”è¯¥å®Œæˆçš„æ“ä½œï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªç±»åŠ å…¥spring.factoriesé…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå£°æ˜ æ‰“åŒ…é¡¹ç›®ï¼Œä¹‹ååœ¨ä¸€ä¸ªSpringBooté¡¹ç›®ä¸­å¼•å…¥è¯¥é¡¹ç›®ä¾èµ–ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨è¯¥starteräº† 2ã€â€”ä¸ƒã€jvm1ã€ç±»åŠ è½½- è¯´è¯´ä½ è®¤è¯†çš„è™šæ‹Ÿæœº â˜…â˜…â˜…é»˜è®¤ï¼ŒHotspotï¼›é˜¿é‡Œçš„ taobaoVMï¼Œåä¸ºçš„é¸¿è’™VM - JVMä¸­ç±»åŠ è½½çš„ç”Ÿå‘½å‘¨æœŸï¼ˆç±»åŠ è½½åŸç†æœºåˆ¶ï¼‰â˜…å¿…è€ƒâ˜…è£…è½½ -&gt; é“¾æ¥ï¼ˆéªŒè¯-&gt;å‡†å¤‡-&gt;è§£æï¼‰-&gt; åˆå§‹åŒ–-&gt;è¿è¡Œ -&gt; å¸è½½ è£…è½½ï¼šå°†ç±»çš„å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ é“¾æ¥ï¼š éªŒè¯ï¼šç¡®ä¿åŠ è½½çš„å­—èŠ‚ç åˆæ³•ï¼Œè§„èŒƒ å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œè®¾ç½®é»˜è®¤å€¼ è§£æï¼šå°†ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨ åˆå§‹åŒ–ï¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–ï¼ŒåŒ…æ‹¬é™æ€å˜é‡èµ‹å€¼å’Œé™æ€ä»£ç å—æ‰§è¡Œ è¿è¡Œï¼šJVMæ‰§è¡Œjavaç¨‹åºï¼Œç¨‹åºä¸­çš„çº¿ç¨‹å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°ç¨‹åºç»“æŸæˆ–è€…å¼‚å¸¸ å¸è½½ï¼šå½“ä¸€ä¸ªç±»ä¸å†è¢«å¼•ç”¨æˆ–è€…ç±»åŠ è½½å™¨è¢«å›æ”¶ï¼ŒJVMä¼šå¸è½½è¿™ä¸ªç±»ï¼Œé‡Šæ”¾å¯¹åº”å†…å­˜ - å“ªäº›æƒ…å†µä¼šè§¦å‘ç±»çš„åŠ è½½(ç±»åŠ è½½çš„æ—¶æœº) åˆ›å»ºç±»çš„å®ä¾‹ï¼ˆ new ï¼‰ è®¿é—®ç±»çš„é™æ€å˜é‡ï¼Œæˆ–é™æ€å˜é‡èµ‹å€¼ è°ƒç”¨ç±»çš„é™æ€æ–¹æ³• ä½¿ç”¨Class.forName ã€ClassLoader.loadClassã€æ–¹æ³• - ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨æœ‰å“ªäº› â˜…â˜…â˜…ç”¨äºå°†ç±»çš„å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„Classå¯¹è±¡ã€‚ç±»åŠ è½½å™¨è´Ÿè´£æŸ¥æ‰¾ã€åŠ è½½å’Œé“¾æ¥ç±»çš„è¿‡ç¨‹ Javaä¸­çš„ç±»åŠ è½½å™¨å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼šå®ƒæ˜¯JVMçš„ä¸€éƒ¨åˆ†ï¼Œè´Ÿè´£åŠ è½½Javaçš„æ ¸å¿ƒç±»åº“ï¼Œå¦‚java.langåŒ…ä¸­çš„ç±»ã€‚å®ƒæ˜¯JVMè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼Œç”±C++å®ç°ï¼Œä¸æ˜¯Javaç±»ï¼Œå› æ­¤åœ¨Javaä¸­æ— æ³•ç›´æ¥è·å–åˆ°å¯åŠ¨ç±»åŠ è½½å™¨çš„å¼•ç”¨ã€‚ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼šå®ƒè´Ÿè´£åŠ è½½Javaçš„æ‰©å±•ç±»åº“ï¼Œä½äºJREçš„lib/extç›®å½•ä¸‹çš„jaråŒ…ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ç³»ç»Ÿå±æ€§java.ext.dirsæŒ‡å®šæ‰©å±•ç±»åº“çš„è·¯å¾„ã€‚ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ï¼šä¹Ÿç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œå®ƒè´Ÿè´£åŠ è½½åº”ç”¨ç¨‹åºçš„ç±»ï¼Œå³å¼€å‘è€…è‡ªå·±ç¼–å†™çš„ç±»ã€‚å®ƒæ˜¯ClassLoaderç±»çš„å­ç±»ï¼Œæ˜¯Javaä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼šå¼€å‘è€…å¯ä»¥é€šè¿‡ç»§æ‰¿ClassLoaderç±»ï¼Œå®ç°è‡ªå·±çš„ç±»åŠ è½½å™¨ã€‚è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¯ä»¥åŠ è½½ç‰¹å®šè·¯å¾„ä¸‹çš„ç±»æ–‡ä»¶ï¼Œæˆ–è€…ä»å…¶ä»–æ¥æºï¼ˆå¦‚ç½‘ç»œã€æ•°æ®åº“ï¼‰åŠ è½½ç±»ã€‚ ç±»åŠ è½½å™¨é‡‡ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Modelï¼‰æ¥åŠ è½½ç±»ã€‚å³å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°åŠ è½½ç±»çš„è¯·æ±‚æ—¶ï¼Œå®ƒä¼šé¦–å…ˆå°†è¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶åŠ è½½å™¨æ¥å°è¯•åŠ è½½ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œæ‰ä¼šç”±å½“å‰åŠ è½½å™¨è‡ªå·±æ¥åŠ è½½ã€‚ï¼ˆå­åŠ è½½å™¨å’Œçˆ¶æ˜¯åŒ…å«çš„å…³ç³»ï¼Œä¸æ˜¯ç±»ç»§æ‰¿ï¼‰ è¿™ç§å±‚æ¬¡ç»“æ„çš„ç±»åŠ è½½å™¨å¯ä»¥ä¿è¯Javaç±»çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ã€‚é€šè¿‡åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå¯ä»¥ç¡®ä¿æ ¸å¿ƒç±»åº“çš„å®‰å…¨æ€§ï¼Œé¿å…äº†ä¸åŒç±»åŠ è½½å™¨åŠ è½½åŒä¸€ä¸ªç±»çš„é—®é¢˜ã€‚åŒæ—¶ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å®ç°ç‰¹å®šçš„åŠ è½½é€»è¾‘ï¼Œä¾‹å¦‚åŠ è½½åŠ å¯†çš„ç±»æ–‡ä»¶ã€åŠ è½½ç½‘ç»œä¸Šçš„ç±»ç­‰ - åŒäº²å§”æ´¾æœºåˆ¶çš„åŸç†å½“Javaç¨‹åºéœ€è¦åŠ è½½ä¸€ä¸ªç±»æ—¶ï¼Œé¦–å…ˆä¼šå§”æ‰˜ç»™å½“å‰ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚ çˆ¶ç±»åŠ è½½å™¨ä¼šæŒ‰ç…§ç›¸åŒçš„æ–¹å¼å°è¯•åŠ è½½è¯¥ç±»ã€‚å¦‚æœçˆ¶ç±»åŠ è½½å™¨èƒ½å¤ŸæˆåŠŸåŠ è½½è¯¥ç±»ï¼Œåˆ™åŠ è½½è¿‡ç¨‹ç»“æŸã€‚ å¦‚æœçˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»ï¼Œåˆ™ä¼šå°†åŠ è½½è¯·æ±‚å†æ¬¡å§”æ‰˜ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨ï¼Œç›´åˆ°è¾¾åˆ°é¡¶å±‚çš„å¼•å¯¼ç±»åŠ è½½å™¨ã€‚ å¼•å¯¼ç±»åŠ è½½å™¨æ˜¯Javaè™šæ‹Ÿæœºå†…ç½®çš„ç±»åŠ è½½å™¨ï¼Œå®ƒè´Ÿè´£åŠ è½½æ ¸å¿ƒç±»åº“ï¼Œå¦‚java.langåŒ…ä¸‹çš„ç±»ã€‚ å¦‚æœå¼•å¯¼ç±»åŠ è½½å™¨ä¹Ÿæ— æ³•åŠ è½½è¯¥ç±»ï¼Œåˆ™ä¼šå›åˆ°åˆå§‹çš„ç±»åŠ è½½å™¨ï¼Œå°è¯•ä½¿ç”¨è‡ªèº«çš„åŠ è½½æœºåˆ¶åŠ è½½è¯¥ç±»ã€‚ å¦‚æœè‡ªèº«çš„åŠ è½½æœºåˆ¶ä»ç„¶æ— æ³•åŠ è½½è¯¥ç±»ï¼Œåˆ™ä¼šæŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ - åŒäº²å§”æ´¾æœºåˆ¶çš„ä¼˜ç¼º â˜…â˜…ä¼˜ç‚¹ï¼š é¿å…é‡å¤åŠ è½½ï¼šç”±äºç±»åŠ è½½å™¨ç›´æ¥ä»çˆ¶ç±»åŠ è½½å™¨é‚£é‡ŒåŠ è½½ç±»ï¼Œé¿å…äº†ç±»çš„é‡å¤åŠ è½½ã€‚ å®‰å…¨æ€§ï¼šé€šè¿‡åŒäº²å§”æ´¾æ¨¡å‹ï¼ŒJava æ ‡å‡†åº“ä¸­çš„æ ¸å¿ƒç±»åº“ï¼ˆå¦‚ java.lang.*ï¼‰ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™æ ·èƒ½ä¿è¯è¿™äº›æ ¸å¿ƒç±»åº“ä¸ä¼šè¢«æ¶æ„ä»£ç ç¯¡æ”¹æˆ–æ›¿æ¢ï¼Œä»è€Œæé«˜ç¨‹åºçš„å®‰å…¨æ€§ã€‚ ä¸€è‡´æ€§ï¼šè¿™ç§æ–¹å¼ç¡®ä¿äº†åŒä¸€ä¸ªç±»çš„åŠ è½½ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨å®Œæˆï¼Œä»è€Œåœ¨è¿è¡Œæ—¶ä¿è¯äº†ç±»å‹çš„å”¯ä¸€æ€§å’Œç›¸åŒæ€§ã€‚è¿™ä¹Ÿæœ‰åŠ©äºå‡è½»ç±»åŠ è½½å™¨åœ¨å¤„ç†ç›¸äº’å…³è”çš„ç±»æ—¶çš„å¤æ‚æ€§ ç¼ºç‚¹ï¼š çµæ´»æ€§å—é™ï¼šåŒäº²å§”æ´¾æœºåˆ¶å¯¹äºæŸäº›ç‰¹æ®Šçš„ç±»åŠ è½½éœ€æ±‚å¯èƒ½è¿‡äºä¸¥æ ¼ï¼Œé™åˆ¶äº†åŠ è½½å™¨çš„çµæ´»æ€§ã€‚ ç ´åéš”ç¦»æ€§ï¼šå¦‚æœè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸éµå¾ªåŒäº²å§”æ´¾æœºåˆ¶ï¼Œå¯èƒ½ä¼šç ´åç±»åŠ è½½çš„éš”ç¦»æ€§ï¼Œå¯¼è‡´ç±»å†²çªæˆ–å®‰å…¨æ€§é—®é¢˜ã€‚ ä¸é€‚åˆåŠ¨æ€æ›´æ–°ï¼ˆæ¯”å¦‚jspï¼‰ï¼šç”±äºç±»åŠ è½½å™¨åœ¨åŠ è½½ç±»æ—¶ä¼šå…ˆæ£€æŸ¥çˆ¶åŠ è½½å™¨æ˜¯å¦å·²åŠ è½½ï¼Œå› æ­¤åœ¨åŠ¨æ€æ›´æ–°ç±»æ—¶å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œéœ€è¦é¢å¤–çš„å¤„ç† - ç ´ååŒäº²å§”æ´¾æœºåˆ¶ â˜…â˜…æ€ä¹ˆç ´åï¼š 1ã€è‡ªå®šä¹‰ç±»åŠ è½½å™¨ è‡ªå®šä¹‰ç±»åŠ è½½å™¨éœ€è¦ç»§æ‰¿ ClassLoader ç±»ï¼Œå¹¶è¦†å†™ findClass æ–¹æ³• 2ã€é‡å†™ClassLoaderçš„loadClassæ–¹æ³• - ä¸‰ç ´åŒäº²å§”æ´¾ â˜…â˜…â˜…1ã€å…¼å®¹1.2ä¹‹å‰ç‰ˆæœ¬ åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸€æ¬¡â€œè¢«ç ´åâ€å…¶å®å‘ç”Ÿåœ¨åŒäº²å§”æ´¾æ¨¡å‹å‡ºç°ä¹‹å‰â€”â€”å³JDK 1.2é¢ä¸–ä»¥å‰çš„â€œè¿œ å¤â€æ—¶ä»£ã€‚ ç”±äºåŒäº²å§”æ´¾æ¨¡å‹åœ¨JDK 1.2ä¹‹åæ‰è¢«å¼•å…¥ï¼Œä½†æ˜¯ç±»åŠ è½½å™¨çš„æ¦‚å¿µå’ŒæŠ½è±¡ç±» java.lang.ClassLoaderåˆ™åœ¨Javaçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸­å°±å·²ç»å­˜åœ¨ï¼Œé¢å¯¹å·²ç»å­˜åœ¨çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„ä»£ ç ï¼ŒJavaè®¾è®¡è€…ä»¬å¼•å…¥åŒäº²å§”æ´¾æ¨¡å‹æ—¶ä¸å¾—ä¸åšå‡ºä¸€äº›å¦¥åã€‚ ä¸ºäº†å…¼å®¹è¿™äº›å·²æœ‰ä»£ç ï¼Œæ— æ³•å†ä»¥æŠ€æœ¯æ‰‹æ®µé¿å…loadClass()è¢«å­ç±»è¦†ç›–çš„å¯èƒ½æ€§ï¼Œåªèƒ½åœ¨JDK 1.2ä¹‹åçš„java.lang.ClassLoaderä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ protectedæ–¹æ³•findClass()ã€‚å¹¶å¼•å¯¼ç”¨æˆ·ç¼–å†™çš„ç±»åŠ è½½é€»è¾‘æ—¶å°½å¯èƒ½å»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨ loadClass()ä¸­ç¼–å†™ä»£ç ã€‚ æŒ‰ç…§loadClass()æ–¹æ³•çš„é€»è¾‘ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å¤±è´¥ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è‡ªå·±çš„findClass()æ–¹æ³•æ¥å®ŒæˆåŠ è½½ï¼Œè¿™æ · æ—¢ä¸å½±å“ç”¨æˆ·æŒ‰ç…§è‡ªå·±çš„æ„æ„¿å»åŠ è½½ç±»ï¼Œåˆå¯ä»¥ä¿è¯æ–°å†™å‡ºæ¥çš„ç±»åŠ è½½å™¨æ˜¯ç¬¦åˆåŒäº²å§”æ´¾è§„åˆ™çš„ã€‚ 2ã€åŸºç¡€ç±»å‹å›è°ƒç”¨æˆ·ä»£ç  çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»å‹åŠ è½½å™¨ SPIåœºæ™¯ 3ã€åŠ¨æ€åŒ–ï¼šçƒ­éƒ¨ç½²ï¼Œçƒ­æ›¿æ¢ï¼ˆjspï¼‰ åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸‰æ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±äºç”¨æˆ·å¯¹ç¨‹åºåŠ¨æ€æ€§çš„è¿½æ±‚è€Œå¯¼è‡´çš„ã€‚è¿™é‡Œæ‰€è¯´çš„â€œåŠ¨æ€æ€§â€æŒ‡çš„æ˜¯ä¸€äº›éå¸¸â€œçƒ­â€é—¨çš„åè¯ï¼šä»£ç çƒ­æ›¿æ¢ï¼ˆHot Swapï¼‰ã€æ¨¡å—çƒ­éƒ¨ç½²ï¼ˆHot Deploymentï¼‰ç­‰ OSGiå®ç°æ¨¡å—åŒ–çƒ­éƒ¨ç½²çš„å…³é”®æ˜¯å®ƒè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æœºåˆ¶çš„å®ç°ã€‚ æ¯ä¸€ä¸ªç¨‹åºæ¨¡å—ï¼ˆOSGiä¸­ç§°ä¸º Bundleï¼‰éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå½“éœ€è¦æ›´æ¢ä¸€ä¸ªBundleæ—¶ï¼Œå°±æŠŠBundleè¿åŒç±»åŠ è½½å™¨ä¸€èµ·æ¢æ‰ä»¥å® ç°ä»£ç çš„çƒ­æ›¿æ¢ åœ¨OSGiç¯å¢ƒä¸‹ï¼Œç±»åŠ è½½å™¨ä¸å†åŒäº²å§”æ´¾æ¨¡å‹æ¨èçš„æ ‘çŠ¶ç»“æ„ï¼Œè€Œæ˜¯è¿›ä¸€æ­¥å‘å±•ä¸ºæ›´ åŠ å¤æ‚çš„ç½‘çŠ¶ç»“æ„ 2ã€å†…å­˜ç¯‡- jvmå†…å­˜ç»“æ„ï¼ˆç»„æˆç»“æ„ï¼‰â˜…å¿…è€ƒâ˜…1. å †ï¼ˆHeapï¼‰ ä½œç”¨ï¼šå †æ˜¯JVMå†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚ ç‰¹ç‚¹ï¼šå®ƒæ˜¯åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºçš„ï¼Œå¹¶ä¸”æ˜¯åƒåœ¾å›æ”¶å™¨ä¸»è¦çš„å·¥ä½œåŒºåŸŸã€‚å †å†…å­˜çš„å¤§å°æ˜¯å¯ä»¥è°ƒæ•´çš„ï¼Œå…¶å¤§å°å’Œç”Ÿå­˜å‘¨æœŸæ˜¯JVMæ€§èƒ½è°ƒä¼˜çš„å…³é”®å› ç´ ã€‚ 2. æ ˆï¼ˆStackï¼‰ ä½œç”¨ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ä¿¡æ¯ã€æ–¹æ³•è¿”å›å€¼ä»¥åŠæ–¹æ³•è°ƒç”¨çš„ç›¸å…³ä¿¡æ¯ã€‚ ç‰¹ç‚¹ï¼šæ ˆå†…å­˜å­˜å‚¨çš„æ˜¯åŸºæœ¬ç±»å‹çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨å˜é‡ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ã€‚æ¯ä¸ªæ–¹æ³•è°ƒç”¨æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ï¼Œç”¨äºå­˜å‚¨è¿™äº›ä¿¡æ¯ã€‚ 3. æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ ä½œç”¨ï¼šç”¨äºå­˜å‚¨æ¯ä¸ªç±»çš„ç»“æ„ä¿¡æ¯ï¼Œå¦‚è¿è¡Œæ—¶å¸¸é‡æ± ã€å­—æ®µå’Œæ–¹æ³•æ•°æ®ã€æ„é€ å‡½æ•°å’Œæ™®é€šæ–¹æ³•çš„ä»£ç ã€ç‰¹æ®Šæ–¹æ³•ç­‰ã€‚ ç‰¹ç‚¹ï¼šæ–¹æ³•åŒºæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸã€‚åœ¨Java 8åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œæ–¹æ³•åŒºçš„å®ç°ä¸ºå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ã€‚ 4. ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ ä½œç”¨ï¼šå­˜å‚¨å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ ç‰¹ç‚¹ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚ 5. æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰ ä½œç”¨ï¼šä¸“é—¨ç”¨äºå¤„ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ã€‚ ç‰¹ç‚¹ï¼šæœ¬åœ°æ–¹æ³•æ ˆå’ŒJavaæ ˆçš„ä½œç”¨ç›¸ä¼¼ï¼Œä½†æœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡ 6. è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰ ä½œç”¨ï¼šå­˜å‚¨æ¯ä¸ªç±»çš„å¸¸é‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç›´æ¥å¸¸é‡ï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°å€¼ç±»å‹å¸¸é‡ï¼‰å’Œå¯¹å…¶ä»–ç±»å‹ã€å­—æ®µã€æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ã€‚ ç‰¹ç‚¹ï¼šå®ƒæ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ç±»åŠ è½½åè¢«åˆ›å»ºã€‚ æ³¨æ„äº‹é¡¹ åƒåœ¾å›æ”¶ï¼šä¸»è¦å‘ç”Ÿåœ¨å †åŒºï¼Œéƒ¨åˆ†æƒ…å†µä¸‹ä¹Ÿæ¶‰åŠæ–¹æ³•åŒºã€‚ å†…å­˜æº¢å‡ºï¼šå †ã€æ ˆå’Œæ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰éƒ½å¯èƒ½æˆä¸ºå†…å­˜æº¢å‡ºçš„æºå¤´ã€‚ å †å’Œæ ˆçš„åŒºåˆ« å †ï¼šæ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œç”¨äºå­˜æ”¾å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚å®ƒåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚ æ ˆï¼šçº¿ç¨‹ç§æœ‰çš„å†…å­˜åŒºåŸŸï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒï¼Œç”¨äºå­˜æ”¾å±€éƒ¨å˜é‡å’Œéƒ¨åˆ†æ–¹æ³•è°ƒç”¨ä¿¡æ¯ã€‚æ¯ä¸ªæ–¹æ³•è°ƒç”¨åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ä¿¡æ¯ç­‰ã€‚ - JVMè®¡æ•°å™¨å¦‚ä½•è®°æ•°åœ¨Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­ï¼Œç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter, PCï¼‰æ˜¯ä¸€ç§å†…å­˜åŒºåŸŸï¼Œç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚è¿™ç§è®¡æ•°å™¨çš„ä¸»è¦ä½œç”¨æ˜¯ä¿æŒçº¿ç¨‹æ‰§è¡ŒçŠ¶æ€çš„å‡†ç¡®æ€§ã€‚ çº¿ç¨‹ç§æœ‰ï¼šç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹ç§æœ‰çš„å†…å­˜ç©ºé—´ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ã€‚ å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ï¼šç¨‹åºè®¡æ•°å™¨å­˜å‚¨çš„æ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚å¦‚æœæ‰§è¡Œçš„æ˜¯éæœ¬åœ°æ–¹æ³•ï¼ˆå³éNativeæ–¹æ³•ï¼‰ï¼Œè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æœæ˜¯æœ¬åœ°æ–¹æ³•ï¼Œåˆ™è®¡æ•°å™¨çš„å€¼ä¸ºç©ºï¼ˆUndefinedï¼‰ã€‚ æŒ‡ä»¤æµçš„è·Ÿè¸ªï¼šç¨‹åºè®¡æ•°å™¨ç¡®ä¿äº†çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ§åˆ¶æµç¨‹ï¼Œå³åœ¨ä»»ä½•æ—¶åˆ»éƒ½å¯ä»¥çŸ¥é“çº¿ç¨‹åº”è¯¥æ‰§è¡Œå“ªä¸€æ¡æŒ‡ä»¤ã€‚ åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†å’Œçº¿ç¨‹æ¢å¤ï¼šç¨‹åºè®¡æ•°å™¨å¯¹äºæ§åˆ¶ç»“æ„ï¼ˆå¦‚å¾ªç¯ã€æ¡ä»¶åˆ†æ”¯ï¼‰ã€æ–¹æ³•è°ƒç”¨å’Œå¼‚å¸¸å¤„ç†ç­‰å…·æœ‰é‡è¦ä½œç”¨ã€‚åœ¨è¿™äº›æ§åˆ¶æµç¨‹ä¸­ï¼Œè®¡æ•°å™¨å¸®åŠ©çº¿ç¨‹ç¡®å®šä¸‹ä¸€æ­¥åº”è¯¥æ‰§è¡Œå“ªæ¡æŒ‡ä»¤ã€‚ çº¿ç¨‹é—´éš”ç¦»ï¼Œé˜²æ­¢å¹²æ‰°ï¼šç”±äºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå› æ­¤åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹çš„è®¡æ•°å™¨ä¸ä¼šå¯¹å¦ä¸€ä¸ªçº¿ç¨‹çš„è®¡æ•°å™¨äº§ç”Ÿå½±å“ã€‚è¿™æ ·ç¡®ä¿äº†çº¿ç¨‹åˆ‡æ¢åèƒ½å¤Ÿæ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ã€‚ å†…å­˜éœ€æ±‚æå°ï¼šç¨‹åºè®¡æ•°å™¨å ç”¨çš„å†…å­˜å¾ˆå°ï¼Œä½†å®ƒå¯¹äºçº¿ç¨‹çš„åŠŸèƒ½æ˜¯å¿…ä¸å¯å°‘çš„ - ä»€ä¹ˆæƒ…å†µæ ˆä¼šæº¢å‡º â˜… é€’å½’æˆ–è€…å¾ªç¯çš„æ·±åº¦ï¼šå½“ä¸€ä¸ªå‡½æ•°é€’å½’è°ƒç”¨è‡ªå·±ï¼Œè€Œæ²¡æœ‰é€‚å½“çš„ç»ˆæ­¢æ¡ä»¶æˆ–é€’å½’æ·±åº¦å¤ªå¤§ï¼Œä¼šå¯¼è‡´æ ˆå†…å­˜è€—å°½ã€‚æ¯æ¬¡å‡½æ•°è°ƒç”¨éƒ½ä¼šåœ¨æ ˆä¸Šåˆ†é…ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡å’Œè¿”å›åœ°å€ç­‰ã€‚å¦‚æœé€’å½’è°ƒç”¨æ¬¡æ•°è¿‡å¤šï¼Œæ ˆç©ºé—´å°†è¢«è€—å°½ã€‚ å¤§é‡çš„å±€éƒ¨å˜é‡ï¼šå¦‚æœåœ¨å‡½æ•°å†…éƒ¨å£°æ˜äº†å¤§é‡çš„å±€éƒ¨å˜é‡æˆ–è€…å±€éƒ¨å˜é‡çš„å°ºå¯¸éå¸¸å¤§ï¼ˆä¾‹å¦‚å¤§æ•°ç»„ï¼‰ï¼Œå¯èƒ½ä¼šå ç”¨å¤§é‡çš„æ ˆç©ºé—´ï¼Œå¯¼è‡´æ ˆæº¢å‡ºã€‚ çº¿ç¨‹æ ˆç©ºé—´å¤ªå°ï¼šåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹é€šå¸¸æœ‰è‡ªå·±çš„æ ˆç©ºé—´ã€‚å¦‚æœçº¿ç¨‹æ ˆç©ºé—´è®¾ç½®å¾—è¿‡å°ï¼Œé‚£ä¹ˆå³ä½¿æ­£å¸¸çš„å‡½æ•°è°ƒç”¨æ·±åº¦ä¹Ÿå¯èƒ½å¯¼è‡´æ ˆæº¢å‡ºã€‚ ç³»ç»Ÿç¯å¢ƒé™åˆ¶ï¼šåœ¨æŸäº›ç³»ç»Ÿæˆ–ç¯å¢ƒä¸­ï¼Œæ ˆç©ºé—´çš„å¤§å°å¯èƒ½å—åˆ°é™åˆ¶ã€‚åœ¨è¿™äº›ç¯å¢ƒä¸‹ï¼Œå³ä½¿æ˜¯æ­£å¸¸çš„ç¨‹åºæ“ä½œä¹Ÿå¯èƒ½å› ä¸ºè¶…å‡ºç³»ç»Ÿåˆ†é…çš„æ ˆç©ºé—´è€Œå¯¼è‡´æ ˆæº¢å‡ºã€‚ - å †å’Œæ ˆçš„åŒºåˆ«ã€è°çš„æ€§èƒ½æ›´é«˜å †ï¼ˆHeapï¼‰ ç”¨é€”ï¼šç”¨äºå­˜æ”¾Javaç¨‹åºä¸­åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡å’Œæ•°ç»„ï¼Œæ— è®ºæ˜¯å“ªä¸ªçº¿ç¨‹åˆ›å»ºçš„ã€‚ çº¿ç¨‹å…±äº«ï¼šå †æ˜¯ä¸€ä¸ªæ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸã€‚ å†…å­˜ç®¡ç†ï¼šåƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰ä¸»è¦åœ¨å †ä¸Šè¿›è¡Œï¼Œç®¡ç†è¾ƒä¸ºå¤æ‚ã€‚ å­˜å‚¨å†…å®¹ï¼šåŒ…æ‹¬æ‰€æœ‰é€šè¿‡newåˆ›å»ºçš„å¯¹è±¡å’Œæ•°ç»„ã€‚ ç”Ÿå‘½å‘¨æœŸï¼šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸å›ºå®šï¼Œå¯èƒ½ä»ç¨‹åºå¼€å§‹åˆ°ç¨‹åºç»“æŸã€‚ æ€§èƒ½ï¼šç›¸å¯¹äºæ ˆï¼Œå †çš„å†…å­˜åˆ†é…å’Œç®¡ç†æˆæœ¬è¾ƒé«˜ï¼Œæ€§èƒ½è¾ƒä½ã€‚ æ ˆï¼ˆStackï¼‰ ç”¨é€”ï¼šç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡å¼•ç”¨ï¼‰å’Œæ§åˆ¶æµç¨‹ä¿¡æ¯ï¼ˆæ¯”å¦‚æ–¹æ³•è°ƒç”¨ï¼‰ã€‚ çº¿ç¨‹ç§æœ‰ï¼šæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æ ˆï¼Œä¸å…¶ä»–çº¿ç¨‹éš”ç¦»ã€‚ å†…å­˜ç®¡ç†ï¼šæ ˆçš„ç®¡ç†æ˜¯çº¿æ€§çš„ï¼Œæ¯ä¸ªæ–¹æ³•è°ƒç”¨æ—¶åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œæ–¹æ³•ç»“æŸæ—¶é”€æ¯ï¼Œç®¡ç†ç®€å•ã€‚ å­˜å‚¨å†…å®¹ï¼šå±€éƒ¨å˜é‡ã€æ“ä½œæ•°ã€æ–¹æ³•è°ƒç”¨å’Œè¿”å›åœ°å€ã€‚ ç”Ÿå‘½å‘¨æœŸï¼šå±€éƒ¨å˜é‡éšæ–¹æ³•è°ƒç”¨è€Œåˆ›å»ºï¼Œéšæ–¹æ³•ç»“æŸè€Œé”€æ¯ã€‚ æ€§èƒ½ï¼šæ ˆä¸Šçš„æ“ä½œé€šå¸¸æœ‰æ›´é«˜çš„æ€§èƒ½ã€‚å†…å­˜åˆ†é…å’Œå›æ”¶é€Ÿåº¦å¿«ï¼Œæ•ˆç‡é«˜ã€‚ æ€§èƒ½æ¯”è¾ƒ æ ˆï¼šç”±äºæ ˆæœ‰ç€å›ºå®šçš„å†…å­˜åˆ†é…æ¨¡å¼ï¼ˆåè¿›å…ˆå‡ºï¼‰ï¼Œå†…å­˜åˆ†é…å’Œå›æ”¶é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤æ ˆçš„æ€§èƒ½é€šå¸¸æ¯”å †é«˜ã€‚ å †ï¼šå †çš„å†…å­˜åˆ†é…å’Œç®¡ç†æ›´ä¸ºå¤æ‚ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ°åƒåœ¾å›æ”¶æ—¶ï¼Œå¯èƒ½ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚ åº”ç”¨åœºæ™¯ å †ï¼šé€‚ç”¨äºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ã€å¤§å°ä¸å®šçš„å¯¹è±¡ã€‚ æ ˆï¼šé€‚ç”¨äºå­˜å‚¨ä¸´æ—¶å˜é‡å’Œå®ç°æ–¹æ³•è°ƒç”¨ã€‚ - JVMå†…å­˜ä¸ºä»€ä¹ˆè¦åˆ†æˆæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£ï¼ŒæŒä¹…ä»£ã€‚æ–°ç”Ÿä»£ä¸­ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºEdenå’ŒSurvivorJavaè™šæ‹Ÿæœºï¼ˆJVMï¼‰çš„å†…å­˜åˆ†åŒºæ˜¯ä¸ºäº†ä¼˜åŒ–å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶æ•ˆç‡è€Œè®¾è®¡çš„ã€‚ä¸åŒçš„åˆ†åŒºç”¨äºå­˜å‚¨å¯¹è±¡çš„ä¸åŒç”Ÿå‘½å‘¨æœŸé˜¶æ®µ **æ–°ç”Ÿä»£ (Young Generation)**ï¼šè¿™æ˜¯å¤§å¤šæ•°æ–°åˆ›å»ºçš„å¯¹è±¡è¢«åˆ†é…çš„åœ°æ–¹ã€‚æ–°ç”Ÿä»£åˆè¢«è¿›ä¸€æ­¥åˆ†ä¸ºEdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºï¼ˆé€šå¸¸ç§°ä¸ºS0å’ŒS1ï¼‰ã€‚ EdenåŒºï¼šæ–°åˆ›å»ºçš„å¯¹è±¡é¦–å…ˆè¢«åˆ†é…åˆ°EdenåŒºã€‚å½“EdenåŒºæ»¡æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡Minor GCï¼ˆåƒåœ¾å›æ”¶ï¼‰ï¼Œæ­¤æ—¶å­˜æ´»çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°ä¸€ä¸ªSurvivoråŒºï¼ˆä¾‹å¦‚S0ï¼‰ã€‚ SurvivoråŒºï¼šåœ¨å‡ æ¬¡Minor GCåï¼Œä»ç„¶å­˜æ´»çš„å¯¹è±¡ä»ä¸€ä¸ªSurvivoråŒºï¼ˆå¦‚S0ï¼‰ç§»åŠ¨åˆ°å¦ä¸€ä¸ªï¼ˆå¦‚S1ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹é‡å¤å‡ æ¬¡ï¼Œä¸€äº›å¯¹è±¡å¯èƒ½ä¼šä»S0ç§»åŠ¨åˆ°S1ï¼Œç„¶åå†ç§»å›S0ã€‚å½“å¯¹è±¡åœ¨SurvivoråŒºå­˜æ´»äº†è¶³å¤Ÿé•¿çš„æ—¶é—´ï¼ˆæˆ–è¾¾åˆ°ä¸€å®šçš„å¹´é¾„é˜ˆå€¼ï¼‰åï¼Œå®ƒä»¬ä¼šè¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚ **è€å¹´ä»£ (Old Generation æˆ– Tenured Generation)**ï¼šå­˜æ´»æ—¶é—´è¾ƒé•¿çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°è¿™ä¸ªåŒºåŸŸã€‚è€å¹´ä»£çš„ç©ºé—´é€šå¸¸æ¯”æ–°ç”Ÿä»£å¤§å¾—å¤šï¼Œä¸”å…¶åƒåœ¾å›æ”¶é¢‘ç‡è¾ƒä½ã€‚ **æŒä¹…ä»£ (Permanent Generation) / å…ƒç©ºé—´ (Metaspace)**ï¼šè¿™éƒ¨åˆ†å†…å­˜ç”¨äºå­˜å‚¨ç±»çš„å…ƒæ•°æ®ã€å¸¸é‡ä»¥åŠé™æ€å˜é‡ã€‚åœ¨Java 8ä¸­ï¼ŒæŒä¹…ä»£è¢«æ›¿æ¢ä¸ºå…ƒç©ºé—´ï¼Œå®ƒä¸åœ¨JVMå†…å­˜ä¸­è€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ - ä»€ä¹ˆæƒ…å†µä¸‹å¯¹è±¡ä¼šä»æ–°ç”Ÿä»£è¿›å…¥è€å¹´ä»£ â˜…â˜…â˜…â˜…ï¼ˆ1ï¼‰ä¸€å®šæ¬¡æ•°çš„Minor GC å å¸¸è§„å¯¹è±¡è¢«åˆ›å»ºä¹‹åæ—¶å­˜å‚¨åœ¨æ–°ç”Ÿä»£çš„EdenåŒºï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰å¹´é¾„ï¼Œåœ¨Minor GCåï¼Œsurvivor1åŒºè¿˜å­˜æ´»çš„å¯¹è±¡çš„å¹´é¾„å…¨éƒ¨+1ï¼Œå½“å¯¹è±¡å¹´é¾„è¾¾åˆ°15æ—¶ï¼Œä¼šè¢«ç§»äº¤åˆ°è€å¹´ä»£ï¼Œ15æ˜¯ç³»ç»Ÿé»˜è®¤çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡JVMå‚æ•°-XX:MaxTenuringThresholdæ¥è®¾ç½® ï¼ˆ2ï¼‰Minor GCåSurvivoræ”¾ä¸ä¸‹ åœ¨Minor GCä¹‹åå­˜æ´»çš„å¯¹è±¡è¶…è¿‡äº†SurvivoråŒºçš„å¤§å°ï¼Œä¼šå°†è¿™äº›å¯¹è±¡ç›´æ¥è½¬ç§»åˆ°è€å¹´ä»£ã€‚ ï¼ˆ3ï¼‰åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­ å¦‚æœåœ¨SurvivoråŒºï¼Œæœ‰æŸä¸€å¹´é¾„çš„å¯¹è±¡çš„æ€»å¤§å°è¶…è¿‡äº†SurvivoråŒºå¤§å°çš„50%ï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ ï¼ˆ4ï¼‰å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ æ‰€è°“å¤§å¯¹è±¡å°±æ˜¯æŒ‡éœ€è¦å¤§é‡çš„è¿ç»­å†…å­˜ç©ºé—´çš„Javaå¯¹è±¡ï¼Œæ¯”å¦‚å¾ˆé•¿çš„å­—ç¬¦ä¸²æˆ–æ•°ç»„ï¼ˆä¸ºä»€ä¹ˆï¼Ÿä¸ºäº†é™ä½å¤åˆ¶ç®—æ³•æ‰§è¡Œçš„æ¬¡æ•°ï¼‰ - æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å›æ”¶ç­–ç•¥ â˜…â˜…â˜…æ–°ç”Ÿä»£å›æ”¶ç­–ç•¥æ–°ç”Ÿä»£ä¸»è¦å­˜å‚¨ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡ã€‚ç”±äºå¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯â€œæœç”Ÿå¤•æ­»â€çš„ï¼Œæ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶é¢‘ç‡ç›¸å¯¹è¾ƒé«˜ï¼Œä½†æ¯æ¬¡GCæ‰€éœ€æ—¶é—´è¾ƒçŸ­ã€‚æ–°ç”Ÿä»£çš„å›æ”¶é€šå¸¸é‡‡ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰ï¼šæ–°ç”Ÿä»£åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šä¸€ä¸ªEdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºï¼ˆé€šå¸¸ç§°ä¸ºFromå’ŒToï¼‰ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ–°åˆ†é…çš„å¯¹è±¡é¦–å…ˆæ”¾åœ¨EdenåŒºã€‚è¿›è¡ŒGCæ—¶ï¼Œæ´»ç€çš„å¯¹è±¡ä»EdenåŒºå’Œä¸€ä¸ªSurvivoråŒºå¤åˆ¶åˆ°å¦ä¸€ä¸ªSurvivoråŒºã€‚è¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯åªéœ€å¤„ç†å­˜æ´»çš„å¯¹è±¡ï¼Œä¸”ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚ åˆ†ä»£å¹´é¾„ï¼ˆGenerational Agingï¼‰ï¼šå­˜æ´»å¯¹è±¡åœ¨SurvivoråŒºé—´ç§»åŠ¨ï¼Œå¹¶éšç€æ¯æ¬¡GCå¢åŠ å¹´é¾„ã€‚å½“å¯¹è±¡è¾¾åˆ°ç‰¹å®šå¹´é¾„é˜ˆå€¼ï¼ˆä¾‹å¦‚15ï¼‰æ—¶ï¼Œå®ƒä»¬ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ã€‚ Minor GCï¼šæ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ç§°ä¸ºMinor GCï¼Œå®ƒåªæ¸…ç†æ–°ç”Ÿä»£ï¼Œä¸æ¶‰åŠè€å¹´ä»£ï¼Œå› æ­¤é€Ÿåº¦ç›¸å¯¹è¾ƒå¿«ã€‚ è€å¹´ä»£å›æ”¶ç­–ç•¥è€å¹´ä»£å­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ï¼Œå…¶åƒåœ¾å›æ”¶é¢‘ç‡è¾ƒä½ï¼Œä½†æ¯æ¬¡GCçš„æˆæœ¬è¾ƒé«˜ï¼Œå› ä¸ºæ¶‰åŠåˆ°æ›´å¤šçš„æ•°æ®å’Œå¤æ‚çš„æ•°æ®ç»“æ„ æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰ç®—æ³•ï¼šï¼Œå…¶ä¸­é¦–å…ˆæ ‡è®°æ‰€æœ‰ä»æ ¹é›†åˆå¯è¾¾çš„å¯¹è±¡ï¼Œç„¶åæ¸…é™¤æ‰€æœ‰æœªæ ‡è®°çš„å¯¹è±¡ã€‚è¿™ç§æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡ã€‚ æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰ç®—æ³•ï¼šä½†åœ¨æ¸…é™¤æœªæ ‡è®°å¯¹è±¡ä¹‹åï¼Œå®ƒä¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œä»¥è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚ å¢é‡æ”¶é›†ï¼ˆIncremental Collectingï¼‰ï¼šè¿™ç§æ–¹æ³•å°è¯•åˆ†æ•£GCçš„å·¥ä½œé‡ï¼Œä»¥é¿å…é•¿æ—¶é—´çš„åœé¡¿ã€‚ä¾‹å¦‚ï¼ŒCMSï¼ˆConcurrent Mark-Sweepï¼‰æ”¶é›†å™¨å°±æ˜¯ä¸€ç§å®ç°ï¼Œå®ƒåœ¨æ ‡è®°å’Œæ¸…é™¤é˜¶æ®µçš„å¤§éƒ¨åˆ†å·¥ä½œæ˜¯å¹¶å‘è¿›è¡Œçš„ã€‚ Major GC / Full GCï¼šæ¶‰åŠæ•´ä¸ªå †ï¼ˆåŒ…æ‹¬æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼‰ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨è€å¹´ä»£å‡ ä¹æ»¡æ—¶ï¼Œæˆ–è€…åœ¨æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰æˆ–å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ä¸è¶³æ—¶ã€‚Full GCæ¯”Minor GCè€—æ—¶æ›´é•¿ï¼Œä¼šå¯¼è‡´è¾ƒé•¿æ—¶é—´çš„åº”ç”¨æš‚åœ - Minor (æ–°ç”Ÿä»£) GC å’Œ Full GC (è€å¹´ä»£ï¼‰è§¦å‘æ—¶æœº â˜…â˜…â˜… æ–°ç”Ÿä»£ç©ºé—´ä¸è¶³ï¼šå½“æ–°ç”Ÿä»£ï¼ˆç‰¹åˆ«æ˜¯EdenåŒºï¼‰ä¸­çš„ç©ºé—´ä¸è¶³ä»¥å®¹çº³æ–°åˆ†é…çš„å¯¹è±¡æ—¶ï¼ŒJVMä¼šè§¦å‘Minor GCã€‚æ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œå°†å­˜æ´»çš„å¯¹è±¡ä»EdenåŒºå’Œä¸€ä¸ªSurvivoråŒºå¤åˆ¶åˆ°å¦ä¸€ä¸ªSurvivoråŒºï¼ŒåŒæ—¶æ¸…ç†æ‰ä¸å†å­˜æ´»çš„å¯¹è±¡ã€‚ å¯¹è±¡åˆ†é…æ—¶çš„ç­–ç•¥ï¼šåœ¨å°è¯•åˆ†é…å¤§å¯¹è±¡æ—¶ï¼Œå¦‚æœæ–°ç”Ÿä»£ç©ºé—´ä¸è¶³ä»¥å®¹çº³è¿™äº›å¯¹è±¡ï¼Œå³ä½¿æ–°ç”Ÿä»£å…¶ä»–éƒ¨åˆ†è¿˜æœ‰ç©ºé—´ï¼Œä¹Ÿå¯èƒ½è§¦å‘Minor GCã€‚ Full GC æ¶‰åŠæ•´ä¸ªå †å†…å­˜ï¼ˆåŒ…æ‹¬æ–°ç”Ÿä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£/å…ƒç©ºé—´ï¼‰ï¼Œå…¶è§¦å‘æ—¶æœºæ›´å¤æ‚ï¼ŒåŒ…æ‹¬ï¼š è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼šå½“è€å¹´ä»£ï¼ˆOld Generationï¼‰ä¸­çš„ç©ºé—´ä¸è¶³ä»¥å®¹çº³ä»æ–°ç”Ÿä»£æ™‹å‡çš„å¯¹è±¡æ—¶ï¼ŒJVMä¼šè§¦å‘Full GCã€‚ æ°¸ä¹…ä»£/å…ƒç©ºé—´ä¸è¶³ï¼šåœ¨æ—©æœŸçš„JVMç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ç©ºé—´ä¸è¶³ï¼Œä¼šè§¦å‘Full GCã€‚åœ¨Java 8åŠä¹‹åç‰ˆæœ¬ä¸­ï¼Œå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰å–ä»£äº†æ°¸ä¹…ä»£ï¼Œå…ƒç©ºé—´ä¸è¶³åŒæ ·ä¼šè§¦å‘Full GC è€å¹´ä»£åˆ†é…æ‹…ä¿å¤±è´¥ï¼šåœ¨è¿›è¡ŒMinor GCå‰ï¼ŒJVMä¼šæ£€æŸ¥è€å¹´ä»£æ˜¯å¦æœ‰è¶³å¤Ÿç©ºé—´å®¹çº³æ–°ç”Ÿä»£æ™‹å‡çš„å¯¹è±¡ã€‚å¦‚æœä¸å¤Ÿï¼Œä¼šå…ˆè§¦å‘ä¸€æ¬¡Full GC æ³¨æ„äº‹é¡¹ æ€§èƒ½å½±å“ï¼šMinor GC é€šå¸¸è¾ƒå¿«ä¸”é¢‘ç¹ï¼Œå½±å“è¾ƒå°ï¼›è€ŒFull GC é€šå¸¸è€—æ—¶æ›´é•¿ï¼Œå½±å“æ›´å¤§ã€‚ åƒåœ¾å›æ”¶å™¨ï¼šä¸åŒçš„åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚Serial, Parallel, CMS, G1, ZGCç­‰ï¼‰åœ¨è§¦å‘GCçš„æ—¶æœºå’Œç­–ç•¥ä¸Šæœ‰æ‰€ä¸åŒï¼Œé€‰æ‹©åˆé€‚çš„åƒåœ¾å›æ”¶å™¨å¯ä»¥å‡å°‘GCçš„å½±å“ã€‚ - JVMçš„æ°¸ä¹…ä»£ä¸­ä¼šå‘ç”Ÿåƒåœ¾å›æ”¶ä¹ˆ å‘ç”Ÿåƒåœ¾å›æ”¶ï¼šæ˜¯çš„ï¼Œæ°¸ä¹…ä»£ä¸­ç¡®å®ä¼šå‘ç”Ÿåƒåœ¾å›æ”¶ï¼Œä½†è¿™ç§å›æ”¶å¹¶ä¸é¢‘ç¹ã€‚ å­˜å‚¨å†…å®¹ï¼šæ°¸ä¹…ä»£ä¸»è¦ç”¨äºå­˜å‚¨ç±»çš„å…ƒæ•°æ®ã€å¸¸é‡æ± ã€é™æ€å˜é‡ä»¥åŠJITç¼–è¯‘åçš„ä»£ç ç­‰ã€‚ å›æ”¶æ¡ä»¶ï¼šå½“ç±»è¢«å¸è½½æ—¶ï¼Œæˆ–è€…åŠ¨æ€ç”Ÿæˆçš„ç±»ä¸å†ä½¿ç”¨æ—¶ï¼Œè¿™äº›ç±»çš„å…ƒæ•°æ®ä»¥åŠä¸ä¹‹å…³è”çš„å…¶ä»–ä¿¡æ¯å°±ä¼šæˆä¸ºåƒåœ¾å›æ”¶çš„ç›®æ ‡ã€‚ å›æ”¶é¢‘ç‡ï¼šç›¸è¾ƒäºå †å†…å­˜ä¸­çš„æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ°¸ä¹…ä»£ä¸­çš„åƒåœ¾å›æ”¶å‘ç”Ÿçš„é¢‘ç‡è¾ƒä½ã€‚ è§¦å‘æ—¶æœºï¼šé€šå¸¸ï¼Œå½“æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³æ—¶ï¼ŒJVMä¼šå°è¯•è¿›è¡Œåƒåœ¾å›æ”¶ä»¥é‡Šæ”¾ç©ºé—´ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒFull GCä¼šæ¶‰åŠå¯¹æ°¸ä¹…ä»£çš„å›æ”¶ Java 8ä¸­çš„å…ƒç©ºé—´ä»Java 8å¼€å§‹ï¼Œæ°¸ä¹…ä»£è¢«å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰æ‰€å–ä»£ï¼ŒåŸå› åŒ…æ‹¬ï¼š å­˜å‚¨æ–¹å¼çš„å˜åŒ–ï¼šå…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼ˆå³æ“ä½œç³»ç»Ÿå†…å­˜ï¼‰ï¼Œè€ŒéJVMå †å†…å­˜ã€‚è¿™æ”¹å˜äº†ç±»å…ƒæ•°æ®çš„å­˜å‚¨æ–¹å¼ï¼Œæä¾›äº†æ›´çµæ´»çš„å†…å­˜ä½¿ç”¨ã€‚ åƒåœ¾å›æ”¶ï¼šå…ƒç©ºé—´ä¸­çš„åƒåœ¾å›æ”¶ä¾ç„¶å­˜åœ¨ï¼Œä¸»è¦æ¶‰åŠä¸å†ä½¿ç”¨çš„ç±»å’Œç±»åŠ è½½å™¨çš„å…ƒæ•°æ®ã€‚ æ€§èƒ½æ”¹è¿›ï¼šè¿™ä¸ªæ”¹å˜æ—¨åœ¨å‡å°‘å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryErrorï¼‰çš„é£é™©ï¼ŒåŒæ—¶æå‡æ€§èƒ½ã€‚ é…ç½®å’Œç›‘æ§ï¼šå¯¹å…ƒç©ºé—´çš„å¤§å°å’Œå›æ”¶å¯ä»¥é€šè¿‡JVMå‚æ•°è¿›è¡Œé…ç½®å’Œç›‘æ§ - new å¯¹è±¡çš„æµç¨‹ â˜…â˜…â˜…â˜…1. ç±»åŠ è½½æ£€æŸ¥åœ¨å¯ä»¥åˆ›å»ºå¯¹è±¡ä¹‹å‰ï¼ŒJVMé¦–å…ˆæ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ã€é“¾æ¥å’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœç±»æ²¡æœ‰è¢«åŠ è½½ï¼ŒJVMä¼šæ‰§è¡Œç±»åŠ è½½è¿‡ç¨‹ï¼Œè¿™åŒ…æ‹¬æŸ¥æ‰¾å­—èŠ‚ç ã€åŠ è½½å­—èŠ‚ç åˆ°å†…å­˜ä¸­ã€éªŒè¯ã€å‡†å¤‡ã€è§£æå’Œåˆå§‹åŒ–ã€‚ 2. åˆ†é…å†…å­˜ä¸€æ—¦ç±»æ£€æŸ¥å®Œæˆï¼ŒJVMæ¥ç€åœ¨å †ä¸Šä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ã€‚å†…å­˜åˆ†é…æ–¹å¼å–å†³äºåƒåœ¾å›æ”¶å™¨çš„é…ç½®å’Œç­–ç•¥ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰ï¼šå¦‚æœå †å†…å­˜æ˜¯ç»´æŠ¤ä¸ºè¿ç»­çš„ç©ºé—²ç©ºé—´ï¼Œåªéœ€è¦å°†æŒ‡å‘è‡ªç”±ç©ºé—´çš„æŒ‡é’ˆå‘ç©ºé—´è¶³å¤Ÿçš„åœ°æ–¹ç§»åŠ¨ã€‚ ç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰ï¼šå¦‚æœå †å†…å­˜ä¸­åŒ…å«äº†è¶³å¤Ÿç©ºé—´çš„å¤šä¸ªå°ç©ºé—´ï¼ŒJVMä¼šä»è¿™ä¸ªåˆ—è¡¨ä¸­æ‰¾åˆ°è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ†é…ç»™æ–°å¯¹è±¡ã€‚ 3. åˆå§‹åŒ–é»˜è®¤å€¼åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´åœ¨å¯¹è±¡ä½¿ç”¨ä¹‹å‰ï¼Œä¼šè¢«åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆnullï¼‰ã€‚è¿™ç¡®ä¿äº†å¯¹è±¡çš„å®ä¾‹å˜é‡ä¸ä¼šæœ‰Javaé»˜è®¤å€¼ä»¥å¤–çš„æ•°æ®ã€‚ 4. è®¾ç½®å¯¹è±¡å¤´JVMä¸ºå¯¹è±¡åˆ†é…çš„å†…å­˜ä¸­åŒ…å«äº†ä¸€äº›å¿…è¦çš„ä¿¡æ¯ï¼Œå¦‚å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„GCåˆ†ä»£å¹´é¾„ç­‰ã€‚è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨å¯¹è±¡å¤´ä¸­ã€‚ 5. æ‰§è¡Œæ„é€ æ–¹æ³•æœ€åï¼ŒJVMè°ƒç”¨æ„é€ å‡½æ•°ã€‚æ„é€ å‡½æ•°ä¸ä»…åŒ…æ‹¬ç¨‹åºå‘˜ç¼–å†™çš„ä»£ç ï¼Œè¿˜å¯èƒ½åŒ…æ‹¬ç¼–è¯‘å™¨å¯èƒ½æ’å…¥åˆ°æ„é€ å‡½æ•°ä¸­çš„ç‰¹æ®Šæ–¹æ³•è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ–æ–¹æ³•å’Œå®ä¾‹å˜é‡ã€‚æ„é€ æ–¹æ³•å®Œæˆåï¼Œå¯¹è±¡åˆ›å»ºå®Œæ¯•ã€‚ ç‰¹æ®Šæƒ…å†µï¼šåŒæ­¥å’Œå¹¶å‘åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹å¯èƒ½æ¶‰åŠåˆ°é”å®šæˆ–è€…å…¶ä»–å½¢å¼çš„åŒæ­¥ï¼Œä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ - JVMä¸­ä¸€æ¬¡å®Œæ•´çš„GCæµç¨‹æ˜¯æ€æ ·çš„ â˜…â˜…â˜… å¼€å§‹ï¼šé€šå¸¸ä»æ–°ç”Ÿä»£GCå¼€å§‹ï¼Œå½“æ–°ç”Ÿä»£ç©ºé—´ä¸è¶³æ—¶è§¦å‘ã€‚ æ–°ç”Ÿä»£GCï¼šåœ¨æ–°ç”Ÿä»£ä¸­å›æ”¶å†…å­˜ï¼Œå­˜æ´»å¯¹è±¡è¢«å¤åˆ¶åˆ°SurvivoråŒºæˆ–æ™‹å‡åˆ°è€å¹´ä»£ è§¦å‘æ¡ä»¶ï¼šå½“æ–°ç”Ÿä»£ï¼ˆEdenåŒºå’ŒSurvivoråŒºï¼‰ä¸­çš„å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°åˆ›å»ºçš„å¯¹è±¡æ—¶ï¼Œè§¦å‘Minor GCã€‚ æ ‡è®°å­˜æ´»å¯¹è±¡ï¼šGCé¦–å…ˆæ ‡è®°EdenåŒºå’Œä¸€ä¸ªSurvivoråŒºï¼ˆä¾‹å¦‚FromåŒºï¼‰ä¸­æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ã€‚å­˜æ´»çš„å¯¹è±¡æ˜¯æŒ‡é‚£äº›ä»ç„¶è¢«åº”ç”¨ç¨‹åºå¼•ç”¨çš„å¯¹è±¡ã€‚ å¤åˆ¶å­˜æ´»å¯¹è±¡ï¼šå­˜æ´»çš„å¯¹è±¡è¢«å¤åˆ¶åˆ°å¦ä¸€ä¸ªSurvivoråŒºï¼ˆä¾‹å¦‚ToåŒºï¼‰ã€‚å¦‚æœå¯¹è±¡çš„å¹´é¾„è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼Œå®ƒä»¬ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ã€‚ æ¸…ç©ºEdenå’ŒFromåŒºï¼šå®Œæˆå¤åˆ¶åï¼Œæ¸…ç©ºEdenåŒºå’ŒåŸå§‹çš„SurvivoråŒºï¼ˆFromåŒºï¼‰ è€å¹´ä»£GCï¼šå¦‚æœéœ€è¦ï¼Œéšåä¼šè§¦å‘è€å¹´ä»£çš„GCï¼Œæ¸…ç†è€å¹´ä»£ä¸­çš„ä¸å†ä½¿ç”¨çš„å¯¹è±¡ è§¦å‘æ¡ä»¶ï¼šè€å¹´ä»£å†…å­˜ä¸è¶³ï¼Œæˆ–è€…æŸäº›æƒ…å†µä¸‹æ–°ç”Ÿä»£å¯¹è±¡æ— æ³•æ™‹å‡åˆ°è€å¹´ä»£æ—¶è§¦å‘ã€‚ æ ‡è®°è¿‡ç¨‹ï¼šè€å¹´ä»£GCé¦–å…ˆæ˜¯æ ‡è®°é˜¶æ®µï¼Œæ ‡è®°å‡ºæ‰€æœ‰ä»æ ¹é›†åˆï¼ˆå¦‚é™æ€å­—æ®µã€æœ¬åœ°å˜é‡ç­‰ï¼‰å¯è¾¾çš„å¯¹è±¡ã€‚ æ¸…é™¤/æ•´ç†è¿‡ç¨‹ï¼šæ ‡è®°å®Œæˆåï¼Œæ‰§è¡Œæ¸…é™¤æˆ–æ•´ç†æ“ä½œã€‚åœ¨æ¸…é™¤é˜¶æ®µï¼Œå›æ”¶æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ã€‚åœ¨æ•´ç†é˜¶æ®µï¼ˆå¦‚æœä½¿ç”¨çš„æ˜¯æ ‡è®°-æ•´ç†ç®—æ³•ï¼‰ï¼Œåˆ™æ˜¯ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œä»¥æ¶ˆé™¤å†…å­˜ç¢ç‰‡ - Javaå¯¹è±¡å¤´é‡Œæœ‰ä»€ä¹ˆâ˜…1. æ ‡è®°å­—ï¼ˆMark Wordï¼‰æ ‡è®°å­—å­˜å‚¨äº†å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š å“ˆå¸Œç ï¼šç³»ç»Ÿé»˜è®¤çš„ã€å¯é‡å†™çš„å¯¹è±¡å“ˆå¸Œç ã€‚ åƒåœ¾å›æ”¶ä¿¡æ¯ï¼šå¦‚å¹´é¾„ï¼ˆåœ¨æ–°ç”Ÿä»£ä¸­å·²ç»ç»å†è¿‡çš„GCæ¬¡æ•°ï¼‰æˆ–å…¶ä»–ä¸GCç›¸å…³çš„æ ‡è®°ã€‚ é”çŠ¶æ€æ ‡è®°ï¼šå¯¹è±¡çš„é”ä¿¡æ¯ï¼Œç”¨äºè¡¨ç¤ºå¯¹è±¡æ˜¯å¦è¢«é”å®šä»¥åŠé”å®šçš„çŠ¶æ€ï¼ˆå¦‚åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ç­‰ï¼‰ã€‚ é”è®°å½•çš„çº¿ç¨‹ï¼šå¦‚æœå¯¹è±¡è¢«ä½œä¸ºé”ä½¿ç”¨ï¼Œè¿™é‡Œä¼šè®°å½•æŒæœ‰è¯¥é”çš„çº¿ç¨‹ã€‚ åå‘çº¿ç¨‹IDï¼šå¦‚æœå¯ç”¨äº†åå‘é”ï¼Œè¿™é‡Œä¼šè®°å½•åå‘å“ªä¸ªçº¿ç¨‹ã€‚ 2. ç±»å‹æŒ‡é’ˆï¼ˆClass Pointerï¼‰ æŒ‡å‘ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼šè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å¯¹è±¡æ‰€å±ç±»çš„å…ƒæ•°æ®ï¼ŒJVMé€šè¿‡å®ƒæ¥ç¡®å®šå¯¹è±¡çš„ç±»ã€‚ æ•°ç»„é•¿åº¦ï¼šå¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™éƒ¨åˆ†è¿˜ä¼šåŒ…å«æ•°ç»„çš„é•¿åº¦ã€‚ - å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿâ˜…â˜… å¼ºå¼•ç”¨ï¼šå¸¸è§„å¯¹è±¡å¼•ç”¨ï¼Œé˜»æ­¢åƒåœ¾å›æ”¶ã€‚ è½¯å¼•ç”¨ï¼šå†…å­˜æ•æ„Ÿçš„ç¼“å­˜ï¼Œå†…å­˜ä¸è¶³æ—¶å¯èƒ½è¢«å›æ”¶ã€‚ å¼±å¼•ç”¨ï¼šç®€å•çš„ç¼“å­˜ï¼Œä¸€æ—¦æ²¡æœ‰å¼ºå¼•ç”¨æŒ‡å‘å¯¹è±¡ä¸”å‘ç”ŸGCï¼Œå³è¢«å›æ”¶ã€‚ è™šå¼•ç”¨ï¼šå¯¹è±¡å›æ”¶è·Ÿè¸ªï¼Œä¸å½±å“å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ - å“ªäº›éƒ¨åˆ†å¯ä»¥ä½œä¸ºGC Root å±€éƒ¨å˜é‡ï¼šå½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•çš„å±€éƒ¨å˜é‡å’Œè¾“å…¥å‚æ•°ã€‚è¿™äº›å˜é‡ä½äºJavaæ ˆä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆå’Œå±€éƒ¨å˜é‡ã€‚ æ´»è·ƒçš„çº¿ç¨‹ï¼šæ‰€æœ‰æ´»è·ƒçš„çº¿ç¨‹ï¼ˆThreadå¯¹è±¡ï¼‰éƒ½æ˜¯GC Rootsã€‚è¿™åŒ…æ‹¬è°ƒç”¨Javaä»£ç çš„çº¿ç¨‹ä»¥åŠJVMå†…éƒ¨çš„çº¿ç¨‹ã€‚ é™æ€å­—æ®µï¼šç±»çš„é™æ€å­—æ®µã€‚è¿™äº›å­—æ®µå±äºJavaç±»è€Œéå®ä¾‹ï¼Œè¢«å­˜å‚¨åœ¨æ–¹æ³•åŒºæˆ–Java 8åŠä»¥åç‰ˆæœ¬çš„å…ƒç©ºé—´ä¸­ã€‚ JNIå¼•ç”¨ï¼šç”±æœ¬åœ°æ–¹æ³•ï¼ˆå³ä½¿ç”¨Java Native Interfaceï¼ˆJNIï¼‰çš„æ–¹æ³•ï¼‰åˆ›å»ºçš„å¯¹è±¡å¼•ç”¨ã€‚ ç³»ç»Ÿç±»ï¼šç”±Bootstrapç±»åŠ è½½å™¨åŠ è½½çš„ç±»ã€‚ å·²æ³¨å†Œçš„ç›‘å¬å™¨å’Œå›è°ƒï¼šå¦‚é€šè¿‡æŸäº›APIæ³¨å†Œçš„äº‹ä»¶ç›‘å¬å™¨æˆ–å…¶ä»–å›è°ƒ - ä¸ºä»€ä¹ˆéœ€è¦GC RootsGC Rootsåœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­éå¸¸é‡è¦ï¼Œå› ä¸ºåƒåœ¾å›æ”¶å™¨éœ€è¦æœ‰ä¸€ä¸ªæ˜ç¡®çš„èµ·ç‚¹æ¥å¼€å§‹å…¶å·¥ä½œã€‚GC Rootsæä¾›äº†è¿™äº›èµ·ç‚¹ï¼ŒGCé€šè¿‡è¿™äº›æ ¹å¯¹è±¡éå†å¼•ç”¨å›¾ï¼Œæ ‡è®°æ‰€æœ‰ä»æ ¹å¯è¾¾çš„å¯¹è±¡ã€‚åªæœ‰é‚£äº›æ— æ³•ä»ä»»ä½•GC Rootsåˆ°è¾¾çš„å¯¹è±¡æ‰è¢«è®¤ä¸ºæ˜¯åƒåœ¾ï¼Œå¯ä»¥è¢«å®‰å…¨å›æ”¶ 3ã€GCç¯‡- ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘åƒåœ¾å›æ”¶ å †å†…å­˜ä¸è¶³ï¼šå½“JVMä¸­çš„å †å†…å­˜æ¥è¿‘å…¶æé™æ—¶ï¼Œä¼šè§¦å‘åƒåœ¾å›æ”¶ä»¥é‡Šæ”¾å†…å­˜ã€‚è¿™æ˜¯æœ€å¸¸è§çš„è§¦å‘åŸå› ã€‚ æ–°ç”Ÿä»£å†…å­˜ä¸è¶³ï¼šå½“æ–°ç”Ÿä»£ï¼ˆEdenåŒºæˆ–SurvivoråŒºï¼‰çš„ç©ºé—´ä¸è¶³ä»¥ä¸ºæ–°å¯¹è±¡åˆ†é…ç©ºé—´æ—¶ï¼Œä¼šè§¦å‘Minor GCã€‚ è€å¹´ä»£å†…å­˜ä¸è¶³ï¼šå½“è€å¹´ä»£ç©ºé—´ä¸è¶³ä»¥å®¹çº³ä»æ–°ç”Ÿä»£æ™‹å‡è¿‡æ¥çš„å¯¹è±¡æ—¶ï¼Œä¼šè§¦å‘Major GCæˆ–Full GCã€‚ ç³»ç»Ÿè°ƒç”¨ï¼š è°ƒç”¨System.gc()æ–¹æ³•ï¼šç¨‹åºå‘˜å¯ä»¥é€šè¿‡è°ƒç”¨è¿™ä¸ªæ–¹æ³•è¯·æ±‚JVMæ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œä½†æ˜¯JVMå¹¶ä¸ä¿è¯ç«‹å³å“åº”è¯¥è¯·æ±‚ã€‚ ä½¿ç”¨JVMå‚æ•°ï¼šä¾‹å¦‚ï¼Œ-XX:+ExplicitGCInvokesConcurrentå’Œ-XX:+DisableExplicitGCå¯ä»¥æ§åˆ¶ç³»ç»Ÿè°ƒç”¨System.gc()çš„è¡Œä¸ºã€‚ æ°¸ä¹…ä»£/å…ƒç©ºé—´æ»¡æ—¶ï¼šåœ¨JVMçš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ç©ºé—´æ»¡ï¼Œä¼šè§¦å‘Full GCã€‚åœ¨Java 8åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œæ°¸ä¹…ä»£è¢«å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰æ‰€å–ä»£ï¼Œå¦‚æœå…ƒç©ºé—´æ»¡ï¼ŒåŒæ ·ä¼šè§¦å‘Full GCã€‚ JVMåˆå§‹åŒ–å‚æ•°ï¼š è®¾ç½®äº†ç‰¹å®šçš„GCå‚æ•°ï¼Œå¦‚å †å¤§å°ï¼ˆ-Xmså’Œ-Xmxï¼‰æˆ–è€…ç‰¹å®šçš„GCæ”¶é›†å™¨è¡Œä¸ºå‚æ•°ï¼Œä¹Ÿå¯èƒ½å½±å“GCçš„è§¦å‘ã€‚ å†…å­˜åˆ†é…ç‡é«˜ï¼šå¦‚æœåº”ç”¨ç¨‹åºå¿«é€Ÿåœ°åˆ†é…å¯¹è±¡ï¼Œå³ä½¿å †å†…å­˜è¿˜æœªæ»¡ï¼ŒJVMä¹Ÿå¯èƒ½æå‰è§¦å‘GCï¼Œä»¥é˜²åœ¨æœªæ¥å‡ºç°å†…å­˜ä¸è¶³çš„æƒ…å†µã€‚ å…¶ä»–æƒ…å†µï¼š åˆ†ä»£æ”¶é›†å™¨åœ¨å¤„ç†ä¸åŒä»£ï¼ˆæ–°ç”Ÿä»£ã€è€å¹´ä»£ï¼‰æ—¶ä¹Ÿä¼šæœ‰ä¸åŒçš„è§¦å‘æœºåˆ¶ã€‚ å¹¶å‘åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚G1ï¼‰å¯èƒ½åœ¨åå°æŒç»­è¿è¡Œï¼Œæ‰§è¡Œæ›´ç»†ç²’åº¦çš„å›æ”¶æ“ä½œã€‚ - å¸¸è§çš„åƒåœ¾å›æ”¶å™¨ç®—æ³•æœ‰å“ªäº›1. Serial GC JDKç‰ˆæœ¬ï¼šæ—©æœŸç‰ˆæœ¬ã€‚ ç®—æ³•ï¼šå•çº¿ç¨‹ï¼Œæ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ•´ç†ã€‚ åº”ç”¨åœºæ™¯ï¼šå•æ ¸å¤„ç†å™¨ã€å°å‹åº”ç”¨ã€å¼€å‘ç¯å¢ƒã€‚ æ€§èƒ½ï¼šååé‡é€‚ä¸­ï¼Œåœé¡¿æ—¶é—´è¾ƒé•¿ã€‚ 2. Parallel GC JDKç‰ˆæœ¬ï¼šè‡ªJDK 1.4èµ·ã€‚ ç®—æ³•ï¼šå¤šçº¿ç¨‹ï¼Œæ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ•´ç†ã€‚ åº”ç”¨åœºæ™¯ï¼šå¤šæ ¸å¤„ç†å™¨ï¼Œæ³¨é‡é«˜ååé‡çš„åå°å¤„ç†å’Œæ‰¹å¤„ç†ç³»ç»Ÿã€‚ æ€§èƒ½ï¼šé«˜ååé‡ï¼Œä½†GCåœé¡¿æ—¶é—´è¾ƒé•¿ã€‚ 3. CMS (Concurrent Mark-Sweep) GC JDKç‰ˆæœ¬ï¼šè‡ªJDK 5èµ·ã€‚ ç®—æ³•ï¼šå¹¶å‘æ ‡è®°å’Œæ¸…é™¤ã€‚ åº”ç”¨åœºæ™¯ï¼šWEBåº”ç”¨æœåŠ¡å™¨ï¼Œäº¤äº’å¼åº”ç”¨ã€‚ æ€§èƒ½ï¼šå‡å°‘åœé¡¿æ—¶é—´ï¼Œä½†å¯èƒ½äº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå ç”¨æ›´å¤šCPUèµ„æºã€‚ 4. G1 (Garbage-First) GC JDKç‰ˆæœ¬ï¼šè‡ªJDK 7èµ·ï¼ŒJDK 9ä¸­æˆä¸ºé»˜è®¤é€‰é¡¹ã€‚ ç®—æ³•ï¼šå°†å †åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œå¹¶è¡Œå’Œå¢é‡å¼æ¸…ç†ã€‚ åº”ç”¨åœºæ™¯ï¼šå¤§å‹Webåº”ç”¨å’Œä¸­é—´ä»¶ï¼Œéœ€è¦å¹³è¡¡ååé‡å’Œå“åº”æ—¶é—´ã€‚ æ€§èƒ½ï¼šåœé¡¿æ—¶é—´å¯æ§ï¼Œçµæ´»å¤„ç†å¤§å †å†…å­˜ã€‚ 5. ZGC (Z Garbage Collector) JDKç‰ˆæœ¬ï¼šè‡ªJDK 11èµ· ç®—æ³•ï¼šå¹¶å‘ï¼ŒåŸºäºåŒºåŸŸçš„å†…å­˜ç®¡ç†ã€‚ åº”ç”¨åœºæ™¯ï¼šå¤§æ•°æ®å¤„ç†ã€å®æ—¶ç³»ç»Ÿã€é«˜é¢‘äº¤æ˜“ç³»ç»Ÿã€‚ æ€§èƒ½ï¼šæä½çš„åœé¡¿æ—¶é—´ï¼Œé€‚åˆå¤§å †å†…å­˜ã€‚ åˆ†ä»£å’Œåˆ†åŒº åˆ†ä»£ï¼ˆSerial, Parallel, CMSï¼‰ï¼šæ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ•´ç†æˆ–æ ‡è®°-æ¸…é™¤ã€‚ åˆ†åŒºï¼ˆG1, ZGCï¼‰ï¼šä¸ä¸¥æ ¼éµå¾ªä¼ ç»Ÿåˆ†ä»£æ¨¡å‹ï¼Œé€šè¿‡å°†å †åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸæ¥å®ç°æ›´ç»†ç²’åº¦çš„å†…å­˜ç®¡ç†ã€‚ æ€§èƒ½å¯¹æ¯” ååé‡ï¼šParallel GCæä¾›æœ€é«˜çš„ååé‡ï¼Œé€‚åˆCPUèµ„æºå……è¶³çš„ç¯å¢ƒã€‚ åœé¡¿æ—¶é—´ï¼šZGCå’ŒShenandoahåœ¨ä¿è¯æä½å»¶è¿Ÿæ–¹é¢è¡¨ç°æœ€ä½³ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦ä½åœé¡¿çš„åœºæ™¯ã€‚ èµ„æºå ç”¨ï¼šSerialå’ŒParallel GCèµ„æºå ç”¨è¾ƒä½ï¼Œä½†åœ¨å¤šæ ¸å¿ƒç¯å¢ƒä¸­å¯èƒ½ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚ çµæ´»æ€§ï¼šG1æä¾›çµæ´»çš„åœé¡¿æ—¶é—´æ§åˆ¶ï¼Œé€‚åˆéœ€è¦å¹³è¡¡ååé‡å’Œå“åº”æ—¶é—´çš„å¤æ‚åº”ç”¨ã€‚ - å¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè¢«å›æ”¶ â˜…â˜…â˜…1ã€ä¸å¯è¾¾æ€§ å¯¹è±¡å˜å¾—â€œä¸å¯è¾¾â€æ—¶ï¼Œå³æ²¡æœ‰ä»»ä½•æ´»åŠ¨çº¿ç¨‹çš„å¼•ç”¨é“¾èƒ½å¤Ÿåˆ°è¾¾è¯¥å¯¹è±¡ï¼Œè¿™æ˜¯å¯¹è±¡è¢«å›æ”¶çš„ä¸»è¦æ¡ä»¶ 2ã€å…¶ä»–å¼•ç”¨ç±»å‹ è½¯å¼•ç”¨å¯¹è±¡ï¼šå½“JVMå†…å­˜ä¸è¶³æ—¶ï¼ŒæŒ‡å‘è¿™äº›å¯¹è±¡çš„è½¯å¼•ç”¨ä¼šè¢«å›æ”¶ã€‚ å¼±å¼•ç”¨å¯¹è±¡ï¼šåªè¦GCè¿è¡Œï¼ŒæŒ‡å‘è¿™äº›å¯¹è±¡çš„å¼±å¼•ç”¨å°±ä¼šè¢«å›æ”¶ã€‚ è™šå¼•ç”¨å¯¹è±¡ï¼šè™šå¼•ç”¨ä¸ä¼šå½±å“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶ç”¨äºæ¥æ”¶ç³»ç»Ÿé€šçŸ¥ 3ã€æœªè¢«é”å®šæˆ–åŒæ­¥ å¦‚æœå¯¹è±¡å½“å‰è¢«ç”¨äºé”å®šæˆ–åŒæ­¥ï¼ˆä¾‹å¦‚ï¼Œä½œä¸ºsynchronizedå—çš„ç›®æ ‡ï¼‰ï¼Œé‚£ä¹ˆå®ƒä¸ä¼šè¢«å›æ”¶ 4ã€è°ƒä¼˜ç¯‡- JVMè°ƒä¼˜è°ƒçš„å“ªäº›å‚æ•°ï¼Ÿåœ¨å“ªé‡Œå†™è¿™äº›å‚æ•°1. å †å†…å­˜è®¾ç½® -Xmsï¼šè®¾ç½®å †å†…å­˜çš„åˆå§‹å¤§å°ã€‚ä¾‹å¦‚ï¼Œ-Xms512mè®¾ç½®åˆå§‹å †å¤§å°ä¸º512MBã€‚ -Xmxï¼šè®¾ç½®å †å†…å­˜çš„æœ€å¤§å¤§å°ã€‚ä¾‹å¦‚ï¼Œ-Xmx1024mè®¾ç½®æœ€å¤§å †å¤§å°ä¸º1024MBã€‚ -Xmnï¼šè®¾ç½®æ–°ç”Ÿä»£å¤§å°ï¼ˆä»…é€‚ç”¨äºæŸäº›åƒåœ¾å›æ”¶å™¨ï¼‰ã€‚ 2. åƒåœ¾å›æ”¶å™¨è®¾ç½® -XX:+UseG1GCï¼šä½¿ç”¨G1åƒåœ¾å›æ”¶å™¨ã€‚ -XX:+UseConcMarkSweepGCï¼šä½¿ç”¨CMSåƒåœ¾å›æ”¶å™¨ã€‚ -XX:+UseParallelGCï¼šä½¿ç”¨å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ã€‚ 3. åƒåœ¾å›æ”¶ä¼˜åŒ– -XX:SurvivorRatioï¼šè®¾ç½®EdenåŒºä¸ä¸€ä¸ªSurvivoråŒºçš„å¤§å°æ¯”ä¾‹ã€‚ -XX:NewRatioï¼šè®¾ç½®è€å¹´ä»£ä¸æ–°ç”Ÿä»£çš„æ¯”ä¾‹ã€‚ -XX:MaxTenuringThresholdï¼šè®¾ç½®å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ã€‚ -XX:PermSizeå’Œ-XX:MaxPermSizeï¼šè®¾ç½®æ°¸ä¹…ä»£çš„åˆå§‹å’Œæœ€å¤§å¤§å°ï¼ˆåœ¨Java 8ä¸­è¢«å…ƒç©ºé—´Metaspaceæ›¿ä»£ï¼‰ã€‚ 4. æ€§èƒ½ç›‘æ§ -XX:+PrintGCDetailsï¼šæ‰“å°è¯¦ç»†çš„GCæ—¥å¿—ã€‚ -XX:+PrintGCDateStampsï¼šåœ¨GCæ—¥å¿—ä¸­æ·»åŠ æ—¶é—´æˆ³ã€‚ -XX:+PrintHeapAtGCï¼šåœ¨è¿›è¡ŒGCæ—¶æ‰“å°å †çš„æ¦‚è¦ä¿¡æ¯ã€‚ 5. çº¿ç¨‹å †æ ˆè®¾ç½® -Xssï¼šè®¾ç½®æ¯ä¸ªçº¿ç¨‹å †æ ˆçš„å¤§å°ã€‚ä¾‹å¦‚ï¼Œ-Xss256kè®¾ç½®çº¿ç¨‹å †æ ˆå¤§å°ä¸º256KB è®¾ç½®æ–¹å¼1ã€jar java -Xmx1024m -XX:MaxPermSize=256m -jar your-application.jar 2ã€maven &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.0-M5&lt;/version&gt; &lt;configuration&gt; &lt;argLine&gt;-Xmx1024m -XX:MaxPermSize=256m&lt;/argLine&gt; &lt;/configuration&gt; &lt;/plugin&gt; åŠ¨æ€è®¾ç½®å‚æ•°å¦‚æœå®åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¿®æ”¹çš„è¯ï¼Œéƒ¨åˆ†å‚æ•°å¯ä»¥ä½¿ç”¨ JMX ï¼Œjdkè‡ªå¸¦çš„æ¥å£å»å®ç° - å†…å­˜æ³„æ¼çš„åŸå› ï¼Œå†…å­˜æ³„æ¼æ€ä¹ˆè§£å†³ â˜…â˜…â˜…â˜…â˜…åŸå›  é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨ï¼šä¾‹å¦‚ï¼Œä¸€ä¸ªé™æ€é›†åˆç±»æŒæœ‰ä¸´æ—¶å¯¹è±¡çš„å¼•ç”¨ã€‚ ç›‘å¬å™¨å’Œå…¶ä»–å›è°ƒï¼šæ³¨å†Œäº†ç›‘å¬å™¨æˆ–å›è°ƒï¼Œä½†æœªåœ¨ä¸éœ€è¦æ—¶å–æ¶ˆæ³¨å†Œã€‚ ç¼“å­˜æœºåˆ¶ï¼šå¯¹è±¡è¢«æ”¾å…¥ç¼“å­˜ä¸”æœªåŠæ—¶æ¸…ç†ã€‚ èµ„æºæœªå…³é—­ï¼šæ•°æ®åº“è¿æ¥ã€æ–‡ä»¶æµç­‰èµ„æºæœªå…³é—­ è§£å†³ï¼š1ã€å®¡æŸ¥ä»£ç ï¼šç¼–ç çš„æ—¶å€™ä½¿ç”¨è°·æ­Œæˆ–è€…é˜¿é‡Œçš„ç¼–ç è§„çº¦æ’ä»¶ 2ã€åˆ†æå·¥å…·ï¼šjvisualvm , arthas 3ã€ç¼“å­˜ç®¡ç†ï¼šå¯¹äºä½¿ç”¨ç¼“å­˜çš„åœºæ™¯ï¼Œç¡®ä¿å®ç°é€‚å½“çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥ 4ã€é¿å…é™æ€é›†åˆç±»æ»¥ç”¨ï¼šé™æ€é›†åˆç±»å¦‚æœä¸æ­£ç¡®ç®¡ç†ï¼Œå®¹æ˜“æˆä¸ºå†…å­˜æ³„æ¼çš„æºå¤´ 5ã€èµ„æºç®¡ç†ï¼šç¡®ä¿æ‰€æœ‰èµ„æºï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€æ–‡ä»¶æµï¼‰éƒ½åœ¨ä½¿ç”¨åæ­£ç¡®å…³é—­ - ç”¨è¿‡å“ªäº›è°ƒä¼˜å·¥å…·JDKè‡ªå¸¦çš„ jvisualvm ï¼Œè¦çœ‹ GC å †åŒºåŸŸéœ€è¦ä¸‹è½½æ’ä»¶ï¼ŒåŠŸèƒ½ä¹Ÿæ¯”è¾ƒåŸºç¡€ é˜¿é‡Œçš„arthas ï¼ŒåŠ¨æ€ç›‘æ§å’Œæ•…éšœæ’æŸ¥æ›´åŠ å“è¶Šï¼Œæ›´é€‚åˆç”Ÿäº§ä½¿ç”¨ - ä»SQLã€JVMã€æ¶æ„è®²è®²ä¼˜åŒ–æ€è·¯1. SQLä¼˜åŒ– æ‰§è¡Œè®¡åˆ’åˆ†æï¼šä½¿ç”¨æ•°æ®åº“æä¾›çš„æ‰§è¡Œè®¡åˆ’å·¥å…·åˆ†æå¤æ‚æŸ¥è¯¢ï¼Œè¯†åˆ«ä½æ•ˆçš„æŸ¥è¯¢æ“ä½œã€‚ ç´¢å¼•ä¼˜åŒ–ï¼šåˆç†åˆ›å»ºç´¢å¼•ä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶é¿å…è¿‡å¤šç´¢å¼•å¯¼è‡´çš„å†™æ“ä½œæ€§èƒ½ä¸‹é™ã€‚ æŸ¥è¯¢é‡å†™ï¼šä¼˜åŒ–SQLè¯­å¥ï¼Œå¦‚ä½¿ç”¨JOINä»£æ›¿å­æŸ¥è¯¢ï¼Œå‡å°‘ä¸å¿…è¦çš„åˆ—å’Œè¡Œçš„æŸ¥è¯¢ã€‚ æ‰¹é‡å¤„ç†ï¼šå¯¹äºå¤§é‡çš„æ•°æ®æ’å…¥æˆ–æ›´æ–°ï¼Œä½¿ç”¨æ‰¹å¤„ç†ä»¥å‡å°‘ç½‘ç»œå’Œæ•°æ®åº“çš„è´Ÿæ‹…ã€‚ é¿å…å…¨è¡¨æ‰«æï¼šå°½é‡ä½¿ç”¨ç´¢å¼•æ‰«æè€Œéå…¨è¡¨æ‰«æ JVMè°ƒä¼˜ åˆç†è®¾ç½®å †å¤§å°ï¼šé€šè¿‡-Xmså’Œ-Xmxè®¾ç½®é€‚å½“çš„å †åˆå§‹å¤§å°å’Œæœ€å¤§å¤§å°ã€‚ é€‰æ‹©åˆé€‚çš„åƒåœ¾å›æ”¶å™¨ï¼šæ ¹æ®åº”ç”¨éœ€æ±‚é€‰æ‹©åƒåœ¾å›æ”¶å™¨ï¼ˆå¦‚G1ã€CMSæˆ–Parallel GCï¼‰ã€‚ ç›‘æ§å’Œåˆ†æGCï¼šå®šæœŸç›‘æ§å’Œåˆ†æåƒåœ¾å›æ”¶è¿‡ç¨‹ï¼Œè¯†åˆ«æ½œåœ¨çš„å†…å­˜é—®é¢˜ã€‚ å‡å°‘å¯¹è±¡åˆ›å»ºï¼šé€šè¿‡å¯¹è±¡æ± ç­‰æŠ€æœ¯å‡å°‘å¯¹è±¡é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ã€‚ 3. ç³»ç»Ÿæ¶æ„ä¼˜åŒ– å¾®æœåŠ¡æ¶æ„ï¼šæ ¹æ®éœ€è¦å°†åº”ç”¨åˆ†è§£ä¸ºå¤šä¸ªå¾®æœåŠ¡ï¼Œä»¥æé«˜å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚ ç¼“å­˜ç­–ç•¥ï¼šä½¿ç”¨ç¼“å­˜ï¼ˆå¦‚Redisã€Memcachedï¼‰å‡è½»æ•°æ®åº“è´Ÿæ‹…ï¼ŒåŠ å¿«æ•°æ®è®¿é—®é€Ÿåº¦ã€‚ è´Ÿè½½å‡è¡¡ï¼šåœ¨å¤šä¸ªæœåŠ¡å™¨é—´åˆ†æ•£è´Ÿè½½ï¼Œä»¥æé«˜ç³»ç»Ÿçš„å“åº”èƒ½åŠ›å’Œå¯ç”¨æ€§ã€‚ å¼‚æ­¥å¤„ç†å’Œæ¶ˆæ¯é˜Ÿåˆ—ï¼šå¯¹äºéå®æ—¶æ€§è¦æ±‚çš„ä»»åŠ¡ä½¿ç”¨å¼‚æ­¥å¤„ç†å’Œæ¶ˆæ¯é˜Ÿåˆ— Nã€è®¾è®¡é¢˜1ã€MQå®ç°å¼‚æ­¥ç§’æ€1ã€ä»‹ç»åœºæ™¯ï¼šä¸€ä¸‡ä»¶å•†å“åŒæ—¶è¢«ä¸€ä¸‡äººç§’æ€æˆåŠŸï¼Œä¼šå¯¼è‡´ç¬é—´ä¸Šä¸‡è¯·æ±‚è®¿é—®åˆ°è®¢å•æ•°æ®åº“ä¸­åˆ›å»ºè®¢å•ã€‚æ­¤æ—¶å¯¹æ•°æ®åº“çš„å‹åŠ›å°±ä¼šå¾ˆå¤§ã€‚ æ–¹æ¡ˆï¼šå¼•å…¥RocketMQè¿›è¡Œå‰Šå³°å¤„ç†ã€‚ æ¯ä¸ªè¯·æ±‚è¿›æ¥åœ¨Redisä¸­ç§’æ€åº“å­˜æˆåŠŸï¼Œå°±è®¤ä¸ºéœ€è¦ç”Ÿæˆè®¢å•ï¼Œæ­¤æ—¶å‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ°RocketMQä¸­å»ã€‚ ç„¶åè®©æ™®é€šè®¢å•ç³»ç»Ÿä»RocketMQä¸­æ¶ˆè´¹ç§’æ€æˆåŠŸçš„æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚å¯¹äºMQæ¥è¯´ï¼Œè¿™ç§ä¸Šä¸‡çš„æ¶ˆæ¯ç§¯å‹å¾ˆå®¹æ˜“å°±æ‰›ä¸‹æ¥äº†ï¼Œåªè¦è¿‡äº†é«˜å³°æœŸï¼Œè®¢å•ç³»ç»Ÿå¾ˆå¿«å°±èƒ½æ¶ˆè´¹ã€å¤„ç†å®Œã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šå¯¹è®¢å•æ•°æ®åº“é€ æˆè¿‡å¤§çš„å‹åŠ› 2ã€æ¶æ„å›¾ 3ã€æ€»ç»“ åœ¨å‰ç«¯/å®¢æˆ·ç«¯è®¾ç½®ç§’æ€ç­”é¢˜ï¼Œé”™å¼€å¤§é‡äººä¸‹å•çš„æ—¶é—´ï¼Œç»„ç»‡ä½œå¼Šå™¨åˆ·å• ç‹¬ç«‹å‡ºæ¥ä¸€å¥—ç§’æ€ç³»ç»Ÿï¼Œä¸“é—¨è´Ÿè´£å¤„ç†ç§’æ€è¯·æ±‚ ä¼˜å…ˆåŸºäºRedisè¿›è¡Œé«˜å¹¶å‘çš„åº“å­˜æ‰£å‡ï¼Œä¸€æ—¦åº“å­˜æ‰£å®Œåˆ™ç§’æ€ç»“æŸ ç§’æ€ç»“æŸä¹‹åï¼ŒNginxå±‚è¿‡æ»¤æ‰æ— æ•ˆçš„è¯·æ±‚ï¼Œå¤§å¹…åº¦å‰Šå‡è½¬å‘åˆ°åç«¯çš„æµé‡ ç¬æ—¶ç”Ÿæˆçš„å¤§é‡ä¸‹å•è¯·æ±‚ç›´æ¥è¿›å…¥RocketMQè¿›è¡Œå‰Šå³°ï¼Œè®¢å•ç³»ç»Ÿæ…¢æ…¢æ‹‰å–æ¶ˆæ¯å®Œæˆä¸‹å•æ“ä½œ ç§’æ€ç³»ç»Ÿè¡¥å……ï¼š1ã€å¤§é‡ç”¨æˆ·å…ˆè¿›æ¥é¡µé¢è¯¦æƒ…é¡µé¢ï¼Œèµ°CDNé™æ€åŒ–åŠ é€Ÿï¼Œåˆ°Nginxé›†ç¾¤ï¼ˆåŠ¨é™åˆ†ç¦»ï¼‰ï¼Œå…¶æ¬¡å»Redisé›†ç¾¤åŠ è½½ç§’æ€æ•°æ®ï¼ˆè¿™ä¸ªæ•°æ®å¯ä»¥æäº¤å‰ç¼“å­˜é¢„çƒ­ï¼‰ï¼Œç„¶ååˆ°é¡µé¢æ¸²æŸ“ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ç†è®ºæ˜¯æ²¡æœ‰ç»è¿‡åç«¯æœåŠ¡ç³»ç»Ÿæ¸²æŸ“ï¼Œç›´æ¥å‰ç«¯æ¸²æŸ“ï¼Œå…¶å®å¯ä»¥åç«¯æ¸²æŸ“ï¼ˆä¸å»ºè®®ï¼‰2ã€å¤§é‡ç³»ç»Ÿä¸‹å•ï¼Œå…ˆåˆ°å‰ç«¯ç§’æ€ç­”é¢˜ï¼ˆå½“ç„¶ä¹Ÿæœ‰çš„å¯ä»¥é€šè¿‡Nginxå¯¹è¯·æ±‚åˆ‡åˆ†åˆ†æ‰¹ï¼‰ï¼Œç„¶åæŠŠæ— æ•ˆè¯·æ±‚ç»è¿‡Nginxé›†ç¾¤è¿‡æ»¤ï¼›æœ‰æ•ˆè¯·æ±‚è¿›å…¥ç§’æ€ç³»ç»Ÿï¼Œå…³äºåº“å­˜æ•°æ®ä¼šæäº¤é¢„çƒ­åˆ°Redisé›†ç¾¤è¿›è¡Œåº“å­˜æ‰£é™¤ï¼Œå¤§é‡æˆåŠŸçš„è®¢å•è¿›å…¥RocketMQè¿›è¡Œå‰Šå³°ï¼Œè®¢å•ç³»ç»Ÿæ…¢æ…¢æ‹‰å–å®Œæˆä¸‹å•æ“ä½œ 2ã€RocketMQäº‹åŠ¡æœ€ç»ˆä¸€è‡´æ€§1ã€æ‰§è¡Œæµç¨‹å›¾ 1ã€é¦–å…ˆæœåŠ¡ A å‘é€ä¸€ä¸ªåŠäº‹åŠ¡æ¶ˆæ¯(ä¹Ÿç§° half æ¶ˆæ¯)è‡³ MQ ä¸­ã€‚ä¸ºä»€ä¹ˆè¦å…ˆå‘é€ä¸€ä¸ª half æ¶ˆæ¯å‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†ä¿è¯æœåŠ¡ A å’Œ MQ ä¹‹é—´çš„é€šä¿¡æ­£å¸¸ï¼Œå¦‚æœæ— æ³•æ­£å¸¸é€šä¿¡ï¼Œåˆ™æœåŠ¡ A å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªå¼‚å¸¸ï¼Œä¹Ÿå°±ä¸ç”¨å¤„ç†åé¢çš„é€»è¾‘çš„äº†ã€‚ 2ã€å¦‚æœ half æ¶ˆæ¯å‘é€æˆåŠŸï¼ŒMQ æ”¶åˆ°è¿™ä¸ª half æ¶ˆæ¯åï¼Œä¼šè¿”å›ä¸€ä¸ª success å“åº”ç»™æœåŠ¡ Aã€‚ 3ã€æœåŠ¡ A æ¥æ”¶åˆ° MQ è¿”å›çš„ success å“åº”åï¼Œå¼€å§‹å¤„ç†æœ¬åœ°çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶æäº¤æœ¬åœ°äº‹åŠ¡ã€‚ 4ã€å¦‚æœæœåŠ¡ A æœ¬åœ°äº‹åŠ¡æäº¤æˆåŠŸï¼Œåˆ™ä¼šå‘ MQ ä¸­å‘é€ commitï¼Œè¡¨ç¤ºå°† half æ¶ˆæ¯æäº¤ï¼ŒMQ å°±ä¼šæ‰§è¡Œç¬¬ 5 æ­¥æ“ä½œï¼›å¦‚æœæœåŠ¡ A æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥ï¼Œåˆ™ç›´æ¥å›æ»šæœ¬åœ°äº‹åŠ¡ï¼Œå¹¶å‘ MQ ä¸­å‘é€ rollbackï¼Œè¡¨ç¤ºå°†ä¹‹å‰çš„ half æ¶ˆæ¯è¿›è¡Œå›æ»šï¼ŒMQ æ¥æ”¶åˆ° rollback æ¶ˆæ¯åï¼Œå°±ä¼šå°† half æ¶ˆæ¯åˆ é™¤ã€‚ 5ã€å¦‚æœ commitï¼Œåˆ™å°† half æ¶ˆæ¯å†™å…¥åˆ°ç£ç›˜ã€‚ 6ã€å¦‚æœ MQ é•¿æ—¶é—´æ²¡æœ‰æ¥æ”¶åˆ° commit æˆ–è€… rollback æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼šæœåŠ¡ A åœ¨å¤„ç†æœ¬åœ°ä¸šåŠ¡æ—¶å®•æœºäº†ï¼Œæˆ–è€…å‘é€çš„ commitã€rollback å› ä¸ºåœ¨å¼±ç½‘ç¯å¢ƒï¼Œæ•°æ®ä¸¢å¤±äº†ã€‚é‚£ä¹ˆ MQ å°±ä¼šåœ¨ä¸€å®šæ—¶é—´åå°è¯•è°ƒç”¨æœåŠ¡ A æä¾›çš„ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£æ¥åˆ¤æ–­ half æ¶ˆæ¯çš„çŠ¶æ€ã€‚æ‰€ä»¥æœåŠ¡ A æä¾›çš„æ¥å£ï¼Œéœ€è¦å®ç°çš„ä¸šåŠ¡é€»è¾‘æ˜¯ï¼šé€šè¿‡æ•°æ®åº“ä¸­å¯¹åº”æ•°æ®çš„çŠ¶æ€æ¥åˆ¤æ–­ï¼Œä¹‹å‰çš„ half æ¶ˆæ¯å¯¹åº”çš„ä¸šåŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚å¦‚æœ MQ ä»è¿™ä¸ªæ¥å£ä¸­å¾—çŸ¥ half æ¶ˆæ¯æ‰§è¡ŒæˆåŠŸäº†ï¼Œé‚£ä¹ˆ MQ å°±ä¼šå°† half æ¶ˆæ¯æŒä¹…åŒ–åˆ°æœ¬åœ°ç£ç›˜ï¼Œå¦‚æœå¾—çŸ¥æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆå°±ä¼šå°† half æ¶ˆæ¯åˆ é™¤ã€‚ 7ã€æœåŠ¡ B ä» MQ ä¸­æ¶ˆè´¹åˆ°å¯¹åº”çš„æ¶ˆæ¯ã€‚ 8ã€æœåŠ¡ B å¤„ç†æœ¬åœ°ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åæäº¤æœ¬åœ°äº‹åŠ¡ã€‚ 2ã€é—®ç­”é¢˜Q: half æ¶ˆæ¯æ˜¯ä¸ªå•¥ï¼Ÿ A: å®ƒå’Œæˆ‘ä»¬æ­£å¸¸å‘é€çš„æ™®é€šæ¶ˆæ¯æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨ MQ ä¸­ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ half åœ¨ MQ ä¸­ä¸ä¼šç«‹é©¬è¢«æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ï¼Œé™¤éè¿™ä¸ª half æ¶ˆæ¯è¢« commit äº†ã€‚(è‡³äºä¸ºä»€ä¹ˆæœª commit çš„ half æ¶ˆæ¯æ— æ³•è¢«æ¶ˆè´¹è€…è¯»å–åˆ°ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ MQ å†…éƒ¨ï¼Œå¯¹äºäº‹åŠ¡æ¶ˆæ¯è€Œè¨€ï¼Œåœ¨ commit ä¹‹å‰ï¼Œä¼šå…ˆæ”¾åœ¨ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ—ä¸­ï¼Œåªæœ‰ commit äº†ï¼Œæ‰ä¼šçœŸæ­£å°†æ¶ˆæ¯æ”¾åœ¨æ¶ˆè´¹è€…èƒ½è¯»å–åˆ°çš„ topic é˜Ÿåˆ—ä¸­) Q: ä¸ºä»€ä¹ˆè¦å…ˆå‘é€ half æ¶ˆæ¯ï¼Ÿ A: å‰é¢å·²ç»è§£é‡Šè¿‡äº†ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯æœåŠ¡ A å’Œ MQ ä¹‹é—´æ˜¯å¦èƒ½æ­£å¸¸é€šä¿¡ï¼Œå¦‚æœä¸¤è€…ä¹‹é—´éƒ½ä¸èƒ½æ­£å¸¸é€šä¿¡ï¼Œåé¢è¿˜ç©ä¸ªé”¤å­ï¼Œç›´æ¥è¿”å›å¼‚å¸¸å°±å¯ä»¥äº†ã€‚ Q: å¦‚æœ MQ æ¥æ”¶åˆ°äº† half æ¶ˆæ¯ï¼Œä½†æ˜¯åœ¨è¿”å› success å“åº”çš„æ—¶å€™ï¼Œå› ä¸ºç½‘ç»œåŸå› ï¼Œå¯¼è‡´æœåŠ¡ A æ²¡æœ‰æ¥æ”¶åˆ° success å“åº”ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯ä»€ä¹ˆç°è±¡ï¼Ÿ A: å½“æœåŠ¡ A å‘é€ half æ¶ˆæ¯åï¼Œå®ƒä¼šç­‰å¾… MQ ç»™è‡ªå·±è¿”å› success å“åº”ï¼Œå¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°ï¼Œé‚£ä¹ˆæœåŠ¡ A ä¹Ÿä¼šç›´æ¥ç»“æŸï¼Œè¿”å›å¼‚å¸¸ï¼Œä¸å†æ‰§è¡Œåç»­é€»è¾‘ã€‚ä¸æ‰§è¡Œåç»­é€»è¾‘ï¼Œè¿™æ ·æœåŠ¡ A ä¹Ÿå°±ä¸ä¼šæäº¤ commit æ¶ˆæ¯ç»™ MQï¼ŒMQ é•¿æ—¶é—´æ²¡æ¥æ”¶åˆ° commit æ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šä¸»åŠ¨å›è°ƒæœåŠ¡ A çš„ä¸€ä¸ªæ¥å£ï¼ŒæœåŠ¡ A é€šè¿‡æ¥å£ï¼ŒæŸ¥è¯¢æœ¬åœ°æ•°æ®åï¼Œå‘ç°è¿™æ¡æ¶ˆæ¯å¯¹åº”çš„ä¸šåŠ¡å¹¶æ²¡æœ‰æ­£å¸¸æ‰§è¡Œï¼Œé‚£ä¹ˆå°±å‘Šè¯‰ MQï¼Œè¿™ä¸ª half æ¶ˆæ¯ä¸èƒ½ commitï¼Œéœ€è¦ rollbackï¼ŒMQ çŸ¥é“åï¼Œå°±å°† half æ¶ˆæ¯è¿›è¡Œåˆ é™¤ã€‚ Q: å¦‚æœæœåŠ¡ A æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ A: æœåŠ¡ A æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥åï¼Œå…ˆå¯¹è‡ªå·±æœ¬åœ°äº‹åŠ¡è¿›è¡Œå›æ»šï¼Œç„¶åå†å‘ MQ å‘é€ rollback æ“ä½œã€‚ Q: æœåŠ¡ A æœ¬åœ°äº‹åŠ¡æäº¤æˆåŠŸæˆ–å¤±è´¥åï¼Œå‘ MQ å‘é€çš„ commit æˆ–è€… rollback æ¶ˆæ¯ï¼Œå› ä¸ºç½‘ç»œé—®é¢˜ä¸¢å¤±äº†ï¼Œåˆè¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ A: å’Œä¸Šä¸€ä¸ªé—®é¢˜ä¸€æ ·ï¼ŒMQ é•¿æ—¶é—´æ²¡æœ‰æ¥æ”¶åˆ° half æ¶ˆæ¯çš„ commit æˆ–è€… rollback æ¶ˆæ¯ï¼ŒMQ ä¼šä¸»åŠ¨å›è°ƒæœåŠ¡ A çš„æ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£æ¥åˆ¤æ–­è‡ªå·±è¯¥å¯¹è¿™ä¸ª half æ¶ˆæ¯å¦‚ä½•å¤„ç†ã€‚ Q: å‰é¢è¯´çš„å…¨æ˜¯äº‹åŠ¡æ¶ˆæ¯çš„å®ç°æµç¨‹ï¼Œè¿™å’Œäº‹åŠ¡æ¶ˆæ¯å¦‚ä½•ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ A: æœ‰å…³ç³»ã€‚é¦–å…ˆï¼ŒæœåŠ¡ A æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶æäº¤å’Œå‘ MQ ä¸­å‘é€æ¶ˆæ¯è¿™æ˜¯ä¸¤ä¸ªå†™æ“ä½œï¼Œç„¶åé€šè¿‡ RocketMQ çš„äº‹åŠ¡æ¶ˆæ¯ï¼Œæˆ‘ä»¬ä¿è¯äº†è¿™ä¸¤ä¸ªå†™æ“ä½œè¦ä¹ˆéƒ½æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œå¤±è´¥ã€‚ç„¶åè®©å…¶ä»–ç³»ç»Ÿï¼Œå¦‚æœåŠ¡ B é€šè¿‡æ¶ˆè´¹ MQ ä¸­çš„æ¶ˆæ¯ï¼Œç„¶åå†å»æ‰§è¡Œè‡ªå·±æœ¬åœ°çš„äº‹åŠ¡ï¼Œè¿™æ ·åˆ°æœ€åï¼ŒæœåŠ¡ A å’ŒæœåŠ¡ B è¿™ä¸¤ä¸ªç³»ç»Ÿçš„æ•°æ®çŠ¶æ€æ˜¯ä¸æ˜¯è¾¾åˆ°äº†ä¸€è‡´ï¼Ÿè¿™å°±æ˜¯æœ€ç»ˆä¸€è‡´æ€§çš„å«ä¹‰ã€‚ å¦‚æœè¦æ±‚æœåŠ¡ A å’ŒæœåŠ¡ B çš„æ•°æ®çŠ¶æ€ï¼Œåœ¨æœåŠ¡ A è¿”å›ç»™å®¢æˆ·ç«¯ä¹‹é—´ï¼Œè¿™ä¸¤è€…å°±è¾¾åˆ°ä¸€è‡´ï¼Œè¿™æ˜¯å¼ºä¸€è‡´æ€§ï¼ŒRocketMQ æ˜¯æ²¡æ³•ä¿è¯å¼ºä¸€è‡´æ€§çš„ã€‚ ç›®å‰é€šè¿‡ã€Œå¯é æ¶ˆæ¯æ¥ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€æ˜¯å¾ˆå¤šå¤§å‚éƒ½é‡‡ç”¨çš„æ–¹æ¡ˆï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ MQ å’Œè¡¥å¿æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ï¼ˆæ‰€è°“çš„å¯é æ¶ˆæ¯ï¼Œå°±æ˜¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œå¦‚ä½•ä¿è¯ MQ çš„æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œä¸‹ç¯‡æ–‡ç« ä¼šå†™ï¼Œè¿™ä¹Ÿæ˜¯é¢è¯•å¸¸è€ƒé¢˜ï¼‰ Q: æœåŠ¡ B æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ A: å¦‚æœæœåŠ¡ B æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥äº†ï¼Œå¯ä»¥è¿›è¡Œå¤šæ¬¡é‡è¯•ï¼Œç›´åˆ°æˆåŠŸã€‚å¦‚æœé‡è¯•å¤šæ¬¡åï¼Œè¿˜æ˜¯æäº¤å¤±è´¥ï¼Œä¾‹å¦‚æ­¤æ—¶æœåŠ¡ B å¯¹åº”çš„ DB å®•æœºäº†ï¼Œè¿™ä¸ªæ—¶å€™åªè¦æœåŠ¡ B ä¸å‘ MQ æäº¤æœ¬æ¬¡æ¶ˆæ¯çš„ offset å³å¯ã€‚å¦‚æœä¸æäº¤ offsetï¼Œé‚£ä¹ˆ MQ ä¼šåœ¨ä¸€å®šæ—¶é—´åï¼Œç»§ç»­å°†è¿™æ¡æ¶ˆæ¯æ¨é€ç»™æœåŠ¡ Bï¼ŒæœåŠ¡ B å°±å¯ä»¥ç»§ç»­æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶æäº¤äº†ï¼Œç›´åˆ°æˆåŠŸã€‚è¿™æ ·ï¼Œä¾æ—§æ˜¯ä¿è¯äº†æœåŠ¡ A å’ŒæœåŠ¡ B æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚ 3ã€Tã€æ•£åˆ—1ã€ä¹±æ‰“ é—®é¢˜ï¼šåº“å­˜ä¸ºå•¥åˆ†ä¸º é”å®šåº“å­˜ä»€ä¹ˆçš„ï¼Œæ²¡æœ‰è¿™ä¸ªé”å®šåº“å­˜çš„è¯ï¼ŒæŠ¢è´­æˆåŠŸï¼Œç›´æ¥å¯é”€å”®åº“å­˜ -1 ï¼Œå·²é”€å”®åº“å­˜ + 1 ä¸ä¹Ÿå¯ä»¥å˜›ï¼Œä¸ºå•¥redisçš„ç§’æ€äº§å“ å’Œ æ•°æ®åº“å•†å“è¡¨ï¼Œéƒ½è¦åŠ ä¸Šä»€ä¹ˆé”å®šåº“å­˜å‘¢ï¼Ÿ ç­”ï¼šåº“å­˜åˆ†ä¸ºé”å®šåº“å­˜å’Œå¯é”€å”®åº“å­˜çš„åŸå› æ˜¯ä¸ºäº†é¿å…è¶…å–å’Œé‡å¤é”€å”®çš„æƒ…å†µå‘ç”Ÿã€‚åœ¨ç§’æ€åœºæ™¯ä¸­ï¼Œç”±äºç”¨æˆ·çš„å¹¶å‘é‡éå¸¸é«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤šä¸ªç”¨æˆ·åŒæ—¶ä¸‹å•æˆåŠŸï¼Œä½†å®é™…ä¸Šåº“å­˜åªæœ‰ä¸€ä¸ªï¼Œå¦‚æœä¸åŠ é”å®šåº“å­˜çš„æœºåˆ¶ï¼Œå°±ä¼šå¯¼è‡´è¶…å–çš„æƒ…å†µã€‚è€Œä¸”ï¼Œåœ¨ç”¨æˆ·ä¸‹å•ä¹‹åï¼Œè®¢å•å¹¶ä¸ä¸€å®šä¼šç«‹å³æ”¯ä»˜ï¼Œå¦‚æœå°†å¯é”€å”®åº“å­˜å‡å»ï¼Œå°±æœ‰å¯èƒ½ä¼šå‡ºç°è®¢å•æœªæ”¯ä»˜ä½†åº“å­˜å·²è¢«æ‰£å‡çš„æƒ…å†µï¼Œè¿™ä¹Ÿæ˜¯éœ€è¦é”å®šåº“å­˜çš„åŸå› ã€‚æ‰€ä»¥ï¼Œåœ¨ç§’æ€åœºæ™¯ä¸­ï¼Œä¸ºäº†ä¿è¯åº“å­˜çš„æ­£ç¡®æ€§å’Œå”®åæœåŠ¡çš„è´¨é‡ï¼Œéœ€è¦å¯¹åº“å­˜è¿›è¡Œç»†åˆ†å’Œç®¡ç†ã€‚ é—®é¢˜ï¼šHystrix ä¸ºå•¥æ¯æ¬¡è¯·æ±‚éƒ½ç”¨è‡ªå·±çš„çº¿ç¨‹ ç­”ï¼šHystrix æ˜¯ä¸€ç§åŸºäºçº¿ç¨‹éš”ç¦»çš„æ–­è·¯å™¨æ¨¡å¼å®ç°ã€‚ä¸ºäº†å®ç°çº¿ç¨‹éš”ç¦»ï¼ŒHystrix ä¼šåœ¨æ¯ä¸ªè¢«ä¿æŠ¤çš„ä¾èµ–æœåŠ¡è°ƒç”¨ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ± ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šè¢«åˆ†é…åˆ°è¿™ä¸ªçº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå³ä½¿è¢«ä¿æŠ¤çš„ä¾èµ–æœåŠ¡è°ƒç”¨å‘ç”Ÿæ•…éšœæˆ–å»¶è¿Ÿï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–è¯·æ±‚çš„æ‰§è¡Œï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚ Hystrix è¿˜å¯ä»¥å¯¹æ¯ä¸ªçº¿ç¨‹æ± è¿›è¡Œé…ç½®ï¼Œæ¯”å¦‚å¯ä»¥è®¾ç½®çº¿ç¨‹æ± çš„å¤§å°ã€é˜Ÿåˆ—çš„å®¹é‡ç­‰å‚æ•°ï¼Œä»¥è¾¾åˆ°æ›´å¥½çš„èµ„æºåˆ©ç”¨å’Œè´Ÿè½½å‡è¡¡æ•ˆæœã€‚å› æ­¤ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä½¿ç”¨è‡ªå·±çš„çº¿ç¨‹ï¼Œå¯ä»¥æ›´å¥½åœ°å®ç°çº¿ç¨‹éš”ç¦»ï¼Œä¿éšœç³»ç»Ÿçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚ é—®é¢˜ï¼šåœ¨seataåˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶ä¸‹ï¼Œå¦‚æœä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡åˆ†è¡¨è°ƒç”¨Aã€Bã€CæœåŠ¡ï¼ŒAã€Bè°ƒç”¨æˆåŠŸï¼ŒCè°ƒç”¨å¤±è´¥ï¼Œè¿›è¡Œå›æ»šã€‚åœ¨å›æ»šçš„æ—¶å€™ï¼ŒAã€Bæœ‰æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“æŒä¹…åŒ–ï¼Ÿ ç­”ï¼šå…¶å®å·²ç»æˆåŠŸäº†ï¼Œä½†æ˜¯seataåº•å±‚è‡ªåŠ¨ç”Ÿæˆç”¨æ¥å›æ»šçš„sqlï¼ŒæŠŠä½ ä¹‹å‰æ‰§è¡Œçš„æ•°æ®åº“æ›´æ–°ï¼Œç»™åšä¸€ä¸ªåå‘æ“ä½œ é—®é¢˜ï¼šè¿™ä¸ªå¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ¶ˆæ¯é˜²ä¸¢å—ï¼Ÿé‚£RabbitMQä½¿ç”¨æ‰‹åŠ¨ACKä¹Ÿå¯ä»¥å®ç°æ¶ˆæ¯é˜²ä¸¢ï¼Œå› æ­¤RabbitMQä¹Ÿç®—æ˜¯èƒ½å®ç°å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§å—ï¼Ÿ æ€»æ„Ÿè§‰æˆ‘ç†è§£é”™äº†ã€‚ç­”ï¼šå¯¹çš„ï¼Œå…¶å®æ¯ä¸ªMQéƒ½æœ‰è‡ªå·±çš„åŠŸèƒ½ï¼Œå¾€åçœ‹ï¼Œå³ä½¿æ²¡æœ‰RocketMQï¼Œè‡ªå·±åšç‚¹å¼€å‘ï¼Œä¹Ÿèƒ½å®ç°ç±»ä¼¼çš„æ•ˆæœ é—®é¢˜ï¼šåŸºäºå†…å­˜åˆ†æ®µç”Ÿæˆè®¢å•å·æ–¹æ¡ˆæˆ‘è§‰å¾—ç¨å¾®å¤æ‚ä¸€äº›ï¼Œè€Œä¸”è¿˜éœ€è¦ä¾é æ•°æ®åº“ä¸­çš„è¡¨æ¥å¤„ç†max idï¼Œè¿™ç§å†…å­˜åˆ†æ®µçš„æ–¹æ¡ˆè·Ÿç›´æ¥ç”¨redisçš„incrç”Ÿæˆä¸€ä¸ªè‡ªå¢çš„æ•°å­—ç›¸æ¯”æœ‰ä»€ä¹ˆå¥½å¤„å—ï¼Œç›´æ¥ç”¨rediså¤„ç†æ›´ç®€å•ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿå¾ˆé«˜ ç­”ï¼šredisçš„æ“ä½œæ˜¯éœ€è¦å»å»ºç«‹ç½‘ç»œè¿æ¥çš„ï¼Œå†…å­˜æ“ä½œç›´æ¥åœ¨å†…å­˜ä¸­è·å–çš„ï¼Œæ€§èƒ½å¿«å¾ˆå¤š é—®é¢˜ï¼šè®¢å•å¼•å…¥çŠ¶æ€æœºåæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Œä¸ç”¨çš„è¯ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼ŸçŠ¶æ€æœºä¸ºä»€ä¹ˆè¦é€‰ç”¨squirrelæ¡†æ¶å‘¢ï¼Ÿç­”ï¼šè¿™æ ·çš„å¥½å¤„å°±æ˜¯å°†è®¢å•çŠ¶æ€æµè½¬å’Œå¯¹åº”çš„ä¸šåŠ¡å¤„ç†è§£è€¦ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå†æœ‰ä¸€å †ç¹æ‚çš„ ifâ€¦else æ“ä½œï¼Œæ¯å½“éœ€è¦æ–°çš„è®¢å•çŠ¶æ€æµè½¬æ“ä½œçš„æ—¶å€™ï¼Œå¯ä»¥å»ç¼–å†™å¯¹åº”çš„ä¸€å¥—operatorå’Œprocessorç»„ä»¶æ¥å®Œæˆï¼Œå’Œå·²æœ‰ä¸šåŠ¡çš„åˆ†ç¦»åº¦å¾ˆé«˜ã€‚squirrelæ¡†æ¶ é›†æˆç®€å•ä¸Šæ‰‹å¿«ï¼ŒåŠŸèƒ½å…¨é¢ é—®é¢˜ï¼šå•†å“è€ƒæ ¸æˆ‘è®¤ä¸ºå°±æ˜¯ï¼Œè¿è¥ä¼šé’ˆå¯¹çº¿ä¸Šå•†å“çš„ä¸€äº›é”€å”®æ•°æ®æƒ…å†µä½œåˆ†æï¼Œæ¯”å¦‚ä¸Šæ¶äº†ä¸€æ‰¹è–¯æ¡ï¼Œè¿™ä¸ªæœˆé”€é‡å¾ˆå¥½ï¼Œé‚£æˆ‘ä»¬å°±å¤šè¿›ç‚¹è´§ç‰©ï¼Œå°‘é‚£å°±å°‘è¿›ç‚¹ï¼Œä½†æ˜¯é’ˆå¯¹æµ·é‡çš„å•†å“ï¼Œä¹Ÿä¸èƒ½ä¸€ä¸ªä¸ªç»™è‚‰çœ¼å»å®¡æ ¸ï¼Œåœ¨å®¡æ ¸æ—¶å€™æœ‰é…ç½®æ¨¡ç‰ˆå•¥çš„ï¼Œå¼•å…¥å®¡æ ¸é…ç½®è§„åˆ™ï¼Œæ¯”å¦‚ä¸€ä¸ªé…ç½®æ¨¡ç‰ˆé‡Œè¾¹æœ‰å•†å“ID=ã€‹è§„åˆ™æ¨¡ç‰ˆè¿™æ ·çš„ã€‚ ä¸çŸ¥é“æˆ‘çš„ç†è§£å¯¹ä¸å¯¹? ç­”ï¼šæ‚¨çš„ç†è§£æ˜¯æ­£ç¡®çš„ã€‚å•†å“è€ƒæ ¸é€šå¸¸æ˜¯åŸºäºçº¿ä¸Šé”€å”®æ•°æ®å¯¹å•†å“è¿›è¡Œè¯„ä¼°å’Œåˆ†æï¼Œä»¥ä¾¿è¿è¥äººå‘˜åšå‡ºæ›´åŠ æ˜æ™ºçš„å†³ç­–ï¼Œæ¯”å¦‚è°ƒæ•´å•†å“çš„è¿›è´§é‡ã€ä»·æ ¼ç­‰ï¼Œä»¥æé«˜é”€å”®ä¸šç»©å’Œåˆ©æ¶¦ã€‚ å¯¹äºæµ·é‡å•†å“çš„è€ƒæ ¸ï¼Œæ‰‹å·¥å®¡æ ¸ç¡®å®æ˜¯ä¸åˆ‡å®é™…çš„ã€‚å› æ­¤ï¼Œå¯ä»¥å¼•å…¥è‡ªåŠ¨åŒ–çš„å®¡æ ¸é…ç½®è§„åˆ™ï¼Œè¿™äº›è§„åˆ™å¯ä»¥é€šè¿‡é…ç½®æ¨¡æ¿æ¥å®ç°ï¼Œæ¯”å¦‚åŸºäºå•†å“IDã€é”€å”®é¢ã€åº“å­˜ã€å”®åæœåŠ¡è´¨é‡ç­‰æŒ‡æ ‡æ¥è®¾è®¡è§„åˆ™ï¼Œä»è€Œæ›´åŠ é«˜æ•ˆåœ°è¿›è¡Œå•†å“è€ƒæ ¸ã€‚åœ¨å…·ä½“å®ç°è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æœºå™¨å­¦ä¹ å’Œæ•°æ®åˆ†ææŠ€æœ¯ï¼Œä»å¤§é‡æ•°æ®ä¸­æŒ–æ˜å‡ºæœ‰æ•ˆè§„å¾‹å’Œæ¨¡å¼ï¼Œæé«˜å•†å“è€ƒæ ¸çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚ é—®é¢˜ï¼šæäº¤è®¢å•ï¼Œä¼šå‘ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯ï¼Œå¦‚æœä¸€ç›´è®¢å•æœªæ”¯ä»˜ï¼Œåˆ°äº†è§¦å‘çš„æ—¶å€™ï¼Œæ°å¥½ç”¨æˆ·ç‚¹å‡»ä»˜æ¬¾äº†ï¼Œæ­¤æ—¶å¹¶å‘åŒæ—¶è¿‡æ¥ï¼Œæ˜¯ä¸æ˜¯è¦åœ¨æ”¯ä»˜å’Œå–æ¶ˆçš„æ—¶å€™éƒ½è¦åŠ åˆ†å¸ƒå¼é”ï¼Œé‚£å¦‚æœçœŸçš„æ­¤æ—¶å–æ¶ˆäº†ï¼Œæ˜¯ä¸æ˜¯åªèƒ½é€šçŸ¥ç”¨æˆ·ï¼Œè®¢å•å·²å–æ¶ˆï¼Œè¯·é‡æ–°ä¸‹å•å— ç­”ï¼šå¯¹äºè®¢å•æ”¯ä»˜çš„å»¶è¿Ÿæ¶ˆæ¯ï¼Œç¡®ä¿è®¢å•æ”¯ä»˜çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§æ˜¯éå¸¸é‡è¦çš„ã€‚åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§é€šå¸¸éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥é¿å…å†²çªã€‚åœ¨è®¢å•å–æ¶ˆçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é‡‡ç”¨å¼‚æ­¥é€šçŸ¥çš„æ–¹å¼å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå‘ŠçŸ¥è®¢å•å·²å–æ¶ˆï¼Œå¹¶æé†’ç”¨æˆ·é‡æ–°ä¸‹å•ã€‚åœ¨å®é™…å®ç°ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ç­‰æŠ€æœ¯æ¥å®ç°å»¶è¿Ÿæ¶ˆæ¯å’Œå¼‚æ­¥é€šçŸ¥ï¼Œä¿è¯è®¢å•æ”¯ä»˜çš„æ­£ç¡®æ€§å’Œç”¨æˆ·ä½“éªŒã€‚ é—®é¢˜ï¼šæˆ‘çœ‹å¥½å¤šä¹¦éƒ½å‚è€ƒ&lt;æ·±å…¥ç†è§£javaå†…å­˜æ¨¡å‹&gt;ä¸€ä¹¦å«äº†StoreStore, StoreLoad, LoadLoad, LoadStore, ä½†æ˜¯æˆ‘å‘ç°è¿˜æœ‰ä¸€ç§å«æ³•å«Release Barrier , Store Barrier, Acquire Barrier? è¿™ä¸¤ç§å«æ³•ä»¥ä»€ä¹ˆä¸ºåŸºå‡†å«çš„???å†…å­˜å±éšœæ˜¯æ€ä¹ˆåˆ†ç±»çš„ï¼Ÿï¼Ÿï¼Ÿ ç­”ï¼šå†…å­˜å±éšœæ˜¯æŒ‡åœ¨ç¼–ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œå®ƒèƒ½å¤Ÿç¡®ä¿åœ¨ç¨‹åºä¸­ç‰¹å®šä½ç½®å¤„çš„å†…å­˜æ“ä½œæŒ‰ç…§ç‰¹å®šé¡ºåºæ‰§è¡Œï¼Œä»è€Œä¿è¯äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å¯è§æ€§å’Œæœ‰åºæ€§ã€‚ åœ¨Javaå†…å­˜æ¨¡å‹ä¸­ï¼Œå†…å­˜å±éšœæŒ‰ç…§åŠŸèƒ½è¢«åˆ’åˆ†ä¸ºå››ç§ï¼šLoad Barrierï¼ˆè¯»å±éšœï¼‰ã€Store Barrierï¼ˆå†™å±éšœï¼‰ã€StoreLoad Barrierï¼ˆå†™-è¯»å±éšœï¼‰å’ŒLoadStore Barrierï¼ˆè¯»-å†™å±éšœï¼‰ã€‚è¿™äº›å±éšœçš„ä½œç”¨å¦‚ä¸‹ï¼š Load Barrierï¼ˆè¯»å±éšœï¼‰ï¼šå®ƒç”¨äºç¡®ä¿æŸä¸ªçº¿ç¨‹åœ¨è¯»å–æŸä¸ªå˜é‡æ—¶ï¼Œèƒ½å¤Ÿçœ‹åˆ°å…¶ä»–çº¿ç¨‹å¯¹è¯¥å˜é‡çš„æ›´æ–°ã€‚Store Barrierï¼ˆå†™å±éšœï¼‰ï¼šå®ƒç”¨äºç¡®ä¿æŸä¸ªçº¿ç¨‹åœ¨ä¿®æ”¹æŸä¸ªå˜é‡æ—¶ï¼Œå¯¹å…¶ä»–çº¿ç¨‹çš„ä¿®æ”¹å¯è§ã€‚StoreLoad Barrierï¼ˆå†™-è¯»å±éšœï¼‰ï¼šå®ƒç”¨äºç¡®ä¿æŸä¸ªçº¿ç¨‹åœ¨å†™å…¥æŸä¸ªå˜é‡åï¼Œä¹‹åè¯»å–è¯¥å˜é‡æ—¶ï¼Œèƒ½å¤Ÿçœ‹åˆ°å…¶ä»–çº¿ç¨‹åœ¨å†™å…¥è¯¥å˜é‡ä¹‹å‰çš„æ“ä½œã€‚LoadStore Barrierï¼ˆè¯»-å†™å±éšœï¼‰ï¼šå®ƒç”¨äºç¡®ä¿æŸä¸ªçº¿ç¨‹åœ¨è¯»å–æŸä¸ªå˜é‡æ—¶ï¼Œä¹‹å‰çš„å†™å…¥æ“ä½œå¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚å¦å¤–ï¼ŒRelease Barrier å’Œ Acquire Barrier æ˜¯ä¸€ç§æ›´é«˜å±‚æ¬¡çš„å†…å­˜å±éšœæ¦‚å¿µï¼Œå®ƒä»¬æ˜¯åŸºäºå‰é¢æåˆ°çš„å››ç§å†…å­˜å±éšœè€Œå®šä¹‰çš„ã€‚Release Barrier å’Œ Acquire Barrier åˆ†åˆ«ç”¨äºç¡®ä¿æŸä¸ªçº¿ç¨‹çš„å†™æ“ä½œå¯¹å…¶ä»–çº¿ç¨‹å¯è§å’Œç¡®ä¿æŸä¸ªçº¿ç¨‹çš„è¯»æ“ä½œçœ‹åˆ°å…¶ä»–çº¿ç¨‹çš„å†™æ“ä½œã€‚åœ¨Javaå†…å­˜æ¨¡å‹ä¸­ï¼ŒRelease Barrier å¯¹åº”çš„æ˜¯ Store Store Barrier å’Œ StoreLoad Barrierï¼Œè€Œ Acquire Barrier å¯¹åº”çš„æ˜¯ LoadLoad Barrier å’Œ LoadStore Barrierã€‚ å†…å­˜å±éšœçš„åˆ†ç±»æ˜¯æ ¹æ®å…¶åŠŸèƒ½ä¸åŒæ¥åˆ’åˆ†çš„ï¼Œè€Œ Release Barrier å’Œ Acquire Barrier åˆ™æ˜¯ä¸€ç§æ›´é«˜å±‚æ¬¡çš„æ¦‚å¿µï¼Œå®ƒä»¬æ˜¯åŸºäºå‰é¢æåˆ°çš„å››ç§å†…å­˜å±éšœè€Œå®šä¹‰çš„ã€‚ é—®é¢˜2ï¼šèƒ½ä¸èƒ½ä¸‹è®¢å•çš„æ—¶å€™ä¸æ¨mqï¼Œåœ¨ç”¨æˆ·æ”¯ä»˜çš„æˆåŠŸåå†å‘å…¶ä»–ç³»ç»Ÿæ¨é€mqæ¶ˆæ¯å‘¢?å¦‚æœå»¶è¿Ÿæ¨é€ï¼Œç”¨æˆ·åˆšä¸‹å•å°±æ”¯ä»˜äº†ï¼Œå²‚ä¸æ˜¯è¦ç­‰åŠä¸ªå°æ—¶ï¼Œæ‰èƒ½æ”¶åˆ°çº¢åŒ…ç³»ç»Ÿå‘çš„çº¢åŒ…? ç­”ï¼šè¿™æ˜¯ä¸¤æ¡æ¶ˆæ¯ï¼Œä¸€ä¸ªæ˜¯ä½ åˆ›å»ºè®¢å•äº†ï¼Œå®Œäº†æœ‰ä¸€ä¸ªè®¢å•åˆ›å»ºé€šçŸ¥ï¼Œä½ å¯ä»¥30åˆ†é’Ÿåæ¶ˆè´¹è¿™ä¸ªæ¶ˆæ¯ï¼Œåˆ¤æ–­ä½ çš„è®¢å•æ˜¯å¦å·²ç»è¶…è¿‡30åˆ†é’Ÿè¿˜æ²¡æ”¯ä»˜;å¦å¤–ä¸€ä¸ªæ˜¯å¦‚æœå·²ç»æ”¯ä»˜äº†ï¼Œæœ‰ä¸€ä¸ªè®¢å•æ”¯ä»˜çš„æ¶ˆæ¯ï¼Œç„¶åä½ å¾ˆå¤šç³»ç»Ÿå¯ä»¥æ¶ˆè´¹è¿™ä¸ªæ¶ˆæ¯ï¼Œåšåç»­çš„å¤„ç† 2ã€é—²èŠ1ã€ç¦»èŒåŸå›  è–ªèµ„ä¸€æ–¹é¢ï¼Œå…¶æ¬¡æ˜¯è§¦ç¢°æ›´å¤šçš„æ˜¯è¾¹ç¼˜æŠ€æœ¯ï¼Œèƒ½æˆé•¿çš„ç©ºé—´æœ‰é™ è™½è¯´èƒ½ç¢°åˆ°ä¸€äº›æ ¸å¿ƒæŠ€æœ¯ï¼Œä½†æ˜¯æˆé•¿ä¹Ÿæ¯”è¾ƒç¼“æ…¢ï¼Œä¸æ˜¯é•¿ä¹…ä¹‹ç­– èˆ’é€‚åœˆå¾…ä¹…äº†ï¼Œæœ‰äº›è¿«åˆ‡çš„å±æœºæ„Ÿï¼Œ æœ›å¾—åˆ°æ›´å¤šçš„æŒ‘æˆ˜å’Œå­¦ä¹ æœºä¼š 2ã€å‚è€ƒ â†“MySQL æ‰§è¡Œæµç¨‹ :https://blog.csdn.net/qwer123451234123/article/details/124344299 æ•°æ®ç»“æ„å¯è§†åŒ–æ¼”å˜ï¼š https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html B+Treeæ—¶é—´å¤æ‚åº¦ï¼šhttps://blog.csdn.net/yunduanyou/article/details/128233801 1.8æµæ“ä½œé¢˜ï¼šhttps://blog.csdn.net/Thinkingcao/article/details/108664921 MySQLä¸­çš„èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ï¼šhttps://www.jb51.net/article/251419.htm MySQLå­˜å‚¨å¼•æ“ï¼šhttps://blog.csdn.net/promsing/article/details/126157969 MySQLè¦†ç›–ç´¢å¼•ä¸ºä»€ä¹ˆä¸ç”¨å›è¡¨ï¼šhttps://blog.csdn.net/muwenbofx/article/details/123259858 æ…¢SQLè§£å†³ï¼š https://www.qycn.com/xzx/article/9300.html https://baijiahao.baidu.com/s?id=1746620518356199899&amp;wfr=spider&amp;for=pc Mysqläº‹åŠ¡é”é¢åŸºï¼šhttps://blog.csdn.net/weixin_43889788/article/details/128416743 SpringCloudä¸Dubboçš„åŒºåˆ«ï¼šhttps://blog.csdn.net/weixin_51291483/article/details/109212137/ CNDåŠ é€Ÿï¼šhttps://www.likecs.com/show-204294177.html#sc=1128ç§’æ€è®¾è®¡ï¼šhttps://blog.csdn.net/weixin_42405670/article/details/118138802seata é¢è¯•é¢˜ï¼šç®€å•ç‰ˆï¼šhttps://zhuanlan.zhihu.com/p/470281769å®Œæ•´ç‰ˆï¼šhttps://www.cnblogs.com/crazymakercircle/p/14375424.html#autoid-h4-6-3-0 Seataçš„å››ç§æ¨¡å¼ï¼š https://blog.csdn.net/wuyongde_0922/article/details/125333625 https://blog.csdn.net/m0_58600248/article/details/126271252 Spring é¢è¯•é¢˜ï¼šhttps://zhuanlan.zhihu.com/p/469797333MQé¢è¯•é¢˜ï¼šhttps://zhuanlan.zhihu.com/p/470984789 RocketMQäº‹åŠ¡æ¶ˆæ¯å¦‚ä½•ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼šhttps://blog.csdn.net/qq_42093488/article/details/114677515 ä¸ƒç§åˆ†å¸ƒå¼äº‹åŠ¡å®ç°ï¼šhttps://blog.csdn.net/qq_36963950/article/details/108909780 redisæ•°æ®ç»“æ„ï¼šhttps://blog.csdn.net/mz474920631/article/details/125200050 TCCè½åœ°æ–‡ç« ï¼ˆæœ‰åˆé›†ï¼‰ï¼šhttps://blog.csdn.net/weixin_44102992/article/details/126493034?spm=1001.2014.3001.5501 TCCå’ŒRocketMQåšåˆ†å¸ƒå¼äº‹åŠ¡åŒºåˆ«ï¼šhttps://zhuanlan.zhihu.com/p/183753774 redisä¹‹å¦‚ä½•å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼šhttps://blog.csdn.net/wang0907/article/details/127830591 åˆ†å¸ƒå¼äº‹åŠ¡å››ç§æ–¹æ¡ˆå’Œå¯¹æ¯”ï¼šhttps://www.cnblogs.com/muxilaoshi/p/15429404.html seata ATå’ŒXAçš„åŒºåˆ«ï¼šhttps://www.51cto.com/article/659139.html?u_atoken=908e9399-a703-4278-8438-3e2639de1e42&amp;u_asession=01cbB_xA5flpNlOFMXMMxwrHuPaiY7SlcCklCBZ6cSuxieaFEySACzsRygqqIcFf6yX0KNBwm7Lovlpxjd_P_q4JsKWYrT3W_NKPr8w6oU7K8PYmybX1Fb1-mAlyDPgbs_DvUNWlpfeCH_Z_6FnnXEnGBkFo3NEHBv0PZUm6pbxQU&amp;u_asig=05H6c_C18NzGqylFOgxYxOfyO9v0KX11HhF9UNuVuWDyDEKZsyCCsmlvOm93IX5QObFbfUNqdn8aQG1mI6aOKSs4Teqnna915rPIdR1R6vLUber5juuaXtMV73tq6jjhUPwNFoYr3TWz60hy4MRDOTCYy74sE94reA3i6Bm9SeXcv9JS7q8ZD7Xtz2Ly-b0kmuyAKRFSVJkkdwVUnyHAIJzdFdm6FtdJ6etcsGdFNqcU7WcMYF5aSO9Hw4ju-PP021VSW66CuWlZZ6ywL2zPMFnu3h9VXwMyh6PgyDIVSG1W8kCUCcLCVBKZk4XCs8ybF9IwNOrpX04BxodSt1A8Jz_TYwAep73xlDlF8jhaGyXHfBkISeMFkkfFA1VnMgsMutmWspDxyAEEo4kbsryBKb9Q&amp;u_aref=djAEUQI%2FtZgGE8x5s2Rr8%2BQuQKg%3D é‡‘èé¡¹ç›®seataè¯´æ˜ï¼šhttps://zhuanlan.zhihu.com/p/499041496 æ¥å£å¹‚ç­‰æ€§æ ¡éªŒå®ç°ï¼šhttps://blog.csdn.net/huchao_lingo/article/details/105540418 æ¶ˆæ¯é˜Ÿåˆ—çš„å¯é æ€§ï¼šhttps://blog.csdn.net/m0_73859807/article/details/128861716 å­—èŠ‚è·³åŠ¨ï¼Œé«˜å¯ç”¨ã€ä¸é‡å¤æ¶ˆè´¹ã€å¯é ä¼ è¾“ã€é¡ºåºæ¶ˆè´¹ã€æ¶ˆæ¯å †ç§¯ï¼šhttps://www.cnblogs.com/binghe001/p/14443360.html ç«™é•¿ç®€ä¹¦ï¼šhttps://www.jianshu.com/p/2e995df9ccbc Redisé¢è¯•é¢˜ï¼š https://zhuanlan.zhihu.com/p/567047691 https://www.cnblogs.com/javazhiyin/p/13839357.html Redisç¼“å­˜ä¸€è‡´æ€§ï¼šhttps://blog.csdn.net/a745233700/article/details/88081219 hystrixä¸­ä¿¡å·é‡å’Œçº¿ç¨‹æ± ï¼šhttps://www.cnblogs.com/chihirotan/p/11368520.html nacosé¢è¯•ç­‰å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/482632893 eureka: https://blog.csdn.net/lyc_liyanchao/article/details/120060221 https://blog.csdn.net/weixin_48227718/article/details/125620401 zookeeper: https://blog.csdn.net/weixin_43495317/article/details/123142595 https://blog.51cto.com/u_15127568/2713356 seataåŸç†ï¼š https://blog.csdn.net/qq_14996421/article/details/125706271 redisåŸå­æ€§ä¿è¯ï¼šhttps://blog.csdn.net/u013277209/article/details/126274656 binlogã€redologã€undologï¼šhttps://zhuanlan.zhihu.com/p/474218953 FlinkCDC and ETL :https://blog.csdn.net/YiRan_Zhao/article/details/126946412 ã€ç²¾ã€‘Seataå››ç§æ¨¡å¼å’ŒåŸç†ï¼ˆå…¨ï¼‰ï¼šhttp://www.360doc.com/content/22/0902/20/78411425_1046313419.shtmlã€ç²¾ã€‘Seata ATæ¨¡å¼ä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼šhttps://www.cnblogs.com/ciel717/p/16190760.htmlã€ç²¾ã€‘åˆ†å¸ƒå¼äº‹åŠ¡å…¨è§£ï¼šhttps://www.cnblogs.com/ciel717/p/16190481.html binlogè¯¦è§£ï¼šhttps://blog.csdn.net/m0_73311735/article/details/127935751 Redis6 IOå¤šè·¯å¤ç”¨+å¤šçº¿ç¨‹ï¼šhttps://blog.csdn.net/weixin_39724194/article/details/128660990 seataæ¡ˆä¾‹ï¼Œsagaåº”ç”¨åœºæ™¯ï¼šhttps://www.cnblogs.com/yizhiamumu/p/16809386.html å¹¶å‘çº¿ç¨‹æ•°ã€QPSä¸å¹³å‡è€—æ—¶çš„å…³ç³»ï¼šhttps://cloud.tencent.com/developer/article/1784548?ivk_sa=1024320u æ­£å‘ä»£ç†å’Œæ–¹å‘ä»£ç†ï¼šhttps://baijiahao.baidu.com/s?id=1756527779282578683&amp;wfr=spider&amp;for=pc flinké¢è¯•é¢˜ï¼š https://cloud.tencent.com/developer/article/1892515 https://blog.csdn.net/sinat_23225111/article/details/124495260 jvmçš„ç»„æˆï¼šhttps://blog.csdn.net/m0_71777195/article/details/126247090 åˆ†æclassloader:https://www.cnblogs.com/guanbin-529/p/12944953.html åŒäº²å§”æ´¾æœºåˆ¶ï¼šhttps://blog.csdn.net/huanglu0314/article/details/122967809 ã€ç²¾ã€‘ä¸‰ç ´åŒäº²å§”æ´¾ï¼šhttps://www.bookinput.com/display?id=1633457968414498816 jvmè°ƒä¼˜å·¥å…·ï¼šhttps://zhuanlan.zhihu.com/p/628011411 arthasï¼šhttps://blog.csdn.net/Facial_Mask/article/details/126042839","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://mykkto.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://mykkto.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"jvm","slug":"jvm","permalink":"https://mykkto.github.io/tags/jvm/"}],"author":"mykk"},{"title":"JUC-æ·±åº¦é¢è¯•é¢˜ï¼ˆç²‰ä¸æŠ•ç¨¿ï¼‰","slug":"22-ä¸“æ /yjc/yjc01-2022 JUC é¢è¯•å¤ç›˜","date":"2023-01-04T12:39:21.000Z","updated":"2023-06-11T02:53:45.125Z","comments":true,"path":"posts/ee9ed7cb.html","link":"","permalink":"https://mykkto.github.io/posts/ee9ed7cb.html","excerpt":"","text":"2022 JUC å¤ç›˜å¤§çº²ç›®å½•[TOC] ComlpetableFutuerå›é¡¾Future1future æ¥å£å°±æ˜¯å®šä¹‰æ“ä½œä¸€æ­¥æ‰§è¡Œä¸€äº›æ–¹æ³•ï¼Œå¦‚è·å¾—å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚å–æ¶ˆä»»åŠ¡çš„æ‰§è¡Œï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å–æ¶ˆï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ã€‚2 å®ƒå…·ä½“å®ç°æ˜¯FutureTask ,å®ƒåŒæ—¶å®ç°äº† Runnable å’ŒFuture æ¥å£ ã€‚é€šè¿‡å®ƒæ„é€ æ–¹æ³•æ–¹æ³•å¯ä»¥ä¼ å…¥ callable å’Œrunnable å…·ä½“å®ç°ç±»ã€‚3 ç»“è®ºå°±æ˜¯ é€šè¿‡futuretask æ¥å¯ä»¥ç°å®æ€§å¤šçº¿ç¨‹çš„å¼‚æ­¥ä»»åŠ¡ã€‚4 futuretask ç»“åˆçº¿ç¨‹æ± æä¾›æ•ˆç‡5futuretask ç¼ºç‚¹ï¼š 1å¦‚æœè€—æ—¶å¾ˆä¹…çš„å¼‚æ­¥å­çº¿ç¨‹å¤„ç†å®Œæˆä¹‹å ï¼Œå†å»è°ƒç”¨ getæ–¹æ³•è·å–è®¡ç®—ä»»åŠ¡ç¨‹åºä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œåä¹‹å°±ä¼šå¯¼è‡´ä¹‹çº¿ç¨‹é˜»å¡ã€‚2isDone æ–¹æ³• è½®è¯¢å®¹æ˜“å¯¼è‡´cpuç©ºè½¬ è€—æŸå¯¼è‡´æ›´å¤šèµ„æºå ç”¨ã€‚6é’ˆå¯¹futuretask çš„æ”¹è¿›ä¸éœ€é€šè¿‡è½®è¯¢çš„æ–¹å¼çš„åˆ¤æ–­çš„çº¿ç¨‹ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œé€šè¿‡å›è°ƒé€šçŸ¥å‡½æ•°ã€‚å¼‚æ­¥ä»»åŠ¡çš„æ­¥éª¤ä¸Šçš„ä¾èµ–ï¼ˆä¸Šä¸€ä¸ªæ­¥éª¤æ—¶ä¸‹ä¸ªæ­¥éª¤çš„å‰æï¼‰è¿™å°±CompletableFutrureå‡ºæ¥çš„ä¼ç¬”ã€‚==è€ƒç‚¹ CompletableFutuer è°ƒç”¨ runAsync supplyAsync ç­‰é™æ€æ–¹æ³•ä¼ å…¥ä¸€ä¸ªå‚æ•°æ—¶å€™ï¼Œå®ƒçš„çº¿ç¨‹æ± æ˜¯ä»€ä¹ˆï¼Ÿ==åœ¨è°ƒç”¨CompletableFutuer é™æ€æ–¹æ³•é»˜è®¤ä¸ä¼ å…¥çº¿ç¨‹æ± çš„å‚æ•°æ—¶å€™ï¼ŒCompletableFutuer çš„ForkJoinpool ã€‚codeExecutorService pool = Executors.newFixedThreadPool(3); try{ CompletableFuture.supplyAsync(()-&gt;{ try{TimeUnit.SECONDS.sleep(1);}catch(InterruptedException e){} System.out.println(Thread.currentThread().getName()+\"come in\"); int ruset = ThreadLocalRandom.current().nextInt(10); return ruset; },pool).whenComplete((v,e) -&gt;{ if (e==null ){//æ— å¼‚å¸¸æƒ…å†µ System.out.println(\"ä¸Šéƒ¨çš„è®¡ç®—ç»“æœæ—¶\"+v); } }).exceptionally(e -&gt;{ e.printStackTrace(); System.out.println(\"å¼‚å¸¸æƒ…å†µæ˜¯\"); return null; }); System.out.println(\"ä¸»è¦çº¿ç¨‹å¿™å…¶ä»–ä»»åŠ¡å»äº†\"); }catch(Exception e){ e.printStackTrace(); } finally { pool.shutdown();//å…³é—­çº¿ç¨‹æ±  } ==è€ƒç‚¹ CompletableFuture ç§æ–¹æ³•get å’Œjoin ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«==get æ–¹æ³•éœ€è¦å£°æ˜æŠ›å¼‚å¸¸ï¼ŒäºŒjoin ä¸éœ€è¦ getNowæ˜¯åˆ¤æ–­çº¿ç¨‹ä»»åŠ¡æ˜¯æ˜¯å¦å®Œæˆï¼Œå¦‚æœå®Œæˆå°±è¿”å›å®Œæˆçš„çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰å°±è¿”å›getNowçš„å‚æ•°çš„çš„å€¼ï¼ŒHandleè¿™ä¸ªæ–¹æ³•å¯ä»¥è·å¾—æ­£å¸¸å’Œå¼‚å¸¸çš„å‚æ•°ç»“æœã€‚==è€ƒç‚¹ CompletableFuture æ˜¯å¦éƒ½ä¸€ç›´è°ƒç”¨é»˜è®¤çš„çº¿ç¨‹æ± å—ï¼ŒthenApply å’ŒthenApplyAsyncè¿™ä¸¤ä¸ªæ–¹æ³•æœ‰å•¥å´åˆ«==å¦‚æœæœ‰ä¼ å…¥è‡ªå®šä¹‰çš„çº¿ç¨‹æ± å°±æŒ‰ç…§ä¼ å…¥çº¿ç¨‹æ‰§è¡Œï¼Œå½“è°ƒ ThenRun æ–¹æ³•æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶å€™ï¼Œåˆ™ç¬¬äºŒä¸ªä»»åŠ¡å’Œç¬¬ä¸€ä¸ªä»»åŠ¡å…±ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå½“è°ƒç”¨ThenRunAsync æ—¶å€™æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶å€™ï¼Œåˆ™ç¬¬ä¸€ä»»åŠ¡ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹æ± ï¼Œä»ç¬¬äºŒä¸ªä»»åŠ¡å¼€å§‹ä½¿ç”¨çš„å°±æ˜¯ForkJoin çº¿ç¨‹æ± ã€‚==è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ å¦‚æœmian çº¿ç¨‹æ‰§è¡Œï¼Œé‚£ä¹ˆåç»­éƒ½ç”±mainçº¿ç¨‹æ‰§è¡Œä¸ä¼šåˆ‡æ¢çº¿ç¨‹æ± ã€‚ç³»ç»Ÿä¼˜åŒ–åŸåˆ™å‡å°‘åˆ‡æ¢ï¼Œmain çº¿ç¨‹æ‰§è¡Œæ•ˆç‡å¤ªå¿«==public class CompleateFutureAPIDome { public static void main(String[] args) { ExecutorService pool = Executors.newFixedThreadPool(3);//è‡ªå®šä¹‰çº¿ç¨‹æ±  CompletableFuture.supplyAsync(()-&gt;{ try{ TimeUnit.SECONDS.sleep(1);}catch(InterruptedException e){} System.out.println(Thread.currentThread().getName()); System.out.println(\"1111\"); return 1; },pool).thenApply(f -&gt;{ System.out.println(Thread.currentThread().getName()); //å½“å‰çº¿ç¨‹æ± æ˜¯pool System.out.println(\"222\"); return 2; }).thenApplyAsync(f -&gt;{//è¿™ä¸ªä¹‹åéƒ½æ˜¯é»˜è®¤çº¿ç¨‹æ±  System.out.println(Thread.currentThread().getName());//å½“å‰çº¿ç¨‹æ± æ˜¯ ForkJoin çº¿ç¨‹æ±  System.out.println(\"333\"); return 3; }).whenComplete((v,e) -&gt;{ if (e==null){ System.out.println(\"æ‰“å°å‡ºæ¥æ˜¯\"+v ); } }).exceptionally(e -&gt;{ e.printStackTrace(); return null; }); pool.shutdown(); } } Java é”çš„å“ªäº›äº‹==ä½•ä¸ºæ‚²è§‚é”ä½•ä¸ºä¹è§‚é”==æ‚²è§‚é”æ¦‚å¿µï¼šå¤§ç™½è¯çš„ï¼Œçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡å…¶ä»–çº¿ç¨‹ä¸€å®šä¼šå’Œå®ƒæŠ¢èµ„æºï¼Œå› æ­¤åœ¨è·å–æ•°æ®ä¹‹å‰ä¸€å®šæ˜¯åŠ ä¸€æŠŠé”ï¼Œç¡®ä¿æ•°æ®å®‰å…¨æ²¡æœ‰èƒŒä¿®æ”¹è¿‡ã€‚è§„åˆ™æ˜¯å…ˆåŠ é”ã€‚ä¹è§‚é”çš„æ¦‚å¿µï¼šçº¿ç¨‹æ‰§è¡Œçš„æ—¶å€™è®¤ä¸ºä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹å’Œå®ƒæŠ¢å èµ„æºï¼ˆå…¶ä»–çº¿ç¨‹ä¸ä¼šä¿®æ”¹æ•°æ®ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šåŠ é”ã€‚è§„åˆ™ä¸ä¼šåŠ é”ï¼Œä½†æ˜¯é€šè¿‡ç‰ˆæœ¬å¥½çš„è¿­ä»£æˆ–è€…CAS è‡ªæ—‹æ¥åˆ¤æ–­ã€‚ï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢çš„çŠ¶æ€ï¼‰==æ ¹æ®8 é”ç”¨ä¾‹åœºæ™¯æ€»ç»“==å½“å¯¹è±¡åŒæ—¶å¤šä¸ªsynchronzied æ–¹æ³•ï¼Œå½“æŸä¸€æ—¶åˆ»å†…ï¼Œåªè¦ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨å…¶ä¸­çš„ä¸€ä¸ªsynchronzied æ–¹æ³• å…¶ä»–çº¿éƒ½è¦ç­‰å¾…å®ƒæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œã€‚é”æ˜¯å½“å‰å¯¹è±¡this å› ä¸ºå¯¹è±¡æ˜¯jvm å †é‡Œé¢å½“æ²¡æœ‰äº§ç”Ÿç«äº‰æ—¶å€™ï¼Œå„è‡ªæ‹¿è‡ªå·±é”çš„æ‰§è¡Œã€‚static sychronzied é”çš„æ˜¯å½“å‰ ç±»å‹æ¨¡æ¿ã€‚class (ç±»é”) jvm çš„æ–¹æ³•åŒºé‡Œé¢ åªæœ‰å”¯ä¸€ ä¸€ä¸ªå¯¹ åŒæ­¥ä»£ç å— é”çš„ sychronzied æ‹¬å·çš„å¯¹è±¡==æ€»ä¹‹æ ¹æ®é”ä¸åŒï¼Œåˆ†ææ˜¯å¯¹è±¡é”è¿˜æ˜¯ï¼Œç±»é”ï¼Œæˆ–è€…åŒæ­¥ä»£ç å—ï¼Œå¦‚æœä¸åŒé”ï¼Œä¸é‚£ä¹ˆä¸ä¼šæœ‰ç«äº‰å…³ç³»ï¼Œå„è‡ªæ‰§è¡Œå„è‡ªäº’ä¸ç›¸å¹²æ‰°ï¼Œä½¿ç”¨é”çš„åŸåˆ™ç”¨æ— é”å°½é‡ï¼Œå®åœ¨ä¸è¡Œå°±åŒä»£ç å—ï¼Œåœ¨ä¸è¡Œä½¿ç”¨å¯¹è±¡ ï¼Œæœ€åæ‰è€ƒè™‘ç±»é”ã€‚é”ç²’åº¦å¤§å°æ’åº åˆ°å¤§ æ— é” &lt; åŒæ­¥ä»£ç å— &lt; å¯¹è±¡é” &lt; ç±»é”====åŒæ­¥ä»£ç  åç¼–è¯‘çœ‹ æ˜¯ç”¨ javap -c æŸ¥çœ‹ åº•å±‚sychronized morritorenter å’Œmonitorexit,ä½†ä¸ºå•¥ä¼šä¸¤ä¸ª monitorexit==æ˜¯å”¯ä¸€æ­£å¸¸æƒ…å†µè·å¾—æ‰§è¡Œå®Œæ¯•é‡Šæ”¾é”ï¼Œä½†è¦å¼‚å¸¸æƒ…å†µä¹Ÿå¯ä»¥é‡Šæ”¾é”ã€‚æ‰€ä»¥åŠ ä¸¤ä¸ªçš„ monitorexitï¼ŒäºŒå¯¹è±¡é”å’Œç±»å‹ å®ƒä»¬åç¼–è¯‘ä¹‹åå¯ä»¥çœ‹ ACC_SYCHRONIZED ,ä»¥åŠç±»é”==å…¬å¹³é” å’Œéå…¬å¹³é”==å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œç±»ä¼¼äºæ’é˜Ÿä¹°é¥­ï¼Œå…ˆæ¥ååˆ°ï¼Œå…ˆæ¥å…ˆæœåŠ¡ï¼Œå°±æ˜¯å…¬å¹³çš„ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—éå…¬å¹³é” æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹ä¸ä¼š æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œæœ‰çš„é” æ’é˜Ÿï¼Œè€Œä¸”æ’é˜Ÿæ‰§è¡Œä¹‹åï¼Œå¯èƒ½ä¼šç»§ç»­å†æ¥æ’é˜Ÿåˆæ’é˜Ÿç›¸æ¯”å…¶ä»–çº¿ç¨‹ä¸å…¬å¹³çš„æŠ¢å¤ºcpuèµ„æºçš„ã€‚==ä¸ºå•¥é»˜è®¤æ˜¯éå…¬å¹³çš„ï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™ç”¨å…¬å¹³ä»€ä¹ˆæ—¶å€™ç”¨éå…¬å¹³==é¦–å…ˆé»˜è®¤ä½¿ç”¨éå…¬å¹³çš„æ—¶å€™ï¼Œç³»ç»Ÿå‡å°‘çº¿ç¨‹åˆ‡æ¢æ¬¡æ•°ã€‚æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå¯¹äºä½•ä¸ºä½¿ç”¨å…¬å¹³å’Œéå…¬å¹³çš„ã€‚é‚£æ ¹æ®å…·ä½“ä¸šåŠ¡å…·ä½“åˆ†æä¾‹å¦‚åŒ»é™¢æŒ‚å·çš„å¯ä»¥ä½¿ç”¨å…¬å¹³ä¿è¯æ²¡æœ‰æ¯ä¸ªäººéƒ½è¢«å«åˆ°ï¼Œéå…¬å¹³ä¾‹å¦‚ç­‰çº¢ç»¿ç¯æ—¶å€™ä¸»å¹²é“çš„è½¦è¾†æ¯”è¾ƒå¤šï¼Œéœ€è¦æ”¾è¡Œè½¦è¾†æ¬¡æ•°å¤šï¼Œæ¬¡è¦å¹²é“è½¦æµå°‘ã€‚ç”šè‡³æ²¡æœ‰è½¦ã€‚æ‰€ä»¥ä½¿ç”¨éå…¬å¹³è®©äº¤é€šæµç•…==åå‘é”==åå‘é”:å•çº¿ç¨‹ç«äº‰å½“çº¿ç¨‹Aç¬¬ä¸€æ¬¡ç«äº‰åˆ°é”æ—¶ï¼Œé€šè¿‡æ“ä½œä¿®æ”¹Mark Wordä¸­çš„åå‘çº¿ç¨‹IDã€åå‘æ¨¡å¼å¦‚æœä¸å­˜åœ¨å…¶ä»–çº¿ç¨‹ç«äº‰ï¼Œé‚£ä¹ˆæŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚ï¼ˆ==å‡å°‘ç”¨æˆ·æ€å†…æ ¸æ€åˆ‡æ¢==ï¼‰ä½œç”¨ï¼š å½“ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è®¿é—®ï¼Œç”±äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹é‚£å¹ºè¯¥çº¿ç¨‹åœ¨åç»­è®¿é—®æ—¶ä¾¿ä¼šè‡ªåŠ¨è·å¾—é”ã€‚ç†è®ºè½åœ° åœ¨å®é™…åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç°ï¼Œâ€œé”æ€»æ˜¯åŒä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œå¾ˆå°‘å‘ç”Ÿç«äº‰â€ï¼Œä¹Ÿå°±æ˜¯è¯´é”æ€»æ˜¯è¢«ç¬¬ä¸€ä¸ªå ç”¨ä»–çš„çº¿ç¨‹æ‹¥æœ‰ï¼Œè¿™ä¸ªçº¿ç¨‹å°±æ˜¯é”çš„åå‘çº¿ç¨‹ã€‚ é‚£ä¹ˆåªéœ€è¦åœ¨é”ç¬¬ä¸€æ¬¡è¢«æ‹¥æœ‰çš„æ—¶å€™ï¼Œè®°å½•ä¸‹åå‘çº¿ç¨‹IDã€‚è¿™æ ·åå‘çº¿ç¨‹å°±ä¸€ç›´æŒæœ‰ç€é”(åç»­è¿™ä¸ªçº¿ç¨‹è¿›å…¥å’Œé€€å‡ºè¿™æ®µåŠ äº†åŒæ­¥é”çš„ä»£ç å—æ—¶ï¼Œä¸éœ€è¦å†æ¬¡åŠ é”å’Œé‡Šæ”¾é”ã€‚è€Œæ˜¯ç›´æ¥ä¼šå»æ£€æŸ¥é”çš„MarkWordé‡Œé¢æ˜¯ä¸æ˜¯æ”¾çš„è‡ªå·±çš„çº¿ç¨‹ID)ã€‚å¦‚æœç›¸ç­‰ï¼Œè¡¨ç¤ºåå‘é”æ˜¯åå‘äºå½“å‰çº¿ç¨‹çš„ï¼Œå°±ä¸éœ€è¦å†å°è¯•è·å¾—é”äº†ï¼Œç›´åˆ°ç«äº‰å‘ç”Ÿæ‰é‡Šæ”¾é”ã€‚ä»¥åæ¯æ¬¡åŒæ­¥ï¼Œæ£€æŸ¥é”çš„åå‘çº¿ç¨‹Dä¸å½“å‰çº¿ç¨‹IDæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ç›´æ¥è¿›å…¥åŒæ­¥ã€‚æ— éœ€æ¯æ¬¡åŠ é”è§£é”éƒ½å»CASæ›´æ–°å¯¹è±¡å¤´ã€‚å¦‚æœè‡ªå§‹è‡³ç»ˆä½¿ç”¨é”çš„çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œå¾ˆæ˜æ˜¾åå‘é”å‡ ä¹æ²¡æœ‰é¢å¤–å¼€é”€ï¼Œæ€§èƒ½æé«˜ã€‚ å¦‚æœä¸ç­‰ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†ç«äº‰ï¼Œé”å·²ç»ä¸æ˜¯æ€»æ˜¯åå‘äºåŒä¸€ä¸ªçº¿ç¨‹äº†ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå°è¯•ä½¿ç”¨CASæ¥æ›¿æ¢MarkWordé‡Œé¢çš„çº¿ç¨‹IDä¸ºæ–°çº¿ç¨‹çš„IDï¼Œ ç«äº‰æˆåŠŸï¼Œè¡¨ç¤ºä¹‹å‰çš„çº¿ç¨‹ä¸å­˜åœ¨äº†ï¼Œ Markwordé‡Œé¢çš„çº¿ç¨‹IDä¸ºæ–°çº¿ç¨‹çš„IDï¼Œé”ä¸ä¼šå‡çº§ï¼Œä»ç„¶ä¸ºåå‘é”ï¼Œç«äº‰å¤±è´¥ï¼Œè¿™æ—¶å€™å¯èƒ½éœ€è¦å‡çº§å˜ä¸ºè½»é‡çº§é”ï¼Œæ‰èƒ½ä¿è¯çº¿ç¨‹é—´å…¬å¹³ç«äº‰é”ã€‚æ³¨æ„ï¼Œåå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹æ˜¯ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”çš„ã€‚æŠ€æœ¯å®ç°: æŠ€æœ¯å®ç°ï¼šä¸€ä¸ªsynchronizedæ–¹æ³•è¢«ä¸€ä¸ªçº¿ç¨‹æŠ¢åˆ°äº†é”æ—¶ï¼Œé‚£è¿™ä¸ªæ–¹æ³•æ‰€åœ¨çš„å¯¹è±¡å°±ä¼šåœ¨å…¶æ‰€åœ¨çš„Mak Wordä¸­å°†åå‘é”ä¿®æ”¹çŠ¶æ€ä½ï¼ŒåŒæ—¶è¿˜ä¼šæœ‰å ç”¨å‰54ä½æ¥å­˜å‚¨çº¿ç¨‹æŒ‡é’ˆä½œä¸ºæ ‡è¯†ã€‚è‹¥è¯¥çº¿ç¨‹å†æ¬¡è®¿é—®åŒä¸€ä¸ªsynchronizedæ–¹æ³•æ—¶ï¼Œè¯¥çº¿ç¨‹åªéœ€å»å¯¹è±¡å¤´çš„Mark Word ä¸­å»åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æœ‰åå‘é”æŒ‡å‘æœ¬èº«çš„IDï¼Œæ— éœ€å†è¿›å…¥ Monitor å»ç«äº‰å¯¹è±¡äº†ã€‚ ==è½»é‡é”==å®šä¹‰ï¼šå¤šçº¿ç¨‹ç«äº‰ï¼Œä½†æ˜¯ä»»æ„æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹ç«äº‰ï¼Œå³ä¸å­˜åœ¨é”ç«äº‰å¤ªè¿‡æ¿€çƒˆçš„æƒ…å†µï¼Œä¹Ÿå°±æ²¡æœ‰çº¿ç¨‹é˜»å¯¨ã€‚ä½œç”¨ï¼šæœ‰çº¿ç¨‹æ¥å‚ä¸é”çš„ç«äº‰ï¼Œä½†æ˜¯è·å–é”çš„å†²çªæ—¶é—´æçŸ­æœ¬è´¨å°±æ˜¯è‡ªæ—‹é”CAS==é‡é‡çº§é”==é‡é‡çº§é”åŸç†æŒ‡å‘äº’æ–¥é‡ (é‡é‡çº§é”)çš„æŒ‡é’ˆJavaä¸­synchronizedçš„é‡é‡çº§é”ï¼Œæ˜¯åŸºäºè¿›å…¥å’Œé€€å‡ºMonitorå¯¹è±¡å®ç°çš„ã€‚åœ¨ç¼–è¯‘æ—¶ä¼šå°†åŒæ­¥å—çš„å¼€å§‹ä½ç½®æ’å…¥monitor enteræŒ‡ä»¤ï¼Œåœ¨ç»“æŸä½ç½®æ’å…¥monitor exitæŒ‡ä»¤ã€‚å½“çº¿ç¨‹æ‰§è¡Œåˆ°monitor enteræŒ‡ä»¤æ—¶ï¼Œä¼šå°è¯•è·å–å¯¹è±¡æ‰€å¯¹åº”çš„Monitoræ‰€æœ‰æƒï¼Œå¦‚æœè·å–åˆ°äº†ï¼Œå³è·å–åˆ°äº†é”ï¼Œä¼šåœ¨Monitorçš„ownerä¸­å­˜æ”¾å½“å‰çº¿ç¨‹çš„idï¼Œè¿™æ ·å®ƒå°†å¤„äºé”å®šçŠ¶æ€ï¼Œé™¤éé€€å‡ºåŒæ­¥å—ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹æ— æ³•è·å–åˆ°è¿™ä¸ªMonitorã€‚ ==è‡ªæ—‹é”==è‡ªæ—‹é” (spinlock)CAS æ˜¯å®ç°è‡ªæ—‹é”çš„åŸºç¡€ï¼ŒCAS åˆ©ç”¨ CPU æŒ‡ä»¤ä¿è¯äº†æ“ä½œçš„åŸå­æ€§ï¼Œä»¥è¾¾åˆ°é”çš„æ•ˆæœï¼Œè‡³äºè‡ªæ—‹å‘¢ï¼Œçœ‹å­—é¢æ„æ€ä¹Ÿå¾ˆæ˜ç™½ï¼Œè‡ªå·±æ—‹è½¬ã€‚æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œå½“çº¿ç¨‹å‘ç°é”è¢«å ç”¨æ—¶ï¼Œä¼šä¸æ–­å¾ªç¯åˆ¤æ–­é”çš„çŠ¶æ€ï¼Œç›´åˆ°è·å–ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPUCAS æ˜¯å®ç°è‡ªæ—‹é”çš„åŸºç¡€ï¼Œè‡ªæ—‹ç¿»è¯‘æˆäººè¯å°±æ˜¯å¾ªç¯ï¼Œä¸€èˆ¬æ˜¯ç”¨ä¸€ä¸ªæ— é™å¾ªç¯å®ç°ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼Œæ‰§è¡Œä¸€ä¸ªCAS æ“ä½œï¼Œå½“æ“ä½œæˆåŠŸè¿”å› true æ—¶ï¼Œå¾ªç¯ç»“æŸ;å½“è¿”å› false æ—¶ï¼Œæ¥ç€æ‰§è¡Œå¾ªç¯ï¼Œç»§ç»­å°è¯• CAS æ“ä½œï¼Œç›´åˆ°è¿”å› trueã€‚ /*** * å®ç°ä¸€ä¸ªè‡ªæ—‹é”ï¼Œå¤ä¹ CASæ€æƒ³ * è‡ªæ—‹é”å¥½å¤„: å¾ªåæ¯”è¾ƒè·å–æ²¡æœ‰ç±»ä¼¼waitçš„é˜»å¡ * æ°´ * é€šè¿‡CASæ“ä½œå®Œæˆè‡ªæ—‹é”ï¼ŒAçº¿ç¨‹å…ˆè¿›æ¥è°ƒç”¨myLockæ–¹æ³•è‡ªå·±æŒæœ‰é”5ç§’é’Ÿï¼ŒBéšåè¿›æ¥åå‘ç°ï¿¥å½“å‰æœ‰çº¿ç¨‹æŒæœ‰é”ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡è‡ªæ—‹ç­‰å¾…ï¼Œç›´åˆ°Aé‡Šæ”¾é”åBéšåæŠ¢åˆ°ã€‚ */ public class LockSprnk { AtomicReference&lt;Thread&gt; atomicReference=new AtomicReference&lt;&gt;();//è‡ªå®šä¹‰ç±»çš„åŸå­å¼•ç”¨ /** * åŠ é”æ–¹æ³• */ public void lockAtmot(){ Thread thread = Thread.currentThread(); System.out.println(Thread.currentThread().getName()+\" come in\"); while (!atomicReference.compareAndSet(null,thread)){//åˆ¤æ–­ æ˜¯å¦æœ‰çº¿ç¨‹ï¼Œæ²¡æœ‰å°±æŠŠå½“å‰æ”¾è¿›å» } } /** * è§£é”æ–¹æ³• */ public void unLockAtomit(){ Thread thread = Thread.currentThread(); atomicReference.compareAndSet(thread,null);//è‡ªæ—‹çœ‹æ˜¯å¦å½“å‰çº¿ç¨‹ æ˜¯ç½®ç©º System.out.println(Thread.currentThread().getName()+\"è§£é”æˆåŠŸ\"); } public static void main(String[] args) { LockSprnk lockSprnk = new LockSprnk(); new Thread(() -&gt;{ lockSprnk.lockAtmot(); //ä¼‘çœ 5æ¯«ç§’ try{ TimeUnit.SECONDS.sleep(5);}catch(InterruptedException e){} lockSprnk.unLockAtomit(); },\"A\").start(); //æš‚åœ5ç§’ try{TimeUnit.SECONDS.sleep(2);}catch(InterruptedException e){} new Thread(() -&gt;{ lockSprnk.lockAtmot(); lockSprnk.unLockAtomit(); },\"B\").start(); } } CAS çš„ç¼ºç‚¹ï¼šCPUçš„ç©ºè½¬ ä»¥åŠ ABA çš„é—®é¢˜ï¼ˆè¿™åˆä¼šå¼•å‡ºæ—¶é—´æˆ³çš„åŸå­ç±»ï¼‰==è¯»å†™é”==ReentrantReadWriteLockè¯»å†™é”å®šä¹‰ä¸º:ä¸€ä¸ªèµ„æºèƒ½å¤Ÿè¢«å¤šä¸ªè¯»çº¿ç¨‹è®¿é—®ï¼Œæˆ–è€…è¢«ä¸€ä¸ªå†™çº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶å­˜åœ¨è¯»å†™çº¿ç¨‹ã€‚ï¼ˆè¯»å†™äº’æ–¥ï¼Œè¯»è¯»å…±äº«ï¼Œè¯»æ˜¯ç‹¬å é”è¯»æœªå®Œæˆå†™é”æŠ¢ä¸åˆ°ï¼‰==é‚®æˆ³é”==StampedLockReentrantReadWriteLockçš„è¯»é”è¢«å ç”¨çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å°è¯•è·å–å†™é”çš„æ—¶å€™ä¼šè¢«é˜»å¡ã€‚ä½†æ˜¯ï¼ŒStampedLocké‡‡å–ä¹è§‚è·å–åï¼Œå…¶ä»–çº¿ç¨‹å°è¯•è·å–å†™é”æ—¶ä¸ä¼šè¢«é˜»å¡ï¼Œè¿™å…¶å®æ˜¯å¯¹è¯»é”çš„ä¼˜åŒ–ï¼Œæ‰€ä»¥ï¼Œåœ¨è·å–ä¹è§‚è¯»é”åï¼Œè¿˜éœ€è¦å¯¹ç»“æœè¿›è¡Œæ ¡éªŒã€‚==é”çš„é™çº§==å†™é”çš„é™çº§ï¼Œé™çº§æˆä¸ºäº†è¯»é” 1 å¦‚æœåŒä¸€ä¸ªçº¿ç¨‹æŒæœ‰äº†å†™é”ï¼Œåœ¨æ²¡æœ‰é‡Šæ”¾å†™é”çš„æƒ…å†µä¸‹ï¼Œå®ƒè¿˜å¯ä»¥ç»§ç»­è·å¾—è¯»é”ã€‚è¿™å°±æ˜¯å†™é”çš„é™çº§ï¼Œé™çº§æˆä¸ºäº†è¯»é”ã€‚ 2 è§„åˆ™æƒ¯ä¾‹ï¼Œå…ˆè·å–å†™é”ï¼Œç„¶åè·å–è¯»é”ï¼Œå†é‡Šæ”¾å†™é”çš„ æ¬¡åº 3 å¦‚æœé‡Šæ”¾äº†å†™é”ï¼Œé‚£ä¹ˆå°±å®Œå…¨è½¬æ¢ä¸ºè¯»é”ã€‚ ==å¯é‡å…¥é”ï¼ˆé€’å½’é”ï¼‰==æŒ‡çš„æ˜¯åŒä¸€çº¿ç¨‹å¤–å±‚å‡½æ•°è·å¾—é”ä¹‹åï¼Œå†…å±‚é€’å½’å‡½æ•°ä»ç„¶èƒ½è·å–è¯¥é”çš„ä»£ç ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚ï¼ˆå‰æè·å¾—åŒä¸€æŠŠé”ï¼‰ å¯é‡å…¥é” åˆ†ä¸ºéšå¼é” å’Œ æ˜¾ç¤ºé” ï¼š sychronized å…³é”®å­— ä½¿ç”¨çš„é” é»˜è®¤å¯é‡å…¥é”ï¼Œæ˜¾ç¤ºé” reentrLock çš„lock å’Œunlock é”çš„è¦æˆå¯¹å‡ºç°ï¼Œä¸ç„¶å¯¼è‡´ä¸èƒ½æœ‰æ•ˆé‡Šæ”¾é”ä»¥è‡³äºçº¿ç¨‹è¢«é˜»å¡ã€‚==æ­»é”==æ­»é”çš„æ¦‚å¿µï¼šä¸¤ä¸ªæˆ–ä¸¤ä¸ªçš„çº¿ç¨‹äº‰å¤ºèµ„æºï¼Œè€Œé€ æˆçš„ç›¸äº’ç­‰å¾… CodeObject a=new Object(); Object b=new Object(); new Thread(() -&gt;{ synchronized (a) { System.out.println(Thread.currentThread().getName()+\" Aæƒ³æƒ³æ‹¿åˆ°bé”\"); try{TimeUnit.SECONDS.sleep(3);}catch(InterruptedException e){} synchronized (b){ System.out.println(Thread.currentThread().getName()+\" Bæƒ³æ‹¿åˆ°Aé”\"); } } },\"t1\").start(); new Thread(() -&gt;{ synchronized (b) { System.out.println(Thread.currentThread().getName()+\" Bæƒ³æƒ³æ‹¿åˆ°Aé”\"); synchronized (a){ System.out.println(Thread.currentThread().getName()+\" Aæƒ³æ‹¿åˆ°Bé”\"); } } },\"t2\").start(); æ­»é”çš„è¯Šæ–­ JPS -l åˆ—æ‰€æœ‰çš„çº¿ç¨‹id å†æ ¹æ® jstack çº¿ç¨‹idå¥½è¯Šæ–­ å›¾å½¢åŒ–è¯Šæ–­ æ­»é” çº¿ç¨‹ä¸­æ–­æœºåˆ¶==è€ƒç‚¹ï¼šçº¿ç¨‹å¦‚ä½•ä¸­æ–­è¿è¡Œ ,è¯·ç”¨ç®€å•çš„code ç¼–å†™ã€‚å½“è°ƒç”¨ interrupt()æ˜¯å¦é©¬ä¸Šåœæ­¢çº¿ç¨‹å‘¢ ï¼Œå¯¹æ¯”ä¸€ä¸‹isinterruptå’Œé™æ€interruptä»–ä»¬çš„æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«==public static void main(String[] args) { Thread t1 = new Thread(() -&gt; { while (true) { //æ˜¯å¦ä¸­æ–­ if (Thread.currentThread().isInterrupted()){ System.out.println(\"çº¿ç¨‹+\" + Thread.currentThread().isInterrupted()); break; } try{TimeUnit.SECONDS.sleep(1);}catch(InterruptedException e){ e.printStackTrace(); Thread.currentThread().interrupt(); //ç¡çœ ä¸­æ–­å¼‚å¸¸çš„ å¯¼è‡´æ­»å¾ªç¯ ä¸€å®šè¦å†è°ƒç”¨ä¸€æ¬¡ï¼ŒæŠŠæ ‡å¿—ä½æ”¹è¿‡ç¨‹ï¼ˆé‡ç‚¹ï¼‰åŸå› æ˜¯æŠŠt2ä¸­æ–­æ ‡å¿—ä½ç»™æ¸…é™¤äº†ï¼Œåªæœ‰InterruptedException å¼‚å¸¸å°±ä¼šä¸­æ–­æ ‡å¿—ä½æ ‡è¯† } System.out.println(\"çº¿ç¨‹æ²¡æœ‰åœæ­¢\"); } }, \"t1\"); t1.start(); // System.out.println(Thread.currentThread().isInterrupted()); try{ TimeUnit.MICROSECONDS.sleep(5);}catch(InterruptedException e){} new Thread(() -&gt;{ t1.interrupt(); //ä¸­æ–­ è°ƒç”¨è¿™ä¸ªæ–¹æ³• å˜æ›´ä¸­æ–­çš„æ ‡å¿—ä½ï¼ˆä¸­æ–­æ˜¯ä¸€ç§åå•†æœºåˆ¶ï¼Œä¸æ˜¯ç«‹å³åœæ­¢çº¿ç¨‹çš„æ´»å¾—ï¼Œè€Œæ˜¯è¢«ä¸­æ–­çš„çº¿ç¨‹è‡ªå·±åœæ­¢ï¼‰ },\"t2\").start(); } ä¸­æ–­çš„æ€»ç»“:å…·ä½“æ¥è¯´ï¼Œå½“å¯¹ä¸€ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨ interrupt() æ—¶:1å¦‚æœçº¿ç¨‹å¤„äºæ­£å¸¸æ´»åŠ¨çŠ¶æ€ï¼Œé‚£ä¹ˆä¼šå°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—è®¾ç½®ä¸º trueï¼Œä»…æ­¤è€Œå·²ã€‚è¢«è®¾ç½®ä¸­æ–­æ ‡å¿—çš„çº¿ç¨‹å°†ç»§ç»­æ­£å¸¸è¿è¡Œï¼Œä¸å—å½±å“ã€‚æ‰€ä»¥ï¼Œinterrupt() å¹¶ä¸èƒ½çœŸæ­£çš„ä¸­æ–­çº¿ç¨‹ï¼Œéœ€è¦è¢«è°ƒç”¨çš„çº¿ç¨‹è‡ªå·±è¿›è¡Œé…åˆæ‰è¡Œ2å¦‚æœçº¿ç¨‹å¤„äºè¢«é˜»å¡çŠ¶æ€(ä¾‹å¦‚å¤„äºsleep,wait, join ç­‰çŠ¶æ€)ï¼Œåœ¨åˆ«çš„çº¿ç¨‹ä¸­è°ƒç”¨å½“å‰çº¿ç¨‹å¯¹è±¡çš„interruptæ–¹æ³•,é‚£ä¹ˆçº¿ç¨‹å°†ç«‹å³é€€å‡ºè¢«é˜»å¡çŠ¶æ€ï¼Œå¹¶æŠ›å‡ºä¸€ä¸ªInterruptedExceptionå¼‚å¸¸ã€‚ ä¸­æ–­interrupt çš„é™æ€ æ–¹æ³•ä»– ä¼šä¸­ä¸¤ä¸ªäº‹æƒ…ï¼Œä¸€ä¸ªæµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å°†å½“å‰çº¿ç¨‹ä¸­æ–­æŠŠæ ‡å¿—ä½æ”¹ä¸ºfalse ã€‚æ¸…é™¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ ï¼Œå®ä¾‹æ–¹æ³•isterrup å’Œinterrup å®ƒä»¬åº•å±‚éƒ½æ˜¯è°ƒç”¨çš„ ç›¸åŒçš„æ–¹æ³•ï¼Œåªä¸è¿‡é™æ€æ–¹æ³•ä¸»åŠ¨æ¸…é™¤æ ‡å¿—ä½ã€‚LockSuppotLockSupport æ˜¯å‰é¢çš„å¯¹çº¿ç¨‹çš„ç­‰å¾…å’Œå”¤é†’ çš„ä¼˜åŒ–ï¼Œå‰é¢Objectè‡ªå¸¦çš„ wait å’Œnotfiy Lockä¸­çš„ await å’Œsignalsychorizied é‡Œé¢ wait notfiy éœ€è¦æˆå¯¹å‡ºç°ï¼Œå¹¶ä¸”æ”¾åœ¨åŒæ­¥sychcorized ä¿®é¥°çš„ä»£ç å—é‡Œé¢ã€‚å¦åˆ™ä¹Ÿä¼šæŠ¥å¼‚å¸¸ã€‚condition ä¸­ lock await å’Œsignal ä¹Ÿæ˜¯ä¸€æ ·è¦ lock unlock é‡Œé¢çš„ é¡ºåºä¹Ÿä¸èƒ½è°ƒæ¢ã€‚ç”±æ­¤ä¼˜åŒ–çš„LockSupport èƒŒæ™¯ã€‚LockSupportæ˜¯ç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„åŸºæœ¬çº¿ç¨‹é˜»å¯’åŸè¯­ã€‚ä¸€ä¸ªçº¿ç¨‹é˜»å¡å·¥å…·ç±»ï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œå¯ä»¥è®©çº¿ç¨‹åœ¨ä»»æ„ä½ç½®é˜»å¡ï¼Œé˜»å¡ä¹‹åä¹Ÿæœ‰å¯¹åº”çš„å”¤é†’æ–¹æ³•ã€‚å½’æ ¹ç»“_ockSupportæ˜¯LockSupportè°ƒç”¨çš„Unsafeä¸­çš„nativeä»£ç ã€‚_ockSupport æä¾›park()å’Œunpark()æ–¹æ³•å®ç°é˜»å¡çº¿ç¨‹å’Œè§£é™¤çº¿ç¨‹é˜»å¡çš„è¿‡ç¨‹ockSupportå’Œæ¯ä¸ªä½¿ç”¨å®ƒçš„çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè®¸å¯(permit)å…³è”ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç›¸å…³çš„permit, permitæœ€å¤šåªæœ‰ä¸€ä¸ªï¼Œé‡å¤è°ƒç”¨unparkä¹Ÿä¸ä¼šç§¯ç´¯å‡­è¯ã€‚å½¢è±¡çš„ç†è§£çº¿ç¨‹é˜»å¡éœ€è¦æ¶ˆè€—å‡­è¯(permit)ï¼Œè¿™ä¸ªå‡­è¯æœ€å¤šåªæœ‰1ä¸ªã€‚å½“è°ƒç”¨ parkæ–¹æ³•æ—¶ å¦‚æœæœ‰å‡­è¯ï¼Œåˆ™ä¼šç›´æ¥æ¶ˆè€—æ‰è¿™ä¸ªå‡­è¯ç„¶åæ­£å¸¸é€€å‡º;å¦‚æœæ— å‡­è¯ï¼Œå°±å¿…é¡»é˜»å¯’ç­‰å¾…å‡­è¯å¯ç”¨;è€Œunparkåˆ™ç›¸åï¼Œå®ƒä¼šå¢åŠ ä¸€ä¸ªå‡­è¯ï¼Œä½†å‡­è¯æœ€å¤šåªèƒ½æœ‰1ä¸ªï¼Œç´¯åŠ æ— æ•ˆã€‚==è€ƒç‚¹ ä¸ºä»€ä¹ˆå¯ä»¥çªç ´wait/notifyçš„åŸæœ‰è°ƒç”¨é¡ºåº? ä¸ºä»€ä¹ˆå”¤é†’ä¸¤æ¬¡åé˜»å¡ä¸¤æ¬¡==ä¸ºä»€ä¹ˆå¯ä»¥çªç ´wait/notifyçš„åŸæœ‰è°ƒç”¨é¡ºåº?å› ä¸ºunparkè·å¾—äº†ä¸€ä¸ªå‡­è¯ï¼Œä¹‹åå†è°ƒç”¨parkæ–¹æ³•ï¼Œå°±å¯ä»¥åæ­£è¨€é¡ºçš„å‡­è¯æ¶ˆè´¹ï¼Œæ•…ä¸ä¼šé˜»å¡ã€‚å…ˆå‘æ”¾äº†å‡­è¯åç»­å¯ä»¥ç•…é€šæ— é˜»ã€‚ä¸ºä»€ä¹ˆå”¤é†’ä¸¤æ¬¡åé˜»å¡ä¸¤æ¬¡ï¼Œä½†æœ€ç»ˆç»“æœè¿˜ä¼šé˜»å¡çº¿ç¨‹?å› ä¸ºå‡­è¯çš„æ•°é‡æœ€å¤šä¸º 1ï¼Œè¿ç»­è°ƒç”¨ä¸¤æ¬¡ unpark å’Œ è°ƒç”¨ä¸€æ¬¡ unpark æ•ˆæœä¸€æ ·ï¼Œåªä¼šå¢åŠ ä¸€ä¸ªå‡­è¯:è€Œè°ƒç”¨ä¸¤æ¬¡ parkå´éœ€è¦æ¶ˆè´¹ä¸¤ä¸ªå‡­è¯ï¼Œè¯ä¸å¤Ÿï¼Œä¸èƒ½æ”¾è¡Œã€‚==ä¸ºä»€ä¹ˆwaitå¿…é¡»å†™åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼Ÿ==é¿å… CPU åˆ‡æ¢åˆ°å…¶ä»–ç¨‹ï¼Œè€Œå…¶ä»–çº¿ç¨‹åˆæå‰æ‰§è¡Œäº† notify æ–¹æ³•ï¼Œé‚£è¿™æ ·å°±è¾¾ä¸åˆ°æˆ‘ä»¬çš„é¢„æœŸï¼ˆå…ˆ wait å†ç”±å…¶ä»–ç¨‹æ¥å”¤é†’ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªåŒæ­¥é”æ¥ä¿æŠ¤==sleep()ä¸wait()çš„åŒºåˆ«ï¼Ÿ==ä¸»è¦æœ‰å››ä¸ªæ–¹é¢åŒºåˆ« sleep() å±äºThreadç±»ï¼Œwait() å±äºObjectç±» sleep() ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œwait() ä¼šé‡Šæ”¾å¯¹è±¡é” sleep() å¿…é¡»æŒ‡å®šæ—¶é—´ï¼Œwait() å¯æŒ‡å®šä¹Ÿå¯ä»¥ä¸æŒ‡å®š sleep() å¯ä»¥ä½¿ç”¨åœ¨ä»»ä½•ä»£ç å—ï¼Œwait() å¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨ ==ä¸ºä»€ä¹ˆwaitè¦å®šä¹‰åœ¨Objectä¸­è€Œä¸å®šä¹‰åœ¨Threadä¸­ï¼Ÿ==Javaçš„é”æ˜¯å¯¹è±¡çº§åˆ«çš„ï¼Œä¸æ˜¯çº¿ç¨‹çº§åˆ«çš„sleep() ä¼‘çœ æŒ‡çš„å°±æ˜¯çº¿ç¨‹ä¼‘çœ ï¼Œæ‰€ä»¥åœ¨Threadç±»==Sychronizedå’Œlockæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç”¨æ–°çš„Lockæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿä¸¾ä¾‹è¯´è¯´== åŸå§‹æ„æˆï¼š Synchronizedæ˜¯å…³é”®å­—å±äºJVMå±‚é¢monitorenter (åº•å±‚æ˜¯é€šè¿‡monitorå¯¹è±¡æ¥å®Œæˆï¼Œå…¶å®å’Œwait/notifyç­‰æ–¹æ³•ä¹Ÿä¾èµ–äºmonitorå¯¹è±¡åªæœ‰åœ¨åŒæ­¥å—æˆ–è€…æ–¹æ³•ä¸­æ‰èƒ½è°ƒç”¨wait/notifyç­‰æ–¹æ³•)monitorExit(æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ­£å¸¸é€€å‡ºä¸€ä¸ªæ˜¯å¼‚å¸¸é€€å‡º) Lockæ˜¯å…·ä½“ç±» (java.utilconcurrentlocks.Lock) æ˜¯apiå±‚é¢çš„é” ä½¿ç”¨æ–¹æ³•ï¼š synchronizedä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå½“synchronizedä»£ç æ‰§è¡Œå®Œæˆåç³»ç»Ÿä¼šè‡ªåŠ¨è®©çº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å ç”¨ ReentrantLockåˆ™éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œè‹¥æ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°æ­»é”ç°è±¡éœ€è¦lock()å’Œunlock()æ–¹æ³•é…åˆtry/finallyè¯­å¥å—æ¥å®Œæˆ ç­‰å¾…æ˜¯å¦å¯ä¸­æ–­ Synchronizedä¸å¯ä¸­æ–­ï¼Œé™¤éæŠ›å‡ºå¼‚å¸¸æˆ–è€…æ­£å¸¸è¿è¡Œå®Œæˆ é™¤éæŠ›å‡ºå¼‚å¸¸æˆ–è€…æ­£å¸¸è¿è¡Œå®Œæˆ è®¾ç½®è¶…æ—¶æ–¹æ³•tryLock(long timeoutTimeUnit unit) lockInterruptibly()æ”¾ä»£ç å—ä¸­ï¼Œè°ƒç”¨interrupt0)æ–¹æ³•å¯ä¸­æ–­ é”ç»‘å®šå¤šä¸ªæ¡ä»¶Condition synchronizedæ²¡æœ‰ ReentrantLockç”¨æ¥å®ç°åˆ†ç»„å”¤é†’éœ€è¦å”¤é†’çš„çº¿ç¨‹ä»¬ï¼Œå¯ä»¥ç²¾ç¡®å”¤é†’ï¼Œè€Œä¸æ˜¯åƒsynchronizedè¦ä¹ˆéšæœºå”¤é†’ä¸€ä¸ªå…ˆåæ›¾è¦ä¹ˆå”¤é†’å…¨éƒ¨çº¿ç¨‹ã€‚ javaå†…å­˜æ¨¡å‹ ä¹‹ jMMå› ä¸ºæœ‰è¿™ä¹ˆå¤šçº§çš„ç¼“å­˜(cpuå’Œç‰©ç†ä¸»å†…å­˜çš„é€Ÿåº¦ä¸ä¸€è‡´çš„).CPUçš„è¿è¡Œå¹¶ä¸æ˜¯ç›´æ¥æ“ä½œå†…å­˜è€Œæ˜¯å…ˆæŠŠå†…å­˜é‡Œè¾¹çš„æ•°æ®è¯»åˆ°ç¼“å­˜ï¼Œè€Œå†…å­˜çš„è¯»å’Œå†™æ“ä½œçš„æ—¶å€™å°±ä¼šé€ æˆä¸ä¸€è‡´çš„é—®é¢˜jVMè§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§Javaå†…å­˜æ¨¡å‹ java Memory Modelï¼Œç®€ç§°JMM)æ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚æ‰€ä»¥ï¼Œæ¨å¯¼å‡ºæˆ‘ä»¬éœ€è¦çŸ¥é“JMMJMM(Javaå†…å­˜æ¨¡å‹Java Memory Modeï¼Œç®€ç§°JMM)æœ¬èº«æ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µå¹¶ä¸çœŸå®å­˜åœ¨å®ƒä»…ä»…æè¿°çš„æ˜¯ä¸€ç»„çº¦å®šæˆ–è§„èŒƒï¼Œé€šè¿‡è¿™ç»„ç°èŒƒå®šä¹‰äº†ç¨‹åºä¸­(å°¤å…¶æ˜¯å¤šçº¿ç¨‹)å„äººå˜é‡çš„è¯»å†™è®¿é—®æ–¹å¼å¹¶å†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶ä»¥åŠå¦‚ä½•å˜æˆå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ï¼Œå…³å»ºæŠ€æœ¯ç‚¹éƒ½æ˜¯å›´ç»•å¤šçº¿ç¨‹çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§å±•å¼€çš„ã€‚åŸåˆ™:JMMçš„å…³é”®æŠ€æœ¯ç‚¹éƒ½æ˜¯å›´ç»•å¤šçº¿ç¨‹çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§å±•å¼€çš„èƒ½å¹²å˜›?é€šè¿‡JMMæ¥å®ç°çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ã€‚å±è”½å„ä¸ªç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚è€ƒç‚¹==JMM çš„ä¸‰å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆè¯·å¯¹è¿™ä¸‰å¤§ç‰¹æ€§ åšä¸€ä¸ªè¯´æ˜å§==1. ==å¯è§æ€§ ï¼šå½“ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¦ç«‹å³çŸ¥é“å…±äº«å˜é‡å‘ç”Ÿäº†å˜æ›´ã€‚JMMè§„å®šäº†å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ã€‚ç³»ç»Ÿä¸»å†…å­˜ä¸­å…±äº«å˜é‡è¢«å†™å…¥çš„æ—¶æœºä¸ç¡®å®šï¼Œå¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹å®¹æ˜“äº§ç”Ÿè„è¯»ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½æ“ä½œè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œä¸èƒ½ç›´æ¥è¯»å–ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçº¿ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹å˜é‡å€¼çš„ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ==2. ==åŸå­æ€§ ï¼šæŒ‡åŒä¸€ä¸ªæ“ä½œä¸èƒ½è¢«æ‰“æ–­ï¼Œå¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œæ“ä½œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°==3. ==æœ‰åºæ€§ ï¼šJAVAè§„èŒƒè§„å®šçš„JVMçº¿ç¨‹å†…éƒ¨ç»´æŒçš„é¡ºåºåŒ–è¯­åºï¼Œå¦‚æœä»£ç æ‰§è¡Œçš„æœ€ç»ˆç»“æœä¸é¡ºåºæ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆæŒ‡ä»¤æ‰§è¡Œçš„é¡ºåºä¸ä»£ç æ‰§è¡Œçš„é¡ºåºä¸ä¸€è‡´ å³æŒ‡ä»¤é‡æ–°æ’åº====ä¼˜ç‚¹: JVM æ ¹æ®å¤„ç†å™¨ç‰¹æ€§å¯¹æœºå™¨æŒ‡ä»¤é‡æ’ ä½¿æœºå™¨æŒ‡ä»¤æ›´ç¬¦åˆCPUçš„æ‰§è¡Œé¡ºåº ï¼Œæœ€å¤§é™åº¦çš„å‘æŒ¥äº†æœºå™¨æ€§èƒ½====ç¼ºç‚¹ï¼šæŒ‡ä»¤é‡æ’å¯ä»¥ä¿è¯ä¸²è¡Œè¯­ä¹‰çš„ä¸€è‡´ï¼Œä½†ä¸èƒ½ä¿è¯å¤šçº¿ç¨‹è¯­ä¹‰ä¹Ÿä¸€è‡´== ==è€ƒç‚¹happens-beforeæ€»åŸåˆ™ç†è§£==å¦‚æœä¸€ä¸ªæ“ä½œhappens-beforeå¦ä¸€ä¸ªæ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœå°†å¯¹ç¬¬äºŒä¸ªæ“ä½œå¯è§è€Œä¸”ç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€ä¸€å®šè¦æŒ‰ç…§happens-beforeåŸåˆ™åˆ¶å®šçš„é¡ºåºæ¥æ‰§è¡Œå¦‚æœé‡æ’åºä¹‹åçš„æ‰§è¡Œç»“æœä¸æŒ‰ç…§happens-beforeå…³ç³»æ¥æ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ç§é‡æ’åºå¹¶ä¸éæ³•ã€‚happens-before åŸåˆ™å…·ä½“ç‰ˆ .1æ¬¡åºè§„åˆ™: ä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ä»£ç é¡ºåºï¼Œå†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºå†™åœ¨åé¢çš„æ“ä½œ; å‰ä¸€ä¸ªæ“ä½œçš„ç»“æœå¯ä»¥è¢«åç»­çš„æ“ä½œè·å–è®²ç›´ç™½ç‚¹å°±æ˜¯å‰é¢ä¸€ä¸ªæ“ä½œæŠŠå˜é‡Xèµ‹å€¼ä¸º1ï¼Œé‚£åé¢ä¸€ä¸ªæ“ä½œè‚¯å®šèƒ½çŸ¥é“Xå·²ç»å˜æˆäº†1 2.é”å®šè§„åˆ™: ä¸ªunLockæ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢((è¿™é‡Œçš„â€œåé¢â€æ˜¯æŒ‡æ—¶é—´ä¸Šçš„å…ˆå))å¯¹åŒä¸€ä¸ªé”çš„lockæ“ä½œ; 3.volatileå˜é‡è§„åˆ™:å¯¹ä¸€ä¸ªvolatileå˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼Œå‰é¢çš„å†™å¯¹åé¢çš„è¯»æ˜¯å¯è§çš„ï¼Œè¿™é‡Œçš„â€œåé¢â€åŒæ ·æ˜¯æŒ‡æ—¶é—´ä¸Šçš„å…ˆå 4.ä¼ é€’è§„åˆ™:å¦‚æœæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œBï¼Œè€Œæ“ä½œBåˆå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCï¼Œåˆ™å¯ä»¥å¾—å‡ºæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œC 5.çº¿ç¨‹å¯åŠ¨è§„åˆ™(Thread Start Rule):Threadå¯¹è±¡çš„start()æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œ 6.çº¿ç¨‹ä¸­æ–­è§„åˆ™(Thread Interruption Rule): å¯¹çº¿ç¨‹interrupt()æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿ;å¯ä»¥é€šè¿‡Thread.interrupted()æ£€æµ‹åˆ°æ˜¯å¦å‘ç”Ÿä¸­æ–­ä¹Ÿå°±æ˜¯è¯´ä½ è¦å…ˆè°ƒç”¨interrupt()æ–¹æ³•è®¾ç½®è¿‡ä¸­æ–­æ ‡å¿—ä½ï¼Œæˆ‘æ‰èƒ½æ£€æµ‹åˆ°ä¸­æ–­å‘ç”Ÿ 7.çº¿ç¨‹ç»ˆæ­¢è§„åˆ™(Thread Termination Rule): çº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºå¯¹æ­¤çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡isAlive()ç­‰æ‰‹æ®µæ£€æµ‹çº¿ç¨‹æ˜¯å¦å·²ç»ç»ˆæ­¢æ‰§è¡Œ 8.å¯¹è±¡ç»ˆç»“è§„åˆ™(Finalizer Rule): å¯¹è±¡æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ä¹‹å‰ï¼Œæ˜¯ä¸èƒ½è°ƒç”¨finalized0)æ–¹æ³•çš„ volatile å’Œ JMM==è€ƒç‚¹è¢«volatileä¿®é¥°çš„å˜é‡æœ‰ä»€ä¹ˆç‰¹ç‚¹ ï¼šå¯è§æ€§ æœ‰åºæ€§==volatileçš„å†…å­˜è¯­ä¹‰ï¼ˆä½œç”¨ï¼‰ï¼šå½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡å€¼ç«‹å³åˆ·æ–°å›ä¸»å†…å­˜ä¸­ã€‚å½“è¯»ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜è®¾ç½®ä¸ºæ— æ•ˆï¼Œé‡æ–°å›åˆ°ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°å…±äº«å˜æ‰€ä»¥volatileçš„å†™å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œè¯»çš„å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–==è€ƒç‚¹çš„é€šè¿‡ä»€ä¹ˆæ–¹å¼ä¿è¯å¯ä»¥è§æ€§å’Œæœ‰åºæ€§ï¼šæ˜¯é€šè¿‡å†…å­˜å±éšœ==è¯´è¯´å†…å­˜å±éšœåŸç†ï¼ˆ==é‡ç‚¹==ï¼‰å†è¯´å†…å­˜å±éšœä¹‹å‰ï¼Œå…ˆçœ‹çœ‹å¯¹äºæœ‰åºæ€§çš„ç†è§£æœ‰åº(ç¦é‡æ’) é‡æ’åºæ˜¯æŒ‡ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†ä¼˜åŒ–ç¨‹åºæ€§èƒ½è€Œå¯¹æŒ‡ä»¤åºåˆ—è¿›è¡Œé‡æ–°æ’åºçš„ä¸€ç§æ‰‹æ®µï¼Œæœ‰æ—¶å€™ä¼šæ”¹å˜ç¨‹åºè¯­å¥çš„å…ˆåé¡ºåºä¸å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œå¯ä»¥é‡æ’åº; å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¦æ­¢é‡æ’åºä½†é‡æ’åçš„æŒ‡ä»¤ç»å¯¹ä¸èƒ½æ”¹å˜åŸæœ‰çš„ä¸²è¡Œè¯­ä¹‰!è¿™ç‚¹åœ¨å¹¶å‘è®¾è®¡ä¸­å¿…é¡»è¦é‡ç‚¹è€ƒè™‘! å†…å­˜å±éšœçš„åˆ†ç±» ç²—åˆ†ä¸¤ç§ï¼šè¯»å±éšœ ï¼ˆåœ¨è¯»æŒ‡ä»¤ä¹‹å‰æ’å…¥è¯»å±éšœï¼Œè®©å·¥ä½œå†…å­˜æˆ–CPUé«˜é€Ÿç¼“å­˜å½“ä¸­çš„ç¼“å­˜æ•°æ®å¤±æ•ˆï¼Œé‡æ–°å›åˆ°ä¸»å†…å­˜ä¸­è·å–æœ€æ–°æ•°æ®ï¼‰å’Œå†™çš„å±éšœï¼ˆåœ¨å†™æŒ‡ä»¤ä¹‹åæ’å…¥å†™å±éšœï¼Œå¼ºåˆ¶æŠŠå†™ç¼“å†²åŒºçš„æ•°æ®åˆ·å›åˆ°ä¸»å†…å­˜ä¸­ï¼‰ ç»†åˆ†æœ‰å››ç§ï¼š å±éšœç±»å‹ æŒ‡ä»¤ç¤ºä¾‹ è¯´æ˜ LoadLoad Load1;LoadLoad;Load2 ä¿è¯load1çš„è¯»å–æ“ä½œåœ¨load2åŠåç»­è¯»å–æ“ä½œä¹‹å‰æ‰§è¡Œ StoreStore Store1; StoreStore; Store2 åœ¨store2åŠå…¶åçš„å†™æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯store1çš„å†™æ“ä½œå·²åˆ·æ–°åˆ°ä¸»å†…å­˜ LoadStore Load1: LoadStore: Store2 åœ¨stroe2åŠå…¶åçš„å†™æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯load1çš„è¯»æ“ä½œå·²è¯»å–ç»“æŸ StoreLoad Store1: Storeload: Load2 ä¿è¯store1çš„å†™æ“ä½œå·²åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹åï¼Œload2åŠå…¶åçš„è¯»æ“ä½œæ‰èƒ½æ‰§è¡Œ Happens-beforeä¹‹volatile çš„è§„åˆ™ ç­–ç•¥ ç¬¬ä¸€ä¸ªæ“ä½œ ç¬¬äºŒä¸ªæ“ä½œ: æ™®é€šè¯»å†™ ç¬¬äºŒä¸ªæ“ä½œ: volatileè¯» ç¬¬äºŒä¸ªæ“ä½œ: volatileè¯» æ™®é€šè¯»å†™ æ™®é€šè¯»å†™ æ™®é€šè¯»å†™ ä¸å¯ä»¥é‡æ’ volatileè¯» ä¸å¯ä»¥é‡æ’ ä¸å¯ä»¥é‡æ’ ä¸å¯ä»¥é‡æ’ volatileå†™ å¯ä»¥é‡æ’ ä¸å¯ä»¥é‡æ’ ä¸å¯ä»¥é‡æ’ ç­–ç•¥çš„è®°å¿†å£è¯€ å½“ç¬¬ä¸€ä¸ªæ“ä½œä¸ºvolatleè¯»æ—¶ï¼Œä¸è®ºç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªæ“ä½œä¿è¯äº†volatleè¯»ä¹‹åçš„æ“ä½œä¸ä¼šè¢«é‡æ’åˆ°volatileè¯»ä¹‹å‰ã€‚ å½“ç¬¬äºŒä¸ªæ“ä½œä¸ºvolatileå†™æ—¶ï¼Œä¸è®ºç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªæ“ä½œä¿è¯äº†volatileå†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«é‡æ’åˆ°volatileå†™ä¹‹åã€‚ å½“ç¬¬ä¸€ä¸ªæ“ä½œä¸ºvolatileå†™æ—¶ï¼Œç¬¬äºŒä¸ªæ“ä½œä¸ºvolatileè¯»æ—¶ï¼Œä¸èƒ½é‡æ’ã€‚ è¯»å±éšœçš„ç¤ºæ„å›¾ å†™å±éšœçš„ç¤ºæ„å›¾ volatie å˜é‡å†™è¿‡ç¨‹çš„ read: ä½œç”¨äºä¸»å†…å­˜ï¼Œå°†å˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°å·¥ä½œå†…å­˜ï¼Œä¸»å†…å­˜åˆ°å·¥ä½œå†…å­˜ load: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†readä»ä¸»å†…å­˜ä¼ è¾“çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜å˜é‡å‰¯æœ¬ä¸­ï¼Œå³æ•°æ®åŠ è½½ use: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†å·¥ä½œå†…å­˜å˜é‡å‰¯æœ¬çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“JVMé‡åˆ°éœ€è¦è¯¥å˜é‡çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶ä¼šæ‰§è¡Œè¯¥æ“ä½œ assign: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†ä»æ‰§è¡Œå¼•è­¦æ¥æ”¶åˆ°çš„å€¼èµ‹å€¼ç»™å·¥ä½œå†…å­˜å˜é‡ï¼Œæ¯å½“JVMé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼å­—èŠ‚ç æŒ‡ä»¤æ—¶ä¼šæ‰§è¡Œè¯¥æ“ä½œ store: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†èµ‹å€¼å®Œæ¯•çš„å·¥ä½œå˜é‡çš„å€¼å†™å›ç»™ä¸»å†…å­˜ write:ä½œç”¨äºä¸»å†…å­˜ï¼Œå°†storeä¼ è¾“è¿‡æ¥çš„å˜é‡å€¼èµ‹å€¼ç»™ä¸»å†…å­˜ä¸­çš„å˜é‡ ==ç”±äºä¸Šè¿°6æ¡åªèƒ½ä¿è¯å•æ¡æŒ‡ä»¤çš„åŸå­æ€§ï¼Œé’ˆå¯¹å¤šæ¡æŒ‡ä»¤çš„ç»„åˆæ€§åŸå­ä¿è¯ï¼Œæ²¡æœ‰å¤§é¢ç§¯åŠ é”ï¼Œæ‰€ä»¥ï¼ŒJVMæä¾›äº†å¦å¤–ä¸¤ä¸ªåŸå­æŒ‡ä»¤== lock: ä½œç”¨äºä¸»å†…å­˜ï¼Œå°†ä¸€ä¸ªå˜é‡æ ‡è®°ä¸ºä¸€ä¸ªçº¿ç¨‹ç‹¬å çš„çŠ¶æ€ï¼Œåªæ˜¯å†™æ—¶å€™åŠ é”ï¼Œå°±åªæ˜¯é”äº†å†™å˜é‡çš„è¿‡ç¨‹ã€‚ unlock: ä½œç”¨äºä¸»å†…å­˜ï¼ŒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾ï¼Œç„¶åæ‰èƒ½è¢«å…¶ä»–çº¿ç¨‹å ç”¨ ==è€ƒç‚¹volatile çš„ä½¿ç”¨åœºæ™¯== å•ä¸€èµ‹å€¼å¯ä»¥ï¼Œbutå«å¤åˆè¿ç®—èµ‹å€¼ä¸å¯ä»¥(i++ä¹‹ç±») çŠ¶æ€æ ‡å¿—ï¼Œåˆ¤æ–­ä¸šåŠ¡æ˜¯å¦ç»“æŸ ï¼ˆå˜é‡å¯ä»¥ç”¨volatile ä¿®é¥°ï¼‰ å¼€é”€è¾ƒä½çš„è¯»ï¼Œå†™é”ç­–ç•¥ ï¼ˆå†å†™ä½¿ç”¨sychornized ä¿®é¥° è¯»çš„å˜é‡çš„ä½¿ç”¨volatile ä¿®é¥°ï¼‰ AtomicIntegerFieldUpdaterï¼ŒAtomicLongFieldUpdaterï¼ŒAtomicReferenceFieldUpdater æ›´æ–°çš„å¯¹è±¡å±æ€§å¿…é¡»ä½¿ç”¨ public volatile ä¿®é¥°ç¬¦ DCLåŒç«¯é”çš„å‘å¸ƒ ï¼ˆå•ä¾‹æ¨¡å¼çš„ä¸­åŒé‡æ£€æŸ¥ï¼‰ package com.atguigu.itdachang; public class SafeDoubleCheckSingleton{ private static SafeDoubleCheckSingleton singleton; //ç§è‚²åŒ–æ„é€ æ–¹æ³• private SafeDoubleChecksingleton(){} } //åŒé‡é”æ²¡è®¡ public static volatile SafeDoubleCheckSingleton getInstance(){ if (singleton == nu11){ //1.å¤šçº¿ç¨‹å¹¶å‘åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼šé€šè¿‡åŠ é”ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½åˆ›å»ºå¯¹è±¡ synchronized (SafeDoubleCheckSingleton.class){ if (singleton == nu11){ //éšæ‚£ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œç”±äºé‡æ’åºï¼Œè¯¥å¯¹è±¡å¯èƒ½è¿˜æœªå®Œæˆåˆå§‹åŒ–å°±è¢«å…¶ä»–çº¿ç¨‹è¯»èŒ singleton = new SafeDoubleCheckSingleton(); } } } //2.å¯¹è±¡åˆ›å»ºå®Œæ¯•ï¼Œæ‰§è¡ŒgetInstance()ç‰¹ä¸éœ€è¦è·èŒé”ï¼Œç›´æ¥è¿”å›åˆ›å»ºå¯¹è±¡ return singleton; } } é¢è¯•volatile çš„æ—¶å€™ï¼Œä»è¿™ä¸ªç‚¹æ³•ä¸Šé¢åŒºè¡¨è¿° volatileå…³é”®å­—ä¿è¯å¯è§æ€§: å¯¹ä¸€ä¸ªè¢«volatileå…³é”®å­—ä¿®æ”¹çš„å˜é‡ å†™æ“ä½œçš„è¯ï¼Œè¿™ä¸ªå˜é‡çš„æœ€æ–°å€¼ä¼šç«‹å³åˆ·æ–°å›åˆ°ä¸»å†…å­˜ä¸­ è¯»æ“ä½œçš„è¯ï¼Œæ€»æ˜¯èƒ½å¤Ÿè¯»å–åˆ°è¿™ä¸ªå˜é‡çš„æœ€æ–°å€¼ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå˜é‡æœ€åè¢«ä¿®æ”¹çš„å€¼ å½“æŸä¸ªçº¿ç¨‹æ”¶åˆ°é€šçŸ¥ï¼Œå»è¯»å–volatileä¿®é¥°çš„å˜é‡çš„å€¼çš„æ—¶å€™ï¼Œçº¿ç¨‹ç§æœ‰å·¥ä½œå†…å­˜çš„æ•°æ®å¤±æ•ˆï¼Œéœ€è¦é‡æ–°å›åˆ°ä¸»å†…å­˜ä¸­å»è¯»å–æœ€æ–°çš„æ•°æ®ã€‚ æ²¡æœ‰åŸå­æ€§ ï¼šç»“åˆçº¿ç¨‹å½“æ“ä½œå¤åˆè¿ç®—++ i çš„é—®é¢˜ä¸Šï¼Œä»–ä»¬çš„æ­¥éª¤ä¸æ˜¯åŸå­æ€§ï¼Œè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ ç¦æ­¢é‡æ’åºï¼ˆæœ‰åºæ€§ï¼‰ ==å‡­å•¥å°±ç»™æˆ‘ä»¬volatileå°±ä¼šåŠ å†…å­˜å±éšœ== åº•å±‚çœ‹volatile ä¿®é¥°å°±æ·»åŠ  ACC_VOLATILE ç¨‹åºå°±ä¼šæŒ‰ç…§è¿™ä¸ªåŠ å†…å­˜å±éšœ CASæ¦‚å¿µcompare and swapçš„ç¼©å†™ï¼Œä¸­æ–‡ç¿»è¯‘æˆæ¯”è¾ƒå¹¶äº¤æ¢,å®ç°å¹¶å‘ç®—æ³•æ—¶å¸¸ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ã€‚ å®ƒåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ä¸€ä¸€å†…å­˜ä½ç½®ã€é¢„æœŸåŸå€¼åŠæ›´æ–°å€¼ã€‚ æ‰§è¡ŒCASæ“ä½œçš„æ—¶å€™ï¼Œå°†å†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼æ¯”è¾ƒ:å¦‚æœç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼å¦‚æœä¸åŒ¹é…ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒCASæ“ä½œåªæœ‰ä¸€ä¸ªä¼šæˆåŠŸã€‚ CASæœ‰3ä¸ªæ“ä½œæ•°ï¼Œä½ç½®å†…å­˜å€¼Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ›´æ–°å€¼Bå½“ä¸”ä»…å½“æ—§çš„é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼Vä¿®æ”¹ä¸ºBï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšæˆ–é‡æ¥å½“å®ƒé‡æ¥é‡è¯•çš„è¿™ç§è¡Œä¸ºæˆä¸º----è‡ªæ—‹! ! è®¤è¯†CAS è¦å¯¹åº•å±‚çš„unsafa æ ¸å¿ƒç±»çš„äº†è§£Unsafeæ˜¯CASçš„æ ¸å¿ƒç±»ï¼Œç”±äºJavaæ–¹æ³•æ— æ³•ç›´æ¥è®¿é—®åº•å±‚ç³»ç»Ÿï¼Œéœ€è¦é€šè¿‡æœ¬åœ°(native) æ–¹æ³•æ¥è®¿é—®ï¼ŒUnsafeç›¸å½“äºä¸€ä¸ªåé—¨ï¼ŒåŸºäºè¯¥ç±»å¯ä»¥ç›´æ¥æ“ä½œç‰¹å®šå†…å­˜çš„æ•°æ®ã€‚Unsafeç±»å­˜åœ¨äºsun.miscåŒ…ä¸­ï¼Œå…¶å†…éƒ¨æ–¹æ³•æ“ä½œå¯ä»¥åƒCçš„æŒ‡é’ˆä¸€æ ·ç›´æ¥æ“ä½œå†…å­˜ï¼Œå› ä¸ºJavaä¸­CASæ“ä½œçš„æ‰§è¡Œä¾èµ–äºUnsafeç±»çš„æ–¹æ³•ã€‚ æ³¨æ„Unsafeç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯nativeä¿®é¥°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´Unsafeç±»ä¸­çš„æ³•éƒ½ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿåº•å±‚èµ„æºæ‰§è¡Œç›¸åº”ä½œåŠ¡ CASå¹¶å‘åŸè¯­ä½“ç°åœ¨JAVAè¯­è¨€ä¸­å°±æ˜¯sun.misc.Unsafeç±»ä¸­çš„æ ¸å¿ƒæ–¹æ³•ã€‚==è°ƒç”¨UnSafeç±»ä¸­çš„CASæ–¹æ³•ï¼ŒJVMä¼šå¸®æˆ‘ä»¬å®ç°å‡ºCASæ±‡ç¼–æŒ‡ä»¤ã€‚è¿™æ˜¯ä¸€ç§å®Œå…¨ä¾èµ–äºç¡¬ä»¶çš„åŠŸèƒ½ï¼Œé€šè¿‡å®ƒå®ç°äº†åŸå­æ“ä½œã€‚å†æ¬¡å¼ºè°ƒï¼Œç”±äºCASæ˜¯ä¸€ç§ç³»ç»ŸåŸè¯­ï¼ŒåŸè¯­å±äºæ“ä½œç³»ç»Ÿç”¨è¯­èŒƒç•´ï¼Œæ˜¯ç”±è‹¥å¹²æ¡æŒ‡ä»¤ç»„æˆçš„ï¼Œç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå¹¶ä¸”åŸè¯­çš„æ‰§è¡Œå¿…é¡»æ˜¯è¿ç»­çš„ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸å…è®¸è¢«ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´CASæ˜¯ä¸€æ¡CPUçš„åŸå­æŒ‡ä»¤ï¼Œä¸ä¼šé€ æˆæ‰€è°“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜==ã€‚ JUC ä¸‹çš„å¹¶å‘åŒ…çš„åŸå­ç±»volatile è§£å†³å¤šçº¿ç¨‹å†…å­˜ä¸å¯è§é—®é¢˜å¯¹äºä¸€å†™å¤šè¯»ï¼Œæ˜¯å¯ä»¥è§£å†³å˜é‡åŒæ­¥é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå¤šå†™ï¼ŒåŒæ ·æ— æ³•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚è¯´æ˜: å¦‚æœæ˜¯ count+ +æ“ä½œï¼Œä½¿ç”¨å¦‚ä¸‹ç±»å®ç°:AtomicInteger count = new AtomicInteger();count.addAndGet(1): å¦‚æœæ˜¯JDK8ï¼Œ==æ¨èä½¿ç”¨ LongAdder å¯¹è±¡ï¼Œæ¯” AtomicLong æ€§èƒ½æ›´å¥½==(å‡å°‘ä¹è§‚é”çš„é‡è¯•æ¬¡æ•°)åœ¨LongAdder å’ŒAtomicLong å®ƒä»¬åœ¨å¹¶å‘é‡ä½çš„æ—¶å€™ï¼Œæ€§èƒ½å·®ä¸äº†å¤šå°‘ã€‚ä½†åœ¨é«˜å¹¶å‘çš„æ—¶å€™ï¼ŒLongAdderçš„åŸºæœ¬æ€è·¯å°±æ˜¯åˆ†æ•£çƒ­ç‚¹ï¼Œå°†valueå€¼åˆ†æ•£åˆ°ä¸€ä¸ªCeæ•°ç»„ä¸­ï¼Œä¸åŒçº¿ç¨‹ä¼šå‘½ä¸­åˆ°æ•°ç»„çš„ä¸åŒæ§½ä¸­ï¼Œå„ä¸ªçº¿ç¨‹åªå¯¹è‡ªå·±æ§½ä¸­çš„é‚£ä¸ªå€¼è¿›è¡ŒCASæ“ä½œï¼Œè¿™æ ·çƒ­ç‚¹å°±è¢«åˆ†æ•£äº†ï¼Œå†²çªçš„æ¦‚ç‡å°±å°å¾ˆå¤šã€‚å¦‚æœè¦è·å–çœŸæ­£çš„longå€¼ï¼Œåªè¦å°†å„ä¸ªæ§½ä¸­çš„å˜é‡å€¼ç´¯åŠ è¿”å›ã€‚ï¼ˆå†…éƒ¨ä¸€ä¸ªbase å˜é‡ï¼Œä¸€ä¸ª cell[] æ•°ç»„ ï¼šbase æ˜¯åœ¨ä½å¹¶å‘æƒ…å†µä¸‹ï¼ŒåšCASç´¯åŠ ã€‚å¦‚æœä¸€ç›´è‡ªæ—‹å¤±è´¥çš„è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥ åˆ›å»ºCellæ•°ç»„ æ¥åˆ†æ‹…å‹åŠ›ã€‚æ¯ä¸ªcellçš„å…ƒç´ éƒ½å­˜æ”¾ä¸åŒä¸åŒçº¿ç¨‹çš„ç´¯åŠ ã€‚æœ€ç»ˆæŠŠå„ä¸ªcell æ•°ç»„å…ƒç´ çš„é‡Œé¢çš„å€¼å’Œbase ç›¸åŠ ã€‚æ•ˆç‡ä¼šä¸€ä¸ªbase å¤„ç†æ•°æ®å¿«ï¼‰è¯´è¯´AtomicStampedReference å’Œ AtomicMarkableReference çš„åŒºåˆ« AtomicStampedReference è§£å†³ä¿®æ”¹çŠ¶æ€æˆ³åŸ ä¿®æ”¹å¤šæ¬¡çš„åŸå­æ›´æ–° AtomicMarkableReference è§£å†³ä¸€æ¬¡çš„çŠ¶æ€çš„ä¿®æ”¹çš„åŸå­æ›´æ–° TheadLocadlå®šä¹‰ï¼šThreadLocalæä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚è¿™äº›å˜é‡ä¸æ­£å¸¸çš„å˜é‡ä¸åŒï¼Œå› ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®ThreadLocalå®ä¾‹çš„æ—¶å€™(é€šè¿‡å…¶getæˆ–setæ–¹æ³•)éƒ½æœ‰è‡ªå·±çš„ã€ç‹¬ç«‹åˆå§‹åŒ–çš„å˜é‡å‰¯æœ¬ã€‚ThreadLocalå®ä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„ç§æœ‰é™æ€å­—æ®µï¼Œä½¿ç”¨å®ƒçš„ç›®çš„æ˜¯å¸Œæœ›å°†çŠ¶æ€(ä¾‹å¦‚ï¼Œç”¨æˆ·IDæˆ–äº‹åŠ¡1D)ä¸çº¿ç¨‹å…³è”èµ·æ¥ã€‚ä½œç”¨å®ç°æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ä¸“å±çš„æœ¬åœ°å˜é‡å‰¯æœ¬(è‡ªå·±ç”¨è‡ªå·±çš„å˜é‡ä¸éº»çƒ¦åˆ«äººï¼Œä¸å’Œå…¶ä»–äººå…±äº«ï¼Œäººäººæœ‰ä»½ï¼Œäººå„ä¸€ä»½), ä¸»è¦è§£å†³äº†è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œé€šè¿‡ä½¿ç”¨get0å’Œsetæ–¹æ³•ï¼Œè·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰è®²è§£çš„8é”æ¡ˆä¾‹ï¼Œèµ„æºç±»æ˜¯ä½¿ç”¨åŒä¸€éƒ¨æ‰‹æœºï¼Œå¤šä¸ªçº¿ç¨‹æŠ¢å¤ºåŒä¸€éƒ¨æ‰‹æœºä½¿ç”¨ï¼Œå‡å¦‚äººæ‰‹ä¸€ä»½æ˜¯ä¸æ˜¯å¤©ä¸‹å¤ªå¹³?? ==ThreadLocalè€ƒç‚¹==ThreadLocalä¸­ThreadLocalMapçš„æ•°æ®ç»“æ„å’Œå…³ç³»?Thread é‡Œé¢çš„åŒ…å«ä¸€ä¸ªThreadLocal å¼•ç”¨ è€ŒThreadLocal é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»TheadLocadlMapã€‚ ThreadLocalä¸ºkey å­˜æ”¾åœ¨value ThreadLocalçš„keyæ˜¯å¼±å¼•ç”¨ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ?å¼±å¼•ç”¨ç›¸è¾ƒäºå‰é¢çš„å¼ºå¼•ç”¨å’Œè½¯å¼•ç”¨çš„çš„è¯ï¼Œjvm æ›´ä¼šä¸»åŠ¨å»å›æ”¶ThreadLocalMap çš„key è¿™æ ·çš„ä¸ä¼šåˆ°å¯¼è‡´å†…å­˜æ³„æ¼ã€‚ å½“function1æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œæ ˆé”€æ¯å¼ºå¼•ç”¨ tl ä¹Ÿå°±æ²¡æœ‰äº†ã€‚ä½†æ­¤æ—¶çº¿ç¨‹çš„ThreadLocalMapé‡ŒæŸä¸ªentryçš„keyå¼•ç”¨è¿˜æŒ‡å‘è¿™ä¸ªå¯¹è±¡è‹¥è¿™ä¸ªkeyå¼•ç”¨æ˜¯å¼ºå¼•ç”¨ï¼Œå°±ä¼šå¯¼è‡´keyæŒ‡å‘çš„ThreadLocalå¯¹è±¡åŠvæŒ‡å‘çš„å¯¹è±¡ä¸èƒ½è¢«gcå›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼;è‹¥è¿™ä¸ªkeyå¼•ç”¨æ˜¯å¼±å¼•ç”¨å°±å¤§æ¦‚ç‡ä¼šå‡å°‘å†…å­˜æ³„æ¼çš„é—®é¢˜(è¿˜æœ‰ä¸€ä¸ªkeyä¸ºnulçš„é›·ï¼Œç¬¬2ä¸ªå‘åé¢è®²)ã€‚ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆåˆç†ï¼‰ï¼Œå°±å¯ä»¥ä½¿ThreadLocalå¯¹è±¡åœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åé¡ºåˆ©è¢«å›æ”¶ä¸”Entryçš„keyå¼•ç”¨æŒ‡å‘ä¸ºnull. â€‹ ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜ä½ çŸ¥é“å—? threadLocalä¸­æœ€åä¸ºä»€ä¹ˆè¦åŠ removeæ–¹æ³•?ThreadLocalè‡ªå®šä¹‰çš„å˜é‡ç”¨å®Œéœ€è¦remove æ‰ ï¼Œå‡å°‘çº¿ç¨‹çš„è´Ÿæ‹…ã€‚ç‰¹åˆ«çº¿ç¨‹æ± çš„å¤ç”¨å¯¼è‡´çº¿ç¨‹å†…å­˜æ³„æ¼ ä½¿ç”¨ä¸­ try -finallyå—å›æ”¶ã€‚ ä½¿ç”¨å¼±å¼•ç”¨çš„ä¸èƒ½é¿å…ç™¾åˆ†ç™¾ï¼Œå› ä¸ºå½“ThreadLocal çš„è¢«å›æ”¶ä¹‹åï¼Œçº¿ç¨‹é‡Œé¢è¿˜æœ‰å½“key ä¸ºnull çš„valueã€‚è€Œè¿™äº›valueä¸€ç›´ThraeadLocalmapå¼ºå¼•ç”¨ï¼Œè¿™æ ·çš„jvm ä¸èƒ½å›æ”¶ã€‚å¦‚æœåœ¨çº¿ç¨‹æ± å¤ç”¨çš„å¯¼å†…å­˜æ³„æ¼ã€‚å½“ä½¿ç”¨ set æ–¹æ³•å’Œget ä»¥åŠ remove æ–¹æ³• .éƒ½ä¼šå…ˆå»åˆ¤æ–­key æ˜¯å¦ä¸ºnull ,å¦‚æœæ˜¯çš„å°±ä¼šæŠŠ keyä¸ºnullçš„value ç»™å›æ”¶ã€‚é¿å…å†…å­˜æ³„æ¼å’Œå¤ç”¨å¯¼è‡´bug æ‰‹åŠ¨remove æœ‰å¿…è¦çš„ å¯¹è±¡å†…å­˜å¸ƒå±€ä¹‹å¯¹è±¡å¤´å¯¹è±¡å¤´çš„æ„æˆè¿è¡Œæ—¶å…ƒæ•°æ® (Mark Word)å“ˆå¸Œå€¼ (HashCode)GCåˆ†ä»£å¹´é¾„é”çŠ¶æ€æ ‡å¿—çº¿ç¨‹æŒæœ‰çš„é”åå‘çº¿ç¨‹IDåå‘æ—¶é—´æˆ³ç±»å‹æŒ‡é’ˆä¸€ä¸€æŒ‡å‘ç±»å…ƒæ•°æ®InstanceClassï¼Œç¡®å®šè¯¥å¯¹è±¡æ‰€å±çš„ç±»å‹å®ä¾‹æ•°æ® (Instance Data) :å®ƒæ˜¯å¯¹æ€¥çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¨‹åºä»£ç ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µ(åŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œæœ¬èº«æ‹¥æœ‰çš„å­—æ®µ) é”çš„å‡çº§sychcornizedé”:ç”±å¯¹è±¡å¤´ä¸­çš„Mark Wordæ ¹æ®é”æ ‡å¿—ä½çš„ä¸åŒè€Œè¢«å¤ç”¨åŠé”å‡çº§ç­–ç•¥é”å‡çº§çš„èƒŒæ™¯javaçš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ï¼Œå¦‚æœè¦é˜³å¡æˆ–å”¤é†’ä¸€ä¸ªçº¿ç¨‹å°±éœ€è¦æ¢ä½œç³»ç»Ÿä»‹å…¥ï¼Œéœ€è¦åœ¨æˆ·æ€ä¸æ ¸å¿ƒæ€ä¹‹é—´åˆ‡æ¢ï¼Œè¿™ç§åˆ‡æ¢ä¼šæ¶ˆæ–™å¤§é‡çš„ç³»ç»Ÿèµ„æºï¼Œå› ä¸ºç”¨æˆ·æ€ä¸å†…æ ¸æ€éƒ½æœ‰å„è‡ªä¸“ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä¸“ç”¨çš„å¯„å­˜å™¨ç­‰ï¼Œç”¨æˆ·æ€åˆ‡æ¢è‡³å†…æ ¸æ€éœ€è¦ä¼ é€’ç»™è®¸å¤šå˜é‡ã€å‚æ•°ç»™å†…æ ¸ï¼Œå†…æ ¸ä¹Ÿéœ€è¦ä¿æŠ¤å¥½ç”¨æˆ·æ€åœ¨åˆ‡æ¢æ—¶çš„ä¸€äº›å¯„å­˜å™¨å€¼ã€å˜é‡ç­‰ï¼Œä»¥ä¾¿å†…æ ¸æ€è°ƒç”¨ç»“æŸååˆ‡æ¢å›ç”¨æˆ·æ€ç»§ç»­å·¥ä½œã€‚åœ¨Javaæ—©æœŸç‰ˆæœ¬ä¸­ï¼Œsynchronizedå±äºé‡é‡çº§é”ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºç›‘è§†å™¨é” (monitor)æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lock(ç³»ç»Ÿäº’æ–¥é‡)æ¥å®ç°çš„ï¼ŒæŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹éƒ½éœ€è¦è½¬å…¥å†…æ ¸æ€å»å®Œæˆï¼Œé˜³å¯’æˆ–å”¤é†’ä¸€ä¸ªJaaçº¿ç¨‹éœ€è¦æ¢ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€åˆ‡æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ï¼Œå¦‚æœåŒæ­¥ä»£ç å—ä¸­å†…å®¹è¿‡äºç®€å•ï¼Œè¿™ç§åˆ‡æ¢çš„æ—¶é—´å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜é•¿â€ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ—©æœŸçš„synchronizedæ•ˆç‡ä½çš„åŸå› Java 6ä¹‹åï¼Œä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”æ‰€å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†è½»é‡çº§é”å’Œåå‘é”. Monitorå¯ä»¥ç†è§£ä¸ºä¸€ç§åŒæ­¥å·¥å…· ï¼Œä¹Ÿå¯ç†è§£ä¸ºä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œå¸¸å¸¸è¢«æè¿°ä¸ºä¸€ä»·Javaå¯¹è±¡ã€‚Javaå¯¹è±¡æ˜¯å¤©ç”Ÿçš„Monitorï¼Œæ¯ä¸€ä¸ªJavaå¯¹è±¡éƒ½æœ‰æˆä¸ºMonitorçš„æ½œè´¨ï¼Œå› ä¸ºåœ¨Jvaçš„è®¾è®¡ä¸­ï¼Œæ¯ä¸€ä¸ªJavaå¯¹è±¡è‡ªæ‰“å¨˜èƒé‡Œå‡ºæ¥å°±å¸¦äº†ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼Œå®ƒå«åšå†…éƒ¨é”æˆ–è€…Monitoré”ã€‚ Monitorçš„æœ¬è´¨æ˜¯ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿçš„Mutex Lockå®ç°ï¼Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢éœ€è¦ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„è½¬æ¢ï¼Œæˆæœ¬éå¸¸é«˜ã€‚ é”çš„æŒ‡å‘åå‘é”: MarkWordå­˜å‚¨çš„æ˜¯åå‘çš„çº¿ç¨‹ID;è½»é‡é”: MarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘çº¿ç¨‹æ ˆä¸­Lock Recordçš„æŒ‡é’ˆ;é‡é‡é”: MarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘å †ä¸­çš„monitorå¯¹è±¡çš„æŒ‡é’ˆ;åå‘é”çš„æ’¤é”€å½“æœ‰å¦å¤–çº¿ç¨‹é€æ­¥æ¥ç«äº‰é”çš„æ—¶å€™ï¼Œå°±ä¸èƒ½å†ä½¿ç”¨åå‘é”äº†ï¼Œè¦å‡çº§ä¸ºè½»é‡çº§é”ç«äº‰çº¿ç¨‹å°è¯•CASæ›´æ–°å¯¹è±¡å¤´å¤±è´¥ï¼Œä¼šç­‰å¾…åˆ°å…¨å±€å®‰å…¨ç‚¹ã€Šæ­¤æ—¶ä¸ä¼šæ‰§è¡Œä»»ä½•ä»£ç ) æ’¤é”€åå‘é”ã€‚åå‘é”çš„æ’¤é”€() åå‘é”ä½¿ç”¨ä¸€ç§ç­‰åˆ°ç«äº‰å‡ºç°æ‰é‡Šæ”¾é”çš„æœºåˆ¶ï¼Œåªæœ‰å½“å…¶ä»–çº¿ç¨‹ç«äº‰é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„åŸæ¥çº¿ç¨‹æ‰ä¼šè¢«æ’¤é”€æ’¤é”€éœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹(è¯¥æ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œ)ï¼ŒåŒæ—¶æ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦è¿˜åœ¨æ‰§è¡Œ: 1ç¬¬ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œsynchronizedæ–¹æ³•(å¤„äºåŒæ­¥å—)ï¼Œå®ƒè¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå…¶å®ƒçº¿ç¨‹æ¥æŠ¢å¤ºï¼Œè¯¥åå‘é”ä¼šè¢«å–æ¶ˆæ‰å¹¶å‡ºç°é”å‡çº§æ­¤æ—¶è½»é‡çº§é”ç”±åŸæŒæœ‰åå‘é”çš„çº¿ç¨‹æŒæœ‰ï¼Œç»§ç»­æ‰§è¡Œå…¶åŒæ­¥ä»£ç ï¼Œè€Œæ­£åœ¨ç«äº‰çš„çº¿ç¨‹ä¼šè¿›å…¥è‡ªæ—‹ç­‰å¾…è·å¾—è¯¥è½»é‡çº§é”ã€‚ 2ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆsynchronizedæ–¹æ³•(é€€å‡ºåŒæ­¥å—)ï¼Œåˆ™å°†å¯¹è±¡å¤´è®¾ç½®æˆæ— é”çŠ¶æ€å¹¶æ’¤é”€åå‘é”ï¼Œé‡æ–°åå‘ã€‚ è½»é‡é”è½»é‡çº§é”çš„åŠ é”JVMä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åœ¨å½“å‰çº¿ç¨‹çš„é¾™ä¸­åˆ›å¾‹ç”¨åƒå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå®˜æ–¹æˆä¸ºDisplaced Mark wrdã€‚è‹¥ä¸€ä¸ªçº¿ç¨‹è·å¾—é”æ—¶å‘ç°æ˜¯é‡çº§é”ï¼Œä¼šæŠŠé”çš„MarkWordå¤åˆ¶åˆ°è‡ªå·±çš„Displaced Mark Wordé‡Œé¢ã€‚ç„¶åçº¿ç¨‹å°è¯•ç”¨CASå°†é”çš„MarkWordæ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºMark Wordå·²ç»è¢«æ›¿æ¢æˆäº†å…¶ä»–çº¿ç¨‹çš„é”è®°å½•ï¼Œè¯´æ˜åœ¨ä¸å…¶å®ƒçº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰ç¨‹å°±å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚è‡ªæ—‹CAS:ä¸æ–­å°è¯•å»è·å–é”ï¼Œèƒ½ä¸å‡çº§å°±ä¸å¾€ä¸Šæ…ï¼Œå°½é‡ä¸è¦é˜»å¡è½»é‡çº§é”çš„é‡Šæ”¾åœ¨é‡Šæ”¾é”æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šä½¿ç”¨CASæ“ä½œå°†Displaced Mak Wordçš„å†…å®¹å¤åˆ¶å›é”çš„Mark Wordé‡Œé¢ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿç«äº‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤åˆ¶çš„æ“ä½œä¼šæˆåŠŸã€‚å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹å› ä¸ºç™½æ—‹å¤šæ¬¡å¯¼è‡´è½»é‡çº§é”å‡çº§æˆäº†é‡é‡çº§é”ï¼Œé‚£ä¹ˆCASæ“ä½œä¼šå¤±è´¥ï¼Œæ­¤æ—¶ä¼šé‡Šæ”¾é”å¹¶å”¤é†’è¢«é˜³çš„çº¿ç¨‹ã€‚é‡é‡çº§é”é‡é‡çº§é”åŸç†æŒ‡å‘äº’æ–¥é‡ (é‡é‡çº§é”)çš„æŒ‡é’ˆJavaä¸­synchronizedçš„é‡é‡çº§é”ï¼Œæ˜¯åŸºäºè¿›å…¥å’Œé€€å‡ºMonitorå¯¹è±¡å®ç°çš„ã€‚åœ¨ç¼–è¯‘æ—¶ä¼šå°†åŒæ­¥å—çš„å¼€å§‹ä½ç½®æ’å…¥monitor enteræŒ‡ä»¤ï¼Œåœ¨ç»“æŸä½ç½®æ’å…¥monitor exitæŒ‡ä»¤ã€‚å½“çº¿ç¨‹æ‰§è¡Œåˆ°monitor enteræŒ‡ä»¤æ—¶ï¼Œä¼šå°è¯•è·å–å¯¹è±¡æ‰€å¯¹åº”çš„Monitoræ‰€æœ‰æƒï¼Œå¦‚æœè·å–åˆ°äº†ï¼Œå³è·å–åˆ°äº†é”ï¼Œä¼šåœ¨Monitorçš„ownerä¸­å­˜æ”¾å½“å‰çº¿ç¨‹çš„idï¼Œè¿™æ ·å®ƒå°†å¤„äºé”å®šçŠ¶æ€ï¼Œé™¤éé€€å‡ºåŒæ­¥å—ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹æ— æ³•è·å–åˆ°è¿™ä¸ªMonitorã€‚ é”å‡çº§çš„æ€»ç»“ ==åœ¨æ— é”çŠ¶æ€ä¸‹==ï¼ŒMark Wordä¸­å¯ä»¥å­˜å‚¨å¯¹è±¡çš„identity hash codeå€¼ã€‚å½“å¯¹è±¡çš„hashCode0)æ–¹æ³•ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ï¼ŒJVMä¼šç”Ÿæˆå¯¹åº”çš„dentity hash codeå€¼å¹¶å°†è¯¥å€¼å­˜å‚¨åˆ°Mark Wordä¸­ã€‚ ==å¯¹å¹²åç™½é”==ï¼Œåœ¨çº¿ç¨‹è·å–åå‘é”æ—¶ï¼Œä¼šç”¨Thread IDå’Œepochå€¼è¦†ç›–identity hash codeæ‰€åœ¨çš„ä½ç½®ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡çš„hashCode0)æ–¹æ³•å·²ç»è¢«è°ƒç”¨è¿‡ä¸€æ¬¡ä¹‹åï¼Œè¿™ä¸ªå¯¹è±¡ä¸èƒ½è¢«è®¾ç½®åå‘é”ã€‚å› ä¸ºå¦‚æœå¯ä»¥çš„åŒ–ï¼Œé‚£Mark Wordä¸­çš„identity hash codeå¿…ç„¶ä¼šè¢«åå‘çº¿ç¨‹idç»™è¦†ç›–ï¼Œè¿™å°±ä¼šé€ æˆåŒä¸€ä¸ªå¯¹è±¡å‰åä¸¤æ¬¡è°ƒç”¨hashCode()æ–¹æ³•å¾—åˆ°çš„ç»“æœä¸ä¸€è‡´ã€‚ ==å‡çº§ä¸ºè½»é‡çº§é”æ—¶==ï¼ŒJVMä¼šåœ¨å½“å‰çº¿ç¨‹çš„æ ˆé¡ºä¸­åˆ›å¾‹ä¸€ä¸ªé”è®°å½•Lock Record)ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡çš„Mark Wordæ‹·è´ï¼Œè¯¥æ®è´ä¸­å¯ä»¥åŒ…å«identity hash codeï¼Œæ‰€ä»¥è½»é‡çº§é”å¯ä»¥å’Œidentity hash codeå…±å­˜ï¼Œå“ˆå¸Œç å’ŒGCå¹´é¾„è‡ªç„¶ä¿å­˜åœ¨æ­¤ï¼Œé‡Šæ”¾é”åä¼šå°†è¿™äº›ä¿¡æ¯å†™å›åˆ°å¯¹è±¡å¤´ã€‚ ==å‡çº§ä¸ºé‡é‡çº§é”å==ï¼ŒMark Wordä¿å­˜çš„é‡é‡çº§é”æŒ‡é’ˆï¼Œä»£è¡¨é‡é‡çº§é”çš„bjectMonitorç±»é‡Œæœ‰å­—æ®µè®°å½•éåŠ é”çŠ¶æ€ä¸‹çš„Mark Wordï¼Œé”é‡Šæ”¾åä¹Ÿä¼šå°†ä¿¡æ¯å†™å›åˆ°å¯¹è±¡å¤´ã€‚ AQSæ—¢ç„¶è¯´åˆ°äº†æ’é˜Ÿç­‰å€™æœºåˆ¶ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¼šæœ‰æŸç§é˜Ÿåˆ—å½¢æˆï¼Œè¿™æ ·çš„é˜Ÿåˆ—æ˜¯ä»€ä¹ˆæ•°æ®ç»“æ„å‘¢?å¦‚æœå…±äº«èµ„æºè¢«å ç”¨ï¼Œå°±éœ€è¦ä¸€å®šçš„é˜»å¡ç­‰å¾…å”¤é†’æœºåˆ¶æ¥ä¿è¯é”åˆ†é…ã€‚è¿™ä¸ªæœºåˆ¶ä¸»è¦ç”¨çš„æ˜¯CLHé˜Ÿåˆ—çš„å˜ä½“å®ç°çš„ï¼Œå°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°±æ˜¯AQSåŒæ­¥é˜Ÿåˆ—çš„æŠ½è±¡è¡¨ç°ã€‚å®ƒå°†è¦è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹åŠè‡ªèº«çš„ç­‰å¾…çŠ¶æ€å°è£…æˆé˜Ÿåˆ—çš„ç»“ç‚¹å¯¹è±¡(Node)ï¼Œé€šè¿‡CASã€è‡ªæ—‹ä»¥åŠLockSupport.park0)çš„æ–¹å¼ï¼Œç»´æŠ¤tateå˜é‡çš„çŠ¶æ€ï¼Œä½¿å¹¶å‘è¾¾åˆ°åŒæ­¥çš„æ•ˆæœã€‚ åŸç†AQSä½¿ç”¨ä¸€ä¸ªvolatieçš„intç±»å‹çš„æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çš„æ’é˜Ÿå·¥ä½œå°†æ¯æ¡è¦å»æŠ¢å èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªNodeèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ï¼Œé€šè¿‡CASå®Œæˆå¯¹Stateå€¼çš„ä¿®æ”¹ AQS(AbstractQueuedSynchronizer) abstract static class Sync extends AbstractQueuedSynchronizer static final class NonfairSync extends Sync//éå…¬å¹³ static final class FairSync extends Sync //å…¬å¹³ //ä»¥éå…¬å¹³ä¸ºä¾‹å­è·Ÿè¸ª final void lock() { if (compareAndSetState(0, 1))//è‡ªæ—‹ä¿®æ”¹çŠ¶æ€ (Thread.currentThread());//æŠŠå½“å‰é”çš„æŒæœ‰åˆ™ else acquire(1); } =======================================ç¬¬ä¸€éƒ¨åˆ†===================================================================== /** 1å°è¯•åŠ é” 2åŠ é”å¤±è´¥çº¿ç¨‹å…¥é˜Ÿ3çº¿ç¨‹å…¥é˜Ÿåï¼Œçº¿ç¨‹è¿›å…¥é˜»å¡ */ public final void acquire(int arg) { if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt(); } //å…·ä½“çš„å­ç±»å®ç°NonfairSync protected final boolean tryAcquire(int acquires) { return nonfairTryAcquire(acquires); } /** *æƒ…å†µä¸€ æŸ¥çœ‹å½“å‰çŠ¶æ€æ˜¯å¦ç­‰äº0ï¼Œå¦‚æœæ˜¯å°±è¿›å…¥è‡ªæ—‹å°è¯•ä¿®æ”¹çŠ¶æ€ï¼Œå¹¶æŠŠå½“å‰çº¿ç¨‹ è®¾ç½®é”çš„æ‹¥æœ‰è€…ã€‚è¿”å›true, å½“å‰çº¿ç¨‹çš„æ˜¯å¦å’Œé”çš„æŒæœ‰è€…ä¸€åŒä¸€çº¿ç¨‹ï¼Œæ˜¯å°±æ›´æ”¹é”çš„çŠ¶æ€ï¼Œ */ final boolean nonfairTryAcquire(int acquires) { final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) { if (compareAndSetState(0, acquires)) { setExclusiveOwnerThread(current); return true; } } else if (current == getExclusiveOwnerThread()) { int nextc = c + acquires; //æ›´æ–°é”çš„çŠ¶æ€ if (nextc &lt; 0) // overflow throw new Error(\"Maximum lock count exceeded\"); setState(nextc); return true; } return false; } ====================================================ç¬¬äºŒéƒ¨åˆ†=================================================================== //åŠ å…¥å¯¹è±¡ç­‰ private Node addWaiter(Node mode) { Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure Node pred = tail; if (pred != null) {//ä¸æ˜¯ç¬¬ä¸€åˆ›å»ºé˜Ÿåˆ—ï¼Œåç»­çš„èŠ‚ç‚¹è¿›æ¥ç›´æ¥å°±æ·»åŠ çš„åŒç«¯é˜Ÿåˆ—çš„æœ«å°¾ node.prev = pred; if (compareAndSetTail(pred, node)) { pred.next = node; return node; } } enq(node); //å…¥é˜Ÿï¼Œé˜Ÿåˆ—åˆå§‹åŒ– return node; } // ç¬¬ä¸€è¿›å…¥é˜Ÿåˆ—çš„ private Node enq(final Node node) { for (;;) { Node t = tail; if (t == null) { // Must initialize if (compareAndSetHead(new Node())) //åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹é¦–å°¾ç›¸è¿ //è‡ªæ—‹ tail = head; } else { node.prev = t; if (compareAndSetTail(t, node)) { // //è‡ªæ—‹ t.next = node; //æŠŠåˆšè¿›æ¥çš„èŠ‚ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ— return t; } } } } //å°è¯•è·å¾—é”ï¼Œæ²¡æœ‰è·å¾—å°±é˜»å¡ç­‰å¾…å”¤é†’ final boolean acquireQueued(final Node node, int arg) { boolean failed = true; try { boolean interrupted = false; for (;;) { final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) { setHead(node); p.next = null; // help GC failed = false; return interrupted; } if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; } } finally { if (failed) cancelAcquire(node); } } //ç­‰å¾…å”¤é†’ä¹‹å‰ä¿®æ”¹èŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€ private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) { int ws = pred.waitStatus; if (ws == Node.SIGNAL) return true; if (ws &gt; 0) { do { node.prev = pred = pred.prev; } while (pred.waitStatus &gt; 0); pred.next = node; } else { compareAndSetWaitStatus(pred, ws, Node.SIGNAL); } return false; } //çº¿ç¨‹é˜»å¡ ä¸­æ–­æœºåˆ¶ private final boolean parkAndCheckInterrupt() { LockSupport.park(this);//é˜»å¡ return Thread.interrupted(); //ä¸­æ–­æ ‡å¿—è·å¾—é”çš„çº¿ç¨‹æ ‡å¿—ï¼Œåå•†ã€‚éœ€è¦è·å¾—é”è‡ªè¡Œå†³å®šæ˜¯å¦æ˜¯å¦ } ====================================ç¬¬ä¸‰éƒ¨åˆ†================================================================================ /*** å–æ¶ˆç­‰å¾… */ private void cancelAcquire(Node node) { // Ignore if node doesn't exist if (node == null) return; node.thread = null; Node pred = node.prev; while (pred.waitStatus &gt; 0) node.prev = pred = pred.prev; //ç§»é™¤èŠ‚ç‚¹ Node predNext = pred.next; node.waitStatus = Node.CANCELLED; if (node == tail &amp;&amp; compareAndSetTail(node, pred)) {//å°è¯•ä¿®æ”¹å½“å‰çš„çš„å°¾éƒ¨ compareAndSetNext(pred, predNext, null); } else { int ws; if (pred != head &amp;&amp; ((ws = pred.waitStatus) == Node.SIGNAL || (ws &lt;= 0 &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp; //ä¿®æ”¹ å‰é¢èŠ‚ç‚¹å”¤é†’çŠ¶æ€ pred.thread != null) { Node next = node.next; if (next != null &amp;&amp; next.waitStatus &lt;= 0) compareAndSetNext(pred, predNext, next); } else { unparkSuccessor(node);//è·å¾—é‡Šæ”¾é”å¹¶æ”¹å˜status çš„çŠ¶æ€ } node.next = node; // help GC } } private void unparkSuccessor(Node node) { int ws = node.waitStatus; if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); //CAS ä¿®æ”¹å€¼ Node s = node.next; if (s == null || s.waitStatus &gt; 0) { s = null; for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; } if (s != null) LockSupport.unpark(s.thread);//è§£é” } AQSå®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼ï¼šExclusiveï¼ˆç‹¬å ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLockï¼‰å’ŒShareï¼ˆå…±äº«ï¼Œå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚Semaphore/CountDownLatchï¼‰å˜é‡transient volatile Node headwaiteré˜Ÿåˆ—çš„å¤´ï¼Œåˆšå¼€å§‹æ—¶æ˜¯ä¸€ä¸ªå•¥éƒ½æ²¡æœ‰çš„ç»“ç‚¹ï¼Œåé¢è§£é”ä¸€ä¸ªå»æ‰ä¸€ä¸ªtransient volatile Node tailwaiteré˜Ÿåˆ—çš„å°¾ï¼Œç¬¬ä¸€æ¬¡ä¸Šé”æ²¡é”ä¸Šçš„å¾€åè¾¹æ’ï¼Œæ¯å½“ä¸€ä¸ªå€’éœ‰è›‹æ²¡æœ‰è·å¾—é”ï¼Œå°±åŠ å…¥é˜Ÿåˆ—volatile int stateä¸åŒçš„è‡ªå®šä¹‰åŒæ­¥å™¨äº‰ç”¨å…±äº«èµ„æºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚è‡ªå®šä¹‰åŒæ­¥å™¨åœ¨å®ç°æ—¶åªéœ€è¦å®ç°å…±äº«èµ„æºstateçš„è·å–ä¸é‡Šæ”¾æ–¹å¼å³å¯æ–¹æ³•(æœªå…·ä½“å®ç°ï¼ŒåªæŠ›å¼‚å¸¸)tryAcquire(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falsetryRelease(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falsetryAcquireShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºtryReleaseShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å›falseæ–¹æ³•ï¼ˆå·²å®ç°ï¼‰acquire(int)public final void acquire(int arg) { if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt(); } tryAcquire()å°è¯•ç›´æ¥å»è·å–èµ„æºï¼Œå¦‚æœæˆåŠŸåˆ™ç›´æ¥è¿”å›ï¼ˆè¿™é‡Œä½“ç°äº†éå…¬å¹³é”ï¼Œæ¯ä¸ªçº¿ç¨‹è·å–é”æ—¶ä¼šå°è¯•ç›´æ¥æŠ¢å åŠ å¡ä¸€æ¬¡ï¼Œè€ŒCLHé˜Ÿåˆ—ä¸­å¯èƒ½è¿˜æœ‰åˆ«çš„çº¿ç¨‹åœ¨ç­‰å¾…ï¼‰ï¼›addWaiter()å°†è¯¥çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œå¹¶æ ‡è®°ä¸ºç‹¬å æ¨¡å¼ï¼›acquireQueued()ä½¿çº¿ç¨‹é˜»å¡åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­è·å–èµ„æºï¼Œä¸€ç›´è·å–åˆ°èµ„æºåæ‰è¿”å›ã€‚å¦‚æœåœ¨æ•´ä¸ªç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚(è‡ªæ—‹)å¦‚æœçº¿ç¨‹åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œå®ƒæ˜¯ä¸å“åº”çš„ã€‚åªæ˜¯è·å–èµ„æºåæ‰å†è¿›è¡Œè‡ªæˆ‘ä¸­æ–­selfInterrupt()ï¼Œå°†ä¸­æ–­è¡¥ä¸Šã€‚release(int)tryRelease(int)ï¼ŒtryRelease()éƒ½ä¼šæˆåŠŸçš„ï¼Œå› ä¸ºè¿™æ˜¯ç‹¬å æ¨¡å¼ï¼Œè¯¥çº¿ç¨‹æ¥é‡Šæ”¾èµ„æºï¼Œé‚£ä¹ˆå®ƒè‚¯å®šå·²ç»æ‹¿åˆ°ç‹¬å èµ„æºäº†ï¼Œç›´æ¥å‡æ‰ç›¸åº”é‡çš„èµ„æºå³å¯(state-=arg)ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚releaseæ˜¯æ ¹æ®tryRelease()çš„è¿”å›å€¼æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å·²ç»å®Œæˆèµ„æºé‡Šæ”¾ã€‚æ‰€ä»¥å®ç°æ—¶ï¼Œ(state=0)ï¼Œè¦è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚unparkSuccessor(Node) ç”¨LockSupport.unpark()æ–¹æ³•å”¤é†’é˜Ÿåˆ—ä¸­æœ€æ¬ æ‰çš„é‚£ä¸ªæœªæ”¾å¼ƒçš„çº¿ç¨‹ã€‚ä¸€èˆ¬æ¥è¯´å½“å‰ç»“ç‚¹çš„åä¸€ä¸ªç»“ç‚¹å°±æ˜¯ä¸‹ä¸€ä¸ªï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½åé¢çš„ç»“ç‚¹æ”¾å¼ƒäº†ï¼Œè¿™æ—¶ä»å°¾å·´ä¸€ç›´å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½è·‘çš„å°±è®©ä»–è·‘å†…éƒ¨ç±»Nodeå˜é‡volatile Node prev å‰é©±volatile Node next åç»§volatile int waitStatus CANCELLED = 1ï¼šè¡¨ç¤ºå½“å‰ç»“ç‚¹å·²å–æ¶ˆè°ƒåº¦ã€‚å½“timeoutæˆ–è¢«ä¸­æ–­ï¼ˆå“åº”ä¸­æ–­çš„æƒ…å†µä¸‹ï¼‰ï¼Œä¼šè§¦å‘å˜æ›´ä¸ºæ­¤çŠ¶æ€ï¼Œè¿›å…¥è¯¥çŠ¶æ€åçš„ç»“ç‚¹å°†ä¸ä¼šå†å˜åŒ–ã€‚ é»˜è®¤å€¼0 æ–°èŠ‚ç‚¹å…¥é˜Ÿæ—¶é»˜è®¤çŠ¶æ€ SIGNAL = -1åç»§ç»“ç‚¹åœ¨ç­‰å¾…å½“å‰ç»“ç‚¹å”¤é†’ï¼Œåè®°ç»“ç‚¹å…¥é˜Ÿæ—¶ï¼Œä¼šå°†å‰é©±ç»“ç‚¹æ›´æ–°æœªSIGNAL CONDITION = -2è¡¨ç¤ºç»“ç‚¹ç­‰å¾…åœ¨Conditionä¸Šï¼Œå½“å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†Conditionçš„signal()æ–¹æ³•åCONDITIONçŠ¶æ€çš„ç»“ç‚¹å°†ä»ç­‰å¾…é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è·å–åŒæ­¥é” PROPAGATE = -3å…±äº«æ¨¡å¼ä¸‹ï¼Œå‰ç»§ç»“ç‚¹ä¸ä»…ä¼šå”¤é†’å…¶åç»§ç»“ç‚¹ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½ä¼šå”¤é†’åç»§çš„åç»§ç»“ç‚¹ã€‚ Node nextWaitervolatile Thread thread+æŠ¢é”çš„çº¿ç¨‹ ConditionObjectçº¿ç¨‹æ± ==çº¿ç¨‹æ± ç”¨è¿‡å—ï¼ŸThreadPoolExecutorè°ˆè°ˆä½ çš„ç†è§£==çº¿ç¨‹==ä¼˜åŠ¿== çº¿ç¨‹æ± åšçš„å·¥ä½œä¸»è¦æ˜¯æ§åˆ¶è¿è¡Œçš„çº¿ç¨‹çš„æ•°é‡.å¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—.ç„¶ååœ¨çº¿ç¨‹åˆ›å»ºåå¯åŠ¨è¿™äº›ä»»åŠ¡å¦‚æœçº¿ç¨‹æ•°é‡è¶…è¿‡äº†æœ€å¤§æ•°é‡è¶…å‡ºæ•°é‡çš„çº¿ç¨‹æ’é˜Ÿç­‰å€™,ç­‰å…¶å®ƒçº¿ç¨‹æ‰§è¡Œå®Œæ¯•,å†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚ å®ƒçš„ä¸»è¦ç‰¹ç‚¹ä¸º:çº¿ç¨‹å¤ç”¨;æ§åˆ¶æœ€å¤§å¹¶å‘æ•°:;ç®¡ç†çº¿ç¨‹ ç¬¬ä¸€:é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€— ç¬¬äºŒ:æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶,ä»»åŠ¡å¯ä»¥ä¸éœ€è¦çš„ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œ ç¬¬ä¸‰:æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºå¦‚æœæ— é™åˆ¶çš„åˆ›å»º,ä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…è°ƒä¼˜å’Œç›‘æ§ çº¿ç¨‹æ± å¦‚ä½•ä½¿ç”¨Executors.newScheduledThreadPool()JDK1.8 Executors.newScheduledThreadPool(int)Executors.newFixedThreadPool(integer); åœºæ™¯ï¼šæ‰§è¡Œé•¿æœŸçš„ä»»åŠ¡ï¼Œæ€§èƒ½å¥½å¾ˆå¤š ä¸»è¦çš„ç‰¹ç‚¹ï¼š public static ExecutorService newFixedThreadPool(int nThreads){ return new ThreadPoolExecutor(nThreadsï¼ŒnThreads,keepAliveTime:0Lï¼ŒTimeUnit.MILLISECONDSnew LinkedBlockingQueue&lt;Runnable&gt;()) } åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± å¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°è¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚ newFixedThreadPoolåˆ›å»ºçš„çº¿ç¨‹æ±  corePoolsizeå’Œ maximumPoolsizeå€¼æ˜¯ç›¸ç­‰çš„å®ƒä½¿ç”¨çš„ LinkedBlockingQueue xecutors.newSingleThreadExecutor(); ä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œçš„åœºæ™¯ ä¸»è¦çš„ç‰¹ç‚¹ï¼š public static ExecutorService newSingleThreadExecutor(){ return new FinalizableDelegatedExecutorService(new ThreadPoolExecutor( corePoolSize: 1ï¼ŒmaxmumPoolSize: 1keepAliveTime: 0LTimeUnit.MILLISECONDSnew LinkedBlockingQueue&lt;Runnable&gt;()) } åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ,å®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡,ä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåºæ‰§è¡Œã€‚ newSingleThreadExecutorå°† corePoolsizeå’Œ maximumPoolsizeéƒ½è®¾ç½®ä¸º1å®ƒä½¿ç”¨çš„LinkedBlockingQueue Executors.newCachedThreadPool() é€‚ç”¨ï¼šæ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥çš„å°ç¨‹åºæˆ–è€…è´Ÿè½½æ¯”è¾ƒè½»çš„æœåŠ¡å™¨ ä¸»è¦çš„ç‰¹ç‚¹ï¼š public static ExecutorService newCachedThreadPool(){ return new ThreadPoolExecutor( corePoolSize: 0,Integer.MAX VALUE,keepAliveTime: 60Lï¼ŒTimeUnit.SECONDSnew SynchronousQueue&lt;Runnable&gt;()); } åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ,å¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦,å¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹,è‹¥æ— å¯å›æ”¶,åˆ™æ–°å»ºçº¿ç¨‹ã€‚ newCachedThreadPoolå°† corePoolsizeè®¾ç½®ä¸º0,å°† maximumPoolsizeè®¾ç½®ä¸ºInteger.MAXVALUEä½¿ç”¨çš„synchronousQueue,ä¹Ÿå°±æ˜¯è¯´æ¥äº†ä»»åŠ¡å°±åˆ›å»ºçº¿ç¨‹è¿è¡Œå½“çº¿ç¨‹ç©ºé—²è¶…è¿‡60ç§’å°±é”€æ¯çº¿ç¨‹ ==çº¿ç¨‹æ± çš„å‡ ä¸ªé‡è¦å‚æ•°ä»‹ç»ï¼Ÿ==7å¤§å‚æ•°int corePoolSize çº¿ç¨‹æ± ä¸­çš„å¸¸é©»æ ¸å¿ƒçº¿ç¨‹æ•° int maximumPoolSize çº¿ç¨‹æ± èƒ½å¤Ÿå®¹çº³åŒæ—¶æ‰§è¡Œçš„æœ€å¤§çº¿ç¨‹æ•°,æ­¤å€¼å¿…é¡»å¤§äºç­‰äº1 long keepAliveTimeåœ¨åˆ›å»ºäº†çº¿ç¨‹æ± å,å½“æœ‰è¯·æ±‚ä»»åŠ¡æ¥ä¹‹å,å°±ä¼šå®‰æ’æ± ä¸­çš„çº¿ç¨‹å»æ‰§è¡Œè¯·æ±‚ä»»åŠ¡,è¿‘ä¼¼ç†è§£ä¸ºä»Šæ—¥å½“å€¼çº¿ç¨‹,å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ° core PoolSizeåå°±ä¼šæŠŠåˆ°è¾¾çš„ä»»åŠ¡æ”¾åˆ°ç¼“æœ‰é˜Ÿåˆ—ä¸­ å¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ã€‚çº¿ç¨‹æ± æ•°é‡è¶…è¿‡ core poolsizeæ—¶,å½“ç©ºé—²æ—¶é—´è¾¾åˆ° keepAliveTimeå€¼æ—¶ å¤šä½™ç©ºé—²çº¿ç¨‹ä¼šè¢«é”€æ¯ç›´åˆ°åªå‰©ä¸‹ core Poolsizeä¸ªçº¿ç¨‹ä¸ºæ­¢ TimeUnit unit keepAliveTimeçš„å•ä½ BlockingQueue workQueue ä»»åŠ¡é˜Ÿåˆ—,è¢«æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„ä»»åŠ¡ã€‚ ThreadFactory threadFactory ç”Ÿæˆçº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹å·¥å‚,ç”¨äºåˆ›å»ºçº¿ç¨‹ä¸€èˆ¬ç”¨é»˜è®¤çš„å³å¯ RejectedExecutionHandler handler æ‹’ç»ç­–ç•¥,è¡¨ç¤ºå½“é˜Ÿåˆ—æ»¡äº†å¹¶ä¸”å·¥ä½œçº¿ç¨‹å¤§äºç­‰äºçº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°(maximumpoolsize)æ—¶æ‹’ç»è¯·æ±‚æ‰§è¡Œçš„ç­–ç•¥ ==è€ƒç‚¹çº¿ç¨‹æ± åº•å±‚åŸç†== åœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åç­‰å¾…æäº¤è¿‡æ¥çš„ä»»åŠ¡è¯·æ±‚ 2å½“è°ƒç”¨execute(æ–¹æ³•æ·»åŠ ä¸€ä¸ªè¯·æ±‚ä»»åŠ¡æ—¶çº¿ç¨‹æ± ä¼šåšå¦‚ä¸‹åˆ¤æ–­ 2.1å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äºcorePoolsize,é‚£ä¹ˆé©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡ 2.2å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äºcorePoolsizeé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ— 2.3å¦‚æœè¿™æ—¶å€™é˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¿˜å°äº maximumPoolsizeé‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡, 2.4å¦‚æœé˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äºmaximumPoolsizeé‚£ä¹ˆçº¿ç¨‹æ± ä¼šå¯åŠ¨é¥±å’Œæ‹’ç»ç­–ç•¥æ¥æ‰§è¡Œã€‚ 3å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶,å®ƒä¼šä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œ 4å½“ä¸€ä¸ªçº¿ç¨‹æ— äº‹å¯åšè¶…è¿‡ä¸€å®šçš„æ—¶é—´( keepAliveTime)æ—¶çº¿ç¨‹æ± ä¼š==åˆ¤æ–­== å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äºcorePoolsizeé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«åœæ‰æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ°corePoolsizeçš„å¤§å° ==ç”Ÿäº§ä¸Šä½ å¦‚ä½•è®¾ç½®åˆç†å‚æ•°ï¼Ÿ==çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä½ è°ˆè°ˆä»€ä¹ˆæ˜¯æ‹’ç»ç­–ç•¥ ç­‰å¾…é˜Ÿåˆ—ä¹Ÿå·²ç»æ’æ»¡äº†,å†ä¹Ÿå¡ä¸ä¸‹æ–°ä»»åŠ¡äº†åŒæ—¶ï¼Œçº¿ç¨‹æ± ä¸­çš„maxçº¿ç¨‹ä¹Ÿè¾¾åˆ°äº†,æ— æ³•ç»§ç»­ä¸ºæ–°ä»»åŠ¡æœåŠ¡ è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦==æ‹’ç»ç­–ç•¥æœºåˆ¶åˆç†==çš„å¤„ç†è¿™ä¸ªé—®é¢˜ JDKå†…ç½®çš„æ‹’ç»ç­–ç•¥ AbortPolicyl(é»˜è®¤):ç›´æ¥æŠ›å‡º Rejected Execution Exceptionå¼‚å¸¸é˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚ CallerRunsPolicy:â€è°ƒç”¨è€…è¿è¡Œâ€ä¸€ç§è°ƒèŠ‚æœºåˆ¶,è¯¥ç­–ç•¥å‚šä¸ä¼šæŠ›å¼ƒä»»åŠ¡,ä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸,è€Œæ˜¯å°†æŸäº›ä»»åŠ¡å›é€€åˆ°è°ƒç”¨è€…ï¼Œä»è€Œé™ä½æ–°ä»»åŠ¡çš„æµé‡ Discardoldest polic:æŠ›å¼ƒé˜Ÿåˆ—ä¸­ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡,ç„¶åæŠŠå½“å‰ä»»åŠ¡åŠ å…¥é˜Ÿä¸­å°è¯•å†æ¬¡æäº¤å½“å‰ä»¼åŠ¡ã€‚ DiscardPolicy:ç›´æ¥ä¸¢å¼ƒä»»åŠ¡,ä¸äºˆä»»ä½•å¤„ç†ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœå…è®¸ä»»åŠ¡ä¸¢å¤±,è¿™æ˜¯æœ€å¥½çš„ä¸€ç§æ–¹æ¡ˆã€‚ ä»¥ä¸Šå†…ç½®æ‹’ç»ç­–ç•¥å‡å®ç°äº†RejectedExecutionHandleræ¥å£ ==è€ƒç‚¹ï¼šä½ åœ¨å·¥ä½œä¸­å•ä¸€çš„/å›ºå®šæ•°çš„å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•,ä½ ç”¨é‚£ä¸ªå¤š?==ä¸€ä¸ªéƒ½ä¸ç”¨ï¼Œæˆ‘ä»¬ç”Ÿäº§ä¸Šåªèƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„ Executorsä¸­JDKå·²ç»ç»™ä½ æä¾›äº†ï¼Œä¸ºä»€ä¹ˆä¸ç”¨? æ¥è‡ªé˜¿é‡Œå·´å·´å¼€å‘è§„èŒƒæ‰‹å†Œ [å¼ºåˆ¶]**çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨Executors å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ThreadPoolExecutor çš„æ–¹å¼ï¼Œè¿™æ ·è§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œ*è¯´æ˜:Executors è¿”å›çš„çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹:1)FixedThreadPoolå’Œ SingleThreadPoolå…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸ºlntegerMAXVALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´00Mã€‚2)CachedThreadPool å’Œ ScheduledThreadPoo1:å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸ºInteger.MAXVALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚ ==åœ¨å·¥ä½œä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± çš„,æ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± ä½¿ç”¨== æŒ‰ç…§Executorsä¸­çš„ç…§çŒ«ç”»è™å°±å¥½äº†ï¼Œå°±æ˜¯æœ€å¤§çº¿ç¨‹æ•°ä¸è¦ç”¨Integer.MaxValue ==åˆç†é…ç½®çº¿ç¨‹æ± ä½ æ˜¯å¦‚ä½•è€ƒè™‘çš„?== CPUå¯†é›†å‹ CPUå¯†é›†çš„æ„æ€æ˜¯è¯¥ä»»åŠ¡éœ€è¦å¤§é‡çš„è¿ç®—è€Œæ²¡æœ‰é˜»å¡CPUä¸€ç›´å…¨é€Ÿè¿è¡Œ CPUå¯†é›†ä»»åŠ¡åªæœ‰åœ¨çœŸæ­£çš„å¤šæ ¸CPUä¸Šæ‰å¯èƒ½å¾—åˆ°åŠ é€Ÿ(é€šè¿‡å¤šçº¿ç¨‹)ï¼Œè€Œåœ¨å•æ ¸CPUä¸Š(æ‚²å‰§å§? = =!)æ— è®ºä½ å¼€å‡ ä¸ªæ¨¡æ‹Ÿçš„å¤šçº¿ç¨‹è¯¥ä»»åŠ¡éƒ½ä¸å¯èƒ½å¾—åˆ°åŠ é€Ÿå› ä¸ºCPUæ€»çš„è¿ç®—èƒ½åŠ›å°±é‚£äº›ã€‚ CPUå¯†é›†å‹ä»»åŠ¡é…ç½®å°½å¯èƒ½å°‘çš„çº¿ç¨‹æ•°é‡ä¸€èˆ¬å…¬å¼:CPUæ ¸æ•°+1ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ±  IOå¯†é›†å‹ï¼ˆ1Oèœœé›†å‹å³è¯¥ä»»åŠ¡éœ€è¦å¤§é‡çš„IO å³å¤§é‡çš„é˜»å¡ã€‚ï¼‰ ç”±äº10å¯†é›†å‹ä»»åŠ¡çº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´åœ¨æ‰§è¡Œä»»åŠ¡åˆ™åº”é…ç½®å°½å¯èƒ½å¤šçš„çº¿ç¨‹å¦‚cPUæ ¸æ•°â€2 åœ¨å•çº¿ç¨‹ä¸Šè¿è¡ŒIOå¯†é›†å‹çš„ä»»åŠ¡ä¼šå¯¼è‡´æµªè´¹å¤§é‡çš„CPUè¿ç®—èƒ½åŠ›æµªè´¹åœ¨ç­‰å¾…æ‰€ä»¥åœ¨I0å¯†é›†å‹ä»»åŠ¡ä¸­ä½¿ç”¨å¤šçº¿ç¨‹å¯ä»¥å¤§å¤§çš„åŠ é€Ÿç¨‹åºè¿è¡Œå³ä½¿åœ¨å•æ ¸CPUä¸Šè¿™ç§åŠ é€Ÿä¸»è¦å°±æ˜¯åˆ©ç”¨äº†è¢«æµªè´¹æ‰çš„é˜»å¡æ—¶é—´ IOå¯†é›†å‹æ—¶,å¤§éƒ¨åˆ†çº¿ç¨‹éƒ½é˜»å¡æ•…éœ€è¦å¤šé…ç½®çº¿ç¨‹æ•°å‚è€ƒå…¬å¼:CPUæ ¸æ•°/1-é˜³å¡ç³»æ•°é˜»å¡ç³»æ•°åœ¨0.8~09ä¹‹é—´æ¯”å¦‚8æ ¸CPU:8/(1-09)=80ä¸ªçº¿ç¨‹æ•°","categories":[{"name":"ä¸“åˆŠç¯‡","slug":"ä¸“åˆŠç¯‡","permalink":"https://mykkto.github.io/categories/%E4%B8%93%E5%88%8A%E7%AF%87/"}],"tags":[{"name":"juc","slug":"juc","permalink":"https://mykkto.github.io/tags/juc/"},{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://mykkto.github.io/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"author":"æ¨æ±Ÿé•¿"},{"title":"ç°åº¦å‘å¸ƒæ–¹æ¡ˆ","slug":"03-javaåˆ†å¸ƒå¼/08-ç½‘å…³/01-ç°åº¦å‘å¸ƒæ–¹æ¡ˆ","date":"2022-11-27T05:22:33.000Z","updated":"2023-06-11T02:53:45.151Z","comments":true,"path":"posts/f83c265d.html","link":"","permalink":"https://mykkto.github.io/posts/f83c265d.html","excerpt":"","text":"ä»£ç ï¼šhttps://gitee.com/TK_LIMR/springcloud2021To2021.git ç›®å½•ï¼šä¸€ã€gateway å‰ç½®çŸ¥è¯† ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒ ç°åº¦å‘å¸ƒè½åœ°æ–¹æ¡ˆ åŸç†å›¾ æ¡ˆä¾‹ï¼š æœåŠ¡æ³¨å†Œ æ„å»ºç½‘å…³ ç¼–å†™ç°åº¦ç”¨æˆ· äºŒã€openresty â… ã€gateway ç°åº¦ä¸€ã€å‰ç½®çŸ¥è¯†1.nacos æœåŠ¡æ³¨å†Œä¸å‘ç° 2.æœ¬åœ°è´Ÿè½½å‡è¡¡å™¨ç®—æ³• 3.gateway ç½‘å…³ 4.ThreadLocal 1.ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Ÿ2.ä»€ä¹ˆæ˜¯ç°åº¦ç­–ç•¥?3.ç°åº¦å‘å¸ƒè½åœ°æ–¹æ¡ˆæœ‰å“ªäº›4.ç°åº¦å‘å¸ƒæ¶æ„è®¾è®¡åŸç† nginx+luaï¼Ÿ5.å¦‚ä½•åŸºäºGateWay+Nacosæ„å»ºç°åº¦ç¯å¢ƒ6.GateWayè´Ÿè½½å‡è¡¡è·¯ç”±ç®—æ³•åŸç†â€”â€”æ”¹å†™7.å¦‚ä½•é‡å†™æœ¬åœ°è´Ÿè½½å‡è¡¡å™¨ï¼Œèµ°ç°åº¦ç¯å¢ƒ8.ä¸ºä½•ä¸åŸºäºnginx+luaå®ç°ï¼Ÿè€Œä½¿ç”¨GateWay9.ä»£ç è½åœ°å®æˆ˜ï¼šæ„å»ºå¾®æœåŠ¡ç°åº¦å‘å¸ƒç¯å¢ƒ äºŒã€ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒç°åº¦å‘å¸ƒï¼ˆåˆåé‡‘ä¸é›€å‘å¸ƒï¼‰æ˜¯æŒ‡åœ¨é»‘ä¸ç™½ä¹‹é—´ï¼Œèƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡çš„ä¸€ç§å‘å¸ƒæ–¹å¼ã€‚åœ¨å…¶ä¸Šå¯ä»¥è¿›è¡ŒA/B testingï¼Œå³è®©ä¸€éƒ¨åˆ†ç”¨æˆ·ç»§ç»­ç”¨äº§å“ç‰¹æ€§Aï¼Œä¸€éƒ¨åˆ†ç”¨æˆ·å¼€å§‹ç”¨äº§å“ç‰¹æ€§Bï¼Œå¦‚æœç”¨æˆ·å¯¹Bæ²¡æœ‰ä»€ä¹ˆåå¯¹æ„è§ï¼Œé‚£ä¹ˆé€æ­¥æ‰©å¤§èŒƒå›´ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·éƒ½è¿ç§»åˆ°Bä¸Šé¢æ¥ã€‚ç°åº¦å‘å¸ƒå¯ä»¥ä¿è¯æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šï¼Œåœ¨åˆå§‹ç°åº¦çš„æ—¶å€™å°±å¯ä»¥å‘ç°ã€è°ƒæ•´é—®é¢˜ï¼Œä»¥ä¿è¯å…¶å½±å“åº¦ã€‚ ç°åº¦æœŸï¼šç°åº¦å‘å¸ƒå¼€å§‹åˆ°ç»“æŸæœŸé—´çš„è¿™ä¸€æ®µæ—¶é—´ï¼Œç§°ä¸ºç°åº¦æœŸã€‚ ç°åº¦å‘å¸ƒèƒ½åŠæ—©è·å¾—ç”¨æˆ·çš„æ„è§åé¦ˆï¼Œå®Œå–„äº§å“åŠŸèƒ½ï¼Œæå‡äº§å“è´¨é‡ï¼Œè®©ç”¨æˆ·å‚ä¸äº§å“æµ‹è¯•ï¼ŒåŠ å¼ºä¸ç”¨æˆ·äº’åŠ¨ï¼Œé™ä½äº§å“å‡çº§æ‰€å½±å“çš„ç”¨æˆ·èŒƒå›´ã€‚ æ•´åˆæœåŠ¡æ³¨å†Œä¸­å¿ƒ ä¸‰ã€ç°åº¦å‘å¸ƒè½åœ°æ–¹æ¡ˆ1.nginx+lua+nacos å®ç°ï¼ˆéœ€è¦æ‡‚luaè„šæœ¬ï¼‰ï¼Œé€šè¿‡nginxå®ç°æ•ˆç‡é«˜ã€æœ¬bolg æœ‰ lua æ•™ç¨‹ã€‘ 2.gateway+nacos+é‡å†™æœ¬åœ°è´Ÿè½½å‡è¡¡å™¨ ï¼ˆjavaå®ç°ï¼‰â€”javaç¨‹åºå‘˜æ¨è æ€§èƒ½æ²¡æœ‰ç›´æ¥ å››ã€åŸç†å›¾äº”ã€æ¡ˆä¾‹â…¡ã€nginx ç°åº¦ä¸€ã€äºŒã€ä¸‰ã€å››ã€äº”ã€å‚è€ƒæ–‡ç«  â†“docker-nacoså•ä½“ï¼ˆå¿«é€Ÿï¼‰ https://www.jb51.net/article/248585.htm gatway: https://blog.csdn.net/u014001523/article/details/125400266 https://blog.csdn.net/qq_43692950/article/details/125226460?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-1-125226460-blog-125400266.pc_relevant_3mothn_strategy_recovery&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-1-125226460-blog-125400266.pc_relevant_3mothn_strategy_recovery&amp;utm_relevant_index=2 openresty:https://blog.csdn.net/u014001523/article/details/125400318 openfeigné‡å†™ï¼šhttps://www.itmuch.com/spring-cloud-sum/hystrix-threadlocal/","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"gateway","slug":"gateway","permalink":"https://mykkto.github.io/tags/gateway/"},{"name":"ç°åº¦å‘å¸ƒ","slug":"ç°åº¦å‘å¸ƒ","permalink":"https://mykkto.github.io/tags/%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/"},{"name":"nginx","slug":"nginx","permalink":"https://mykkto.github.io/tags/nginx/"}],"author":"mykk"},{"title":"é¢è¯•é¢˜-01","slug":"05-é¢è¯•é¢˜/02-å¤§å‚é¢è¯•é¢˜/é¢è¯•é¢˜_01","date":"2022-10-22T08:16:56.000Z","updated":"2023-06-11T02:53:45.128Z","comments":true,"path":"posts/726c3129.html","link":"","permalink":"https://mykkto.github.io/posts/726c3129.html","excerpt":"","text":"ç›®å½•ï¼š Spring-tx äº‹åŠ¡å¤±æ•ˆåœºæ™¯ æ£€æŸ¥å¼‚å¸¸ é”™è¯¯çš„ try-catch åˆ‡é¢é¡ºåº épublicåœºæ™¯ çˆ¶å­å®¹å™¨ æœ¬ç±»æ–¹æ³•è°ƒç”¨ åŸå­æ€§ï¼ˆé”å¤±æ•ˆï¼‰ æ•°æ®åº“ç´¢å¼•å¤±æ•ˆåœºæ™¯ æºç ï¼šhttps://gitee.com/TK_LIMR/springcloud2021To2021 ä¸€ã€Spring-tx äº‹åŠ¡å¤±æ•ˆåœºæ™¯1ã€æ£€æŸ¥å¼‚å¸¸1ã€å¤±æ•ˆåœºæ™¯è¿™è¾¹æ„é€ ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶æµï¼Œé€ æˆå¼‚å¸¸æ¨¡æ‹Ÿ æ•°æ®åº“æƒ…å†µ å¾ˆæ˜æ˜¾äº‹åŠ¡å¤±æ•ˆäº† 2ã€è§£å†³æ–¹æ¡ˆåŠ ä¸Šæ³¨è§£ï¼Œå®ç°æœ‰æ„ŸçŸ¥å›æ»š 2ã€é”™è¯¯çš„ try-catch1ã€å¤±æ•ˆåœºæ™¯è‡ªå·±try åï¼Œå¤–éƒ¨è°ƒç”¨çš„æ–¹æ³•ï¼Œæ— æ„ŸçŸ¥ï¼Œåˆ™æäº¤äº†æ²¡æœ‰å›æ»š 2ã€è§£å†³æ–¹æ¡ˆæ–¹æ³•ä¸€ï¼š å½“ç”¨ try-catch å‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œæ˜¾ç¤ºçš„å¾€ä¸ŠæŠ›ï¼Œè®©ä¸Šå±‚è°ƒç”¨è€…æ„ŸçŸ¥ æ–¹æ³•äºŒï¼š è°ƒç”¨äº‹åŠ¡æ–¹æ³•ï¼Œå›æ»šåŠŸèƒ½ï¼Œå¯ä»¥æ˜¾ç¤ºçš„æäº¤æˆ–è€…å›æ»šï¼Œå›æ»šæ•ˆæœå’Œå‘ä¸ŠæŠ›å¼‚å¸¸æ—¶ä¸€æ ·çš„ 3ã€åˆ‡é¢é¡ºåº1ã€å¤±æ•ˆåœºæ™¯åŸºäºæ£€æŸ¥å¼‚å¸¸+try-catchçš„å¤„ç†åï¼Œä½¿ç”¨äº†åç½®é€šçŸ¥å‘ç°ä¾ç„¶å›æ»šå¤±è´¥ åŸå›  ä¸»è¦å› ä¸ºå…ˆè¿›å…¥äº‹åŠ¡ï¼Œç„¶åè¿›å…¥åç½®(æœ‰å¼‚å¸¸)ï¼Œåœ¨è¿›å…¥ç›®æ ‡æ–¹æ³•ï¼Œæ­¤æ—¶åç½®å¹¶æ²¡æœ‰å¾€äº‹åŠ¡ä¸ŠæŠ›ï¼Œæ‰€ä»¥æ— æ„ŸçŸ¥ 2ã€è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰è®¾ç½®åç½®çš„ä¼˜å…ˆçº§é«˜äºäº‹åŠ¡ï¼Œè¿™æ ·äº‹åŠ¡åœ¨åé¢è¿è¡Œï¼Œæ—¢å¯ä»¥æ„ŸçŸ¥åˆ°å¼‚å¸¸ æ–¹æ³•ä¸€ åœ¨åˆ‡é¢ catch æ—¶å€™é‡‡ç”¨ æ£€æŸ¥å¼‚å¸¸ æˆ–è€… try-catch ä¸Šé¢ä¸¤ç§æ–¹æ³•åœ¨ åˆ‡é¢æ–¹æ³•æ”¹åŠ¨ æ–¹æ³•äºŒ è®¾ç½®ä¼˜å…ˆçº§é«˜äºäº‹åŠ¡ 4ã€épublicåœºæ™¯1ã€å¤±æ•ˆåœºæ™¯æ–¹æ³•è®¾ç½®ä¸ºé»˜è®¤ épublic ï¼Œäº‹åŠ¡å¤±æ•ˆ 2ã€è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œé»˜è®¤true åªå¯¹ public æ–¹æ³•ç”Ÿæ•ˆ 5ã€çˆ¶å­å®¹å™¨1ã€å¤±æ•ˆåœºæ™¯ç®€å•æ¥è¯´å°±æ˜¯æ”¾åœ¨ controller ä¸Šè°ƒç”¨ serviceï¼Œä¹Ÿæ˜¯å¼€å‘ä¸­å¸¸è§çš„åœºæ™¯ åŸå› ï¼šå­å®¹å™¨æ‰«æèŒƒå›´è¿‡å¤§ï¼ŒæŠŠæœªåŠ äº‹åŠ¡é…ç½®çš„ service æ‰«æè¿›æ¥ 2ã€è§£å†³æ–¹æ¡ˆåœ¨springbooté‡ä¸åˆ°ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªå®¹å™¨ã€‚é€šå¸¸å‡ºç°åœ¨ä¼ ç»Ÿé¡¹ç›®ï¼ˆspring+MVCæ•´åˆçš„æ—¶å€™ï¼‰ï¼Œä¼šé‡åˆ°æ‰«æçˆ¶å­å®¹å™¨ã€‚Springæ‰«spring,MVCæ‰«mvcè‡ªå·±çš„åŒ…ï¼Œå°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰«æ•´ä¸ªä¸Šå±‚åŒ… 6ã€æœ¬ç±»æ–¹æ³•è°ƒç”¨1ã€å¤±æ•ˆåœºæ™¯æœ¬ç±»ä¸¤ä¸ªæ–¹æ³•ç›¸äº’è°ƒç”¨ åŸå›  æœ¬ç±»è°ƒç”¨ï¼Œä¸ç»è¿‡ä»£ç†ï¼Œå› æ­¤æ— æ³•å¢å¼ºï¼Œå¯¼è‡´ä¸¤ä¸ªäº‹åŠ¡å…¬ç”¨ä¸€ä¸ª 2ã€è§£å†³æ–¹æ¡ˆæ–¹æ³•ä¸€ è‡ªå·±æ³¨å…¥è‡ªå·± æ–¹æ³•äºŒ ä» Aopä¸­ä»£ç†è°ƒç”¨ 7ã€åŸå­æ€§ï¼ˆé”å¤±æ•ˆï¼‰1ã€å¤±æ•ˆåœºæ™¯Jmeter æ¨¡æ‹Ÿ100ä¸ªçº¿ç¨‹æ¯ç§’ 2ã€è§£å†³æ–¹æ¡ˆç”¨ synchronize èƒ½è§£å†³ï¼Ÿï¼Ÿ ç­”æ¡ˆï¼šä¸èƒ½ @Transactional æ²¡æœ‰ä¿è¯åŸå­çš„åŸå› ï¼š äº‹åŠ¡çš„åŸå­æ€§ä»…è¦†ç›– inset,update,delete ï¼›select è¯­å¥ä¸è¦†ç›–ï¼Œselect æ–¹æ³•ä¸é˜»å¡ @Transactional å¯¼è‡´ synchronize å¤±æ•ˆçš„åŸå› ï¼š synchronize ä»…ä¿è¯ç›®æ ‡æ–¹æ³•çš„åŸå­æ€§ï¼Œç¯ç»•æ–¹æ³•çš„è¿˜æœ‰ commit (äº‹åŠ¡æäº¤)ç­‰æ“ä½œï¼Œä»–ä»¬å¹¶æœªå¤„äº sync åŒæ­¥å—ä¸­ æ–¹æ¡ˆ1ï¼šï¼ˆä¸æ¨èï¼‰ ä¿®æ”¹ synchronize ä½ç½®èŒƒå›´æ‰©å¤§è‡³ä»£ç†æ–¹æ³•è°ƒç”¨(ä¸Šå±‚å¹¶å‘æ¥å£ä½ç½®) æ–¹æ¡ˆ2ï¼šï¼ˆæ¨èï¼‰ ä¿®æ”¹ SQL è¯­å¥ æŠŠ select æ›¿æ¢æˆ select â€¦for update äºŒã€æ•°æ®åº“ç´¢å¼•å¤±æ•ˆåœºæ™¯1ã€like ä»¥%å¼€å¤´ï¼Œç´¢å¼•æ— æ•ˆï¼›å½“likeå‰ç¼€æ²¡æœ‰%ï¼Œåç¼€æœ‰%æ—¶ï¼Œç´¢å¼•æœ‰æ•ˆ 2ã€orè¯­å¥å‰åæ²¡æœ‰åŒæ—¶ä½¿ç”¨ç´¢å¼• å½“orå·¦å³æŸ¥è¯¢å­—æ®µåªæœ‰ä¸€ä¸ªæ˜¯ç´¢å¼•ï¼Œè¯¥ç´¢å¼•å¤±æ•ˆï¼Œåªæœ‰å½“orå·¦å³æŸ¥è¯¢å­—æ®µå‡ä¸ºç´¢å¼•æ—¶ï¼Œæ‰ä¼šç”Ÿæ•ˆ 3ã€ç»„åˆç´¢å¼•ï¼Œä¸æ˜¯ä½¿ç”¨ç¬¬ä¸€åˆ—ç´¢å¼•ï¼Œç´¢å¼•å¤±æ•ˆ 4ã€å¦‚æœåˆ—ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¸€å®šè¦åœ¨æ¡ä»¶ä¸­å°†æ•°æ®ä½¿ç”¨å¼•å·å¼•ç”¨èµ·æ¥ï¼Œå¦åˆ™ä¸ä½¿ç”¨ç´¢å¼• æ•°æ®ç±»å‹å‡ºç°éšå¼è½¬åŒ–ã€‚å¦‚varcharä¸åŠ å•å¼•å·çš„è¯å¯èƒ½ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºintå‹ï¼Œä½¿ç´¢å¼•æ— æ•ˆï¼Œäº§ç”Ÿå…¨è¡¨æ‰«æã€‚ 5ã€åœ¨ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨notï¼Œ&lt;&gt;ï¼Œ!= ä¸ç­‰äºæ“ä½œç¬¦æ˜¯æ°¸è¿œä¸ä¼šç”¨åˆ°ç´¢å¼•çš„ï¼Œå› æ­¤å¯¹å®ƒçš„å¤„ç†åªä¼šäº§ç”Ÿå…¨è¡¨æ‰«æã€‚ ä¼˜åŒ–æ–¹æ³•ï¼š key&lt;&gt;0 æ”¹ä¸º key&gt;0 or key&lt;0ã€‚ 6ã€å¯¹ç´¢å¼•å­—æ®µè¿›è¡Œè®¡ç®—æ“ä½œ æˆ–è€… å­—æ®µä¸Šä½¿ç”¨å‡½æ•°ã€‚ 7ã€å½“å…¨è¡¨æ‰«æé€Ÿåº¦æ¯”ç´¢å¼•é€Ÿåº¦å¿«æ—¶ï¼Œmysqlä¼šä½¿ç”¨å…¨è¡¨æ‰«æï¼Œæ­¤æ—¶ç´¢å¼•å¤±æ•ˆ ä¸‰ã€1ã€2ã€3ã€4ã€5ã€å‚è€ƒ â†“springboot é…ç½® jdbctemplate :https://blog.csdn.net/u014553029/article/details/101130291 äº‹åŠ¡å¤±æ•ˆå®Œæ•´åœºæ™¯ï¼šhttps://www.csdn.net/tags/MtTagg3sMjU0NTEtYmxvZwO0O0OO0O0O.html ç´¢å¼•å¤±æ•ˆï¼šhttps://m.php.cn/article/487049.html","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://mykkto.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://mykkto.github.io/tags/%E9%9D%A2%E8%AF%95/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"https://mykkto.github.io/tags/%E4%BA%8B%E5%8A%A1/"},{"name":"spring-tx","slug":"spring-tx","permalink":"https://mykkto.github.io/tags/spring-tx/"}],"author":"mykk"},{"title":"RabbitMQ-å…¥é—¨+å®æˆ˜ç¯‡","slug":"03-javaåˆ†å¸ƒå¼/06-æ¶ˆæ¯é˜Ÿåˆ—/01-RabbitMQ","date":"2022-10-08T15:21:32.000Z","updated":"2023-06-11T02:53:45.151Z","comments":true,"path":"posts/faf1dfc8.html","link":"","permalink":"https://mykkto.github.io/posts/faf1dfc8.html","excerpt":"","text":"æºä»£ç ä½ç½®https://gitee.com/TK_LIMR/springcloud2021To2021 ç›®å½•ï¼š å…¥é—¨ æ¦‚è¿° å¿«é€Ÿå…¥é—¨æ¡ˆä¾‹ å·¥ä½œæ¨¡å¼æ¡ˆä¾‹ æ•´åˆSpring æ•´åˆSpringBoot å®æˆ˜ é«˜çº§ç‰¹æ€§ æ¶ˆæ¯å¯é æ€§æŠ•é€’ï¼ˆç”Ÿäº§è€… -&gt; MQï¼‰ Consumer ACK (MQ -&gt; æ¶ˆè´¹è€…) æ¶ˆè´¹ç«¯é™æµ TTL è¿‡æœŸæ—¶é—´ æ­»ä¿¡é˜Ÿåˆ— â˜… å»¶è¿Ÿé˜Ÿåˆ— X æ—¥å¿—ä¸ç›‘æ§ï¼ˆäº†è§£ï¼‰ X æ¶ˆæ¯å¯é æ€§åˆ†æä¸è¿½è¸ªï¼ˆæ…ç”¨ï¼‰ X ç®¡ç† åº”ç”¨é—®é¢˜ æ¶ˆæ¯å¯é æ€§ä¿éšœ æ¶ˆæ¯è¡¥å¿æœºåˆ¶ æ¶ˆæ¯å¹‚ç­‰æ€§å¤„ç† ä¹è§‚é”è§£å†³æ–¹æ¡ˆ é«˜å¯ç”¨é›†ç¾¤æ­å»º â… ã€å…¥é—¨ç¯‡ä¸€ã€æ¦‚è¿°1ã€MQæ¦‚è¿°æ˜¯ä»€ä¹ˆï¼šMQå…¨ç§° Message Queueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œæ˜¯åœ¨æ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ä¸­ä¿å­˜æ¶ˆæ¯çš„å®¹å™¨ã€‚å¤šç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´è¿›è¡Œé€šä¿¡ å°ç»“ï¼š MQï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯çš„ä¸­é—´ä»¶ åˆ†å¸ƒå¼ç³»ç»Ÿé€šä¿¡ä¸¤ç§æ–¹å¼ï¼šç›´æ¥è¿œç¨‹è°ƒç”¨ å’Œ å€ŸåŠ©ç¬¬ä¸‰æ–¹ å®Œæˆé—´æ¥é€šä¿¡ å‘é€æ–¹ç§°ä¸ºç”Ÿäº§è€…ï¼Œæ¥æ”¶æ–¹ç§°ä¸ºæ¶ˆè´¹è€… 2ã€MQä¼˜åŠ¿å’ŒåŠ£åŠ¿1ã€ä¼˜åŠ¿ åº”ç”¨è§£è€¦ å¼‚æ­¥æé€Ÿ å‰Šå³°å¡«è°· 1-1ã€åº”ç”¨è§£è€¦ ä¼ ç»Ÿæ–¹å¼ï¼Œè®¢å•ç³»ç»Ÿè¦å‘é€æŒ‡å®šç³»ç»Ÿï¼Œæˆ–è€…æ‰“æ–­æŒ‡å®šç³»ç»Ÿçš„å‘é€éœ€è¦ä¿®æ”¹è®¢å•ç³»ç»Ÿä»£ç  å¼•å…¥ mqï¼Œå‘é€ç»™mqå³å¯ï¼Œé€‰æ‹©æˆ–è€…æ‰“æ–­æŒ‡å®šç³»ç»Ÿå‘é€åªéœ€è¦æ§åˆ¶ topicè§„åˆ™å³å¯ï¼Œä½¿å¾—åº”ç”¨è§£è€¦ï¼Œæå‡å®¹é”™æ€§å’Œå¯ç»´æŠ¤æ€§ 1-2ã€å¼‚æ­¥æé€Ÿ ä¸€ä¸ªä¸‹å•æ“ä½œè€—æ—¶ï¼š20 + 300 + 300 + 300 = 920ms ï¼Œç”¨æˆ·ç‚¹å‡»å®Œä¸‹å•æŒ‰é’®åï¼Œéœ€è¦ç­‰å¾…920msæ‰èƒ½å¾—åˆ°ä¸‹å•å“åº”ï¼Œå¤ªæ…¢ï¼ ç”¨æˆ·ç‚¹å‡»å®Œä¸‹å•æŒ‰é’®åï¼Œåªéœ€ç­‰å¾…25mså°±èƒ½å¾—åˆ°ä¸‹å•å“åº” (20 + 5 = 25ms)ã€‚ æå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿååé‡ï¼ˆå•ä½æ—¶é—´å†…å¤„ç†è¯·æ±‚çš„æ•°ç›®ï¼‰ 1-3ã€å‰Šå³°å¡«è°· ä¼ ç»Ÿæ¨¡å¼å½“å¤§é‡å¹¶å‘æ¥ä¸´ï¼Œå¯èƒ½å°†ç³»ç»Ÿå†²å® ä½¿ç”¨äº† MQ ä¹‹åï¼Œé™åˆ¶æ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦ä¸º1000ï¼Œè¿™æ ·ä¸€æ¥ï¼Œé«˜å³°æœŸäº§ç”Ÿçš„æ•°æ®åŠ¿å¿…ä¼šè¢«ç§¯å‹åœ¨ MQ ä¸­ï¼Œé«˜å³° å°±è¢«â€œå‰Šâ€æ‰äº†ï¼Œä½†æ˜¯å› ä¸ºæ¶ˆæ¯ç§¯å‹ï¼Œåœ¨é«˜å³°æœŸè¿‡åçš„ä¸€æ®µæ—¶é—´å†…ï¼Œæ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦è¿˜æ˜¯ä¼šç»´æŒåœ¨1000ï¼Œç›´åˆ°æ¶ˆè´¹å®Œç§¯å‹çš„æ¶ˆæ¯ï¼Œè¿™å°±å«åšâ€œå¡«è°·â€ã€‚ 1-4ã€å°ç»“ åº”ç”¨è§£è€¦ï¼šæé«˜ç³»ç»Ÿå®¹é”™æ€§å’Œå¯ç»´æŠ¤æ€§ å¼‚æ­¥æé€Ÿï¼šæå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿååé‡ å‰Šå³°å¡«è°·ï¼šæé«˜ç³»ç»Ÿç¨³å®šæ€§ 2ã€åŠ£åŠ¿ ç³»ç»Ÿå¯ç”¨æ€§é™ä½ ç³»ç»Ÿå¤æ‚åº¦å˜é«˜ ä¸€è‡´æ€§é—®é¢˜ 2-1ã€ç³»ç»Ÿå¯ç”¨æ€§é™ä½ç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œç³»ç»Ÿç¨³å®šæ€§è¶Šå·®ï¼Œéœ€è¦ä¿è¯å¯ç”¨çš„è¶Šå¤šï¼›ä¸€æ—¦MQå®•æœºï¼Œå°±ä¼šå¯¹ä¸šåŠ¡å½±å“ï¼ˆå¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿï¼Ÿ é›†ç¾¤ï¼‰ 2-2ã€ç³»ç»Ÿå¤æ‚åº¦æé«˜ä¼ ç»Ÿçš„ç³»ç»Ÿæ˜¯åŒæ­¥è°ƒç”¨ï¼Œç°åœ¨é€šè¿‡MQå¼‚æ­¥è°ƒç”¨ï¼ˆå¦‚ä½•ä¿è¯æ¶ˆæ¯æ²¡æœ‰é‡å¤æ¶ˆè´¹ï¼Œæ€ä¹ˆå¤„ç†æ¶ˆæ¯ä¸¢å¤±é—®é¢˜ï¼Œä»¥åŠæ¶ˆæ¯çš„æœ‰åºæ€§ï¼‰ 2-3ã€ä¸€è‡´æ€§é—®é¢˜Aç³»ç»Ÿå¤„ç†å®Œä¸šåŠ¡ï¼Œé€šè¿‡MQç»™ B,C,D ä¸‰ä¸ªç³»ç»Ÿå‘é€æ¶ˆæ¯ï¼Œå¦‚æœB,CæˆåŠŸã€Då¤±è´¥ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ 2-4ã€å°ç»“æ—¢ç„¶ MQ æœ‰ä¼˜åŠ¿ä¹Ÿæœ‰åŠ£åŠ¿ï¼Œé‚£ä¹ˆä½¿ç”¨ MQ éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶å‘¢ï¼Ÿ ç”Ÿäº§è€…ä¸éœ€è¦ä»æ¶ˆè´¹è€…å¤„è·å–åé¦ˆï¼›ä¸Šå±‚ä¸éœ€è¦ç­‰å¾…ä¸‹å±‚å›è°ƒå¤„ç†ï¼Œæ‰èƒ½è®©å¼‚æ­¥æˆä¸ºå¯èƒ½ å®¹è®¸çŸ­æš‚çš„ä¸ä¸€è‡´æ€§ åœ¨è§£è€¦ã€æé€Ÿã€å‰Šå³°æ–¹é¢çš„æ”¶ç›Šï¼Œå¤§äºç®¡ç†MQçš„æˆæœ¬ 3ã€å¸¸è§MQå¯¹æ¯” 4ã€RabbitMQç®€ä»‹1ã€æ¶æ„å›¾ 2ã€ç»„ä»¶è¯´æ˜ï¼ˆâ†‘ï¼‰ Brokerï¼šæ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Serverå°±æ˜¯ Message Broker Virtual hostï¼šå‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠ AMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºç½‘ ç»œä¸­çš„ namespace æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ª RabbitMQ server æä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤š ä¸ªvhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ vhost åˆ›å»º exchangeï¼queue ç­‰ Connectionï¼špublisherï¼consumer å’Œ broker ä¹‹é—´çš„ TCP è¿æ¥ Channelï¼šå¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ª Connectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹ TCP Connection çš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channel æ˜¯åœ¨ connection å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ ç¨‹ï¼Œé€šå¸¸æ¯ä¸ªthreadåˆ›å»ºå•ç‹¬çš„ channel è¿›è¡Œé€šè®¯ï¼ŒAMQP method åŒ…å«äº†channel id å¸®åŠ©å®¢æˆ·ç«¯å’Œ message broker è¯†åˆ« channelï¼Œæ‰€ä»¥ channel ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channel ä½œä¸ºè½»é‡çº§çš„ Connection æå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹ TCP connection çš„å¼€é”€ Exchangeï¼šmessage åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œåˆ†å‘æ¶ˆæ¯åˆ° queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šdirect (point-to-point), topic (publish-subscribe) and fanout (multicast) Queueï¼šæ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾… consumer å–èµ° Bindingï¼šexchange å’Œ queue ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbinding ä¸­å¯ä»¥åŒ…å« routing keyã€‚Binding ä¿¡æ¯è¢«ä¿å­˜åˆ° exchange ä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äº message çš„åˆ†å‘ä¾æ® 3ã€RabbitMQ 6ä¸­å·¥ä½œæ¨¡å¼ç®€å•æ¨¡å¼ã€work queuesã€Publish/Subscribe å‘å¸ƒä¸è®¢é˜…æ¨¡å¼ã€Routing è·¯ç”±æ¨¡å¼ã€Topics ä¸»é¢˜æ¨¡å¼ã€RPC è¿œç¨‹è°ƒç”¨æ¨¡å¼ï¼ˆè¿œç¨‹è°ƒç”¨ï¼Œä¸å¤ªç®— MQï¼›ä¸ä½œä»‹ç»ï¼‰ 4ã€JMS JMS å³ Java å¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„API JMS æ˜¯ JavaEE è§„èŒƒä¸­çš„ä¸€ç§ï¼Œç±»æ¯”JDBC å¾ˆå¤šæ¶ˆæ¯ä¸­é—´ä»¶éƒ½å®ç°äº†JMSè§„èŒƒï¼Œä¾‹å¦‚ï¼šActiveMQã€‚RabbitMQ å®˜æ–¹æ²¡æœ‰æä¾› JMS çš„å®ç°åŒ…ï¼Œä½†æ˜¯å¼€æºç¤¾åŒºæœ‰ 5ã€RabbitMQå°ç»“ RabbitMQ æ˜¯åŸºäº AMQP åè®®ä½¿ç”¨ Erlang è¯­è¨€å¼€å‘çš„ä¸€æ¬¾æ¶ˆæ¯é˜Ÿåˆ—äº§å“ RabbitMQæä¾›äº†6ç§å·¥ä½œæ¨¡å¼ï¼Œæˆ‘ä»¬å­¦ä¹ 5ç§ AMQP æ˜¯åè®®ï¼Œç±»æ¯”HTTP JMS æ˜¯ API è§„èŒƒæ¥å£ï¼Œç±»æ¯” JDBC äºŒã€å¿«é€Ÿå…¥é—¨1ã€æ­¥éª¤ä½¿ç”¨ç®€å•æ¨¡å¼å®Œæˆæ¶ˆæ¯ä¼ é€’ï¼š â‘  åˆ›å»ºå·¥ç¨‹ï¼ˆç”Ÿæˆè€…ã€æ¶ˆè´¹è€…ï¼‰ â‘¡ åˆ†åˆ«æ·»åŠ ä¾èµ– â‘¢ ç¼–å†™ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ â‘£ ç¼–å†™æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯ 2ã€å°ç»“ åœ¨ä¸Šå›¾çš„æ¨¡å‹ä¸­ï¼Œæœ‰ä»¥ä¸‹æ¦‚å¿µï¼š Pï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åº Cï¼šæ¶ˆè´¹è€…ï¼šæ¶ˆæ¯çš„æ¥æ”¶è€…ï¼Œä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ï¼ˆçº¿ç¨‹ä¸€ç›´åœ¨ç›‘å¬ï¼‰ queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå›¾ä¸­çº¢è‰²éƒ¨åˆ†ã€‚ç±»ä¼¼ä¸€ä¸ªé‚®ç®±ï¼Œå¯ä»¥ç¼“å­˜æ¶ˆæ¯ï¼›ç”Ÿäº§è€…å‘å…¶ä¸­æŠ•é€’æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä»å…¶ä¸­å–å‡ºæ¶ˆæ¯ ä¸‰ã€å·¥ä½œæ¨¡å¼1ã€Work queues å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ 1ã€è¯´æ˜ Work Queuesï¼šä¸å…¥é—¨ç¨‹åºçš„ç®€å•æ¨¡å¼ç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ªæˆ–ä¸€äº›æ¶ˆè´¹ç«¯ï¼Œå¤šä¸ªæ¶ˆè´¹ç«¯å…±åŒæ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ åº”ç”¨åœºæ™¯ï¼šå¯¹äºä»»åŠ¡è¿‡é‡æˆ–ä»»åŠ¡è¾ƒå¤šæƒ…å†µä½¿ç”¨å·¥ä½œé˜Ÿåˆ—å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†çš„é€Ÿåº¦ã€‚ 2ã€ä»£ç  3ã€å°ç»“ åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­å¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…ä¹‹é—´å¯¹äºåŒä¸€ä¸ªæ¶ˆæ¯çš„å…³ç³»æ˜¯ç«äº‰çš„å…³ç³»ã€‚ Work Queues å¯¹äºä»»åŠ¡è¿‡é‡æˆ–ä»»åŠ¡è¾ƒå¤šæƒ…å†µä½¿ç”¨å·¥ä½œé˜Ÿåˆ—å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†çš„é€Ÿåº¦ã€‚ä¾‹å¦‚ï¼šçŸ­ä¿¡æœåŠ¡éƒ¨ç½²å¤šä¸ªï¼Œåªéœ€è¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æˆåŠŸå‘é€å³å¯ã€‚ 2ã€Pub/Sub è®¢é˜…æ¨¡å¼ åœ¨è®¢é˜…æ¨¡å‹ä¸­ï¼Œå¤šäº†ä¸€ä¸ª Exchange è§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š Pï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™Xï¼ˆäº¤æ¢æœºï¼‰ Cï¼šæ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯çš„æ¥æ”¶è€…ï¼Œä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ Xï¼šExchangeï¼šäº¤æ¢æœºï¼Œä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚Exchangeæœ‰å¸¸è§ä»¥ä¸‹3ç§ç±»å‹ï¼š Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ— Directï¼šå®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting key çš„é˜Ÿåˆ— Topicï¼šé€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰çš„é˜Ÿåˆ— Exchangeï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸ Exchange ç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤± å°ç»“ï¼š äº¤æ¢æœºéœ€è¦ä¸é˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œç»‘å®šä¹‹åï¼›ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…éƒ½æ”¶åˆ° å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸å·¥ä½œé˜Ÿåˆ—æ¨¡å¼çš„åŒºåˆ«ï¼š å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ä¸ç”¨å®šä¹‰äº¤æ¢æœºï¼Œè€Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼éœ€è¦å®šä¹‰äº¤æ¢æœº å‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„ç”Ÿäº§æ–¹æ˜¯é¢å‘äº¤æ¢æœºå‘é€æ¶ˆæ¯ï¼Œå·¥ä½œé˜Ÿåˆ—æ¨¡å¼çš„ç”Ÿäº§æ–¹æ˜¯é¢å‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯(åº•å±‚ä½¿ç”¨é»˜è®¤äº¤æ¢æœº) å‘å¸ƒ/è®¢é˜…æ¨¡å¼éœ€è¦è®¾ç½®é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®šï¼Œå·¥ä½œé˜Ÿåˆ—æ¨¡å¼ä¸éœ€è¦è®¾ç½®ï¼Œå®é™…ä¸Šå·¥ä½œé˜Ÿåˆ—æ¨¡å¼ä¼šå°†é˜Ÿåˆ—ç»‘å®šåˆ°é»˜è®¤çš„äº¤æ¢æœº 3ã€Routing è·¯ç”±æ¨¡å¼1ã€æ¨¡å¼è¯´æ˜ é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ª RoutingKeyï¼ˆè·¯ç”±keyï¼‰ æ¶ˆæ¯çš„å‘é€æ–¹åœ¨å‘ Exchange å‘é€æ¶ˆæ¯ç»™ Consumer æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ RoutingKey Exchange ä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„ Routing Key è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„ Routingkey ä¸æ¶ˆæ¯çš„ Routing key å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯ 2ã€å›¾è§£ Pï¼šç”Ÿäº§è€…ï¼Œå‘ Exchange å‘é€æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šæŒ‡å®šä¸€ä¸ªrouting key Xï¼šExchangeï¼ˆäº¤æ¢æœºï¼‰ï¼Œæ¥æ”¶ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œç„¶åæŠŠæ¶ˆæ¯é€’äº¤ç»™ä¸ routing key å®Œå…¨åŒ¹é…çš„é˜Ÿåˆ— C1ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦ routing key ä¸º error çš„æ¶ˆæ¯ C2ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦ routing key ä¸º infoã€errorã€warning çš„æ¶ˆæ¯ 3ã€ä»£ç  4ã€å°ç»“Routing æ¨¡å¼è¦æ±‚é˜Ÿåˆ—åœ¨ç»‘å®šäº¤æ¢æœºæ—¶è¦æŒ‡å®š routing keyï¼Œæ¶ˆæ¯ä¼šè½¬å‘åˆ°ç¬¦åˆ routing key çš„é˜Ÿåˆ—ã€‚ 4ã€Topics é€šé…ç¬¦æ¨¡å¼1ã€è¯´æ˜ Q1 Queueï¼šç»‘å®šçš„æ˜¯ usa.# ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ usa. å¼€å¤´çš„ routing key éƒ½ä¼šè¢«åŒ¹é…åˆ° Q2 Queueï¼šç»‘å®šçš„æ˜¯ #.news ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ .news ç»“å°¾çš„ routing key éƒ½ä¼šè¢«åŒ¹é… 2ã€ä»£ç  3ã€å°ç»“Topic ä¸»é¢˜æ¨¡å¼å¯ä»¥å®ç° Pub/Sub å‘å¸ƒä¸è®¢é˜…æ¨¡å¼å’Œ Routing è·¯ç”±æ¨¡å¼çš„åŠŸèƒ½ï¼Œåªæ˜¯ Topic åœ¨é…ç½®routing key çš„æ—¶å€™å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œæ˜¾å¾—æ›´åŠ çµæ´»ã€‚ 5ã€å·¥ä½œæ¨¡å¼æ€»ç»“ ç®€å•æ¨¡å¼ HelloWorld ï¼šä¸€ä¸ªç”Ÿäº§è€…ã€ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰ã€‚ å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ Work Queue ï¼šä¸€ä¸ªç”Ÿäº§è€…ã€å¤šä¸ªæ¶ˆè´¹è€…ï¼ˆç«äº‰å…³ç³»ï¼‰ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰ã€‚ å‘å¸ƒè®¢é˜…æ¨¡å¼ Publish/subscribe ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º fanout çš„äº¤æ¢æœºï¼Œå¹¶ä¸”äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šå°†æ¶ˆæ¯å‘é€åˆ°ç»‘å®šçš„é˜Ÿåˆ—ã€‚ è·¯ç”±æ¨¡å¼ Routing ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º direct çš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®š routing keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ® routing key å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚ é€šé…ç¬¦æ¨¡å¼ Topic ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º topic çš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®šé€šé…ç¬¦æ–¹å¼çš„ routing keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ® routing key å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚ å››ã€Spring æ•´åˆ RabbitMQ1ã€ä»£ç 1-1ã€ç”Ÿäº§è€…â‘  åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ â‘¡ æ·»åŠ ä¾èµ– â‘¢ é…ç½®æ•´åˆ â‘£ ç¼–å†™ä»£ç å‘é€æ¶ˆæ¯ 1-2ã€æ¶ˆè´¹è€…â‘  åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ â‘¡ æ·»åŠ ä¾èµ– â‘¢ é…ç½®æ•´åˆ â‘£ ç¼–å†™æ¶ˆæ¯ç›‘å¬å™¨ 2ã€å°ç»“ ä½¿ç”¨ Spring æ•´åˆ RabbitMQ å°†ç»„ä»¶å…¨éƒ¨ä½¿ç”¨é…ç½®æ–¹å¼å®ç°ï¼Œç®€åŒ–ç¼–ç  Spring æä¾› RabbitTemplate ç®€åŒ–å‘é€æ¶ˆæ¯ API ä½¿ç”¨ç›‘å¬æœºåˆ¶ç®€åŒ–æ¶ˆè´¹è€…ç¼–ç  äº”ã€SpringBoot æ•´åˆ RabbitMQ1ã€ä»£ç  â…¡ã€å®æˆ˜ç¯‡ä¸€ã€é«˜çº§ç‰¹æ€§1ã€æ¶ˆæ¯å¯é æ€§æŠ•é€’ï¼ˆç”Ÿäº§è€… -&gt; MQï¼‰ 1ã€æ¦‚è¿°åœ¨ä½¿ç”¨ RabbitMQ çš„æ—¶å€™ï¼Œä½œä¸ºæ¶ˆæ¯å‘é€æ–¹å¸Œæœ›æœç»ä»»ä½•æ¶ˆæ¯ä¸¢å¤±æˆ–è€…æŠ•é€’å¤±è´¥åœºæ™¯ã€‚RabbitMQ ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§æ–¹å¼ç”¨æ¥æ§åˆ¶æ¶ˆæ¯çš„æŠ•é€’å¯é æ€§æ¨¡å¼ã€‚ ç¡®è®¤æ¨¡å¼ å›é€€æ¨¡å¼ rabbitmq æ•´ä¸ªæ¶ˆæ¯æŠ•é€’çš„è·¯å¾„ä¸ºï¼š producer â€”&gt; rabbitmq broker â€”&gt; exchange â€”&gt; queue â€”&gt; consumer æ¶ˆæ¯ä» producer åˆ° exchange åˆ™ä¼šè¿”å›ä¸€ä¸ª confirmCallback çš„å›è°ƒ æ¶ˆæ¯ä» exchange åˆ° queue æŠ•é€’å¤±è´¥åˆ™è¿”å›ä¸€ä¸ª returnCallback å›è°ƒ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸¤ä¸ª callback å›è°ƒ æ§åˆ¶æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’ 2ã€ä»£ç  3ã€å°ç»“ è®¾ç½®ConnectionFactoryçš„publisher-confirms=â€trueâ€ å¼€å¯ ç¡®è®¤æ¨¡å¼ ä½¿ç”¨rabbitTemplate.setConfirmCallbackè®¾ç½®å›è°ƒå‡½æ•°ã€‚å½“æ¶ˆæ¯å‘é€åˆ°exchangeåå› è°ƒconfirmæ–¹æ³•ã€‚åœ¨æ–¹æ³•ä¸­åˆ¤æ–­ackï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™å‘é€æˆåŠŸï¼Œå¦‚æœä¸ºfalseï¼Œåˆ™å‘ é€å¤±è´¥ï¼Œéœ€è¦å¤„ç† è®¾ç½®ConnectionFactoryçš„publisher-returns=â€trueâ€ å¼€å¯ é€€å›æ¨¡å¼ ä½¿ç”¨rabbitTemplate.setReturnCallbackè®¾ç½®é€€å›å‡½æ•°ï¼Œå½“æ¶ˆæ¯ä»exchangeè·¯ç”±åˆ° queueå¤±è´¥åï¼Œå¦‚æœè®¾ç½®äº†rabbitTemplate.setMandatory(true)å‚æ•°ï¼Œåˆ™ä¼šå°†æ¶ˆæ¯é€€ å›ç»™producerã€‚å¹¶æ‰§è¡Œå›è°ƒå‡½æ•°returnedMessage åœ¨RabbitMQä¸­ä¹Ÿæä¾›äº†äº‹åŠ¡æœºåˆ¶ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®ï¼Œæ­¤å¤„ä¸åšè®²è§£ã€‚ ä½¿ç”¨channelä¸‹åˆ—æ–¹æ³•ï¼Œå®Œæˆäº‹åŠ¡æ§åˆ¶ï¼š txSelect(), ç”¨äºå°†å½“å‰channelè®¾ç½®æˆtransactionæ¨¡å¼ txCommit()ï¼Œç”¨äºæäº¤äº‹åŠ¡ txRollback(),ç”¨äºå›æ»šäº‹åŠ¡ 2ã€Consumer AckMQ -&gt; æ¶ˆè´¹è€… 1ã€æ¦‚è¿°ackæŒ‡Acknowledgeï¼Œç¡®è®¤ã€‚ è¡¨ç¤ºæ¶ˆè´¹ç«¯æ”¶åˆ°æ¶ˆæ¯åçš„ç¡®è®¤æ–¹å¼ã€‚ æœ‰ä¸‰ç§ç¡®è®¤æ–¹å¼ï¼š â€¢ è‡ªåŠ¨ç¡®è®¤ï¼šacknowledge=â€noneâ€ â€¢ æ‰‹åŠ¨ç¡®è®¤ï¼šacknowledge=â€manualâ€ â€¢ æ ¹æ®å¼‚å¸¸æƒ…å†µç¡®è®¤ï¼šacknowledge=â€autoâ€ï¼Œï¼ˆè¿™ç§æ–¹å¼ä½¿ç”¨éº»çƒ¦ï¼Œä¸ä½œè®²è§£ï¼‰ å…¶ä¸­è‡ªåŠ¨ç¡®è®¤æ˜¯æŒ‡ï¼Œå½“æ¶ˆæ¯ä¸€æ—¦è¢«Consumeræ¥æ”¶åˆ°ï¼Œåˆ™è‡ªåŠ¨ç¡®è®¤æ”¶åˆ°ï¼Œå¹¶å°†ç›¸åº” message RabbitMQ çš„æ¶ˆæ¯ç¼“å­˜ä¸­ç§»é™¤ã€‚ä½†æ˜¯åœ¨å®é™…ä¸šåŠ¡å¤„ç†ä¸­ï¼Œå¾ˆå¯èƒ½æ¶ˆæ¯æ¥æ”¶åˆ°ï¼Œä¸šåŠ¡å¤„ç†å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚å¦‚æœè®¾ç½®äº†æ‰‹åŠ¨ç¡®è®¤æ–¹å¼ï¼Œåˆ™éœ€è¦åœ¨ä¸šåŠ¡å¤„ç†æˆåŠŸåï¼Œè°ƒç”¨channel.basicAck()ï¼Œæ‰‹åŠ¨ç­¾æ”¶ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨channel.basicNack()æ–¹æ³•ï¼Œè®©å…¶è‡ªåŠ¨é‡æ–°å‘é€æ¶ˆæ¯ã€‚ 2ã€ä»£ç  3ã€å°ç»“ åœ¨rabbit:listener-containeræ ‡ç­¾ä¸­è®¾ç½®acknowledgeå±æ€§ï¼Œè®¾ç½®ackæ–¹å¼ noneï¼šè‡ªåŠ¨ç¡®è®¤ï¼Œ manualï¼šæ‰‹åŠ¨ç¡®è®¤ å¦‚æœåœ¨æ¶ˆè´¹ç«¯æ²¡æœ‰å‡ºç°å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨channel.basicAck(deliveryTag,false);æ–¹æ³•ç¡®è®¤ç­¾æ”¶æ¶ˆæ¯ å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™åœ¨catchä¸­è°ƒç”¨ basicNackæˆ– basicRejectï¼Œæ‹’ç»æ¶ˆæ¯ï¼Œè®©MQé‡æ–°å‘é€æ¶ˆæ¯ã€‚ 3ã€æ¶ˆæ¯å¯é æ€§æ€»ç»“ æŒä¹…åŒ– exchangeè¦æŒä¹…åŒ– queueè¦æŒä¹…åŒ– messageè¦æŒä¹…åŒ– ç”Ÿäº§æ–¹ç¡®è®¤Confirm æ¶ˆè´¹æ–¹ç¡®è®¤Ack Brokeré«˜å¯ç”¨ 4ã€æ¶ˆè´¹ç«¯é™æµ1ã€æ¦‚å¿µ 2ã€ä»£ç  3ã€å°ç»“ åœ¨rabbit:listener-container ä¸­é…ç½® prefetchå±æ€§è®¾ç½®æ¶ˆè´¹ç«¯ä¸€æ¬¡æ‹‰å–å¤šå°‘æ¶ˆæ¯ æ¶ˆè´¹ç«¯çš„ç¡®è®¤æ¨¡å¼ä¸€å®šä¸ºæ‰‹åŠ¨ç¡®è®¤ã€‚acknowledge=â€manualâ€ 5ã€TTL è¿‡æœŸæ—¶é—´1ã€æ¦‚è¿° TTL å…¨ç§° Time To Liveï¼ˆå­˜æ´»æ—¶é—´/è¿‡æœŸæ—¶é—´ï¼‰ å½“æ¶ˆæ¯åˆ°è¾¾å­˜æ´»æ—¶é—´åï¼Œè¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œä¼šè¢«è‡ªåŠ¨æ¸…é™¤ RabbitMQå¯ä»¥å¯¹æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå¯ä»¥å¯¹æ•´ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰è®¾ç½®è¿‡æœŸæ—¶é—´ 2ã€ä»£ç  3ã€å°ç»“ è®¾ç½®é˜Ÿåˆ—è¿‡æœŸæ—¶é—´ä½¿ç”¨å‚æ•°ï¼šx-message-ttlï¼Œå•ä½ï¼šms(æ¯«ç§’)ï¼Œä¼šå¯¹æ•´ä¸ªé˜Ÿåˆ—æ¶ˆæ¯ç»Ÿä¸€è¿‡æœŸ è®¾ç½®æ¶ˆæ¯è¿‡æœŸæ—¶é—´ä½¿ç”¨å‚æ•°ï¼šexpirationã€‚å•ä½ï¼šms(æ¯«ç§’)ï¼Œå½“è¯¥æ¶ˆæ¯åœ¨é˜Ÿåˆ—å¤´éƒ¨æ—¶ï¼ˆæ¶ˆè´¹æ—¶ï¼‰ï¼Œä¼šå•ç‹¬åˆ¤æ–­è¿™ä¸€æ¶ˆæ¯æ˜¯å¦è¿‡æœŸ å¦‚æœä¸¤è€…éƒ½è¿›è¡Œäº†è®¾ç½®ï¼Œä»¥æ—¶é—´çŸ­çš„ä¸ºå‡† 6ã€æ­»ä¿¡é˜Ÿåˆ—1ã€æ¦‚è¿°æ­»ä¿¡é˜Ÿåˆ—å…¶å®è¯´çš„å°±æ˜¯ç§ä¿¡äº¤æ¢æœº æ­»ä¿¡é˜Ÿåˆ—ï¼Œè‹±æ–‡ç¼©å†™ï¼šDLX ã€‚Dead Letter Exchangeï¼ˆæ­»ä¿¡äº¤æ¢æœºï¼‰ï¼Œå½“æ¶ˆæ¯æˆä¸ºDead messageåï¼Œå¯ä»¥è¢«é‡æ–°å‘é€åˆ°å¦ä¸€ä¸ªäº¤æ¢æœºï¼Œè¿™ä¸ªäº¤æ¢æœºå°±æ˜¯DLX æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µï¼š é˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦åˆ°è¾¾é™åˆ¶ï¼› ï¼ˆèƒ½æ”¾10æ¡ï¼Œæ”¾äº†11æ¡ï¼Œ1æ¡è¶…è¿‡è¢«æˆä¸ºæ­»ä¿¡ï¼‰ï¼Œå¯ä»¥è®¾ç½®é˜Ÿåˆ—å­˜æ”¾çš„æ•°é‡ æ¶ˆè´¹è€…æ‹’æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼ŒbasicNack/basicRejectï¼›å¹¶ä¸”ä¸æŠŠæ¶ˆæ¯é‡æ–°æ”¾å…¥åŸç›®æ ‡é˜Ÿåˆ—,requeue=falseï¼› åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯è¿‡æœŸè®¾ç½®ï¼Œæ¶ˆæ¯åˆ°è¾¾è¶…æ—¶æ—¶é—´æœªè¢«æ¶ˆè´¹ï¼› é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº ç»™é˜Ÿåˆ—è®¾ç½®å‚æ•°ï¼š x-dead-letter-exchange å’Œ x-dead-letter-routing-key 2ã€ä»£ç  3ã€å°ç»“ æ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—å’Œæ™®é€šçš„æ²¡æœ‰åŒºåˆ« å½“æ¶ˆæ¯æˆä¸ºæ­»ä¿¡åï¼Œå¦‚æœè¯¥é˜Ÿåˆ—ç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœºï¼Œåˆ™æ¶ˆæ¯ä¼šè¢«æ­»ä¿¡äº¤æ¢æœºé‡æ–°è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ— æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ é˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦åˆ°è¾¾é™åˆ¶ æ¶ˆè´¹è€…æ‹’æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸é‡å›é˜Ÿåˆ— åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯è¿‡æœŸè®¾ç½®ï¼Œæ¶ˆæ¯åˆ°è¾¾è¶…æ—¶æ—¶é—´æœªè¢«æ¶ˆè´¹ 7ã€å»¶è¿Ÿé˜Ÿåˆ—1ã€æ¦‚å¿µå»¶è¿Ÿé˜Ÿåˆ—ï¼Œå³æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—åä¸ä¼šç«‹å³è¢«æ¶ˆè´¹ï¼Œåªæœ‰åˆ°è¾¾æŒ‡å®šæ—¶é—´åï¼Œæ‰ä¼šè¢«æ¶ˆè´¹ éœ€æ±‚ï¼š ä¸‹å•åï¼Œ30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œå–æ¶ˆè®¢å•ï¼Œå›æ»šåº“å­˜ æ–°ç”¨æˆ·æ³¨å†ŒæˆåŠŸ7å¤©åï¼Œå‘é€çŸ­ä¿¡é—®å€™ å®ç°æ–¹å¼ï¼š å®šæ—¶å™¨ å»¶è¿Ÿé˜Ÿåˆ— å¾ˆå¯æƒœï¼Œåœ¨RabbitMQä¸­å¹¶æœªæä¾›å»¶è¿Ÿé˜Ÿåˆ—åŠŸèƒ½ã€‚ ä½†æ˜¯å¯ä»¥ä½¿ç”¨ï¼šTTL+æ­»ä¿¡é˜Ÿåˆ— ç»„åˆå®ç°å»¶è¿Ÿé˜Ÿåˆ—çš„æ•ˆæœ 2ã€ä»£ç  3ã€å°ç»“ å»¶è¿Ÿé˜Ÿåˆ— æŒ‡æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—åï¼Œå¯ä»¥è¢«å»¶è¿Ÿä¸€å®šæ—¶é—´ï¼Œå†è¿›è¡Œæ¶ˆè´¹ RabbitMQæ²¡æœ‰æä¾›å»¶è¿Ÿé˜Ÿåˆ—åŠŸèƒ½ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ ï¼š TTL + DLX æ¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—æ•ˆæœ äºŒã€åº”ç”¨é—®é¢˜1ã€å‚è€ƒæ–‡çŒ® â†“windownå®‰è£… rabbitmq ï¼šhttps://blog.csdn.net/qq_25919879/article/details/113055350 docker å®‰è£… rabbitmqï¼šhttps://www.jb51.net/article/233585.htm docker å®‰è£…å ç•Œé¢ç«¯åŠŸèƒ½ç¼ºå¤±é—®é¢˜ï¼šhttps://blog.csdn.net/qq_45369827/article/details/115921401 springboot-rabbitmq ç¡®è®¤æ¨¡å¼å¼ƒç”¨é…ç½®ï¼šhttps://blog.csdn.net/z69183787/article/details/109371628 å•å…ƒæµ‹è¯•ï¼Œå‘å¸ƒç¡®è®¤å›è°ƒ ack æ€»æ˜¯ falseï¼šhttps://blog.csdn.net/dh554112075/article/details/90137869 spring-boot æ­»ä¿¡é˜Ÿåˆ—ï¼šhttps://blog.csdn.net/weixin_52062043/article/details/127077941","categories":[{"name":"æ¶ˆæ¯ä¸­é—´ä»¶","slug":"æ¶ˆæ¯ä¸­é—´ä»¶","permalink":"https://mykkto.github.io/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/"}],"tags":[{"name":"amqp","slug":"amqp","permalink":"https://mykkto.github.io/tags/amqp/"},{"name":"rabbitmq","slug":"rabbitmq","permalink":"https://mykkto.github.io/tags/rabbitmq/"}],"author":"mykk"},{"title":"Netty-å®ç”¨ç¯‡","slug":"07-å†…åŠ›/02-ç½‘ç»œæ¡†æ¶/01-Nettyå®ç”¨ç¯‡","date":"2022-08-21T05:22:33.000Z","updated":"2023-06-11T02:53:45.141Z","comments":true,"path":"posts/bb8f1edf.html","link":"","permalink":"https://mykkto.github.io/posts/bb8f1edf.html","excerpt":"","text":"æºä»£ç ä½ç½®https://gitee.com/TK_LIMR/springcloud2021To2021 ç›®å½•ï¼š ç½‘ç»œç¼–ç¨‹ ä¸‰æ¬¡æ¡æ‰‹ åŸºç¡€åé¢ä¼šåœ¨å…¶ä»–æ–‡ç« æ›´æ–° nio ä¸‰å¤§ç»„ä»¶ ByteBufferè¯¦è§£ æ–‡ä»¶ç¼–ç¨‹ ç½‘ç»œç¼–ç¨‹ nio vs bio vs aio netty å…¥é—¨ è¿›é˜¶ ä¼˜åŒ– å®æˆ˜ æºç  â… ã€NIOä¸€ã€ä¸‰å¤§ç»„ä»¶1ã€Channel &amp; Bufferchannel æœ‰ä¸€ç‚¹ç±»ä¼¼äº streamï¼Œå®ƒå°±æ˜¯è¯»å†™æ•°æ®çš„åŒå‘é€šé“ï¼Œå¯ä»¥ä» channel å°†æ•°æ®è¯»å…¥ bufferï¼Œä¹Ÿå¯ä»¥å°† buffer çš„æ•°æ®å†™å…¥ channelï¼Œè€Œä¹‹å‰çš„ stream è¦ä¹ˆæ˜¯è¾“å…¥ï¼Œè¦ä¹ˆæ˜¯è¾“å‡ºï¼Œchannel æ¯” stream æ›´ä¸ºåº•å±‚ å¸¸è§çš„ Channel æœ‰ FileChannel DatagramChannel SocketChannel ServerSocketChannel buffer åˆ™ç”¨æ¥ç¼“å†²è¯»å†™æ•°æ®ï¼Œå¸¸è§çš„ buffer æœ‰ ByteBuffer MappedByteBuffer DirectByteBuffer HeapByteBuffer ShortBuffer IntBuffer LongBuffer FloatBuffer DoubleBuffer CharBuffer 2ã€Selectorselector å•ä»å­—é¢æ„æ€ä¸å¥½ç†è§£ï¼Œéœ€è¦ç»“åˆæœåŠ¡å™¨çš„è®¾è®¡æ¼”åŒ–æ¥ç†è§£å®ƒçš„ç”¨é€” 2-1ã€å¤šçº¿ç¨‹ç‰ˆè®¾è®¡ âš ï¸ å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹ å†…å­˜å ç”¨é«˜ çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬é«˜ åªé€‚åˆè¿æ¥æ•°å°‘çš„åœºæ™¯ 2-2ã€çº¿ç¨‹æ± ç‰ˆè®¾è®¡ âš ï¸ çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹ é˜»å¡æ¨¡å¼ä¸‹ï¼Œçº¿ç¨‹ä»…èƒ½å¤„ç†ä¸€ä¸ª socket è¿æ¥ ä»…é€‚åˆçŸ­è¿æ¥åœºæ™¯ 2-3ã€selector ç‰ˆè®¾è®¡selector çš„ä½œç”¨å°±æ˜¯é…åˆä¸€ä¸ªçº¿ç¨‹æ¥ç®¡ç†å¤šä¸ª channelï¼Œè·å–è¿™äº› channel ä¸Šå‘ç”Ÿçš„äº‹ä»¶ï¼Œè¿™äº› channel å·¥ä½œåœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œä¸ä¼šè®©çº¿ç¨‹åŠæ­»åœ¨ä¸€ä¸ª channel ä¸Šã€‚é€‚åˆè¿æ¥æ•°ç‰¹åˆ«å¤šï¼Œä½†æµé‡ä½çš„åœºæ™¯ï¼ˆlow trafficï¼‰ è°ƒç”¨ selector çš„ select() ä¼šé˜»å¡ç›´åˆ° channel å‘ç”Ÿäº†è¯»å†™å°±ç»ªäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å‘ç”Ÿï¼Œselect æ–¹æ³•å°±ä¼šè¿”å›è¿™äº›äº‹ä»¶äº¤ç»™ thread æ¥å¤„ç† äºŒã€ByteBufferè¯¦è§£æœ‰ä¸€æ™®é€šæ–‡æœ¬æ–‡ä»¶ data.txtï¼Œå†…å®¹ä¸º 1234567890abcd ä½¿ç”¨ FileChannel æ¥è¯»å–æ–‡ä»¶å†…å®¹ package com.kk.netty.nio; import lombok.extern.slf4j.Slf4j; import java.io.IOException; import java.io.RandomAccessFile; import java.nio.ByteBuffer; import java.nio.channels.FileChannel; @Slf4j public class ChannelDemo1 { // public static void main(String[] args) { /** * try () 1.7çš„è¯­æ³•ç³–ï¼Œæ–¹ä¾¿å…³é—­ RandomAccessFile èµ„æº * FileChannel * 1ã€è¾“å…¥è¾“å‡ºæµï¼ŒRandomAccessFile */ try (RandomAccessFile file = new RandomAccessFile (\"boot_netty/helloword/data.txt\", \"rw\")) { FileChannel channel = file.getChannel ( ); ByteBuffer buffer = ByteBuffer.allocate (10); do { // å‡†å¤‡ç¼“å†²åŒºï¼Œå‘ buffer å†™å…¥ int len = channel.read (buffer); log.debug (\"è¯»åˆ°å­—èŠ‚æ•°ï¼š{}\", len); if (len == -1) {// æ²¡æœ‰å†…å®¹äº† break; } // åˆ‡æ¢ buffer è¯»æ¨¡å¼ // ç¿»è½¬ç¼“å†²åŒºï¼Œä¸ºå†™åšå‡†å¤‡ buffer.flip ( ); while (buffer.hasRemaining ( )) {// æ˜¯å¦è¿˜æœ‰å‰©ä½™æœªè¯»æ•°æ® byte b = buffer.get ( ); log.debug (\"{}\", (char) b); } // åˆ‡æ¢ buffer å†™æ¨¡å¼ // æ¸…æ¥šç¼“å†²åŒºï¼Œä¸ºè¯»åšå‡†å¤‡ buffer.clear ( ); } while (true); } catch (IOException e) { e.printStackTrace ( ); } } } è¾“å‡º 19:02:52.712 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š1019:02:52.717 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 119:02:52.717 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 219:02:52.717 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 319:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 419:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 519:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 619:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 719:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 819:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 919:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 019:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š619:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - a19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - b19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - c19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - d19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 -19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š-1 1ã€ByteBuffer æ­¥éª¤ å‘ buffer å†™å…¥æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ channel.read(buffer) è°ƒç”¨ flip() åˆ‡æ¢è‡³è¯»æ¨¡å¼ ä» buffer è¯»å–æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ buffer.get() è°ƒç”¨ clear() æˆ– compact() åˆ‡æ¢è‡³å†™æ¨¡å¼ é‡å¤ 1~4 æ­¥éª¤ 2ã€ByteBuffer ç»“æ„ByteBuffer æœ‰ä»¥ä¸‹é‡è¦å±æ€§ capacity å®¹é‡ position å†™å…¥ä½ç½®ï¼Œç§»åŠ¨çš„æ¸¸æ ‡ limit å†™å…¥æˆ–è€…è¯»å–é™åˆ¶ï¼ˆæ ¹æ®è¯»å†™æ¨¡å¼åˆ‡æ¢å†³å®šï¼‰ 1ã€å¼€å§‹ 2ã€å†™æ¨¡å¼ä¸‹ï¼Œposition æ˜¯å†™å…¥ä½ç½®ï¼Œlimit ç­‰äºå®¹é‡ï¼Œä¸‹å›¾è¡¨ç¤ºå†™å…¥äº† 4 ä¸ªå­—èŠ‚åçš„çŠ¶æ€ 3ã€flip åŠ¨ä½œå‘ç”Ÿåï¼Œposition åˆ‡æ¢ä¸ºè¯»å–ä½ç½®ï¼Œlimit åˆ‡æ¢ä¸ºè¯»å–é™åˆ¶ 4ã€è¯»å– 4 ä¸ªå­—èŠ‚åï¼ŒçŠ¶æ€ 5ã€clear åŠ¨ä½œå‘ç”Ÿåï¼ŒçŠ¶æ€ 6ã€compact æ–¹æ³•ï¼Œæ˜¯æŠŠæœªè¯»å®Œçš„éƒ¨åˆ†å‘å‰å‹ç¼©ï¼Œç„¶ååˆ‡æ¢è‡³å†™æ¨¡å¼ ğŸ’¡ è°ƒè¯•å·¥å…·ç±»package com.kk.netty.nio; import io.netty.util.internal.StringUtil; import java.nio.ByteBuffer; import static io.netty.util.internal.MathUtil.isOutOfBounds; import static io.netty.util.internal.StringUtil.NEWLINE; public class ByteBufferUtil { private static final char[] BYTE2CHAR = new char[256]; private static final char[] HEXDUMP_TABLE = new char[256 * 4]; private static final String[] HEXPADDING = new String[16]; private static final String[] HEXDUMP_ROWPREFIXES = new String[65536 &gt;&gt;&gt; 4]; private static final String[] BYTE2HEX = new String[256]; private static final String[] BYTEPADDING = new String[16]; static { final char[] DIGITS = \"0123456789abcdef\".toCharArray ( ); for (int i = 0; i &lt; 256; i++) { HEXDUMP_TABLE[i &lt;&lt; 1] = DIGITS[i &gt;&gt;&gt; 4 &amp; 0x0F]; HEXDUMP_TABLE[(i &lt;&lt; 1) + 1] = DIGITS[i &amp; 0x0F]; } int i; // Generate the lookup table for hex dump paddings for (i = 0; i &lt; HEXPADDING.length; i++) { int padding = HEXPADDING.length - i; StringBuilder buf = new StringBuilder (padding * 3); for (int j = 0; j &lt; padding; j++) { buf.append (\" \"); } HEXPADDING[i] = buf.toString ( ); } // Generate the lookup table for the start-offset header in each row (up to 64KiB). for (i = 0; i &lt; HEXDUMP_ROWPREFIXES.length; i++) { StringBuilder buf = new StringBuilder (12); buf.append (NEWLINE); buf.append (Long.toHexString (i &lt;&lt; 4 &amp; 0xFFFFFFFFL | 0x100000000L)); buf.setCharAt (buf.length ( ) - 9, '|'); buf.append ('|'); HEXDUMP_ROWPREFIXES[i] = buf.toString ( ); } // Generate the lookup table for byte-to-hex-dump conversion for (i = 0; i &lt; BYTE2HEX.length; i++) { BYTE2HEX[i] = ' ' + StringUtil.byteToHexStringPadded (i); } // Generate the lookup table for byte dump paddings for (i = 0; i &lt; BYTEPADDING.length; i++) { int padding = BYTEPADDING.length - i; StringBuilder buf = new StringBuilder (padding); for (int j = 0; j &lt; padding; j++) { buf.append (' '); } BYTEPADDING[i] = buf.toString ( ); } // Generate the lookup table for byte-to-char conversion for (i = 0; i &lt; BYTE2CHAR.length; i++) { if (i &lt;= 0x1f || i &gt;= 0x7f) { BYTE2CHAR[i] = '.'; } else { BYTE2CHAR[i] = (char) i; } } } /** * æ‰“å°æ‰€æœ‰å†…å®¹ * * @param buffer */ public static void debugAll(ByteBuffer buffer) { int oldlimit = buffer.limit ( ); buffer.limit (buffer.capacity ( )); StringBuilder origin = new StringBuilder (256); appendPrettyHexDump (origin, buffer, 0, buffer.capacity ( )); System.out.println (\"+--------+-------------------- all ------------------------+----------------+\"); System.out.printf (\"position: [%d], limit: [%d]\\n\", buffer.position ( ), oldlimit); System.out.println (origin); buffer.limit (oldlimit); } /** * æ‰“å°å¯è¯»å–å†…å®¹ * * @param buffer */ public static void debugRead(ByteBuffer buffer) { StringBuilder builder = new StringBuilder (256); appendPrettyHexDump (builder, buffer, buffer.position ( ), buffer.limit ( ) - buffer.position ( )); System.out.println (\"+--------+-------------------- read -----------------------+----------------+\"); System.out.printf (\"position: [%d], limit: [%d]\\n\", buffer.position ( ), buffer.limit ( )); System.out.println (builder); } private static void appendPrettyHexDump(StringBuilder dump, ByteBuffer buf, int offset, int length) { if (isOutOfBounds (offset, length, buf.capacity ( ))) { throw new IndexOutOfBoundsException ( \"expected: \" + \"0 &lt;= offset(\" + offset + \") &lt;= offset + length(\" + length + \") &lt;= \" + \"buf.capacity(\" + buf.capacity ( ) + ')'); } if (length == 0) { return; } dump.append ( \" +-------------------------------------------------+\" + NEWLINE + \" | 0 1 2 3 4 5 6 7 8 9 a b c d e f |\" + NEWLINE + \"+--------+-------------------------------------------------+----------------+\"); final int startIndex = offset; final int fullRows = length &gt;&gt;&gt; 4; final int remainder = length &amp; 0xF; // Dump the rows which have 16 bytes. for (int row = 0; row &lt; fullRows; row++) { int rowStartIndex = (row &lt;&lt; 4) + startIndex; // Per-row prefix. appendHexDumpRowPrefix (dump, row, rowStartIndex); // Hex dump int rowEndIndex = rowStartIndex + 16; for (int j = rowStartIndex; j &lt; rowEndIndex; j++) { dump.append (BYTE2HEX[getUnsignedByte (buf, j)]); } dump.append (\" |\"); // ASCII dump for (int j = rowStartIndex; j &lt; rowEndIndex; j++) { dump.append (BYTE2CHAR[getUnsignedByte (buf, j)]); } dump.append ('|'); } // Dump the last row which has less than 16 bytes. if (remainder != 0) { int rowStartIndex = (fullRows &lt;&lt; 4) + startIndex; appendHexDumpRowPrefix (dump, fullRows, rowStartIndex); // Hex dump int rowEndIndex = rowStartIndex + remainder; for (int j = rowStartIndex; j &lt; rowEndIndex; j++) { dump.append (BYTE2HEX[getUnsignedByte (buf, j)]); } dump.append (HEXPADDING[remainder]); dump.append (\" |\"); // Ascii dump for (int j = rowStartIndex; j &lt; rowEndIndex; j++) { dump.append (BYTE2CHAR[getUnsignedByte (buf, j)]); } dump.append (BYTEPADDING[remainder]); dump.append ('|'); } dump.append (NEWLINE + \"+--------+-------------------------------------------------+----------------+\"); } private static void appendHexDumpRowPrefix(StringBuilder dump, int row, int rowStartIndex) { if (row &lt; HEXDUMP_ROWPREFIXES.length) { dump.append (HEXDUMP_ROWPREFIXES[row]); } else { dump.append (NEWLINE); dump.append (Long.toHexString (rowStartIndex &amp; 0xFFFFFFFFL | 0x100000000L)); dump.setCharAt (dump.length ( ) - 9, '|'); dump.append ('|'); } } public static short getUnsignedByte(ByteBuffer buffer, int index) { return (short) (buffer.get (index) &amp; 0xFF); } } è°ƒç”¨æ¡ˆä¾‹package com.kk.netty.nio.demo; import java.nio.ByteBuffer; import static com.kk.netty.nio.ByteBufferUtil.debugAll; public class TestByteBufferReadWrite { public static void main(String[] args) { ByteBuffer buffer = ByteBuffer.allocate (10); System.out.println (\"1ã€å…ˆæ’å…¥ a ï¼Œå†æ’å…¥ b c d\" ); // ASCLLç ï¼ˆåè¿›åˆ¶ï¼‰ 97 = åå…­è¿›åˆ¶ 0x61 = a buffer.put ((byte)0x61);// å†™å…¥ä¸€ä¸ªå­—ç¬¦ a debugAll(buffer);// è°ƒè¯•æ‰“å° buffer.put (new byte[]{0x62,0x63,0x64});// å†™å…¥å­—ç¬¦ b c d debugAll(buffer);// è°ƒè¯•æ‰“å° System.out.println (\" 2ã€åˆ‡æ¢ è¯»æ¨¡å¼ï¼Œå–ä¸€ä¸ªå­—ç¬¦\" ); // åœ¨æ²¡æœ‰åˆ‡æ¢ä¸º è¯» æ¨¡å¼çš„æ—¶å€™ï¼Œç›´æ¥æ‹¿æ˜¯æ‹¿ä¸åˆ°çš„ //System.out.println (buffer.get ( )); buffer.flip ();// åˆ‡æ¢è¯»æ¨¡å¼ System.out.println (buffer.get ( ));// å–å‡ºä¸€ä¸ªï¼Œè¿˜å‰©3ä¸ª System.out.println (buffer.get ( ));// å–å‡ºä¸€ä¸ªï¼Œè¿˜å‰©2ä¸ª debugAll(buffer);// è°ƒè¯•æ‰“å° System.out.println (\"3ã€æœªè¯»å–çš„å¾€å‰ç§»(å‹ç¼©),ç¬¬3ã€4ä½ä¼šé—ç•™äºŒä¸ª63ã€64æ˜¯å› ä¸ºæ²¡æœ‰æ¸…é›¶ï¼Œç„¶ååé¢æ’å…¥ä¸å½±å“ï¼Œä¼šä»å·²æœ‰çš„åé¢æ’å…¥\" ); buffer.compact (); debugAll(buffer);// è°ƒè¯•æ‰“å° System.out.println (\"4ã€æ’å…¥ä¸¤ä¸ªå­—ç¬¦ï¼Œä»å·²æœ‰çš„åé¢æ’å…¥\" ); buffer.put (new byte[]{0x65,0x6f}); debugAll(buffer);// è°ƒè¯•æ‰“å° } } 3ã€ByteBuffer å¸¸è§ API åˆ†é…ç©ºé—´ å‘ buffer å†™å…¥æ•°æ® ä» buffer è¯»å–æ•°æ® mark å’Œ reset å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬ Buffer çš„çº¿ç¨‹å®‰å…¨ 3-1ã€åˆ†é…ç©ºé—´å¯ä»¥ä½¿ç”¨ allocate æ–¹æ³•ä¸º ByteBuffer åˆ†é…ç©ºé—´ï¼Œå…¶å®ƒ buffer ç±»ä¹Ÿæœ‰è¯¥æ–¹æ³• Bytebuffer buf = ByteBuffer.allocate(16); 3-2ã€buffer å†™å…¥æ•°æ®æœ‰ä¸¤ç§åŠæ³• è°ƒç”¨ channel çš„ read æ–¹æ³• è°ƒç”¨ buffer è‡ªå·±çš„ put æ–¹æ³• int readBytes = channel.read(buf); å’Œ buf.put((byte)127); 3-3ã€buffer è¯»å–æ•°æ®åŒæ ·æœ‰ä¸¤ç§åŠæ³• è°ƒç”¨ channel çš„ write æ–¹æ³• è°ƒç”¨ buffer è‡ªå·±çš„ get æ–¹æ³• int writeBytes = channel.write(buf); å’Œ byte b = buf.get(); get æ–¹æ³•ä¼šè®© position è¯»æŒ‡é’ˆå‘åèµ°ï¼Œå¦‚æœæƒ³é‡å¤è¯»å–æ•°æ® å¯ä»¥è°ƒç”¨ rewind æ–¹æ³•å°† position é‡æ–°ç½®ä¸º 0 æˆ–è€…è°ƒç”¨ get(int i) æ–¹æ³•è·å–ç´¢å¼• i çš„å†…å®¹ï¼Œå®ƒä¸ä¼šç§»åŠ¨è¯»æŒ‡é’ˆ 3-4ã€mark å’Œ resetmark æ˜¯åœ¨è¯»å–æ—¶ï¼Œåšä¸€ä¸ªæ ‡è®°ï¼Œå³ä½¿ position æ”¹å˜ï¼Œåªè¦è°ƒç”¨ reset å°±èƒ½å›åˆ° mark çš„ä½ç½® æ³¨æ„ rewind å’Œ flip éƒ½ä¼šæ¸…é™¤ mark ä½ç½® 3-5ã€å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬package com.kk.netty.nio.demo; import java.nio.ByteBuffer; import java.nio.CharBuffer; import java.nio.charset.Charset; import java.nio.charset.StandardCharsets; import static com.kk.netty.nio.ByteBufferUtil.debugAll; public class TestButeBufferApi { public static void main(String[] args) { ByteBuffer buffer1 = StandardCharsets.UTF_8.encode (\"ä½ å¥½\"); ByteBuffer buffer2 = Charset.forName (\"utf-8\").encode (\"ä½ å¥½\"); debugAll (buffer1); debugAll (buffer2); CharBuffer buffer3 = StandardCharsets.UTF_8.decode (buffer1); System.out.println (buffer3.getClass ( )); System.out.println (buffer3.toString ( )); } } è¾“å‡º +-------------------------------------------------+ | 0 1 2 3 4 5 6 7 8 9 a b c d e f | +--------+-------------------------------------------------+----------------+ |00000000| e4 bd a0 e5 a5 bd |...... | +--------+-------------------------------------------------+----------------+ +-------------------------------------------------+ | 0 1 2 3 4 5 6 7 8 9 a b c d e f | +--------+-------------------------------------------------+----------------+ |00000000| e4 bd a0 e5 a5 bd |...... | +--------+-------------------------------------------------+----------------+ class java.nio.HeapCharBuffer ä½ å¥½ 3-6ã€Buffer çš„çº¿ç¨‹å®‰å…¨ Buffer æ˜¯éçº¿ç¨‹å®‰å…¨çš„ 4ã€Scattering Reads1ã€åˆ†æ•£é›†ä¸­è¯»åˆ†æ•£è¯»å–ï¼Œæœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ 3parts.txt onetwothree ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¯»å–ï¼Œå¯ä»¥å°†æ•°æ®å¡«å……è‡³å¤šä¸ª buffer package com.kk.netty.nio.demo; import java.io.IOException; import java.io.RandomAccessFile; import java.nio.ByteBuffer; import java.nio.channels.FileChannel; import static com.kk.netty.nio.ByteBufferUtil.debugAll; public class TestScatteringReads { public static void main(String[] args) { try (RandomAccessFile file = new RandomAccessFile (\"boot_netty/helloword/3parts.txt\", \"rw\")) { FileChannel channel = file.getChannel ( ); ByteBuffer a = ByteBuffer.allocate (3); ByteBuffer b = ByteBuffer.allocate (3); ByteBuffer c = ByteBuffer.allocate (5); channel.read (new ByteBuffer[]{a, b, c}); a.flip ( ); b.flip ( ); c.flip ( ); debugAll (a); debugAll (b); debugAll (c); } catch (IOException e) { e.printStackTrace ( ); } } } ç»“æœ +-------------------------------------------------+ | 0 1 2 3 4 5 6 7 8 9 a b c d e f | +--------+-------------------------------------------------+----------------+ |00000000| 6f 6e 65 |one | +--------+-------------------------------------------------+----------------+ +-------------------------------------------------+ | 0 1 2 3 4 5 6 7 8 9 a b c d e f | +--------+-------------------------------------------------+----------------+ |00000000| 74 77 6f |two | +--------+-------------------------------------------------+----------------+ +-------------------------------------------------+ | 0 1 2 3 4 5 6 7 8 9 a b c d e f | +--------+-------------------------------------------------+----------------+ |00000000| 74 68 72 65 65 |three | +--------+-------------------------------------------------+----------------+ 2ã€åˆ†æ•£é›†ä¸­å†™package com.kk.netty.nio.demo; import java.io.IOException; import java.io.RandomAccessFile; import java.nio.ByteBuffer; import java.nio.channels.FileChannel; import java.nio.charset.StandardCharsets; /** * åˆ†æ•£é›†ä¸­å†™ */ public class TestScatteringWrites { public static void main(String[] args) { ByteBuffer b1 = StandardCharsets.UTF_8.encode (\"hello\"); ByteBuffer b2 = StandardCharsets.UTF_8.encode (\"world\"); ByteBuffer b3 = StandardCharsets.UTF_8.encode (\"ä½ å¥½ï¼Œä¸–ç•Œ\"); try (FileChannel file = new RandomAccessFile (\"boot_netty/helloword/2parts.txt\", \"rw\").getChannel ( )) { file.write (new ByteBuffer[]{b1, b2, b3}); } catch (IOException e) { e.printStackTrace ( ); } } } 5ã€Gathering Writesç½‘ç»œä¸Šæœ‰å¤šæ¡æ•°æ®å‘é€ç»™æœåŠ¡ç«¯ï¼Œæ•°æ®ä¹‹é—´ä½¿ç”¨ \\n è¿›è¡Œåˆ†éš”ä½†ç”±äºæŸç§åŸå› è¿™äº›æ•°æ®åœ¨æ¥æ”¶æ—¶ï¼Œè¢«è¿›è¡Œäº†é‡æ–°ç»„åˆï¼Œä¾‹å¦‚åŸå§‹æ•°æ®æœ‰3æ¡ä¸º Hello,world\\n Iâ€™m zhangsan\\n How are you?\\n å˜æˆäº†ä¸‹é¢çš„ä¸¤ä¸ª byteBuffer (é»åŒ…ï¼ŒåŠåŒ…) Hello,world\\nIâ€™m zhangsan\\nHo w are you?\\n ç°åœ¨è¦æ±‚ä½ ç¼–å†™ç¨‹åºï¼Œå°†é”™ä¹±çš„æ•°æ®æ¢å¤æˆåŸå§‹çš„æŒ‰ \\n åˆ†éš”çš„æ•°æ® package com.kk.netty.nio.demo; import java.nio.ByteBuffer; import static com.kk.netty.nio.ByteBufferUtil.debugAll; public class TestGatheringWrites { public static void main(String[] args) { ByteBuffer source = ByteBuffer.allocate (32); // 11 24 source.put (\"Hello,world\\nI'm zhangsan\\nHo\".getBytes ( )); split (source); source.put (\"w are you?\\nhaha!\\n\".getBytes ( )); split (source); } private static void split(ByteBuffer source) { source.flip ( ); // source.limit ( ) ç¼“å†²åŒºå®¹é‡é•¿åº¦ for (int i = 0; i &lt; source.limit ( ); i++) { // æ‰¾åˆ°ä¸€æ¡å®Œæ•´ä¿¡æ¯ if (source.get (i) == '\\n') { System.out.println (i); // è®¡ç®—æ¯ä¸ª \\n è¯ç»„çš„é•¿åº¦ï¼ˆæ¢è¡Œç¬¦å· +1 - æ¸¸æ ‡èµ·å§‹ä½ç½®ï¼‰ int length = i + 1 - source.position ( ); // å°†è¿™æ¡å®Œæ•´ä¿¡æ¯å­˜å…¥æ–°çš„ bytebuffer ByteBuffer target = ByteBuffer.allocate (length); // ä» source è¯»ï¼Œå‘ target å†™ for (int j = 0; j &lt; length; j++) { target.put (source.get ()); } debugAll (target); } } // æœªè¯»çš„å¾€å‰ç§»åŠ¨ source.compact ( ); } } ä¸‰ã€æ–‡ä»¶ç¼–ç¨‹1ã€FileChannel1ã€âš ï¸ FileChannel å·¥ä½œæ¨¡å¼ FileChannel åªèƒ½å·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹ 2ã€è·å–ä¸èƒ½ç›´æ¥æ‰“å¼€ FileChannelï¼Œå¿…é¡»é€šè¿‡ FileInputStreamã€FileOutputStream æˆ–è€… RandomAccessFile æ¥è·å– FileChannelï¼Œå®ƒä»¬éƒ½æœ‰ getChannel æ–¹æ³• é€šè¿‡ FileInputStream è·å–çš„ channel åªèƒ½è¯» é€šè¿‡ FileOutputStream è·å–çš„ channel åªèƒ½å†™ é€šè¿‡ RandomAccessFile æ˜¯å¦èƒ½è¯»å†™æ ¹æ®æ„é€  RandomAccessFile æ—¶çš„è¯»å†™æ¨¡å¼å†³å®š 3ã€è¯»å–ä¼šä» channel è¯»å–æ•°æ®å¡«å…… ByteBufferï¼Œè¿”å›å€¼è¡¨ç¤ºè¯»åˆ°äº†å¤šå°‘å­—èŠ‚ï¼Œ-1 è¡¨ç¤ºåˆ°è¾¾äº†æ–‡ä»¶çš„æœ«å°¾ int readBytes = channel.read(buffer); 4ã€å†™å…¥å†™å…¥çš„æ­£ç¡®å§¿åŠ¿å¦‚ä¸‹ï¼Œ SocketChannel ByteBuffer buffer = ...; buffer.put(...); // å­˜å…¥æ•°æ® buffer.flip(); // åˆ‡æ¢è¯»æ¨¡å¼ while(buffer.hasRemaining()) { channel.write(buffer); } åœ¨ while ä¸­è°ƒç”¨ channel.write æ˜¯å› ä¸º write æ–¹æ³•å¹¶ä¸èƒ½ä¿è¯ä¸€æ¬¡å°† buffer ä¸­çš„å†…å®¹å…¨éƒ¨å†™å…¥ channel 5ã€ä½ç½®è·å–å½“å‰ä½ç½® long pos = channel.position(); è®¾ç½®å½“å‰ä½ç½® long newPos = ...; channel.position(newPos); è®¾ç½®å½“å‰ä½ç½®æ—¶ï¼Œå¦‚æœè®¾ç½®ä¸ºæ–‡ä»¶çš„æœ«å°¾ è¿™æ—¶è¯»å–ä¼šè¿”å› -1 è¿™æ—¶å†™å…¥ï¼Œä¼šè¿½åŠ å†…å®¹ï¼Œä½†è¦æ³¨æ„å¦‚æœ position è¶…è¿‡äº†æ–‡ä»¶æœ«å°¾ï¼Œå†å†™å…¥æ—¶åœ¨æ–°å†…å®¹å’ŒåŸæœ«å°¾ä¹‹é—´ä¼šæœ‰ç©ºæ´ï¼ˆ00ï¼‰ 6ã€å¤§å°ä½¿ç”¨ size æ–¹æ³•è·å–æ–‡ä»¶çš„å¤§å° 7ã€å¼ºåˆ¶å†™å…¥æ“ä½œç³»ç»Ÿå‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œä¼šå°†æ•°æ®ç¼“å­˜ï¼Œä¸æ˜¯ç«‹åˆ»å†™å…¥ç£ç›˜ã€‚å¯ä»¥è°ƒç”¨ force(true) æ–¹æ³•å°†æ–‡ä»¶å†…å®¹å’Œå…ƒæ•°æ®ï¼ˆæ–‡ä»¶çš„æƒé™ç­‰ä¿¡æ¯ï¼‰ç«‹åˆ»å†™å…¥ç£ç›˜ 2ã€ä¸¤ä¸ª Channel ä¼ è¾“æ•°æ®åŸºç¡€ç‰ˆï¼šé™åˆ¶2g package com.kk.netty.nio.file; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.IOException; import java.nio.channels.FileChannel; public class TestFileChannel { public static void main(String[] args) { String FROM = \"boot_netty/helloword/data.txt\"; String TO = \"boot_netty/helloword/to.txt\"; long start = System.nanoTime ( ); try ( FileChannel from = new FileInputStream (FROM).getChannel ( ); FileChannel to = new FileOutputStream (TO).getChannel ( ); ) { // æ•°æ® from ä¼ è¾“åˆ° to*ï¼ˆå°±æ˜¯ä¸€ä¸ªæ‹·è´è¿‡ç¨‹ï¼‰ // æ•ˆç‡ä¼šæ¯”ä¼ ç»Ÿçš„åŸç”Ÿapi é«˜ï¼Œåº•å±‚ä¼šç”¨æ“ä½œç³»ç»Ÿçš„é›¶æ‹·è´è¿›è¡Œä¼˜åŒ– from.transferTo (0, from.size ( ), to); } catch (IOException e) { e.printStackTrace ( ); } long end = System.nanoTime ( ); System.out.println (\"transferTo ç”¨æ—¶ï¼š\" + (end - start) / 1000_000.0); } } ä¼˜åŒ–ç‰ˆï¼šå¾ªç¯æ’å…¥ï¼Œè§£å†³2gé™åˆ¶ package com.kk.netty.nio.file; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.IOException; import java.nio.channels.FileChannel; public class TestFileChannel { public static void main(String[] args) { String FROM = \"boot_netty/helloword/data.txt\"; String TO = \"boot_netty/helloword/to.txt\"; long start = System.nanoTime ( ); try ( FileChannel from = new FileInputStream (FROM).getChannel ( ); FileChannel to = new FileOutputStream (TO).getChannel ( ); ) { // æ•°æ® from ä¼ è¾“åˆ° to*ï¼ˆå°±æ˜¯ä¸€ä¸ªæ‹·è´è¿‡ç¨‹ï¼‰ // æ•ˆç‡ä¼šæ¯”ä¼ ç»Ÿçš„åŸç”Ÿapi é«˜ï¼Œåº•å±‚ä¼šç”¨æ“ä½œç³»ç»Ÿçš„é›¶æ‹·è´è¿›è¡Œä¼˜åŒ– long size = from.size ( ); // left å˜é‡ä»£è¡¨è¿˜å‰©ä½™å¤šå°‘å­—èŠ‚ for (long left = size; left &gt; 0; ) { System.out.println (\"position:\" + (size - left) + \" left:\" + left); left -= from.transferTo (size - left, left, to); } } catch (IOException e) { e.printStackTrace ( ); } long end = System.nanoTime ( ); System.out.println (\"transferTo ç”¨æ—¶ï¼š\" + (end - start) / 1000_000.0); } } 3ã€Pathjdk7 å¼•å…¥äº† Path å’Œ Paths ç±» Path ç”¨æ¥è¡¨ç¤ºæ–‡ä»¶è·¯å¾„ Paths æ˜¯å·¥å…·ç±»ï¼Œç”¨æ¥è·å– Path å®ä¾‹ Path source = Paths.get(\"1.txt\"); // ç›¸å¯¹è·¯å¾„ ä½¿ç”¨ user.dir ç¯å¢ƒå˜é‡æ¥å®šä½ 1.txt Path source = Paths.get(\"d:\\\\1.txt\"); // ç»å¯¹è·¯å¾„ ä»£è¡¨äº† d:\\1.txt Path source = Paths.get(\"d:/1.txt\"); // ç»å¯¹è·¯å¾„ åŒæ ·ä»£è¡¨äº† d:\\1.txt Path projects = Paths.get(\"d:\\\\data\", \"projects\"); // ä»£è¡¨äº† d:\\data\\projects . ä»£è¡¨äº†å½“å‰è·¯å¾„ .. ä»£è¡¨äº†ä¸Šä¸€çº§è·¯å¾„ ä¾‹å¦‚ç›®å½•ç»“æ„å¦‚ä¸‹ d: |- data |- projects |- a |- b ä»£ç  Path path = Paths.get(\"d:\\\\data\\\\projects\\\\a\\\\..\\\\b\"); System.out.println(path); System.out.println(path.normalize()); // æ­£å¸¸åŒ–è·¯å¾„ ä¼šè¾“å‡º d:\\data\\projects\\a\\..\\b d:\\data\\projects\\b 4ã€Filesæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨Path path = Paths.get(\"helloword/data.txt\"); System.out.println(Files.exists(path)); åˆ›å»ºä¸€çº§ç›®å½•Path path = Paths.get(\"helloword/d1\"); Files.createDirectory(path); å¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException ä¸èƒ½ä¸€æ¬¡åˆ›å»ºå¤šçº§ç›®å½•ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ NoSuchFileException åˆ›å»ºå¤šçº§ç›®å½•ç”¨Path path = Paths.get(\"helloword/d1/d2\"); Files.createDirectories(path); æ‹·è´æ–‡ä»¶Path source = Paths.get(\"helloword/data.txt\"); Path target = Paths.get(\"helloword/target.txt\"); Files.copy(source, target); å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException å¦‚æœå¸Œæœ›ç”¨ source è¦†ç›–æ‰ targetï¼Œéœ€è¦ç”¨ StandardCopyOption æ¥æ§åˆ¶ Files.copy(source, target, StandardCopyOption.REPLACE_EXISTING); ç§»åŠ¨æ–‡ä»¶Path source = Paths.get(\"helloword/data.txt\"); Path target = Paths.get(\"helloword/data.txt\"); Files.move(source, target, StandardCopyOption.ATOMIC_MOVE); StandardCopyOption.ATOMIC_MOVE ä¿è¯æ–‡ä»¶ç§»åŠ¨çš„åŸå­æ€§ åˆ é™¤æ–‡ä»¶Path target = Paths.get(\"helloword/target.txt\"); Files.delete(target); å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ NoSuchFileException åˆ é™¤ç›®å½•Path target = Paths.get(\"helloword/d1\"); Files.delete(target); å¦‚æœç›®å½•è¿˜æœ‰å†…å®¹ï¼Œä¼šæŠ›å¼‚å¸¸ DirectoryNotEmptyException éå†ç›®å½•æ–‡ä»¶è®¾è®¡æ¨¡å¼ï¼šè®¿é—®è€…æ¨¡å¼ public static void main(String[] args) throws IOException { // ç›®å½•ä¸ªæ•° AtomicInteger direCount = new AtomicInteger ( ); // æ–‡ä»¶ä¸ªæ•° AtomicInteger fileCount = new AtomicInteger ( ); // ç›®å½•å¯¹è±¡ Path path = Paths.get (\"C:\\\\Program Files\\\\Java\\\\jdk1.8.0_202\"); // è®¾è®¡æ¨¡å¼ï¼šè®¿é—®è€…æ¨¡å¼ Files.walkFileTree (path,new SimpleFileVisitor&lt;Path&gt;(){ // è·å–ç›®å½• @Override public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) throws IOException { System.out.println (dir ); direCount.incrementAndGet (); return super.preVisitDirectory (dir, attrs); } // è·å–æ–‡ä»¶ @Override public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException { System.out.println (file ); fileCount.incrementAndGet (); return super.visitFile (file, attrs); } } ); System.out.println(direCount); // 133 System.out.println(fileCount); // 1479 } ç»Ÿè®¡ jar çš„æ•°ç›® public static void main(String[] args) throws IOException { // æ–‡ä»¶ä¸ªæ•° AtomicInteger fileCount = new AtomicInteger ( ); // ç›®å½•å¯¹è±¡ Path path = Paths.get (\"C:\\\\Program Files\\\\Java\\\\jdk1.8.0_202\"); // è®¾è®¡æ¨¡å¼ï¼šè®¿é—®è€…æ¨¡å¼ Files.walkFileTree (path,new SimpleFileVisitor&lt;Path&gt; (){ @Override public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException { // æ ¹æ®æ–‡ä»¶åç¼€ç­›é€‰ if (file.toFile ().getName ().endsWith (\".jar\")){ fileCount.incrementAndGet (); } return super.visitFile (file, attrs); } }); System.out.println(fileCount); // 705 } åˆ é™¤å¤šçº§ç›®å½• public class TestRemoveFile { public static void main(String[] args) throws IOException { Path path = Paths.get (\"j:\\\\test\"); Files.walkFileTree (path,new SimpleFileVisitor&lt;Path&gt; (){ // å…ˆåˆ é™¤æ–‡ä»¶ @Override public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException { Files.delete (file); return super.visitFile (file, attrs); } // å†åˆ é™¤ç›®å½• @Override public FileVisitResult postVisitDirectory(Path dir, IOException exc) throws IOException { Files.delete (dir); return super.postVisitDirectory (dir, exc); } }); } } âš ï¸ åˆ é™¤å¾ˆå±é™© åˆ é™¤æ˜¯å±é™©æ“ä½œï¼Œç¡®ä¿è¦é€’å½’åˆ é™¤çš„æ–‡ä»¶å¤¹æ²¡æœ‰é‡è¦å†…å®¹ æ‹·è´å¤šçº§ç›®å½• public class TestCopyMultDirectory { public static void main(String[] args) throws IOException { String source = \"j:\\\\test\"; String target = \"j:\\\\testTemp\"; long start = System.currentTimeMillis (); Files.walk (Paths.get (source)).forEach (path -&gt; { try { String targetName = path.toString ( ).replace (source, target); // å¦‚æœæ˜¯ç›®å½• if (Files.isDirectory (path)){ Files.createDirectories (Paths.get (targetName)); } // å¦‚æœæ˜¯æ–‡ä»¶ else if (Files.isRegularFile (path)){ Files.copy (path,Paths.get (targetName)); } } catch (Exception e) { e.printStackTrace ( ); } }); long end = System.currentTimeMillis(); System.out.println(end - start); } } å››ã€ç½‘ç»œç¼–ç¨‹1ã€éé˜»å¡ vs é˜»å¡1.1ã€é˜»å¡ é˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šå¯¼è‡´çº¿ç¨‹æš‚åœ ServerSocketChannel.accept ä¼šåœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶è®©çº¿ç¨‹æš‚åœ SocketChannel.read ä¼šåœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶è®©çº¿ç¨‹æš‚åœ é˜»å¡çš„è¡¨ç°å…¶å®å°±æ˜¯çº¿ç¨‹æš‚åœäº†ï¼Œæš‚åœæœŸé—´ä¸ä¼šå ç”¨ cpuï¼Œä½†çº¿ç¨‹ç›¸å½“äºé—²ç½® å•çº¿ç¨‹ä¸‹ï¼Œé˜»å¡æ–¹æ³•ä¹‹é—´ç›¸äº’å½±å“ï¼Œå‡ ä¹ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œéœ€è¦å¤šçº¿ç¨‹æ”¯æŒ ä½†å¤šçº¿ç¨‹ä¸‹ï¼Œæœ‰æ–°çš„é—®é¢˜ï¼Œä½“ç°åœ¨ä»¥ä¸‹æ–¹é¢ 32 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 320kï¼Œ64 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 1024kï¼Œå¦‚æœè¿æ¥æ•°è¿‡å¤šï¼Œå¿…ç„¶å¯¼è‡´ OOMï¼Œå¹¶ä¸”çº¿ç¨‹å¤ªå¤šï¼Œåè€Œä¼šå› ä¸ºé¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´æ€§èƒ½é™ä½ å¯ä»¥é‡‡ç”¨çº¿ç¨‹æ± æŠ€æœ¯æ¥å‡å°‘çº¿ç¨‹æ•°å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ²»æ ‡ä¸æ²»æœ¬ï¼Œå¦‚æœæœ‰å¾ˆå¤šè¿æ¥å»ºç«‹ï¼Œä½†é•¿æ—¶é—´ inactiveï¼Œä¼šé˜»å¡çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹ï¼Œå› æ­¤ä¸é€‚åˆé•¿è¿æ¥ï¼Œåªé€‚åˆçŸ­è¿æ¥ é˜»å¡åœ¨å“ªé‡Œ(äººè¯) 1ã€è¿æ¥çš„é˜»å¡ï¼ˆacceptï¼‰ 2ã€å†™å…¥æ•°æ®çš„é˜»å¡ï¼ˆreadï¼‰ 3ã€accept çš„æ—¶å€™ä¸èƒ½ read ,read æ—¶å€™ä¸èƒ½ accept ï¼Œè¿™å°±æ˜¯é˜»å¡ 4ã€ä¸€å¥è¯ï¼šè¿™ä¸ªçº¿ç¨‹æ²¡æœ‰å‘ç”Ÿï¼Œè¿˜ä¼šå°±ä¼šç­‰å¾…ï¼ˆåä¹‹ï¼šä¸ä¼šç­‰å¾…åˆ™æ˜¯éé˜»å¡ï¼‰ server@Slf4j public class Server { public static void main(String[] args) throws IOException { // ä½¿ç”¨ nio æ¥ç†è§£é˜»å¡æ¨¡å¼ï¼Œå•çº¿ç¨‹ ByteBuffer buffer = ByteBuffer.allocate (16); // 1ã€åˆ›å»ºæœåŠ¡ç«¯ ServerSocketChannel ssc = ServerSocketChannel.open ( ); // 2ã€ç»‘å®šç›‘å¬ç«¯å£ ssc.bind (new InetSocketAddress (8080)); // 3ã€åˆ›å»ºè¿æ¥é›†åˆ List&lt;SocketChannel&gt; channels = new ArrayList&lt;&gt; ( ); // å¾ªç¯è¿è¡Œç­‰å¾… while(true){ log.debug (\"connection...\"); // 4ã€accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡ SocketChannel sc = ssc.accept ( );//é˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹åœæ­¢è¿è¡Œ log.debug(\"connected... {}\", sc); channels.add (sc); for (SocketChannel channel : channels) { // 5ã€æ¥å—å®¢æˆ·ç«¯å‘é€çš„æ•°æ® log.debug(\"before read... {}\", channel); channel.read (buffer);// å†™å…¥ï¼ˆé˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹åœæ­¢è¿è¡Œï¼‰ buffer.flip ();//åˆ‡æ¢ä¸ºè¯»æ¨¡å¼ debugRead(buffer);// æ‰“å°å¯è¯»å–çš„å†…å®¹ buffer.clear ();// åˆ‡æ¢ä¸ºå†™æ¨¡å¼ log.debug(\"after read...{}\", channel); } } } } clientpublic class Client { public static void main(String[] args) throws IOException { SocketChannel sc = SocketChannel.open ( ); sc.connect (new InetSocketAddress (\"localhost\",8080)); System.out.println (\"waiting...\" ); } } 1.2ã€éé˜»å¡ éé˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šä¸ä¼šè®©çº¿ç¨‹æš‚åœ åœ¨ ServerSocketChannel.accept åœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶ï¼Œä¼šè¿”å› nullï¼Œç»§ç»­è¿è¡Œ SocketChannel.read åœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œä¼šè¿”å› 0ï¼Œä½†çº¿ç¨‹ä¸å¿…é˜»å¡ï¼Œå¯ä»¥å»æ‰§è¡Œå…¶å®ƒ SocketChannel çš„ read æˆ–æ˜¯å»æ‰§è¡Œ ServerSocketChannel.accept å†™æ•°æ®æ—¶ï¼Œçº¿ç¨‹åªæ˜¯ç­‰å¾…æ•°æ®å†™å…¥ Channel å³å¯ï¼Œæ— éœ€ç­‰ Channel é€šè¿‡ç½‘ç»œæŠŠæ•°æ®å‘é€å‡ºå» ä½†éé˜»å¡æ¨¡å¼ä¸‹ï¼Œå³ä½¿æ²¡æœ‰è¿æ¥å»ºç«‹ï¼Œå’Œå¯è¯»æ•°æ®ï¼Œçº¿ç¨‹ä»ç„¶åœ¨ä¸æ–­è¿è¡Œï¼Œç™½ç™½æµªè´¹äº† cpu æ•°æ®å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹å®é™…è¿˜æ˜¯é˜»å¡çš„ï¼ˆAIO æ”¹è¿›çš„åœ°æ–¹ï¼‰ serverï¼šæœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯ä»£ç ä¸å˜@Slf4j public class NotBlockServer { public static void main(String[] args) throws IOException { // ä½¿ç”¨ nio æ¥ç†è§£é˜»å¡æ¨¡å¼ï¼Œå•çº¿ç¨‹ ByteBuffer buffer = ByteBuffer.allocate (16); // 1ã€åˆ›å»ºæœåŠ¡ç«¯ ServerSocketChannel ssc = ServerSocketChannel.open ( ); ssc.configureBlocking (false);// åˆ‡æ¢ä¸ºéé˜»å¡æ¨¡å¼ï¼Œé»˜è®¤ä¸ºé˜»å¡ // 2ã€ç»‘å®šç›‘å¬ç«¯å£ ssc.bind (new InetSocketAddress (8080)); // 3ã€åˆ›å»ºè¿æ¥é›†åˆ List&lt;SocketChannel&gt; channels = new ArrayList&lt;&gt; ( ); // å¾ªç¯è¿è¡Œç­‰å¾… while (true) { log.debug (\"connection...\"); // 4ã€accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡ SocketChannel sc = ssc.accept ( );//éé˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹ç»§ç»­è¿è¡Œ log.debug (\"connected... {}\", sc); channels.add (sc); for (SocketChannel channel : channels) { // 5ã€æ¥å—å®¢æˆ·ç«¯å‘é€çš„æ•°æ® // å¦‚æœæ²¡æœ‰è¯»åˆ°æ•°æ®ï¼Œread è¿”å› 0 int read = channel.read (buffer);// å†™å…¥ï¼ˆéé˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹ç»§ç»­è¿è¡Œï¼‰ if (read &gt; 0) { log.debug (\"before read... {}\", channel); buffer.flip ( );//åˆ‡æ¢ä¸ºè¯»æ¨¡å¼ debugRead (buffer);// æ‰“å°å¯è¯»å–çš„å†…å®¹ buffer.clear ( );// åˆ‡æ¢ä¸ºå†™æ¨¡å¼ log.debug (\"after read...{}\", channel); } } } } } å¤šä¸ªå®¢æˆ·ç«¯è°ƒè¯•å‘ç°ï¼šå…¶å®ä¸ç”¨çš„æ—¶å€™è¿˜åœ¨ä¸€ç›´æ‰“å°ï¼ŒCPUçŠ¶æ€æ˜¯æ‰“æ»¡çš„ï¼Œè‡ªç„¶ä¹Ÿæ˜¯æ€§èƒ½çš„æ¶ˆè€— 1.3ã€å¤šè·¯å¤ç”¨å•çº¿ç¨‹å¯ä»¥é…åˆ Selector å®Œæˆå¯¹å¤šä¸ª Channel å¯è¯»å†™äº‹ä»¶çš„ç›‘æ§ï¼Œè¿™ç§°ä¹‹ä¸ºå¤šè·¯å¤ç”¨ å¤šè·¯å¤ç”¨ä»…é’ˆå¯¹ç½‘ç»œ IOã€æ™®é€šæ–‡ä»¶ IO æ²¡æ³•åˆ©ç”¨å¤šè·¯å¤ç”¨ å¦‚æœä¸ç”¨ Selector çš„éé˜»å¡æ¨¡å¼ï¼Œçº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨åšæ— ç”¨åŠŸï¼Œè€Œ Selector èƒ½å¤Ÿä¿è¯ æœ‰å¯è¿æ¥äº‹ä»¶æ—¶æ‰å»è¿æ¥ æœ‰å¯è¯»äº‹ä»¶æ‰å»è¯»å– æœ‰å¯å†™äº‹ä»¶æ‰å»å†™å…¥ é™äºç½‘ç»œä¼ è¾“èƒ½åŠ›ï¼ŒChannel æœªå¿…æ—¶æ—¶å¯å†™ï¼Œä¸€æ—¦ Channel å¯å†™ï¼Œä¼šè§¦å‘ Selector çš„å¯å†™äº‹ä»¶ 2ã€Selector å¥½å¤„ ä¸€ä¸ªçº¿ç¨‹é…åˆ selector å°±å¯ä»¥ç›‘æ§å¤šä¸ª channel çš„äº‹ä»¶ï¼Œäº‹ä»¶å‘ç”Ÿçº¿ç¨‹é‡‡å–å¤„ç†ã€‚é¿å…éé˜»å¡æ¨¡å¼ä¸‹æ‰€åšçš„æ— ç”¨åŠŸ è®©è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¢«å……åˆ†çš„åˆ©ç”¨ èŠ‚çº¦äº†çº¿ç¨‹çš„æ•°é‡ å‡å°‘äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ 1ã€åˆ›å»ºSelector selector = Selector.open ( ); 2ã€ç»‘å®š Channel äº‹ä»¶ä¹Ÿç§°ä¹‹ä¸ºæ³¨å†Œäº‹ä»¶ï¼Œç»‘å®šçš„äº‹ä»¶ selector æ‰å›å…³å¿ƒ channel.configureBlocking (false); // æ ¹æ®å¸¸é‡å€¼æ¥é€‰æ‹©ç»‘å®šç±»å‹ SelectionKey.OP_ACCEPT SelectionKey key = channel.register (selector, ç»‘å®šäº‹ä»¶); channel å¿…é¡»åœ¨éé˜»å¡æ¨¡å¼ä¸‹å·¥ä½œ FileChannel æ²¡æœ‰éé˜»å¡æ¨¡å¼ï¼Œæ‰€ä»¥ä¸èƒ½é…åˆ selector ä½¿ç”¨ ç»‘å®šçš„äº‹ä»¶ç±»å‹ connect - å®¢æˆ·ç«¯è¿æ¥æˆåŠŸæ—¶è§¦å‘ accept - æœåŠ¡ç«¯æˆåŠŸè¿æ¥æ—¶è§¦å‘ read - æ•°æ®å¯è¯»å…¥æ—¶è§¦å‘ write - æ•°æ®å¯å†™å…¥æ—¶è§¦å‘ 3ã€ç›‘å¬ Channel äº‹ä»¶å¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹æ³•æ¥ç›‘å¬æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæ–¹æ³•çš„è¿”å›å€¼ä»£è¡¨æœ‰å¤šå°‘ channel å‘ç”Ÿäº†äº‹ä»¶ã€‚ æ–¹æ³•ä¸€ï¼šé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿ int count = selector.select(); æ–¹æ³•äºŒï¼šé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿï¼Œæˆ–æ˜¯è¶…æ—¶ï¼ˆæ—¶é—´å•ä½ä¸º msï¼‰ int count = selector.select(long timeout) æ–¹æ³•ä¸‰ï¼šä¸ä¼šé˜»å¡ï¼Œä¹Ÿå°±æ˜¯ä¸ç®¡æœ‰æ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå°±ç«‹å³è¿”å›ï¼Œè‡ªå·±æ ¹æ®è¿”å›å€¼æ£€æŸ¥å½“å‰æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿã€‚ int count = selector.selectNow(); 4ã€ğŸ’¡ select ä½•æ—¶ä¸é˜»å¡ äº‹ä»¶å‘ç”Ÿæ—¶ å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ï¼Œä¼šè§¦å‘ acceptäº‹ä»¶ å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥ï¼Œå®¢æˆ·ç«¯æ­£å¸¸ï¼Œæˆ–è€…å¼‚å¸¸å…³é—­æ—¶ï¼Œéƒ½ä¼šè§¦å‘ read äº‹ä»¶ï¼Œå¦å¤–å¦‚æœå‘é€çš„æ•°æ®å¤§äº buffer ç¼“å†²åŒºï¼Œä¼šè§¦å‘å¤šæ¬¡è¯»å–äº‹ä»¶ channel å¯å†™ï¼Œä¼šè§¦å‘ write äº‹ä»¶ åœ¨ Linux ä¸‹ nio bug å‘ç”Ÿæ—¶ è°ƒç”¨ selector.wakeup()ï¼Œå”¤é†’ è°ƒç”¨ selector.clone()ï¼Œå…³é—­ selector æ‰€åœ¨çº¿ç¨‹ interruptï¼ˆæ‰“æ–­ï¼Œé˜»æ–­ï¼Œæš‚å®šï¼‰ 3ã€å¤„ç† accept äº‹ä»¶ä¸»è¦ç”¨äºå»ºç«‹è¿æ¥ å®¢æˆ·ç«¯ä»£ç package com.kk.netty.nio.network.selector; import java.io.IOException; import java.net.Socket; public class Client { public static void main(String[] args) { try (Socket socket = new Socket (\"localhost\", 8080)) { System.out.println (socket); socket.getOutputStream ( ).write (\"hello!\".getBytes ( )); System.in.read ( ); } catch (IOException e) { e.printStackTrace ( ); } } } æœåŠ¡ç«¯ä»£ç package com.kk.netty.nio.network.selector; import lombok.extern.slf4j.Slf4j; import java.io.IOException; import java.net.InetSocketAddress; import java.nio.channels.SelectionKey; import java.nio.channels.Selector; import java.nio.channels.ServerSocketChannel; import java.util.Iterator; import java.util.Set; @Slf4j public class AcceptService { public static void main(String[] args) throws IOException { // 1ã€åˆ›å»º selector ç®¡ç†å¤šä¸ª channel Selector selector = Selector.open ( ); ServerSocketChannel channel = ServerSocketChannel.open ( ); channel.configureBlocking (false); // 2ã€å»ºç«‹ selector å’Œ channel çš„è”ç³»(æ³¨å†Œ) channel.register (selector, SelectionKey.OP_ACCEPT); // SelectionKey å½“äº‹ä»¶å‘ç”Ÿåï¼Œé€šè¿‡å®ƒå¾—åˆ°äº‹ä»¶ç±»å‹ å’Œ å“ªä¸ª channel å‘ç”Ÿäº†è¯¥äº‹ä»¶ SelectionKey ckey = channel.register (selector, 0, null); // key åªå…³æ³¨ accept äº‹ä»¶ // interestOps åªå…³æ³¨ ckey.interestOps (SelectionKey.OP_ACCEPT); log.debug (\"register key:{}\", ckey); channel.bind (new InetSocketAddress (8080)); while (true) { // 3ã€select æ–¹æ³•ï¼Œæ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹é˜»å¡ï¼›æœ‰äº‹ä»¶ï¼Œæ‰æ¢å¤è¿è¡Œ //select åœ¨äº‹ä»¶æœªå¤„ç†çš„æ—¶å€™ï¼Œå®ƒä¸ä¼šé˜»å¡ï¼›äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†æˆ–è€…å–æ¶ˆï¼Œä¸èƒ½ç½®ä¹‹ä¸ç† selector.select ( ); // 4ã€å¤„ç†äº‹ä»¶ï¼ŒselectedKey å†…éƒ¨åŒ…å«äº†æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶ Set&lt;SelectionKey&gt; keys = selector.selectedKeys ( ); // éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç† Iterator&lt;SelectionKey&gt; iter = keys.iterator ( ); while (iter.hasNext ( )) { SelectionKey key = iter.next ( ); key.cancel ( ); } } } } ğŸ’¡ äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆå–æ¶ˆï¼ˆcancelï¼‰ï¼Œä¸èƒ½ä»€ä¹ˆéƒ½ä¸åšï¼Œå¦åˆ™ä¸‹æ¬¡è¯¥äº‹ä»¶ä»ä¼šè§¦å‘ï¼Œè¿™æ˜¯å› ä¸º nioåº•å±‚ä½¿ç”¨çš„æ˜¯æ°´å¹³è§¦å‘ 4ã€å¤„ç† read äº‹ä»¶servicepackage com.kk.netty.nio.network.selector; import lombok.extern.slf4j.Slf4j; import java.io.IOException; import java.net.InetSocketAddress; import java.nio.ByteBuffer; import java.nio.channels.*; import java.util.Iterator; import java.util.Set; import static com.kk.netty.nio.ByteBufferUtil.debugRead; @Slf4j public class ReadService { // sscKey ã€ scKey ä¸€äººä¸€ä¸ªç®¡ç†å‘˜ public static void main(String[] args) throws IOException { // 1ã€åˆ›å»º selector ç®¡ç†å¤šä¸ª channel Selector selector = Selector.open ( ); ServerSocketChannel channel = ServerSocketChannel.open ( ); channel.configureBlocking (false); // 2ã€å»ºç«‹ selector å’Œ channel çš„è”ç³»(æ³¨å†Œ) channel.register (selector, SelectionKey.OP_ACCEPT); // SelectionKey å½“äº‹ä»¶å‘ç”Ÿåï¼Œé€šè¿‡å®ƒå¾—åˆ°äº‹ä»¶ç±»å‹ å’Œ å“ªä¸ª channel å‘ç”Ÿäº†è¯¥äº‹ä»¶ SelectionKey sscKey = channel.register (selector, 0, null); // key åªå…³æ³¨ accept äº‹ä»¶ // interestOps åªå…³æ³¨ sscKey.interestOps (SelectionKey.OP_ACCEPT); log.debug (\"register key:{}\", sscKey); channel.bind (new InetSocketAddress (8080)); while (true) { // 3ã€select æ–¹æ³•ï¼Œæ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹é˜»å¡ï¼›æœ‰äº‹ä»¶ï¼Œæ‰æ¢å¤è¿è¡Œ //select åœ¨äº‹ä»¶æœªå¤„ç†çš„æ—¶å€™ï¼Œå®ƒä¸ä¼šé˜»å¡ï¼›äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†æˆ–è€…å–æ¶ˆï¼Œä¸èƒ½ç½®ä¹‹ä¸ç† selector.select ( ); // 4ã€å¤„ç†äº‹ä»¶ï¼ŒselectedKey å†…éƒ¨åŒ…å«äº†æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶ Set&lt;SelectionKey&gt; keys = selector.selectedKeys ( ); // éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç† Iterator&lt;SelectionKey&gt; iter = keys.iterator ( ); while (iter.hasNext ( )) { SelectionKey key = iter.next ( ); log.debug (\"key:{}\", key); // 5ã€åŒºåˆ†äº‹ä»¶ç±»å‹ if (key.isAcceptable ( )) {// å¦‚æœæ˜¯ accept ServerSocketChannel channelTest1 = (ServerSocketChannel) key.channel ( ); SocketChannel sc = channelTest1.accept ( ); sc.configureBlocking (false); SelectionKey scKey = sc.register (selector, 0, null); scKey.interestOps (SelectionKey.OP_READ); } else if (key.isReadable ( )) {// å¦‚æœæ˜¯ read // æ‹¿åˆ°è§¦å‘çš„äº‹ä»¶ channel SocketChannel channlTest2 = (SocketChannel) key.channel ( ); ByteBuffer buffer = ByteBuffer.allocate (16); channlTest2.read (buffer); buffer.flip ( ); debugRead (buffer); } // key.cancel ( ); } } } } è¾“å‡ºç»“æœï¼š å› ä¸º select ç”¨å®Œ key æ²¡æœ‰ remove() 4.1ã€ä¸ºä»€ä¹ˆè¦remove å› ä¸º select åœ¨äº‹ä»¶å‘ç”Ÿåï¼Œå°±ä¼šå°†ç›¸å…³çš„ key æ”¾å…¥ selectedKeys é›†åˆï¼Œä½†ä¸ä¼šåœ¨å¤„ç†å®Œåä» selectedKeys é›†åˆä¸­ç§»é™¤ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–ç åˆ é™¤ã€‚ä¾‹å¦‚ ç¬¬ä¸€æ¬¡è§¦å‘äº† ssckey ä¸Šçš„ accept äº‹ä»¶ï¼Œæ²¡æœ‰ç§»é™¤ ssckey ç¬¬äºŒæ¬¡è§¦å‘äº† sckey ä¸Šçš„ read äº‹ä»¶ï¼Œä½†è¿™æ—¶ selectedKeys ä¸­è¿˜æœ‰ä¸Šæ¬¡çš„ ssckey ï¼Œåœ¨å¤„ç†æ—¶å› ä¸ºæ²¡æœ‰çœŸæ­£çš„ serverSocket è¿ä¸Šäº†ï¼Œå°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ 4.2ã€remove ä»£ç æ‹¿åˆ°åå°±åˆ æ‰ï¼Œæ–¹å¼é‡å¤äº‹ä»¶å¤„ç†ï¼ˆå†™åœ¨åé¢ä¹Ÿå¯ä»¥ï¼‰ 4.3ã€å¤„ç†å®¢æˆ·ç«¯æ–­å¼€ 4.4ã€ä¸å¤„ç†è¾¹ç•Œé—®é¢˜ä»¥ BIO ä¸ºæ¡ˆä¾‹ä»£ç service public class BoundaryService { public static void main(String[] args) throws Exception { ServerSocket ss = new ServerSocket (9000); while (true) { Socket socket = ss.accept ( ); InputStream in = socket.getInputStream ( ); // è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜ byte[] arr = new byte[4]; while (true) { int read = in.read (arr); // è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜ if (read == -1) { break; } System.out.println (new String (arr, 0, read)); } } } } client public class BoundDaryClient { public static void main(String[] args) { Socket socket = null; try { socket = new Socket (\"localhost\", 9000); OutputStream out = socket.getOutputStream ( ); out.write (\"hello\".getBytes ( )); out.write (\"world\".getBytes ( )); out.write (\"ä½ å¥½\".getBytes ( )); out.close ( ); } catch (IOException e) { e.printStackTrace ( ); } } } è¾“å‡º hell owor ldï¿½ ï¿½å¥½ 4.5ã€å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œï¼ˆå®¹é‡è¶…å‡ºï¼‰å®¹é‡è¶…å‡ºï¼Œå°±éœ€è¦è€ƒè™‘æ‰©å®¹é—®é¢˜ï¼Œè¿™è¾¹æ²¡å»è€ƒè™‘ç¼©å®¹ï¼Œnettry ä¼šæœ‰é€‚é…è¿™äº›é—®é¢˜ ä¸€ç§æ€è·¯æ˜¯å›ºå®šæ¶ˆæ¯é•¿åº¦ï¼Œæ•°æ®åŒ…å¤§å°ä¸€æ ·ï¼ŒæœåŠ¡å™¨æŒ‰é¢„å®šé•¿åº¦è¯»å–ï¼Œç¼ºç‚¹æ˜¯æµªè´¹å¸¦å®½ å¦ä¸€ç§æ€è·¯æ˜¯æŒ‰åˆ†éš”ç¬¦æ‹†åˆ†ï¼Œç¼ºç‚¹æ˜¯æ•ˆç‡ä½ TLV æ ¼å¼ï¼Œå³ Type ç±»å‹ã€Length é•¿åº¦ã€Value æ•°æ®ï¼Œç±»å‹å’Œé•¿åº¦å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥æ–¹ä¾¿è·å–æ¶ˆæ¯å¤§å°ï¼Œåˆ†é…åˆé€‚çš„ bufferï¼Œç¼ºç‚¹æ˜¯ buffer éœ€è¦æå‰åˆ†é…ï¼Œå¦‚æœå†…å®¹è¿‡å¤§ï¼Œåˆ™å½±å“ server ååé‡ Http 1.1 æ˜¯ TLV æ ¼å¼ Http 2.0 æ˜¯ LTV æ ¼å¼ **è¿™è¾¹ service ä¼šç”¨åˆ°é™„ä»¶çŸ¥è¯†ï¼Œä¼šæŠŠ bytebuffer ä½œä¸ºäº‹ä»¶æ³¨å†Œåˆ° SelectorKey ä¸Š ** æ—¢ ï¼Œ registerï¼ˆt1,t2,t3ï¼‰ç¬¬ä¸‰ä¸ªå‚æ•°ä¸Š service // sscKey ã€ scKey ä¸€äººä¸€ä¸ªç®¡ç†å‘˜ public static void main(String[] args) throws IOException { // 1ã€åˆ›å»º selector ç®¡ç†å¤šä¸ª channel Selector selector = Selector.open ( ); ServerSocketChannel ssc = ServerSocketChannel.open ( ); ssc.configureBlocking (false); // 2ã€å»ºç«‹ selector å’Œ channel çš„è”ç³»(æ³¨å†Œ) ssc.register (selector, SelectionKey.OP_ACCEPT); // SelectionKey å½“äº‹ä»¶å‘ç”Ÿåï¼Œé€šè¿‡å®ƒå¾—åˆ°äº‹ä»¶ç±»å‹ å’Œ å“ªä¸ª channel å‘ç”Ÿäº†è¯¥äº‹ä»¶ SelectionKey sscKey = ssc.register (selector, 0, null); // key åªå…³æ³¨ accept äº‹ä»¶ // interestOps åªå…³æ³¨ sscKey.interestOps (SelectionKey.OP_ACCEPT); log.debug (\"register key:{}\", sscKey); ssc.bind (new InetSocketAddress (8080)); while (true) { // 3ã€select æ–¹æ³•ï¼Œæ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹é˜»å¡ï¼›æœ‰äº‹ä»¶ï¼Œæ‰æ¢å¤è¿è¡Œ //select åœ¨äº‹ä»¶æœªå¤„ç†çš„æ—¶å€™ï¼Œå®ƒä¸ä¼šé˜»å¡ï¼›äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†æˆ–è€…å–æ¶ˆï¼Œä¸èƒ½ç½®ä¹‹ä¸ç† selector.select ( ); // 4ã€å¤„ç†äº‹ä»¶ï¼ŒselectedKey å†…éƒ¨åŒ…å«äº†æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶ Set&lt;SelectionKey&gt; keys = selector.selectedKeys ( ); // éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç† Iterator&lt;SelectionKey&gt; iter = keys.iterator ( ); while (iter.hasNext ( )) { SelectionKey key = iter.next ( ); iter.remove ( ); log.debug (\"key:{}\", key); // 5ã€åŒºåˆ†äº‹ä»¶ç±»å‹ if (key.isAcceptable ( )) {// å¦‚æœæ˜¯ accept ServerSocketChannel channel = (ServerSocketChannel) key.channel ( ); SocketChannel sc = channel.accept ( ); sc.configureBlocking (false); ByteBuffer buffer = ByteBuffer.allocate (16);// attachment // å°†ä¸€ä¸ª byteBuffer ä½œä¸ºé™„ä»¶å…³è”åˆ° selectionKey ä¸Š SelectionKey scKey = sc.register (selector, 0, buffer); scKey.interestOps (SelectionKey.OP_READ); } else if (key.isReadable ( )) {// å¦‚æœæ˜¯ read try { // æ‹¿åˆ°è§¦å‘çš„äº‹ä»¶ channel SocketChannel channel = (SocketChannel) key.channel ( ); // è·å– selectionKey ä¸Šå…³è”çš„äº‹ä»¶ //ByteBuffer buffer = ByteBuffer.allocate (16); ByteBuffer buffer = (ByteBuffer) key.attachment ( ); // å¦‚æœæ˜¯æ­£å¸¸æ–­å¼€ã€‚read çš„æ–¹æ³•è¿”å›å€¼æ˜¯ -1 int read = channel.read (buffer); if (read == -1) { key.cancel ( ); } else { // å‹ç¼©è¯»å–ä¸€æ¬¡ï¼Œç¡®ä¿æ•°æ®å®Œæ•´ split (buffer); // å¦‚æœæ¸¸æ ‡çš„èµ·å§‹ç›¸ç­‰ï¼Œè¯´æ˜å®¹é‡å·²æ»¡ï¼Œéœ€è¦æ‰©å®¹ if (buffer.position ( ) == buffer.limit ( )) { // æ‰©å®¹ä¸¤å€ ByteBuffer newBuffer = ByteBuffer.allocate (buffer.capacity ( ) * 2); buffer.flip ( ); newBuffer.put (buffer); key.attach (newBuffer); } } } catch (Exception e) { e.printStackTrace ( ); // å› ä¸ºå®¢æˆ·ç«¯æ–­å¼€äº†ï¼Œå› æ­¤éœ€è¦å°† key å–æ¶ˆï¼ˆä» selector å¾—keys é›†åˆä¸­çœŸæ­£åˆ é™¤ï¼‰ key.cancel ( ); } } } } } client public static void main(String[] args) throws IOException { SocketChannel sc = SocketChannel.open (); sc.connect (new InetSocketAddress (\"localhost\", 8080)); SocketAddress address = sc.getLocalAddress ( ); sc.write (Charset.defaultCharset ().encode (\"0123456789abcdef\")); sc.write (Charset.defaultCharset ().encode (\"012345Q\\n6789abcdef3333\\n\")); } 4.6ã€ByteBuffer å¤§å°åˆ†é… æ¯ä¸ª channel éƒ½éœ€è¦è®°å½•å¯èƒ½è¢«åˆ‡åˆ†çš„æ¶ˆæ¯ï¼Œå› ä¸º ByteBuffer ä¸èƒ½è¢«å¤šä¸ª channel å…±åŒä½¿ç”¨ï¼Œå› æ­¤éœ€è¦ä¸ºæ¯ä¸ª channel ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„ ByteBuffer ByteBuffer ä¸èƒ½å¤ªå¤§ï¼Œæ¯”å¦‚ä¸€ä¸ª ByteBuffer 1Mb çš„è¯ï¼Œè¦æ”¯æŒç™¾ä¸‡è¿æ¥å°±è¦ 1Tb å†…å­˜ï¼Œå› æ­¤éœ€è¦è®¾è®¡å¤§å°å¯å˜çš„ ByteBuffer ä¸€ç§æ€è·¯æ˜¯é¦–å…ˆåˆ†é…ä¸€ä¸ªè¾ƒå°çš„ bufferï¼Œä¾‹å¦‚ 4kï¼Œå¦‚æœå‘ç°æ•°æ®ä¸å¤Ÿï¼Œå†åˆ†é… 8k çš„ bufferï¼Œå°† 4k buffer å†…å®¹æ‹·è´è‡³ 8k bufferï¼Œä¼˜ç‚¹æ˜¯æ¶ˆæ¯è¿ç»­å®¹æ˜“å¤„ç†ï¼Œç¼ºç‚¹æ˜¯æ•°æ®æ‹·è´è€—è´¹æ€§èƒ½ï¼Œå‚è€ƒå®ç° http://tutorials.jenkov.com/java-performance/resizable-array.html å¦ä¸€ç§æ€è·¯æ˜¯ç”¨å¤šä¸ªæ•°ç»„ç»„æˆ bufferï¼Œä¸€ä¸ªæ•°ç»„ä¸å¤Ÿï¼ŒæŠŠå¤šå‡ºæ¥çš„å†…å®¹å†™å…¥æ–°çš„æ•°ç»„ï¼Œä¸å‰é¢çš„åŒºåˆ«æ˜¯æ¶ˆæ¯å­˜å‚¨ä¸è¿ç»­è§£æå¤æ‚ï¼Œä¼˜ç‚¹æ˜¯é¿å…äº†æ‹·è´å¼•èµ·çš„æ€§èƒ½æŸè€— 5ã€å¤„ç† write äº‹ä»¶ä¸€æ¬¡æ€§æ— æ³•å†™å®Œçš„ä¾‹å­ éé˜»å¡æ¨¡å¼ä¸‹ï¼Œæ— æ³•ä¿è¯æŠŠ buffer ä¸­æ‰€æœ‰æ•°æ®éƒ½å†™å…¥ channelï¼Œå› æ­¤éœ€è¦è¿½è¸ª write æ–¹æ³•çš„è¿”å›å€¼ï¼ˆä»£è¡¨å®é™…å†™å…¥å­—èŠ‚æ•°ï¼‰ ç”¨ selector ç›‘å¬æ‰€æœ‰ channel çš„å¯å†™äº‹ä»¶ï¼Œæ¯ä¸ª channel éƒ½éœ€è¦ä¸€ä¸ª key æ¥è·Ÿè¸ª bufferï¼Œä½†è¿™æ ·åˆä¼šå¯¼è‡´å ç”¨å†…å­˜è¿‡å¤šï¼Œå°±æœ‰ä¸¤é˜¶æ®µç­–ç•¥ å½“æ¶ˆæ¯å¤„ç†å™¨ç¬¬ä¸€æ¬¡å†™å…¥æ¶ˆæ¯æ—¶ï¼Œæ‰å°† channel æ³¨å†Œåˆ° selector ä¸Š selector æ£€æŸ¥ channel ä¸Šçš„å¯å†™äº‹ä»¶ï¼Œå¦‚æœæ‰€æœ‰çš„æ•°æ®å†™å®Œäº†ï¼Œå°±å–æ¶ˆ channel çš„æ³¨å†Œ å¦‚æœä¸å–æ¶ˆï¼Œä¼šæ¯æ¬¡å¯å†™å‡ä¼šè§¦å‘ write äº‹ä»¶ service public class WriteServer { public static void main(String[] args) throws Exception { ServerSocketChannel ssc = ServerSocketChannel.open ( ); ssc.configureBlocking (false); ssc.bind (new InetSocketAddress (8080)); Selector selector = Selector.open ( ); ssc.register (selector, SelectionKey.OP_ACCEPT); while (true) { selector.select ( ); Iterator&lt;SelectionKey&gt; iter = selector.selectedKeys ( ).iterator ( ); while (iter.hasNext ( )) { SelectionKey key = iter.next ( ); iter.remove ( ); if (key.isAcceptable ( )) { SocketChannel sc = ssc.accept ( ); sc.configureBlocking (false); SelectionKey scKey = sc.register (selector, SelectionKey.OP_READ); // 1ã€å‘å®¢æˆ·ç«¯å‘é€å¤§é‡æ•°æ® StringBuffer sb = new StringBuffer ( ); for (int i = 0; i &lt; 3000000; i++) { sb.append (\"a\"); } ByteBuffer buffer = Charset.defaultCharset ( ).encode (sb.toString ( )); // 2ã€è¿”å›å€¼ä»£è¡¨å®é™…å†™å…¥çš„å­—èŠ‚æ•° int write = sc.write (buffer); System.out.println (\"å®é™…å†™å…¥å­—èŠ‚:\" + write); // 3ã€åˆ¤æ–­æ˜¯å¦æœ‰å‰©ä½™å†…å®¹ if (buffer.hasRemaining ( )) { // 4ã€å…³æ³¨å¯å†™äº‹ä»¶(1+4) // read 1 write 4 scKey.interestOps (scKey.interestOps ( ) + SelectionKey.OP_WRITE); // 5ã€æŠŠæœªå†™å®Œçš„æ•°æ® æŒ‚åˆ° scKeyä¸Š scKey.attach (buffer); } } else if (key.isWritable ( )) { ByteBuffer buffer = (ByteBuffer) key.attachment ( ); SocketChannel sc = (SocketChannel) key.channel ( ); int write = sc.write (buffer); System.out.println (\"å®é™…å†™å…¥å­—èŠ‚:\" + write); if (!buffer.hasRemaining ( )) {// å†™å®Œäº†(åˆ‡æ¢ä¸ºè¯»æ¨¡å¼) key.interestOps (key.interestOps ( ) - SelectionKey.OP_WRITE); // éœ€è¦æ¸…é™¤ buffer key.attach (null); } } } } } } client public class WriteClient { public static void main(String[] args) throws IOException { SocketChannel sc = SocketChannel.open ( ); sc.connect (new InetSocketAddress (8080)); // æ¥æ”¶æ•°æ® int count = 0; while (true) { ByteBuffer buffer = ByteBuffer.allocate (1 &lt;&lt; 20); count += sc.read (buffer); System.out.println (count ); buffer.clear (); } } } ğŸ’¡ write ä¸ºä½•è¦å–æ¶ˆåªè¦å‘ channel å‘é€æ•°æ®æ—¶ï¼Œsocket ç¼“å†²å¯å†™ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šé¢‘ç¹è§¦å‘; å› æ­¤åº”å½“åªåœ¨ socket ç¼“å†²åŒºå†™ä¸ä¸‹æ—¶å†å…³æ³¨å¯å†™äº‹ä»¶ï¼Œæ•°æ®å†™å®Œä¹‹åå†å–æ¶ˆå…³æ³¨ 6ã€å¤šçº¿ç¨‹ä¼˜åŒ–1ã€ç¼–ç æ€è·¯ ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œç”¨é˜Ÿåˆ—åœ¨ä¸­é—´è¿›è¡Œä¼ è¾“ï¼ˆè¿™é‡Œç”¨å®‰å…¨é˜Ÿåˆ—ï¼‰ï¼Œnettyåº•å±‚ä¹Ÿæ˜¯ æ ¹æ®å¤„ç†å™¨æ•°é‡ï¼Œè½®è®­ï¼ˆè¿™è¾¹1.8çš„api jvm æœ‰é—®é¢˜ï¼Œåœ¨jdk 10çš„æ—¶å€™æ‰ä¿®å¤ï¼‰ å•çº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œä¸“é—¨å¤„ç† accept äº‹ä»¶ åˆ›å»º cpu æ ¸å¿ƒæ•°çš„çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œè½®æµå¤„ç† read äº‹ä»¶ 2ã€å¦‚ä½•æ‹¿åˆ° cpu ä¸ªæ•° Runtime.getRuntime().availableProcessors() å¦‚æœå·¥ä½œåœ¨ docker å®¹å™¨ä¸‹ï¼Œå› ä¸ºå®¹å™¨ä¸æ˜¯ç‰©ç†éš”ç¦»çš„ï¼Œä¼šæ‹¿åˆ°ç‰©ç† cpu ä¸ªæ•°ï¼Œè€Œä¸æ˜¯å®¹å™¨ç”³è¯·æ—¶çš„ä¸ªæ•° è¿™ä¸ªé—®é¢˜ç›´åˆ° jdk 10 æ‰ä¿®å¤ï¼Œä½¿ç”¨ jvm å‚æ•° UseContainerSupport é…ç½®ï¼Œ é»˜è®¤å¼€å¯ @Slf4j public class MultiThreadServer { public static void main(String[] args) throws IOException{ Thread.currentThread ().setName (\"boss\"); ServerSocketChannel ssc = ServerSocketChannel.open ( ); ssc.configureBlocking (false); Selector boos = Selector.open ( ); SelectionKey boosKey = ssc.register (boos, 0, null); boosKey.interestOps (SelectionKey.OP_ACCEPT); ssc.bind (new InetSocketAddress (8080)); // 1ã€åˆ›å»ºå›ºå®šæ•°é‡çš„ worker å¹¶åˆå§‹åŒ– // Runtime.getRuntime ().availableProcessors () å¤„ç†å™¨æ•°é‡ Worker[] workers = new Worker[Runtime.getRuntime ().availableProcessors ()]; for (int i = 0; i &lt; workers.length; i++) { workers[i] = new Worker (\"WORKER-\"+i); } AtomicInteger index = new AtomicInteger (); while (true) { boos.select (); Iterator&lt;SelectionKey&gt; iter = boos.selectedKeys ( ).iterator ( ); while (iter.hasNext ( )) { SelectionKey key = iter.next ( ); iter.remove (); if (key.isAcceptable ( )) { SocketChannel sc = ssc.accept ( ); sc.configureBlocking (false); log.debug(\"connected...{}\", sc.getRemoteAddress()); // 2. å…³è” selector log.debug(\"before register...{}\", sc.getRemoteAddress()); // è½®è®­ workers[index.getAndIncrement ()%workers.length].register (sc); log.debug(\"after register...{}\", sc.getRemoteAddress()); } } } } static class Worker implements Runnable { private Thread thread; private Selector selector; private String name; private volatile boolean start = false;// è¿˜æœªåˆå§‹åŒ– private ConcurrentLinkedQueue&lt;Runnable&gt; queue = new ConcurrentLinkedQueue&lt;&gt; ( ); private Worker(String name) { this.name = name; } // åˆå§‹åŒ–çº¿ç¨‹ å’Œ selector public void register(SocketChannel sc) throws IOException { if (!start) { selector = Selector.open ( ); thread = new Thread (this, name); thread.start ( ); start = true; } // å”¤é†’ select æ–¹æ³• boos selector.wakeup ( ); // boos sc.register (selector, SelectionKey.OP_READ, null); } @Override public void run() { while (true) { try { selector.select ( );// worker-0 é˜»å¡ Iterator&lt;SelectionKey&gt; iter = selector.selectedKeys ( ).iterator ( ); while (iter.hasNext ( )) { SelectionKey key = iter.next ( ); iter.remove ( ); if (key.isReadable ( )) { ByteBuffer buffer = ByteBuffer.allocate (16); SocketChannel channel = (SocketChannel) key.channel ( ); log.debug (\"read...{}\", channel.getRemoteAddress ( )); channel.read (buffer); buffer.flip ( ); debugAll (buffer); } } } catch (IOException e) { e.printStackTrace ( ); } } } } } 7ã€UDP UDP æ˜¯æ— è¿æ¥çš„ï¼Œclient å‘é€æ•°æ®ä¸ä¼šç®¡ server æ˜¯å¦å¼€å¯ server è¿™è¾¹çš„ receive æ–¹æ³•ä¼šå°†æ¥æ”¶åˆ°çš„æ•°æ®å­˜å…¥ byte bufferï¼Œä½†å¦‚æœæ•°æ®æŠ¥æ–‡è¶…è¿‡ buffer å¤§å°ï¼Œå¤šå‡ºæ¥çš„æ•°æ®ä¼šè¢«é»˜é»˜æŠ›å¼ƒ äº”ã€Nio vs Bio or Aio1ã€stream vs channel stream ä¸ä¼šè‡ªåŠ¨ç¼“å†²æ•°æ®ï¼Œchannel ä¼šåˆ©ç”¨ç³»ç»Ÿæä¾›çš„å‘é€ç¼“å†²åŒºã€æ¥æ”¶ç¼“å†²åŒºï¼ˆæ›´ä¸ºåº•å±‚ï¼‰ stream ä»…æ”¯æŒé˜»å¡ APIï¼Œchannel åŒæ—¶æ”¯æŒé˜»å¡ã€éé˜»å¡ APIï¼Œç½‘ç»œ channel å¯é…åˆ selector å®ç°å¤šè·¯å¤ç”¨ äºŒè€…å‡ä¸ºå…¨åŒå·¥ï¼Œå³è¯»å†™å¯ä»¥åŒæ—¶è¿›è¡Œ 2ã€IOæ¨¡å‹3ã€é›¶æ‹·è´3-1ã€ä¼ ç»ŸIOé—®é¢˜ä¼ ç»Ÿçš„ IO å°†ä¸€ä¸ªæ–‡ä»¶é€šè¿‡ socket å†™å‡º File f = new File(\"helloword/data.txt\"); RandomAccessFile file = new RandomAccessFile(file, \"r\"); byte[] buf = new byte[(int)f.length()]; file.read(buf); Socket socket = ...; socket.getOutputStream().write(buf); å†…éƒ¨å·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š java æœ¬èº«å¹¶ä¸å…·å¤‡ IO è¯»å†™èƒ½åŠ›ï¼Œå› æ­¤ read æ–¹æ³•è°ƒç”¨åï¼Œè¦ä» java ç¨‹åºçš„ç”¨æˆ·æ€åˆ‡æ¢è‡³å†…æ ¸æ€ï¼Œå»è°ƒç”¨æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰çš„è¯»èƒ½åŠ›ï¼Œå°†æ•°æ®è¯»å…¥å†…æ ¸ç¼“å†²åŒºã€‚è¿™æœŸé—´ç”¨æˆ·çº¿ç¨‹é˜»å¡ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨ DMAï¼ˆDirect Memory Accessï¼‰æ¥å®ç°æ–‡ä»¶è¯»ï¼Œå…¶é—´ä¹Ÿä¸ä¼šä½¿ç”¨ cpu DMA ä¹Ÿå¯ä»¥ç†è§£ä¸ºç¡¬ä»¶å•å…ƒï¼Œç”¨æ¥è§£æ”¾ cpu å®Œæˆæ–‡ä»¶ IO ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ï¼Œå°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºè¯»å…¥ç”¨æˆ·ç¼“å†²åŒºï¼ˆå³ byte[] bufï¼‰ï¼Œè¿™æœŸé—´ cpu ä¼šå‚ä¸æ‹·è´ï¼Œæ— æ³•åˆ©ç”¨ DMA è°ƒç”¨ write æ–¹æ³•ï¼Œè¿™æ—¶å°†æ•°æ®ä»ç”¨æˆ·ç¼“å†²åŒºï¼ˆbyte[] bufï¼‰å†™å…¥ socket ç¼“å†²åŒºï¼Œcpu ä¼šå‚ä¸æ‹·è´ æ¥ä¸‹æ¥è¦å‘ç½‘å¡å†™æ•°æ®ï¼Œè¿™é¡¹èƒ½åŠ› java åˆä¸å…·å¤‡ï¼Œå› æ­¤åˆå¾—ä»ç”¨æˆ·æ€åˆ‡æ¢è‡³å†…æ ¸æ€ï¼Œè°ƒç”¨æ“ä½œç³»ç»Ÿçš„å†™èƒ½åŠ›ï¼Œä½¿ç”¨ DMA å°† socket ç¼“å†²åŒºçš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu å¯ä»¥çœ‹åˆ°ä¸­é—´ç¯èŠ‚è¾ƒå¤šï¼Œjava çš„ IO å®é™…ä¸æ˜¯ç‰©ç†è®¾å¤‡çº§åˆ«çš„è¯»å†™ï¼Œè€Œæ˜¯ç¼“å­˜çš„å¤åˆ¶ï¼Œåº•å±‚çš„çœŸæ­£è¯»å†™æ˜¯æ“ä½œç³»ç»Ÿæ¥å®Œæˆçš„ ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢å‘ç”Ÿäº† 3 æ¬¡ï¼Œè¿™ä¸ªæ“ä½œæ¯”è¾ƒé‡é‡çº§ æ•°æ®æ‹·è´äº†å…± 4 æ¬¡ 3-2ã€NIOä¼˜åŒ–é€šè¿‡ DirectByteBuf ByteBuffer.allocate(10) HeapByteBuffer ä½¿ç”¨çš„è¿˜æ˜¯ java å†…å­˜ ByteBuffer.allocateDirect(10) DirectByteBuffer ä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿå†…å­˜ å¤§éƒ¨åˆ†æ­¥éª¤ä¸ä¼˜åŒ–å‰ç›¸åŒï¼Œä¸å†èµ˜è¿°ã€‚å”¯æœ‰ä¸€ç‚¹ï¼šjava å¯ä»¥ä½¿ç”¨ DirectByteBuf å°†å †å¤–å†…å­˜æ˜ å°„åˆ° jvm å†…å­˜ä¸­æ¥ç›´æ¥è®¿é—®ä½¿ç”¨ è¿™å—å†…å­˜ä¸å— jvm åƒåœ¾å›æ”¶çš„å½±å“ï¼Œå› æ­¤å†…å­˜åœ°å€å›ºå®šï¼Œæœ‰åŠ©äº IO è¯»å†™ java ä¸­çš„ DirectByteBuf å¯¹è±¡ä»…ç»´æŠ¤äº†æ­¤å†…å­˜çš„è™šå¼•ç”¨ï¼Œå†…å­˜å›æ”¶åˆ†æˆä¸¤æ­¥ DirectByteBuf å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œå°†è™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ— é€šè¿‡ä¸“é—¨çº¿ç¨‹è®¿é—®å¼•ç”¨é˜Ÿåˆ—ï¼Œæ ¹æ®è™šå¼•ç”¨é‡Šæ”¾å †å¤–å†…å­˜ å‡å°‘äº†ä¸€æ¬¡æ•°æ®æ‹·è´ï¼Œç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢æ¬¡æ•°æ²¡æœ‰å‡å°‘ è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆåº•å±‚é‡‡ç”¨äº† linux 2.1 åæä¾›çš„ sendFile æ–¹æ³•ï¼‰ï¼Œjava ä¸­å¯¹åº”ç€ä¸¤ä¸ª channel è°ƒç”¨ transferTo/transferFrom æ–¹æ³•æ‹·è´æ•°æ® java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„ç”¨æˆ·æ€åˆ‡æ¢è‡³å†…æ ¸æ€ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥å†…æ ¸ç¼“å†²åŒºï¼Œä¸ä¼šä½¿ç”¨ cpu æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºä¼ è¾“åˆ° socket ç¼“å†²åŒºï¼Œcpu ä¼šå‚ä¸æ‹·è´ æœ€åä½¿ç”¨ DMA å°† socket ç¼“å†²åŒºçš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu å¯ä»¥çœ‹åˆ° åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢ æ•°æ®æ‹·è´äº† 3 æ¬¡ è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆlinux 2.4ï¼‰ java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„ç”¨æˆ·æ€åˆ‡æ¢è‡³å†…æ ¸æ€ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥å†…æ ¸ç¼“å†²åŒºï¼Œä¸ä¼šä½¿ç”¨ cpu åªä¼šå°†ä¸€äº› offset å’Œ length ä¿¡æ¯æ‹·å…¥ socket ç¼“å†²åŒºï¼Œå‡ ä¹æ— æ¶ˆè€— ä½¿ç”¨ DMA å°† å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu æ•´ä¸ªè¿‡ç¨‹ä»…åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ•°æ®æ‹·è´äº† 2 æ¬¡ã€‚æ‰€è°“çš„ã€é›¶æ‹·è´ã€‘ï¼Œå¹¶ä¸æ˜¯çœŸæ­£æ— æ‹·è´ï¼Œè€Œæ˜¯åœ¨ä¸ä¼šæ‹·è´é‡å¤æ•°æ®åˆ° jvm å†…å­˜ä¸­ï¼Œé›¶æ‹·è´çš„ä¼˜ç‚¹æœ‰ æ›´å°‘çš„ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢ ä¸åˆ©ç”¨ cpu è®¡ç®—ï¼Œå‡å°‘ cpu ç¼“å­˜ä¼ªå…±äº« é›¶æ‹·è´é€‚åˆå°æ–‡ä»¶ä¼ è¾“ 4ã€AIOAIO ç”¨æ¥è§£å†³æ•°æ®å¤åˆ¶é˜¶æ®µçš„é˜»å¡é—®é¢˜ åŒæ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹éœ€è¦ç­‰å¾…ç»“æœï¼Œè¿˜æ˜¯ç›¸å½“äºé—²ç½® å¼‚æ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¸å¿…ç­‰å¾…ç»“æœï¼Œè€Œæ˜¯å°†æ¥ç”±æ“ä½œç³»ç»Ÿæ¥é€šè¿‡å›è°ƒæ–¹å¼ç”±å¦å¤–çš„çº¿ç¨‹æ¥è·å¾—ç»“æœ å¼‚æ­¥æ¨¡å‹éœ€è¦åº•å±‚æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰æä¾›æ”¯æŒ Windows ç³»ç»Ÿé€šè¿‡ IOCP å®ç°äº†çœŸæ­£çš„å¼‚æ­¥ IO Linux ç³»ç»Ÿå¼‚æ­¥ IO åœ¨ 2.6 ç‰ˆæœ¬å¼•å…¥ï¼Œä½†å…¶åº•å±‚å®ç°è¿˜æ˜¯ç”¨å¤šè·¯å¤ç”¨æ¨¡æ‹Ÿäº†å¼‚æ­¥ IOï¼Œæ€§èƒ½æ²¡æœ‰ä¼˜åŠ¿ 5ã€â…¡ã€Nettyä¸€ã€å…¥é—¨1ã€æ¦‚è¿°1ã€Nerryæ˜¯ä»€ä¹ˆNetty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ 2ã€ä¼˜åŠ¿ Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š éœ€è¦è‡ªå·±æ„å»ºåè®® è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ… epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100% å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal =&gt; ThreadLocalï¼ŒByteBuff =&gt; ByteBuffer Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶ Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€ ä¹…ç»è€ƒéªŒï¼Œ18å¹´ï¼ŒNetty ç‰ˆæœ¬ 2.x 2004 3.x 2008 4.x 2013 5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰ 3ã€åœ°ä½Netty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½ ä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼ Cassandra - nosql æ•°æ®åº“ Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶ RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ— ElasticSearch - æœç´¢å¼•æ“ gRPC - rpc æ¡†æ¶ Dubbo - rpc æ¡†æ¶ Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯ Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶ 2ã€Hello World1ã€ç›®æ ‡å¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å› åŠ å…¥ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;io.netty&lt;/groupId&gt; &lt;artifactId&gt;netty-all&lt;/artifactId&gt; &lt;version&gt;4.1.39.Final&lt;/version&gt; &lt;/dependency&gt; 2ã€æœåŠ¡ç«¯public class Service { public static void main(String[] args) throws Exception { new ServerBootstrap ( ) .group (new NioEventLoopGroup ( )) // 1 .channel (NioServerSocketChannel.class) // 2 .childHandler (new ChannelInitializer&lt;NioSocketChannel&gt; ( ) { // 3 protected void initChannel(NioSocketChannel ch) { ch.pipeline ( ).addLast (new StringDecoder ( )); // 5 ch.pipeline ( ).addLast (new SimpleChannelInboundHandler&lt;String&gt; ( ) { // 6 @Override protected void channelRead0(ChannelHandlerContext ctx, String msg) { System.out.println (msg); } }); } }).bind (8080); // 4 } } 1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º çº¿ç¨‹æ±  + Selector 2 å¤„ï¼Œé€‰æ‹©æœåŠ¡ Scoket å®ç°ç±»ï¼Œå…¶ä¸­ NioServerSocketChannel è¡¨ç¤ºåŸºäº NIO çš„æœåŠ¡å™¨ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰ 3 å¤„ï¼Œä¸ºå•¥æ–¹æ³•å« childHandlerï¼Œæ˜¯æ¥ä¸‹æ¥æ·»åŠ çš„å¤„ç†å™¨éƒ½æ˜¯ç»™ SocketChannel ç”¨çš„ï¼Œè€Œä¸æ˜¯ç»™ ServerSocketChannelã€‚ChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨ 4 å¤„ï¼ŒServerSocketChannel ç»‘å®šçš„ç›‘å¬ç«¯å£ 5 å¤„ï¼ŒSocketChannel çš„å¤„ç†å™¨ï¼Œè§£ç  ByteBuf =&gt; String 6 å¤„ï¼ŒSocketChannel çš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå¤„ç†å™¨çš„å¤„ç†ç»“æœ 3ã€å®¢æˆ·ç«¯public class Client { public static void main(String[] args) throws InterruptedException { new Bootstrap ( ) .group (new NioEventLoopGroup ( )) // 1 .channel (NioSocketChannel.class) // 2 .handler (new ChannelInitializer&lt;Channel&gt; ( ) { // 3 @Override protected void initChannel(Channel ch) { ch.pipeline ( ).addLast (new StringEncoder ( )); // 8 } }) .connect (\"127.0.0.1\", 8080) // 4 .sync ( ) // 5 .channel ( ) // 6 .writeAndFlush (new Date ( ) + \": hello world!\"); // 7 } } 1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼ŒåŒ Server 2 å¤„ï¼Œé€‰æ‹©å®¢æˆ· Socket å®ç°ç±»ï¼ŒNioSocketChannel è¡¨ç¤ºåŸºäº NIO çš„å®¢æˆ·ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰ 3 å¤„ï¼Œæ·»åŠ  SocketChannel çš„å¤„ç†å™¨ï¼ŒChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨ 4 å¤„ï¼ŒæŒ‡å®šè¦è¿æ¥çš„æœåŠ¡å™¨å’Œç«¯å£ 5 å¤„ï¼ŒNetty ä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚ connectï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ sync æ–¹æ³•ç­‰å¾… connect å»ºç«‹è¿æ¥å®Œæ¯• 6 å¤„ï¼Œè·å– channel å¯¹è±¡ï¼Œå®ƒå³ä¸ºé€šé“æŠ½è±¡ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œ 7 å¤„ï¼Œå†™å…¥æ¶ˆæ¯å¹¶æ¸…ç©ºç¼“å†²åŒº 8 å¤„ï¼Œæ¶ˆæ¯ä¼šç»è¿‡é€šé“ handler å¤„ç†ï¼Œè¿™é‡Œæ˜¯å°† String =&gt; ByteBuf å‘å‡º æ•°æ®ç»è¿‡ç½‘ç»œä¼ è¾“ï¼Œåˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯ 5 å’Œ 6 å¤„çš„ handler å…ˆåè¢«è§¦å‘ï¼Œèµ°å®Œä¸€ä¸ªæµç¨‹ 4ã€æ¢³ç†æµç¨‹ 5ã€è¯¦ç»†è§£è¯» æŠŠ channel ç†è§£ä¸ºæ•°æ®çš„é€šé“ æŠŠ msg ç†è§£ä¸ºæµåŠ¨çš„æ•°æ®ï¼Œæœ€å¼€å§‹è¾“å…¥æ˜¯ ByteBufï¼Œä½†ç»è¿‡ pipeline çš„åŠ å·¥ï¼Œä¼šå˜æˆå…¶å®ƒç±»å‹å¯¹è±¡ï¼Œæœ€åè¾“å‡ºåˆå˜æˆ ByteBuf æŠŠ handler ç†è§£ä¸ºæ•°æ®çš„å¤„ç†å·¥åº å·¥åºæœ‰å¤šé“ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯ pipelineï¼Œpipeline è´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼ˆè¯»ã€è¯»å–å®Œæˆâ€¦ï¼‰ä¼ æ’­ç»™æ¯ä¸ª handlerï¼Œ handler å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼ˆé‡å†™äº†ç›¸åº”äº‹ä»¶å¤„ç†æ–¹æ³•ï¼‰ handler åˆ† Inbound å’Œ Outbound ä¸¤ç±» æŠŠ eventLoop ç†è§£ä¸ºå¤„ç†æ•°æ®çš„å·¥äºº å·¥äººå¯ä»¥ç®¡ç†å¤šä¸ª channel çš„ io æ“ä½œï¼Œå¹¶ä¸”ä¸€æ—¦å·¥äººè´Ÿè´£äº†æŸä¸ª channelï¼Œå°±è¦è´Ÿè´£åˆ°åº•ï¼ˆç»‘å®šï¼‰ å·¥äººæ—¢å¯ä»¥æ‰§è¡Œ io æ“ä½œï¼Œä¹Ÿå¯ä»¥è¿›è¡Œä»»åŠ¡å¤„ç†ï¼Œæ¯ä½å·¥äººæœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œå¯ä»¥å †æ”¾å¤šä¸ª channel çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œä»»åŠ¡åˆ†ä¸ºæ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡ å·¥äººæŒ‰ç…§ pipeline é¡ºåºï¼Œä¾æ¬¡æŒ‰ç…§ handler çš„è§„åˆ’ï¼ˆä»£ç ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥ä¸ºæ¯é“å·¥åºæŒ‡å®šä¸åŒçš„å·¥äºº 3ã€ç»„ä»¶1ã€EventLoopäº‹ä»¶å¾ªç¯å¯¹è±¡ EventLoop æœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼ˆåŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ª Selectorï¼‰ï¼Œé‡Œé¢æœ‰ run æ–¹æ³•å¤„ç† Channel ä¸Šæºæºä¸æ–­çš„ io äº‹ä»¶ã€‚ å®ƒçš„ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚ ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª j.u.c.ScheduledExecutorService å› æ­¤åŒ…å«äº†çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ–¹æ³• å¦ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª netty è‡ªå·±çš„ OrderedEventExecutorï¼Œ æä¾›äº† boolean inEventLoop(Thread thread) æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦å±äºæ­¤ EventLoop æä¾›äº† parent æ–¹æ³•æ¥çœ‹çœ‹è‡ªå·±å±äºå“ªä¸ª EventLoopGroup äº‹ä»¶å¾ªç¯ç»„ EventLoopGroup æ˜¯ä¸€ç»„ EventLoopï¼ŒChannel ä¸€èˆ¬ä¼šè°ƒç”¨ EventLoopGroup çš„ register æ–¹æ³•æ¥ç»‘å®šå…¶ä¸­ä¸€ä¸ª EventLoopï¼Œåç»­è¿™ä¸ª Channel ä¸Šçš„ io äº‹ä»¶éƒ½ç”±æ­¤ EventLoop æ¥å¤„ç†ï¼ˆä¿è¯äº† io äº‹ä»¶å¤„ç†æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼‰ ç»§æ‰¿è‡ª netty è‡ªå·±çš„ EventExecutorGroup å®ç°äº† Iterable æ¥å£æä¾›éå† EventLoop çš„èƒ½åŠ› å¦æœ‰ next æ–¹æ³•è·å–é›†åˆä¸­ä¸‹ä¸€ä¸ª EventLoop ä»¥ä¸€ä¸ªç®€å•çš„å®ç°ä¸ºä¾‹ï¼š // å†…éƒ¨åˆ›å»ºäº†ä¸¤ä¸ª EventLoop, æ¯ä¸ª EventLoop ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹ DefaultEventLoopGroup group = new DefaultEventLoopGroup(2); System.out.println(group.next()); System.out.println(group.next()); System.out.println(group.next()); è¾“å‡º io.netty.channel.DefaultEventLoop@60f82f98 io.netty.channel.DefaultEventLoop@35f983a6 io.netty.channel.DefaultEventLoop@60f82f98 ä¹Ÿå¯ä»¥ä½¿ç”¨ for å¾ªç¯ DefaultEventLoopGroup group = new DefaultEventLoopGroup(2); for (EventExecutor eventLoop : group) { System.out.println(eventLoop); } è¾“å‡º io.netty.channel.DefaultEventLoop@60f82f98 io.netty.channel.DefaultEventLoop@35f983a6 io.netty.channel.DefaultEventLoop@60f82f98 io.netty.channel.DefaultEventLoop@35f983a6 ğŸ’¡ ä¼˜é›…å…³é—­ä¼˜é›…å…³é—­ shutdownGracefully æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆåˆ‡æ¢ EventLoopGroup åˆ°å…³é—­çŠ¶æ€ä»è€Œæ‹’ç»æ–°çš„ä»»åŠ¡çš„åŠ å…¥ï¼Œç„¶ååœ¨ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæˆåï¼Œåœæ­¢çº¿ç¨‹çš„è¿è¡Œã€‚ä»è€Œç¡®ä¿æ•´ä½“åº”ç”¨æ˜¯åœ¨æ­£å¸¸æœ‰åºçš„çŠ¶æ€ä¸‹é€€å‡ºçš„ 2ã€NioEventLoop å¤„ç†æ™®é€šä»»åŠ¡NioEventLoop é™¤äº†å¯ä»¥å¤„ç† io äº‹ä»¶ï¼ŒåŒæ ·å¯ä»¥å‘å®ƒæäº¤æ™®é€šä»»åŠ¡ NioEventLoopGroup nioWorkers = new NioEventLoopGroup(2); log.debug(\"server start...\"); Thread.sleep(2000); nioWorkers.execute(()-&gt;{ log.debug(\"normal task...\"); }); è¾“å‡º 22:30:36 [DEBUG] [main] c.i.o.EventLoopTest2 - server start... 22:30:38 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - normal task... å¯ä»¥ç”¨æ¥æ‰§è¡Œè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡ 3ã€NioEventLoop å¤„ç†å®šæ—¶ä»»åŠ¡NioEventLoopGroup nioWorkers = new NioEventLoopGroup(2); log.debug(\"server start...\"); Thread.sleep(2000); nioWorkers.scheduleAtFixedRate(() -&gt; { log.debug(\"running...\"); }, 0, 1, TimeUnit.SECONDS); è¾“å‡º 22:35:15 [DEBUG] [main] c.i.o.EventLoopTest2 - server start... 22:35:17 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running... 22:35:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running... 22:35:19 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running... 22:35:20 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running... ... å¯ä»¥ç”¨æ¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡ 2ã€Channelchannel çš„ä¸»è¦ä½œç”¨ close() å¯ä»¥ç”¨æ¥å…³é—­ channel closeFuture() ç”¨æ¥å¤„ç† channel çš„å…³é—­ sync æ–¹æ³•ä½œç”¨æ˜¯åŒæ­¥ç­‰å¾… channel å…³é—­ è€Œ addListener æ–¹æ³•æ˜¯å¼‚æ­¥ç­‰å¾… channel å…³é—­ pipeline() æ–¹æ³•æ·»åŠ å¤„ç†å™¨ write() æ–¹æ³•å°†æ•°æ®å†™å…¥ writeAndFlush() æ–¹æ³•å°†æ•°æ®å†™å…¥å¹¶åˆ·å‡º 2.1ã€ChannelFutureè¿™æ—¶åˆšæ‰çš„å®¢æˆ·ç«¯ä»£ç  new Bootstrap() .group(new NioEventLoopGroup()) .channel(NioSocketChannel.class) .handler(new ChannelInitializer&lt;Channel&gt;() { @Override protected void initChannel(Channel ch) { ch.pipeline().addLast(new StringEncoder()); } }) .connect(\"127.0.0.1\", 8080) .sync() .channel() .writeAndFlush(new Date() + \": hello world!\"); ç°åœ¨æŠŠå®ƒæ‹†å¼€æ¥çœ‹ ChannelFuture channelFuture = new Bootstrap() .group(new NioEventLoopGroup()) .channel(NioSocketChannel.class) .handler(new ChannelInitializer&lt;Channel&gt;() { @Override protected void initChannel(Channel ch) { ch.pipeline().addLast(new StringEncoder()); } }) .connect(\"127.0.0.1\", 8080); // 1 channelFuture.sync().channel().writeAndFlush(new Date() + \": hello world!\"); 1 å¤„è¿”å›çš„æ˜¯ ChannelFuture å¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ©ç”¨ channel() æ–¹æ³•æ¥è·å– Channel å¯¹è±¡ æ³¨æ„ connect æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ„å‘³ç€ä¸ç­‰è¿æ¥å»ºç«‹ï¼Œæ–¹æ³•æ‰§è¡Œå°±è¿”å›äº†ã€‚å› æ­¤ channelFuture å¯¹è±¡ä¸­ä¸èƒ½ã€ç«‹åˆ»ã€‘è·å¾—åˆ°æ­£ç¡®çš„ Channel å¯¹è±¡ å®éªŒå¦‚ä¸‹ï¼š ChannelFuture channelFuture = new Bootstrap() .group(new NioEventLoopGroup()) .channel(NioSocketChannel.class) .handler(new ChannelInitializer&lt;Channel&gt;() { @Override protected void initChannel(Channel ch) { ch.pipeline().addLast(new StringEncoder()); } }) .connect(\"127.0.0.1\", 8080); System.out.println(channelFuture.channel()); // 1 channelFuture.sync(); // 2 System.out.println(channelFuture.channel()); // 3 æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° [id: 0x2e1884dd] æ‰§è¡Œåˆ° 2 æ—¶ï¼Œsync æ–¹æ³•æ˜¯åŒæ­¥ç­‰å¾…è¿æ¥å»ºç«‹å®Œæˆ æ‰§è¡Œåˆ° 3 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° [id: 0x2e1884dd, L:/127.0.0.1:57191 - R:/127.0.0.1:8080] é™¤äº†ç”¨ sync æ–¹æ³•å¯ä»¥è®©å¼‚æ­¥æ“ä½œåŒæ­¥ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å›è°ƒçš„æ–¹å¼ï¼š ChannelFuture channelFuture = new Bootstrap() .group(new NioEventLoopGroup()) .channel(NioSocketChannel.class) .handler(new ChannelInitializer&lt;Channel&gt;() { @Override protected void initChannel(Channel ch) { ch.pipeline().addLast(new StringEncoder()); } }) .connect(\"127.0.0.1\", 8080); System.out.println(channelFuture.channel()); // 1 channelFuture.addListener((ChannelFutureListener) future -&gt; { System.out.println(future.channel()); // 2 }); æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° [id: 0x749124ba] ChannelFutureListener ä¼šåœ¨è¿æ¥å»ºç«‹æ—¶è¢«è°ƒç”¨ï¼ˆå…¶ä¸­ operationComplete æ–¹æ³•ï¼‰ï¼Œå› æ­¤æ‰§è¡Œåˆ° 2 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° [id: 0x749124ba, L:/127.0.0.1:57351 - R:/127.0.0.1:8080] 2.2ã€CloseFuturepackage com.kk.netty.basice.demo2; import io.netty.bootstrap.Bootstrap; import io.netty.channel.Channel; import io.netty.channel.ChannelFuture; import io.netty.channel.ChannelFutureListener; import io.netty.channel.ChannelInitializer; import io.netty.channel.nio.NioEventLoopGroup; import io.netty.channel.socket.nio.NioSocketChannel; import io.netty.handler.codec.string.StringEncoder; import java.util.Date; public class ChannelFutureTest { public static void main(String[] args) throws InterruptedException { ChannelFuture channelFuture = new Bootstrap ( ) .group (new NioEventLoopGroup ( )) .channel (NioSocketChannel.class) .handler (new ChannelInitializer&lt;Channel&gt; ( ) { @Override protected void initChannel(Channel ch) { ch.pipeline ( ).addLast (new StringEncoder ( )); } }) .connect (\"127.0.0.1\", 8080); //channelFuture.sync ( ).channel ( ).writeAndFlush (new Date ( ) + \"hello!\"); channelFuture.channel ( ).writeAndFlush (new Date ( ) + \"hello!\"); System.out.println (channelFuture.channel ( )); // channelFuture.sync (); // System.out.println (channelFuture.channel () ); channelFuture.addListener ((ChannelFutureListener) future -&gt; { System.out.println (future.channel ( )); }); } } ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ çœ‹åˆ°è¿™é‡Œä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å»æ‰§è¡Œå»ºç«‹è¿æ¥ã€å»æ‰§è¡Œå…³é—­ channelï¼Œé‚£æ ·ä¸æ˜¯ä¹Ÿå¯ä»¥å—ï¼Ÿéè¦ç”¨è¿™ä¹ˆå¤æ‚çš„å¼‚æ­¥æ–¹å¼ï¼šæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å‘èµ·å»ºç«‹è¿æ¥ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å»çœŸæ­£å»ºç«‹è¿æ¥ è¿˜æœ‰åŒå­¦ä¼šç¬¼ç»Ÿåœ°å›ç­”ï¼Œå› ä¸º netty å¼‚æ­¥æ–¹å¼ç”¨äº†å¤šçº¿ç¨‹ã€å¤šçº¿ç¨‹å°±æ•ˆç‡é«˜ã€‚å…¶å®è¿™äº›è®¤è¯†éƒ½æ¯”è¾ƒç‰‡é¢ï¼Œå¤šçº¿ç¨‹å’Œå¼‚æ­¥æ‰€æå‡çš„æ•ˆç‡å¹¶ä¸æ˜¯æ‰€è®¤ä¸ºçš„ æ€è€ƒä¸‹é¢çš„åœºæ™¯ï¼Œ4 ä¸ªåŒ»ç”Ÿç»™äººçœ‹ç—…ï¼Œæ¯ä¸ªç—…äººèŠ±è´¹ 20 åˆ†é’Ÿï¼Œè€Œä¸”åŒ»ç”Ÿçœ‹ç—…çš„è¿‡ç¨‹ä¸­æ˜¯ä»¥ç—…äººä¸ºå•ä½çš„ï¼Œä¸€ä¸ªç—…äººçœ‹å®Œäº†ï¼Œæ‰èƒ½çœ‹ä¸‹ä¸€ä¸ªç—…äººã€‚å‡è®¾ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œå¯ä»¥è®¡ç®—ä¸€ä¸‹ 4 ä¸ªåŒ»ç”Ÿä¸€å¤©å·¥ä½œ 8 å°æ—¶ï¼Œå¤„ç†çš„ç—…äººæ€»æ•°æ˜¯ï¼š4 * 8 * 3 = 96 ç»ç ”ç©¶å‘ç°ï¼Œçœ‹ç—…å¯ä»¥ç»†åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼Œç»æ‹†åˆ†åæ¯ä¸ªæ­¥éª¤éœ€è¦ 5 åˆ†é’Ÿï¼Œå¦‚ä¸‹ å› æ­¤å¯ä»¥åšå¦‚ä¸‹ä¼˜åŒ–ï¼Œåªæœ‰ä¸€å¼€å§‹ï¼ŒåŒ»ç”Ÿ 2ã€3ã€4 åˆ†åˆ«è¦ç­‰å¾… 5ã€10ã€15 åˆ†é’Ÿæ‰èƒ½æ‰§è¡Œå·¥ä½œï¼Œä½†åªè¦åç»­ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œä»–ä»¬å°±èƒ½å¤Ÿæ»¡è´Ÿè·å·¥ä½œï¼Œå¹¶ä¸”å¤„ç†ç—…äººçš„èƒ½åŠ›æé«˜åˆ°äº† 4 * 8 * 12 æ•ˆç‡å‡ ä¹æ˜¯åŸæ¥çš„å››å€ è¦ç‚¹ å•çº¿ç¨‹æ²¡æ³•å¼‚æ­¥æé«˜æ•ˆç‡ï¼Œå¿…é¡»é…åˆå¤šçº¿ç¨‹ã€å¤šæ ¸ cpu æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„ä¼˜åŠ¿ å¼‚æ­¥å¹¶æ²¡æœ‰ç¼©çŸ­å“åº”æ—¶é—´ï¼Œåè€Œæœ‰æ‰€å¢åŠ  åˆç†è¿›è¡Œä»»åŠ¡æ‹†åˆ†ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¼‚æ­¥çš„å…³é”® 3ã€Future &amp; Promiseåœ¨å¼‚æ­¥å¤„ç†æ—¶ï¼Œç»å¸¸ç”¨åˆ°è¿™ä¸¤ä¸ªæ¥å£ é¦–å…ˆè¦è¯´æ˜ netty ä¸­çš„ Future ä¸ jdk ä¸­çš„ Future åŒåï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªæ¥å£ï¼Œnetty çš„ Future ç»§æ‰¿è‡ª jdk çš„ Futureï¼Œè€Œ Promise åˆå¯¹ netty Future è¿›è¡Œäº†æ‰©å±• jdk Future åªèƒ½åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼ˆæˆ–æˆåŠŸã€æˆ–å¤±è´¥ï¼‰æ‰èƒ½å¾—åˆ°ç»“æœ netty Future å¯ä»¥åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸå¾—åˆ°ç»“æœï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥æ–¹å¼å¾—åˆ°ç»“æœï¼Œä½†éƒ½æ˜¯è¦ç­‰ä»»åŠ¡ç»“æŸ netty Promise ä¸ä»…æœ‰ netty Future çš„åŠŸèƒ½ï¼Œè€Œä¸”è„±ç¦»äº†ä»»åŠ¡ç‹¬ç«‹å­˜åœ¨ï¼Œåªä½œä¸ºä¸¤ä¸ªçº¿ç¨‹é—´ä¼ é€’ç»“æœçš„å®¹å™¨ åŠŸèƒ½/åç§° jdk Future netty Future Promise cancel å–æ¶ˆä»»åŠ¡ - - isCanceled ä»»åŠ¡æ˜¯å¦å–æ¶ˆ - - isDone ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œä¸èƒ½åŒºåˆ†æˆåŠŸå¤±è´¥ - - get è·å–ä»»åŠ¡ç»“æœï¼Œé˜»å¡ç­‰å¾… - - getNow - è·å–ä»»åŠ¡ç»“æœï¼Œéé˜»å¡ï¼Œè¿˜æœªäº§ç”Ÿç»“æœæ—¶è¿”å› null - await - ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡ isSuccess åˆ¤æ–­ - sync - ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ - isSuccess - åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ - cause - è·å–å¤±è´¥ä¿¡æ¯ï¼Œéé˜»å¡ï¼Œå¦‚æœæ²¡æœ‰å¤±è´¥ï¼Œè¿”å›null - addLinstener - æ·»åŠ å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ - setSuccess - - è®¾ç½®æˆåŠŸç»“æœ setFailure - - è®¾ç½®å¤±è´¥ç»“æœ 3-1ã€JDK-future // jdk-future public static void test() throws ExecutionException, InterruptedException { // 1.çº¿ç¨‹æ±  ExecutorService executorService = Executors.newFixedThreadPool (2); // 2.æäº¤ä»»åŠ¡ Future&lt;Integer&gt; future = executorService.submit (new Callable&lt;Integer&gt; ( ) { @Override public Integer call() throws InterruptedException { log.info (\"æ‰§è¡Œè®¡ç®—ï¼\"); Thread.sleep (1000); return 50; } }); // 3ã€ä¸»çº¿ç¨‹é€šè¿‡ futureè·å–ç»“æœ log.info (\"ç­‰å¾…ç»“æœä¸­......\"); log.info (\"ç»“æœä¸ºï¼š{}\", future.get ( )); } è¾“å‡º 10:08:46.201 [main] INFO com.kk.netty.basice.demo2.FutureAndPromise - ç­‰å¾…ç»“æœä¸­â€¦â€¦10:08:46.201 [pool-1-thread-1] INFO com.kk.netty.basice.demo2.FutureAndPromise - æ‰§è¡Œè®¡ç®—ï¼10:08:47.205 [main] INFO com.kk.netty.basice.demo2.FutureAndPromise - ç»“æœä¸ºï¼š50 3-2ã€netty-future // netty-future() public static void test11() throws ExecutionException, InterruptedException { NioEventLoopGroup group = new NioEventLoopGroup ( ); EventLoop eventLoop = group.next ( ); Future&lt;Integer&gt; future = eventLoop.submit (new Callable&lt;Integer&gt; ( ) { @Override public Integer call() throws InterruptedException { log.info (\"æ‰§è¡Œè®¡ç®—ï¼\"); Thread.sleep (1000); return 50; } }); log.info (\"ç­‰å¾…ç»“æœä¸­......\"); //&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;åŒæ­¥&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; // æ§åˆ¶å°æ‰“å°æ˜¯mainçº¿ç¨‹æ‰“å° // log.info (\"ç»“æœä¸ºï¼š{}\", future.get ( )); //&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;åŒæ­¥&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; //&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;å¼‚æ­¥&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; future.addListener (new GenericFutureListener&lt;Future&lt;? super Integer&gt;&gt; ( ) { @Override public void operationComplete(Future&lt;? super Integer&gt; future) throws Exception { // æ§åˆ¶å°æ‰“å°æ˜¯ nioEventLoopGroup çº¿ç¨‹ç»„æ‰“å° log.info (\"ç»“æœä¸ºï¼š{}\", future.getNow ( )); } }); //&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;å¼‚æ­¥&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; } 10:40:10.185 [main] INFO com.kk.netty.basice.demo2.FutureAndPromise - ç­‰å¾…ç»“æœä¸­â€¦â€¦10:40:10.189 [nioEventLoopGroup-2-1] INFO com.kk.netty.basice.demo2.FutureAndPromise - æ‰§è¡Œè®¡ç®—ï¼10:40:11.190 [nioEventLoopGroup-2-1] INFO com.kk.netty.basice.demo2.FutureAndPromise - ç»“æœä¸ºï¼š50 3-(1-2)å°ç»“æ— è®ºæ˜¯jucä¸­çš„ future è¿˜æ˜¯ netty ä¸­çš„ future éƒ½æ˜¯æ¥è‡ªäº juc ä¸Šé¢ä¸¤ç§è·å–çš„ future æ–¹å¼ éƒ½æ˜¯è¢«åŠ¨è¿”å›å¾—åˆ°çš„ï¼Œè‹¥è¦ä¸»åŠ¨ï¼Œæ­¤æ—¶å¯ä»¥ç”¨ netty ä¸­çš„ Promise 3.1ã€åŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ DefaultEventLoop eventExecutors = new DefaultEventLoop ( ); DefaultPromise&lt;Integer&gt; promise = new DefaultPromise&lt;&gt; (eventExecutors); eventExecutors.execute (() -&gt; { try { Thread.sleep (1000); } catch (InterruptedException e) { e.printStackTrace ( ); } log.debug (\"set success, {}\", 10); promise.setSuccess (10); }); log.debug (\"start...\"); log.debug (\"getNow:{}\", promise.getNow ( )); // è¿˜æ²¡æœ‰ç»“æœ log.debug (\"get:{}\", promise.get ( )); } è¾“å‡º 17:15:38.604 [main] DEBUG com.kk.netty.basice.demo2.FutureAndPromise - startâ€¦17:15:38.604 [main] DEBUG com.kk.netty.basice.demo2.FutureAndPromise - getNow:null17:15:39.605 [defaultEventLoop-1-1] DEBUG com.kk.netty.basice.demo2.FutureAndPromise - set success, 1017:15:39.605 [main] DEBUG com.kk.netty.basice.demo2.FutureAndPromise - get:10 3.2ã€å¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸDefaultEventLoop eventExecutors = new DefaultEventLoop ( ); DefaultPromise&lt;Integer&gt; promise = new DefaultPromise&lt;&gt; (eventExecutors); // è®¾ç½®å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ promise.addListener (future -&gt; { // è¿™é‡Œçš„ future å°±æ˜¯ä¸Šé¢çš„ promise log.debug (\"getNow:{}\", future.getNow ( )); }); eventExecutors.execute (() -&gt; { try { Thread.sleep (1000); } catch (InterruptedException e) { e.printStackTrace ( ); } log.debug (\"set success, {}\", 10); promise.setSuccess (10); }); log.debug (\"start...\"); è¾“å‡º 11:49:30 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - startâ€¦11:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set success, 1011:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - 10 3.3ã€åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - sync &amp; getDefaultEventLoop eventExecutors = new DefaultEventLoop ( ); DefaultPromise&lt;Integer&gt; promise = new DefaultPromise&lt;&gt; (eventExecutors); eventExecutors.execute (() -&gt; { try { Thread.sleep (1000); } catch (InterruptedException e) { e.printStackTrace ( ); } RuntimeException e = new RuntimeException (\"error...\"); log.debug (\"set failure, {}\", e.toString ( )); promise.setFailure (e); }); log.debug (\"start...\"); log.debug (\"getNow:{}\", promise.getNow ( )); promise.get ( ); // sync() ä¹Ÿä¼šå‡ºç°å¼‚å¸¸ï¼Œåªæ˜¯ get ä¼šå†ç”¨ ExecutionException åŒ…ä¸€å±‚å¼‚å¸¸ è¾“å‡º 12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - startâ€¦12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null12:11:08 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: errorâ€¦Exception in thread â€œmainâ€ java.util.concurrent.ExecutionException: java.lang.RuntimeException: errorâ€¦ at io.netty.util.concurrent.AbstractFuture.get(AbstractFuture.java:41) at com.itcast.oio.DefaultPromiseTest2.main(DefaultPromiseTest2.java:34)Caused by: java.lang.RuntimeException: errorâ€¦ at com.itcast.oio.DefaultPromiseTest2.lambda$main$0(DefaultPromiseTest2.java:27) at io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54) at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918) at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) at java.lang.Thread.run(Thread.java:745) 3.4ã€åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - awaitDefaultEventLoop eventExecutors = new DefaultEventLoop ( ); DefaultPromise&lt;Integer&gt; promise = new DefaultPromise&lt;&gt; (eventExecutors); eventExecutors.execute (() -&gt; { try { Thread.sleep (1000); } catch (InterruptedException e) { e.printStackTrace ( ); } RuntimeException e = new RuntimeException (\"error...\"); log.debug (\"set failure, {}\", e.toString ( )); promise.setFailure (e); }); log.debug (\"start...\"); log.debug (\"getNow:{}\", promise.getNow ( )); promise.await ( ); // ä¸ sync å’Œ get åŒºåˆ«åœ¨äºï¼Œä¸ä¼šæŠ›å¼‚å¸¸ log.debug (\"result {}\", (promise.isSuccess ( ) ? promise.getNow ( ) : promise.cause ( )).toString ( )); è¾“å‡º 12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - startâ€¦12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null12:18:54 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: errorâ€¦12:18:54 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: errorâ€¦ 3.5ã€å¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥DefaultEventLoop eventExecutors = new DefaultEventLoop ( ); DefaultPromise&lt;Integer&gt; promise = new DefaultPromise&lt;&gt; (eventExecutors); promise.addListener (future -&gt; { log.debug (\"result {}\", (promise.isSuccess ( ) ? promise.getNow ( ) : promise.cause ( )).toString ( )); }); eventExecutors.execute (() -&gt; { try { Thread.sleep (1000); } catch (InterruptedException e) { e.printStackTrace ( ); } RuntimeException e = new RuntimeException (\"error...\"); log.debug (\"set failure, {}\", e.toString ( )); promise.setFailure (e); }); log.debug (\"start...\"); è¾“å‡º 12:04:57 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - startâ€¦12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: errorâ€¦12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: errorâ€¦ 3.6ã€await æ­»é”æ£€æŸ¥DefaultEventLoop eventExecutors = new DefaultEventLoop ( ); DefaultPromise&lt;Integer&gt; promise = new DefaultPromise&lt;&gt; (eventExecutors); eventExecutors.submit (() -&gt; { System.out.println (\"1\"); try { promise.await ( ); // æ³¨æ„ä¸èƒ½ä»…æ•è· InterruptedException å¼‚å¸¸ // å¦åˆ™ æ­»é”æ£€æŸ¥æŠ›å‡ºçš„ BlockingOperationException ä¼šç»§ç»­å‘ä¸Šä¼ æ’­ // è€Œæäº¤çš„ä»»åŠ¡ä¼šè¢«åŒ…è£…ä¸º PromiseTaskï¼Œå®ƒçš„ run æ–¹æ³•ä¸­ä¼š catch æ‰€æœ‰å¼‚å¸¸ç„¶åè®¾ç½®ä¸º Promise çš„å¤±è´¥ç»“æœè€Œä¸ä¼šæŠ›å‡º } catch (Exception e) { e.printStackTrace ( ); } System.out.println (\"2\"); }); eventExecutors.submit (() -&gt; { System.out.println (\"3\"); try { promise.await ( ); } catch (Exception e) { e.printStackTrace ( ); } System.out.println (\"4\"); }); è¾“å‡º 1234io.netty.util.concurrent.BlockingOperationException: DefaultPromise@47499c2a(incomplete)at io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:384) 4ã€Handler &amp; PipelineChannelHandler ç”¨æ¥å¤„ç† Channel ä¸Šçš„å„ç§äº‹ä»¶ï¼Œåˆ†ä¸ºå…¥æ ˆã€å‡ºæ ˆä¸¤ç§ã€‚æ‰€æœ‰ ChannelHandler è¢«è¿æˆä¸€ä¸²ï¼Œå°±æ˜¯ Pipeline å…¥ç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelInboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦ç”¨æ¥è¯»å–å®¢æˆ·ç«¯æ•°æ®ï¼Œå†™å›ç»“æœ å‡ºç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelOutboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦å¯¹å†™å›ç»“æœè¿›è¡ŒåŠ å·¥ æ‰“ä¸ªæ¯”å–»ï¼Œæ¯ä¸ª Channel æ˜¯ä¸€ä¸ªäº§å“çš„åŠ å·¥è½¦é—´ï¼ŒPipeline æ˜¯è½¦é—´ä¸­çš„æµæ°´çº¿ï¼ŒChannelHandler å°±æ˜¯æµæ°´çº¿ä¸Šçš„å„é“å·¥åºï¼Œè€Œåé¢è¦è®²çš„ ByteBuf æ˜¯åŸææ–™ï¼Œç»è¿‡å¾ˆå¤šå·¥åºçš„åŠ å·¥ï¼šå…ˆç»è¿‡ä¸€é“é“å…¥ç«™å·¥åºï¼Œå†ç»è¿‡ä¸€é“é“å‡ºç«™å·¥åºæœ€ç»ˆå˜æˆäº§å“ å…ˆææ¸…æ¥šé¡ºåºï¼ŒæœåŠ¡ç«¯ new ServerBootstrap() .group(new NioEventLoopGroup()) .channel(NioServerSocketChannel.class) .childHandler(new ChannelInitializer&lt;NioSocketChannel&gt;() { protected void initChannel(NioSocketChannel ch) { ch.pipeline().addLast(new ChannelInboundHandlerAdapter(){ @Override public void channelRead(ChannelHandlerContext ctx, Object msg) { System.out.println(1); ctx.fireChannelRead(msg); // 1 } }); ch.pipeline().addLast(new ChannelInboundHandlerAdapter(){ @Override public void channelRead(ChannelHandlerContext ctx, Object msg) { System.out.println(2); ctx.fireChannelRead(msg); // 2 } }); ch.pipeline().addLast(new ChannelInboundHandlerAdapter(){ @Override public void channelRead(ChannelHandlerContext ctx, Object msg) { System.out.println(3); ctx.channel().write(msg); // 3 } }); ch.pipeline().addLast(new ChannelOutboundHandlerAdapter(){ @Override public void write(ChannelHandlerContext ctx, Object msg, ChannelPromise promise) { System.out.println(4); ctx.write(msg, promise); // 4 } }); ch.pipeline().addLast(new ChannelOutboundHandlerAdapter(){ @Override public void write(ChannelHandlerContext ctx, Object msg, ChannelPromise promise) { System.out.println(5); ctx.write(msg, promise); // 5 } }); ch.pipeline().addLast(new ChannelOutboundHandlerAdapter(){ @Override public void write(ChannelHandlerContext ctx, Object msg, ChannelPromise promise) { System.out.println(6); ctx.write(msg, promise); // 6 } }); } }) .bind(8080); å®¢æˆ·ç«¯ new Bootstrap() .group(new NioEventLoopGroup()) .channel(NioSocketChannel.class) .handler(new ChannelInitializer&lt;Channel&gt;() { @Override protected void initChannel(Channel ch) { ch.pipeline().addLast(new StringEncoder()); } }) .connect(\"127.0.0.1\", 8080) .addListener((ChannelFutureListener) future -&gt; { future.channel().writeAndFlush(\"hello,world\"); }); æœåŠ¡å™¨ç«¯æ‰“å°ï¼š 1 2 3 6 5 4 äºŒã€è¿›é˜¶1ã€2ã€3ã€ä¸‰ã€æºç 1ã€2ã€3ã€â…¢ã€å¸¸è¯†ï¼ˆé¢è¯•ï¼‰1ã€å¤šçº¿ç¨‹ç¼ºç‚¹ å†…å­˜å ç”¨é«˜ çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬é«˜ åªé€‚åˆè¿æ¥æ•°å°‘çš„åœºæ™¯ 2ã€çº¿ç¨‹æ± ç¼ºç‚¹ é˜»å¡æ¨¡å¼ä¸‹ï¼Œçº¿ç¨‹ä»…èƒ½å¤„ç†ä¸€ä¸ª socket è¿æ¥ ä»…é€‚åˆçŸ­è¿æ¥åœºæ™¯ 3ã€FileChannel å·¥ä½œæ¨¡å¼FileChannel åªèƒ½å·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹ 4ã€5ã€6ã€7ã€8ã€å‚è€ƒæ–‡çŒ® â†“try 1.7 ï¼šhttps://blog.csdn.net/renvictory/article/details/108844745","categories":[{"name":"å†…åŠ›ç¯‡","slug":"å†…åŠ›ç¯‡","permalink":"https://mykkto.github.io/categories/%E5%86%85%E5%8A%9B%E7%AF%87/"}],"tags":[{"name":"netty","slug":"netty","permalink":"https://mykkto.github.io/tags/netty/"},{"name":"nio","slug":"nio","permalink":"https://mykkto.github.io/tags/nio/"},{"name":"ç½‘ç»œç¼–ç¨‹","slug":"ç½‘ç»œç¼–ç¨‹","permalink":"https://mykkto.github.io/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"}],"author":"mykk"},{"title":"éšæ€§è®°å½•ä¸€å°ç‚¹ 2021-07-15è‡³æœªæ¥","slug":"00-blog/00_æ•£åˆ—éšæ‰‹è®°","date":"2022-08-05T15:21:33.000Z","updated":"2023-04-22T12:44:06.463Z","comments":true,"path":"posts/cfd1312a.html","link":"","permalink":"https://mykkto.github.io/posts/cfd1312a.html","excerpt":"","text":"â€”â€”â€”â€”ç®€ä¹¦åŸå§‹åœ°å€â€”â€”â€”â€”2021å¹´07æœˆ15æ—¥pl/sqlå®¢æˆ·ç«¯bug åˆ‡æ¢çš„ç”¨æˆ·çš„æ—¶å€™ï¼Œä¼šä¸²æ‰ï¼ˆæ„æ€æ˜¯æ˜¾ç¤ºä¸Šåˆ‡æ¢äº†ï¼Œå…¶å®å¹¶æ²¡æœ‰ï¼‰è§£å†³æ–¹æ¡ˆï¼šå¿…é¡»é‡å¯å®¢æˆ·ç«¯ï¼Œåˆ‡æ¢ç”¨æˆ· 2021å¹´07æœˆ26æ—¥idea git å°å§¿åŠ¿ï¼Œæœ¬åœ°åº“æ‹–å› 2021å¹´07æœˆ28æ—¥oracle å°çŸ¥è¯†ï¼šä¸å°å¿ƒåˆ é™¤äº†ä¸€å¼ è¡¨æ•°æ®ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ select * from è¡¨å as of timestamp sysdate-1/12 //æŸ¥è¯¢ä¸¤ä¸ªå°æ—¶å‰çš„åˆ é™¤çš„æŸå¼ è¡¨ 2021å¹´08æœˆ22æ—¥å¹¶è¡Œï¼šå¤šä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶é—´ç‚¹å‘ç”Ÿï¼Œå¹¶ç”±ä¸åŒçš„cpuè¿›è¡Œå¤„ç†ï¼Œä¸äº’ç›¸æŠ¢å èµ„æºå¹¶å‘ï¼šå¤šä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶é—´ç‚¹å†…åŒæ—¶å‘ç”Ÿäº†ï¼Œä½†ç”±åŒä¸€ä¸ªcpuè¿›è¡Œå¤„ç†ï¼Œäº’ç›¸æŠ¢å èµ„æºæ–‡ç« æ¨èï¼šhttps://www.cnblogs.com/iamqiyue/p/14184769.html 2021å¹´08æœˆ30æ—¥jsp ç”¨0åšå­—æ®µçŠ¶æ€ï¼Œåˆ—è¡¨ä¼šå‡ºé—®é¢˜ï¼Œä¼šæœ‰é»˜è®¤å€¼ 2021å¹´09æœˆ07æ—¥easyUI åµŒå¥—å¯¹è¯æ¡†é—®é¢˜ï¼Œå¯¹è¯æ¡†Aå¼¹å‡ºå¯¹è¯æ¡†Bï¼ŒAæ— æ³•å…³é—­ã€‚éœ€è¦åœ¨Açš„å…³é—­å›è°ƒ æ‰“å¼€Bï¼Œä¹Ÿå°±æ˜¯å…³é—­Aä¸èƒ½å’Œæ‰“å¼€B å†™åœ¨ä¸€èµ·ï¼Œå¿…é¡»å…³é—­Aè°ƒç”¨Açš„å…³é—­å›è°ƒä¹‹åå†æ‰“å¼€Bã€‚ 2021å¹´09æœˆ14æ—¥oracle 11gåˆ†ç»„æ¡ˆä¾‹ï¼š1ã€group by user_id,PUNCH_DATEï¼šé€šè¿‡ç”¨æˆ·idå’Œæ—¥æœŸåˆ†ç»„2ã€listagg( TIME_INTERVAL ,â€™,â€™) within group (order by id) ï¼šéœ€è¦å±•ç¤ºçš„å­—æ®µï¼ˆæ²¡æœ‰çº³å…¥åˆ†ç»„è§„åˆ™çš„ï¼‰ï¼Œorder by id é€šè¿‡ id æ’åºï¼Œæˆ–è€…å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ’åºå­—æ®µ select d.id,u.User_Id,u.User_Name,d.Punch_Date,d.Punch_Time,de.Dept_Name,d.time,d.remark,d.status,d.TIME_INTERVAL,d.PUNCH_STATUS from (select user_id,PUNCH_DATEï¼Œ listagg( TIME_INTERVAL ,',') within group (order by id) as TIME_INTERVAL, listagg( STATUS,',') within group(order by id) as STATUS, listagg( id ,',') within group(order by id) as id, listagg( REMARK ,',') within group(order by id) as REMARK, listagg( PUNCH_TIME ,',') within group(order by id) as PUNCH_TIME, listagg( PUNCH_STATUS ,',') within group(order by id) as PUNCH_STATUS, listagg( time ,',') within group(order by id) as time from KQ_PUNCH_DAILY group by user_id,PUNCH_DATE) d inner join tbl_sys_user u on d.User_Id=u.USER_ID inner join tbl_sys_department de on de.dept_id=u.dept_id 2021å¹´09æœˆ23æ—¥ä¸€ã€oracle 11g å­˜å‚¨è¿‡ç¨‹åˆ†å‰²å­—ç¬¦ä¸²æ¡ˆä¾‹ï¼šçº¯åˆ†å‰² æµ‹è¯•ä»£ç ï¼ˆå…ˆè¿è¡Œå­˜å‚¨è¿‡ç¨‹ä»£ç ï¼‰ SELECT * FROM TABLE( FUNC_ISM_GETSPLITSTR('_FUNC_CTP_LG_GEsss_s_ssssTSPNG_', '_')); å…ˆåˆ›å»ºå˜é‡ --åˆ›å»ºå˜é‡ CREATE OR REPLACE TYPE \"ARRYTYPE1\" IS VARRAY(10000) OF VARCHAR(2000); å­˜å‚¨è¿‡ç¨‹ä»£ç  CREATE OR REPLACE FUNCTION FUNC_ISM_GETSPLITSTR ( in_str IN VARCHAR2, --éœ€åˆ†å‰²çš„å­—ç¬¦ä¸² in_split IN VARCHAR2 --åˆ†éš”ç¬¦ ) RETURN arrytype1 AS v_count1 INTEGER; v_count2 INTEGER; v_strlist arrytype1; v_node VARCHAR2 (2000); BEGIN v_count2 := 0; v_strlist := arrytype1 (); IF (in_str IS NULL) OR (LENGTH (in_str) &lt;= 0) THEN RETURN NULL; END IF; FOR v_i IN 1 .. LENGTH (in_str) LOOP v_count1 := INSTRB (in_str, in_split, 1, v_i); v_count2 := INSTRB (in_str, in_split, 1, v_i + 1); v_node := SUBSTRB (in_str, v_count1 + 1, v_count2 - v_count1 - 1); IF v_node IS NULL THEN v_node := ''; END IF; IF (v_count2 = 0) OR (v_count2 IS NULL) THEN EXIT; ELSE v_strlist.EXTEND (); v_strlist (v_i) := v_node; v_node := ''; END IF; END LOOP; RETURN v_strlist; END FUNC_ISM_GETSPLITSTR; è¾“å‡ºç»“æœ äºŒã€oracle 11g å­˜å‚¨è¿‡ç¨‹åˆ†å‰²å­—ç¬¦ä¸²æ¡ˆä¾‹ï¼šåˆ†å‰²+åˆ¤æ–­ç¼–å†™è¯­å¥ CREATE OR REPLACE FUNCTION FUNC_ISM_GETSPLITSTR2 (-- æœ€ç»ˆè¿”å› 1 å‘èµ·éƒ¨é—¨ï¼Œ2 ä¸»åŠéƒ¨é—¨ï¼Œ3 ååŠéƒ¨é—¨ -- å†™æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨å¼€å§‹èŠ‚ç‚¹å’Œç»“æŸèŠ‚ç‚¹åŠ ä¸Šåˆ†éš”ç¬¦å¦åˆ™å¨¶ä¸åˆ° -- _FUNC_CTP_LG_GEsss_s_ssssTSPNG_ ç±»ä¼¼ è¿™ç§æ ¼å¼ in_str IN VARCHAR2, --éœ€åˆ†å‰²çš„å­—ç¬¦ä¸² in_split IN VARCHAR2 --åˆ†éš”ç¬¦ ) RETURN VARCHAR2 AS v_count1 INTEGER; v_count2 INTEGER; v_count3 INTEGER;--è®¡æ•°å™¨ v_node VARCHAR2 (2000); v_result VARCHAR2 (2000); v_resulttep VARCHAR2 (2000); in_strtep VARCHAR2 (2000); BEGIN in_strtep := in_split||in_str||in_split; v_count2 := 0; v_count3 := 0; v_result := '1'; v_resulttep :=''; IF (in_strtep IS NULL) OR (LENGTH (in_strtep) &lt;= 0) THEN RETURN NULL; END IF; FOR v_i IN 1 .. LENGTH (in_strtep) LOOP v_count1 := INSTRB (in_strtep, in_split, 1, v_i); v_count2 := INSTRB (in_strtep, in_split, 1, v_i + 1); v_node := SUBSTRB (in_strtep, v_count1 + 1, v_count2 - v_count1 - 1); IF v_node IS NULL THEN v_node := ''; elsif (v_node= '2') then v_count3 := v_count3 +1 ;-- è®°å¾—å¯¹èŠ‚ç‚¹åˆ¤ç©ºï¼Œå†™åœ¨åå¤´ ELSE v_resulttep := v_resulttep || v_node; END IF; IF (v_count2 = 0) OR (v_count2 IS NULL) THEN EXIT; ELSE v_strlist.EXTEND (); v_strlist (v_i) := v_node; v_node := ''; END IF; END LOOP; if ((LENGTH (in_str)-1)/2+1 = v_count3) then v_result := '2';END IF; RETURN v_result; END FUNC_ISM_GETSPLITSTR2; ç»“æœå¯¹æ¯”è¾“å‡ºï¼šå¦‚æœæœ‰ä¸€ä¸ª 1æ‰€æœ‰éƒ½æ˜¯1 ï¼Œå¦‚æœ æ‰€æœ‰ä¸º 2 æ‰èƒ½å…¨éƒ¨ä¸º2 ä¸‰ã€å•æ¡SQL æ˜ å°„è¾“å‡ºï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸èƒ½æ˜¯å¤šæ¡ç»“æœé›†ï¼Œè¿™ä¸ªåªæ˜¯å•æ¡ï¼Œæ¥å—ç±»å‹ä¸º varchar2 ï¼‰ CREATE OR REPLACE FUNCTION \"FUNC_ISM_GETSPLITSTR2_TODAY2\" (-- è®¡ç®—åŠ 3å¤©åï¼ˆè·³è¿‡éåŒæ˜¨æ—¥ï¼‰ï¼Œå¾—åˆ°å®é™…çš„ æ—¥æœŸï¼‰ -- å†™æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨å¼€å§‹èŠ‚ç‚¹å’Œç»“æŸèŠ‚ç‚¹åŠ ä¸Šåˆ†éš”ç¬¦å¦åˆ™å¨¶ä¸åˆ° -- _FUNC_CTP_LG_GEsss_s_ssssTSPNG_ ç±»ä¼¼ è¿™ç§æ ¼å¼ in_str IN VARCHAR2 --éœ€è¦è¢«è®¡ç®—çš„æ—¥æœŸ ) RETURN VARCHAR2 AS in_result VARCHAR2 (4000);-- in_temp VARCHAR2 (4000); in_year VARCHAR2 (4000); in_month VARCHAR2 (4000); in_day VARCHAR2 (4000); BEGIN in_temp := SUBSTR(in_str,1,4);sql select ID into in_result from TBL_TASKS_PERSONAL_SIDE WHERE ID='402881e57c968139017c969805df00d9'; RETURN in_temp; END FUNC_ISM_GETSPLITSTR2_TODAY2; æµ‹è¯•ä»£ç ï¼šSELECT FUNC_ISM_GETSPLITSTR2_TODAY2('2021-04-22') as aaa FROM TBL_TASKS_PERSONAL_MAIN ORACLE å­˜å‚¨è¿‡ç¨‹INTO å¤šä¸ªå˜é‡ select f1,f2,f3 into v1,v2,v3 from tab1 2021å¹´09æœˆ29æ—¥æœ‰çš„æ—¶å€™Java catch ç”¨ e.getStackTrace ( );ä¸å‡ºå¼‚å¸¸æ ˆä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨e.printStackTrace ( );è§£å†³ 2021å¹´10æœˆ26æ—¥ï¼ˆ1ï¼‰oracle åˆ†é¡µ select * from ( select A.*,ROWNUM RN from ( SELECT * from DEP_TASK_VIEW) A where 1=1 and ROWNUM &lt;=10 ) WHERE RN &gt;= 1 ï¼ˆ2ï¼‰ä¸ä»…å¦‚æ­¤ RNè¿˜å¯ä»¥å½“åšå”¯ä¸€è®°å½•æ•°IDä½¿ç”¨ï¼Œå› è§†å›¾åˆå¹¶å‡ºæ¥çš„æ•°æ®IDä¸æ˜¯å”¯ä¸€çš„ select * from ( select A.*,ROWNUM RN from ( SELECT * from DEP_TASK_VIEW) A where 1=1 and ROWNUM &lt;=10 ) WHERE RN &gt;= 1 and RN in (2,3,5) 2021å¹´10æœˆ29æ—¥æ—¥æœŸæœŸé™è®¡ç®—èŠ‚å‡æ—¥çš„å­˜å‚¨è¿‡ç¨‹ï¼Œå¥—ç”¨ä¸¤ä¸ªè§†å›¾ï¼ˆ1ï¼‰å‡½æ•° CREATE OR REPLACE FUNCTION \"FUNC_ISM_GETSPLITSTR2_TODAY2\" (-- è®¡ç®—åŠ 3å¤©åï¼ˆè·³è¿‡éåŒæ˜¨æ—¥ï¼‰ï¼Œå¾—åˆ°å®é™…çš„ æ—¥æœŸï¼‰æ‰æœ‰è¯¥è·³çš„ç¬¬ä¸‰æ¡è®°å½•è·å–ï¼Œè€Œä¸æ˜¯æ—¥æœŸç›´æ¥+3ï¼Œç­›é€‰å‡ºåªæœ‰å·¥ä½œæ—¥ in_str IN VARCHAR2 --éœ€è¦è¢«è®¡ç®—çš„æ—¥æœŸ ) RETURN VARCHAR2 AS in_result VARCHAR2 (4000);-- æœ€ç»ˆç»“æœ in_temp VARCHAR2 (4000);-- è¾…åŠ©ç­›é€‰å¹´ in_temp2 NUMBER;-- è¾…åŠ©ç­›é€‰å¹´ +1 in_temp3 VARCHAR2 (4000);-- è¾…åŠ©ç­›é€‰æœˆ in_temp33 NUMBER;-- è¾…åŠ©ç­›é€‰æœˆ --å¤„ç†ç²¾åº¦ in_temp4 VARCHAR2 (4000);-- è¾…åŠ©ç­›é€‰æ—¥ in_temp44 NUMBER;-- è¾…åŠ©ç­›é€‰æ—¥ --å¤„ç†ç²¾åº¦ in_year VARCHAR2 (4000);--è®¡ç®—çš„å¹´ in_month VARCHAR2 (4000);--è®¡ç®—çš„æœˆ in_day VARCHAR2 (4000);--è®¡ç®—çš„æ—¥ in_rn1 VARCHAR2 (4000);--å…ˆæ‰¾åˆ°è¯æ¡æ—¥å†çš„rownum,ç„¶ååŠ 3çš„è®°å½•æ•°å°±æ˜¯ in_rn12 VARCHAR2 (4000);-- è¯æ¡äºŒï¼ˆæœ€ç»ˆçš„ï¼‰ï¼Œé…åˆè§†å›¾äºŒ in_rn122 NUMBER; in_time VARCHAR2 (4000);-- åç¼€çš„æ—¶é—´ BEGIN in_temp := SUBSTR(in_str,1,4); in_temp2 := \"TO_NUMBER\"(in_temp)+1; in_temp3 := SUBSTR(in_str,6,2); in_temp33 := \"TO_NUMBER\"(in_temp3); in_temp4 := SUBSTR(in_str,9,2); in_temp44 := \"TO_NUMBER\"(in_temp4); in_time := SUBSTR(in_str,11,99); SELECT RNN into in_rn1 from TASK_TEMP_DAY1 WHERE CALYEAR = in_temp AND CALENDAR_MONTH = in_temp33 AND CALENDAR_DAY = in_temp44; SELECT RNN2 into in_rn12 from TASK_TEMP_DAY2 WHERE RNN = in_rn1; in_rn122 := \"TO_NUMBER\"(in_rn12)+3; SELECT CALYEAR,CALENDAR_MONTH,CALENDAR_DAY into in_year,in_month,in_day from TASK_TEMP_DAY2 WHERE RNN2 = in_rn122; in_result := in_year||'-'; IF(in_month&lt;10) THEN in_result := in_result || '0'||in_month||'-'; ELSE in_result := in_result ||in_month||'-'; END IF; IF(in_day&lt;10) THEN in_result := in_result || '0'||in_day; ELSE in_result := in_result ||in_day; END IF; in_result := in_result ||in_time; RETURN in_result; END FUNC_ISM_GETSPLITSTR2_TODAY2; ï¼ˆ2ï¼‰TASK_TEMP_DAY1 SELECT ROWNUM RNN, \"CALYEAR\", \"ID\", \"CALENDAR_ID\", \"CALENDAR_MONTH\", \"CALENDAR_DAY\", \"CALENDAR_DATE_TYPE\", \"CALENDAR_MODIFY_PERSON\", \"CALENDAR_MODIFY_TIME\", \"BLANK0\", \"BLANK1\" FROM ( SELECT DE.*, CA.CALENDAR_YEAR CALYEAR FROM KQ_CALENDAR CA INNER JOIN KQ_CALENDAR_DETAIL DE ON CA.CALENDAR_ID = DE.CALENDAR_ID WHERE 1 = 1 AND CA.CALENDAR_CREATOR = '4028811d7057520301705756b3ca0050' ORDER BY CA.CALENDAR_YEAR ASC, DE.CALENDAR_MONTH ASC, DE.CALENDAR_DAY ASC ) -- å·¥ä½œä»»åŠ¡é€¾æœŸè®¡ç®—èŠ‚å‡æ—¥é…åˆå‡½æ•°çš„è§†å›¾(è¢«æŸ¥è¯¢çš„è§†å›¾) ï¼ˆ3ï¼‰TASK_TEMP_DAY2 SELECT ROWNUM RNN2, \"RNN\", \"CALYEAR\", \"ID\", \"CALENDAR_ID\", \"CALENDAR_MONTH\", \"CALENDAR_DAY\", \"CALENDAR_DATE_TYPE\", \"CALENDAR_MODIFY_PERSON\", \"CALENDAR_MODIFY_TIME\", \"BLANK0\", \"BLANK1\" FROM TASK_TEMP_DAY1 WHERE CALENDAR_DATE_TYPE = '0' -- å·¥ä½œä»»åŠ¡é€¾æœŸè®¡ç®—èŠ‚å‡æ—¥é…åˆå‡½æ•°çš„è§†å›¾(è¢«è®¡ç®—çš„è§†å›¾) 2021å¹´11æœˆ04æ—¥oracle 11g å†™å­˜å‚¨è¿‡ç¨‹æŠ¥é”™ï¼šORA-00972 identifier is too longåŸå› å­˜å‚¨è¿‡ç¨‹çš„å‘½åè¿‡é•¿ï¼Œæ”¹çŸ­å³å¯ã€‚ 2021å¹´11æœˆ05æ—¥oracle 11g å†™å­˜å‚¨è¿‡ç¨‹ æ‹¼æ¥å•å¼•å·è½¬ä¹‰é—®é¢˜ï¼š in_str := '1'; -- è¾“å‡º 1 in_str := '''1'''; -- è¾“å‡º '1' 2021å¹´11æœˆ05æ—¥oracle 11g å†™å­˜å‚¨è¿‡ç¨‹ SQLå­—ç¬¦ä¸² è¿è¡Œåèµ‹å€¼ï¼š v_idsaaa := SUBSTR(v_idsaaa,1,\"LENGTH\"(v_idsaaa)-1); in_timesiov := 'SELECT createTe_ from (SELECT listagg (createTe_, '','') WITHIN GROUP (ORDER BY ID_) AS createTe_ from ( select TO_CHAR ( create_, ''yyyy-mm-dd hh24:mi:ss'' ) createTe_ ,COMMITUSERID_,BUSINESSID_,NAME_,ID_ from jbpm_taskinstance WHERE BUSINESSID_=''402881f47ce4b52d017ce4bc73d30026'' and NAME_ =''è¿›ç¨‹1'' and COMMITUSERID_ in ('||v_idsaaa||')) GROUP BY BUSINESSID_,NAME_)' ; execute immediate in_timesiov into v_flag; -- execute immediate ç”¨äºæ‰§è¡Œ SQLè¯­å¥ -- in_timesiov æ˜¯æ‹¼æ¥å‡ºæ¥çš„SQLè¯­å¥ -- v_flag æ¥æ”¶è¯­å¥è¿”å›çš„æ•°æ® 2021å¹´11æœˆ15æ—¥è®°å½•ä¸€ä¸ª echarts æŸ±å½¢å›¾çš„å‘ï¼ˆ1ï¼‰æ¸²æŸ“keyçš„æ—¶å€™å¦‚æœæ˜¯æ•´ä¸ªæ•°ç»„è¿‡æ¥ï¼Œå°±ä¼šå˜æˆä¸€å¨ xAxis: { //data: [\"ä¸€èˆ¬\",\"å¥½\",\"éå¸¸å¥½\"] data: dataKeyList }, ï¼ˆ2ï¼‰æ‰€ä»¥è¦ä½¿ç”¨éå†å‡ºæ¥ xAxis: { data: [\"ä¸€èˆ¬\",\"å¥½\",\"éå¸¸å¥½\"] }, 2021å¹´11æœˆ30æ—¥SQL è‡ªå®šä¹‰æ’åº select * from tbl_duty_user decode(u.postType,'1',4,'2',3,'3',2,'4',1) asc oracle å­—æ®µå·²é€—å·éš”å¼€åˆ†è§£ä¸ºå¤šæ¡æ•°æ® https://blog.csdn.net/sofeien/article/details/80534557 No row with the given identifier exists: [com.jh.jcs.business.duty.model.TblDutyDetail#402881e57c7df2e5017c7df8d7c20138] HQLå¤šå°ä¸€è„æ•°æ®é—®é¢˜ 2021å¹´12æœˆ13æ—¥å…³äºSQL æœç´¢æ—¶é—´æ—¥æœŸèŒƒå›´ä¸å¯ç”¨ or String hql2 = \"from KqPunchDaily where punchDate like '%\" + DailyUtil.sameMonth ( )+ \"%' or punchDate like '%\" + DailyUtil.lastMonth ( )+ \"%' and punchStatus !=0 and userId in (\"+idstemp+\") \"; ä»¥ä¸Š3wæ•°æ®è¦ç”¨ beginTime ï¼Œæˆ–è€… &gt;, &lt;é”å®šèŒƒå›´æ—¶é—´ String hql1 = \"from KqLeaveForm where beginTime BETWEEN '\" + DailyUtil.sameMonth ( ) + \"' and '\" + DailyUtil.lastMonth ( ) + \"' and status ='1' and deptId = '\"+deptId+\"' \"; 2021å¹´12æœˆ17æ—¥pl/SQLå®¢æˆ·ç«¯ä¹±ç https://blog.csdn.net/gm371200587/article/details/81381825 2021å¹´12æœˆ17æ—¥oracleåˆå¹¶è¡¨å‡½æ•° Unionï¼šå¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œå¹¶é›†æ“ä½œï¼Œä¸åŒ…æ‹¬é‡å¤è¡Œï¼ŒåŒæ—¶è¿›è¡Œé»˜è®¤è§„åˆ™çš„æ’åºï¼› Union Allï¼šå¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œå¹¶é›†æ“ä½œï¼ŒåŒ…æ‹¬é‡å¤è¡Œï¼Œä¸è¿›è¡Œæ’åºï¼› Intersectï¼šå¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œäº¤é›†æ“ä½œï¼Œä¸åŒ…æ‹¬é‡å¤è¡Œï¼ŒåŒæ—¶è¿›è¡Œé»˜è®¤è§„åˆ™çš„æ’åºï¼› Minusï¼šå¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œå·®æ“ä½œï¼Œä¸åŒ…æ‹¬é‡å¤è¡Œï¼ŒåŒæ—¶è¿›è¡Œé»˜è®¤è§„åˆ™çš„æ’åºã€‚ 2021å¹´12æœˆ20æ—¥å®šåˆ¶æ’åºï¼šè¡¨ï¼Œå­¦ç”Ÿæ ¹æ®æ€§åˆ«æ’åºï¼Œå¦‚æœæ˜¯ç”·çš„æ ¹æ®å¹´é¾„å‡åºï¼Œå¦‚æœæ˜¯å¥³çš„æ ¹æ®ä½“é‡descï¼Œç”·çš„æ’åœ¨å¥³çš„å‰é¢ order by æ€§åˆ«ï¼Œcase when æ€§åˆ«=ç”· then å¹´é¾„ end,case when æ€§åˆ«=å¥³ then ä½“é‡ end desc ###å‚è€ƒåšå®¢https://www.cnblogs.com/sunice/p/10436725.html 2022-08-01dea sql æœªè¿æ¥æ£€æŸ¥ çˆ†çº¢å–æ¶ˆæ ·å¼é…ç½®ï¼šhttps://blog.csdn.net/a907691592/article/details/94724090 idea è‡ªåŠ¨ç”Ÿæˆåºåˆ—å·ï¼šhttps://www.jianshu.com/p/b4807c3efcb6 idea é…ç½® åŒ…æ’åºâ€“ sort by type idea ä¹¦ç­¾æŠ€å·§ï¼šhttps://www.studyweb.cn/detail/java_174180.html oracle å­—ç¬¦ä¸²åˆ†å‰²ï¼šhttps://blog.csdn.net/qq_40230848/article/details/123417714 oracle é•¿å­—ç¬¦ä¸²æ— æ³•æ’å…¥é—®é¢˜ï¼š https://blog.csdn.net/weixin_46266448/article/details/124351040 https://www.ssfiction.com/sqljc/630238.html æ‰§è¡Œæ³¨æ„å† update åé¢åŠ  commit; 2022-08-21ideaè°ƒè¯•å°æŠ€å·§ï¼Œevaluateï¼šhttps://blog.csdn.net/xue_xiaofei/article/details/113197181 2022-11-05ä»Šå¤©åœ¨åšblog é™æ€ç§»æ¤ï¼Œé‡åˆ°ä¸€æ¡linux å‘½ä»¤ï¼ˆåˆ é™¤å­æ–‡ä»¶ï¼Œé™¤äº†æŸä¸ªæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼‰ rm -rf !(static|rmnotstatic.sh) è¿™æ¡ä¼šåˆ é™¤å½“å‰ç›®å½•çš„æ‰€æœ‰ï¼Œé™¤äº†æ‹¬å·ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œè¿è¡Œæ²¡é—®é¢˜ï¼Œä½†æ˜¯æ”¾åˆ° shell è„šæœ¬ä¸­ [root@VM-4-7-centos www]# sh rmnotstatic.sh rmnotstatic.sh: line 2: syntax error near unexpected token `(' rmnotstatic.sh: line 2: `rm -rf !(static|mnotstatic.sh)' è¿™ä¸ªæ„æ€æ˜¯ï¼šæ„å¤–æ ‡è®°â€œï¼ˆâ€é™„è¿‘å‡ºç°è¯­æ³•é”™è¯¯ï¼Œä½†æ˜¯è¯­æ³•æ˜¯æ²¡é”™çš„ï¼ŒçŒœæƒ³åº”è¯¥æ˜¯æ²¡æœ‰è½¬ä¹‰ï¼Œäºæ˜¯æ”¹æˆ #!/bin/bash rm -rf !\\(static\\|rmnotstatic.sh\\) å°±å¯ä»¥ï¼ 2022-11-22tnsnames.ora æ–‡ä»¶è§£æè¯´æ˜ï¼š DB_NAME= (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = IP)(PORT = ç«¯å£å·)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = å®ä¾‹åç§°) ) ) æœ€ç»ˆç­‰äºï¼šip ç«¯å£/å®ä¾‹åç§° å‚è€ƒï¼šhttps://www.cnblogs.com/wml-it/p/15175753.html 2022-11-23mybatis å£°æ˜å®ä½“å­—æ®µæ³¨è§£ç”¨ @tablefield ä¸è¦ç”¨jdkçš„@cloumn 2022-12-20springbooté›†æˆnutzdao :https://www.codenong.com/cs106644689/ nutzæ‰©å±•æ–‡æ¡£ï¼šhttps://www.wenjiangs.com/doc/nutz-dao-create nutzæœ¬åœ°ï¼Œmavenæœ¬åœ°å¼•ç”¨jarï¼šhttp://t.zoukankan.com/iceywu-p-12284695.htmlhttps://blog.csdn.net/weixin_43606226/article/details/124021874 2022-12-21idea sqlè¡¨çˆ†çº¢è§£å†³ï¼šhttps://blog.csdn.net/qq_62497280/article/details/123741808 æ•£è£…çš„ç–‘éš¾æ‚ç—‡1ã€é“¾è·¯Aæ²¡é—®é¢˜ï¼Œé“¾è·¯Cæ²¡é—®é¢˜ï¼Œå®Œæ•´ABCæœ‰é—®é¢˜ï¼Œåœ¨æ²¡æœ‰æ—¥å¿—å¯ä»¥çœ‹çš„æƒ…å†µä¸‹ï¼Œè€ƒè™‘æ˜¯å¦Aå¼‚æ­¥ï¼Œå»¶è¿Ÿï¼Œå¯¼è‡´Cæ‹¿ä¸åˆ°Aé“¾è·¯åº”è¯¥æä¾›ç»™Cçš„æ¶ˆæ¯ï¼ˆå…³äºç¬¬ä¸‰æ–¹äº¤äº’å»¶è¿Ÿä¹Ÿéœ€è¦è€ƒè™‘ï¼Œç‰¹åˆ«æ˜¯é‡åˆ°å¼‚æ­¥çš„æƒ…å†µä¸‹ï¼‰ 2ã€æ–°æ¥å£Aæ…¢ï¼ŒåŸå§‹æ¥å£Aå¿«ï¼Œè€ƒè™‘æ˜¯å¦å“ªé‡Œæœ‰å®šæ—¶åˆ·æ–°ç¼“å­˜äº†ä¸€äº›æ•°æ®","categories":[{"name":"docker","slug":"docker","permalink":"https://mykkto.github.io/categories/docker/"}],"tags":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://mykkto.github.io/tags/%E6%8A%80%E6%9C%AF/"},{"name":"è®°å½•","slug":"è®°å½•","permalink":"https://mykkto.github.io/tags/%E8%AE%B0%E5%BD%95/"}],"author":"mykk"},{"title":"docker æ“ä½œç¯‡","slug":"03-javaåˆ†å¸ƒå¼/02-å®¹å™¨/02_dockerå®æ“ç¯‡","date":"2022-07-05T15:17:13.000Z","updated":"2023-06-11T02:53:45.154Z","comments":true,"path":"posts/abdfa13a.html","link":"","permalink":"https://mykkto.github.io/posts/abdfa13a.html","excerpt":"","text":"â€”â€”â€”â€”â€”â€”â€”â€”â€” Docker éƒ¨ç½²ç¯‡ â€”â€”â€”â€”â€”â€”â€”â€”â€“ã€‡ã€æœ¬ç« æºä»£ç https://gitee.com/TK_LIMR/springcloud2021To2021.git â… ã€DockerFileä¸€ã€æ˜¯ä»€ä¹ˆ1ã€å®˜ç½‘https://docs.docker.com/engine/reference/builder 2ã€æ¦‚è¿°Dockerfileæ˜¯ç”¨æ¥æ„å»ºDockeré•œåƒçš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ˜¯ç”±ä¸€æ¡æ¡æ„å»ºé•œåƒæ‰€éœ€çš„æŒ‡ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ã€‚ 3ã€æ­¥éª¤ ç¼–å†™Dockerfileæ–‡ä»¶ docker buildå‘½ä»¤æ„å»ºé•œåƒ docker runä¾é•œåƒè¿è¡Œå®¹å™¨å®ä¾‹ äºŒã€DockerFileæ„å»ºè¿‡ç¨‹è§£æ1ã€Dockerfileå†…å®¹åŸºç¡€çŸ¥è¯† æ¯æ¡ä¿ç•™å­—æŒ‡ä»¤éƒ½å¿…é¡»ä¸ºå¤§å†™å­—æ¯ä¸”åé¢è¦è·Ÿéšè‡³å°‘ä¸€ä¸ªå‚æ•° æŒ‡ä»¤æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹ï¼Œé¡ºåºæ‰§è¡Œ #è¡¨ç¤ºæ³¨é‡Š æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚å¹¶å¯¹é•œåƒè¿›è¡Œæäº¤ 2ã€Dockeræ‰§è¡ŒDockerfileçš„å¤§è‡´æµç¨‹ dockerä»åŸºç¡€é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨ æ‰§è¡Œä¸€æ¡æŒ‡ä»¤å¹¶å¯¹å®¹å™¨ä½œå‡ºä¿®æ”¹ æ‰§è¡Œç±»ä¼¼docker commitçš„æ“ä½œæäº¤ä¸€ä¸ªæ–°çš„é•œåƒå±‚ dockerå†åŸºäºåˆšæäº¤çš„é•œåƒè¿è¡Œä¸€ä¸ªæ–°å®¹å™¨ æ‰§è¡Œdockerfileä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ç›´åˆ°æ‰€æœ‰æŒ‡ä»¤éƒ½æ‰§è¡Œå®Œæˆ 3ã€å°æ€»ç»“ä»åº”ç”¨è½¯ä»¶çš„è§’åº¦æ¥çœ‹ï¼ŒDockerfileã€Dockeré•œåƒä¸Dockerå®¹å™¨åˆ†åˆ«ä»£è¡¨è½¯ä»¶çš„ä¸‰ä¸ªä¸åŒé˜¶æ®µï¼Œ Dockerfileæ˜¯è½¯ä»¶çš„åŸææ–™ Dockeré•œåƒæ˜¯è½¯ä»¶çš„äº¤ä»˜å“ Dockerå®¹å™¨åˆ™å¯ä»¥è®¤ä¸ºæ˜¯è½¯ä»¶é•œåƒçš„è¿è¡Œæ€ï¼Œä¹Ÿå³ä¾ç…§é•œåƒè¿è¡Œçš„å®¹å™¨å®ä¾‹ Dockerfileé¢å‘å¼€å‘ï¼ŒDockeré•œåƒæˆä¸ºäº¤ä»˜æ ‡å‡†ï¼ŒDockerå®¹å™¨åˆ™æ¶‰åŠéƒ¨ç½²ä¸è¿ç»´ï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ï¼ŒåˆåŠ›å……å½“Dockerä½“ç³»çš„åŸºçŸ³ã€‚ Dockerfileï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªDockerfileï¼ŒDockerfileå®šä¹‰äº†è¿›ç¨‹éœ€è¦çš„ä¸€åˆ‡ä¸œè¥¿ã€‚Dockerfileæ¶‰åŠçš„å†…å®¹åŒ…æ‹¬æ‰§è¡Œä»£ç æˆ–è€…æ˜¯æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€ä¾èµ–åŒ…ã€è¿è¡Œæ—¶ç¯å¢ƒã€åŠ¨æ€é“¾æ¥åº“ã€æ“ä½œç³»ç»Ÿçš„å‘è¡Œç‰ˆã€æœåŠ¡è¿›ç¨‹å’Œå†…æ ¸è¿›ç¨‹(å½“åº”ç”¨è¿›ç¨‹éœ€è¦å’Œç³»ç»ŸæœåŠ¡å’Œå†…æ ¸è¿›ç¨‹æ‰“äº¤é“ï¼Œè¿™æ—¶éœ€è¦è€ƒè™‘å¦‚ä½•è®¾è®¡namespaceçš„æƒé™æ§åˆ¶)ç­‰ç­‰; Dockeré•œåƒï¼Œåœ¨ç”¨Dockerfileå®šä¹‰ä¸€ä¸ªæ–‡ä»¶ä¹‹åï¼Œdocker buildæ—¶ä¼šäº§ç”Ÿä¸€ä¸ªDockeré•œåƒï¼Œå½“è¿è¡Œ Dockeré•œåƒæ—¶ä¼šçœŸæ­£å¼€å§‹æä¾›æœåŠ¡; Dockerå®¹å™¨ï¼Œå®¹å™¨æ˜¯ç›´æ¥æä¾›æœåŠ¡çš„ã€‚ ä¸‰ã€DockerFileå¸¸ç”¨ä¿ç•™å­—æŒ‡ä»¤ FROMï¼šåŸºç¡€é•œåƒï¼Œå½“å‰æ–°é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„ï¼ŒæŒ‡å®šä¸€ä¸ªå·²ç»å­˜åœ¨çš„é•œåƒä½œä¸ºæ¨¡æ¿ï¼Œç¬¬ä¸€æ¡å¿…é¡»æ˜¯from MAINTAINERï¼šé•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€ RUNï¼šå®¹å™¨æ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤ï¼ŒRUNæ˜¯åœ¨ docker buildæ—¶è¿è¡Œ shellæ ¼å¼ï¼šRUN yum -y install vim execæ ¼å¼ï¼š EXPOSEï¼šå½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£ WORKDIRï¼šæŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»é™†çš„è¿›æ¥å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹ USERï¼šæŒ‡å®šè¯¥é•œåƒä»¥ä»€ä¹ˆæ ·çš„ç”¨æˆ·å»æ‰§è¡Œï¼Œå¦‚æœéƒ½ä¸æŒ‡å®šï¼Œé»˜è®¤æ˜¯root ENVï¼šç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ ENV MY_PATH /usr/mytest è¿™ä¸ªç¯å¢ƒå˜é‡å¯ä»¥åœ¨åç»­çš„ä»»ä½•RUNæŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œè¿™å°±å¦‚åŒåœ¨å‘½ä»¤å‰é¢æŒ‡å®šäº†ç¯å¢ƒå˜é‡å‰ç¼€ä¸€æ ·ï¼›ä¹Ÿå¯ä»¥åœ¨å…¶å®ƒæŒ‡ä»¤ä¸­ç›´æ¥ä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡ æ¯”å¦‚ï¼šWORKDIR $MY_PATH ADDï¼šå°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹tarå‹ç¼©åŒ… COPYï¼šç±»ä¼¼ADDï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­ã€‚å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ &lt;æºè·¯å¾„&gt; çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„ &lt;ç›®æ ‡è·¯å¾„&gt; ä½ç½® COPY src dest COPY [â€œsrcâ€, â€œdestâ€] &lt;srcæºè·¯å¾„&gt;ï¼šæºæ–‡ä»¶æˆ–è€…æºç›®å½• &lt;destç›®æ ‡è·¯å¾„&gt;ï¼šå®¹å™¨å†…çš„æŒ‡å®šè·¯å¾„ï¼Œè¯¥è·¯å¾„ä¸ç”¨äº‹å…ˆå»ºå¥½ï¼Œè·¯å¾„ä¸å­˜åœ¨çš„è¯ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚ VOLUMEï¼šå®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œ CMDï¼šæŒ‡å®šå®¹å™¨å¯åŠ¨åçš„è¦å¹²çš„äº‹æƒ… æ³¨æ„ï¼š Dockerfile ä¸­å¯ä»¥æœ‰å¤šä¸ª CMD æŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMD ä¼šè¢« docker run ä¹‹åçš„å‚æ•°æ›¿æ¢ å®ƒå’Œå‰é¢RUNå‘½ä»¤çš„åŒºåˆ« CMDæ˜¯åœ¨docker run æ—¶è¿è¡Œã€‚ RUNæ˜¯åœ¨ docker buildæ—¶è¿è¡Œã€‚ ENTRYPOINTï¼šä¹Ÿæ˜¯ç”¨æ¥æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ ç±»ä¼¼äº CMD æŒ‡ä»¤ï¼Œä½†æ˜¯ENTRYPOINTä¸ä¼šè¢«docker runåé¢çš„å‘½ä»¤è¦†ç›–ï¼Œè€Œä¸”è¿™äº›å‘½ä»¤è¡Œå‚æ•°ä¼šè¢«å½“ä½œå‚æ•°é€ç»™ ENTRYPOINT æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åº å°æ€»ç»“ å››ã€æ¡ˆä¾‹1ã€è‡ªå®šä¹‰é•œåƒmyCentosJava81ã€è¦æ±‚Centos7é•œåƒå…·å¤‡vim+ifconfig+jdk8 å‡†å¤‡ï¼šJDK8ä¸‹è½½ä½ç½® https://mirrors.yangxingzhen.com/jdk/ 2ã€ç¼–å†™FROM centos:7 MAINTAINER jack&lt;mykkto.cn&gt; ENV MYPATH /usr/local WORKDIR $MYPATH #å®‰è£…vimç¼–è¾‘å™¨ RUN yum -y install vim #å®‰è£…ifconfigå‘½ä»¤æŸ¥çœ‹ç½‘ç»œIP RUN yum -y install net-tools #å®‰è£…java8åŠlibåº“ RUN yum -y install glibc.i686 RUN mkdir /usr/local/java #ADD æ˜¯ç›¸å¯¹è·¯å¾„jar,æŠŠjdk-8u171-linux-x64.tar.gzæ·»åŠ åˆ°å®¹å™¨ä¸­,å®‰è£…åŒ…å¿…é¡»è¦å’ŒDockerfileæ–‡ä»¶åœ¨åŒä¸€ä½ç½® ADD jdk-8u171-linux-x64.tar.gz /usr/local/java/ #é…ç½®javaç¯å¢ƒå˜é‡ ENV JAVA_HOME /usr/local/java/jdk1.8.0_171 ENV JRE_HOME $JAVA_HOME/jre ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH ENV PATH $JAVA_HOME/bin:$PATH EXPOSE 80 CMD echo $MYPATH CMD echo \"success--------------ok\" CMD /bin/bash 3ã€æ„å»ºdocker build -t æ–°é•œåƒåå­—:TAG docker build -t centosjava8:1.5 . æ³¨æ„ï¼šä¸Šé¢TAGåé¢æœ‰ä¸ªç©ºæ ¼ï¼Œæœ‰ä¸ªç‚¹ å‘½ä»¤ï¼š æˆåŠŸï¼š 4ã€è¿è¡Œdocker run -it æ–°é•œåƒåå­—:TAG docker run -it centosjava8:1.5 /bin/bash 5ã€æ€»ç»“UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼šUnionæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹(unite several directories into a single virtual filesystem)ã€‚Union æ–‡ä»¶ç³»ç»Ÿæ˜¯ Docker é•œåƒçš„åŸºç¡€ã€‚é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿ï¼ŒåŸºäºåŸºç¡€é•œåƒï¼ˆæ²¡æœ‰çˆ¶é•œåƒï¼‰ï¼Œå¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒã€‚ ç‰¹æ€§ï¼šä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½• 2ã€è™šæ‚¬é•œåƒ1ã€æ˜¯ä»€ä¹ˆä»“åº“åã€æ ‡ç­¾éƒ½æ˜¯çš„é•œåƒï¼Œä¿—ç§°dangling image å†™ä¸€ä¸ª 2ã€æŸ¥çœ‹docker image ls -f dangling=true 3ã€åˆ é™¤docker image prune è™šæ‚¬é•œåƒå·²ç»å¤±å»å­˜åœ¨ä»·å€¼ï¼Œå¯ä»¥åˆ  äº”ã€æ€»ç»“ â…¡ã€Docker ç½‘ç»œä¸€ã€æ˜¯ä»€ä¹ˆ1ã€é»˜è®¤dockerä¸å¯åŠ¨ï¼Œé»˜è®¤ç½‘ç»œæƒ…å†µ 2ã€å¯åŠ¨dockerå¯åŠ¨åï¼Œç½‘ç»œæƒ…å†µ äºŒã€å‘½ä»¤1ã€Allå‘½ä»¤ 2ã€ä¸»æŸ¥çœ‹ç½‘ç»œdocker network ls 3ã€æŸ¥çœ‹ç½‘ç»œæºæ•°æ®docker network inspect XXXç½‘ç»œåå­— 4ã€åˆ é™¤ç½‘ç»œdocker network rm XXXç½‘ç»œåå­— 5ã€æ¡ˆä¾‹ ä¸‰ã€èƒ½å¹²å˜› å®¹å™¨é—´çš„äº’è”å’Œé€šä¿¡ä»¥åŠç«¯å£æ˜ å°„ å®¹å™¨IPå˜åŠ¨æ—¶å€™å¯ä»¥é€šè¿‡æœåŠ¡åç›´æ¥ç½‘ç»œé€šä¿¡è€Œä¸å—åˆ°å½±å“ å››ã€ç½‘ç»œæ¨¡å¼1ã€åˆ—è¡¨1ã€æ˜¯ä»€ä¹ˆ bridgeæ¨¡å¼ï¼šä½¿ç”¨â€“network bridgeæŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨docker0 hostæ¨¡å¼ï¼šä½¿ç”¨â€“network hostæŒ‡å®š noneæ¨¡å¼ï¼šä½¿ç”¨â€“network noneæŒ‡å®š containeræ¨¡å¼ï¼šä½¿ç”¨â€“network container:NAMEæˆ–è€…å®¹å™¨IDæŒ‡å®š 2ã€è§„åˆ™dockerå®¹å™¨å†…éƒ¨çš„ipæ˜¯æœ‰å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜çš„ è¯´æ˜ 1ã€å¯åŠ¨ä¸¤ä¸ªå®¹å™¨è¯´æ˜ 2ã€docker inspect å®¹å™¨ID or å®¹å™¨åå­— 3ã€æ¡ˆä¾‹ï¼š3-1ã€bridge1ã€æ˜¯ä»€ä¹ˆDocker æœåŠ¡é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª docker0 ç½‘æ¡¥ï¼ˆå…¶ä¸Šæœ‰ä¸€ä¸ª docker0 å†…éƒ¨æ¥å£ï¼‰ï¼Œè¯¥æ¡¥æ¥ç½‘ç»œçš„åç§°ä¸ºdocker0ï¼Œå®ƒåœ¨å†…æ ¸å±‚è¿é€šäº†å…¶ä»–çš„ç‰©ç†æˆ–è™šæ‹Ÿç½‘å¡ï¼Œè¿™å°±å°†æ‰€æœ‰å®¹å™¨å’Œæœ¬åœ°ä¸»æœºéƒ½æ”¾åˆ°åŒä¸€ä¸ªç‰©ç†ç½‘ç»œã€‚Docker é»˜è®¤æŒ‡å®šäº† docker0 æ¥å£ çš„ IP åœ°å€å’Œå­ç½‘æ©ç ï¼Œè®©ä¸»æœºå’Œå®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ç½‘æ¡¥ç›¸äº’é€šä¿¡ã€‚ #æŸ¥çœ‹ bridge ç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ grep è·å–åç§°é¡¹ docker network inspect bridge | grep name ifconfig | grep docker 2ã€æ¡ˆä¾‹(1ï¼‰è¯´æ˜ï¼š Dockerä½¿ç”¨Linuxæ¡¥æ¥ï¼Œåœ¨å®¿ä¸»æœºè™šæ‹Ÿä¸€ä¸ªDockerå®¹å™¨ç½‘æ¡¥(docker0)ï¼ŒDockerå¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶ä¼šæ ¹æ®Dockerç½‘æ¡¥çš„ç½‘æ®µåˆ†é…ç»™å®¹å™¨ä¸€ä¸ªIPåœ°å€ï¼Œç§°ä¸ºContainer-IPï¼ŒåŒæ—¶Dockerç½‘æ¡¥æ˜¯æ¯ä¸ªå®¹å™¨çš„é»˜è®¤ç½‘å…³ã€‚å› ä¸ºåœ¨åŒä¸€å®¿ä¸»æœºå†…çš„å®¹å™¨éƒ½æ¥å…¥åŒä¸€ä¸ªç½‘æ¡¥ï¼Œè¿™æ ·å®¹å™¨ä¹‹é—´å°±èƒ½å¤Ÿé€šè¿‡å®¹å™¨çš„Container-IPç›´æ¥é€šä¿¡ã€‚ docker run çš„æ—¶å€™ï¼Œæ²¡æœ‰æŒ‡å®šnetworkçš„è¯é»˜è®¤ä½¿ç”¨çš„ç½‘æ¡¥æ¨¡å¼å°±æ˜¯bridgeï¼Œä½¿ç”¨çš„å°±æ˜¯docker0ã€‚åœ¨å®¿ä¸»æœºifconfig,å°±å¯ä»¥çœ‹åˆ°docker0å’Œè‡ªå·±createçš„network(åé¢è®²)eth0ï¼Œeth1ï¼Œeth2â€¦â€¦ä»£è¡¨ç½‘å¡ä¸€ï¼Œç½‘å¡äºŒï¼Œç½‘å¡ä¸‰â€¦â€¦ï¼Œloä»£è¡¨127.0.0.1ï¼Œå³localhostï¼Œinet addrç”¨æ¥è¡¨ç¤ºç½‘å¡çš„IPåœ°å€ ç½‘æ¡¥docker0åˆ›å»ºä¸€å¯¹å¯¹ç­‰è™šæ‹Ÿè®¾å¤‡æ¥å£ä¸€ä¸ªå«vethï¼Œå¦ä¸€ä¸ªå«eth0ï¼Œæˆå¯¹åŒ¹é…ã€‚ 3.1 æ•´ä¸ªå®¿ä¸»æœºçš„ç½‘æ¡¥æ¨¡å¼éƒ½æ˜¯docker0ï¼Œç±»ä¼¼ä¸€ä¸ªäº¤æ¢æœºæœ‰ä¸€å †æ¥å£ï¼Œæ¯ä¸ªæ¥å£å«vethï¼Œåœ¨æœ¬åœ°ä¸»æœºå’Œå®¹å™¨å†…åˆ†åˆ«åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ¥å£ï¼Œå¹¶è®©ä»–ä»¬å½¼æ­¤è”é€šï¼ˆè¿™æ ·ä¸€å¯¹æ¥å£å«veth pairï¼‰ï¼› 3.2 æ¯ä¸ªå®¹å™¨å®ä¾‹å†…éƒ¨ä¹Ÿæœ‰ä¸€å—ç½‘å¡ï¼Œæ¯ä¸ªæ¥å£å«eth0ï¼› 3.3 docker0ä¸Šé¢çš„æ¯ä¸ªvethåŒ¹é…æŸä¸ªå®¹å™¨å®ä¾‹å†…éƒ¨çš„eth0ï¼Œä¸¤ä¸¤é…å¯¹ï¼Œä¸€ä¸€åŒ¹é…ã€‚ é€šè¿‡ä¸Šè¿°ï¼Œå°†å®¿ä¸»æœºä¸Šçš„æ‰€æœ‰å®¹å™¨éƒ½è¿æ¥åˆ°è¿™ä¸ªå†…éƒ¨ç½‘ç»œä¸Šï¼Œä¸¤ä¸ªå®¹å™¨åœ¨åŒä¸€ä¸ªç½‘ç»œä¸‹,ä¼šä»è¿™ä¸ªç½‘å…³ä¸‹å„è‡ªæ‹¿åˆ°åˆ†é…çš„ipï¼Œæ­¤æ—¶ä¸¤ä¸ªå®¹å™¨çš„ç½‘ç»œæ˜¯äº’é€šçš„ã€‚ (2ï¼‰å‘½ä»¤ï¼š docker run -d -p 8081:8080 --name tomcat81 billygoo/tomcat8-jdk8 docker run -d -p 8082:8080 --name tomcat82 billygoo/tomcat8-jdk8 (3ï¼‰éªŒè¯ï¼š [root@VM-0-13-centos ~]# ip addr| tail -n 8 3-2ã€1ã€æ˜¯ä»€ä¹ˆç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ IP åœ°å€ä¸å¤–ç•Œè¿›è¡Œé€šä¿¡ï¼Œä¸å†éœ€è¦é¢å¤–è¿›è¡ŒNAT è½¬æ¢ã€‚ 2ã€æ¡ˆä¾‹(1)è¯´æ˜ å®¹å™¨å°†ä¸ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„Network Namespaceï¼Œ è€Œæ˜¯å’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ªNetwork Namespaceã€‚å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡è€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£ã€‚ ï¼ˆ2ï¼‰å‘½ä»¤ docker run -d --network host --name tomcat83 billygoo/tomcat8-jdk8 (3)æ— ä¹‹å‰çš„é…å¯¹æ˜¾ç¤ºäº†ï¼Œçœ‹å®¹å™¨å®ä¾‹å†…éƒ¨ (4)æ²¡æœ‰è®¾ç½®-pçš„ç«¯å£æ˜ å°„äº†ï¼Œå¦‚ä½•è®¿é—®å¯åŠ¨çš„tomcat83 ? å°±æ˜¯é»˜è®¤ç«¯å£ï¼Œhttp://å®¿ä¸»æœºIP:8080/ æ¯”å¦‚ï¼štomcat æ˜¯ 8080ï¼Œnginx æ˜¯ 80 ï¼Œmysql æ˜¯3306 3-3ã€none1ã€æ˜¯ä»€ä¹ˆç¦ç”¨ç½‘ç»œåŠŸèƒ½ï¼Œåªæœ‰loæ ‡è¯†(å°±æ˜¯127.0.0.1è¡¨ç¤ºæœ¬åœ°å›ç¯) 2ã€æ¡ˆä¾‹docker run -d -p 8084:8080 --network none --name tomcat84 billygoo/tomcat8-jdk8 3-4ã€container1ã€æ˜¯ä»€ä¹ˆæ–°å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªç½‘ç»œipé…ç½®è€Œä¸æ˜¯å’Œå®¿ä¸»æœºå…±äº«ã€‚æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„IPï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº«IPã€ç«¯å£èŒƒå›´ç­‰ã€‚åŒæ ·ï¼Œä¸¤ä¸ªå®¹å™¨é™¤äº†ç½‘ç»œæ–¹é¢ï¼Œå…¶ä»–çš„å¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯éš”ç¦»çš„ã€‚ 2ã€æ¡ˆä¾‹Alpine Linux æ˜¯ä¸€æ¬¾ç‹¬ç«‹çš„ã€éå•†ä¸šçš„é€šç”¨ Linux å‘è¡Œç‰ˆï¼Œä¸“ä¸ºè¿½æ±‚å®‰å…¨æ€§ã€ç®€å•æ€§å’Œèµ„æºæ•ˆç‡çš„ç”¨æˆ·è€Œè®¾è®¡ã€‚ å¯èƒ½å¾ˆå¤šäººæ²¡å¬è¯´è¿‡è¿™ä¸ª Linux å‘è¡Œç‰ˆæœ¬ï¼Œä½†æ˜¯ç»å¸¸ç”¨ Docker çš„æœ‹å‹å¯èƒ½éƒ½ç”¨è¿‡ï¼Œå› ä¸ºä»–å°ï¼Œç®€å•ï¼Œå®‰å…¨è€Œè‘—ç§°ï¼Œæ‰€ä»¥ä½œä¸ºåŸºç¡€é•œåƒæ˜¯éå¸¸å¥½çš„ä¸€ä¸ªé€‰æ‹©ï¼Œå¯è°“æ˜¯éº»é›€è™½å°ä½†äº”è„ä¿±å…¨ï¼Œé•œåƒéå¸¸å°å·§ï¼Œä¸åˆ° 6Mçš„å¤§å°ï¼Œæ‰€ä»¥ç‰¹åˆ«é€‚åˆå®¹å™¨æ‰“åŒ…ã€‚ docker run -it -d --name alpine1 alpine /bin/sh docker run -it -d --network container:alpine1 --name alpine2 alpine /bin/sh å…³é—­alpine1ï¼Œå†çœ‹çœ‹alpine2 3-5ã€â˜… è‡ªå®šä¹‰ç½‘ç»œ1ã€æ˜¯ä»€ä¹ˆå­—é¢æ„æ€ï¼Œè‡ªå®šä¹‰çš„ç½‘ç»œ 2ã€æ¡ˆä¾‹ä¸€ç±»ï¼šbefore docker run -d -p 8081:8080 --name tomcat81 billygoo/tomcat8-jdk8 docker run -d -p 8082:8080 --name tomcat82 billygoo/tomcat8-jdk8 ä¸Šè¿°æˆåŠŸå¯åŠ¨å¹¶ç”¨docker execè¿›å…¥å„è‡ªå®¹å™¨å®ä¾‹å†…éƒ¨ å­˜åœ¨çš„é—®é¢˜ï¼šå¯ä»¥æŒ‰ç…§IP ping é€šï¼Œä½†æ˜¯æ— æ³•ç”¨æœåŠ¡å ping é€š äºŒç±»ï¼šafter 1ã€æ–°å»ºæ¡¥æ¥ç½‘ç»œ docker network create jack_network 2ã€æ–°å»ºå®¹å™¨åŠ å…¥ä¸Šä¸€æ­¥æ–°å»ºçš„è‡ªå®šä¹‰ç½‘ç»œ docker run -d -p 8081:8080 --network jack_network --name tomcat81 billygoo/tomcat8-jdk8 docker run -d -p 8082:8080 --network jack_network --name tomcat82 billygoo/tomcat8-jdk8 3ã€æµ‹è¯•äº’ ping 4ã€ç»“è®º è‡ªå®šä¹‰ç½‘ç»œæœ¬èº«å°±ç»´æŠ¤å¥½äº†ä¸»æœºåå’Œipçš„å¯¹åº”å…³ç³»ï¼ˆipå’ŒåŸŸåéƒ½èƒ½é€šï¼‰ äº”ã€Dockeræ¶æ„å›¾è§£ä»å…¶æ¶æ„å’Œè¿è¡Œæµç¨‹æ¥çœ‹ï¼ŒDocker æ˜¯ä¸€ä¸ª C/S æ¨¡å¼çš„æ¶æ„ï¼Œåç«¯æ˜¯ä¸€ä¸ªæ¾è€¦åˆæ¶æ„ï¼Œä¼—å¤šæ¨¡å—å„å¸å…¶èŒã€‚ Docker è¿è¡Œçš„åŸºæœ¬æµç¨‹ä¸ºï¼š 1 ç”¨æˆ·æ˜¯ä½¿ç”¨ Docker Client ä¸ Docker Daemon å»ºç«‹é€šä¿¡ï¼Œå¹¶å‘é€è¯·æ±‚ç»™åè€…ã€‚2 Docker Daemon ä½œä¸º Docker æ¶æ„ä¸­çš„ä¸»ä½“éƒ¨åˆ†ï¼Œé¦–å…ˆæä¾› Docker Server çš„åŠŸèƒ½ä½¿å…¶å¯ä»¥æ¥å— Docker Client çš„è¯·æ±‚ã€‚3 Docker Engine æ‰§è¡Œ Docker å†…éƒ¨çš„ä¸€ç³»åˆ—å·¥ä½œï¼Œæ¯ä¸€é¡¹å·¥ä½œéƒ½æ˜¯ä»¥ä¸€ä¸ª Job çš„å½¢å¼çš„å­˜åœ¨ã€‚4 Job çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦å®¹å™¨é•œåƒæ—¶ï¼Œåˆ™ä» Docker Registry ä¸­ä¸‹è½½é•œåƒï¼Œå¹¶é€šè¿‡é•œåƒç®¡ç†é©±åŠ¨ Graph driverå°†ä¸‹è½½é•œåƒä»¥Graphçš„å½¢å¼å­˜å‚¨ã€‚5 å½“éœ€è¦ä¸º Docker åˆ›å»ºç½‘ç»œç¯å¢ƒæ—¶ï¼Œé€šè¿‡ç½‘ç»œç®¡ç†é©±åŠ¨ Network driver åˆ›å»ºå¹¶é…ç½® Docker å®¹å™¨ç½‘ç»œç¯å¢ƒã€‚6 å½“éœ€è¦é™åˆ¶ Docker å®¹å™¨è¿è¡Œèµ„æºæˆ–æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤ç­‰æ“ä½œæ—¶ï¼Œåˆ™é€šè¿‡ Execdriver æ¥å®Œæˆã€‚7 Libcontaineræ˜¯ä¸€é¡¹ç‹¬ç«‹çš„å®¹å™¨ç®¡ç†åŒ…ï¼ŒNetwork driverä»¥åŠExec driveréƒ½æ˜¯é€šè¿‡Libcontaineræ¥å®ç°å…·ä½“å¯¹å®¹å™¨è¿›è¡Œçš„æ“ä½œã€‚ â…¢ã€Dockerå¾®æœåŠ¡å®æˆ˜ä¸€ã€åˆ›å»ºä¸€ä¸ªæ™®é€šæ¨¡å—1ã€å»ºmodeldocker_boot 2ã€æ”¹pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.5.6&lt;/version&gt; &lt;relativePath/&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;docker_boot&lt;/artifactId&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;junit.version&gt;4.12&lt;/junit.version&gt; &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt; &lt;lombok.version&gt;1.16.18&lt;/lombok.version&gt; &lt;mysql.version&gt;5.1.47&lt;/mysql.version&gt; &lt;druid.version&gt;1.1.16&lt;/druid.version&gt; &lt;mapper.version&gt;4.1.5&lt;/mapper.version&gt; &lt;mybatis.spring.boot.version&gt;1.3.0&lt;/mybatis.spring.boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!--SpringBooté€šç”¨ä¾èµ–æ¨¡å—--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--test--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;!-- &lt;build &gt; ä¸»è¦ç”¨äºç¼–è¯‘è®¾ç½® --&gt; &lt;build&gt; &lt;!-- å®šä¹‰æ‰“åŒ…æˆjarçš„åå­— --&gt; &lt;!-- è¿™é‡Œå¦‚æœä¸å®šä¹‰ , æ‰“åŒ…æˆçš„jaråå­—æ ¼å¼ä¸º : &lt;artifactId&gt; + &lt;version&gt; --&gt; &lt;finalName&gt;docker_jar&lt;/finalName&gt; &lt;plugins&gt; &lt;!--SpringBoot mavenæ’ä»¶--&gt; &lt;!-- å¯ä»¥å°†åº”ç”¨æ‰“æˆä¸€ä¸ªå¯æ‰§è¡Œçš„jaråŒ… --&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;!-- è®¾ç½®å¯åŠ¨å…¥å£ --&gt; &lt;!-- manClasså³ä½¿ä¸é…ç½® , SprinBootä¹Ÿåœ¨æ‰“åŒ…çš„æ—¶å€™ä¹Ÿæ¸…æ¥šå…¥å£æ˜¯å“ªä¸ª , å…¶å®ä¸ç”¨é…ç½® --&gt; &lt;configuration&gt; &lt;mainClass&gt;com.kk.DockerBootApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 3ã€å†™ymlserver: port: 6001 4ã€ä¸»å¯åŠ¨package com.kk; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class DockerBootApplication { public static void main(String[] args) { SpringApplication.run (DockerBootApplication.class, args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RequestMethod; import org.springframework.web.bind.annotation.RestController; import java.util.UUID; @RestController public class OrderController { @Value(\"${server.port}\") private String port; @RequestMapping(\"/order/docker\") public String helloDocker() { return \"hello docker\" + \"\\t\" + port + \"\\t\" + UUID.randomUUID ( ).toString ( ); } @RequestMapping(value = \"/order/index\", method = RequestMethod.GET) public String index() { return \"æœåŠ¡ç«¯å£å·: \" + \"\\t\" + port + \"\\t\" + UUID.randomUUID ( ).toString ( ); } } äºŒã€æ‰“ jar + dockerfile1ã€æ‰“åŒ… 2ã€ç¼–å†™Dockerfile# åŸºç¡€é•œåƒä½¿ç”¨java FROM java:8 # ä½œè€… MAINTAINER jack # VOLUME æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸º/tmpï¼Œåœ¨ä¸»æœº/var/lib/dockerç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶é“¾æ¥åˆ°å®¹å™¨çš„/tmp VOLUME /tmp # å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸º jack_docker.jar ADD docker_jar.jar jack_docker.jar # è¿è¡ŒjaråŒ… RUN bash -c 'touch /jack_docker.jar' ENTRYPOINT [\"java\",\"-jar\",\"/jack_docker.jar\"] #æš´éœ²6001ç«¯å£ä½œä¸ºå¾®æœåŠ¡ EXPOSE 6001 3ã€æ„å»ºé•œåƒdocker build -t jack_docker:1.6 . 4ã€è¿è¡Œå®¹å™¨docker run -d -p 6001:6001 jack_docker:1.6 5ã€è®¿é—®æµ‹è¯• â…£ã€Docker-composeå®¹å™¨ç¼–æ’ä¸€ã€æ¦‚è¿°1ã€æ˜¯ä»€ä¹ˆDocker-Composeæ˜¯Dockerå®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œå¿«é€Ÿæ„å»ºå¤šä¸ªå®¹å™¨ï¼Œè´Ÿè´£å®ç°å¯¹Dockerå®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚ 2ã€å®‰è£…1ã€ä¸‹è½½ï¼šå¿«é€Ÿå›½å†…é•œåƒ sudo curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose 2ã€å®‰è£… sudo chmod +x /usr/local/bin/docker-compose 3ã€æµ‹è¯• docker-compose --version 3ã€æ ¸å¿ƒ1ã€æ–‡ä»¶ docker-compose.yml 2ã€æœåŠ¡ï¼ˆserviceï¼‰ ä¸€ä¸ªä¸ªåº”ç”¨å®¹å™¨å®ä¾‹ï¼Œæ¯”å¦‚è®¢å•å¾®æœåŠ¡ã€åº“å­˜å¾®æœåŠ¡ã€mysqlå®¹å™¨ã€nginxå®¹å™¨æˆ–è€…rediså®¹å™¨ 3ã€å·¥ç¨‹ï¼ˆprojectï¼‰ ç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ docker-compose.yml æ–‡ä»¶ä¸­å®šä¹‰ã€‚ äºŒã€æ­¥éª¤ ç¼–å†™Dockerfileå®šä¹‰å„ä¸ªå¾®æœåŠ¡åº”ç”¨å¹¶æ„å»ºå‡ºå¯¹åº”çš„é•œåƒæ–‡ä»¶ ä½¿ç”¨ docker-compose.yml å®šä¹‰ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œå®‰æ’å¥½æ•´ä½“åº”ç”¨ä¸­çš„å„ä¸ªå®¹å™¨æœåŠ¡ã€‚ æœ€åï¼Œæ‰§è¡Œdocker-compose upå‘½ä»¤ æ¥å¯åŠ¨å¹¶è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œå®Œæˆä¸€é”®éƒ¨ç½²ä¸Šçº¿ ä¸‰ã€å‘½ä»¤ Composeå¸¸ç”¨å‘½ä»¤docker-compose -h # æŸ¥çœ‹å¸®åŠ©docker-compose up # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡docker-compose up -d # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡å¹¶åå°è¿è¡Œdocker-compose down # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€ç½‘ç»œã€å·ã€é•œåƒã€‚docker-compose exec ymlé‡Œé¢çš„æœåŠ¡id # è¿›å…¥å®¹å™¨å®ä¾‹å†…éƒ¨ docker-compose exec docker-compose.ymlæ–‡ä»¶ä¸­å†™çš„æœåŠ¡id /bin/bashdocker-compose ps # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨docker-compose top # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„å®¹å™¨è¿›ç¨‹docker-compose logs ymlé‡Œé¢çš„æœåŠ¡id # æŸ¥çœ‹å®¹å™¨è¾“å‡ºæ—¥å¿—docker-compose config # æ£€æŸ¥é…ç½®docker-compose config -q # æ£€æŸ¥é…ç½®ï¼Œæœ‰é—®é¢˜æ‰æœ‰è¾“å‡ºdocker-compose restart # é‡å¯æœåŠ¡docker-compose start # å¯åŠ¨æœåŠ¡docker-compose stop # åœæ­¢æœåŠ¡ å››ã€æ¡ˆä¾‹1ã€æ”¹é€ å¾®æœåŠ¡1ã€å»ºè¡¨ CREATE TABLE `t_user` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `username` varchar(50) NOT NULL DEFAULT '' COMMENT 'ç”¨æˆ·å', `password` varchar(50) NOT NULL DEFAULT '' COMMENT 'å¯†ç ', `sex` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'æ€§åˆ« 0=å¥³ 1=ç”· ', `deleted` tinyint(4) unsigned NOT NULL DEFAULT '0' COMMENT 'åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤', `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´', `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´', PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='ç”¨æˆ·è¡¨' 2ã€æ”¹pom &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.5.6&lt;/version&gt; &lt;relativePath/&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;docker_boot&lt;/artifactId&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;junit.version&gt;4.12&lt;/junit.version&gt; &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt; &lt;lombok.version&gt;1.16.18&lt;/lombok.version&gt; &lt;mysql.version&gt;5.1.47&lt;/mysql.version&gt; &lt;druid.version&gt;1.1.16&lt;/druid.version&gt; &lt;mapper.version&gt;4.1.5&lt;/mapper.version&gt; &lt;mybatis.spring.boot.version&gt;1.3.0&lt;/mybatis.spring.boot.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!--guava Google å¼€æºçš„ Guava ä¸­è‡ªå¸¦çš„å¸ƒéš†è¿‡æ»¤å™¨--&gt; &lt;dependency&gt; &lt;groupId&gt;com.google.guava&lt;/groupId&gt; &lt;artifactId&gt;guava&lt;/artifactId&gt; &lt;version&gt;23.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- redisson --&gt; &lt;dependency&gt; &lt;groupId&gt;org.redisson&lt;/groupId&gt; &lt;artifactId&gt;redisson&lt;/artifactId&gt; &lt;version&gt;3.13.4&lt;/version&gt; &lt;/dependency&gt; &lt;!--SpringBooté€šç”¨ä¾èµ–æ¨¡å—--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--swagger2--&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; &lt;/dependency&gt; &lt;!--SpringBootä¸Redisæ•´åˆä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--springCache--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--springCacheè¿æ¥æ± ä¾èµ–åŒ…--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- jedis --&gt; &lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;/dependency&gt; &lt;!--Mysqlæ•°æ®åº“é©±åŠ¨--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;/dependency&gt; &lt;!--SpringBooté›†æˆdruidè¿æ¥æ± --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;${druid.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--mybatiså’Œspringbootæ•´åˆ--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${mybatis.spring.boot.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- æ·»åŠ springbootå¯¹amqpçš„æ”¯æŒ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;commons-codec&lt;/groupId&gt; &lt;artifactId&gt;commons-codec&lt;/artifactId&gt; &lt;version&gt;1.10&lt;/version&gt; &lt;/dependency&gt; &lt;!--é€šç”¨åŸºç¡€é…ç½®junit/devtools/test/log4j/lombok/hutool--&gt; &lt;!--hutool--&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;5.2.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;${junit.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;${log4j.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;${lombok.version}&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!--persistence--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.persistence&lt;/groupId&gt; &lt;artifactId&gt;persistence-api&lt;/artifactId&gt; &lt;version&gt;1.0.2&lt;/version&gt; &lt;/dependency&gt; &lt;!--é€šç”¨Mapper--&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper&lt;/artifactId&gt; &lt;version&gt;${mapper.version}&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;!-- &lt;build &gt; ä¸»è¦ç”¨äºç¼–è¯‘è®¾ç½® --&gt; &lt;build&gt; &lt;!-- å®šä¹‰æ‰“åŒ…æˆjarçš„åå­— --&gt; &lt;!-- è¿™é‡Œå¦‚æœä¸å®šä¹‰ , æ‰“åŒ…æˆçš„jaråå­—æ ¼å¼ä¸º : &lt;artifactId&gt; + &lt;version&gt; --&gt; &lt;finalName&gt;docker_jar&lt;/finalName&gt; &lt;plugins&gt; &lt;!--SpringBoot mavenæ’ä»¶--&gt; &lt;!-- å¯ä»¥å°†åº”ç”¨æ‰“æˆä¸€ä¸ªå¯æ‰§è¡Œçš„jaråŒ… --&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;!-- è®¾ç½®å¯åŠ¨å…¥å£ --&gt; &lt;!-- manClasså³ä½¿ä¸é…ç½® , SprinBootä¹Ÿåœ¨æ‰“åŒ…çš„æ—¶å€™ä¹Ÿæ¸…æ¥šå…¥å£æ˜¯å“ªä¸ª , å…¶å®ä¸ç”¨é…ç½® --&gt; &lt;configuration&gt; &lt;mainClass&gt;com.kk.DockerBootApplication&lt;/mainClass&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 3ã€application.properties.properties server.port=6001 # ========================alibaba.druidç›¸å…³é…ç½®===================== spring.datasource.type=com.alibaba.druid.pool.DruidDataSource spring.datasource.driver-class-name=com.mysql.jdbc.Driver spring.datasource.url=jdbc:mysql://106.52.23.202:3306/db2022?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false spring.datasource.username=root spring.datasource.password=root spring.datasource.druid.test-while-idle=false # ========================redisç›¸å…³é…ç½®===================== spring.redis.database=0 spring.redis.host=106.12.159.22 spring.redis.port=6379 spring.redis.password= spring.redis.lettuce.pool.max-active=8 spring.redis.lettuce.pool.max-wait=-1ms spring.redis.lettuce.pool.max-idle=8 spring.redis.lettuce.pool.min-idle=0 # ========================mybatisç›¸å…³é…ç½®=================== mybatis.mapper-locations=classpath:mapper/*.xml mybatis.type-aliases-package=com.kk.docker.entities # ========================swagger===================== spring.swagger2.enabled=true 4ã€ä¸»å¯åŠ¨ package com.kk; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import tk.mybatis.spring.annotation.MapperScan; @SpringBootApplication @MapperScan(\"com.kk.docker.mapper\") public class DockerBootApplication { public static void main(String[] args) { SpringApplication.run (DockerBootApplication.class, args); } } 5ã€ä¸šåŠ¡ç±» 5-1ã€configé…ç½®ç±» RedisConfig package com.kk.docker.config; import lombok.extern.slf4j.Slf4j; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory; import org.springframework.data.redis.core.RedisTemplate; import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer; import org.springframework.data.redis.serializer.StringRedisSerializer; import java.io.Serializable; @Configuration @Slf4j public class RedisConfig { /** * @param lettuceConnectionFactory * @return redisåºåˆ—åŒ–çš„å·¥å…·é…ç½®ç±»ï¼Œä¸‹é¢è¿™ä¸ªè¯·ä¸€å®šå¼€å¯é…ç½® * 127.0.0.1:6379&gt; keys * * 1) \"ord:102\" åºåˆ—åŒ–è¿‡ * 2) \"\\xac\\xed\\x00\\x05t\\x00\\aord:102\" é‡ç”Ÿï¼Œæ²¡æœ‰åºåˆ—åŒ–è¿‡ */ @Bean public RedisTemplate&lt;String, Serializable&gt; redisTemplate(LettuceConnectionFactory lettuceConnectionFactory) { RedisTemplate&lt;String, Serializable&gt; redisTemplate = new RedisTemplate&lt;&gt; ( ); redisTemplate.setConnectionFactory (lettuceConnectionFactory); //è®¾ç½®keyåºåˆ—åŒ–æ–¹å¼string redisTemplate.setKeySerializer (new StringRedisSerializer ( )); //è®¾ç½®valueçš„åºåˆ—åŒ–æ–¹å¼json redisTemplate.setValueSerializer (new GenericJackson2JsonRedisSerializer ( )); redisTemplate.setHashKeySerializer (new StringRedisSerializer ( )); redisTemplate.setHashValueSerializer (new GenericJackson2JsonRedisSerializer ( )); redisTemplate.afterPropertiesSet ( ); return redisTemplate; } } SwaggerConfig package com.kk.docker.config; import org.springframework.beans.factory.annotation.Value; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import springfox.documentation.builders.ApiInfoBuilder; import springfox.documentation.builders.PathSelectors; import springfox.documentation.builders.RequestHandlerSelectors; import springfox.documentation.service.ApiInfo; import springfox.documentation.spi.DocumentationType; import springfox.documentation.spring.web.plugins.Docket; import springfox.documentation.swagger2.annotations.EnableSwagger2; import java.text.SimpleDateFormat; import java.util.Date; @Configuration @EnableSwagger2 public class SwaggerConfig { @Value(\"${spring.swagger2.enabled}\") private Boolean enabled; @Bean public Docket createRestApi() { return new Docket (DocumentationType.SWAGGER_2) .apiInfo (apiInfo ( )) .enable (enabled) .select ( ) .apis (RequestHandlerSelectors.basePackage (\"com.kk.docker\")) //ä½ è‡ªå·±çš„package .paths (PathSelectors.any ( )) .build ( ); } public ApiInfo apiInfo() { return new ApiInfoBuilder ( ) .title (\"java å­¦ä¹  docker\" + \"\\t\" + new SimpleDateFormat (\"yyyy-MM-dd\").format (new Date ( ))) .description (\"docker-compose\") .version (\"1.0\") .termsOfServiceUrl (\"https://www.mykkto.cn\") .build ( ); } } 5-2ã€æ–°å»ºentity User package com.kk.docker.entirys; import javax.persistence.Column; import javax.persistence.GeneratedValue; import javax.persistence.Id; import javax.persistence.Table; import java.util.Date; @Table(name = \"t_user\") public class User { @Id @GeneratedValue(generator = \"JDBC\") private Integer id; /** * ç”¨æˆ·å */ private String username; /** * å¯†ç  */ private String password; /** * æ€§åˆ« 0=å¥³ 1=ç”· */ private Byte sex; /** * åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤ */ private Byte deleted; /** * æ›´æ–°æ—¶é—´ */ @Column(name = \"update_time\") private Date updateTime; /** * åˆ›å»ºæ—¶é—´ */ @Column(name = \"create_time\") private Date createTime; /** * @return id */ public Integer getId() { return id; } /** * @param id */ public void setId(Integer id) { this.id = id; } /** * è·å–ç”¨æˆ·å * * @return username - ç”¨æˆ·å */ public String getUsername() { return username; } /** * è®¾ç½®ç”¨æˆ·å * * @param username ç”¨æˆ·å */ public void setUsername(String username) { this.username = username; } /** * è·å–å¯†ç  * * @return password - å¯†ç  */ public String getPassword() { return password; } /** * è®¾ç½®å¯†ç  * * @param password å¯†ç  */ public void setPassword(String password) { this.password = password; } /** * è·å–æ€§åˆ« 0=å¥³ 1=ç”· * * @return sex - æ€§åˆ« 0=å¥³ 1=ç”· */ public Byte getSex() { return sex; } /** * è®¾ç½®æ€§åˆ« 0=å¥³ 1=ç”· * * @param sex æ€§åˆ« 0=å¥³ 1=ç”· */ public void setSex(Byte sex) { this.sex = sex; } /** * è·å–åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤ * * @return deleted - åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤ */ public Byte getDeleted() { return deleted; } /** * è®¾ç½®åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤ * * @param deleted åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤ */ public void setDeleted(Byte deleted) { this.deleted = deleted; } /** * è·å–æ›´æ–°æ—¶é—´ * * @return update_time - æ›´æ–°æ—¶é—´ */ public Date getUpdateTime() { return updateTime; } /** * è®¾ç½®æ›´æ–°æ—¶é—´ * * @param updateTime æ›´æ–°æ—¶é—´ */ public void setUpdateTime(Date updateTime) { this.updateTime = updateTime; } /** * è·å–åˆ›å»ºæ—¶é—´ * * @return create_time - åˆ›å»ºæ—¶é—´ */ public Date getCreateTime() { return createTime; } /** * è®¾ç½®åˆ›å»ºæ—¶é—´ * * @param createTime åˆ›å»ºæ—¶é—´ */ public void setCreateTime(Date createTime) { this.createTime = createTime; } } UserDTO package com.kk.docker.entirys; import io.swagger.annotations.ApiModel; import io.swagger.annotations.ApiModelProperty; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; import lombok.ToString; import java.io.Serializable; import java.util.Date; @NoArgsConstructor @AllArgsConstructor @Data @ApiModel(value = \"ç”¨æˆ·ä¿¡æ¯\") @ToString public class UserDTO implements Serializable { @ApiModelProperty(value = \"ç”¨æˆ·ID\") private Integer id; @ApiModelProperty(value = \"ç”¨æˆ·å\") private String username; @ApiModelProperty(value = \"å¯†ç \") private String password; @ApiModelProperty(value = \"æ€§åˆ« 0=å¥³ 1=ç”· \") private Byte sex; @ApiModelProperty(value = \"åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤\") private Byte deleted; @ApiModelProperty(value = \"æ›´æ–°æ—¶é—´\") private Date updateTime; @ApiModelProperty(value = \"åˆ›å»ºæ—¶é—´\") private Date createTime; /** * @return id */ public Integer getId() { return id; } /** * @param id */ public void setId(Integer id) { this.id = id; } /** * è·å–ç”¨æˆ·å * * @return username - ç”¨æˆ·å */ public String getUsername() { return username; } /** * è®¾ç½®ç”¨æˆ·å * * @param username ç”¨æˆ·å */ public void setUsername(String username) { this.username = username; } /** * è·å–å¯†ç  * * @return password - å¯†ç  */ public String getPassword() { return password; } /** * è®¾ç½®å¯†ç  * * @param password å¯†ç  */ public void setPassword(String password) { this.password = password; } /** * è·å–æ€§åˆ« 0=å¥³ 1=ç”· * * @return sex - æ€§åˆ« 0=å¥³ 1=ç”· */ public Byte getSex() { return sex; } /** * è®¾ç½®æ€§åˆ« 0=å¥³ 1=ç”· * * @param sex æ€§åˆ« 0=å¥³ 1=ç”· */ public void setSex(Byte sex) { this.sex = sex; } /** * è·å–åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤ * * @return deleted - åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤ */ public Byte getDeleted() { return deleted; } /** * è®¾ç½®åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤ * * @param deleted åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤ */ public void setDeleted(Byte deleted) { this.deleted = deleted; } /** * è·å–æ›´æ–°æ—¶é—´ * * @return update_time - æ›´æ–°æ—¶é—´ */ public Date getUpdateTime() { return updateTime; } /** * è®¾ç½®æ›´æ–°æ—¶é—´ * * @param updateTime æ›´æ–°æ—¶é—´ */ public void setUpdateTime(Date updateTime) { this.updateTime = updateTime; } /** * è·å–åˆ›å»ºæ—¶é—´ * * @return create_time - åˆ›å»ºæ—¶é—´ */ public Date getCreateTime() { return createTime; } /** * è®¾ç½®åˆ›å»ºæ—¶é—´ * * @param createTime åˆ›å»ºæ—¶é—´ */ public void setCreateTime(Date createTime) { this.createTime = createTime; } } 5-3 æ–°å»ºmapper æ–°å»ºæ¥å£UserMapper package com.kk.docker.mapper; import com.kk.docker.entirys.User; import tk.mybatis.mapper.common.Mapper; public interface UserMapper extends Mapper&lt;User&gt; { } src\\main\\resourcesè·¯å¾„ä¸‹æ–°å»ºmapperæ–‡ä»¶å¤¹å¹¶æ–°å¢UserMapper.xml &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt; &lt;mapper namespace=\"com.atguigu.docker.mapper.UserMapper\"&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.kk.docker.entirys.User\"&gt; &lt;!-- WARNING - @mbg.generated --&gt; &lt;id column=\"id\" jdbcType=\"INTEGER\" property=\"id\"/&gt; &lt;result column=\"username\" jdbcType=\"VARCHAR\" property=\"username\"/&gt; &lt;result column=\"password\" jdbcType=\"VARCHAR\" property=\"password\"/&gt; &lt;result column=\"sex\" jdbcType=\"TINYINT\" property=\"sex\"/&gt; &lt;result column=\"deleted\" jdbcType=\"TINYINT\" property=\"deleted\"/&gt; &lt;result column=\"update_time\" jdbcType=\"TIMESTAMP\" property=\"updateTime\"/&gt; &lt;result column=\"create_time\" jdbcType=\"TIMESTAMP\" property=\"createTime\"/&gt; &lt;/resultMap&gt; &lt;/mapper&gt; 5-4 æ–°å»ºservice package com.kk.docker.service; import com.kk.docker.entirys.User; import com.kk.docker.mapper.UserMapper; import lombok.extern.slf4j.Slf4j; import org.springframework.data.redis.core.RedisTemplate; import org.springframework.stereotype.Service; import javax.annotation.Resource; @Service @Slf4j public class UserService { public static final String CACHE_KEY_USER = \"user:\"; @Resource private UserMapper userMapper; @Resource private RedisTemplate redisTemplate; /** * addUser * * @param user */ public void addUser(User user) { //1 å…ˆæ’å…¥mysqlå¹¶æˆåŠŸ int i = userMapper.insertSelective (user); if (i &gt; 0) { //2 éœ€è¦å†æ¬¡æŸ¥è¯¢ä¸€ä¸‹mysqlå°†æ•°æ®æå›æ¥å¹¶ok user = userMapper.selectByPrimaryKey (user.getId ( )); //3 å°†æå‡ºæ¥çš„userå­˜è¿›redisï¼Œå®Œæˆæ–°å¢åŠŸèƒ½çš„æ•°æ®ä¸€è‡´æ€§ã€‚ String key = CACHE_KEY_USER + user.getId ( ); redisTemplate.opsForValue ( ).set (key, user); } } /**F * findUserById * * @param id * @return */ public User findUserById(Integer id) { User user = null; String key = CACHE_KEY_USER + id; //1 å…ˆä»redisé‡Œé¢æŸ¥è¯¢ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ç»“æœï¼Œå¦‚æœæ²¡æœ‰å†å»æŸ¥è¯¢mysql user = (User) redisTemplate.opsForValue ( ).get (key); if (user == null) { //2 redisé‡Œé¢æ— ï¼Œç»§ç»­æŸ¥è¯¢mysql user = userMapper.selectByPrimaryKey (id); if (user == null) { //3.1 redis+mysql éƒ½æ— æ•°æ® //ä½ å…·ä½“ç»†åŒ–ï¼Œé˜²æ­¢å¤šæ¬¡ç©¿é€ï¼Œæˆ‘ä»¬è§„å®šï¼Œè®°å½•ä¸‹å¯¼è‡´ç©¿é€çš„è¿™ä¸ªkeyå›å†™redis return user; } else { //3.2 mysqlæœ‰ï¼Œéœ€è¦å°†æ•°æ®å†™å›redisï¼Œä¿è¯ä¸‹ä¸€æ¬¡çš„ç¼“å­˜å‘½ä¸­ç‡ redisTemplate.opsForValue ( ).set (key, user); } } return user; } public void deleteUser(Integer id) { } public void updateUser(User user) { } public User findUserById2(Integer id) { return null; } } 5-5 æ–°å»ºcontroller package com.kk.docker.controller; import cn.hutool.core.util.IdUtil; import com.kk.docker.entirys.User; import com.kk.docker.entirys.UserDTO; import com.kk.docker.service.UserService; import io.swagger.annotations.Api; import io.swagger.annotations.ApiOperation; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.BeanUtils; import org.springframework.web.bind.annotation.*; import javax.annotation.Resource; import java.util.Random; @Api(description = \"ç”¨æˆ·Useræ¥å£\") @RestController @Slf4j public class UserController { @Resource private UserService userService; @ApiOperation(\"æ•°æ®åº“æ–°å¢3æ¡è®°å½•\") @RequestMapping(value = \"/user/add\", method = RequestMethod.POST) public void addUser() { for (int i = 1; i &lt;= 3; i++) { User user = new User ( ); user.setUsername (\"jack\" + i); user.setPassword (IdUtil.simpleUUID ( ).substring (0, 6)); user.setSex ((byte) new Random ( ).nextInt (2)); userService.addUser (user); } } @ApiOperation(\"åˆ é™¤1æ¡è®°å½•\") @RequestMapping(value = \"/user/delete/{id}\", method = RequestMethod.POST) public void deleteUser(@PathVariable Integer id) { userService.deleteUser (id); } @ApiOperation(\"ä¿®æ”¹1æ¡è®°å½•\") @RequestMapping(value = \"/user/update\", method = RequestMethod.POST) public void updateUser(@RequestBody UserDTO userDTO) { User user = new User ( ); BeanUtils.copyProperties (userDTO, user); userService.updateUser (user); } @ApiOperation(\"æŸ¥è¯¢1æ¡è®°å½•\") @RequestMapping(value = \"/user/find/{id}\", method = RequestMethod.GET) public User findUserById(@PathVariable Integer id) { return userService.findUserById2 (id); } } 6ã€æ‰“åŒ… 7ã€ç¼–å†™ Dockerfile # åŸºç¡€é•œåƒä½¿ç”¨java FROM java:8 # ä½œè€… MAINTAINER jack # VOLUME æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸º/tmpï¼Œåœ¨ä¸»æœº/var/lib/dockerç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶é“¾æ¥åˆ°å®¹å™¨çš„/tmp VOLUME /tmp # å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸º jack_docker.jar ADD docker_jar.jar jack_docker.jar # è¿è¡ŒjaråŒ… RUN bash -c 'touch /jack_docker.jar' ENTRYPOINT [\"java\",\"-jar\",\"/jack_docker.jar\"] #æš´éœ²6001ç«¯å£ä½œä¸ºå¾®æœåŠ¡ EXPOSE 6001 8ã€æ„å»ºé•œåƒ docker build -t jack_docker:1.7 . 9ã€è¿è¡Œ docker run -d -p 6001:6001 --name jackto17 jack_docker:1.7 10ã€è®¿é—® swageer http://106.XX.XX.XXX:6001/swagger-ui.html 2ã€ä¸ç”¨Compose å•ç‹¬å¯åŠ¨å®¹å™¨ redis å•ç‹¬å¯åŠ¨å®¹å™¨ mysql å•ç‹¬å¯åŠ¨å®¹å™¨ å¾®æœåŠ¡ 3ã€å­˜åœ¨çš„é—®é¢˜ å…ˆåé¡ºåºè¦æ±‚å›ºå®šï¼Œå…ˆmysql+redisæ‰èƒ½å¾®æœåŠ¡è®¿é—®æˆåŠŸ å¤šä¸ªrunå‘½ä»¤â€¦â€¦ å®¹å™¨é—´çš„å¯åœæˆ–å®•æœºï¼Œæœ‰å¯èƒ½å¯¼è‡´IPåœ°å€å¯¹åº”çš„å®¹å™¨å®ä¾‹å˜åŒ–ï¼Œæ˜ å°„å‡ºé”™ï¼Œè¦ä¹ˆç”Ÿäº§IPå†™æ­»(å¯ä»¥ä½†æ˜¯ä¸æ¨è)ï¼Œè¦ä¹ˆé€šè¿‡æœåŠ¡è°ƒç”¨ 4ã€ä½¿ç”¨Compose1ã€ç¼–å†™ docker-compose.ymlæ–‡ä»¶ version: \"3\" services: microService: image: jack_docker:1.8 container_name: ms01 ports: - \"6001:6001\" volumes: - /app/microService:/data networks: - mykk_net depends_on: - redis - mysql redis: image: redis:6.0.8 ports: - \"6379:6379\" volumes: - /app/redis/redis.conf:/etc/redis/redis.conf - /app/redis/data:/data networks: - mykk_net command: redis-server /etc/redis/redis.conf mysql: image: mysql:5.7 environment: MYSQL_ROOT_PASSWORD: 'a1b2c3' MYSQL_ALLOW_EMPTY_PASSWORD: 'no' MYSQL_DATABASE: 'db2022' MYSQL_USER: 'jack' MYSQL_PASSWORD: 'a1b2c3' ports: - \"3306:3306\" volumes: - /app/mysql/db:/var/lib/mysql - /app/mysql/conf/my.cnf:/etc/my.cnf - /app/mysql/init:/docker-entrypoint-initdb.d networks: - mykk_net command: --default-authentication-plugin=mysql_native_password #è§£å†³å¤–éƒ¨æ— æ³•è®¿é—® networks: mykk_net: 2ã€ç¬¬äºŒæ¬¡ä¿®æ”¹å¾®æœåŠ¡å·¥ç¨‹ docker_boot 2-1 æ”¹ YMLï¼šé€šè¿‡æœåŠ¡åè®¿é—®ï¼ŒIPæ— å…³ 2-2 æ‰“åŒ…ï¼Œç¼–å†™ Dockerfile 2-3 æ„å»ºé•œåƒ docker build -t jack_docker:1.8 . 3ã€æ‰§è¡Œ docker-compose æ‰§è¡Œ docker-compose upæˆ–è€…æ‰§è¡Œ docker-compose up -d 4ã€åˆ›å»ºè¡¨ docker exec -it å®¹å™¨å®ä¾‹id /bin/bash mysql -uroot -p create database db2022; use db2022; CREATE TABLE t_user ( id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT, username VARCHAR(50) NOT NULL DEFAULT â€˜â€™ COMMENT â€˜ç”¨æˆ·åâ€™, password VARCHAR(50) NOT NULL DEFAULT â€˜â€™ COMMENT â€˜å¯†ç â€™, sex TINYINT(4) NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜æ€§åˆ« 0=å¥³ 1=ç”· â€˜, deleted TINYINT(4) UNSIGNED NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤â€™, update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT â€˜æ›´æ–°æ—¶é—´â€™, create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT â€˜åˆ›å»ºæ—¶é—´â€™, PRIMARY KEY (id)) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT=â€™ç”¨æˆ·è¡¨â€™; 5ã€å…³åœdocker-compose stop äº”ã€å‘½ä»¤(docker-compose) Composeå¸¸ç”¨å‘½ä»¤docker-compose -h # æŸ¥çœ‹å¸®åŠ©docker-compose up # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡docker-compose up -d # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡å¹¶åå°è¿è¡Œdocker-compose down # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€ç½‘ç»œã€å·ã€é•œåƒã€‚docker-compose exec ymlé‡Œé¢çš„æœåŠ¡id # è¿›å…¥å®¹å™¨å®ä¾‹å†…éƒ¨ docker-compose exec docker-compose.ymlæ–‡ä»¶ä¸­å†™çš„æœåŠ¡id /bin/bashdocker-compose ps # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨docker-compose top # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„å®¹å™¨è¿›ç¨‹docker-compose logs ymlé‡Œé¢çš„æœåŠ¡id # æŸ¥çœ‹å®¹å™¨è¾“å‡ºæ—¥å¿—dokcer-compose config # æ£€æŸ¥é…ç½®dokcer-compose config -q # æ£€æŸ¥é…ç½®ï¼Œæœ‰é—®é¢˜æ‰æœ‰è¾“å‡ºdocker-compose restart # é‡å¯æœåŠ¡docker-compose start # å¯åŠ¨æœåŠ¡docker-compose stop # åœæ­¢æœåŠ¡ å‚è€ƒåœ°å€ â†“1ã€docker åŠ é€Ÿï¼ˆåšä¸»ç®€ä¹¦ï¼‰urlï¼šhttps://www.jianshu.com/p/f554c85b25c1 2ã€DockerBuildæŠ¥é”™ï¼šThe command â€˜/bin/sh -c yum install -y vimâ€˜ returned a non-zero code: 1urlï¼šhttps://blog.csdn.net/weixin_53402685/article/details/125296621 3ã€docker-compose æ—¥å¿—è¾“å‡ºurlï¼šhttps://www.cnblogs.com/sunstudy/articles/16340509.html","categories":[{"name":"docker","slug":"docker","permalink":"https://mykkto.github.io/categories/docker/"}],"tags":[{"name":"docker-compose","slug":"docker-compose","permalink":"https://mykkto.github.io/tags/docker-compose/"},{"name":"dockerfile","slug":"dockerfile","permalink":"https://mykkto.github.io/tags/dockerfile/"},{"name":"dockerç½‘ç»œ","slug":"dockerç½‘ç»œ","permalink":"https://mykkto.github.io/tags/docker%E7%BD%91%E7%BB%9C/"}],"author":"mykk"},{"title":"å¤§æ•°æ®-Flinkæµå¼è®¡ç®—æ¡†æ¶(JAVA)","slug":"13-å¤§æ•°æ®/01-Flink/01_FlinkæŠ€æœ¯æ ˆ","date":"2022-05-17T14:17:13.000Z","updated":"2023-06-11T02:53:45.132Z","comments":true,"path":"posts/1b79564d.html","link":"","permalink":"https://mykkto.github.io/posts/1b79564d.html","excerpt":"","text":"â€‹ 0ï¸âƒ£ä»£ç åœ°å€https://github.com/mykkTo/Flink_java.git â… ã€Flink åˆè¯†å‰è¨€1ã€å°ç¬”è®° 1ã€åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä½¿ç”¨äº†lambdaè¡¨è¾¾å¼éœ€è¦æ³¨æ„æ³›å‹æ“¦é™¤ï¼Œæ²¡æœ‰æŒ‡æ˜çš„è¯flinkä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºå¯¹æ•°æ®æœ‰ä¸¥æ ¼è¦æ±‚ .returns(Types.String); è¿›è¡Œæ˜ç¡®å£°æ˜ 2ã€æ•°æ®å€¾æ–œï¼šå°±æ˜¯æœ‰çš„çº¿ç¨‹å¿™çš„å¿™æ­»ï¼Œæœ‰ç‚¹çº¿ç¨‹é—²çš„é—²æ­»ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦è°ƒç”¨ç‰©ç†åˆ†åŒºçš„ç®—å­ï¼ˆé»˜è®¤flinkåº•å±‚ä¼šè°ƒç”¨ï¼‰ï¼Œæ‰‹åŠ¨çš„è¯è°ƒç”¨ shuffle() æ–¹æ³•ï¼ˆæ´—ç‰Œï¼Œéšæœºåˆ†åŒºï¼‰ï¼Œæ‰‹åŠ¨è°ƒç”¨ rebalance() æ–¹æ³•ï¼ˆè½®è®­åˆ†åŒºï¼‰ï¼Œç„¶è€Œéœ€è¦æ³¨æ„çš„æ˜¯ keyByï¼ˆï¼‰æ–¹æ³•æ˜¯é€»è¾‘åˆ†åŒºï¼Œæ€»çš„6ç§è¿˜æœ‰è‡ªå®šä¹‰çš„ï¼Œå¦‚æœç”Ÿäº§æ²¡æœ‰ä¸¥é‡å€¾æ–œå°±ä¸éœ€è¦ç”¨è¿™äº›ã€‚ 3ã€æœ‰ä¸¤ä¸ªsetParallelism(N) â€‹ env.setParallelism(N) æ˜¯è®¾ç½®Nä¸ªç‰©ç†åˆ†åŒº â€‹ print ().setParallelism(N)æ˜¯è®¾ç½®Nä¸ªçº¿ç¨‹åœ¨è·‘ï¼Œå¯Œå‡½æ•°çš„è¯å°±ä¼šæœ‰4æ¬¡ç”Ÿå‘½å‘¨æœŸ 4ã€ ä¸€ã€åŸºæœ¬æ¦‚è¿°1ã€æ¦‚è¿°Flink æ˜¯ Apache åŸºé‡‘ä¼šæ——ä¸‹çš„ä¸€ä¸ªå¼€æºå¤§æ•°æ®å¤„ç†æ¡†æ¶ã€‚ç›®å‰ï¼ŒFlink å·²ç»æˆä¸ºå„å¤§å…¬å¸å¤§æ•°æ®å®æ—¶å¤„ç†çš„å‘åŠ›é‡ç‚¹ï¼Œç‰¹åˆ«æ˜¯å›½å†…ä»¥é˜¿é‡Œä¸ºä»£è¡¨çš„ä¸€ä¼—äº’è”ç½‘å¤§å‚éƒ½åœ¨å…¨åŠ›æŠ•å…¥ï¼Œä¸º Flink ç¤¾åŒºè´¡çŒ®äº†å¤§é‡æºç ã€‚å¦‚ä»Š Flink å·²è¢«å¾ˆå¤šäººè®¤ä¸ºæ˜¯å¤§æ•°æ®å®æ—¶å¤„ç†çš„æ–¹å‘å’Œæœªæ¥ï¼Œè®¸å¤šå…¬å¸ä¹Ÿéƒ½åœ¨æ‹›è˜å’Œå‚¨å¤‡æŒæ¡ Flink æŠ€æœ¯çš„äººæ‰ã€‚ 2ã€æºèµ·å’Œè®¾è®¡ç†å¿µFlink èµ·æºäºä¸€ä¸ªå«ä½œ Stratosphere çš„é¡¹ç›®ï¼Œå®ƒæ˜¯ç”± 3 æ‰€åœ°å¤„æŸæ—çš„å¤§å­¦å’Œæ¬§æ´²å…¶ä»–ä¸€äº›å¤§ å­¦åœ¨ 2010~2014 å¹´å…±åŒè¿›è¡Œçš„ç ”ç©¶é¡¹ç›®ï¼Œç”±æŸæ—ç†å·¥å¤§å­¦çš„æ•™æˆæ²ƒå…‹å°”Â·é©¬å°”ç§‘ï¼ˆVolker Marklï¼‰ é¢†è¡”å¼€å‘ã€‚2014 å¹´ 4 æœˆï¼ŒStratosphere çš„ä»£ç è¢«å¤åˆ¶å¹¶æèµ ç»™äº† Apache è½¯ä»¶åŸºé‡‘ä¼šï¼ŒFlink å°± æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šè¢«é‡æ–°è®¾è®¡å‡ºæ¥çš„ã€‚ åœ¨å¾·è¯­ä¸­ï¼Œâ€œflinkâ€ä¸€è¯è¡¨ç¤ºâ€œå¿«é€Ÿã€çµå·§â€ã€‚é¡¹ç›®çš„ logo æ˜¯ä¸€åªå½©è‰²çš„æ¾é¼ ï¼Œå½“ç„¶äº†ï¼Œ è¿™ä¸ä»…æ˜¯å› ä¸º Apache å¤§æ•°æ®é¡¹ç›®å¯¹åŠ¨ç‰©çš„å–œå¥½ï¼ˆæ˜¯å¦è”æƒ³åˆ°äº† Hadoopã€Hiveï¼Ÿï¼‰ï¼Œæ›´æ˜¯å› ä¸º æ¾é¼ è¿™ç§å°åŠ¨ç‰©å®Œç¾åœ°ä½“ç°äº†â€œå¿«é€Ÿã€çµå·§â€çš„ç‰¹ç‚¹ã€‚å…³äº logo çš„é¢œè‰²ï¼Œè¿˜ä¸€ä¸ªæœ‰è¶£çš„ç¼˜ç”±ï¼š æŸæ—å½“åœ°çš„æ¾é¼ éå¸¸æ¼‚äº®ï¼Œé¢œè‰²æ˜¯è¿·äººçš„çº¢æ£•è‰²ï¼›è€Œ Apache è½¯ä»¶åŸºé‡‘ä¼šçš„ logoï¼Œåˆšå¥½ä¹Ÿæ˜¯ä¸€ æ ¹ä»¥çº¢æ£•è‰²ä¸ºä¸»çš„æ¸å˜è‰²ç¾½æ¯›ã€‚äºæ˜¯ï¼ŒFlink çš„æ¾é¼  Logo å°±è®¾è®¡æˆäº†çº¢æ£•è‰²ï¼Œè€Œä¸”æ‹¥æœ‰ä¸€ä¸ªæ¼‚ äº®çš„æ¸å˜è‰²å°¾å·´ï¼Œå°¾å·´çš„é…è‰²ä¸ Apache è½¯ä»¶åŸºé‡‘ä¼šçš„ logo ä¸€è‡´ã€‚è¿™åªæ¾é¼ è‰²å½©ç‚«ç›®ï¼Œæ—¢å‘¼åº” äº† Apache çš„é£æ ¼ï¼Œä¼¼ä¹ä¹Ÿé¢„ç¤ºç€ Flink æœªæ¥å°†è¦å¤§æ”¾å¼‚å½©ã€‚ äºŒã€Flink çš„åº”ç”¨Flink æ˜¯ä¸€ä¸ªå¤§æ•°æ®æµå¤„ç†å¼•æ“ï¼Œå®ƒå¯ä»¥ä¸ºä¸åŒçš„è¡Œä¸šæä¾›å¤§æ•°æ®å®æ—¶å¤„ç†çš„è§£å†³æ–¹æ¡ˆã€‚ éšç€ Flink çš„å¿«é€Ÿå‘å±•å®Œå–„ï¼Œå¦‚ä»Šåœ¨ä¸–ç•ŒèŒƒå›´è®¸å¤šå…¬å¸éƒ½å¯ä»¥è§åˆ° Flink çš„èº«å½±ã€‚ ç›®å‰åœ¨å…¨çƒèŒƒå›´å†…ï¼ŒåŒ—ç¾ã€æ¬§æ´²å’Œé‡‘ç –å›½å®¶å‡æ˜¯ Flink çš„åº”ç”¨çƒ­é—¨åŒºåŸŸã€‚å½“ç„¶ï¼Œè¿™äº›åœ°åŒº å…¶å®ä¹Ÿå°±æ˜¯ ITã€äº’è”ç½‘è¡Œä¸šè¾ƒå‘è¾¾çš„åœ°åŒºã€‚ Flink åœ¨å›½å†…çƒ­åº¦å°¤å…¶é«˜ï¼Œä¸€æ–¹é¢æ˜¯å› ä¸ºé˜¿é‡Œçš„è´¡çŒ®å’Œå¸¦å¤´æ•ˆåº”ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿè·Ÿä¸­å›½çš„åº” ç”¨åœºæ™¯å¯†åˆ‡ç›¸å…³ã€‚ä¸­å›½çš„äººå£è§„æ¨¡ä¸äº’è”ç½‘ä½¿ç”¨æ™®åŠç¨‹åº¦ï¼Œå†³å®šäº†å¯¹å¤§æ•°æ®å¤„ç†çš„é€Ÿåº¦è¦æ±‚è¶Š æ¥è¶Šé«˜ï¼Œä¹Ÿè¿«ä½¿ä¸­å›½çš„äº’è”ç½‘ä¼ä¸šå»è¿½é€æ›´é«˜çš„æ•°æ®å¤„ç†æ•ˆç‡ã€‚è¯•æƒ³åœ¨ä¸­å›½ï¼Œä¸€ä¸ªç½‘ç«™å¯èƒ½è¦ é¢å¯¹æ•°äº¿çš„æ—¥æ´»ç”¨æˆ·ã€æ¯ç§’æ•°äº¿æ¬¡çš„è®¡ç®—å³°å€¼ï¼Œè¿™å¯¹å¾ˆå¤šå›½å¤–çš„å…¬å¸æ¥è¯´æ˜¯æ— æ³•æƒ³è±¡çš„ã€‚è€Œ Flink æ°å¥½ç»™æˆ‘ä»¬é«˜é€Ÿå‡†ç¡®çš„å¤„ç†æµ·é‡æµå¼æ•°æ®æä¾›äº†å¯èƒ½ã€‚ 1ã€ä¼ä¸šä¸­çš„åº”ç”¨Flink ä¸ºå…¨çƒè®¸å¤šå…¬å¸å’Œä¼ä¸šçš„å…³é”®ä¸šåŠ¡åº”ç”¨æä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚ å¯¹äºæ•°æ®å¤„ç†è€Œè¨€ï¼Œä»»ä½•è¡Œä¸šã€ä»»ä½•å…¬å¸çš„éœ€æ±‚å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ï¼šæ•°æ®è§„æ¨¡å¤§ã€å®æ—¶æ€§è¦ æ±‚é«˜ã€ç¡®ä¿ç»“æœå‡†ç¡®ã€æ–¹ä¾¿æ‰©å±•ã€æ•…éšœåå¯æ¢å¤â€”â€”è€Œè¿™äº›è¦æ±‚ï¼Œä½œä¸ºæ–°ä¸€ä»£å¤§æ•°æ®æµå¼å¤„ç† å¼•æ“çš„ Flink ç»Ÿç»Ÿå¯ä»¥æ»¡è¶³ï¼è¿™ä¹Ÿæ­£æ˜¯ Flink åœ¨å…¨ä¸–ç•ŒèŒƒå›´å¾—åˆ°å¹¿æ³›åº”ç”¨çš„åŸå› ã€‚ 2ã€ä¸»è¦çš„åº”ç”¨åœºæ™¯ ç”µå•†å’Œå¸‚åœºè¥é”€ ä¸¾ä¾‹ï¼šå®æ—¶æ•°æ®æŠ¥è¡¨ã€å¹¿å‘ŠæŠ•æ”¾ã€å®æ—¶æ¨è åœ¨ç”µå•†è¡Œä¸šä¸­ï¼Œç½‘ç«™ç‚¹å‡»é‡æ˜¯ç»Ÿè®¡ PVã€UV çš„é‡è¦æ¥æºï¼Œä¹Ÿæ˜¯å¦‚ä»Šâ€œæµé‡ç»æµâ€çš„æœ€ä¸»è¦ æ•°æ®æŒ‡æ ‡ã€‚å¾ˆå¤šå…¬å¸çš„è¥é”€ç­–ç•¥ï¼Œæ¯”å¦‚å¹¿å‘Šçš„æŠ•æ”¾ï¼Œä¹Ÿæ˜¯åŸºäºç‚¹å‡»é‡æ¥å†³å®šçš„ã€‚å¦å¤–ï¼Œåœ¨ç½‘ç«™ä¸Šæä¾›ç»™ç”¨æˆ·çš„å®æ—¶æ¨èï¼Œå¾€å¾€ä¹Ÿæ˜¯åŸºäºå½“å‰ç”¨æˆ·çš„ç‚¹å‡»è¡Œä¸ºåšå‡ºçš„ã€‚ ç½‘ç«™è·å¾—çš„ç‚¹å‡»æ•°æ®å¯èƒ½æ˜¯è¿ç»­ä¸”ä¸å‡åŒ€çš„ï¼Œè¿˜å¯èƒ½åœ¨åŒä¸€æ—¶é—´å¤§é‡äº§ç”Ÿï¼Œè¿™æ˜¯å…¸å‹çš„æ•° æ®æµã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æŠŠå®ƒä»¬å…¨éƒ¨æ”¶é›†èµ·æ¥ï¼Œå†å»åˆ†æå¤„ç†ï¼Œå°±ä¼šé¢ä¸´å¾ˆå¤šé—®é¢˜ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬éœ€ è¦å¾ˆå¤§çš„ç©ºé—´æ¥å­˜å‚¨æ•°æ®ï¼›å…¶æ¬¡ï¼Œæ”¶é›†æ•°æ®çš„è¿‡ç¨‹è€—å»äº†å¤§é‡æ—¶é—´ï¼Œç»Ÿè®¡åˆ†æç»“æœçš„å®æ—¶æ€§å°± å¤§å¤§é™ä½äº†ï¼›å¦å¤–ï¼Œåˆ†å¸ƒå¼å¤„ç†æ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºï¼Œå¦‚æœæˆ‘ä»¬åªä»¥æ•°æ®è¿›å…¥ç³»ç»Ÿçš„æ—¶é—´ä¸ºå‡†ï¼Œ å¯èƒ½å¯¼è‡´æœ€ç»ˆç»“æœè®¡ç®—é”™è¯¯ã€‚ æˆ‘ä»¬éœ€è¦çš„æ˜¯ç›´æ¥å¤„ç†æ•°æ®æµï¼Œè€Œ Flink å°±å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ ç‰©è”ç½‘ï¼ˆIOTï¼‰ ä¸¾ä¾‹ï¼šä¼ æ„Ÿå™¨å®æ—¶æ•°æ®é‡‡é›†å’Œæ˜¾ç¤ºã€å®æ—¶æŠ¥è­¦ï¼Œäº¤é€šè¿è¾“ä¸š ç‰©è”ç½‘æ˜¯æµæ•°æ®è¢«æ™®éåº”ç”¨çš„é¢†åŸŸã€‚å„ç§ä¼ æ„Ÿå™¨ä¸åœè·å¾—æµ‹é‡æ•°æ®ï¼Œå¹¶å°†å®ƒä»¬ä»¥æµçš„å½¢å¼ ä¼ è¾“è‡³æ•°æ®ä¸­å¿ƒã€‚è€Œæ•°æ®ä¸­å¿ƒä¼šå°†æ•°æ®å¤„ç†åˆ†æä¹‹åï¼Œå¾—åˆ°è¿è¡ŒçŠ¶æ€æˆ–è€…æŠ¥è­¦ä¿¡æ¯ï¼Œå®æ—¶åœ°æ˜¾ ç¤ºåœ¨ç›‘æ§å±å¹•ä¸Šã€‚æ‰€ä»¥åœ¨ç‰©è”ç½‘ä¸­ï¼Œä½å»¶è¿Ÿçš„æ•°æ®ä¼ è¾“å’Œå¤„ç†ï¼Œä»¥åŠå‡†ç¡®çš„æ•°æ®åˆ†æé€šå¸¸å¾ˆå…³ é”®ã€‚ äº¤é€šè¿è¾“ä¸šä¹Ÿä½“ç°äº†æµå¤„ç†çš„é‡è¦æ€§ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚ä»Šé«˜é“è¿è¡Œä¸»è¦å°±æ˜¯ä¾é ä¼ æ„Ÿå™¨æ£€æµ‹æ•° æ®ï¼Œæµ‹é‡æ•°æ®åŒ…æ‹¬åˆ—è½¦çš„é€Ÿåº¦å’Œä½ç½®ï¼Œä»¥åŠè½¨é“å‘¨è¾¹çš„çŠ¶å†µã€‚è¿™äº›æ•°æ®ä¼šä»è½¨é“ä¼ ç»™åˆ—è½¦ï¼Œå† ä»åˆ—è½¦ä¼ åˆ°æ²¿é€”çš„å…¶ä»–ä¼ æ„Ÿå™¨ï¼›ä¸æ­¤åŒæ—¶ï¼Œæ•°æ®æŠ¥å‘Šä¹Ÿè¢«å‘é€å›æ§åˆ¶ä¸­å¿ƒã€‚å› ä¸ºåˆ—è½¦å¤„äºé«˜é€Ÿ è¡Œé©¶çŠ¶æ€ï¼Œå› æ­¤æ•°æ®å¤„ç†çš„å®æ—¶æ€§è¦æ±‚æ˜¯æé«˜çš„ã€‚å¦‚æœæµæ•°æ®æ²¡æœ‰è¢«åŠæ—¶æ­£ç¡®å¤„ç†ï¼Œè°ƒæ•´æ„è§ å’Œè­¦å‘Šå°±ä¸èƒ½ç›¸åº”äº§ç”Ÿï¼Œåæœå¯èƒ½ä¼šéå¸¸ä¸¥é‡ã€‚ ç‰©æµé…é€å’ŒæœåŠ¡ä¸š ä¸¾ä¾‹ï¼šè®¢å•çŠ¶æ€å®æ—¶æ›´æ–°ã€é€šçŸ¥ä¿¡æ¯æ¨é€ åœ¨å¾ˆå¤šæœåŠ¡å‹åº”ç”¨ä¸­ï¼Œéƒ½ä¼šæ¶‰åŠè®¢å•çŠ¶æ€çš„æ›´æ–°å’Œé€šçŸ¥çš„æ¨é€ã€‚è¿™äº›ä¿¡æ¯åŸºäºäº‹ä»¶è§¦å‘ï¼Œ ä¸å‡åŒ€åœ°è¿ç»­ä¸æ–­ç”Ÿæˆï¼Œå¤„ç†ä¹‹åéœ€è¦åŠæ—¶ä¼ é€’ç»™ç”¨æˆ·ã€‚è¿™ä¹Ÿæ˜¯éå¸¸å…¸å‹çš„æ•°æ®æµçš„å¤„ç†ã€‚ é“¶è¡Œå’Œé‡‘èä¸š ä¸¾ä¾‹ï¼šå®æ—¶ç»“ç®—å’Œé€šçŸ¥æ¨é€ï¼Œå®æ—¶æ£€æµ‹å¼‚å¸¸è¡Œä¸º é“¶è¡Œå’Œé‡‘èä¸šæ˜¯å¦ä¸€ä¸ªå…¸å‹çš„åº”ç”¨è¡Œä¸šã€‚ç”¨æˆ·çš„äº¤æ˜“è¡Œä¸ºæ˜¯è¿ç»­å¤§é‡å‘ç”Ÿçš„ï¼Œé“¶è¡Œé¢å¯¹çš„ æ˜¯æµ·é‡çš„æµå¼æ•°æ®ã€‚ç”±äºè¦å¤„ç†çš„äº¤æ˜“æ•°æ®é‡å¤ªå¤§ï¼Œä»¥å‰çš„é“¶è¡Œæ˜¯æŒ‰å¤©ç»“ç®—çš„ï¼Œæ±‡æ¬¾ä¸€èˆ¬éƒ½è¦ éš”å¤©æ‰èƒ½åˆ°è´¦ã€‚æ‰€ä»¥æœ‰ä¸€ä¸ªè¯´æ³•å«ä½œâ€œé“¶è¡Œå®¶å·¥ä½œæ—¶é—´â€ï¼Œè¯´çš„å°±æ˜¯é“¶è¡Œå®¶ä¸ä»…ä¸éœ€è¦ 996ï¼Œç”š è‡³ä¸‹åˆæ—©æ—©å°±ä¸‹ç­äº†ï¼šå› ä¸ºé“¶è¡Œéœ€è¦æ—©ç‚¹å…³é—¨è¿›è¡Œç»“ç®—ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ç¬¬äºŒå¤©è¥ä¸šä¹‹å‰ç®—å‡ºå‡† ç¡®çš„è´¦ã€‚è¿™æ˜¾ç„¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬å¿«é€Ÿäº¤æ˜“çš„éœ€æ±‚ã€‚åœ¨å…¨çƒåŒ–ç»æµä¸­ï¼Œèƒ½å¤Ÿæä¾› 24 å°æ—¶æœåŠ¡å˜å¾— è¶Šæ¥è¶Šé‡è¦ã€‚ç°åœ¨äº¤æ˜“å’ŒæŠ¥è¡¨éƒ½ä¼šå¿«é€Ÿå‡†ç¡®åœ°ç”Ÿæˆï¼Œæˆ‘ä»¬è·¨è¡Œè½¬è´¦ä¹Ÿå¯ä»¥åšåˆ°ç¬é—´åˆ°è´¦ï¼Œè¿˜å¯ä»¥æ¥åˆ°å®æ—¶çš„æ¨é€é€šçŸ¥ã€‚è¿™å°±éœ€è¦æˆ‘ä»¬èƒ½å¤Ÿå®æ—¶å¤„ç†æ•°æ®æµã€‚ å¦å¤–ï¼Œä¿¡ç”¨å¡æ¬ºè¯ˆçš„æ£€æµ‹ä¹Ÿéœ€è¦åŠæ—¶çš„ç›‘æ§å’ŒæŠ¥è­¦ã€‚ä¸€äº›é‡‘èäº¤æ˜“å¸‚åœºï¼Œå¯¹å¼‚å¸¸äº¤æ˜“è¡Œä¸º çš„åŠæ—¶æ£€æµ‹å¯ä»¥æ›´å¥½åœ°è¿›è¡Œé£é™©æ§åˆ¶ï¼›è¿˜å¯ä»¥å¯¹å¼‚å¸¸ç™»å½•è¿›è¡Œæ£€æµ‹ï¼Œä»è€Œå‘ç°é’“é±¼å¼æ”»å‡»ï¼Œä» è€Œé¿å…å·¨å¤§çš„æŸå¤±ã€‚ ä¸‰ã€æµå¼è®¡ç®—æ¼”å˜æˆ‘ä»¬å·²ç»äº†è§£ï¼ŒFlink çš„ä¸»è¦åº”ç”¨åœºæ™¯ï¼Œå°±æ˜¯ å¤„ç†å¤§è§„æ¨¡çš„æ•°æ®æµã€‚é‚£ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨ Flink å‘¢ï¼Ÿæ•°æ®å¤„ç†è¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„æ–¹å¼ï¼Ÿè¦è§£ç­”è¿™ä¸ªç–‘æƒ‘ï¼Œæˆ‘ä»¬å°±éœ€è¦å…ˆä»æµå¤„ç†å’Œæ‰¹å¤„ç†çš„æ¦‚å¿µ è®²èµ·ã€‚ 1ã€æµå¤„ç†å’Œæ‰¹å¤„ç†æ•°æ®å¤„ç†æœ‰ä¸åŒçš„æ–¹å¼ã€‚ å¯¹äºå…·ä½“åº”ç”¨æ¥è¯´ï¼Œæœ‰äº›åœºæ™¯æ•°æ®æ˜¯ä¸€ä¸ªä¸€ä¸ªæ¥çš„ï¼Œæ˜¯ä¸€ç»„æœ‰åºçš„æ•°æ®åºåˆ—ï¼Œæˆ‘ä»¬æŠŠå®ƒå«ä½œâ€œæ•°æ®æµâ€ï¼›è€Œæœ‰äº›åœºæ™¯çš„æ•°æ®ï¼Œæœ¬èº«å°±æ˜¯ä¸€æ‰¹åŒæ—¶åˆ°æ¥ï¼Œæ˜¯ä¸€ä¸ªæœ‰é™çš„æ•°æ®é›†ï¼Œè¿™å°±æ˜¯æ‰¹é‡æ•°æ®ï¼ˆæœ‰æ—¶ä¹Ÿç›´æ¥å«æ•°æ®é›†ï¼‰ã€‚ å®¹æ˜“æƒ³åˆ°ï¼Œå¤„ç†æ•°æ®æµï¼Œå½“ç„¶åº”è¯¥â€œæ¥ä¸€ä¸ªå°±å¤„ç†ä¸€ä¸ªâ€ï¼Œè¿™ç§æ•°æ®å¤„ç†æ¨¡å¼å°±å«ä½œæµå¤„ç†ï¼›å› ä¸ºè¿™ç§å¤„ç†æ˜¯å³æ—¶çš„ï¼Œæ‰€ä»¥ä¹Ÿå«å®æ—¶å¤„ç†ã€‚ä¸ä¹‹å¯¹åº”ï¼Œå¤„ç†æ‰¹é‡æ•°æ®è‡ªç„¶å°±åº”è¯¥ä¸€æ‰¹è¯»å…¥ã€ä¸€èµ·è®¡ç®—ï¼Œè¿™ç§æ–¹å¼å°±å«ä½œæ‰¹å¤„ç†ï¼Œä¹Ÿå«ä½œç¦»çº¿å¤„ç†ã€‚ é‚£çœŸå®çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œåˆ°åº•æ˜¯æ•°æ®æµæ›´å¸¸è§ã€è¿˜æ˜¯æ‰¹é‡æ•°æ®æ›´å¸¸è§å‘¢ï¼Ÿ ç”Ÿæ´»ä¸­ï¼Œè¿™ä¸¤ç§å½¢å¼çš„æ•°æ®éƒ½æœ‰ï¼Œå¦‚å›¾ 1-4 æ‰€ç¤ºã€‚æ¯”å¦‚æˆ‘ä»¬æ—¥å¸¸å‘ä¿¡æ¯ï¼Œå¯ä»¥ä¸€å¥ä¸€å¥åœ° è¯´ï¼Œä¹Ÿå¯ä»¥å†™ä¸€å¤§æ®µä¸€èµ·å‘è¿‡å»ã€‚ä¸€å¥ä¸€å¥çš„ä¿¡æ¯ï¼Œå°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„æ•°æ®ï¼Œå®ƒä»¬æ„æˆçš„åºåˆ—å°±æ˜¯ä¸€ä¸ªæ•°æ®æµï¼›è€Œä¸€å¤§æ®µä¿¡æ¯ï¼Œæ˜¯ä¸€ç»„æ•°æ®çš„é›†åˆï¼Œå¯¹åº”å°±æ˜¯æ‰¹é‡æ•°æ®ï¼ˆæ•°æ®é›†ï¼‰ã€‚ å½“ç„¶ï¼Œæœ‰ç»éªŒçš„äººéƒ½ä¼šçŸ¥é“ï¼Œä¸€å¥ä¸€å¥åœ°å‘ï¼Œä½ ä¸€è¨€æˆ‘ä¸€è¯­ï¼Œæœ‰æ¥æœ‰å¾€è¿™æ‰å«èŠå¤©ï¼›ä¸€å¤§ æ®µä¿¡æ¯ç›´æ¥ç ¸è¿‡å»ï¼Œåˆ«äººçœ‹ç€éƒ½çœ¼æ™•ï¼Œå¾ˆå®¹æ˜“å°±æ²¡ä¸‹æ–‡äº†â€”â€”å¦‚æœæ˜¯å¾ˆé‡è¦çš„æ•´ç¯‡å†…å®¹ï¼ˆæ¯”å¦‚ è¡¨ç™½ä¿¡ï¼‰ï¼Œå†™æˆæ–‡æ¡£æˆ–è€…é‚®ä»¶å‘è¿‡å»å¯èƒ½æ•ˆæœä¼šæ›´å¥½ã€‚ æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°ï¼Œâ€œèŠå¤©â€è¿™ä¸ªç”Ÿæ´»åœºæ™¯ï¼Œæ•°æ®çš„ç”Ÿæˆã€ä¼ é€’å’Œæ¥æ”¶å¤„ç†ï¼Œéƒ½æ˜¯æµå¼çš„ï¼›è€Œ â€œå†™ä¿¡â€çš„åœºæ™¯ï¼Œæ•°æ®çš„ç”Ÿæˆå°½ç®¡åº”è¯¥ä¹Ÿæ˜¯æµå¼çš„ï¼ˆå­—æ€»å¾—ä¸€ä¸ªä¸ªå†™ï¼‰ï¼Œä½†æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æ”¶é›†èµ·æ¥ï¼Œç»Ÿä¸€ä¼ è¾“ã€ç»Ÿä¸€å¤„ç†ï¼ˆå½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥è¾ƒçœŸï¼šå¤„ç†ä¹Ÿæ˜¯æµå¼çš„ï¼Œå­—å¾—ä¸€ä¸ªä¸€ä¸ªè¯»ï¼‰ã€‚ ä¸è®ºä¼ è¾“å¤„ç†çš„æ–¹å¼æ˜¯æ€æ ·çš„ï¼Œæ•°æ®çš„ç”Ÿæˆï¼Œä¸€èˆ¬éƒ½æ˜¯æµå¼çš„ã€‚ 2ã€ä¼ ç»Ÿäº‹åŠ¡å¤„ç†IT äº’è”ç½‘å…¬å¸å¾€å¾€ä¼šç”¨ä¸åŒçš„åº”ç”¨ç¨‹åºæ¥å¤„ç†å„ç§ä¸šåŠ¡ã€‚æ¯”å¦‚å†…éƒ¨ä½¿ç”¨çš„ä¼ä¸šèµ„æºè§„åˆ’ ï¼ˆERPï¼‰ç³»ç»Ÿã€å®¢æˆ·å…³ç³»ç®¡ç†ï¼ˆCRMï¼‰ç³»ç»Ÿï¼Œè¿˜æœ‰é¢å‘å®¢æˆ·çš„ Web åº”ç”¨ç¨‹åºã€‚è¿™äº›ç³»ç»Ÿä¸€èˆ¬éƒ½ ä¼šè¿›è¡Œåˆ†å±‚è®¾è®¡ï¼šâ€œè®¡ç®—å±‚â€å°±æ˜¯åº”ç”¨ç¨‹åºæœ¬èº«ï¼Œç”¨äºæ•°æ®è®¡ç®—å’Œå¤„ç†ï¼›è€Œâ€œå­˜å‚¨å±‚â€å¾€å¾€æ˜¯ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼Œç”¨äºæ•°æ®å­˜å‚¨ï¼Œå¦‚å›¾ æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œçš„åº”ç”¨ç¨‹åºåœ¨å¤„ç†æ•°æ®çš„æ¨¡å¼ä¸Šæœ‰å…±åŒä¹‹å¤„ï¼šæ¥æ”¶çš„æ•°æ®æ˜¯æŒç»­ç”Ÿæˆçš„äº‹ ä»¶ï¼Œæ¯”å¦‚ç”¨æˆ·çš„ç‚¹å‡»è¡Œä¸ºï¼Œå®¢æˆ·ä¸‹çš„è®¢å•ï¼Œæˆ–è€…æ“ä½œäººå‘˜å‘å‡ºçš„è¯·æ±‚ã€‚å¤„ç†äº‹ä»¶æ—¶ï¼Œåº”ç”¨ç¨‹åº éœ€è¦å…ˆè¯»å–è¿œç¨‹æ•°æ®åº“çš„çŠ¶æ€ï¼Œç„¶åæŒ‰ç…§å¤„ç†é€»è¾‘å¾—åˆ°ç»“æœï¼Œå°†å“åº”è¿”å›ç»™ç”¨æˆ·ï¼Œå¹¶æ›´æ–°æ•°æ®åº“çŠ¶æ€ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªæ•°æ®åº“ç³»ç»Ÿå¯ä»¥æœåŠ¡äºå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒä»¬æœ‰æ—¶ä¼šè®¿é—®ç›¸åŒçš„æ•°æ®åº“æˆ–è¡¨ å¯¹äºå„ç§äº‹ä»¶è¯·æ±‚ï¼Œäº‹åŠ¡å¤„ç†çš„æ–¹å¼èƒ½å¤Ÿä¿è¯å®æ—¶å“åº”ï¼Œå¥½å¤„æ˜¯ä¸€ç›®äº†ç„¶çš„ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œè¿™æ ·çš„æ¶æ„å¯¹è¡¨å’Œæ•°æ®åº“çš„è®¾è®¡è¦æ±‚å¾ˆé«˜ï¼›å½“æ•°æ®è§„æ¨¡è¶Šæ¥è¶Šåºå¤§ã€ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚æ—¶ï¼Œå¯èƒ½éœ€è¦å¯¹è¡¨è¿›è¡Œé‡æ„ï¼Œè€Œä¸”ä¸€æ¬¡è”è¡¨æŸ¥è¯¢ä¹Ÿä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ï¼Œç”šè‡³ä¸èƒ½åŠæ—¶å¾—åˆ°è¿”å›ç»“æœã€‚äºæ˜¯ï¼Œä½œä¸ºç¨‹åºå‘˜å°±åªå¥½å°†æ›´å¤šçš„ç²¾åŠ›æ”¾åœ¨è¡¨çš„è®¾è®¡å’Œé‡æ„ï¼Œä»¥åŠ SQL çš„è°ƒä¼˜ä¸Šï¼Œè€Œæ— æ³•ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°äº†â€”â€”æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè¿™ç§å·¥ä½œè´¹åŠ›è´¹æ—¶ï¼Œå´æ²¡æ³•ç›´æ¥ä½“ç°åœ¨äº§å“ä¸Šç»™è€æ¿çœ‹ï¼Œç®€ç›´å°±æ˜¯å™©æ¢¦ã€‚ é‚£æœ‰æ²¡æœ‰æ›´åˆç†ã€æ›´é«˜æ•ˆçš„å¤„ç†æ¶æ„å‘¢ï¼Ÿâ†“ 3ã€æœ‰çŠ¶æ€çš„æµå¤„ç†ä¸éš¾æƒ³åˆ°ï¼Œå¦‚æœæˆ‘ä»¬å¯¹äºäº‹ä»¶æµçš„å¤„ç†éå¸¸ç®€å•ï¼Œä¾‹å¦‚æ”¶åˆ°ä¸€æ¡è¯·æ±‚å°±è¿”å›ä¸€ä¸ªâ€œæ”¶åˆ°â€ï¼Œé‚£å°±å¯ä»¥çœå»æ•°æ®åº“çš„æŸ¥è¯¢å’Œæ›´æ–°äº†ã€‚ä½†æ˜¯è¿™æ ·çš„å¤„ç†æ˜¯æ²¡ä»€ä¹ˆå®é™…æ„ä¹‰çš„ã€‚åœ¨ç°å®çš„åº”ç”¨ä¸­ï¼Œå¾€å¾€éœ€è¦è¿˜å…¶ä»–ä¸€äº›é¢å¤–æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥æŠŠéœ€è¦çš„é¢å¤–æ•°æ®ä¿å­˜æˆä¸€ä¸ªâ€œçŠ¶æ€â€ï¼Œç„¶åé’ˆå¯¹è¿™æ¡æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”æ›´æ–°çŠ¶æ€ã€‚åœ¨ä¼ ç»Ÿæ¶æ„ä¸­ï¼Œè¿™ä¸ªçŠ¶æ€å°±æ˜¯ä¿å­˜åœ¨æ•°æ®åº“é‡Œçš„ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œæœ‰çŠ¶æ€çš„æµå¤„ç†â€ã€‚ ä¸ºäº†åŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†çŠ¶æ€ä¿å­˜åœ¨æœ¬åœ°å†…å­˜ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ å½“åº”ç”¨æ”¶åˆ°ä¸€ä¸ªæ–°äº‹ä»¶æ—¶ï¼Œå®ƒå¯ä»¥ä»çŠ¶æ€ä¸­è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ›´æ–°çŠ¶æ€ã€‚è€Œå½“çŠ¶æ€æ˜¯ä»å†…å­˜ä¸­è¯»å†™çš„æ—¶å€™ï¼Œè¿™å°±å’Œè®¿é—®æœ¬åœ°å˜é‡æ²¡ä»€ä¹ˆåŒºåˆ«äº†ï¼Œå®æ—¶æ€§å¯ä»¥å¾—åˆ°æå¤§çš„æå‡ã€‚ å¦å¤–ï¼Œæ•°æ®è§„æ¨¡å¢å¤§æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦åšé‡æ„ï¼Œåªéœ€è¦æ„å»ºåˆ†å¸ƒå¼é›†ç¾¤ï¼Œå„è‡ªåœ¨æœ¬åœ°è®¡ç®—å°±å¯ä»¥äº†ï¼Œå¯æ‰©å±•æ€§ä¹Ÿå˜å¾—æ›´å¥½ã€‚ å› ä¸ºé‡‡ç”¨çš„æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¿æŠ¤æœ¬åœ°çŠ¶æ€ï¼Œé˜²æ­¢åœ¨æ•…éšœæ—¶æ•°æ®ä¸¢å¤±ã€‚æˆ‘ä»¬å¯ä»¥å®šæœŸåœ°å°†åº”ç”¨çŠ¶æ€çš„ä¸€è‡´æ€§æ£€æŸ¥ç‚¹ï¼ˆcheckpointï¼‰å­˜ç›˜ï¼Œå†™å…¥è¿œç¨‹çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œé‡åˆ°æ•…éšœæ—¶å†å»è¯»å–è¿›è¡Œæ¢å¤ï¼Œè¿™æ ·å°±ä¿è¯äº†æ›´å¥½çš„å®¹é”™æ€§ã€‚ 4ã€æœ‰çŠ¶æ€æµæ¶æ„1ã€äº‹ä»¶é©±åŠ¨å‹ï¼ˆEvent-Drivenï¼‰åº”ç”¨ äº‹ä»¶é©±åŠ¨å‹åº”ç”¨æ˜¯ä¸€ç±»å…·æœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œå®ƒä»ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶æµæå–æ•°æ®ï¼Œå¹¶æ ¹æ®åˆ°æ¥çš„ äº‹ä»¶è§¦å‘è®¡ç®—ã€çŠ¶æ€æ›´æ–°æˆ–å…¶ä»–å¤–éƒ¨åŠ¨ä½œã€‚æ¯”è¾ƒå…¸å‹çš„å°±æ˜¯ä»¥ Kafka ä¸ºä»£è¡¨çš„æ¶ˆæ¯é˜Ÿåˆ—å‡ ä¹éƒ½ æ˜¯äº‹ä»¶é©±åŠ¨å‹åº”ç”¨ã€‚ è¿™å…¶å®è·Ÿä¼ ç»Ÿäº‹åŠ¡å¤„ç†æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºåŸºäºæœ‰çŠ¶æ€æµå¤„ç†çš„äº‹ä»¶é©±åŠ¨åº”ç”¨ï¼Œä¸ å†éœ€è¦æŸ¥è¯¢è¿œç¨‹æ•°æ®åº“ï¼Œè€Œæ˜¯åœ¨æœ¬åœ°è®¿é—®å®ƒä»¬çš„æ•°æ®ï¼Œå¦‚å›¾ä¸Šæ‰€ç¤ºï¼Œè¿™æ ·åœ¨ååé‡å’Œå»¶è¿Ÿæ–¹ é¢å°±å¯ä»¥æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚ å¦å¤–è¿œç¨‹æŒä¹…æ€§å­˜å‚¨çš„æ£€æŸ¥ç‚¹ä¿è¯äº†åº”ç”¨å¯ä»¥ä»æ•…éšœä¸­æ¢å¤ã€‚æ£€æŸ¥ç‚¹å¯ä»¥å¼‚æ­¥å’Œå¢é‡åœ°å®Œ æˆï¼Œå› æ­¤å¯¹æ­£å¸¸è®¡ç®—çš„å½±å“éå¸¸å° 2ã€æ•°æ®åˆ†æï¼ˆData Analysisï¼‰å‹åº”ç”¨ æ‰€è°“çš„æ•°æ®åˆ†æï¼Œå°±æ˜¯ä»åŸå§‹æ•°æ®ä¸­æå–ä¿¡æ¯å’Œå‘æ˜è§„å¾‹ã€‚ä¼ ç»Ÿä¸Šï¼Œæ•°æ®åˆ†æä¸€èˆ¬æ˜¯å…ˆå°† æ•°æ®å¤åˆ¶åˆ°æ•°æ®ä»“åº“ï¼ˆData Warehouseï¼‰ï¼Œç„¶åè¿›è¡Œæ‰¹é‡æŸ¥è¯¢ã€‚å¦‚æœæ•°æ®æœ‰äº†æ›´æ–°ï¼Œå¿…é¡»å°†æœ€ æ–°æ•°æ®æ·»åŠ åˆ°è¦åˆ†æçš„æ•°æ®é›†ä¸­ï¼Œç„¶åé‡æ–°è¿è¡ŒæŸ¥è¯¢æˆ–åº”ç”¨ç¨‹åºã€‚ å¦‚ä»Šï¼ŒApache Hadoop ç”Ÿæ€ç³»ç»Ÿçš„ç»„ä»¶ï¼Œå·²ç»æ˜¯è®¸å¤šä¼ä¸šå¤§æ•°æ®æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„ç»„æˆéƒ¨ åˆ†ã€‚ç°åœ¨çš„åšæ³•ä¸€èˆ¬æ˜¯å°†å¤§é‡æ•°æ®ï¼ˆå¦‚æ—¥å¿—æ–‡ä»¶ï¼‰å†™å…¥ Hadoop çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆHDFSï¼‰ã€ S3 æˆ– HBase ç­‰æ‰¹é‡å­˜å‚¨æ•°æ®åº“ï¼Œä»¥è¾ƒä½çš„æˆæœ¬è¿›è¡Œå¤§å®¹é‡å­˜å‚¨ã€‚ç„¶åå¯ä»¥é€šè¿‡ SQL-on-Hadoop ç±»çš„å¼•æ“æŸ¥è¯¢å’Œå¤„ç†æ•°æ®ï¼Œæ¯”å¦‚å¤§å®¶ç†Ÿæ‚‰çš„ Hiveã€‚è¿™ç§å¤„ç†æ–¹å¼ï¼Œæ˜¯å…¸å‹çš„æ‰¹å¤„ç†ï¼Œç‰¹ç‚¹æ˜¯ å¯ä»¥å¤„ç†æµ·é‡æ•°æ®ï¼Œä½†å®æ—¶æ€§è¾ƒå·®ï¼Œæ‰€ä»¥ä¹Ÿå«ç¦»çº¿åˆ†æã€‚ å¦‚æœæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå¤æ‚çš„æµå¤„ç†å¼•æ“ï¼Œæ•°æ®åˆ†æå…¶å®ä¹Ÿå¯ä»¥å®æ—¶æ‰§è¡Œã€‚æµå¼æŸ¥è¯¢æˆ–åº”ç”¨ç¨‹ åºä¸æ˜¯è¯»å–æœ‰é™çš„æ•°æ®é›†ï¼Œè€Œæ˜¯æ¥æ”¶å®æ—¶äº‹ä»¶æµï¼Œä¸æ–­ç”Ÿæˆå’Œæ›´æ–°ç»“æœã€‚ç»“æœè¦ä¹ˆå†™å…¥å¤–éƒ¨æ•° æ®åº“ï¼Œè¦ä¹ˆä½œä¸ºå†…éƒ¨çŠ¶æ€è¿›è¡Œç»´æŠ¤ã€‚ Apache Flink åŒæ—¶æ”¯æŒæµå¼ä¸æ‰¹å¤„ç†çš„æ•°æ®åˆ†æåº”ç”¨ ä¸æ‰¹å¤„ç†åˆ†æç›¸æ¯”ï¼Œæµå¤„ç†åˆ†ææœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯ä½å»¶è¿Ÿï¼ŒçœŸæ­£å®ç°äº†å®æ—¶ã€‚å¦å¤–ï¼Œæµå¤„ç† ä¸éœ€è¦å»å•ç‹¬è€ƒè™‘æ–°æ•°æ®çš„å¯¼å…¥å’Œå¤„ç†ï¼Œå®æ—¶æ›´æ–°æœ¬æ¥å°±æ˜¯æµå¤„ç†çš„åŸºæœ¬æ¨¡å¼ã€‚å½“å‰ä¼ä¸šå¯¹æµ å¼æ•°æ®å¤„ç†çš„ä¸€ä¸ªçƒ­ç‚¹åº”ç”¨å°±æ˜¯å®æ—¶æ•°ä»“ï¼Œå¾ˆå¤šå…¬å¸æ­£æ˜¯åŸºäº Flink æ¥å®ç°çš„ã€‚ 3ã€æ•°æ®ç®¡é“ï¼ˆData Pipelineï¼‰å‹åº”ç”¨ å¦‚å›¾ï¼ŒETL ä¸æ•°æ®ç®¡é“ä¹‹é—´çš„åŒºåˆ« ETL ä¹Ÿå°±æ˜¯æ•°æ®çš„æå–ã€è½¬æ¢ã€åŠ è½½ï¼Œæ˜¯åœ¨å­˜å‚¨ç³»ç»Ÿä¹‹é—´è½¬æ¢å’Œç§»åŠ¨æ•°æ®çš„å¸¸ç”¨æ–¹æ³•ã€‚ åœ¨æ•°æ®åˆ†æçš„åº”ç”¨ä¸­ï¼Œé€šå¸¸ä¼šå®šæœŸè§¦å‘ ETL ä»»åŠ¡ï¼Œå°†æ•°æ®ä»äº‹åŠ¡æ•°æ®åº“ç³»ç»Ÿå¤åˆ¶åˆ°åˆ†ææ•°æ® åº“æˆ–æ•°æ®ä»“åº“ã€‚ æ‰€è°“æ•°æ®ç®¡é“çš„ä½œç”¨ä¸ ETL ç±»ä¼¼ã€‚å®ƒä»¬å¯ä»¥è½¬æ¢å’Œæ‰©å±•æ•°æ®ï¼Œä¹Ÿå¯ä»¥åœ¨å­˜å‚¨ç³»ç»Ÿä¹‹é—´ç§» åŠ¨æ•°æ®ã€‚ä¸è¿‡å¦‚æœæˆ‘ä»¬ç”¨æµå¤„ç†æ¶æ„æ¥æ­å»ºæ•°æ®ç®¡é“ï¼Œè¿™äº›å·¥ä½œå°±å¯ä»¥è¿ç»­è¿è¡Œï¼Œè€Œä¸éœ€è¦å† å»å‘¨æœŸæ€§è§¦å‘äº†ã€‚æ¯”å¦‚ï¼Œæ•°æ®ç®¡é“å¯ä»¥ç”¨æ¥ç›‘æ§æ–‡ä»¶ç³»ç»Ÿç›®å½•ä¸­çš„æ–°æ–‡ä»¶ï¼Œå°†æ•°æ®å†™å…¥äº‹ä»¶æ—¥ å¿—ã€‚è¿ç»­æ•°æ®ç®¡é“çš„æ˜æ˜¾ä¼˜åŠ¿æ˜¯å‡å°‘äº†å°†æ•°æ®ç§»åŠ¨åˆ°ç›®çš„åœ°çš„å»¶è¿Ÿï¼Œè€Œä¸”æ›´åŠ é€šç”¨ï¼Œå¯ä»¥ç”¨äº æ›´å¤šçš„åœºæ™¯ã€‚ 4ã€Lambda æ¶æ„ å¯¹äºæœ‰çŠ¶æ€çš„æµå¤„ç†ï¼Œå½“æ•°æ®è¶Šæ¥è¶Šå¤šæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»ç”¨åˆ†å¸ƒå¼çš„é›†ç¾¤æ¶æ„æ¥è·å–æ›´å¤§çš„å åé‡ã€‚ä½†æ˜¯åˆ†å¸ƒå¼æ¶æ„ä¼šå¸¦æ¥å¦ä¸€ä¸ªé—®é¢˜ï¼šæ€æ ·ä¿è¯æ•°æ®å¤„ç†çš„é¡ºåºæ˜¯æ­£ç¡®çš„å‘¢ï¼Ÿ å¯¹äºæ‰¹å¤„ç†æ¥è¯´ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å› ä¸ºæ‰€æœ‰æ•°æ®éƒ½å·²æ”¶é›†å®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦é€‰ æ‹©ã€æ’åˆ—æ•°æ®ï¼Œå¾—åˆ°æƒ³è¦çš„ç»“æœã€‚å¯å¦‚æœæˆ‘ä»¬é‡‡ç”¨â€œæ¥ä¸€ä¸ªå¤„ç†ä¸€ä¸ªâ€çš„æµå¤„ç†ï¼Œå°±å¯èƒ½å‡ºç° â€œä¹±åºâ€çš„ç°è±¡ï¼šæœ¬æ¥å…ˆå‘ç”Ÿçš„äº‹ä»¶ï¼Œå› ä¸ºåˆ†å¸ƒå¤„ç†çš„åŸå› æ»åäº†ã€‚æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ ä»¥ Storm ä¸ºä»£è¡¨çš„ç¬¬ä¸€ä»£åˆ†å¸ƒå¼å¼€æºæµå¤„ç†å™¨ï¼Œä¸»è¦ä¸“æ³¨äºå…·æœ‰æ¯«ç§’å»¶è¿Ÿçš„äº‹ä»¶å¤„ç†ï¼Œç‰¹ ç‚¹å°±æ˜¯ä¸€ä¸ªå­—â€œå¿«â€ï¼›è€Œå¯¹äºå‡†ç¡®æ€§å’Œç»“æœçš„ä¸€è‡´æ€§ï¼Œæ˜¯ä¸æä¾›å†…ç½®æ”¯æŒçš„ï¼Œå› ä¸ºç»“æœæœ‰å¯èƒ½ å–å†³äºåˆ°è¾¾äº‹ä»¶çš„æ—¶é—´å’Œé¡ºåºã€‚å¦å¤–ï¼Œç¬¬ä¸€ä»£æµå¤„ç†å™¨é€šè¿‡æ£€æŸ¥ç‚¹æ¥ä¿è¯å®¹é”™æ€§ï¼Œä½†æ˜¯æ•…éšœæ¢ å¤çš„æ—¶å€™ï¼Œå³ä½¿äº‹ä»¶ä¸ä¼šä¸¢å¤±ï¼Œä¹Ÿæœ‰å¯èƒ½è¢«é‡å¤å¤„ç†â€”â€”æ‰€ä»¥æ— æ³•ä¿è¯ exactly-onceã€‚ ä¸æ‰¹å¤„ç†å™¨ç›¸æ¯”ï¼Œå¯ä»¥è¯´ç¬¬ä¸€ä»£æµå¤„ç†å™¨ç‰ºç‰²äº†ç»“æœçš„å‡†ç¡®æ€§ï¼Œç”¨æ¥æ¢å–æ›´ä½çš„å»¶è¿Ÿã€‚è€Œ æ‰¹å¤„ç†å™¨æ°å¥½åè¿‡æ¥ï¼Œç‰ºç‰²äº†å®æ—¶æ€§ï¼Œæ¢å–äº†ç»“æœçš„å‡†ç¡® æˆ‘ä»¬è‡ªç„¶æƒ³åˆ°ï¼Œå¦‚æœå¯ä»¥è®©äºŒè€…åšä¸ªç»“åˆï¼Œä¸å°±å¯ä»¥åŒæ—¶æä¾›å¿«é€Ÿå’Œå‡†ç¡®çš„ç»“æœäº†å—ï¼Ÿæ­£ æ˜¯åŸºäºè¿™æ ·çš„æ€æƒ³ï¼ŒLambda æ¶æ„è¢«è®¾è®¡å‡ºæ¥ï¼Œå¦‚ä¸Šå›¾ã€‚æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™æ˜¯ç¬¬äºŒä»£æµå¤„ ç†æ¶æ„ï¼Œä½†äº‹å®ä¸Šï¼Œå®ƒåªæ˜¯ç¬¬ä¸€ä»£æµå¤„ç†å™¨å’Œæ‰¹å¤„ç†å™¨çš„ç®€å•åˆå¹¶ã€‚ 5ã€æ–°ä¸€ä»£æµå¤„ç†å™¨ ä¹‹å‰çš„åˆ†å¸ƒå¼æµå¤„ç†æ¶æ„ï¼Œéƒ½æœ‰æ˜æ˜¾çš„ç¼ºé™·ï¼Œäººä»¬ä¹Ÿä¸€ç›´æ²¡æœ‰æ”¾å¼ƒå¯¹æµå¤„ç†å™¨çš„æ”¹è¿›å’Œå®Œ å–„ã€‚ç»ˆäºï¼Œåœ¨åŸæœ‰æµå¤„ç†å™¨çš„åŸºç¡€ä¸Šï¼Œæ–°ä¸€ä»£åˆ†å¸ƒå¼å¼€æºæµå¤„ç†å™¨è¯ç”Ÿäº†ã€‚ä¸ºäº†ä¸ä¹‹å‰çš„ç³»ç»Ÿ åŒºåˆ†ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºç¬¬ä¸‰ä»£æµå¤„ç†å™¨ï¼Œä»£è¡¨å½“ç„¶å°±æ˜¯ Flinkã€‚ ç¬¬ä¸‰ä»£æµå¤„ç†å™¨é€šè¿‡å·§å¦™çš„è®¾è®¡ï¼Œå®Œç¾è§£å†³äº†ä¹±åºæ•°æ®å¯¹ç»“æœæ­£ç¡®æ€§çš„å½±å“ã€‚è¿™ä¸€ä»£ç³»ç»Ÿ è¿˜åšåˆ°äº†ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly-onceï¼‰çš„ä¸€è‡´æ€§ä¿éšœï¼Œæ˜¯ç¬¬ä¸€ä¸ªå…·æœ‰ä¸€è‡´æ€§å’Œå‡†ç¡®ç»“æœçš„å¼€æºæµ å¤„ç†å™¨ã€‚å¦å¤–ï¼Œå…ˆå‰çš„æµå¤„ç†å™¨ä»…èƒ½åœ¨é«˜ååå’Œä½å»¶è¿Ÿä¸­äºŒé€‰ä¸€ï¼Œè€Œæ–°ä¸€ä»£ç³»ç»Ÿèƒ½å¤ŸåŒæ—¶æä¾› è¿™ä¸¤ä¸ªç‰¹æ€§ã€‚æ‰€ä»¥å¯ä»¥è¯´ï¼Œè¿™ä¸€ä»£æµå¤„ç†å™¨ä»…å‡­ä¸€å¥—ç³»ç»Ÿå°±å®Œæˆäº† Lambda æ¶æ„ä¸¤å¥—ç³»ç»Ÿçš„å·¥ ä½œï¼Œå®ƒçš„å‡ºç°ä½¿å¾— Lambda æ¶æ„é»¯ç„¶å¤±è‰²ã€‚ é™¤äº†ä½å»¶è¿Ÿã€å®¹é”™å’Œç»“æœå‡†ç¡®æ€§ä¹‹å¤–ï¼Œæ–°ä¸€ä»£æµå¤„ç†å™¨è¿˜åœ¨ä¸æ–­æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œä¾‹å¦‚é«˜å¯ ç”¨çš„è®¾ç½®ï¼Œä»¥åŠä¸èµ„æºç®¡ç†å™¨ï¼ˆå¦‚ YARN æˆ– Kubernetesï¼‰çš„ç´§å¯†é›†æˆç­‰ç­‰ã€‚ å››ã€Flink çš„ç‰¹æ€§æ€»ç»“Flink æ˜¯ç¬¬ä¸‰ä»£åˆ†å¸ƒå¼æµå¤„ç†å™¨ï¼Œå®ƒçš„åŠŸèƒ½ä¸°å¯Œè€Œå¼ºå¤§ã€‚ 1ã€æ ¸å¿ƒç‰¹æ€§ é«˜ååå’Œä½å»¶è¿Ÿã€‚æ¯ç§’å¤„ç†æ•°ç™¾ä¸‡ä¸ªäº‹ä»¶ï¼Œæ¯«ç§’çº§å»¶è¿Ÿã€‚ ç»“æœçš„å‡†ç¡®æ€§ã€‚Flink æä¾›äº†äº‹ä»¶æ—¶é—´ï¼ˆevent-timeï¼‰å’Œå¤„ç†æ—¶é—´ï¼ˆprocessing-timeï¼‰ è¯­ä¹‰ã€‚å¯¹äºä¹±åºäº‹ä»¶æµï¼Œäº‹ä»¶æ—¶é—´è¯­ä¹‰ä»ç„¶èƒ½æä¾›ä¸€è‡´ä¸”å‡†ç¡®çš„ç»“æœã€‚ ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly-onceï¼‰çš„çŠ¶æ€ä¸€è‡´æ€§ä¿è¯ã€‚ å¯ä»¥è¿æ¥åˆ°æœ€å¸¸ç”¨çš„å­˜å‚¨ç³»ç»Ÿï¼Œå¦‚ Apache Kafkaã€Apache Cassandraã€Elasticsearchã€ JDBCã€Kinesis å’Œï¼ˆåˆ†å¸ƒå¼ï¼‰æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ HDFS å’Œ S3ã€‚ é«˜å¯ç”¨ã€‚æœ¬èº«é«˜å¯ç”¨çš„è®¾ç½®ï¼ŒåŠ ä¸Šä¸ K8sï¼ŒYARN å’Œ Mesos çš„ç´§å¯†é›†æˆï¼Œå†åŠ ä¸Šä»æ•… éšœä¸­å¿«é€Ÿæ¢å¤å’ŒåŠ¨æ€æ‰©å±•ä»»åŠ¡çš„èƒ½åŠ›ï¼ŒFlink èƒ½åšåˆ°ä»¥æå°‘çš„åœæœºæ—¶é—´ 7Ã—24 å…¨å¤©å€™ è¿è¡Œ èƒ½å¤Ÿæ›´æ–°åº”ç”¨ç¨‹åºä»£ç å¹¶å°†ä½œä¸šï¼ˆjobsï¼‰è¿ç§»åˆ°ä¸åŒçš„ Flink é›†ç¾¤ï¼Œè€Œä¸ä¼šä¸¢å¤±åº”ç”¨ ç¨‹åºçš„çŠ¶æ€ã€‚ 2ã€åˆ†å±‚ APIé™¤äº†ä¸Šè¿°è¿™äº›ç‰¹æ€§ä¹‹å¤–ï¼ŒFlink è¿˜æ˜¯ä¸€ä¸ªéå¸¸æ˜“äºå¼€å‘çš„æ¡†æ¶ï¼Œå› ä¸ºå®ƒæ‹¥æœ‰æ˜“äºä½¿ç”¨çš„åˆ†å±‚ APIï¼Œæ•´ä½“ API åˆ†å±‚å¦‚å›¾ï¼š æœ€åº•å±‚çº§çš„æŠ½è±¡ä»…ä»…æä¾›äº†æœ‰çŠ¶æ€æµï¼Œå®ƒå°†å¤„ç†å‡½æ•°ï¼ˆProcess Functionï¼‰åµŒå…¥åˆ°äº† DataStream API ä¸­ã€‚åº•å±‚å¤„ç†å‡½æ•°ï¼ˆProcess Functionï¼‰ä¸ DataStream API ç›¸é›†æˆï¼Œå¯ä»¥å¯¹æŸ äº›æ“ä½œè¿›è¡ŒæŠ½è±¡ï¼Œå®ƒå…è®¸ç”¨æˆ·å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çŠ¶æ€å¤„ç†æ¥è‡ªä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®æµçš„äº‹ä»¶ï¼Œä¸”çŠ¶æ€ å…·æœ‰ä¸€è‡´æ€§å’Œå®¹é”™ä¿è¯ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œäº‹ä»¶æ—¶é—´å¹¶å¤„ç†æ—¶é—´å›è°ƒï¼Œä»è€Œä½¿ç¨‹åºå¯ä»¥ å¤„ç†å¤æ‚çš„è®¡ç®—ã€‚ å®é™…ä¸Šï¼Œå¤§å¤šæ•°åº”ç”¨å¹¶ä¸éœ€è¦ä¸Šè¿°çš„åº•å±‚æŠ½è±¡ï¼Œè€Œæ˜¯ç›´æ¥é’ˆå¯¹æ ¸å¿ƒ APIï¼ˆCore APIsï¼‰ è¿› è¡Œç¼–ç¨‹ï¼Œæ¯”å¦‚ DataStream APIï¼ˆç”¨äºå¤„ç†æœ‰ç•Œæˆ–æ— ç•Œæµæ•°æ®ï¼‰ä»¥åŠ DataSet APIï¼ˆç”¨äºå¤„ç†æœ‰ç•Œ æ•°æ®é›†ï¼‰ã€‚è¿™äº› API ä¸ºæ•°æ®å¤„ç†æä¾›äº†é€šç”¨çš„æ„å»ºæ¨¡å—ï¼Œæ¯”å¦‚ç”±ç”¨æˆ·å®šä¹‰çš„å¤šç§å½¢å¼çš„è½¬æ¢ ï¼ˆtransformationsï¼‰ã€è¿æ¥ï¼ˆjoinsï¼‰ã€èšåˆï¼ˆaggregationsï¼‰ã€çª—å£ï¼ˆwindowsï¼‰æ“ä½œç­‰ã€‚ äº”ã€Flink vs Spark1ã€æ•°æ®å¤„ç†æ¶æ„æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œæ•°æ®å¤„ç†çš„åŸºæœ¬æ–¹å¼ï¼Œå¯ä»¥åˆ†ä¸ºæ‰¹å¤„ç†å’Œæµå¤„ç†ä¸¤ç§ã€‚ æ‰¹å¤„ç†é’ˆå¯¹çš„æ˜¯æœ‰ç•Œæ•°æ®é›†ï¼Œéå¸¸é€‚åˆéœ€è¦è®¿é—®æµ·é‡çš„å…¨éƒ¨æ•°æ®æ‰èƒ½å®Œæˆçš„è®¡ç®—å·¥ä½œï¼Œä¸€ èˆ¬ç”¨äºç¦»çº¿ç»Ÿè®¡ã€‚ æµå¤„ç†ä¸»è¦é’ˆå¯¹çš„æ˜¯æ•°æ®æµï¼Œç‰¹ç‚¹æ˜¯æ— ç•Œã€å®æ—¶, å¯¹ç³»ç»Ÿä¼ è¾“çš„æ¯ä¸ªæ•°æ®ä¾æ¬¡æ‰§è¡Œæ“ä½œï¼Œ ä¸€èˆ¬ç”¨äºå®æ—¶ç»Ÿè®¡ã€‚ ä»æ ¹æœ¬ä¸Šè¯´ï¼ŒSpark å’Œ Flink é‡‡ç”¨äº†å®Œå…¨ä¸åŒçš„æ•°æ®å¤„ç†æ–¹å¼ã€‚å¯ä»¥è¯´ï¼Œä¸¤è€…çš„ä¸–ç•Œè§‚æ˜¯ æˆªç„¶ç›¸åçš„ã€‚ Spark ä»¥æ‰¹å¤„ç†ä¸ºæ ¹æœ¬ï¼Œå¹¶å°è¯•åœ¨æ‰¹å¤„ç†ä¹‹ä¸Šæ”¯æŒæµè®¡ç®—ï¼›åœ¨ Spark çš„ä¸–ç•Œè§‚ä¸­ï¼Œä¸‡ç‰©çš†æ‰¹æ¬¡ï¼Œç¦»çº¿æ•°æ®æ˜¯ä¸€ä¸ªå¤§æ‰¹æ¬¡ï¼Œè€Œå®æ—¶æ•°æ®åˆ™æ˜¯ç”±ä¸€ä¸ªä¸€ä¸ªæ— é™çš„å°æ‰¹æ¬¡ç»„æˆçš„ã€‚æ‰€ä»¥å¯¹äºæµå¤„ç†æ¡†æ¶ Spark Streaming è€Œè¨€ï¼Œå…¶å®å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„â€œæµâ€å¤„ç†ï¼Œè€Œæ˜¯â€œå¾®æ‰¹æ¬¡â€ ï¼ˆmicro-batchingï¼‰å¤„ç† 1.æ— ç•Œæ•°æ®æµæ‰€è°“æ— ç•Œæ•°æ®æµï¼Œå°±æ˜¯æœ‰å¤´æ²¡å°¾ï¼Œæ•°æ®çš„ç”Ÿæˆå’Œä¼ é€’ä¼šå¼€å§‹ä½†æ°¸è¿œä¸ä¼šç»“æŸï¼Œæˆ‘ä»¬æ— æ³•ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½åˆ°è¾¾ï¼Œå› ä¸ºè¾“å…¥æ˜¯æ— ç•Œçš„ï¼Œæ°¸æ— æ­¢å¢ƒï¼Œæ•°æ®æ²¡æœ‰â€œéƒ½åˆ°è¾¾â€çš„ æ—¶å€™ã€‚æ‰€ä»¥å¯¹äºæ— ç•Œæ•°æ®æµï¼Œå¿…é¡»è¿ç»­å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»åœ¨è·å–æ•°æ®åç«‹å³å¤„ç†ã€‚åœ¨å¤„ç†æ— ç•Œæµæ—¶ï¼Œä¸ºäº†ä¿è¯ç»“æœçš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬å¿…é¡»èƒ½å¤Ÿåšåˆ°æŒ‰ç…§é¡ºåºå¤„ç†æ•°æ®ã€‚ 2.æ— ç•Œæ•°æ®æµæœ‰ç•Œæ•°æ®æµæœ‰æ˜ç¡®å®šä¹‰çš„å¼€å§‹å’Œç»“æŸï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è·å–æ‰€æœ‰æ•°æ®æ¥å¤„ç†æœ‰ç•Œæµã€‚å¤„ç†æœ‰ç•Œæµå°±ä¸éœ€è¦ä¸¥æ ¼ä¿è¯æ•°æ®çš„é¡ºåºäº†ï¼Œå› ä¸ºæ€»å¯ä»¥å¯¹æœ‰ç•Œæ•°æ®é›†è¿›è¡Œæ’åºã€‚æœ‰ç•Œæµçš„å¤„ç†ä¹Ÿå°±æ˜¯æ‰¹å¤„ç†ã€‚ æ­£å› ä¸ºè¿™ç§æ¶æ„ä¸Šçš„ä¸åŒï¼ŒSpark å’Œ Flink åœ¨ä¸åŒçš„åº”ç”¨é¢†åŸŸä¸Šè¡¨ç°ä¼šæœ‰å·®åˆ«ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒSpark åŸºäºå¾®æ‰¹å¤„ç†çš„æ–¹å¼åšåŒæ­¥æ€»æœ‰ä¸€ä¸ªâ€œæ”’æ‰¹â€çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¼šæœ‰é¢å¤–å¼€é”€ï¼Œå› æ­¤æ— æ³•åœ¨æµå¤„ç†çš„ä½å»¶è¿Ÿä¸Šåšåˆ°æè‡´ã€‚åœ¨ä½å»¶è¿Ÿæµå¤„ç†åœºæ™¯ï¼ŒFlink å·²ç»æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚è€Œåœ¨æµ·é‡æ•°æ®çš„æ‰¹å¤„ç†é¢†åŸŸï¼ŒSpark èƒ½å¤Ÿå¤„ç†çš„ååé‡æ›´å¤§ï¼ŒåŠ ä¸Šå…¶å®Œå–„çš„ç”Ÿæ€å’Œæˆç†Ÿæ˜“ç”¨çš„ APIï¼Œç›®å‰åŒæ ·ä¼˜åŠ¿æ¯”è¾ƒæ˜æ˜¾ã€‚ 2ã€æ•°æ®æ¨¡å‹å’Œè¿è¡Œæ¶æ„ é™¤äº†ä¸‰è§‚ä¸åˆï¼ŒSpark å’Œ Flink åœ¨åº•å±‚å®ç°æœ€ä¸»è¦çš„å·®åˆ«å°±åœ¨äºæ•°æ®æ¨¡å‹ä¸åŒã€‚ Spark åº•å±‚æ•°æ®æ¨¡å‹æ˜¯å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆRDDï¼‰ï¼ŒSpark Streaming è¿›è¡Œå¾®æ‰¹å¤„ç†çš„åº•å±‚ æ¥å£ DStreamï¼Œå®é™…ä¸Šå¤„ç†çš„ä¹Ÿæ˜¯ä¸€ç»„ç»„å°æ‰¹æ•°æ® RDD çš„é›†åˆã€‚å¯ä»¥çœ‹å‡ºï¼ŒSpark åœ¨è®¾è®¡ä¸Šæœ¬ èº«å°±æ˜¯ä»¥æ‰¹é‡çš„æ•°æ®é›†ä½œä¸ºåŸºå‡†çš„ï¼Œæ›´åŠ é€‚åˆæ‰¹å¤„ç†çš„åœºæ™¯ã€‚ è€Œ Flink çš„åŸºæœ¬æ•°æ®æ¨¡å‹æ˜¯æ•°æ®æµï¼ˆDataFlowï¼‰ï¼Œä»¥åŠäº‹ä»¶ï¼ˆEventï¼‰åºåˆ—ã€‚Flink åŸºæœ¬ä¸Šæ˜¯ å®Œå…¨æŒ‰ç…§ Google çš„ DataFlow æ¨¡å‹å®ç°çš„ï¼Œæ‰€ä»¥ä»åº•å±‚æ•°æ®æ¨¡å‹ä¸Šçœ‹ï¼ŒFlink æ˜¯ä»¥å¤„ç†æµå¼æ•° æ®ä½œä¸ºè®¾è®¡ç›®æ ‡çš„ï¼Œæ›´åŠ é€‚åˆæµå¤„ç†çš„åœºæ™¯ã€‚ æ•°æ®æ¨¡å‹ä¸åŒï¼Œå¯¹åº”åœ¨è¿è¡Œå¤„ç†çš„æµç¨‹ä¸Šï¼Œè‡ªç„¶ä¹Ÿä¼šæœ‰ä¸åŒçš„æ¶æ„ã€‚Spark åšæ‰¹è®¡ç®—ï¼Œéœ€ è¦å°†ä»»åŠ¡å¯¹åº”çš„ DAG åˆ’åˆ†é˜¶æ®µï¼ˆStageï¼‰ï¼Œä¸€ä¸ªå®Œæˆåç»è¿‡ shuffle å†è¿›è¡Œä¸‹ä¸€é˜¶æ®µçš„è®¡ç®—ã€‚è€Œ Flink æ˜¯æ ‡å‡†çš„æµå¼æ‰§è¡Œæ¨¡å¼ï¼Œä¸€ä¸ªäº‹ä»¶åœ¨ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†å®Œåå¯ä»¥ç›´æ¥å‘å¾€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œå¤„ç†ã€‚ 3ã€Spark è¿˜æ˜¯ FlinkSpark å’Œ Flink å¯ä»¥è¯´ç›®å‰æ˜¯å„æ“…èƒœåœºï¼Œæ‰¹å¤„ç†é¢†åŸŸ Spark ç§°ç‹ï¼Œè€Œåœ¨æµå¤„ç†æ–¹é¢ Flink å½“ä»ä¸è®©ã€‚å…·ä½“åˆ°é¡¹ç›®åº”ç”¨ä¸­ï¼Œä¸ä»…è¦çœ‹æ˜¯æµå¤„ç†è¿˜æ˜¯ æ‰¹å¤„ç†ï¼Œè¿˜éœ€è¦åœ¨å»¶è¿Ÿã€ååé‡ã€å¯é æ€§ï¼Œä»¥åŠå¼€å‘å®¹æ˜“åº¦ç­‰å¤šä¸ªæ–¹é¢è¿›è¡Œæƒè¡¡ã€‚ å¦‚æœåœ¨å·¥ä½œä¸­éœ€è¦ä» Spark å’Œ Flink è¿™ä¸¤ä¸ªä¸»æµæ¡†æ¶ä¸­é€‰æ‹©ä¸€ä¸ªæ¥è¿›è¡Œå®æ—¶æµå¤„ç†ï¼Œæˆ‘ä»¬æ›´åŠ æ¨èä½¿ç”¨ Flinkï¼Œä¸»è¦çš„åŸå› æœ‰ï¼š Flink çš„å»¶è¿Ÿæ˜¯æ¯«ç§’çº§åˆ«ï¼Œè€Œ Spark Streaming çš„å»¶è¿Ÿæ˜¯ç§’çº§å»¶è¿Ÿã€‚ Flink æä¾›äº†ä¸¥æ ¼çš„ç²¾ç¡®ä¸€æ¬¡æ€§è¯­ä¹‰ä¿è¯ã€‚ Flink çš„çª—å£ API æ›´åŠ çµæ´»ã€è¯­ä¹‰æ›´ä¸°å¯Œã€‚ Flink æä¾›äº‹ä»¶æ—¶é—´è¯­ä¹‰ï¼Œå¯ä»¥æ­£ç¡®å¤„ç†å»¶è¿Ÿæ•°æ®ã€‚ Flink æä¾›äº†æ›´åŠ çµæ´»çš„å¯¹çŠ¶æ€ç¼–ç¨‹çš„ APIã€‚ â…¡ã€Flink éƒ¨ç½²ä¸€ã€Flink å¿«é€Ÿä¸Šæ‰‹1ã€åˆ›å»ºé¡¹ç›®(1.8)1ã€mavenåœ¨é¡¹ç›®çš„ pom æ–‡ä»¶ä¸­ï¼Œå¢åŠ æ ‡ç­¾è®¾ç½®å±æ€§ï¼Œç„¶åå¢åŠ æ ‡ç­¾å¼•å…¥éœ€è¦çš„ä¾èµ–ã€‚æˆ‘ä»¬éœ€è¦æ·»åŠ çš„ä¾èµ–æœ€é‡è¦çš„å°±æ˜¯ Flink çš„ç›¸å…³ç»„ä»¶ï¼ŒåŒ…æ‹¬ flink-javaã€ flink-streaming-javaï¼Œä»¥åŠ flink-clientsï¼ˆå®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥çœç•¥ï¼‰ã€‚å¦å¤–ï¼Œä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼Œ æˆ‘ä»¬å¼•å…¥ slf4j å’Œ log4j è¿›è¡Œæ—¥å¿—ç†ã€‚ &lt;properties&gt; &lt;flink.version&gt;1.13.0&lt;/flink.version&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;scala.binary.version&gt;2.12&lt;/scala.binary.version&gt; &lt;slf4j.version&gt;1.7.30&lt;/slf4j.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- å¼•å…¥ Flink ç›¸å…³ä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-java&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-java_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-clients_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥æ—¥å¿—ç®¡ç†ç›¸å…³ä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;${slf4j.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt; &lt;version&gt;${slf4j.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-to-slf4j&lt;/artifactId&gt; &lt;version&gt;2.14.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; åœ¨å±æ€§ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†&lt;scala.binary.version&gt;ï¼Œè¿™æŒ‡ä»£çš„æ˜¯æ‰€ä¾èµ–çš„ Scala ç‰ˆæœ¬ã€‚è¿™æœ‰ä¸€ç‚¹å¥‡æ€ªï¼šFlink åº•å±‚æ˜¯ Javaï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿåªç”¨ Java APIï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šä¾èµ– Scala å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º Flinkçš„æ¶æ„ä¸­ä½¿ç”¨äº† Akka æ¥å®ç°åº•å±‚çš„åˆ†å¸ƒå¼é€šä¿¡ï¼Œè€Œ Akka æ˜¯ç”¨ Scala å¼€å‘çš„ 2ã€é…ç½®æ—¥å¿—ç®¡ç†åœ¨ç›®å½• src/main/resources ä¸‹æ·»åŠ æ–‡ä»¶:log4j.propertiesï¼Œå†…å®¹é…ç½®å¦‚ä¸‹ï¼š log4j.rootLogger=error, stdout log4j.appender.stdout=org.apache.log4j.ConsoleAppender log4j.appender.stdout.layout=org.apache.log4j.PatternLayout log4j.appender.stdout.layout.ConversionPattern=%-4r [%t] %-5p %c %x - %m%n 2ã€ç¼–å†™ä»£ç æ­å¥½é¡¹ç›®æ¡†æ¶ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒå·¥ä½œâ€”â€”å¾€é‡Œé¢å¡«å……ä»£ç ã€‚æˆ‘ä»¬ä¼šç”¨ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹æ¥è¯´æ˜ Flink ä»£ç æ€æ ·ç¼–å†™ï¼šç»Ÿè®¡ä¸€æ®µæ–‡å­—ä¸­ï¼Œæ¯ä¸ªå•è¯å‡ºç°çš„é¢‘æ¬¡ã€‚è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ WordCount ç¨‹åºâ€”â€”å®ƒæ˜¯å¤§æ•°æ®é¢†åŸŸéå¸¸ç»å…¸çš„å…¥é—¨æ¡ˆä¾‹ï¼Œåœ°ä½ç­‰åŒäºåˆå­¦ç¼–ç¨‹è¯­è¨€æ—¶çš„Hello Worldã€‚ 1ã€æ‰¹å¤„ç† 1ã€æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª txtæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ hello world hello flink hello java 2ã€æ€è·¯ å…ˆé€è¡Œè¯»å…¥æ–‡ä»¶æ•°æ®ï¼Œç„¶åå°†æ¯ä¸€è¡Œæ–‡å­—æ‹†åˆ†æˆå•è¯ï¼›æ¥ç€æŒ‰ç…§å•è¯åˆ†ç»„ï¼Œç»Ÿè®¡æ¯ç»„æ•°æ®çš„ä¸ªæ•°ï¼Œå°±æ˜¯å¯¹åº”å•è¯çš„é¢‘æ¬¡ã€‚ 3ã€Java ç±» BatchWordCount package com.kk.wc; import org.apache.flink.api.common.typeinfo.Types; import org.apache.flink.api.java.ExecutionEnvironment; import org.apache.flink.api.java.operators.AggregateOperator; import org.apache.flink.api.java.operators.DataSource; import org.apache.flink.api.java.operators.FlatMapOperator; import org.apache.flink.api.java.operators.UnsortedGrouping; import org.apache.flink.api.java.tuple.Tuple2; import org.apache.flink.util.Collector; public class BatchWordCount { public static void main(String[] args) throws Exception { // 1. åˆ›å»ºæ‰§è¡Œç¯å¢ƒ ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment ( ); // 2. ä»æ–‡ä»¶è¯»å–æ•°æ® æŒ‰è¡Œè¯»å–(å­˜å‚¨çš„å…ƒç´ å°±æ˜¯æ¯è¡Œçš„æ–‡æœ¬) DataSource&lt;String&gt; listDateSource = env.readTextFile (\"input/words.txt\"); // 3. å°†æ¯è¡Œæ•°æ®è¿›è¡Œåˆ†è¯ï¼Œè½¬æ¢æˆäºŒå…ƒç»„ç±»å‹ // Collector: flink å®šä¹‰çš„æ”¶é›†å™¨ // Tuple: äºŒå…ƒç»„ç±»å‹ &lt;String,Long&gt;,K å°±æ˜¯å…·ä½“çš„å•è¯ï¼ŒV å°±æ˜¯ä¸ªæ•° FlatMapOperator&lt;String, Tuple2&lt;String, Long&gt;&gt; wordAndOneTuple = listDateSource.flatMap ((String line, Collector&lt;Tuple2&lt;String, Long&gt;&gt; out) -&gt; { // æ¯è¡Œæ ¹æ®ç©ºæ ¼åˆ†éš”å‡ºï¼Œå•è¯ String[] words = line.split (\" \"); // out.collect å°±æ˜¯è¾“å‡ºçš„æ„æ€ for (String word : words) { // Tuple2.of æ„å»ºäºŒå…ƒç»„å®ä¾‹ out.collect (Tuple2.of (word, 1L)); } }) // returns è§£å†³ scala æ³›å‹æ“¦é™¤é—®é¢˜ .returns (Types.TUPLE (Types.STRING, Types.LONG)); // æ ¹æ®è½¬æ¢å¾—åˆ°çš„è¿ç®—å­ wordAndOneTuple // 4. æŒ‰ç…§ word è¿›è¡Œåˆ†ç»„, 0 è¡¨ç¤ºç¬¬ 1 ä¸ªå­—æ®µç´¢å¼•ï¼Œå°±æ˜¯ä¸Šé¢æ³›å‹&lt;k,v&gt; ä¸­çš„ k ä¸º word å­—æ®µ UnsortedGrouping&lt;Tuple2&lt;String, Long&gt;&gt; wordAndOneGroup = wordAndOneTuple.groupBy (0); // 5. åˆ†ç»„è¿›è¡Œèšåˆ(æ±‚å’Œ)ç»Ÿè®¡ï¼Œ1 è¡¨ç¤ºç¬¬ 2 ä¸ªå­—æ®µç´¢å¼•ï¼Œå°±æ˜¯ä¸Šé¢æ³›å‹&lt;k,v&gt; ä¸­çš„ v ä¸º 1L æ•°å€¼çš„å­—æ®µ AggregateOperator&lt;Tuple2&lt;String, Long&gt;&gt; sum = wordAndOneGroup.sum (1); // 6. æ‰“å° sum.print ( ); } } 2ã€æµå¤„ç†ï¼ˆæœ‰ç•Œï¼‰package com.kk.wc; import org.apache.flink.api.common.typeinfo.Types; import org.apache.flink.api.java.tuple.Tuple2; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.datastream.KeyedStream; import org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; import org.apache.flink.util.Collector; /* * @Description: æµå¤„ç†æœ‰ç•Œæµ * @Author: é˜¿K * @CreateDate: 2022/5/19 21:14 * @Param: * @Return: **/ public class BoundedStreamWordCount { public static void main(String[] args) throws Exception{ // 1. åˆ›å»ºæµå¼æ‰§è¡Œç¯å¢ƒ StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); // 2. ä»æ–‡ä»¶è¯»å–æ•°æ® æŒ‰è¡Œè¯»å–(å­˜å‚¨çš„å…ƒç´ å°±æ˜¯æ¯è¡Œçš„æ–‡æœ¬) DataStreamSource&lt;String&gt; listDateSource = env.readTextFile (\"input/words.txt\"); // 3. å°†æ¯è¡Œæ•°æ®è¿›è¡Œåˆ†è¯ï¼Œè½¬æ¢æˆäºŒå…ƒç»„ç±»å‹ SingleOutputStreamOperator&lt;Tuple2&lt;String, Long&gt;&gt; wordAndOne = listDateSource.flatMap ((String line, Collector&lt;Tuple2&lt;String,Long&gt;&gt; out) -&gt; { String[] words = line.split (\" \"); for (String word : words) { out.collect (Tuple2.of (word,1L)); } }).returns (Types.TUPLE (Types.STRING, Types.LONG)); // 4. åˆ†ç»„(keyBy æŒ‰ç…§ key åˆ†ç»„ KeyedStream&lt;Tuple2&lt;String, Long&gt;, String&gt; wordAndOneKS = wordAndOne.keyBy (data -&gt; data.f0); // 5. æ±‚å’Œ SingleOutputStreamOperator&lt;Tuple2&lt;String, Long&gt;&gt; result = wordAndOneKS.sum (1); // 6. æ‰“å° result.print (); // 7. æ‰§è¡Œ env.execute (); } } 3ã€æµå¤„ç†ï¼ˆæ— ç•Œï¼‰åˆ©ç”¨ nc æ¨¡æ‹Ÿå®æ—¶æ¨é€ï¼Œå¯ä»¥å‚è€ƒåº•ä¸‹ ã€5ã€‘ package com.kk.wc; import org.apache.flink.api.common.typeinfo.Types; import org.apache.flink.api.java.tuple.Tuple2; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.datastream.KeyedStream; import org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; import org.apache.flink.util.Collector; /* * @Description: æµå¼è®¡ç®—ï¼ˆnc æµ‹è¯•æ— ç•Œæµï¼‰ * @Author: é˜¿K * @CreateDate: 2022/5/19 22:43 * @Param: * @Return: **/ public class StreamWordCount { public static void main(String[] args) throws Exception{ // 1. åˆ›å»ºæµå¼æ‰§è¡Œç¯å¢ƒ StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); // 2. è¯»å–æ–‡æœ¬æµ(è¿œç¨‹æœº) DataStreamSource&lt;String&gt; lineDataStream = env.socketTextStream (\"101.34.180.133\", 7777); // 3. å°†æ¯è¡Œæ•°æ®è¿›è¡Œåˆ†è¯ï¼Œè½¬æ¢æˆäºŒå…ƒç»„ç±»å‹ SingleOutputStreamOperator&lt;Tuple2&lt;String, Long&gt;&gt; wordAndOne = lineDataStream.flatMap ((String line, Collector&lt;Tuple2&lt;String,Long&gt;&gt; out) -&gt; { String[] words = line.split (\" \"); for (String word : words) { out.collect (Tuple2.of (word,1L)); } }).returns (Types.TUPLE (Types.STRING, Types.LONG)); // 4. åˆ†ç»„(keyBy æŒ‰ç…§ key åˆ†ç»„ KeyedStream&lt;Tuple2&lt;String, Long&gt;, String&gt; wordAndOneKS = wordAndOne.keyBy (data -&gt; data.f0); // 5. æ±‚å’Œ SingleOutputStreamOperator&lt;Tuple2&lt;String, Long&gt;&gt; result = wordAndOneKS.sum (1); // 6. æ‰“å° result.print (); // 7. æ‰§è¡Œ env.execute (); } } æµ‹è¯•ä¸Šé¢å¯ä»¥ç”¨ nc æµ‹è¯•ï¼ˆå®æ—¶æ¨¡æ‹Ÿæ•°æ®å‘é€ï¼‰ äºŒã€ä½œä¸šéƒ¨ç½²1ã€æ­å»ºFlinkFlink æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¤„ç†æ¡†æ¶ï¼Œæ‰€ä»¥å®é™…åº”ç”¨ä¸€èˆ¬éƒ½éœ€è¦æ­å»ºé›†ç¾¤ç¯å¢ƒã€‚ä½œè€…åˆå­¦å°±æ­å»ºå•æœºå¥½äº† æœ‰æ¡ä»¶å°±ç”¨ docker å¿«é€Ÿå ç”¨å°ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢ç¬¬å…­ 1.å®˜ç½‘ä¸‹è½½flink-1.13.0-bin-scala_2.12.tgz 2.è§£å‹mkdir /opt/module/ tar -zxvf flink-1.13.0-bin-scala_2.12.tgz -C /opt/module/ 3.å¯åŠ¨cd flink-1.13.0/ # å¯åŠ¨ bin/start-cluster.sh # åœæ­¢ bin/stop-cluster.sh 2ã€æ‰“åŒ…&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;FlinkTutorial&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;properties&gt; &lt;flink.version&gt;1.13.0&lt;/flink.version&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;scala.binary.version&gt;2.12&lt;/scala.binary.version&gt; &lt;slf4j.version&gt;1.7.30&lt;/slf4j.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- å¼•å…¥Flinkç›¸å…³ä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-java&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-java_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-clients_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-kafka_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.bahir&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-redis_2.11&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-elasticsearch6_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-jdbc_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-statebackend-rocksdb_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;1.13.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-table-api-java-bridge_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-table-planner-blink_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-scala_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-csv&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-cep_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥æ—¥å¿—ç®¡ç†ç›¸å…³ä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;${slf4j.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt; &lt;version&gt;${slf4j.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-to-slf4j&lt;/artifactId&gt; &lt;version&gt;2.14.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt; &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt; &lt;version&gt;2.7.5&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.0&lt;/version&gt; &lt;configuration&gt; &lt;descriptorRefs&gt; &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt; &lt;/descriptorRefs&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;make-assembly&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;single&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.8.0&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;${java.version}&lt;/source&gt; &lt;target&gt;${java.version}&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; ä¼šç”Ÿæˆä¸¤ä¸ª jar ï¼Œä¸€ä¸ªæœ‰ flinkä¾èµ–çš„æ¯”è¾ƒå¤§ï¼Œä¸€ä¸ªæ²¡æœ‰ä¾èµ–çš„æ¯”è¾ƒå° 3ã€æäº¤ä½œä¸š1ã€é€‰æ‹©ä¸€ä¸ª jar å°çš„é‚£ä¸ªæ²¡æœ‰ä¾èµ–çš„ 2ã€ä¸Šä¼ ï¼Œç™»å½•UIé¢æ¿ï¼šhttp://101.34.180.133:8081/ 3ã€é…ç½®å¯åŠ¨ç±» ä¸€ä¸ªèŠ‚ç‚¹é€‰æ‹© 1ï¼Œä¸¤ä¸ªèŠ‚ç‚¹é€‰æ‹© 2 4ã€å¯åŠ¨ nc æ¨¡æ‹Ÿ 5ã€ä»»åŠ¡æäº¤æˆåŠŸä¹‹åï¼Œå¯ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ çš„â€œRunning Jobsâ€æŸ¥çœ‹ç¨‹åºè¿è¡Œåˆ—è¡¨æƒ…å†µ ä¸‰ã€æ­å»ºkafkadockerç‰ˆæœ¬æ­å»º zookeeper and kafka 1ã€zookeeperdocker run -d --name zookeeper -p 2181:2181 -v /etc/localtime:/etc/localtime wurstmeister/zookeeper 2ã€kafkaè¿™è¾¹éœ€è¦æ³¨æ„ç½‘æ®µï¼Œ192.168.16.4 ifconfig æŸ¥çœ‹ä¸‹ï¼Œå¦‚æœç”¨127.0.0.1 å¯èƒ½ä¼šé—ªé€€ docker run -d --name kafka -p 9092:9092 -e KAFKA_BROKER_ID=0 -e KAFKA_ZOOKEEPER_CONNECT=192.168.16.4:2181 -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://106.12.159.22:9092 -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 -t wurstmeister/kafka -e KAFKA_BROKER_ID=0 åœ¨kafkaé›†ç¾¤ä¸­ï¼Œæ¯ä¸ªkafkaéƒ½æœ‰ä¸€ä¸ªBROKER_IDæ¥åŒºåˆ†è‡ªå·± -e KAFKA_ZOOKEEPER_CONNECT=192.168.16.4:2181/kafka é…ç½®zookeeperç®¡ç†kafkaçš„è·¯å¾„10.9.44.11:2181/kafka -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://192.168.16.4:9092 æŠŠkafkaçš„åœ°å€ç«¯å£æ³¨å†Œç»™zookeeper -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 é…ç½®kafkaçš„ç›‘å¬ç«¯å£ -v /etc/localtime:/etc/localtime å®¹å™¨æ—¶é—´åŒæ­¥è™šæ‹Ÿæœºçš„æ—¶é—´ å…¬ç½‘é…ç½®æ˜ å°„å‚æ•°ï¼šæ‰èƒ½è®©ä½ çš„kafkaè¢«è¿œç¨‹è®¿é—®ï¼Œåº•ä¸‹é…ç½®åªæœ‰ KAFKA_ADVERTISED_LISTENERS å¿…é¡»æ˜¯å…¬ç½‘æ˜ å°„ docker run -d â€“restart=always â€“name kafka -p 9092:9092 -e KAFKA_BROKER_ID=1 -e KAFKA_auto_create_topics_enable=true \\-e KAFKA_HEAP_OPTS=â€-Xmx256M -Xms128Mâ€ -e KAFKA_ZOOKEEPER_CONNECT=å…¬ç½‘ip:2181 -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://å…¬ç½‘ip:9092 -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 \\ 3ã€æ£€éªŒkafka1ã€è¿›å…¥å®¹å™¨docker exec -it kafka /bin/sh 2ã€åˆ‡æ¢åˆ°è·¯å¾„cd /opt/kafka/bin 3ã€è¿è¡Œkafkaç”Ÿäº§è€…å‘½ä»¤./kafka-console-producer.sh --broker-list localhost:9092 --topic clicks 4ã€è¿è¡Œæ¶ˆè´¹è€…å‘½ä»¤æ³¨æ„ï¼štopic ä¸»é¢˜è¦ä¸€è‡´ï¼Œæ–¹èƒ½æ¶ˆè´¹åˆ° ./kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic clicks 5ã€å‘é€æ•°æ®aaa bbb 6ã€æ•ˆæœå›¾ â…¢ã€DataStream APIä¸€ã€æ¦‚å¿µDataStreamï¼ˆæ•°æ®æµï¼‰æœ¬èº«æ˜¯ Flink ä¸­ä¸€ä¸ªç”¨æ¥è¡¨ç¤ºæ•°æ®é›†åˆçš„ç±»ï¼Œè¿™å¥—æ ¸å¿ƒ API å¯ä»¥åšæµå¤„ç†ä»¥åŠæ‰¹å¤„ç†,è¿™å¥—API ä¸»è¦åšçš„æ˜¯æ•°æ®çš„è½¬æ¢ ä¸€ä¸ª Flink ç¨‹åºï¼Œå…¶å®å°±æ˜¯å¯¹ DataStream çš„å„ç§è½¬æ¢ã€‚å…·ä½“æ¥è¯´ï¼Œä»£ç åŸºæœ¬ä¸Šéƒ½ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†æ„æˆ è·å–æ‰§è¡Œç¯å¢ƒ è¯»å–æ•°æ®æº å®šä¹‰åŸºäºæ•°æ®çš„è½¬æ¢æ“ä½œ å®šä¹‰è®¡ç®—ç»“æœçš„è¾“å‡ºä½ç½® è§¦å‘ç¨‹åºæ‰§è¡Œ äºŒã€æ‰§è¡Œç¯å¢ƒè¿è¡Œç¯å¢ƒï¼šæœ¬åœ° JVM ä¸­æ‰§è¡Œç¨‹åºï¼Œä¹Ÿå¯ä»¥æäº¤åˆ°è¿œç¨‹é›†ç¾¤ä¸Šè¿è¡Œã€‚ 1ã€åˆ›å»ºæ‰§è¡Œç¯å¢ƒæˆ‘ ä»¬ è¦ è· å– çš„ æ‰§ è¡Œ ç¯ å¢ƒ ï¼Œ æ˜¯ StreamExecutionEnvironment ç±»çš„å¯¹è±¡ï¼Œè¿™æ˜¯æ‰€æœ‰ Flink ç¨‹åºçš„åŸºç¡€ã€‚ åˆ›å»ºæ‰§è¡Œç¯å¢ƒçš„æ–¹å¼ï¼Œå°±æ˜¯è°ƒç”¨è¿™ä¸ªç±»çš„é™æ€æ–¹æ³•ï¼Œå…·ä½“æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š getExecutionEnvironment StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); - æ™ºèƒ½åˆ¤æ–­ï¼šå¦‚æœå½“å‰ç¨‹åºæ˜¯ç‹¬ç«‹è¿è¡Œï¼Œåˆ™è¿”å›ä¸€ä¸ªæœ¬åœ°ç¯å¢ƒï¼›å¦‚æœæ˜¯é›†ç¾¤ç¯å¢ƒï¼Œåˆ™è¿”å›é›†ç¾¤ç¯å¢ƒ - **createLocalEnvironment** - ```java StreamExecutionEnvironment localEnv = StreamExecutionEnvironment.createLocalEnvironment ( ); è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªæœ¬åœ°æ‰§è¡Œç¯å¢ƒã€‚å¯ä»¥åœ¨è°ƒç”¨æ—¶ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šé»˜è®¤çš„å¹¶è¡Œåº¦ï¼›å¦‚æœä¸ä¼ å…¥ï¼Œåˆ™é»˜è®¤å¹¶è¡Œåº¦å°±æ˜¯æœ¬åœ°çš„ CPU æ ¸å¿ƒæ•°ã€‚ createRemoteEnvironment StreamExecutionEnvironment remoteEnv = StreamExecutionEnvironment .createRemoteEnvironment ( \"host\", // JobManager ä¸»æœºå 1234, // JobManager è¿›ç¨‹ç«¯å£å· \"path/to/jarFile.jar\" // æäº¤ç»™ JobManager çš„ JAR åŒ… ); - åœ¨è·å–åˆ°ç¨‹åºæ‰§è¡Œç¯å¢ƒåï¼Œè¿˜å¯ä»¥å¯¹æ‰§è¡Œç¯å¢ƒè¿›è¡Œçµæ´»çš„è®¾ç½®ã€‚æ¯”å¦‚å¯ä»¥å…¨å±€è®¾ç½®ç¨‹åºçš„å¹¶è¡Œåº¦ã€ç¦ç”¨ç®—å­é“¾ï¼Œè¿˜å¯ä»¥å®šä¹‰ç¨‹åºçš„æ—¶é—´è¯­ä¹‰ã€é…ç½®å®¹é”™æœºåˆ¶ã€‚å…³äºæ—¶é—´è¯­ä¹‰å’Œå®¹é”™æœºåˆ¶ #### 2ã€æ‰§è¡Œæ¨¡å¼ ```java // æ‰¹å¤„ç†ç¯å¢ƒ ExecutionEnvironment batchEnv = ExecutionEnvironment.getExecutionEnvironment ( ); // æµå¤„ç†ç¯å¢ƒ StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); 3ã€è§¦å‘ç¨‹åºæ‰§è¡Œ1ã€å½“ main()æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå…¶å®åªæ˜¯å®šä¹‰äº†ä½œä¸šçš„æ¯ä¸ªæ‰§è¡Œæ“ä½œï¼Œç„¶åæ·»åŠ åˆ°æ•°æ®æµå›¾ä¸­ï¼›è¿™æ—¶å¹¶æ²¡æœ‰çœŸæ­£å¤„ç†æ•°æ®ã€å› ä¸ºæ•°æ®å¯èƒ½è¿˜æ²¡æ¥ã€‘ 2ã€åªæœ‰ç­‰åˆ°æ•°æ®åˆ°æ¥ï¼Œæ‰ä¼šè§¦å‘çœŸæ­£çš„è®¡ç®—ï¼Œè¿™ä¹Ÿè¢«ç§°ä¸ºâ€œå»¶è¿Ÿæ‰§è¡Œâ€æˆ–â€œæ‡’æ‰§è¡Œâ€ 3ã€æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°è°ƒç”¨æ‰§è¡Œç¯å¢ƒçš„ execute()æ–¹æ³•ï¼Œæ¥è§¦å‘ç¨‹åºæ‰§è¡Œã€‚execute()æ–¹æ³•å°†ä¸€ç›´ç­‰å¾…ä½œä¸šå®Œæˆï¼Œç„¶åè¿”å›ä¸€ä¸ªæ‰§è¡Œç»“æœ env.execute(); ä¸‰ã€æºç®—å­1ã€å‡†å¤‡å·¥ä½œä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬å…ˆæ„å»ºä¸€ä¸ªå®é™…åº”ç”¨åœºæ™¯ã€‚æ¯”å¦‚ç½‘ç«™çš„è®¿é—®æ“ä½œï¼Œå¯ä»¥æŠ½è±¡æˆä¸€ä¸ªä¸‰å…ƒç»„ï¼ˆç”¨æˆ·åï¼Œç”¨æˆ·è®¿é—®çš„ urrlï¼Œç”¨æˆ·è®¿é—® url çš„æ—¶é—´æˆ³ï¼‰ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç±» Eventï¼Œå°†ç”¨æˆ·è¡Œä¸ºåŒ…è£…æˆå®ƒçš„ä¸€ä¸ªå¯¹è±¡ã€‚Event åŒ…å«äº†ä»¥ä¸‹ä¸€äº›å­—æ®µ å­—æ®µå æ•°æ®ç±»å‹ è¯´æ˜ user String ç”¨æˆ·å url String ç”¨æˆ·è®¿é—®çš„url timeStamp Long ç”¨æˆ·è®¿é—®urlçš„æ—¶é—´æˆ³ package com.kk.model2.pojo; import lombok.AllArgsConstructor; import lombok.NoArgsConstructor; import lombok.ToString; @NoArgsConstructor @AllArgsConstructor @ToString public class Event { public String user; public String url; public Long timestamp; } è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬å®šä¹‰çš„ Eventï¼Œæœ‰è¿™æ ·å‡ ä¸ªç‰¹ç‚¹ï¼š ç±»æ˜¯å…¬æœ‰ï¼ˆpublicï¼‰çš„ æœ‰ä¸€ä¸ªæ— å‚çš„æ„é€ æ–¹æ³• æ‰€æœ‰å±æ€§éƒ½æ˜¯å…¬æœ‰ï¼ˆpublicï¼‰çš„ æ‰€æœ‰å±æ€§çš„ç±»å‹éƒ½æ˜¯å¯ä»¥åºåˆ—åŒ–çš„ Flink ä¼šæŠŠè¿™æ ·çš„ç±»ä½œä¸ºä¸€ç§ç‰¹æ®Šçš„ POJO æ•°æ®ç±»å‹æ¥å¯¹å¾…ï¼Œæ–¹ä¾¿æ•°æ®çš„è§£æå’Œåºåˆ—åŒ–ã€‚ 2ã€å¸¸è§„è¯»æ•°æ®é›†åˆè¯»æ•°æ®-æ–‡ä»¶è¯»æ•°æ®-Socket è¯»æ•°æ® package com.kk.model2; import com.kk.model2.pojo.Event; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; import java.util.ArrayList; /* * @Description: é›†åˆä¸­è¯»å–æ•°æ® * @Author: é˜¿K * @CreateDate: 2022/5/24 22:04 * @Param: * @Return: **/ public class SourceTest1 { public static void main(String[] args) throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); // è®¾ç½®å¹¶è¡Œåº¦ä¸º 1 ï¼Œä¿è¯æœ‰åºè¿è¡Œ env.setParallelism (1); // 1.ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ® DataStreamSource&lt;String&gt; stream1 = env.readTextFile (\"input/clicks.csv\"); // 2.ä»é›†åˆä¸­è¯»å–æ•°æ® ArrayList&lt;Integer&gt; nums = new ArrayList&lt;&gt; ( ); nums.add (2); nums.add (5); DataStreamSource&lt;Integer&gt; numStream = env.fromCollection (nums); ArrayList&lt;Event&gt; events = new ArrayList&lt;&gt; ( ); events.add (new Event (\"Mary\", \"./home\", 1000L)); events.add (new Event (\"Bob\", \"./cart\", 2000L)); DataStreamSource&lt;Event&gt; stream2 = env.fromCollection (events); // 3.ä»å…ƒç´ è¯»å–æ•°æ® DataStreamSource&lt;Event&gt; stream3 = env.fromElements ( new Event (\"Mary\", \"./home\", 1000L), new Event (\"Bob\", \"./cart\", 2000L) ); // ä»Socketæ–‡æœ¬æµè¯»å– DataStreamSource&lt;String&gt; stream4 = env.socketTextStream (\"localhost\", 7777); // stream1.print(\"1\"); // numStream.print(\"nums\"); // stream2.print(\"2\"); // stream3.print(\"3\"); stream4.print (\"4\"); env.execute ( ); } } 3ã€Kafka è¯»æ•°æ® â˜…Flink å®˜æ–¹æä¾›çš„æ˜¯ä¸€ä¸ªé€šç”¨çš„ Kafka è¿æ¥å™¨ï¼Œå®ƒä¼šè‡ªåŠ¨è·Ÿè¸ªæœ€æ–°ç‰ˆæœ¬çš„ Kafka å®¢æˆ·ç«¯ &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-kafka_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; ç„¶åè°ƒç”¨ env.addSource()ï¼Œä¼ å…¥ FlinkKafkaConsumer çš„å¯¹è±¡å®ä¾‹å°±å¯ä»¥äº† package com.kk.model2; import org.apache.flink.api.common.serialization.SimpleStringSchema; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumer; import java.util.Properties; public class SourceKafkaTest { public static void main(String[] args) throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); Properties properties = new Properties ( ); properties.setProperty (\"bootstrap.servers\", \"106.12.159.22:9092\"); // properties.setProperty(\"group.id\", \"consumer-group\"); // properties.setProperty(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); // properties.setProperty(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); // properties.setProperty(\"auto.offset.reset\", \"latest\"); DataStreamSource&lt;String&gt; stream = env.addSource (new FlinkKafkaConsumer&lt;String&gt; ( \"sun\", new SimpleStringSchema ( ), properties )); stream.print ( ); env.execute ( ); } } åˆ›å»º FlinkKafkaConsumer æ—¶éœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š âš« ç¬¬ä¸€ä¸ªå‚æ•° topicï¼Œå®šä¹‰äº†ä»å“ªäº›ä¸»é¢˜ä¸­è¯»å–æ•°æ®ã€‚å¯ä»¥æ˜¯ä¸€ä¸ª topicï¼Œä¹Ÿå¯ä»¥æ˜¯ topicåˆ—è¡¨ï¼Œè¿˜å¯ä»¥æ˜¯åŒ¹é…æ‰€æœ‰æƒ³è¦è¯»å–çš„ topic çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å½“ä»å¤šä¸ª topic ä¸­è¯»å–æ•°æ®æ—¶ï¼ŒKafka è¿æ¥å™¨å°†ä¼šå¤„ç†æ‰€æœ‰ topic çš„åˆ†åŒºï¼Œå°†è¿™äº›åˆ†åŒºçš„æ•°æ®æ”¾åˆ°ä¸€æ¡æµä¸­å»ã€‚ âš« ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª DeserializationSchema æˆ–è€… KeyedDeserializationSchemaã€‚Kafka æ¶ˆæ¯è¢«å­˜å‚¨ä¸ºåŸå§‹çš„å­—èŠ‚æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ååºåˆ—åŒ–æˆ Java æˆ–è€… Scala å¯¹è±¡ã€‚ä¸Šé¢ä»£ç ä¸­ä½¿ç”¨çš„ SimpleStringSchemaï¼Œæ˜¯ä¸€ä¸ªå†…ç½®çš„ DeserializationSchemaï¼Œå®ƒåªæ˜¯å°†å­—èŠ‚æ•°ç»„ç®€å•åœ°ååºåˆ—åŒ–æˆå­—ç¬¦ä¸²ã€‚DeserializationSchema å’Œ KeyedDeserializationSchema æ˜¯å…¬å…±æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘ã€‚ âš« ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª Properties å¯¹è±¡ï¼Œè®¾ç½®äº† Kafka å®¢æˆ·ç«¯çš„ä¸€äº›å±æ€§ã€‚ ç»“æœï¼š 4ã€è‡ªå®šä¹‰ Sourceæƒ³è¦è¯»å–çš„æ•°æ®æºæ¥è‡ªæŸä¸ªå¤–éƒ¨ç³»ç»Ÿï¼Œè€Œ flink æ—¢æ²¡æœ‰é¢„å®ç°çš„æ–¹æ³•ã€ä¹Ÿæ²¡æœ‰æä¾›è¿æ¥å™¨ï¼Œ æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æ•°æ®æºï¼Œå®ç° SourceFunction æ¥å£ âš« run()æ–¹æ³•ï¼šä½¿ç”¨è¿è¡Œæ—¶ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆSourceContextï¼‰å‘ä¸‹æ¸¸å‘é€æ•°æ®ï¼› âš« cancel()æ–¹æ³•ï¼šé€šè¿‡æ ‡è¯†ä½æ§åˆ¶é€€å‡ºå¾ªç¯ï¼Œæ¥è¾¾åˆ°ä¸­æ–­æ•°æ®æºçš„æ•ˆæœã€‚ package com.kk.model2; import com.kk.model2.pojo.Event; import org.apache.flink.streaming.api.functions.source.SourceFunction; import java.util.Calendar; import java.util.Random; public class ClickSource implements SourceFunction&lt;Event&gt; { // å£°æ˜ä¸€ä¸ªå¸ƒå°”å˜é‡ï¼Œä½œä¸ºæ§åˆ¶æ•°æ®ç”Ÿæˆçš„æ ‡è¯†ä½ private Boolean running = true; @Override public void run(SourceContext&lt;Event&gt; ctx) throws Exception { // åœ¨æŒ‡å®šçš„æ•°æ®é›†ä¸­éšæœºé€‰å–æ•°æ® Random random = new Random ( ); String[] users = {\"Mary\", \"Alice\", \"Bob\", \"Cary\"}; String[] urls = {\"./home\", \"./cart\", \"./fav\", \"./prod?id=1\", \"./prod?id=2\"}; while (running) { ctx.collect (new Event ( users[random.nextInt (users.length)], urls[random.nextInt (urls.length)], Calendar.getInstance ( ).getTimeInMillis ( ) )); // éš” 1 ç§’ç”Ÿæˆä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œæ–¹ä¾¿è§‚æµ‹ Thread.sleep (1000); } } @Override public void cancel() { running = false; } } è¿™ä¸ªæ•°æ®æºï¼Œæˆ‘ä»¬åé¢ä¼šé¢‘ç¹ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨åé¢çš„ä»£ç ä¸­æ¶‰åŠåˆ° ClickSource()æ•°æ®æºï¼Œä½¿ç”¨ä¸Šé¢çš„ä»£ç å°±å¯ä»¥äº†ã€‚ ä¸‹é¢çš„ä»£ç æˆ‘ä»¬æ¥è¯»å–ä¸€ä¸‹è‡ªå®šä¹‰çš„æ•°æ®æºã€‚æœ‰äº†è‡ªå®šä¹‰çš„ source functionï¼Œæ¥ä¸‹æ¥åªè¦è°ƒç”¨ addSource()å°±å¯ä»¥äº† public static void main(String[] args) throws Exception{ StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); // æœ‰äº†è‡ªå®šä¹‰çš„ source functionï¼Œè°ƒç”¨ addSource æ–¹æ³• DataStreamSource&lt;Event&gt; stream = env.addSource(new ClickSource()); stream.print(\"SourceCustom\"); env.execute(); } æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰å¹¶è¡Œçš„æ•°æ®æºçš„è¯ï¼Œéœ€è¦ä½¿ç”¨ ParallelSourceFunction public static void main(String[] args) throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.addSource (new CustomSource ( )).setParallelism (2).print ( ); env.execute ( ); } public static class CustomSource implements ParallelSourceFunction&lt;Integer&gt; { private boolean running = true; private Random random = new Random ( ); @Override public void run(SourceContext&lt;Integer&gt; sourceContext) throws Exception { while (running) { sourceContext.collect (random.nextInt ( )); } } @Override public void cancel() { running = false; } } 5ã€Flink æ”¯æŒçš„æ•°æ®ç±»å‹1. Flink çš„ç±»å‹ç³»ç»ŸFlink æœ‰è‡ªå·±ä¸€æ•´å¥—ç±»å‹ç³»ç»Ÿã€‚Flink ä½¿ç”¨â€œç±»å‹ä¿¡æ¯â€ ï¼ˆTypeInformationï¼‰æ¥ç»Ÿä¸€è¡¨ç¤ºæ•°æ®ç±»å‹ã€‚TypeInformation ç±»æ˜¯ Flink ä¸­æ‰€æœ‰ç±»å‹æè¿°ç¬¦çš„åŸºç±»ã€‚ å®ƒæ¶µç›–äº†ç±»å‹çš„ä¸€äº›åŸºæœ¬å±æ€§ï¼Œå¹¶ä¸ºæ¯ä¸ªæ•°æ®ç±»å‹ç”Ÿæˆç‰¹å®šçš„åºåˆ—åŒ–å™¨ã€ååºåˆ—åŒ–å™¨å’Œæ¯”è¾ƒå™¨ã€‚ 2. Flink æ”¯æŒçš„æ•°æ®ç±»å‹ï¼ˆ1ï¼‰åŸºæœ¬ç±»å‹ æ‰€æœ‰ Java åŸºæœ¬ç±»å‹åŠå…¶åŒ…è£…ç±»ï¼Œå†åŠ ä¸Š Voidã€Stringã€Dateã€BigDecimal å’Œ BigIntegerã€‚ ï¼ˆ2ï¼‰æ•°ç»„ç±»å‹ åŒ…æ‹¬åŸºæœ¬ç±»å‹æ•°ç»„ï¼ˆPRIMITIVE_ARRAYï¼‰å’Œå¯¹è±¡æ•°ç»„(OBJECT_ARRAY) ï¼ˆ3ï¼‰å¤åˆæ•°æ®ç±»å‹ âš« Java å…ƒç»„ç±»å‹ï¼ˆTUPLEï¼‰ï¼šè¿™æ˜¯ Flink å†…ç½®çš„å…ƒç»„ç±»å‹ï¼Œæ˜¯ Java API çš„ä¸€éƒ¨åˆ†ã€‚æœ€å¤š 25 ä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯ä» Tuple0~Tuple25ï¼Œä¸æ”¯æŒç©ºå­—æ®µ âš« Scala æ ·ä¾‹ç±»åŠ Scala å…ƒç»„ï¼šä¸æ”¯æŒç©ºå­—æ®µ âš« è¡Œç±»å‹ï¼ˆROWï¼‰ï¼šå¯ä»¥è®¤ä¸ºæ˜¯å…·æœ‰ä»»æ„ä¸ªå­—æ®µçš„å…ƒç»„,å¹¶æ”¯æŒç©ºå­—æ®µ âš« POJOï¼šFlink è‡ªå®šä¹‰çš„ç±»ä¼¼äº Java bean æ¨¡å¼çš„ç±» ï¼ˆ4ï¼‰è¾…åŠ©ç±»å‹ Optionã€Eitherã€Listã€Map ç­‰ ï¼ˆ5ï¼‰æ³›å‹ç±»å‹ï¼ˆGENERICï¼‰ Flink æ”¯æŒæ‰€æœ‰çš„ Java ç±»å’Œ Scala ç±»ã€‚ä¸è¿‡å¦‚æœæ²¡æœ‰æŒ‰ç…§ä¸Šé¢ POJO ç±»å‹çš„è¦æ±‚æ¥å®šä¹‰ï¼Œå°±ä¼šè¢« Flink å½“ä½œæ³›å‹ç±»æ¥å¤„ç†ã€‚Flink ä¼šæŠŠæ³›å‹ç±»å‹å½“ä½œé»‘ç›’ï¼Œæ— æ³•è·å–å®ƒä»¬å†…éƒ¨çš„å±æ€§ï¼›å®ƒä»¬ä¹Ÿä¸æ˜¯ç”± Flink æœ¬èº«åºåˆ—åŒ–çš„ï¼Œè€Œæ˜¯ç”± Kryo åºåˆ—åŒ–çš„ã€‚åœ¨è¿™äº›ç±»å‹ä¸­ï¼Œå…ƒç»„ç±»å‹å’Œ POJO ç±»å‹æœ€ä¸ºçµæ´»ï¼Œå› ä¸ºå®ƒä»¬æ”¯æŒåˆ›å»ºå¤æ‚ç±»å‹ã€‚è€Œç›¸æ¯”ä¹‹ä¸‹ï¼ŒPOJO è¿˜æ”¯æŒåœ¨é”®ï¼ˆkeyï¼‰çš„å®šä¹‰ä¸­ç›´æ¥ä½¿ç”¨å­—æ®µåï¼Œè¿™ä¼šè®©æˆ‘ä»¬çš„ä»£ç å¯è¯»æ€§å¤§å¤§å¢åŠ ã€‚æ‰€ä»¥ï¼Œåœ¨é¡¹ç›®å®è·µä¸­ï¼Œå¾€å¾€ä¼šå°†æµå¤„ç†ç¨‹åºä¸­çš„å…ƒç´ ç±»å‹å®šä¸º Flink çš„ POJO ç±»å‹ã€‚ Flink å¯¹ POJO ç±»å‹çš„è¦æ±‚å¦‚ä¸‹ï¼š âš« ç±»æ˜¯å…¬å…±çš„ï¼ˆpublicï¼‰å’Œç‹¬ç«‹çš„ï¼ˆstandaloneï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰éé™æ€çš„å†…éƒ¨ç±»ï¼‰ï¼› âš« ç±»æœ‰ä¸€ä¸ªå…¬å…±çš„æ— å‚æ„é€ æ–¹æ³•ï¼› âš« ç±»ä¸­çš„æ‰€æœ‰å­—æ®µæ˜¯ public ä¸”é final çš„ï¼›æˆ–è€…æœ‰ä¸€ä¸ªå…¬å…±çš„ getter å’Œ setter æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éœ€è¦ç¬¦åˆ Java bean çš„å‘½åè§„èŒƒã€‚ æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°ï¼Œä¹‹å‰çš„ UserBehaviorï¼Œå°±æ˜¯æˆ‘ä»¬åˆ›å»ºçš„ç¬¦åˆ Flink POJO å®šä¹‰çš„æ•°æ®ç±»å‹ã€‚ 3. ç±»å‹æç¤ºï¼ˆType Hintsï¼‰ç”±äº Java ä¸­æ³›å‹æ“¦é™¤çš„å­˜åœ¨ï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼ˆæ¯”å¦‚ Lambda è¡¨è¾¾å¼ä¸­ï¼‰ï¼Œä¸ºäº†è§£å†³è¿™ç±»é—®é¢˜ï¼ŒJava API æä¾›äº†ä¸“é—¨çš„â€œç±»å‹æç¤ºâ€ï¼ˆtype hintsï¼‰ .map(word -&gt; Tuple2.of(word, 1L)) .returns(Types.TUPLE(Types.STRING, Types.LONG)); --------------------------------------------------------------------------- returns(new TypeHint&lt;Tuple2&lt;Integer, SomeType&gt;&gt;(){}) å››ã€è½¬æ¢ç®—å­ 1ã€åŸºæœ¬è½¬æ¢ç®—å­1. æ˜ å°„ï¼ˆmapï¼‰ä¸»è¦ç”¨äºå°†æ•°æ®æµä¸­çš„æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œå½¢æˆæ–°çš„æ•°æ®æµã€‚ç®€å•æ¥è¯´ï¼Œæ¶ˆè´¹ä¸€ä¸ªå…ƒç´ å°±äº§å‡ºä¸€ä¸ªå…ƒç´  æˆ‘ä»¬åªéœ€è¦åŸºäº DataStrema è°ƒç”¨ map()æ–¹æ³•å°±å¯ä»¥è¿›è¡Œè½¬æ¢å¤„ç†ã€‚æ–¹æ³•éœ€è¦ä¼ å…¥çš„å‚æ•°æ˜¯æ¥å£ MapFunction çš„å®ç°ï¼›è¿”å›å€¼ç±»å‹è¿˜æ˜¯ DataStream egï¼šæå– Event ä¸­çš„ user å­—æ®µçš„åŠŸèƒ½ package com.kk.model2; import com.kk.model2.pojo.Event; import org.apache.flink.api.common.functions.MapFunction; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; public class TransMapTest { public static void main(String[] args) throws Exception { // åˆ›é€ æ‰§è¡Œç¯å¢ƒ // å¹¶è¡Œä¸º 1 StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); // æ„å»ºæ•°æ® DataStreamSource&lt;Event&gt; stream = env.fromElements ( new Event (\"Mary\", \"./home\", 1000L), new Event (\"Bob\", \"./cart\", 2000L) ); // å†™æ³•ä¸€ï¼šä¼ å…¥åŒ¿åç±»ï¼Œå®ç° MapFunction stream.map (new MapFunction&lt;Event, String&gt; ( ) { @Override public String map(Event e) throws Exception { return e.user; } }).print ( ); // å†™æ³•äºŒï¼š ä¼ å…¥ MapFunction çš„å®ç°ç±» //stream.map (new UserExtractor ()).print (); env.execute ( ); } public static class UserExtractor implements MapFunction&lt;Event, String&gt; { @Override public String map(Event e) throws Exception { return e.user; } } } ä¸Šé¢ä»£ç ä¸­ï¼ŒMapFunction å®ç°ç±»çš„æ³›å‹ç±»å‹ï¼Œä¸è¾“å…¥æ•°æ®ç±»å‹å’Œè¾“å‡ºæ•°æ®çš„ç±»å‹æœ‰å…³ã€‚åœ¨å®ç° MapFunction æ¥å£çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šä¸¤ä¸ªæ³›å‹ï¼Œåˆ†åˆ«æ˜¯è¾“å…¥äº‹ä»¶å’Œè¾“å‡ºäº‹ä»¶çš„ç±»å‹ï¼Œè¿˜éœ€è¦é‡å†™ä¸€ä¸ª map()æ–¹æ³•ï¼Œå®šä¹‰ä»ä¸€ä¸ªè¾“å…¥äº‹ä»¶è½¬æ¢ä¸ºå¦ä¸€ä¸ªè¾“å‡ºäº‹ä»¶çš„å…·ä½“é€»è¾‘ã€‚ 2. è¿‡æ»¤ï¼ˆfilterï¼‰filter è½¬æ¢æ“ä½œï¼Œé¡¾åæ€ä¹‰æ˜¯å¯¹æ•°æ®æµæ‰§è¡Œä¸€ä¸ªè¿‡æ»¤ï¼Œé€šè¿‡ä¸€ä¸ªå¸ƒå°”æ¡ä»¶è¡¨è¾¾å¼è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œå¯¹äºæ¯ä¸€ä¸ªæµå†…å…ƒç´ è¿›è¡Œåˆ¤æ–­ï¼Œè‹¥ä¸º true åˆ™å…ƒç´ æ­£å¸¸è¾“å‡ºï¼Œè‹¥ä¸º false åˆ™å…ƒç´ è¢«è¿‡æ»¤æ‰ package com.kk.model2; import com.kk.model2.pojo.Event; import org.apache.flink.api.common.functions.FilterFunction; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; public class TransFilterTest { public static void main(String[] args) throws Exception { // åˆ›é€ æ‰§è¡Œç¯å¢ƒ // å¹¶è¡Œä¸º 1 StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); // æ„å»ºæ•°æ® DataStreamSource&lt;Event&gt; stream = env.fromElements ( new Event (\"Mary\", \"./home\", 1000L), new Event (\"Bob\", \"./cart\", 2000L) ); // å†™æ³•ä¸€ï¼šä¼ å…¥åŒ¿åç±»å®ç° FilterFunction stream.filter (new FilterFunction&lt;Event&gt; ( ) { @Override public boolean filter(Event e) throws Exception { return e.user.equals (\"Bob\"); } }).print ( ); // å†™æ³•äºŒï¼šä¼ å…¥ FilterFunction å®ç°ç±» stream.filter (new UserFilter ( )).print ( ); env.execute ( ); } public static class UserFilter implements FilterFunction&lt;Event&gt; { @Override public boolean filter(Event e) throws Exception { return e.user.equals (\"Mary\"); } } } è¿›è¡Œ filter è½¬æ¢ä¹‹åçš„æ–°æ•°æ®æµçš„æ•°æ®ç±»å‹ä¸åŸæ•°æ®æµæ˜¯ç›¸åŒçš„ã€‚filter è½¬æ¢éœ€è¦ä¼ å…¥çš„å‚æ•°éœ€è¦å®ç° FilterFunction æ¥å£ï¼Œè€Œ FilterFunction å†…è¦å®ç° filter()æ–¹æ³•ï¼Œå°±ç›¸å½“äºä¸€ä¸ªè¿”å›å¸ƒå°”ç±»å‹çš„æ¡ä»¶è¡¨è¾¾å¼ã€‚ 3ã€æ‰å¹³æ˜ å°„ï¼ˆflatMapï¼‰flatMap æ“ä½œåˆç§°ä¸ºæ‰å¹³æ˜ å°„ï¼Œä¸»è¦æ˜¯å°†æ•°æ®æµä¸­çš„æ•´ä½“ï¼ˆä¸€èˆ¬æ˜¯é›†åˆç±»å‹ï¼‰æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„ä¸ªä½“ä½¿ç”¨ã€‚æ¶ˆè´¹ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥äº§ç”Ÿ 0 åˆ°å¤šä¸ªå…ƒç´ ,ä¹Ÿå°±æ˜¯å…ˆæŒ‰ç…§æŸç§è§„åˆ™å¯¹æ•°æ®è¿›è¡Œæ‰“æ•£æ‹†åˆ†ï¼Œå†å¯¹æ‹†åˆ†åçš„å…ƒç´ åšè½¬æ¢å¤„ç† package com.kk.model2; import com.kk.model2.pojo.Event; import org.apache.flink.api.common.functions.FlatMapFunction; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; import org.apache.flink.util.Collector; public class TransFlatmapTest { public static void main(String[] args) throws Exception { // åˆ›é€ æ‰§è¡Œç¯å¢ƒ // å¹¶è¡Œä¸º 1 StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); // æ„å»ºæ•°æ® DataStreamSource&lt;Event&gt; stream = env.fromElements ( new Event (\"Mary\", \"./home\", 1000L), new Event (\"Bob\", \"./cart\", 2000L) ); stream.flatMap (new FlatMapFunction&lt;Event, String&gt; ( ) { @Override public void flatMap(Event e, Collector&lt;String&gt; collector) throws Exception { if (e.user.equals (\"Mary\")) { collector.collect (e.user); } else if (e.user.equals (\"Bob\")) { collector.collect (e.user); collector.collect (e.url); } } }).print ( );// print () æ‰“å° // æ‰§è¡Œ env.execute ( ); } } flatMap æ“ä½œä¼šåº”ç”¨åœ¨æ¯ä¸€ä¸ªè¾“å…¥äº‹ä»¶ä¸Šé¢ï¼ŒFlatMapFunction æ¥å£ä¸­å®šä¹‰äº† flatMap æ–¹æ³•ï¼Œ ç”¨æˆ·å¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¯¹è¾“å…¥æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶å†³å®šæ˜¯è¿”å› 0 ä¸ªã€1 ä¸ªæˆ–å¤šä¸ªç»“æœæ•°æ®ã€‚å› æ­¤ flatMap å¹¶æ²¡æœ‰ç›´æ¥å®šä¹‰è¿”å›å€¼ç±»å‹ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªâ€œæ”¶é›†å™¨â€ï¼ˆCollectorï¼‰æ¥æŒ‡å®šè¾“å‡ºã€‚å¸Œæœ›è¾“å‡ºç»“æœæ—¶ï¼Œåªè¦è°ƒç”¨æ”¶é›†å™¨çš„.collect()æ–¹æ³•å°±å¯ä»¥äº†ï¼›è¿™ä¸ªæ–¹æ³•å¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥ä¸è°ƒç”¨ã€‚æ‰€ä»¥ flatMap æ–¹æ³•ä¹Ÿå¯ä»¥å®ç° map æ–¹æ³•å’Œ filter æ–¹æ³•çš„åŠŸèƒ½ï¼Œå½“è¿”å›ç»“æœæ˜¯ 0 ä¸ªçš„æ—¶å€™ï¼Œå°±ç›¸å½“äºå¯¹æ•°æ®è¿›è¡Œäº†è¿‡æ»¤ï¼Œå½“è¿”å›ç»“æœæ˜¯ 1 ä¸ªçš„æ—¶å€™ï¼Œç›¸å½“äºå¯¹æ•°æ®è¿›è¡Œäº†ç®€å•çš„è½¬æ¢æ“ä½œã€‚ 2ã€èšåˆç®—å­1. æŒ‰é”®åˆ†åŒºkeyBy æ˜¯èšåˆå‰å¿…é¡»è¦ç”¨åˆ°çš„ä¸€ä¸ªç®—å­ã€‚keyBy é€šè¿‡æŒ‡å®šé”®ï¼ˆkeyï¼‰ï¼Œå¯ä»¥å°†ä¸€æ¡æµä»é€»è¾‘ä¸Šåˆ’åˆ†æˆä¸åŒçš„åˆ†åŒºï¼ˆpartitionsï¼‰ã€‚è¿™é‡Œæ‰€è¯´çš„åˆ†åŒºï¼Œå…¶å®å°±æ˜¯å¹¶è¡Œå¤„ç†çš„å­ä»»åŠ¡ï¼Œä¹Ÿå°±å¯¹åº”ç€ä»»åŠ¡æ§½ package com.kk.model2; import com.kk.model2.pojo.Event; import org.apache.flink.streaming.api.datastream.DataStreamSink; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; public class TransKeyByTest { public static void main(String[] args) throws Exception { // åˆ›é€ æ‰§è¡Œç¯å¢ƒ // å¹¶è¡Œä¸º 1 StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); // æ„å»ºæ•°æ® DataStreamSource&lt;Event&gt; stream = env.fromElements ( new Event (\"Mary\", \"./home\", 1000L), new Event (\"Bob\", \"./cart\", 2000L) ); // lambda DataStreamSink&lt;Event&gt; byKeyStream = stream.keyBy (e -&gt; e.user).print ( ); env.execute ( ); } } 2. ç®€å•èšåˆâš« sum()ï¼šåœ¨è¾“å…¥æµä¸Šï¼Œå¯¹æŒ‡å®šçš„å­—æ®µåšå åŠ æ±‚å’Œçš„æ“ä½œã€‚ âš« min()ï¼šåœ¨è¾“å…¥æµä¸Šï¼Œå¯¹æŒ‡å®šçš„å­—æ®µæ±‚æœ€å°å€¼ã€‚ âš« max()ï¼šåœ¨è¾“å…¥æµä¸Šï¼Œå¯¹æŒ‡å®šçš„å­—æ®µæ±‚æœ€å¤§å€¼ã€‚ âš« minBy()ï¼šä¸ min()ç±»ä¼¼ï¼Œåœ¨è¾“å…¥æµä¸Šé’ˆå¯¹æŒ‡å®šå­—æ®µæ±‚æœ€å°å€¼ã€‚ä¸åŒçš„æ˜¯ï¼Œmin()åªè®¡ç®—æŒ‡å®šå­—æ®µçš„æœ€å°å€¼ï¼Œå…¶ä»–å­—æ®µä¼šä¿ç•™æœ€åˆç¬¬ä¸€ä¸ªæ•°æ®çš„å€¼ï¼›è€Œ minBy()åˆ™ä¼šè¿”å›åŒ… å«å­—æ®µæœ€å°å€¼çš„æ•´æ¡æ•°æ®ã€‚ âš« maxBy()ï¼šä¸ max()ç±»ä¼¼ï¼Œåœ¨è¾“å…¥æµä¸Šé’ˆå¯¹æŒ‡å®šå­—æ®µæ±‚æœ€å¤§å€¼ã€‚ä¸¤è€…åŒºåˆ«ä¸ min()/minBy()å®Œå…¨ä¸€è‡´ã€‚ package com.kk.model2; import org.apache.flink.api.java.tuple.Tuple2; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; public class TransTupleAggreationTest { public static void main(String[] args) throws Exception { // åˆ›é€ æ‰§è¡Œç¯å¢ƒ // å¹¶è¡Œä¸º 1 StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); // æ„å»ºæ•°æ® DataStreamSource&lt;Tuple2&lt;String, Integer&gt;&gt; stream = env.fromElements ( Tuple2.of (\"a\", 1), Tuple2.of (\"a\", 5), Tuple2.of (\"a\", 3), Tuple2.of (\"b\", 4), Tuple2.of (\"b\", 5), Tuple2.of (\"b\", 2) ); // stream.keyBy(r -&gt; r.f0).sum(1).print(\"SUM:\"); // stream.keyBy(r -&gt; r.f0).sum(\"f1\").print(); stream.keyBy(r -&gt; r.f0).max(1).print(\"MAX\"); // stream.keyBy(r -&gt; r.f0).max(\"f1\").print(); // stream.keyBy(r -&gt; r.f0).min(1).print(); // stream.keyBy(r -&gt; r.f0).min(\"f1\").print(); // stream.keyBy(r -&gt; r.f0).maxBy(1).print(); // stream.keyBy(r -&gt; r.f0).maxBy(\"f1\").print(); // stream.keyBy(r -&gt; r.f0).minBy(1).print(); // stream.keyBy(r -&gt; r.f0).minBy(\"f1\").print(); env.execute (); } } è€Œå¦‚æœæ•°æ®æµçš„ç±»å‹æ˜¯ POJO ç±»ï¼Œé‚£ä¹ˆå°±åªèƒ½é€šè¿‡å­—æ®µåç§°æ¥æŒ‡å®šï¼Œä¸èƒ½é€šè¿‡ä½ç½®æ¥æŒ‡å®šäº† package com.kk.model3; import com.kk.model2.pojo.Event; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; public class TransformSimpleaggTest { public static void main(String[] args) throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); DataStreamSource&lt;Event&gt; stream = env.fromElements ( new Event (\"Mary\", \"/home\", 1000L), new Event (\"Bob\", \"/cart\", 2000L), new Event (\"Alice\", \"/prod?id=100\", 3000L), new Event (\"Bob\", \"/prod?id=1\", 3300L), new Event (\"Bob\", \"/home?id=2\", 3800L), new Event (\"Alice\", \"/prod?id=200\", 3200L), new Event (\"Bob\", \"/home?id=3\", 4000L) ); // æŒ‰é”®åˆ†ç»„ä¹‹åè¿›è¡Œèšåˆï¼Œæå–å½“å‰ç”¨æˆ·æœ€è¿‘ä¸€æ¬¡è®¿é—®æ•°æ®ï¼ˆæœ€å¤§æ—¶é—´æ•°å€¼ï¼‰ /*stream.keyBy (new KeySelector&lt;Event, String&gt; ( ) { @Override public String getKey(Event val) { return val.user; } });*/ // ä»¥å user ä½œä¸º key,timestamp ä½œä¸ºæ’åºå€¼ stream.keyBy (val -&gt;val.user).max (\"timestamp\").print (\"max:\"); stream.keyBy (val -&gt;val.user).maxBy (\"timestamp\").print (\"maxBy:\"); env.execute (); // æ€»ç»“ï¼šåŒæ ·ï¼Œmaxå’ŒmaxByçš„åŒºåˆ«åœ¨äºï¼Œmaxç®—å­å¯¹æŸå­—æ®µæ±‚æœ€å¤§å€¼ï¼ŒmaxByè¿”å›å…·æœ‰æœ€å¤§å€¼çš„å…ƒç´ ã€‚ } } æ€»ç»“ï¼šåŒæ ·ï¼Œmaxå’ŒmaxByçš„åŒºåˆ«åœ¨äºï¼Œmaxç®—å­å¯¹æŸå­—æ®µæ±‚æœ€å¤§å€¼ï¼ŒmaxByè¿”å›å…·æœ‰æœ€å¤§å€¼çš„å…ƒç´ ã€‚ 3. å½’çº¦èšåˆï¼ˆreduceï¼‰éœ€æ±‚ï¼šç»Ÿè®¡å‡ºç”¨æˆ·è®¿é—®é¢‘ç‡æœ€é«˜çš„ package com.kk.model3; import com.kk.model2.pojo.Event; import org.apache.flink.api.common.functions.MapFunction; import org.apache.flink.api.common.functions.ReduceFunction; import org.apache.flink.api.java.tuple.Tuple2; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; public class TransformReduceTest { public static void main(String[] args) throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); DataStreamSource&lt;Event&gt; stream = env.fromElements ( new Event (\"Mary\", \"/home\", 1000L), new Event (\"Bob\", \"/cart\", 2000L), new Event (\"Alice\", \"/prod?id=100\", 3000L), new Event (\"Bob\", \"/prod?id=1\", 3300L), new Event (\"Alice\", \"/prod?id=200\", 3200L), new Event (\"Bob\", \"/home?id=2\", 3800L), new Event (\"Bob\", \"/home?id=3\", 4000L) ); // 1ã€ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„è®¿é—®é¢‘ç‡ // ä¾ç„¶æ˜¯ä¸€ä¸ªDataStream SingleOutputStreamOperator&lt;Tuple2&lt;String, Long&gt;&gt; clicksByUser = stream.map (new MapFunction&lt;Event, Tuple2&lt;String, Long&gt;&gt; ( ) { @Override public Tuple2&lt;String, Long&gt; map(Event val) { return Tuple2.of (val.user, 1L);// å°†pojoè½¬æˆäºŒå…ƒç»„ï¼Œæ¯æ¬¡ç”¨æˆ·+1æ¬¡,ç›¸å½“äºèµ‹å€¼Listä¸­çš„å…ƒç´  } }).keyBy (data -&gt; data.f0)// æŒ‰é”®åˆ†åŒº(ç»„ .reduce (new ReduceFunction&lt;Tuple2&lt;String, Long&gt;&gt; ( ) { @Override public Tuple2&lt;String, Long&gt; reduce(Tuple2&lt;String, Long&gt; val1, Tuple2&lt;String, Long&gt; val2) throws Exception { // æ–°äºŒå…ƒç»„ å‚1ä¸ºkey,å‚2ä¸ºæ¯æ¬¡çš„å åŠ  return Tuple2.of (val1.f0, val1.f1 + val2.f1); } }); // 2ã€è·å–å½“å‰æœ€æ´»è·ƒçš„ç”¨æˆ· // æ‰€æœ‰çš„æ•°æ®éƒ½æœ‰ç›¸åŒçš„keyï¼Œéƒ½ä¼šåˆ†é…åˆ°åŒä¸€ä¸ªåˆ†åŒºï¼ˆç”Ÿäº§æ…ç”¨ï¼ŒåŒä¸€ä¸ªåˆ†åŒºåˆ™ä¸ºä¸²è¡Œï¼ˆå•çº¿ç¨‹ï¼‰ï¼‰ SingleOutputStreamOperator&lt;Tuple2&lt;String, Long&gt;&gt; result = clicksByUser.keyBy (data -&gt; \"key\") .reduce (new ReduceFunction&lt;Tuple2&lt;String, Long&gt;&gt; ( ) { @Override public Tuple2&lt;String, Long&gt; reduce(Tuple2&lt;String, Long&gt; val1, Tuple2&lt;String, Long&gt; val2) throws Exception { // åˆ¤æ–­è°çš„æ•°å€¼å¤§ï¼Œè¾“å‡ºå®Œæ•´å®ä½“ return val1.f1 &gt; val2.f1 ? val1 : val2; } }); result.print ( );// è¾“å‡º env.execute ( ); } } 3ã€è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰1ã€å‡½æ•°ç±»å…¶å®ä¸Šé¢å·²ç»ä»‹ç»è¿‡ 2ã€åŒ¿åç±»å…¶å®ä¸Šé¢å·²ç»ä»‹ç»è¿‡ https://mykkto.cn/image/blog/2022/Interview/202303252125554.png 3ã€å¯Œå‡½æ•°ç”Ÿå‘½å‘¨æœŸï¼š open()æ–¹æ³•ï¼Œæ˜¯ Rich Function çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¼šå¼€å¯ä¸€ä¸ªç®—å­çš„ç”Ÿå‘½å‘¨æœŸã€‚å½“ä¸€ä¸ªç®—å­çš„å®é™…å·¥ä½œæ–¹æ³•ä¾‹å¦‚ map()æˆ–è€… filter()æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰ï¼Œ close()æ–¹æ³•ï¼Œæ˜¯ç”Ÿå‘½å‘¨æœŸä¸­çš„æœ€åä¸€ä¸ªè°ƒç”¨çš„æ–¹æ³•ï¼Œç±»ä¼¼äºè§£æ„æ–¹æ³•ã€‚ä¸€èˆ¬ç”¨æ¥åšä¸€äº›æ¸…ç†å·¥ä½œã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºä¸€ä¸ªå¹¶è¡Œå­ä»»åŠ¡æ¥è¯´åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼›è€Œå¯¹åº”çš„ï¼Œ å®é™…å·¥ä½œæ–¹æ³•ï¼Œåœ¨æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šè§¦å‘ä¸€æ¬¡è°ƒç”¨ã€‚ StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); æ¯”å¦‚1æ˜¯ä¸²è¡Œï¼Œå°±ä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå¼€å…³æ–¹æ³•å°±è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœ setParallelism ä¸º2å°±æ˜¯ä¸¤æ¬¡å¼€å…³ç”Ÿå‘½å‘¨æœŸ ä¸Šæ¡ˆä¾‹ï¼š package com.kk.model3; import com.kk.model2.pojo.Event; import org.apache.flink.api.common.functions.RichMapFunction; import org.apache.flink.configuration.Configuration; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; public class TransformRichFunctionTest { public static void main(String[] args) throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); // æ³¨æ„ï¼šè¿™è¾¹çº¿ç¨‹1ä¸ªç”Ÿå‘½å‘¨æœŸå¼€å…³ä¸€æ¬¡ï¼Œ2ä¸ªä¾¿æœ‰2é env.setParallelism (1); DataStreamSource&lt;Event&gt; stream = env.fromElements ( new Event (\"Mary\", \"./home\", 1000L), new Event (\"Tom\", \"./cart\", 3000L), new Event (\"Bob\", \"./cart?id=1\", 2000L) ); // è®¾ç½®å¹¶è¡Œåº¦=ç”Ÿå‘½å‘¨æœŸæ¬¡æ•° stream.map (new MyRichMapper ( )).setParallelism (2).print ( ); env.execute ( ); } public static class MyRichMapper extends RichMapFunction&lt;Event, Integer&gt; { @Override public void open(Configuration parameters) throws Exception { super.open (parameters); // è·å–å½“å‰ç´¢å¼•å· System.out.println (\"openç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š\" + getRuntimeContext ( ).getIndexOfThisSubtask ( ) + \"å·ä»»åŠ¡å¯åŠ¨\"); } @Override public Integer map(Event value) { return value.url.length ( ); } @Override public void close() throws Exception { super.close ( ); System.out.println (\"closeç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š\" + getRuntimeContext ( ).getIndexOfThisSubtask ( ) + \"å·ä»»åŠ¡å¯åŠ¨\"); } } } openç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š1å·ä»»åŠ¡å¯åŠ¨ openç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š0å·ä»»åŠ¡å¯åŠ¨ closeç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š0å·ä»»åŠ¡å¯åŠ¨ closeç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š1å·ä»»åŠ¡å¯åŠ¨ 6 11 6 ä¸€ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›è¿æ¥åˆ°ä¸€ä¸ªå¤–éƒ¨æ•°æ®åº“è¿›è¡Œè¯»å†™æ“ä½œï¼Œé‚£ä¹ˆå°†è¿æ¥æ“ä½œæ”¾åœ¨ map()ä¸­æ˜¾ç„¶ä¸æ˜¯ä¸ªå¥½é€‰æ‹©â€”â€”å› ä¸ºæ¯æ¥ä¸€æ¡æ•°æ®å°±ä¼šé‡æ–°è¿æ¥ä¸€æ¬¡æ•°æ®åº“ï¼›æ‰€ä»¥ æˆ‘ä»¬å¯ä»¥åœ¨ open()ä¸­å»ºç«‹è¿æ¥ï¼Œåœ¨ map()ä¸­è¯»å†™æ•°æ®ï¼Œè€Œåœ¨ close()ä¸­å…³é—­è¿æ¥ã€‚æ‰€ä»¥æˆ‘ä»¬æ¨èçš„æœ€ä½³å®è·µå¦‚ä¸‹ï¼š public class MyFlatMap extends RichFlatMapFunction&lt;IN, OUT&gt;&gt; { @Override public void open(Configuration configuration) { // åšä¸€äº›åˆå§‹åŒ–å·¥ä½œ // ä¾‹å¦‚å»ºç«‹ä¸€ä¸ªå’Œ MySQL çš„è¿æ¥ } @Override public void flatMap(IN in, Collector&lt;OUT out) { // å¯¹æ•°æ®åº“è¿›è¡Œè¯»å†™ } @Override public void close() { // æ¸…ç†å·¥ä½œï¼Œå…³é—­å’Œ MySQL æ•°æ®åº“çš„è¿æ¥ã€‚ } } 4ã€ç‰©ç†åˆ†åŒº1ã€éšæœºåˆ†åŒº2ã€è½®è®­åˆ†åŒºï¼ˆé»˜è®¤ï¼‰3ã€rescale é‡ç¼©æ”¾åˆ†åŒº4ã€å¹¿æ’­ï¼ˆå‘ç»™æ¯ä¸ªçº¿ç¨‹ï¼‰5ã€å…¨å±€åˆ†åŒºï¼ˆå¼ºè¡Œè®¾ç½®æˆ 1 ä¸²è¡Œï¼‰6ã€è‡ªå®šä¹‰é‡åˆ†åŒºï¼ˆæœ‰ç‚¹åƒ4ï¼‰package com.kk.model3; import com.kk.model2.pojo.Event; import org.apache.flink.api.common.functions.Partitioner; import org.apache.flink.api.java.functions.KeySelector; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; import org.apache.flink.streaming.api.functions.source.RichParallelSourceFunction; public class TransformPartitionTest { public static void main(String[] args)throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); DataStreamSource&lt;Event&gt; stream = env.fromElements ( new Event (\"Mary\", \"/home\", 1000L), new Event (\"Bob\", \"/cart\", 2000L), new Event (\"Alice\", \"/prod?id=100\", 3000L), new Event (\"Bob\", \"/prod?id=1\", 3300L), new Event (\"Alice\", \"/prod?id=200\", 3200L), new Event (\"Bob\", \"/home?id=2\", 3800L), new Event (\"Bob\", \"/home?id=3\", 4000L) ); m6 (env); env.execute (); } public static void m1(DataStreamSource stream){ // 1ã€éšæœºåˆ†åŒº stream.shuffle ().print ().setParallelism (4); } public static void m2(DataStreamSource stream){ // 2ã€è½®è®­åˆ†åŒº stream.print ().setParallelism (4); // stream.rebalance ().print ().setParallelism (3); } public static void m3(StreamExecutionEnvironment env){ // 3ã€rescale é‡ç¼©æ”¾åˆ†åŒº(ä½¿ç”¨åˆç†çš„è¯æ•ˆç‡æ›´é«˜ // RichParallelSourceFunction æŠ½è±¡çˆ¶å‡½æ•°çš„å­å®ç° env.addSource (new RichParallelSourceFunction&lt;String&gt; ( ) { @Override public void run(SourceContext&lt;String&gt; ctx)throws Exception { for (int i = 1; i &lt;= 8; i++) { // å°†å¥‡å¶æ•°åˆ†åˆ«å‘é€åˆ°0å·æˆ–1å·åˆ†åŒº if (i%2==getRuntimeContext ().getIndexOfThisSubtask ()) ctx.collect (i+\",\"+getRuntimeContext ().getIndexOfThisSubtask ()); } } @Override public void cancel() { } }).setParallelism (2).rescale ().print ().setParallelism (4); } public static void m4(DataStreamSource stream){ // 4ã€å¹¿æ’­ï¼ˆå‘ç»™æ¯ä¸ªçº¿ç¨‹ï¼‰ stream.broadcast ().print ().setParallelism (4); } public static void m5(DataStreamSource stream){ // 5ã€å…¨å±€åˆ†åŒºï¼ˆå¼ºè¡Œè®¾ç½®æˆ 1 ä¸²è¡Œï¼‰ stream.global ().print ().setParallelism (4); } public static void m6(StreamExecutionEnvironment env){ // 6ã€è‡ªå®šä¹‰é‡åˆ†åŒºï¼ˆè‡ªå®šä¹‰åˆ†åŒºå™¨ï¼Œæ•°æ®é•¿ä»€ä¹ˆæ ·ï¼Œå°±åˆ†é…åˆ°å“ªé‡Œï¼‰ env.fromElements (1,2,3,4,5,6,7,8) .partitionCustom (new Partitioner&lt;Integer&gt; ( ) { @Override public int partition(Integer key, int num) { // æŒ‡å®šåˆ†åŒºç­–ç•¥ return key % 2; } }, new KeySelector&lt;Integer, Integer&gt; ( ) { @Override public Integer getKey(Integer value) throws Exception { return value; } }) .print ().setParallelism (4); } } äº”ã€è¾“å‡ºç®—å­1ã€è¾“å‡ºåˆ°æ–‡ä»¶æ¯”å¦‚æˆ‘ä»¬ç»å¸¸ç”¨çš„æ—¥å¿—æ–‡ä»¶ï¼Œå°±æ˜¯ç±»ä¼¼äºè¿™ç§æ»šåŠ¨è¾“å‡º package com.kk.model4; import com.kk.BaseUtil; import org.apache.flink.api.common.serialization.SimpleStringEncoder; import org.apache.flink.core.fs.Path; import org.apache.flink.streaming.api.functions.sink.filesystem.StreamingFileSink; import org.apache.flink.streaming.api.functions.sink.filesystem.rollingpolicies.DefaultRollingPolicy; import java.util.concurrent.TimeUnit; public class SinkToFileTest { public static void main(String[] args) throws Exception { // 1ã€å®šä¹‰Stringç±»å‹æ–¹ä¾¿è¾“å‡º StreamingFileSink&lt;String&gt; streamingFileSink = StreamingFileSink.&lt;String&gt;forRowFormat ( new Path (\"./output\"),// è¾“å‡ºè·¯å¾„ new SimpleStringEncoder&lt;&gt; (\"UTF-8\"))//å­—ç¬¦é›† // æŒ‡å®šæ»šåŠ¨ç­–ç•¥ï¼š // æ¯”å¦‚æ—¥å¿—æ–‡ä»¶ä¸åœå†™å…¥ï¼Œæ–‡ä»¶ä¸åœå¢å¤§ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªç­–ç•¥è®¾ç½®ä¸€ä¸ªæ–‡ä»¶å¤šå¤§åœæ­¢å†™å…¥ï¼Œ // å¼€å¯ä¸€ä¸ªæ–°çš„æ–‡ä»¶ç»§ç»­å†™å…¥ .withRollingPolicy ( DefaultRollingPolicy.builder ( ) .withMaxPartSize (1024 * 1024 * 1024)// æ»šåŠ¨å¤§å°ï¼š1G // æ»šåŠ¨æ—¶é—´ï¼Œ15åˆ†é’Ÿå¼€å¯ä¸€ä¸ªæ–°çš„ .withRolloverInterval (TimeUnit.MINUTES.toMinutes (15)) // æ»šåŠ¨å‘¨æœŸï¼ˆå¦‚æœ5åˆ†é’Ÿæ²¡æœ‰æ•°æ®å†™å…¥ï¼Œåˆ™å¼€å¯ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼‰ .withInactivityInterval (TimeUnit.MINUTES.toMinutes (5)) .build ( ) ) .build ( );// æ„å»ºè¿”å›å¯¹è±¡ BaseUtil.stream.map (data -&gt; data.toString ( )) .addSink (streamingFileSink); BaseUtil.env.setParallelism (4); BaseUtil.env.execute (); } } 2ã€è¾“å‡ºåˆ°kafkaï¼ˆ1ï¼‰åˆ›å»ºç”Ÿäº§è€… 1ã€è¿›å…¥å®¹å™¨ docker exec -it kafka /bin/sh 2ã€è¿›å…¥é©±åŠ¨æ–‡ä»¶è·¯å¾„ cd opt/kafka/bin 3ã€åˆ›å»ºç”Ÿäº§è€… ./kafka-console-producer.sh --broker-list localhost:9092 --topic clicks ï¼ˆ2ï¼‰åˆ›å»ºæ¶ˆè´¹è€… ./kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic events ï¼ˆ3ï¼‰ç¼–ç  package com.kk.model4; import com.kk.BaseUtil; import com.kk.model2.pojo.Event; import org.apache.flink.api.common.functions.MapFunction; import org.apache.flink.api.common.serialization.SimpleStringSchema; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumer; import org.apache.flink.streaming.connectors.kafka.FlinkKafkaProducer; import java.util.Properties; public class SinkToKafka { public static void main(String[] args)throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); Properties properties = new Properties ( ); properties.setProperty (\"bootstrap.servers\", BaseUtil.KAFKAURL); // 1ã€ä»kafkaä¸­è¯»å–æ•°æ® DataStreamSource&lt;String&gt; kafkaStream = env.addSource (new FlinkKafkaConsumer&lt;String&gt; ( \"clicks\", new SimpleStringSchema ( ), properties )); kafkaStream.print ( ); // 2ã€ç”¨flinkè¿›è¡Œè½¬æ¢å¤„ç† SingleOutputStreamOperator&lt;String&gt; result = kafkaStream.map (new MapFunction&lt;String, String&gt; ( ) { @Override public String map(String value) { String[] fields = value.split (\",\"); return new Event (fields[0].trim ( ), fields[1].trim ( ), Long.valueOf (fields[2])).toString ( ); } }); // 3ã€ç»“æœæ•°æ®å†™å…¥ kafka result.addSink (new FlinkKafkaProducer&lt;String&gt; (BaseUtil.KAFKAURL,\"events\",new SimpleStringSchema ())); env.execute (); } } (4)æµç¨‹ ç”Ÿäº§è€…å‘é€ -ã€‹ flink æ¥æ”¶å¤„ç† -ã€‹ kafka æ¶ˆè´¹è€…æ¶ˆè´¹ ï¼ˆXï¼‰è¡¥å……ï¼škafka å¯¹å¤–è¿œç¨‹æ˜ å°„ docker å¯åŠ¨éœ€è¦æŒ‡å®šå…¬ç½‘é…ç½®ï¼Œå¦‚æœæ²¡æœ‰é…ç½®çš„è¯ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶é…ç½®(é‡å¯æœ‰è‡ªåŠ¨é‡åˆ·å›åŸå§‹çš„é—®é¢˜) é…ç½®è·¯å¾„ï¼šopt/kafka/conf/services.properties 3ã€è¾“å‡ºåˆ°Redis&lt;dependency&gt; &lt;groupId&gt;org.apache.bahir&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-redis_2.11&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/dependency&gt; éœ€è¦å®ç°ä¸€ä¸ªå­ç±»å®ç°æ¥å£ RedisMapperï¼Œè¿™è¾¹ä½¿ç”¨åŒ¿åç±»ï¼Œä¸»è¦æ˜¯ RedisCommandDescription çš„ä¸¤ä¸ªå‚æ•°ï¼Œä»¥åŠå…¶ä»–ä¸¤ä¸ªå‡½æ•°keyï¼Œvalueçš„é‡å†™ package com.kk.model4; import com.kk.model2.ClickSource; import com.kk.model2.pojo.Event; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; import org.apache.flink.streaming.connectors.redis.RedisSink; import org.apache.flink.streaming.connectors.redis.common.config.FlinkJedisPoolConfig; import org.apache.flink.streaming.connectors.redis.common.mapper.RedisCommand; import org.apache.flink.streaming.connectors.redis.common.mapper.RedisCommandDescription; import org.apache.flink.streaming.connectors.redis.common.mapper.RedisMapper; public class SinkToRedis { public static void main(String[] args) throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( ); env.setParallelism (1); // Event æ˜¯æˆ‘ä»¬å°è£…çš„ç±»å®ä½“ FlinkJedisPoolConfig conf = new FlinkJedisPoolConfig.Builder ( ).setHost (IpUtil.IPREDIS).build ( ); env.addSource (new ClickSource ( )) // åŒ¿åå†…éƒ¨ç±»å®ç° RedisMapperæ¥å£ .addSink (new RedisSink&lt;Event&gt; (conf, new RedisMapper&lt;Event&gt; ( ) { @Override public String getKeyFromData(Event e) { return e.user; } @Override public String getValueFromData(Event event) { return event.url; } @Override public RedisCommandDescription getCommandDescription() { // å‚æ•°1ï¼šredis å­˜å‚¨çš„æ•°æ®ç»“æ„ç±»å‹ hset æ•£åˆ—å‡½æ•° // å‚æ•°2ï¼šredis çš„ key clicks return new RedisCommandDescription (RedisCommand.HSET, \"clicks\"); } })); env.execute ( ); } // è‡ªå®šä¹‰å®ç°RedisMapperæ¥å£ //public static class MyRedisMapper implements RedisMapper&lt;Event&gt; } 4ã€è¾“å‡ºåˆ°ElasticecSearch&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-elasticsearch7_${scala.binary.version}&lt;/artifactId&gt; &lt;version&gt;${flink.version}&lt;/version&gt; &lt;/dependency&gt; package com.kk.model4; import com.kk.model2.pojo.Event; import org.apache.flink.api.common.functions.RuntimeContext; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; import org.apache.flink.streaming.connectors.elasticsearch.ElasticsearchSinkFunction; import org.apache.flink.streaming.connectors.elasticsearch.RequestIndexer; import org.apache.flink.streaming.connectors.elasticsearch6.ElasticsearchSink; import org.apache.http.HttpHost; import org.elasticsearch.action.index.IndexRequest; import org.elasticsearch.client.Requests; import java.util.ArrayList; import java.util.HashMap; public class SinkToElasticSearch { public static void main(String[] args) throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment .getExecutionEnvironment ( ); env.setParallelism (1); Event[] events = { new Event (\"Mary\", \"./home\", 1000L), new Event (\"Bob\", \"./cart\", 2000L), new Event (\"Alice\", \"./prod?id=100\", 3000L), new Event (\"Alice\", \"./prod?id=200\", 3500L), new Event (\"Bob\", \"./prod?id=2\", 2500L), new Event (\"Alice\", \"./prod?id=300\", 3600L), new Event (\"Bob\", \"./home\", 3000L), new Event (\"Bob\", \"./prod?id=1\", 2300L), new Event (\"Bob\", \"./prod?id=3\", 3300L) }; // å‚æ•°æ˜¯ä¸ªå¯å˜æ•°ç»„ DataStreamSource&lt;Event&gt; stream = env.fromElements (events); ArrayList&lt;HttpHost&gt; httpHosts = new ArrayList&lt;&gt; ( ); httpHosts.add (new HttpHost (IpUtil.IPES, 9200, \"http\")); // åˆ›å»ºä¸€ä¸ª ElasticsearchSinkFunction ElasticsearchSinkFunction&lt;Event&gt; elasticsearchSinkFunction = new ElasticsearchSinkFunction&lt;Event&gt; ( ) { @Override public void process(Event event, RuntimeContext ctx, RequestIndexer indexer) { HashMap&lt;String, String&gt; data = new HashMap&lt;&gt; ( ); data.put (event.user, event.url); IndexRequest request = Requests.indexRequest ( ) .index (\"clicks\") // keyå .type (\"type\")// Es 6 å¿…é¡»å®šä¹‰ type .source (data); indexer.add (request); } }; stream.addSink (new ElasticsearchSink.Builder&lt;Event&gt; (httpHosts, elasticsearchSinkFunction).build ( )); env.execute ( ); } } esæ”¯æŒ resté£æ ¼ï¼Œæ‰€ä»¥ç›´æ¥è®¿é—®æŸ¥çœ‹æ˜¯å¦æœ‰æ•°æ®äº† 5ã€è¾“å‡ºåˆ°MySQL(JDBC)create table clicks( user varchar(20) not null, url varchar(100) not null); package com.kk.model4; import com.kk.model2.pojo.Event; import org.apache.flink.connector.jdbc.JdbcConnectionOptions; import org.apache.flink.connector.jdbc.JdbcExecutionOptions; import org.apache.flink.connector.jdbc.JdbcSink; import org.apache.flink.streaming.api.datastream.DataStreamSource; import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; public class SinkToMySQL { public static void main(String[] args) throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment .getExecutionEnvironment ( ); DataStreamSource&lt;Event&gt; stream = env.fromElements ( new Event (\"Mary\", \"./home\", 1000L), new Event (\"Bob\", \"./cart\", 2000L), new Event (\"Alice\", \"./prod?id=100\", 3000L), new Event (\"Alice\", \"./prod?id=200\", 3500L), new Event (\"Bob\", \"./prod?id=2\", 2500L), new Event (\"Alice\", \"./prod?id=300\", 3600L), new Event (\"Bob\", \"./home\", 3000L), new Event (\"Bob\", \"./prod?id=1\", 2300L), new Event (\"Bob\", \"./prod?id=3\", 3300L)); stream.addSink ( JdbcSink.sink ( \"INSERT INTO clicks (user, url) VALUES (?, ?)\", (statement, r) -&gt; { statement.setString (1, r.user); statement.setString (2, r.url); }, JdbcExecutionOptions.builder ( ) .withBatchSize (1000) .withBatchIntervalMs (200) .withMaxRetries (5) .build ( ), new JdbcConnectionOptions.JdbcConnectionOptionsBuilder ( ) .withUrl (\"jdbc:mysql://localhost:3306/book\") // å¯¹äº MySQL 5.7ï¼Œç”¨\"com.mysql.jdbc.Driver\" .withDriverName (\"com.mysql.jdbc.Driver\") .withUsername (\"root\") .withPassword (\"a1b2c3\") .build ( ) ) ); env.execute ( ); } } 6ã€è‡ªå®šä¹‰Sinkè¾“å‡ºFlink ä¸ºæˆ‘ä»¬æä¾›äº†é€šç”¨çš„ SinkFunction æ¥å£å’Œå¯¹åº”çš„ RichSinkDunction æŠ½è±¡ç±»ï¼Œåªè¦å®ç°å®ƒï¼Œé€šè¿‡ç®€å•åœ°è°ƒç”¨ DataStream çš„.addSink()æ–¹æ³•å°±å¯ä»¥è‡ªå®šä¹‰å†™å…¥ä»»ä½•å¤–éƒ¨å­˜å‚¨ã€‚ ä¾‹å¦‚ï¼ŒFlink å¹¶æ²¡æœ‰æä¾› HBase çš„è¿æ¥å™¨ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªå·±å†™ åœ¨å®ç° SinkFunction çš„æ—¶å€™ï¼Œéœ€è¦é‡å†™çš„ä¸€ä¸ªå…³é”®æ–¹æ³• invoke(), åˆ›å»º HBase çš„è¿æ¥ä»¥åŠå…³é—­ HBase çš„è¿æ¥éœ€è¦åˆ†åˆ«æ”¾åœ¨ open()æ–¹æ³•å’Œ close()æ–¹æ³•ä¸­ã€‚ docker run -itd -h hbase.dev.xhyun.vip --name hbase2.1 -p 2181:2181 -p 8080:8080 -p 8085:8085 -p 9090:9090 -p 9095:9095 -p 16000:16000 -p 16010:16010 -p 16201:16201 -p 16301:16301 harisekhon/hbase:2.1 è®¿é—®åœ°å€ï¼šhttp://mykkto.cn:16010/master-status â…£ã€Flink æ—¶é—´å’Œçª—å£ä¸€ã€æ—¶é—´è¯­ä¹‰äºŒã€æ°´ä½çº¿ä¸‰ã€çª—å£å››ã€è¿Ÿåˆ°æ•°æ®çš„å¤„ç†äº”ã€æ€»ç»“â…¤ã€å¤„ç†å‡½æ•°â…¥ã€å¤šæµè½¬æ¢â…¦ã€çŠ¶æ€ç¼–ç¨‹â…§ã€å®¹é”™æœºåˆ¶â…¨ã€Table API and SQLâ…©ã€Flink CEPå‚è€ƒåœ°å€ â†“1ã€docker åŠ é€Ÿï¼ˆåšä¸»ç®€ä¹¦ï¼‰urlï¼šhttps://www.jianshu.com/p/f554c85b25c1 2ã€Hadoop å•æœºå®‰è£…urlï¼šhttps://blog.51cto.com/u_15187242/4760802 docker run -i -t --network host -p 50070:50070 -p 9000:9000 -p 8088:8088 -p 8040:8040 -p 8042:8042 -p 49707:49707 -p 50010:50010 -p 50075:50075 -p 50090:50090 sequenceiq/hadoop-docker:2.7.0 /etc/bootstrap.sh -bash 3ã€Hadoopé›†ç¾¤urlï¼šhttps://dhcp.cn/k8s/docker/deploy_hadoop.html#reference 4ã€Hadoopå¸¸ç”¨ç«¯å£urlï¼šhttps://blog.csdn.net/qq_36816848/article/details/113106441 5ã€nc -lk æ¨¡æ‹Ÿå®æ—¶æ•°æ®urlï¼šhttps://www.csdn.net/tags/MtzakgwsODA4NjktYmxvZwO0O0OO0O0O.html 6ã€Flinkï¼ˆdockerï¼‰å¿«é€Ÿæ­å»ºurlï¼šhttps://blog.csdn.net/weixin_42357472/article/details/118223101 7ã€Zookeeper(docker)å¿«é€Ÿæ­å»ºæ‹‰å–urlï¼šhttps://blog.csdn.net/u010416101/article/details/122803105 å¯åŠ¨urlï¼šhttps://www.cnblogs.com/shanfeng1000/p/14488665.html 8ã€kafka(docker)å¿«é€Ÿæ­å»ºæ­å»ºurlï¼šhttps://www.cnblogs.com/shanfeng1000/p/14638455.html ä½¿ç”¨urlï¼šhttps://blog.csdn.net/qq_22041375/article/details/106180415 9ã€ESï¼ˆdockerï¼‰å¿«é€Ÿæ­å»ºurlï¼šhttps://www.cnblogs.com/nesn/p/15898123.html 10ã€Hbase(docker)æ­å»ºå’Œæµ‹è¯•urlï¼šhttps://www.cnblogs.com/user-sunli/p/16362500.html","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"https://mykkto.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"https://mykkto.github.io/tags/Flink/"},{"name":"hadoop","slug":"hadoop","permalink":"https://mykkto.github.io/tags/hadoop/"},{"name":"kafka","slug":"kafka","permalink":"https://mykkto.github.io/tags/kafka/"}],"author":"mykk"},{"title":"é¡¹ç›®-é‡‘èèƒŒæ™¯åŠå…¶åç«¯æ­å»º","slug":"08-é¡¹ç›®/01å°šèå®/01_é‡‘èé¡¹ç›®è¯´æ˜å’Œæ­å»º","date":"2022-04-26T15:11:33.000Z","updated":"2023-06-11T02:53:45.137Z","comments":true,"path":"posts/a6407b24.html","link":"","permalink":"https://mykkto.github.io/posts/a6407b24.html","excerpt":"","text":"ã€‡ã€ä¸»ç›®å½•æ€»çº²â… ã€é¡¹ç›®æ¦‚å¿µä¸€ã€é¡¹ç›®ç®€ä»‹1ã€é¡¹ç›®è¯´æ˜å°šèå®æ˜¯ä¸€ä¸ªç½‘ç»œå€Ÿè´·ä¿¡æ¯ä¸­ä»‹æœåŠ¡å¹³å°ï¼Œä¸ºä¸ªäººæŠ•èµ„è€…ã€ä¸ªäººèèµ„ç”¨æˆ·å’Œå°å¾®ä¼ä¸šæä¾›ä¸“ä¸šçš„çº¿ä¸Šä¿¡è´·åŠå‡ºå€Ÿæ’®åˆæœåŠ¡ã€‚ è¡Œä¸šæ¡ˆä¾‹ï¼šäººäººè´· https://www.renrendai.com/ã€æ‹æ‹è´· https://www.paipaidai.com/ 2ã€é¡¹ç›®æ¶æ„å›¾ 3ã€ä¸šåŠ¡æµç¨‹å›¾ äºŒã€å¼€å‘ç¯å¢ƒå’ŒæŠ€æœ¯æ ˆ1ã€æŠ€æœ¯æ ˆ-åç«¯ SpringBoot 2.3.4.RELEASE SpringCloud Hoxton.SR8ï¼šå¾®æœåŠ¡åŸºç¡€è®¾æ–½ - æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡ç†”æ–­ã€å¾®æœåŠ¡ç½‘å…³ã€é…ç½®ä¸­å¿ƒç­‰ SpringCloud Alibaba 2.2.2.RELEASE MyBatis Plusï¼šæŒä¹…å±‚æ¡†æ¶å’Œä»£ç ç”Ÿæˆå™¨ Lombokï¼šç®€åŒ–å®ä½“ç±»å¼€å‘ Swagger2ï¼šApiæ¥å£æ–‡æ¡£ç”Ÿæˆå·¥å…· Logbackï¼šæ—¥å¿—ç³»ç»Ÿ alibaba-easyexcelï¼šExcelè¯»å†™ Spring Data Redisï¼šSpringé¡¹ç›®ä¸­è®¿é—®Redisç¼“å­˜ HTTPClient: åŸºäºHttpåè®®çš„å®¢æˆ·ç«¯ï¼Œç”¨æ¥å®ç°è¿œç¨‹è°ƒç”¨ Spring Taskï¼šå®šæ—¶ä»»åŠ¡ 2ã€æŠ€æœ¯æ ˆ-å‰ç«¯ Node.jsï¼š JavaScript è¿è¡Œç¯å¢ƒ ES6ï¼šJavaScriptçš„æ¨¡å—åŒ–ç‰ˆæœ¬ axiosï¼šä¸€ä¸ªå‘é€Ajaxè¯·æ±‚çš„å·¥å…· Vue.jsï¼šweb ç•Œé¢çš„æ¸è¿›å¼æ¡†æ¶ Element-UIï¼šå‰ç«¯ç»„ä»¶åº“ æ¨¡å—åŒ–å¼€å‘ï¼šè§£å†³javascriptå˜é‡å…¨å±€ç©ºé—´æ±¡æŸ“çš„é—®é¢˜ NPMï¼šæ¨¡å—èµ„æºç®¡ç†å™¨ vue-element-adminï¼šåŸºäºVue.jsçš„åå°ç®¡ç†ç³»ç»ŸUIé›†æˆæ–¹æ¡ˆ NuxtJSï¼šåŸºäºVue.jsæ„å»ºçš„æœåŠ¡å™¨ç«¯æ¸²æŸ“åº”ç”¨çš„è½»é‡çº§æ¡†æ¶ 3ã€ä¸­é—´ä»¶ MySQL 5.7ï¼šå…³ç³»å‹æ•°æ®åº“ Redis 5.0ï¼šç¼“å­˜æŠ€æœ¯ RabbitMQ 3.8ï¼šæ¶ˆæ¯ä¸­é—´ä»¶ 4ã€ç¬¬ä¸‰æ–¹æ¥å£ é˜¿é‡Œäº‘çŸ­ä¿¡ï¼šçŸ­ä¿¡ç½‘å…³ é˜¿é‡Œäº‘OSSï¼šåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ èµ„é‡‘æ‰˜ç®¡å¹³å°APIå¯¹æ¥ï¼šæ±‡ä»˜å® 5ã€å¼€å‘ç¯å¢ƒ jdk 1.8 maven 3.6 ideaIU-2020.2.3ï¼š æ’ä»¶ï¼šlombokã€MyBatisX ä¸‰ã€é‡‘èçŸ¥è¯†æ™®åŠ1ã€ä¿¡ç”¨è´·æ¬¾å¹³å°çš„ç±»åˆ«1ã€é“¶è¡Œç³» ä¼˜åŠ¿ï¼š ç¬¬ä¸€ï¼Œèµ„é‡‘é›„åšï¼ŒæµåŠ¨æ€§å……è¶³ï¼› ç¬¬äºŒï¼Œé¡¹ç›®æºè´¨åœ°ä¼˜è‰¯ï¼Œå¤§å¤šæ¥è‡ªäºé“¶è¡ŒåŸæœ‰ä¸­å°å‹å®¢æˆ·ï¼› ç¬¬ä¸‰ï¼Œé£é™©æ§åˆ¶èƒ½åŠ›å¼ºã€‚å¦‚æ’ä¸°é“¶è¡Œã€æ‹›å•†é“¶è¡Œç­‰æ——ä¸‹éƒ½æœ‰ä¿¡ç”¨è´·æ¬¾å¹³å°ã€‚ åŠ£åŠ¿ï¼šæ”¶ç›Šç‡åä½ï¼Œé¢„æœŸå¹´åŒ–æ”¶ç›Šç‡å¤„äº5.5%-8.6%ä¹‹é—´ï¼Œç•¥é«˜äºé“¶è¡Œå…¶ä»–ç†è´¢äº§å“ï¼Œå¯¹æŠ•èµ„äººå¸å¼•åŠ›æœ‰é™ã€‚ 2ã€å›½èµ„ç³» ä¼˜åŠ¿ï¼š æ‹¥æœ‰å›½æœ‰èƒŒæ™¯è‚¡ä¸œçš„éšæ€§èƒŒä¹¦ï¼Œå…‘ä»˜èƒ½åŠ›æœ‰ä¿éšœï¼Œä¸šåŠ¡æ¨¡å¼è¾ƒä¸ºè§„èŒƒï¼Œä»ä¸šäººå‘˜é‡‘èä¸“ä¸šç´ å…»è¾ƒé«˜ã€‚ åŠ£åŠ¿ï¼š ç¼ºä¹äº’è”ç½‘åŸºå› ï¼›é¡¹ç›®æ ‡çš„è¾ƒå¤§ï¼Œèµ·æŠ•é—¨æ§›è¾ƒé«˜ï¼›ä¸”äº§å“ç§ç±»æœ‰é™ï¼Œå¤šä¸ºä¼ä¸šä¿¡ç”¨è´·ï¼› è¾ƒä¸ºè°¨æ…ï¼Œå±‚å±‚å®¡æ ¸çš„æœºåˆ¶ä¸¥é‡å½±å“äº†å¹³å°è¿è¥æ•ˆç‡ï¼›æ”¶ç›Šç‡ä¸å…·æœ‰å¸å¼•åŠ›ã€‚ 3ã€æ°‘è¥ç³»æ°‘è¥ç³»å¹³å°æ•°é‡æœ€å¤šï¼Œèµ·æ­¥æœ€æ—©ï¼Œä½†é±¼é¾™æ··æ‚ï¼Œä¸èƒœæšä¸¾ã€‚ ä¼˜åŠ¿ï¼š æ™®æƒ é‡‘èï¼Œæ‰‹ç»­ä¾¿æ·ï¼›é—¨æ§›æä½ï¼ŒæŠ•èµ„èµ·ç‚¹ä½æœ€ä½èµ·æŠ•é—¨æ§›ç”šè‡³50å…ƒï¼› å¼ºå¤§çš„äº’è”ç½‘æ€ç»´ï¼Œäº§å“åˆ›æ–°èƒ½åŠ›é«˜ï¼Œå¸‚åœºåŒ–ç¨‹åº¦é«˜ï¼›æ”¶ç›Šç‡é«˜ï¼ŒæŠ•èµ„æ”¶ç›Šç‡å…·æœ‰å¸å¼•åŠ›ã€‚ åŠ£åŠ¿ï¼š é£é™©åé«˜ï¼Œèµ„æœ¬å®åŠ›åŠé£æ§èƒ½åŠ›åå¼±ï¼Œè·‘è·¯åŠå€’é—­çš„é«˜å‘åŒºã€‚ 2ã€ä¸šåŠ¡æµç¨‹ 1ã€æŠ•èµ„äººå¸Œæœ›åœ¨å¹³å°ä¸Šæ‰¾åˆ°åˆé€‚çš„æŠ•èµ„é¡¹ç›®ï¼Œè·å–åˆ©æ¶¦å›æŠ¥çš„ç”¨æˆ· 2ã€å€Ÿæ¬¾äººéœ€è¦èµ„é‡‘å‘¨è½¬çš„ç”¨æˆ· 3ã€èµ„é‡‘æ± é£é™© èµ„é‡‘æ± ï¼šä¸€ä¸ªå¤§æ± å­æ”¾é’±ï¼Œä¸€è¾¹å­˜è¿›æ¥ï¼ˆå…¥æ°´ç®¡ï¼‰ï¼Œä¸€è¾¹è´·å‡ºå»ï¼ˆå‡ºæ°´ç®¡ï¼‰ã€‚ä¸ç®¡æ˜¯å¼ ä¸‰çš„é’±ã€æå››çš„é’±ã€è¿˜æ˜¯ç‹äº”çš„é’±ï¼Œåªè¦è¿›åˆ°æ± å­é‡Œï¼Œå°±éƒ½å«æ± å­çš„é’±äº†ã€‚é“¶è¡Œå°±æ˜¯å…¸å‹çš„èµ„é‡‘æ± ã€‚ èµ„é‡‘æ± é£é™©ï¼š ç¬¬ä¸€ç§æƒ…å†µï¼šæŠ•èµ„å…¥æ°´ç®¡æµé‡è¿‡å¤§ï¼Œæ± å­é‡Œå…¨æ˜¯æ°´ã€‚è¿™ç§æƒ…å†µï¼Œå¹³å°äºé’±ï¼Œå¹²ä¸é•¿ã€‚åŸå› å¾ˆç®€å•ï¼Œæ± å­é‡Œçš„é’±æ˜¯æœ‰æˆæœ¬çš„ï¼Œåªè¿›ä¸å‡ºï¼Œæ²¡æœ‰åˆ©å·®ï¼Œæ‹¿ä»€ä¹ˆé’±ä»˜æŠ•èµ„äººçš„åˆ©æ¯ï¼Œæ—¶é—´é•¿äº†ï¼Œå°±åªèƒ½ç”¨æŠ•èµ„äººçš„æœ¬é‡‘è¿˜æŠ•èµ„äººçš„åˆ©æ¯ï¼Œå€Ÿæ–°è¿˜æ—§ï¼Œåºæ°éª—å±€ã€‚è¿™ä¸ªè¿‡ç¨‹å°±ç›´æ¥èƒŒç¦»äº†å¹³å°ä¿¡æ¯ä¸­ä»‹çš„èº«ä»½ï¼Œè€Œæˆäº†ä¸é“¶è¡Œç±»ä¼¼çš„é‡‘èæœºæ„ã€‚ ç¬¬äºŒç§æƒ…å†µï¼šçªç„¶æ¥äº†è¿™ä¹ˆå¤šé’±ï¼Œæ€ä¹ˆåŠï¼Ÿåªèƒ½æŠŠæ”¾è´·å‡ºæ°´ç®¡çš„æµé‡è°ƒå¤§ã€‚æ”¾è´·çš„è¿™æ¡å‡ºæ°´ç®¡ä¸Šæœ‰ä¸¤ä¸ªé˜€é—¨ï¼Œä¸€ä¸ªå«æ‰¾é¡¹ç›®ï¼Œä¸€ä¸ªå«åšé£æ§ã€‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œç»å¸¸å°±æ˜¯ä¸¤ä¸ªé˜€é—¨ä¸€å—å„¿æ”¾ï¼Œé’±æ˜¯è´·å‡ºå»äº†ï¼Œä½†ç”±äºæ”¾æ¾äº†å¯¹é£é™©çš„æŠŠæ§ï¼Œèƒ½ä¸èƒ½å†æµå›æ¥ï¼Œå°±ä¸å¥½è¯´äº†ï¼Œå±é™©ã€‚ ç¬¬ä¸‰ç§æƒ…å†µï¼šææ¬¾çš„å‡ºæ°´ç®¡æµé‡å˜å¤§ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªé»‘å¤©é¹…äº‹ä»¶ï¼Œä¸€ä¸ªè´Ÿé¢æ–°é—»ï¼Œä¸€ä¸ªå¹³å°å®äº†ï¼Œéƒ½å¯èƒ½è¯±å‘è¿™ç§æƒ…å†µï¼Œè¿™å°±æ˜¯æŒ¤å…‘ã€‚æ¯”å¦‚è¯´æŸç§Ÿå®äº‹ä»¶åï¼Œä¸åªè¿™ä¸€å®¶å¹³å°ï¼Œå¾ˆå¤šå…¶ä»–å¹³å°çš„ç”¨æˆ·ï¼Œä¹Ÿåœ¨ç–¯ç‹‚çš„æç°ï¼Œæœ‰å¯èƒ½ä¸€ç›´æåˆ°å…³é—¨ä¸ºæ­¢ã€‚ ç¬¬å››ç§æƒ…å†µæœ€æç«¯ï¼šå¹³å°æŠŠæ± å­é‡Œçš„é’±éƒ½æå‡ºæ¥ï¼Œèµ°äººã€‚è¿™ä¸ªå°±ä¸ç”¨è§£é‡Šäº†ï¼Œå°±æ˜¯ è·‘è·¯ã€‚ ä»¥ä¸Šå››ç§æƒ…å†µå°±æ˜¯èµ„é‡‘æ± æœ€ä¸»è¦çš„å‡ ä¸ªé£é™©â€”â€”ç»è¥ä¸å–„ï¼Œé£é™©å¤±æ§ï¼ŒæŒ¤å…‘å’Œè·‘è·¯ã€‚é“¶ç›‘ä¼šå‘å¸ƒçš„ã€Šç½‘ç»œå€Ÿè´·ä¿¡æ¯ä¸­ä»‹æœºæ„ä¸šåŠ¡æ´»åŠ¨ç®¡ç†æš‚è¡ŒåŠæ³•ã€‹è®©èµ„é‡‘å­˜ç®¡æˆä¸ºç½‘è´·å¹³å°çš„ç¡¬æ€§è¦æ±‚ï¼ŒåŒæ—¶é™ä½äº†å¹³å°å»ºç«‹èµ„é‡‘æ± ã€æŒªç”¨ç”¨æˆ·èµ„é‡‘çš„é£é™©ã€‚ 4ã€èµ„é‡‘æ‰˜ç®¡å¹³å° ç¬¬ä¸‰æ–¹å­˜ç®¡æ¨¡å¼ï¼šâ€œç¬¬ä¸‰æ–¹å­˜ç®¡â€çš„å…¨ç§°æ˜¯â€œå®¢æˆ·äº¤æ˜“ç»“ç®—èµ„é‡‘ç¬¬ä¸‰æ–¹å­˜ç®¡â€ã€‚è¿™é‡Œçš„ç¬¬ä¸‰æ–¹å­˜ç®¡æœºæ„ï¼Œç›®å‰æ˜¯æŒ‡å…·å¤‡ç¬¬ä¸‰æ–¹å­˜ç®¡èµ„æ ¼çš„å•†ä¸šé“¶è¡Œã€‚é“¶è¡Œçš„æµå…¥èµ„é‡‘æˆæœ¬ä½ï¼Œé£æ§ä½“ç³»è¾ƒå®Œå–„ï¼Œèµ„é‡‘æ± å­è¶³å¤Ÿå¤§ï¼Œè€Œä¸”æ˜¯å›½å®¶èƒŒä¹¦ï¼Œä¸ä¼šè·‘è·¯ã€‚ è¯´æ˜ï¼šç”±äºæˆ‘ä»¬æ˜¯æ•™å­¦ä½¿ç”¨ï¼Œæ— æ³•ç”³è¯·åˆ°æ­£å¼çš„èµ„é‡‘æ‰˜ç®¡å¹³å°çš„æ”¯æŒï¼Œæ‰€ä»¥æˆ‘ä»¬æ ¹æ®èµ„é‡‘æ‰˜ç®¡å¹³å°APIæ¥å£æ–‡æ¡£ï¼Œè‡ªè¡Œå¼€å‘æ¨¡æ‹Ÿä¸€å¥—APIæ¥å£æ¥æ»¡è¶³ä¸šåŠ¡éœ€è¦ï¼Œä¸šåŠ¡è¿‡ç¨‹ä¸å®é™…å¼€å‘åŸºæœ¬ä¸€è‡´ã€‚ â…¡ã€åç«¯æ¶æ„æ­å»ºä¸€ã€æ¥å£å·¥ç¨‹åˆ›å»º1ã€åˆ›å»ºçˆ¶å·¥ç¨‹ BackEndCode1ã€åˆ›å»º maven é¡¹ç›®Groupï¼šcom.kk Artifactï¼šBackEndCode 2ã€åˆ é™¤srcç›®å½•3ã€é…ç½®SpringBootç‰ˆæœ¬&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.3.4.RELEASE&lt;/version&gt; &lt;/parent&gt; 4ã€é…ç½®pomä¾èµ–ç‰ˆæœ¬å·&lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring-cloud-alibaba.version&gt;2.2.2.RELEASE&lt;/spring-cloud-alibaba.version&gt; &lt;spring-cloud.version&gt;Hoxton.SR8&lt;/spring-cloud.version&gt; &lt;mybatis-plus.version&gt;3.4.1&lt;/mybatis-plus.version&gt; &lt;velocity.version&gt;2.0&lt;/velocity.version&gt; &lt;swagger.version&gt;2.9.2&lt;/swagger.version&gt; &lt;swagger-bootstrap-ui.version&gt;1.9.2&lt;/swagger-bootstrap-ui.version&gt; &lt;commons-lang3.version&gt;3.9&lt;/commons-lang3.version&gt; &lt;commons-fileupload.version&gt;1.3.1&lt;/commons-fileupload.version&gt; &lt;commons-io.version&gt;2.6&lt;/commons-io.version&gt; &lt;alibaba.easyexcel.version&gt;2.1.1&lt;/alibaba.easyexcel.version&gt; &lt;apache.xmlbeans.version&gt;3.1.0&lt;/apache.xmlbeans.version&gt; &lt;fastjson.version&gt;1.2.28&lt;/fastjson.version&gt; &lt;gson.version&gt;2.8.2&lt;/gson.version&gt; &lt;json.version&gt;20170516&lt;/json.version&gt; &lt;aliyun-java-sdk-core.version&gt;4.3.3&lt;/aliyun-java-sdk-core.version&gt; &lt;aliyun-sdk-oss.version&gt;3.10.2&lt;/aliyun-sdk-oss.version&gt; &lt;jodatime.version&gt;2.10.1&lt;/jodatime.version&gt; &lt;jwt.version&gt;0.7.0&lt;/jwt.version&gt; &lt;httpclient.version&gt;4.5.1&lt;/httpclient.version&gt; &lt;/properties&gt; 5ã€é…ç½®pomä¾èµ–&lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!--Spring Cloud--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--Spring Cloud Alibaba--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud-alibaba.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--mybatis-plus--&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;${mybatis-plus.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--mybatis-plus ä»£ç ç”Ÿæˆå™¨--&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt; &lt;version&gt;${mybatis-plus.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- Mybatis Plus ä»£ç ç”Ÿæˆå™¨æ¨¡æ¿å¼•æ“, --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.velocity&lt;/groupId&gt; &lt;artifactId&gt;velocity-engine-core&lt;/artifactId&gt; &lt;version&gt;${velocity.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--swagger--&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;${swagger.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--swagger ui--&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;${swagger.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--swagger-bootstrap-ui--&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt; &lt;artifactId&gt;swagger-bootstrap-ui&lt;/artifactId&gt; &lt;version&gt;${swagger-bootstrap-ui.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--commons-lang3--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt; &lt;version&gt;${commons-lang3.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--æ–‡ä»¶ä¸Šä¼ --&gt; &lt;dependency&gt; &lt;groupId&gt;commons-fileupload&lt;/groupId&gt; &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt; &lt;version&gt;${commons-fileupload.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--commons-io--&gt; &lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;${commons-io.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--excelè§£æ--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;easyexcel&lt;/artifactId&gt; &lt;version&gt;${alibaba.easyexcel.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--excelè§£æä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.xmlbeans&lt;/groupId&gt; &lt;artifactId&gt;xmlbeans&lt;/artifactId&gt; &lt;version&gt;${apache.xmlbeans.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--json--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;${fastjson.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.json&lt;/groupId&gt; &lt;artifactId&gt;json&lt;/artifactId&gt; &lt;version&gt;${json.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt; &lt;artifactId&gt;gson&lt;/artifactId&gt; &lt;version&gt;${gson.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--é˜¿é‡Œäº‘SDKè¿œç¨‹è°ƒç”¨--&gt; &lt;dependency&gt; &lt;groupId&gt;com.aliyun&lt;/groupId&gt; &lt;artifactId&gt;aliyun-java-sdk-core&lt;/artifactId&gt; &lt;version&gt;${aliyun-java-sdk-core.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--é˜¿é‡Œäº‘æ–‡ä»¶ç®¡ç†--&gt; &lt;dependency&gt; &lt;groupId&gt;com.aliyun.oss&lt;/groupId&gt; &lt;artifactId&gt;aliyun-sdk-oss&lt;/artifactId&gt; &lt;version&gt;${aliyun-sdk-oss.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--æ—¥æœŸæ—¶é—´å·¥å…·--&gt; &lt;dependency&gt; &lt;groupId&gt;joda-time&lt;/groupId&gt; &lt;artifactId&gt;joda-time&lt;/artifactId&gt; &lt;version&gt;${jodatime.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--jwtå·¥å…·--&gt; &lt;dependency&gt; &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt; &lt;artifactId&gt;jjwt&lt;/artifactId&gt; &lt;version&gt;${jwt.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--httpclient--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; &lt;artifactId&gt;httpclient&lt;/artifactId&gt; &lt;version&gt;${httpclient.version}&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 2ã€åˆ›å»ºæ¨¡å—kk-common1ã€åˆ›å»ºMavenæ¨¡å—åœ¨ çˆ¶å·¥ç¨‹ ä¸‹åˆ›å»ºæ™®é€šmavenæ¨¡å— Groupï¼šcom.kk Artifactï¼škk-common 2ã€é…ç½®pom&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--lombokç”¨æ¥ç®€åŒ–å®ä½“ç±»ï¼šéœ€è¦å®‰è£…lombokæ’ä»¶--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 3ã€åˆ›å»ºæ¨¡å—service-base1ã€åˆ›å»ºMavenæ¨¡å—åœ¨ çˆ¶å·¥ç¨‹ ä¸‹åˆ›å»ºæ™®é€šmavenæ¨¡å— Groupï¼šcom.kk Artifactï¼šservice-base 2ã€é…ç½®pomæ³¨æ„ï¼šä¾èµ–kk-common &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;service-base&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;!--swagger--&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--swagger ui--&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 4ã€åˆ›å»ºæ¨¡å—service-core1ã€åˆ›å»ºMavenæ¨¡å—åœ¨ çˆ¶å·¥ç¨‹ ä¸‹åˆ›å»ºæ™®é€šmavenæ¨¡å— Groupï¼šcom.kk Artifactï¼šservice-core 2ã€é…ç½®pomæ³¨æ„ï¼šä¾èµ–kk-common &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;service-base&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;!--mysql--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mybatis-plus--&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mybatis-plus ä»£ç ç”Ÿæˆå™¨--&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Mybatis Plus ä»£ç ç”Ÿæˆå™¨æ¨¡æ¿å¼•æ“, --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.velocity&lt;/groupId&gt; &lt;artifactId&gt;velocity-engine-core&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 5ã€ä»£ç ç”Ÿæˆå™¨1ã€åˆ›å»ºæ•°æ®åº“åˆ›å»ºæ•°æ®åº“srb_core å¹¶æ‰§è¡Œsqlè„šæœ¬åˆå§‹åŒ–æ•°æ®ç»“æ„å’Œæ•°æ® 2ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨åœ¨testç›®å½•ä¸­åˆ›å»ºæµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶æ‰§è¡Œ package com.kk.srb.core; import com.baomidou.mybatisplus.annotation.DbType; import com.baomidou.mybatisplus.annotation.IdType; import com.baomidou.mybatisplus.generator.AutoGenerator; import com.baomidou.mybatisplus.generator.config.DataSourceConfig; import com.baomidou.mybatisplus.generator.config.GlobalConfig; import com.baomidou.mybatisplus.generator.config.PackageConfig; import com.baomidou.mybatisplus.generator.config.StrategyConfig; import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy; import org.junit.Test; public class CodeGenerator { @Test public void genCode() { // 1ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨ AutoGenerator mpg = new AutoGenerator ( ); // 2ã€å…¨å±€é…ç½® GlobalConfig gc = new GlobalConfig ( ); String projectPath = System.getProperty (\"user.dir\"); gc.setOutputDir (projectPath + \"/src/main/java\"); gc.setAuthor (\"mykk\"); gc.setOpen (false); //ç”Ÿæˆåæ˜¯å¦æ‰“å¼€èµ„æºç®¡ç†å™¨ gc.setServiceName (\"%sService\"); //å»æ‰Serviceæ¥å£çš„é¦–å­—æ¯I gc.setIdType (IdType.AUTO); //ä¸»é”®ç­–ç•¥ gc.setSwagger2 (true);//å¼€å¯Swagger2æ¨¡å¼ mpg.setGlobalConfig (gc); // 3ã€æ•°æ®æºé…ç½® DataSourceConfig dsc = new DataSourceConfig ( ); dsc.setUrl (\"jdbc:mysql://121.4.120.62:3306/srb_core?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8\"); dsc.setDriverName (\"com.mysql.cj.jdbc.Driver\"); dsc.setUsername (\"root\"); dsc.setPassword (\"root\"); dsc.setDbType (DbType.MYSQL); mpg.setDataSource (dsc); // 4ã€åŒ…é…ç½® PackageConfig pc = new PackageConfig ( ); pc.setParent (\"com.kk.srb.core\"); pc.setEntity (\"pojo.entity\"); //æ­¤å¯¹è±¡ä¸æ•°æ®åº“è¡¨ç»“æ„ä¸€ä¸€å¯¹åº”ï¼Œé€šè¿‡ DAO å±‚å‘ä¸Šä¼ è¾“æ•°æ®æºå¯¹è±¡ã€‚ mpg.setPackageInfo (pc); // 5ã€ç­–ç•¥é…ç½® StrategyConfig strategy = new StrategyConfig ( ); strategy.setNaming (NamingStrategy.underline_to_camel);//æ•°æ®åº“è¡¨æ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥ strategy.setColumnNaming (NamingStrategy.underline_to_camel);//æ•°æ®åº“è¡¨å­—æ®µæ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥ strategy.setEntityLombokModel (true); // lombok strategy.setLogicDeleteFieldName (\"is_deleted\");//é€»è¾‘åˆ é™¤å­—æ®µå strategy.setEntityBooleanColumnRemoveIsPrefix (true);//å»æ‰å¸ƒå°”å€¼çš„is_å‰ç¼€ï¼ˆç¡®ä¿tinyint(1)ï¼‰ strategy.setRestControllerStyle (true); //restful apié£æ ¼æ§åˆ¶å™¨ mpg.setStrategy (strategy); // 6ã€æ‰§è¡Œ mpg.execute ( ); } } 6ã€å¯åŠ¨åº”ç”¨ç¨‹åº1ã€åˆ›å»ºapplication.ymlserver: port: 8110 # æœåŠ¡ç«¯å£ spring: profiles: active: dev # ç¯å¢ƒè®¾ç½® application: name: service-core # æœåŠ¡å datasource: # mysqlæ•°æ®åº“è¿æ¥ type: com.zaxxer.hikari.HikariDataSource driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://121.4.120.62:3306/srb_core?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8 username: root password: root mybatis-plus: #mybatis configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl mapper-locations: classpath:com/kk/srb/core/mapper/xml/*.xml 2ã€åˆ›å»ºSpringBooté…ç½®æ–‡ä»¶åœ¨service-coreä¸­åˆ›å»ºconfigåŒ…ï¼Œåˆ›å»ºMybatisPlusConfigç±» package com.kk.srb.core.config; import com.baomidou.mybatisplus.annotation.DbType; import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor; import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor; import org.mybatis.spring.annotation.MapperScan; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.transaction.annotation.EnableTransactionManagement; @Configuration @MapperScan(\"com.kk.srb.core.mapper\") @EnableTransactionManagement //äº‹åŠ¡å¤„ç† public class MybatisPlusConfig { @Bean public MybatisPlusInterceptor mybatisPlusInterceptor() { MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor ( ); interceptor.addInnerInterceptor (new PaginationInnerInterceptor (DbType.MYSQL));//åˆ†é¡µ return interceptor; } } 3ã€åˆ›å»ºSpringBootå¯åŠ¨ç±»æ³¨æ„ï¼šæ‰«æcom.kk.srb package com.kk.srb.core; import org.mybatis.spring.annotation.MapperScan; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication @MapperScan({\"com.kk.srb\"}) public class ServiceCoreApplication { public static void main(String[] args) { SpringApplication.run (ServiceCoreApplication.class, args); } } 4ã€è¿è¡Œå¯åŠ¨ç±»æŸ¥çœ‹æ§åˆ¶å°8110ç«¯å£æ˜¯å¦æˆåŠŸå¯åŠ¨ 7ã€æ•´ä½“ä»£ç ç»“æ„å›¾ äºŒã€ç§¯åˆ†ç­‰çº§CRUD1ã€ç§¯åˆ†ç­‰çº§åˆ—è¡¨æ¥å£1ã€ç¼–å†™ç§¯åˆ†ç­‰çº§ç®¡ç†æ¥å£åœ¨controllerä¸­æ·»åŠ adminåŒ…ï¼Œæ·»åŠ AdminIntegralGradeControllerç±» package com.kk.srb.core.controller.admin; import com.kk.srb.core.pojo.entity.IntegralGrade; import com.kk.srb.core.service.IntegralGradeService; import org.springframework.web.bind.annotation.CrossOrigin; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; import java.util.List; @CrossOrigin//å…è®¸å¯è®¿é—®çš„åŸŸåˆ—è¡¨ @RestController @RequestMapping(\"/admin/core/integralGrade\") public class AdminIntegralGradeController { @Resource private IntegralGradeService integralGradeService; @GetMapping(\"/list\") public List&lt;IntegralGrade&gt; listAll() { return integralGradeService.list ( ); } } 2ã€æµ‹è¯•é‡å¯æœåŠ¡ï¼Œè®¿é—®ï¼š http://localhost:8110/admin/core/integralGrade/list æŸ¥çœ‹ç»“æœjsonæ•°æ® 2ã€é€»è¾‘åˆ é™¤æ¥å£1ã€æ·»åŠ åˆ é™¤æ–¹æ³•AdminIntegralGradeControlleræ·»åŠ removeByIdæ–¹æ³• @DeleteMapping(\"/remove/{id}\") public boolean removeById(@PathVariable Long id){ return integralGradeService.removeById(id); } 2ã€ä½¿ç”¨postmanæµ‹è¯•åˆ é™¤ 3ã€é…ç½®Swagger21ã€Swagger2é…ç½®æ–‡ä»¶åœ¨service-baseä¸­åˆ›å»ºSwagger2Config package com.kk.srb.core.config; import com.google.common.base.Predicates; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import springfox.documentation.builders.ApiInfoBuilder; import springfox.documentation.builders.PathSelectors; import springfox.documentation.service.ApiInfo; import springfox.documentation.service.Contact; import springfox.documentation.spi.DocumentationType; import springfox.documentation.spring.web.plugins.Docket; import springfox.documentation.swagger2.annotations.EnableSwagger2; @Configuration @EnableSwagger2 public class Swagger2Config { @Bean public Docket adminApiConfig() { return new Docket (DocumentationType.SWAGGER_2) .groupName (\"adminApi\") .apiInfo (adminApiInfo ( )) .select ( ) //åªæ˜¾ç¤ºadminè·¯å¾„ä¸‹çš„é¡µé¢ .paths (Predicates.and (PathSelectors.regex (\"/admin/.*\"))) .build ( ); } private ApiInfo adminApiInfo() { return new ApiInfoBuilder ( ) .title (\"å°šèå®åå°ç®¡ç†ç³»ç»Ÿ-APIæ–‡æ¡£\") .description (\"æœ¬æ–‡æ¡£æè¿°äº†å°šèå®åå°ç®¡ç†ç³»ç»Ÿæ¥å£\") .version (\"1.0\") .contact (new Contact (\"Helen\", \"http://mykkto.cn\", \"763856958@qq.com\")) .build ( ); } } 2ã€æŸ¥çœ‹Swaggeræ–‡æ¡£é‡å¯æœåŠ¡å™¨æŸ¥çœ‹æ¥å£æ–‡æ¡£ï¼šhttp://localhost:8110/swagger-ui.html 3ã€å¸¸è§æ³¨è§£å®ä½“ç±»æ³¨è§£ï¼šentityçš„å®ä½“ç±»ä¸­å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå®šä¹‰è®¾ç½®ï¼Œä¾‹å¦‚ï¼š @ApiModelProperty(value = \"åˆ›å»ºæ—¶é—´\", example = \"2019-01-01 8:00:00\") private LocalDateTime createTime; @ApiModelProperty(value = \"æ›´æ–°æ—¶é—´\", example = \"2019-01-01 8:00:00\") private LocalDateTime updateTime; controlleræ³¨è§£ï¼š å®šä¹‰åœ¨ç±»ä¸Š @Api(tags = \"ç§¯åˆ†ç­‰çº§ç®¡ç†\") å®šä¹‰åœ¨æ–¹æ³•ä¸Š @ApiOperation(\"ç§¯åˆ†ç­‰çº§åˆ—è¡¨\") @ApiOperation(value = \"æ ¹æ®idåˆ é™¤ç§¯åˆ†ç­‰çº§\", notes = \"é€»è¾‘åˆ é™¤\") å®šä¹‰åœ¨å‚æ•°ä¸Š @ApiParam(value = \"æ•°æ®id\", required = true, example = \"100\") ä¸‰ã€ç»Ÿä¸€è¿”å›ç»“æœ1ã€æ•°æ®æ ¼å¼çš„å®šä¹‰é¡¹ç›®ä¸­æˆ‘ä»¬ä¼šå°†å“åº”å°è£…æˆjsonè¿”å›ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå°†æ‰€æœ‰æ¥å£çš„æ•°æ®æ ¼å¼ç»Ÿä¸€ï¼Œ ä½¿å‰ç«¯å¯¹æ•°æ®çš„æ“ä½œæ›´ä¸€è‡´ã€è½»æ¾ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼æ²¡æœ‰å›ºå®šçš„æ ¼å¼ï¼Œåªè¦èƒ½æè¿°æ¸…æ¥šè¿”å›çš„æ•°æ®çŠ¶æ€ä»¥åŠè¦è¿”å›çš„å…·ä½“æ•°æ®å°±å¯ä»¥ã€‚ä½†æ˜¯ä¸€èˆ¬ä¼šåŒ…å«çŠ¶æ€ç ã€è¿”å›æ¶ˆæ¯ã€æ•°æ®è¿™å‡ éƒ¨åˆ†å†…å®¹ ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿè¦æ±‚è¿”å›çš„åŸºæœ¬æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š æˆåŠŸï¼š { \"code\": 0, \"message\": \"æˆåŠŸ\", \"data\": æ•°æ® } å¤±è´¥ï¼š { \"code\": -1, \"message\": \"å¤±è´¥\", \"data\": null } å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰ç»Ÿä¸€ç»“æœ { \"code\": æ•°å­—, //ä¸šåŠ¡å“åº”ç  \"message\": å­—ç¬¦ä¸², //è¿”å›æ¶ˆæ¯ \"data\": å¯¹è±¡ //è¿”å›æ•°æ® } 2ã€åˆ›å»ºæšä¸¾åœ¨kk-commonä¸­åˆ›å»ºresultåŒ…ï¼Œåˆ›å»ºæšä¸¾ ResponseEnum package com.kk.common.result; import lombok.AllArgsConstructor; import lombok.Getter; import lombok.ToString; @Getter @AllArgsConstructor @ToString public enum ResponseEnum { SUCCESS (0, \"æˆåŠŸ\"), ERROR (-1, \"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\"); // å“åº”çŠ¶æ€ç  private Integer code; // å“åº”ä¿¡æ¯ private String message; } 3ã€å®šä¹‰åŒç»Ÿä¸€ç»“æœç±»package com.kk.common.result; import lombok.Data; import java.util.HashMap; import java.util.Map; @Data public class R { private Integer code; private String message; private Map&lt;String, Object&gt; data = new HashMap ( ); /** * æ„é€ å™¨ç§æœ‰ */ private R() { } /** * è¿”å›æˆåŠŸ */ public static R ok() { R r = new R ( ); r.setCode (ResponseEnum.SUCCESS.getCode ( )); r.setMessage (ResponseEnum.SUCCESS.getMessage ( )); return r; } /** * è¿”å›å¤±è´¥ */ public static R error() { R r = new R ( ); r.setCode (ResponseEnum.ERROR.getCode ( )); r.setMessage (ResponseEnum.ERROR.getMessage ( )); return r; } /** * è®¾ç½®ç‰¹å®šç»“æœ */ public static R setResult(ResponseEnum responseEnum) { R r = new R ( ); r.setCode (responseEnum.getCode ( )); r.setMessage (responseEnum.getMessage ( )); return r; } public R message(String message) { this.setMessage (message); return this; } public R code(Integer code) { this.setCode (code); return this; } public R data(String key, Object value) { this.data.put (key, value); return this; } public R data(Map&lt;String, Object&gt; map) { this.setData (map); return this; } } 4ã€ä½¿ç”¨ç»Ÿä¸€è¿”å›ç»“æœ1ã€ä¿®æ”¹listAll@GetMapping(\"/list\") @ApiOperation(\"ç§¯åˆ†ç­‰çº§åˆ—è¡¨\") public List&lt;IntegralGrade&gt; listAll() { return integralGradeService.list ( ); } 2ã€ä¿®æ”¹removeById@ApiOperation(value = \"æ ¹æ®idåˆ é™¤ç§¯åˆ†ç­‰çº§\", notes = \"é€»è¾‘åˆ é™¤\") @DeleteMapping(\"/remove/{id}\") public R removeById( @ApiParam(value = \"æ•°æ®id\", required = true, example = \"1\") @PathVariable Long id) { boolean result = integralGradeService.removeById (id); if (result) { //return R.setResult(ResponseEnum.UPLOAD_ERROR); return R.ok ( ).message (\"åˆ é™¤æˆåŠŸ\"); } else { return R.error ( ).message (\"åˆ é™¤å¤±è´¥\"); } } 3ã€æ–°å¢æ•°æ®@ApiOperation(\"æ–°å¢ç§¯åˆ†ç­‰çº§\") @PostMapping(\"/save\") public R save( @ApiParam(value = \"ç§¯åˆ†ç­‰çº§å¯¹è±¡\", required = true) @RequestBody IntegralGrade integralGrade) { boolean result = integralGradeService.save (integralGrade); if (result) { return R.ok ( ).message (\"ä¿å­˜æˆåŠŸ\"); } else { return R.error ( ).message (\"ä¿å­˜å¤±è´¥\"); } } 4ã€æ ¹æ®idæŸ¥è¯¢@ApiOperation(\"æ ¹æ®idè·å–ç§¯åˆ†ç­‰çº§\") @GetMapping(\"/get/{id}\") public R getById( @ApiParam(value = \"æ•°æ®id\", required = true, example = \"1\") @PathVariable Long id ) { IntegralGrade integralGrade = integralGradeService.getById (id); if (integralGrade != null) { return R.ok ( ).data (\"record\", integralGrade); } else { return R.error ( ).message (\"æ•°æ®ä¸å­˜åœ¨\"); } } 5ã€æ ¹æ®idä¿®æ”¹@ApiOperation(\"æ›´æ–°ç§¯åˆ†ç­‰çº§\") @PutMapping(\"/update\") public R updateById( @ApiParam(value = \"ç§¯åˆ†ç­‰çº§å¯¹è±¡\", required = true) @RequestBody IntegralGrade integralGrade) { boolean result = integralGradeService.updateById (integralGrade); if (result) { return R.ok ( ).message (\"ä¿®æ”¹æˆåŠŸ\"); } else { return R.error ( ).message (\"ä¿®æ”¹å¤±è´¥\"); } } å››ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†1ã€é¡¹ç›®ä¸­çš„å¼‚å¸¸1ã€åˆ¶é€ å¼‚å¸¸å±è”½ IntegralGrade ä¸­çš„ @TableFieldæ³¨è§£ @ApiModelProperty(value = \"é€»è¾‘åˆ é™¤(1:å·²åˆ é™¤ï¼Œ0:æœªåˆ é™¤)\") //@TableField(\"is_deleted\") @TableLogic private Boolean deleted; 2ã€Swaggerä¸­æµ‹è¯•æµ‹è¯•åˆ—è¡¨æŸ¥è¯¢åŠŸèƒ½ï¼ŒæŸ¥çœ‹ç»“æœï¼Œå‘ç”Ÿé”™è¯¯ï¼Œæ˜¾ç¤ºå“åº”å¤±è´¥ 2ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†ç›®æ ‡ï¼šæˆ‘ä»¬æƒ³è®©å¼‚å¸¸ç»“æœä¹Ÿæ˜¾ç¤ºä¸ºç»Ÿä¸€çš„è¿”å›ç»“æœå¯¹è±¡ï¼Œå¹¶ä¸”ç»Ÿä¸€å¤„ç†ç³»ç»Ÿçš„å¼‚å¸¸ä¿¡æ¯ï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œç»Ÿä¸€å¼‚å¸¸å¤„ç†ã€‚ 1ã€åˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨kk-commonä¸­åˆ›å»ºexceptionåŒ…ï¼Œåˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨ç±»UnifiedExceptionHandler package com.kk.common.exception; import com.kk.common.result.R; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Component; import org.springframework.web.bind.annotation.ExceptionHandler; import org.springframework.web.bind.annotation.RestControllerAdvice; @Slf4j @Component //Springå®¹æ˜“è‡ªåŠ¨ç®¡ç† @RestControllerAdvice //åœ¨controllerå±‚æ·»åŠ é€šçŸ¥ã€‚å¦‚æœä½¿ç”¨@ControllerAdviceï¼Œåˆ™æ–¹æ³•ä¸Šéœ€è¦æ·»åŠ @ResponseBody public class UnifiedExceptionHandler { /** * æœªå®šä¹‰å¼‚å¸¸ */ @ExceptionHandler(value = Exception.class) //å½“controllerä¸­æŠ›å‡ºExceptionï¼Œåˆ™æ•è· public R handleException(Exception e) { log.error (e.getMessage ( ), e); return R.error ( ); } } 2ã€service-coreæ·»åŠ æ‰«ææ·»åŠ  â€œcom.kk.commonâ€ @SpringBootApplication //@MapperScan({\"com.kk.srb\"})// éœ€è¦æŒ‡å®šæŒ‡å®šè·¯å¾„ @ComponentScan({\"com.kk.srb\",\"com.kk.common\"}) public class ServiceCoreApplication { 3ã€æµ‹è¯•è¿”å›ç»Ÿä¸€é”™è¯¯ç»“æœ 3ã€å¤„ç†ç‰¹å®šå¼‚å¸¸å¦‚æœæˆ‘ä»¬ä¸æƒ³æ˜¾ç¤ºç»Ÿä¸€çš„â€œæœåŠ¡å™¨å†…éƒ¨é”™è¯¯â€ï¼Œéœ€è¦ä¸ªæ€§åŒ–çš„æ˜¾ç¤ºå¼‚å¸¸ä¿¡æ¯ï¼Œé‚£ä¹ˆéœ€è¦é’ˆå¯¹ç‰¹å®šçš„å¼‚å¸¸åšå¤„ç† 1ã€æ·»åŠ ä¾èµ–åœ¨kk-commonä¸­æ·»åŠ jdbcä¾èµ– &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•åœ¨ UnifiedExceptionHandler ä¸­æ·»åŠ  /** * ç‰¹å®šå¼‚å¸¸ */ @ExceptionHandler(BadSqlGrammarException.class) public R handleBadSqlGrammarException(BadSqlGrammarException e){ log.error(e.getMessage(), e); return R.setResult(ResponseEnum.BAD_SQL_GRAMMAR_ERROR); } å®Œæ•´æšä¸¾ package com.kk.common.result; import lombok.AllArgsConstructor; import lombok.Getter; import lombok.ToString; @Getter @AllArgsConstructor @ToString public enum ResponseEnum { SUCCESS (0, \"æˆåŠŸ\"), ERROR (-1, \"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\"), //-1xx æœåŠ¡å™¨é”™è¯¯ BAD_SQL_GRAMMAR_ERROR (-101, \"sqlè¯­æ³•é”™è¯¯\"), SERVLET_ERROR (-102, \"servletè¯·æ±‚å¼‚å¸¸\"), //-2xx å‚æ•°æ ¡éªŒ UPLOAD_ERROR (-103, \"æ–‡ä»¶ä¸Šä¼ é”™è¯¯\"), EXPORT_DATA_ERROR (104, \"æ•°æ®å¯¼å‡ºå¤±è´¥\"), //-2xx å‚æ•°æ ¡éªŒ BORROW_AMOUNT_NULL_ERROR (-201, \"å€Ÿæ¬¾é¢åº¦ä¸èƒ½ä¸ºç©º\"), MOBILE_NULL_ERROR (-202, \"æ‰‹æœºå·ç ä¸èƒ½ä¸ºç©º\"), MOBILE_ERROR (-203, \"æ‰‹æœºå·ç ä¸æ­£ç¡®\"), PASSWORD_NULL_ERROR (204, \"å¯†ç ä¸èƒ½ä¸ºç©º\"), CODE_NULL_ERROR (205, \"éªŒè¯ç ä¸èƒ½ä¸ºç©º\"), CODE_ERROR (206, \"éªŒè¯ç é”™è¯¯\"), MOBILE_EXIST_ERROR (207, \"æ‰‹æœºå·å·²è¢«æ³¨å†Œ\"), LOGIN_MOBILE_ERROR (208, \"ç”¨æˆ·ä¸å­˜åœ¨\"), LOGIN_PASSWORD_ERROR (209, \"å¯†ç é”™è¯¯\"), LOGIN_LOKED_ERROR (210, \"ç”¨æˆ·è¢«é”å®š\"), LOGIN_AUTH_ERROR (-211, \"æœªç™»å½•\"), USER_BIND_IDCARD_EXIST_ERROR (-301, \"èº«ä»½è¯å·ç å·²ç»‘å®š\"), USER_NO_BIND_ERROR (302, \"ç”¨æˆ·æœªç»‘å®š\"), USER_NO_AMOUNT_ERROR (303, \"ç”¨æˆ·ä¿¡æ¯æœªå®¡æ ¸\"), USER_AMOUNT_LESS_ERROR (304, \"æ‚¨çš„å€Ÿæ¬¾é¢åº¦ä¸è¶³\"), LEND_INVEST_ERROR (305, \"å½“å‰çŠ¶æ€æ— æ³•æŠ•æ ‡\"), LEND_FULL_SCALE_ERROR (306, \"å·²æ»¡æ ‡ï¼Œæ— æ³•æŠ•æ ‡\"), NOT_SUFFICIENT_FUNDS_ERROR (307, \"ä½™é¢ä¸è¶³ï¼Œè¯·å……å€¼\"), PAY_UNIFIEDORDER_ERROR (401, \"ç»Ÿä¸€ä¸‹å•é”™è¯¯\"), ALIYUN_SMS_LIMIT_CONTROL_ERROR (-502, \"çŸ­ä¿¡å‘é€è¿‡äºé¢‘ç¹\"),//ä¸šåŠ¡é™æµ ALIYUN_SMS_ERROR (-503, \"çŸ­ä¿¡å‘é€å¤±è´¥\"),//å…¶ä»–å¤±è´¥ WEIXIN_CALLBACK_PARAM_ERROR (-601, \"å›è°ƒå‚æ•°ä¸æ­£ç¡®\"), WEIXIN_FETCH_ACCESSTOKEN_ERROR (-602, \"è·å–access_tokenå¤±è´¥\"), WEIXIN_FETCH_USERINFO_ERROR (-603, \"è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥\"); // å“åº”çŠ¶æ€ç  private Integer code; // å“åº”ä¿¡æ¯ private String message; } 3ã€æ¢å¤åˆ¶é€ çš„å¼‚å¸¸@TableField(value = \"is_deleted\") 4ã€è‡ªå®šä¹‰å¼‚å¸¸ç›®æ ‡ï¼šä½¿ç”¨ä¸€ä¸ªæˆ–è¾ƒå°‘çš„å¼‚å¸¸ç±»ï¼Œå¯ä»¥æ•è·å’Œæ˜¾ç¤ºæ‰€æœ‰çš„å¼‚å¸¸ä¿¡æ¯ã€‚ æ–¹æ¡ˆï¼šå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼ˆå¿…é¡»æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ï¼‰ï¼Œåœ¨ç¨‹åºä¸­æŠ›å‡ºè¿™ä¸ªè‡ªå®šä¹‰å¼‚å¸¸å¯¹è±¡ï¼Œå¹¶åœ¨ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨ä¸­æ•è·è‡ªå®šä¹‰å¼‚å¸¸å¯¹è±¡ 1ã€åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»å®Œæ•´æŸ¥çœ‹githubæºç  package com.kk.common.exception; import lombok.Data; import lombok.NoArgsConstructor; @Data @NoArgsConstructor public class BusinessException extends RuntimeException { //çŠ¶æ€ç  private Integer code; //é”™è¯¯æ¶ˆæ¯ private String message; } 2ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•UnifiedExceptionHandlerç±»ä¸­æ·»åŠ  /** * è‡ªå®šä¹‰å¼‚å¸¸ */ @ExceptionHandler(BusinessException.class) public R handleBusinessException(BusinessException e){ log.error(e.getMessage(), e); return R.error().message(e.getMessage()).code(e.getCode()); } 3ã€ä¿®æ”¹Controlleråœ¨AdminIntegralGradeControllerçš„æ–¹æ³•ä¸­æ·»åŠ å¼‚å¸¸å¤„ç†ï¼Œä¸šåŠ¡ä¸­éœ€è¦çš„ä½ç½®æŠ›å‡ºBusinessExceptionè‡ªå®šä¹‰å¼‚å¸¸ã€‚ @ApiOperation(\"æ–°å¢ç§¯åˆ†ç­‰çº§\") @PostMapping(\"/save\") public R save( @ApiParam(value = \"ç§¯åˆ†ç­‰çº§å¯¹è±¡\", required = true) @RequestBody IntegralGrade integralGrade){ //å¦‚æœå€Ÿæ¬¾é¢åº¦ä¸ºç©ºå°±æ‰‹åŠ¨æŠ›å‡ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¼‚å¸¸ï¼ if(integralGrade.getBorrowAmount() == null){ //BORROW_AMOUNT_NULL_ERROR(-201, \"å€Ÿæ¬¾é¢åº¦ä¸èƒ½ä¸ºç©º\"), throw new BusinessException(ResponseEnum.BORROW_AMOUNT_NULL_ERROR); } boolean result = integrationService.save(integralGrade); if (result) { return R.ok().message(\"ä¿å­˜æˆåŠŸ\"); } else { return R.error().message(\"ä¿å­˜å¤±è´¥\"); } } 4ã€æµ‹è¯• 5ã€å¼‚å¸¸å¤„ç†ä¼˜åŒ–ç›®æ ‡ï¼šä»¥ä¼˜é›…çš„ Assert(æ–­è¨€) æ–¹å¼æ¥æ ¡éªŒä¸šåŠ¡çš„å¼‚å¸¸æƒ…å†µï¼Œæ¶ˆé™¤ if else 1ã€ä»€ä¹ˆæ˜¯æ–­è¨€ç”¨æ–­è¨€çš„æ–¹å¼å°è£…å¼‚å¸¸çš„æŠ›å‡º package com.kk.srb.core; import org.junit.Test; import org.springframework.util.Assert; public class AssertTests { //if elseçš„ç”¨æ³• @Test public void test1() { Object o = null; if (o == null) { throw new IllegalArgumentException (\"ç”¨æˆ·ä¸å­˜åœ¨.\"); } } //æ–­è¨€çš„ç”¨æ³•ï¼šæ›´ä¸ºç®€æ´ @Test public void test2() { // å¦ä¸€ç§å†™æ³• Object o = null; Assert.notNull (o, \"ç”¨æˆ·ä¸å­˜åœ¨.\"); } } 2ã€è‡ªå®šä¹‰æ–­è¨€å¼•å…¥è‡ªå®šä¹‰æ–­è¨€ï¼Œç±»è·¯å¾„ï¼šcom.kk.common.exception.Assert @Slf4j public class Assert { /** * æ–­è¨€å¯¹è±¡ä¸ä¸ºç©º * obj ä¸ºç©ºåˆ™æŠ›å¼‚å¸¸ * * @param obj * @param responseEnum */ public static void notNull(Object obj, ResponseEnum responseEnum) { if (obj == null) { log.info (\"obj is null.....................\"); throw new BusinessException (responseEnum); } } ........... } å®Œæ•´çš„æºä»£ç ï¼šAssert.java 3ã€ä¿®æ”¹controlleråœ¨controllerä¸­ç”¨æ–­è¨€æ›¿æ¢if else Assert.notNull(integralGrade.getBorrowAmount(), ResponseEnum.BORROW_AMOUNT_NULL_ERROR); 6ã€Controllerä¸Šå±‚å¼‚å¸¸1ã€å¼‚å¸¸åˆ†ç±»å¯¹å¼‚å¸¸æŒ‰é˜¶æ®µè¿›è¡Œåˆ†ç±»ï¼Œå¤§ä½“å¯ä»¥åˆ†æˆï¼šè¿›å…¥Controllerå‰çš„å¼‚å¸¸ å’Œ ä¸šåŠ¡å±‚å¼‚å¸¸ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š 2ã€å¤„ç†Controllerä¸Šå±‚å¼‚å¸¸UnifiedExceptionHandlerä¸­æ·»åŠ  /** * Controllerä¸Šä¸€å±‚ç›¸å…³å¼‚å¸¸ */ @ExceptionHandler({ NoHandlerFoundException.class, HttpRequestMethodNotSupportedException.class, HttpMediaTypeNotSupportedException.class, MissingPathVariableException.class, MissingServletRequestParameterException.class, TypeMismatchException.class, HttpMessageNotReadableException.class, HttpMessageNotWritableException.class, MethodArgumentNotValidException.class, HttpMediaTypeNotAcceptableException.class, ServletRequestBindingException.class, ConversionNotSupportedException.class, MissingServletRequestPartException.class, AsyncRequestTimeoutException.class }) public R handleServletException(Exception e) { log.error(e.getMessage(), e); //SERVLET_ERROR(-102, \"servletè¯·æ±‚å¼‚å¸¸\"), return R.error().message(ResponseEnum.SERVLET_ERROR.getMessage()).code(ResponseEnum.SERVLET_ERROR.getCode()); } 3ã€æµ‹è¯•åœ¨saveæµ‹è¯•ç”¨ä¾‹ä¸­è¾“å…¥éæ³•çš„jsonå‚æ•°ï¼Œåˆ™å¾—åˆ°ä¸‹é¢çš„ç»“æœã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°æ—¥å¿—ä¸­æŸ¥çœ‹å…·ä½“çš„é”™è¯¯åŸå› ã€‚å‰ç«¯åªéœ€è¦è¿”å›ç›¸å¯¹ç®€å•å‹å¥½çš„æç¤ºå³å¯ã€‚ äº”ã€ç»Ÿä¸€æ—¥å¿—å¤„ç†1ã€Logbackæ—¥å¿—1.ä»€ä¹ˆæ˜¯æ—¥å¿—é€šè¿‡æ—¥å¿—æŸ¥çœ‹ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ï¼Œè¿è¡Œä¿¡æ¯ï¼Œå¼‚å¸¸ä¿¡æ¯ç­‰ 2.æ—¥å¿—çº§åˆ«æ—¥å¿—è®°å½•å™¨ï¼ˆLoggerï¼‰çš„è¡Œä¸ºæ˜¯åˆ†ç­‰çº§çš„ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š åˆ†ä¸ºï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFF é»˜è®¤æƒ…å†µä¸‹ï¼Œspring bootä»æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„æ—¥å¿—çº§åˆ«åªæœ‰INFOåŠä»¥ä¸Šçº§åˆ«ï¼Œå¯ä»¥é…ç½®æ—¥å¿—çº§åˆ« # è®¾ç½®æ—¥å¿—çº§åˆ« logging: level: root: ERROR è¿™ç§æ–¹å¼èƒ½å°†ERRORçº§åˆ«ä»¥åŠä»¥ä¸Šçº§åˆ«çš„æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ä¸Šï¼Œå…¶ä»–çº§åˆ«å°†ä¸ä¼šè¾“å‡º 3.åˆ›å»ºæ—¥å¿—æ–‡ä»¶spring bootå†…éƒ¨ä½¿ç”¨Logbackä½œä¸ºæ—¥å¿—å®ç°çš„æ¡†æ¶ã€‚ å…ˆåˆ é™¤å‰é¢åœ¨application.ymlä¸­çš„æ—¥å¿—çº§åˆ«é…ç½® resources ä¸­åˆ›å»º logback-spring.xml ï¼ˆé»˜è®¤æ—¥å¿—æ–‡ä»¶çš„åå­—ï¼‰ &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;configuration&gt; &lt;/configuration&gt; 4ã€åˆ›å»ºæµ‹è¯•æ—¥å¿—è¾“å‡ºå°†ä»¥ä¸‹æ—¥å¿—è¾“å‡ºåˆ°ä»»æ„controllerçš„æ–¹æ³•ä¸­å³å¯ï¼Œä¾‹å¦‚listæ–¹æ³•ä¸­ å‰æï¼šç±»ä¸Šè®°å¾—åŠ  @Slf4jï¼Œæ³¨å…¥ log.info @GetMapping(\"/list\") @ApiOperation(\"ç§¯åˆ†ç­‰çº§åˆ—è¡¨\") public R listAll() { log.info (\"hi i'm helen\"); log.warn (\"warning!!!\"); log.error (\"it's a error\"); List&lt;IntegralGrade&gt; list = integralGradeService.list ( ); return R.ok ( ).data (\"list\", list); } 2ã€åŸºæœ¬é…ç½®è¯´æ˜1.configurationæ—¥å¿—é…ç½®çš„æ ¹èŠ‚ç‚¹ &lt;configuration&gt;&lt;/configuration&gt; 2.contextNameæ˜¯ çš„å­èŠ‚ç‚¹ã€‚ æ¯ä¸ªloggeréƒ½å…³è”åˆ°loggerä¸Šä¸‹æ–‡ï¼Œé»˜è®¤ä¸Šä¸‹æ–‡åç§°ä¸ºâ€œdefaultâ€ã€‚ä½†å¯ä»¥ä½¿ç”¨è®¾ç½®æˆå…¶ä»–åå­—ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„åº”ç”¨ç¨‹åºã€‚ &lt;contextName&gt;kkSrb&lt;/contextName&gt; 3.propertyæ˜¯ çš„å­èŠ‚ç‚¹ï¼Œç”¨æ¥å®šä¹‰å˜é‡ã€‚ æœ‰ä¸¤ä¸ªå±æ€§ï¼Œnameå’Œvalueï¼šnameçš„å€¼æ˜¯å˜é‡çš„åç§°ï¼Œvalueæ˜¯å˜é‡çš„å€¼ã€‚ é€šè¿‡ å®šä¹‰çš„å€¼ä¼šè¢«æ’å…¥åˆ°loggerä¸Šä¸‹æ–‡ä¸­ã€‚å®šä¹‰å˜é‡åï¼Œå¯ä»¥ä½¿â€œ${}â€æ¥ä½¿ç”¨å˜é‡ã€‚ &lt;!-- æ—¥å¿—çš„è¾“å‡ºç›®å½• --&gt; &lt;property name=\"log.path\" value=\"D:/project/finance/srb_log/core\" /&gt; &lt;!--æ§åˆ¶å°æ—¥å¿—æ ¼å¼ï¼šå½©è‰²æ—¥å¿—--&gt; &lt;!-- magenta:æ´‹çº¢ --&gt; &lt;!-- boldMagenta:ç²—çº¢--&gt; &lt;!-- cyan:é’è‰² --&gt; &lt;!-- white:ç™½è‰² --&gt; &lt;!-- magenta:æ´‹çº¢ --&gt; &lt;property name=\"CONSOLE_LOG_PATTERN\" value=\"%yellow(%date{yyyy-MM-dd HH:mm:ss}) %highlight([%-5level]) %green(%logger) %msg%n\"/&gt; &lt;!--æ–‡ä»¶æ—¥å¿—æ ¼å¼--&gt; &lt;property name=\"FILE_LOG_PATTERN\" value=\"%date{yyyy-MM-dd HH:mm:ss} [%-5level] %thread %file:%line %logger %msg%n\" /&gt; &lt;!--ç¼–ç --&gt; &lt;property name=\"ENCODING\" value=\"UTF-8\" /&gt; 4ã€appender æ˜¯çš„å­èŠ‚ç‚¹ï¼Œæ˜¯è´Ÿè´£å†™æ—¥å¿—çš„ç»„ä»¶ æœ‰ä¸¤ä¸ªå¿…è¦å±æ€§nameå’Œclassï¼šnameæŒ‡å®šappenderåç§°ï¼ŒclassæŒ‡å®šappenderçš„å…¨é™å®šå å¯¹æ—¥å¿—è¿›è¡Œæ ¼å¼åŒ– å®šä¹‰æ—¥å¿—çš„å…·ä½“è¾“å‡ºæ ¼å¼ ç¼–ç æ–¹å¼ 4.1æ§åˆ¶å°æ—¥å¿—é…ç½® &lt;!-- æ§åˆ¶å°æ—¥å¿— --&gt; &lt;appender name=\"CONSOLE\" class=\"ch.qos.logback.core.ConsoleAppender\"&gt; &lt;encoder&gt; &lt;pattern&gt;${CONSOLE_LOG_PATTERN}&lt;/pattern&gt; &lt;charset&gt;${ENCODING}&lt;/charset&gt; &lt;/encoder&gt; &lt;/appender&gt; 4.2æ–‡ä»¶æ—¥å¿—é…ç½® è¡¨ç¤ºæ—¥å¿—æ–‡ä»¶çš„ä½ç½®ï¼Œå¦‚æœä¸Šçº§ç›®å½•ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ²¡æœ‰é»˜è®¤å€¼ã€‚ é»˜è®¤ trueï¼Œæ—¥å¿—è¢«è¿½åŠ åˆ°æ–‡ä»¶ç»“å°¾ï¼Œå¦‚æœæ˜¯ falseï¼ŒæœåŠ¡é‡å¯åæ¸…ç©ºç°å­˜æ–‡ä»¶ã€‚ &lt;!-- æ–‡ä»¶æ—¥å¿— --&gt; &lt;appender name=\"FILE\" class=\"ch.qos.logback.core.FileAppender\"&gt; &lt;file&gt;${log.path}/log.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;encoder&gt; &lt;pattern&gt;${FILE_LOG_PATTERN}&lt;/pattern&gt; &lt;charset&gt;${ENCODING}&lt;/charset&gt; &lt;/encoder&gt; &lt;/appender&gt; 5ã€loggerå¯ä»¥æ˜¯ çš„å­èŠ‚ç‚¹ï¼Œç”¨æ¥è®¾ç½®æŸä¸€ä¸ªåŒ…æˆ–å…·ä½“æŸä¸€ä¸ªç±»çš„æ—¥å¿—æ‰“å°çº§åˆ«ã€æŒ‡å®š nameï¼š ç”¨æ¥æŒ‡å®šå—æ­¤loggerçº¦æŸçš„æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±» levelï¼š ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFã€‚é»˜è®¤ç»§æ‰¿ä¸Šçº§çš„çº§åˆ« å¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œæ ‡è¯†è¿™ä¸ªappenderå°†ä¼šæ·»åŠ åˆ°è¿™ä¸ªlogger &lt;!-- æ—¥å¿—è®°å½•å™¨ --&gt; &lt;logger name=\"com.kk\" level=\"INFO\"&gt; &lt;appender-ref ref=\"CONSOLE\" /&gt; &lt;appender-ref ref=\"FILE\" /&gt; &lt;/logger&gt; 6ã€æµ‹è¯•æµ‹è¯•æ—¥å¿—è®°å½•çš„æ§åˆ¶å°è¾“å‡ºã€æ–‡ä»¶è¾“å‡ºã€ä»¥åŠæ—¥å¿—çº§åˆ« 3ã€å¤šç¯å¢ƒé…ç½®springProfileåœ¨ä¸€ä¸ªåŸºäºSpring bootå¼€å‘çš„é¡¹ç›®é‡Œï¼Œå¸¸å¸¸éœ€è¦æœ‰å¤šå¥—ç¯å¢ƒçš„é…ç½®ï¼šå¼€å‘ï¼Œæµ‹è¯•ä»¥åŠäº§å“ã€‚ ä½¿ç”¨springProfile å¯ä»¥åˆ†åˆ«é…ç½®å¼€å‘ï¼ˆdevï¼‰ï¼Œæµ‹è¯•ï¼ˆtestï¼‰ä»¥åŠç”Ÿäº§ï¼ˆprodï¼‰ç­‰ä¸åŒçš„ç¯å¢ƒ &lt;!-- å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒ --&gt; &lt;springProfile name=\"dev,test\"&gt; &lt;logger name=\"com.kk\" level=\"INFO\"&gt; &lt;appender-ref ref=\"CONSOLE\" /&gt; &lt;/logger&gt; &lt;/springProfile&gt; &lt;!-- ç”Ÿäº§ç¯å¢ƒ --&gt; &lt;springProfile name=\"prod\"&gt; &lt;logger name=\"com.kk\" level=\"ERROR\"&gt; &lt;appender-ref ref=\"CONSOLE\" /&gt; &lt;appender-ref ref=\"FILE\" /&gt; &lt;/logger&gt; &lt;/springProfile&gt; æ³¨æ„ï¼šéœ€è¦æ³¨é‡ŠåŸå§‹é…ç½® &lt;!-- æ—¥å¿—è®°å½•å™¨ --&gt; &lt;!--&lt;logger name=\"com.kk\" level=\"INFO\"&gt;--&gt; &lt;!--&lt;appender-ref ref=\"CONSOLE\"/&gt;--&gt; &lt;!--&lt;appender-ref ref=\"FILE\"/&gt;--&gt; &lt;!--&lt;/logger&gt;--&gt; 4ã€æ»šåŠ¨æ—¥å¿— â˜…é—®é¢˜ï¼šç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œå¦‚æœç³»ç»Ÿé•¿æ—¶é—´è¿è¡Œï¼Œé‚£ä¹ˆæ—¥å¿—æ–‡ä»¶ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œç³»ç»Ÿè¯»å–å’Œå†™å…¥æ—¥å¿—çš„æ—¶é—´ä¼šè¶Šæ¥è¶Šæ…¢ï¼Œä¸¥é‡çš„æƒ…å†µä¼šè€—å°½ç³»ç»Ÿå†…å­˜ï¼Œå¯¼è‡´ç³»ç»Ÿå®•æœºã€‚ è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥è®¾ç½®æ»šåŠ¨æ—¥å¿—ã€‚ 1.è®¾ç½®æ—¶é—´æ»šåŠ¨ç­–ç•¥RollingFileAppenderæ˜¯ Appenderçš„å¦ä¸€ä¸ªå®ç°ï¼Œè¡¨ç¤ºæ»šåŠ¨è®°å½•æ–‡ä»¶ï¼Œå…ˆå°†æ—¥å¿—è®°å½•åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œå½“ç¬¦åˆæŸä¸ªæ¡ä»¶æ—¶ï¼Œå°†æ—§æ—¥å¿—å¤‡ä»½åˆ°å…¶ä»–æ–‡ä»¶ æ˜¯ çš„å­èŠ‚ç‚¹ï¼Œç”¨æ¥å®šä¹‰æ»šåŠ¨ç­–ç•¥ã€‚ TimeBasedRollingPolicyï¼š æœ€å¸¸ç”¨çš„æ»šåŠ¨ç­–ç•¥ï¼Œæ ¹æ®æ—¶é—´æ¥åˆ¶å®šæ»šåŠ¨ç­–ç•¥ã€‚ ï¼š åŒ…å«æ–‡ä»¶ååŠè½¬æ¢ç¬¦ï¼Œ â€œ%dâ€å¯ä»¥åŒ…å«æŒ‡å®šçš„æ—¶é—´æ ¼å¼ï¼Œå¦‚ï¼š%d{yyyy-MM-dd}ã€‚å¦‚æœç›´æ¥ä½¿ç”¨ %dï¼Œé»˜è®¤æ ¼å¼æ˜¯ yyyy-MM-ddã€‚ ï¼š å¯é€‰èŠ‚ç‚¹ï¼Œæ§åˆ¶ä¿ç•™çš„å½’æ¡£æ–‡ä»¶çš„æœ€å¤§æ•°é‡ï¼Œè¶…å‡ºæ•°é‡å°±åˆ é™¤æ—§æ–‡ä»¶ã€‚å‡è®¾è®¾ç½®æ¯ä¸ªæœˆæ»šåŠ¨ï¼Œä¸”æ˜¯6ï¼Œåˆ™åªä¿å­˜æœ€è¿‘6ä¸ªæœˆçš„æ–‡ä»¶ï¼Œåˆ é™¤ä¹‹å‰çš„æ—§æ–‡ä»¶ã€‚æ³¨æ„ï¼Œåˆ é™¤æ—§æ–‡ä»¶æ˜¯ï¼Œé‚£äº›ä¸ºäº†å½’æ¡£è€Œåˆ›å»ºçš„ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚ &lt;appender name=\"ROLLING_FILE\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;!-- è¦åŒºåˆ«äºå…¶ä»–çš„appenderä¸­çš„æ–‡ä»¶åå­— --&gt; &lt;file&gt;${log.path}/log-rolling.log&lt;/file&gt; &lt;encoder&gt; &lt;pattern&gt;${FILE_LOG_PATTERN}&lt;/pattern&gt; &lt;charset&gt;${ENCODING}&lt;/charset&gt; &lt;/encoder&gt; &lt;!-- è®¾ç½®æ»šåŠ¨æ—¥å¿—è®°å½•çš„æ»šåŠ¨ç­–ç•¥ --&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"&gt; &lt;!-- æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ --&gt; &lt;fileNamePattern&gt;${log.path}/info/log-rolling-%d{yyyy-MM-dd}.log&lt;/fileNamePattern&gt; &lt;!--å½’æ¡£æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æœ€å¤§æ•°é‡--&gt; &lt;maxHistory&gt;15&lt;/maxHistory&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; 2.è®¾ç½®è§¦å‘æ»šåŠ¨æ—¶æœºæ”¾åœ¨çš„å­èŠ‚ç‚¹çš„ä½ç½®é‡Œé¢ï¼ŒåŸºäºå®è·µç­–ç•¥çš„è§¦å‘æ»šåŠ¨ç­–ç•¥ è®¾ç½®è§¦å‘æ»šåŠ¨æ¡ä»¶ï¼šå•ä¸ªæ–‡ä»¶å¤§äº100Mæ—¶ç”Ÿæˆæ–°çš„æ–‡ä»¶ æ³¨æ„ï¼šä¿®æ”¹æ—¥å¿—æ–‡ä»¶å æ­¤æ—¶ ${log.path}/info/log-rolling-%d{yyyy-MM-dd}.%i.log &lt;timeBasedFileNamingAndTriggeringPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP\"&gt; &lt;maxFileSize&gt;1KB&lt;/maxFileSize&gt; &lt;/timeBasedFileNamingAndTriggeringPolicy&gt; 5ã€å®Œæ•´çš„æ—¥å¿—é…ç½®æ–‡ä»¶&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;configuration&gt; &lt;contextName&gt;kkSrb&lt;/contextName&gt; &lt;!-- æ—¥å¿—çš„è¾“å‡ºç›®å½• --&gt; &lt;property name=\"log.path\" value=\"D:/project/test/srb_log/core\"/&gt; &lt;!--æ§åˆ¶å°æ—¥å¿—æ ¼å¼ï¼šå½©è‰²æ—¥å¿—--&gt; &lt;!-- magenta:æ´‹çº¢ --&gt; &lt;!-- boldMagenta:ç²—çº¢--&gt; &lt;!-- cyan:é’è‰² --&gt; &lt;!-- white:ç™½è‰² --&gt; &lt;!-- magenta:æ´‹çº¢ --&gt; &lt;property name=\"CONSOLE_LOG_PATTERN\" value=\"%yellow(%date{yyyy-MM-dd HH:mm:ss}) %highlight([%-5level]) %green(%logger) %msg%n\"/&gt; &lt;!--æ–‡ä»¶æ—¥å¿—æ ¼å¼--&gt; &lt;property name=\"FILE_LOG_PATTERN\" value=\"%date{yyyy-MM-dd HH:mm:ss} [%-5level] %thread %file:%line %logger %msg%n\"/&gt; &lt;!--ç¼–ç --&gt; &lt;property name=\"ENCODING\" value=\"UTF-8\"/&gt; &lt;!-- æ§åˆ¶å°æ—¥å¿— --&gt; &lt;appender name=\"CONSOLE\" class=\"ch.qos.logback.core.ConsoleAppender\"&gt; &lt;encoder&gt; &lt;pattern&gt;${CONSOLE_LOG_PATTERN}&lt;/pattern&gt; &lt;charset&gt;${ENCODING}&lt;/charset&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- æ–‡ä»¶æ—¥å¿— --&gt; &lt;appender name=\"FILE\" class=\"ch.qos.logback.core.FileAppender\"&gt; &lt;file&gt;${log.path}/log.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;encoder&gt; &lt;pattern&gt;${FILE_LOG_PATTERN}&lt;/pattern&gt; &lt;charset&gt;${ENCODING}&lt;/charset&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;appender name=\"ROLLING_FILE\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;!-- è¦åŒºåˆ«äºå…¶ä»–çš„appenderä¸­çš„æ–‡ä»¶åå­— --&gt; &lt;file&gt;${log.path}/log-rolling.log&lt;/file&gt; &lt;encoder&gt; &lt;pattern&gt;${FILE_LOG_PATTERN}&lt;/pattern&gt; &lt;charset&gt;${ENCODING}&lt;/charset&gt; &lt;/encoder&gt; &lt;!-- è®¾ç½®æ»šåŠ¨æ—¥å¿—è®°å½•çš„æ»šåŠ¨ç­–ç•¥ --&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\"&gt; &lt;!-- æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ --&gt; &lt;fileNamePattern&gt;${log.path}/info/log-rolling-%d{yyyy-MM-dd}.%i.log&lt;/fileNamePattern&gt; &lt;!--å½’æ¡£æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æœ€å¤§æ•°é‡--&gt; &lt;maxHistory&gt;15&lt;/maxHistory&gt; &lt;timeBasedFileNamingAndTriggeringPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP\"&gt; &lt;maxFileSize&gt;1KB&lt;/maxFileSize&gt; &lt;/timeBasedFileNamingAndTriggeringPolicy&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; &lt;!-- &lt;logger name=\"com.kk\" level=\"INFO\"&gt;--&gt; &lt;!-- &lt;appender-ref ref=\"CONSOLE\" /&gt;--&gt; &lt;!-- &lt;appender-ref ref=\"FILE\" /&gt;--&gt; &lt;!-- &lt;/logger&gt;--&gt; &lt;!-- å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒ --&gt; &lt;springProfile name=\"dev,test\"&gt; &lt;logger name=\"com.kk\" level=\"INFO\"&gt; &lt;appender-ref ref=\"CONSOLE\"/&gt; &lt;/logger&gt; &lt;/springProfile&gt; &lt;!-- ç”Ÿäº§ç¯å¢ƒ --&gt; &lt;springProfile name=\"prod\"&gt; &lt;logger name=\"com.kk\" level=\"ERROR\"&gt; &lt;appender-ref ref=\"CONSOLE\"/&gt; &lt;appender-ref ref=\"ROLLING_FILE\"/&gt; &lt;/logger&gt; &lt;/springProfile&gt; &lt;/configuration&gt; â…¢ã€å‰ç«¯æ¶æ„æ­å»ºä¸€ã€æ­å»ºå‰ç«¯å¹³å°1ã€vue-element-adminvue-element-adminæ˜¯åŸºäºelement-ui çš„ä¸€å¥—åå°ç®¡ç†ç³»ç»Ÿé›†æˆæ–¹æ¡ˆã€‚ GitHubåœ°å€ï¼šhttps://github.com/PanJiaChen/vue-element-admin é¡¹ç›®åœ¨çº¿é¢„è§ˆï¼šhttps://panjiachen.gitee.io/vue-element-admin 2ã€vue-admin-template1ã€ç®€ä»‹vueAdmin-templateæ˜¯åŸºäºvue-element-adminçš„ä¸€å¥—åå°ç®¡ç†ç³»ç»ŸåŸºç¡€æ¨¡æ¿ï¼ˆæœ€å°‘ç²¾ç®€ç‰ˆï¼‰ï¼Œå¯ä½œä¸ºæ¨¡æ¿è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚ GitHubåœ°å€ï¼šhttps://github.com/PanJiaChen/vue-admin-template æ ¹æ®ç”¨æˆ·è§’è‰²æ¥åŠ¨æ€ç”Ÿæˆä¾§è¾¹æ çš„åˆ†æ”¯ï¼šhttps://github.com/PanJiaChen/vue-admin-template/tree/permission-control 2ã€å®‰è£…å’Œè¿è¡Œ# clone é¡¹ç›® git clone https...... # é‡å‘½å,åˆ æ‰è‡ªå¸¦çš„ .gitæ–‡ä»¶å¤¹ # è¿›å…¥ç›®å½• cd FrontEndCode # å®‰è£…ä¾èµ– npm install # å¯åŠ¨ã€‚æ‰§è¡Œåï¼Œæµè§ˆå™¨è‡ªåŠ¨å¼¹å‡ºå¹¶è®¿é—®http://localhost:9528/ npm run dev 3ã€å‰ç«¯é…ç½®1ã€ç¦ç”¨ESLintè¯­æ³•æ£€æŸ¥vue.config.js ç¬¬30è¡Œå¤„ç¦ç”¨ESLintè¯­æ³•æ£€æŸ¥ lintOnSave: false, 2ã€æ·»åŠ prettieræ ¼å¼åŒ–é…ç½®åœ¨vueé¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶.prettierrc { \"semi\": false, \"singleQuote\": true, \"htmlWhitespaceSensitivity\": \"ignore\" } 3ã€ä¿®æ”¹é¡µé¢æ ‡é¢˜src/settings.js ç¬¬3è¡Œå¤„ä¿®æ”¹é¡µé¢æ ‡é¢˜ 4ã€å›½é™…åŒ–è®¾ç½®src/main.js ç¬¬7è¡Œå¤„ä¿®æ”¹è¯­è¨€ import locale from 'element-ui/lib/locale/lang/zh-CN' // lang i18n æµ‹è¯•å¹³å°è¯­è¨€çš„ä¿®æ”¹ 5ã€ä¸‹æ‹‰èœå•ä¿®æ”¹ 6ã€ç™»å½•é¡µä¿®æ”¹src/views/login/index.vue ä¿®æ”¹é¡µé¢æ ‡é¢˜ã€ç™»å½•æŒ‰é’®ç­‰ äºŒã€ç³»ç»Ÿè·¯ç”±é…ç½®1ã€ç»„ä»¶å®šä¹‰1ã€åˆ›å»ºvueç»„ä»¶åœ¨src/viewsæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä»¥ä¸‹æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ 2ã€list.vuecore/integral-grade/list.vue æ³¨æ„ï¼Œæœ€åº•ä¸‹ä¿ç•™ä¸€è¡Œï¼Œä¸ç„¶vscodeæŠ¥é”™ &lt;template&gt; &lt;div class=\"app-container\"&gt;ç§¯åˆ†ç­‰çº§åˆ—è¡¨&lt;/div&gt; &lt;/template&gt; 3ã€form.vuecore/integral-grade/orm.vue &lt;template&gt; &lt;div class=\"app-container\"&gt; ç§¯åˆ†ç­‰çº§è¡¨å• &lt;/div&gt; &lt;/template&gt; 2ã€è·¯ç”±å®šä¹‰ä¿®æ”¹ src/router/index.js æ–‡ä»¶ï¼Œé‡æ–°å®šä¹‰constantRoutesï¼Œæ‹·è´åˆ° dashboardè·¯ç”±èŠ‚ç‚¹ ä¸‹é¢ æ³¨æ„ï¼šæ¯ä¸ªè·¯ç”±çš„nameä¸èƒ½ç›¸åŒ { path: '/core/integral-grade', component: Layout, redirect: '/core/integral-grade/list', name: 'coreIntegralGrade', meta: { title: 'ç§¯åˆ†ç­‰çº§ç®¡ç†', icon: 'el-icon-s-marketing' }, alwaysShow: true, children: [ { path: 'list', name: 'coreIntegralGradeList', component: () =&gt; import('@/views/core/integral-grade/list'), meta: { title: 'ç§¯åˆ†ç­‰çº§åˆ—è¡¨' } }, { path: 'create', name: 'coreIntegralGradeCreate', component: () =&gt; import('@/views/core/integral-grade/form'), meta: { title: 'æ–°å¢ç§¯åˆ†ç­‰çº§' } }, { path: 'edit/:id', name: 'coreIntegralGradeEdit', component: () =&gt; import('@/views/core/integral-grade/form'), meta: { title: 'ç¼–è¾‘ç§¯åˆ†ç­‰çº§' }, hidden: true } ] }, ä¸‰ã€å‰ç«¯å¼€å‘æµç¨‹1ã€å…¨æ ˆå¼€å‘æµç¨‹1ã€å‰ç«¯è°ƒç”¨æµç¨‹ä¸‹å›¾æ˜¯å¼€å‘è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°å’Œå‡ ä¸ªæ ¸å¿ƒçš„æ¨¡å—ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†è·¯ç”±çš„é…ç½®å’Œé¡µé¢ç»„ä»¶çš„åˆ›å»ºï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥å®Œå–„é¡µé¢ç»„ä»¶çš„æ¨¡æ¿ &lt;template&gt;éƒ¨åˆ†ï¼Œä»¥åŠè„šæœ¬&lt;script&gt;ç­‰éƒ¨åˆ†çš„å¼€å‘ï¼Œç„¶ååˆ›å»ºå‰åç«¯å¯¹æ¥éœ€è¦çš„apiæ¨¡å—ï¼Œæœ€åé€šè¿‡apiæ¨¡å—å‘åç«¯æ¥å£å‘èµ·è°ƒç”¨ã€‚ 2ã€nginxåå‘ä»£ç†é…ç½®ç›®å‰ï¼Œåº”ç”¨ç¨‹åºçš„å‰åç«¯åŸºæœ¬æ¶æ„å¦‚ä¸‹ï¼šsrb-adminæ˜¯å‰ç«¯ç¨‹åºï¼Œç›´æ¥è°ƒç”¨åç«¯çš„srb-coreå¾®æœåŠ¡ ä¸ºäº†èƒ½å¤Ÿè®©å‰ç«¯ç¨‹åºèƒ½å¤ŸåŒæ—¶å¯¹æ¥å¤šä¸ªåç«¯æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šç§è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚nginxåå‘ä»£ç†ã€å¾®æœåŠ¡ç½‘å…³ç­‰ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨nginxä½œä¸ºå‰åç«¯ä¸­é—´çš„åå‘ä»£ç†å±‚ï¼Œæ¶æ„å¦‚ä¸‹ nginxçš„é…ç½® server { listen 80; server_name localhost; location ~ /core/ { proxy_pass http://localhost:8110; } location ~ /sms/ { proxy_pass http://localhost:8120; } location ~ /oss/ { proxy_pass http://localhost:8130; } } nginxçš„å‘½ä»¤ start nginx #å¯åŠ¨ nginx -s stop #åœæ­¢ nginx -s reload #é‡æ–°åŠ è½½é…ç½® å‰ç«¯çš„é…ç½®ï¼š .env.development # base apiï¼šè¿æ¥åˆ°nginx VUE_APP_BASE_API = 'http://localhost' 3ã€mock-serverVUE_APP_BASE_API çš„ ä¿®æ”¹ä¼šå½±å“åˆ°å¹³å°æ¨¡æ‹Ÿç™»å½•åŠŸèƒ½çš„mockæ•°æ®ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹mock-serverçš„åœ°å€ ä¿®æ”¹ mock/mock-server.js æ–‡ä»¶ ç¬¬37è¡Œ url: new RegExp(`/dev-api${url}`), ä¿®æ”¹ src/api/user.jsä¸­çš„æ¥å£è°ƒç”¨ï¼Œä¸ºæ¯ä¸€ä¸ªè¿œç¨‹è°ƒç”¨æ·»åŠ é…ç½® baseURL: '/dev-api', 2ã€å‰ç«¯ç»„ä»¶å¼€å‘1ã€å®šä¹‰apiæ¨¡å—åˆ›å»ºæ–‡ä»¶ src/api/core/integral-grade.js // @ ç¬¦å·åœ¨vue.config.js ä¸­é…ç½®ï¼Œ è¡¨ç¤º 'src' è·¯å¾„çš„åˆ«å import request from '@/utils/request' export default { list() { return request({ url: '/admin/core/integralGrade/list', method: 'get' }) } } 2ã€å®šä¹‰é¡µé¢ç»„ä»¶è„šæœ¬src/views/core/integral-grade/list.vue &lt;script&gt; import integralGradeApi from '@/api/core/integral-grade' export default { // å®šä¹‰æ•°æ®æ¨¡å‹ data() { return { list: [] // æ•°æ®åˆ—è¡¨ } }, // é¡µé¢æ¸²æŸ“æˆåŠŸåè·å–æ•°æ® created() { this.fetchData() }, // å®šä¹‰æ–¹æ³• methods: { fetchData() { // è°ƒç”¨api integralGradeApi.list().then(response =&gt; { this.list = response.data.list }) } } } &lt;/script&gt; 3ã€å®šä¹‰é¡µé¢ç»„ä»¶æ¨¡æ¿src/views/core/integral-grade/list.vue &lt;template&gt; &lt;div class=\"app-container\"&gt; &lt;!-- è¡¨æ ¼ --&gt; &lt;el-table :data=\"list\" border stripe&gt; &lt;el-table-column type=\"index\" width=\"50\" /&gt; &lt;el-table-column prop=\"borrowAmount\" label=\"å€Ÿæ¬¾é¢åº¦\" /&gt; &lt;el-table-column prop=\"integralStart\" label=\"ç§¯åˆ†åŒºé—´å¼€å§‹\" /&gt; &lt;el-table-column prop=\"integralEnd\" label=\"ç§¯åˆ†åŒºé—´ç»“æŸ\" /&gt; &lt;/el-table&gt; &lt;/div&gt; &lt;/template&gt; 4ã€axioså“åº”æ‹¦æˆªå™¨ä¿®æ”¹src/utils/request.js ä¸­ å°†ç¬¬49è¡Œçš„ if (res.code !== 20000) { ä¿®æ”¹æˆ if (res.code !== 0 &amp;&amp; res.code !== 20000) { å› ä¸ºæˆ‘ä»¬çš„åç«¯æ¥å£ç»Ÿä¸€ç»“æœåˆ¤æ–­0ä¸ºæˆåŠŸçš„å“åº”ç»“æœï¼Œè€Œmockæ•°æ®åˆ¤æ–­20000ä½æ­£ç¡®çš„ç»“æœ å››ã€å®Œå–„ç§¯åˆ†æ¨¡å—1ã€åˆ é™¤æ•°æ®1.å®šä¹‰api src/api/core/integral-grade.js removeById(id) { return request({ url: `/admin/core/integralGrade/remove/${id}`, method: 'delete' }) } 2.é¡µé¢ç»„ä»¶æ¨¡æ¿src/views/core/integral-grade/list.vueï¼Œåœ¨tableç»„ä»¶ä¸­æ·»åŠ åˆ é™¤åˆ— &lt;el-table-column label=\"æ“ä½œ\" width=\"200\" align=\"center\"&gt; &lt;template slot-scope=\"scope\"&gt; &lt;el-button type=\"danger\" size=\"mini\" icon=\"el-icon-delete\" @click=\"removeById(scope.row.id)\" &gt; åˆ é™¤ &lt;/el-button&gt; &lt;/template&gt; &lt;/el-table-column&gt; 3.åˆ é™¤æ•°æ®è„šæœ¬// æ ¹æ®idåˆ é™¤æ•°æ® removeById(id) { // debugger console.log('id', id) this.$confirm('æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤è¯¥è®°å½•, æ˜¯å¦ç»§ç»­?', 'æç¤º', { confirmButtonText: 'ç¡®å®š', cancelButtonText: 'å–æ¶ˆ', type: 'warning' }) .then(() =&gt; { return integralGradeApi.removeById(id) }) .then(response =&gt; { this.$message({ message: response.message, type: 'success' }) this.fetchData() }) .catch(error =&gt; { console.log('catchçš„error', error) if (error === 'cancel') { this.$message({ type: 'info', message: 'å·²å–æ¶ˆåˆ é™¤' }) } }) } 2ã€æ–°å¢æ•°æ®1.å®šä¹‰api src/api/core/integral-grade.js save(integralGrade) { return request({ url: '/admin/core/integralGrade/save', method: 'post', data: integralGrade }) } 2.å®šä¹‰é¡µé¢datasrc/views/core/integral-grade/form.vueï¼Œå®Œå–„dataå®šä¹‰ &lt;script&gt; export default { data() { return { integralGrade: {}, // åˆå§‹åŒ–æ•°æ® saveBtnDisabled: false // ä¿å­˜æŒ‰é’®æ˜¯å¦ç¦ç”¨ï¼Œé˜²æ­¢è¡¨å•é‡å¤æäº¤ } } } &lt;/script&gt; 3.é¡µé¢ç»„ä»¶æ¨¡æ¿src/views/core/integral-grade/form.vueï¼Œå®Œå–„template &lt;template&gt; &lt;div class=\"app-container\"&gt; &lt;!-- è¾“å…¥è¡¨å• --&gt; &lt;el-form label-width=\"120px\"&gt; &lt;el-form-item label=\"å€Ÿæ¬¾é¢åº¦\"&gt; &lt;el-input-number v-model=\"integralGrade.borrowAmount\" :min=\"0\" /&gt; &lt;/el-form-item&gt; &lt;el-form-item label=\"ç§¯åˆ†åŒºé—´å¼€å§‹\"&gt; &lt;el-input-number v-model=\"integralGrade.integralStart\" :min=\"0\" /&gt; &lt;/el-form-item&gt; &lt;el-form-item label=\"ç§¯åˆ†åŒºé—´ç»“æŸ\"&gt; &lt;el-input-number v-model=\"integralGrade.integralEnd\" :min=\"0\" /&gt; &lt;/el-form-item&gt; &lt;el-form-item&gt; &lt;el-button :disabled=\"saveBtnDisabled\" type=\"primary\" @click=\"saveOrUpdate()\"&gt; ä¿å­˜ &lt;/el-button&gt; &lt;/el-form-item&gt; &lt;/el-form&gt; &lt;/div&gt; &lt;/template&gt; 4.æ–°å¢æ•°æ®è„šæœ¬src/views/core/integral-grade/form.vueï¼Œå¼•å…¥api import integralGradeApi from '@/api/core/integral-grade' å®šä¹‰ä¿å­˜æ–¹æ³• methods: { saveOrUpdate() { // ç¦ç”¨ä¿å­˜æŒ‰é’® this.saveBtnDisabled = true this.saveData() }, // æ–°å¢æ•°æ® saveData() { // debugger integralGradeApi.save(this.integralGrade).then(response =&gt; { this.$message({ type: 'success', message: response.message }) this.$router.push('/core/integral-grade/list') }) } } 3ã€å›æ˜¾æ•°æ®1.åˆ—è¡¨é¡µç¼–è¾‘æŒ‰é’®src/views/core/integral-grade/list.vueï¼Œè¡¨æ ¼â€œæ“ä½œâ€åˆ—ä¸­å¢åŠ â€œä¿®æ”¹â€æŒ‰é’® &lt;router-link :to=\"'/core/integral-grade/edit/' + scope.row.id\" style=\"margin-right:5px;\" &gt; &lt;el-button type=\"primary\" size=\"mini\" icon=\"el-icon-edit\"&gt; ä¿®æ”¹ &lt;/el-button&gt; &lt;/router-link&gt; 2.å®šä¹‰apisrc/api/core/integral-grade.js getById(id) { return request({ url: `/admin/core/integralGrade/get/${id}`, method: 'get' }) } 3.è·å–æ•°æ®è„šæœ¬src/views/core/integral-grade/form.vueï¼Œmethodsä¸­å®šä¹‰å›æ˜¾æ–¹æ³• // æ ¹æ®idæŸ¥è¯¢è®°å½• fetchDataById(id) { integralGradeApi.getById(id).then(response =&gt; { this.integralGrade = response.data.record }) } é¡µé¢æ¸²æŸ“æˆåŠŸåè·å–æ•°æ® å› ä¸ºå·²åœ¨è·¯ç”±ä¸­å®šä¹‰å¦‚ä¸‹å†…å®¹ï¼špath: â€˜edit/:idâ€™/ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ this.$route.params.id è·å–è·¯ç”±ä¸­çš„id //é¡µé¢æ¸²æŸ“æˆåŠŸ created() { if (this.$route.params.id) { this.fetchDataById(this.$route.params.id) } }, 4ã€æ›´æ–°æ•°æ®1.å®šä¹‰apisrc/api/core/integral-grade.js updateById(integralGrade) { return request({ url: '/admin/core/integralGrade/update', method: 'put', data: integralGrade }) } 2.æ›´æ–°æ•°æ®è„šæœ¬src/views/core/integral-grade/form.vueï¼Œmethodsä¸­å®šä¹‰updateData // æ ¹æ®idæ›´æ–°è®°å½• updateData() { // æ•°æ®çš„è·å– integralGradeApi.updateById(this.integralGrade).then(response =&gt; { this.$message({ type: 'success', message: response.message }) this.$router.push('/core/integral-grade/list') }) } å®Œå–„saveOrUpdateæ–¹æ³• saveOrUpdate() { // ç¦ç”¨ä¿å­˜æŒ‰é’® this.saveBtnDisabled = true if (!this.integralGrade.id) { this.saveData() } else { this.updateData() } }, å‚è€ƒåœ°å€ â†“1ã€Springboot å¯åŠ¨æ³¨è§£æ‰«æï¼šhttps://blog.csdn.net/m0_50932526/article/details/122936434 2ã€å¼‚å¸¸ï¼šorg.apache.ibatis.binding.BindingException: Invalid bound statement (not fou éœ€è¦æŒ‡å®šæ‰«æåŒ…è·¯å¾„ä¸ºå…·ä½“è·¯å¾„ï¼Œä¹‹å‰æ˜¯ @MapperScan({â€œcom.kk.srbâ€}),ç°åœ¨æ˜¯**@MapperScan({â€œcom.kk.srb.core.mapperâ€})** https://www.freesion.com/article/7476436940/ 3ã€vueé¡¹ç›® å‡ºç° Failed to compile. ç¼–è¯‘é”™è¯¯ï¼Œå¯èƒ½æ˜¯æŒ‡å®šçš„è·¯å¾„å’Œæ–‡ä»¶ä¸åŒ¹é… 4ã€ &lt; æ ‡ç­¾å¼€å¤´å¦‚æœä¸æ˜¯æˆå¯¹å­˜åœ¨ï¼Œéœ€ç”¨ \\ è½¬ä¹‰","categories":[{"name":"é¡¹ç›®-é‡‘è","slug":"é¡¹ç›®-é‡‘è","permalink":"https://mykkto.github.io/categories/%E9%A1%B9%E7%9B%AE-%E9%87%91%E8%9E%8D/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://mykkto.github.io/tags/nginx/"},{"name":"springboot","slug":"springboot","permalink":"https://mykkto.github.io/tags/springboot/"},{"name":"vue","slug":"vue","permalink":"https://mykkto.github.io/tags/vue/"}],"author":"mykk"},{"title":"JVM-01-å­—èŠ‚ç ","slug":"07-å†…åŠ›/03-jvm/01_jvm_Byte","date":"2022-04-16T13:00:12.000Z","updated":"2023-06-11T02:53:45.138Z","comments":true,"path":"posts/6ae84987.html","link":"","permalink":"https://mykkto.github.io/posts/6ae84987.html","excerpt":"","text":"ä¸€ã€JVMæ¦‚è¿°1ã€Javaçš„ç”Ÿæ€1ã€Oracle JDKä¸Open JDK å…³ç³»Oracleä¸OpenJDKä¹‹é—´çš„ä¸»è¦åŒºåˆ«ï¼š Oracle JDKç‰ˆæœ¬å°†æ¯ä¸‰å¹´å‘å¸ƒä¸€æ¬¡LTSç‰ˆæœ¬ï¼Œè€ŒOpenJDKç‰ˆæœ¬æ¯ä¸‰ä¸ªæœˆå‘å¸ƒä¸€æ¬¡ã€‚ Oracle JDKå°†æ›´å¤šåœ°å…³æ³¨ç¨³å®šæ€§ï¼Œå®ƒé‡è§†æ›´å¤šçš„ä¼ä¸šçº§ç”¨æˆ·ï¼Œè€ŒOpenJDKç»å¸¸å‘å¸ƒä»¥æ”¯æŒå…¶ä»–æ€§èƒ½ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸ç¨³å®šã€‚ Oracle JDKæ”¯æŒé•¿æœŸå‘å¸ƒçš„æ›´æ”¹ï¼Œè€ŒOpen JDKä»…æ”¯æŒè®¡åˆ’å’Œå®Œæˆä¸‹ä¸€ä¸ªå‘è¡Œç‰ˆã€‚ Oracle JDKæ ¹æ®äºŒè¿›åˆ¶ä»£ç è®¸å¯åè®®è·å¾—è®¸å¯ï¼Œè€ŒOpenJDKæ ¹æ®GPL v2è®¸å¯è·å¾—è®¸å¯ã€‚ ä½¿ç”¨Oracleå¹³å°æ—¶ä¼šäº§ç”Ÿä¸€äº›è®¸å¯å½±å“ã€‚å¦‚Oracle å®£å¸ƒçš„é‚£æ ·ï¼Œåœ¨æ²¡æœ‰å•†ä¸šè®¸å¯çš„æƒ…å†µä¸‹ï¼Œåœ¨2019å¹´1æœˆä¹‹åå‘å¸ƒçš„Oracle Java SE 8çš„å…¬å¼€æ›´æ–°å°†æ— æ³•ç”¨äºå•†ä¸šï¼Œå•†ä¸šæˆ–ç”Ÿäº§ç”¨é€”ã€‚ä½†æ˜¯ï¼ŒOpenJDKæ˜¯å®Œå…¨å¼€æºçš„ï¼Œå¯ä»¥è‡ªç”±ä½¿ç”¨ã€‚ Oracle JDKçš„æ„å»ºè¿‡ç¨‹åŸºäºOpenJDKï¼Œå› æ­¤OpenJDKä¸Oracle JDKä¹‹é—´æ²¡æœ‰æŠ€æœ¯å·®å¼‚ã€‚ é¡¶çº§å…¬å¸æ­£åœ¨ä½¿ç”¨Oracle JDKï¼Œä¾‹å¦‚Android Studioï¼ŒMinecraftå’ŒIntelliJ IDEAå¼€å‘å·¥å…·ï¼Œå…¶ä¸­Open JDKä¸å¤ªå—æ¬¢è¿ã€‚ Oracle JDKå…·æœ‰Flight Recorderï¼ŒJava Mission Controlå’ŒApplication Class-Data SharingåŠŸèƒ½ï¼ŒOpen JDKå…·æœ‰Font RendereråŠŸèƒ½ï¼Œè¿™æ˜¯OpenJDKä¸Oracle JDKä¹‹é—´çš„æ˜¾ç€å·®å¼‚ã€‚ Oracle JDKå…·æœ‰è‰¯å¥½çš„GCé€‰é¡¹å’Œæ›´å¥½çš„æ¸²æŸ“å™¨ï¼Œè€ŒOpenJDKå…·æœ‰æ›´å°‘çš„GCé€‰é¡¹ï¼Œå¹¶ä¸”ç”±äºå…¶åŒ…å«è‡ªå·±çš„æ¸²æŸ“å™¨çš„åˆ†å¸ƒï¼Œå› æ­¤å…·æœ‰è¾ƒæ…¢çš„å›¾å½¢æ¸²æŸ“å™¨é€‰é¡¹ã€‚ åœ¨å“åº”æ€§å’ŒJVMæ€§èƒ½æ–¹é¢ï¼ŒOracle JDKä¸OpenJDKç›¸æ¯”æä¾›äº†æ›´å¥½çš„æ€§èƒ½ã€‚ ä¸OpenJDKç›¸æ¯”ï¼ŒOracle JDKçš„å¼€æºç¤¾åŒºè¾ƒå°‘ï¼ŒOpenJDKç¤¾åŒºç”¨æˆ·çš„è¡¨ç°ä¼˜äºOracle JDKå‘å¸ƒçš„åŠŸèƒ½ï¼Œä»¥æé«˜æ€§èƒ½ã€‚ å¦‚æœä½¿ç”¨Oracle JDKä¼šäº§ç”Ÿè®¸å¯å½±å“ï¼Œè€ŒOpenJDKæ²¡æœ‰è¿™æ ·çš„é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ä»¥ä»»ä½•æ–¹å¼ä½¿ç”¨ï¼Œä»¥æ»¡è¶³å®Œå…¨å¼€æºå’Œå…è´¹ä½¿ç”¨ã€‚ Oracle JDKåœ¨è¿è¡ŒJDKæ—¶ä¸ä¼šäº§ç”Ÿä»»ä½•é—®é¢˜ï¼Œè€ŒOpenJDKåœ¨ä¸ºæŸäº›ç”¨æˆ·è¿è¡ŒJDKæ—¶ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ã€‚ æ ¹æ®ä½¿ç”¨æ–¹çš„ä½¿ç”¨å’Œè®¸å¯åè®®ï¼Œç°æœ‰åº”ç”¨ç¨‹åºå¯ä»¥ä»Oracle JDKè¿ç§»åˆ°Open JDKï¼Œåä¹‹äº¦ç„¶ã€‚ Oracle JDKå°†ä»å…¶10.0.Xç‰ˆæœ¬å°†æ”¶è´¹ï¼Œç”¨æˆ·å¿…é¡»ä»˜è´¹æˆ–å¿…é¡»ä¾èµ–OpenJDKæ‰èƒ½ä½¿ç”¨å…¶å…è´¹ç‰ˆæœ¬ã€‚ Oracle JDKä¸ä¼šä¸ºå³å°†å‘å¸ƒçš„ç‰ˆæœ¬æä¾›é•¿æœŸæ”¯æŒï¼Œç”¨æˆ·æ¯æ¬¡éƒ½å¿…é¡»é€šè¿‡æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬è·å¾—æ”¯æŒæ¥è·å–æœ€æ–°ç‰ˆæœ¬ã€‚ Oracle JDKä»¥å‰çš„1.0ç‰ˆä»¥å‰çš„ç‰ˆæœ¬æ˜¯ç”±Sunå¼€å‘çš„ï¼Œåæ¥è¢«Oracleæ”¶è´­å¹¶ä¸ºå…¶ä»–ç‰ˆæœ¬ç»´æŠ¤ï¼Œè€ŒOpenJDKæœ€åˆåªåŸºäºJava SDKæˆ–JDKç‰ˆæœ¬7ã€‚ Oracle JDKå‘å¸ƒæ—¶å¤§å¤šæ•°åŠŸèƒ½éƒ½æ˜¯å¼€æºçš„ï¼Œå…¶ä¸­ä¸€äº›åŠŸèƒ½å…äºå¼€æºï¼Œå¹¶ä¸”æ ¹æ®Sunçš„è®¸å¯æˆæƒï¼Œè€ŒOpenJDKå‘å¸ƒäº†æ‰€æœ‰åŠŸèƒ½ï¼Œå¦‚å¼€æºå’Œå…è´¹ã€‚ Oracle JDKå®Œå…¨ç”±Oracleå…¬å¸å¼€å‘ï¼Œè€ŒOpen JDKé¡¹ç›®ç”±IBMï¼ŒAppleï¼ŒSAP AGï¼ŒRedhatç­‰é¡¶çº§å…¬å¸åŠ å…¥å’Œåˆä½œã€‚ 2ã€JDKä¸JVMæ˜¯ä»€ä¹ˆå…³ç³» 1ã€å¦‚ä½•ç†è§£Javaæ˜¯è·¨å¹³å°çš„è¯­è¨€ å½“Javaæºä»£ç æˆåŠŸç¼–è¯‘æˆå­—èŠ‚ç åï¼Œå¦‚æœæƒ³åœ¨ä¸åŒçš„å¹³å°ä¸Šé¢è¿è¡Œï¼Œåˆ™æ— é¡»å†æ¬¡ç¼–è¯‘è¿™ä¸ªä¼˜åŠ¿ä¸å†é‚£ä¹ˆå¸å¼•äººäº†ã€‚Pythonã€PHPã€Perlã€Rubyã€Lispç­‰æœ‰å¼ºå¤§çš„è§£é‡Šå™¨ã€‚è·¨å¹³å°ä¼¼ä¹å·²ç»å¿«æˆä¸ºä¸€é—¨è¯­è¨€å¿…é€‰çš„ç‰¹æ€§ã€‚ 2ã€å¦‚ä½•ç†è§£JVMè·¨è¯­è¨€çš„å¹³å° Javaè™šæ‹Ÿæœºæ ¹æœ¬ä¸å…³å¿ƒè¿è¡Œåœ¨å…¶å†…éƒ¨çš„ç¨‹åºåˆ°åº•æ˜¯ä½¿ç”¨ä½•ç§ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ï¼Œå®ƒåªå…³å¿ƒâ€œå­—èŠ‚ç â€æ–‡ä»¶ã€‚ Javaä¸æ˜¯æœ€å¼ºå¤§çš„è¯­è¨€ï¼Œä½†æ˜¯JVMæ˜¯æœ€å¼ºå¤§çš„è™šæ‹Ÿæœºã€‚ 3ã€Javaå‘å±•çš„å‡ ä¸ªé‡å¤§äº‹ä»¶2000å¹´ï¼ŒJDK 1.3å‘å¸ƒï¼ŒJava HotSpot Virtual Machineæ­£å¼å‘å¸ƒï¼Œæˆä¸ºJavaçš„é»˜è®¤è™šæ‹Ÿæœºã€‚2002å¹´ï¼ŒJDK 1.4å‘å¸ƒï¼Œå¤è€çš„Classicè™šæ‹Ÿæœºé€€å‡ºå†å²èˆå°ã€‚2003å¹´å¹´åº•ï¼ŒJavaå¹³å°çš„Scalaæ­£å¼å‘å¸ƒï¼ŒåŒå¹´Groovyä¹ŸåŠ å…¥äº† Javaé˜µè¥ã€‚2006å¹´ï¼ŒJDK 6å‘å¸ƒã€‚åŒå¹´ï¼ŒJavaå¼€æºå¹¶å»ºç«‹äº† OpenJDKã€‚é¡ºç†æˆç« ï¼ŒHotspotè™šæ‹Ÿæœºä¹Ÿæˆä¸ºäº† OpenJDKä¸­çš„é»˜è®¤è™šæ‹Ÿæœºã€‚2007å¹´ï¼ŒJavaå¹³å°è¿æ¥äº†æ–°ä¼™ä¼´Clojureã€‚2008 å¹´ï¼ŒOracle æ”¶è´­äº† BEA,å¾—åˆ°äº† JRockit è™šæ‹Ÿæœºã€‚2009å¹´ï¼ŒTwitterå®£å¸ƒæŠŠåå°å¤§éƒ¨åˆ†ç¨‹åºä»Rubyè¿ç§»åˆ°Scalaï¼Œè¿™æ˜¯Javaå¹³å°çš„åˆä¸€æ¬¡å¤§è§„æ¨¡åº”ç”¨ã€‚2010å¹´ï¼ŒOracleæ”¶è´­äº†Sunï¼Œè·å¾—Javaå•†æ ‡å’Œæœ€å…·ä»·å€¼çš„HotSpotè™šæ‹Ÿæœºã€‚æ­¤æ—¶ï¼ŒOracleæ‹¥æœ‰å¸‚åœºå ç”¨ç‡æœ€é«˜çš„ä¸¤æ¬¾è™šæ‹ŸæœºHotSpotå’ŒJRockitï¼Œå¹¶è®¡åˆ’åœ¨æœªæ¥å¯¹å®ƒä»¬è¿›è¡Œæ•´åˆï¼šHotRockit. JCPç»„ç»‡ç®¡ç†ï¼šJavaè¯­è¨€2011å¹´ï¼ŒJDK7å‘å¸ƒã€‚åœ¨JDK 1.7u4ä¸­ï¼Œæ­£å¼å¯ç”¨äº†æ–°çš„åƒåœ¾å›æ”¶å™¨G1ã€‚2017å¹´ï¼ŒJDK9å‘å¸ƒã€‚å°†G1è®¾ç½®ä¸ºé»˜è®¤GCï¼Œæ›¿ä»£CMS (è¢«æ ‡è®°ä¸ºDeprecated)åŒå¹´ï¼ŒIBMçš„J9å¼€æºï¼Œå½¢æˆäº†ç°åœ¨çš„Open J9ç¤¾åŒº2018å¹´ï¼ŒAndroidçš„Javaä¾µæƒæ¡ˆåˆ¤å†³ï¼ŒGoogleèµ”å¿Oracleè®¡88äº¿ç¾å…ƒåŒå¹´ï¼ŒJDK11å‘å¸ƒï¼ŒLTSç‰ˆæœ¬çš„JDK,å‘å¸ƒé©å‘½æ€§çš„ZGC,è°ƒæ•´JDKæˆæƒè®¸å¯2019å¹´ï¼ŒJDK12å‘å¸ƒï¼ŒåŠ å…¥RedHaté¢†å¯¼å¼€å‘çš„Shenandoah GC 2ã€JVMçš„æ¶æ„1ã€JVMæ¶æ„å›¾ è¿™ä¸ªæ¶æ„å¯ä»¥åˆ†æˆä¸‰å±‚çœ‹ï¼š æœ€ä¸Šå±‚ï¼šjavacç¼–è¯‘å™¨å°†ç¼–è¯‘å¥½çš„å­—èŠ‚ç classæ–‡ä»¶ï¼Œé€šè¿‡java ç±»è£…è½½å™¨æ‰§è¡Œæœºåˆ¶ï¼ŒæŠŠå¯¹è±¡æˆ–classæ–‡ä»¶å­˜æ”¾åœ¨ jvmåˆ’åˆ†å†…å­˜åŒºåŸŸã€‚ä¸­é—´å±‚ï¼šç§°ä¸ºRuntime Data Areaï¼Œä¸»è¦æ˜¯åœ¨Javaä»£ç è¿è¡Œæ—¶ç”¨äºå­˜æ”¾æ•°æ®çš„ï¼Œä»å·¦è‡³å³ä¸ºæ–¹æ³•åŒº(æ°¸ä¹…ä»£ã€å…ƒæ•°æ®åŒº)ã€å †(å…±äº«,GCå›æ”¶å¯¹è±¡åŒºåŸŸ)ã€æ ˆã€ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨ã€æœ¬åœ°æ–¹æ³•æ ˆ(ç§æœ‰)ã€‚æœ€ä¸‹å±‚ï¼šè§£é‡Šå™¨ã€JIT(just in time)ç¼–è¯‘å™¨å’Œ GCï¼ˆGarbage Collectionï¼Œåƒåœ¾å›æ”¶å™¨ï¼‰ 2ã€JVMè„‰ç»œ äºŒã€å­—èŠ‚ç æ–‡ä»¶æ¦‚è¿°1ã€å­—èŠ‚ç æ–‡ä»¶è·¨å¹³å°Classæ–‡ä»¶ç»“æ„ä¸ä»…ä»…æ˜¯Javaè™šæ‹Ÿæœºçš„æ‰§è¡Œå…¥å£ï¼Œæ›´æ˜¯Javaç”Ÿæ€åœˆçš„åŸºç¡€å’Œæ ¸å¿ƒã€‚ 1ã€classæ–‡ä»¶é‡Œæ˜¯ä»€ä¹ˆå­—èŠ‚ç æ–‡ä»¶é‡Œæ˜¯ä»€ä¹ˆï¼Ÿ æºä»£ç ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘ä¹‹åä¾¿ä¼šç”Ÿæˆä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶ï¼Œå­—èŠ‚ç æ˜¯ä¸€ç§äºŒè¿›åˆ¶çš„ç±»æ–‡ä»¶ï¼Œå®ƒçš„å†…å®¹æ˜¯JVMçš„æŒ‡ä»¤ï¼Œè€Œä¸åƒCã€C++ç»ç”±ç¼–è¯‘å™¨ç›´æ¥ç”Ÿæˆæœºå™¨ç ã€‚ éšç€Javaå¹³å°çš„ä¸æ–­å‘å±•ï¼Œåœ¨å°†æ¥ï¼ŒClassæ–‡ä»¶çš„å†…å®¹ä¹Ÿä¸€å®šä¼šåšè¿›ä¸€æ­¥çš„æ‰©å……ï¼Œä½†æ˜¯å…¶åŸºæœ¬çš„æ ¼å¼å’Œç»“æ„ä¸ä¼šåšé‡å¤§è°ƒæ•´ã€‚ 2ã€â˜† classæ–‡ä»¶çš„ç¼–è¯‘å™¨1ã€ä»ä½ç½®ä¸Šç†è§£ 2ã€å‰ç«¯ç¼–è¯‘å™¨çš„ç§ç±»Javaæºä»£ç çš„ç¼–è¯‘ç»“æœæ˜¯å­—èŠ‚ç ï¼Œé‚£ä¹ˆè‚¯å®šéœ€è¦æœ‰ä¸€ç§ç¼–è¯‘å™¨èƒ½å¤Ÿå°†Javaæºç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œæ‰¿æ‹…è¿™ä¸ªé‡è¦è´£ä»»çš„å°±æ˜¯é…ç½®åœ¨pathç¯å¢ƒå˜é‡ä¸­çš„javacç¼–è¯‘å™¨ã€‚javacæ˜¯ä¸€ç§èƒ½å¤Ÿå°†Javaæºç ç¼–è¯‘ä¸ºå­—èŠ‚ç çš„å‰ç«¯ç¼–è¯‘å™¨ã€‚ HotSpot VMå¹¶æ²¡æœ‰å¼ºåˆ¶è¦æ±‚å‰ç«¯ç¼–è¯‘å™¨åªèƒ½ä½¿ç”¨javacæ¥ç¼–è¯‘å­—èŠ‚ç ï¼Œå…¶å®åªè¦ç¼–è¯‘ç»“æœç¬¦åˆJVMè§„èŒƒéƒ½å¯ä»¥è¢«JVMæ‰€è¯†åˆ«å³å¯ã€‚åœ¨Javaçš„å‰ç«¯ç¼–è¯‘å™¨é¢†åŸŸï¼Œé™¤äº†javacä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§è¢«å¤§å®¶ç»å¸¸ç”¨åˆ°çš„å‰ç«¯ç¼–è¯‘å™¨ï¼Œé‚£å°±æ˜¯å†…ç½®åœ¨Eclipseä¸­çš„ECJ (Eclipse Compiler for Java)ç¼–è¯‘å™¨ã€‚å’ŒJavacçš„å…¨é‡å¼ç¼–è¯‘ä¸åŒï¼ŒECJæ˜¯ä¸€ç§å¢é‡å¼ç¼–è¯‘å™¨ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒIntelliJ IDEA ä½¿ç”¨ javac ç¼–è¯‘å™¨ã€‚(è¿˜å¯ä»¥è‡ªå·±è®¾ç½®ä¸ºAspectJç¼–è¯‘å™¨ ajc) 3ã€å‰ç«¯ç¼–è¯‘å™¨çš„ä»»åŠ¡å‰ç«¯ç¼–è¯‘å™¨çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯è´Ÿè´£å°†ç¬¦åˆJavaè¯­æ³•è§„èŒƒçš„Javaä»£ç è½¬æ¢ä¸ºç¬¦åˆJVMè§„èŒƒçš„å­—èŠ‚ç æ–‡ä»¶ã€‚ 3ã€å‰ç«¯ç¼–è¯‘å™¨çš„å±€é™æ€§å‰ç«¯ç¼–è¯‘å™¨å¹¶ä¸ä¼šç›´æ¥æ¶‰åŠç¼–è¯‘ä¼˜åŒ–ç­‰æ–¹é¢çš„æŠ€æœ¯ï¼Œè€Œæ˜¯å°†è¿™äº›å…·ä½“ä¼˜åŒ–ç»†èŠ‚ç§»äº¤ç»™HotSpotçš„JITç¼–è¯‘å™¨è´Ÿè´£ã€‚ å¤ä¹ ï¼šAOT(é™æ€æå‰ç¼–è¯‘å™¨ï¼ŒAhead Of Time Compiler) jdk9å¼•å…¥äº†AOTç¼–è¯‘å™¨(é™æ€æå‰ç¼–è¯‘å™¨ï¼ŒAhead Of Time Compiler) Java 9 å¼•å…¥äº†å®éªŒæ€§ AOT ç¼–è¯‘å·¥å…·jaotcã€‚å®ƒå€ŸåŠ©äº† Graal ç¼–è¯‘å™¨ï¼Œå°†æ‰€è¾“å…¥çš„ Java ç±»æ–‡ä»¶è½¬æ¢ä¸ºæœºå™¨ç ï¼Œå¹¶å­˜æ”¾è‡³ç”Ÿæˆçš„åŠ¨æ€å…±äº«åº“ä¹‹ä¸­ã€‚ æ‰€è°“ AOT ç¼–è¯‘ï¼Œæ˜¯ä¸å³æ—¶ç¼–è¯‘ç›¸å¯¹ç«‹çš„ä¸€ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå³æ—¶ç¼–è¯‘æŒ‡çš„æ˜¯åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†å­—èŠ‚ç è½¬æ¢ä¸ºå¯åœ¨ç¡¬ä»¶ä¸Šç›´æ¥è¿è¡Œçš„æœºå™¨ç ï¼Œå¹¶éƒ¨ç½²è‡³æ‰˜ç®¡ç¯å¢ƒä¸­çš„è¿‡ç¨‹ã€‚è€Œ AOT ç¼–è¯‘æŒ‡çš„åˆ™æ˜¯ï¼Œåœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œä¾¿å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç çš„è¿‡ç¨‹ã€‚.java -&gt; .class -&gt; .so æœ€å¤§å¥½å¤„ï¼šJavaè™šæ‹ŸæœºåŠ è½½å·²ç»é¢„ç¼–è¯‘æˆäºŒè¿›åˆ¶åº“ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œã€‚ä¸å¿…ç­‰å¾…å³æ—¶ç¼–è¯‘å™¨çš„é¢„çƒ­ï¼Œå‡å°‘Javaåº”ç”¨ç»™äººå¸¦æ¥â€œç¬¬ä¸€æ¬¡è¿è¡Œæ…¢â€çš„ä¸è‰¯ä½“éªŒã€‚ ç¼ºç‚¹ï¼šç ´åäº†javaâ€œä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œâ€ï¼Œå¿…é¡»ä¸ºæ¯ä¸ªä¸åŒç¡¬ä»¶ã€OSç¼–è¯‘å¯¹åº”çš„å‘è¡ŒåŒ…ã€‚é™ä½äº†Javaé“¾æ¥è¿‡ç¨‹çš„åŠ¨æ€æ€§ï¼ŒåŠ è½½çš„ä»£ç åœ¨ç¼–è¯‘æœŸå°±å¿…é¡»å…¨éƒ¨å·²çŸ¥ã€‚ è¿˜éœ€è¦ç»§ç»­ä¼˜åŒ–ä¸­ï¼Œæœ€åˆåªæ”¯æŒLinux x64 java base 2ã€Classå¯¹è±¡å¯¹åº”ç±»å‹ ï¼ˆ1ï¼‰classï¼šå¤–éƒ¨ç±»ï¼Œæˆå‘˜(æˆå‘˜å†…éƒ¨ç±»ï¼Œé™æ€å†…éƒ¨ç±»)ï¼Œå±€éƒ¨å†…éƒ¨ç±»ï¼ŒåŒ¿åå†…éƒ¨ç±»ï¼ˆ2ï¼‰interfaceï¼šæ¥å£ï¼ˆ3ï¼‰[]ï¼šæ•°ç»„ï¼ˆ4ï¼‰enumï¼šæšä¸¾ï¼ˆ5ï¼‰annotationï¼šæ³¨è§£@interfaceï¼ˆ6ï¼‰primitive typeï¼šåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆ7ï¼‰void @Test public void test(){ Class c1 = Object.class; Class c2 = Comparable.class; Class c3 = String[].class; Class c4 = int[][].class; Class c5 = ElementType.class; Class c6 = Override.class; Class c7 = int.class; Class c8 = void.class; Class c9 = Class.class; int[] a = new int[10]; int[] b = new int[100]; Class c10 = a.getClass(); Class c11 = b.getClass(); // åªè¦å…ƒç´ ç±»å‹ä¸ç»´åº¦ä¸€æ ·ï¼Œå°±æ˜¯åŒä¸€ä¸ªClass System.out.println(c10 == c11); } 3ã€å­—èŠ‚ç æŒ‡ä»¤1ã€ä»€ä¹ˆæ˜¯å­—èŠ‚ç æŒ‡ä»¤Javaè™šæ‹Ÿæœºçš„æŒ‡ä»¤ç”±ä¸€ä¸ªå­—èŠ‚é•¿åº¦çš„ã€ä»£è¡¨ç€æŸç§ç‰¹å®šæ“ä½œå«ä¹‰çš„æ“ä½œç ï¼ˆopcodeï¼‰ä»¥åŠè·Ÿéšå…¶åçš„é›¶è‡³å¤šä¸ªä»£è¡¨æ­¤æ“ä½œæ‰€éœ€å‚æ•°çš„æ“ä½œæ•°ï¼ˆoperandï¼‰æ‰€æ„æˆã€‚è™šæ‹Ÿæœºä¸­è®¸å¤šæŒ‡ä»¤å¹¶ä¸åŒ…å«æ“ä½œæ•°ï¼Œåªæœ‰ä¸€ä¸ªæ“ä½œç ã€‚ 2ã€â˜† é¢è¯•é¢˜i++å’Œ++iæœ‰ä»€ä¹ˆåŒºåˆ« public class ByteCodeInterview { //é¢è¯•é¢˜ï¼š i++å’Œ++iæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ @Test public void test1(){ int i = 10; i++; //++i; System.out.println(i); } @Test public void test2(){ int i = 10; i = i++; System.out.println(i); } @Test public void test3(){ int i = 2; i *= i++; System.out.println(i); } @Test public void test4(){ int k = 10; k = k + (k++) + (++k); System.out.println(k); } //åŒ…è£…ç±»å¯¹è±¡çš„ç¼“å­˜é—®é¢˜ @Test public void test5(){ // Integer x = 5; // int y = 5; Integer i1 = 10; Integer i2 = 10; System.out.println(i1 == i2); Integer i3 = 128; Integer i4 = 128; System.out.println(i3 == i4); Boolean b1 = true; Boolean b2 = true; System.out.println(b1 == b2); } @Test public void test6(){ String str = new String(\"hello\") + new String(\"world\"); String str1 = \"helloworld\"; System.out.println(str == str1); } } class Father { int x = 10; public Father() { this.print(); x = 20; } public void print() { System.out.println(\"Father.x = \" + x); } } class Son extends Father { int x = 30; public Son() { this.print(); x = 40; } public void print() { System.out.println(\"Son.x = \" + x); } } public class SonTest { public static void main(String[] args) { Father f = new Son(); System.out.println(f.x); } } 4ã€å¦‚ä½•è§£è¯»classæ–‡ä»¶æ–¹å¼ä¸€ï¼šä¸€ä¸ªä¸€ä¸ªäºŒè¿›åˆ¶çš„çœ‹ã€‚è¿™é‡Œç”¨åˆ°çš„æ˜¯Notepad++,éœ€è¦å®‰è£…ä¸€ä¸ªHEX-Editoræ’ä»¶ï¼Œæˆ–è€…ä½¿ç”¨Binary Viewer æ–¹å¼äºŒï¼šä½¿ç”¨javapæŒ‡ä»¤ï¼šjdkè‡ªå¸¦çš„åè§£æå·¥å…·æ–¹å¼ä¸‰ï¼šä½¿ç”¨IDEAæ’ä»¶ï¼šjclasslib æˆ–jclasslib bytecode viewerå®¢æˆ·ç«¯å·¥å…·ã€‚ï¼ˆå¯è§†åŒ–æ›´å¥½ï¼‰ ä¸‰ã€Classæ–‡ä»¶ç»“æ„ç»†èŠ‚1ã€æ¦‚è¿°1ã€classæ–‡ä»¶ç»“æ„æ¦‚è¿°Classæ–‡ä»¶çš„ç»“æ„å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œéšç€Javaè™šæ‹Ÿæœºçš„ä¸æ–­å‘å±•ï¼Œæ€»æ˜¯ä¸å¯é¿å…åœ°ä¼šå¯¹Classæ–‡ä»¶ç»“æ„åšå‡ºä¸€äº›è°ƒæ•´ï¼Œä½†æ˜¯å…¶åŸºæœ¬ç»“æ„å’Œæ¡†æ¶æ˜¯éå¸¸ç¨³å®šçš„ã€‚Classæ–‡ä»¶çš„æ€»ä½“ç»“æ„å¦‚ä¸‹ï¼š é­”æ•° Classæ–‡ä»¶ç‰ˆæœ¬ å¸¸é‡æ±  è®¿é—®æ ‡è¯†(æˆ–æ ‡å¿—) ç±»ç´¢å¼•ï¼Œçˆ¶ç±»ç´¢å¼•ï¼Œæ¥å£ç´¢å¼•é›†åˆ å­—æ®µè¡¨é›†åˆ æ–¹æ³•è¡¨é›†åˆ å±æ€§è¡¨é›†åˆ 2ã€ç»“æ„å›¾è¡¨ è¿™æ˜¯ä¸€å¼ Javaå­—èŠ‚ç æ€»çš„ç»“æ„è¡¨ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸Šé¢çš„é¡ºåºé€ä¸€è¿›è¡Œè§£è¯»å°±å¯ä»¥äº†ã€‚ 2ã€é­”æ•°Magic Numberï¼ˆé­”æ•°ï¼‰ï¼šclassæ–‡ä»¶çš„æ ‡å¿— æ¯ä¸ª Class æ–‡ä»¶å¼€å¤´çš„4ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•´æ•°ç§°ä¸ºé­”æ•°ï¼ˆMagic Numberï¼‰ å®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥å—çš„æœ‰æ•ˆåˆæ³•çš„Classæ–‡ä»¶ã€‚å³ï¼šé­”æ•°æ˜¯Classæ–‡ä»¶çš„æ ‡è¯†ç¬¦ã€‚ é­”æ•°å€¼å›ºå®šä¸º0xCAFEBABEã€‚ä¸ä¼šæ”¹å˜ã€‚ å¦‚æœä¸€ä¸ªClassæ–‡ä»¶ä¸ä»¥0xCAFEBABEå¼€å¤´ï¼Œè™šæ‹Ÿæœºåœ¨è¿›è¡Œæ–‡ä»¶æ ¡éªŒçš„æ—¶å€™å°±ä¼šç›´æ¥æŠ›å‡ºä»¥ä¸‹é”™è¯¯ï¼š Error: A JNI error has occurred, please check your installation and try againException in thread â€œmainâ€ java.lang.ClassFormatError: Incompatible magic value 1885430635 in class file StringTest ä½¿ç”¨é­”æ•°è€Œä¸æ˜¯æ‰©å±•åæ¥è¿›è¡Œè¯†åˆ«ä¸»è¦æ˜¯åŸºäºå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼Œå› ä¸ºæ–‡ä»¶æ‰©å±•åå¯ä»¥éšæ„åœ°æ”¹åŠ¨ã€‚ 3ã€é«˜ç‰ˆæœ¬æ‰§è¡Œä½ç‰ˆæœ¬Classä¸åŒç‰ˆæœ¬çš„Javaç¼–è¯‘å™¨ç¼–è¯‘çš„Classæ–‡ä»¶å¯¹åº”çš„ç‰ˆæœ¬æ˜¯ä¸ä¸€æ ·çš„ã€‚ç›®å‰ï¼Œé«˜ç‰ˆæœ¬çš„Javaè™šæ‹Ÿæœºå¯ä»¥æ‰§è¡Œç”±ä½ç‰ˆæœ¬ç¼–è¯‘å™¨ç”Ÿæˆçš„Classæ–‡ä»¶,ä½†æ˜¯ä½ç‰ˆæœ¬çš„Javaè™šæ‹Ÿæœºä¸èƒ½æ‰§è¡Œç”±é«˜ç‰ˆæœ¬ç¼–è¯‘å™¨ç”Ÿæˆçš„Classæ–‡ä»¶ã€‚å¦åˆ™JVMä¼šæŠ›å‡ºjava.lang.UnsupportedClassVersionErrorå¼‚å¸¸ã€‚ ï¼ˆå‘ä¸‹å…¼å®¹ï¼‰ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”±äºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ä¸åŒï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯¥é—®é¢˜çš„å‘ç”Ÿã€‚å› æ­¤ï¼Œéœ€è¦æˆ‘ä»¬åœ¨å¼€å‘æ—¶ï¼Œç‰¹åˆ«æ³¨æ„å¼€å‘ç¼–è¯‘çš„JDKç‰ˆæœ¬å’Œç”Ÿäº§ç¯å¢ƒä¸­çš„JDKç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ã€‚ classæ–‡ä»¶ç‰ˆæœ¬å· ç´§æ¥ç€é­”æ•°çš„ 4 ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯ Class æ–‡ä»¶çš„ç‰ˆæœ¬å·ã€‚åŒæ ·ä¹Ÿæ˜¯4ä¸ªå­—èŠ‚ã€‚ç¬¬5ä¸ªå’Œç¬¬6ä¸ªå­—èŠ‚æ‰€ä»£è¡¨çš„å«ä¹‰å°±æ˜¯ç¼–è¯‘çš„å‰¯ç‰ˆæœ¬å·minor_versionï¼Œè€Œç¬¬7ä¸ªå’Œç¬¬8ä¸ªå­—èŠ‚å°±æ˜¯ç¼–è¯‘çš„ä¸»ç‰ˆæœ¬å·major_versionã€‚ å®ƒä»¬å…±åŒæ„æˆäº†classæ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬å·ã€‚è­¬å¦‚æŸä¸ª Class æ–‡ä»¶çš„ä¸»ç‰ˆæœ¬å·ä¸º Mï¼Œå‰¯ç‰ˆæœ¬å·ä¸º mï¼Œé‚£ä¹ˆè¿™ä¸ªClass æ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬å·å°±ç¡®å®šä¸º M.mã€‚ ç‰ˆæœ¬å·å’ŒJavaç¼–è¯‘å™¨çš„å¯¹åº”å…³ç³»å¦‚ä¸‹è¡¨ï¼š Java çš„ç‰ˆæœ¬å·æ˜¯ä»45å¼€å§‹çš„ï¼ŒJDK 1.1ä¹‹åçš„æ¯ä¸ªJDKå¤§ç‰ˆæœ¬å‘å¸ƒä¸»ç‰ˆæœ¬å·å‘ä¸ŠåŠ 1ã€‚ è™šæ‹ŸæœºJDKç‰ˆæœ¬ä¸º1.k ï¼ˆk &gt;= 2ï¼‰æ—¶ï¼Œå¯¹åº”çš„classæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬å·çš„èŒƒå›´ä¸º45.0 - 44+k.0 ï¼ˆå«ä¸¤ç«¯ï¼‰ã€‚ 4ã€â˜† å¸¸é‡æ± å¸¸é‡æ± ï¼šclassæ–‡ä»¶çš„åŸºçŸ³ï¼Ÿä½œç”¨æ˜¯ï¼Ÿ 1ã€ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± è®¡æ•°å™¨constant_pool_count ï¼ˆå¸¸é‡æ± è®¡æ•°å™¨ï¼‰ ç”±äºå¸¸é‡æ± çš„æ•°é‡ä¸å›ºå®šï¼Œæ—¶é•¿æ—¶çŸ­ï¼Œæ‰€ä»¥éœ€è¦æ”¾ç½®ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ã€‚ å¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ï¼ˆu2ç±»å‹ï¼‰ï¼šä»1å¼€å§‹ï¼Œè¡¨ç¤ºå¸¸é‡æ± ä¸­æœ‰å¤šå°‘é¡¹å¸¸é‡ã€‚å³constant_pool_count=1è¡¨ç¤ºå¸¸é‡æ± ä¸­æœ‰0ä¸ªå¸¸é‡é¡¹ã€‚ Demoçš„å€¼ä¸ºï¼š å…¶å€¼ä¸º0x0016,ææŒ‡ä¸€ç®—ï¼Œä¹Ÿå°±æ˜¯22ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å®é™…ä¸Šåªæœ‰21é¡¹å¸¸é‡ã€‚ç´¢å¼•ä¸ºèŒƒå›´æ˜¯1-21ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿé€šå¸¸æˆ‘ä»¬å†™ä»£ç æ—¶éƒ½æ˜¯ä»0å¼€å§‹çš„ï¼Œä½†æ˜¯è¿™é‡Œçš„å¸¸é‡æ± å´æ˜¯ä»1å¼€å§‹ï¼Œå› ä¸ºå®ƒæŠŠç¬¬0é¡¹å¸¸é‡ç©ºå‡ºæ¥äº†ã€‚è¿™æ˜¯ä¸ºäº†æ»¡è¶³åé¢æŸäº›æŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•å€¼çš„æ•°æ®åœ¨ç‰¹å®šæƒ…å†µä¸‹éœ€è¦è¡¨è¾¾â€œä¸å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡æ± é¡¹ç›®â€çš„å«ä¹‰ï¼Œè¿™ç§æƒ…å†µå¯ç”¨ç´¢å¼•å€¼0æ¥è¡¨ç¤ºã€‚ int[] arr = new int[10]; arr[0]; arr[1]; ar[10 - 1]; #### 2ã€å¸¸é‡æ± è¡¨ **constant_pool []ï¼ˆå¸¸é‡æ± ï¼‰** - constant_poolæ˜¯ä¸€ç§è¡¨ç»“æ„ï¼Œä»¥ 1 ~ constant_pool_count - 1ä¸ºç´¢å¼•ã€‚è¡¨æ˜äº†åé¢æœ‰å¤šå°‘ä¸ªå¸¸é‡é¡¹ã€‚ - å¸¸é‡æ± ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼š`å­—é¢é‡ï¼ˆLiteralï¼‰`å’Œ`ç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰` - å®ƒåŒ…å«äº†classæ–‡ä»¶ç»“æ„åŠå…¶å­ç»“æ„ä¸­å¼•ç”¨çš„æ‰€æœ‰å­—ç¬¦ä¸²å¸¸é‡ã€ç±»æˆ–æ¥å£åã€å­—æ®µåå’Œå…¶ä»–å¸¸é‡ã€‚å¸¸é‡æ± ä¸­çš„æ¯ä¸€é¡¹éƒ½å…·å¤‡ç›¸åŒçš„ç‰¹å¾ã€‚ç¬¬1ä¸ªå­—èŠ‚ä½œä¸ºç±»å‹æ ‡è®°ï¼Œç”¨äºç¡®å®šè¯¥é¡¹çš„æ ¼å¼ï¼Œè¿™ä¸ªå­—èŠ‚ç§°ä¸ºtag byte ï¼ˆæ ‡è®°å­—èŠ‚ã€æ ‡ç­¾å­—èŠ‚ï¼‰ã€‚ ![](https://mykkto.cn/image/blog/2022/jvm/20220417163310.png) ##### 1ã€å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ 1ã€å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ åœ¨å¯¹è¿™äº›å¸¸é‡è§£è¯»å‰ï¼Œæˆ‘ä»¬éœ€è¦ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µã€‚ å¸¸é‡æ± ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰ã€‚å¦‚ä¸‹è¡¨ï¼š ![](https://mykkto.cn/image/blog/2022/jvm/20220417164111.png) ```java String str = \"mykk\"; final int NUM = 10; 2ã€å…¨é™å®šåcom/kk/test/Demoè¿™ä¸ªå°±æ˜¯ç±»çš„å…¨é™å®šåï¼Œä»…ä»…æ˜¯æŠŠåŒ…åçš„â€.â€æ›¿æ¢æˆâ€/â€œï¼Œä¸ºäº†ä½¿è¿ç»­çš„å¤šä¸ªå…¨é™å®šåä¹‹é—´ä¸äº§ç”Ÿæ··æ·†ï¼Œåœ¨ä½¿ç”¨æ—¶æœ€åä¸€èˆ¬ä¼šåŠ å…¥ä¸€ä¸ªâ€œ;â€è¡¨ç¤ºå…¨é™å®šåç»“æŸã€‚ 3ã€ç®€å•åç§°ç®€å•åç§°æ˜¯æŒ‡æ²¡æœ‰ç±»å‹å’Œå‚æ•°ä¿®é¥°çš„æ–¹æ³•æˆ–è€…å­—æ®µåç§°ï¼Œä¸Šé¢ä¾‹å­ä¸­çš„ç±»çš„add()æ–¹æ³•å’Œnumå­—æ®µçš„ç®€å•åç§°åˆ†åˆ«æ˜¯addå’Œnumã€‚ 4ã€æè¿°ç¬¦æè¿°ç¬¦çš„ä½œç”¨æ˜¯ç”¨æ¥æè¿°å­—æ®µçš„æ•°æ®ç±»å‹ã€æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼ˆåŒ…æ‹¬æ•°é‡ã€ç±»å‹ä»¥åŠé¡ºåºï¼‰å’Œè¿”å›å€¼ã€‚æ ¹æ®æè¿°ç¬¦è§„åˆ™ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbyteã€charã€doubleã€floatã€intã€longã€shortã€booleanï¼‰ä»¥åŠä»£è¡¨æ— è¿”å›å€¼çš„voidç±»å‹éƒ½ç”¨ä¸€ä¸ªå¤§å†™å­—ç¬¦æ¥è¡¨ç¤ºï¼Œè€Œå¯¹è±¡ç±»å‹åˆ™ç”¨å­—ç¬¦LåŠ å¯¹è±¡çš„å…¨é™å®šåæ¥è¡¨ç¤ºï¼Œè¯¦è§ä¸‹è¡¨: ï¼ˆæ•°æ®ç±»å‹ï¼šåŸºæœ¬æ•°æ®ç±»å‹ ã€ å¼•ç”¨æ•°æ®ç±»å‹ï¼‰ ç”¨æè¿°ç¬¦æ¥æè¿°æ–¹æ³•æ—¶ï¼ŒæŒ‰ç…§å…ˆå‚æ•°åˆ—è¡¨ï¼Œåè¿”å›å€¼çš„é¡ºåºæè¿°ï¼Œå‚æ•°åˆ—è¡¨æŒ‰ç…§å‚æ•°çš„ä¸¥æ ¼é¡ºåºæ”¾åœ¨ä¸€ç»„å°æ‹¬å·â€œ()â€ä¹‹å†…ã€‚å¦‚ï¼šæ–¹æ³•java.lang.String toString()çš„æè¿°ç¬¦ä¸º() Ljava/lang/String;ï¼Œæ–¹æ³•int abc(int[] x, int y)çš„æè¿°ç¬¦ä¸º([II) Iã€‚ 2ã€è°ˆè°ˆä½ å¯¹ç¬¦å·å¼•ç”¨ã€ç›´æ¥å¼•ç”¨çš„ç†è§£ï¼Ÿè¿™é‡Œè¯´æ˜ä¸‹ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„åŒºåˆ«ä¸å…³è”ï¼šç¬¦å·å¼•ç”¨ï¼šç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šå·²ç»åŠ è½½åˆ°äº†å†…å­˜ä¸­ã€‚ç›´æ¥å¼•ç”¨ï¼šç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨æ˜¯ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›¸å…³çš„ï¼ŒåŒä¸€ä¸ªç¬¦å·å¼•ç”¨åœ¨ä¸åŒè™šæ‹Ÿæœºå®ä¾‹ä¸Šç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¸€èˆ¬ä¸ä¼šç›¸åŒã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£è¯´æ˜å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»å­˜åœ¨äºå†…å­˜ä¹‹ä¸­äº†ã€‚ 3ã€å¸¸é‡ç±»å‹å’Œç»“æ„å¸¸é‡æ± ä¸­æ¯ä¸€é¡¹å¸¸é‡éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼ŒJDK1.7ä¹‹åå…±æœ‰14ç§ä¸åŒçš„è¡¨ç»“æ„æ•°æ®ã€‚å¦‚ä¸‹è¡¨æ ¼æ‰€ç¤ºï¼š è¿™14ç§è¡¨ï¼ˆæˆ–è€…å¸¸é‡é¡¹ç»“æ„ï¼‰çš„å…±åŒç‚¹æ˜¯ï¼šè¡¨å¼€å§‹çš„ç¬¬ä¸€ä½æ˜¯ä¸€ä¸ªu1ç±»å‹çš„æ ‡å¿—ä½ï¼ˆtagï¼‰ï¼Œä»£è¡¨å½“å‰è¿™ä¸ªå¸¸é‡é¡¹ä½¿ç”¨çš„æ˜¯å“ªç§è¡¨ç»“æ„ï¼Œå³å“ªç§å¸¸é‡ç±»å‹ã€‚ åœ¨å¸¸é‡æ± åˆ—è¡¨ä¸­ï¼ŒCONSTANT_Utf8_infoå¸¸é‡é¡¹æ˜¯ä¸€ç§ä½¿ç”¨æ”¹è¿›è¿‡çš„UTF-8ç¼–ç æ ¼å¼æ¥å­˜å‚¨è¯¸å¦‚æ–‡å­—å­—ç¬¦ä¸²ã€ç±»æˆ–è€…æ¥å£çš„å…¨é™å®šåã€å­—æ®µæˆ–è€…æ–¹æ³•çš„ç®€å•åç§°ä»¥åŠæè¿°ç¬¦ç­‰å¸¸é‡å­—ç¬¦ä¸²ä¿¡æ¯ã€‚ è¿™14ç§å¸¸é‡é¡¹ç»“æ„è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œå…¶ä¸­13ä¸ªå¸¸é‡é¡¹å ç”¨çš„å­—èŠ‚å›ºå®šï¼Œåªæœ‰CONSTANT_Utf8_infoå ç”¨å­—èŠ‚ä¸å›ºå®šï¼Œå…¶å¤§å°ç”±lengthå†³å®šã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä»å¸¸é‡æ± å­˜æ”¾çš„å†…å®¹å¯çŸ¥ï¼Œå…¶å­˜æ”¾çš„æ˜¯å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œæœ€ç»ˆè¿™äº›å†…å®¹éƒ½ä¼šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²çš„å¤§å°æ˜¯åœ¨ç¼–å†™ç¨‹åºæ—¶æ‰ç¡®å®šï¼Œæ¯”å¦‚ä½ å®šä¹‰ä¸€ä¸ªç±»ï¼Œç±»åå¯ä»¥å–é•¿å–çŸ­ï¼Œæ‰€ä»¥åœ¨æ²¡ç¼–è¯‘å‰ï¼Œå¤§å°ä¸å›ºå®šï¼Œç¼–è¯‘åï¼Œé€šè¿‡utf-8ç¼–ç ï¼Œå°±å¯ä»¥çŸ¥é“å…¶é•¿åº¦ã€‚ 3ã€è®¿é—®æ ‡è¯†è®¿é—®æ ‡è¯†(access_flagã€è®¿é—®æ ‡å¿—ã€è®¿é—®æ ‡è®°) åœ¨å¸¸é‡æ± åï¼Œç´§è·Ÿç€è®¿é—®æ ‡è®°ã€‚è¯¥æ ‡è®°ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè¿™ä¸ª Class æ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼›æ˜¯å¦å®šä¹‰ä¸º public ç±»å‹ï¼›æ˜¯å¦å®šä¹‰ä¸º abstract ç±»å‹ï¼›å¦‚æœæ˜¯ç±»çš„è¯ï¼Œæ˜¯å¦è¢«å£°æ˜ä¸º final ç­‰ã€‚å„ç§è®¿é—®æ ‡è®°å¦‚ä¸‹æ‰€ç¤ºï¼š ç±»çš„è®¿é—®æƒé™é€šå¸¸ä¸º ACC_ å¼€å¤´çš„å¸¸é‡ã€‚ æ¯ä¸€ç§ç±»å‹çš„è¡¨ç¤ºéƒ½æ˜¯é€šè¿‡è®¾ç½®è®¿é—®æ ‡è®°çš„32ä½ä¸­çš„ç‰¹å®šä½æ¥å®ç°çš„ã€‚æ¯”å¦‚ï¼Œè‹¥æ˜¯public finalçš„ç±»ï¼Œåˆ™è¯¥æ ‡è®°ä¸ºACC_PUBLIC | ACC_FINALã€‚ ä½¿ç”¨ACC_SUPERå¯ä»¥è®©ç±»æ›´å‡†ç¡®åœ°å®šä½åˆ°çˆ¶ç±»çš„æ–¹æ³•super.method(),ç°ä»£ç¼–è¯‘å™¨éƒ½ä¼šè®¾ç½®å¹¶ä¸”ä½¿ç”¨è¿™ä¸ªæ ‡è®°ã€‚ 4ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆ åœ¨è®¿é—®æ ‡è®°åï¼Œä¼šæŒ‡å®šè¯¥ç±»çš„ç±»åˆ«ã€çˆ¶ç±»ç±»åˆ«ä»¥åŠå®ç°çš„æ¥å£ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š è¿™ä¸‰é¡¹æ•°æ®æ¥ç¡®å®šè¿™ä¸ªç±»çš„ç»§æ‰¿å…³ç³»ã€‚ ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šå çˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚ç”±äº Javaè¯­è¨€ä¸å…è®¸å¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº†java.lang.Object ä¹‹å¤–ï¼Œæ‰€æœ‰çš„Javaç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº†java.lang.Object å¤–ï¼Œæ‰€æœ‰Javaç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º 0ã€‚ æ¥å£ç´¢å¼•é›†åˆå°±ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†å“ªäº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰ implements è¯­å¥ï¼ˆå¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåˆ™åº”å½“æ˜¯ extends è¯­å¥ï¼‰åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚ this_classï¼ˆç±»ç´¢å¼•ï¼‰ å­—èŠ‚æ— ç¬¦å·æ•´æ•°ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ã€‚å®ƒæä¾›äº†ç±»çš„å…¨é™å®šå,å¦‚com/kk/java1/Demoã€‚this_classçš„å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± è¡¨ä¸­æŸé¡¹çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚å¸¸é‡æ± åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„æˆå‘˜å¿…é¡»ä¸ºCONSTANT_Class_infoç±»å‹ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“è¡¨ç¤ºè¿™ä¸ªclassæ–‡ä»¶æ‰€å®šä¹‰çš„ç±»æˆ–æ¥å£ã€‚ super_class ï¼ˆçˆ¶ç±»ç´¢å¼•ï¼‰ 2å­—èŠ‚æ— ç¬¦å·æ•´æ•°ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ã€‚å®ƒæä¾›äº†å½“å‰ç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰ç»§æ‰¿ä»»ä½•ç±»ï¼Œå…¶é»˜è®¤ç»§æ‰¿çš„æ˜¯java/lang/Objectç±»ã€‚åŒæ—¶ï¼Œç”±äºJavaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œæ‰€ä»¥å…¶çˆ¶ç±»åªæœ‰ä¸€ä¸ªã€‚ superclassæŒ‡å‘çš„çˆ¶ç±»ä¸èƒ½æ˜¯finalã€‚ interfaces æŒ‡å‘å¸¸é‡æ± ç´¢å¼•é›†åˆï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç¬¦å·å¼•ç”¨åˆ°æ‰€æœ‰å·²å®ç°çš„æ¥å£ ç”±äºä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œå› æ­¤éœ€è¦ä»¥æ•°ç»„å½¢å¼ä¿å­˜å¤šä¸ªæ¥å£çš„ç´¢å¼•ï¼Œè¡¨ç¤ºæ¥å£çš„æ¯ä¸ªç´¢å¼•ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± çš„CONSTANT_Class (å½“ç„¶è¿™é‡Œå°±å¿…é¡»æ˜¯æ¥å£ï¼Œè€Œä¸æ˜¯ç±»)ã€‚ interfaces_count (æ¥å£è®¡æ•°å™¨) interfaces_counté¡¹çš„å€¼è¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£çš„ç›´æ¥è¶…æ¥å£æ•°é‡ã€‚ interfaces [](æ¥å£ç´¢å¼•é›†åˆ) interfaces []ä¸­æ¯ä¸ªæˆå‘˜çš„å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± è¡¨ä¸­æŸé¡¹çš„æœ‰æ•ˆç´¢å¼•å€¼ï¼Œå®ƒçš„é•¿åº¦ä¸º interfaces_countã€‚ æ¯ä¸ªæˆå‘˜ interfaces[i]å¿…é¡»ä¸º CONSTANT_Class_infoç»“æ„ï¼Œå…¶ä¸­ 0 &lt;= i &lt; interfaces_countã€‚åœ¨ interfaces[]ä¸­ï¼Œå„æˆå‘˜æ‰€è¡¨ç¤ºçš„æ¥å£é¡ºåºå’Œå¯¹åº”çš„æºä»£ç ä¸­ç»™å®šçš„æ¥å£é¡ºåºï¼ˆä»å·¦è‡³å³ï¼‰ä¸€æ ·ï¼Œå³ interfaces[0]å¯¹åº”çš„æ˜¯æºä»£ç ä¸­æœ€å·¦è¾¹çš„æ¥å£ã€‚ 5ã€å­—æ®µè¡¨é›†åˆ1ã€å­—æ®µè®¡æ•°å™¨ fields_countçš„å€¼è¡¨ç¤ºå½“å‰classæ–‡ä»¶fieldsè¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚ fieldsè¡¨ä¸­æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªfield_infoç»“æ„ï¼Œç”¨äºè¡¨ç¤ºè¯¥ç±»æˆ–æ¥å£æ‰€å£°æ˜çš„æ‰€æœ‰ç±»å­—æ®µæˆ–è€…å®ä¾‹å­—æ®µï¼Œä¸åŒ…æ‹¬æ–¹æ³•å†…éƒ¨å£°æ˜çš„å˜é‡ï¼Œä¹Ÿä¸åŒ…æ‹¬ä»çˆ¶ç±»æˆ–çˆ¶æ¥å£ç»§æ‰¿çš„é‚£äº›å­—æ®µ 2ã€å­—æ®µè¡¨ï¼Œfields [] fieldsè¡¨ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªfields_infoç»“æ„çš„æ•°æ®é¡¹ï¼Œç”¨äºè¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£ä¸­æŸä¸ªå­—æ®µçš„å®Œæ•´æè¿°ã€‚ ä¸€ä¸ªå­—æ®µçš„ä¿¡æ¯åŒ…æ‹¬å¦‚ä¸‹è¿™äº›ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯ä¸­ï¼Œå„ä¸ªä¿®é¥°ç¬¦éƒ½æ˜¯å¸ƒå°”å€¼ï¼Œè¦ä¹ˆæœ‰ï¼Œè¦ä¹ˆæ²¡æœ‰ã€‚ ä½œç”¨åŸŸï¼ˆpublicã€privateã€protectedä¿®é¥°ç¬¦ï¼‰ æ˜¯å®ä¾‹å˜é‡è¿˜æ˜¯ç±»å˜é‡ï¼ˆstaticä¿®é¥°ç¬¦ï¼‰ å¯å˜æ€§ï¼ˆfinalï¼‰ å¹¶å‘å¯è§æ€§ï¼ˆvolatileä¿®é¥°ç¬¦ï¼Œæ˜¯å¦å¼ºåˆ¶ä»ä¸»å†…å­˜è¯»å†™ï¼‰ å¯å¦åºåˆ—åŒ–ï¼ˆtransientä¿®é¥°ç¬¦ï¼‰ å­—æ®µæ•°æ®ç±»å‹ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡ã€æ•°ç»„ï¼‰ å­—æ®µåç§° å­—æ®µè¡¨ç»“æ„ 6ã€æ–¹æ³•è¡¨é›†åˆ1ã€æ–¹æ³•è®¡æ•°å™¨ methods_countçš„å€¼è¡¨ç¤ºå½“å‰classæ–‡ä»¶methodsè¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚ methods è¡¨ä¸­æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªmethod_infoç»“æ„ã€‚ 2ã€æ–¹æ³•è¡¨ methodsè¡¨ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªmethod_infoç»“æ„ï¼Œç”¨äºè¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£ä¸­æŸä¸ªæ–¹æ³•çš„å®Œæ•´æè¿°ã€‚å¦‚æœæŸä¸ªmethod_infoç»“æ„çš„access_flagsé¡¹æ—¢æ²¡æœ‰è®¾ç½® ACC_NATIVE æ ‡å¿—ä¹Ÿæ²¡æœ‰è®¾ç½®ACC_ABSTRACTæ ‡å¿—ï¼Œé‚£ä¹ˆè¯¥ç»“æ„ä¸­ä¹Ÿåº”åŒ…å«å®ç°è¿™ä¸ªæ–¹æ³•æ‰€ç”¨çš„Javaè™šæ‹ŸæœºæŒ‡ä»¤ã€‚ method_infoç»“æ„å¯ä»¥è¡¨ç¤ºç±»å’Œæ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬å®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•å’Œç±»æˆ–æ¥å£åˆå§‹åŒ–æ–¹æ³• æ–¹æ³•è¡¨çš„ç»“æ„å®é™…è·Ÿå­—æ®µè¡¨æ˜¯ä¸€æ ·çš„ï¼Œæ–¹æ³•è¡¨ç»“æ„å¦‚ä¸‹ï¼š 7ã€å±æ€§è¡¨é›†åˆ1ã€å±æ€§è®¡æ•°å™¨attributes_countçš„å€¼è¡¨ç¤ºå½“å‰classæ–‡ä»¶å±æ€§è¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚å±æ€§è¡¨ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªattribute_infoç»“æ„ã€‚ 2ã€å±æ€§è¡¨ ConstantValue å±æ€§ ConstantValue å±æ€§è¡¨ç¤ºä¸€ä¸ªå¸¸é‡å­—æ®µçš„å€¼ã€‚ä½äº field_infoç»“æ„çš„å±æ€§è¡¨ä¸­ã€‚ ConstantValue_attribute { u2 attribute_name_index; u4 attribute_length; u2 constantvalue_index;//å­—æ®µå€¼åœ¨å¸¸é‡æ± ä¸­çš„ç´¢å¼•ï¼Œå¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å¤„çš„é¡¹ç»™å‡ºè¯¥å±æ€§è¡¨ç¤ºçš„å¸¸é‡å€¼ã€‚ï¼ˆä¾‹å¦‚ï¼Œå€¼æ˜¯longå‹çš„ï¼Œåœ¨å¸¸é‡æ± ä¸­ä¾¿æ˜¯CONSTANT_Longï¼‰ } - Deprecated å±æ€§ - Deprecated å±æ€§æ˜¯åœ¨ JDK 1.1 ä¸ºäº†æ”¯æŒæ³¨é‡Šä¸­çš„å…³é”®è¯@deprecated è€Œå¼•å…¥çš„ã€‚ ```java Deprecated_attribute { u2 attribute_name_index; u4 attribute_length; } Code å±æ€§ Codeå±æ€§å°±æ˜¯å­˜æ”¾æ–¹æ³•ä½“é‡Œé¢çš„ä»£ç ã€‚ä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰æ–¹æ³•è¡¨éƒ½æœ‰Codeå±æ€§ã€‚åƒæ¥å£æˆ–è€…æŠ½è±¡æ–¹æ³•ï¼Œä»–ä»¬æ²¡æœ‰å…·ä½“çš„æ–¹æ³•ä½“ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šæœ‰Codeå±æ€§äº†ã€‚Codeå±æ€§è¡¨çš„ç»“æ„,å¦‚ä¸‹å›¾ï¼š å¯ä»¥çœ‹åˆ°ï¼šCodeå±æ€§è¡¨çš„å‰ä¸¤é¡¹è·Ÿå±æ€§è¡¨æ˜¯ä¸€è‡´çš„ï¼Œå³Codeå±æ€§è¡¨éµå¾ªå±æ€§è¡¨çš„ç»“æ„ï¼Œåé¢é‚£äº›åˆ™æ˜¯ä»–è‡ªå®šä¹‰çš„ç»“æ„ã€‚ InnerClasses å±æ€§ ä¸ºäº†æ–¹ä¾¿è¯´æ˜ç‰¹åˆ«å®šä¹‰ä¸€ä¸ªè¡¨ç¤ºç±»æˆ–æ¥å£çš„ Class æ ¼å¼ä¸º Cã€‚å¦‚æœ C çš„å¸¸é‡æ± ä¸­åŒ…å«æŸä¸ªCONSTANT_Class_info æˆå‘˜ï¼Œä¸”è¿™ä¸ªæˆå‘˜æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£ä¸å±äºä»»ä½•ä¸€ä¸ªåŒ…ï¼Œé‚£ä¹ˆ C çš„ClassFile ç»“æ„çš„å±æ€§è¡¨ä¸­å°±å¿…é¡»å«æœ‰å¯¹åº”çš„ InnerClasses å±æ€§ã€‚InnerClasses å±æ€§æ˜¯åœ¨ JDK 1.1 ä¸­ä¸ºäº†æ”¯æŒå†…éƒ¨ç±»å’Œå†…éƒ¨æ¥å£è€Œå¼•å…¥çš„,ä½äº ClassFileç»“æ„çš„å±æ€§è¡¨ã€‚ LineNumberTable å±æ€§ LineNumberTable å±æ€§æ˜¯å¯é€‰å˜é•¿å±æ€§ï¼Œä½äº Codeç»“æ„çš„å±æ€§è¡¨ã€‚ LineNumberTableå±æ€§æ˜¯ç”¨æ¥æè¿°Javaæºç è¡Œå·ä¸å­—èŠ‚ç è¡Œå·ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚è¿™ä¸ªå±æ€§å¯ä»¥ç”¨æ¥åœ¨è°ƒè¯•çš„æ—¶å€™å®šä½ä»£ç æ‰§è¡Œçš„è¡Œæ•°ã€‚ start_pc,å³å­—èŠ‚ç è¡Œå·;line_numberï¼Œå³Javaæºä»£ç è¡Œå·ã€‚ åœ¨ Code å±æ€§çš„å±æ€§è¡¨ä¸­,LineNumberTable å±æ€§å¯ä»¥æŒ‰ç…§ä»»æ„é¡ºåºå‡ºç°ï¼Œæ­¤å¤–ï¼Œå¤šä¸ª LineNumberTableå±æ€§å¯ä»¥å…±åŒè¡¨ç¤ºä¸€ä¸ªè¡Œå·åœ¨æºæ–‡ä»¶ä¸­è¡¨ç¤ºçš„å†…å®¹ï¼Œå³ LineNumberTable å±æ€§ä¸éœ€è¦ä¸æºæ–‡ä»¶çš„è¡Œä¸€ä¸€å¯¹åº”ã€‚ LocalVariableTable å±æ€§ LocalVariableTable æ˜¯å¯é€‰å˜é•¿å±æ€§ï¼Œä½äº Codeå±æ€§çš„å±æ€§è¡¨ä¸­ã€‚å®ƒè¢«è°ƒè¯•å™¨ç”¨äºç¡®å®šæ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å±€éƒ¨å˜é‡çš„ä¿¡æ¯ã€‚åœ¨ Code å±æ€§çš„å±æ€§è¡¨ä¸­ï¼ŒLocalVariableTable å±æ€§å¯ä»¥æŒ‰ç…§ä»»æ„é¡ºåºå‡ºç°ã€‚ Code å±æ€§ä¸­çš„æ¯ä¸ªå±€éƒ¨å˜é‡æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ª LocalVariableTable å±æ€§ã€‚ start pc + lengthè¡¨ç¤ºè¿™ä¸ªå˜é‡åœ¨å­—èŠ‚ç ä¸­çš„ç”Ÿå‘½å‘¨æœŸèµ·å§‹å’Œç»“æŸçš„åç§»ä½ç½®ï¼ˆthisç”Ÿå‘½å‘¨æœŸä»å¤´0åˆ°ç»“å°¾ï¼‰ indexå°±æ˜¯è¿™ä¸ªå˜é‡åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½ï¼ˆæ§½ä½å¯å¤ç”¨ï¼‰ nameå°±æ˜¯å˜é‡åç§° Descriptorè¡¨ç¤ºå±€éƒ¨å˜é‡ç±»å‹æè¿° Signature å±æ€§ Signature å±æ€§æ˜¯å¯é€‰çš„å®šé•¿å±æ€§ï¼Œä½äº ClassFileï¼Œ field_infoæˆ– method_infoç»“æ„çš„å±æ€§è¡¨ä¸­ã€‚åœ¨ Java è¯­è¨€ä¸­ï¼Œä»»ä½•ç±»ã€ æ¥å£ã€ åˆå§‹åŒ–æ–¹æ³•æˆ–æˆå‘˜çš„æ³›å‹ç­¾åå¦‚æœåŒ…å«äº†ç±»å‹å˜é‡ï¼ˆ Type Variablesï¼‰ æˆ–å‚æ•°åŒ–ç±»å‹ï¼ˆ Parameterized Typesï¼‰ï¼Œåˆ™ Signature å±æ€§ä¼šä¸ºå®ƒè®°å½•æ³›å‹ç­¾åä¿¡æ¯ã€‚ SourceFileå±æ€§ å…¶ä»–å±æ€§ Javaè™šæ‹Ÿæœºä¸­é¢„å®šä¹‰çš„å±æ€§æœ‰20å¤šä¸ªï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œé€šè¿‡ä¸Šé¢å‡ ä¸ªå±æ€§çš„ä»‹ç»ï¼Œåªè¦é¢†ä¼šå…¶ç²¾é«“ï¼Œå…¶ä»–å±æ€§çš„è§£è¯»ä¹Ÿæ˜¯æ˜“å¦‚åæŒã€‚ 5ã€å››ã€javaporacleå®˜æ–¹çš„åè§£æå·¥å…·ï¼šjavap 1ã€è§£æå­—èŠ‚ç çš„ä½œç”¨é€šè¿‡åç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ·±å…¥çš„äº†è§£javaä»£ç çš„å·¥ä½œæœºåˆ¶ã€‚ä½†æ˜¯ï¼Œè‡ªå·±åˆ†æç±»æ–‡ä»¶ç»“æ„å¤ªéº»çƒ¦äº†ï¼é™¤äº†ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„jclasslibå·¥å…·ä¹‹å¤–ï¼Œoracleå®˜æ–¹ä¹Ÿæä¾›äº†å·¥å…·ï¼šjavapã€‚ javapæ˜¯jdkè‡ªå¸¦çš„åè§£æå·¥å…·ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯æ ¹æ®classå­—èŠ‚ç æ–‡ä»¶ï¼Œåè§£æå‡ºå½“å‰ç±»å¯¹åº”çš„codeåŒºï¼ˆå­—èŠ‚ç æŒ‡ä»¤ï¼‰ã€å±€éƒ¨å˜é‡è¡¨ã€å¼‚å¸¸è¡¨å’Œä»£ç è¡Œåç§»é‡æ˜ å°„è¡¨ã€å¸¸é‡æ± ç­‰ä¿¡æ¯ã€‚ é€šè¿‡å±€éƒ¨å˜é‡è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸèŒƒå›´ã€æ‰€åœ¨æ§½ä½ç­‰ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥çœ‹åˆ°æ§½ä½å¤ç”¨ç­‰ä¿¡æ¯ã€‚ 2ã€javac -gæ“ä½œè§£æå­—èŠ‚ç æ–‡ä»¶å¾—åˆ°çš„ä¿¡æ¯ä¸­ï¼Œæœ‰äº›ä¿¡æ¯ï¼ˆå¦‚å±€éƒ¨å˜é‡è¡¨ã€æŒ‡ä»¤å’Œä»£ç è¡Œåç§»é‡æ˜ å°„è¡¨ã€å¸¸é‡æ± ä¸­æ–¹æ³•çš„å‚æ•°åç§°ç­‰ç­‰ï¼‰éœ€è¦åœ¨ä½¿ç”¨javacç¼–è¯‘æˆclassæ–‡ä»¶æ—¶ï¼ŒæŒ‡å®šå‚æ•°æ‰èƒ½è¾“å‡ºã€‚ æ¯”å¦‚ï¼Œä½ ç›´æ¥javac xx.javaï¼Œå°±ä¸ä¼šåœ¨ç”Ÿæˆå¯¹åº”çš„å±€éƒ¨å˜é‡è¡¨ç­‰ä¿¡æ¯ï¼Œå¦‚æœä½ ä½¿ç”¨javac -g xx.javaå°±å¯ä»¥ç”Ÿæˆæ‰€æœ‰ç›¸å…³ä¿¡æ¯äº†ã€‚å¦‚æœä½ ä½¿ç”¨çš„eclipseæˆ–IDEAï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ï¼Œeclipseã€IDEAåœ¨ç¼–è¯‘æ—¶ä¼šå¸®ä½ ç”Ÿæˆå±€éƒ¨å˜é‡è¡¨ã€æŒ‡ä»¤å’Œä»£ç è¡Œåç§»é‡æ˜ å°„è¡¨ç­‰ä¿¡æ¯çš„ã€‚ 3ã€javapçš„ç”¨æ³•javapçš„ç”¨æ³•æ ¼å¼ï¼šjavap å…¶ä¸­ï¼Œclasseså°±æ˜¯ä½ è¦åç¼–è¯‘çš„classæ–‡ä»¶ã€‚ åœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥è¾“å…¥javapæˆ–javap -helpå¯ä»¥çœ‹åˆ°javapçš„optionsæœ‰å¦‚ä¸‹é€‰é¡¹ï¼š -help â€“help -? è¾“å‡ºæ­¤ç”¨æ³•æ¶ˆæ¯ -version ç‰ˆæœ¬ä¿¡æ¯ï¼Œå…¶å®æ˜¯å½“å‰javapæ‰€åœ¨jdkçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¸æ˜¯classåœ¨å“ªä¸ªjdkä¸‹ç”Ÿæˆçš„ã€‚ -public ä»…æ˜¾ç¤ºå…¬å…±ç±»å’Œæˆå‘˜ -protected æ˜¾ç¤ºå—ä¿æŠ¤çš„/å…¬å…±ç±»å’Œæˆå‘˜ -p -private æ˜¾ç¤ºæ‰€æœ‰ç±»å’Œæˆå‘˜ -package æ˜¾ç¤ºç¨‹åºåŒ…/å—ä¿æŠ¤çš„/å…¬å…±ç±» å’Œæˆå‘˜ (é»˜è®¤) -sysinfo æ˜¾ç¤ºæ­£åœ¨å¤„ç†çš„ç±»çš„ç³»ç»Ÿä¿¡æ¯ (è·¯å¾„, å¤§å°, æ—¥æœŸ, MD5 æ•£åˆ—,æºæ–‡ä»¶å) -constants æ˜¾ç¤ºé™æ€æœ€ç»ˆå¸¸é‡ -s è¾“å‡ºå†…éƒ¨ç±»å‹ç­¾å -l è¾“å‡ºè¡Œå·å’Œæœ¬åœ°å˜é‡è¡¨ -c å¯¹ä»£ç è¿›è¡Œåæ±‡ç¼– -v -verbose è¾“å‡ºé™„åŠ ä¿¡æ¯ï¼ˆåŒ…æ‹¬è¡Œå·ã€æœ¬åœ°å˜é‡è¡¨ï¼Œåæ±‡ç¼–ç­‰è¯¦ç»†ä¿¡æ¯ï¼‰ -classpath æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½® -cp æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½® -bootclasspath è¦†ç›–å¼•å¯¼ç±»æ–‡ä»¶çš„ä½ç½® ä¸€èˆ¬å¸¸ç”¨çš„æ˜¯-v -l -cä¸‰ä¸ªé€‰é¡¹ã€‚ javap -l ä¼šè¾“å‡ºè¡Œå·å’Œæœ¬åœ°å˜é‡è¡¨ä¿¡æ¯ã€‚javap -c ä¼šå¯¹å½“å‰classå­—èŠ‚ç è¿›è¡Œåç¼–è¯‘ç”Ÿæˆæ±‡ç¼–ä»£ç ã€‚javap -v classxx é™¤äº†åŒ…å«-cå†…å®¹å¤–ï¼Œè¿˜ä¼šè¾“å‡ºè¡Œå·ã€å±€éƒ¨å˜é‡è¡¨ä¿¡æ¯ã€å¸¸é‡æ± ç­‰ä¿¡æ¯ã€‚ 4ã€ä½¿ç”¨ä¸¾ä¾‹package com.kk.test; public class JavapTest { private int num; boolean flag; protected char gender; public String info; public static final int COUNTS = 1; static{ String url = \"www.mykkto.com\"; } { info = \"java\"; } public JavapTest(){ } private JavapTest(boolean flag){ this.flag = flag; } private void methodPrivate(){ } int getNum(int i){ return num + i; } protected char showGender(){ return gender; } public void showInfo(){ int i = 10; System.out.println(info + i); } } å¸Œæœ›è¾“å‡ºçš„ä¿¡æ¯æ¯”è¾ƒå®Œæ•´çš„è¯ï¼Œä½¿ç”¨å¦‚ä¸‹æ“ä½œï¼š javac JavapTest.java javap -v -p JavapTest.class J:\\0 å¤§å‚ç´ æ\\jvm\\00Test&gt;javac JavapTest.java J:\\0 å¤§å‚ç´ æ\\jvm\\00Test&gt;javap -v -p JavapTest.class Classfile /J:/0 å¤§å‚ç´ æ/jvm/00Test/JavapTest.class Last modified 2022-4-17; size 1141 bytes MD5 checksum 16833cad2e0187d03ccf1baecaa23808 Compiled from \"JavapTest.java\" public class com.kk.test.JavapTest minor version: 0 major version: 52 flags: ACC_PUBLIC, ACC_SUPER Constant pool: #1 = Methodref #16.#42 // java/lang/Object.\"&lt;init&gt;\":()V #2 = String #43 // java #3 = Fieldref #15.#44 // com/kk/test/JavapTest.info:Ljava/lang/String; #4 = Fieldref #15.#45 // com/kk/test/JavapTest.flag:Z #5 = Fieldref #15.#46 // com/kk/test/JavapTest.num:I #6 = Fieldref #15.#47 // com/kk/test/JavapTest.gender:C #7 = Fieldref #48.#49 // java/lang/System.out:Ljava/io/PrintStream; #8 = Class #50 // java/lang/StringBuilder #9 = Methodref #8.#42 // java/lang/StringBuilder.\"&lt;init&gt;\":()V #10 = Methodref #8.#51 // java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder; #11 = Methodref #8.#52 // java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder; #12 = Methodref #8.#53 // java/lang/StringBuilder.toString:()Ljava/lang/String; #13 = Methodref #54.#55 // java/io/PrintStream.println:(Ljava/lang/String;)V #14 = String #56 // www.mykkto.com #15 = Class #57 // com/kk/test/JavapTest #16 = Class #58 // java/lang/Object #17 = Utf8 num #18 = Utf8 I #19 = Utf8 flag #20 = Utf8 Z #21 = Utf8 gender #22 = Utf8 C #23 = Utf8 info #24 = Utf8 Ljava/lang/String; #25 = Utf8 COUNTS #26 = Utf8 ConstantValue #27 = Integer 1 #28 = Utf8 &lt;init&gt; #29 = Utf8 ()V #30 = Utf8 Code #31 = Utf8 LineNumberTable #32 = Utf8 (Z)V #33 = Utf8 methodPrivate #34 = Utf8 getNum #35 = Utf8 (I)I #36 = Utf8 showGender #37 = Utf8 ()C #38 = Utf8 showInfo #39 = Utf8 &lt;clinit&gt; #40 = Utf8 SourceFile #41 = Utf8 JavapTest.java #42 = NameAndType #28:#29 // \"&lt;init&gt;\":()V #43 = Utf8 java #44 = NameAndType #23:#24 // info:Ljava/lang/String; #45 = NameAndType #19:#20 // flag:Z #46 = NameAndType #17:#18 // num:I #47 = NameAndType #21:#22 // gender:C #48 = Class #59 // java/lang/System #49 = NameAndType #60:#61 // out:Ljava/io/PrintStream; #50 = Utf8 java/lang/StringBuilder #51 = NameAndType #62:#63 // append:(Ljava/lang/String;)Ljava/lang/StringBuilder; #52 = NameAndType #62:#64 // append:(I)Ljava/lang/StringBuilder; #53 = NameAndType #65:#66 // toString:()Ljava/lang/String; #54 = Class #67 // java/io/PrintStream #55 = NameAndType #68:#69 // println:(Ljava/lang/String;)V #56 = Utf8 www.mykkto.com #57 = Utf8 com/kk/test/JavapTest #58 = Utf8 java/lang/Object #59 = Utf8 java/lang/System #60 = Utf8 out #61 = Utf8 Ljava/io/PrintStream; #62 = Utf8 append #63 = Utf8 (Ljava/lang/String;)Ljava/lang/StringBuilder; #64 = Utf8 (I)Ljava/lang/StringBuilder; #65 = Utf8 toString #66 = Utf8 ()Ljava/lang/String; #67 = Utf8 java/io/PrintStream #68 = Utf8 println #69 = Utf8 (Ljava/lang/String;)V { private int num; descriptor: I flags: ACC_PRIVATE boolean flag; descriptor: Z flags: protected char gender; descriptor: C flags: ACC_PROTECTED public java.lang.String info; descriptor: Ljava/lang/String; flags: ACC_PUBLIC public static final int COUNTS; descriptor: I flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL ConstantValue: int 1 public com.kk.test.JavapTest(); descriptor: ()V flags: ACC_PUBLIC Code: stack=2, locals=1, args_size=1 0: aload_0 1: invokespecial #1 // Method java/lang/Object.\"&lt;init&gt;\":()V 4: aload_0 5: ldc #2 // String java 7: putfield #3 // Field info:Ljava/lang/String; 10: return LineNumberTable: line 16: 0 line 14: 4 line 18: 10 private com.kk.test.JavapTest(boolean); descriptor: (Z)V flags: ACC_PRIVATE Code: stack=2, locals=2, args_size=2 0: aload_0 1: invokespecial #1 // Method java/lang/Object.\"&lt;init&gt;\":()V 4: aload_0 5: ldc #2 // String java 7: putfield #3 // Field info:Ljava/lang/String; 10: aload_0 11: iload_1 12: putfield #4 // Field flag:Z 15: return LineNumberTable: line 19: 0 line 14: 4 line 20: 10 line 21: 15 private void methodPrivate(); descriptor: ()V flags: ACC_PRIVATE Code: stack=0, locals=1, args_size=1 0: return LineNumberTable: line 24: 0 int getNum(int); descriptor: (I)I flags: Code: stack=2, locals=2, args_size=2 0: aload_0 1: getfield #5 // Field num:I 4: iload_1 5: iadd 6: ireturn LineNumberTable: line 26: 0 protected char showGender(); descriptor: ()C flags: ACC_PROTECTED Code: stack=1, locals=1, args_size=1 0: aload_0 1: getfield #6 // Field gender:C 4: ireturn LineNumberTable: line 29: 0 public void showInfo(); descriptor: ()V flags: ACC_PUBLIC Code: stack=3, locals=2, args_size=1 0: bipush 10 2: istore_1 3: getstatic #7 // Field java/lang/System.out:Ljava/io/PrintStream; 6: new #8 // class java/lang/StringBuilder 9: dup 10: invokespecial #9 // Method java/lang/StringBuilder.\"&lt;init&gt;\":()V 13: aload_0 14: getfield #3 // Field info:Ljava/lang/String; 17: invokevirtual #10 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder; 20: iload_1 21: invokevirtual #11 // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder; 24: invokevirtual #12 // Method java/lang/StringBuilder.toString:()Ljava/lang/String; 27: invokevirtual #13 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 30: return LineNumberTable: line 32: 0 line 33: 3 line 34: 30 static {}; descriptor: ()V flags: ACC_STATIC Code: stack=1, locals=1, args_size=0 0: ldc #14 // String www.mykkto.com 2: astore_0 3: return LineNumberTable: line 11: 0 line 12: 3 } SourceFile: \"JavapTest.java\" J:\\0 å¤§å‚ç´ æ\\jvm\\00Test&gt; 5ã€æ€»ç»“1ã€é€šè¿‡javapå‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªjavaç±»åæ±‡ç¼–å¾—åˆ°çš„Classæ–‡ä»¶ç‰ˆæœ¬å·ã€å¸¸é‡æ± ã€è®¿é—®æ ‡è¯†ã€å˜é‡è¡¨ã€æŒ‡ä»¤ä»£ç è¡Œå·è¡¨ç­‰ç­‰ä¿¡æ¯ã€‚ä¸æ˜¾ç¤ºç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆã€()ã€()ç­‰ç»“æ„ 2ã€é€šè¿‡å¯¹å‰é¢ä¾‹å­ä»£ç åæ±‡ç¼–æ–‡ä»¶çš„ç®€å•åˆ†æï¼Œå¯ä»¥å‘ç°ï¼Œä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œé€šå¸¸ä¼šæ¶‰åŠä¸‹é¢å‡ å—å†…å­˜çš„æ“ä½œï¼šï¼ˆ1ï¼‰javaæ ˆä¸­ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€‚ï¼ˆ2ï¼‰javaå †ã€‚é€šè¿‡å¯¹è±¡çš„åœ°å€å¼•ç”¨å»æ“ä½œã€‚ï¼ˆ3ï¼‰å¸¸é‡æ± ã€‚ï¼ˆ4ï¼‰å…¶ä»–å¦‚å¸§æ•°æ®åŒºã€æ–¹æ³•åŒºçš„å‰©ä½™éƒ¨åˆ†ç­‰æƒ…å†µï¼Œæµ‹è¯•ä¸­æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™é‡Œè¯´æ˜ä¸€ä¸‹ã€‚ 3ã€å¹³å¸¸ï¼Œæˆ‘ä»¬æ¯”è¾ƒå…³æ³¨çš„æ˜¯javaç±»ä¸­æ¯ä¸ªæ–¹æ³•çš„åæ±‡ç¼–ä¸­çš„æŒ‡ä»¤æ“ä½œè¿‡ç¨‹ï¼Œè¿™äº›æŒ‡ä»¤éƒ½æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£æŸ¥çœ‹æ¯ä¸ªæŒ‡ä»¤çš„å«ä¹‰ï¼Œå¾ˆç®€å•ï¼šhttps://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html äº”ã€å­—èŠ‚ç æŒ‡ä»¤é›†ä¸è§£ææ¦‚è¿°Javaå­—èŠ‚ç å¯¹äºè™šæ‹Ÿæœºï¼Œå°±å¥½åƒæ±‡ç¼–è¯­è¨€å¯¹äºè®¡ç®—æœºï¼Œå±äºåŸºæœ¬æ‰§è¡ŒæŒ‡ä»¤ã€‚ Java è™šæ‹Ÿæœºçš„æŒ‡ä»¤ç”±ä¸€ä¸ªå­—èŠ‚é•¿åº¦çš„ã€ä»£è¡¨ç€æŸç§ç‰¹å®šæ“ä½œå«ä¹‰çš„æ•°å­—ï¼ˆç§°ä¸ºæ“ä½œç ï¼ŒOpcodeï¼‰ä»¥åŠè·Ÿéšå…¶åçš„é›¶è‡³å¤šä¸ªä»£è¡¨æ­¤æ“ä½œæ‰€éœ€å‚æ•°ï¼ˆç§°ä¸ºæ“ä½œæ•°ï¼ŒOperandsï¼‰è€Œæ„æˆã€‚ç”±äº Java è™šæ‹Ÿæœºé‡‡ç”¨é¢å‘æ“ä½œæ•°æ ˆè€Œä¸æ˜¯å¯„å­˜å™¨çš„ç»“æ„ï¼Œæ‰€ä»¥å¤§å¤šæ•°çš„æŒ‡ä»¤éƒ½ä¸åŒ…å«æ“ä½œæ•°ï¼Œåªæœ‰ä¸€ä¸ªæ“ä½œç ã€‚ ç”±äºé™åˆ¶äº† Java è™šæ‹Ÿæœºæ“ä½œç çš„é•¿åº¦ä¸ºä¸€ä¸ªå­—èŠ‚ï¼ˆå³ 0ï½255ï¼‰ï¼Œè¿™æ„å‘³ç€æŒ‡ä»¤é›†çš„æ“ä½œç æ€»æ•°ä¸å¯èƒ½è¶…è¿‡ 256 æ¡ã€‚ å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html ç†Ÿæ‚‰è™šæ‹Ÿæœºçš„æŒ‡ä»¤å¯¹äºåŠ¨æ€å­—èŠ‚ç ç”Ÿæˆã€åç¼–è¯‘Classæ–‡ä»¶ã€Classæ–‡ä»¶ä¿®è¡¥éƒ½æœ‰ç€éå¸¸é‡è¦çš„ä»·å€¼ã€‚å› æ­¤ï¼Œé˜…è¯»å­—èŠ‚ç ä½œä¸ºäº†è§£ Java è™šæ‹Ÿæœºçš„åŸºç¡€æŠ€èƒ½ï¼Œéœ€è¦ç†Ÿç»ƒæŒæ¡å¸¸è§æŒ‡ä»¤ã€‚ 1ã€å­—èŠ‚ç ä¸æ•°æ®ç±»å‹åœ¨Javaè™šæ‹Ÿæœºçš„æŒ‡ä»¤é›†ä¸­ï¼Œå¤§å¤šæ•°çš„æŒ‡ä»¤éƒ½åŒ…å«äº†å…¶æ“ä½œæ‰€å¯¹åº”çš„æ•°æ®ç±»å‹ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼ŒiloadæŒ‡ä»¤ç”¨äºä»å±€éƒ¨å˜é‡è¡¨ä¸­åŠ è½½intå‹çš„æ•°æ®åˆ°æ“ä½œæ•°æ ˆä¸­ï¼Œè€ŒfloadæŒ‡ä»¤åŠ è½½çš„åˆ™æ˜¯floatç±»å‹çš„æ•°æ®ã€‚ å¯¹äºå¤§éƒ¨åˆ†ä¸æ•°æ®ç±»å‹ç›¸å…³çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œå®ƒä»¬çš„æ“ä½œç åŠ©è®°ç¬¦ä¸­éƒ½æœ‰ç‰¹æ®Šçš„å­—ç¬¦æ¥è¡¨æ˜ä¸“é—¨ä¸ºå“ªç§æ•°æ®ç±»å‹æœåŠ¡ï¼š iä»£è¡¨å¯¹intç±»å‹çš„æ•°æ®æ“ä½œ lä»£è¡¨longç±»å‹çš„æ•°æ®æ“ä½œ sä»£è¡¨shortç±»å‹çš„æ•°æ®æ“ä½œ bä»£è¡¨byteç±»å‹çš„æ•°æ®æ“ä½œ cä»£è¡¨charç±»å‹çš„æ•°æ®æ“ä½œ fä»£è¡¨floatç±»å‹çš„æ•°æ®æ“ä½œ dä»£è¡¨doubleç±»å‹çš„æ•°æ®æ“ä½œ ä¹Ÿæœ‰ä¸€äº›æŒ‡ä»¤çš„åŠ©è®°ç¬¦ä¸­æ²¡æœ‰æ˜ç¡®åœ°æŒ‡æ˜æ“ä½œç±»å‹çš„å­—æ¯ï¼Œå¦‚arraylengthæŒ‡ä»¤ï¼Œå®ƒæ²¡æœ‰ä»£è¡¨æ•°æ®ç±»å‹çš„ç‰¹æ®Šå­—ç¬¦ï¼Œä½†æ“ä½œæ•°æ°¸è¿œåªèƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹çš„å¯¹è±¡ã€‚ è¿˜æœ‰å¦å¤–ä¸€äº›æŒ‡ä»¤ï¼Œå¦‚æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤gotoåˆ™æ˜¯ä¸æ•°æ®ç±»å‹æ— å…³çš„ã€‚ å¤§éƒ¨åˆ†çš„æŒ‡ä»¤éƒ½æ²¡æœ‰æ”¯æŒæ•´æ•°ç±»å‹byteã€charå’Œshortï¼Œç”šè‡³æ²¡æœ‰ä»»ä½•æŒ‡ä»¤æ”¯æŒbooleanç±»å‹ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸæˆ–è¿è¡ŒæœŸå°†byteå’Œshortç±»å‹çš„æ•°æ®å¸¦ç¬¦å·æ‰©å±•ï¼ˆSign-Extendï¼‰ä¸ºç›¸åº”çš„intç±»å‹æ•°æ®ï¼Œå°†booleanå’Œcharç±»å‹æ•°æ®é›¶ä½æ‰©å±•ï¼ˆZero-Extendï¼‰ä¸ºç›¸åº”çš„intç±»å‹æ•°æ®ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œåœ¨å¤„ç†booleanã€byteã€shortå’Œcharç±»å‹çš„æ•°ç»„æ—¶ï¼Œä¹Ÿä¼šè½¬æ¢ä¸ºä½¿ç”¨å¯¹åº”çš„intç±»å‹çš„å­—èŠ‚ç æŒ‡ä»¤æ¥å¤„ç†ã€‚å› æ­¤ï¼Œå¤§å¤šæ•°å¯¹äºbooleanã€byteã€shortå’Œcharç±»å‹æ•°æ®çš„æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯ä½¿ç”¨ç›¸åº”çš„intç±»å‹ä½œä¸ºè¿ç®—ç±»å‹ã€‚ byte b1 = 12; short s1 = 10; int i = b1 + s1; 2ã€æŒ‡ä»¤åˆ†ç±»ç”±äºå®Œå…¨ä»‹ç»å’Œå­¦ä¹ è¿™äº›æŒ‡ä»¤éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´ã€‚ä¸ºäº†è®©å¤§å®¶èƒ½å¤Ÿæ›´å¿«åœ°ç†Ÿæ‚‰å’Œäº†è§£è¿™äº›åŸºæœ¬æŒ‡ä»¤ï¼Œè¿™é‡Œå°†JVMä¸­çš„å­—èŠ‚ç æŒ‡ä»¤é›†æŒ‰ç”¨é€”å¤§è‡´åˆ†æˆ 9 ç±»ã€‚ åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤ ç®—æœ¯æŒ‡ä»¤ ç±»å‹è½¬æ¢æŒ‡ä»¤ å¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤ æ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤ æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤ æ§åˆ¶è½¬ç§»æŒ‡ä»¤ å¼‚å¸¸å¤„ç†æŒ‡ä»¤ åŒæ­¥æ§åˆ¶æŒ‡ä»¤ (è¯´åœ¨å‰é¢)åœ¨åšå€¼ç›¸å…³æ“ä½œæ—¶ï¼š ä¸€ä¸ªæŒ‡ä»¤ï¼Œå¯ä»¥ä»å±€éƒ¨å˜é‡è¡¨ã€å¸¸é‡æ± ã€å †ä¸­å¯¹è±¡ã€æ–¹æ³•è°ƒç”¨ã€ç³»ç»Ÿè°ƒç”¨ä¸­ç­‰å–å¾—æ•°æ®ï¼Œè¿™äº›æ•°æ®ï¼ˆå¯èƒ½æ˜¯å€¼ï¼Œå¯èƒ½æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼‰è¢«å‹å…¥æ“ä½œæ•°æ ˆã€‚ ä¸€ä¸ªæŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥ä»æ“ä½œæ•°æ ˆä¸­å–å‡ºä¸€åˆ°å¤šä¸ªå€¼ï¼ˆpopå¤šæ¬¡ï¼‰ï¼Œå®Œæˆèµ‹å€¼ã€åŠ å‡ä¹˜é™¤ã€æ–¹æ³•ä¼ å‚ã€ç³»ç»Ÿè°ƒç”¨ç­‰ç­‰æ“ä½œã€‚ å…­ã€â˜… å­—èŠ‚ç æŒ‡ä»¤1ã€åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤2ã€ç®—æœ¯æŒ‡ä»¤3ã€ç±»å‹è½¬æ¢æŒ‡ä»¤4ã€å¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤5ã€æ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤6ã€æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤7ã€æ§åˆ¶è½¬ç§»æŒ‡ä»¤8ã€å¼‚å¸¸å¤„ç†æŒ‡ä»¤9ã€åŒæ­¥æ§åˆ¶æŒ‡ä»¤","categories":[{"name":"é«˜é˜¶ç¯‡","slug":"é«˜é˜¶ç¯‡","permalink":"https://mykkto.github.io/categories/%E9%AB%98%E9%98%B6%E7%AF%87/"}],"tags":[{"name":"jvm","slug":"jvm","permalink":"https://mykkto.github.io/tags/jvm/"},{"name":"å­—èŠ‚ç ","slug":"å­—èŠ‚ç ","permalink":"https://mykkto.github.io/tags/%E5%AD%97%E8%8A%82%E7%A0%81/"}],"author":"mykk"},{"title":"å†æ¥é¢åŸºé¢˜ã€é•¿æœŸã€‘","slug":"05-é¢è¯•é¢˜/00-é¢åŸº/01_Always_Interview","date":"2022-04-09T03:06:12.000Z","updated":"2023-06-11T02:53:45.128Z","comments":true,"path":"posts/c1193e28.html","link":"","permalink":"https://mykkto.github.io/posts/c1193e28.html","excerpt":"","text":"ä¸€ã€å‰è¨€1ã€è¯´æ˜åˆç¨¿æ²¡æƒ³å¥½æ€ä¹ˆå®šä¹‰ï¼ŒæŠŠæœ€è¿‘é‡åˆ°çš„é¢è¯•é¢˜å¤§æ¦‚æ¢³ç†ä¸‹ï¼ˆå¯èƒ½æ¯”è¾ƒæ½¦è‰ï¼Œæš‚æ—¶æ²¡èŠ±æ—¶é—´æ’ç‰ˆï¼‰ äºŒã€é¢˜ç›®ä¸€äº›é¢˜ç›®ä¼šè´´å‡ºé—®é¢˜æ–¹æ¡ˆï¼Œéƒ¨åˆ†æš‚æ—¶æ²¡æœ‰å½’çº³ï¼Œä¸è¿‡åœ¨æ­¤ç«™éƒ½èƒ½æœç´¢å¾—åˆ°ï¼Œæä¸‹ æœ¬ç«™é‡‡ç”¨å…¨æ–‡æœç´¢ï¼Œå¯ä»¥æ–¹ä¾¿çš„æ£€ç´¢åˆ°é—®é¢˜ä»¥åŠæ–¹æ¡ˆã€‚ æ•°æ®åº“ä¸‰èŒƒå¼ï¼ˆæ”¶é›†éœ€æ±‚å’Œæ€ä¹ˆè®¾è®¡æ•°æ®åº“çš„ï¼‰ Springã€SpringBootã€SpringCloudåŒºåˆ«ï¼Œå±•å¼€ Springç‰¹æ€§ç”¨æ³•ï¼Œäº‹åŠ¡ï¼Œjdbcæ¨¡æ¿ä¹‹ç±» SpringBooté›¶é…ç½®â€¦â€¦å¯ä»¥çš„è¯è‡ªå®šä¹‰é…ç½®èŠä¸‹ SpringCloudåˆ†ä¸¤éƒ¨åˆ†è¯´ï¼ˆnetfix,alibabaï¼‰ï¼Œæ¯ä¸ªç»„ä»¶ç”¨æ³•è¯´ä¸‹ï¼Œå¯ä»¥çš„è¯åŸç†å±•å¼€ä¸‹ Seata ID(1)+ç»„ä»¶(3)æ‰©å±•è¯´æ˜ï¼Œç”¨æ³•åŠåŒºåˆ« è¿™è¾¹IDç”¨åˆ°çš„é›ªèŠ±ç®—æ³•ï¼Œæ‡‚çš„è¯å¯ä»¥å±•å¼€ï¼Œå¦‚æœä¼šå†™çš„è¯ï¼Œè¯´å‡ºå®ç°ç®—æ³•çš„åŸç†æœ€ä½³ï¼Œä»¥åŠé›ªèŠ±çš„ç¼ºé™·ï¼ˆæ—¶é’Ÿé—®é¢˜ï¼‰ï¼Œè§£å†³æ–¹æ¡ˆ ä¸‰ä¸ªç»„ä»¶åŸç†æœ¬ç«™ä¹Ÿæœ‰å†™ æ•°æ®åº“ä¼˜åŒ–ï¼Œç´¢å¼•å¤±æ•ˆå“ªäº›æƒ…å†µ æ•°æ®åº“ï¼Œç‰©åŒ–è§†å›¾ ç‰©åŒ–è§†å›¾ä¸æ™®é€šçš„è§†å›¾ç›¸æ¯”çš„åŒºåˆ«æ˜¯ç‰©åŒ–è§†å›¾æ˜¯å»ºç«‹çš„å‰¯æœ¬ï¼Œå®ƒç±»ä¼¼äºä¸€å¼ è¡¨ï¼Œéœ€è¦å ç”¨å­˜å‚¨ç©ºé—´ã€‚è€Œå¯¹ä¸€ä¸ªç‰©åŒ–è§†å›¾æŸ¥è¯¢çš„æ‰§è¡Œæ•ˆç‡ä¸æŸ¥è¯¢ä¸€ä¸ªè¡¨æ˜¯ä¸€æ ·çš„ã€‚ å…¶å®å°±æ˜¯å­˜åœ¨ç‰©ç†å†…å­˜çš„å‰¯æœ¬è¡¨ï¼Œä½†æ˜¯æ€§èƒ½å’Œè§†å›¾ä¸€æ · æœ€è¿‘é¡¹ç›®æè¿°åŠå…¶å±•å¼€è¯´æ˜ï¼ˆè¿™ä¸ªä¸ç”¨å¤šè¯´äº†å§ï¼‰ åŒæ­¥é›†åˆç”¨è¿‡å“ªäº›ï¼Œè¯´æ˜ï¼Œä»¥åŠåˆ†å¸ƒå¼é”è¯´æ˜ è¿™è¾¹ä¹‹å‰æƒ³å±•å¼€AQSè¯´æ˜ä½†æ˜¯è®²äº†å¾ˆå¤šäº†å£å¹²èˆŒç‡¥çš„ï¼Œæ°´ä¹Ÿä¸å¤Ÿå–äº† ä¸€æ–¹é¢å¯¹åº•å±‚ä¹Ÿæ˜¯å¤§æ¦‚äº†è§£ï¼ŒFIFOå†…çš„Nodeæ·±å…¥APIçš„è¯æœªå¿…ç­”çš„å…¨é¢ åˆ†å¸ƒé”å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå®ç°å±•å¼€ï¼ˆluaã€redissionã€zookeeperï¼‰ï¼Œluaåˆåˆ†ä¸ºå•ä½“å’Œé›†ç¾¤éƒ½å¯ä»¥å±•å¼€è¯´æ˜ lua é›†ç¾¤å®ç°åˆ†å¸ƒå¼é”ï¼Œå¯ä»¥èŠä¸‹redlockï¼Œredissionåº•å±‚å°±æ˜¯â€¦.. redission åº•å±‚è‡ªæ—‹çš„çœ‹é—¨å£ç‹—(watchdog)æœºåˆ¶å¯ä»¥è¯´ä¸‹ esç”¨è¿‡è¯´ä¸‹ï¼Œå€’æ’ç´¢å¼•æœºåˆ¶åŸç†è¯´ä¸‹ å¤šçº¿ç¨‹æ‰©å±•èŠäº†CAS åŸºæœ¬ä»‹ç»ä¸‹CASï¼Œä¼˜ç¼ºç‚¹ï¼Œç¼ºç‚¹æ–¹æ¡ˆè§£å†³ å‡ ç§åŸå­ç±»è¯´æ˜ï¼Œè·Ÿvolatileå¯è§æ€§æ¯”è¾ƒ å¯ä»¥çš„è¯åŸå­ç±»åŸç†å±•å¼€ï¼ŒLongAdderå¿«çš„åŸå›  Synchronizedç”¨è¿‡å— å¯ä»¥çš„è¯è¯´æ˜ä¸‹ç”¨æ³•ï¼Œç„¶åå±•å¼€ä¸‹é”å‡çº§ï¼ˆæ— é”-åé”-è½»é”-é‡é”ï¼‰ å¯ä»¥æä¸‹JUCä¸­çš„è¯»å†™é”ï¼ˆReentrantReadWriteLockï¼‰ï¼Œå¤§æ¦‚è¯´ä¸‹è¯»å†™å››ç§æƒ…å†µä»¥åŠé”é™çº§ è‡ªè¿°å®Œè¯»å†™é”ï¼Œå¯ä»¥æä¸‹æ›´é«˜æ•ˆçš„é‚®æˆ³é”ï¼ˆStampedLockï¼‰ï¼Œä¼˜ç¼ºç‚¹è¯´ä¸‹ï¼Œç‰¹ç‚¹è¯´ä¸‹ï¼ˆåå­—å°±å¯ä»¥çœ‹å‡ºæ˜¯ä¸é‡å…¥é”ï¼‰ rediså‡»ç©¿ã€ç©¿é€ã€é›ªå´© è¯´ä¸‹æ˜¯ä»€ä¹ˆï¼Œè§£å†³æ–¹æ¡ˆ å¸ƒéš†è¿‡æ»¤å™¨å®ç°åŸç† å‚è€ƒæ–‡æ¡£ â†“ç‰©åŒ–è§†å›¾ï¼šhttps://baijiahao.baidu.com/s?id=1709212821591222829&amp;wfr=spider&amp;for=pc","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://mykkto.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"åŸç†","slug":"åŸç†","permalink":"https://mykkto.github.io/tags/%E5%8E%9F%E7%90%86/"},{"name":"java","slug":"java","permalink":"https://mykkto.github.io/tags/java/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://mykkto.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://mykkto.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"author":"mykk"},{"title":"ShardingSphereåˆ†åº“åˆ†è¡¨ã€ä½œåºŸã€‘","slug":"03-javaåˆ†å¸ƒå¼/05-jdbc/01_ShardingSphere","date":"2022-04-09T01:01:02.000Z","updated":"2023-06-11T02:53:45.151Z","comments":true,"path":"posts/97bfaea3.html","link":"","permalink":"https://mykkto.github.io/posts/97bfaea3.html","excerpt":"","text":"ä¸€ã€æ¦‚è¿°1ã€å­¦è‹±è¯­åšä¸»æ˜¯ä¸ªäºŒæµå­ï¼Œè‹±è¯­ä¸ä¼šä½†åˆæ ¼å¤–å–œæ¬¢ ShardingSphere(å¡è…š-è²å„¿)ã€åˆ†ç‰‡-çƒã€‘ã€Proxy(æ™®æ‹‰å…‹è°)ã€ä»£ç†ã€‘ 2ã€åˆ†åº“åˆ†è¡¨1ã€ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨åˆ†åº“åˆ†è¡¨å°±æ˜¯ä¸ºäº†è§£å†³ç”±äºæ•°æ®é‡è¿‡å¤§è€Œå¯¼è‡´æ•°æ®åº“æ€§èƒ½é™ä½çš„é—®é¢˜ï¼Œå°†åŸæ¥ç‹¬ç«‹çš„æ•°æ®åº“æ‹†åˆ†æˆè‹¥å¹²æ•°æ®åº“ç»„æˆï¼Œå°†æ•°æ®å¤§è¡¨æ‹†åˆ†æˆè‹¥å¹²æ•°æ®è¡¨ç»„æˆï¼Œä½¿å¾—å•ä¸€æ•°æ®åº“ã€å•ä¸€æ•°æ®è¡¨çš„æ•°æ®é‡å˜å°ï¼Œä»è€Œè¾¾åˆ°æå‡æ•°æ®åº“æ€§èƒ½çš„ç›®çš„ã€‚ 2ã€åˆ†åº“åˆ†è¡¨æ–¹å¼åˆ†åº“åˆ†è¡¨ åˆ†åº“åˆ†è¡¨åŒ…æ‹¬åˆ†åº“å’Œåˆ†è¡¨ä¸¤ä¸ªéƒ¨åˆ†ï¼š åœ¨ç”Ÿäº§ä¸­é€šå¸¸åŒ…æ‹¬ï¼šå‚ç›´åˆ†åº“ã€æ°´å¹³åˆ†åº“ã€å‚ç›´åˆ†è¡¨ã€æ°´å¹³åˆ†è¡¨å››ç§æ–¹å¼ã€‚ æ°´å¹³æ‹†åˆ†ï¼šæ ¹æ®è¡¨ä¸­æ•°æ®çš„é€»è¾‘å…³ç³»ï¼Œå°†è¡¨ä¸­çš„æ•°æ®æŒ‰ç…§æŸç§æ¡ä»¶æ‹†åˆ†åˆ°å¤šå°æ•°æ®åº“ä¸Šã€‚ å‚ç›´æ‹†åˆ†ï¼šæŠŠå•ä¸€çš„è¡¨æ‹†åˆ†æˆå¤šä¸ªè¡¨ï¼Œå¹¶åˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“ï¼ˆä¸»æœºï¼‰ä¸Š 2.1 å‚ç›´åˆ†åº“ 2.2 å‚ç›´åˆ†è¡¨ 2.3 æ°´å¹³åˆ†è¡¨ 2.4 æ°´å¹³åˆ†åº“ 3ã€ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨ä¸€èˆ¬çš„æœºå™¨ï¼ˆ4æ ¸16Gï¼‰ï¼Œå•åº“çš„MySQLå¹¶å‘ï¼ˆQPS+TPSï¼‰è¶…è¿‡äº†2kï¼Œç³»ç»ŸåŸºæœ¬å°±å®•æœºäº†ã€‚æœ€å¥½æ˜¯å¹¶å‘é‡æ§åˆ¶åœ¨1kå·¦å³ã€‚ QPSï¼šæ¯ç§’å¹¶å‘é‡ TPSï¼šæ¯ç§’ååé‡ åˆ†åº“åˆ†è¡¨ç›®çš„ï¼šè§£å†³é«˜å¹¶å‘ï¼Œå’Œæ•°æ®é‡å¤§çš„é—®é¢˜ã€‚ 4ã€åˆ†åº“åˆ†è¡¨çš„åœºæ™¯ï¼ˆ1ï¼‰åœ¨æ•°æ®åº“è®¾è®¡æ—¶å€™è€ƒè™‘å‚ç›´åˆ†åº“å’Œå‚ç›´åˆ†è¡¨ ï¼ˆ2ï¼‰éšç€æ•°æ®åº“æ•°æ®é‡å¢åŠ ï¼Œä¸è¦é©¬ä¸Šè€ƒè™‘åšæ°´å¹³åˆ‡åˆ†ï¼Œé¦–å…ˆè€ƒè™‘ç¼“å­˜å¤„ç†ï¼Œè¯»å†™åˆ†ç¦»ï¼Œä½¿ç”¨ç´¢å¼•ç­‰ç­‰æ–¹å¼ï¼Œå¦‚æœè¿™äº›æ–¹å¼ä¸èƒ½æ ¹æœ¬è§£å†³é—®é¢˜äº†ï¼Œ å†è€ƒè™‘åšæ°´å¹³åˆ†åº“å’Œæ°´å¹³åˆ†è¡¨ 5ã€åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„é—®é¢˜â€¢ äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜ â€¢ è·¨èŠ‚ç‚¹å…³è”æŸ¥è¯¢çš„é—®é¢˜ ( Join )ã€‚ â€¢ è·¨èŠ‚ç‚¹åˆ†é¡µã€åˆ†ç»„ã€æ’åºé—®é¢˜ã€‚ â€¢ å­˜åœ¨å¤šæ•°æ®æºç®¡ç†çš„é—®é¢˜ äºŒã€Sharding-JDBCå¿«é€Ÿå…¥é—¨å®˜ç½‘http://shardingsphere.apache.org/index_zh.html 1ã€åŸºæœ¬ä»‹ç»Sharding-JDBCæ˜¯å½“å½“ç½‘ç ”å‘çš„å¼€æºåˆ†å¸ƒå¼æ•°æ®åº“ä¸­é—´ä»¶ï¼Œä»3.0 å¼€å§‹Sharding-JDBC è¢«åŒ…å«åœ¨Sharding-Sphereä¸­ï¼Œ ä¹‹åè¯¥é¡¹ç›®è¿›å…¥è¿›å…¥Apacheå­µåŒ–å™¨ï¼Œ4.ç‰ˆæœ¬ä¹‹åçš„ç‰ˆæœ¬ä¸ºApacheç‰ˆæœ¬ã€‚ å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚ Sharding-JDBCæ¶æ„å›¾ï¼š Sharding-Proxyæ¶æ„å›¾ï¼š Sharding-Jdbcæ··åˆæ¶æ„ï¼š ShardingSphere-JDBC é‡‡ç”¨æ— ä¸­å¿ƒåŒ–æ¶æ„ï¼Œé€‚ç”¨äº Java å¼€å‘çš„é«˜æ€§èƒ½çš„è½»é‡çº§ OLTPï¼ˆè¿æ¥äº‹åŠ¡å¤„ç†ï¼‰ åº”ç”¨ï¼›ShardingSphere-Proxy æä¾›é™æ€å…¥å£ä»¥åŠå¼‚æ„è¯­è¨€çš„æ”¯æŒï¼Œé€‚ç”¨äº OLAPï¼ˆè¿æ¥æ•°æ®åˆ†æï¼‰ åº”ç”¨ä»¥åŠå¯¹åˆ†ç‰‡æ•°æ®åº“è¿›è¡Œç®¡ç†å’Œè¿ç»´çš„åœºæ™¯ã€‚ Apache ShardingSphere æ˜¯å¤šæ¥å…¥ç«¯å…±åŒç»„æˆçš„ç”Ÿæ€åœˆã€‚ é€šè¿‡æ··åˆä½¿ç”¨ ShardingSphere-JDBC å’Œ ShardingSphere-Proxyï¼Œå¹¶é‡‡ç”¨åŒä¸€æ³¨å†Œä¸­å¿ƒç»Ÿä¸€é…ç½®åˆ†ç‰‡ç­–ç•¥ï¼Œèƒ½å¤Ÿçµæ´»çš„æ­å»ºé€‚ç”¨äºå„ç§åœºæ™¯çš„åº”ç”¨ç³»ç»Ÿï¼Œä½¿å¾—æ¶æ„å¸ˆæ›´åŠ è‡ªç”±åœ°è°ƒæ•´é€‚åˆä¸å½“å‰ä¸šåŠ¡çš„æœ€ä½³ç³»ç»Ÿæ¶æ„ã€‚ ä¸jdbcæ€§èƒ½å¯¹æ¯” 2ã€éœ€æ±‚è¯´æ˜1ã€æ¡ˆä¾‹ä¸€ï¼šæ°´å¹³åˆ†è¡¨æ‰‹åŠ¨åˆ›å»ºä¸¤å¼ è¡¨ï¼Œt_order_1å’Œt_order_2ï¼Œè¿™ä¸¤å¼ è¡¨æ˜¯è®¢å•è¡¨ï¼Œæ‹†åˆ†åçš„è¡¨ï¼Œé€šè¿‡Sharding-Jdbcå‘è¯¾ç¨‹è¡¨æ’å…¥æ•°æ®ï¼ŒæŒ‰ç…§ä¸€å®šçš„åˆ†ç‰‡è§„åˆ™ï¼Œä¸»é”®ä¸ºå¶æ•°çš„è¿›å…¥t_order_1ï¼Œå¦ä¸€éƒ¨åˆ†æ•°æ®è¿›å…¥t_order_2ï¼Œé€šè¿‡Sharding-Jdbc æŸ¥è¯¢æ•°æ®ï¼Œæ ¹æ® SQLè¯­å¥çš„å†…å®¹ä»t_order_1æˆ–t_order_2æŸ¥è¯¢æ•°æ®ã€‚ 2ã€æ¡ˆä¾‹äºŒã€æ°´å¹³åˆ†åº“åœ¨æ¡ˆä¾‹ä¸€çš„åŸºç¡€ä¸Šï¼Œæ‰©å±•å‡ºä¸¤ä¸ªæ•°æ®åº“ï¼Œæ ¹æ® user_id å¶æ•°å…¥åº“ï¼Œsharding_jdbc1 å¥‡æ•°å…¥åº“ï¼Œsharding_jdbc2 3ã€æ¡ˆä¾‹ä¸‰ã€å‚ç›´åˆ†åº“æŒ‰ç…§ä¸šä½™å»åŒºåˆ†åº“ 3ã€é¡¹ç›®æ­å»º1ã€æŠ€æœ¯é€‰å‹springboot2.2.1+MybatisPlus+Sharding-JDBC+Druidè¿æ¥æ±  é˜¿é‡Œé•œåƒï¼šæ¯”è¾ƒå¿« https://start.aliyun.com/ å»ºè¡¨ ä¸¤å¼ ç»“æ„ä¸€æ · DROP TABLE IF EXISTS `course_1`; CREATE TABLE `course_1` ( `cid` bigint(20) NOT NULL COMMENT 'è¯¾ç¨‹id', `cname` VARCHAR(50) NOT NULL COMMENT 'è¯¾ç¨‹å', `user_id` bigint(20) NOT NULL COMMENT 'è¯¾ç¨‹è€å¸ˆ', `cstatus` varchar(10) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT 'è¯¾ç¨‹çŠ¶æ€', PRIMARY KEY (`cid`) USING BTREE ) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic; DROP TABLE IF EXISTS `course_2`; CREATE TABLE `course_2` ( `cid` bigint(20) NOT NULL COMMENT 'è¯¾ç¨‹id', `cname` VARCHAR(50) NOT NULL COMMENT 'è¯¾ç¨‹å', `user_id` bigint(20) NOT NULL COMMENT 'è¯¾ç¨‹è€å¸ˆ', `cstatus` varchar(10) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT 'è¯¾ç¨‹çŠ¶æ€', PRIMARY KEY (`cid`) USING BTREE ) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic; 2ã€å»ºmodel 3ã€å¯¼pom&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.20&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;4.0.0-RC1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.0.5&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 4ã€åŸºç¡€ä¸šåŠ¡ä»£ç 1ã€entirypackage com.kk.shardingjdbc.entiry; import lombok.Data; @Data public class Course { private Long cid; private String cname; private Long userId; private String cstatus; } 2ã€mapperpackage com.kk.shardingjdbc.mapper; import com.baomidou.mybatisplus.core.mapper.BaseMapper; import org.springframework.stereotype.Repository; @Repository public interface CourseMapper extends BaseMapper&lt;CourseMapper&gt; { } 3ã€æ‰«æé…ç½®package com.kk.shardingjdbc; import org.mybatis.spring.annotation.MapperScan; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication @MapperScan(\"com.kk.shardingjdbc.entiry.mapper\") public class ShardingjdbcApplication { public static void main(String[] args) { SpringApplication.run (ShardingjdbcApplication.class, args); } } 5ã€å†™ application.propertiesmysql æ•°æ®æº 8.0çš„è¯é©±åŠ¨åŒ…è·¯å¾„è¦åŠ  cjï¼Œcom.mysql.cj.jdbc.Driver urlè¦åŠ **æ—¶åŒº[?serverTimezone=GMT%2B8]**ï¼Œjdbc:mysql://localhost:3306/sharding_jdbc1?serverTimezone=GMT%2B8 # shardingåˆ†ç‰‡ç­–ç•¥ # é…ç½®æ•°æ®æºï¼Œç»™æ•°æ®æºèµ·åˆ«å spring.shardingsphere.datasource.names=s1 # é…ç½®æ•°æ®æºå…·ä½“å†…å®¹ï¼ŒåŒ…å«è¿æ¥æ± ï¼Œé©±åŠ¨ï¼Œåœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç  spring.shardingsphere.datasource.s1.type=com.alibaba.druid.pool.DruidDataSource spring.shardingsphere.datasource.s1.driver-class-name=com.mysql.jdbc.Driver spring.shardingsphere.datasource.s1.url=jdbc:mysql://localhost:3306/sharding_jdbc1 spring.shardingsphere.datasource.s1.username=root spring.shardingsphere.datasource.s1.password=a1b2c3 # æŒ‡å®š course è¡¨åˆ†å¸ƒæƒ…å†µï¼Œé…ç½®è¡¨åœ¨å“ªä¸ªæ•°æ®åº“é‡Œé¢ï¼Œè¡¨åç§°éƒ½æ˜¯ä»€ä¹ˆ s1.course_1 , s1.course_2 #course æ˜¯è¡¨çš„å‰ç¼€ï¼Œ {1,2}æ˜¯è¡¨çš„åç¼€ï¼Œè¡¨ç¤ºæœ‰course1 å’Œ course2 spring.shardingsphere.sharding.tables.course.actual-data-nodes=s1.course_$-&gt;{1..2} # æŒ‡å®š ä»¥courseä¸ºå‰ç¼€çš„è¡¨é‡Œé¢ä¸»é”® cid ã€‚ç”Ÿæˆç­–ç•¥ SNOWFLAKEï¼ˆé›ªèŠ±ç®—æ³•ï¼‰ spring.shardingsphere.sharding.tables.course.key-generator.column=cid spring.shardingsphere.sharding.tables.course.key-generator.type=SNOWFLAKE # æŒ‡å®šåˆ†ç‰‡ç­–ç•¥ï¼Œçº¦å®š cidå€¼ä¸ºå¶æ•°æ·»åŠ åˆ°è¡¨ course_1, å¥‡æ•°åˆ° course_2 #course æ˜¯è¡¨çš„å‰ç¼€ #ç¬¬äºŒè¡Œçš„å–æ¨¡åï¼Œ+1 æ“ä½œé˜²æ­¢å–æ¨¡åä¸º 0 spring.shardingsphere.sharding.tables.course.table-strategy.inline.sharding-column=cid spring.shardingsphere.sharding.tables.course.table-strategy.inline.algorithm-expression=course_$-&gt;{cid % 2 + 1} # æ‰“å¼€sql è¾“å‡ºæ—¥å¿— spring.shardingsphere.props.sql.show=true # è§£å†³ä¸€ä¸ªå®ä½“å¯¹åº”ä¸¤ä¸ªè¡¨é—®é¢˜ spring.main.allow-bean-definition-overriding=true 6ã€æµ‹è¯•ç±»package com.kk.shardingjdbc; import com.kk.shardingjdbc.entiry.Course; import com.kk.shardingjdbc.mapper.CourseMapper; import org.junit.jupiter.api.Test; import org.junit.runner.RunWith; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.test.context.junit4.SpringRunner; @RunWith(SpringRunner.class) @SpringBootTest class ShardingjdbcApplicationTests { @Autowired private CourseMapper courseMapper; @Test public void addCourse() { for (int i = 0; i &lt; 10; i++) { Course course = new Course ( ); course.setCname (\"java\"+i); course.setUserId (100L); course.setCstatus (\"Normal\"+i); courseMapper.insert (course); } } @Test public void searchCourse() { QueryWrapper&lt;Course&gt; wrapper = new QueryWrapper&lt;&gt; ( ); wrapper.eq (\"cid\",721132131354411008L); Course course = courseMapper.selectOne (wrapper); System.out.println (course ); } } 4ã€æ¡ˆä¾‹äºŒåŸºäºæ¡ˆä¾‹ä¸€æ‰©å±• 1ã€å½“å‰åº“ç»“æ„ 2ã€application.properties# shardingåˆ†ç‰‡ç­–ç•¥ # é…ç½®æ•°æ®æºï¼Œç»™æ•°æ®æºèµ·åˆ«å spring.shardingsphere.datasource.names=s1,s2 # é…ç½®æ•°æ®æºå…·ä½“å†…å®¹ï¼ŒåŒ…å«è¿æ¥æ± ï¼Œé©±åŠ¨ï¼Œåœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç  spring.shardingsphere.datasource.s1.type=com.alibaba.druid.pool.DruidDataSource spring.shardingsphere.datasource.s1.driver-class-name=com.mysql.cj.jdbc.Driver spring.shardingsphere.datasource.s1.url=jdbc:mysql://localhost:3306/sharding_jdbc1?serverTimezone=GMT%2B8 spring.shardingsphere.datasource.s1.username=root spring.shardingsphere.datasource.s1.password=a1b2c3 # é…ç½®æ•°æ®æºå…·ä½“å†…å®¹ï¼ŒåŒ…å«è¿æ¥æ± ï¼Œé©±åŠ¨ï¼Œåœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç  spring.shardingsphere.datasource.s2.type=com.alibaba.druid.pool.DruidDataSource spring.shardingsphere.datasource.s2.driver-class-name=com.mysql.cj.jdbc.Driver spring.shardingsphere.datasource.s2.url=jdbc:mysql://localhost:3306/sharding_jdbc2?serverTimezone=GMT%2B8 spring.shardingsphere.datasource.s2.username=root spring.shardingsphere.datasource.s2.password=a1b2c3 #--------------------------------------------------------------------------------------------------- # æŒ‡å®š course è¡¨åˆ†å¸ƒæƒ…å†µï¼Œé…ç½®è¡¨åœ¨å“ªä¸ªæ•°æ®åº“é‡Œé¢ï¼Œè¡¨åç§°éƒ½æ˜¯ä»€ä¹ˆ s1.course_1 , s1.course_2 #course æ˜¯è¡¨çš„å‰ç¼€ï¼Œ {1,2}æ˜¯è¡¨çš„åç¼€ï¼Œè¡¨ç¤ºæœ‰course1 å’Œ course2 #spring.shardingsphere.sharding.tables.course.actual-data-nodes=s1.course_$-&gt;{1..2} # é…ç½®ä¸¤ä¸ªæ•°æ®åº“ spring.shardingsphere.sharding.tables.course.actual-data-nodes=s$-&gt;{1..2}.course_$-&gt;{1..2} # æŒ‡å®š ä»¥courseä¸ºå‰ç¼€çš„è¡¨é‡Œé¢ä¸»é”® cid ã€‚ç”Ÿæˆç­–ç•¥ SNOWFLAKEï¼ˆé›ªèŠ±ç®—æ³•ï¼‰ spring.shardingsphere.sharding.tables.course.key-generator.column=cid spring.shardingsphere.sharding.tables.course.key-generator.type=SNOWFLAKE # æŒ‡å®šåˆ†ç‰‡ç­–ç•¥ï¼Œçº¦å®š cidå€¼ä¸ºå¶æ•°æ·»åŠ åˆ°è¡¨ course_1, å¥‡æ•°åˆ° course_2 #course æ˜¯è¡¨çš„å‰ç¼€ #ç¬¬äºŒè¡Œçš„å–æ¨¡åï¼Œ+1 æ“ä½œé˜²æ­¢å–æ¨¡åä¸º 0 spring.shardingsphere.sharding.tables.course.table-strategy.inline.sharding-column=cid spring.shardingsphere.sharding.tables.course.table-strategy.inline.algorithm-expression=course_$-&gt;{cid % 2 + 1} # æŒ‡å®šæ•°æ®åº“åˆ†ç‰‡ç­–ç•¥ #çº¦å®šuser_idæ˜¯å¶æ•°æ·»åŠ m1ï¼Œæ˜¯å¥‡æ•°æ·»åŠ m2 spring.shardingsphere.sharding.tables.course.database-strategy.inline.sharding-column=user_id spring.shardingsphere.sharding.tables.course.database-strategy.inline.algorithm-expression=s$-&gt;{user_id % 2 + 1} # æ‰“å¼€sql è¾“å‡ºæ—¥å¿— spring.shardingsphere.props.sql.show=true # è§£å†³ä¸€ä¸ªå®ä½“å¯¹åº”ä¸¤ä¸ªè¡¨é—®é¢˜ spring.main.allow-bean-definition-overriding=true 3ã€æµ‹è¯•package com.kk.shardingjdbc; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper; import com.kk.shardingjdbc.entiry.Course; import com.kk.shardingjdbc.mapper.CourseMapper; import org.junit.jupiter.api.Test; import org.junit.runner.RunWith; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.test.context.junit4.SpringRunner; @RunWith(SpringRunner.class) @SpringBootTest class ShardingjdbcApplicationTests { @Autowired private CourseMapper courseMapper; //----------------ä»¥ä¸‹æ˜¯æ°´å¹³åˆ†åº“æµ‹è¯• @Test public void add() { for (int i = 0; i &lt; 20; i++) { Course course = new Course ( ); course.setUserId (0L + i); course.setCname (\"java\" + i); course.setCstatus (\"Normal\" + i); courseMapper.insert (course); } } @Test public void delete() { QueryWrapper&lt;Course&gt; wrapper = new QueryWrapper&lt;&gt; ( ); wrapper.isNotNull (\"cid\"); courseMapper.delete (wrapper); } //----------------ä»¥ä¸‹æ˜¯æ°´å¹³åˆ†è¡¨æµ‹è¯• @Test public void addCourse() { for (int i = 0; i &lt; 10; i++) { Course course = new Course ( ); course.setCname (\"java\" + i); course.setUserId (100L); course.setCstatus (\"Normal\" + i); courseMapper.insert (course); } } @Test public void searchCourse() { QueryWrapper&lt;Course&gt; wrapper = new QueryWrapper&lt;&gt; ( ); wrapper.eq (\"cid\", 721132131354411008L); Course course = courseMapper.selectOne (wrapper); System.out.println (course); } } 5ã€æ¡ˆä¾‹ä¸‰1ã€å»ºè¡¨2ã€ä¸‰ã€Sharding-JDBCæ‰§è¡ŒåŸç†1ã€2ã€3ã€4ã€5ã€å››ã€åˆ†åº“åˆ†è¡¨åˆ†ç±»1ã€2ã€3ã€4ã€5ã€äº”ã€Mysqlä¸»ä»æ­å»ºè·¯ç”±ï¼šnacosé«˜å¯ç”¨æ­å»º å…­ã€è¯»å†™åˆ†ç¦»1ã€2ã€3ã€4ã€5ã€å‚è€ƒæ–‡æ¡£ â†“https://blog.csdn.net/unique_perfect/article/details/116134490 https://www.kuangstudy.com/zl/sharding#1369532356595126274","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://mykkto.github.io/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"}],"tags":[{"name":"ShardingSphere","slug":"ShardingSphere","permalink":"https://mykkto.github.io/tags/ShardingSphere/"},{"name":"åˆ†åº“åˆ†è¡¨","slug":"åˆ†åº“åˆ†è¡¨","permalink":"https://mykkto.github.io/tags/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/"},{"name":"jdbc","slug":"jdbc","permalink":"https://mykkto.github.io/tags/jdbc/"}],"author":"mykk"},{"title":"Luaè„šæœ¬è¯­è¨€åŸºç¡€","slug":"06-ç¼–ç¨‹è¯­è¨€åŸº/01-lua/01_lua","date":"2022-04-03T15:17:13.000Z","updated":"2023-06-11T02:53:45.141Z","comments":true,"path":"posts/fafe363a.html","link":"","permalink":"https://mykkto.github.io/posts/fafe363a.html","excerpt":"","text":"ä¸€ã€æ¦‚è¿°1ã€æ¦‚å¿µLuaæ˜¯ä¸€ç§è½»é‡ã€å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ã€‚è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åˆ°å…¶ä»–åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚ 2ã€ç‰¹æ€§è·Ÿå…¶ä»–è¯­è¨€è¿›è¡Œæ¯”è¾ƒï¼ŒLuaæœ‰å…¶è‡ªèº«çš„ç‰¹ç‚¹ï¼š ï¼ˆ1ï¼‰è½»é‡çº§ Luaç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ï¼Œç¼–è¯‘åä»…ä»…ä¸€ç™¾ä½™åƒå­—èŠ‚ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åµŒå…¥åˆ°å…¶ä»–ç¨‹åºä¸­ã€‚ ï¼ˆ2ï¼‰å¯æ‰©å±• Luaæä¾›éå¸¸ä¸°å¯Œæ˜“äºä½¿ç”¨çš„æ‰©å±•æ¥å£å’Œæœºåˆ¶ï¼Œç”±å®¿ä¸»è¯­è¨€(é€šå¸¸æ˜¯Cæˆ–C++)æä¾›åŠŸèƒ½ï¼ŒLuaå¯ä»¥ä½¿ç”¨å®ƒä»¬ï¼Œå°±åƒå†…ç½®çš„åŠŸèƒ½ä¸€æ ·ã€‚ ï¼ˆ3ï¼‰æ”¯æŒé¢å‘è¿‡ç¨‹ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹ 3ã€åº”ç”¨åœºæ™¯Luaåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­å¾—åˆ°å¤§é‡åº”ç”¨ï¼Œåœºæ™¯çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹: æ¸¸æˆå¼€å‘ã€ç‹¬ç«‹åº”ç”¨è„šæœ¬ã€webåº”ç”¨è„šæœ¬ã€æ‰©å±•å’Œæ•°æ®åº“æ’ä»¶ã€ç³»ç»Ÿå®‰å…¨ä¸Šã€‚ äºŒã€å®‰è£…1ã€å®˜ç½‘åœ¨linuxä¸Šå®‰è£…Luaéå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸‹è½½æºç åŒ…å¹¶åœ¨ç»ˆç«¯è§£å‹ã€ç¼–è¯‘å³å¯ä½¿ç”¨ã€‚ Luaçš„å®˜ç½‘åœ°å€ä¸º:https://www.lua.org 2ã€ä¸‹è½½å¹¶ä¸”è§£å‹1ã€ä¸‹è½½wget https://www.lua.org/ftp/lua-5.4.1.tar.gz 2ã€å®‰è£…ä¾èµ–libreadline-devä¾èµ–åŒ…ï¼Œéœ€è¦é€šè¿‡å‘½ä»¤æ¥è¿›è¡Œå®‰è£… yum install -y readline-devel 3ã€è§£å‹tar zxvf lua-5.4.1.tar.gz 4ã€ç¼–è¯‘å®‰è£…cd lua-5.4.1 make linux make install 5ã€éªŒè¯lua -v ä¸‰ã€Luaçš„è¯­æ³•1ã€ç¬¬ä¸€ä¸ªç¨‹åº1ã€è¿›å…¥æ§åˆ¶å°æ“ä½œ1ã€ç”¨ luaè¿›å…¥ 2ã€ç¼–å†™è¾“å‡ºè¯­å¥ï¼Œprint(â€œxxxxâ€) 3ã€ctrl+D é€€å‡ºæ§åˆ¶å° 2ã€lua æ–‡ä»¶è¿è¡Œ1ã€åˆ›å»º test.lua 2ã€ç¼–å†™è¯­å¥ï¼Œä¿å­˜ 3ã€è¿è¡Œ 3ã€luaç›´æ¥è¿è¡Œ 1ã€åˆ›å»º test2.lua 2ã€ç¼–å†™è¯­å¥çš„æ—¶å€™å‰ç¼€åŠ ä¸Šå£°æ˜ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ #!/usr/local/bin/lua 3ã€æ–‡ä»¶èµ‹æƒé™ï¼Œè¿è¡Œ chmod 755 test2.lua ./test2.lua 2ã€æ³¨é‡Š1ã€å•è¡Œæ³¨é‡Šçš„è¯­æ³•ä¸ºï¼š--æ³¨é‡Šå†…å®¹ 2ã€å¤šè¡Œæ³¨é‡Šçš„è¯­æ³•ä¸º:--[[ æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹ --]] 3ã€å–æ¶ˆå¤šè¡Œå¦‚æœæƒ³å–æ¶ˆå¤šè¡Œæ³¨é‡Šï¼Œåªéœ€è¦åœ¨ç¬¬ä¸€ä¸ªâ€“ä¹‹å‰åœ¨åŠ ä¸€ä¸ª-å³å¯ï¼Œå¦‚ï¼š ---[[ æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹ --]] 3ã€æ ‡è¯†ç¬¦æ¢å¥è¯è¯´æ ‡è¯†ç¬¦å°±æ˜¯æˆ‘ä»¬çš„å˜é‡åï¼ŒLuaå®šä¹‰å˜é‡åä»¥ä¸€ä¸ªå­—æ¯ A åˆ° Z æˆ– a åˆ° z æˆ–ä¸‹åˆ’çº¿ _ å¼€å¤´ååŠ ä¸Š0ä¸ªæˆ–å¤šä¸ªå­—æ¯ï¼Œä¸‹åˆ’çº¿ï¼Œæ•°å­—ï¼ˆ0åˆ°9ï¼‰ã€‚è¿™å—å»ºè®®å¤§å®¶æœ€å¥½ä¸è¦ä½¿ç”¨ä¸‹åˆ’çº¿åŠ å¤§å†™å­—æ¯çš„æ ‡è¯†ç¬¦ï¼Œå› ä¸ºLuaçš„ä¿ç•™å­—ä¹Ÿæ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œå®¹æ˜“å‘ç”Ÿå†²çªã€‚æ³¨æ„Luaæ˜¯åŒºåˆ†å¤§å°å†™å­—æ¯çš„ã€‚ ç®€å•æ¥è¯´å‚è€ƒjavaè§„èŒƒå°±å¥½ 4ã€å…³é”®å­—ä¸‹åˆ—æ˜¯Luaçš„å…³é”®å­—ï¼Œå¤§å®¶åœ¨å®šä¹‰å¸¸é‡ã€å˜é‡æˆ–å…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰æ ‡è¯†ç¬¦éƒ½è¦é¿å…ä½¿ç”¨ä»¥ä¸‹è¿™äº›å…³é”®å­—ï¼š and break do else elseif end false for function if in local nil not or repeat return then true until while goto ä¸€èˆ¬çº¦å®šï¼Œä»¥ä¸‹åˆ’çº¿å¼€å¤´è¿æ¥ä¸€ä¸²å¤§å†™å­—æ¯çš„åå­—ï¼ˆæ¯”å¦‚ _VERSIONï¼‰è¢«ä¿ç•™ç”¨äº Lua å†…éƒ¨å…¨å±€å˜é‡ã€‚è¿™ä¸ªä¹Ÿæ˜¯ä¸Šé¢æˆ‘ä»¬ä¸å»ºè®®è¿™ä¹ˆå®šä¹‰æ ‡è¯†ç¬¦çš„åŸå› ã€‚ 5ã€è¿ç®—ç¬¦Luaä¸­æ”¯æŒçš„è¿ç®—ç¬¦æœ‰ç®—æœ¯è¿ç®—ç¬¦ã€å…³ç³»è¿ç®—ç¬¦ã€é€»è¾‘è¿ç®—ç¬¦ã€å…¶ä»–è¿ç®—ç¬¦ã€‚ ç®—æœ¯è¿ç®—ç¬¦: + åŠ æ³• - å‡æ³• * ä¹˜æ³• / é™¤æ³• % å–ä½™ ^ ä¹˜å¹‚ - è´Ÿå· ä¾‹å¦‚: 10+20 --&gt;30 20-10 --&gt;10 10*20 --&gt;200 20/10 --&gt;2 3%2 --&gt;1 10^2 --&gt;100 -10 --&gt;-10 å…³ç³»è¿ç®—ç¬¦ == ç­‰äº ~= ä¸ç­‰äº &gt; å¤§äº &lt; å°äº &gt;= å¤§äºç­‰äº &lt;= å°äºç­‰äº ä¾‹å¦‚: 10==10 --&gt;true 10~=10 --&gt;false 20&gt;10 --&gt;true 20&lt;10 --&gt;false 20&gt;=10 --&gt;true 20&lt;=10 --&gt;false é€»è¾‘è¿ç®—ç¬¦ and é€»è¾‘ä¸ A and B &amp;&amp; or é€»è¾‘æˆ– A or B || not é€»è¾‘é å–åï¼Œå¦‚æœä¸ºtrue,åˆ™è¿”å›false ! é€»è¾‘è¿ç®—ç¬¦å¯ä»¥ä½œä¸ºifçš„åˆ¤æ–­æ¡ä»¶ï¼Œè¿”å›çš„ç»“æœå¦‚ä¸‹: A = true B = true A and B --&gt;true A or B --&gt;true not A --&gt;false ------------------------------------------------------------------------------------------------ A = true B = false A and B --&gt;false A or B --&gt;true not A --&gt;false ------------------------------------------------------------------------------------------------ A = false B = true A and B --&gt;false A or B --&gt;true not A --&gt;true å…¶ä»–è¿ç®—ç¬¦ .. è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸² # ä¸€å…ƒé¢„ç®—æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²æˆ–è¡¨çš„é•¿åº¦ ä¾‹å¦‚: &gt; \"HELLO \"..\"WORLD\" --&gt;HELLO WORLD &gt; #\"HELLO\" --&gt;5 6ã€å…¨å±€å˜é‡&amp;å±€éƒ¨å˜é‡åœ¨Luaè¯­è¨€ä¸­ï¼Œå…¨å±€å˜é‡æ— é¡»å£°æ˜å³å¯ä½¿ç”¨ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ€»æ˜¯è®¤ä¸ºæ˜¯å…¨å±€çš„ï¼Œå¦‚æœæœªæå‰èµ‹å€¼ï¼Œé»˜è®¤ä¸ºnil: è¦æƒ³å£°æ˜ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œéœ€è¦ä½¿ç”¨localæ¥å£°æ˜ 7ã€Luaæ•°æ®ç±»å‹Luaæœ‰8ä¸ªæ•°æ®ç±»å‹ nil(ç©ºï¼Œæ— æ•ˆå€¼) boolean(å¸ƒå°”ï¼Œtrue/false) number(æ•°å€¼) string(å­—ç¬¦ä¸²) function(å‡½æ•°) tableï¼ˆè¡¨ï¼‰ thread(çº¿ç¨‹) userdataï¼ˆç”¨æˆ·æ•°æ®ï¼‰ å¯ä»¥ä½¿ç”¨typeå‡½æ•°æµ‹è¯•ç»™å®šå˜é‡æˆ–è€…çš„ç±»å‹ï¼š print(type(nil)) --&gt;nil print(type(true)) --&gt; boolean print(type(1.1*1.1)) --&gt; number print(type(\"Hello world\")) --&gt; string print(type(type(X))) --&gt; string ï¼Œtypeå‡½æ•°è¿”å›çš„ä¹Ÿæ˜¯å­—ç¬¦ä¸²ç±»å‹ print(type(print)) --&gt; function print(type(type)) --&gt;function print(type{}) --&gt;table print(type(io.stdin)) --&gt;userdata nilnilæ˜¯ä¸€ç§åªæœ‰ä¸€ä¸ªnilå€¼çš„ç±»å‹ï¼Œå®ƒçš„ä½œç”¨å¯ä»¥ç”¨æ¥ä¸å…¶ä»–æ‰€æœ‰å€¼è¿›è¡ŒåŒºåˆ†ï¼Œä¹Ÿå¯ä»¥å½“æƒ³è¦ç§»é™¤ä¸€ä¸ªå˜é‡æ—¶ï¼Œåªéœ€è¦å°†è¯¥å˜é‡åèµ‹å€¼ä¸ºnil,åƒåœ¾å›æ”¶å°±ä¼šä¼šé‡Šæ”¾è¯¥å˜é‡æ‰€å ç”¨çš„å†…å­˜ã€‚ booleanbooleanç±»å‹å…·æœ‰ä¸¤ä¸ªå€¼ï¼Œtrueå’Œfalseã€‚booleanç±»å‹ä¸€èˆ¬è¢«ç”¨æ¥åšæ¡ä»¶åˆ¤æ–­çš„çœŸä¸å‡ã€‚åœ¨Luaè¯­è¨€ä¸­ï¼Œåªä¼šå°†falseå’Œnilè§†ä¸ºå‡ï¼Œå…¶ä»–çš„éƒ½è§†ä¸ºçœŸï¼Œç‰¹åˆ«æ˜¯åœ¨æ¡ä»¶æ£€æµ‹ä¸­0å’Œç©ºå­—ç¬¦ä¸²éƒ½ä¼šè®¤ä¸ºæ˜¯çœŸï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„å¤§å¤šæ•°è¯­è¨€ä¸å¤ªä¸€æ ·ã€‚ numberåœ¨Lua5.3ç‰ˆæœ¬å¼€å§‹ï¼ŒLuaè¯­è¨€ä¸ºæ•°å€¼æ ¼å¼æä¾›äº†ä¸¤ç§é€‰æ‹©:integer(æ•´å‹)å’Œfloat(åŒç²¾åº¦æµ®ç‚¹å‹)[å’Œå…¶ä»–è¯­è¨€ä¸å¤ªä¸€æ ·ï¼Œfloatä¸ä»£è¡¨å•ç²¾åº¦ç±»å‹]ã€‚ æ•°å€¼å¸¸é‡çš„è¡¨ç¤ºæ–¹å¼: &gt;4 --&gt;4 &gt;0.4 --&gt;0.4 &gt;4.75e-3 --&gt;0.00475 &gt;4.75e3 --&gt;4750 ä¸ç®¡æ˜¯æ•´å‹è¿˜æ˜¯åŒç²¾åº¦æµ®ç‚¹å‹ï¼Œä½¿ç”¨type()å‡½æ•°æ¥å–å…¶ç±»å‹ï¼Œéƒ½ä¼šè¿”å›çš„æ˜¯number &gt;type(3) --&gt;number &gt;type(3.3) --&gt;number æ‰€ä»¥å®ƒä»¬ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ï¼ŒåŒæ—¶ï¼Œå…·æœ‰ç›¸åŒç®—æœ¯å€¼çš„æ•´å‹å€¼å’Œæµ®ç‚¹å‹å€¼åœ¨Luaè¯­è¨€ä¸­æ˜¯ç›¸ç­‰çš„ stringLuaè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å³å¯ä»¥è¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€æ•´æœ¬ä¹¦ç±ã€‚åœ¨Luaè¯­è¨€ä¸­ï¼Œæ“ä½œ100Kæˆ–è€…1Mä¸ªå­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²çš„ç¨‹åºå¾ˆå¸¸è§ã€‚ å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·æ¥å£°æ˜å­—ç¬¦ä¸² &gt;a = \"hello\" &gt;b = 'world' &gt;print(a) --&gt;hello &gt;print(b) --&gt;world å¦‚æœå£°æ˜çš„å­—ç¬¦ä¸²æ¯”è¾ƒé•¿æˆ–è€…æœ‰å¤šè¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œå£°æ˜ html = [[ &lt;html&gt; &lt;head&gt; &lt;title&gt;Lua-string&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;a href=\"http://www.lua.org\"&gt;Lua&lt;/a&gt; &lt;/body&gt; &lt;/html&gt; ]] tableâ€‹ tableæ˜¯Luaè¯­è¨€ä¸­æœ€ä¸»è¦å’Œå¼ºå¤§çš„æ•°æ®ç»“æ„ã€‚ä½¿ç”¨è¡¨ï¼Œ Lua è¯­è¨€å¯ä»¥ä»¥ä¸€ç§ç®€å•ã€ç»Ÿä¸€ä¸”é«˜æ•ˆçš„æ–¹å¼è¡¨ç¤ºæ•°ç»„ã€é›†åˆã€è®°å½•å’Œå…¶ä»–å¾ˆå¤šæ•°æ®ç»“æ„ã€‚ Luaè¯­è¨€ä¸­çš„è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è¾…åŠ©æ•°ç»„ã€‚è¿™ç§æ•°ç»„æ¯”Javaä¸­çš„æ•°ç»„æ›´åŠ çµæ´»ï¼Œå¯ä»¥ä½¿ç”¨æ•°å€¼åšç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æˆ–å…¶ä»–ä»»æ„ç±»å‹çš„å€¼ä½œç´¢å¼•(é™¤nilå¤–)ã€‚ åˆ›å»ºè¡¨çš„æœ€ç®€å•æ–¹å¼: &gt; a = {} åˆ›å»ºæ•°ç»„: â€‹ æˆ‘ä»¬éƒ½çŸ¥é“æ•°ç»„å°±æ˜¯ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ æŒ‰ç…§ä¸€å®šé¡ºåºæ’åˆ—çš„é›†åˆï¼Œé‚£ä¹ˆä½¿ç”¨tableå¦‚ä½•åˆ›å»ºä¸€ä¸ªæ•°ç»„å‘¢? &gt;arr = {\"TOM\",\"JERRY\",\"ROSE\"} â€‹ è¦æƒ³è·å–æ•°ç»„ä¸­çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å†…å®¹æ¥è·å–: print(arr[0]) nil print(arr[1]) TOM print(arr[2]) JERRY print(arr[3]) ROSE â€‹ ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ•°ç»„çš„ä¸‹æ ‡é»˜è®¤æ˜¯ä»1å¼€å§‹çš„ã€‚æ‰€ä»¥ä¸Šè¿°åˆ›å»ºæ•°ç»„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥åˆ›å»º &gt;arr = {} &gt;arr[1] = \"TOM\" &gt;arr[2] = \"JERRY\" &gt;arr[3] = \"ROSE\" ä¸Šé¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œè¡¨çš„ç´¢å¼•å³å¯ä»¥æ˜¯æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç­‰å…¶ä»–çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç´¢å¼•æ›´æ”¹ä¸ºå­—ç¬¦ä¸²æ¥åˆ›å»º &gt;arr = {} &gt;arr[\"X\"] = 10 &gt;arr[\"Y\"] = 20 &gt;arr[\"Z\"] = 30 å½“ç„¶ï¼Œå¦‚æœæƒ³è¦è·å–è¿™äº›æ•°ç»„ä¸­çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ æ–¹å¼ä¸€ &gt;print(arr[\"X\"]) &gt;print(arr[\"Y\"]) &gt;print(arr[\"Z\"]) æ–¹å¼äºŒ &gt;print(arr.X) &gt;print(arr.Y) &gt;print(arr.Z) å½“å‰tableçš„çµæ´»ä¸è¿›äºæ­¤ï¼Œè¿˜æœ‰æ›´çµæ´»çš„å£°æ˜æ–¹å¼ &gt;arr = {\"TOM\",X=10,\"JERRY\",Y=20,\"ROSE\",Z=30} å¦‚ä½•è·å–ä¸Šé¢çš„å€¼? TOM : arr[1] 10 : arr[\"X\"] | arr.X JERRY: arr[2] 20 : arr[\"Y\"] | arr.Y ROESE? functionåœ¨ Luaè¯­è¨€ä¸­ï¼Œå‡½æ•°ï¼ˆ Function ï¼‰æ˜¯å¯¹è¯­å¥å’Œè¡¨è¾¾å¼è¿›è¡ŒæŠ½è±¡çš„ä¸»è¦æ–¹å¼ã€‚ å®šä¹‰å‡½æ•°çš„è¯­æ³•ä¸º: function functionName(params) end å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ä¸ªæ•°ä¸å®šä¹‰å‡½æ•°æ—¶ä½¿ç”¨çš„å‚æ•°ä¸ªæ•°ä¸ä¸€è‡´çš„æ—¶å€™ï¼ŒLua è¯­è¨€ä¼šé€šè¿‡ æŠ›å¼ƒå¤šä½™å‚æ•°å’Œå°†ä¸è¶³çš„å‚æ•°è®¾ä¸º nil çš„æ–¹å¼æ¥è°ƒæ•´å‚æ•°çš„ä¸ªæ•°ã€‚ function f(a,b) print(a,b) end f() --&gt; nil nil f(2) --&gt; 2 nil f(2,6) --&gt; 2 6 f(2.6.8) --&gt; 2 6 (8è¢«ä¸¢å¼ƒ) å¯å˜é•¿å‚æ•°å‡½æ•° function add(...) a,b,c=... print(a) print(b) print(c) end add(1,2,3) --&gt; 1 2 3 å‡½æ•°è¿”å›å€¼å¯ä»¥æœ‰å¤šä¸ªï¼Œè¿™ç‚¹å’ŒJavaä¸å¤ªä¸€æ · function f(a,b) return a,b end x,y=f(11,22) --&gt; x=11,y=22 threadthreadç¿»è¯‘è¿‡æ¥æ˜¯çº¿ç¨‹çš„æ„æ€ï¼Œåœ¨Luaä¸­ï¼Œthreadç”¨æ¥è¡¨ç¤ºæ‰§è¡Œçš„ç‹¬ç«‹çº¿è·¯ï¼Œç”¨æ¥æ‰§è¡ŒååŒç¨‹åºã€‚ userdatauserdataæ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œç”¨äºè¡¨ç¤ºä¸€ç§ç”±åº”ç”¨ç¨‹åºæˆ–C/C++è¯­è¨€åº“æ‰€åˆ›å»ºçš„ç±»å‹ã€‚ 8ã€Luaæ§åˆ¶ç»“æ„Lua è¯­è¨€æä¾›äº†ä¸€ç»„ç²¾ç®€ä¸”å¸¸ç”¨çš„æ§åˆ¶ç»“æ„ï¼ŒåŒ…æ‹¬ç”¨äºæ¡ä»¶æ‰§è¡Œçš„è¯ ä»¥åŠç”¨äºå¾ªç¯çš„ whileã€ repeat å’Œ forã€‚ æ‰€æœ‰çš„æ§åˆ¶ç»“æ„è¯­æ³•ä¸Šéƒ½æœ‰ä¸€ä¸ªæ˜¾å¼çš„ç»ˆç»“ç¬¦ï¼š end ç”¨äºç»ˆç»“ ifã€ for åŠ while ç»“æ„ï¼Œ until ç”¨äºç»ˆç»“ repeat ç»“æ„ã€‚ if then elseif elseifè¯­å¥å…ˆæµ‹è¯•å…¶æ¡ä»¶ï¼Œå¹¶æ ¹æ®æ¡ä»¶æ˜¯å¦æ»¡è¶³æ‰§è¡Œç›¸åº”çš„ then éƒ¨åˆ†æˆ– else éƒ¨åˆ†ã€‚ else éƒ¨åˆ† æ˜¯å¯é€‰çš„ã€‚ function testif(a) if a&gt;0 then print(\"aæ˜¯æ­£æ•°\") end end function testif(a) if a&gt;0 then print(\"aæ˜¯æ­£æ•°\") else print(\"aæ˜¯è´Ÿæ•°\") end end å¦‚æœè¦ç¼–å†™åµŒå¥—çš„ if è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨ elseifã€‚ å®ƒç±»ä¼¼äºåœ¨ else åé¢ç´§è·Ÿä¸€ä¸ªifã€‚æ ¹æ®ä¼ å…¥çš„å¹´é¾„è¿”å›ä¸åŒçš„ç»“æœï¼Œå¦‚ age&lt;=18 é’å°‘å¹´ï¼Œ age&gt;18 , age &lt;=45 é’å¹´ age&gt;45 , age&lt;=60 ä¸­å¹´äºº age&gt;60 è€å¹´äºº function show(age) if age&lt;=18 then return \"é’å°‘å¹´\" elseif age&gt;18 and age&lt;=45 then return \"é’å¹´\" elseif age&gt;45 and age&lt;=60 then return \"ä¸­å¹´äºº\" elseif age&gt;60 then return \"è€å¹´äºº\" end end whileå¾ªç¯é¡¾åæ€ä¹‰ï¼Œå½“æ¡ä»¶ä¸ºçœŸæ—¶ while å¾ªç¯ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ã€‚ Lua è¯­è¨€å…ˆæµ‹è¯• while è¯­å¥ çš„æ¡ä»¶ï¼Œè‹¥æ¡ä»¶ä¸ºå‡åˆ™å¾ªç¯ç»“æŸï¼›å¦åˆ™ï¼Œ Lua ä¼šæ‰§è¡Œå¾ªç¯ä½“å¹¶ä¸æ–­åœ°é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚ è¯­æ³•ï¼š while æ¡ä»¶ do å¾ªç¯ä½“ end ä¾‹å­:å®ç°æ•°ç»„çš„å¾ªç¯ function testWhile() local i = 1 while i&lt;=10 do print(i) i=i+1 end end repeatå¾ªç¯é¡¾åæ€ä¹‰ï¼Œ repeat-untilè¯­å¥ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ç›´åˆ°æ¡ä»¶ä¸ºçœŸæ—¶ç»“æŸã€‚ ç”±äºæ¡ä»¶æµ‹è¯•åœ¨å¾ªç¯ä½“ä¹‹åæ‰§è¡Œï¼Œæ‰€ä»¥å¾ªç¯ä½“è‡³å°‘ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ è¯­æ³• repeat å¾ªç¯ä½“ until æ¡ä»¶ function testRepeat() local i = 10 repeat print(i) i=i-1 until i &lt; 1 end forå¾ªç¯æ•°å€¼å‹forå¾ªç¯ è¯­æ³• for param=exp1,exp2,exp3 do å¾ªç¯ä½“ end paramçš„å€¼ä»exp1å˜åŒ–åˆ°exp2ä¹‹å‰çš„æ¯æ¬¡å¾ªç¯ä¼šæ‰§è¡Œ å¾ªç¯ä½“ï¼Œå¹¶åœ¨æ¯æ¬¡å¾ªç¯ç»“æŸåå°†æ­¥é•¿(step)exp3å¢åŠ åˆ°paramä¸Šã€‚exp3å¯é€‰ï¼Œå¦‚æœä¸è®¾ç½®é»˜è®¤ä¸º1 äººè¯ï¼šä»è¾“å‡º1å¼€å§‹ï¼Œæ¯æ¬¡ +10ï¼Œå°äº100ï¼ˆ1ï¼Œ11ï¼Œ21ï¼Œâ€¦,91ï¼‰ for i = 1,100,10 do print(i) end æ³›å‹forå¾ªç¯ æ³›å‹forå¾ªç¯é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°æ¥éå†æ‰€æœ‰å€¼ï¼Œç±»ä¼¼äºjavaä¸­çš„foreachè¯­å¥ã€‚ è¯­æ³• for i,v in ipairs(x) do å¾ªç¯ä½“ end iæ˜¯æ•°ç»„ç´¢å¼•å€¼ï¼Œvæ˜¯å¯¹åº”ç´¢å¼•çš„æ•°ç»„å…ƒç´ å€¼ï¼Œipairsæ˜¯Luaæä¾›çš„ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°ï¼Œç”¨æ¥è¿­ä»£æ•°ç»„ï¼Œxæ˜¯è¦éå†çš„æ•°ç»„ã€‚ ä¾‹å¦‚: arr = {\"TOME\",\"JERRY\",\"ROWS\",\"LUCY\"} for i,v in ipairs(arr) do print(i,v) end ä¸Šè¿°å®ä¾‹è¾“å‡ºçš„ç»“æœä¸º 1 TOM 2 JERRY 3 ROWS 4 LUCY ä½†æ˜¯å¦‚æœå°†arrçš„å€¼è¿›è¡Œä¿®æ”¹ä¸º arr = {\"TOME\",\"JERRY\",\"ROWS\",x=\"JACK\",\"LUCY\"} åŒæ ·çš„ä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±åªèƒ½çœ‹åˆ°å’Œä¹‹å‰ä¸€æ ·çš„ç»“æœï¼Œè€Œå…¶ä¸­çš„xä¸ºJACKå°±æ— æ³•éå†å‡ºæ¥ï¼Œç¼ºå¤±äº†æ•°æ®ï¼Œå¦‚æœè§£å†³å‘¢? æˆ‘ä»¬å¯ä»¥å°†è¿­ä»£å™¨å‡½æ•°å˜æˆpairs,å¦‚ for i,v in pairs(arr) do print(i,v) end ä¸Šè¿°å®ä¾‹å°±è¾“å‡ºçš„ç»“æœä¸º 1 TOM 2 JERRY 3 ROWS 4 LUCY x JACK å››ã€OpenResty1ã€åŸºæœ¬æ“ä½œ1ã€æ˜¯ä»€ä¹ˆOpenRestyæ˜¯ä¸€ä¸ªåŸºäºNginxä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚æ‰€ä»¥æœ¬èº«OpenRestyå†…éƒ¨å°±å·²ç»é›†æˆäº†Nginxå’ŒLuaï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ã€‚ 2ã€å®‰è£…è¯¦æƒ…å¯è§ã€OpenRestyã€‘ 1ã€æ‹‰å–docker pull openresty/openresty 2ã€æŒ‚è½½å¹¶å¯åŠ¨è¯´æ˜ä¸‹ï¼š å®Œå…¨åŸºäºä¸Šé¢çš„nginxé…ç½®çš„ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå”¯ä¸€ä¿®æ”¹çš„æ˜¯ nginx.confé…ç½®æ–‡ä»¶ï¼Œè¿™è¾¹æŒ‚è½½æ”¹æˆäº† nginx2.confï¼Œç”¨äºä¿ç•™ä¹‹å‰çš„ï¼ˆè‡ªå·±æ‡’è€Œå·²ï¼‰ æ–°å¢äº†ï¼Œluaæ–‡ä»¶æŒ‚è½½ ä¿®æ”¹äº†å®¹å™¨å†…çš„æŒ‚è½½ä½ç½®ï¼Œå› ä¸º openrestyå®¹å™¨ä½ç½®ä¸ä¸€æ ·äº†(å¤–éƒ¨è¿˜æ˜¯ä¸å˜ï¼Œå®¹å™¨å†…çš„ä½ç½®å˜äº†) docker run -d -p 443:443 -p 80:80 --name openresty -v /root/nginx/www:/usr/local/openresty/nginx/html -v /root/nginx/conf/nginx2.conf:/usr/local/openresty/nginx/conf/nginx.conf -v /root/nginx/logs:/usr/local/openresty/nginx/logs -v /root/nginx/lls/:/usr/local/openresty/nginx/ssl -v /root/nginx/lua/:/usr/local/openresty/nginx/lua openresty/openresty 2ã€ngx_luaçš„ä½¿ç”¨ä½¿ç”¨Luaç¼–å†™Nginxè„šæœ¬çš„åŸºæœ¬æ„å»ºå—æ˜¯æŒ‡ä»¤ã€‚æŒ‡ä»¤ç”¨äºæŒ‡å®šä½•æ—¶è¿è¡Œç”¨æˆ·Luaä»£ç ä»¥åŠå¦‚ä½•ä½¿ç”¨ç»“æœã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æ‰§è¡ŒæŒ‡ä»¤çš„é¡ºåºã€‚ å…ˆæ¥è§£é‡Šä¸‹*çš„ä½œç”¨ *ï¼šæ—  ï¼Œ å³ xxx_by_lua ,æŒ‡ä»¤åé¢è·Ÿçš„æ˜¯ luaæŒ‡ä»¤ *:_fileï¼Œå³ xxx_by_lua_file æŒ‡ä»¤åé¢è·Ÿçš„æ˜¯ luaæ–‡ä»¶ *:_block,å³ xxx_by_lua_block åœ¨0.9.17ç‰ˆåæ›¿æ¢init_by_lua_file init_by_lua*è¯¥æŒ‡ä»¤åœ¨æ¯æ¬¡Nginxé‡æ–°åŠ è½½é…ç½®æ—¶æ‰§è¡Œï¼Œå¯ä»¥ç”¨æ¥å®Œæˆä¸€äº›è€—æ—¶æ¨¡å—çš„åŠ è½½ï¼Œæˆ–è€…åˆå§‹åŒ–ä¸€äº›å…¨å±€é…ç½®ã€‚ init_worker_by_lua*è¯¥æŒ‡ä»¤ç”¨äºå¯åŠ¨ä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œå¦‚å¿ƒè·³æ£€æŸ¥ã€å®šæ—¶æ‹‰å–æœåŠ¡å™¨é…ç½®ç­‰ã€‚ set_by_lua*è¯¥æŒ‡ä»¤åªè¦ç”¨æ¥åšå˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¸€æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶å°†ç»“æœèµ‹å€¼ç»™Nginxä¸­æŒ‡å®šçš„å˜é‡ã€‚ rewrite_by_lua*è¯¥æŒ‡ä»¤ç”¨äºæ‰§è¡Œå†…éƒ¨URLé‡å†™æˆ–è€…å¤–éƒ¨é‡å®šå‘ï¼Œå…¸å‹çš„å¦‚ä¼ªé™æ€åŒ–URLé‡å†™ï¼Œæœ¬é˜¶æ®µåœ¨rewriteå¤„ç†é˜¶æ®µçš„æœ€åé»˜è®¤æ‰§è¡Œã€‚ access_by_lua*è¯¥æŒ‡ä»¤ç”¨äºè®¿é—®æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªå…è®¸å†…ç½‘IPè®¿é—®ã€‚ content_by_lua*è¯¥æŒ‡ä»¤æ˜¯åº”ç”¨æœ€å¤šçš„æŒ‡ä»¤ï¼Œå¤§éƒ¨åˆ†ä»»åŠ¡æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µå®Œæˆçš„ï¼Œå…¶ä»–çš„è¿‡ç¨‹å¾€å¾€ä¸ºè¿™ä¸ªé˜¶æ®µå‡†å¤‡æ•°æ®ï¼Œæ­£å¼å¤„ç†åŸºæœ¬éƒ½åœ¨æœ¬é˜¶æ®µã€‚ header_filter_by_lua*è¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®åº”ç­”æ¶ˆæ¯çš„å¤´éƒ¨ä¿¡æ¯ã€‚ body_filter_by_lua*è¯¥æŒ‡ä»¤æ˜¯å¯¹å“åº”æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æˆªæ–­ã€æ›¿æ¢ã€‚ log_by_lua*è¯¥æŒ‡ä»¤ç”¨äºåœ¨logè¯·æ±‚å¤„ç†é˜¶æ®µï¼Œç”¨Luaä»£ç å¤„ç†æ—¥å¿—ï¼Œä½†å¹¶ä¸æ›¿æ¢åŸæœ‰logå¤„ç†ã€‚ balancer_by_lua*è¯¥æŒ‡ä»¤ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç°ä¸Šæ¸¸æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å™¨ç®—æ³• ssl_certificate_by_*è¯¥æŒ‡ä»¤ä½œç”¨åœ¨Nginxå’Œä¸‹æ¸¸æœåŠ¡å¼€å§‹ä¸€ä¸ªSSLæ¡æ‰‹æ“ä½œæ—¶å°†å…è®¸æœ¬é…ç½®é¡¹çš„Luaä»£ç ã€‚ éœ€æ±‚:http://192.168.200.133?name=å¼ ä¸‰&amp;gender=1 Nginxæ¥æ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ®genderä¼ å…¥çš„å€¼ï¼Œå¦‚æœgenderä¼ å…¥çš„æ˜¯1ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤º å¼ ä¸‰å…ˆç”Ÿ,å¦‚æœgenderä¼ å…¥çš„æ˜¯0ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰å¥³å£«,å¦‚æœæœªä¼ æˆ–è€…ä¼ å…¥çš„ä¸æ˜¯1å’Œ2åˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰ã€‚ å®ç°ä»£ç  æ³¨æ„ï¼šåŠ å…¥é…ç½®æ–‡ä»¶çš„æ—¶å€™ #å†…å®¹è¦å»æ‰ location /getByGender { default_type 'text/html'; set_by_lua $name \" #è·å–è¯·æ±‚urlä¸Šçš„å€¼ nameï¼Œgender local uri_args = ngx.req.get_uri_args() gender = uri_args['gender'] name = uri_args['name'] if gender=='1' then return name..'å…ˆç”Ÿ' elseif gender=='0' then return name..'å¥³å£«' else return name end \"; #è§£å†³ä¹±ç é—®é¢˜ charset utf-8; return 200 $name; } 3ã€ngx_luaæ“ä½œRedis1ã€ApiåŠå…¶è¯­å¥è¯´æ˜lua-resty-redisæä¾›äº†è®¿é—®Redisçš„è¯¦ç»†APIï¼ŒåŒ…æ‹¬åˆ›å»ºå¯¹æ¥ã€è¿æ¥ã€æ“ä½œã€æ•°æ®å¤„ç†ç­‰ã€‚è¿™äº›APIåŸºæœ¬ä¸Šä¸Redisçš„æ“ä½œä¸€ä¸€å¯¹åº”ã€‚ ï¼ˆ1ï¼‰redis = require \"resty.redis\" ï¼ˆ2ï¼‰new è¯­æ³•: redis,err = redis:new(),åˆ›å»ºä¸€ä¸ªRediså¯¹è±¡ã€‚ ï¼ˆ3ï¼‰connect è¯­æ³•:ok,err=redis:connect(host,port[,options_table]),è®¾ç½®è¿æ¥Redisçš„è¿æ¥ä¿¡æ¯ã€‚ ok:è¿æ¥æˆåŠŸè¿”å› 1ï¼Œè¿æ¥å¤±è´¥è¿”å›nil err:è¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ ï¼ˆ4ï¼‰set_timeout è¯­æ³•: redis:set_timeout(time) ï¼Œè®¾ç½®è¯·æ±‚æ“ä½œRedisçš„è¶…æ—¶æ—¶é—´ã€‚ ï¼ˆ5ï¼‰close è¯­æ³•: ok,err = redis:close(),å…³é—­å½“å‰è¿æ¥ï¼ŒæˆåŠŸè¿”å›1ï¼Œå¤±è´¥è¿”å›nilå’Œé”™è¯¯ä¿¡æ¯ ï¼ˆ6ï¼‰rediså‘½ä»¤å¯¹åº”çš„æ–¹æ³• åœ¨lua-resty-redisä¸­ï¼Œæ‰€æœ‰çš„Rediså‘½ä»¤éƒ½æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œæ–¹æ³•åå­—å’Œå‘½ä»¤åå­—ç›¸åŒï¼Œåªæ˜¯å…¨éƒ¨ä¸ºå°å†™ã€‚ 2ã€å®ç°location /testRedis { default_type \"text/html\"; content_by_lua_block{ local redis = require \"resty.redis\" -- å¼•å…¥Redis local redisObj = redis:new() --åˆ›å»ºRediså¯¹è±¡ redisObj:set_timeout(1000) --è®¾ç½®è¶…æ—¶æ•°æ®ä¸º1s local ok,err = redisObj:connect(\"10.0.4.7\",6379) --è®¾ç½®redisè¿æ¥ä¿¡æ¯ï¼Œè¿™è¾¹ä¸è¦ç”¨127.0.0.1 if not ok then --åˆ¤æ–­æ˜¯å¦è¿æ¥æˆåŠŸ ngx.say(\"failed to connection redis\",err) return end ok,err = redisObj:set(\"username\",\"TOM\")--å­˜å…¥æ•°æ® if not ok then --åˆ¤æ–­æ˜¯å¦å­˜å…¥æˆåŠŸ ngx.say(\"failed to set username\",err) return end local res,err = redisObj:get(\"username\") --ä»redisä¸­è·å–æ•°æ® ngx.say(res) --å°†æ•°æ®å†™ä¼šæ¶ˆæ¯ä½“ä¸­ redisObj:close() } } 4ã€ngx_luaæ“ä½œMysql1ã€æŸ¥è¯¢1ã€å‡†å¤‡driverClass=com.mysql.jdbc.Driver url=jdbc:mysql://10.0.4.7:3306/nginx_db username=root password=root 2ã€å»ºåº“ create table users( id int primary key auto_increment, username varchar(30), birthday date, salary double ); insert into users(id,username,birthday,salary) values(null,\"TOM\",\"1988-11-11\",10000.0); insert into users(id,username,birthday,salary) values(null,\"JERRY\",\"1989-11-11\",20000.0); insert into users(id,username,birthday,salary) values(null,\"ROWS\",\"1990-11-11\",30000.0); insert into users(id,username,birthday,salary) values(null,\"LUCY\",\"1991-11-11\",40000.0); insert into users(id,username,birthday,salary) values(null,\"JACK\",\"1992-11-11\",50000.0); 3ã€Apiè¯¦è§£ï¼ˆ1ï¼‰å¼•å…¥\"resty.mysql\"æ¨¡å— local mysql = require \"resty.mysql\" ï¼ˆ2ï¼‰new åˆ›å»ºä¸€ä¸ªMySQLè¿æ¥å¯¹è±¡ï¼Œé‡åˆ°é”™è¯¯æ—¶ï¼Œdbä¸ºnilï¼Œerrä¸ºé”™è¯¯æè¿°ä¿¡æ¯ è¯­æ³•: db,err = mysql:new() ï¼ˆ3ï¼‰connect å°è¯•è¿æ¥åˆ°ä¸€ä¸ªMySQLæœåŠ¡å™¨ è¯­æ³•:ok,err=db:connect(options),optionsæ˜¯ä¸€ä¸ªå‚æ•°çš„Luaè¡¨ç»“æ„ï¼Œé‡Œé¢åŒ…å«æ•°æ®åº“è¿æ¥çš„ç›¸å…³ä¿¡æ¯ host:æœåŠ¡å™¨ä¸»æœºåæˆ–IPåœ°å€ port:æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º3306 user:ç™»å½•çš„ç”¨æˆ·å password:ç™»å½•å¯†ç  database:ä½¿ç”¨çš„æ•°æ®åº“å ï¼ˆ4ï¼‰set_timeout è®¾ç½®å­è¯·æ±‚çš„è¶…æ—¶æ—¶é—´(ms)ï¼ŒåŒ…æ‹¬connectæ–¹æ³• è¯­æ³•:db:set_timeout(time) ï¼ˆ5ï¼‰close å…³é—­å½“å‰MySQLè¿æ¥å¹¶è¿”å›çŠ¶æ€ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›1ï¼›å¦‚æœå‡ºç°ä»»ä½•é”™è¯¯ï¼Œåˆ™å°†è¿”å›nilå’Œé”™è¯¯æè¿°ã€‚ è¯­æ³•:db:close() ï¼ˆ6ï¼‰send_query å¼‚æ­¥å‘è¿œç¨‹MySQLå‘é€ä¸€ä¸ªæŸ¥è¯¢ã€‚å¦‚æœæˆåŠŸåˆ™è¿”å›æˆåŠŸå‘é€çš„å­—èŠ‚æ•°ï¼›å¦‚æœé”™è¯¯ï¼Œåˆ™è¿”å›nilå’Œé”™è¯¯æè¿° è¯­æ³•:bytes,err=db:send_query(sql) ï¼ˆ7ï¼‰read_result ä»MySQLæœåŠ¡å™¨è¿”å›ç»“æœä¸­è¯»å–ä¸€è¡Œæ•°æ®ã€‚resè¿”å›ä¸€ä¸ªæè¿°OKåŒ…æˆ–ç»“æœé›†åŒ…çš„Luaè¡¨,è¯­æ³•: res, err, errcode, sqlstate = db:read_result() res, err, errcode, sqlstate = db:read_result(rows) :rowsæŒ‡å®šè¿”å›ç»“æœé›†çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ä¸º4 å¦‚æœæ˜¯æŸ¥è¯¢ï¼Œåˆ™è¿”å›ä¸€ä¸ªå®¹çº³å¤šè¡Œçš„æ•°ç»„ã€‚æ¯è¡Œæ˜¯ä¸€ä¸ªæ•°æ®åˆ—çš„key-valueå¯¹ï¼Œå¦‚ { {id=1,username=\"TOM\",birthday=\"1988-11-11\",salary=10000.0}, {id=2,username=\"JERRY\",birthday=\"1989-11-11\",salary=20000.0} } å¦‚æœæ˜¯å¢åˆ æ”¹ï¼Œåˆ™è¿”å›ç±»ä¸Šå¦‚ä¸‹æ•°æ® { insert_id = 0, server_status=2, warning_count=1, affected_rows=2, message=nil } è¿”å›å€¼: res:æ“ä½œçš„ç»“æœé›† err:é”™è¯¯ä¿¡æ¯ errcode:MySQLçš„é”™è¯¯ç ï¼Œæ¯”å¦‚1064 sqlstate:è¿”å›ç”±5ä¸ªå­—ç¬¦ç»„æˆçš„æ ‡å‡†SQLé”™è¯¯ç ï¼Œæ¯”å¦‚42000 4ã€å®ç°location /mysqlSearch{ default_type 'text/html'; content_by_lua_block{ local mysql = require \"resty.mysql\" local db = mysql:new() local ok,err = db:connect{ host=\"10.0.4.7\", #ä¸è¦ç”¨127.0.0.1 port=3306, user=\"root\", password=\"root\", database=\"lua_db\" } db:set_timeout(1000) db:send_query(\"select * from users where id =1\") local res,err,errcode,sqlstate = db:read_result() ngx.say(res[1].id..\",\"..res[1].username..\",\"..res[1].birthday..\",\"..res[1].salary) db:close() } } 5ã€ğŸ¤ä¼˜åŒ–:location /mysqlSearch { default_type 'text/html'; content_by_lua_block{ local mysql = require \"resty.mysql\" local db = mysql:new() local ok,err = db:connect{ host=\"10.0.4.7\", port=3306, user=\"root\", password=\"root\", database=\"lua_db\" } db:set_timeout(1000) local uri_args = ngx.req.get_uri_args() local reqId = uri_args['id'] db:send_query(\"select * from users where id =\"..reqId) local res,err,errcode,sqlstate = db:read_result() ngx.say(res[1].id..\",\"..res[1].username..\",\"..res[1].birthday..\",\"..res[1].salary) db:close() } } 6ã€ğŸ›°lua-cjsonread_result()å¾—åˆ°çš„ç»“æœreséƒ½æ˜¯tableç±»å‹ï¼Œè¦æƒ³åœ¨é¡µé¢ä¸Šå±•ç¤ºï¼Œå°±å¿…é¡»çŸ¥é“tableçš„å…·ä½“æ•°æ®ç»“æ„æ‰èƒ½è¿›è¡Œéå†è·å–ã€‚å¤„ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸€ç§ç®€å•æ–¹å¼cjsonï¼Œä½¿ç”¨å®ƒå°±å¯ä»¥å°†tableç±»å‹çš„æ•°æ®è½¬æ¢æˆjsonå­—ç¬¦ä¸²ï¼ŒæŠŠjsonå­—ç¬¦ä¸²å±•ç¤ºåœ¨é¡µé¢ä¸Šå³å¯ã€‚ æ­¥éª¤ä¸€ï¼šå¼•å…¥cjson local cjson = require \"cjson\" æ­¥éª¤äºŒï¼šè°ƒç”¨cjsonçš„encodeæ–¹æ³•è¿›è¡Œç±»å‹è½¬æ¢ cjson.encode(res) ä¼˜åŒ–ä»£ç ï¼š location /mysqlSearch { default_type 'text/html'; content_by_lua_block{ local mysql = require \"resty.mysql\" local db = mysql:new() local cjson = require \"cjson\" local ok,err = db:connect{ host=\"10.0.4.7\", port=3306, user=\"root\", password=\"root\", database=\"lua_db\" } db:set_timeout(1000) local uri_args = ngx.req.get_uri_args() local reqId = uri_args['id'] db:send_query(\"select * from users where id =\"..reqId) local res,err,errcode,sqlstate = db:read_result() ngx.say(cjson.encode(res)) for i,v in ipairs(res) do ngx.say(v.id..\",\"..v.username..\",\"..v.birthday..\",\"..v.salary) end db:close() } } 2ã€å¢åˆ æ”¹location /mysql { default_type 'text/html'; content_by_lua_block{ local mysql = require \"resty.mysql\" local db = mysql:new() local cjson = require \"cjson\" local ok,err = db:connect{ host=\"10.0.4.7\", port=3306, user=\"root\", password=\"root\", database=\"lua_db\" } db:set_timeout(1000) local uri_args = ngx.req.get_uri_args() local reqId = uri_args['id'] local reqType = uri_args['reqType'] db:send_query(\"select * from users where id =\"..reqId) if reqType == 'search' then local res,err,errcode,sqlstate = db:read_result() ngx.say(cjson.encode(res)) for i,v in ipairs(res) do ngx.say(v.id..\",\"..v.username..\",\"..v.birthday..\",\"..v.salary) end elseif reqType == 'add' then local res,err,errcode,sqlstate = db:query(\"insert into users(id,username,birthday,salary) values(6,'zhangsan','2023-11-11',32222.0)\") elseif reqType == 'update' then local res,err,errcode,sqlstate = db:query(\"update users set username='lisi' where id = 6\") elseif reqType == 'delete' then local res,err,errcode,sqlstate = db:query(\"delete from users where id = 6\") end db:close() } } 5ã€Rdisç¼“å­˜é¢„çƒ­ä½¿ç”¨ngx_luaæ¨¡å—å®ŒæˆRedisç¼“å­˜é¢„çƒ­ã€‚ æ­¥éª¤: ï¼ˆ1ï¼‰å…ˆå¾—æœ‰ä¸€å¼ è¡¨(users) ï¼ˆ2ï¼‰æµè§ˆå™¨è¾“å…¥å¦‚ä¸‹åœ°å€ http://10.0.4.7?username=TOM ï¼ˆ3ï¼‰ä»è¡¨ä¸­æŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œæ­¤æ—¶è·å–çš„ç»“æœä¸ºtableç±»å‹ ï¼ˆ4ï¼‰ä½¿ç”¨cjsonå°†tableæ•°æ®è½¬æ¢æˆjsonå­—ç¬¦ä¸² ï¼ˆ5ï¼‰å°†æŸ¥è¯¢çš„ç»“æœæ•°æ®å­˜å…¥Redisä¸­ init_by_lua_block{ redis = require \"resty.redis\" mysql = require \"resty.mysql\" cjson = require \"cjson\" } location /redisPreheat{ default_type \"text/html\"; content_by_lua_block{ --è·å–è¯·æ±‚çš„å‚æ•°username local param = ngx.req.get_uri_args()[\"username\"] --å»ºç«‹mysqlæ•°æ®åº“çš„è¿æ¥ local db = mysql:new() local ok,err = db:connect{ host=\"10.0.4.7\", port=3306, user=\"root\", password=\"root\", database=\"lua_db\" } if not ok then ngx.say(\"failed connect to mysql:\",err) return end --è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ db:set_timeout(1000) --æŸ¥è¯¢æ•°æ® local sql = \"\"; if not param then sql=\"select * from users\" else sql=\"select * from users where username=\"..\"'\"..param..\"'\" end local res,err,errcode,sqlstate=db:query(sql) if not res then ngx.say(\"failed to query from mysql:\",err) return end --è¿æ¥redis local rd = redis:new() ok,err = rd:connect(\"10.0.4.7\",6379) if not ok then ngx.say(\"failed to connect to redis:\",err) return end rd:set_timeout(1000) --å¾ªç¯éå†æ•°æ® for i,v in ipairs(res) do rd:set(\"user_\"..v.username,cjson.encode(v)) end ngx.say(\"success\") rd:close() db:close() } } å‘ç°: + è‹±æ–‡å­—æ¯æœ‰å°å›¾æ ‡ :c â€”&gt; â°ğŸ¤ å…³äºæ’¤å›ï¼Œvim","categories":[{"name":"è®¡ç®—æœºè¯­è¨€","slug":"è®¡ç®—æœºè¯­è¨€","permalink":"https://mykkto.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://mykkto.github.io/tags/nginx/"},{"name":"lua","slug":"lua","permalink":"https://mykkto.github.io/tags/lua/"},{"name":"openresty","slug":"openresty","permalink":"https://mykkto.github.io/tags/openresty/"}],"author":"mykk"},{"title":"SpringCloud-Alibaba-Seata å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/16_SpringCloudAlibaba-Seata","date":"2022-03-25T12:11:33.000Z","updated":"2023-06-11T02:53:45.173Z","comments":true,"path":"posts/e1138fa5.html","link":"","permalink":"https://mykkto.github.io/posts/e1138fa5.html","excerpt":"","text":"ä¸€ã€åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜1ã€åˆ†å¸ƒå¼å‰ å•æœºå•åº“æ²¡è¿™ä¸ªé—®é¢˜ ä»1ï¼š1 -&gt; 1ï¼šN -&gt; Nï¼šN 2ã€åˆ†å¸ƒå¼ä¹‹åå•ä½“åº”ç”¨è¢«æ‹†åˆ†æˆå¾®æœåŠ¡åº”ç”¨ï¼ŒåŸæ¥çš„ä¸‰ä¸ªæ¨¡å—è¢«æ‹†åˆ†æˆä¸‰ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸‰ä¸ªç‹¬ç«‹çš„æ•°æ®æºï¼Œä¸šåŠ¡æ“ä½œéœ€è¦è°ƒç”¨ä¸‰ä¸ªæœåŠ¡æ¥å®Œæˆã€‚æ­¤æ—¶æ¯ä¸ªæœåŠ¡å†…éƒ¨çš„æ•°æ®ä¸€è‡´æ€§ç”±æœ¬åœ°**äº‹åŠ¡æ¥ä¿è¯ï¼Œä½†æ˜¯å…¨å±€**çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜æ²¡æ³•ä¿è¯ã€‚ 3ã€ä¸€å¥è¯ä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ äºŒã€Seataç®€ä»‹1ã€æ˜¯ä»€ä¹ˆSeataæ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºåœ¨å¾®æœåŠ¡æ¶æ„ä¸‹æä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚ 2ã€èƒ½å¹²å˜›ï¼ˆâ˜…ï¼‰1ã€ID(1)+ç»„ä»¶(3)1ã€IDå…¨å±€å”¯ä¸€çš„äº‹åŠ¡IDï¼šTransaction ID XID 2ã€ç»„ä»¶Transaction Coordinator (TC)ã€æ‰“å·¥äººã€‘ äº‹åŠ¡åè°ƒå™¨ï¼Œç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»šï¼› Transaction Manager (TM)ã€è€æ¿ã€‘ æ§åˆ¶å…¨å±€äº‹åŠ¡çš„è¾¹ç•Œï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›æ»šçš„å†³è®®ï¼› Resource Manager (RM)ã€ä»»åŠ¡ã€‘ æ§åˆ¶åˆ†æ”¯äº‹åŠ¡ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œã€çŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æ¥æ”¶äº‹åŠ¡åè°ƒå™¨çš„æŒ‡ä»¤ï¼Œé©±åŠ¨åˆ†æ”¯ï¼ˆæœ¬åœ°ï¼‰äº‹åŠ¡çš„æäº¤å’Œå›æ»š 2ã€å¤„ç†è¿‡ç¨‹1ã€TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XIDï¼› 2ã€XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ï¼› 3ã€RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ï¼› 4ã€TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®®ï¼› 5ã€TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ã€‚ 3ã€æ€ä¹ˆç”¨1ã€æœ¬åœ°å•ä½“æ¶æ„ä¸Šï¼Œæœ¬åœ°ä½¿ç”¨springï¼š@Transactional 2ã€å…¨å±€åˆ†å¸ƒå¼ä¸Šï¼Œå…¨å±€ä½¿ç”¨Seataï¼š@GlobalTransactional ä¸‰ã€Seata-Serverå®‰è£…1ã€å®˜ç½‘1ã€åœ°å€http://seata.io/zh-cn/ 2ã€ä¸‹è½½åœ°å€https://github.com/seata/seata/releases é€‰æ‹© 1.0.0 GA ç¨³å®šç‰ˆ 2ã€é…ç½®seata-server-1.0.0.zip è§£å‹åˆ°æŒ‡å®šç›®å½•å¹¶ä¿®æ”¹confç›®å½•ä¸‹çš„file.confé…ç½®æ–‡ä»¶ 1ã€file.confï¼ˆserviceæ¨¡å—ï¼‰vgroup_mapping.my_test_tx_group = \"fsp_tx_group\" 2ã€file.confï¼ˆstoreæ¨¡å—ï¼‰mode = \"db\" url = \"jdbc:mysql://127.0.0.1:3306/seata\" user = \"root\" password = \"ä½ è‡ªå·±å¯†ç \" 3ã€å¯¼å…¥å»ºè¡¨sql-- -------------------------------- The script used when storeMode is 'db' -------------------------------- -- the table to store GlobalSession data CREATE TABLE IF NOT EXISTS `global_table` ( `xid` VARCHAR(128) NOT NULL, `transaction_id` BIGINT, `status` TINYINT NOT NULL, `application_id` VARCHAR(32), `transaction_service_group` VARCHAR(32), `transaction_name` VARCHAR(128), `timeout` INT, `begin_time` BIGINT, `application_data` VARCHAR(2000), `gmt_create` DATETIME, `gmt_modified` DATETIME, PRIMARY KEY (`xid`), KEY `idx_gmt_modified_status` (`gmt_modified`, `status`), KEY `idx_transaction_id` (`transaction_id`) ) ENGINE = InnoDB DEFAULT CHARSET = utf8; -- the table to store BranchSession data CREATE TABLE IF NOT EXISTS `branch_table` ( `branch_id` BIGINT NOT NULL, `xid` VARCHAR(128) NOT NULL, `transaction_id` BIGINT, `resource_group_id` VARCHAR(32), `resource_id` VARCHAR(256), `branch_type` VARCHAR(8), `status` TINYINT, `client_id` VARCHAR(64), `application_data` VARCHAR(2000), `gmt_create` DATETIME(6), `gmt_modified` DATETIME(6), PRIMARY KEY (`branch_id`), KEY `idx_xid` (`xid`) ) ENGINE = InnoDB DEFAULT CHARSET = utf8; -- the table to store lock data CREATE TABLE IF NOT EXISTS `lock_table` ( `row_key` VARCHAR(128) NOT NULL, `xid` VARCHAR(96), `transaction_id` BIGINT, `branch_id` BIGINT NOT NULL, `resource_id` VARCHAR(256), `table_name` VARCHAR(32), `pk` VARCHAR(36), `gmt_create` DATETIME, `gmt_modified` DATETIME, PRIMARY KEY (`row_key`), KEY `idx_branch_id` (`branch_id`) ) ENGINE = InnoDB DEFAULT CHARSET = utf8; 4ã€å¯åŠ¨1ã€å¯åŠ¨cacosï¼Œseate 2ã€æŸ¥çœ‹ nacos æ§åˆ¶å° å››ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡1ã€å®æˆ˜ä¸šåŠ¡è¯´æ˜1ã€è¯¦ç»†è¿™é‡Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸‰ä¸ªæœåŠ¡ï¼Œä¸€ä¸ªè®¢å•æœåŠ¡ï¼Œä¸€ä¸ªåº“å­˜æœåŠ¡ï¼Œä¸€ä¸ªè´¦æˆ·æœåŠ¡ã€‚ å½“ç”¨æˆ·ä¸‹å•æ—¶ï¼Œä¼šåœ¨è®¢å•æœåŠ¡ä¸­åˆ›å»ºä¸€ä¸ªè®¢å•ï¼Œç„¶åé€šè¿‡è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ¥æ‰£å‡ä¸‹å•å•†å“çš„åº“å­˜ï¼Œå†é€šè¿‡è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ¥æ‰£å‡ç”¨æˆ·è´¦æˆ·é‡Œé¢çš„ä½™é¢ï¼Œæœ€ååœ¨è®¢å•æœåŠ¡ä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆã€‚ è¯¥æ“ä½œè·¨è¶Šä¸‰ä¸ªæ•°æ®åº“ï¼Œæœ‰ä¸¤æ¬¡è¿œç¨‹è°ƒç”¨ï¼Œå¾ˆæ˜æ˜¾ä¼šæœ‰åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚ 2ã€è°ƒç”¨æµç¨‹ä¸‹è®¢å•â€”&gt;æ‰£åº“å­˜â€”&gt;å‡è´¦æˆ·(ä½™é¢) 2ã€å»ºåº“å»ºè¡¨0ã€å»ºåº“CREATE DATABASE seata_order; CREATE DATABASE seata_storage; CREATE DATABASE seata_account; 1ã€è®¢å•seata_orderï¼šå­˜å‚¨è®¢å•çš„æ•°æ®åº“ï¼› è¡¨è¯­å¥ï¼š CREATE TABLE t_order ( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `product_id` BIGINT(11) DEFAULT NULL COMMENT 'äº§å“id', `count` INT(11) DEFAULT NULL COMMENT 'æ•°é‡', `money` DECIMAL(11,0) DEFAULT NULL COMMENT 'é‡‘é¢', `status` INT(1) DEFAULT NULL COMMENT 'è®¢å•çŠ¶æ€ï¼š0ï¼šåˆ›å»ºä¸­ï¼›1ï¼šå·²å®Œç»“' ) ENGINE=INNODB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8; SELECT * FROM t_order; 2ã€åº“å­˜seata_storageï¼šå­˜å‚¨åº“å­˜çš„æ•°æ®åº“ï¼› è¡¨è¯­å¥ï¼š CREATE TABLE t_storage ( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `product_id` BIGINT(11) DEFAULT NULL COMMENT 'äº§å“id', `total` INT(11) DEFAULT NULL COMMENT 'æ€»åº“å­˜', `used` INT(11) DEFAULT NULL COMMENT 'å·²ç”¨åº“å­˜', `residue` INT(11) DEFAULT NULL COMMENT 'å‰©ä½™åº“å­˜' ) ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO seata_storage.t_storage(`id`, `product_id`, `total`, `used`, `residue`) VALUES ('1', '1', '100', '0', '100'); SELECT * FROM t_storage; 3ã€è´¦æˆ·ä¿¡æ¯seata_accountï¼šå­˜å‚¨è´¦æˆ·ä¿¡æ¯çš„æ•°æ®åº“ã€‚ è¡¨è¯­å¥ï¼š CREATE TABLE t_account ( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT 'id', `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `total` DECIMAL(10,0) DEFAULT NULL COMMENT 'æ€»é¢åº¦', `used` DECIMAL(10,0) DEFAULT NULL COMMENT 'å·²ç”¨ä½™é¢', `residue` DECIMAL(10,0) DEFAULT '0' COMMENT 'å‰©ä½™å¯ç”¨é¢åº¦' ) ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO seata_account.t_account(`id`, `user_id`, `total`, `used`, `residue`) VALUES ('1', '1', '1000', '0', '1000'); SELECT * FROM t_account; 4ã€å›æ»šæ—¥å¿—è¡¨æŒ‰ç…§ä¸Šè¿°3åº“åˆ†åˆ«å»ºå¯¹åº”çš„å›æ»šæ—¥å¿—è¡¨ -- the table to store seata xid data -- 0.7.0+ add context -- you must to init this sql for you business databese. the seata server not need it. -- æ­¤è„šæœ¬å¿…é¡»åˆå§‹åŒ–åœ¨ä½ å½“å‰çš„ä¸šåŠ¡æ•°æ®åº“ä¸­ï¼Œç”¨äºAT æ¨¡å¼XIDè®°å½•ã€‚ä¸serverç«¯æ— å…³ï¼ˆæ³¨ï¼šä¸šåŠ¡æ•°æ®åº“ï¼‰ -- æ³¨æ„æ­¤å¤„0.3.0+ å¢åŠ å”¯ä¸€ç´¢å¼• ux_undo_log DROP TABLE `undo_log`; CREATE TABLE `undo_log` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT, `branch_id` BIGINT(20) NOT NULL, `xid` VARCHAR(100) NOT NULL, `context` VARCHAR(128) NOT NULL, `rollback_info` LONGBLOB NOT NULL, `log_status` INT(11) NOT NULL, `log_created` DATETIME NOT NULL, `log_modified` DATETIME NOT NULL, `ext` VARCHAR(100) DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`) ) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8; 5ã€æ•ˆæœ äº”ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡1ã€ä¸šåŠ¡éœ€æ±‚ä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;æ‰£ä½™é¢-&gt;æ”¹(è®¢å•)çŠ¶æ€ 2ã€æ–°å»ºè®¢å•Order-Module1ã€modelseata-order-service2001 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;seata-order-service2001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--nacos--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--seata--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-seata&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;!--feign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--web-actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mysql-druid--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.37&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 2001 spring: application: name: seata-order-service cloud: alibaba: seata: #è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°éœ€è¦ä¸seata-serverä¸­çš„å¯¹åº” tx-service-group: fsp_tx_group nacos: discovery: server-addr: 106.52.23.202:8848 datasource: driver-class-name: com.mysql.jdbc.Driver url: jdbc:mysql://106.52.23.202:3306/seata_order username: root password: root feign: hystrix: enabled: false logging: level: io: seata: info mybatis: mapperLocations: classpath:mapper/*.xml 4ã€file.confyml åŒå±‚ç›®å½•ä¸‹ éœ€è¦ä¿®æ”¹çš„æ˜¯ mysql url,username,password transport { # tcp udt unix-domain-socket type = \"TCP\" #NIO NATIVE server = \"NIO\" #enable heartbeat heartbeat = true #thread factory for netty thread-factory { boss-thread-prefix = \"NettyBoss\" worker-thread-prefix = \"NettyServerNIOWorker\" server-executor-thread-prefix = \"NettyServerBizHandler\" share-boss-worker = false client-selector-thread-prefix = \"NettyClientSelector\" client-selector-thread-size = 1 client-worker-thread-prefix = \"NettyClientWorkerThread\" # netty boss thread size,will not be used for UDT boss-thread-size = 1 #auto default pin or 8 worker-thread-size = 8 } shutdown { # when destroy server, wait seconds wait = 3 } serialization = \"seata\" compressor = \"none\" } service { vgroup_mapping.fsp_tx_group = \"default\" #ä¿®æ”¹è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§° default.grouplist = \"127.0.0.1:8091\" enableDegrade = false disable = false max.commit.retry.timeout = \"-1\" max.rollback.retry.timeout = \"-1\" disableGlobalTransaction = false } client { async.commit.buffer.limit = 10000 lock { retry.internal = 10 retry.times = 30 } report.retry.count = 5 tm.commit.retry.count = 1 tm.rollback.retry.count = 1 } ## transaction log store store { ## store mode: fileã€db mode = \"db\" ## file store file { dir = \"sessionStore\" # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions max-branch-session-size = 16384 # globe session size , if exceeded throws exceptions max-global-session-size = 512 # file buffer size , if exceeded allocate new buffer file-write-buffer-cache-size = 16384 # when recover batch read size session.reload.read_size = 100 # async, sync flush-disk-mode = async } ## database store db { ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc. datasource = \"dbcp\" ## mysql/oracle/h2/oceanbase etc. db-type = \"mysql\" driver-class-name = \"com.mysql.jdbc.Driver\" url = \"jdbc:mysql://106.52.23.202:3306/seata\" user = \"root\" password = \"root\" min-conn = 1 max-conn = 3 global.table = \"global_table\" branch.table = \"branch_table\" lock-table = \"lock_table\" query-limit = 100 } } lock { ## the lock store mode: localã€remote mode = \"remote\" local { ## store locks in user's database } remote { ## store locks in the seata's server } } recovery { #schedule committing retry period in milliseconds committing-retry-period = 1000 #schedule asyn committing retry period in milliseconds asyn-committing-retry-period = 1000 #schedule rollbacking retry period in milliseconds rollbacking-retry-period = 1000 #schedule timeout retry period in milliseconds timeout-retry-period = 1000 } transaction { undo.data.validation = true undo.log.serialization = \"jackson\" undo.log.save.days = 7 #schedule delete expired undo_log in milliseconds undo.log.delete.period = 86400000 undo.log.table = \"undo_log\" } ## metrics settings metrics { enabled = false registry-type = \"compact\" # multi exporters use comma divided exporter-list = \"prometheus\" exporter-prometheus-port = 9898 } support { ## spring spring { # auto proxy the DataSource bean datasource.autoproxy = false } } 5ã€registry.confregistry { # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa type = \"nacos\" nacos { serverAddr = \"106.52.23.202:8848\" namespace = \"\" cluster = \"default\" } eureka { serviceUrl = \"http://localhost:8761/eureka\" application = \"default\" weight = \"1\" } redis { serverAddr = \"localhost:6379\" db = \"0\" } zk { cluster = \"default\" serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } consul { cluster = \"default\" serverAddr = \"127.0.0.1:8500\" } etcd3 { cluster = \"default\" serverAddr = \"http://localhost:2379\" } sofa { serverAddr = \"127.0.0.1:9603\" application = \"default\" region = \"DEFAULT_ZONE\" datacenter = \"DefaultDataCenter\" cluster = \"default\" group = \"SEATA_GROUP\" addressWaitTime = \"3000\" } file { name = \"file.conf\" } } config { # fileã€nacos ã€apolloã€zkã€consulã€etcd3 type = \"file\" nacos { serverAddr = \"localhost\" namespace = \"\" } consul { serverAddr = \"127.0.0.1:8500\" } apollo { app.id = \"seata-server\" apollo.meta = \"http://192.168.1.204:8801\" } zk { serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } etcd3 { serverAddr = \"http://localhost:2379\" } file { name = \"file.conf\" } } 6ã€ä¸šåŠ¡ç±»1ã€domainpackage com.kk.springcloud.domain; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; @Data @AllArgsConstructor @NoArgsConstructor public class CommonResult&lt;T&gt; { private Integer code; private String message; private T data; public CommonResult(Integer code, String message) { this (code, message, null); } } package com.kk.springcloud.domain; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; import java.math.BigDecimal; @Data @AllArgsConstructor @NoArgsConstructor public class Order { private Long id; private Long userId; private Long productId; private Integer count; private BigDecimal money; /** * è®¢å•çŠ¶æ€ï¼š0ï¼šåˆ›å»ºä¸­ï¼›1ï¼šå·²å®Œç»“ */ private Integer status; } 2ã€daopackage com.kk.springcloud.dao; import com.kk.springcloud.domain.Order; import org.apache.ibatis.annotations.Mapper; import org.apache.ibatis.annotations.Param; @Mapper public interface OrderDao { /** * åˆ›å»ºè®¢å• */ void create(Order order); /** * ä¿®æ”¹è®¢å•é‡‘é¢ */ void update(@Param(\"userId\") Long userId, @Param(\"status\") Integer status); } OrderMapper.xml &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\" &gt; &lt;mapper namespace=\"com.kk.springcloud.dao.OrderDao\"&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.kk.springcloud.domain.Order\"&gt; &lt;id column=\"id\" property=\"id\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"user_id\" property=\"userId\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"product_id\" property=\"productId\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"count\" property=\"count\" jdbcType=\"INTEGER\"/&gt; &lt;result column=\"money\" property=\"money\" jdbcType=\"DECIMAL\"/&gt; &lt;result column=\"status\" property=\"status\" jdbcType=\"INTEGER\"/&gt; &lt;/resultMap&gt; &lt;insert id=\"create\"&gt; INSERT INTO `t_order` (`id`, `user_id`, `product_id`, `count`, `money`, `status`) VALUES (NULL, #{userId}, #{productId}, #{count}, #{money}, 0); &lt;/insert&gt; &lt;update id=\"update\"&gt; UPDATE `t_order` SET status = 1 WHERE user_id = #{userId} AND status = #{status}; &lt;/update&gt; &lt;/mapper&gt; 3ã€serivce OrderService OrderServiceImpl package com.kk.springcloud.service; import com.kk.springcloud.domain.Order; public interface OrderService { /** * åˆ›å»ºè®¢å• */ void create(Order order); } package com.kk.springcloud.service; import com.kk.springcloud.dao.OrderDao; import com.kk.springcloud.domain.Order; import io.seata.spring.annotation.GlobalTransactional; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Service; import javax.annotation.Resource; @Service @Slf4j public class OrderServiceImpl implements OrderService { @Resource private OrderDao orderDao; @Resource private StorageService storageService; @Resource private AccountService accountService; /** * åˆ›å»ºè®¢å•-&gt;è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜-&gt;è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡è´¦æˆ·ä½™é¢-&gt;ä¿®æ”¹è®¢å•çŠ¶æ€ * ç®€å•è¯´ï¼š * ä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;å‡ä½™é¢-&gt;æ”¹çŠ¶æ€ * rollbackFor = Exception.class ,ä»»ä½•å¼‚å¸¸éƒ½å›æ»š */ @Override @GlobalTransactional(name = \"fsp-create-order\", rollbackFor = Exception.class) public void create(Order order) { log.info (\"===å¼€å§‹ä¸‹å•===\"); //æœ¬åº”ç”¨åˆ›å»ºè®¢å• orderDao.create (order); //è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜ log.info (\"-------&gt;order-serviceä¸­æ‰£å‡åº“å­˜å¼€å§‹\"); storageService.decrease (order.getProductId ( ), order.getCount ( )); log.info (\"-------&gt;order-serviceä¸­æ‰£å‡åº“å­˜ç»“æŸ\"); //è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡ä½™é¢ log.info (\"-------&gt;order-serviceä¸­æ‰£å‡ä½™é¢å¼€å§‹\"); accountService.decrease (order.getUserId ( ), order.getMoney ( )); log.info (\"-------&gt;order-serviceä¸­æ‰£å‡ä½™é¢ç»“æŸ\"); //ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆ log.info (\"-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€å¼€å§‹\"); orderDao.update (order.getUserId ( ), 0); log.info (\"-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ç»“æŸ\"); log.info (\"-------&gt;ä¸‹å•ç»“æŸ\"); } } AccountService package com.kk.springcloud.service; import com.kk.springcloud.domain.CommonResult; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestParam; import java.math.BigDecimal; @FeignClient(value = \"seata-account-service\") public interface AccountService { /** * æ‰£å‡è´¦æˆ·ä½™é¢ */ //@RequestMapping(value = \"/account/decrease\", method = RequestMethod.POST, produces = \"application/json; charset=UTF-8\") @PostMapping(\"/account/decrease\") CommonResult decrease(@RequestParam(\"userId\") Long userId, @RequestParam(\"money\") BigDecimal money); } StorageService package com.kk.springcloud.service; import com.kk.springcloud.domain.CommonResult; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestParam; @FeignClient(value = \"seata-storage-service\") public interface StorageService { /** * æ‰£å‡åº“å­˜ */ @PostMapping(value = \"/storage/decrease\") CommonResult decrease(@RequestParam(\"productId\") Long productId, @RequestParam(\"count\") Integer count); } 4ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.domain.CommonResult; import com.kk.springcloud.domain.Order; import com.kk.springcloud.service.OrderService; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class OrderController { @Autowired private OrderService orderService; /** * åˆ›å»ºè®¢å• */ @GetMapping(\"/order/create\") public CommonResult create(Order order) { orderService.create(order); return new CommonResult(200, \"è®¢å•åˆ›å»ºæˆåŠŸ!\"); } } 7ã€Configé…ç½® MybatisConfig package com.kk.springcloud.config; import org.mybatis.spring.annotation.MapperScan; import org.springframework.context.annotation.Configuration; @Configuration @MapperScan({\"com.kk.springcloud.dao\"}) public class MyBatisConfig { } DataSourceProxyConfig package com.kk.springcloud.config; import com.alibaba.druid.pool.DruidDataSource; import io.seata.rm.datasource.DataSourceProxy; import org.apache.ibatis.session.SqlSessionFactory; import org.mybatis.spring.SqlSessionFactoryBean; import org.mybatis.spring.transaction.SpringManagedTransactionFactory; import org.springframework.beans.factory.annotation.Value; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.core.io.support.PathMatchingResourcePatternResolver; import javax.sql.DataSource; /* * @Description: ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç† * @Author: é˜¿K * @CreateDate: 2022/3/27 13:31 * @Param: * @Return: **/ @Configuration public class DataSourceProxyConfig { @Value(\"${mybatis.mapperLocations}\") private String mapperLocations; @Bean @ConfigurationProperties(prefix = \"spring.datasource\") public DataSource druidDataSource() { return new DruidDataSource ( ); } @Bean public DataSourceProxy dataSourceProxy(DataSource dataSource) { return new DataSourceProxy (dataSource); } @Bean public SqlSessionFactory sqlSessionFactoryBean(DataSourceProxy dataSourceProxy) throws Exception { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean ( ); sqlSessionFactoryBean.setDataSource (dataSourceProxy); sqlSessionFactoryBean.setMapperLocations (new PathMatchingResourcePatternResolver ( ).getResources (mapperLocations)); sqlSessionFactoryBean.setTransactionFactory (new SpringManagedTransactionFactory ( )); return sqlSessionFactoryBean.getObject ( ); } } 8ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.openfeign.EnableFeignClients; @EnableDiscoveryClient @EnableFeignClients @SpringBootApplication(exclude = DataSourceAutoConfiguration.class)//å–æ¶ˆæ•°æ®æºçš„è‡ªåŠ¨åˆ›å»º public class SeataOrderMainApp2001 { public static void main(String[] args) { SpringApplication.run (SeataOrderMainApp2001.class, args); } } 3ã€æ–°å»ºåº“å­˜Storage-Module1ã€modelseata-storage-service2002 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;seata-order-service2001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--nacos--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--seata--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-seata&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;!--feign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--web-actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mysql-druid--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.37&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 2002 spring: application: name: seata-storage-service cloud: alibaba: seata: tx-service-group: fsp_tx_group nacos: discovery: server-addr: 106.52.23.202:8848 datasource: driver-class-name: com.mysql.jdbc.Driver url: jdbc:mysql://106.52.23.202:3306/seata_storage username: root password: root logging: level: io: seata: info mybatis: mapperLocations: classpath:mapper/*.xml 4ã€file.confvgroup_mapping.fsp_tx_group = \"default\" transport { # tcp udt unix-domain-socket type = \"TCP\" #NIO NATIVE server = \"NIO\" #enable heartbeat heartbeat = true #thread factory for netty thread-factory { boss-thread-prefix = \"NettyBoss\" worker-thread-prefix = \"NettyServerNIOWorker\" server-executor-thread-prefix = \"NettyServerBizHandler\" share-boss-worker = false client-selector-thread-prefix = \"NettyClientSelector\" client-selector-thread-size = 1 client-worker-thread-prefix = \"NettyClientWorkerThread\" # netty boss thread size,will not be used for UDT boss-thread-size = 1 #auto default pin or 8 worker-thread-size = 8 } shutdown { # when destroy server, wait seconds wait = 3 } serialization = \"seata\" compressor = \"none\" } service { #vgroup-&gt;rgroup vgroup_mapping.fsp_tx_group = \"default\" #only support single node default.grouplist = \"127.0.0.1:8091\" #degrade current not support enableDegrade = false #disable disable = false #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, default permanent max.commit.retry.timeout = \"-1\" max.rollback.retry.timeout = \"-1\" disableGlobalTransaction = false } client { async.commit.buffer.limit = 10000 lock { retry.internal = 10 retry.times = 30 } report.retry.count = 5 tm.commit.retry.count = 1 tm.rollback.retry.count = 1 } transaction { undo.data.validation = true undo.log.serialization = \"jackson\" undo.log.save.days = 7 #schedule delete expired undo_log in milliseconds undo.log.delete.period = 86400000 undo.log.table = \"undo_log\" } support { ## spring spring { # auto proxy the DataSource bean datasource.autoproxy = false } } 5ã€registry.confregistry { # file ã€nacos ã€eurekaã€redisã€zk type = \"nacos\" nacos { serverAddr = \"106.52.23.202:8848\" namespace = \"\" cluster = \"default\" } eureka { serviceUrl = \"http://localhost:8761/eureka\" application = \"default\" weight = \"1\" } redis { serverAddr = \"localhost:6381\" db = \"0\" } zk { cluster = \"default\" serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } file { name = \"file.conf\" } } config { # fileã€nacos ã€apolloã€zk type = \"file\" nacos { serverAddr = \"localhost\" namespace = \"\" cluster = \"default\" } apollo { app.id = \"fescar-server\" apollo.meta = \"http://192.168.1.204:8801\" } zk { serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } file { name = \"file.conf\" } } 6ã€ä¸šåŠ¡ç±»1ã€domainpackage com.kk.springcloud.domain; import lombok.Data; @Data public class Storage { private Long id; /** * äº§å“id */ private Long productId; /** * æ€»åº“å­˜ */ private Integer total; /** * å·²ç”¨åº“å­˜ */ private Integer used; /** * å‰©ä½™åº“å­˜ */ private Integer residue; } 2ã€daopackage com.kk.springcloud.dao; import org.apache.ibatis.annotations.Mapper; import org.apache.ibatis.annotations.Param; @Mapper public interface StorageDao { /** * æ‰£å‡åº“å­˜ */ void decrease(@Param(\"productId\") Long productId, @Param(\"count\") Integer count); } &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\" &gt; &lt;mapper namespace=\"com.kk.springcloud.dao.StorageDao\"&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.kk.springcloud.domain.Storage\"&gt; &lt;id column=\"id\" property=\"id\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"product_id\" property=\"productId\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"total\" property=\"total\" jdbcType=\"INTEGER\"/&gt; &lt;result column=\"used\" property=\"used\" jdbcType=\"INTEGER\"/&gt; &lt;result column=\"residue\" property=\"residue\" jdbcType=\"INTEGER\"/&gt; &lt;/resultMap&gt; &lt;update id=\"decrease\"&gt; UPDATE t_storage SET used = used + #{count}, residue = residue - #{count} WHERE product_id = #{productId} &lt;/update&gt; &lt;/mapper&gt; 3ã€serivcepackage com.kk.springcloud.service; public interface StorageService { /** * æ‰£å‡åº“å­˜ */ void decrease(Long productId, Integer count); } package com.kk.springcloud.service; import com.kk.springcloud.dao.StorageDao; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Service; import javax.annotation.Resource; @Service @Slf4j public class StorageServiceImpl implements StorageService { @Resource private StorageDao storageDao; /** * æ‰£å‡åº“å­˜ */ @Override public void decrease(Long productId, Integer count) { log.info (\"-------&gt;storage-serviceä¸­æ‰£å‡åº“å­˜å¼€å§‹\"); storageDao.decrease (productId, count); log.info (\"-------&gt;storage-serviceä¸­æ‰£å‡åº“å­˜ç»“æŸ\"); } } 4ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.service.StorageService; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class StorageController { @Autowired private StorageService storageService; /** * æ‰£å‡åº“å­˜ */ @RequestMapping(\"/storage/decrease\") public CommonResult decrease(Long productId, Integer count) { storageService.decrease (productId, count); return new CommonResult (200, \"æ‰£å‡åº“å­˜æˆåŠŸï¼\"); } } 7ã€Configé…ç½® MybatisConfig package com.kk.springcloud.config; import org.mybatis.spring.annotation.MapperScan; import org.springframework.context.annotation.Configuration; @Configuration @MapperScan({\"com.kk.springcloud.dao\"}) public class MyBatisConfig { } DataSourceProxyConfig package com.kk.springcloud.config; import com.alibaba.druid.pool.DruidDataSource; import io.seata.rm.datasource.DataSourceProxy; import org.apache.ibatis.session.SqlSessionFactory; import org.mybatis.spring.SqlSessionFactoryBean; import org.mybatis.spring.transaction.SpringManagedTransactionFactory; import org.springframework.beans.factory.annotation.Value; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.core.io.support.PathMatchingResourcePatternResolver; import javax.sql.DataSource; /* * @Description: ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç† * @Author: é˜¿K * @CreateDate: 2022/3/27 13:31 * @Param: * @Return: **/ @Configuration public class DataSourceProxyConfig { @Value(\"${mybatis.mapperLocations}\") private String mapperLocations; @Bean @ConfigurationProperties(prefix = \"spring.datasource\") public DataSource druidDataSource() { return new DruidDataSource ( ); } @Bean public DataSourceProxy dataSourceProxy(DataSource dataSource) { return new DataSourceProxy (dataSource); } @Bean public SqlSessionFactory sqlSessionFactoryBean(DataSourceProxy dataSourceProxy) throws Exception { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean ( ); sqlSessionFactoryBean.setDataSource (dataSourceProxy); sqlSessionFactoryBean.setMapperLocations (new PathMatchingResourcePatternResolver ( ).getResources (mapperLocations)); sqlSessionFactoryBean.setTransactionFactory (new SpringManagedTransactionFactory ( )); return sqlSessionFactoryBean.getObject ( ); } } 8ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication(exclude = DataSourceAutoConfiguration.class) @EnableDiscoveryClient @EnableFeignClients public class SeataStorageServiceApplication2002 { public static void main(String[] args) { SpringApplication.run (SeataStorageServiceApplication2002.class, args); } } 4ã€æ–°å»ºè´¦æˆ·Account-Module1ã€modelseata-account-service2003 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;seata-account-service2003&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--nacos--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--seata--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-seata&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;!--feign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.37&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 2003 spring: application: name: seata-account-service cloud: alibaba: seata: tx-service-group: fsp_tx_group nacos: discovery: server-addr: 106.52.23.202:8848 datasource: driver-class-name: com.mysql.jdbc.Driver url: jdbc:mysql://106.52.23.202:3306/seata_account username: root password: root feign: hystrix: enabled: false logging: level: io: seata: info mybatis: mapperLocations: classpath:mapper/*.xml 4ã€file.conftransport { # tcp udt unix-domain-socket type = \"TCP\" #NIO NATIVE server = \"NIO\" #enable heartbeat heartbeat = true #thread factory for netty thread-factory { boss-thread-prefix = \"NettyBoss\" worker-thread-prefix = \"NettyServerNIOWorker\" server-executor-thread-prefix = \"NettyServerBizHandler\" share-boss-worker = false client-selector-thread-prefix = \"NettyClientSelector\" client-selector-thread-size = 1 client-worker-thread-prefix = \"NettyClientWorkerThread\" # netty boss thread size,will not be used for UDT boss-thread-size = 1 #auto default pin or 8 worker-thread-size = 8 } shutdown { # when destroy server, wait seconds wait = 3 } serialization = \"seata\" compressor = \"none\" } service { vgroup_mapping.fsp_tx_group = \"default\" #ä¿®æ”¹è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§° default.grouplist = \"127.0.0.1:8091\" enableDegrade = false disable = false max.commit.retry.timeout = \"-1\" max.rollback.retry.timeout = \"-1\" disableGlobalTransaction = false } client { async.commit.buffer.limit = 10000 lock { retry.internal = 10 retry.times = 30 } report.retry.count = 5 tm.commit.retry.count = 1 tm.rollback.retry.count = 1 } ## transaction log store store { ## store mode: fileã€db mode = \"db\" ## file store file { dir = \"sessionStore\" # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions max-branch-session-size = 16384 # globe session size , if exceeded throws exceptions max-global-session-size = 512 # file buffer size , if exceeded allocate new buffer file-write-buffer-cache-size = 16384 # when recover batch read size session.reload.read_size = 100 # async, sync flush-disk-mode = async } ## database store db { ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc. datasource = \"dbcp\" ## mysql/oracle/h2/oceanbase etc. db-type = \"mysql\" driver-class-name = \"com.mysql.jdbc.Driver\" url = \"jdbc:mysql://106.52.23.202:3306/seata\" user = \"root\" password = \"root\" min-conn = 1 max-conn = 3 global.table = \"global_table\" branch.table = \"branch_table\" lock-table = \"lock_table\" query-limit = 100 } } lock { ## the lock store mode: localã€remote mode = \"remote\" local { ## store locks in user's database } remote { ## store locks in the seata's server } } recovery { #schedule committing retry period in milliseconds committing-retry-period = 1000 #schedule asyn committing retry period in milliseconds asyn-committing-retry-period = 1000 #schedule rollbacking retry period in milliseconds rollbacking-retry-period = 1000 #schedule timeout retry period in milliseconds timeout-retry-period = 1000 } transaction { undo.data.validation = true undo.log.serialization = \"jackson\" undo.log.save.days = 7 #schedule delete expired undo_log in milliseconds undo.log.delete.period = 86400000 undo.log.table = \"undo_log\" } ## metrics settings metrics { enabled = false registry-type = \"compact\" # multi exporters use comma divided exporter-list = \"prometheus\" exporter-prometheus-port = 9898 } support { ## spring spring { # auto proxy the DataSource bean datasource.autoproxy = false } } 5ã€registry.confregistry { # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa type = \"nacos\" nacos { serverAddr = \"106.52.23.202:8848\" namespace = \"\" cluster = \"default\" } eureka { serviceUrl = \"http://localhost:8761/eureka\" application = \"default\" weight = \"1\" } redis { serverAddr = \"localhost:6379\" db = \"0\" } zk { cluster = \"default\" serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } consul { cluster = \"default\" serverAddr = \"127.0.0.1:8500\" } etcd3 { cluster = \"default\" serverAddr = \"http://localhost:2379\" } sofa { serverAddr = \"127.0.0.1:9603\" application = \"default\" region = \"DEFAULT_ZONE\" datacenter = \"DefaultDataCenter\" cluster = \"default\" group = \"SEATA_GROUP\" addressWaitTime = \"3000\" } file { name = \"file.conf\" } } config { # fileã€nacos ã€apolloã€zkã€consulã€etcd3 type = \"file\" nacos { serverAddr = \"localhost\" namespace = \"\" } consul { serverAddr = \"127.0.0.1:8500\" } apollo { app.id = \"seata-server\" apollo.meta = \"http://192.168.1.204:8801\" } zk { serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } etcd3 { serverAddr = \"http://localhost:2379\" } file { name = \"file.conf\" } } 6ã€ä¸šåŠ¡ç±»1ã€domainpackage com.kk.springclpid.domain; import lombok.Data; import java.math.BigDecimal; @Data public class Account { private Long id; /** * ç”¨æˆ·id */ private Long userId; /** * æ€»é¢åº¦ */ private BigDecimal total; /** * å·²ç”¨é¢åº¦ */ private BigDecimal used; /** * å‰©ä½™é¢åº¦ */ private BigDecimal residue; } 2ã€daopackage com.kk.springcloud.dao; import org.apache.ibatis.annotations.Mapper; import org.apache.ibatis.annotations.Param; import java.math.BigDecimal; @Mapper public interface AccountDao { /** * æ‰£å‡è´¦æˆ·ä½™é¢ */ void decrease(@Param(\"userId\") Long userId, @Param(\"money\") BigDecimal money); } &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\" &gt; &lt;mapper namespace=\"com.kk.springcloud.dao.AccountDao\"&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.kk.springcloud.domain.Account\"&gt; &lt;id column=\"id\" property=\"id\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"user_id\" property=\"userId\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"total\" property=\"total\" jdbcType=\"DECIMAL\"/&gt; &lt;result column=\"used\" property=\"used\" jdbcType=\"DECIMAL\"/&gt; &lt;result column=\"residue\" property=\"residue\" jdbcType=\"DECIMAL\"/&gt; &lt;/resultMap&gt; &lt;update id=\"decrease\"&gt; UPDATE t_account SET residue = residue - #{money},used = used + #{money} WHERE user_id = #{userId}; &lt;/update&gt; &lt;/mapper&gt; 3ã€serivcepackage com.kk.springcloud.service; import org.springframework.web.bind.annotation.RequestParam; import java.math.BigDecimal; public interface AccountService { /** * æ‰£å‡è´¦æˆ·ä½™é¢ * * @param userId ç”¨æˆ·id * @param money é‡‘é¢ */ void decrease(@RequestParam(\"userId\") Long userId, @RequestParam(\"money\") BigDecimal money); } package com.kk.springcloud.service; import com.kk.springcloud.dao.AccountDao; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.stereotype.Service; import javax.annotation.Resource; import java.math.BigDecimal; import java.util.concurrent.TimeUnit; @Service public class AccountServiceImpl implements AccountService { private static final Logger LOGGER = LoggerFactory.getLogger (AccountServiceImpl.class); @Resource AccountDao accountDao; /** * æ‰£å‡è´¦æˆ·ä½™é¢ */ @Override public void decrease(Long userId, BigDecimal money) { LOGGER.info (\"-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢å¼€å§‹\"); //æ¨¡æ‹Ÿè¶…æ—¶å¼‚å¸¸ï¼Œå…¨å±€äº‹åŠ¡å›æ»š //æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹ try { TimeUnit.SECONDS.sleep (30); } catch (InterruptedException e) { e.printStackTrace ( ); } accountDao.decrease (userId, money); LOGGER.info (\"-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢ç»“æŸ\"); } } 4ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.service.AccountService; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RequestParam; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; import java.math.BigDecimal; @RestController public class AccountController { @Resource AccountService accountService; /** * æ‰£å‡è´¦æˆ·ä½™é¢ */ @RequestMapping(\"/account/decrease\") public CommonResult decrease(@RequestParam(\"userId\") Long userId, @RequestParam(\"money\") BigDecimal money) { accountService.decrease (userId, money); return new CommonResult (200, \"æ‰£å‡è´¦æˆ·ä½™é¢æˆåŠŸï¼\"); } } 7ã€Configé…ç½® MybatisConfig package com.kk.springcloud.config; import org.mybatis.spring.annotation.MapperScan; import org.springframework.context.annotation.Configuration; @Configuration @MapperScan({\"com.kk.springcloud.dao\"}) public class MyBatisConfig { } DataSourceProxyConfig package com.kk.springcloud.config; import com.alibaba.druid.pool.DruidDataSource; import io.seata.rm.datasource.DataSourceProxy; import org.apache.ibatis.session.SqlSessionFactory; import org.mybatis.spring.SqlSessionFactoryBean; import org.mybatis.spring.transaction.SpringManagedTransactionFactory; import org.springframework.beans.factory.annotation.Value; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.core.io.support.PathMatchingResourcePatternResolver; import javax.sql.DataSource; /* * @Description: ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç† * @Author: é˜¿K * @CreateDate: 2022/3/27 13:31 * @Param: * @Return: **/ @Configuration public class DataSourceProxyConfig { @Value(\"${mybatis.mapperLocations}\") private String mapperLocations; @Bean @ConfigurationProperties(prefix = \"spring.datasource\") public DataSource druidDataSource() { return new DruidDataSource ( ); } @Bean public DataSourceProxy dataSourceProxy(DataSource dataSource) { return new DataSourceProxy (dataSource); } @Bean public SqlSessionFactory sqlSessionFactoryBean(DataSourceProxy dataSourceProxy) throws Exception { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean ( ); sqlSessionFactoryBean.setDataSource (dataSourceProxy); sqlSessionFactoryBean.setMapperLocations (new PathMatchingResourcePatternResolver ( ).getResources (mapperLocations)); sqlSessionFactoryBean.setTransactionFactory (new SpringManagedTransactionFactory ( )); return sqlSessionFactoryBean.getObject ( ); } } 8ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication(exclude = DataSourceAutoConfiguration.class) @EnableDiscoveryClient @EnableFeignClients public class SeataAccountMainApp2003 { public static void main(String[] args) { SpringApplication.run (SeataAccountMainApp2003.class, args); } } å…­ã€Test1ã€åˆå§‹æƒ…å†µ 2ã€æ­£å¸¸ä¸‹å•1ã€è¯·æ±‚http://localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100 2ã€æ•°æ®åº“æƒ…å†µ 3ã€æ— æ³¨è§£è¶…æ—¶å¼‚å¸¸ï¼Œæ²¡åŠ @GlobalTransactional 1ã€AccountServiceImplæ·»åŠ è¶…æ—¶ 2ã€æ•°æ®åº“æƒ…å†µ 3ã€æ•…éšœæƒ…å†µ å½“åº“å­˜å’Œè´¦æˆ·é‡‘é¢æ‰£å‡åï¼Œè®¢å•çŠ¶æ€å¹¶æ²¡æœ‰è®¾ç½®ä¸ºå·²ç»å®Œæˆï¼Œæ²¡æœ‰ä»é›¶æ”¹ä¸º1 è€Œä¸”ç”±äºfeignçš„é‡è¯•æœºåˆ¶ï¼Œè´¦æˆ·ä½™é¢è¿˜æœ‰å¯èƒ½è¢«å¤šæ¬¡æ‰£å‡ 4ã€æœ‰æ³¨è§£è¶…æ—¶å¼‚å¸¸ï¼Œæ·»åŠ @GlobalTransactional 1ã€AccountServiceImplæ·»åŠ è¶…æ—¶ 2ã€OrderServiceImpl@GlobalTransactional @GlobalTransactional(name = \"fsp-create-order\",rollbackFor = Exception.class) public void create(Order order) { ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ } 3ã€ç»“æœ ä¸‹å•åæ•°æ®åº“æ•°æ®å¹¶æ²¡æœ‰ä»»ä½•æ”¹å˜ è®°å½•éƒ½æ·»åŠ ä¸è¿›æ¥ ä¸ƒã€ä¸€éƒ¨åˆ†è¡¥å……1ã€å†çœ‹TC/TM/RMä¸‰å¤§ç»„ä»¶åˆ†å¸ƒå¼äº‹åŠ¡çš„æ‰§è¡Œæµç¨‹ 1ã€TM å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆTM å‘ TC æ³¨å†Œå…¨å±€äº‹åŠ¡è®°å½•ï¼‰ï¼› 2ã€æŒ‰ä¸šåŠ¡åœºæ™¯ï¼Œç¼–æ’æ•°æ®åº“ã€æœåŠ¡ç­‰äº‹åŠ¡å†…èµ„æºï¼ˆRM å‘ TC æ±‡æŠ¥èµ„æºå‡†å¤‡çŠ¶æ€ ï¼‰ï¼› 3ã€TM ç»“æŸåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸€é˜¶æ®µç»“æŸï¼ˆTM é€šçŸ¥ TC æäº¤/å›æ»šåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ï¼› 4ã€TC æ±‡æ€»äº‹åŠ¡ä¿¡æ¯ï¼Œå†³å®šåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æäº¤è¿˜æ˜¯å›æ»šï¼› 5ã€TC é€šçŸ¥æ‰€æœ‰ RM æäº¤/å›æ»š èµ„æºï¼Œäº‹åŠ¡äºŒé˜¶æ®µç»“æŸã€‚ 2ã€ATæ¨¡å¼å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥1ã€æ˜¯ä»€ä¹ˆ 2ã€ä¸€é˜¶æ®µåŠ è½½åœ¨ä¸€é˜¶æ®µï¼ŒSeata ä¼šæ‹¦æˆªâ€œä¸šåŠ¡ SQLâ€ï¼Œ1 è§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œä¸šåŠ¡ SQLâ€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€œbefore imageâ€ï¼Œ2 æ‰§è¡Œâ€œä¸šåŠ¡ SQLâ€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹åï¼Œ3 å…¶ä¿å­˜æˆâ€œafter imageâ€ï¼Œæœ€åç”Ÿæˆè¡Œé”ã€‚ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§ã€‚ 3ã€äºŒé˜¶æ®µæäº¤äºŒé˜¶æ®µå¦‚æ˜¯é¡ºåˆ©æäº¤çš„è¯ï¼Œå› ä¸ºâ€œä¸šåŠ¡ SQLâ€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œæ‰€ä»¥Seataæ¡†æ¶åªéœ€å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯ã€‚ 3ã€äºŒé˜¶æ®µå›æ»šäºŒé˜¶æ®µå›æ»šï¼šäºŒé˜¶æ®µå¦‚æœæ˜¯å›æ»šçš„è¯ï¼ŒSeata å°±éœ€è¦å›æ»šä¸€é˜¶æ®µå·²ç»æ‰§è¡Œçš„â€œä¸šåŠ¡ SQLâ€ï¼Œè¿˜åŸä¸šåŠ¡æ•°æ®ã€‚å›æ»šæ–¹å¼ä¾¿æ˜¯ç”¨â€œbefore imageâ€è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œ â€œafter imageâ€ï¼Œå¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰è„å†™ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†ã€‚ 3ã€è¡¥å…… å‚è€ƒæ–‡æ¡£ â†“docker å®‰è£…é—®é¢˜ï¼šhttps://www.cnblogs.com/youngyajun/p/14002547.html docker ç½‘ç»œé—®é¢˜ï¼šhttps://blog.csdn.net/tilyp/article/details/103371360 docker è¿è¡Œé—®é¢˜ï¼šhttps://www.manongdao.com/article-2421258.html","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"seata","slug":"seata","permalink":"https://mykkto.github.io/tags/seata/"},{"name":"åˆ†å¸ƒå¼äº‹åŠ¡","slug":"åˆ†å¸ƒå¼äº‹åŠ¡","permalink":"https://mykkto.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"}],"author":"mykk"},{"title":"äº‘ä¸»æœºéƒ¨ç½²å¹¶åŒæ­¥æ›´æ–°äºŒçº§åŸŸå","slug":"00-blog/01_blogSynGithub","date":"2022-03-20T08:17:13.000Z","updated":"2023-06-11T02:53:45.175Z","comments":true,"path":"posts/829b453d.html","link":"","permalink":"https://mykkto.github.io/posts/829b453d.html","excerpt":"","text":"ä¸€ã€æœ¬åœ°æ‹‰å–é…ç½®1ã€åˆ›å»ºå¹¶å¯åŠ¨1ã€æ‹‰å–docker pull nginx 2ã€å¯åŠ¨docker run --name nginx-test -p 80:80 -d nginx â€“ name å®¹å™¨å‘½å -v æ˜ å°„ç›®å½• -d è®¾ç½®å®¹å™¨åå°è¿è¡Œ -p æœ¬æœºç«¯å£æ˜ å°„ å°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„80ç«¯å£ 2ã€æ˜ å°„åˆ°æœ¬åœ°1ã€åˆ›å»ºé¦–å…ˆåœ¨æœ¬æœºåˆ›å»ºnginxçš„ä¸€äº›æ–‡ä»¶å­˜å‚¨ç›®å½• mkdir -p /root/nginx/www /root/nginx/logs /root/nginx/conf www: nginxå­˜å‚¨ç½‘ç«™ç½‘é¡µçš„ç›®å½• logs: nginxæ—¥å¿—ç›®å½• conf: nginxé…ç½®æ–‡ä»¶ç›®å½• 2ã€æ˜ å°„ï¼ˆ1ï¼‰å…ˆæŸ¥çœ‹å®¹å™¨ docker ps -a ï¼ˆ2ï¼‰æ˜ å°„ docker cp 481e121fb29f:/etc/nginx/nginx.conf /root/nginx/conf 3ã€å¯åŠ¨å®¹å™¨éœ€è¦è¯´æ˜ä¸‹ï¼Œngxin-test å®¹å™¨æ˜¯ä¸ºäº†è·å¾—å®¹å™¨çš„é…ç½®æ–‡ä»¶ï¼Œæœ€ç»ˆä½¿ç”¨çš„æ˜¯ nginx-web ç›®å‰å·²ç»å¯åŠ¨ nginx-test 80ç«¯å£ï¼Œè‹¥æ˜¯ nginx-webæŒ‡å®šçš„ä¹Ÿæ˜¯ 80ï¼Œå°±éœ€è¦å…³é—­ nginx-testäº† docker stop nginx-test 1ã€æ–°å®¹å™¨æ˜ å°„åˆ›å»ºæ–°nginxå®¹å™¨nginx-web,å¹¶å°†www,logs,confç›®å½•æ˜ å°„åˆ°æœ¬åœ° docker run -d -p 80:80 --name nginx-web -v /root/nginx/www:/usr/share/nginx/html -v /root/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/logs:/var/log/nginx nginx 2ã€å¯åŠ¨docker start nginx-web äºŒã€ä¸‹è½½git1ã€ä¸‹è½½yum install git 2ã€é…ç½®github ä»£ç†git config --global url.\"https://ghproxy.com/https://github.com\".insteadOf \"https://github.com\" 3ã€æ‹‰å–git clone https://github.com/mykkTo/mykkTo.github.io.git 4ã€å‰ªåˆ‡æ–‡ä»¶mv /root/nginx/www/mykkTo.github.io/* /root/nginx/www ä¸‰ã€å®šæ—¶ä»»åŠ¡1ã€ç¼–å†™shellè„šæœ¬#!/bin/bash #åˆ é™¤åŸå§‹é™æ€é¡µé¢æ•°æ®ä»¥åŠæ‹‰å–çš„æ–‡ä»¶å¤¹ rm -rf /root/nginx/www/* rm -rf /root/nginx/mykkTo.github.iopwd #æ‹‰å–ï¼Œå‰ªåˆ‡åˆ°80æ˜ å°„ä¸‹ cd /root/nginx/ git clone https://github.com/mykkTo/mykkTo.github.io.git mv /root/nginx/mykkTo.github.io/* /root/nginx/www #å¤åˆ¶ä»¤ç‰Œç”¨æˆ·ç™¾åº¦ç«™é•¿éªŒè¯ä½¿ç”¨ cp /root/nginx/baidu_verify_code-Os7hLX61vV.html /root/nginx/www/baidu_verify_code-Os7hLX61vV.html #æ›¿æ¢æ–‡æœ¬ï¼Œç”¨äºç™¾åº¦ç«™é•¿seoæ˜ å°„ sed 's/github.io/cn/g' /root/nginx/www/baidu_urls.txt&gt;/root/nginx/www/baidu_urls1.txt sed 's/https/http/g' /root/nginx/www/baidu_urls1.txt&gt;/root/nginx/www/baidu_urls2.txt echo \"============æˆåŠŸ=========\" 2ã€åˆ›å»ºå®šæ—¶ä»»åŠ¡crontab -e è¡¥å……ï¼š linux é»‘æ´ï¼Œé˜²æ­¢èµ„æºå ç”¨ /dev/null 2&gt;&amp;1 #åç¼€åŠ ä¸Š /root/nginx/synblog.sh /dev/null 2&gt;&amp;1 å¯åŠ¨ï¼š è¿™è¾¹è®¾ç½®æ²¡ä¸€ä¸ªå°æ—¶æ›´æ–°ä¸€æ¬¡ï¼ˆéœ€è¦æ³¨æ„centos7.6å†™æ³•å¯åŠ¨ï¼‰ service crond start å››ã€SSLè¯ä¹¦1ã€æ˜¯ä»€ä¹ˆæ•°æ®åŠ å¯†ï¼šå¼€å¯ HTTPS ç»¿è‰²åŠ å¯†é€šé“ï¼Œç½‘ç«™æ•°æ®çš„åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢ç½‘ç«™æ ¸å¿ƒæ•°æ®è¢«çªƒå–æˆ–ç¯¡æ”¹ã€‚ ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠ http è®¿é—®çš„å˜æˆ httpsï¼Œå¹¶ä¸”æµè§ˆå™¨æ˜¾ç¤ºå®‰å…¨ï¼Œä¸åœ¨æ˜¯ä¸å®‰å…¨äº† 2ã€è·å–è¯ä¹¦1ã€ä¸‹è½½ 2ã€ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹ 3ã€é‡æŒ‚è½½1ã€åˆ æ‰ä¹‹å‰çš„å®¹å™¨docker rm -f nginx-web 2ã€é‡æ–°æŒ‚è½½1ã€æ–°å¢äº† 443ç«¯å£æ˜ å°„ï¼Œç›®å½•æŒ‚è½½ 2ã€å®¹å™¨å¤–ï¼Œåœ¨nginxåº•ä¸‹ï¼Œåˆ›å»ºæ–°ç›®å½• mkdir lls 3ã€åˆ›å»ºå®¹å™¨ å¤šåŠ äº†ä¸¤ä¸ªé…ç½® docker run -d -p 443:443 -p 80:80 --name nginx-web -v /root/nginx/www:/usr/share/nginx/html -v /root/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/logs:/var/log/nginx -v /root/nginx/lls/:/etc/nginx/ssl nginx 4ã€ä¿®æ”¹é…ç½®nginx.conf user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; events { worker_connections 1024; } http { limit_req_zone $binary_remote_addr zone=mylimit:10m rate=2r/s; include /etc/nginx/mime.types; default_type application/octet-stream; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; access_log /var/log/nginx/access.log main; sendfile on; #tcp_nopush on; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf; server{ listen 443 ssl; #å¯¹åº”çš„åŸŸåï¼ŒæŠŠmykkto.cnæ”¹æˆä½ ä»¬è‡ªå·±çš„åŸŸåå°±å¯ä»¥äº† server_name mykkto.cn; #è¯ä¹¦çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ ssl_certificate /etc/nginx/ssl/7526194_www.mykkto.cn.pem; ssl_certificate_key /etc/nginx/ssl/7526194_www.mykkto.cn.key; #ä»¥ä¸‹éƒ½æ˜¯ä¸€äº›åŠ å¯†è§„åˆ™ ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; ssl_prefer_server_ciphers on; #è¿™æ˜¯æˆ‘çš„ä¸»é¡µè®¿é—®åœ°å€ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯é™æ€çš„htmlç½‘é¡µï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨locationå°±å¯ä»¥å®Œæˆäº†ã€‚ location / { #æ–‡ä»¶å¤¹ï¼ˆè¿™ä¸ªå…¶å®æŒ‚è½½çš„å°±æ˜¯å¤–éƒ¨çš„wwwç›®å½•ä¸‹çš„é™æ€èµ„æºï¼‰ root //usr/share/nginx/html; #ä¸»é¡µæ–‡ä»¶ index index.html; } } server { listen 80; #è¿™è¾¹ç©ºæ ¼éš”å¼€ï¼Œé…ç½®äº†ä¸¤ä¸ªï¼Œå› ä¸ºåŠ äº†wwwä¹Ÿè¦é…ç½® server_name mykkto.cn www.mykkto.cn; rewrite ^/(.*)$ https://mykkto.cn:443/$1 permanent; # location / { # limit_req zone=mylimit; #} } } 5ã€é‡å¯å¹¶æµ‹è¯•1ã€é‡å¯docker restart nginx-web 2ã€æµ‹è¯•1ã€è®¿é—®ï¼Œwww.mykkto.cnmï¼Œè‡ªåŠ¨è·³è½¬ 2ã€è®¿é—®ï¼Œmykkto.cnï¼Œè‡ªåŠ¨è·³è½¬ äº”ã€IPé»‘åå•é™åˆ¶1ã€å‰è¨€1ã€ç”¨åˆ°ä»€ä¹ˆæŠ€æœ¯æ ˆé¦–å…ˆï¼ŒåŸºæœ¬æ¶æ„æ˜¯ docker+nginx+lua+mysqlè¿™æ˜¯æœ€åˆçš„æƒ³æ³•ï¼Œä½†æ˜¯ä½œè€…ç”¨äº†dockeræ­å»ºçš„nginxï¼Œluaæ¨¡å—é›†æˆä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥æ›¿æ¢æˆäº†ï¼ŒOpenRestyã€‚ 2ã€ä»€ä¹ˆæ˜¯ OpenRestyç®€å•æ¥è¯´å°±æ˜¯ lua + nginxï¼Œå½“ç„¶è¿˜æœ‰æ›´å¤šåŠŸèƒ½ï¼Œè‡ªå·±ç™¾åº¦å§ 3ã€é‡åˆ°çš„é—®é¢˜ç®€å•æè¿°ä¸‹ï¼Œä¸Šé¢ç”¨åˆ°çš„ nginx.confå†™æ³•ï¼Œå‰ç¼€ user nginx; ä¼šå¯¼è‡´æ— æ³•è¿è¡Œï¼Œå› ä¸ºopenrestyæ²¡æœ‰è¿™ä¸ªç”¨æˆ·ï¼Œå¯ä»¥è‡ªå·±æ–°å»ºï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯æ”¹å†™é…ç½®ã€‚ 2ã€æ­å»º OpenResty1ã€æ‹‰å–docker pull openresty/openresty 2ã€æŒ‚è½½å¹¶å¯åŠ¨è¯´æ˜ä¸‹ï¼š å®Œå…¨åŸºäºä¸Šé¢çš„nginxé…ç½®çš„ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå”¯ä¸€ä¿®æ”¹çš„æ˜¯ nginx.confé…ç½®æ–‡ä»¶ï¼Œè¿™è¾¹æŒ‚è½½æ”¹æˆäº† nginx2.confï¼Œç”¨äºä¿ç•™ä¹‹å‰çš„ï¼ˆè‡ªå·±æ‡’è€Œå·²ï¼‰ æ–°å¢äº†ï¼Œluaæ–‡ä»¶æŒ‚è½½ ä¿®æ”¹äº†å®¹å™¨å†…çš„æŒ‚è½½ä½ç½®ï¼Œå› ä¸º openrestyå®¹å™¨ä½ç½®ä¸ä¸€æ ·äº†(å¤–éƒ¨è¿˜æ˜¯ä¸å˜ï¼Œå®¹å™¨å†…çš„ä½ç½®å˜äº†) docker run -d -p 443:443 -p 80:80 --name openresty -v /root/nginx/www:/usr/local/openresty/nginx/html -v /root/nginx/conf/nginx2.conf:/usr/local/openresty/nginx/conf/nginx.conf -v /root/nginx/logs:/usr/local/openresty/nginx/logs -v /root/nginx/lls/:/usr/local/openresty/nginx/ssl -v /root/nginx/lua/:/usr/local/openresty/nginx/lua openresty/openresty 3ã€é…ç½®æ–‡ä»¶ä¿®æ”¹1ã€åˆå§‹åŒ–è¿™æ˜¯è‡ªå¸¦çš„ï¼Œå¯ä»¥è‡ªå·± DIY # nginx.conf -- docker-openresty # # This file is installed to: # `/usr/local/openresty/nginx/conf/nginx.conf` # and is the file loaded by nginx at startup, # unless the user specifies otherwise. # # It tracks the upstream OpenResty's `nginx.conf`, but removes the `server` # section and adds this directive: # `include /etc/nginx/conf.d/*.conf;` # # The `docker-openresty` file `nginx.vh.default.conf` is copied to # `/etc/nginx/conf.d/default.conf`. It contains the `server section # of the upstream `nginx.conf`. # # See https://github.com/openresty/docker-openresty/blob/master/README.md#nginx-config-files # #user nobody; #worker_processes 1; # Enables the use of JIT for regular expressions to speed-up their processing. pcre_jit on; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; # Enables or disables the use of underscores in client request header fields. # When the use of underscores is disabled, request header fields whose names contain underscores are marked as invalid and become subject to the ignore_invalid_headers directive. # underscores_in_headers off; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; # Log in JSON Format # log_format nginxlog_json escape=json '{ \"timestamp\": \"$time_iso8601\", ' # '\"remote_addr\": \"$remote_addr\", ' # '\"body_bytes_sent\": $body_bytes_sent, ' # '\"request_time\": $request_time, ' # '\"response_status\": $status, ' # '\"request\": \"$request\", ' # '\"request_method\": \"$request_method\", ' # '\"host\": \"$host\",' # '\"upstream_addr\": \"$upstream_addr\",' # '\"http_x_forwarded_for\": \"$http_x_forwarded_for\",' # '\"http_referrer\": \"$http_referer\", ' # '\"http_user_agent\": \"$http_user_agent\", ' # '\"http_version\": \"$server_protocol\", ' # '\"nginx_access\": true }'; # access_log /dev/stdout nginxlog_json; # See Move default writable paths to a dedicated directory (#119) # https://github.com/openresty/docker-openresty/issues/119 client_body_temp_path /var/run/openresty/nginx-client-body; proxy_temp_path /var/run/openresty/nginx-proxy; fastcgi_temp_path /var/run/openresty/nginx-fastcgi; uwsgi_temp_path /var/run/openresty/nginx-uwsgi; scgi_temp_path /var/run/openresty/nginx-scgi; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf; # Don't reveal OpenResty version to clients. # server_tokens off; } 2ã€å¼•å…¥ä¹‹å‰çš„é…ç½®åœ¨åˆå§‹çš„åŸºç¡€ä¸ŠåŠ ä¸Šï¼Œä¸¤ä¸ªä¹‹å‰å†™å¥½çš„ server å—ï¼Œä»¥åŠluaè„šæœ¬ç”¨äºæµ‹è¯• # nginx.conf -- docker-openresty # # This file is installed to: # `/usr/local/openresty/nginx/conf/nginx.conf` # and is the file loaded by nginx at startup, # unless the user specifies otherwise. # # It tracks the upstream OpenResty's `nginx.conf`, but removes the `server` # section and adds this directive: # `include /etc/nginx/conf.d/*.conf;` # # The `docker-openresty` file `nginx.vh.default.conf` is copied to # `/etc/nginx/conf.d/default.conf`. It contains the `server section # of the upstream `nginx.conf`. # # See https://github.com/openresty/docker-openresty/blob/master/README.md#nginx-config-files # #user nobody; #worker_processes 1; # Enables the use of JIT for regular expressions to speed-up their processing. pcre_jit on; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; # Enables or disables the use of underscores in client request header fields. # When the use of underscores is disabled, request header fields whose names contain underscores are marked as invalid and become subject to the ignore_invalid_headers directive. # underscores_in_headers off; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; # Log in JSON Format # log_format nginxlog_json escape=json '{ \"timestamp\": \"$time_iso8601\", ' # '\"remote_addr\": \"$remote_addr\", ' # '\"body_bytes_sent\": $body_bytes_sent, ' # '\"request_time\": $request_time, ' # '\"response_status\": $status, ' # '\"request\": \"$request\", ' # '\"request_method\": \"$request_method\", ' # '\"host\": \"$host\",' # '\"upstream_addr\": \"$upstream_addr\",' # '\"http_x_forwarded_for\": \"$http_x_forwarded_for\",' # '\"http_referrer\": \"$http_referer\", ' # '\"http_user_agent\": \"$http_user_agent\", ' # '\"http_version\": \"$server_protocol\", ' # '\"nginx_access\": true }'; # access_log /dev/stdout nginxlog_json; # See Move default writable paths to a dedicated directory (#119) # https://github.com/openresty/docker-openresty/issues/119 client_body_temp_path /var/run/openresty/nginx-client-body; proxy_temp_path /var/run/openresty/nginx-proxy; fastcgi_temp_path /var/run/openresty/nginx-fastcgi; uwsgi_temp_path /var/run/openresty/nginx-uwsgi; scgi_temp_path /var/run/openresty/nginx-scgi; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf; server{ listen 443 ssl; #å¯¹åº”çš„åŸŸåï¼ŒæŠŠmykkto.cnæ”¹æˆä½ ä»¬è‡ªå·±çš„åŸŸåå°±å¯ä»¥äº† server_name mykkto.cn; #è¯ä¹¦çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ ssl_certificate /usr/local/openresty/nginx/ssl/7526194_www.mykkto.cn.pem; ssl_certificate_key /usr/local/openresty/nginx/ssl/7526194_www.mykkto.cn.key; #ä»¥ä¸‹éƒ½æ˜¯ä¸€äº›åŠ å¯†è§„åˆ™ ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; ssl_prefer_server_ciphers on; #è¿™æ˜¯æˆ‘çš„ä¸»é¡µè®¿é—®åœ°å€ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯é™æ€çš„htmlç½‘é¡µï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨locationå°±å¯ä»¥å®Œæˆäº†ã€‚ location / { #æ–‡ä»¶å¤¹ï¼ˆè¿™ä¸ªå…¶å®æŒ‚è½½çš„å°±æ˜¯å¤–éƒ¨çš„wwwç›®å½•ä¸‹çš„é™æ€èµ„æºï¼‰ root /usr/local/openresty/nginx/html; #ä¸»é¡µæ–‡ä»¶ index index.html; } #luaè„šæœ¬ç”¨äºæµ‹è¯• location /lua { default_type 'text/html'; content_by_lua 'ngx.say(\"&lt;h1&gt; hello,openrestry&lt;/h1&gt;\")'; } } server { listen 80; #è¿™è¾¹ç©ºæ ¼éš”å¼€ï¼Œé…ç½®äº†ä¸¤ä¸ªï¼Œå› ä¸ºåŠ äº†wwwä¹Ÿè¦é…ç½® server_name mykkto.cn www.mykkto.cn; rewrite ^/(.*)$ https://mykkto.cn:443/$1 permanent; # location / { # limit_req zone=mylimit; #} } # Don't reveal OpenResty version to clients. # server_tokens off; } 3ã€æµ‹è¯•luaè„šæœ¬ å…­ã€é™æµ1ã€é…ç½®http { limit_req_zone $binary_remote_addr zone=one:10m rate=5r/s; server { location /search/ { limit_req zone=one burst=5 nodelay; } } limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s; ç¬¬ä¸€ä¸ªå‚æ•°ï¼š$binary_remote_addr è¡¨ç¤ºé€šè¿‡remote_addrè¿™ä¸ªæ ‡è¯†æ¥åšé™åˆ¶ï¼Œâ€œbinary_â€çš„ç›®çš„æ˜¯ç¼©å†™å†…å­˜å ç”¨é‡ï¼Œæ˜¯é™åˆ¶åŒä¸€å®¢æˆ·ç«¯ipåœ°å€ã€‚ ç¬¬äºŒä¸ªå‚æ•°ï¼šzone=one:10mè¡¨ç¤ºç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º10Mï¼Œåå­—ä¸ºoneçš„å†…å­˜åŒºåŸŸï¼Œç”¨æ¥å­˜å‚¨è®¿é—®çš„é¢‘æ¬¡ä¿¡æ¯ã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šrate=5r/sè¡¨ç¤ºå…è®¸ç›¸åŒæ ‡è¯†çš„å®¢æˆ·ç«¯çš„è®¿é—®é¢‘æ¬¡ï¼Œè¿™é‡Œé™åˆ¶çš„æ˜¯æ¯ç§’ 5 æ¬¡ï¼Œè¿˜å¯ä»¥æœ‰æ¯”å¦‚30r/mçš„ã€‚ limit_req zone=one burst=5 nodelay; ç¬¬ä¸€ä¸ªå‚æ•°ï¼šzone=one è®¾ç½®ä½¿ç”¨å“ªä¸ªé…ç½®åŒºåŸŸæ¥åšé™åˆ¶ï¼Œä¸ä¸Šé¢limit_req_zone é‡Œçš„nameå¯¹åº”ã€‚ ç¬¬äºŒä¸ªå‚æ•°ï¼šburst=5ï¼Œé‡ç‚¹è¯´æ˜ä¸€ä¸‹è¿™ä¸ªé…ç½®ï¼Œburstçˆ†å‘çš„æ„æ€ï¼Œè¿™ä¸ªé…ç½®çš„æ„æ€æ˜¯è®¾ç½®ä¸€ä¸ªå¤§å°ä¸º5çš„ç¼“å†²åŒºå½“æœ‰å¤§é‡è¯·æ±‚ï¼ˆçˆ†å‘ï¼‰è¿‡æ¥æ—¶ï¼Œè¶…è¿‡äº†è®¿é—®é¢‘æ¬¡é™åˆ¶çš„è¯·æ±‚å¯ä»¥å…ˆæ”¾åˆ°è¿™ä¸ªç¼“å†²åŒºå†…ã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šnodelayï¼Œå¦‚æœè®¾ç½®ï¼Œè¶…è¿‡è®¿é—®é¢‘æ¬¡è€Œä¸”ç¼“å†²åŒºä¹Ÿæ»¡äº†çš„æ—¶å€™å°±ä¼šç›´æ¥è¿”å›503ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™æ‰€æœ‰è¯·æ±‚ä¼šç­‰å¾…æ’é˜Ÿã€‚ 2ã€ç½‘ç«™é…ç½®æºç #user nobody; #worker_processes 1; # Enables the use of JIT for regular expressions to speed-up their processing. pcre_jit on; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; server_tokens off; #å¼•å…¥libåŒ… lua_package_path \"/usr/local/openresty/lualib/?.lua;;\"; #å¼€è¾Ÿä¸€å—å†…å­˜åŒºåŸŸ lua_shared_dict ip_blacklist 4m; # Enables or disables the use of underscores in client request header fields. # When the use of underscores is disabled, request header fields whose names contain underscores are marked as invalid and become subject to the ignore_invalid_headers directive. # underscores_in_headers off; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; # Log in JSON Format # log_format nginxlog_json escape=json '{ \"timestamp\": \"$time_iso8601\", ' # '\"remote_addr\": \"$remote_addr\", ' # '\"body_bytes_sent\": $body_bytes_sent, ' # '\"request_time\": $request_time, ' # '\"response_status\": $status, ' # '\"request\": \"$request\", ' # '\"request_method\": \"$request_method\", ' # '\"host\": \"$host\",' # '\"upstream_addr\": \"$upstream_addr\",' # '\"http_x_forwarded_for\": \"$http_x_forwarded_for\",' # '\"http_referrer\": \"$http_referer\", ' # '\"http_user_agent\": \"$http_user_agent\", ' # '\"http_version\": \"$server_protocol\", ' # '\"nginx_access\": true }'; # access_log /dev/stdout nginxlog_json; # See Move default writable paths to a dedicated directory (#119) # https://github.com/openresty/docker-openresty/issues/119 client_body_temp_path /var/run/openresty/nginx-client-body; proxy_temp_path /var/run/openresty/nginx-proxy; fastcgi_temp_path /var/run/openresty/nginx-fastcgi; uwsgi_temp_path /var/run/openresty/nginx-uwsgi; scgi_temp_path /var/run/openresty/nginx-scgi; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf; #é™æµè®¾ç½® limit_req_zone $binary_remote_addr zone=one:30m rate=10r/s; server{ listen 443 ssl; #å¯¹åº”çš„åŸŸåï¼ŒæŠŠmykkto.cnæ”¹æˆä½ ä»¬è‡ªå·±çš„åŸŸåå°±å¯ä»¥äº† server_name mykkto.cn; #è¯ä¹¦çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ ssl_certificate /usr/local/openresty/nginx/ssl/7526194_www.mykkto.cn.pem; ssl_certificate_key /usr/local/openresty/nginx/ssl/7526194_www.mykkto.cn.key; #ä»¥ä¸‹éƒ½æ˜¯ä¸€äº›åŠ å¯†è§„åˆ™ ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; ssl_prefer_server_ciphers on; #è¿™æ˜¯æˆ‘çš„ä¸»é¡µè®¿é—®åœ°å€ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯é™æ€çš„htmlç½‘é¡µï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨locationå°±å¯ä»¥å®Œæˆäº†ã€‚ set $real_ip $remote_addr; if ( $http_x_forwarded_for ~ \"^(\\d+\\.\\d+\\.\\d+\\.\\d+)\" ) { set $real_ip $1; } # ç®¡ç†ä¿¡æ¯ï¼Œè®¿é—®è¯¥URLå¯ä»¥æŸ¥çœ‹nginxä¸­çš„IPé»‘åå•ä¿¡æ¯ location /get-ipblacklist-info { access_by_lua_file /usr/local/openresty/nginx/lua/get_ipblacklist_info.lua; } # åŒæ­¥URLï¼Œé€šè¿‡å®šæ—¶ä»»åŠ¡è°ƒç”¨è¯¥URL,å®ç°IPé»‘åå•ä»mysqlåˆ°nginxçš„å®šæ—¶åˆ·æ–° location /sync-ipblacklist { access_by_lua_file /usr/local/openresty/nginx/lua/sync_ipblacklist.lua; } location / { #é™æµ limit_req zone=one burst=10 nodelay; # æ‰€æœ‰IPè¿›æ¥éƒ½è¦æ ¡éªŒ access_by_lua_file /usr/local/openresty/nginx/lua/check_realip.lua; # proxy_read_timeout 60s; # proxy_set_header Host $http_host; # proxy_set_header X-Real_IP $remote_addr; # proxy_set_header X-Forwarded-for $remote_addr; # proxy_http_version 1.1; #æ–‡ä»¶å¤¹ï¼ˆè¿™ä¸ªå…¶å®æŒ‚è½½çš„å°±æ˜¯å¤–éƒ¨çš„wwwç›®å½•ä¸‹çš„é™æ€èµ„æºï¼‰ root /usr/local/openresty/nginx/html; #ä¸»é¡µæ–‡ä»¶ index index.html; } } server { listen 80; #è¿™è¾¹ç©ºæ ¼éš”å¼€ï¼Œé…ç½®äº†ä¸¤ä¸ªï¼Œå› ä¸ºåŠ äº†wwwä¹Ÿè¦é…ç½® server_name mykkto.cn www.mykkto.cn; rewrite ^/(.*)$ https://mykkto.cn:443/$1 permanent; # location / { # limit_req zone=mylimit; #} } # Don't reveal OpenResty version to clients. # server_tokens off; } 3ã€æµ‹è¯•QPSï¼š3000å‹æµ‹ 5æ¬¡ å‹æµ‹çš„IPä¸º Aï¼Œé€šè¿‡ï¼ŒåŒç½‘æ®µçš„æœºå™¨è®¿é—®ï¼ˆæ‰‹æœºæ¨¡æ‹Ÿï¼‰ï¼Œ503å¼‚å¸¸ï¼Œç»“è®ºè¢«é™æµæˆåŠŸ åˆ‡æ¢ç½‘æ®µB ï¼Œéå‹æµ‹IP ä¸é™æµï¼Œæµ‹è¯•æˆåŠŸ ä¸ƒã€DNSè§£æ+Github Pagesï¼ˆæ— æœåŠ¡å™¨åŒ–ï¼‰å‰æï¼šå…ˆä¹°ä¸ªDNSè§£æï¼Œåšä¸»ç›®å‰åŸŸåå’ŒDNSè§£æéƒ½æ˜¯ä¹°é˜¿é‡Œäº‘çš„ 1ã€DNSè§£æåŸŸåè¿™ä¸ªæ˜¯åˆç‰ˆ1.0ï¼Œé”™è¯¯çš„ï¼Œå› ä¸º ä¸»æœºè®°å½•è§£æ * å¯èƒ½è¦†ç›–åé¢åºŠå›¾æŒ‡å‘çš„ v1 é…ç½® æ­£ç¡®é…ç½®ï¼šæœ€æ–°ç‰ˆï¼ï¼ï¼ 2ã€Github Pagesè¿›å…¥è‡ªå·±äºŒçº§é™æ€ç½‘ç«™ä»“åº“ï¼Œé…ç½®ï¼ˆå¦‚æœæœ‰é…SSLè¯ä¹¦çš„æ‰“å‹¾ï¼Œæ²¡æœ‰ä¸éœ€è¦æ‰“å‹¾ HTTPSï¼‰ å…³äºè¯ä¹¦ï¼šåé¢æ­å»ºåºŠå›¾ä¹Ÿéœ€è¦æŒ‡å‘ï¼Œä¸ç„¶æ— æ³•åŠ è½½å›¾ç‰‡ï¼ˆå°å‘ï¼‰ å…«ã€Nginxæ­å»ºåºŠå›¾åŸºäºdnsè§£æ + Github pages æ˜ å°„é€‚é… ä¼ ç»Ÿæ­å»ºæ–¹å¼ï¼ˆhttpï¼‰,ä¼šå¯¼è‡´åœ¨ img ä¸Šæ¸²æŸ“å›¾ç‰‡çš„æ—¶å€™æ— æ³•æ˜¾ç¤ºï¼ˆè°·æ­Œæµè§ˆå™¨ï¼ŒIEæµè§ˆå™¨ä¼šï¼Œ360æé€Ÿä¸ä¼šâ€“å…·ä½“ä¸æ¸…æ¥šï¼‰ï¼Œ å› ä¸º pages å¼€å¯äº† https æ‰€ä»¥ï¼Œè‡ªå·±æ­å»ºçš„åºŠå›¾ä¹Ÿè¦æ˜¯ https ï¼ˆæˆ‘æ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œç„¶åå®ç°ï¼Œç¡®å®å¯ä»¥äº†ï¼‰ åˆ†æï¼šä¸€å¼€å§‹çœ‹åˆ° console æ§åˆ¶å°ï¼Œ ä¸€å †å›¾ç‰‡æŠ¥é”™ ï¼Œäºæ˜¯æ‹¿è¿æ¥å»è¯·æ±‚ï¼Œå‘ç°ä¸å¯ä»¥è®¿é—®ï¼ˆå¸¦httpï¼Œæ—  sï¼‰ 1ã€é…ç½®åŸŸåè§£æåˆç‰ˆ1.0ï¼ŒåºŸå¼ƒï¼Œæœ€å¥½ä¸è¦ç”¨ _ ä¸ºå‰ç¼€ï¼Œå› ä¸ºåé¢è¦æ˜¯æœ‰é…ç½®SSLè¯ä¹¦ï¼Œå°±æ— æ³•é€šè¿‡ æœ€æ–°2.0é…ç½®ï¼Œå®Œç¾è§£å†³äº†æ‰€æœ‰é—®é¢˜ 2ã€é…ç½®SSLè¯ä¹¦è´­ä¹°è¯ä¹¦ï¼Œè¿™è¾¹ä½œè€…ç”¨çš„æ˜¯å…è´¹çš„ ç„¶åä¸‹è½½éƒ¨ç½²ï¼Œå…·ä½“é…ç½®ä¿¡æ¯ 4 nginx.conf 3ã€æ­å»ºå…·ä½“å‚è€ƒ ä¸€ã€å››ç”¨äº†docker 4ã€è¡¥å……1ã€nginx é…ç½®user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; events { worker_connections 1024; } http { limit_req_zone $binary_remote_addr zone=mylimit:10m rate=2r/s; include /etc/nginx/mime.types; default_type application/octet-stream; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; access_log /var/log/nginx/access.log main; sendfile on; #tcp_nopush on; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf; server{ listen 443 ssl; #å¯¹åº”çš„åŸŸåï¼ŒæŠŠmykkto.cnæ”¹æˆä½ ä»¬è‡ªå·±çš„åŸŸåå°±å¯ä»¥äº† server_name mykkto.cn; #è¯ä¹¦çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ ssl_certificate /etc/nginx/ssl/8799443_v1.mykkto.cn.pem; ssl_certificate_key /etc/nginx/ssl/8799443_v1.mykkto.cn.key; #ä»¥ä¸‹éƒ½æ˜¯ä¸€äº›åŠ å¯†è§„åˆ™ ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; ssl_prefer_server_ciphers on; #è¿™æ˜¯æˆ‘çš„ä¸»é¡µè®¿é—®åœ°å€ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯é™æ€çš„htmlç½‘é¡µï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨locationå°±å¯ä»¥å®Œæˆäº†ã€‚ location / { #æ–‡ä»¶å¤¹ï¼ˆè¿™ä¸ªå…¶å®æŒ‚è½½çš„å°±æ˜¯å¤–éƒ¨çš„wwwç›®å½•ä¸‹çš„é™æ€èµ„æºï¼‰ root //usr/share/nginx/html; #ä¸»é¡µæ–‡ä»¶ index index.html; } } server { listen 80; #è¿™è¾¹ç©ºæ ¼éš”å¼€ï¼Œé…ç½®äº†ä¸¤ä¸ªï¼Œå› ä¸ºåŠ äº†wwwä¹Ÿè¦é…ç½® server_name mykkto.cn; rewrite ^/(.*)$ https://mykkto.cn:443/$1 permanent; # location / { # limit_req zone=mylimit; #} } } 2ã€æ›´æ–°åºŠå›¾è„šæœ¬ 3ã€PICGO é…ç½® å‚è€ƒ â†“â€”â€” ã€ä¸€åˆ°ä¸‰ã€‘å‚è€ƒâ€”â€”â€”â€“ https://www.cnblogs.com/zltech/p/13517231.html https://www.cnblogs.com/thepoy/p/14848080.html https://www.cnblogs.com/jianqingwang/p/6726589.html â€”â€” ã€ä¸€åˆ°ä¸‰ã€‘å‚è€ƒâ€”â€”â€”â€“ SSLè¯ä¹¦å‚è€ƒ&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; https://www.cnblogs.com/zeussbook/p/11231820.html https://www.cnblogs.com/yuyeblog/p/13582127.html https://www.cnblogs.com/makalochen/p/14241052.html#%E5%A4%9A%E7%9B%AE%E5%BD%95%E6%8C%82%E8%BD%BD IPé»‘åå•å‚è€ƒ&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; https://www.jb51.net/article/168907.htm https://blog.csdn.net/weixin_33971205/article/details/89861486 https://www.csdn.net/tags/MtTaIgzsNDYzNDUtYmxvZwO0O0OO0O0O.html é™æµ&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; https://www.cnblogs.com/biglittleant/p/8979915.html DNSè§£æ+Github Pagesï¼ˆæ— æœåŠ¡å™¨ï¼‰ https://cloud.tencent.com/developer/article/2019284","categories":[{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://mykkto.github.io/categories/%E5%8D%9A%E5%AE%A2/"}],"tags":[{"name":"blog","slug":"blog","permalink":"https://mykkto.github.io/tags/blog/"},{"name":"éƒ¨ç½²","slug":"éƒ¨ç½²","permalink":"https://mykkto.github.io/tags/%E9%83%A8%E7%BD%B2/"},{"name":"å°å§¿åŠ¿","slug":"å°å§¿åŠ¿","permalink":"https://mykkto.github.io/tags/%E5%B0%8F%E5%A7%BF%E5%8A%BF/"}],"author":"mykk"},{"title":"SpringCloud-Alibaba-Sentinel å®ç°ç†”æ–­ä¸é™æµ","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/15_SpringCloudAlibaba-Sentinel","date":"2022-03-13T07:17:13.000Z","updated":"2023-06-11T02:53:45.168Z","comments":true,"path":"posts/32724da3.html","link":"","permalink":"https://mykkto.github.io/posts/32724da3.html","excerpt":"","text":"ä¸€ã€æ¦‚è¿°1ã€å®˜ç½‘https://github.com/alibaba/Sentinel https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D 2ã€æ˜¯ä»€ä¹ˆä¸€å¥è¯è§£é‡Šï¼Œå°±æ˜¯ç±»ä¼¼äº Hystrix 3ã€å»å“ªä¸‹https://github.com/alibaba/Sentinel/releases 4ã€èƒ½å¹²å˜› æœåŠ¡ä½¿ç”¨ä¸­çš„å„ç§é—®é¢˜ æœåŠ¡é›ªå´© æœåŠ¡é™çº§ æœåŠ¡ç†”æ–­ æœåŠ¡é™æµ äºŒã€å®‰è£…æ§åˆ¶å°1ã€sentinelç»„ä»¶ç”±ä¸¤éƒ¨åˆ†æ„æˆ åå° å‰å°8080 2ã€å®‰è£…æ­¥éª¤1ã€æ‹‰å–é•œåƒdocker pull bladex/sentinel-dashboard:1.7.0 2ã€å¯åŠ¨å¹¶åˆ›å»ºå®¹å™¨docker run --name sentinel -d -p 8858:8858 bladex/sentinel-dashboard:1.7.0 3ã€è®¿é—®ip:8858 ç™»å½•è´¦å·å¯†ç å‡ä¸ºsentinel ä¸‰ã€åˆå§‹åŒ–å·¥ç¨‹1ã€å¯åŠ¨å‡†å¤‡å·¥ä½œå¯åŠ¨ sentinel ï¼ˆ8858ï¼‰ï¼Œnacosï¼ˆ8848ï¼‰ 2ã€model1ã€å»ºmodelcloudalibaba-sentinel-service8401 2ã€pom&lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt; &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-sentinel-service8401&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt; &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶+actuator --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;4.6.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: #NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: 101.34.180.133:8848 sentinel: transport: #é…ç½®Sentinel dashboardåœ°å€ # dashboard: 101.34.180.133:8858 # dashboard: 106.52.23.202:8080 # é¡¹ç›®å’Œ sentinel ä¸åœ¨åŒä¸€å°æœºå™¨æ— æ³•æŸ¥çœ‹å®æ—¶ç›‘æ§ dashboard: localhost:8080 #é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ port: 8719 # æœ¬åœ°æœºå™¨ip(dockerå®¹å™¨å¿…é¡»åŠ ä¸Š) # client-ip: 169.254.135.77 management: endpoints: web: exposure: include: '*' 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @SpringBootApplication @EnableDiscoveryClient public class SpringCloudSentinelMain8401 { public static void main(String[] args) { SpringApplication.run (SpringCloudSentinelMain8401.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class FlowLimitController { @GetMapping(\"/testA\") public String testA() { return \"------testA\"; } @GetMapping(\"/testB\") public String testB() { return \"------testB\"; } } 3ã€æ“ä½œ sentinelæ§åˆ¶å°1ã€åˆšè¿›æ¥ç©ºç©ºå¦‚ä¹Ÿï¼Œå•¥éƒ½æ²¡æœ‰ 2ã€æ‡’åŠ è½½è¯´æ˜ Sentinelé‡‡ç”¨çš„æ‡’åŠ è½½è¯´æ˜ éœ€è¦æ‰§è¡Œä¸€æ¬¡ http://localhost:8401/testA http://localhost:8401/testB è¿™è¾¹éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šå¦‚æœä½ çš„å®æ—¶ç›‘æ§æ²¡æœ‰æ•°æ®ï¼Œå¯èƒ½æ˜¯å› ä¸º sentinel å’Œé¡¹ç›®ä¸å†åŒä¸€ä¸ª æœºå™¨æˆ–è€… sentinelè®¿é—®ä¸åˆ° é¡¹ç›®å°±ç›‘æ§ä¸åˆ°äº† å››ã€æµæ§åˆ¶è§„åˆ™1ã€åŸºæœ¬ä»‹ç» 2ã€æµæ§æ¨¡å¼1ã€ç›´æ¥(é»˜è®¤)è¡¨ç¤ºï¼š1ç§’é’Ÿå†…æŸ¥è¯¢1æ¬¡å°±æ˜¯OKï¼Œè‹¥è¶…è¿‡æ¬¡æ•°1ï¼Œå°±ç›´æ¥-å¿«é€Ÿå¤±è´¥ï¼ŒæŠ¥é»˜è®¤é”™è¯¯ 1ã€é…ç½®å†…å®¹ 2ã€æµ‹è¯•æ•ˆæœè®¿é—®ï¼šhttp://localhost:8401/testA 3ã€ç»“è®ºæ€è€ƒç›´æ¥è°ƒç”¨é»˜è®¤æŠ¥é”™ä¿¡æ¯ï¼ŒæŠ€æœ¯æ–¹é¢OKï¼Œ ä½†æ˜¯å¦åº”è¯¥æœ‰æˆ‘ä»¬è‡ªå·±çš„åç»­å¤„ç†ï¼Œç±»ä¼¼æœ‰ä¸ªfallbackçš„å…œåº•æ–¹æ³• 2ã€å…³è”1ã€æ˜¯ä»€ä¹ˆ å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·± å½“ä¸Aå…³è”çš„èµ„æºBè¾¾åˆ°é˜€å€¼åï¼Œå°±é™æµAè‡ªå·± Bæƒ¹äº‹ï¼ŒAæŒ‚äº† 2ã€é…ç½®Aå½“å…³è”èµ„æº /testB çš„ qps é˜€å€¼è¶…è¿‡1æ—¶ï¼Œå°±é™æµ /testA çš„Restè®¿é—®åœ°å€ï¼Œå½“å…³è”èµ„æºåˆ°é˜ˆå€¼åé™åˆ¶é…ç½®å¥½çš„èµ„æºå 3ã€postmanæ¨¡æ‹Ÿå¹¶å‘å¯†é›†è®¿é—®testBåˆ›å»ºä¸€ä¸ªé›†åˆå¹¶å‘æµ‹è¯•æ–‡ä»¶å¤¹ å°†æµ‹è¯•çš„urlæ”¾è¿›æ–‡ä»¶å¤¹ 4ã€æµ‹è¯•å¯åŠ¨å¹¶å‘å¯¹ /testB runï¼Œå†æ¬¡è¿‡ç¨‹ä¸­è®¿é—® /testB å‘ç°å‡ºé”™ 3ã€é“¾è·¯ å¤šä¸ªè¯·æ±‚è°ƒç”¨äº†åŒä¸€ä¸ªå¾®æœåŠ¡ 2Xï¼ˆæµæ§æ¨¡å¼æ€»ç»“ï¼‰ ç›´æ¥ï¼šå¯¹å½“å‰èµ„æºé™æµ å…³è”ï¼šé«˜ä¼˜å…ˆçº§èµ„æºè§¦å‘é˜ˆå€¼ï¼Œå¯¹ä½ä¼˜å…ˆçº§èµ„æºé™æµã€‚ é“¾è·¯ï¼šé˜ˆå€¼ç»Ÿè®¡æ—¶ï¼Œåªç»Ÿè®¡ä»æŒ‡å®šèµ„æºè¿›å…¥å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œæ˜¯å¯¹è¯·æ±‚æ¥æºçš„é™æµ 3ã€æµæ§æ•ˆæœ1ã€å¿«é€Ÿå¤±è´¥è¾¾åˆ°å³°å€¼ï¼Œç›´æ¥å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼ˆBlocked by Sentinel (flow limiting)ï¼‰ æºç ï¼ˆä¿®æ”¹æ‰©å±•ä½ç½®ï¼‰ï¼šcom.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController 2ã€WarmUpï¼ˆé¢„çƒ­ï¼‰1ã€å…¬å¼é˜ˆå€¼é™¤ä»¥coldFactor(é»˜è®¤å€¼ä¸º3),ç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜ˆå€¼ 2ã€å®˜ç½‘ é»˜è®¤coldFactorä¸º3ï¼Œå³è¯·æ±‚ QPS ä» threshold / 3 å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„ QPS é˜ˆå€¼ã€‚ é™æµï¼Œå†·å¯åŠ¨ https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8 3ã€æºç com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController 4ã€WarmUpé…ç½® é»˜è®¤ coldFactor ä¸º 3ï¼Œå³è¯·æ±‚QPSä»(threshold / 3) å¼€å§‹ï¼Œç»å¤šå°‘é¢„çƒ­æ—¶é•¿æ‰é€æ¸å‡è‡³è®¾å®šçš„ QPS é˜ˆå€¼ã€‚ æ¡ˆä¾‹ï¼Œé˜€å€¼ä¸º10+é¢„çƒ­æ—¶é•¿è®¾ç½®5ç§’ã€‚ç³»ç»Ÿåˆå§‹åŒ–çš„é˜€å€¼ä¸º10 / 3 çº¦ç­‰äº3,å³é˜€å€¼åˆšå¼€å§‹ä¸º3ï¼›ç„¶åè¿‡äº†5ç§’åé˜€å€¼æ‰æ…¢æ…¢å‡é«˜æ¢å¤åˆ°10 5ã€ç‚¹å‡»æµ‹è¯•å¤šæ¬¡ç‚¹å‡»http://localhost:8401/testB åˆšå¼€å§‹ä¸è¡Œï¼Œåç»­æ…¢æ…¢OK 6ã€åº”ç”¨åœºæ™¯å¦‚ï¼šç§’æ€ç³»ç»Ÿåœ¨å¼€å¯çš„ç¬é—´ï¼Œä¼šæœ‰å¾ˆå¤šæµé‡ä¸Šæ¥ï¼Œå¾ˆæœ‰å¯èƒ½æŠŠç³»ç»Ÿæ‰“æ­»ï¼Œé¢„çƒ­æ–¹å¼å°±æ˜¯æŠŠä¸ºäº†ä¿æŠ¤ç³»ç»Ÿï¼Œå¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾è¿›æ¥ï¼Œæ…¢æ…¢çš„æŠŠé˜€å€¼å¢é•¿åˆ°è®¾ç½®çš„é˜€å€¼ã€‚ 3ã€æ’é˜Ÿç­‰å¾…1ã€è¯´æ˜åŒ€é€Ÿæ’é˜Ÿï¼Œé˜ˆå€¼å¿…é¡»è®¾ç½®ä¸ºQPS 2ã€å®˜ç½‘https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6 3ã€æºç com.alibaba.csp.sentinel.slots.block.flow.controller.RateLimiterController 4ã€é…ç½® åŒ€é€Ÿæ’é˜Ÿï¼Œè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜€å€¼ç±»å‹å¿…é¡»è®¾æˆQPSï¼Œå¦åˆ™æ— æ•ˆã€‚ è®¾ç½®å«ä¹‰ï¼š /testB æ¯ç§’1æ¬¡è¯·æ±‚ï¼Œè¶…è¿‡çš„è¯å°±æ’é˜Ÿç­‰å¾…ï¼Œç­‰å¾…çš„è¶…æ—¶æ—¶é—´ä¸º20000æ¯«ç§’ã€‚ 5ã€æµ‹è¯• äº”ã€é™çº§è§„åˆ™1ã€å®˜ç½‘https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7 2ã€åŸºæœ¬ä»‹ç»1ã€è¯´æ˜ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçŠ¶æ€æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…æ—¶æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ï¼Œå¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œè®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶å®ƒçš„èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ã€‚ å½“èµ„æºè¢«é™çº§åï¼Œåœ¨æ¥ä¸‹æ¥çš„é™çº§æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¯¥èµ„æºçš„è°ƒç”¨éƒ½è‡ªåŠ¨ç†”æ–­ï¼ˆé»˜è®¤è¡Œä¸ºæ˜¯æŠ›å‡º DegradeExceptionï¼‰ 2ã€hystrixæ¯”è¾ƒSentinelçš„æ–­è·¯å™¨æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ åŠå¼€çš„çŠ¶æ€ç³»ç»Ÿè‡ªåŠ¨å»æ£€æµ‹æ˜¯å¦è¯·æ±‚æœ‰å¼‚å¸¸ï¼Œæ²¡æœ‰å¼‚å¸¸å°±å…³é—­æ–­è·¯å™¨æ¢å¤ä½¿ç”¨ï¼Œæœ‰å¼‚å¸¸åˆ™ç»§ç»­æ‰“å¼€æ–­è·¯å™¨ä¸å¯ç”¨ã€‚å…·ä½“å¯ä»¥å‚è€ƒHystrix ä»¥ä¸‹æ˜¯hystrixæ–­è·¯å™¨ç»“æ„å›¾ 3ã€é™çº§ç­–ç•¥å®æˆ˜1ã€RT 1ã€ä»£ç @GetMapping(\"/testD\") public String testD() { //æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹ try { TimeUnit.SECONDS.sleep (1); } catch (InterruptedException e) { e.printStackTrace ( ); } log.info (\"testD æµ‹è¯•RT\"); return \"------testD\"; } 2ã€é…ç½® 3ã€jmeterå‹æµ‹ 4ã€ç»“æœ 2ã€å¼‚å¸¸æ¯”ä¾‹1ã€æ˜¯ä»€ä¹ˆ 2ã€ä»£ç @GetMapping(\"/testD\") public String testD() { log.info (\"testD æµ‹è¯•å¼‚å¸¸æ¯”ä¾‹\"); int age = 10 / 0; return \"------testD\"; } 3ã€é…ç½® 4ã€jmeter 5ã€ç»“è®º 3ã€å¼‚å¸¸æ•°1ã€æ˜¯ä»€ä¹ˆ 2ã€éœ€çŸ¥å¼‚å¸¸æ•°æ˜¯æŒ‰ç…§åˆ†é’Ÿç»Ÿè®¡çš„ 3ã€ä»£ç @GetMapping(\"/testE\") public String testE() { log.info (\"testE æµ‹è¯•å¼‚å¸¸æ¯”ä¾‹\"); int age = 10 / 0; return \"------testE æµ‹è¯•å¼‚å¸¸æ¯”ä¾‹\"; } 4ã€é…ç½® 5ã€jmeter å…­ã€çƒ­ç‚¹keyé™æµ1ã€åŸºæœ¬ä»‹ç»1ã€æ˜¯ä»€ä¹ˆä½•ä¸ºçƒ­ç‚¹ çƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æˆ–è€…é™åˆ¶æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„TopNæ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™æµæˆ–è€…å…¶å®ƒæ“ä½œ 2ã€å®˜ç½‘https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81 3ã€å…œåº•æ–¹æ³•sentinelç³»ç»Ÿé»˜è®¤çš„æç¤ºï¼šBlocked by Sentinel (flow limiting) å¯ä»¥æŒ‡å®šï¼Œè‡ªå®šä¹‰å…œåº•æ–¹æ³• ä»HystrixCommand åˆ°@SentinelResource 2ã€æ¡ˆä¾‹1ã€ä»£ç @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"dealHandler_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false) String p1, @RequestParam(value = \"p2\", required = false) String p2) { return \"------testHotKey\"; } public String dealHandler_testHotKey(String p1, String p2, BlockException exception) { return \"-----dealHandler_testHotKey\"; } 2ã€é…ç½®è¯´æ˜ é™æµæ¨¡å¼åªæ”¯æŒQPSæ¨¡å¼ï¼Œå›ºå®šå†™æ­»äº†ã€‚ï¼ˆè¿™æ‰å«çƒ­ç‚¹ï¼‰@SentinelResourceæ³¨è§£çš„æ–¹æ³•å‚æ•°ç´¢å¼•ï¼Œ0ä»£è¡¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ1ä»£è¡¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨å•æœºé˜€å€¼ä»¥åŠç»Ÿè®¡çª—å£æ—¶é•¿è¡¨ç¤ºåœ¨æ­¤çª—å£æ—¶é—´è¶…è¿‡é˜€å€¼å°±é™æµã€‚ä¸Šé¢çš„æŠ“å›¾å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æœ‰å€¼çš„è¯ï¼Œ1ç§’çš„QPSä¸º1ï¼Œè¶…è¿‡å°±é™æµï¼Œé™æµåè°ƒç”¨ dealHandler_testHotKeyæ”¯æŒæ–¹æ³•ã€‚ 3ã€é…ç½® @SentinelResource(value = \"testHotKey\",blockHandler = \"dealHandler_testHotKey\") æ–¹æ³•testHotKeyé‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°åªè¦QPSè¶…è¿‡æ¯ç§’1æ¬¡ï¼Œé©¬ä¸Šé™çº§å¤„ç† 4ã€æµ‹è¯•http://localhost:8401/testHotKey?p1=abc http://localhost:8401/testHotKey?p1=abc&amp;p2=33 http://localhost:8401/testHotKey?p2=33 3ã€å‚æ•°é«˜çº§é€‰é¡¹1ã€ä½œç”¨ä¸Šè¿°æ¡ˆä¾‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°p1ï¼Œå½“QPSè¶…è¿‡1ç§’1æ¬¡ç‚¹å‡»åé©¬ä¸Šè¢«é™æµ è‹¥æ˜¯æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œp1ç‰¹ä¾‹ä¸º5 ï¼ŒQPS é˜ˆå€¼ä¸º 200å°±å¯ä»¥é€šè¿‡ è¿™ä¸ªå®ç° 2ã€é…ç½® 3ã€æµ‹è¯•http://localhost:8401/testHotKey?p1=5 http://localhost:8401/testHotKey?p1=3 4ã€ç»“è®ºå½“p1ç­‰äº5çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 å½“p1ä¸ç­‰äº5çš„æ—¶å€™ï¼Œé˜ˆå€¼ä¸ºå¹³å¸¸çš„ 1 çƒ­ç‚¹å‚æ•°çš„æ³¨æ„ç‚¹ï¼Œå‚æ•°å¿…é¡»æ˜¯åŸºæœ¬ç±»å‹æˆ–è€…String ä¸ƒã€@SentinelResource1ã€æŒ‰èµ„æºåç§°é™æµ+åç»­å¤„ç†1ã€ä»£ç 1ã€ä»£ç  package com.kk.springcloud.controller; import com.alibaba.csp.sentinel.annotation.SentinelResource; import com.alibaba.csp.sentinel.slots.block.BlockException; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class RateLimitController { @GetMapping(\"/byResource\") @SentinelResource(value = \"byResource\",blockHandler = \"handleException\") public CommonResult byResource() { return new CommonResult (200,\"æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK\",new Payment (2020L,\"serial001\")); } public CommonResult handleException(BlockException exception) { return new CommonResult(444,exception.getClass().getCanonicalName()+\"\\t æœåŠ¡ä¸å¯ç”¨\"); } } 2ã€pom &lt;dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; 2ã€é…ç½®æµæ§è§„åˆ™1ã€æ­¥éª¤ 2ã€å›¾å½¢é…ç½®å’Œä»£ç å…³ç³» 3ã€é…ç½®è¯´æ˜è¡¨ç¤º1ç§’é’Ÿå†…æŸ¥è¯¢æ¬¡æ•°å¤§äº1ï¼Œå°±è·‘åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„å¤„æµï¼Œé™æµ 3ã€æµ‹è¯•1ç§’é’Ÿç‚¹å‡»1ä¸‹ï¼ŒOK è¶…è¿‡ä¸Šè¿°ï¼Œç–¯ç‹‚ç‚¹å‡»ï¼Œè¿”å›äº†è‡ªå·±å®šä¹‰çš„é™æµå¤„ç†ä¿¡æ¯ï¼Œé™æµå‘ç”Ÿ 2ã€æŒ‰ç…§Urlåœ°å€é™æµ+åç»­å¤„ç†1ã€ä½œç”¨é€šè¿‡è®¿é—®çš„URLæ¥é™æµï¼Œä¼šè¿”å›Sentinelè‡ªå¸¦é»˜è®¤çš„é™æµå¤„ç†ä¿¡æ¯ 2ã€ä»£ç @GetMapping(\"/rateLimit/byUrl\") @SentinelResource(value = \"byUrl\") public CommonResult byUrl() { return new CommonResult (200, \"æŒ‰urlé™æµæµ‹è¯•OK\", new Payment (2020L, \"serial002\")); } 3ã€è®¿é—®ï¼ˆ1æ¬¡ï¼‰ä¸ºäº†åˆ·æ–°å®æ—¶é…ç½®ï¼Œçº¿ä¸Šå°±æ²¡å¿…è¦è¿™ä¸ªæ“ä½œäº† http://localhost:8401//rateLimit/byUrl 4ã€é…ç½® 5ã€è®¿é—®ï¼ˆç‹‚ç‚¹ï¼‰ 3ã€å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜1 ç³»ç»Ÿé»˜è®¤çš„ï¼Œæ²¡æœ‰ä½“ç°æˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡è¦æ±‚ã€‚ 2 ä¾ç…§ç°æœ‰æ¡ä»¶ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„å¤„ç†æ–¹æ³•åˆå’Œä¸šåŠ¡ä»£ç è€¦åˆåœ¨ä¸€å—ï¼Œä¸ç›´è§‚ã€‚ 3 æ¯ä¸ªä¸šåŠ¡æ–¹æ³•éƒ½æ·»åŠ ä¸€ä¸ªå…œåº•çš„ï¼Œé‚£ä»£ç è†¨èƒ€åŠ å‰§ã€‚ 4 å…¨å±€ç»Ÿä¸€çš„å¤„ç†æ–¹æ³•æ²¡æœ‰ä½“ç° 4ã€ç”¨æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘1ã€è‡ªå®šä¹‰é™æµå¤„ç†ç±»åˆ›å»ºCustomerBlockHandlerç±»ç”¨äºè‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘ package com.kk.springcloud.handler; import com.alibaba.csp.sentinel.slots.block.BlockException; import com.kk.springcloud.entities.CommonResult; public class CustomerBlockHandler { public static CommonResult handleException(BlockException exception) { return new CommonResult (2020, \"è‡ªå®šä¹‰çš„é™æµå¤„ç†ä¿¡æ¯......CustomerBlockHandler\"); } } 2ã€ä½¿ç”¨/** * è‡ªå®šä¹‰é€šç”¨çš„é™æµå¤„ç†é€»è¾‘ï¼Œ blockHandlerClass = CustomerBlockHandler.class blockHandler = handleException ä¸Šè¿°é…ç½®ï¼šæ‰¾CustomerBlockHandlerç±»é‡Œçš„handleException2æ–¹æ³•è¿›è¡Œå…œåº•å¤„ç† */ /** * è‡ªå®šä¹‰é€šç”¨çš„é™æµå¤„ç†é€»è¾‘ */ @GetMapping(\"/rateLimit/customerBlockHandler\") @SentinelResource(value = \"customerBlockHandler\", blockHandlerClass = CustomerBlockHandler.class, blockHandler = \"handleException\") public CommonResult customerBlockHandler() { return new CommonResult (200, \"æŒ‰å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘\"); } 3ã€é…ç½® 4ã€é…ç½®è¯´æ˜ 5ã€æµ‹è¯• 5ã€æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜ å…«ã€æœåŠ¡ç†”æ–­åŠŸèƒ½1ã€æ•´åˆsentinelæ•´åˆribbon+openFeign+fallback 2ã€Ribbon1ã€ç”Ÿäº§è€…1ã€å»ºmodelcloudalibaba-provider-payment9003 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-provider-payment9003&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt;&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 9003 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: localhost:8848 #é…ç½®Nacosåœ°å€ management: endpoints: web: exposure: include: '*' 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @EnableDiscoveryClient @SpringBootApplication public class PaymentMain9003 { public static void main(String[] args) { SpringApplication.run (PaymentMain9003.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import java.util.HashMap; @RestController public class PaymentController { @Value(\"${server.port}\") private String serverPort; public static HashMap&lt;Long, Payment&gt; hashMap = new HashMap&lt;&gt; ( ); static { hashMap.put (1L, new Payment (1L, \"28a8c1e3bc2742d8848569891fb42181\")); hashMap.put (2L, new Payment (2L, \"bba8c1e3bc2742d8848569891ac32182\")); hashMap.put (3L, new Payment (3L, \"6ua8c1e3bc2742d8848569891xt92183\")); } @GetMapping(value = \"/paymentSQL/{id}\") public CommonResult&lt;Payment&gt; paymentSQL(@PathVariable(\"id\") Long id) { Payment payment = hashMap.get (id); CommonResult&lt;Payment&gt; result = new CommonResult (200, \"from mysql,serverPort: \" + serverPort, payment); return result; } } 6ã€å¯åŠ¨åŒä¸€ä¸ªæœåŠ¡ï¼Œå¯åŠ¨9003ï¼Œ9004 -Dserver.port=9004 7ã€æµ‹è¯•http://localhost:9003/paymentSQL/1 http://localhost:9004/paymentSQL/1 2ã€æ¶ˆè´¹è€…1ã€modelæ–°å»ºcloudalibaba-consumer-nacos-order84 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-consumer-nacos-order84&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 84 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: localhost:8848 sentinel: transport: #é…ç½®Sentinel dashboardåœ°å€ dashboard: localhost:8080 #é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ port: 8719 #æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…) service-url: nacos-user-service: http://nacos-payment-provider 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @EnableDiscoveryClient @SpringBootApplication public class OrderNacosMain84 { public static void main(String[] args) { SpringApplication.run (OrderNacosMain84.class,args); } } 5ã€é…ç½®ç±»1ã€rabbion è´Ÿè½½é…ç½® package com.kk.springcloud.config; import org.springframework.cloud.client.loadbalancer.LoadBalanced; import org.springframework.context.annotation.Bean; import org.springframework.stereotype.Component; import org.springframework.web.client.RestTemplate; @Component public class ApplicationContextConfig { @Bean @LoadBalanced public RestTemplate getRestTemplate() { return new RestTemplate ( ); } } 6ã€ä¸šåŠ¡ç±»1ã€åªé…ç½®fallbackï¼ˆæœ¬ä¾‹sentinelæ— é…ç½®ï¼‰ 2ã€åªé…ç½®blockHandler package com.kk.springcloud.controller; import com.alibaba.csp.sentinel.annotation.SentinelResource; import com.alibaba.csp.sentinel.slots.block.BlockException; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; @RestController @Slf4j public class CircleBreakerController { public static final String SERVICE_URL = \"http://nacos-payment-provider\"; @Resource private RestTemplate restTemplate; @RequestMapping(\"/consumer/fallback/{id}\") @SentinelResource(value = \"fallback\", blockHandler = \"blockHandler\") //blockHandlerè´Ÿè´£åœ¨sentinelé‡Œé¢é…ç½®çš„é™çº§é™æµ public CommonResult&lt;Payment&gt; fallback(@PathVariable Long id) { CommonResult&lt;Payment&gt; result = restTemplate.getForObject (SERVICE_URL + \"/paymentSQL/\" + id, CommonResult.class, id); if (id == 4) { throw new IllegalArgumentException (\"éæ³•å‚æ•°å¼‚å¸¸....\"); } else if (result.getData ( ) == null) { throw new NullPointerException (\"NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•\"); } return result; } // å…œåº• public CommonResult handlerFallback(@PathVariable Long id, Throwable e) { Payment payment = new Payment (id, \"null\"); return new CommonResult&lt;&gt; (444, \"å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹ \" + e.getMessage ( ), payment); } // é™çº§ public CommonResult blockHandler(@PathVariable Long id, BlockException blockException) { Payment payment = new Payment (id, \"null\"); return new CommonResult&lt;&gt; (445, \"blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException \" + blockException.getMessage ( ), payment); } } 3ã€fallbackå’ŒblockHandleréƒ½é…ç½® package com.kk.springcloud.controller; import com.alibaba.csp.sentinel.annotation.SentinelResource; import com.alibaba.csp.sentinel.slots.block.BlockException; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; @RestController @Slf4j public class CircleBreakerController { public static final String SERVICE_URL = \"http://nacos-payment-provider\"; @Resource private RestTemplate restTemplate; @RequestMapping(\"/consumer/fallback/{id}\") @SentinelResource(value = \"fallback\", fallback = \"handlerFallback\", blockHandler = \"blockHandler\") public CommonResult&lt;Payment&gt; fallback(@PathVariable Long id) { CommonResult&lt;Payment&gt; result = restTemplate.getForObject (SERVICE_URL + \"/paymentSQL/\" + id, CommonResult.class, id); if (id == 4) { throw new IllegalArgumentException (\"éæ³•å‚æ•°å¼‚å¸¸....\"); } else if (result.getData ( ) == null) { throw new NullPointerException (\"NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•\"); } return result; } // å…œåº• public CommonResult handlerFallback(@PathVariable Long id, Throwable e) { Payment payment = new Payment (id, \"null\"); return new CommonResult&lt;&gt; (444, \"fallback,æ— æ­¤æµæ°´,exception \" + e.getMessage ( ), payment); } // é™çº§ public CommonResult blockHandler(@PathVariable Long id, BlockException blockException) { Payment payment = new Payment (id, \"null\"); return new CommonResult&lt;&gt; (445, \"blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException \" + blockException.getMessage ( ), payment); } } é™çº§ä¼˜å…ˆäºé™æµï¼šè‹¥ blockHandler å’Œ fallback éƒ½è¿›è¡Œäº†é…ç½®ï¼Œåˆ™è¢«é™æµé™çº§è€ŒæŠ›å‡º BlockException æ—¶åªä¼šè¿›å…¥ blockHandler å¤„ç†é€»è¾‘ã€‚ 4ã€å±æ€§å¿½ç•¥ ç›´æ¥æŠ›åˆ°å‰å°å¯¹ç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œç»†èŠ‚æ³¨æ„ 3ã€Feign1ã€modelä¿®æ”¹84æ¨¡å— 2ã€pom&lt;!--SpringCloud openfeign --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; 3ã€yml# æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ feign: sentinel: enabled: true 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.openfeign.EnableFeignClients; @EnableDiscoveryClient @SpringBootApplication @EnableFeignClients public class OrderNacosMain84 { public static void main(String[] args) { SpringApplication.run (OrderNacosMain84.class,args); } } 5ã€ä¸šåŠ¡ç±»1ã€è¿œç¨‹è°ƒæœåŠ¡æ¥å£package com.kk.springcloud.serivice; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; /** * @auther mykk * @create 2022å¹´3æœˆ24æ—¥ 21:45:49 * ä½¿ç”¨ fallback æ–¹å¼æ˜¯æ— æ³•è·å–å¼‚å¸¸ä¿¡æ¯çš„ï¼Œ * å¦‚æœæƒ³è¦è·å–å¼‚å¸¸ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ fallbackFactoryå‚æ•° */ @FeignClient(value = \"nacos-payment-provider\", fallback = PaymentFallbackService.class)//è°ƒç”¨ä¸­å…³é—­9003æœåŠ¡æä¾›è€… public interface PaymentService { @GetMapping(value = \"/paymentSQL/{id}\") CommonResult&lt;Payment&gt; paymentSQL(@PathVariable(\"id\") Long id); } 2ã€å…œåº•å®ç°package com.kk.springcloud.serivice; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import org.springframework.stereotype.Component; @Component public class PaymentFallbackService implements PaymentService { @Override public CommonResult&lt;Payment&gt; paymentSQL(Long id) { return new CommonResult&lt;&gt; (444, \"æœåŠ¡é™çº§è¿”å›,æ²¡æœ‰è¯¥æµæ°´ä¿¡æ¯\", new Payment (id, \"errorSerial......\")); } } 3ã€Controller//==================OpenFeign @Resource private PaymentService paymentService; @GetMapping(value = \"/consumer/openfeign/{id}\") public CommonResult&lt;Payment&gt; paymentSQL(@PathVariable(\"id\") Long id) { if (id == 4) { throw new RuntimeException (\"æ²¡æœ‰è¯¥id\"); } return paymentService.paymentSQL (id); } 6ã€æµ‹è¯•æµ‹è¯•84è°ƒç”¨9003ï¼Œæ­¤æ—¶æ•…æ„å…³é—­9003/9004å¾®æœåŠ¡æä¾›è€…ï¼Œçœ‹84æ¶ˆè´¹ä¾§è‡ªåŠ¨é™çº§ï¼Œä¸ä¼šè¢«è€—æ­» 4ã€ç†”æ–­æ¡†æ¶æ¯”è¾ƒ ä¹ã€æŒä¹…åŒ–è§„åˆ™1ã€æ˜¯ä»€ä¹ˆä¸€æ—¦æˆ‘ä»¬é‡å¯åº”ç”¨ï¼Œsentinelè§„åˆ™å°†æ¶ˆå¤±ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦å°†é…ç½®è§„åˆ™è¿›è¡ŒæŒä¹…åŒ– 2ã€æ€ä¹ˆç©å°†é™æµé…ç½®è§„åˆ™æŒä¹…åŒ–è¿›Nacosä¿å­˜ï¼Œåªè¦åˆ·æ–°8401æŸä¸ªreståœ°å€ï¼Œsentinelæ§åˆ¶å°çš„æµæ§è§„åˆ™å°±èƒ½çœ‹åˆ°ï¼Œåªè¦Nacosé‡Œé¢çš„é…ç½®ä¸åˆ é™¤ï¼Œé’ˆå¯¹8401ä¸Šsentinelä¸Šçš„æµæ§è§„åˆ™æŒç»­æœ‰æ•ˆ 3ã€å®æˆ˜1ã€modelä¿®æ”¹cloudalibaba-sentinel-service8401 2ã€pom &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-sentinel-service8401&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba sentinel-datasource-nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt; &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt; &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶+actuator --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;4.6.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€yml server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: #NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: 101.34.180.133:8848 sentinel: transport: #é…ç½®Sentinel dashboardåœ°å€ # dashboard: 101.34.180.133:8858 # dashboard: 106.52.23.202:8080 # é¡¹ç›®å’Œ sentinel ä¸åœ¨åŒä¸€å°æœºå™¨æ— æ³•æŸ¥çœ‹å®æ—¶ç›‘æ§ dashboard: localhost:8080 #é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ port: 8719 datasource: ds1: nacos: server-addr: 101.34.180.133:8848 dataId: cloudalibaba-sentinel-service groupId: DEFAULT_GROUP data-type: json rule-type: flow # æœ¬åœ°æœºå™¨ip(dockerå®¹å™¨å¿…é¡»åŠ ä¸Š) # client-ip: 169.254.135.77 feign: sentinel: enabled: true # æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ management: endpoints: web: exposure: include: '*' 4ã€æ·»åŠ Nacosä¸šåŠ¡è§„åˆ™é…ç½®[ { \"resource\": \"/rateLimit/byUrl\", \"limitApp\": \"default\", \"grade\": 1, \"count\": 1, \"strategy\": 0, \"controlBehavior\": 0, \"clusterMode\": false } ] 5ã€å¯åŠ¨å¯åŠ¨8401ååˆ·æ–°sentinelå‘ç°ä¸šåŠ¡è§„åˆ™æœ‰äº† 6ã€æµ‹è¯•ï¼ˆè®¿é—®ï¼‰å¿«é€Ÿè®¿é—®æµ‹è¯•æ¥å£ http://localhost:8401/rateLimit/byUrl åäºŒã€å‚è€ƒæ–‡æ¡£ â†“https://www.cnblogs.com/linjiqin/p/15369091.html https://www.jianshu.com/p/373eb512ec48 https://m.imooc.com/article/details?article_id=289384 https://www.cnblogs.com/yunqing/p/11406225.html","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"ç†”æ–­å™¨","slug":"ç†”æ–­å™¨","permalink":"https://mykkto.github.io/tags/%E7%86%94%E6%96%AD%E5%99%A8/"},{"name":"sentinel","slug":"sentinel","permalink":"https://mykkto.github.io/tags/sentinel/"},{"name":"é™æµ","slug":"é™æµ","permalink":"https://mykkto.github.io/tags/%E9%99%90%E6%B5%81/"}],"author":"mykk"},{"title":"Nacos é«˜å¯ç”¨é›†ç¾¤ï¼ˆdocker-composeï¼‰","slug":"03-javaåˆ†å¸ƒå¼/02-å®¹å™¨/01_docker(nacos)","date":"2022-03-12T03:17:13.000Z","updated":"2023-06-11T02:53:45.156Z","comments":true,"path":"posts/d9c3bea0.html","link":"","permalink":"https://mykkto.github.io/posts/d9c3bea0.html","excerpt":"","text":"ä¸€ã€æ¶æ„1ã€å‰è¨€æœ¬æ¥è¿™éƒ¨åˆ†æ˜¯è¦åœ¨ Spring-nacos æ‰‹å†Œä¸­ ï¼Œä½†æ˜¯åé¢æ­å»ºé‡åˆ°å¾ˆå¤šå‘æ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œå°±å•ç‹¬æ•´ç†åå†™å‡ºè¿™ç¯‡ã€‚ 2ã€æ¶æ„å›¾ ä¸€ä¸ªngxin è´Ÿè½½ ä¸‰ä¸ª nacosèŠ‚ç‚¹ï¼Œmysql ä¸»ä»ä¸¤ä¸ªèŠ‚ç‚¹ äºŒã€æ­å»º mysql ä¸»ä»1ã€æ‹‰å–å’Œåˆ›å»º# 1ã€æ‹‰å– [root@VM_0_17_centos ~]docker pull mysql:5.7.13 # 2ã€å¯åŠ¨ [root@VM_0_17_centos ~]docker run --name master -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7.13 # å‚æ•°è¯´æ˜ --name ä¸ºå®¹å™¨æŒ‡å®šåç§°ï¼Œè¿™é‡Œæ˜¯master -p å°†å®¹å™¨çš„æŒ‡å®šç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„æŒ‡å®šç«¯å£ï¼Œè¿™é‡Œæ˜¯å°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306ç«¯å£ -e è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œæ˜¯æŒ‡å®šrootè´¦å·çš„å¯†ç ä¸ºroot -d åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID mysql:5.7.13 æŒ‡å®šè¿è¡Œçš„mysqlç‰ˆ # 3ã€æŸ¥çœ‹æ˜¯å¦å¯åŠ¨,ä»¥æœ‰å®¹å™¨ [root@VM_0_17_centos ~]# docker ps -a 2ã€å¼€æ”¾ç«¯å£firewall-cmd --zone=public --add-port=3306/tcp --permanent firewall-cmd --reload # è¯´æ˜ --permanent æ°¸ä¹…å¼€å¯ï¼Œé¿å…ä¸‹æ¬¡å¼€æœºéœ€è¦å†æ¬¡æ‰‹åŠ¨å¼€å¯ç«¯å£ 3ã€åˆ›å»º[ä¸»å®¹å™¨]çš„å¤åˆ¶è´¦å·ä½¿ç”¨Navicatå‹å¥½çš„å›¾åƒåŒ–ç•Œé¢æ‰§è¡ŒSQL GRANT REPLICATION SLAVE ON *.* to 'backup'@'%' identified by 'backup'; show grants for 'backup'@'%'; 4ã€ä¿®æ”¹MySQL[ä¸»å®¹å™¨]é…ç½®ç¯å¢ƒ1ã€åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š/usr/local/mysql/master/usr/local/mysql/slave1/usr/local/mysql/slave2 [root@VM_0_17_centos ~]# mkdir -p /usr/local/mysql/master /usr/local/mysql/slave1 /usr/local/mysql/slave2 2ã€æ‹·è´ä¸€ä»½MySQLé…ç½®æ–‡ä»¶[root@VM_0_17_centos local]# docker cp master:/etc/mysql/my.cnf /usr/local/mysql/master/my.cnf 3ã€è¿›åˆ°masterç›®å½•ä¸‹ï¼Œå·²å­˜åœ¨æ‹·è´çš„my.cnf[root@VM_0_17_centos master]# ll total 4 -rw-r--r-- 1 root root 1801 May 10 10:27 my.cnf 4ã€ä¿®æ”¹my.cnfï¼Œåœ¨ [mysqld] èŠ‚ç‚¹æœ€ååŠ ä¸Šåä¿å­˜log-bin=mysql-bin server-id=1 log-bin=mysql-bin ä½¿ç”¨binary loggingï¼Œmysql-binæ˜¯logæ–‡ä»¶åçš„å‰ç¼€ server-id=1 å”¯ä¸€æœåŠ¡å™¨IDï¼Œé0æ•´æ•°ï¼Œä¸èƒ½å’Œå…¶ä»–æœåŠ¡å™¨çš„server-idé‡å¤ 5ã€å°†ä¿®æ”¹åçš„æ–‡ä»¶è¦†ç›–Dockerä¸­MySQLä¸­çš„é…ç½®æ–‡ä»¶docker cp /usr/local/mysql/master/my.cnf master:/etc/mysql/my.cnf 6ã€é‡å¯ mysql çš„docker , è®©é…ç½®ç”Ÿæ•ˆ[root@VM_0_17_centos master]# docker restart master 5ã€è¿è¡ŒMySQL [ä»]å®¹å™¨1ã€é¦–å…ˆè¿è¡Œä»å®¹å™¨[root@VM_0_17_centos ~]# docker run --name slave1 -p 3307:3306 -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7.13 2ã€ä¸ä¸»å®¹å™¨ç›¸ä¼¼ï¼Œæ‹·è´é…ç½®æ–‡ä»¶è‡³slave1ç›®å½•ä¿®æ”¹åè¦†ç›–å›Dockerä¸­log-bin=mysql-bin server-id=2 3ã€åˆ«å¿˜è®°ï¼Œé‡å¯slave1å®¹å™¨ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ[root@VM_0_17_centos master]# docker slave1 master 6ã€é…ç½®ä¸»ä»å¤åˆ¶1ã€ä½¿ç”¨Navicatè¿æ¥ [slave1]åæ–°å»ºæŸ¥è¯¢ï¼Œæ‰§è¡Œä»¥ä¸‹SQLCHANGE MASTER TO MASTER_HOST='è¿æ¥Navicatçš„ip', MASTER_PORT=3306, MASTER_USER='backup', MASTER_PASSWORD='backup'; START SLAVE; MASTER_HOST å¡«Navicatè¿æ¥é…ç½®ä¸­çš„ipåº”è¯¥å°±å¯ä»¥ MASTER_PORT ä¸»å®¹å™¨çš„ç«¯å£ MASTER_USER åŒæ­¥è´¦å·çš„ç”¨æˆ·å MASTER_PASSWORD åŒæ­¥è´¦å·çš„å¯†ç  2ã€æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸshow slave status; 7ã€æ£€æŸ¥ä¸»ä» ä¸‰ã€æ­å»º nacos é›†ç¾¤1ã€å‰è¨€docker-composeé…ç½®çš„æºç ï¼Œå·²ç»ä¸Šä¼ åˆ° github,å¯ç›´æ¥clone ï¼š https://github.com/mykkTo/nacos-cluster-docker.git 2ã€é…ç½®æ–‡ä»¶è¯´æ˜1ã€Nacoså…±ç”¨çš„init.d/custom.propertiesï¼Œä¸å®˜æ–¹ä¿æŒä¸€è‡´ï¼ŒæŒ‰éœ€ä½¿ç”¨ 2ã€docker-compose-nacos1.yml ä»¥ 1ä¸ºä¾‹ï¼Œ å¸¦ä¸ªéƒ½å¤§åŒå°å¼‚ 3ã€å¯åŠ¨ nacos é›†ç¾¤1ã€å°†æºä»£ç é…ç½®ä¿®æ”¹åï¼Œåˆ†åˆ«ä¸Šä¼ åˆ°ä¸‰å°ä¸»æœº 101.34.180.133 å¯¹åº” nacos-1 106.52.23.202 å¯¹åº” nacos-2 119.45.122.161 å¯¹åº” nacos-3 2ã€å¯åŠ¨å®¹å™¨åˆ†åˆ«åœ¨å„ä¸»æœºä¸Šè¿›å…¥å„è‡ªå¯¹åº”çš„nacosç›®å½•ä¸­ï¼Œå¯åŠ¨å®¹å™¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 133æœåŠ¡å™¨ï¼š $ cd nacos-cluster-docker/nacos-1 $ docker-compose -f docker-compose-nacos1.yml up -d 202æœåŠ¡å™¨ï¼š $ cd nacos-cluster-docker/nacos-2 $ docker-compose -f docker-compose-nacos2.yml up -d 161æœåŠ¡å™¨ï¼š $ cd nacos-cluster-docker/nacos-3 $ docker-compose -f docker-compose-nacos3.yml up -d 3ã€æŸ¥çœ‹æ—¥å¿—æŸ¥çœ‹æ—¥å¿—åˆ†åˆ«åœ¨å¯¹åº”çš„nacos-*ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ tail -f cluster-logs/nacos*/nacos.log 4ã€åœæ­¢å®¹å™¨$ docker-compose -f docker-compose-nacos1.yml stop 5ã€è®¿é—®Nacos UIç•Œé¢ è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°Nacosé›†ç¾¤å„èŠ‚ç‚¹å·²ç»æ­£å¸¸äº†ï¼ŒLEADERä¸FOLLOWERå·²ç»é€‰å‡ºï¼Œä¸€åˆ‡æ­£å¸¸äº† å››ã€nginx è´Ÿè½½1ã€åˆ›å»ºå¹¶å¯åŠ¨1ã€æ‹‰å–docker pull nginx 2ã€å¯åŠ¨docker run --name nginx-test -p 80:80 -d nginx â€“ name å®¹å™¨å‘½å -v æ˜ å°„ç›®å½• -d è®¾ç½®å®¹å™¨åå°è¿è¡Œ -p æœ¬æœºç«¯å£æ˜ å°„ å°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„80ç«¯å£ 2ã€æ˜ å°„åˆ°æœ¬åœ°1ã€åˆ›å»ºé¦–å…ˆåœ¨æœ¬æœºåˆ›å»ºnginxçš„ä¸€äº›æ–‡ä»¶å­˜å‚¨ç›®å½• mkdir -p /root/nginx/www /root/nginx/logs /root/nginx/conf www: nginxå­˜å‚¨ç½‘ç«™ç½‘é¡µçš„ç›®å½• logs: nginxæ—¥å¿—ç›®å½• conf: nginxé…ç½®æ–‡ä»¶ç›®å½• 2ã€æ˜ å°„ï¼ˆ1ï¼‰å…ˆæŸ¥çœ‹å®¹å™¨ docker ps -a ï¼ˆ2ï¼‰æ˜ å°„ docker cp 481e121fb29f:/etc/nginx/nginx.conf /root/nginx/conf 3ã€å¯åŠ¨å®¹å™¨éœ€è¦è¯´æ˜ä¸‹ï¼Œngxin-test å®¹å™¨æ˜¯ä¸ºäº†è·å¾—å®¹å™¨çš„é…ç½®æ–‡ä»¶ï¼Œæœ€ç»ˆä½¿ç”¨çš„æ˜¯ nginx-web ç›®å‰å·²ç»å¯åŠ¨ nginx-test 80ç«¯å£ï¼Œè‹¥æ˜¯ nginx-webæŒ‡å®šçš„ä¹Ÿæ˜¯ 80ï¼Œå°±éœ€è¦å…³é—­ nginx-testäº† docker stop nginx-test 1ã€æ–°å®¹å™¨æ˜ å°„åˆ›å»ºæ–°nginxå®¹å™¨nginx-web,å¹¶å°†www,logs,confç›®å½•æ˜ å°„åˆ°æœ¬åœ° docker run -d -p 80:80 --name nginx-web -v /root/nginx/www:/usr/share/nginx/html -v /root/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/logs:/var/log/nginx nginx 2ã€å¯åŠ¨docker start nginx-web 4ã€é…ç½®è´Ÿè½½å‡è¡¡1ã€è¿›å…¥ é…ç½®åœ¨ root åº•ä¸‹ 2ã€é…ç½®æºç user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; events { worker_connections 1024; } http { #gzip on; upstream nacos-cluster { server 101.34.180.133:8848; server 106.52.23.202:8848; server 119.45.122.161:8848; } server { listen 80; location /{ proxy_pass http://nacos-cluster; } } } ä¸»è¦çš„æ˜¯è¿™å— è¯´æ˜ä¸‹ï¼š æ–°æ‰‹å¯èƒ½ä¸å¤ªä¼šnginxï¼Œlisten ä¸º 80 æ˜¯å› ä¸ºä½ å®¹å™¨å¯åŠ¨æ—¶å€™æ˜¯ 80ï¼Œå½“è®¿é—® 80çš„æ—¶å€™è½¬åˆ° ä»¥ä¸Šä¸‰ä¸ª ip è´Ÿè½½è½®è®­ï¼Œè¿˜å¯ä»¥è®¾ç½®æƒé‡å¯ä»¥å»çœ‹æ–‡æ¡£ 3ã€é‡å¯docker restart nginx-web äº”ã€Spring-bootè¿æ¥1ã€ymlé…ç½® 2ã€æŸ¥çœ‹å®¢æˆ·ç«¯ å…­ã€é—®é¢˜æ±‡æ€»1ã€å…³äº 503å¼‚å¸¸ä¿¡æ¯ï¼šjava.lang.IllegalStateException: failed to req API:/nacos/v1/ns/instance after all servers([101.34.180.133:8848]) tried: failed to req API:101.34.180.133:8848/nacos/v1/ns/instance. code:503 msg: server is DOWN now, please try again later! ä¸ªäººè§è§£ï¼šè¿™ä¸ªé—®é¢˜åšä¸»è®¤ä¸ºæ˜¯é›†ç¾¤èŠ‚ç‚¹å°‘äº3ä¸ªå‡ºç°çš„ï¼Œå› ä¸ºæœåŠ¡å™¨è¿‡æœŸäº†ä¸€å°å‰©ä¸‹äº† ä¸¤å°ï¼Œæ‰€ä»¥æŠ¥è¿™ä¸ªé”™è¯¯ï¼Œä¸‰å°æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚ ä¸ƒã€å‚è€ƒæ–‡æ¡£ â†“https://www.cnblogs.com/hellxz/p/nacos-cluster-docker.html https://docs.docker.com/compose/install/ https://www.cnblogs.com/bigband/p/13515219.html https://my.oschina.net/u/3773384/blog/1810111 https://www.jianshu.com/p/658911a8cff3 https://www.yht7.com/news/92162 https://blog.csdn.net/weixin_40461281/article/details/92586378 https://www.cnblogs.com/ilinuxer/p/6916969.html https://blog.csdn.net/weixin_40461281/article/details/92586378","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"é›†ç¾¤","slug":"é›†ç¾¤","permalink":"https://mykkto.github.io/tags/%E9%9B%86%E7%BE%A4/"},{"name":"nacos","slug":"nacos","permalink":"https://mykkto.github.io/tags/nacos/"},{"name":"docker-compose","slug":"docker-compose","permalink":"https://mykkto.github.io/tags/docker-compose/"}],"author":"mykk"},{"title":"é«˜é˜¶é¢è¯•é¢˜ï¼šJUC-AQS","slug":"05-é¢è¯•é¢˜/01-å¤šçº¿ç¨‹/01_Interview-JUC-AQS","date":"2022-03-09T13:32:10.000Z","updated":"2023-06-11T02:53:45.130Z","comments":true,"path":"posts/3fb37166.html","link":"","permalink":"https://mykkto.github.io/posts/3fb37166.html","excerpt":"","text":"ä¸€ã€æ˜¯ä»€ä¹ˆ1ã€å­—é¢æ„æ€æŠ½è±¡çš„é˜Ÿåˆ—åŒæ­¥å™¨ ç»“æ„å…³ç³»å›¾ï¼š 2ã€æŠ€æœ¯è§£é‡Š ç”¨æ¥æ„å»ºé”æˆ–è€…å…¶å®ƒåŒæ­¥å™¨ç»„ä»¶çš„é‡é‡çº§åŸºç¡€æ¡†æ¶åŠæ•´ä¸ªJUCä½“ç³»çš„åŸºçŸ³ã€‚ é€šè¿‡å†…ç½®çš„FIFO1é˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œï¼Œå¹¶é€šè¿‡ä¸€ä¸ªintç±»å˜é‡è¡¨ç¤ºæŒæœ‰é”çš„çŠ¶æ€ CLHï¼šCraigã€Landin and Hagersten é˜Ÿåˆ—ï¼Œæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼ŒAQSä¸­çš„é˜Ÿåˆ—æ˜¯CLHå˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—FIFO äºŒã€AQS=JUCï¼ˆåŸºçŸ³ï¼‰AQSä¸ºä»€ä¹ˆæ˜¯JUCå†…å®¹ä¸­æœ€é‡è¦çš„åŸºçŸ³ 1ã€AQSæœ‰å…³çš„é” ReentrantLock CountDownLatch ReentrantReadWriteLock Semaphore â€¦â€¦â€¦â€¦â€¦ç­‰ç­‰ 2ã€è¿›ä¸€æ­¥ç†è§£é”å’ŒåŒæ­¥å™¨çš„å…³ç³» é”ï¼Œé¢å‘é”çš„ä½¿ç”¨è€…ï¼š å®šä¹‰äº†ç¨‹åºå‘˜å’Œé”äº¤äº’çš„ä½¿ç”¨å±‚APIï¼Œéšè—äº†å®ç°ç»†èŠ‚ï¼Œä½ è°ƒç”¨å³å¯ã€‚ åŒæ­¥å™¨ï¼Œé¢å‘é”çš„å®ç°è€… æ¯”å¦‚Javaå¹¶å‘å¤§ç¥DougLeeï¼Œæå‡ºç»Ÿä¸€è§„èŒƒå¹¶ç®€åŒ–äº†é”çš„å®ç°ï¼Œå±è”½äº†åŒæ­¥çŠ¶æ€ç®¡ç†ã€é˜»å¡çº¿ç¨‹æ’é˜Ÿå’Œé€šçŸ¥ã€å”¤é†’æœºåˆ¶ç­‰ã€‚ ä¸‰ã€èƒ½å¹²å˜›1ã€åŠ é”ä¼šå¯¼è‡´é˜»å¡æœ‰é˜»å¡å°±éœ€è¦æ’é˜Ÿï¼Œå®ç°æ’é˜Ÿå¿…ç„¶éœ€è¦é˜Ÿåˆ— 2ã€è¯´æ˜è§£é‡ŠæŠ¢åˆ°èµ„æºçš„çº¿ç¨‹ç›´æ¥ä½¿ç”¨å¤„ç†ä¸šåŠ¡ï¼ŒæŠ¢ä¸åˆ°èµ„æºçš„å¿…ç„¶æ¶‰åŠä¸€ç§æ’é˜Ÿç­‰å€™æœºåˆ¶ã€‚æŠ¢å èµ„æºå¤±è´¥çš„çº¿ç¨‹ç»§ç»­å»ç­‰å¾…(ç±»ä¼¼é“¶è¡Œä¸šåŠ¡åŠç†çª—å£éƒ½æ»¡äº†ï¼Œæš‚æ—¶æ²¡æœ‰å—ç†çª—å£çš„é¡¾å®¢åªèƒ½å»å€™å®¢åŒºæ’é˜Ÿç­‰å€™)ï¼Œä½†ç­‰å€™çº¿ç¨‹ä»ç„¶ä¿ç•™è·å–é”çš„å¯èƒ½ä¸”è·å–é”æµç¨‹ä»åœ¨ç»§ç»­(å€™å®¢åŒºçš„é¡¾å®¢ä¹Ÿåœ¨ç­‰ç€å«å·ï¼Œè½®åˆ°äº†å†å»å—ç†çª—å£åŠç†ä¸šåŠ¡)ã€‚ æ—¢ç„¶è¯´åˆ°äº†æ’é˜Ÿç­‰å€™æœºåˆ¶ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¼šæœ‰æŸç§é˜Ÿåˆ—å½¢æˆï¼Œè¿™æ ·çš„é˜Ÿåˆ—æ˜¯ä»€ä¹ˆæ•°æ®ç»“æ„å‘¢ï¼Ÿ å¦‚æœå…±äº«èµ„æºè¢«å ç”¨ï¼Œå°±éœ€è¦ä¸€å®šçš„é˜»å¡ç­‰å¾…å”¤é†’æœºåˆ¶æ¥ä¿è¯é”åˆ†é…ã€‚è¿™ä¸ªæœºåˆ¶ä¸»è¦ç”¨çš„æ˜¯CLHé˜Ÿåˆ—çš„å˜ä½“å®ç°çš„ï¼Œå°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°±æ˜¯AQSçš„æŠ½è±¡è¡¨ç°ã€‚å®ƒå°†è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆé˜Ÿåˆ—çš„ç»“ç‚¹ï¼ˆNodeï¼‰ï¼Œé€šè¿‡CASã€è‡ªæ—‹ä»¥åŠLockSupport.park()çš„æ–¹å¼ï¼Œç»´æŠ¤stateå˜é‡çš„çŠ¶æ€ï¼Œä½¿å¹¶å‘è¾¾åˆ°åŒæ­¥çš„æ•ˆæœã€‚ LockSupport.park()ï¼šé˜»å¡å½“å‰çº¿ç¨‹çš„æ‰§è¡Œï¼Œä¸”éƒ½ä¸ä¼šé‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„é”èµ„æºï¼› å››ã€AQS è§£è¯»1ã€AQSæ¦‚è¿°1ã€å®˜ç½‘è§£é‡Š 2ã€é˜»å¡-&gt;é˜Ÿåˆ—æœ‰é˜»å¡å°±éœ€è¦æ’é˜Ÿï¼Œå®ç°æ’é˜Ÿå¿…ç„¶éœ€è¦é˜Ÿåˆ— AQSä½¿ç”¨ä¸€ä¸ªvolatileçš„intç±»å‹çš„æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çš„æ’é˜Ÿå·¥ä½œå°†æ¯æ¡è¦å»æŠ¢å èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªNodeèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ï¼Œé€šè¿‡CASå®Œæˆå¯¹Stateå€¼çš„ä¿®æ”¹ã€‚ 2ã€AQSå†…éƒ¨ä½“ç³»æ¶æ„ 1ã€AQSè‡ªèº«1ã€AQSçš„intå˜é‡ â˜…1ã€AQSçš„åŒæ­¥çŠ¶æ€Stateæˆå‘˜å˜é‡ 2ã€é“¶è¡ŒåŠç†ä¸šåŠ¡çš„å—ç†çª—å£çŠ¶æ€ï¼ˆé€šä¿—ç†è§£ï¼‰ é›¶å°±æ˜¯æ²¡äººï¼ˆè‡ªç”±çŠ¶æ€ï¼‰ï¼Œå¯ä»¥åŠç† å¤§äºç­‰äº1ï¼Œæœ‰äººå ç”¨çª—å£ï¼Œç­‰ç€å» 2ã€AQSçš„CLHé˜Ÿåˆ—1ã€CLHé˜Ÿåˆ—(ä¸‰ä¸ªå¤§ç‰›çš„åå­—ç»„æˆ)ï¼Œä¸ºä¸€ä¸ªåŒå‘é˜Ÿåˆ— 2ã€é“¶è¡Œå€™å®¢åŒºçš„ç­‰å¾…é¡¾å®¢ï¼ˆé€šä¿—ç†è§£ï¼‰ 3ã€å°æ€»ç»“ æœ‰é˜»å¡å°±éœ€è¦æ’é˜Ÿï¼Œå®ç°æ’é˜Ÿå¿…ç„¶éœ€è¦é˜Ÿåˆ— stateå˜é‡+CLHåŒç«¯é˜Ÿåˆ— 2ã€å†…éƒ¨ç±»Nodeå†…éƒ¨ç±»Node(Nodeç±»åœ¨AQSç±»å†…éƒ¨) 1ã€Nodeçš„intå˜é‡ â˜…1ã€Nodeçš„ç­‰å¾…çŠ¶æ€waitStateæˆå‘˜å˜é‡ 2ã€è¯´æ˜ ç­‰å€™åŒºå…¶å®ƒé¡¾å®¢(å…¶å®ƒçº¿ç¨‹)çš„ç­‰å¾…çŠ¶æ€ é˜Ÿåˆ—ä¸­æ¯ä¸ªæ’é˜Ÿçš„ä¸ªä½“å°±æ˜¯ä¸€ä¸ª Node 2ã€Nodeæ­¤ç±»è¯¦è§£1ã€å†…éƒ¨ç»“æ„ 2ã€å±æ€§è¯´æ˜ 3ã€AQSåŒæ­¥é˜Ÿåˆ—çš„åŸºæœ¬ç»“æ„ CLHï¼šCraigã€Landin and Hagersten é˜Ÿåˆ—ï¼Œæ˜¯ä¸ªå•å‘é“¾è¡¨ï¼ŒAQSä¸­çš„é˜Ÿåˆ—æ˜¯CLHå˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—ï¼ˆFIFOï¼‰ FIFOï¼šé˜Ÿåˆ—ä¸­ç”¨åˆ°äº†å“¨å…µèŠ‚ç‚¹ï¼ˆå‚€å„¡èŠ‚ç‚¹ï¼‰æ—¢ï¼Œå¤´èŠ‚ç‚¹ï¼ˆå¥½å¤„å°±æ˜¯ä¸ç”¨å»åˆ¤ç©ºï¼Œå› ä¸ºæœ‰å¤´èŠ‚ç‚¹ï¼‰ äº”ã€ä»ReentrantLockå¼€å§‹è§£è¯»AQS1ã€è¯´æ˜Lockæ¥å£çš„å®ç°ç±»ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ã€èšåˆã€‘äº†ä¸€ä¸ªã€é˜Ÿåˆ—åŒæ­¥å™¨ã€‘çš„å­ç±»å®Œæˆçº¿ç¨‹è®¿é—®æ§åˆ¶çš„ 1ã€å¯ä»¥çœ‹å‡ºå†…éƒ¨å­ç±» Syncï¼Œç»§æ‰¿äº† AQS 2ã€çœ‹ä¸‹ç±» UMLå›¾ï¼ŒSync åº•ä¸‹åˆæœ‰ä¸¤ä¸ªå­ç±»ï¼ˆåˆ†åˆ«ä¸ºå…¬å¹³å’Œéå…¬å¹³ï¼‰ 2ã€å…¬å¹³é”å’Œéå…¬å¹³é”1ã€å…ˆä»åˆ›å»ºå…¥æ‰‹ 2ã€è¿½æº¯1ã€é»˜è®¤æ„é€ æ–¹æ³•ï¼Œé»˜è®¤ä¸ä¼ å‚æ„é€  2ã€å¸¦å‚ä¼ å…¥ï¼Œæ­¤æ—¶åˆ¤æ–­æ˜¯éå…¬å¹³è¿˜æ˜¯å…¬å¹³ 3ã€å¾ˆæ˜æ˜¾è¿™æ˜¯ä¸¤ä¸ªç±»ï¼Œåˆ†åˆ«ç»§æ‰¿ä¸Syncï¼Œä¸Šé¢æœ‰æåˆ° 3ã€çœ‹æºç 1ã€çœ‹å·®å¼‚1ã€å¯ä»¥æ˜æ˜¾çœ‹å‡ºå…¬å¹³é”ä¸éå…¬å¹³é”çš„lock()æ–¹æ³•å”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºå…¬å¹³é”åœ¨è·å–åŒæ­¥çŠ¶æ€æ—¶å¤šäº†ä¸€ä¸ªé™åˆ¶æ¡ä»¶ hasQueuedPredecessors() hasQueuedPredecessorsæ˜¯å…¬å¹³é”åŠ é”æ—¶åˆ¤æ–­ç­‰å¾…é˜Ÿåˆ—ä¸­æ˜¯å¦å­˜åœ¨æœ‰æ•ˆèŠ‚ç‚¹çš„æ–¹æ³• 2ã€å¯¹æ¯”å…¬å¹³é”ï¼šå…¬å¹³é”è®²ç©¶å…ˆæ¥å…ˆåˆ°ï¼Œçº¿ç¨‹åœ¨è·å–é”æ—¶ï¼Œå¦‚æœè¿™ä¸ªé”çš„ç­‰å¾…é˜Ÿåˆ—ä¸­å·²ç»æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼› éå…¬å¹³é”ï¼šä¸ç®¡æ˜¯å¦æœ‰ç­‰å¾…é˜Ÿåˆ—ï¼Œå¦‚æœå¯ä»¥è·å–é”ï¼Œåˆ™ç«‹åˆ»å æœ‰é”å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªæ’é˜Ÿçº¿ç¨‹åœ¨unpark()ï¼Œä¹‹åè¿˜æ˜¯éœ€è¦ç«äº‰é”ï¼ˆå­˜åœ¨çº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼‰ 3ã€å¿…è°ƒ lock()åœ¨åˆ›å»ºå®Œå…¬å¹³/éå…¬å¹³é”ï¼Œè°ƒç”¨lockæ–¹æ³•è¿›è¡ŒåŠ é”ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨ acquire æ–¹æ³• 3ã€æºç Apiè§£è¯»1ã€lock() 2ã€acquire() ä¸‰ä¸ªèµ°å‘ 1ã€tryAcquire() -&gt; tryAcquire () ç”±äºå­ç±» FairSync å®ç° 2ã€è°ƒç”¨ addWaiter() -&gt; enq() å…¥é˜Ÿæ“ä½œ 3ã€acquireQueued() -&gt; cancelAcquire() å‚è€ƒæ–‡æ¡£https://www.cnblogs.com/tong-yuan/p/11768904.html https://baijiahao.baidu.com/s?id=1718317852417206951&amp;wfr=spider&amp;for=pc https://blog.csdn.net/hengyunabc/article/details/28126139 å“¨å…µèŠ‚ç‚¹è§£è¯»ï¼šhttps://www.cnblogs.com/litexy/p/9749544.html","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://mykkto.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"AQS","slug":"AQS","permalink":"https://mykkto.github.io/tags/AQS/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://mykkto.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"JUC","slug":"JUC","permalink":"https://mykkto.github.io/tags/JUC/"}],"author":"mykk"},{"title":"Oracle11g(dockerç‰ˆ)","slug":"04-åŸºç¡€/04oracle/01_oracle11g-docker","date":"2022-02-28T04:49:31.000Z","updated":"2023-06-11T02:53:45.143Z","comments":true,"path":"posts/42dbeac3.html","link":"","permalink":"https://mykkto.github.io/posts/42dbeac3.html","excerpt":"","text":"ä¸€ã€Dockerå®‰è£…å’Œé…ç½®1ã€é•œåƒæ‹‰å–ï¼ˆç¬¬ä¸‰æ–¹ï¼‰docker pull registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g 2ã€ä¸‹è½½å®Œåï¼ŒæŸ¥çœ‹docker images 3ã€åˆ›å»ºå®¹å™¨docker run -d -p 1521:1521 --name oracle11g registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g 4ã€å¯åŠ¨å®¹å™¨ï¼Œæ“ä½œ1ã€å¯åŠ¨docker start oracle11g 2ã€è¿›å…¥å®¹å™¨docker exec -it oracle11g bash 3ã€åˆ‡æ¢rootç”¨æˆ·su root å¯†ç ï¼šhelowin æ³¨æ„ï¼šç°åœ¨è¿˜ä¸èƒ½é€€å‡ºï¼Œç»§ç»­æ“ä½œ 5ã€ç¼–è¾‘profileæ–‡ä»¶é…ç½®ORACLEç¯å¢ƒå˜é‡åœ¨dockerä¸­æŸ¥æ‰¾å¹¶ç¼–è¾‘profileæ–‡ä»¶ vi /etc/profile export ORACLE_HOME=/home/oracle/app/oracle/product/11.2.0/dbhome_2 export ORACLE_SID=helowin export PATH=$ORACLE_HOME/bin:$PATH åœ¨æœ€åä¸ŠåŠ ï¼š ä¿å­˜å¹¶é€€å‡º ï¼šwq 6ã€oracleçš„é…ç½®1. åˆ›å»ºè½¯è¿æ¥ln -s $ORACLE_HOME/bin/sqlplus /usr/bin 2.åˆ‡æ¢åˆ°oracle ç”¨æˆ·è¿™é‡Œè¿˜è¦è¯´ä¸€ä¸‹ï¼Œä¸€å®šè¦å†™ä¸­é—´çš„ - å¿…é¡»è¦ï¼Œå¦åˆ™è½¯è¿æ¥æ— æ•ˆ su - oracle 7ã€oracleæ•°æ®åº“çš„æ“ä½œ1. ç™»å½•sqlpluså¹¶ä¿®æ”¹sysã€systemç”¨æˆ·å¯†ç sqlplus /nolog conn /as sysdba 2. ä¿®æ”¹å’Œåˆ›å»ºç”¨æˆ·alter user system identified by system; alter user sys identified by sys; ä¹Ÿå¯ä»¥åˆ›å»ºç”¨æˆ· create user test identified by test; å¹¶ç»™ç”¨æˆ·èµ‹äºˆæƒé™ grant connect,resource,dba to test; 3. scottç”¨æˆ·çš„å¼€å¯--è§£é”scottç”¨æˆ·ï¼ˆå®‰è£…æ—¶è‹¥ä½¿ç”¨é»˜è®¤æƒ…å†µæ²¡æœ‰è§£é”å’Œè®¾ç½®å¯†ç è¿›è¡Œä¸‹åˆ—æ“ä½œï¼Œè¦è¶…çº§ç®¡ç†å‘˜æ“ä½œï¼‰ alter user scott account unlock; --è§£é”scottç”¨æˆ·çš„å¯†ç ã€æ­¤å¥ä¹Ÿå¯ä»¥ç”¨æ¥é‡ç½®å¯†ç ã€‘ alter user scott identified by tiger; äºŒã€å®¢æˆ·ç«¯è¿æ¥1ã€navicatè¿æ¥æ‰“å¼€navicatåï¼ˆnavicat12ä¸ç”¨é…ç½®oci.dllæ–‡ä»¶äº†ï¼‰ 2ã€pl/sql è¿æ¥101.xx.xxx.133:1521/helowinXDBå¯†ç ï¼štiger ä¸‰ã€å…¶ä»–åŠŸèƒ½1ã€scottèµ‹äºˆæœ€é«˜æƒé™åˆ†ä¸¤æ¡è¿è¡Œ CONN / AS SYSDBA; GRANT DBA TO SCOTT; å‚è€ƒhttps://www.cnblogs.com/laoluoits/p/13942119.html https://www.cnblogs.com/flyingsand/p/9463460.html","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://mykkto.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"oracle","slug":"oracle","permalink":"https://mykkto.github.io/tags/oracle/"},{"name":"docker","slug":"docker","permalink":"https://mykkto.github.io/tags/docker/"},{"name":"å®‰è£…","slug":"å®‰è£…","permalink":"https://mykkto.github.io/tags/%E5%AE%89%E8%A3%85/"}],"author":"mykk"},{"title":"SpringCloud-Alibaba-Nacos æœåŠ¡æ³¨å†Œ+é…ç½®ä¸­å¿ƒ","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/14_SpringCloudAlibaba-Nacos","date":"2022-02-23T13:12:31.000Z","updated":"2023-06-11T02:53:45.162Z","comments":true,"path":"posts/af0a257d.html","link":"","permalink":"https://mykkto.github.io/posts/af0a257d.html","excerpt":"","text":"å‹æƒ…é“¾æ¥-æ—©æœŸNacosæ–‡ç« ä¸€ã€Nacosç®€ä»‹1ã€æ˜¯ä»€ä¹ˆé¡¹ç›®æ–‡æ¡£ï¼šhttps://github.com/alibaba/Nacos ä½¿ç”¨æ–‡æ¡£ï¼šhttps://nacos.io/zh-cn/index.html ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚ Nacos = Eureka+Config +Bus 2ã€èƒ½å¹²å˜› æ›¿ä»£EurekaåšæœåŠ¡æ³¨å†Œä¸­å¿ƒ æ›¿ä»£ConfigåšæœåŠ¡é…ç½®ä¸­å¿ƒ 3ã€æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ äºŒã€å®‰è£…ï¼ˆdockerï¼‰1ã€pullé•œåƒæ¨èç¨³å®šç‰ˆç‰ˆæœ¬(å®˜æ–¹æ¨è1.3.1),å¦‚æœä¸æŒ‡å®šç‰ˆæœ¬çš„è¯åˆ™å°±æ˜¯latestç‰ˆæœ¬(å¯¹åº”nacosçš„1.4ç‰ˆæœ¬) docker pull nacos/nacos-server:1.3.1 2ã€è¿è¡Œå¹¶åˆ›å»ºå®¹å™¨docker run --name nacosName -e MODE=standalone -d -v /mnt/logs/nacos:/home/logs/nacos -p 8848:8848 nacos/nacos-server:1.1.4 -d åå°è¿è¡Œ -p å¤–éƒ¨è®¿é—®ç«¯å£:å†…éƒ¨è¢«æ˜ å°„ç«¯å£ Dockerç›¸å¯¹äºè™šæ‹Ÿæœº å¤–éƒ¨è®¿é—®ç«¯å£å°±æ˜¯ å¤–ç½‘è®¿é—®çš„ç«¯å£ å†…éƒ¨è¢«æ˜ å°„ç«¯å£å°±æ˜¯ è¯¥é•œåƒåœ¨dockeré‡Œé¢çš„ç«¯å£ â€“name å®¹å™¨çš„åç§° é•œåƒåç§°ï¼šç‰ˆæœ¬å· nacos/nacos-server:1.3.1 ï¼ˆè¿è¡Œè¯¥é•œåƒï¼‰ -e ç¯å¢ƒå˜é‡è®¾ç½® -e MODE=standalone -v æ˜ å°„åˆ°centosä¸Šçš„æŸä¸ªç›®å½•:é…ç½®æŸä¸ªå®¹å™¨çš„ç›®å½• -v /mnt/logs/nacos:/home/logs/nacos 3ã€æŸ¥çœ‹å¯åŠ¨æ—¥å¿— #æŸ¥çœ‹å·²ç»å¯åŠ¨çš„å®¹å™¨ è·å–å®¹å™¨ID docker ps #æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„è¾“å‡ºæ—¥å¿— docker logs --since 10m nacosçš„å®¹å™¨id #æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„è¾“å‡ºæ—¥å¿— 4ã€è®¿é—®http://lhttp://localhost:8848/nacos ç™»å½•è´¦å· ç™»å½•å¯†ç  nacos nacos ä¸‰ã€Nacosï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰1ã€åŸºäºNacosç”Ÿäº§è€…1ã€å»ºmodelcloudalibaba-provider-payment9001 2ã€pom1ã€çˆ¶pom &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;2.1.0.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; 2ã€æœ¬æ¨¡å—pom &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-provider-payment9001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: 101.34.180.133:8848 #é…ç½®Nacosåœ°å€ management: endpoints: web: exposure: include: '*' 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @EnableDiscoveryClient @SpringBootApplication public class PaymentMain9001 { public static void main(String[] args) { SpringApplication.run (PaymentMain9001.class, args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; @RestController public class PaymentController { @Value(\"${server.port}\") private String serverPort; @GetMapping(value = \"/payment/nacos/{id}\") public String getPayment(@PathVariable(\"id\") Integer id) { return \"nacos registry, serverPort: \" + serverPort + \"\\t id\" + id; } } 6ã€æµ‹è¯•1ã€è®¿é—®ï¼šhttp://localhost:9001/payment/nacos/1 2ã€nacoså®¢æˆ·ç«¯ 7ã€æ˜ å°„å‡ºä¸€æ¨¡ä¸€æ ·çš„9002ï¼Œæµ‹è¯•è´Ÿè½½1ã€å¤åˆ¶é…ç½® 2ã€ç¼–å†™é…ç½® -DServer.port=9002 3ã€æŸ¥çœ‹æ˜¯å¦æˆåŠŸå¯åŠ¨ 2ã€åŸºäºNacosæ¶ˆè´¹è€…1ã€å»ºmodelcloudalibaba-consumer-nacos-order83 2ã€pomä¸ºä»€ä¹ˆnacosæ”¯æŒè´Ÿè½½å‡è¡¡ &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-consumer-nacos-order83&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: 101.34.180.133:8848 #é…ç½®Nacosåœ°å€ #æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…) service-url: nacos-user-service: http://nacos-payment-provider 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @EnableDiscoveryClient @SpringBootApplication public class OrderNacosMain83 { public static void main(String[] args) { SpringApplication.run(OrderNacosMain83.class,args); } } 5ã€ä¸šåŠ¡ç±»ApplicationContextBeanï¼š package com.kk.springcloud.config; import org.springframework.cloud.client.loadbalancer.LoadBalanced; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.web.client.RestTemplate; @Configuration public class ApplicationContextBean { @Bean @LoadBalanced public RestTemplate getRestTempe() { return new RestTemplate ( ); } } OrderNacosControllerï¼š package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; @RestController public class OrderNacosController { @Resource private RestTemplate restTemplate; @Value(\"${service-url.nacos-user-service}\") private String serverURL; @GetMapping(\"/consumer/payment/nacos/{id}\") public String paymentInfo(@PathVariable(\"id\") Long id) { return restTemplate.getForObject (serverURL + \"/payment/nacos/\" + id, String.class); } } 6ã€æµ‹è¯•1ã€å®¢æˆ·ç«¯æ³¨å†Œ 2ã€è®¿é—®ï¼šhttp://localhost:83/consumer/payment/nacos/13 1,2,1,2,1,2 åˆ‡æ¢æ•ˆæœå­˜åœ¨ 3ã€æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”1ã€nacoså…¨æ™¯å›¾ 2ã€Nacoså’ŒCAP 3ã€Nacos æ”¯æŒAPå’ŒCPæ¨¡å¼çš„åˆ‡æ¢Cæ˜¯æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼›è€ŒAçš„å®šä¹‰æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”ã€‚ ä½•æ—¶é€‰æ‹©ä½¿ç”¨ä½•ç§æ¨¡å¼ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸éœ€è¦å­˜å‚¨æœåŠ¡çº§åˆ«çš„ä¿¡æ¯ä¸”æœåŠ¡å®ä¾‹æ˜¯é€šè¿‡nacos-clientæ³¨å†Œï¼Œå¹¶èƒ½å¤Ÿä¿æŒå¿ƒè·³ä¸ŠæŠ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©APæ¨¡å¼ã€‚å½“å‰ä¸»æµçš„æœåŠ¡å¦‚ Spring cloud å’Œ Dubbo æœåŠ¡ï¼Œéƒ½é€‚ç”¨äºAPæ¨¡å¼ï¼ŒAPæ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯èƒ½æ€§è€Œå‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤APæ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ã€‚ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–è€…å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ï¼ŒK8SæœåŠ¡å’ŒDNSæœåŠ¡åˆ™é€‚ç”¨äºCPæ¨¡å¼ã€‚CPæ¨¡å¼ä¸‹åˆ™æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼Œæ­¤æ—¶åˆ™æ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹æ³¨å†Œå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ³¨å†ŒæœåŠ¡ï¼Œå¦‚æœæœåŠ¡ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ã€‚ curl -X PUT â€˜$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CPâ€™ å››ã€Nacosï¼ˆé…ç½®ä¸­å¿ƒï¼‰1ã€å»ºmodel1ã€å»ºmodelcloudalibaba-config-nacos-client3377 2ã€pom&lt;!--nacos-config--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-config-nacos-client3377&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--nacos-config--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--nacos-discovery--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--web + actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€yml1ã€whyé…ç½®ä¸¤ä¸ªspringbootä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œbootstrapä¼˜å…ˆçº§é«˜äºapplication 2ã€bootstrap.ymlfile-extension: yaml #æŒ‡å®šyamlæ ¼å¼çš„é…ç½® # nacosé…ç½® server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 #NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 #Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yaml #æŒ‡å®šyamlæ ¼å¼çš„é…ç½® 3ã€application.ymlspring: profiles: active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @EnableDiscoveryClient @SpringBootApplication public class NacosConfigClientMain3377 { public static void main(String[] args) { SpringApplication.run (NacosConfigClientMain3377.class, args); } } 5ã€ä¸šåŠ¡ç±»@RefreshScope package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.cloud.context.config.annotation.RefreshScope; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController @RefreshScope //åœ¨æ§åˆ¶å™¨ç±»åŠ å…¥@RefreshScopeæ³¨è§£ä½¿å½“å‰ç±»ä¸‹çš„é…ç½®æ”¯æŒNacosçš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ã€‚ public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/config/info\") public String getConfigInfo() { return configInfo; } } 2ã€é…ç½®ä¸­å¿ƒåŸºç¡€1ã€è§„åˆ™${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} 2ã€æ–°å¢é…ç½®æ–‡ä»¶ nacos-config-client-dev.yaml config: info: nacos to info 3ã€å¯¹åº”é…ç½®è¯´æ˜ prefix é»˜è®¤ä¸º spring.application.name çš„å€¼ spring.profile.active å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„ profileï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.profile.active æ¥é…ç½®ã€‚ file-exetension ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.cloud.nacos.config.file-extension æ¥é…ç½® 4ã€å†å²é…ç½®ï¼ˆå›æ»šï¼‰Nacosä¼šè®°å½•é…ç½®æ–‡ä»¶çš„å†å²ç‰ˆæœ¬é»˜è®¤ä¿ç•™30å¤©ï¼Œæ­¤å¤–è¿˜æœ‰ä¸€é”®å›æ»šåŠŸèƒ½ï¼Œå›æ»šæ“ä½œå°†ä¼šè§¦å‘é…ç½®æ›´æ–° nacos-config-client-dev.yaml DEFAULT_GROUP 3ã€æµ‹è¯• å¯åŠ¨ 3377 è®¿é—®ï¼šhttp://localhost:3377/config/info æµ‹è¯•è‡ªå¸¦åˆ·æ–°åŠŸèƒ½ ä¿®æ”¹ä¸‹Nacosä¸­çš„yamlé…ç½®æ–‡ä»¶ï¼Œå†æ¬¡è°ƒç”¨æŸ¥çœ‹é…ç½®çš„æ¥å£ï¼Œå°±ä¼šå‘ç°é…ç½®å·²ç»åˆ·æ–° 4ã€é…ç½®ä¸­å¿ƒåˆ†ç±»1ã€Nacosçš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢1ã€é…ç½®ç®¡ç† 2ã€åç§°ç©ºé—´ 3ã€ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½®1ã€DataIDæ–¹æ¡ˆï¼ˆ1ï¼‰è¯´æ˜ æŒ‡å®šspring.profile.activeå’Œé…ç½®æ–‡ä»¶çš„DataIDæ¥ä½¿ä¸åŒç¯å¢ƒä¸‹è¯»å–ä¸åŒçš„é…ç½® ï¼ˆ2ï¼‰æ–°å»ºä¸¤ä¸ªé…ç½® ï¼ˆ3ï¼‰é…ç½®æ˜¯ä»€ä¹ˆå°±åŠ è½½ä»€ä¹ˆ 2ã€Groupæ–¹æ¡ˆï¼ˆ1ï¼‰è¯´æ˜ é€šè¿‡Groupå®ç°ç¯å¢ƒåŒºåˆ† ï¼ˆ2ï¼‰æ–°å»ºç»„ ï¼ˆ3ï¼‰æ§åˆ¶å°ä¸Šçš„æ•ˆæœ ï¼ˆ4ï¼‰Springbootä¸Šçš„é…ç½® åœ¨configä¸‹å¢åŠ ä¸€æ¡groupçš„é…ç½®å³å¯ã€‚å¯é…ç½®ä¸ºDEV_GROUPæˆ–TEST_GROUP 3ã€Namespaceæ–¹æ¡ˆï¼ˆ1ï¼‰æ–°å»ºdev/testçš„Namespace ï¼ˆ2ï¼‰å›åˆ°æœåŠ¡ç®¡ç†-æœåŠ¡åˆ—è¡¨æŸ¥çœ‹ ï¼ˆ3ï¼‰æŒ‰ç…§åŸŸåé…ç½®å¡«å†™ ï¼ˆ4ï¼‰ymlé…ç½®æ–‡ä»¶ application.yml bootstrap.yml äº”ã€â˜… Nacosï¼ˆé›†ç¾¤å’ŒæŒä¹…åŒ–ï¼‰1ã€åŸºæœ¬è¯´æ˜1ã€æ¶æ„å›¾ 2ã€å®˜æ–¹ä¿¡æ¯ 2ã€NacosæŒä¹…åŒ–é…ç½®è§£é‡Š1ã€Nacosé»˜è®¤è‡ªå¸¦çš„æ˜¯åµŒå…¥å¼æ•°æ®åº“derby2ã€derbyåˆ‡æ¢åˆ°mysql æ­¥éª¤ï¼ˆ1ï¼‰è¿›å…¥å®¹å™¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„é…ç½®æ–‡ä»¶ ï¼ˆ2ï¼‰åœ¨æ•°æ®åº“æ‰§è¡Œä»¥ä¸Š sql schema.sql CREATE DATABASE nacos_config; USE nacos_config; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = config_info */ /******************************************/ CREATE TABLE `config_info` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'id', `data_id` VARCHAR(255) NOT NULL COMMENT 'data_id', `group_id` VARCHAR(255) DEFAULT NULL, `content` LONGTEXT NOT NULL COMMENT 'content', `md5` VARCHAR(32) DEFAULT NULL COMMENT 'md5', `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'ä¿®æ”¹æ—¶é—´', `src_user` TEXT COMMENT 'source user', `src_ip` VARCHAR(20) DEFAULT NULL COMMENT 'source ip', `app_name` VARCHAR(128) DEFAULT NULL, `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'ç§Ÿæˆ·å­—æ®µ', `c_desc` VARCHAR(256) DEFAULT NULL, `c_use` VARCHAR(64) DEFAULT NULL, `effect` VARCHAR(64) DEFAULT NULL, `type` VARCHAR(64) DEFAULT NULL, `c_schema` TEXT, PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = config_info_aggr */ /******************************************/ CREATE TABLE `config_info_aggr` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'id', `data_id` VARCHAR(255) NOT NULL COMMENT 'data_id', `group_id` VARCHAR(255) NOT NULL COMMENT 'group_id', `datum_id` VARCHAR(255) NOT NULL COMMENT 'datum_id', `content` LONGTEXT NOT NULL COMMENT 'å†…å®¹', `gmt_modified` DATETIME NOT NULL COMMENT 'ä¿®æ”¹æ—¶é—´', `app_name` VARCHAR(128) DEFAULT NULL, `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'ç§Ÿæˆ·å­—æ®µ', PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='å¢åŠ ç§Ÿæˆ·å­—æ®µ'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = config_info_beta */ /******************************************/ CREATE TABLE `config_info_beta` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'id', `data_id` VARCHAR(255) NOT NULL COMMENT 'data_id', `group_id` VARCHAR(128) NOT NULL COMMENT 'group_id', `app_name` VARCHAR(128) DEFAULT NULL COMMENT 'app_name', `content` LONGTEXT NOT NULL COMMENT 'content', `beta_ips` VARCHAR(1024) DEFAULT NULL COMMENT 'betaIps', `md5` VARCHAR(32) DEFAULT NULL COMMENT 'md5', `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'ä¿®æ”¹æ—¶é—´', `src_user` TEXT COMMENT 'source user', `src_ip` VARCHAR(20) DEFAULT NULL COMMENT 'source ip', `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'ç§Ÿæˆ·å­—æ®µ', PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_beta'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = config_info_tag */ /******************************************/ CREATE TABLE `config_info_tag` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'id', `data_id` VARCHAR(255) NOT NULL COMMENT 'data_id', `group_id` VARCHAR(128) NOT NULL COMMENT 'group_id', `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'tenant_id', `tag_id` VARCHAR(128) NOT NULL COMMENT 'tag_id', `app_name` VARCHAR(128) DEFAULT NULL COMMENT 'app_name', `content` LONGTEXT NOT NULL COMMENT 'content', `md5` VARCHAR(32) DEFAULT NULL COMMENT 'md5', `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'ä¿®æ”¹æ—¶é—´', `src_user` TEXT COMMENT 'source user', `src_ip` VARCHAR(20) DEFAULT NULL COMMENT 'source ip', PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_tag'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = config_tags_relation */ /******************************************/ CREATE TABLE `config_tags_relation` ( `id` BIGINT(20) NOT NULL COMMENT 'id', `tag_name` VARCHAR(128) NOT NULL COMMENT 'tag_name', `tag_type` VARCHAR(64) DEFAULT NULL COMMENT 'tag_type', `data_id` VARCHAR(255) NOT NULL COMMENT 'data_id', `group_id` VARCHAR(128) NOT NULL COMMENT 'group_id', `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'tenant_id', `nid` BIGINT(20) NOT NULL AUTO_INCREMENT, PRIMARY KEY (`nid`), UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`), KEY `idx_tenant_id` (`tenant_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_tag_relation'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = group_capacity */ /******************************************/ CREATE TABLE `group_capacity` ( `id` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID', `group_id` VARCHAR(128) NOT NULL DEFAULT '' COMMENT 'Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤', `quota` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `usage` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'ä½¿ç”¨é‡', `max_size` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `max_aggr_count` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `max_aggr_size` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `max_history_count` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'æœ€å¤§å˜æ›´å†å²æ•°é‡', `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'ä¿®æ”¹æ—¶é—´', PRIMARY KEY (`id`), UNIQUE KEY `uk_group_id` (`group_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = his_config_info */ /******************************************/ CREATE TABLE `his_config_info` ( `id` BIGINT(64) UNSIGNED NOT NULL, `nid` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT, `data_id` VARCHAR(255) NOT NULL, `group_id` VARCHAR(128) NOT NULL, `app_name` VARCHAR(128) DEFAULT NULL COMMENT 'app_name', `content` LONGTEXT NOT NULL, `md5` VARCHAR(32) DEFAULT NULL, `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00', `src_user` TEXT, `src_ip` VARCHAR(20) DEFAULT NULL, `op_type` CHAR(10) DEFAULT NULL, `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'ç§Ÿæˆ·å­—æ®µ', PRIMARY KEY (`nid`), KEY `idx_gmt_create` (`gmt_create`), KEY `idx_gmt_modified` (`gmt_modified`), KEY `idx_did` (`data_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='å¤šç§Ÿæˆ·æ”¹é€ '; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = tenant_capacity */ /******************************************/ CREATE TABLE `tenant_capacity` ( `id` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID', `tenant_id` VARCHAR(128) NOT NULL DEFAULT '' COMMENT 'Tenant ID', `quota` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `usage` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'ä½¿ç”¨é‡', `max_size` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `max_aggr_count` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°', `max_aggr_size` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `max_history_count` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'æœ€å¤§å˜æ›´å†å²æ•°é‡', `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'ä¿®æ”¹æ—¶é—´', PRIMARY KEY (`id`), UNIQUE KEY `uk_tenant_id` (`tenant_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨'; CREATE TABLE `tenant_info` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'id', `kp` VARCHAR(128) NOT NULL COMMENT 'kp', `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'tenant_id', `tenant_name` VARCHAR(128) DEFAULT '' COMMENT 'tenant_name', `tenant_desc` VARCHAR(256) DEFAULT NULL COMMENT 'tenant_desc', `create_source` VARCHAR(32) DEFAULT NULL COMMENT 'create_source', `gmt_create` BIGINT(20) NOT NULL COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` BIGINT(20) NOT NULL COMMENT 'ä¿®æ”¹æ—¶é—´', PRIMARY KEY (`id`), UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`), KEY `idx_tenant_id` (`tenant_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='tenant_info'; CREATE TABLE users ( username VARCHAR(50) NOT NULL PRIMARY KEY, PASSWORD VARCHAR(500) NOT NULL, enabled BOOLEAN NOT NULL ); CREATE TABLE roles ( username VARCHAR(50) NOT NULL, role VARCHAR(50) NOT NULL ); INSERT INTO users (username, PASSWORD, enabled) VALUES ('nacos', '$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu', TRUE); INSERT INTO roles (username, role) VALUES ('nacos', 'ROLE_ADMIN'); ï¼ˆ3ï¼‰åœ¨ application.propertiesä¿®æ”¹é…ç½® ä»¥ä¸Š äº”ä¸ªé…ç½®å‡è¦ä¿®æ”¹ ï¼ˆ4ï¼‰æ”¹å®Œä¹‹åé‡å¯ ï¼ˆ5ï¼‰é‡æ–°ç™»å½•å®¢æˆ·ç«¯ï¼Œå‘ç°ä»¥å‰çš„æ•°æ®æ²¡æœ‰äº†ï¼Œè¯´æ˜åˆ‡æ¢æˆåŠŸ 3ã€é«˜å¯ç”¨é›†ç¾¤æ­å»º1ã€æ¶æ„å›¾ æœ€ç»ˆè½åœ°ï¼šNacos é«˜å¯ç”¨é›†ç¾¤ï¼ˆdocker-composeï¼‰å‚è€ƒæ–‡ç« https://www.jianshu.com/p/d2c81d647323 https://blog.csdn.net/wwwwwww31311/article/details/113066637 https://www.cnblogs.com/hellxz/p/nacos-cluster-docker.html","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"nacos","slug":"nacos","permalink":"https://mykkto.github.io/tags/nacos/"},{"name":"æœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"æœåŠ¡æ³¨å†Œä¸å‘ç°","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"},{"name":"é…ç½®ä¸­å¿ƒ","slug":"é…ç½®ä¸­å¿ƒ","permalink":"https://mykkto.github.io/tags/%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"}],"author":"mykk"},{"title":"SpringCloud-Sleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/13_SpringCloud-Sleuth","date":"2022-02-21T18:22:22.000Z","updated":"2023-06-11T02:53:45.162Z","comments":true,"path":"posts/35c50dd0.html","link":"","permalink":"https://mykkto.github.io/posts/35c50dd0.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€ä¸ºä»€ä¹ˆå‡ºç°â€‹ åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„çš„æœåŠ¡èŠ‚ç‚¹è°ƒç”¨æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œæ¯ä¸€ä¸ªå‰æ®µè¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯ï¼Œé“¾è·¯ä¸­çš„ä»»ä½•ä¸€ç¯å‡ºç°é«˜å»¶æ—¶æˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·æ•´ä¸ªè¯·æ±‚æœ€åçš„å¤±è´¥ã€‚ 2ã€æ˜¯ä»€ä¹ˆ1ã€å®˜ç½‘https://github.com/spring-cloud/spring-cloud-sleuth 2ã€è¯´æ˜Spring Cloud Sleuthæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æä¾›è¿½è¸ªè§£å†³æ–¹æ¡ˆå¹¶ä¸”å…¼å®¹æ”¯æŒäº†zipkin 2ã€æ­å»ºé“¾è·¯ç›‘æ§æ­¥éª¤1ã€zipkin1ã€ä¸‹è½½ SpringCloudä»Fç‰ˆèµ·å·²ä¸éœ€è¦è‡ªå·±æ„å»ºZipkin Serveräº†ï¼Œåªéœ€è°ƒç”¨jaråŒ…å³å¯ https://repo1.maven.org/maven2/io/zipkin/java/zipkin-server/ zipkin-server-2.12.9-exec.jar 2ã€è¿è¡Œ jarjava -jar zipkin-server-2.12.9-exec.jar 3ã€è¿è¡Œæ§åˆ¶å° 3ã€æœåŠ¡ç”Ÿäº§è€…1ã€å»ºmodelcloud-provider-sleuth8001 2ã€pom&lt;!--åŒ…å«äº†sleuth+zipkin--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-provider-sleuth8001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--åŒ…å«äº†sleuth+zipkin--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--eureka-client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt;&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt; &lt;/dependency&gt; &lt;!--mysql-connector-java--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--jdbc--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€yml server: port: 8001 spring: application: name: cloud-payment-service zipkin: base-url: http://106.52.23.202:9411 sleuth: sampler: #é‡‡æ ·ç‡å€¼ä»‹äº 0 åˆ° 1 ä¹‹é—´ï¼Œ1 åˆ™è¡¨ç¤ºå…¨éƒ¨é‡‡é›† probability: 1 datasource: type: com.alibaba.druid.pool.DruidDataSource # å½“å‰æ•°æ®æºæ“ä½œç±»å‹ driver-class-name: org.gjt.mm.mysql.Driver # mysqlé©±åŠ¨åŒ… url: jdbc:mysql://101.34.180.133:3306/spring_cloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false username: root password: a1b2c3 eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka # é›†ç¾¤ç‰ˆ defaultZone: http://localhost:7001/eureka # å•æœºç‰ˆ instance: instance-id: payment8001 #è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºIPåœ°å€ prefer-ip-address: true #Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯30ç§’) lease-renewal-interval-in-seconds: 1 #EurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯90ç§’)ï¼Œè¶…æ—¶å°†å‰”é™¤æœåŠ¡ lease-expiration-duration-in-seconds: 2 mybatis: mapperLocations: classpath:mapper/*.xml type-aliases-package: com.kk.springcloud.entities # æ‰€æœ‰Entityåˆ«åç±»æ‰€åœ¨åŒ… 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication @EnableEurekaClient public class SleuthZipkinMain8001 { public static void main(String[] args) { SpringApplication.run (SleuthZipkinMain8001.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class PromentController { @GetMapping(\"/payment/zipkin\") public String paymentZipkin() { return \"hi ,i'am paymentzipkin server fall backï¼Œwelcome to kk demo ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~\"; } } 4ã€æœåŠ¡æ¶ˆè´¹è€…1ã€å»ºmodelcloud-consumer-order81 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumer-sleuth80&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--åŒ…å«äº†sleuth+zipkin--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt;&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 81 spring: application: name: cloud-order-service zipkin: base-url: http://106.52.23.202:9411 sleuth: sampler: probability: 1 eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ defaultZone: http://eureka7001.com:7001/eureka 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; import org.springframework.context.annotation.Bean; import org.springframework.web.client.RestTemplate; @SpringBootApplication @EnableEurekaClient public class ConsumerSleuthMain81 { public static void main(String[] args) { SpringApplication.run (ConsumerSleuthMain80.class,args); } @Bean public RestTemplate restTemplate() { return new RestTemplate(); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; @RestController public class ConsumerController { public static final String PAYMENT_URL = \"http://CLOUD-PAYMENT-SERVICE\"; @Resource private RestTemplate restTemplate; // ====================&gt; zipkin+sleuth @GetMapping(\"/consumer/payment/zipkin\") public String paymentZipkin() { String result = restTemplate.getForObject (PAYMENT_URL + \"/payment/zipkin/\", String.class); return result; } } 5ã€æµ‹è¯•1ã€è®¿é—® http://localhost:81/consumer/payment/zipkin 2ã€æ‰“å¼€ zipkinå®¢æˆ·ç«¯ http://106.52.23.202:9411/","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æœåŠ¡è·Ÿè¸ª","slug":"æœåŠ¡è·Ÿè¸ª","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E8%B7%9F%E8%B8%AA/"},{"name":"sleuth","slug":"sleuth","permalink":"https://mykkto.github.io/tags/sleuth/"}],"author":"mykk"},{"title":"SpringCloud-Streamæ¶ˆæ¯é©±åŠ¨","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/12_SpringCloud-Stream","date":"2022-02-19T14:52:16.000Z","updated":"2023-06-11T02:53:45.165Z","comments":true,"path":"posts/e867710e.html","link":"","permalink":"https://mykkto.github.io/posts/e867710e.html","excerpt":"","text":"å‹æƒ…é“¾æ¥rabitMQå®‰è£…ï¼ˆdockerï¼‰ 1ã€æ¶ˆæ¯é©±åŠ¨æ¦‚è¿°1ã€æ˜¯ä»€ä¹ˆå±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚,é™ä½åˆ‡æ¢æˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ å®˜ç½‘ï¼šhttps://m.wang1314.com/doc/webapp/topic/20971999.html 2ã€è®¾è®¡æ€æƒ³1ã€æ ‡å‡†MQ Messageï¼šç”Ÿäº§è€…/æ¶ˆè´¹è€…ä¹‹é—´é æ¶ˆæ¯åª’ä»‹ä¼ é€’ä¿¡æ¯å†…å®¹ MessageChannelï¼ˆæ¶ˆæ¯é€šé“ï¼‰ï¼šæ¶ˆæ¯å¿…é¡»èµ°ç‰¹å®šçš„é€šé“ æ¶ˆæ¯é€šé“é‡Œçš„æ¶ˆæ¯å¦‚ä½•è¢«æ¶ˆè´¹å‘¢ï¼Œè°è´Ÿè´£æ”¶å‘å¤„ç† æ¶ˆæ¯é€šé“MessageChannelçš„å­æ¥å£SubscribableChannelï¼Œç”±MessageHandleræ¶ˆæ¯å¤„ç†å™¨æ‰€è®¢é˜… 2ã€ä¸ºä»€ä¹ˆç”¨Cloud Stream1ã€æ¦‚å¿µæ¯”æ–¹è¯´æˆ‘ä»¬ç”¨åˆ°äº†RabbitMQå’ŒKafkaï¼Œç”±äºè¿™ä¸¤ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶çš„æ¶æ„ä¸Šçš„ä¸åŒï¼ŒåƒRabbitMQæœ‰exchangeï¼Œkafkaæœ‰Topicå’ŒPartitionsåˆ†åŒºï¼Œ è¿™äº›ä¸­é—´ä»¶çš„å·®å¼‚æ€§å¯¼è‡´æˆ‘ä»¬å®é™…é¡¹ç›®å¼€å‘ç»™æˆ‘ä»¬é€ æˆäº†ä¸€å®šçš„å›°æ‰°ï¼Œæˆ‘ä»¬å¦‚æœç”¨äº†ä¸¤ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„å…¶ä¸­ä¸€ç§ï¼Œåé¢çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘æƒ³å¾€å¦å¤–ä¸€ç§æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œè¿ç§»ï¼Œè¿™æ—¶å€™æ— ç–‘å°±æ˜¯ä¸€ä¸ªç¾éš¾æ€§çš„ï¼Œä¸€å¤§å †ä¸œè¥¿éƒ½è¦é‡æ–°æ¨å€’é‡æ–°åšï¼Œå› ä¸ºå®ƒè·Ÿæˆ‘ä»¬çš„ç³»ç»Ÿè€¦åˆäº†ï¼Œè¿™æ—¶å€™springcloud Streamç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§è§£è€¦åˆçš„æ–¹å¼ã€‚ 2ã€Streamä¸­çš„æ¶ˆæ¯é€šä¿¡æ–¹å¼éµå¾ªäº†å‘å¸ƒ-è®¢é˜…æ¨¡å¼Topicä¸»é¢˜è¿›è¡Œå¹¿æ’­ï¼š åœ¨RabbitMQå°±æ˜¯Exchange åœ¨Kakfaä¸­å°±æ˜¯Topic 3ã€Spring Cloud Streamæ ‡å‡†æµç¨‹å¥—è·¯ Binderï¼š å¾ˆæ–¹ä¾¿çš„è¿æ¥ä¸­é—´ä»¶ï¼Œå±è”½å·®å¼‚ Channelï¼š é€šé“ï¼Œæ˜¯é˜Ÿåˆ—Queueçš„ä¸€ç§æŠ½è±¡ï¼Œåœ¨æ¶ˆæ¯é€šè®¯ç³»ç»Ÿä¸­å°±æ˜¯å®ç°å­˜å‚¨å’Œè½¬å‘çš„åª’ä»‹ï¼Œé€šè¿‡Channelå¯¹é˜Ÿåˆ—è¿›è¡Œé…ç½® Sourceå’ŒSinkï¼š ç®€å•çš„å¯ç†è§£ä¸ºå‚ç…§å¯¹è±¡æ˜¯Spring Cloud Streamè‡ªèº«ï¼Œä»Streamå‘å¸ƒæ¶ˆæ¯å°±æ˜¯è¾“å‡ºï¼Œæ¥å—æ¶ˆæ¯å°±æ˜¯è¾“å…¥ 4ã€ç¼–ç APIå’Œå¸¸ç”¨æ³¨è§£ 2ã€æ¡ˆä¾‹è¯´æ˜å·¥ç¨‹ä¸­æ–°å»ºä¸‰ä¸ªå­æ¨¡å— cloud-stream-rabbitmq-provider8801ï¼Œ ä½œä¸ºç”Ÿäº§è€…è¿›è¡Œå‘æ¶ˆæ¯æ¨¡å— cloud-stream-rabbitmq-consumer8802ï¼Œä½œä¸ºæ¶ˆæ¯æ¥æ”¶æ¨¡å— cloud-stream-rabbitmq-consumer8803 ä½œä¸ºæ¶ˆæ¯æ¥æ”¶æ¨¡å— 3ã€æ¶ˆæ¯é©±åŠ¨ä¹‹ç”Ÿäº§è€…1ã€æ–°å»ºModulecloud-stream-rabbitmq-provider8801 2ã€pom&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-stream-rabbitmq-provider8801&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--åŸºç¡€é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlbindings: # æœåŠ¡çš„æ•´åˆå¤„ç† output: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰ content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½® server: port: 8801 spring: application: name: cloud-stream-provider cloud: stream: binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼› defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ type: rabbit # æ¶ˆæ¯ç»„ä»¶ç±»å‹ environment: # è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½® spring: rabbitmq: host: 101.34.180.133 port: 5672 username: guest password: guest bindings: # æœåŠ¡çš„æ•´åˆå¤„ç† output: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰ content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½® eureka: client: # å®¢æˆ·ç«¯è¿›è¡ŒEurekaæ³¨å†Œçš„é…ç½® service-url: defaultZone: http://localhost:7001/eureka instance: lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰ lease-expiration-duration-in-seconds: 5 # å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰ instance-id: send-8801.com # åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§° prefer-ip-address: true # è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class StreamMQMain8801 { public static void main(String[] args) { SpringApplication.run (StreamMQMain8801.class, args); } } 5ã€ä¸šåŠ¡ç±»1ã€æ¥å£package com.kk.springcloud.service; public interface IMessageProvider { String send(); } 2ã€æ¥å£å®ç°package com.kk.springcloud.service.impl; import com.kk.springcloud.service.IMessageProvider; import org.springframework.cloud.stream.annotation.EnableBinding; import org.springframework.cloud.stream.messaging.Source; import org.springframework.messaging.MessageChannel; import org.springframework.integration.support.MessageBuilder; import javax.annotation.Resource; import java.util.UUID; @EnableBinding(Source.class) // å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªæ¶ˆæ¯çš„å‘é€ç®¡é“çš„å®šä¹‰ public class MessageProviderImpl implements IMessageProvider { @Resource private MessageChannel output; // æ¶ˆæ¯çš„å‘é€ç®¡é“ @Override public String send() { String serial = UUID.randomUUID ( ).toString ( ); this.output.send (MessageBuilder.withPayload (serial).build ( )); // åˆ›å»ºå¹¶å‘é€æ¶ˆæ¯ System.out.println (\"***serial: \" + serial); return serial; } } 3ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.service.IMessageProvider; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController public class SendMessageController { @Resource private IMessageProvider messageProvider; @GetMapping(value = \"/sendMessage\") public String sendMessage() { return messageProvider.send ( ); } } 6ã€æµ‹è¯• å¯åŠ¨eurekaï¼Œä»¥åŠrabbitMqï¼Œä»¥åŠ8801 è®¿é—®ï¼šhttp://localhost:8801/sendMessage 4ã€æ¶ˆæ¯é©±åŠ¨ä¹‹æ¶ˆè´¹è€…1ã€æ–°å»ºModulecloud-stream-rabbitmq-consumer8802 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-stream-rabbitmq-consumer8802&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--åŸºç¡€é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 8802 spring: application: name: cloud-stream-consumer cloud: stream: binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼› defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ type: rabbit # æ¶ˆæ¯ç»„ä»¶ç±»å‹ environment: # è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½® spring: rabbitmq: host: 101.34.180.133 port: 5672 username: guest password: guest bindings: # æœåŠ¡çš„æ•´åˆå¤„ç† input: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰ content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºå¯¹è±¡jsonï¼Œå¦‚æœæ˜¯æ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½® eureka: client: # å®¢æˆ·ç«¯è¿›è¡ŒEurekaæ³¨å†Œçš„é…ç½® service-url: defaultZone: http://localhost:7001/eureka instance: lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰ lease-expiration-duration-in-seconds: 5 # å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰ instance-id: receive-8802.com # åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§° prefer-ip-address: true # è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class StreamMQMain8802 { public static void main(String[] args) { SpringApplication.run (StreamMQMain8802.class, args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.service; import org.springframework.beans.factory.annotation.Value; import org.springframework.cloud.stream.annotation.EnableBinding; import org.springframework.cloud.stream.annotation.StreamListener; import org.springframework.cloud.stream.messaging.Sink; import org.springframework.messaging.Message; import org.springframework.stereotype.Component; @Component @EnableBinding(Sink.class) public class ReceiveMessageListener { @Value(\"${server.port}\") private String serverPort; @StreamListener(Sink.INPUT) public void input(Message&lt;String&gt; message) { System.out.println (\"æ¶ˆè´¹è€…1å·ï¼Œ-------&gt;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\" + message.getPayload ( ) + \"\\t port: \" + serverPort); } } 6ã€æµ‹è¯•urlï¼šhttp://localhost:8801/sendMessage 5ã€åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–1ã€ä¾ç…§8802ï¼Œcloneå‡ºæ¥ä¸€ä»½è¿è¡Œ8803 cloud-stream-rabbitmq-consumer8803 @SpringBootApplication public class StreamMQMain8803 { public static void main(String[] args) { SpringApplication.run (StreamMQMain8803.class, args); } } - ```java @Component @EnableBinding(Sink.class) public class ReceiveMessageListener { @Value(\"${server.port}\") private String serverPort; @StreamListener(Sink.INPUT) public void input(Message&lt;String&gt; message) { System.out.println (\"æ¶ˆè´¹è€…2å·ï¼Œ-------&gt;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\" + message.getPayload ( ) + \"\\t port: \" + serverPort); } } 2ã€å¯åŠ¨ 3ã€è¿è¡Œåæœ‰ä¸¤ä¸ªé—®é¢˜ æœ‰é‡å¤æ¶ˆè´¹é—®é¢˜ æ¶ˆæ¯æŒä¹…åŒ–é—®é¢˜ 4ã€é‡å¤æ¶ˆè´¹é—®é¢˜ç›®å‰æ˜¯8802/8803åŒæ—¶éƒ½æ”¶åˆ°äº†ï¼Œå­˜åœ¨é‡å¤æ¶ˆè´¹é—®é¢˜ å¦‚ä½•è§£å†³ï¼šåˆ†ç»„å’ŒæŒä¹…åŒ–å±æ€§groupæ¯”å¦‚åœ¨å¦‚ä¸‹åœºæ™¯ä¸­ï¼Œè®¢å•ç³»ç»Ÿæˆ‘ä»¬åšé›†ç¾¤éƒ¨ç½²ï¼Œéƒ½ä¼šä»RabbitMQä¸­è·å–è®¢å•ä¿¡æ¯ï¼Œé‚£å¦‚æœä¸€ä¸ªè®¢å•åŒæ—¶è¢«ä¸¤ä¸ªæœåŠ¡è·å–åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆæ•°æ®é”™è¯¯ï¼Œæˆ‘ä»¬å¾—é¿å…è¿™ç§æƒ…å†µã€‚è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Streamä¸­çš„æ¶ˆæ¯åˆ†ç»„æ¥è§£å†³ æ³¨æ„åœ¨Streamä¸­å¤„äºåŒä¸€ä¸ªgroupä¸­çš„å¤šä¸ªæ¶ˆè´¹è€…æ˜¯ç«äº‰å…³ç³»ï¼Œå°±èƒ½å¤Ÿä¿è¯æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªåº”ç”¨æ¶ˆè´¹ä¸€æ¬¡ã€‚ä¸åŒç»„æ˜¯å¯ä»¥å…¨é¢æ¶ˆè´¹çš„(é‡å¤æ¶ˆè´¹)ï¼Œ åŒä¸€ç»„å†…ä¼šå‘ç”Ÿç«äº‰å…³ç³»ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªå¯ä»¥æ¶ˆè´¹ã€‚ 5ã€åˆ†ç»„1ã€åŸç†å¾®æœåŠ¡åº”ç”¨æ”¾ç½®äºåŒä¸€ä¸ªgroupä¸­ï¼Œå°±èƒ½å¤Ÿä¿è¯æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªåº”ç”¨æ¶ˆè´¹ä¸€æ¬¡ã€‚ä¸åŒçš„ç»„æ˜¯å¯ä»¥æ¶ˆè´¹çš„ï¼ŒåŒä¸€ä¸ªç»„å†…ä¼šå‘ç”Ÿç«äº‰å…³ç³»ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªå¯ä»¥æ¶ˆè´¹ã€‚ 2ã€åˆ’åˆ†ç»„(ä¸åŒç»„) 8802/8803éƒ½å˜æˆä¸åŒç»„ï¼Œgroupä¸¤ä¸ªä¸åŒç»„ï¼ˆkkA,kkBï¼‰ 8802ä¿®æ”¹YML group: kkA 8803ä¿®æ”¹YML group: kkB 3ã€ç»“è®º(ä¸åŒç»„)ä¸åŒç»„çš„è¿˜æ˜¯é‡å¤æ¶ˆè´¹ 4ã€åˆ’åˆ†ç»„(ä¸åŒç»„)ä¸¤è¾¹éƒ½é…ç½®ä¸ºï¼škkA 5ã€ç»“è®º(ä¸åŒç»„)åŒä¸€ä¸ªç»„çš„å¤šä¸ªå¾®æœåŠ¡å®ä¾‹ï¼Œæ¯æ¬¡åªä¼šæœ‰ä¸€ä¸ªæ‹¿åˆ°ã€‚ï¼ˆè§£å†³é‡å¤æ¶ˆè´¹é—®é¢˜ï¼‰ 6ã€æŒä¹…åŒ–ç›®å‰ä¸¤ä¸ªæ¶ˆè´¹è€…8802/8803éƒ½æ˜¯å½’ç±»äº kkAåˆ†ç»„ 1ã€ä¸‹é¢è¦åšçš„æ˜¯å°† 8802åˆ†ç»„é…ç½®æ³¨é‡Š 2ã€å…³é—­8002/8003æœåŠ¡ 3ã€8801å…ˆå‘é€4æ¡æ¶ˆæ¯åˆ°rabbitmq 4ã€å¯åŠ¨8802ï¼ˆæ— åˆ†ç»„ï¼‰ï¼Œæ²¡æœ‰ä»»ä½•æ‰“å° 5ã€å¯åŠ¨8803ï¼ˆæœ‰åˆ†ç»„ï¼‰ï¼Œæ¥æ”¶ç¦»çº¿æ•°æ®","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æ¶ˆæ¯é©±åŠ¨","slug":"æ¶ˆæ¯é©±åŠ¨","permalink":"https://mykkto.github.io/tags/%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/"},{"name":"stream","slug":"stream","permalink":"https://mykkto.github.io/tags/stream/"}],"author":"mykk"},{"title":"SpringCloud-Busåˆ†å¸ƒå¼èŠ‚ç‚¹é“¾æ¥","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/11_SpringCloud-Bus","date":"2022-02-06T03:49:12.000Z","updated":"2023-06-11T02:53:45.166Z","comments":true,"path":"posts/699f8954.html","link":"","permalink":"https://mykkto.github.io/posts/699f8954.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€æ˜¯ä»€ä¹ˆBusæ”¯æŒä¸¤ç§æ¶ˆæ¯ä»£ç†ï¼šRabbitMQ å’Œ Kafka Spring Cloud Bus é…åˆ Spring Cloud Config ä½¿ç”¨å¯ä»¥å®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°ã€‚ Spring Cloud Busæ˜¯ç”¨æ¥å°†åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹ä¸è½»é‡çº§æ¶ˆæ¯ç³»ç»Ÿé“¾æ¥èµ·æ¥çš„æ¡†æ¶ï¼Œå®ƒæ•´åˆäº†Javaçš„äº‹ä»¶å¤„ç†æœºåˆ¶å’Œæ¶ˆæ¯ä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚ Spring Clud Busç›®å‰æ”¯æŒRabbitMQå’ŒKafkaã€‚ 2ã€èƒ½å¹²å˜›Spring Cloud Busèƒ½ç®¡ç†å’Œä¼ æ’­åˆ†å¸ƒå¼ç³»ç»Ÿé—´çš„æ¶ˆæ¯ï¼Œå°±åƒä¸€ä¸ªåˆ†å¸ƒå¼æ‰§è¡Œå™¨ï¼Œå¯ç”¨äºå¹¿æ’­çŠ¶æ€æ›´æ”¹ã€äº‹ä»¶æ¨é€ç­‰ï¼Œä¹Ÿå¯ä»¥å½“ä½œå¾®æœåŠ¡é—´çš„é€šä¿¡é€šé“ã€‚ 3ã€ä¸ºä½•è¢«ç§°ä¸ºæ€»çº¿ä»€ä¹ˆæ˜¯æ€»çº¿åœ¨å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨è½»é‡çº§çš„æ¶ˆæ¯ä»£ç†æ¥æ„å»ºä¸€ä¸ªå…±ç”¨çš„æ¶ˆæ¯ä¸»é¢˜ï¼Œå¹¶è®©ç³»ç»Ÿä¸­æ‰€æœ‰å¾®æœåŠ¡å®ä¾‹éƒ½è¿æ¥ä¸Šæ¥ã€‚ç”±äºè¯¥ä¸»é¢˜ä¸­äº§ç”Ÿçš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰å®ä¾‹ç›‘å¬å’Œæ¶ˆè´¹ï¼Œæ‰€ä»¥ç§°å®ƒä¸ºæ¶ˆæ¯æ€»çº¿ã€‚åœ¨æ€»çº¿ä¸Šçš„å„ä¸ªå®ä¾‹ï¼Œéƒ½å¯ä»¥æ–¹ä¾¿åœ°å¹¿æ’­ä¸€äº›éœ€è¦è®©å…¶ä»–è¿æ¥åœ¨è¯¥ä¸»é¢˜ä¸Šçš„å®ä¾‹éƒ½çŸ¥é“çš„æ¶ˆæ¯ã€‚ åŸºæœ¬åŸç†ConfigClientå®ä¾‹éƒ½ç›‘å¬MQä¸­åŒä¸€ä¸ªtopic(é»˜è®¤æ˜¯springCloudBus)ã€‚å½“ä¸€ä¸ªæœåŠ¡åˆ·æ–°æ•°æ®çš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªä¿¡æ¯æ”¾å…¥åˆ°Topicä¸­ï¼Œè¿™æ ·å…¶å®ƒç›‘å¬åŒä¸€Topicçš„æœåŠ¡å°±èƒ½å¾—åˆ°é€šçŸ¥ï¼Œç„¶åå»æ›´æ–°è‡ªèº«çš„é…ç½®ã€‚ 2ã€RabbitMQç¯å¢ƒé…ç½®1ã€å®‰è£…å®‰è£…dockerï¼šhttps://www.jianshu.com/p/f554c85b25c1 1ã€æ‹‰å–docker pull rabbitmq:3.7.7-management 2ã€åˆ›å»ºå®¹å™¨å¹¶å¯åŠ¨docker run -d --hostname localhost --name myrabbit -p 15672:15672 -p 5672:5672 rabbitmq:3.7.7-management -d åå°è¿è¡Œå®¹å™¨ï¼› â€“name æŒ‡å®šå®¹å™¨åï¼› -p æŒ‡å®šæœåŠ¡è¿è¡Œçš„ç«¯å£ï¼ˆ5672ï¼šåº”ç”¨è®¿é—®ç«¯å£ï¼›15672ï¼šæ§åˆ¶å°Webç«¯å£å·ï¼‰ï¼› -v æ˜ å°„ç›®å½•æˆ–æ–‡ä»¶ï¼› â€“hostname ä¸»æœºåï¼ˆRabbitMQçš„ä¸€ä¸ªé‡è¦æ³¨æ„äº‹é¡¹æ˜¯å®ƒæ ¹æ®æ‰€è°“çš„ â€œèŠ‚ç‚¹åç§°â€ å­˜å‚¨æ•°æ®ï¼Œé»˜è®¤ä¸ºä¸»æœºåï¼‰ï¼› -e æŒ‡å®šç¯å¢ƒå˜é‡ï¼› é»˜è®¤çš„ç”¨æˆ·åï¼šguestï¼› é»˜è®¤ç”¨æˆ·åçš„å¯†ç ï¼šguestï¼‰ 3ã€è®¿é—®http://localhost:15672/ ï¼ˆæ¢æˆè‡ªå·±æœåŠ¡å™¨çš„IPï¼‰ 3ã€SpringCloud Bus åŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­1ã€æ¼”ç¤ºå¹¿æ’­æ•ˆæœï¼Œå¢åŠ å¤æ‚åº¦ä»¥3355ä¸ºæ¨¡æ¿å†åˆ¶ä½œä¸€ä¸ª3366 1ã€å»ºmodelcloud-config-client-3366 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-config-client-3366-2&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€bootstrap.ymlserver: port: 3366 spring: application: name: config-client cloud: #Configå®¢æˆ·ç«¯é…ç½® config: label: master #åˆ†æ”¯åç§° name: config #é…ç½®æ–‡ä»¶åç§° profile: dev #è¯»å–åç¼€åç§° ä¸Šè¿°3ä¸ªç»¼åˆï¼šmasteråˆ†æ”¯ä¸Šconfig-dev.ymlçš„é…ç½®æ–‡ä»¶è¢«è¯»å–http://config-3344.com:3344/master/config-dev.yml uri: http://localhost:3344 #é…ç½®ä¸­å¿ƒåœ°å€ eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient public class ConfigClientMain3366 { public static void main(String[] args) { SpringApplication.run (ConfigClientMain3366.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.cloud.context.config.annotation.RefreshScope; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController @RefreshScope public class ConfigClientController { @Value(\"${server.port}\") private String serverPort; @Value(\"${mytest.info}\") private String configInfo; @GetMapping(\"/configInfo\") public String configInfo() { return \"serverPort: \" + serverPort + \"\\t\\n\\n configInfo: \" + configInfo; } } 2ã€ç»™cloud-config-center-3344é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ1ã€pom&lt;!--æ·»åŠ æ¶ˆæ¯æ€»çº¿RabbitMQæ”¯æŒ--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bus-amqp&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€yml##rabbitmqç›¸å…³é…ç½®,æš´éœ²busåˆ·æ–°é…ç½®çš„ç«¯ç‚¹ management: endpoints: #æš´éœ²busåˆ·æ–°é…ç½®çš„ç«¯ç‚¹ web: exposure: include: 'bus-refresh' 3ã€ç»™cloud-config-client-3355å®¢æˆ·ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ1ã€pom&lt;!--æ·»åŠ æ¶ˆæ¯æ€»çº¿RabbitMQæ”¯æŒ--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bus-amqp&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€bootstrap.yml#rabbitmqç›¸å…³é…ç½® 15672æ˜¯Webç®¡ç†ç•Œé¢çš„ç«¯å£ï¼›5672æ˜¯MQè®¿é—®çš„ç«¯å£ rabbitmq: host: localhost port: 5672 username: guest password: guest server: port: 3355 spring: application: name: config-client cloud: #Configå®¢æˆ·ç«¯é…ç½® config: label: master #åˆ†æ”¯åç§° name: config #é…ç½®æ–‡ä»¶åç§° profile: dev #è¯»å–åç¼€åç§° ä¸Šè¿°3ä¸ªç»¼åˆï¼šmasteråˆ†æ”¯ä¸Šconfig-dev.ymlçš„é…ç½®æ–‡ä»¶è¢«è¯»å–http://config-3344.com:3344/master/config-dev.yml uri: http://localhost:3344 #é…ç½®ä¸­å¿ƒåœ°å€ #rabbitmqç›¸å…³é…ç½® 15672æ˜¯Webç®¡ç†ç•Œé¢çš„ç«¯å£ï¼›5672æ˜¯MQè®¿é—®çš„ç«¯å£ rabbitmq: host: 106.xx.xx.xx port: 5672 username: guest password: guest eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ # æš´éœ²ç›‘æ§ç«¯ç‚¹ management: endpoints: web: exposure: include: \"*\" 4ã€ç»™cloud-config-client-3366å®¢æˆ·ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒåŒä¸Š5ã€æµ‹è¯•1ã€ä¿®æ”¹Githubä¸Šé…ç½®æ–‡ä»¶å¢åŠ ç‰ˆæœ¬å· 2ã€å‘é€ post è¯·æ±‚curl -X POST \"http://localhost:3344/actuator/bus-refresh 3ã€é…ç½®ä¸­å¿ƒhttp://config-3344.com:3344/config-dev.yml åŒæ­¥æ›´æ–°äº†é…ç½®ä¿¡æ¯ 4ã€å®¢æˆ·ç«¯http://localhost:3355/configInfo å‘ç°å¹¶æ²¡æœ‰æ›´æ–°ï¼Œè¿è¡ŒæŒ‡å®š å®šç‚¹è¯•è¯•ï¼šcurl -X POST \"http://localhost:3355/actuator/bus-refresh è¿è¡Œåå‘ç°å°±æ›´æ–°äº†ï¼Œå¾ˆå¥‡æ€ªå“¦ 5ã€ç»“è®ºä¸€æ¬¡ä¿®æ”¹ï¼Œå¹¿æ’­é€šçŸ¥ï¼Œå¤„å¤„ç”Ÿæ•ˆï¼ˆç›®å‰åªæœ‰æœåŠ¡ç«¯æ˜¯è¿™æ ·çš„ï¼Œå®¢æˆ·ç«¯åªèƒ½æ‰‹åŠ¨ï¼Œé—®é¢˜åŸå› æœªçŸ¥ï¼‰ 4ã€SpringCloud Bus åŠ¨æ€åˆ·æ–°å®šç‚¹(å±€éƒ¨)é€šçŸ¥1ã€æ¦‚å¿µæŒ‡å®šå…·ä½“æŸä¸€ä¸ªå®ä¾‹ç”Ÿæ•ˆè€Œä¸æ˜¯å…¨éƒ¨ 2ã€å…¬å¼http://localhost:é…ç½®ä¸­å¿ƒçš„ç«¯å£å·/actuator/bus-refresh/{destination} /bus/refreshè¯·æ±‚ä¸å†å‘é€åˆ°å…·ä½“çš„æœåŠ¡å®ä¾‹ä¸Šï¼Œè€Œæ˜¯å‘ç»™config serverå¹¶é€šè¿‡destinationå‚æ•°ç±»æŒ‡å®šéœ€è¦æ›´æ–°é…ç½®çš„æœåŠ¡æˆ–å®ä¾‹ 3ã€æ¡ˆä¾‹åªåˆ·æ–° 3355 curl -X POST \"http://localhost:3344/actuator/bus-refresh/config-client:3355\" å‚è€ƒï¼šhttps://blog.csdn.net/haoweng4800/article/details/102946846 https://www.cnblogs.com/huanshilang/p/12585877.html https://www.jianshu.com/p/efac7bd8941f","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"bus","slug":"bus","permalink":"https://mykkto.github.io/tags/bus/"},{"name":"èŠ‚ç‚¹é“¾æ¥","slug":"èŠ‚ç‚¹é“¾æ¥","permalink":"https://mykkto.github.io/tags/%E8%8A%82%E7%82%B9%E9%93%BE%E6%8E%A5/"}],"author":"mykk"},{"title":"SpringCloud-Configåˆ†å¸ƒå¼é…ç½®","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/10_SpringCloud-Config","date":"2022-02-04T01:33:12.000Z","updated":"2023-06-11T02:53:45.167Z","comments":true,"path":"posts/fc38d8b7.html","link":"","permalink":"https://mykkto.github.io/posts/fc38d8b7.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€å®˜ç½‘https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/ 2ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„â€”é…ç½®é—®é¢˜ å¾®æœåŠ¡æ„å‘³ç€è¦å°†å•ä½“åº”ç”¨ä¸­çš„ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸ªå­æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡çš„ç²’åº¦ç›¸å¯¹è¾ƒå°ï¼Œå› æ­¤ç³»ç»Ÿä¸­ä¼šå‡ºç°å¤§é‡çš„æœåŠ¡ã€‚ç”±äºæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å¿…è¦çš„é…ç½®ä¿¡æ¯æ‰èƒ½è¿è¡Œï¼Œæ‰€ä»¥ä¸€å¥—é›†ä¸­å¼çš„ã€åŠ¨æ€çš„é…ç½®ç®¡ç†è®¾æ–½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ â€‹ SpringCloudæä¾›äº†ConfigServeræ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¯ä¸€ä¸ªå¾®æœåŠ¡è‡ªå·±å¸¦ç€ä¸€ä¸ªapplication.ymlï¼Œä¸Šç™¾ä¸ªé…ç½®æ–‡ä»¶çš„ç®¡ç†ã€‚ 3ã€æ˜¯ä»€ä¹ˆ SpringCloud Configä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒï¼Œé…ç½®æœåŠ¡å™¨ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®ã€‚ 4ã€æ€ä¹ˆç©SpringCloud Configåˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤éƒ¨åˆ†ã€‚ æœåŠ¡ç«¯ä¹Ÿç§°ä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨ï¼Œç”¨æ¥è¿æ¥é…ç½®æœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›è·å–é…ç½®ä¿¡æ¯ï¼ŒåŠ å¯†/è§£å¯†ä¿¡æ¯ç­‰è®¿é—®æ¥å£ å®¢æˆ·ç«¯åˆ™æ˜¯é€šè¿‡æŒ‡å®šçš„é…ç½®ä¸­å¿ƒæ¥ç®¡ç†åº”ç”¨èµ„æºï¼Œä»¥åŠä¸ä¸šåŠ¡ç›¸å…³çš„é…ç½®å†…å®¹ï¼Œå¹¶åœ¨å¯åŠ¨çš„æ—¶å€™ä»é…ç½®ä¸­å¿ƒè·å–å’ŒåŠ è½½é…ç½®ä¿¡æ¯é…ç½®æœåŠ¡å™¨é»˜è®¤é‡‡ç”¨gitæ¥å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·å°±æœ‰åŠ©äºå¯¹ç¯å¢ƒé…ç½®è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡gitå®¢æˆ·ç«¯å·¥å…·æ¥æ–¹ä¾¿çš„ç®¡ç†å’Œè®¿é—®é…ç½®å†…å®¹ã€‚ 5ã€èƒ½å¹²å˜› é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶ ä¸åŒç¯å¢ƒä¸åŒé…ç½®ï¼ŒåŠ¨æ€åŒ–çš„é…ç½®æ›´æ–°ï¼Œåˆ†ç¯å¢ƒéƒ¨ç½²æ¯”å¦‚dev/test/prod/beta/release è¿è¡ŒæœŸé—´åŠ¨æ€è°ƒæ•´é…ç½®ï¼Œä¸å†éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡éƒ¨ç½²çš„æœºå™¨ä¸Šç¼–å†™é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ä¼šå‘é…ç½®ä¸­å¿ƒç»Ÿä¸€æ‹‰å–é…ç½®è‡ªå·±çš„ä¿¡æ¯ å½“é…ç½®å‘ç”Ÿå˜åŠ¨æ—¶ï¼ŒæœåŠ¡ä¸éœ€è¦é‡å¯å³å¯æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–å¹¶åº”ç”¨æ–°çš„é…ç½® å°†é…ç½®ä¿¡æ¯ä»¥RESTæ¥å£çš„å½¢å¼æš´éœ²ï¼Œpostã€curlè®¿é—®åˆ·æ–°å‡å¯â€¦â€¦ 6ã€ä¸GitHubæ•´åˆé…ç½®ç”±äºSpringCloud Configé»˜è®¤ä½¿ç”¨Gitæ¥å­˜å‚¨é…ç½®æ–‡ä»¶(ä¹Ÿæœ‰å…¶å®ƒæ–¹å¼,æ¯”å¦‚æ”¯æŒSVNå’Œæœ¬åœ°æ–‡ä»¶)ï¼Œä½†æœ€æ¨èçš„è¿˜æ˜¯Gitï¼Œè€Œä¸”ä½¿ç”¨çš„æ˜¯http/httpsè®¿é—®çš„å½¢å¼ 2ã€ConfigæœåŠ¡ç«¯é…ç½®1ã€åˆ›å»ºgithubä»“åº“1ã€æ–°å»ºä»“åº“ç”¨ä½ è‡ªå·±çš„è´¦å·åœ¨GitHub/gitee ä¸Šæ–°å»ºä¸€ä¸ªåä¸ºspringcloud-configçš„æ–°Repository 2ã€è·å¾—åˆšæ–°å»ºçš„gitåœ°å€https://gitee.com/TK_LIMR/spring-cloud-config.git 3ã€æœ¬åœ°ç¡¬ç›˜ç›®å½•ä¸Šæ–°å»ºgitä»“åº“å¹¶clonegit clone https://gitee.com/TK_LIMR/spring-cloud-config.git 4ã€ç¼–è¾‘application.ymlç¯å¢ƒ# ä¸åŒçš„å¼€å‘ç¯å¢ƒï¼Œä¸åŒçš„å¾®æœåŠ¡åå­— spring: profiles: active: - dev --- spring: profiles: dev #å¼€å‘ç¯å¢ƒ application: name: microservicecloud-config-kk-dev config: info: version1 --- spring: profiles: test #æµ‹è¯•ç¯å¢ƒ application: name: microservicecloud-config-kk-test # è¯·ä¿å­˜ä¸ºUTF-8æ ¼å¼ 5ã€ä¸Šä¼ åˆ°giteeä¸Šï¼ˆ1ï¼‰git add . ï¼ˆ2ï¼‰git commit -m \"init yml\" ï¼ˆ3ï¼‰git push origin master 2ã€é¡¹ç›®æ­å»º1ã€å»ºmodelæ–°å»ºModuleæ¨¡å—cloud-config-center-3344 2ã€pom&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-config-center-3344&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 3344 spring: application: name: cloud-config-center #æ³¨å†Œè¿›EurekaæœåŠ¡å™¨çš„å¾®æœåŠ¡å cloud: config: server: git: uri: https://gitee.com/TK_LIMR/spring-cloud-config.git #GitHubä¸Šé¢çš„gitä»“åº“åå­— ####æƒé™ç™»å½•(è¿™é‡Œå¡«å†™è‡ªå·±çš„) force-pull: true username: xxxxxxxx@163.com password: xxxxxxxx ####æœç´¢ç›®å½• search-paths: - springcloud-config ####è¯»å–åˆ†æ”¯ label: master #æœåŠ¡æ³¨å†Œåˆ°eurekaåœ°å€ eureka: client: service-url: defaultZone: http://localhost:7001/eureka 4ã€ä¸»å¯åŠ¨@EnableConfigServer package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.config.server.EnableConfigServer; @SpringBootApplication @EnableConfigServer public class ConfigCenterMain3344 { public static void main(String[] args) { SpringApplication.run (ConfigCenterMain3344.class,args); } } 5ã€æœ¬åœ°hostsé…ç½®127.0.0.1 config-3344.com 6ã€å¯åŠ¨æµ‹è¯•ç”Ÿäº§ï¼šhttp://config-3344.com:3344/master/config-prod.yml å¼€å‘ï¼šhttp://config-3344.com:3344/master/config-dev.yml æµ‹è¯•ï¼šhttp://config-3344.com:3344/master/config-test.yml 3ã€é…ç½®è¯»å–è§„åˆ™1ã€å®˜ç½‘ 2ã€/{label}/{application}-{profile}.ymlå‚æ•°è¯´æ˜ï¼š/åˆ†æ”¯/æœåŠ¡å/ç¯å¢ƒ 1ã€masteråˆ†æ”¯http://config-3344.com:3344/master/config-dev.yml http://config-3344.com:3344/master/config-test.yml http://config-3344.com:3344/master/config-prod.yml 2ã€devåˆ†æ”¯http://config-3344.com:3344/dev/config-dev.yml http://config-3344.com:3344/dev/config-test.yml http://config-3344.com:3344/dev/config-prod.yml 3ã€/{application}-{profile}.ymlå‚æ•°è¯´æ˜ï¼š/æœåŠ¡å/ç¯å¢ƒ http://config-3344.com:3344/config-dev.yml http://config-3344.com:3344/config-test.yml http://config-3344.com:3344/config-prod.yml http://config-3344.com:3344/config-xxxx.yml(ä¸å­˜åœ¨çš„é…ç½®) 4ã€/{application}/{profile}[/{label}]å‚æ•°è¯´æ˜ï¼š/æœåŠ¡å/ç¯å¢ƒ/åˆ†æ”¯ http://config-3344.com:3344/config/dev/master http://config-3344.com:3344/config/test/master http://config-3344.com:3344/config/test/dev 5ã€å‚æ•°è¯´æ˜/{label}-{name}-{profiles}.yml labelï¼šåˆ†æ”¯(branch)name ï¼šæœåŠ¡åprofilesï¼šç¯å¢ƒ(dev/test/prod) 3ã€Configå®¢æˆ·ç«¯é…ç½®1ã€å»ºmodelå’Œæµ‹è¯•1ã€å»ºmodelæ–°å»ºcloud-config-client-3355 2ã€pom&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-config-client-3355&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€bootstrap.ymlapplicaiton.yml æ˜¯ç”¨æˆ·çº§çš„èµ„æºé…ç½®é¡¹bootstrap.yml æ˜¯ç³»ç»Ÿçº§çš„ï¼Œä¼˜å…ˆçº§æ›´åŠ é«˜ server: port: 3355 spring: application: name: config-client cloud: #Configå®¢æˆ·ç«¯é…ç½® config: label: master #åˆ†æ”¯åç§° name: config #é…ç½®æ–‡ä»¶åç§° profile: dev #è¯»å–åç¼€åç§° ä¸Šè¿°3ä¸ªç»¼åˆï¼šmasteråˆ†æ”¯ä¸Šconfig-dev.ymlçš„é…ç½®æ–‡ä»¶è¢«è¯»å–http://config-3344.com:3344/master/config-dev.yml uri: http://localhost:3344 #é…ç½®ä¸­å¿ƒåœ°å€ eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient public class ConfigClientMain3355 { public static void main(String[] args) { SpringApplication.run (ConfigClientMain3355.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/configInfo\") public String getConfigInfo() { return configInfo; } } 6ã€æµ‹è¯•1ã€å¯åŠ¨Configé…ç½®ä¸­å¿ƒ3344å¾®æœåŠ¡å¹¶è‡ªæµ‹ http://config-3344.com:3344/master/config-prod.yml http://config-3344.com:3344/master/config-dev.yml 2ã€å¯åŠ¨3355ä½œä¸ºClientå‡†å¤‡è®¿é—® http://localhost:3355/configInfo 2ã€åŠ¨æ€åˆ·æ–°é—®é¢˜ Linuxè¿ç»´ä¿®æ”¹GitHubä¸Šçš„é…ç½®æ–‡ä»¶å†…å®¹åšè°ƒæ•´ åˆ·æ–°3344ï¼Œå‘ç°ConfigServeré…ç½®ä¸­å¿ƒç«‹åˆ»å“åº” åˆ·æ–°3355ï¼Œå‘ç°ConfigClientå®¢æˆ·ç«¯æ²¡æœ‰ä»»ä½•å“åº” 3355æ²¡æœ‰å˜åŒ–é™¤éè‡ªå·±é‡å¯æˆ–è€…é‡æ–°åŠ è½½ éš¾åˆ°æ¯æ¬¡è¿ç»´ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯éƒ½éœ€è¦é‡å¯ï¼Ÿï¼Ÿå™©æ¢¦ 4ã€Configå®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°æ“ä½œ3355æ¨¡å— 1ã€POMå¼•å…¥actuatorç›‘æ§&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€ä¿®æ”¹YMLï¼Œæš´éœ²ç›‘æ§ç«¯å£# æš´éœ²ç›‘æ§ç«¯ç‚¹ management: endpoints: web: exposure: include: \"*\" 3ã€ä¸šåŠ¡ç±»Controllerä¿®æ”¹@RefreshScope package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.cloud.context.config.annotation.RefreshScope; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController @RefreshScope public class ConfigClientController { @Value(\"${spring.application.name}\") private String configInfo; @GetMapping(\"/configInfo\") public String getConfigInfo() { return configInfo; } } 4ã€æ­¤æ—¶ä¿®æ”¹githubâ€”&gt; 3344 â€”-&gt;33551ã€æ·»åŠ ä¸€ä¸ªç‰ˆæœ¬å·ä¸º1 2ã€æ­¤æ—¶çœ‹ä¸‹3344ï¼ˆconfigæœåŠ¡ç«¯ï¼‰ï¼Œæ²¡æœ‰é‡å¯çš„çŠ¶æ€ä¸‹ æ²¡æœ‰æ›´æ–°ï¼ 3ã€æ­¤æ—¶çœ‹ä¸‹3355ï¼ˆconfigå®¢æˆ·ç«¯ï¼‰ï¼Œæ²¡æœ‰é‡å¯çš„çŠ¶æ€ä¸‹ æ²¡æœ‰æ›´æ–°ï¼ 4ã€æ€»ç»“ï¼šæ˜¯ä¸ä¼šæ›´æ–°çš„ 5ã€è§£å†³ï¼šéœ€è¦è¿ç»´äººå‘˜è¿è¡Œè§£å†³ å¿…é¡»æ˜¯POSTè¯·æ±‚ curl -X POST \"http://localhost:3355/actuator/refresh\" 5ã€è¿˜å­˜åœ¨çš„é—®é¢˜ æ¯ä¸ªå¾®æœåŠ¡éƒ½è¦æ‰§è¡Œä¸€æ¬¡postè¯·æ±‚ï¼Œæ‰‹åŠ¨åˆ·æ–°ï¼Ÿ å†™å¾ªç¯ä»£ç è§£å†³ï¼ˆshellè„šæœ¬ï¼‰ å¯å¦å¹¿æ’­ï¼Œä¸€æ¬¡é€šçŸ¥ï¼Œå¤„å¤„ç”Ÿæ•ˆï¼Ÿ é¸¡è‚‹æ‰€åœ¨ å¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„nacos æ›¿æ¢è§£å†³ æ•´åˆSpringCloud-Busè§£å†³","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"é…ç½®ä¸­å¿ƒ","slug":"é…ç½®ä¸­å¿ƒ","permalink":"https://mykkto.github.io/tags/%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"},{"name":"config","slug":"config","permalink":"https://mykkto.github.io/tags/config/"}],"author":"mykk"},{"title":"SpringCloud-Gatewayè·¯ç”±ç½‘å…³","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/09_SpringCloud-GateWay","date":"2022-02-02T01:22:13.000Z","updated":"2023-06-11T02:53:45.169Z","comments":true,"path":"posts/faa2de28.html","link":"","permalink":"https://mykkto.github.io/posts/faa2de28.html","excerpt":"","text":"ä¸€ã€æ¦‚è¿°ç®€ä»‹1ã€å®˜ç½‘1ã€ä¸Šä¸€ä»£zuul 1.Xhttps://github.com/Netflix/zuul/wiki 2ã€Gatewayhttps://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/ 2ã€æ˜¯ä»€ä¹ˆ1ã€æ¦‚è¿°Gatewayæ˜¯åœ¨Springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡ï¼ŒåŸºäºSpring 5ï¼ŒSpring Boot 2å’Œ Project Reactorç­‰æŠ€æœ¯ã€‚Gatewayæ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±ï¼Œä»¥åŠæä¾›ä¸€äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œ ä¾‹å¦‚ï¼šç†”æ–­ã€é™æµã€é‡è¯•ç­‰ 2ã€ä¸€å¥è¯SpringCloud Gateway ä½¿ç”¨çš„Webfluxä¸­çš„reactor-nettyå“åº”å¼ç¼–ç¨‹ç»„ä»¶ï¼Œåº•å±‚ä½¿ç”¨äº†Nettyé€šè®¯æ¡†æ¶ã€‚ 3ã€èƒ½å¹²å˜› åå‘ä»£ç† é‰´æƒ æµé‡æ§åˆ¶ ç†”æ–­ æ—¥å¿—ç›‘æ§ â€¦â€¦ 4ã€ç½‘å…³åœ¨å¾®æœåŠ¡çš„ä½ç½® 5ã€GateWayä¼˜äºZuulçš„åœ°æ–¹1ã€æˆ‘ä»¬ä¸ºä»€ä¹ˆé€‰æ‹©Gatewayï¼Ÿ1ã€neflixä¸å¤ªé è°±ï¼Œzuul2.0ä¸€ç›´è·³ç¥¨ï¼Œè¿Ÿè¿Ÿä¸å‘å¸ƒ2ã€SpringCloud Gatewayå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ åŸºäºSpring Framework 5, Project Reactor å’Œ Spring Boot 2.0 è¿›è¡Œæ„å»ºï¼› åŠ¨æ€è·¯ç”±ï¼šèƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§ï¼› å¯ä»¥å¯¹è·¯ç”±æŒ‡å®š Predicateï¼ˆæ–­è¨€ï¼‰å’Œ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼› é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½ï¼› é›†æˆ Spring Cloud æœåŠ¡å‘ç°åŠŸèƒ½ï¼› æ˜“äºç¼–å†™çš„ Predicateï¼ˆæ–­è¨€ï¼‰å’Œ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼› è¯·æ±‚é™æµåŠŸèƒ½ï¼› æ”¯æŒè·¯å¾„é‡å†™ã€‚ 3ã€SpringCloud Gateway ä¸ Zuulçš„åŒºåˆ« Zuul 1.xï¼Œæ˜¯ä¸€ä¸ªåŸºäº é˜»å¡ I/ O çš„ API Gateway Zuul 1.x åŸºäºServlet 2. 5ä½¿ç”¨é˜»å¡æ¶æ„å®ƒä¸æ”¯æŒä»»ä½•é•¿è¿æ¥(å¦‚ WebSocket) Zuul çš„è®¾è®¡æ¨¡å¼å’ŒNginxè¾ƒåƒï¼Œæ¯æ¬¡ I/ O æ“ä½œéƒ½æ˜¯ä»å·¥ä½œçº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œï¼Œè¯·æ±‚çº¿ç¨‹è¢«é˜»å¡åˆ°å·¥ä½œçº¿ç¨‹å®Œæˆï¼Œä½†æ˜¯å·®åˆ«æ˜¯Nginx ç”¨C++ å®ç°ï¼ŒZuul ç”¨ Java å®ç°ï¼Œè€Œ JVM æœ¬èº«ä¼šæœ‰ç¬¬ä¸€æ¬¡åŠ è½½è¾ƒæ…¢çš„æƒ…å†µï¼Œä½¿å¾—Zuul çš„æ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚ Zuul 2.xç†å¿µæ›´å…ˆè¿›ï¼Œæƒ³åŸºäºNettyéé˜»å¡å’Œæ”¯æŒé•¿è¿æ¥ï¼Œä½†SpringCloudç›®å‰è¿˜æ²¡æœ‰æ•´åˆã€‚ Zuul 2.xçš„æ€§èƒ½è¾ƒ Zuul 1.x æœ‰è¾ƒå¤§æå‡ã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œæ ¹æ®å®˜æ–¹æä¾›çš„åŸºå‡†æµ‹è¯•ï¼Œ Spring Cloud Gateway çš„ RPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰æ˜¯Zuul çš„ 1. 6 å€ã€‚ Spring Cloud Gateway å»ºç«‹ åœ¨ Spring Framework 5ã€ Project Reactor å’Œ Spring Boot 2 ä¹‹ä¸Šï¼Œ ä½¿ç”¨éé˜»å¡ APIã€‚ Spring Cloud Gateway è¿˜ æ”¯æŒ WebSocketï¼Œ å¹¶ä¸”ä¸Springç´§å¯†é›†æˆæ‹¥æœ‰æ›´å¥½çš„å¼€å‘ä½“éªŒ 2ã€Zuul1.xæ¨¡å‹Springcloudä¸­æ‰€é›†æˆçš„Zuulç‰ˆæœ¬ï¼Œé‡‡ç”¨çš„æ˜¯Tomcatå®¹å™¨ï¼Œä½¿ç”¨çš„æ˜¯ä¼ ç»Ÿçš„Servlet IOå¤„ç†æ¨¡å‹ã€‚ Servletçš„ç”Ÿå‘½å‘¨æœŸ?servletç”±servlet containerè¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ containerå¯åŠ¨æ—¶æ„é€ servletå¯¹è±¡å¹¶è°ƒç”¨servlet init()è¿›è¡Œåˆå§‹åŒ–ï¼› containerè¿è¡Œæ—¶æ¥å—è¯·æ±‚ï¼Œå¹¶ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸€èˆ¬ä»çº¿ç¨‹æ± ä¸­è·å–ç©ºé—²çº¿ç¨‹ï¼‰ç„¶åè°ƒç”¨service()ã€‚ containerå…³é—­æ—¶è°ƒç”¨servlet destory()é”€æ¯servletï¼› 3ã€GateWayæ¨¡å‹WebFluxæ˜¯ä»€ä¹ˆ https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux-new-framework ä¼ ç»Ÿçš„Webæ¡†æ¶ï¼Œæ¯”å¦‚è¯´ï¼šstruts2ï¼Œspringmvcç­‰éƒ½æ˜¯åŸºäºServlet APIä¸Servletå®¹å™¨åŸºç¡€ä¹‹ä¸Šè¿è¡Œçš„ã€‚ä½†æ˜¯åœ¨Servlet3.1ä¹‹åæœ‰äº†å¼‚æ­¥éé˜»å¡çš„æ”¯æŒã€‚è€ŒWebFluxæ˜¯ä¸€ä¸ªå…¸å‹éé˜»å¡å¼‚æ­¥çš„æ¡†æ¶ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯åŸºäºReactorçš„ç›¸å…³APIå®ç°çš„ã€‚ç›¸å¯¹äºä¼ ç»Ÿçš„webæ¡†æ¶æ¥è¯´ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨è¯¸å¦‚Nettyï¼ŒUndertowåŠæ”¯æŒServlet3.1çš„å®¹å™¨ä¸Šã€‚éé˜»å¡å¼+å‡½æ•°å¼ç¼–ç¨‹ï¼ˆSpring5å¿…é¡»è®©ä½ ä½¿ç”¨java8ï¼‰ äºŒã€ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ1ã€Route(è·¯ç”±)è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDï¼Œç›®æ ‡URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”± 2ã€Predicate(æ–­è¨€)å‚è€ƒçš„æ˜¯Java8çš„java.util.function.Predicateå¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹(ä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°)ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”± 3ã€Filter(è¿‡æ»¤)æŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚ 4ã€æ€»ä½“webè¯·æ±‚ï¼Œé€šè¿‡ä¸€äº›åŒ¹é…æ¡ä»¶ï¼Œå®šä½åˆ°çœŸæ­£çš„æœåŠ¡èŠ‚ç‚¹ã€‚å¹¶åœ¨è¿™ä¸ªè½¬å‘è¿‡ç¨‹çš„å‰åï¼Œè¿›è¡Œä¸€äº›ç²¾ç»†åŒ–æ§åˆ¶ã€‚predicateå°±æ˜¯æˆ‘ä»¬çš„åŒ¹é…æ¡ä»¶ï¼›è€Œfilterï¼Œå°±å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ— æ‰€ä¸èƒ½çš„æ‹¦æˆªå™¨ã€‚æœ‰äº†è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œå†åŠ ä¸Šç›®æ ‡uriï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªå…·ä½“çš„è·¯ç”±äº† ä¸‰ã€Gatewayå·¥ä½œæµç¨‹1ã€å®˜ç½‘å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚ç„¶ååœ¨ Gateway Handler Mapping ä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ° Gateway Web Handlerã€‚ Handler å†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆâ€œpreâ€ï¼‰æˆ–ä¹‹åï¼ˆâ€œpostâ€ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚ Filteråœ¨â€œpreâ€ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰ï¼Œåœ¨â€œpostâ€ç±»å‹çš„è¿‡æ»¤å™¨ä¸­å¯ä»¥åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ï¼Œæ—¥å¿—çš„è¾“å‡ºï¼Œæµé‡ç›‘æ§ç­‰æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚ 2ã€æ ¸å¿ƒé€»è¾‘è·¯ç”±è½¬å‘+æ‰§è¡Œè¿‡æ»¤å™¨é“¾ å››ã€å…¥é—¨æ¡ˆä¾‹1ã€æ¨¡å—åˆ›å»ºæ­¥éª¤1ã€å»ºmodelcloud-gateway-gateway9527 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-gateway-gateway9527&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--gateway--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--eureka-client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®ç±»--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 9527 spring: application: name: cloud-gateway eureka: instance: hostname: cloud-gateway-service client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†… service-url: register-with-eureka: true fetch-registry: true defaultZone: http://eureka7001.com:7001/eureka 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient public class GatewayMain9527 { public static void main(String[] args) { SpringApplication.run (GatewayMain9527.class,args); } } 2ã€ç½‘å…³æ˜ å°„é…ç½®1ã€ymlé…ç½®spring: application: name: cloud-gateway cloud: gateway: routes: - id: payment_routh #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/get/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_routh2 #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± 2ã€é…ç½®è¯´æ˜ 4ã€æµ‹è¯•1ã€å¯åŠ¨ eurekaé›†ç¾¤ï¼Œå¯åŠ¨8001/8002ï¼Œå¯åŠ¨ç½‘å…³9527 æ·»åŠ ç½‘å…³å‰uriï¼šhttp://localhost:8001/payment/get/1 æ·»åŠ ç½‘å…³åuriï¼šhttp://localhost:9527/payment/get/1 3ã€YMLé…ç½®è¯´æ˜Gatewayç½‘å…³è·¯ç”±æœ‰ä¸¤ç§é…ç½®æ–¹å¼ï¼š 1ã€æ–¹å¼ä¸€ï¼šåœ¨é…ç½®æ–‡ä»¶ymlä¸­é…ç½®æ—¢ä¸Šé¢æ¡ˆä¾‹çš„æ–¹å¼ 1ã€æ–¹å¼äºŒï¼šä»£ç ä¸­æ³¨å…¥RouteLocatorçš„Beanpackage com.kk.springcloud.config; import org.springframework.cloud.gateway.route.RouteLocator; import org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class GatewayConfig { /** * é…ç½®äº†ä¸€ä¸ªidä¸ºroute-nameçš„è·¯ç”±è§„åˆ™ï¼Œ * å½“è®¿é—®åœ°å€ http://localhost:9527/kkæ—¶ä¼šè‡ªåŠ¨è½¬å‘åˆ°åœ°å€ï¼šhttp://news.baidu.com/ * * @param builder * @return */ @Bean public RouteLocator customRouteLocator(RouteLocatorBuilder builder) { RouteLocatorBuilder.Builder routes = builder.routes ( ); routes.route (\"path_route_mykk\", r -&gt; r.path (\"/kk\").uri (\"http://www.baidu.com/\")).build ( ); return routes.build ( ); } @Bean public RouteLocator customRouteLocator2(RouteLocatorBuilder builder) { RouteLocatorBuilder.Builder routes = builder.routes ( ); routes.route (\"path_route_mykk2\", r -&gt; r.path (\"/kkz\").uri (\"http://www.weibo.com/kkz\")).build ( ); return routes.build ( ); } } äº”ã€å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±1ã€æ¦‚è¿°é»˜è®¤æƒ…å†µä¸‹Gatewayä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„æœåŠ¡åˆ—è¡¨ï¼Œä»¥æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åä¸ºè·¯å¾„åˆ›å»ºåŠ¨æ€è·¯ç”±è¿›è¡Œè½¬å‘ï¼Œä»è€Œå®ç°åŠ¨æ€è·¯ç”±çš„åŠŸèƒ½ 2ã€å¯åŠ¨ä¸€ä¸ªeureka7001 + ä¸¤ä¸ªæœåŠ¡æä¾›è€…8001/8002 4ã€yml1ã€éœ€è¦æ³¨æ„çš„æ˜¯uriçš„åè®®ä¸ºlbï¼Œè¡¨ç¤ºå¯ç”¨Gatewayçš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚ 2ã€lb://serviceNameæ˜¯spring cloud gatewayåœ¨å¾®æœåŠ¡ä¸­è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºçš„è´Ÿè½½å‡è¡¡uri server: port: 9527 spring: application: name: cloud-gateway cloud: gateway: discovery: locator: enabled: true #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”± routes: - id: payment_routh #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/get/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_routh2 #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± eureka: instance: hostname: cloud-gateway-service client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†… service-url: register-with-eureka: true fetch-registry: true defaultZone: http://eureka7001.com:7001/eureka 5ã€æµ‹è¯•urlï¼šhttp://localhost:9527/payment/lb å…­ã€Predicate(æ–­è¨€)çš„ä½¿ç”¨1ã€å¯åŠ¨çœ‹ä¸‹æ—¥å¿— 2ã€Route Predicate FactoriesSpring Cloud Gateway åˆ›å»º Route å¯¹è±¡æ—¶ï¼Œ ä½¿ç”¨ RoutePredicateFactory åˆ›å»º Predicate å¯¹è±¡ï¼ŒPredicate å¯¹è±¡å¯ä»¥èµ‹å€¼ç»™ Routeã€‚ Spring Cloud Gateway åŒ…å«è®¸å¤šå†…ç½®çš„Route Predicate Factoriesã€‚ æ‰€æœ‰è¿™äº›è°“è¯æ˜¯éƒ½åŒ¹é…HTTPè¯·æ±‚çš„ä¸åŒå±æ€§ã€‚å¤šç§è°“è¯å·¥å‚å¯ä»¥ç»„åˆï¼Œå¹¶é€šè¿‡é€»è¾‘ and ç»„åˆã€‚ 3ã€å¸¸ç”¨çš„Route Predicate1ã€After Route Predicateå¿…é¡»è¦åœ¨é…ç½®æ–­è¨€çš„æ—¶åŒºçš„æ—¶é—´ä¹‹åå¯¹åº”çš„uriè¯·æ±‚æ‰èƒ½ç”Ÿæ•ˆ package com.kk.test; import java.time.ZonedDateTime; public class Test { public static void main(String[] args) { ZonedDateTime zbj = ZonedDateTime.now ( ); // é»˜è®¤æ—¶åŒº System.out.println (zbj); // ZonedDateTime zny = ZonedDateTime.now(ZoneId.of(\"America/New_York\")); // ç”¨æŒ‡å®šæ—¶åŒºè·å–å½“å‰æ—¶é—´ // System.out.println(zny); } } - After=2022-02-03T13:53:16.164+08:00[Asia/Shanghai] # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± spring: application: name: cloud-gateway cloud: gateway: discovery: locator: enabled: true #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”± routes: - id: payment_routh #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/get/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - After=2022-02-03T13:53:16.164+08:00[Asia/Shanghai] # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_routh2 #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± 2ã€Before Route Predicateå¿…é¡»è¦åœ¨é…ç½®æ–­è¨€çš„æ—¶åŒºçš„æ—¶é—´ä¹‹å‰å¯¹åº”çš„uriè¯·æ±‚æ‰èƒ½ç”Ÿæ•ˆ - Before=2022-02-03T13:53:16.164+08:00[Asia/Shanghai] # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± 3ã€Between Route Predicateå¿…é¡»è¦åœ¨é…ç½®æ–­è¨€çš„æ—¶åŒºçš„æ—¶é—´èŒƒå›´å†…å¯¹åº”çš„uriè¯·æ±‚æ‰èƒ½ç”Ÿæ•ˆ - Between=2022-02-03T13:53:16.164+08:00[Asia/Shanghai],2022-12-03T13:53:16.164+08:00[Asia/Shanghai] # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± 4ã€Cookie Route Predicateå¿…é¡»æ˜¾ç¤ºçš„æŒ‡å®šæºå¸¦çš„cookieä¿¡æ¯ï¼Œæ‰èƒ½è®¿é—®å¯¹åº”çš„uri - Cookie=username,mykk # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± 1ã€ä¸å¸¦cookieçš„æƒ…å†µ curl http://localhost:9527/payment/get/1 2ã€æºå¸¦cookieçš„æƒ…å†µ curl http://localhost:9527/payment/get/1 --cookie \"username=mykk\" 5ã€Header Route Predicateå¿…é¡»æ˜¾ç¤ºçš„æŒ‡å®šæºå¸¦çš„è¯·æ±‚å¤´Header ä¿¡æ¯ï¼Œæ‰èƒ½è®¿é—®å¯¹åº”çš„uriã€‚ ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯å±æ€§åç§°å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™ä¸ªå±æ€§å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ™æ‰§è¡Œã€‚ - Header=X-Request-Id, \\d+ # è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼ 1ã€ä¸å¸¦Headerçš„æƒ…å†µ curl http://localhost:9527/payment/get/1 2ã€æºå¸¦Headerçš„æƒ…å†µ curl http://localhost:9527/payment/get/1 -H \"X-Request-Id:123\" 6ã€Host Route Predicateå¿…é¡»æ˜¾ç¤ºçš„æºå¸¦æŒ‡å®šè§„åˆ™çš„ä¸»æœºåœ°å€ Hostä¿¡æ¯ ï¼Œæ‰èƒ½è®¿é—®å¯¹åº”çš„uriã€‚ - Host=**.mykk.com è®¿é—®æµ‹è¯• curl http://localhost:9527/payment/get/1 -H \"Host:www.mykk.com\" curl http://localhost:9527/payment/get/1 -H \"Host:news.mykk.com\" 7ã€Method Route Predicateå¿…é¡»æ˜¾ç¤ºçš„æŒ‡å®šè¯·æ±‚æ–¹å¼ ï¼Œæ‰èƒ½è®¿é—®å¯¹åº”çš„uriã€‚ - Method=GET # è¯·æ±‚æ–¹å¼ 8ã€Path Route Predicateè·¯ç”±åˆ°æŒ‡å®šçš„è·¯å¾„ 9ã€Query Route Predicateå¿…é¡»æ˜¾ç¤ºçš„æºå¸¦æŒ‡å®šè§„åˆ™çš„ è¯·æ±‚å‚æ•° ï¼Œæ‰èƒ½è®¿é—®å¯¹åº”çš„uriã€‚ è¯´æ˜ï¼šæ”¯æŒä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å±æ€§åï¼Œä¸€ä¸ªä¸ºå±æ€§å€¼ï¼Œå±æ€§å€¼å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚ æµ‹è¯•ï¼š urlï¼šcurl http://localhost:9527/payment/get/1?username=111 ä¸ƒã€Filterçš„ä½¿ç”¨1ã€æ¦‚è¿°è·¯ç”±è¿‡æ»¤å™¨å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨åªèƒ½æŒ‡å®šè·¯ç”±è¿›è¡Œä½¿ç”¨ã€‚ Spring Cloud Gateway å†…ç½®äº†å¤šç§è·¯ç”±è¿‡æ»¤å™¨ï¼Œä»–ä»¬éƒ½ç”±GatewayFilterçš„å·¥å‚ç±»æ¥äº§ç”Ÿ 1ã€ç”Ÿå‘½å‘¨æœŸå‰ç½®ï¼špre åç½®ï¼špost 2ã€ç§ç±»å•ä¸€ï¼šGatewayFilter https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#the-addrequestparameter-gatewayfilter-factory 31ç§ä¹‹å¤š å…¨å±€ï¼šGlobalFilter 2ã€å¸¸ç”¨çš„GatewayFilterAddRequestParameter filters: - AddRequestParameter=X-Request-Id,1024 #è¿‡æ»¤å™¨å·¥å‚ä¼šåœ¨åŒ¹é…çš„è¯·æ±‚å¤´åŠ ä¸Šä¸€å¯¹è¯·æ±‚å¤´ï¼Œåç§°ä¸ºX-Request-Idå€¼ä¸º1024 server: port: 9527 spring: application: name: cloud-gateway cloud: gateway: discovery: locator: enabled: true #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”± routes: - id: payment_routh #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ filters: - AddRequestParameter=X-Request-Id,1024 #è¿‡æ»¤å™¨å·¥å‚ä¼šåœ¨åŒ¹é…çš„è¯·æ±‚å¤´åŠ ä¸Šä¸€å¯¹è¯·æ±‚å¤´ï¼Œåç§°ä¸ºX-Request-Idå€¼ä¸º1024 predicates: - Path=/payment/get/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - After=2022-02-03T13:53:16.164+08:00[Asia/Shanghai] # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± # - Cookie=username,mykk # - Header=X-Request-Id, \\d+ # è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼ # - Host=**.mykk.com # - Method=GET # è¯·æ±‚æ–¹å¼ - Query=username, \\d+ # è¦æœ‰å‚æ•°åusernameå¹¶ä¸”å€¼è¿˜è¦æ˜¯æ•´æ•°æ‰èƒ½è·¯ç”± - id: payment_routh2 #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± eureka: instance: hostname: cloud-gateway-service client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†… service-url: register-with-eureka: true fetch-registry: true defaultZone: http://eureka7001.com:7001/eureka 3ã€è‡ªå®šä¹‰è¿‡æ»¤å™¨è‡ªå®šä¹‰å…¨å±€GlobalFilter 1ã€ä¸¤ä¸ªä¸»è¦æ¥å£ä»‹ç»implements GlobalFilter,Ordered 2ã€èƒ½å¹²å˜› å…¨å±€æ—¥å¿—è®°å½• ç»Ÿä¸€ç½‘å…³é‰´æƒ â€¦â€¦ 3ã€ä»£ç package com.kk.springcloud.config.config; import org.springframework.cloud.gateway.filter.GatewayFilterChain; import org.springframework.cloud.gateway.filter.GlobalFilter; import org.springframework.core.Ordered; import org.springframework.http.HttpStatus; import org.springframework.stereotype.Component; import org.springframework.web.server.ServerWebExchange; import reactor.core.publisher.Mono; import java.util.Date; @Component public class MyLogGateWayFilter implements GlobalFilter, Ordered { @Override // è¿‡æ»¤é€»è¾‘ public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) { System.out.println(\"time:\"+new Date ()+\"\\t æ‰§è¡Œäº†è‡ªå®šä¹‰çš„å…¨å±€è¿‡æ»¤å™¨: \"+\"MyLogGateWayFilter\"+\"hello\"); String uname = exchange.getRequest().getQueryParams().getFirst(\"uname\"); if (uname == null) { System.out.println(\"****ç”¨æˆ·åä¸ºnullï¼Œæ— æ³•ç™»å½•\"); exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE); return exchange.getResponse().setComplete(); } return chain.filter(exchange); } // ä¼˜å…ˆçº§ï¼Œè¶Šå°‘è¶Šå¤§ @Override public int getOrder() { return 0; } } æµ‹è¯•ï¼šcurl http://localhost:9527/payment/get/1?uname=11","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"è·¯ç”±ç½‘å…³","slug":"è·¯ç”±ç½‘å…³","permalink":"https://mykkto.github.io/tags/%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3/"},{"name":"alibaba","slug":"alibaba","permalink":"https://mykkto.github.io/tags/alibaba/"},{"name":"Gateway","slug":"Gateway","permalink":"https://mykkto.github.io/tags/Gateway/"}],"author":"mykk"},{"title":"mysqlå¼€å¯è¿œç¨‹è¿æ¥","slug":"04-åŸºç¡€/03mysql/01_Mysql_smallPosture","date":"2022-01-27T14:27:39.000Z","updated":"2023-06-11T02:53:45.143Z","comments":true,"path":"posts/bf62bc57.html","link":"","permalink":"https://mykkto.github.io/posts/bf62bc57.html","excerpt":"","text":"1ã€å‰è¨€æœ€è¿‘å¿«è¿‡å¹´äº†ï¼Œå›å»è‚¯å®šæ˜¯è¦æ•²ä»£ç ï¼Œå†™åšæ–‡çš„ï¼Œè¿‘æœŸåœ¨å†™SpringCloudå…¨å®¶æ¡¶ï¼Œæ•°æ®åº“ä¸€ç›´æ˜¯åœ¨æœ¬åœ°ï¼Œæƒ³ç€è¿˜æœ‰å‡ å°äº‘æœºåœ¨äº‘ä¸Šè¿è¡Œç€ï¼Œäºæ˜¯è¿æ¥äº†ä¸‹ï¼Œå‡ºç°äº†å¦‚ä¸‹é—®é¢˜ï¼š ä¹‹å‰è¿˜æ˜¯å¥½çš„ï¼Œå¯èƒ½æŒºä¹…æ²¡ç”¨çš„æƒé™è‡ªå·±å…³é—­äº†ï¼Œå®‰è£…æ˜¯docker å¯ä»¥å‚è€ƒä¹‹å‰åšä¸»çš„ç®€ä¹¦æ–‡ç«  ï¼š https://www.jianshu.com/p/f554c85b25c1 ç‰ˆæœ¬é¡ºä¾¿è¯´ä¸‹5.7.35 MySQL Community Server (GPL) 2ã€å¼€å¯è¿œç¨‹è¿æ¥#å¼€å¯è¿œç¨‹è¿æ¥ GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'a1b2c3' WITH GRANT OPTION; #root ç”¨æˆ·å #a1b2c3 å¯†ç  #åˆ·æ–°æƒé™ï¼Œç«‹å³ç”Ÿæ•ˆ flush privileges; 3ã€ä¿®æ”¹å¯†ç #ä¿®æ”¹å¯†ç (5.7.35) set password = password ('a1b2c3'); #ä¿®æ”¹å¯†ç ï¼ˆé«˜ç‰ˆæœ¬ 8.0+ï¼‰ update mysql.user set authentication_string=password('a1b2c3') where user='a1b2c3'; #åˆ·æ–°æƒé™ï¼Œç«‹å³ç”Ÿæ•ˆ flush privileges;","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://mykkto.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"å°å§¿åŠ¿","slug":"å°å§¿åŠ¿","permalink":"https://mykkto.github.io/tags/%E5%B0%8F%E5%A7%BF%E5%8A%BF/"},{"name":"linux","slug":"linux","permalink":"https://mykkto.github.io/tags/linux/"},{"name":"mysql","slug":"mysql","permalink":"https://mykkto.github.io/tags/mysql/"}],"author":"mykk"},{"title":"SpringCloud-Zuulè·¯ç”±ç½‘å…³","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/08_SpringCloud_Zuul","date":"2022-01-25T13:38:21.000Z","updated":"2023-06-11T02:53:45.170Z","comments":true,"path":"posts/d633875f.html","link":"","permalink":"https://mykkto.github.io/posts/d633875f.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€å®˜ç½‘https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/2.2.1.RELEASE/reference/html/#router-and-filter-zuul 2ã€æ˜¯ä»€ä¹ˆZuulæ˜¯ä¸€ç§æä¾›åŠ¨æ€è·¯ç”±ã€ç›‘è§†ã€å¼¹æ€§ã€å®‰å…¨æ€§ç­‰åŠŸèƒ½çš„è¾¹ç¼˜æœåŠ¡ã€‚ Zuulæ˜¯Netflixå‡ºå“çš„ä¸€ä¸ªåŸºäºJVMè·¯ç”±å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ã€‚ APIç½‘å…³ä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡æä¾›äº†ç»Ÿä¸€çš„è®¿é—®å…¥å£ï¼Œå®¢æˆ·ç«¯é€šè¿‡APIç½‘å…³è®¿é—®ç›¸å…³æœåŠ¡ã€‚APIç½‘å…³çš„å®šä¹‰ç±»ä¼¼äºè®¾è®¡æ¨¡å¼ä¸­çš„é—¨é¢æ¨¡å¼ï¼Œå®ƒç›¸å½“äºæ•´ä¸ªå¾®æœåŠ¡æ¶æ„ä¸­çš„é—¨é¢ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯çš„è®¿é—®éƒ½é€šè¿‡å®ƒæ¥è¿›è¡Œè·¯ç”±åŠè¿‡æ»¤ã€‚å®ƒå®ç°äº†è¯·æ±‚è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€æ ¡éªŒè¿‡æ»¤ã€æœåŠ¡å®¹é”™ã€æœåŠ¡èšåˆç­‰åŠŸèƒ½ã€‚ ZuulåŒ…å«äº†å¦‚ä¸‹æœ€ä¸»è¦çš„åŠŸèƒ½ï¼šä»£ç†+è·¯ç”±+è¿‡æ»¤ä¸‰å¤§åŠŸèƒ½ 3ã€èƒ½å¹²å˜›1ã€è·¯ç”±2ã€è¿‡æ»¤3ã€è´Ÿè½½å‡è¡¡4ã€ç°åº¦å‘å¸ƒï¼ˆé‡‘ä¸é›€å‘å¸ƒï¼‰èµ·æºæ˜¯ï¼ŒçŸ¿äº•å·¥äººå‘ç°ï¼Œé‡‘ä¸é›€å¯¹ç“¦æ–¯æ°”ä½“å¾ˆæ•æ„Ÿï¼ŒçŸ¿å·¥ä¼šåœ¨ä¸‹äº•ä¹‹å‰ï¼Œå…ˆæ”¾ä¸€åªé‡‘ä¸é›€åˆ°äº•ä¸­ï¼Œå¦‚æœé‡‘ä¸é›€ä¸å«äº†ï¼Œå°±ä»£è¡¨ç“¦æ–¯æµ“åº¦é«˜ã€‚ åœ¨ç°åº¦å‘å¸ƒå¼€å§‹åï¼Œå…ˆå¯åŠ¨ä¸€ä¸ªæ–°ç‰ˆæœ¬åº”ç”¨ï¼Œä½†æ˜¯å¹¶ä¸ç›´æ¥å°†æµé‡åˆ‡è¿‡æ¥ï¼Œè€Œæ˜¯æµ‹è¯•äººå‘˜å¯¹æ–°ç‰ˆæœ¬è¿›è¡Œçº¿ä¸Šæµ‹è¯•ï¼Œå¯åŠ¨çš„è¿™ä¸ªæ–°ç‰ˆæœ¬åº”ç”¨ï¼Œå°±æ˜¯æˆ‘ä»¬çš„é‡‘ä¸é›€ã€‚å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå¯ä»¥å°†å°‘é‡çš„ç”¨æˆ·æµé‡å¯¼å…¥åˆ°æ–°ç‰ˆæœ¬ä¸Šï¼Œç„¶åå†å¯¹æ–°ç‰ˆæœ¬åšè¿è¡ŒçŠ¶æ€è§‚å¯Ÿï¼Œæ”¶é›†å„ç§è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚æœæ­¤æ—¶å¯¹æ–°æ—§ç‰ˆæœ¬åšå„ç§æ•°æ®å¯¹æ¯”ï¼Œå°±æ˜¯æ‰€è°“çš„A/Bæµ‹è¯•ã€‚æ–°ç‰ˆæœ¬æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œé‚£ä¹ˆé€æ­¥æ‰©å¤§èŒƒå›´ã€æµé‡ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·éƒ½è¿ç§»åˆ°æ–°ç‰ˆæœ¬ä¸Šé¢æ¥ã€‚ 2ã€è·¯ç”±åŸºæœ¬é…ç½®è·¯ç”±åŠŸèƒ½è´Ÿè´£å°†å¤–éƒ¨è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„æœåŠ¡å®ä¾‹ä¸Šå»ï¼Œæ˜¯å®ç°ç»Ÿä¸€è®¿é—®å…¥å£çš„åŸºç¡€ 1ã€å»ºModelcloud-zuul-gateway9527 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-zuul-gateway9527&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 9527 spring: application: name: cloud-zuul-gateway eureka: client: service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka defaultZone: http://eureka7001.com:7001/eureka instance: instance-id: gateway-9527.com prefer-ip-address: true 4ã€hostsä¿®æ”¹(æœ¬åœ°ç¯å¢ƒ)å› ä¸ºæ˜¯æœ¬åœ°ç¯å¢ƒï¼ŒæœåŠ¡å™¨ï¼ŒåŸŸåç­‰èµ„æºæœ‰é™ æ·»åŠ é…ç½®é¡¹ï¼šC:\\Windows\\System32\\drivers\\etc 127.0.0.1 myzuul.com 5ã€ä¸»å¯åŠ¨æ³¨æ„ï¼š@EnableZuulProxy package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.zuul.EnableZuulProxy; @SpringBootApplication @EnableZuulProxy public class ZuulMain9527 { public static void main(String[] args) { SpringApplication.run (ZuulMain9527.class,args); } } 6ã€å¯åŠ¨é¡ºåº1ã€eurekaé›†ç¾¤ 2ã€8006ç”Ÿäº§è€… 3ã€9527ç½‘å…³ 7ã€æµ‹è¯•1ã€ä¸ç”¨è·¯ç”±http://localhost:8001/payment/consul controller @GetMapping(\"/payment/consul\") public String paymentInfo() { return \"springcloud with consul: \" + serverPort + \"\\t\\t\" + UUID.randomUUID ( ).toString ( ); } 2ã€è·¯ç”±ï¼ˆ1ï¼‰zuulæ˜ å°„é…ç½®+æ³¨å†Œä¸­å¿ƒæ³¨å†Œåå¯¹å¤–æš´éœ²çš„æœåŠ¡åç§°+restè°ƒç”¨åœ°å€ ï¼ˆ2ï¼‰urlï¼š http://myzuul.com:9527/cloud-payment-service/payment/consul ![](C:\\Users\\my_kk\\Documents\\Tencent Files\\763856958\\FileRecv_posts\\03javafenbushi\\01springcloud\\20220201141019.png) 3ã€è·¯ç”±è®¿é—®æ˜ å°„è§„åˆ™1ã€åç§°ä»£ç†1ã€ymlè¯¦è§£zuul: routes: # è·¯ç”±æ˜ å°„é…ç½® mypayment.path: /mypayment/** #IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mypayment.serviceId: cloud-payment-service # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° server: port: 9527 spring: application: name: cloud-zuul-gateway eureka: client: service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka defaultZone: http://eureka7001.com:7001/eureka instance: instance-id: gateway-9527.com prefer-ip-address: true zuul: routes: # è·¯ç”±æ˜ å°„é…ç½® mypayment.path: /mypayment/** #IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mypayment.serviceId: cloud-payment-service # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° 2ã€æµ‹è¯•1ã€è·¯ç”±è®¿é—®ï¼šOKhttp://myzuul.com:9527/mypayment/payment/consul 2ã€åŸè·¯å¾„è®¿é—®ï¼šOKhttp://myzuul.com:9527/cloud-payment-service/payment/consul 2ã€å¿½ç•¥åŸæœ‰çœŸå®æœåŠ¡å1ã€ymlé…ç½®zuul: ignored-services: cloud-payment-service #å¿½ç•¥æœåŠ¡å 2ã€æµ‹è¯•1ã€ä½¿ç”¨æœåŠ¡åè®¿é—®ï¼ˆå¤±è´¥ï¼‰ï¼šhttp://myzuul.com:9527/cloud-payment-service/payment/consul ![](C:\\Users\\my_kk\\Documents\\Tencent Files\\763856958\\FileRecv_posts\\03javafenbushi\\01springcloud\\20220201165024.png) 2ã€æ˜ å°„è®¿é—®ï¼šä¾æ—§å¯ä»¥ï¼ äº”è§’æ˜Ÿï¼šæ‰¹é‡å¿½ç•¥zuul: ignored-services: \"*\" 3ã€è·¯ç”±è½¬å‘å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½1ã€ç”Ÿäº§è€…ï¼šSMSçŸ­ä¿¡æ¨¡å—(8008)1ã€å»ºmodelcloud-provider-sms8008 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-provider-sms8008&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 8008 ###æœåŠ¡åç§°(æœåŠ¡æ³¨å†Œåˆ°eurekaåç§°) spring: application: name: cloud-provider-sms eureka: client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†… service-url: register-with-eureka: true fetch-registry: true defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka #defaultZone: http://127.0.0.1:7001/eureka,http://127.0.0.1:7002/eureka #defaultZone: http://eureka7001.com:7001/eureka # eurekaé›†ç¾¤åŠ @è€æœ¬ç‰ˆ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient public class SMSMain8008 { public static void main(String[] args) { SpringApplication.run (SMSMain8008.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class SMSController { @Value(\"${server.port}\") private String serverPort; @GetMapping(\"/sms\") public String sms() { return \"sms provider service: \"+\"\\t\"+serverPort; } } 6ã€å¯åŠ¨æœåŠ¡ 2ã€ç½‘å…³ï¼šzuulï¼ˆ9527ï¼‰1ã€ymlzuul: # ignored-services: cloud-payment-service #å¿½ç•¥æœåŠ¡å routes: # è·¯ç”±æ˜ å°„é…ç½® mysms.path: /mysms/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mysms.serviceId: cloud-provider-sms # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° server: port: 9527 spring: application: name: cloud-zuul-gateway eureka: client: service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka defaultZone: http://eureka7001.com:7001/eureka instance: instance-id: gateway-9527.com prefer-ip-address: true zuul: # ignored-services: cloud-payment-service #å¿½ç•¥æœåŠ¡å routes: # è·¯ç”±æ˜ å°„é…ç½® mysms.path: /mysms/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mysms.serviceId: cloud-provider-sms # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° mypayment.path: /mypayment/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mypayment.serviceId: cloud-payment-service # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° 2ã€è¯´æ˜ç”±äºZuulè‡ªåŠ¨é›†æˆäº†Ribbonå’ŒHystrixï¼Œæ‰€ä»¥Zuulå¤©ç”Ÿå°±æœ‰è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å®¹é”™èƒ½åŠ› 3ã€æµ‹è¯•è´Ÿè½½æ•ˆæœurlï¼š 4ã€è®¾ç½®ç»Ÿä¸€å…¬å…±å‰ç¼€ymlé…ç½®zuul: prefix: /mykk server: port: 9527 spring: application: name: cloud-zuul-gateway eureka: client: service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka defaultZone: http://eureka7001.com:7001/eureka instance: instance-id: gateway-9527.com prefer-ip-address: true zuul: prefix: /mykk # ignored-services: cloud-payment-service #å¿½ç•¥æœåŠ¡å routes: # è·¯ç”±æ˜ å°„é…ç½® mysms.path: /mysms/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mysms.serviceId: cloud-provider-sms # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° mypayment.path: /mypayment/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mypayment.serviceId: cloud-payment-service # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° æµ‹è¯•urlï¼ˆ1ï¼‰http://myzuul.com:9527/mykk/mypayment/payment/consul ï¼ˆ2ï¼‰http://myzuul.com:9527/mykk/mysms/sms 4ã€æŸ¥çœ‹è·¯ç”±ä¿¡æ¯1ã€POM&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€yml# å¼€å¯æŸ¥çœ‹è·¯ç”±çš„ç«¯ç‚¹ management: endpoints: web: exposure: include: 'routes' 3ã€æŸ¥çœ‹è·¯ç”±è¯¦ç»†ä¿¡æ¯urlï¼šhttp://localhost:9527/actuator/routes 5ã€è¿‡æ»¤å™¨1ã€åŠŸèƒ½è¿‡æ»¤åŠŸèƒ½è´Ÿè´£å¯¹è¯·æ±‚è¿‡ç¨‹è¿›è¡Œé¢å¤–çš„å¤„ç†ï¼Œæ˜¯è¯·æ±‚æ ¡éªŒè¿‡æ»¤åŠæœåŠ¡èšåˆçš„åŸºç¡€ã€‚ 2ã€è¿‡æ»¤å™¨çš„ç”Ÿå‘½å‘¨æœŸ 3ã€ZuulFilter1ã€è¿‡æ»¤ç±»å‹ preï¼šåœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡å‰æ‰§è¡Œï¼Œæ¯”å¦‚æƒé™æ ¡éªŒã€æ‰“å°æ—¥å¿—ç­‰åŠŸèƒ½ï¼› routingï¼šåœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡æ—¶æ‰§è¡Œ postï¼šåœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡åæ‰§è¡Œï¼Œæ¯”å¦‚ç»™ç›®æ ‡æœåŠ¡çš„å“åº”æ·»åŠ å¤´ä¿¡æ¯ï¼Œæ”¶é›†ç»Ÿè®¡æ•°æ®ç­‰åŠŸèƒ½ï¼› errorï¼šè¯·æ±‚åœ¨å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œã€‚ 2ã€è¿‡æ»¤é¡ºåºæ•°å­—å°çš„å…ˆæ‰§è¡Œ 3ã€è¿‡æ»¤æ˜¯å¦å¼€å¯shouldFilteræ–¹æ³•ä¸ºtrueèµ° 4ã€æ‰§è¡Œé€»è¾‘è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ 4ã€æ¡ˆä¾‹Case1ã€è¯´æ˜å‰ç½®è¿‡æ»¤å™¨ï¼Œç”¨äºåœ¨è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡å‰æ‰“å°è¯·æ±‚æ—¥å¿— 2ã€è‡ªå®šä¹‰è¿‡æ»¤å™¨è¿‡æ»¤å™¨ä»£ç ï¼š package com.kk.springcloud.filter; import com.netflix.zuul.ZuulFilter; import com.netflix.zuul.context.RequestContext; import com.netflix.zuul.exception.ZuulException; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Component; import javax.servlet.http.HttpServletRequest; import java.util.Date; @Component @Slf4j public class PreLogFilter extends ZuulFilter { /** * å®šä¹‰è¿‡æ»¤å™¨çš„ç±»å‹ * pre:åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰æ‰§è¡Œ * route:åœ¨è·¯ç”±è¯·æ±‚çš„æ—¶å€™æ‰§è¡Œ * post:è¯·æ±‚è·¯ç”±ä»¥åæ‰§è¡Œ * error:å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯çš„æ—¶å€™æ‰§è¡Œ * * @return è¿‡æ»¤å™¨çš„ç±»å‹ */ @Override public String filterType() { return \"pre\"; } /** * è¿‡æ»¤å™¨æ‰§è¡Œçš„é¡ºåºï¼Œé…ç½®å¤šä¸ªæœ‰é¡ºåºçš„è¿‡æ»¤ * æ‰§è¡Œé¡ºåºä»å°åˆ°å¤§ * * @return æ‰§è¡Œé¡ºåº */ @Override public int filterOrder() { // ä¼˜å…ˆçº§ä¸º0ï¼Œæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½ return 1; } /** * æ˜¯å¦å¼€å¯è¿‡æ»¤å™¨ * true:å¼€å¯ * false:ç¦ç”¨ * * @return æ˜¯å¦å¼€å¯è¿‡æ»¤å™¨ */ @Override public boolean shouldFilter() { // æ˜¯å¦å¼€å¯ return true; } /** * è¿‡æ»¤å™¨çš„ä¸šåŠ¡å®ç° * * @return null æ²¡æœ‰æ„ä¹‰ * @throws ZuulException å¼‚å¸¸ä¿¡æ¯ */ @Override public Object run() throws ZuulException { // ä¸šåŠ¡é€»è¾‘ä»£ç  RequestContext requestContext = RequestContext.getCurrentContext ( ); HttpServletRequest request = requestContext.getRequest ( ); String host = request.getRemoteHost ( ); String method = request.getMethod ( ); String uri = request.getRequestURI ( ); log.info(\"=====&gt; Remote host:{},method:{},uri:{}\", host, method, uri); System.out.println (\"********\" + new Date ( ).getTime ( )); return null; } } 3ã€æµ‹è¯•(1)urlï¼šhttp://myzuul.com:9527/mykk/mysms/sms (2)åœ¨è°ƒç”¨8008ä¹‹å‰ä¼šæ‰“å°æ—¥å¿— 4ã€yml é…ç½®å¼€å…³â˜…è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šå¼€å¯è¿™é‡Œä¹‹åï¼Œperé…ç½®å¤±æ•ˆï¼Œä¸æ¸…æ¥šä¸ºä»€ä¹ˆï¼Œåšä¸»æäº†å¾ˆä¹…å°è¯•æ‰å‘ç°æ˜¯è¿™ä¸ªé—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨ç¡¬ç¼–ç ï¼Œåœ¨javaä¸Šé…ç½®å¼€å…³zuul: prefix: /mykk # ignored-services: cloud-payment-service #å¿½ç•¥æœåŠ¡å routes: # è·¯ç”±æ˜ å°„é…ç½® mysms.path: /mysms/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mysms.serviceId: cloud-provider-sms # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° mypayment.path: /mypayment/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mypayment.serviceId: cloud-payment-service # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° #ymlé…ç½®å¼€å…³ # PreLogFilter: # pre: # disable: true å‚è€ƒæ–‡ç« é“¾æ¥1ã€é™åˆ¶IPè¿‡æ»¤åšæ–‡https://www.jianshu.com/p/20d77ca5cfbc","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"netflix","slug":"netflix","permalink":"https://mykkto.github.io/tags/netflix/"},{"name":"è·¯ç”±ç½‘å…³","slug":"è·¯ç”±ç½‘å…³","permalink":"https://mykkto.github.io/tags/%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3/"},{"name":"zuul","slug":"zuul","permalink":"https://mykkto.github.io/tags/zuul/"}],"author":"mykk"},{"title":"SpringCloud-Hystrixæ–­è·¯å™¨","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/07_SpringCloud_Hystrix","date":"2022-01-23T13:19:18.000Z","updated":"2023-06-11T02:53:45.174Z","comments":true,"path":"posts/b0ab6264.html","link":"","permalink":"https://mykkto.github.io/posts/b0ab6264.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜å¤æ‚åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸­çš„åº”ç”¨ç¨‹åºæœ‰æ•°åä¸ªä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªä¾èµ–å…³ç³»åœ¨æŸäº›æ—¶å€™å°†ä¸å¯é¿å…åœ°å¤±è´¥ã€‚ æœåŠ¡é›ªå´© å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡Aè°ƒç”¨å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cï¼Œå¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cåˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œæ‰‡å‡ºâ€ã€‚å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡Açš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œæ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€. å¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºéƒ½åœ¨å‡ ç§’é’Ÿå†…é¥±å’Œã€‚æ¯”å¤±è´¥æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™äº›åº”ç”¨ç¨‹åºè¿˜å¯èƒ½å¯¼è‡´æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿå¢åŠ ï¼Œå¤‡ä»½é˜Ÿåˆ—ï¼Œçº¿ç¨‹å’Œå…¶ä»–ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå‘ç”Ÿæ›´å¤šçš„çº§è”æ•…éšœã€‚è¿™äº›éƒ½è¡¨ç¤ºéœ€è¦å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚ æ‰€ä»¥ï¼Œé€šå¸¸å½“ä½ å‘ç°ä¸€ä¸ªæ¨¡å—ä¸‹çš„æŸä¸ªå®ä¾‹å¤±è´¥åï¼Œè¿™æ—¶å€™è¿™ä¸ªæ¨¡å—ä¾ç„¶è¿˜ä¼šæ¥æ”¶æµé‡ï¼Œç„¶åè¿™ä¸ªæœ‰é—®é¢˜çš„æ¨¡å—è¿˜è°ƒç”¨äº†å…¶ä»–çš„æ¨¡å—ï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿçº§è”æ•…éšœï¼Œæˆ–è€…å«é›ªå´©ã€‚ 2ã€æ˜¯ä»€ä¹ˆ Hystrixæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å»¶è¿Ÿå’Œå®¹é”™çš„å¼€æºåº“ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œè®¸å¤šä¾èµ–ä¸å¯é¿å…çš„ä¼šè°ƒç”¨å¤±è´¥ï¼Œæ¯”å¦‚è¶…æ—¶ã€å¼‚å¸¸ç­‰ï¼ŒHystrixèƒ½å¤Ÿä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥ï¼Œé¿å…çº§è”æ•…éšœï¼Œä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ã€‚ â€œæ–­è·¯å™¨â€æœ¬èº«æ˜¯ä¸€ç§å¼€å…³è£…ç½®ï¼Œå½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœä¹‹åï¼Œé€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§ï¼ˆç±»ä¼¼ç†”æ–­ä¿é™©ä¸ï¼‰ï¼Œå‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„ã€å¯å¤„ç†çš„å¤‡é€‰å“åº”ï¼ˆFallBackï¼‰ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…æˆ–è€…æŠ›å‡ºè°ƒç”¨æ–¹æ— æ³•å¤„ç†çš„å¼‚å¸¸ï¼Œè¿™æ ·å°±ä¿è¯äº†æœåŠ¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ä¸ä¼šè¢«é•¿æ—¶é—´ã€ä¸å¿…è¦åœ°å ç”¨ï¼Œä»è€Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è”“å»¶ï¼Œä¹ƒè‡³é›ªå´©ã€‚ 3ã€èƒ½å¹²å˜› æœåŠ¡é™çº§ æœåŠ¡ç†”æ–­ æ¥è¿‘å®æ—¶çš„ç›‘æ§ â€¦â€¦â€¦.. 4ã€å®˜ç½‘æ–‡æ¡£https://github.com/Netflix/Hystrix/wiki/How-To-Use 5ã€Hystrixåœæ›´https://github.com/Netflix/Hystrix è¢«åŠ¨ä¿®å¤bugs ä¸å†æ¥å—åˆå¹¶è¯·æ±‚ ä¸å†å‘å¸ƒæ–°ç‰ˆæœ¬ 2ã€Hystrixé‡è¦æ¦‚å¿µ1ã€æœåŠ¡é™çº§1ã€æ“ä½œæœåŠ¡å™¨å¿™ï¼Œè¯·ç¨åå†è¯•ï¼Œä¸è®©å®¢æˆ·ç«¯ç­‰å¾…å¹¶ç«‹åˆ»è¿”å›ä¸€ä¸ªå‹å¥½æç¤ºï¼Œfallback 2ã€å“ªäº›æƒ…å†µä¼šå‡ºå‘é™çº§ ç¨‹åºè¿è¡Œå¼‚å¸¸ è¶…æ—¶ æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§ çº¿ç¨‹æ± /ä¿¡å·é‡æ‰“æ»¡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§ 2ã€æœåŠ¡ç†”æ–­ç±»æ¯”ä¿é™©ä¸è¾¾åˆ°æœ€å¤§æœåŠ¡è®¿é—®åï¼Œç›´æ¥æ‹’ç»è®¿é—®ï¼Œæ‹‰é—¸é™ç”µï¼Œç„¶åè°ƒç”¨æœåŠ¡é™çº§çš„æ–¹æ³•å¹¶è¿”å›å‹å¥½æç¤º å°±æ˜¯ä¿é™©ä¸ï¼šæœåŠ¡çš„é™çº§-&gt;è¿›è€Œç†”æ–­-&gt;æ¢å¤è°ƒç”¨é“¾è·¯ 3ã€æœåŠ¡é™æµç§’æ€é«˜å¹¶å‘ç­‰æ“ä½œï¼Œä¸¥ç¦ä¸€çªèœ‚çš„è¿‡æ¥æ‹¥æŒ¤ï¼Œå¤§å®¶æ’é˜Ÿï¼Œä¸€ç§’é’ŸNä¸ªï¼Œæœ‰åºè¿›è¡Œ 3ã€hystrixæ¡ˆä¾‹1ã€æ„å»º1ã€å»ºmodelæ–°å»ºcloud-provider-hystrix-payment8001 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-provider-hystrix-payment8001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--hystrix--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--eureka client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--web--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt;&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 8001 spring: application: name: cloud-provider-hystrix-payment eureka: client: register-with-eureka: true fetch-registry: true service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka defaultZone: http://eureka7001.com:7001/eureka 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient //æœ¬æœåŠ¡å¯åŠ¨åä¼šè‡ªåŠ¨æ³¨å†Œè¿›eurekaæœåŠ¡ä¸­ public class PaymentHystrixMain8001 { public static void main(String[] args) { SpringApplication.run (PaymentHystrixMain8001.class,args); } } 5ã€ä¸šåŠ¡ç±»1ã€servicepackage com.kk.springcloud.service.imp; import com.kk.springcloud.service.PaymentHystrixServoce; import org.springframework.stereotype.Service; import java.util.concurrent.TimeUnit; @Service public class PaymentHystrixServoceImpl implements PaymentHystrixServoce { /** * æ­£å¸¸è®¿é—®ï¼Œä¸€åˆ‡OK * * @param id * @return */ public String paymentInfo_OK(Integer id) { return \"çº¿ç¨‹æ± :\" + Thread.currentThread ( ).getName ( ) + \"paymentInfo_OK,id: \" + id + \"\\t\" + \"O(âˆ©_âˆ©)O\"; } /** * è¶…æ—¶è®¿é—®ï¼Œæ¼”ç¤ºé™çº§ * * @param id * @return */ public String paymentInfo_TimeOut(Integer id) { try { TimeUnit.SECONDS.sleep (3); } catch (InterruptedException e) { e.printStackTrace ( ); } return \"çº¿ç¨‹æ± :\" + Thread.currentThread ( ).getName ( ) + \"paymentInfo_TimeOut,id: \" + id + \"\\t\" + \"O(âˆ©_âˆ©)Oï¼Œè€—è´¹3ç§’\"; } } 2ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.service.imp.PaymentHystrixServoceImpl; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; @RestController @Slf4j public class PaymentHystrixController { @Autowired private PaymentHystrixServoceImpl paymentService; @Value(\"${server.port}\") private String serverPort; @GetMapping(\"/payment/hystrix/ok/{id}\") public String paymentInfo_OK(@PathVariable(\"id\") Integer id) { String result = paymentService.paymentInfo_OK(id); log.info(\"****result: \"+result); return result; } @GetMapping(\"/payment/hystrix/timeout/{id}\") public String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id) throws InterruptedException { String result = paymentService.paymentInfo_TimeOut(id); log.info(\"****result: \"+result); return result; } } 6ã€æµ‹è¯•1ã€å¯åŠ¨é¡ºåºå…ˆå¯åŠ¨eurekaï¼Œå†å¯åŠ¨hystrix 8001 2ã€è®¿é—® successçš„æ–¹æ³•ï¼š http://localhost:8001/payment/hystrix/ok/1 æ¯æ¬¡è°ƒç”¨è€—è´¹3 ç§’é’Ÿ http://localhost:8001/payment/hystrix/timeout/1 2ã€é«˜å¹¶å‘æµ‹è¯•ä¸Šè¿°åœ¨éé«˜å¹¶å‘æƒ…å½¢ä¸‹ï¼Œè¿˜èƒ½å‹‰å¼ºæ»¡è¶³ 1ã€Jmeterå‹æµ‹æµ‹è¯•1ã€å¼€å¯Jmeterï¼Œæ¥20000ä¸ªå¹¶å‘å‹æ­»8001ï¼Œ20000ä¸ªè¯·æ±‚éƒ½å»è®¿é—®paymentInfo_TimeOutæœåŠ¡ 2ã€å†æ¥ä¸€ä¸ªè®¿é—®ä»3ç§’åˆ°ä¸æ­¢3ç§’ http://localhost:8001/payment/hystrix/timeout/1 ä»ç§’å›åˆ°å»¶è¿Ÿä¸€ç§’å¤š http://localhost:8001/payment/hystrix/ok/1 3ã€çœ‹æ¼”ç¤ºç»“æœä¸¤ä¸ªéƒ½åœ¨è‡ªå·±è½¬åœˆåœˆ ä¸ºä»€ä¹ˆä¼šè¢«å¡æ­»ï¼štomcatçš„é»˜è®¤çš„å·¥ä½œçº¿ç¨‹æ•°è¢«æ‰“æ»¡ äº†ï¼Œæ²¡æœ‰å¤šä½™çš„çº¿ç¨‹æ¥åˆ†è§£å‹åŠ›å’Œå¤„ç†ã€‚ 2ã€Jmeterå‹æµ‹ç»“è®ºä¸Šé¢è¿˜æ˜¯æœåŠ¡æä¾›è€…8001è‡ªå·±æµ‹è¯•ï¼Œå‡å¦‚æ­¤æ—¶å¤–éƒ¨çš„æ¶ˆè´¹è€…80ä¹Ÿæ¥è®¿é—®ï¼Œé‚£æ¶ˆè´¹è€…åªèƒ½å¹²ç­‰ï¼Œæœ€ç»ˆå¯¼è‡´æ¶ˆè´¹ç«¯80ä¸æ»¡æ„ï¼ŒæœåŠ¡ç«¯8001ç›´æ¥è¢«æ‹–æ­» 3ã€çœ‹çƒ­é—¹ä¸å«Œå¼ƒäº‹å¤§ï¼Œ80æ–°å»ºåŠ å…¥cloud-consumer-feign-hystrix-order80 1ã€POM&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumer-feign-hystrix-order80&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--hystrix--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--eureka client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--web--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬åŸºç¡€é€šç”¨é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 2ã€YMLserver: port: 80 eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ 3ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication @EnableFeignClients public class OrderHystrixMain80 { public static void main(String[] args) { SpringApplication.run (OrderHystrixMain80.class,args); } } 4ã€ä¸šåŠ¡ç±» service package com.kk.springcloud.service; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.stereotype.Component; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; @Component @FeignClient(value = \"CLOUD-PROVIDER-HYSTRIX-PAYMENT\") public interface PaymentHystrixService { @GetMapping(\"/payment/hystrix/ok/{id}\") String paymentInfo_OK(@PathVariable(\"id\") Integer id); @GetMapping(\"/payment/hystrix/timeout/{id}\") String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id); } controller package com.kk.springcloud.controller; import com.kk.springcloud.service.PaymentHystrixService; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController @Slf4j public class OrderHystirxController { @Resource private PaymentHystrixService paymentHystrixService; @GetMapping(\"/consumer/payment/hystrix/ok/{id}\") public String paymentInfo_OK(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_OK (id); return result; } @GetMapping(\"/consumer/payment/hystrix/timeout/{id}\") public String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_TimeOut (id); return result; } } 5ã€æµ‹è¯• éœ€è¦å¯åŠ¨çš„æœåŠ¡ url http://localhost/consumer/payment/hystrix/ok/1 6ã€é«˜å¹¶å‘æµ‹è¯• 2Wä¸ªçº¿ç¨‹å‹8001 æ¶ˆè´¹ç«¯80å¾®æœåŠ¡å†å»è®¿é—®æ­£å¸¸çš„Okå¾®æœåŠ¡8001åœ°å€ï¼Œhttp://localhost/consumer/payment/hystrix/ok/1 æ¶ˆè´¹è€…80ï¼Œo(â•¥ï¹â•¥)o è¦ä¹ˆè½¬åœˆåœˆç­‰å¾…ï¼ˆ2Wä¸ªå¹¶å‘ï¼‰ è¦ä¹ˆæ¶ˆè´¹ç«¯æŠ¥è¶…æ—¶é”™è¯¯ï¼ˆ20Wä¸ªå¹¶å‘ï¼Œå†²å®ï¼‰ 3ã€æ•…éšœç°è±¡å’Œå¯¼è‡´åŸå›  8001åŒä¸€å±‚æ¬¡çš„å…¶å®ƒæ¥å£æœåŠ¡è¢«å›°æ­»ï¼Œå› ä¸ºtomcatçº¿ç¨‹æ± é‡Œé¢çš„å·¥ä½œçº¿ç¨‹å·²ç»è¢«æŒ¤å å®Œæ¯• 80æ­¤æ—¶è°ƒç”¨8001ï¼Œå®¢æˆ·ç«¯è®¿é—®å“åº”ç¼“æ…¢ï¼Œè½¬åœˆåœˆ 4ã€ä¸Šè¯‰ç»“è®ºæ­£å› ä¸ºæœ‰ä¸Šè¿°æ•…éšœæˆ–ä¸ä½³è¡¨ç°ï¼Œæ‰æœ‰æˆ‘ä»¬çš„é™çº§/å®¹é”™/é™æµç­‰æŠ€æœ¯è¯ç”Ÿ 5ã€å¦‚ä½•è§£å†³ï¼Ÿè§£å†³çš„è¦æ±‚1ã€è¶…æ—¶å¯¼è‡´æœåŠ¡å™¨å˜æ…¢(è½¬åœˆ)è¶…æ—¶ä¸å†ç­‰å¾… 2ã€å‡ºé”™(å®•æœºæˆ–ç¨‹åºè¿è¡Œå‡ºé”™)å‡ºé”™è¦æœ‰å…œåº•ï¼ˆé™çº§ï¼‰ 3ã€è§£å†³ å¯¹æ–¹æœåŠ¡(8001)è¶…æ—¶äº†ï¼Œè°ƒç”¨è€…(80)ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§ å¯¹æ–¹æœåŠ¡(8001)downæœºäº†ï¼Œè°ƒç”¨è€…(80)ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§ å¯¹æ–¹æœåŠ¡(8001)OKï¼Œè°ƒç”¨è€…(80)è‡ªå·±å‡ºæ•…éšœæˆ–æœ‰è‡ªæˆ‘è¦æ±‚ï¼ˆè‡ªå·±çš„ç­‰å¾…æ—¶é—´å°äºæœåŠ¡æä¾›è€…ï¼‰ï¼Œè‡ªå·±å¤„ç†é™çº§ 3-1å®æˆ˜ï¼šæœåŠ¡é™çº§1ã€é™çº§é…ç½®æ³¨è§£@HystrixCommand 2ã€8001å…ˆä»è‡ªèº«æ‰¾é—®é¢˜è®¾ç½®è‡ªèº«è°ƒç”¨è¶…æ—¶æ—¶é—´çš„å³°å€¼ï¼Œå³°å€¼å†…å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè¶…è¿‡äº†éœ€è¦æœ‰å…œåº•çš„æ–¹æ³•å¤„ç†ï¼Œä½œæœåŠ¡é™çº§fallbackã€‚ 3ã€8001fallback1ã€ä¸šåŠ¡ç±»å¯ç”¨1ã€ä»£ç 8001ï¼ˆ8002ï¼‰PaymentServiceImpl @HystrixCommand(fallbackMethod = \"paymentInfo_TimeOutHandler\", commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"3000\") }) ----------------------- public String paymentInfo_TimeOutHandler(Integer id) { return \"/(ã„’oã„’)/è°ƒç”¨æ”¯ä»˜æ¥å£è¶…æ—¶æˆ–å¼‚å¸¸ï¼š\\t\" + \"\\tå½“å‰çº¿ç¨‹æ± åå­—\" + Thread.currentThread ( ).getName ( ); } package com.kk.springcloud.service.imp; import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand; import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty; import org.springframework.stereotype.Service; import java.util.concurrent.TimeUnit; @Service public class PaymentHystrixServoceImpl { /** * æ­£å¸¸è®¿é—®ï¼Œä¸€åˆ‡OK * * @param id * @return */ public String paymentInfo_OK(Integer id) { return \"çº¿ç¨‹æ± :\" + Thread.currentThread ( ).getName ( ) + \"paymentInfo_OK,id: \" + id + \"\\t\" + \"O(âˆ©_âˆ©)O\"; } /** * è¶…æ—¶è®¿é—®ï¼Œæ¼”ç¤ºé™çº§ * * @param id * @return */ @HystrixCommand(fallbackMethod = \"paymentInfo_TimeOutHandler\", commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"3000\") }) public String paymentInfo_TimeOut(Integer id) { int age = 10/0; try { TimeUnit.SECONDS.sleep (3); } catch (InterruptedException e) { e.printStackTrace ( ); } return \"çº¿ç¨‹æ± :\" + Thread.currentThread ( ).getName ( ) + \"paymentInfo_TimeOut,id: \" + id + \"\\t\" + \"O(âˆ©_âˆ©)Oï¼Œè€—è´¹3ç§’\"; } public String paymentInfo_TimeOutHandler(Integer id) { return \"/(ã„’oã„’)/è°ƒç”¨æ”¯ä»˜æ¥å£è¶…æ—¶æˆ–å¼‚å¸¸ï¼š\\t\" + \"\\tå½“å‰çº¿ç¨‹æ± åå­—\" + Thread.currentThread ( ).getName ( ); } } 2ã€@HystrixCommandæŠ¥å¼‚å¸¸åå¦‚ä½•å¤„ç†ä¸€æ—¦è°ƒç”¨æœåŠ¡æ–¹æ³•å¤±è´¥å¹¶æŠ›å‡ºäº†é”™è¯¯ä¿¡æ¯åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨@HystrixCommandæ ‡æ³¨å¥½çš„ fallbackMethodè°ƒç”¨ç±»ä¸­çš„æŒ‡å®šæ–¹æ³• 2ã€ä¸»å¯åŠ¨ç±»æ¿€æ´»æ·»åŠ æ–°æ³¨è§£@EnableCircuitBreaker 3ã€åˆ¶é€ é—®é¢˜ï¼šæµ‹è¯•é™çº§æ•ˆæœ ä¸Šå›¾æ•…æ„åˆ¶é€ ä¸¤ä¸ªå¼‚å¸¸ï¼š 1 int age = 10/0; è®¡ç®—å¼‚å¸¸ 2 æˆ‘ä»¬èƒ½æ¥å—3ç§’é’Ÿï¼Œå®ƒè¿è¡Œ5ç§’é’Ÿï¼Œè¶…æ—¶å¼‚å¸¸ã€‚ å½“å‰æœåŠ¡ä¸å¯ç”¨äº†ï¼ŒåšæœåŠ¡é™çº§ï¼Œå…œåº•çš„æ–¹æ¡ˆéƒ½æ˜¯ paymentInfo_TimeOutHandler æ— è®ºæ˜¯å»¶è¿ŸæŒ‡å®šæ—¶é—´è¿˜æ˜¯å¼‚å¸¸ï¼Œéƒ½ä¼šåˆ°å¯¹åº”æ–¹æ³•é™çº§ 4ã€80fallback1ã€è¯´æ˜80è®¢å•å¾®æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ›´å¥½çš„ä¿æŠ¤è‡ªå·±ï¼Œè‡ªå·±ä¹Ÿä¾æ ·ç”»è‘«èŠ¦è¿›è¡Œå®¢æˆ·ç«¯é™çº§ä¿æŠ¤ 2ã€æ³¨æ„ç‚¹æˆ‘ä»¬è‡ªå·±é…ç½®è¿‡çš„çƒ­éƒ¨ç½²æ–¹å¼å¯¹javaä»£ç çš„æ”¹åŠ¨æ˜æ˜¾ï¼Œä½†å¯¹@HystrixCommandå†…å±æ€§çš„ä¿®æ”¹å»ºè®®é‡å¯å¾®æœåŠ¡ 3ã€ymlfeign: hystrix: enabled: true server: port: 80 eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ feign: hystrix: enabled: true 4ã€ä¸»å¯åŠ¨@EnableHystrix package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.hystrix.EnableHystrix; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication @EnableFeignClients @EnableHystrix public class OrderHystrixMain80 { public static void main(String[] args) { SpringApplication.run (OrderHystrixMain80.class,args); } } 5ã€ä¸šåŠ¡ç±» @HystrixCommand(fallbackMethod = \"paymentTimeOutFallbackMethod\", commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"1500\") }) ------------------ public String paymentTimeOutFallbackMethod(@PathVariable(\"id\") Integer id) { return \"æˆ‘æ˜¯æ¶ˆè´¹è€…80,å¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,o(â•¥ï¹â•¥)o\"; } package com.kk.springcloud.controller; import com.kk.springcloud.service.PaymentHystrixService; import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand; import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController @Slf4j public class OrderHystirxController { @Resource private PaymentHystrixService paymentHystrixService; @GetMapping(\"/consumer/payment/hystrix/ok/{id}\") @HystrixCommand(fallbackMethod = \"paymentTimeOutFallbackMethod\", commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"1500\") }) public String paymentInfo_OK(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_OK (id); return result; } public String paymentTimeOutFallbackMethod(@PathVariable(\"id\") Integer id) { return \"æˆ‘æ˜¯æ¶ˆè´¹è€…80,å¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,o(â•¥ï¹â•¥)o\"; } @GetMapping(\"/consumer/payment/hystrix/timeout/{id}\") public String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_TimeOut (id); return result; } } 6ã€æµ‹è¯•urlï¼šhttp://localhost//consumer/payment/hystrix/ok/1 5ã€ç›®å‰é—®é¢˜ æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯¹åº”ä¸€ä¸ªå…œåº•çš„æ–¹æ³•ï¼Œä»£ç è†¨èƒ€ ç»Ÿä¸€å’Œè‡ªå®šä¹‰çš„åˆ†å¼€ 6ã€é—®é¢˜è§£å†³1ã€æ¯ä¸ªæ–¹æ³•é…ç½®ä¸€ä¸ªï¼Ÿï¼Ÿï¼Ÿè†¨èƒ€ï¼ˆfeignæ¥å£ç³»åˆ—ï¼‰@DefaultProperties(defaultFallback = \"\") æ¯ä¸ªæ–¹æ³•é…ç½®ä¸€ä¸ªæœåŠ¡é™çº§æ–¹æ³•ï¼ŒæŠ€æœ¯ä¸Šå¯ä»¥ï¼Œå®é™…ä¸Šå‚»X é™¤äº†ä¸ªåˆ«é‡è¦æ ¸å¿ƒä¸šåŠ¡æœ‰ä¸“å±ï¼Œå…¶å®ƒæ™®é€šçš„å¯ä»¥é€šè¿‡@DefaultProperties(defaultFallback = â€œâ€) ç»Ÿä¸€è·³è½¬åˆ°ç»Ÿä¸€å¤„ç†ç»“æœé¡µé¢ é€šç”¨çš„å’Œç‹¬äº«çš„å„è‡ªåˆ†å¼€ï¼Œé¿å…äº†ä»£ç è†¨èƒ€ï¼Œåˆç†å‡å°‘äº†ä»£ç é‡ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~ ----------------- @DefaultProperties(defaultFallback = \"payment_Global_FallbackMethod\") ----------------- @HystrixCommand //åŠ äº†@DefaultPropertieså±æ€§æ³¨è§£ï¼Œå¹¶ä¸”æ²¡æœ‰å†™å…·ä½“æ–¹æ³•åå­—ï¼Œå°±ç”¨ç»Ÿä¸€å…¨å±€çš„ ----------------- public String payment_Global_FallbackMethod() { return \"Globalå¼‚å¸¸å¤„ç†ä¿¡æ¯ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~\"; } package com.kk.springcloud.controller; import com.kk.springcloud.service.PaymentHystrixService; import com.netflix.hystrix.contrib.javanica.annotation.DefaultProperties; import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand; import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController @Slf4j @DefaultProperties(defaultFallback = \"payment_Global_FallbackMethod\") public class OrderHystirxController { @Resource private PaymentHystrixService paymentHystrixService; @GetMapping(\"/consumer/payment/hystrix/ok/{id}\") @HystrixCommand(fallbackMethod = \"paymentTimeOutFallbackMethod\", commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"1500\") }) public String paymentInfo_OK(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_OK (id); return result; } public String paymentTimeOutFallbackMethod(@PathVariable(\"id\") Integer id) { return \"æˆ‘æ˜¯æ¶ˆè´¹è€…80,å¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,o(â•¥ï¹â•¥)o\"; } @GetMapping(\"/consumer/payment/hystrix/timeout/{id}\") @HystrixCommand //åŠ äº†@DefaultPropertieså±æ€§æ³¨è§£ï¼Œå¹¶ä¸”æ²¡æœ‰å†™å…·ä½“æ–¹æ³•åå­—ï¼Œå°±ç”¨ç»Ÿä¸€å…¨å±€çš„ public String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_TimeOut (id); return result; } public String payment_Global_FallbackMethod() { return \"Globalå¼‚å¸¸å¤„ç†ä¿¡æ¯ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~\"; } } 2ã€å’Œä¸šåŠ¡é€»è¾‘æ··ä¸€èµ·ï¼Ÿï¼Ÿï¼Ÿæ··ä¹±åŸå› ï¼šæœåŠ¡é™çº§ï¼Œå®¢æˆ·ç«¯å»è°ƒç”¨æœåŠ¡ç«¯ï¼Œç¢°ä¸ŠæœåŠ¡ç«¯å®•æœºæˆ–å…³é—­ æœ¬æ¬¡æ¡ˆä¾‹æœåŠ¡é™çº§å¤„ç†æ˜¯åœ¨å®¢æˆ·ç«¯80å®ç°å®Œæˆçš„ï¼Œä¸æœåŠ¡ç«¯8001æ²¡æœ‰å…³ç³»åªéœ€è¦ä¸ºFeignå®¢æˆ·ç«¯å®šä¹‰çš„æ¥å£æ·»åŠ ä¸€ä¸ªæœåŠ¡é™çº§å¤„ç†çš„å®ç°ç±»å³å¯å®ç°è§£è€¦ æœªæ¥æˆ‘ä»¬è¦é¢å¯¹çš„å¼‚å¸¸ è¿è¡Œ è¶…æ—¶ å®•æœº æ ¹æ®cloud-consumer-feign-hystrix-order80å·²ç»æœ‰çš„PaymentHystrixServiceæ¥å£ï¼Œé‡æ–°æ–°å»ºä¸€ä¸ªç±»(PaymentFallbackService)å®ç°è¯¥æ¥å£ï¼Œç»Ÿä¸€ä¸ºæ¥å£é‡Œé¢çš„æ–¹æ³•è¿›è¡Œå¼‚å¸¸å¤„ç† serviceç»Ÿä¸€å¤„ç†å¼‚å¸¸ä¸šåŠ¡ package com.kk.springcloud.service.impl; import com.kk.springcloud.service.PaymentHystrixService; import org.springframework.stereotype.Component; @Component public class PaymentFallbackService implements PaymentHystrixService { // å¦‚æœä¸‹æ¸¸çš„æœåŠ¡æ¥å£æŒ‚æ‰ï¼Œåˆ™è¿›å…¥è¿™ä¸ªå®ç°ç±» @Override public String paymentInfo_OK(Integer id) { return \"æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œæç¤ºæ¥è‡ªï¼šcloud-consumer-feign-order80\"; } @Override public String paymentInfo_TimeOut(Integer id) { return \"æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œæç¤ºæ¥è‡ªï¼šcloud-consumer-feign-order80\"; } } yml # ç”¨äºæœåŠ¡é™çº§ åœ¨æ³¨è§£@FeignClientä¸­æ·»åŠ fallbackFactoryå±æ€§å€¼ feign: hystrix: enabled: true #åœ¨Feignä¸­å¼€å¯Hystrix openFeignï¼šè°ƒç”¨ä¸‹æ¸¸çš„æ¥å£ fallback = PaymentFallbackService.class package com.kk.springcloud.service; import com.kk.springcloud.service.impl.PaymentFallbackService; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.stereotype.Component; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; @Component @FeignClient(value = \"CLOUD-PROVIDER-HYSTRIX-PAYMENT\",fallback = PaymentFallbackService.class) public interface PaymentHystrixService { @GetMapping(\"/payment/hystrix/ok/{id}\") String paymentInfo_OK(@PathVariable(\"id\") Integer id); @GetMapping(\"/payment/hystrix/timeout/{id}\") String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id); } æµ‹è¯•ï¼šhttp://localhost/consumer/payment/hystrix/ok/1 æ­£å¸¸è®¿é—®ï¼š æ•…æ„å…³é—­å¾®æœåŠ¡8001åè®¿é—®ï¼š 3-2å®æˆ˜ï¼šæœåŠ¡ç†”æ–­1ã€æ–­è·¯å™¨ä¸€å¥è¯å°±æ˜¯å®¶é‡Œçš„ä¿é™©ä¸ 2ã€ç†”æ–­æ˜¯ä»€ä¹ˆç†”æ–­æœºåˆ¶æ¦‚è¿°ï¼šç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚å½“æ‰‡å‡ºé“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡å‡ºé”™ä¸å¯ç”¨æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡ŒæœåŠ¡çš„é™çº§ï¼Œè¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯ã€‚å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸åï¼Œæ¢å¤è°ƒç”¨é“¾è·¯ã€‚ åœ¨Spring Cloudæ¡†æ¶é‡Œï¼Œç†”æ–­æœºåˆ¶é€šè¿‡Hystrixå®ç°ã€‚Hystrixä¼šç›‘æ§å¾®æœåŠ¡é—´è°ƒç”¨çš„çŠ¶å†µï¼Œå½“å¤±è´¥çš„è°ƒç”¨åˆ°ä¸€å®šé˜ˆå€¼ï¼Œç¼ºçœæ˜¯5ç§’å†…20æ¬¡è°ƒç”¨å¤±è´¥ï¼Œå°±ä¼šå¯åŠ¨ç†”æ–­æœºåˆ¶ã€‚ç†”æ–­æœºåˆ¶çš„æ³¨è§£æ˜¯@HystrixCommandã€‚ 3ã€å®æ“ä¿®æ”¹cloud-provider-hystrix-payment8001 1ã€PaymentService//æœåŠ¡ç†”æ–­ @HystrixCommand(fallbackMethod = \"paymentCircuitBreaker_fallback\", commandProperties = { @HystrixProperty(name = \"circuitBreaker.enabled\", value = \"true\"),//æ˜¯å¦å¼€å¯æ–­è·¯å™¨ @HystrixProperty(name = \"circuitBreaker.requestVolumeThreshold\", value = \"10\"),//è¯·æ±‚æ¬¡æ•° @HystrixProperty(name = \"circuitBreaker.sleepWindowInMilliseconds\", value = \"10000\"),//æ—¶é—´èŒƒå›´ @HystrixProperty(name = \"circuitBreaker.errorThresholdPercentage\", value = \"60\"),//å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åè·³é—¸ }) public String paymentCircuitBreaker(@PathVariable(\"id\") Integer id) { if (id &lt; 0) { throw new RuntimeException (\"******id ä¸èƒ½è´Ÿæ•°\"); } String serialNumber = IdUtil.simpleUUID ( ); return Thread.currentThread ( ).getName ( ) + \"\\t\" + \"è°ƒç”¨æˆåŠŸï¼Œæµæ°´å·: \" + serialNumber; } public String paymentCircuitBreaker_fallback(@PathVariable(\"id\") Integer id) { return \"id ä¸èƒ½è´Ÿæ•°ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~ id: \" + id; } 2ã€PaymentController@GetMapping(\"/payment/circuit/{id}\") public String paymentCircuitBreaker(@PathVariable(\"id\") Integer id) { String result = paymentService.paymentCircuitBreaker (id); log.info (\"****result: \" + result); return result; } 4ã€æµ‹è¯•æ­£ç¡®ï¼šhttp://localhost:8001/payment/circuit/1 é”™è¯¯ï¼šhttp://localhost:8001/payment/circuit/-1 5ã€åŸç†(å°æ€»ç»“)1ã€ç†”æ–­ç±»å‹ ç†”æ–­æ‰“å¼€ è¯·æ±‚ä¸å†è¿›è¡Œè°ƒç”¨å½“å‰æœåŠ¡ï¼Œå†…éƒ¨è®¾ç½®æ—¶é’Ÿä¸€èˆ¬ä¸ºMTTRï¼ˆå¹³å‡æ•…éšœå¤„ç†æ—¶é—´)ï¼Œå½“æ‰“å¼€æ—¶é•¿è¾¾åˆ°æ‰€è®¾æ—¶é’Ÿåˆ™è¿›å…¥åŠç†”æ–­çŠ¶æ€ ç†”æ–­å…³é—­ ç†”æ–­å…³é—­ä¸ä¼šå¯¹æœåŠ¡è¿›è¡Œç†”æ–­ ç†”æ–­åŠå¼€ éƒ¨åˆ†è¯·æ±‚æ ¹æ®è§„åˆ™è°ƒç”¨å½“å‰æœåŠ¡ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸä¸”ç¬¦åˆè§„åˆ™åˆ™è®¤ä¸ºå½“å‰æœåŠ¡æ¢å¤æ­£å¸¸ï¼Œå…³é—­ç†”æ–­ 2ã€å®˜ç½‘æ–­è·¯å™¨æµç¨‹å›¾1ã€æ–­è·¯å™¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¼€å§‹èµ·ä½œç”¨æ¶‰åŠåˆ°æ–­è·¯å™¨çš„ä¸‰ä¸ªé‡è¦å‚æ•°ï¼šå¿«ç…§æ—¶é—´çª—ã€è¯·æ±‚æ€»æ•°é˜€å€¼ã€é”™è¯¯ç™¾åˆ†æ¯”é˜€å€¼ã€‚1ï¼šå¿«ç…§æ—¶é—´çª—ï¼šæ–­è·¯å™¨ç¡®å®šæ˜¯å¦æ‰“å¼€éœ€è¦ç»Ÿè®¡ä¸€äº›è¯·æ±‚å’Œé”™è¯¯æ•°æ®ï¼Œè€Œç»Ÿè®¡çš„æ—¶é—´èŒƒå›´å°±æ˜¯å¿«ç…§æ—¶é—´çª—ï¼Œé»˜è®¤ä¸ºæœ€è¿‘çš„10ç§’ã€‚ 2ï¼šè¯·æ±‚æ€»æ•°é˜€å€¼ï¼šåœ¨å¿«ç…§æ—¶é—´çª—å†…ï¼Œå¿…é¡»æ»¡è¶³è¯·æ±‚æ€»æ•°é˜€å€¼æ‰æœ‰èµ„æ ¼ç†”æ–­ã€‚é»˜è®¤ä¸º20ï¼Œæ„å‘³ç€åœ¨10ç§’å†…ï¼Œå¦‚æœè¯¥hystrixå‘½ä»¤çš„è°ƒç”¨æ¬¡æ•°ä¸è¶³20æ¬¡ï¼Œå³ä½¿æ‰€æœ‰çš„è¯·æ±‚éƒ½è¶…æ—¶æˆ–å…¶ä»–åŸå› å¤±è´¥ï¼Œæ–­è·¯å™¨éƒ½ä¸ä¼šæ‰“å¼€ã€‚ 3ï¼šé”™è¯¯ç™¾åˆ†æ¯”é˜€å€¼ï¼šå½“è¯·æ±‚æ€»æ•°åœ¨å¿«ç…§æ—¶é—´çª—å†…è¶…è¿‡äº†é˜€å€¼ï¼Œæ¯”å¦‚å‘ç”Ÿäº†30æ¬¡è°ƒç”¨ï¼Œå¦‚æœåœ¨è¿™30æ¬¡è°ƒç”¨ä¸­ï¼Œæœ‰15æ¬¡å‘ç”Ÿäº†è¶…æ—¶å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¶…è¿‡50%çš„é”™è¯¯ç™¾åˆ†æ¯”ï¼Œåœ¨é»˜è®¤è®¾å®š50%é˜€å€¼æƒ…å†µä¸‹ï¼Œè¿™æ—¶å€™å°±ä¼šå°†æ–­è·¯å™¨æ‰“å¼€ 2ã€æ–­è·¯å™¨å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶ å½“æ»¡è¶³ä¸€å®šçš„é˜€å€¼çš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡20ä¸ªè¯·æ±‚æ¬¡æ•°ï¼‰ å½“å¤±è´¥ç‡è¾¾åˆ°ä¸€å®šçš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡50%çš„è¯·æ±‚å¤±è´¥ï¼‰ åˆ°è¾¾ä»¥ä¸Šé˜€å€¼ï¼Œæ–­è·¯å™¨å°†ä¼šå¼€å¯ å½“å¼€å¯çš„æ—¶å€™ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¸ä¼šè¿›è¡Œè½¬å‘ ä¸€æ®µæ—¶é—´ä¹‹åï¼ˆé»˜è®¤æ˜¯5ç§’ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æ–­è·¯å™¨æ˜¯åŠå¼€çŠ¶æ€ï¼Œä¼šè®©å…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¿›è¡Œè½¬å‘ã€‚å¦‚æœæˆåŠŸï¼Œæ–­è·¯å™¨ä¼šå…³é—­ï¼Œè‹¥å¤±è´¥ï¼Œç»§ç»­å¼€å¯ã€‚é‡å¤4å’Œ5 3ã€æ–­è·¯å™¨æ‰“å¼€ä¹‹å1ï¼šå†æœ‰è¯·æ±‚è°ƒç”¨çš„æ—¶å€™ï¼Œå°†ä¸ä¼šè°ƒç”¨ä¸»é€»è¾‘ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨é™çº§fallbackã€‚é€šè¿‡æ–­è·¯å™¨ï¼Œå®ç°äº†è‡ªåŠ¨åœ°å‘ç°é”™è¯¯å¹¶å°†é™çº§é€»è¾‘åˆ‡æ¢ä¸ºä¸»é€»è¾‘ï¼Œå‡å°‘å“åº”å»¶è¿Ÿçš„æ•ˆæœã€‚ 2ï¼šåŸæ¥çš„ä¸»é€»è¾‘è¦å¦‚ä½•æ¢å¤å‘¢ï¼Ÿå¯¹äºè¿™ä¸€é—®é¢˜ï¼Œhystrixä¹Ÿä¸ºæˆ‘ä»¬å®ç°äº†è‡ªåŠ¨æ¢å¤åŠŸèƒ½ã€‚å½“æ–­è·¯å™¨æ‰“å¼€ï¼Œå¯¹ä¸»é€»è¾‘è¿›è¡Œç†”æ–­ä¹‹åï¼Œhystrixä¼šå¯åŠ¨ä¸€ä¸ªä¼‘çœ æ—¶é—´çª—ï¼Œåœ¨è¿™ä¸ªæ—¶é—´çª—å†…ï¼Œé™çº§é€»è¾‘æ˜¯ä¸´æ—¶çš„æˆä¸ºä¸»é€»è¾‘ï¼Œå½“ä¼‘çœ æ—¶é—´çª—åˆ°æœŸï¼Œæ–­è·¯å™¨å°†è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œé‡Šæ”¾ä¸€æ¬¡è¯·æ±‚åˆ°åŸæ¥çš„ä¸»é€»è¾‘ä¸Šï¼Œå¦‚æœæ­¤æ¬¡è¯·æ±‚æ­£å¸¸è¿”å›ï¼Œé‚£ä¹ˆæ–­è·¯å™¨å°†ç»§ç»­é—­åˆï¼Œä¸»é€»è¾‘æ¢å¤ï¼Œå¦‚æœè¿™æ¬¡è¯·æ±‚ä¾ç„¶æœ‰é—®é¢˜ï¼Œæ–­è·¯å™¨ç»§ç»­è¿›å…¥æ‰“å¼€çŠ¶æ€ï¼Œä¼‘çœ æ—¶é—´çª—é‡æ–°è®¡æ—¶ã€‚ 4ã€â˜… Allé…ç½®//========================All @HystrixCommand(fallbackMethod = \"str_fallbackMethod\", groupKey = \"strGroupCommand\", commandKey = \"strCommand\", threadPoolKey = \"strThreadPool\", commandProperties = { // è®¾ç½®éš”ç¦»ç­–ç•¥ï¼ŒTHREAD è¡¨ç¤ºçº¿ç¨‹æ±  SEMAPHOREï¼šä¿¡å·æ± éš”ç¦» @HystrixProperty(name = \"execution.isolation.strategy\", value = \"THREAD\"), // å½“éš”ç¦»ç­–ç•¥é€‰æ‹©ä¿¡å·æ± éš”ç¦»çš„æ—¶å€™ï¼Œç”¨æ¥è®¾ç½®ä¿¡å·æ± çš„å¤§å°ï¼ˆæœ€å¤§å¹¶å‘æ•°ï¼‰ @HystrixProperty(name = \"execution.isolation.semaphore.maxConcurrentRequests\", value = \"10\"), // é…ç½®å‘½ä»¤æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´ @HystrixProperty(name = \"execution.isolation.thread.timeoutinMilliseconds\", value = \"10\"), // æ˜¯å¦å¯ç”¨è¶…æ—¶æ—¶é—´ @HystrixProperty(name = \"execution.timeout.enabled\", value = \"true\"), // æ‰§è¡Œè¶…æ—¶çš„æ—¶å€™æ˜¯å¦ä¸­æ–­ @HystrixProperty(name = \"execution.isolation.thread.interruptOnTimeout\", value = \"true\"), // æ‰§è¡Œè¢«å–æ¶ˆçš„æ—¶å€™æ˜¯å¦ä¸­æ–­ @HystrixProperty(name = \"execution.isolation.thread.interruptOnCancel\", value = \"true\"), // å…è®¸å›è°ƒæ–¹æ³•æ‰§è¡Œçš„æœ€å¤§å¹¶å‘æ•° @HystrixProperty(name = \"fallback.isolation.semaphore.maxConcurrentRequests\", value = \"10\"), // æœåŠ¡é™çº§æ˜¯å¦å¯ç”¨ï¼Œæ˜¯å¦æ‰§è¡Œå›è°ƒå‡½æ•° @HystrixProperty(name = \"fallback.enabled\", value = \"true\"), // æ˜¯å¦å¯ç”¨æ–­è·¯å™¨ @HystrixProperty(name = \"circuitBreaker.enabled\", value = \"true\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œæ–­è·¯å™¨ç†”æ–­çš„æœ€å°è¯·æ±‚æ•°ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤è¯¥å€¼ä¸º 20 çš„æ—¶å€™ï¼Œ // å¦‚æœæ»šåŠ¨æ—¶é—´çª—ï¼ˆé»˜è®¤10ç§’ï¼‰å†…ä»…æ”¶åˆ°äº†19ä¸ªè¯·æ±‚ï¼Œ å³ä½¿è¿™19ä¸ªè¯·æ±‚éƒ½å¤±è´¥äº†ï¼Œæ–­è·¯å™¨ä¹Ÿä¸ä¼šæ‰“å¼€ã€‚ @HystrixProperty(name = \"circuitBreaker.requestVolumeThreshold\", value = \"20\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œè¡¨ç¤ºåœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œåœ¨è¯·æ±‚æ•°é‡è¶…è¿‡ // circuitBreaker.requestVolumeThreshold çš„æƒ…å†µä¸‹ï¼Œå¦‚æœé”™è¯¯è¯·æ±‚æ•°çš„ç™¾åˆ†æ¯”è¶…è¿‡50, // å°±æŠŠæ–­è·¯å™¨è®¾ç½®ä¸º \"æ‰“å¼€\" çŠ¶æ€ï¼Œå¦åˆ™å°±è®¾ç½®ä¸º \"å…³é—­\" çŠ¶æ€ã€‚ @HystrixProperty(name = \"circuitBreaker.errorThresholdPercentage\", value = \"50\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®å½“æ–­è·¯å™¨æ‰“å¼€ä¹‹åçš„ä¼‘çœ æ—¶é—´çª—ã€‚ ä¼‘çœ æ—¶é—´çª—ç»“æŸä¹‹åï¼Œ // ä¼šå°†æ–­è·¯å™¨ç½®ä¸º \"åŠå¼€\" çŠ¶æ€ï¼Œå°è¯•ç†”æ–­çš„è¯·æ±‚å‘½ä»¤ï¼Œå¦‚æœä¾ç„¶å¤±è´¥å°±å°†æ–­è·¯å™¨ç»§ç»­è®¾ç½®ä¸º \"æ‰“å¼€\" çŠ¶æ€ï¼Œ // å¦‚æœæˆåŠŸå°±è®¾ç½®ä¸º \"å…³é—­\" çŠ¶æ€ã€‚ @HystrixProperty(name = \"circuitBreaker.sleepWindowinMilliseconds\", value = \"5000\"), // æ–­è·¯å™¨å¼ºåˆ¶æ‰“å¼€ @HystrixProperty(name = \"circuitBreaker.forceOpen\", value = \"false\"), // æ–­è·¯å™¨å¼ºåˆ¶å…³é—­ @HystrixProperty(name = \"circuitBreaker.forceClosed\", value = \"false\"), // æ»šåŠ¨æ—¶é—´çª—è®¾ç½®ï¼Œè¯¥æ—¶é—´ç”¨äºæ–­è·¯å™¨åˆ¤æ–­å¥åº·åº¦æ—¶éœ€è¦æ”¶é›†ä¿¡æ¯çš„æŒç»­æ—¶é—´ @HystrixProperty(name = \"metrics.rollingStats.timeinMilliseconds\", value = \"10000\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®æ»šåŠ¨æ—¶é—´çª—ç»Ÿè®¡æŒ‡æ ‡ä¿¡æ¯æ—¶åˆ’åˆ†\"æ¡¶\"çš„æ•°é‡ï¼Œæ–­è·¯å™¨åœ¨æ”¶é›†æŒ‡æ ‡ä¿¡æ¯çš„æ—¶å€™ä¼šæ ¹æ® // è®¾ç½®çš„æ—¶é—´çª—é•¿åº¦æ‹†åˆ†æˆå¤šä¸ª \"æ¡¶\" æ¥ç´¯è®¡å„åº¦é‡å€¼ï¼Œæ¯ä¸ª\"æ¡¶\"è®°å½•äº†ä¸€æ®µæ—¶é—´å†…çš„é‡‡é›†æŒ‡æ ‡ã€‚ // æ¯”å¦‚ 10 ç§’å†…æ‹†åˆ†æˆ 10 ä¸ª\"æ¡¶\"æ”¶é›†è¿™æ ·ï¼Œæ‰€ä»¥ timeinMilliseconds å¿…é¡»èƒ½è¢« numBuckets æ•´é™¤ã€‚å¦åˆ™ä¼šæŠ›å¼‚å¸¸ @HystrixProperty(name = \"metrics.rollingStats.numBuckets\", value = \"10\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®å¯¹å‘½ä»¤æ‰§è¡Œçš„å»¶è¿Ÿæ˜¯å¦ä½¿ç”¨ç™¾åˆ†ä½æ•°æ¥è·Ÿè¸ªå’Œè®¡ç®—ã€‚å¦‚æœè®¾ç½®ä¸º false, é‚£ä¹ˆæ‰€æœ‰çš„æ¦‚è¦ç»Ÿè®¡éƒ½å°†è¿”å› -1ã€‚ @HystrixProperty(name = \"metrics.rollingPercentile.enabled\", value = \"false\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®ç™¾åˆ†ä½ç»Ÿè®¡çš„æ»šåŠ¨çª—å£çš„æŒç»­æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚ @HystrixProperty(name = \"metrics.rollingPercentile.timeInMilliseconds\", value = \"60000\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®ç™¾åˆ†ä½ç»Ÿè®¡æ»šåŠ¨çª—å£ä¸­ä½¿ç”¨ â€œ æ¡¶ â€çš„æ•°é‡ã€‚ @HystrixProperty(name = \"metrics.rollingPercentile.numBuckets\", value = \"60000\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯ä¸ª â€œæ¡¶â€ ä¸­ä¿ç•™çš„æœ€å¤§æ‰§è¡Œæ¬¡æ•°ã€‚å¦‚æœåœ¨æ»šåŠ¨æ—¶é—´çª—å†…å‘ç”Ÿè¶…è¿‡è¯¥è®¾å®šå€¼çš„æ‰§è¡Œæ¬¡æ•°ï¼Œ // å°±ä»æœ€åˆçš„ä½ç½®å¼€å§‹é‡å†™ã€‚ä¾‹å¦‚ï¼Œå°†è¯¥å€¼è®¾ç½®ä¸º100, æ»šåŠ¨çª—å£ä¸º10ç§’ï¼Œè‹¥åœ¨10ç§’å†…ä¸€ä¸ª â€œæ¡¶ â€ä¸­å‘ç”Ÿäº†500æ¬¡æ‰§è¡Œï¼Œ // é‚£ä¹ˆè¯¥ â€œæ¡¶â€ ä¸­åªä¿ç•™ æœ€åçš„100æ¬¡æ‰§è¡Œçš„ç»Ÿè®¡ã€‚å¦å¤–ï¼Œå¢åŠ è¯¥å€¼çš„å¤§å°å°†ä¼šå¢åŠ å†…å­˜é‡çš„æ¶ˆè€—ï¼Œå¹¶å¢åŠ æ’åºç™¾åˆ†ä½æ•°æ‰€éœ€çš„è®¡ç®—æ—¶é—´ã€‚ @HystrixProperty(name = \"metrics.rollingPercentile.bucketSize\", value = \"100\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®é‡‡é›†å½±å“æ–­è·¯å™¨çŠ¶æ€çš„å¥åº·å¿«ç…§ï¼ˆè¯·æ±‚çš„æˆåŠŸã€ é”™è¯¯ç™¾åˆ†æ¯”ï¼‰çš„é—´éš”ç­‰å¾…æ—¶é—´ã€‚ @HystrixProperty(name = \"metrics.healthSnapshot.intervalinMilliseconds\", value = \"500\"), // æ˜¯å¦å¼€å¯è¯·æ±‚ç¼“å­˜ @HystrixProperty(name = \"requestCache.enabled\", value = \"true\"), // HystrixCommandçš„æ‰§è¡Œå’Œäº‹ä»¶æ˜¯å¦æ‰“å°æ—¥å¿—åˆ° HystrixRequestLog ä¸­ @HystrixProperty(name = \"requestLog.enabled\", value = \"true\"), }, threadPoolProperties = { // è¯¥å‚æ•°ç”¨æ¥è®¾ç½®æ‰§è¡Œå‘½ä»¤çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œè¯¥å€¼ä¹Ÿå°±æ˜¯å‘½ä»¤æ‰§è¡Œçš„æœ€å¤§å¹¶å‘é‡ @HystrixProperty(name = \"coreSize\", value = \"10\"), // è¯¥å‚æ•°ç”¨æ¥è®¾ç½®çº¿ç¨‹æ± çš„æœ€å¤§é˜Ÿåˆ—å¤§å°ã€‚å½“è®¾ç½®ä¸º -1 æ—¶ï¼Œçº¿ç¨‹æ± å°†ä½¿ç”¨ SynchronousQueue å®ç°çš„é˜Ÿåˆ—ï¼Œ // å¦åˆ™å°†ä½¿ç”¨ LinkedBlockingQueue å®ç°çš„é˜Ÿåˆ—ã€‚ @HystrixProperty(name = \"maxQueueSize\", value = \"-1\"), // è¯¥å‚æ•°ç”¨æ¥ä¸ºé˜Ÿåˆ—è®¾ç½®æ‹’ç»é˜ˆå€¼ã€‚ é€šè¿‡è¯¥å‚æ•°ï¼Œ å³ä½¿é˜Ÿåˆ—æ²¡æœ‰è¾¾åˆ°æœ€å¤§å€¼ä¹Ÿèƒ½æ‹’ç»è¯·æ±‚ã€‚ // è¯¥å‚æ•°ä¸»è¦æ˜¯å¯¹ LinkedBlockingQueue é˜Ÿåˆ—çš„è¡¥å……,å› ä¸º LinkedBlockingQueue // é˜Ÿåˆ—ä¸èƒ½åŠ¨æ€ä¿®æ”¹å®ƒçš„å¯¹è±¡å¤§å°ï¼Œè€Œé€šè¿‡è¯¥å±æ€§å°±å¯ä»¥è°ƒæ•´æ‹’ç»è¯·æ±‚çš„é˜Ÿåˆ—å¤§å°äº†ã€‚ @HystrixProperty(name = \"queueSizeRejectionThreshold\", value = \"5\"), } ) public String strConsumer() { return \"hello 2020\"; } public String str_fallbackMethod() { return \"*****fall back str_fallbackMethod\"; } 3-3å®æˆ˜ï¼šæœåŠ¡é™æµé‡‡ç”¨alibabaçš„Sentinelï¼Œåé¢æ‰©å±• 4ã€hystrixå·¥ä½œæµç¨‹ 1 åˆ›å»º HystrixCommandï¼ˆç”¨åœ¨ä¾èµ–çš„æœåŠ¡è¿”å›å•ä¸ªæ“ä½œç»“æœçš„æ—¶å€™ï¼‰ æˆ– HystrixObserableCommandï¼ˆç”¨åœ¨ä¾èµ–çš„æœåŠ¡è¿”å›å¤šä¸ªæ“ä½œç»“æœçš„æ—¶å€™ï¼‰ å¯¹è±¡ã€‚2 å‘½ä»¤æ‰§è¡Œã€‚å…¶ä¸­ HystrixComand å®ç°äº†ä¸‹é¢å‰ä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼›è€Œ HystrixObservableCommand å®ç°äº†åä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼šexecute()ï¼šåŒæ­¥æ‰§è¡Œï¼Œä»ä¾èµ–çš„æœåŠ¡è¿”å›ä¸€ä¸ªå•ä¸€çš„ç»“æœå¯¹è±¡ï¼Œ æˆ–æ˜¯åœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ã€‚queue()ï¼šå¼‚æ­¥æ‰§è¡Œï¼Œ ç›´æ¥è¿”å› ä¸€ä¸ªFutureå¯¹è±¡ï¼Œ å…¶ä¸­åŒ…å«äº†æœåŠ¡æ‰§è¡Œç»“æŸæ—¶è¦è¿”å›çš„å•ä¸€ç»“æœå¯¹è±¡ã€‚observe()ï¼šè¿”å› Observable å¯¹è±¡ï¼Œå®ƒä»£è¡¨äº†æ“ä½œçš„å¤šä¸ªç»“æœï¼Œå®ƒæ˜¯ä¸€ä¸ª Hot Obserableï¼ˆä¸è®º â€œäº‹ä»¶æºâ€ æ˜¯å¦æœ‰ â€œè®¢é˜…è€…â€ï¼Œéƒ½ä¼šåœ¨åˆ›å»ºåå¯¹äº‹ä»¶è¿›è¡Œå‘å¸ƒï¼Œæ‰€ä»¥å¯¹äº Hot Observable çš„æ¯ä¸€ä¸ª â€œè®¢é˜…è€…â€ éƒ½æœ‰å¯èƒ½æ˜¯ä» â€œäº‹ä»¶æºâ€ çš„ä¸­é€”å¼€å§‹çš„ï¼Œå¹¶å¯èƒ½åªæ˜¯çœ‹åˆ°äº†æ•´ä¸ªæ“ä½œçš„å±€éƒ¨è¿‡ç¨‹ï¼‰ã€‚toObservable()ï¼š åŒæ ·ä¼šè¿”å› Observable å¯¹è±¡ï¼Œä¹Ÿä»£è¡¨äº†æ“ä½œçš„å¤šä¸ªç»“æœï¼Œä½†å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªCold Observableï¼ˆæ²¡æœ‰ â€œè®¢é˜…è€…â€ çš„æ—¶å€™å¹¶ä¸ä¼šå‘å¸ƒäº‹ä»¶ï¼Œè€Œæ˜¯è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°æœ‰ â€œè®¢é˜…è€…â€ ä¹‹åæ‰å‘å¸ƒäº‹ä»¶ï¼Œæ‰€ä»¥å¯¹äº Cold Observable çš„è®¢é˜…è€…ï¼Œå®ƒå¯ä»¥ä¿è¯ä»ä¸€å¼€å§‹çœ‹åˆ°æ•´ä¸ªæ“ä½œçš„å…¨éƒ¨è¿‡ç¨‹ï¼‰ã€‚3 è‹¥å½“å‰å‘½ä»¤çš„è¯·æ±‚ç¼“å­˜åŠŸèƒ½æ˜¯è¢«å¯ç”¨çš„ï¼Œ å¹¶ä¸”è¯¥å‘½ä»¤ç¼“å­˜å‘½ä¸­ï¼Œ é‚£ä¹ˆç¼“å­˜çš„ç»“æœä¼šç«‹å³ä»¥ Observable å¯¹è±¡çš„å½¢å¼ è¿”å›ã€‚4 æ£€æŸ¥æ–­è·¯å™¨æ˜¯å¦ä¸ºæ‰“å¼€çŠ¶æ€ã€‚å¦‚æœæ–­è·¯å™¨æ˜¯æ‰“å¼€çš„ï¼Œé‚£ä¹ˆHystrixä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œè€Œæ˜¯è½¬æ¥åˆ° fallback å¤„ç†é€»è¾‘ï¼ˆç¬¬ 8 æ­¥ï¼‰ï¼›å¦‚æœæ–­è·¯å™¨æ˜¯å…³é—­çš„ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨èµ„æºæ¥æ‰§è¡Œå‘½ä»¤ï¼ˆç¬¬ 5 æ­¥ï¼‰ã€‚5 çº¿ç¨‹æ± /è¯·æ±‚é˜Ÿåˆ—/ä¿¡å·é‡æ˜¯å¦å æ»¡ã€‚å¦‚æœå‘½ä»¤ä¾èµ–æœåŠ¡çš„ä¸“æœ‰çº¿ç¨‹æ± å’Œè¯·æ±‚é˜Ÿåˆ—ï¼Œæˆ–è€…ä¿¡å·é‡ï¼ˆä¸ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ï¼‰å·²ç»è¢«å æ»¡ï¼Œ é‚£ä¹ˆ Hystrix ä¹Ÿä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œ è€Œæ˜¯è½¬æ¥åˆ° fallback å¤„ç†é€»è¾‘ï¼ˆç¬¬8æ­¥ï¼‰ã€‚6 Hystrix ä¼šæ ¹æ®æˆ‘ä»¬ç¼–å†™çš„æ–¹æ³•æ¥å†³å®šé‡‡å–ä»€ä¹ˆæ ·çš„æ–¹å¼å»è¯·æ±‚ä¾èµ–æœåŠ¡ã€‚HystrixCommand.run() ï¼šè¿”å›ä¸€ä¸ªå•ä¸€çš„ç»“æœï¼Œæˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚HystrixObservableCommand.construct()ï¼š è¿”å›ä¸€ä¸ªObservable å¯¹è±¡æ¥å‘å°„å¤šä¸ªç»“æœï¼Œæˆ–é€šè¿‡ onError å‘é€é”™è¯¯é€šçŸ¥ã€‚7 Hystrixä¼šå°† â€œæˆåŠŸâ€ã€â€å¤±è´¥â€ã€â€æ‹’ç»â€ã€â€è¶…æ—¶â€ ç­‰ä¿¡æ¯æŠ¥å‘Šç»™æ–­è·¯å™¨ï¼Œ è€Œæ–­è·¯å™¨ä¼šç»´æŠ¤ä¸€ç»„è®¡æ•°å™¨æ¥ç»Ÿè®¡è¿™äº›æ•°æ®ã€‚æ–­è·¯å™¨ä¼šä½¿ç”¨è¿™äº›ç»Ÿè®¡æ•°æ®æ¥å†³å®šæ˜¯å¦è¦å°†æ–­è·¯å™¨æ‰“å¼€ï¼Œæ¥å¯¹æŸä¸ªä¾èµ–æœåŠ¡çš„è¯·æ±‚è¿›è¡Œ â€œç†”æ–­/çŸ­è·¯â€ã€‚8 å½“å‘½ä»¤æ‰§è¡Œå¤±è´¥çš„æ—¶å€™ï¼Œ Hystrix ä¼šè¿›å…¥ fallback å°è¯•å›é€€å¤„ç†ï¼Œ æˆ‘ä»¬é€šå¸¸ä¹Ÿç§°è¯¥æ“ä½œä¸º â€œæœåŠ¡é™çº§â€ã€‚è€Œèƒ½å¤Ÿå¼•èµ·æœåŠ¡é™çº§å¤„ç†çš„æƒ…å†µæœ‰ä¸‹é¢å‡ ç§ï¼šç¬¬4æ­¥ï¼š å½“å‰å‘½ä»¤å¤„äºâ€ç†”æ–­/çŸ­è·¯â€çŠ¶æ€ï¼Œæ–­è·¯å™¨æ˜¯æ‰“å¼€çš„æ—¶å€™ã€‚ç¬¬5æ­¥ï¼š å½“å‰å‘½ä»¤çš„çº¿ç¨‹æ± ã€ è¯·æ±‚é˜Ÿåˆ—æˆ– è€…ä¿¡å·é‡è¢«å æ»¡çš„æ—¶å€™ã€‚ç¬¬6æ­¥ï¼šHystrixObservableCommand.construct() æˆ– HystrixCommand.run() æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ã€‚9 å½“Hystrixå‘½ä»¤æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œ å®ƒä¼šå°†å¤„ç†ç»“æœç›´æ¥è¿”å›æˆ–æ˜¯ä»¥Observable çš„å½¢å¼è¿”å›ã€‚ tipsï¼šå¦‚æœæˆ‘ä»¬æ²¡æœ‰ä¸ºå‘½ä»¤å®ç°é™çº§é€»è¾‘æˆ–è€…åœ¨é™çº§å¤„ç†é€»è¾‘ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œ Hystrix ä¾ç„¶ä¼šè¿”å›ä¸€ä¸ª Observable å¯¹è±¡ï¼Œ ä½†æ˜¯å®ƒä¸ä¼šå‘å°„ä»»ä½•ç»“æœæ•°æ®ï¼Œ è€Œæ˜¯é€šè¿‡ onError æ–¹æ³•é€šçŸ¥å‘½ä»¤ç«‹å³ä¸­æ–­è¯·æ±‚ï¼Œå¹¶é€šè¿‡onError()æ–¹æ³•å°†å¼•èµ·å‘½ä»¤å¤±è´¥çš„å¼‚å¸¸å‘é€ç»™è°ƒç”¨è€…ã€‚ 5ã€æœåŠ¡ç›‘æ§HystrixDashboard1ã€æ¦‚è¿°é™¤äº†éš”ç¦»ä¾èµ–æœåŠ¡çš„è°ƒç”¨ä»¥å¤–ï¼ŒHystrixè¿˜æä¾›äº†å‡†å®æ—¶çš„è°ƒç”¨ç›‘æ§ï¼ˆHystrix Dashboardï¼‰ï¼ŒHystrixä¼šæŒç»­åœ°è®°å½•æ‰€æœ‰é€šè¿‡Hystrixå‘èµ·çš„è¯·æ±‚çš„æ‰§è¡Œä¿¡æ¯ï¼Œå¹¶ä»¥ç»Ÿè®¡æŠ¥è¡¨å’Œå›¾å½¢çš„å½¢å¼å±•ç¤ºç»™ç”¨æˆ·ï¼ŒåŒ…æ‹¬æ¯ç§’æ‰§è¡Œå¤šå°‘è¯·æ±‚å¤šå°‘æˆåŠŸï¼Œå¤šå°‘å¤±è´¥ç­‰ã€‚Netflixé€šè¿‡hystrix-metrics-event-streamé¡¹ç›®å®ç°äº†å¯¹ä»¥ä¸ŠæŒ‡æ ‡çš„ç›‘æ§ã€‚Spring Cloudä¹Ÿæä¾›äº†Hystrix Dashboardçš„æ•´åˆï¼Œå¯¹ç›‘æ§å†…å®¹è½¬åŒ–æˆå¯è§†åŒ–ç•Œé¢ã€‚ 2ã€ä»ªè¡¨ç›˜90011ã€å»ºmodelæ–°å»ºcloud-consumer-hystrix-dashboard9001 2ã€POM&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumer-hystrix-dashboard9001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 9001 4ã€@EnableHystrixDashboardpackage com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard; @SpringBootApplication @EnableHystrixDashboard public class HystrixDashboardMain9001 { public static void main(String[] args) { SpringApplication.run (HystrixDashboardMain9001.class,args); } } 5ã€æ‰€æœ‰Providerå¾®æœåŠ¡æä¾›ç±»(8001/8002/8003)éƒ½éœ€è¦ç›‘æ§ä¾èµ–é…ç½® &lt;!-- actuatorç›‘æ§ä¿¡æ¯å®Œå–„ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; 6ã€è¿›å…¥é¢æ¿http://localhost:9001/hystrix 3ã€æ–­è·¯å™¨æ¼”ç¤º(æœåŠ¡ç›‘æ§hystrixDashboard)1ã€ä¿®æ”¹cloud-provider-hystrix-payment80011ã€æ³¨æ„æ–°ç‰ˆæœ¬æ³¨æ„:æ–°ç‰ˆæœ¬Hystrixéœ€è¦åœ¨ä¸»å¯åŠ¨ç±»MainAppHystrix8001ä¸­æŒ‡å®šç›‘æ§è·¯å¾„ æŠ¥é”™ä¿¡æ¯ï¼šUnable to connect to Command Metric Stream. /** *æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloudå‡çº§åçš„å‘ *ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯\"/hystrix.stream\"ï¼Œ *åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„servletå°±å¯ä»¥äº† */ @Bean public ServletRegistrationBean getServlet() { HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet(); ServletRegistrationBean registrationBean = new ServletRegistrationBean(streamServlet); registrationBean.setLoadOnStartup(1); registrationBean.addUrlMappings(\"/hystrix.stream\"); registrationBean.setName(\"HystrixMetricsStreamServlet\"); return registrationBean; } package com.kk.springcloud; import com.netflix.hystrix.contrib.metrics.eventstream.HystrixMetricsStreamServlet; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.web.servlet.ServletRegistrationBean; import org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; import org.springframework.context.annotation.Bean; @SpringBootApplication @EnableEurekaClient //æœ¬æœåŠ¡å¯åŠ¨åä¼šè‡ªåŠ¨æ³¨å†Œè¿›eurekaæœåŠ¡ä¸­ @EnableCircuitBreaker public class PaymentHystrixMain8001 { public static void main(String[] args) { SpringApplication.run (PaymentHystrixMain8001.class, args); } /** * æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloudå‡çº§åçš„å‘ * ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯\"/hystrix.stream\"ï¼Œ * åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„servletå°±å¯ä»¥äº† */ @Bean public ServletRegistrationBean getServlet() { HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet ( ); ServletRegistrationBean registrationBean = new ServletRegistrationBean (streamServlet); registrationBean.setLoadOnStartup (1); registrationBean.addUrlMappings (\"/hystrix.stream\"); registrationBean.setName (\"HystrixMetricsStreamServlet\"); return registrationBean; } } 2ã€ç›‘æ§æµ‹è¯•1ã€9001ç›‘æ§8001http://localhost:8001/hystrix.stream 1ï¼šDelayï¼šè¯¥å‚æ•°ç”¨æ¥æ§åˆ¶æœåŠ¡å™¨ä¸Šè½®è¯¢ç›‘æ§ä¿¡æ¯çš„å»¶è¿Ÿæ—¶é—´ï¼Œé»˜è®¤ä¸º2000æ¯«ç§’ï¼Œå¯ä»¥é€šè¿‡é…ç½®è¯¥å±æ€§æ¥é™ä½å®¢æˆ·ç«¯çš„ç½‘ç»œå’ŒCPUæ¶ˆè€—ã€‚ 2ï¼šTitleï¼šè¯¥å‚æ•°å¯¹åº”äº†å¤´éƒ¨æ ‡é¢˜Hystrix Streamä¹‹åçš„å†…å®¹ï¼Œé»˜è®¤ä¼šä½¿ç”¨å…·ä½“ç›‘æ§å®ä¾‹çš„URLï¼Œå¯ä»¥é€šè¿‡é…ç½®è¯¥ä¿¡æ¯æ¥å±•ç¤ºæ›´åˆé€‚çš„æ ‡é¢˜ã€‚ 2ã€è®¿é—®æ­£ç¡®ï¼šhttp://localhost:8001/payment/circuit/1 é”™è¯¯ï¼šhttp://localhost:8001/payment/circuit/-1 3ã€â˜… å¦‚ä½•çœ‹ä»ªè¡¨ç›˜ 4ã€ææ‡‚ä¸€ä¸ªæ‰èƒ½çœ‹æ‡‚å¤æ‚çš„","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"netflix","slug":"netflix","permalink":"https://mykkto.github.io/tags/netflix/"},{"name":"æ–­è·¯å™¨","slug":"æ–­è·¯å™¨","permalink":"https://mykkto.github.io/tags/%E6%96%AD%E8%B7%AF%E5%99%A8/"},{"name":"Hystrix","slug":"Hystrix","permalink":"https://mykkto.github.io/tags/Hystrix/"}],"author":"mykk"},{"title":"SpringCloud-OpenFeignè¿œç¨‹è°ƒç”¨æœåŠ¡","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/06_SpringCloud_OpenFeign","date":"2022-01-21T13:32:13.000Z","updated":"2023-06-11T02:53:45.161Z","comments":true,"path":"posts/a723ac51.html","link":"","permalink":"https://mykkto.github.io/posts/a723ac51.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€æ˜¯ä»€ä¹ˆhttps://github.com/spring-cloud/spring-cloud-openfeign Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„WebæœåŠ¡å®¢æˆ·ç«¯ï¼Œè®©ç¼–å†™WebæœåŠ¡å®¢æˆ·ç«¯å˜å¾—éå¸¸å®¹æ˜“ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶åœ¨æ¥å£ä¸Šæ·»åŠ æ³¨è§£å³å¯ 2ã€èƒ½å¹²å˜›1ã€ Feignèƒ½å¹²ä»€ä¹ˆFeignæ—¨åœ¨ä½¿ç¼–å†™Java Httpå®¢æˆ·ç«¯å˜å¾—æ›´å®¹æ˜“ã€‚å‰é¢åœ¨ä½¿ç”¨Ribbon+RestTemplateæ—¶ï¼Œåˆ©ç”¨RestTemplateå¯¹httpè¯·æ±‚çš„å°è£…å¤„ç†ï¼Œå½¢æˆäº†ä¸€å¥—æ¨¡ç‰ˆåŒ–çš„è°ƒç”¨æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œç”±äºå¯¹æœåŠ¡ä¾èµ–çš„è°ƒç”¨å¯èƒ½ä¸æ­¢ä¸€å¤„ï¼Œå¾€å¾€ä¸€ä¸ªæ¥å£ä¼šè¢«å¤šå¤„è°ƒç”¨ï¼Œæ‰€ä»¥é€šå¸¸éƒ½ä¼šé’ˆå¯¹æ¯ä¸ªå¾®æœåŠ¡è‡ªè¡Œå°è£…ä¸€äº›å®¢æˆ·ç«¯ç±»æ¥åŒ…è£…è¿™äº›ä¾èµ–æœåŠ¡çš„è°ƒç”¨ã€‚æ‰€ä»¥ï¼ŒFeignåœ¨æ­¤åŸºç¡€ä¸Šåšäº†è¿›ä¸€æ­¥å°è£…ï¼Œç”±ä»–æ¥å¸®åŠ©æˆ‘ä»¬å®šä¹‰å’Œå®ç°ä¾èµ–æœåŠ¡æ¥å£çš„å®šä¹‰ã€‚åœ¨Feignçš„å®ç°ä¸‹ï¼Œæˆ‘ä»¬åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®å®ƒ(ä»¥å‰æ˜¯Daoæ¥å£ä¸Šé¢æ ‡æ³¨Mapperæ³¨è§£,ç°åœ¨æ˜¯ä¸€ä¸ªå¾®æœåŠ¡æ¥å£ä¸Šé¢æ ‡æ³¨ä¸€ä¸ªFeignæ³¨è§£å³å¯)ï¼Œå³å¯å®Œæˆå¯¹æœåŠ¡æä¾›æ–¹çš„æ¥å£ç»‘å®šï¼Œç®€åŒ–äº†ä½¿ç”¨Spring cloud Ribbonæ—¶ï¼Œè‡ªåŠ¨å°è£…æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯çš„å¼€å‘é‡ã€‚ 2ã€Feigné›†æˆäº†Ribbonåˆ©ç”¨Ribbonç»´æŠ¤äº†Paymentçš„æœåŠ¡åˆ—è¡¨ä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡è½®è¯¢å®ç°äº†å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ã€‚è€Œä¸Ribbonä¸åŒçš„æ˜¯ï¼Œé€šè¿‡feignåªéœ€è¦å®šä¹‰æœåŠ¡ç»‘å®šæ¥å£ä¸”ä»¥å£°æ˜å¼çš„æ–¹æ³•ï¼Œä¼˜é›…è€Œç®€å•çš„å®ç°äº†æœåŠ¡è°ƒç”¨ 3ã€åŒºåˆ«1ã€feignFeignæ˜¯Spring Cloudç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯Feignå†…ç½®äº†Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚Feignçš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼šä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€openfeignOpenFeignæ˜¯Spring Cloud åœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†SpringMVCçš„æ³¨è§£ï¼Œå¦‚@RequesMappingç­‰ç­‰ã€‚OpenFeignçš„@FeignClientå¯ä»¥è§£æSpringMVCçš„@RequestMappingæ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€OpenFeignä½¿ç”¨æ­¥éª¤1ã€å»ºmodelæ–°å»ºcloud-consumer-feign-order80 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumer-feign-order80&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--eureka client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--web--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬åŸºç¡€é€šç”¨é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 80 eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication @EnableFeignClients public class OrderFeignMain80 { public static void main(String[] args) { SpringApplication.run (OrderFeignMain80.class,args); } } 5ã€ä¸šåŠ¡ç±»1ã€æ–°å»ºPaymentFeignServiceæ¥å£å¹¶æ–°å¢æ³¨è§£@FeignClientpackage com.kk.springcloud.service; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.stereotype.Component; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; @Component @FeignClient(value = \"CLOUD-PAYMENT-SERVICE\") public interface PaymentFeignService { @GetMapping(value = \"/payment/get/{id}\") CommonResult&lt;Payment&gt; getPaymentById(@PathVariable(\"id\") Long id); } 2ã€æ§åˆ¶å±‚Controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import com.kk.springcloud.service.PaymentFeignService; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController public class OrderFeignController { @Resource private PaymentFeignService paymentFeignService; @GetMapping(value = \"consumer/payment/get/{id}\") public CommonResult&lt;Payment&gt; getPaymentById(@PathVariable(\"id\") Long id){ return paymentFeignService.getPaymentById (id); } } 6ã€æµ‹è¯•1ã€å¯åŠ¨é¡ºåº å¯åŠ¨ 7001/7002 eurekaé›†ç¾¤ å¯åŠ¨ 8001/8002 ç”Ÿäº§è€…é›†ç¾¤ å¯åŠ¨ OpenFeign:80 æ¶ˆè´¹è€… 2ã€è®¿é—®http://localhost/consumer/payment/get/1 3ã€Feignè‡ªå¸¦è´Ÿè½½å‡è¡¡é…ç½®é¡¹ 7ã€å°ç»“ 3ã€OpenFeignè¶…æ—¶æ§åˆ¶1ã€æ¨¡æ‹Ÿè¶…æ—¶è¶…æ—¶è®¾ç½®ï¼Œæ•…æ„è®¾ç½®è¶…æ—¶æ¼”ç¤ºå‡ºé”™æƒ…å†µ 1ã€æœåŠ¡æä¾›æ–¹8001æ•…æ„å†™æš‚åœç¨‹åºcom.kk.springcloud.controller.PaymentController; @GetMapping(value = \"/payment/feign/timeout\") public String paymentFeignTimeOut() { System.out.println (\"*****paymentFeignTimeOut from port: \" + serverPort); //æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹ try { TimeUnit.SECONDS.sleep (3); } catch (InterruptedException e) { e.printStackTrace ( ); } return serverPort; } 2ã€æœåŠ¡æ¶ˆè´¹æ–¹80æ·»åŠ è¶…æ—¶æ–¹æ³•PaymentFeignServicecom.kk.springcloud.service.PaymentFeignService @GetMapping(value = \"/payment/feign/timeout\") String paymentFeignTimeOut(); 3ã€æœåŠ¡æ¶ˆè´¹æ–¹80æ·»åŠ è¶…æ—¶æ–¹æ³•OrderFeignControllercom.kk.springcloud.controller.OrderFeignController @GetMapping(value = \"/consumer/payment/feign/timeout\") public String paymentFeignTimeOut() { return paymentFeignService.paymentFeignTimeOut ( ); } 4ã€æµ‹è¯•urlï¼šhttp://localhost/consumer/payment/feign/timeout 5ã€å°ç»“OpenFeigné»˜è®¤ç­‰å¾…1ç§’é’Ÿï¼Œè¶…è¿‡åæŠ¥é”™ 2ã€æ˜¯ä»€ä¹ˆ1ã€æ¦‚è¿°é»˜è®¤Feignå®¢æˆ·ç«¯åªç­‰å¾…ä¸€ç§’é’Ÿï¼Œä½†æ˜¯æœåŠ¡ç«¯å¤„ç†éœ€è¦è¶…è¿‡1ç§’é’Ÿï¼Œå¯¼è‡´Feignå®¢æˆ·ç«¯ä¸æƒ³ç­‰å¾…äº†ï¼Œç›´æ¥è¿”å›æŠ¥é”™ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„æƒ…å†µï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦è®¾ç½®Feignå®¢æˆ·ç«¯çš„è¶…æ—¶æ§åˆ¶ã€‚ 2ã€é»˜è®¤æ”¯æŒRibbon 3ã€è¶…æ—¶æ—¶é—´é…ç½®#è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒribbon) ribbon: #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´ ReadTimeout: 5000 #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´ ConnectTimeout: 5000 4ã€OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½1ã€æ˜¯ä»€ä¹ˆFeign æä¾›äº†æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ¥è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼Œä»è€Œäº†è§£ Feign ä¸­ Http è¯·æ±‚çš„ç»†èŠ‚ã€‚è¯´ç™½äº†å°±æ˜¯å¯¹Feignæ¥å£çš„è°ƒç”¨æƒ…å†µè¿›è¡Œç›‘æ§å’Œè¾“å‡º 2ã€æ—¥å¿—çº§åˆ« NONEï¼šé»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—ï¼› BASICï¼šä»…è®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç åŠæ‰§è¡Œæ—¶é—´ï¼› HEADERSï¼šé™¤äº† BASIC ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯ï¼› FULLï¼šé™¤äº† HEADERS ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®ã€‚ 3ã€é…ç½®æ—¥å¿— beanpackage com.kk.springcloud.config; import feign.Logger; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class OpenFeignConfig { @Configuration public class FeignConfig { @Bean Logger.Level feignLoggerLevel() { return Logger.Level.FULL; } } } 4ã€ymlä¸­é…ç½®logging: level: # feignæ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£ com.kk.springcloud.service.PaymentFeignService: debug server: port: 80 eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ #è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒribbon) ribbon: #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´ ReadTimeout: 5000 #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´ ConnectTimeout: 5000 logging: level: # feignæ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£ com.kk.springcloud.service.PaymentFeignService: debug 5ã€åå°å¯åŠ¨æŸ¥çœ‹","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"netflix","slug":"netflix","permalink":"https://mykkto.github.io/tags/netflix/"},{"name":"è¿œç¨‹è°ƒç”¨æœåŠ¡","slug":"è¿œç¨‹è°ƒç”¨æœåŠ¡","permalink":"https://mykkto.github.io/tags/%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1/"},{"name":"openfeign","slug":"openfeign","permalink":"https://mykkto.github.io/tags/openfeign/"}],"author":"mykk"},{"title":"SpringCloud-Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/05_SpringCloud_Ribbon","date":"2022-01-17T14:42:11.000Z","updated":"2023-06-11T02:53:45.161Z","comments":true,"path":"posts/9091e07b.html","link":"","permalink":"https://mykkto.github.io/posts/9091e07b.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€æ˜¯ä»€ä¹ˆ Spring Cloud Ribbonæ˜¯åŸºäºNetflix Ribbonå®ç°çš„ä¸€å¥—å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å·¥å…·ã€‚ ç®€å•çš„è¯´ï¼ŒRibbonæ˜¯Netflixå‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨ã€‚Ribbonå®¢æˆ·ç«¯ç»„ä»¶æä¾›ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹å¦‚è¿æ¥è¶…æ—¶ï¼Œé‡è¯•ç­‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºLoad Balancerï¼ˆç®€ç§°LBï¼‰åé¢æ‰€æœ‰çš„æœºå™¨ï¼ŒRibbonä¼šè‡ªåŠ¨çš„å¸®åŠ©ä½ åŸºäºæŸç§è§„åˆ™ï¼ˆå¦‚ç®€å•è½®è¯¢ï¼Œéšæœºè¿æ¥ç­‰ï¼‰å»è¿æ¥è¿™äº›æœºå™¨ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“ä½¿ç”¨Ribbonå®ç°è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚ 2ã€å®˜ç½‘èµ„æ–™1ã€æ–‡æ¡£https://github.com/Netflix/ribbon/wiki/Getting-Started 2ã€Ribbonç›®å‰ä¹Ÿè¿›å…¥ç»´æŠ¤æ¨¡å¼ æœªæ¥æ›¿æ¢æ–¹æ¡ˆï¼š 3ã€èƒ½å¹²å—1ã€LBï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ç®€å•çš„è¯´å°±æ˜¯å°†ç”¨æˆ·çš„è¯·æ±‚å¹³æ‘Šçš„åˆ†é…åˆ°å¤šä¸ªæœåŠ¡ä¸Šï¼Œä»è€Œè¾¾åˆ°ç³»ç»Ÿçš„HAï¼ˆé«˜å¯ç”¨ï¼‰ã€‚å¸¸è§çš„è´Ÿè½½å‡è¡¡æœ‰è½¯ä»¶Nginxï¼ŒLVSï¼Œç¡¬ä»¶ F5ç­‰ã€‚ æ€»ç»“ï¼šRibbon = è´Ÿè½½å‡è¡¡+RestTemplateè°ƒç”¨ 2ã€åŒºåˆ«ï¼ˆribbon VS nginxï¼‰ Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨è°ƒç”¨å¾®æœåŠ¡æ¥å£æ—¶å€™ï¼Œä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ°JVMæœ¬åœ°ï¼Œä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æŠ€æœ¯ã€‚ 3ã€åˆ’åˆ†1ã€é›†ä¸­å¼LB å³åœ¨æœåŠ¡çš„æ¶ˆè´¹æ–¹å’Œæä¾›æ–¹ä¹‹é—´ä½¿ç”¨ç‹¬ç«‹çš„LBè®¾æ–½(å¯ä»¥æ˜¯ç¡¬ä»¶ï¼Œå¦‚F5, ä¹Ÿå¯ä»¥æ˜¯è½¯ä»¶ï¼Œå¦‚nginx), ç”±è¯¥è®¾æ–½è´Ÿè´£æŠŠè®¿é—®è¯·æ±‚é€šè¿‡æŸç§ç­–ç•¥è½¬å‘è‡³æœåŠ¡çš„æä¾›æ–¹ï¼› 2ã€è¿›ç¨‹å†…LB å°†LBé€»è¾‘é›†æˆåˆ°æ¶ˆè´¹æ–¹ï¼Œæ¶ˆè´¹æ–¹ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·çŸ¥æœ‰å“ªäº›åœ°å€å¯ç”¨ï¼Œç„¶åè‡ªå·±å†ä»è¿™äº›åœ°å€ä¸­é€‰æ‹©å‡ºä¸€ä¸ªåˆé€‚çš„æœåŠ¡å™¨ã€‚ Ribbonå°±å±äºè¿›ç¨‹å†…LBï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç±»åº“ï¼Œé›†æˆäºæ¶ˆè´¹æ–¹è¿›ç¨‹ï¼Œæ¶ˆè´¹æ–¹é€šè¿‡å®ƒæ¥è·å–åˆ°æœåŠ¡æä¾›æ–¹çš„åœ°å€ã€‚ 2ã€Ribbonæ¡ˆä¾‹1ã€æ¶æ„è¯´æ˜ Ribbonåœ¨å·¥ä½œæ—¶åˆ†æˆä¸¤æ­¥ ç¬¬ä¸€æ­¥å…ˆé€‰æ‹© EurekaServer ,å®ƒä¼˜å…ˆé€‰æ‹©åœ¨åŒä¸€ä¸ªåŒºåŸŸå†…è´Ÿè½½è¾ƒå°‘çš„server. ç¬¬äºŒæ­¥å†æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥ï¼Œåœ¨ä»serverå–åˆ°çš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåœ°å€ã€‚å…¶ä¸­Ribbonæä¾›äº†å¤šç§ç­–ç•¥ï¼šæ¯”å¦‚è½®è¯¢ã€éšæœºå’Œæ ¹æ®å“åº”æ—¶é—´åŠ æƒã€‚ æ€»ç»“ï¼šRibbonå…¶å®å°±æ˜¯ä¸€ä¸ªè½¯è´Ÿè½½å‡è¡¡çš„å®¢æˆ·ç«¯ç»„ä»¶ï¼Œä»–å¯ä»¥å’Œå…¶ä»–æ‰€éœ€è¯·æ±‚çš„å®¢æˆ·ç«¯ç»“åˆä½¿ç”¨ï¼Œå’Œeurekaç»“åˆåªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå®ä¾‹ã€‚ 2ã€POM1ã€åæ ‡&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€eureka-client è‡ªå¸¦ ribbonè¯æ˜å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°spring-cloud-starter-netflix-eureka-client ç¡®å®å¼•å…¥äº†Ribbon 3ã€äºŒè¯´RestTemplateçš„ä½¿ç”¨1ã€å®˜ç½‘https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html 2ã€getForObjectæ–¹æ³•/getForEntityï¼ˆè¯»ï¼‰ è¿”å›å¯¹è±¡ä¸ºå“åº”ä½“ä¸­æ•°æ®è½¬åŒ–æˆçš„å¯¹è±¡ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç†è§£ä¸ºJson è¿”å›å¯¹è±¡ä¸ºResponseEntityå¯¹è±¡ï¼ŒåŒ…å«äº†å“åº”ä¸­çš„ä¸€äº›é‡è¦ä¿¡æ¯ï¼Œæ¯”å¦‚å“åº”å¤´ã€å“åº”çŠ¶æ€ç ã€å“åº”ä½“ç­‰ 3ã€postForObject/postForEntity(å†™)å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•ç”¨ä¾‹çš„å†…å®¹æ˜¯å‘æŒ‡å®šçš„URLæäº¤ä¸€ä¸ªPost(å¸–å­). @Test void testSimple() { // è¯·æ±‚åœ°å€ String url = \"http://jsonplaceholder.typicode.com/posts\"; // è¦å‘é€çš„æ•°æ®å¯¹è±¡ PostDTO postDTO = new PostDTO(); postDTO.setUserId(110); postDTO.setTitle(\"zimug å‘å¸ƒæ–‡ç« \"); postDTO.setBody(\"zimug å‘å¸ƒæ–‡ç«  æµ‹è¯•å†…å®¹\"); // å‘é€postè¯·æ±‚ï¼Œå¹¶è¾“å‡ºç»“æœ PostDTO result = restTemplate.postForObject(url, postDTO, PostDTO.class); System.out.println(result); } ä¸Šé¢çš„æ‰€æœ‰çš„postForObjectè¯·æ±‚ä¼ å‚æ–¹æ³•ï¼ŒpostForEntityéƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹æ³•ä¸Šä¹Ÿå‡ ä¹æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯åœ¨è¿”å›ç»“æœæ¥æ”¶çš„æ—¶å€™ç•¥æœ‰å·®åˆ«ã€‚ä½¿ç”¨ResponseEntity&lt;T&gt; responseEntityæ¥æ¥æ”¶å“åº”ç»“æœã€‚ç”¨responseEntity.getBody()è·å–å“åº”ä½“ã€‚å“åº”ä½“å†…å®¹åŒpostForObjectæ–¹æ³•è¿”å›ç»“æœä¸€è‡´ã€‚å‰©ä¸‹çš„è¿™äº›å“åº”ä¿¡æ¯å°±æ˜¯postForEntityæ¯”postForObjectå¤šå‡ºæ¥çš„å†…å®¹ HttpStatus statusCode = responseEntity.getStatusCode(); è·å–æ•´ä½“çš„å“åº”çŠ¶æ€ä¿¡æ¯ int statusCodeValue = responseEntity.getStatusCodeValue(); è·å–å“åº”ç å€¼ HttpHeaders headers = responseEntity.getHeaders(); è·å–å“åº”å¤´ç­‰ @Test public void testEntityPoJo() { // è¯·æ±‚åœ°å€ String url = \"http://jsonplaceholder.typicode.com/posts\"; // è¦å‘é€çš„æ•°æ®å¯¹è±¡ PostDTO postDTO = new PostDTO(); postDTO.setUserId(110); postDTO.setTitle(\"zimug å‘å¸ƒæ–‡ç« \"); postDTO.setBody(\"zimug å‘å¸ƒæ–‡ç«  æµ‹è¯•å†…å®¹\"); // å‘é€postè¯·æ±‚ï¼Œå¹¶è¾“å‡ºç»“æœ ResponseEntity&lt;String&gt; responseEntity = restTemplate.postForEntity(url, postDTO, String.class); String body = responseEntity.getBody(); // è·å–å“åº”ä½“ System.out.println(\"HTTP å“åº”bodyï¼š\" + postDTO.toString()); //ä»¥ä¸‹æ˜¯postForEntityæ¯”postForObjectå¤šå‡ºæ¥çš„å†…å®¹ HttpStatus statusCode = responseEntity.getStatusCode(); // è·å–å“åº”ç  int statusCodeValue = responseEntity.getStatusCodeValue(); // è·å–å“åº”ç å€¼ HttpHeaders headers = responseEntity.getHeaders(); // è·å–å“åº”å¤´ System.out.println(\"HTTP å“åº”çŠ¶æ€ï¼š\" + statusCode); System.out.println(\"HTTP å“åº”çŠ¶æ€ç ï¼š\" + statusCodeValue); System.out.println(\"HTTP Headersä¿¡æ¯ï¼š\" + headers); } 4ã€GETè¯·æ±‚æ–¹æ³•&lt;T&gt; T getForObject(String url, Class&lt;T&gt; responseType, Object... uriVariables); &lt;T&gt; T getForObject(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables); &lt;T&gt; T getForObject(URI url, Class&lt;T&gt; responseType); &lt;T&gt; ResponseEntity&lt;T&gt; getForEntity(String url, Class&lt;T&gt; responseType, Object... uriVariables); &lt;T&gt; ResponseEntity&lt;T&gt; getForEntity(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables); &lt;T&gt; ResponseEntity&lt;T&gt; getForEntity(URI var1, Class&lt;T&gt; responseType); 5ã€POSTè¯·æ±‚æ–¹æ³• &lt;T&gt; T postForObject(String url, @Nullable Object request, Class&lt;T&gt; responseType, Object... uriVariables); &lt;T&gt; T postForObject(String url, @Nullable Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables); &lt;T&gt; T postForObject(URI url, @Nullable Object request, Class&lt;T&gt; responseType); &lt;T&gt; ResponseEntity&lt;T&gt; postForEntity(String url, @Nullable Object request, Class&lt;T&gt; responseType, Object... uriVariables); &lt;T&gt; ResponseEntity&lt;T&gt; postForEntity(String url, @Nullable Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables); &lt;T&gt; ResponseEntity&lt;T&gt; postForEntity(URI url, @Nullable Object request, Class&lt;T&gt; responseType); 3ã€Ribbonæ ¸å¿ƒç»„ä»¶IRule1ã€IRuleï¼šæ ¹æ®ç‰¹å®šç®—æ³•ä¸­ä»æœåŠ¡åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ªè¦è®¿é—®çš„æœåŠ¡ è½®è¯¢: com.netflix.loadbalancer.RoundRobinRule éšæœº: com.netflix.loadbalancer.RandomRule com.netflix.loadbalancer.RetryRule å…ˆæŒ‰ç…§RoundRobinRuleçš„ç­–ç•¥è·å–æœåŠ¡ï¼Œå¦‚æœè·å–æœåŠ¡å¤±è´¥åˆ™åœ¨æŒ‡å®šæ—¶é—´å†…ä¼šè¿›è¡Œé‡è¯•ï¼Œè·å–å¯ç”¨çš„æœåŠ¡ WeightedResponseTimeRule å¯¹RoundRobinRuleçš„æ‰©å±•ï¼Œå“åº”é€Ÿåº¦è¶Šå¿«çš„å®ä¾‹é€‰æ‹©æƒé‡è¶Šå¤§ï¼Œè¶Šå®¹æ˜“è¢«é€‰æ‹© BestAvailableRule ä¼šå…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„æœåŠ¡ AvailabilityFilteringRule å…ˆè¿‡æ»¤æ‰æ•…éšœå®ä¾‹ï¼Œå†é€‰æ‹©å¹¶å‘è¾ƒå°çš„å®ä¾‹ ZoneAvoidanceRule é»˜è®¤è§„åˆ™,å¤åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§é€‰æ‹©æœåŠ¡å™¨ 2ã€æ¡ˆä¾‹ä¿®æ”¹cloud-consumer-order801ã€ç»†èŠ‚è¯´æ˜å®˜æ–¹æ–‡æ¡£æ˜ç¡®ç»™å‡ºäº†è­¦å‘Šï¼šè¿™ä¸ªè‡ªå®šä¹‰é…ç½®ç±»ä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ï¼Œå¦åˆ™æˆ‘ä»¬è‡ªå®šä¹‰çš„è¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«ï¼Œè¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„äº†ã€‚ 2ã€æ–°å»ºpackagecom.kk.myrule 3ã€æ–°å»ºMySelfRuleè§„åˆ™ç±»package com.kk.myrule; import com.netflix.loadbalancer.IRule; import com.netflix.loadbalancer.RandomRule; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class MySelfRule { @Bean public IRule myRule() { return new RandomRule ( );//å®šä¹‰ä¸ºéšæœº } } 4ã€ä¸»å¯åŠ¨ç±»æ·»åŠ @RibbonClient@RibbonClient(name = \"CLOUD-PAYMENT-SERVICE\",configuration=MySelfRule.class) 5ã€æµ‹è¯•å¯åŠ¨ï¼šï¼ˆ1ï¼‰eurekaï¼ˆå•ä¸ªæˆ–è€…é›†ç¾¤éƒ½è¡Œï¼‰ï¼Œï¼ˆ2ï¼‰ç”Ÿäº§è€…8001ï¼ˆå•ä¸ªæˆ–è€…é›†ç¾¤éƒ½è¡Œï¼‰ï¼Œï¼ˆ3ï¼‰æ¶ˆè´¹è€…80 http://localhost/consumer/payment/get/1 4ã€Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•1ã€åŸç†è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šrestæ¥å£ç¬¬å‡ æ¬¡è¯·æ±‚æ•° % æœåŠ¡å™¨é›†ç¾¤æ€»æ•°é‡ = å®é™…è°ƒç”¨æœåŠ¡å™¨ä½ç½®ä¸‹æ ‡ ï¼Œæ¯æ¬¡æœåŠ¡é‡å¯åŠ¨årestæ¥å£è®¡æ•°ä»1å¼€å§‹ã€‚ List instances = discoveryClient.getInstances(â€œCLOUD-PAYMENT-SERVICEâ€); å¦‚ï¼š List [0] instances = 127.0.0.1:8002 List [1] instances = 127.0.0.1:8001 8001+ 8002 ç»„åˆæˆä¸ºé›†ç¾¤ï¼Œå®ƒä»¬å…±è®¡2å°æœºå™¨ï¼Œé›†ç¾¤æ€»æ•°ä¸º2ï¼Œ æŒ‰ç…§è½®è¯¢ç®—æ³•åŸç†ï¼š å½“æ€»è¯·æ±‚æ•°ä¸º1æ—¶ï¼š 1 % 2 =1 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º1 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8001å½“æ€»è¯·æ±‚æ•°ä½2æ—¶ï¼š 2 % 2 =0 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º0 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8002å½“æ€»è¯·æ±‚æ•°ä½3æ—¶ï¼š 3 % 2 =1 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º1 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8001å½“æ€»è¯·æ±‚æ•°ä½4æ—¶ï¼š 4 % 2 =0 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º0 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8002å¦‚æ­¤ç±»æ¨â€¦â€¦ 2ã€RoundRobinRuleæºç  è¿™é‡Œä¸æ˜¯æ­»å¾ªç¯ï¼Œè€Œæ˜¯è‡ªæ—‹é”ï¼ŒcompareAndSetï¼ˆCASæ“ä½œï¼ŒJUCä¸­ä¹è§‚é”çš„åº•å±‚å®ç°ï¼‰ 3ã€æ‰‹å†™1ã€8001å’Œ8002åˆ†åˆ«åŠ å…¥ @Value(\"${server.port}\") private String serverPort; @GetMapping(value = \"/payment/lb\") public String getPaymentLB() { return serverPort; } 2ã€å»æ‰æ³¨è§£@LoadBalanced 3ã€æ–°å»ºLoadBalanceræ¥å£package com.kk.springcloud.lb; import org.springframework.cloud.client.ServiceInstance; import java.util.List; public interface LoadBalancer { ServiceInstance instances(List&lt;ServiceInstance&gt; serviceInstances); } 4ã€æ–°å»ºMyLBpackage com.kk.springcloud.lb; import org.springframework.cloud.client.ServiceInstance; import org.springframework.stereotype.Component; import java.util.List; import java.util.concurrent.atomic.AtomicInteger; @Component public class MyLB implements LoadBalancer { private AtomicInteger atomicInteger = new AtomicInteger (0); @Override public ServiceInstance instances(List&lt;ServiceInstance&gt; serviceInstances) { int index = getAndIncrement ( ) % serviceInstances.size ( ); return serviceInstances.get (index); } public final int getAndIncrement() { int current; int next; do { current = this.atomicInteger.get ( ); next = current &gt;= 2147483647 ? 0 : current + 1; } while (!this.atomicInteger.compareAndSet (current, next)); System.out.println (\"*****next: \" + next); return next; } } 5ã€OrderController@Resource private LoadBalancer loadBalancer; @GetMapping(\"/consumer/payment/lb\") public String getPaymentLB() { List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances (\"CLOUD-PAYMENT-SERVICE\"); if (instances == null || instances.size ( ) &lt;= 0) { return null; } ServiceInstance serviceInstance = loadBalancer.instances (instances); URI uri = serviceInstance.getUri ( ); return restTemplate.getForObject (uri + \"/payment/lb\", String.class); } package com.kk.springcloud.controller; import com.kk.springcloud.lb.LoadBalancer; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import lombok.extern.slf4j.Slf4j; import org.springframework.cloud.client.ServiceInstance; import org.springframework.cloud.client.discovery.DiscoveryClient; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; import java.net.URI; import java.util.List; @RestController @Slf4j public class OrderController { //public static final String PAYMENT_URL = \"http://localhost:8001\"; public static final String PAYMENT_URL = \"http://cloud-payment-service\"; //å¯ä»¥è·å–æ³¨å†Œä¸­å¿ƒä¸Šçš„æœåŠ¡åˆ—è¡¨ @Resource private DiscoveryClient discoveryClient; @Resource private LoadBalancer loadBalancer; @GetMapping(\"/consumer/payment/lb\") public String getPaymentLB() { List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances (\"CLOUD-PAYMENT-SERVICE\"); if (instances == null || instances.size ( ) &lt;= 0) { return null; } ServiceInstance serviceInstance = loadBalancer.instances (instances); URI uri = serviceInstance.getUri ( ); return restTemplate.getForObject (uri + \"/payment/lb\", String.class); } @Resource private RestTemplate restTemplate; @GetMapping(\"/consumer/payment/create\") public CommonResult&lt;Payment&gt; create(Payment payment) { return restTemplate.postForObject (PAYMENT_URL + \"/payment/create\", payment, CommonResult.class); //å†™æ“ä½œ } @GetMapping(\"/consumer/payment/get/{id}\") public CommonResult&lt;Payment&gt; getPayment(@PathVariable(\"id\") Long id) { return restTemplate.getForObject (PAYMENT_URL + \"/payment/get/\" + id, CommonResult.class); } } 6ã€æµ‹è¯•http://localhost/consumer/payment/lb æ³¨æ„ï¼š8001å’Œ8002åˆ«åé…ç½®éƒ½è¦é…å¥½å¦åˆ™è‡ªå®šä¹‰ç®—æ³• è·å–çš„urlä¼šæŠ¥é”™","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"netflix","slug":"netflix","permalink":"https://mykkto.github.io/tags/netflix/"},{"name":"è´Ÿè½½å‡è¡¡","slug":"è´Ÿè½½å‡è¡¡","permalink":"https://mykkto.github.io/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"},{"name":"ribbon","slug":"ribbon","permalink":"https://mykkto.github.io/tags/ribbon/"}],"author":"mykk"},{"title":"hexo + github åœ¨ç™¾åº¦å’Œè°·æ­Œ SEOç«™ç‚¹æ”¶å½•","slug":"00-blog/01_seo","date":"2022-01-16T14:41:15.000Z","updated":"2023-06-11T02:53:45.174Z","comments":true,"path":"posts/f1d997d.html","link":"","permalink":"https://mykkto.github.io/posts/f1d997d.html","excerpt":"","text":"1ã€ç™¾åº¦ seo1ã€ç™»é™†ç™¾åº¦ç«™é•¿ç®¡ç†https://ziyuan.baidu.com/linksubmit/url?sitename=http://site:abc.github.io 2ã€å¡«å†™è‡ªå·±çš„blogåœ°å€ 3ã€hexoè®¾ç½®æ ¡éªŒC:\\Users\\Administrator\\Desktop\\myblog\\mykkTo.github.io\\themes\\matery\\layout\\_partial 4ã€æˆåŠŸ 5ã€ç«™ç‚¹æ”¶å½•https://mykkto.github.io/baidu_urls.txt 2ã€è°·æ­Œ seoå‚è€ƒhttps://www.jianshu.com/p/9be9b4786f97","categories":[{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://mykkto.github.io/categories/%E5%8D%9A%E5%AE%A2/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://mykkto.github.io/tags/hexo/"},{"name":"github","slug":"github","permalink":"https://mykkto.github.io/tags/github/"},{"name":"seo","slug":"seo","permalink":"https://mykkto.github.io/tags/seo/"},{"name":"ç™¾åº¦","slug":"ç™¾åº¦","permalink":"https://mykkto.github.io/tags/%E7%99%BE%E5%BA%A6/"},{"name":"è°·æ­Œ","slug":"è°·æ­Œ","permalink":"https://mykkto.github.io/tags/%E8%B0%B7%E6%AD%8C/"}],"author":"mykk"},{"title":"SpringCloud-Consul","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/04_SpringCloud_Consul","date":"2022-01-16T13:42:11.000Z","updated":"2023-06-11T02:53:45.158Z","comments":true,"path":"posts/51c7125f.html","link":"","permalink":"https://mykkto.github.io/posts/51c7125f.html","excerpt":"","text":"1ã€Consulç®€ä»‹1ã€æ˜¯ä»€ä¹ˆ Consul æ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ç³»ç»Ÿï¼Œç”± HashiCorp å…¬å¸ç”¨ Go è¯­è¨€å¼€å‘ã€‚ æä¾›äº†å¾®æœåŠ¡ç³»ç»Ÿä¸­çš„æœåŠ¡æ²»ç†ã€é…ç½®ä¸­å¿ƒã€æ§åˆ¶æ€»çº¿ç­‰åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ ¹æ®éœ€è¦å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·ä½¿ç”¨ä»¥æ„å»ºå…¨æ–¹ä½çš„æœåŠ¡ç½‘æ ¼ï¼Œæ€»ä¹‹Consulæä¾›äº†ä¸€ç§å®Œæ•´çš„æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚ å®ƒå…·æœ‰å¾ˆå¤šä¼˜ç‚¹ã€‚åŒ…æ‹¬ï¼š åŸºäº raft åè®®ï¼Œæ¯”è¾ƒç®€æ´ï¼› æ”¯æŒå¥åº·æ£€æŸ¥, åŒæ—¶æ”¯æŒ HTTP å’Œ DNS åè®® æ”¯æŒè·¨æ•°æ®ä¸­å¿ƒçš„ WAN é›†ç¾¤ æä¾›å›¾å½¢ç•Œé¢ è·¨å¹³å°ï¼Œæ”¯æŒ Linuxã€Macã€Windows 2ã€èƒ½å¹²å˜›1ã€æœåŠ¡å‘ç°æä¾›HTTPå’ŒDNSä¸¤ç§å‘ç°æ–¹å¼ã€‚ 2ã€å¥åº·ç›‘æµ‹æ”¯æŒå¤šç§æ–¹å¼ï¼ŒHTTPã€TCPã€Dockerã€Shellè„šæœ¬å®šåˆ¶åŒ–ç›‘æ§ 3ã€KVå­˜å‚¨Keyã€Valueçš„å­˜å‚¨æ–¹å¼ 4ã€å¤šæ•°æ®ä¸­å¿ƒConsulæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒ 5ã€å¯è§†åŒ–Webç•Œé¢3ã€å®˜ç½‘æ–‡æ¡£1ã€ä¸‹è½½åœ°å€https://www.consul.io/downloads.html 2ã€å­¦ä¹ æ–‡æ¡£https://www.springcloud.cc/spring-cloud-consul.html 2ã€å®‰è£…å¹¶è¿è¡ŒConsul1ã€å®˜ç½‘å®‰è£…https://www.consul.io/downloads 2ã€å®‰è£…è¯´æ˜ä¸‹è½½å®Œæˆååªæœ‰ä¸€ä¸ªconsul.exeæ–‡ä»¶ï¼Œç¡¬ç›˜è·¯å¾„ä¸‹åŒå‡»è¿è¡Œï¼ŒæŸ¥çœ‹ç‰ˆæœ¬å·ä¿¡æ¯ 3ã€ä½¿ç”¨å¼€å‘æ¨¡å¼å¯åŠ¨ï¼ˆ1ï¼‰å‘½ä»¤ï¼šconsul agent -dev ï¼ˆ2ï¼‰é€šè¿‡ä»¥ä¸‹åœ°å€å¯ä»¥è®¿é—®Consulçš„é¦–é¡µï¼šhttp://localhost:8500 ï¼ˆ3ï¼‰æ•ˆæœï¼š 3ã€æœåŠ¡æä¾›è€…1ã€å»ºmodelcloud-providerconsul-payment8006 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-providerconsul-payment8006&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud consul-server --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€yml###consulæœåŠ¡ç«¯å£å· server: port: 8006 spring: application: name: consul-provider-payment ####consulæ³¨å†Œä¸­å¿ƒåœ°å€ cloud: consul: host: localhost port: 8500 discovery: #hostname: 127.0.0.1 service-name: ${spring.application.name} 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class Payment8006 { public static void main(String[] args) { SpringApplication.run (Payment8006.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; import java.util.UUID; @RestController public class PaymentController { @Value(\"${server.port}\") private String serverPort; @GetMapping(\"/payment/consul\") public String paymentInfo() { return \"springcloud with consul: \" + serverPort + \"\\t\\t\" + UUID.randomUUID ( ).toString ( ); } } 5ã€æµ‹è¯•1ã€è®¿é—®http://localhost:8006/payment/consul 2ã€æ§åˆ¶å° 4ã€æœåŠ¡æ¶ˆè´¹è€…1ã€å»ºmodelcloud-consumerconsul-order82 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumerconsul-order82&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud consul-server --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€yml###consulæœåŠ¡ç«¯å£å· server: port: 82 spring: application: name: cloud-consumer-order ####consulæ³¨å†Œä¸­å¿ƒåœ°å€ cloud: consul: host: localhost port: 8500 discovery: #hostname: 127.0.0.1 service-name: ${spring.application.name} 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @SpringBootApplication @EnableDiscoveryClient public class OrderConsulMain82 { public static void main(String[] args) { SpringApplication.run (OrderConsulMain82.class,args); } } 5ã€ä¸šåŠ¡ç±»1ã€Beané…ç½®ç±»package com.kk.springcloud.config; import org.springframework.cloud.client.loadbalancer.LoadBalanced; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.web.client.RestTemplate; @Configuration public class ApplicationContextBean { @Bean @LoadBalanced public RestTemplate getRestTemplate() { return new RestTemplate ( ); } } 2ã€Controllerpackage com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; @RestController public class OrderConsulController { public static final String INVOKE_URL = \"http://cloud-provider-payment\"; //consul-provider-payment @Autowired private RestTemplate restTemplate; @GetMapping(value = \"/consumer/payment/consul\") public String paymentInfo() { String result = restTemplate.getForObject (INVOKE_URL + \"/payment/consul\", String.class); System.out.println (\"æ¶ˆè´¹è€…è°ƒç”¨æ”¯ä»˜æœåŠ¡(consule)---&gt;result:\" + result); return result; } } 6ã€æµ‹è¯•1ã€å®¢æˆ·ç«¯ 2ã€è®¿é—®http://localhost/consumer/payment/consul 5ã€ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹1ã€CAPCAPç†è®ºå…³æ³¨ç²’åº¦æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯æ•´ä½“ç³»ç»Ÿè®¾è®¡çš„ç­–ç•¥ C:Consistencyï¼ˆå¼ºä¸€è‡´æ€§ï¼‰ A:Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ P:Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ 2ã€CAPå›¾æœ€å¤šåªèƒ½åŒæ—¶è¾ƒå¥½çš„æ»¡è¶³ä¸¤ä¸ªã€‚ CAPç†è®ºçš„æ ¸å¿ƒæ˜¯ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶å¾ˆå¥½çš„æ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªéœ€æ±‚ï¼Œå› æ­¤ï¼Œæ ¹æ® CAP åŸç†å°† NoSQL æ•°æ®åº“åˆ†æˆäº†æ»¡è¶³ CA åŸåˆ™ã€æ»¡è¶³ CP åŸåˆ™å’Œæ»¡è¶³ AP åŸåˆ™ä¸‰ å¤§ç±»ï¼šCA - å•ç‚¹é›†ç¾¤ï¼Œæ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸åœ¨å¯æ‰©å±•æ€§ä¸Šä¸å¤ªå¼ºå¤§ã€‚CP - æ»¡è¶³ä¸€è‡´æ€§ï¼Œåˆ†åŒºå®¹å¿å¿…çš„ç³»ç»Ÿï¼Œé€šå¸¸æ€§èƒ½ä¸æ˜¯ç‰¹åˆ«é«˜ã€‚AP - æ»¡è¶³å¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹å¿æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸å¯èƒ½å¯¹ä¸€è‡´æ€§è¦æ±‚ä½ä¸€äº›ã€‚ 3ã€AP-CPæ¶æ„å›¾1ã€AP(Eureka)APæ¶æ„ å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼Œç³»ç»ŸBå¯ä»¥è¿”å›æ—§å€¼ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ç»“è®ºï¼šè¿èƒŒäº†ä¸€è‡´æ€§Cçš„è¦æ±‚ï¼Œåªæ»¡è¶³å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³AP 2ã€CP(Zookeeper/Consul)CPæ¶æ„ å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œå°±å¿…é¡»æ‹’æ¥è¯·æ±‚ï¼Œå¦åˆ™æ— æ³•ä¿è¯ä¸€è‡´æ€§ç»“è®ºï¼šè¿èƒŒäº†å¯ç”¨æ€§Açš„è¦æ±‚ï¼Œåªæ»¡è¶³ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³CP","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"æœåŠ¡æ³¨å†Œä¸å‘ç°","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"},{"name":"Consul","slug":"Consul","permalink":"https://mykkto.github.io/tags/Consul/"}],"author":"mykk"},{"title":"Springcloud-Zookeeper(å¿«é€Ÿå…¥é—¨)","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/03_SpringCloud-Zookeeper","date":"2022-01-15T15:01:12.000Z","updated":"2023-06-11T02:53:45.173Z","comments":true,"path":"posts/c0125b8a.html","link":"","permalink":"https://mykkto.github.io/posts/c0125b8a.html","excerpt":"","text":"å®‰è£…å‚è€ƒã€åé¢å†™ã€‘https://blog.csdn.net/zhou_fan_xi/article/details/103275955 å®‰è£…å®Œï¼Œwindownè®¿é—®æµ‹è¯• telnet 106.52.23.202 2181 1ã€æ³¨å†Œä¸­å¿ƒZookeeperåŸºæœ¬æ¦‚è¿° zookeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒå·¥å…·ï¼Œå¯ä»¥å®ç°æ³¨å†Œä¸­å¿ƒåŠŸèƒ½ å…³é—­LinuxæœåŠ¡å™¨é˜²ç«å¢™åæ‰èƒ½å¯åŠ¨zookeeperæœåŠ¡å™¨ zookeeperæœåŠ¡å™¨å–ä»£EurekaæœåŠ¡å™¨ï¼Œzkä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒ 2ã€æœåŠ¡æä¾›è€…1ã€å»ºmodelæ–°å»ºcloud-provider-payment8004 2ã€å†™pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-provider-payment8004&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt;&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆzookeeperå®¢æˆ·ç«¯ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt; &lt;!--å…ˆæ’é™¤è‡ªå¸¦çš„zookeeper3.5.3--&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;!--æ·»åŠ zookeeper3.4.9ç‰ˆæœ¬--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.4.9&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€æ”¹yml#8004è¡¨ç¤ºæ³¨å†Œåˆ°zookeeperæœåŠ¡å™¨çš„æ”¯ä»˜æœåŠ¡æä¾›è€…ç«¯å£å· server: port: 8004 #æœåŠ¡åˆ«å----æ³¨å†Œzookeeperåˆ°æ³¨å†Œä¸­å¿ƒåç§° spring: application: name: cloud-provider-payment cloud: zookeeper: connect-string: 106.52.23.202:2181 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @SpringBootApplication @EnableDiscoveryClient//è¯¥æ³¨è§£ç”¨äºå‘ä½¿ç”¨consulæˆ–è€…zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶æ³¨å†ŒæœåŠ¡ public class PaymentMain8004 { public static void main(String[] args) { SpringApplication.run (PaymentMain8004.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import java.util.UUID; @RestController public class PaymentController { @Value(\"${server.port}\") private String serverPort; @RequestMapping(value = \"/payment/zk\") public String paymentzk() { return \"springcloud with zookeeper: \" + serverPort + \"\\t\" + UUID.randomUUID ( ).toString ( ); } } 6ã€å¯åŠ¨8004æ³¨å†Œè¿›zookeeper1ã€liunxå¯åŠ¨ zookeeper#æŸ¥çœ‹æ‰§è¡Œè·¯å¾„ [root@VM-0-13-centos bin]# pwd /root/zookeeper-3.4.9/bin #å¯åŠ¨ [root@VM-0-13-centos bin]# ./zkServer.sh start #åœæ­¢ [root@VM-0-13-centos bin]# ./zkServer.sh stop #é‡å¯ [root@VM-0-13-centos bin]# ./zkServer.sh restart 7ã€æµ‹è¯•1ã€è®¿é—®æœåŠ¡http://localhost:8004/payment/zk 2ã€æŸ¥çœ‹æœåŠ¡ç«¯è¢«æ˜¯å¦è¢«æ³¨å†Œ#è¿›å…¥ zookeeperå®¢æˆ·ç«¯ [root@VM-0-13-centos bin]# ./zkCli.sh WatchedEvent state:SyncConnected type:None path:null #æŸ¥çœ‹åºåˆ— [zk: localhost:2181(CONNECTED) 0] ls /services/cloud-provider-payment [a6293666-45c1-490e-adb8-bee63f121983] #æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ [zk: localhost:2181(CONNECTED) 1] ls /services/cloud-provider-payment/a6293666-45c1-490e-adb8-bee63f121983 [] [zk: localhost:2181(CONNECTED) 2] get /services/cloud-provider-payment/a6293666-45c1-490e-adb8-bee63f121983 {\"name\":\"cloud-provider-payment\",\"id\":\"a6293666-45c1-490e-adb8-bee63f121983\",\"address\":\"FYYX-2020GVNPLA\",\"port\":8004,\"sslPort\":null,\"payload\":{\"@class\":\"org.springframework.cloud.zookeeper.discovery.ZookeeperInstance\",\"id\":\"application-1\",\"name\":\"cloud-provider-payment\",\"metadata\":{}},\"registrationTimeUTC\":1642423897607,\"serviceType\":\"DYNAMIC\",\"uriSpec\":{\"parts\":[{\"value\":\"scheme\",\"variable\":true},{\"value\":\"://\",\"variable\":false},{\"value\":\"address\",\"variable\":true},{\"value\":\":\",\"variable\":false},{\"value\":\"port\",\"variable\":true}]}} 8ã€æ€è€ƒæœåŠ¡èŠ‚ç‚¹æ˜¯ä¸´æ—¶èŠ‚ç‚¹è¿˜æ˜¯æŒä¹…èŠ‚ç‚¹ï¼Ÿï¼Ÿ ï¼ˆ1ï¼‰å½“æˆ‘å…³é—­ 8004èŠ‚ç‚¹åï¼Œzookeeper ä¾æ—§ä¼šæŒç»­å‘å¿ƒè·³ï¼Œå½“æœ‰æ¥æ”¶åˆ°åé¦ˆåˆ™è¿˜æœ‰åºåˆ—å·ï¼Œæ²¡æœ‰åˆ™è¿”å›ç©º[] ï¼ˆ2ï¼‰ç„¶åå†æ¬¡å¯åŠ¨ï¼Œåˆ™è¿”å›ä¸€ä¸ªæ–°çš„åºåˆ—ï¼Œç”±æ­¤è¯´æ˜è¿™æ˜¯ä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ 3ã€æœåŠ¡æ¶ˆè´¹è€…1ã€å»ºmodelæ–°å»ºcloud-consumerzk-order81 2ã€å†™pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumerzk-order81&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆzookeeperå®¢æˆ·ç«¯ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt; &lt;!--å…ˆæ’é™¤è‡ªå¸¦çš„zookeeper--&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;!--æ·»åŠ zookeeper3.4.9ç‰ˆæœ¬--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.4.9&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€æ”¹yml#81è¡¨ç¤ºæ³¨å†Œåˆ°zookeeperæœåŠ¡å™¨çš„æ”¯ä»˜æœåŠ¡æä¾›è€…ç«¯å£å· server: port: 81 #æœåŠ¡åˆ«å----æ³¨å†Œzookeeperåˆ°æ³¨å†Œä¸­å¿ƒåç§° spring: application: name: cloud-consumer-order cloud: zookeeper: connect-string: 106.52.23.202:2181 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @SpringBootApplication @EnableDiscoveryClient public class OrderZK81 { public static void main(String[] args) { SpringApplication.run (OrderZK81.class,args); } } 5ã€ä¸šåŠ¡ç±»1ã€é…ç½®Beanpackage com.kk.springcloud.config; import org.springframework.cloud.client.loadbalancer.LoadBalanced; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.web.client.RestTemplate; @Configuration public class ApplicationContextBean { @Bean @LoadBalanced// ç»™äºˆ RestTemplate è´Ÿè½½å‡è¡¡çš„èƒ½åŠ› public RestTemplate getRestTemplate() { return new RestTemplate ( ); } } 2ã€Controllerpackage com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; @RestController public class OrderZKController81 { public static final String INVOKE_URL = \"http://cloud-provider-payment\"; @Autowired private RestTemplate restTemplate; @RequestMapping(value = \"/consumer/payment/zk\") public String paymentInfo() { String result = restTemplate.getForObject (INVOKE_URL + \"/payment/zk\", String.class); System.out.println (\"æ¶ˆè´¹è€…è°ƒç”¨æ”¯ä»˜æœåŠ¡(zookeeper)---&gt;result:\" + result); return result; } } 6ã€æµ‹è¯•1ã€zookeeper[zk: localhost:2181(CONNECTED) 21] ls /services [cloud-provider-payment, cloud-consumer-order] 2ã€è®¿é—®http://localhost:81/consumer/payment/zk","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"æœåŠ¡æ³¨å†Œä¸å‘ç°","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"},{"name":"Zookeeper","slug":"Zookeeper","permalink":"https://mykkto.github.io/tags/Zookeeper/"}],"author":"mykk"},{"title":"SpringCloud-Eureka","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/02_SpringCloud-Eureka","date":"2022-01-14T14:35:22.000Z","updated":"2023-06-11T02:53:45.158Z","comments":true,"path":"posts/402d692e.html","link":"","permalink":"https://mykkto.github.io/posts/402d692e.html","excerpt":"","text":"1ã€EurekaåŸºç¡€çŸ¥è¯†1ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç† Spring Cloud å°è£…äº† Netflix å…¬å¸å¼€å‘çš„ Eureka æ¨¡å—æ¥å®ç°æœåŠ¡æ²»ç† åœ¨ä¼ ç»Ÿçš„rpcè¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œç®¡ç†æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æœåŠ¡æ²»ç†ï¼Œç®¡ç†æœåŠ¡äºæœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚ 2ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œ1ã€æ¦‚å¿µ Eurekaé‡‡ç”¨äº†CSçš„è®¾è®¡æ¶æ„ï¼ŒEureka Server ä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚è€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨ Eurekaçš„å®¢æˆ·ç«¯è¿æ¥åˆ° Eureka Serverå¹¶ç»´æŒå¿ƒè·³è¿æ¥ã€‚è¿™æ ·ç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡ Eureka Server æ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ åœ¨æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­ï¼Œæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€‚å½“æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰è‡ªå·±æœåŠ¡å™¨çš„ä¿¡æ¯ æ¯”å¦‚ æœåŠ¡åœ°å€é€šè®¯åœ°å€ç­‰ä»¥åˆ«åæ–¹å¼æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šã€‚å¦ä¸€æ–¹ï¼ˆæ¶ˆè´¹è€…|æœåŠ¡æä¾›è€…ï¼‰ï¼Œä»¥è¯¥åˆ«åçš„æ–¹å¼å»æ³¨å†Œä¸­å¿ƒä¸Šè·å–åˆ°å®é™…çš„æœåŠ¡é€šè®¯åœ°å€ï¼Œç„¶åå†å®ç°æœ¬åœ°RPCè°ƒç”¨RPCè¿œç¨‹è°ƒç”¨æ¡†æ¶æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šåœ¨äºæ³¨å†Œä¸­å¿ƒï¼Œå› ä¸ºä½¿ç”¨æ³¨å†Œä¸­å¿ƒç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¸€ä¸ªä¾èµ–å…³ç³»(æœåŠ¡æ²»ç†æ¦‚å¿µ)ã€‚åœ¨ä»»ä½•rpcè¿œç¨‹æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ(å­˜æ”¾æœåŠ¡åœ°å€ç›¸å…³ä¿¡æ¯(æ¥å£åœ°å€)) 2ã€å›¾è§£ 3ã€Eurekaä¸¤ç»„ä»¶1ã€EurekaServeræä¾›æœåŠ¡æ³¨å†ŒæœåŠ¡å„ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹é€šè¿‡é…ç½®å¯åŠ¨åï¼Œä¼šåœ¨EurekaServerä¸­è¿›è¡Œæ³¨å†Œï¼Œè¿™æ ·EurekaServerä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒæœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çœ‹åˆ°ã€‚ 2ã€EurekaClienté€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¿é—®æ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–Eureka Serverçš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢(round-robin)è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨ã€‚åœ¨åº”ç”¨å¯åŠ¨åï¼Œå°†ä¼šå‘Eureka Serverå‘é€å¿ƒè·³(é»˜è®¤å‘¨æœŸä¸º30ç§’)ã€‚å¦‚æœEureka Serveråœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEurekaServerå°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤ï¼ˆé»˜è®¤90ç§’ï¼‰ 2ã€å•æœºEurekaæ„å»ºæ­¥éª¤1ã€eurekaServerç«¯æœåŠ¡æ³¨å†Œä¸­å¿ƒ1ã€å»ºmodelcloud-eureka-server7001 2ã€å†™pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-eureka-server7001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--eureka-server--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--boot web actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬é€šç”¨é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€æ”¹ymlserver: port: 7001 eureka: instance: hostname: localhost #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: #falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚ register-with-eureka: false #falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡ fetch-registry: false service-url: #è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ã€‚ defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/ 4ã€ä¸»å¯åŠ¨@SpringBootApplication @EnableEurekaServer public class EurekaMain7001 { public static void main(String[] args) { SpringApplication.run (EurekaMain7001.class,args); } } 5ã€æµ‹è¯•1ã€è®¿é—®ï¼šhttp://localhost:7001/ 2ã€è¿”å›ç»“æœé¡µé¢ No application available æ²¡æœ‰æœåŠ¡è¢«å‘ç° O(âˆ©_âˆ©)Oå› ä¸ºæ²¡æœ‰æ³¨å†ŒæœåŠ¡è¿›æ¥å½“ç„¶ä¸å¯èƒ½æœ‰æœåŠ¡è¢«å‘ç° 2ã€EurekaClientç«¯provider-80011ã€å»ºmodel(ä¸å˜)cloud-provider-payment8001 2ã€å†™pomï¼ˆå¢åŠ ï¼‰ä»¥å‰è€ç‰ˆæœ¬ï¼Œåˆ«å†ä½¿ç”¨ &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt; &lt;/dependency&gt; ç°åœ¨æ–°ç‰ˆæœ¬,å½“å‰ä½¿ç”¨ &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; 3ã€æ”¹yml(å¢åŠ )eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: defaultZone: http://localhost:7001/eureka 4ã€ä¸»å¯åŠ¨(æ·»åŠ )@EnableEurekaClient 5ã€æµ‹è¯•ï¼ˆ1ï¼‰å…ˆè¦å¯åŠ¨EurekaServerï¼Œå†å¯åŠ¨8001 ï¼ˆ2ï¼‰è®¿é—®ï¼šhttp://localhost:7001/ 6ã€è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ 3ã€EurekaClientç«¯consumer-801ã€å»ºmodelï¼ˆä¸å˜ï¼‰2ã€å†™pomï¼ˆåŒä¸Šï¼‰ &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--å¼•å…¥å…¬å…±éƒ¨åˆ†--&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; 3ã€æ”¹ymlï¼ˆåŒä¸Šï¼‰eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: defaultZone: http://localhost:7001/eureka 4ã€ä¸»å¯åŠ¨ï¼ˆåŒä¸Šï¼‰@SpringBootApplication @EnableEurekaClient public class PaymentMain8001 { public static void main(String[] args) { SpringApplication.run (PaymentMain8001.class, args); } } 5ã€æµ‹è¯•ï¼ˆ1ï¼‰å…ˆè¦å¯åŠ¨EurekaServerï¼Œå†å¯åŠ¨80 ï¼ˆ2ï¼‰è®¿é—®ï¼šhttp://localhost/consumer/payment/get/1 3ã€é›†ç¾¤Eurekaæ„å»ºæ­¥éª¤1ã€Eurekaé›†ç¾¤åŸç†è¯´æ˜1ã€å›¾è§£ 2ã€é—®é¢˜ï¼šå¾®æœåŠ¡RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æœ€æ ¸å¿ƒçš„æ˜¯ä»€ä¹ˆ3ã€è§£å†³æ–¹æ¡ˆï¼šé«˜å¯ç”¨ï¼Œè¯•æƒ³ä½ çš„æ³¨å†Œä¸­å¿ƒåªæœ‰ä¸€ä¸ªonly oneï¼Œä¼šå¯¼è‡´æ•´ä¸ªä¸ºæœåŠ¡ç¯å¢ƒä¸å¯ç”¨ï¼Œæ‰€ä»¥ è§£å†³åŠæ³•ï¼šæ­å»ºEurekaæ³¨å†Œä¸­å¿ƒé›†ç¾¤ ï¼Œå®ç°è´Ÿè½½å‡è¡¡+æ•…éšœå®¹é”™ 2ã€EurekaServeré›†ç¾¤ç¯å¢ƒæ„å»ºæ­¥éª¤1ã€å»ºmodelæ–°å»ºcloud-eureka-server7002ï¼Œå‚è€ƒ7001 2ã€å†™pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-eureka-server7002&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--eureka-server--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--boot web actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬é€šç”¨é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ä¿®é…ç½®ç”±äºæœ¬åœ°ä¸»æœºåªæœ‰ä¸€å°ï¼Œä¸ºäº†æ¨¡æ‹Ÿä¸¤å°ï¼ˆå¤šå°)ï¼Œåˆ™å°† å¤šä¸ªipï¼ˆåŸŸåeureka7001.com,eureka7002.com) æŒ‡å‘æœ¬åœ°(127.0.0.1) 1ã€æ‰¾åˆ°å¯¹åº”çš„é…ç½®ç›®å½•C:\\Windows\\System32\\drivers\\etc 2ã€å†™å…¥é…ç½®æ–‡ä»¶ 127.0.0.1 eureka7001.com127.0.0.1 eureka7002.com 4ã€æ”¹yml1ã€7001server: port: 7001 eureka: instance: hostname: eureka7001.com #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: register-with-eureka: false #falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚ fetch-registry: false #falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡ service-url: defaultZone: http://eureka7002.com:7002/eureka/ 2ã€7002server: port: 7002 eureka: instance: hostname: eureka7002.com #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: register-with-eureka: false #falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚ fetch-registry: false #falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡ service-url: defaultZone: http://eureka7001.com:7001/eureka/ 5ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer; @SpringBootApplication @EnableEurekaServer public class EurekaMain7002 { public static void main(String[] args) { SpringApplication.run (EurekaMain7002.class,args); } } 3ã€æ”¯ä»˜8001å‘å¸ƒåˆ°Eurekaé›†ç¾¤1ã€ä¿®æ”¹ymlä¸»è¦ä¿®æ”¹ä¸€å¤„ï¼šdefaultZone: server: port: 8001 spring: application: name: cloud-payment-service datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: org.gjt.mm.mysql.Driver url: jdbc:mysql://localhost:3306/spring_cloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false username: root password: a1b2c3 eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://localhost:7001/eureka defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka # é›†ç¾¤ç‰ˆ mybatis: mapperLocations: classpath:mapper/*.xml type-aliases-package: com.kk.springclond.entities 4ã€è®¢å•80å‘å¸ƒåˆ°Eurekaé›†ç¾¤1ã€ä¿®æ”¹ymlä¸»è¦ä¿®æ”¹ä¸€å¤„ï¼šdefaultZone: server: port: 80 spring: application: name: cloud-consumer-service eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://localhost:7001/eureka defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka # é›†ç¾¤ç‰ˆ 5ã€æµ‹è¯•æµç¨‹æµ‹è¯•ä»¥ä¸Šé…ç½®æ˜¯å¦ç”Ÿæ•ˆ 1ã€å¯åŠ¨é›†ç¾¤å…ˆè¦å¯åŠ¨EurekaServerï¼Œ7001/7002æœåŠ¡ 2ã€å¯åŠ¨ç”Ÿäº§è€…å†è¦å¯åŠ¨æœåŠ¡æä¾›è€…providerï¼Œ8001 3ã€å¯åŠ¨æ¶ˆè´¹è€…å†è¦å¯åŠ¨æ¶ˆè´¹è€…ï¼Œ80 4ã€æµ‹è¯•http://localhost/consumer/payment/get/1 6ã€æ”¯ä»˜8001é›†ç¾¤æ„å»ºã€8002ã€‘1ã€æ–¹å¼ä¸€ï¼šç›´æ¥æŠŠæ•´ä»½8001 copyå‡ºä¸€ä¸ªæ–°çš„ï¼Œéœ€æ”¹yml ï¼Œportå³å¯ã€æ¨èã€‘ server: port: 8002 2ã€æ–¹å¼äºŒï¼šï¼ˆ1ï¼‰æ‰“å¼€ideaé…ç½®ï¼Œå–æ¶ˆå‹¾é€‰å•ä¸€æœåŠ¡æŒ‰é’® ï¼ˆ2ï¼‰ä¿®æ”¹yml server: port: 8002 ï¼ˆ3ï¼‰å¯åŠ¨ 7ã€è´Ÿè½½å‡è¡¡1ã€è®¢å•80è°ƒç”¨è°ƒæ•´åœ¨è°ƒç”¨çš„æ—¶å€™ä¸èƒ½å†™æ­»æˆip+ç«¯å£ï¼Œéœ€è¦ä½¿ç”¨æœåŠ¡åï¼šcloud-payment-service 2ã€@LoadBalancedæ³¨è§£ä½¿ç”¨@LoadBalancedæ³¨è§£èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡çš„èƒ½åŠ› ä¿®æ”¹é…ç½®ä¿¡æ¯æ·»åŠ æ³¨è§£ã€80ç«¯å£ã€‘ 8ã€æµ‹è¯•è´Ÿè½½å‡è¡¡1ã€å¯åŠ¨é¡ºåºè¯´æ˜ï¼ˆ1ï¼‰å…ˆè¦å¯åŠ¨EurekaServerï¼Œ7001/7002æœåŠ¡ ï¼ˆ2ï¼‰å†è¦å¯åŠ¨æœåŠ¡æä¾›è€…providerï¼Œ8001/8002æœåŠ¡ 2ã€è®¿é—®http://localhost/consumer/payment/get/1 3ã€ç»“æœï¼ˆ1ï¼‰è¾¾åˆ°è´Ÿè½½æ•ˆæœ ï¼ˆ2ï¼‰8001/8002ç«¯å£äº¤æ›¿å‡ºç° 4ã€å°ç»“Ribbonå’ŒEurekaæ•´åˆåConsumerå¯ä»¥ç›´æ¥è°ƒç”¨æœåŠ¡è€Œä¸ç”¨å†å…³å¿ƒåœ°å€å’Œç«¯å£å·ï¼Œä¸”è¯¥æœåŠ¡è¿˜æœ‰è´Ÿè½½åŠŸèƒ½äº† 4ã€actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„1ã€ä¸»æœºåç§°:æœåŠ¡åç§°ä¿®æ”¹1ã€å½“å‰é—®é¢˜å«æœ‰ä¸»æœºååç§° 2ã€ä¿®æ”¹8001instance: instance-id: payment8001 å®Œæ•´ yml server: port: 8001 spring: application: name: cloud-payment-service datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: org.gjt.mm.mysql.Driver url: jdbc:mysql://localhost:3306/spring_cloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false username: root password: a1b2c3 eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://localhost:7001/eureka defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka # é›†ç¾¤ç‰ˆ instance: instance-id: payment8001 mybatis: mapperLocations: classpath:mapper/*.xml type-aliases-package: com.kk.springclond.entities 3ã€æ•ˆæœå…¶å®å°±æ˜¯å–åˆ«å 2ã€è®¿é—®ä¿¡æ¯æœ‰IPä¿¡æ¯æç¤º1ã€é—®é¢˜ï¼šæ²¡æœ‰IPæç¤º 2ã€ä¿®æ”¹8001prefer-ip-address: true #è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºIPåœ°å€ 3ã€æ•ˆæœ 5ã€æœåŠ¡å‘ç°Discovery1ã€æ¦‚è¿°å¯¹äºæ³¨å†Œè¿›eurekaé‡Œé¢çš„å¾®æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡å‘ç°æ¥è·å¾—è¯¥æœåŠ¡çš„ä¿¡æ¯ 2ã€ä¿®æ”¹8001çš„Controller1ã€å¢åŠ @Resource private DiscoveryClient discoveryClient; @Value(\"${server.port}\") private String serverPort; /** * æŸ¥çœ‹æ³¨å†ŒæœåŠ¡çš„ä¿¡æ¯ * @return */ @GetMapping(value = \"/payment/discovery\") public Object discovery() { // ç›®å‰å·²ç»æ³¨å†Œçš„å¾®æœåŠ¡åˆ—è¡¨ List&lt;String&gt; services = discoveryClient.getServices ( ); for (String element : services) { log.info (element); } // æ ¹æ®åç§°è·å–çš„å¾®æœåŠ¡å®ä¾‹ï¼ˆå°±åƒç±»å’Œå¯¹è±¡çš„å…³ç³»ï¼‰ List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances (\"CLOUD-PAYMENT-SERVICE\"); for (ServiceInstance element : instances) { log.info (element.getServiceId ( ) + \"\\t\" + element.getHost ( ) + \"\\t\" + element.getPort ( ) + \"\\t\" + element.getUri ( )); } return this.discoveryClient; } 2ã€å…¨éƒ¨package com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import com.kk.springcloud.service.PaymentService; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Value; import org.springframework.cloud.client.ServiceInstance; import org.springframework.cloud.client.discovery.DiscoveryClient; import org.springframework.web.bind.annotation.*; import javax.annotation.Resource; import java.util.List; @RestController @Slf4j /* * @Description: * @Author: é˜¿K * @CreateDate: 2022/1/16 18:11 * @Param: * @Return: **/ public class PaymentController { @Resource private PaymentService paymentService; @Resource private DiscoveryClient discoveryClient; @Value(\"${server.port}\") private String serverPort; /** * æŸ¥çœ‹æ³¨å†ŒæœåŠ¡çš„ä¿¡æ¯ * * @return */ @GetMapping(value = \"/payment/discovery\") public Object discovery() { // ç›®å‰å·²ç»æ³¨å†Œçš„å¾®æœåŠ¡åˆ—è¡¨ List&lt;String&gt; services = discoveryClient.getServices ( ); for (String element : services) { log.info (element); } // æ ¹æ®åç§°è·å–çš„å¾®æœåŠ¡å®ä¾‹ï¼ˆå°±åƒç±»å’Œå¯¹è±¡çš„å…³ç³»ï¼‰ List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances (\"CLOUD-PAYMENT-SERVICE\"); for (ServiceInstance element : instances) { log.info (element.getServiceId ( ) + \"\\t\" + element.getHost ( ) + \"\\t\" + element.getPort ( ) + \"\\t\" + element.getUri ( )); } return this.discoveryClient; } @PostMapping(value = \"/payment/create\") public CommonResult create(@RequestBody Payment payment) { int result = paymentService.create (payment); log.info (\"*****æ’å…¥ç»“æœ1ï¼š\" + result + \"111\"); if (result &gt; 0) { //æˆåŠŸ return new CommonResult (200, \"æ’å…¥æ•°æ®åº“æˆåŠŸ\", result); } else { return new CommonResult (444, \"æ’å…¥æ•°æ®åº“å¤±è´¥\", null); } } @GetMapping(value = \"/payment/get/{id}\") public CommonResult getPaymentById(@PathVariable(\"id\") Long id) { Payment payment = paymentService.getPaymentById (id); log.info (\"*****æŸ¥è¯¢ç»“æœï¼š\" + payment); if (payment != null) { //è¯´æ˜æœ‰æ•°æ®ï¼Œèƒ½æŸ¥è¯¢æˆåŠŸ return new CommonResult (200, \"æŸ¥è¯¢æˆåŠŸ8081\", payment); } else { return new CommonResult (444, \"æ²¡æœ‰å¯¹åº”è®°å½•ï¼ŒæŸ¥è¯¢IDï¼š\" + id, null); } } } 3ã€8001ä¸»å¯åŠ¨1ã€å¢åŠ @EnableDiscoveryClient 2ã€å…¨éƒ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient// æ­¤æ³¨è§£åæœŸè‹¥æ˜¯ä¸ç”¨ Eurekaï¼Œå°†è¢«ä¸‹æ–¹æ³¨è§£æ‰€ä»£æ›¿ @EnableDiscoveryClient// æœåŠ¡æ³¨å†Œå‘ç° public class PaymentMain8001 { public static void main(String[] args) { SpringApplication.run (PaymentMain8001.class, args); } } 4ã€æµ‹è¯•1ã€å¯åŠ¨é¡ºåºå…ˆè¦å¯åŠ¨EurekaServerï¼Œå†å¯åŠ¨8001ä¸»å¯åŠ¨ç±»ï¼Œéœ€è¦ç¨ç­‰ä¸€ä¼šå„¿ 2ã€è®¿é—®http://localhost:8001/payment/discovery 6ã€Eurekaè‡ªæˆ‘ä¿æŠ¤1ã€æ•…éšœç°è±¡ä¿æŠ¤æ¨¡å¼ä¸»è¦ç”¨äºä¸€ç»„å®¢æˆ·ç«¯å’ŒEureka Serverä¹‹é—´å­˜åœ¨ç½‘ç»œåˆ†åŒºåœºæ™¯ä¸‹çš„ä¿æŠ¤ã€‚ä¸€æ—¦è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼ŒEureka Serverå°†ä¼šå°è¯•ä¿æŠ¤å…¶æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†åˆ é™¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šæ³¨é”€ä»»ä½•å¾®æœåŠ¡ã€‚ å¦‚æœåœ¨Eureka Serverçš„é¦–é¡µçœ‹åˆ°ä»¥ä¸‹è¿™æ®µæç¤ºï¼Œåˆ™è¯´æ˜Eurekaè¿›å…¥äº†ä¿æŠ¤æ¨¡å¼ï¼šEMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEYâ€™RE NOT.RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE 2ã€å¯¼è‡´åŸå› æ­¤ä¸¾å±äºCAPé‡Œé¢çš„APåˆ†æ”¯ ä¸€å¥è¯ï¼šæŸæ—¶åˆ»æŸä¸€ä¸ªå¾®æœåŠ¡ä¸å¯ç”¨äº†ï¼ŒEurekaä¸ä¼šç«‹åˆ»æ¸…ç†ï¼Œä¾æ—§ä¼šå¯¹è¯¥å¾®æœåŠ¡çš„ä¿¡æ¯è¿›è¡Œä¿å­˜ 1ã€é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆä¼šäº§ç”ŸEurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Ÿ ä¸ºäº†é˜²æ­¢EurekaClientå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ ä¸ EurekaServerç½‘ç»œä¸é€šæƒ…å†µä¸‹ï¼ŒEurekaServerä¸ä¼šç«‹åˆ»å°†EurekaClientæœåŠ¡å‰”é™¤ 2ã€é—®é¢˜äºŒï¼šä»€ä¹ˆæ˜¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Ÿ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœEurekaServeråœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡å®ä¾‹çš„å¿ƒè·³ï¼ŒEurekaServerå°†ä¼šæ³¨é”€è¯¥å®ä¾‹ï¼ˆé»˜è®¤90ç§’ï¼‰ã€‚ä½†æ˜¯å½“ç½‘ç»œåˆ†åŒºæ•…éšœå‘ç”Ÿ(å»¶æ—¶ã€å¡é¡¿ã€æ‹¥æŒ¤)æ—¶ï¼Œå¾®æœåŠ¡ä¸EurekaServerä¹‹é—´æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œä»¥ä¸Šè¡Œä¸ºå¯èƒ½å˜å¾—éå¸¸å±é™©äº†â€”â€”å› ä¸ºå¾®æœåŠ¡æœ¬èº«å…¶å®æ˜¯å¥åº·çš„ï¼Œæ­¤æ—¶æœ¬ä¸åº”è¯¥æ³¨é”€è¿™ä¸ªå¾®æœåŠ¡ã€‚Eurekaé€šè¿‡â€œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”å½“EurekaServerèŠ‚ç‚¹åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶ï¼ˆå¯èƒ½å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºæ•…éšœï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚ 3ã€æ€ä¹ˆç¦æ­¢è‡ªæˆ‘ä¿æŠ¤1ã€æ³¨å†Œä¸­å¿ƒ7001ï¼ˆ1ï¼‰å‡ºå‚é»˜è®¤ï¼Œè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶æ˜¯å¼€å¯çš„ eureka.server.enable-self-preservation=true ï¼ˆ2ï¼‰ä½¿ç”¨eureka.server.enable-self-preservation = false å¯ä»¥ç¦ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ server: port: 7001 eureka: instance: hostname: eureka7001.com #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: register-with-eureka: false #falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚ fetch-registry: false #falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡ service-url: defaultZone: http://eureka7002.com:7002/eureka/ server: #å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä¿è¯ä¸å¯ç”¨æœåŠ¡è¢«åŠæ—¶è¸¢é™¤ enable-self-preservation: false eviction-interval-timer-in-ms: 2000 ï¼ˆ3ï¼‰æ•ˆæœ 2ã€ç”Ÿäº§è€…80011ã€é»˜è®¤ï¼ˆ1ï¼‰å•ä½ä¸ºç§’(é»˜è®¤æ˜¯30ç§’) eureka.instance.lease-renewal-interval-in-seconds=30 ï¼ˆ2ï¼‰å•ä½ä¸ºç§’(é»˜è®¤æ˜¯90ç§’) eureka.instance.lease-expiration-duration-in-seconds=90 2ã€é…ç½® server: port: 8001 spring: application: name: cloud-payment-service datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: org.gjt.mm.mysql.Driver url: jdbc:mysql://localhost:3306/spring_cloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false username: root password: a1b2c3 eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://localhost:7001/eureka defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka # é›†ç¾¤ç‰ˆ instance: instance-id: payment8001 prefer-ip-address: true #è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºIPåœ°å€ #å¿ƒè·³æ£€æµ‹ä¸ç»­çº¦æ—¶é—´ #å¼€å‘æ—¶è®¾ç½®å°äº›ï¼Œä¿è¯æœåŠ¡å…³é—­åæ³¨å†Œä¸­å¿ƒèƒ½å³ä½¿å‰”é™¤æœåŠ¡ #Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯30ç§’) lease-renewal-interval-in-seconds: 1 #EurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯90ç§’)ï¼Œè¶…æ—¶å°†å‰”é™¤æœåŠ¡ lease-expiration-duration-in-seconds: 2 mybatis: mapperLocations: classpath:mapper/*.xml type-aliases-package: com.kk.springclond.entities 3ã€æµ‹è¯•ï¼ˆ1ï¼‰å…ˆå¯åŠ¨7001ï¼Œåœ¨å¯åŠ¨8001 ï¼ˆ2ï¼‰å†å…³é—­8001ï¼Œå‘ç°æœåŠ¡å·²ç»è¢«åˆ é™¤äº† 7ã€Eurekaåœæ›´``https://github.com/Netflix/eureka/wiki` æŠ€æœ¯é€‰å‹å¯ä»¥è€ƒè™‘ zookeeperã€nacos(alibaba)","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"æœåŠ¡æ³¨å†Œä¸å‘ç°","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"},{"name":"Eureka","slug":"Eureka","permalink":"https://mykkto.github.io/tags/Eureka/"}],"author":"mykk"},{"title":"SpringCloud é¡¹ç›®æ„å»º and æŠ€æœ¯é€‰å‹","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/01_SpringCloud-Build","date":"2022-01-12T15:42:15.000Z","updated":"2023-06-11T02:53:45.171Z","comments":true,"path":"posts/9df20094.html","link":"","permalink":"https://mykkto.github.io/posts/9df20094.html","excerpt":"","text":"1ã€ç‰ˆæœ¬ 2ã€å®˜ç½‘åœ°å€ã€Spring Cloudã€‘1ã€è‹±æ–‡https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/ 2ã€ä¸­æ–‡https://www.bookstack.cn/read/spring-cloud-docs/docs-index.md 3ã€springboothttps://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/htmlsingle/ 3ã€é¡¹ç›®æ­å»º-çˆ¶å·¥ç¨‹æ„å»º çˆ¶å·¥ç¨‹åæ ‡ &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;!-- ç»Ÿä¸€ç®¡ç†jaråŒ…ç‰ˆæœ¬ --&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;junit.version&gt;4.12&lt;/junit.version&gt; &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt; &lt;lombok.version&gt;1.16.18&lt;/lombok.version&gt; &lt;mysql.version&gt;5.1.47&lt;/mysql.version&gt; &lt;druid.version&gt;1.1.16&lt;/druid.version&gt; &lt;mybatis.spring.boot.version&gt;1.3.0&lt;/mybatis.spring.boot.version&gt; &lt;/properties&gt; &lt;!-- å­æ¨¡å—ç»§æ‰¿ä¹‹åï¼Œæä¾›ä½œç”¨ï¼šé”å®šç‰ˆæœ¬+å­modlueä¸ç”¨å†™groupIdå’Œversion --&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!--spring boot 2.2.2--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;2.2.2.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--spring cloud Hoxton.SR1--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;Hoxton.SR1&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;2.1.0.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;${mysql.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;${druid.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${mybatis.spring.boot.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;${junit.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;${log4j.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;${lombok.version}&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;fork&gt;true&lt;/fork&gt; &lt;addResources&gt;true&lt;/addResources&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 4ã€é¡¹ç›®æ­å»º-Restå¾®æœåŠ¡å·¥ç¨‹æ„å»º1ã€åæ ‡&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-provider-payment8001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-jdbc --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 2ã€ymlserver: port: 8001 spring: application: name: cloud-payment-service datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: org.gjt.mm.mysql.Driver url: jdbc:mysql://localhost:3306/spring_cloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false username: root password: a1b2c3 mybatis: mapperLocations: classpath:mapper/*.xml type-aliases-package: com.kk.springclond.entities 3ã€ä¸»å¯åŠ¨@SpringBootApplication public class PaymentMain8001 { public static void main(String[] args) { SpringApplication.run (PaymentMain8001.class, args); } } 4ã€ä¸šåŠ¡ç±»1ã€å»ºè¡¨CREATE TABLE `payment` ( `id` bigint NOT NULL AUTO_INCREMENT , `serial` varchar(255) NULL , PRIMARY KEY (`id`) ) 2ã€å®ä½“ï¼ˆentityï¼‰ï¼ˆ1ï¼‰é€šç”¨è¿”å›ç»“æœå®ä½“@Data @AllArgsConstructor @NoArgsConstructor public class CommonResult&lt;T&gt; { private Integer code; private String message; private T data; public CommonResult(Integer code, String message) { this(code,message,null); } } ï¼ˆ2ï¼‰Payment@Data @AllArgsConstructor @NoArgsConstructor public class Payment { private Long id; private String serial; } 3ã€daoå±‚1ã€æ¥å£PaymentDaoç¼–å†™package com.kk.springcloud.dao; import com.kk.springcloud.entities.Payment; import org.apache.ibatis.annotations.Mapper; import org.apache.ibatis.annotations.Param; @Mapper public interface PaymentDao { public int create(Payment payment); //å†™ public Payment getPaymentById(@Param(\"id\") Long id); //è¯»å– } 2ã€mybatisçš„æ˜ å°„æ–‡ä»¶PaymentMapper.xmlï¼ˆ1ï¼‰è·¯å¾„src\\main\\resources\\mapper\\PaymentMapper.xml ï¼ˆ2ï¼‰å¤´æ–‡ä»¶&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt; &lt;mapper namespace=\"com.kk.springcloud.dao.PaymentDao\"&gt; &lt;insert id=\"create\" parameterType=\"com.kk.springcloud.entities.Payment\" useGeneratedKeys=\"true\" keyProperty=\"id\"&gt; insert into payment(serial) values(${serial}); &lt;/insert&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.kk.springcloud.entities.Payment\"&gt; &lt;id column=\"id\" property=\"id\" jdbcType=\"BIGINT\"&gt;&lt;/id&gt; &lt;id column=\"serial\" property=\"serial\" jdbcType=\"VARCHAR\"&gt;&lt;/id&gt; &lt;/resultMap&gt; &lt;select id=\"getPaymentById\" parameterType=\"Long\" resultMap=\"BaseResultMap\"&gt; select * from payment where id=#{id} &lt;/select&gt; &lt;/mapper&gt; 4ã€service1ã€æ¥å£package com.kk.springcloud.service; import com.kk.springcloud.entities.Payment; import org.apache.ibatis.annotations.Param; public interface PaymentService { public int create(Payment payment); //å†™ public Payment getPaymentById(@Param(\"id\") Long id); //è¯»å– } 2ã€å®ç°ç±»package com.kk.springcloud.service.impl; import com.kk.springcloud.dao.PaymentDao; import com.kk.springcloud.entities.Payment; import com.kk.springcloud.service.PaymentService; import org.springframework.stereotype.Service; import javax.annotation.Resource; @Service public class PaymentServiceImpl implements PaymentService { @Resource private PaymentDao paymentDao; public int create(Payment payment) { return paymentDao.create (payment); } public Payment getPaymentById(Long id) { return paymentDao.getPaymentById (id); } } 5ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import com.kk.springcloud.service.PaymentService; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController @Slf4j public class PaymentController { @Resource private PaymentService paymentService; @PostMapping(value = \"/payment/create\") public CommonResult create(Payment payment) { int result = paymentService.create (payment); log.info (\"*****æ’å…¥ç»“æœï¼š\" + result); if (result &gt; 0) { //æˆåŠŸ return new CommonResult (200, \"æ’å…¥æ•°æ®åº“æˆåŠŸ\", result); } else { return new CommonResult (444, \"æ’å…¥æ•°æ®åº“å¤±è´¥\", null); } } @GetMapping(value = \"/payment/get/{id}\") public CommonResult getPaymentById(@PathVariable(\"id\") Long id) { Payment payment = paymentService.getPaymentById (id); log.info (\"*****æŸ¥è¯¢ç»“æœï¼š\" + payment); if (payment != null) { //è¯´æ˜æœ‰æ•°æ®ï¼Œèƒ½æŸ¥è¯¢æˆåŠŸ return new CommonResult (200, \"æŸ¥è¯¢æˆåŠŸ\", payment); } else { return new CommonResult (444, \"æ²¡æœ‰å¯¹åº”è®°å½•ï¼ŒæŸ¥è¯¢IDï¼š\" + id, null); } } } 5ã€æµ‹è¯•1ã€æ’å…¥ï¼šä½¿ç”¨postè¯·æ±‚æ‰èƒ½è¢«æ’å…¥ï¼Œæ‰€ä»¥åœ¨urlä¸Šæ— æ•ˆï¼Œå¯ä»¥ä½¿ç”¨postmanhttp://localhost:8001/payment/create?serial=mykk02 2ã€æŸ¥è¯¢ï¼šgetè¯·æ±‚ï¼Œurlï¼Œpostmançš†å¯http://localhost:8001/payment/get/1 5ã€çƒ­éƒ¨ç½²1ã€å­å·¥ç¨‹ pomä¸Šé¢çš„ä¾èµ–å·²ç»æœ‰åŠ äº†ï¼Œæ˜¯è¿™ä¸ª 2ã€çˆ¶å·¥ç¨‹ pomæ’ä»¶ä¸Šé¢çš„ä¾èµ–å·²ç»æœ‰åŠ äº†ï¼Œæ˜¯è¿™ä¸ª 3ã€è®¾ç½®è‡ªåŠ¨ç¼–è¯‘ 4ã€å¼€å¯è‡ªåŠ¨æ›´æ–°1ã€æ‰“å¼€è®¾ç½®é¢æ¿ctrl + shift + alt + /åŒæ—¶æŒ‰ä½ï¼Œç‚¹å‡»ç¬¬ä¸€ä¸ªRegistry... 2ã€ä¸¤ä¸ªæ‰“å‹¾ 5ã€é‡å¯ IDEA6ã€é¡¹ç›®æ­å»º-Orderè®¢å•å¾®æœåŠ¡æ„å»º1ã€åæ ‡&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumer-order80&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 2ã€ymlserver: port: 80 3ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class OrderMain80 { public static void main(String[] args) { SpringApplication.run (OrderMain80.class,args); } } 4ã€ä¸šåŠ¡ç±»1ã€åˆ›å»ºentities å°†cloud-provider-payment8001å·¥ç¨‹ä¸‹çš„entitiesåŒ…ä¸‹çš„ä¸¤ä¸ªå®ä½“ç±»å¤åˆ¶è¿‡æ¥ 2ã€RestTemplate1ã€å®˜ç½‘ï¼š https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html 2ã€æ˜¯ä»€ä¹ˆ 3ã€æ€ä¹ˆç”¨ 3ã€é…ç½®ç±»ApplicationContextConfig package com.kk.springcloud.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.web.client.RestTemplate; @Configuration public class ApplicationContextConfig { @Bean public RestTemplate getRestTemplate(){ return new RestTemplate(); } } 4ã€åˆ›å»º controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; @RestController @Slf4j public class OrderController { public static final String PAYMENT_URL = \"http://localhost:8001\"; @Resource private RestTemplate restTemplate; @GetMapping(\"/consumer/payment/create\") public CommonResult&lt;Payment&gt; create(Payment payment) { return restTemplate.postForObject (PAYMENT_URL + \"/payment/create\", payment, CommonResult.class); //å†™æ“ä½œ } @GetMapping(\"/consumer/payment/get/{id}\") public CommonResult&lt;Payment&gt; getPayment(@PathVariable(\"id\") Long id) { return restTemplate.getForObject (PAYMENT_URL + \"/payment/get/\" + id, CommonResult.class); } } 5ã€æµ‹è¯•1ã€å…ˆå¯åŠ¨cloud-provider-payment80012ã€å†å¯åŠ¨cloud-consumer-order803ã€æµ‹è¯•æ¶ˆè´¹è€…æ¥å£http://localhost/consumer/payment/get/1 æ³¨æ„ç‚¹ï¼šè¢«è°ƒç”¨çš„ç”Ÿäº§è€…æ¥å£ä¼ å‚è®°å¾—åŠ æ³¨è§£ 7ã€é¡¹ç›®é‡æ„1ã€è§‚å¯Ÿé—®é¢˜1ã€ç³»ç»Ÿä¸­æœ‰é‡å¤éƒ¨åˆ†ï¼Œé‡æ„ 2ã€æ–°å»ºå…¬å…±æ¨¡å—ã€cloud-api-commonsã€‘1ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/cn.hutool/hutool-all --&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;5.1.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 2ã€å®ä½“å°†è®¢å•æ¨¡å—å’Œæ”¯ä»˜æ¨¡å—å…¬å…±å®ä½“æ”¾åˆ°è¿™é‡Œ 3ã€æ”¹é€ è®¢å•å’Œæ”¯ä»˜1ã€åˆ é™¤å„è‡ªçš„åŸå…ˆæœ‰è¿‡çš„entitiesæ–‡ä»¶å¤¹2ã€å„è‡ªåˆ†åˆ«å¼•å…¥å…¬å…±æ¨¡å—&lt;!--å¼•å…¥å…¬å…±éƒ¨åˆ†--&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; 7ã€é¡¹ç›®æ¨¡å—ç»“æ„å›¾","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æ­å»º","slug":"æ­å»º","permalink":"https://mykkto.github.io/tags/%E6%90%AD%E5%BB%BA/"}],"author":"mykk"},{"title":"å—åŸæ•…äºº","slug":"02-æŠ€æœ¯ä¹‹å¤–/01-æ®µå­/01_nanchengguren","date":"2022-01-10T17:33:22.000Z","updated":"2022-01-11T12:37:38.397Z","comments":true,"path":"posts/f2c0d8e3.html","link":"","permalink":"https://mykkto.github.io/posts/f2c0d8e3.html","excerpt":"","text":"æ‘˜è‡ªï¼šå—åŸæ•…äºº ç¬¬8æœŸå†…å®¹ï¼š 18å²ï¼Œä½ è¯»äº†å¤§å­¦ã€‚20å²ï¼Œä½ å¤§äºŒç»“æŸï¼Œå¼€å§‹æ‚”æ¨è‡ªå·±å‰ä¸¤å¹´å¹¼ç¨šçš„è¡Œä¸ºäºæ˜¯å¼€å§‹åŠªåŠ›22å²ä½ å¤§å­¦æ¯•ä¸šäº†ï¼Œå´å‘ç°æ‰¾ä¸åˆ°ä¸€ä»½ä»¤è‡ªå·±æ»¡æ„çš„å·¥ä½œ26å²ï¼Œä½ çœ‹ç€èº«è¾¹çš„äººéƒ½ç»“äº†å©šå©šç¤¼çš„ä»½å­é’±é€å¹´é€’å¢æ˜¥èŠ‚å›å®¶ï¼Œçˆ¶æ¯ä»å¸¦ä½ ä¸²äº²æˆšå˜æˆäº†å¸¦ä½ å»è§ç›¸äº²å¯¹è±¡è§äº†åå‡ ä¸ªå§‘å¨˜ä½ æ¯æ¬¡éƒ½è§‰å¾—å’Œé‚£ä¸ªå¥¹æ¯”å·®äº†ä¸€ç‚¹28å²é‚£å¹´ï¼Œä½ é‡åˆ°äº†ä¸€ä¸ªå’Œä½ é­é‡å·®ä¸å¤šçš„å§‘å¨˜ä½ ä»¬æœ‰ä¸€æ­æ²¡ä¸€æ­çš„èŠç€å¥¹è¯´ï¼šä½ è¿˜ä¸é”™ä½ å–äº†ä¸€å£å¯ä¹è¯´ï¼šä½ ä¹Ÿæ˜¯ä½ è¿˜ä¸ç¡®å®šå–œä¸å–œæ¬¢å¥¹åŒæ–¹å®¶é•¿å°±å·²ç»æ‘†å¥½äº†è®¢å©šå®´ç»“å©šçš„å‰ä¸€å‘¨ï¼Œä½ å’Œæœ‹å‹å‡ºå»å–é…’ä½ è¯´ï¼Œä¸æƒ³ç»“å©šæœ‹å‹è¯´ï¼Œä½ å•Šï¼Œå°±æ˜¯æƒ³å¤ªå¤šã€‚è°ä¸æ˜¯è¿™ä¹ˆè¿‡æ¥çš„ï¼Ÿ 29å²ï¼Œä½ ä»¬ç»ˆäºç»“äº†å©šå©šç¤¼åŠçš„ä¸å¤§ä¸å°ï¼Œæœ‹å‹æ¥çš„ä¸å¤šä¸å°‘æ”’äº†å‡ å¹´æƒ³è¦å»å®ç°ç†æƒ³çš„é’±æ­åœ¨äº†è¿™ä¸€åœºç™¾äººçš„ç§äººåº™ä¼šä¸Šå©šç¤¼è¿›è¡Œåˆ°ä¸­é—´å¸ä»ªå¸¦ç€æ ‡å‡†çš„å•†ä¸šåŒ–å¾®ç¬‘å¯¹ç€å°ä¸‹çš„äº²æœ‹å–Šé“è¦ä¸è¦è®©ä»–ä»¬äº²ä¸€ä¸ªï¼å°ä¸‹é‚£äº›äººè·Ÿç€ä¸€èµ·èµ·å“„ä¸çŸ¥é“ä¸ºä»€ä¹ˆä½ ç®€ç®€å•å•çš„äº²äº†ä¸€å£ä¿©äººæ¢å¤åˆ°äº†ä¸€å¼€å§‹çš„ç«™ä½ä½ å°å£°è¯´äº†ä¸€å¥ï¼šæˆ‘çˆ±ä½ é‚£ä¸ªæ˜¨å¤©è¿˜çœ‹ä¸æƒ¯ä½ å€’è…¾æ¨¡å‹çš„æ–°å¨˜æ„£äº†ä¸€ä¸‹è¯´ï¼šæˆ‘ä¹Ÿçˆ±ä½ ä½ ä¸ç¡®å®šå¥¹æ˜¯ä¸æ˜¯å¯¹ä½ è¯´çš„å°±åƒä½ ä¸ç¡®å®šæ˜¯ä¸æ˜¯å¯¹å¥¹è¯´çš„ä¸€æ ·å©šç¤¼ç»“æŸåï¼Œå¹¶æ²¡æœ‰ä½ æƒ³è±¡çš„æµªæ¼«ä½ å¬ç€å¤–å±‹çš„æ–°å¨˜ä¸€ç¬”ä¸€ç¬”çš„ç®—ç€ä»½å­é’±æƒ³ç€ä¸è¿‡æ‰ä¸¤å¹´ï¼Œæ€ä¹ˆå°±å˜æˆè¿™æ ·äº†æƒ³ç€æƒ³ç€ï¼Œæ´æˆ¿å¤œå°±ç¡ç€äº† 30å²ï¼Œå¥¹æ€€å­•äº†è¾æ‰äº†å·¥ä½œï¼Œåœ¨å®¶å…»èƒä½ åœ¨å…¬å¸é€æ¸æœ‰äº†ç‚¹åœ°ä½æ‰‹é‡Œç®¡ç€åæ¥ä¸ªäººç‹¬ç«‹è´Ÿè´£ä¸€ä¸ªé¡¹ç›®ç»“å©šå‰é™ªå«çš„é‚£è¾†20ä¸‡å·¦å³çš„è½¦ä¹Ÿå˜æˆäº†ä½ ä¸€ä¸ªäººçš„ç‹¬äº«ä½†ä½ ä¾ç„¶ä¸æ•¢æ”¾æ¾æ¯æ¬¡åŠ ç­ç”µè¯é‚£å¤´éƒ½æ˜¯æŠ±æ€¨ä¸å§”å±ˆä½†ä½ ä¸èƒ½äº‰è¾©ä»€ä¹ˆè°è®©å¥¹æ€€äº†ä½ çš„å­©å­åœ¨è¿™ä¸€åˆ»ä¸è®ºæ˜¯å¥¹çš„çˆ¶æ¯è¿˜æ˜¯ä½ çš„çˆ¶æ¯éƒ½æ— æ¡ä»¶çš„ç«™åœ¨è¿™ä¸€è¾¹31å²ï¼Œå­©å­è½åœ°äº†å‰å‰ååè¿å­•æ£€å¸¦ä½é™¢è´¹èŠ±äº†10ä¸‡å—é’±ä¸è¿‡æ— æ‰€è°“ä½ çœ‹ç€ä½ çš„å­©å­ï¼Œæ€ä¹ˆçœ‹æ€ä¹ˆå–œæ¬¢é«˜å…´çš„ä»¿ä½›è¿™æ˜¯ä½ çš„æ–°ç”Ÿ32å²ï¼Œè¿™æ˜¯äººç”Ÿæœ€ä¸æ„¿æ„é‡å¤çš„ä¸€å¹´å¹³å‡ç¡çœ 3å°æ—¶å­©å­æ¯ä¸€ä¸ªå°æ—¶éƒ½è¦é—¹è…¾ä¸€æ¬¡ç¬¬äºŒå¤©æ‹–ç€ç¡ä¸é†’çš„çœ¼ç›å»ä¸Šç­è€æ¿è¯´ä½ ä¸Šç­ä¸å¹²æ´»å›å®¶åª³å¦‡è¯´ä½ ä¸å¹²æ´»ä½ æƒ³äº†åŠå¤©ä¸æ˜ç™½ï¼Œé‚£è°å¹²æ´»å‘¢ï¼Ÿé‚£è¾†å¼€äº†3å¹´çš„è½¦æˆä¸ºäº†ä½ çœŸæ­£çš„å®¶ä½ ä¸åœ¨æŠ±æ€¨è·¯ä¸Šæ‹¥å µçš„äº¤é€šä½ ç”šè‡³å¼€å§‹å¸Œæœ›å†å¤šå µä¸€ä¼šå›åˆ°å®¶ï¼Œä½ å…³äº†å‘åŠ¨æœºåœ¨è½¦ä¸Šç‚¹äº†ä¸€æ ¹çƒŸè¿™æ˜¯ä½ æ¯å¤©æœ€å¹¸ç¦çš„ååˆ†é’Ÿè½¦å‰æ˜¯åŠŸååˆ©ç¦„ï¼Œè½¦å°¾æ˜¯æŸ´ç±³æ²¹ç› 35å² ä½ å› ä¸ºèº«ä½“è¶Šæ¥è¶Šå·®åŠ ç­è¶Šæ¥è¶Šå°‘æ™‹å‡çš„é€Ÿåº¦ä¹Ÿè¶Šæ¥è¶Šç¼“æ…¢é‚£å¤©ä¸‹ç­ï¼Œåª³å¦‡å‘Šè¯‰ä½ å­©å­è¦ä¸Šå¹¼å„¿å›­äº†åŒè¯­çš„ä¸€ä¸ªæœˆ3000ä½ çš±äº†çš±çœ‰å¤´ï¼Œé‚£è¾¹å°±å·²ç»ä¸è€çƒ¦äº†â€œå››å•å…ƒçš„è€ç‹å®¶å­©å­ï¼Œä¸€ä¸ªæœˆ6000â€â€œä½ å·²ç»è¿™æ ·äº†ï¼Œä½ æƒ³è®©å­©å­ä¹Ÿè¾“ï¼Ÿâ€ä½ æ²¡è¯´è¯ï¼Œå›å±‹ç»™åª³å¦‡è½¬äº†6000å—é’±è¿™ç¬”é’±ï¼Œä½ åŸæœ¬æ‰“ç®—ç»™è‡ªå·±è¿‡ä¸ªç”Ÿæ—¥ï¼Œä¹°ä¸ªæ–°ç”µè„‘ 38å²ï¼Œå­©å­ä¸Šäº†ä¸€å¹´çº§è€å¸ˆè¯´ä¸€å¹´çº§æœ€å…³é”®ï¼Œæ‰“å¥½åŸºç¡€å¾ˆé‡è¦ä½ ç¬‘ç€è¯´ï¼Œæ˜¯æ˜¯æ˜¯ï¼Œè€å¸ˆæ‚¨å¤šç…§é¡¾æ–°ç”Ÿæ¥å¾…çš„è€å¸ˆçœ‹ç€ä½ ä¸æ˜äº‹ç†çš„è„¸ç»™ä½ æŒ‡äº†ä¸€æ¡æ˜è·¯â€œè¯¾å¤–è¾…å¯¼ç­ï¼Œä¸€ä¸ªæœˆ2200â€40å²çš„æ—¶å€™ï¼Œå­©å­ä¸Šäº†ä¸‰å¹´çº§è€å¸ˆè¯´ï¼Œä¸‰å¹´çº§ï¼Œæœ€å…³é”®ï¼Œæ‰¿ä¸Šå¯ä¸‹å¾ˆé‡è¦ä½ ç¬‘ç€è¯´ï¼šæ˜¯æ˜¯æ˜¯ï¼Œæ­£æ‰“ç®—å†æŠ¥ä¸ªè¡¥ä¹ ç­ 44å²ï¼Œå­©å­ä¸Šäº†åˆä¸­æœ‰ä¸€å¤©å›åˆ°å®¶ï¼Œå¥¹å¯¹ä½ è¯´çˆ¸çˆ¸ï¼Œæˆ‘æƒ³å­¦é’¢ç´ä½ æ²¡ä»€ä¹ˆçŠ¹è±«çš„ä½ ä»¥ä¸ºè¿™äº›å¹´ï¼Œä½ å·²ç»ä¹ æƒ¯äº†ä½†é‚£å¥â€œçˆ¸çˆ¸ç°åœ¨ä¹°ä¸èµ·â€ä½ å§‹ç»ˆè¯´ä¸å‡ºå£å¥½åœ¨å­©å­æ¯”è¾ƒæ‡‚äº‹å¥¹è¯´ï¼šçˆ¸çˆ¸æ²¡äº‹ï¼Œè¦ä¸æˆ‘å…ˆå­¦é™¶ç¬›ä¹Ÿå¯ä»¥ä½ çœ‹ç€è¿™ä¹ˆæ‡‚äº‹çš„å­©å­ï¼Œå´å¼€å¿ƒä¸èµ·æ¥ 46å²ï¼Œå­©å­ä¸Šäº†ä¸€ä¸ªä¸å¥½ä¸å·®çš„é«˜ä¸­æœ‰ä¸€å¤©ä½ åœ¨å¼€ä¼šï¼Œæ¥åˆ°äº†è€å¸ˆçš„ç”µè¯ç”µè¯é‡Œè¯´ä½ çš„å­©å­åœ¨å­¦æ ¡æ‰“æ¶äº†å«ä½ å»ä¸€è¶Ÿä½ å”¯å”¯è¯ºè¯ºçš„å’Œé‚£ä¸ªæ¯”ä½ è¿˜å°5å²çš„é¢†å¯¼è¯·äº†ä¸ªå‡åˆ°å­¦æ ¡åˆè¢«è€å¸ˆè®­äº†ä¸€é€šæ— éå°è¯å°±æ˜¯é‚£ä¸€å¥ä½ ä»¬åšå®¶é•¿çš„å°±çŸ¥é“å·¥ä½œï¼Œèƒ½ä¸èƒ½é™ªé™ªå­©å­ä½ çœ‹ç€è¿™ä¸ªè€å¸ˆï¼Œæœ‰ç‚¹å¯ç¬‘å¥½åƒå½“æ—¶è¯´ï¼šå®¶é•¿åœ¨å¤–è¾›è‹¦ç‚¹å¤šèµšç‚¹é’±è®©å­©å­å¤šè¡¥è¡¥è¯¾çš„å’Œä»–ä¸æ˜¯ä¸€ä¸ªäºº 50å²ï¼Œå­©å­ä¸Šäº†å¤§å­¦å¾ˆäº‰æ°”ï¼Œæ˜¯ä¸€ä¸ªä¸€æœ¬ä»–å­¦çš„ä¸“ä¸šä½ æœ‰ç‚¹çœ‹ä¸æ‡‚ä½ åªçŸ¥é“å·¥ä½œä¸ä¸€å®šå¥½æ‰¾è€Œä¸”å­¦è´¹è¿˜æ­»è´µä½ å’Œä»–æ·±å¤œæƒ³èŠèŠå‡†å¤‡äº†åŠæ–¤ç™½é…’ï¼Œä¸€ç¢ŸèŠ±ç”Ÿç±³ä½ è¯´ç€é‚£äº›æ›¾ç»ä½ æœ€è®¨åŒçš„è¯è¿˜æ˜¯è¦ä¸ºä»¥åå·¥ä½œç€æƒ³æŒ‘ä¸ªçƒ­é—¨çš„ä¸“ä¸šæ´»ç€æ¯”çƒ­çˆ±é‡è¦ä½ ä»¬ä»äº¤æµå˜æˆäº†äº‰åµä½ å‘ç°ï¼Œä½ è€äº†è€åˆ°å¯èƒ½éƒ½æ‰“ä¸è¿‡è¿™ä¸ª18å²çš„å­©å­ä½ è¯´ä¸è¿‡ä»–ï¼Œåªèƒ½è¯´ä¸€å¥ï¼šæˆ‘æ˜¯ä½ çˆ¸çˆ¸ï¼å­©å­çœ‹ç€ä½ ï¼ŒçŸ¥é“å†æ€ä¹ˆäº‰è¾©éƒ½æ²¡ç”¨è¿™åœºç¡®ç«‹ä½ æœ€åå¨ä¸¥çš„é…’å±€ä¸æ¬¢è€Œæ•£ä½ å¬çš„ä¸çœŸåˆ‡åœ¨å­©å­å›è‡ªå·±å±‹çš„è·¯ä¸Šå¥½åƒå¨å¨äº†ä¸€å¥â€œæˆ‘ä¸æƒ³æ´»çš„åƒä½ ä¸€æ ·â€æ€ä¹ˆå°±å“­äº†å‘¢ï¼Ÿ50å²çš„äººäº†ä¸€å®šæ˜¯é…’å¤ªè¾£äº†ï¼Œå¯¹ä¸å¯¹ä¸€å®šæ˜¯é…’å¤ªè¾£äº† 55å²ï¼Œå­©å­å·¥ä½œäº†ï¼Œä¼¼ä¹æœ‰ä¸€ç‚¹ç†è§£ä½ äº†ä½†ä½ å´åäº†è¿‡æ¥ï¼Œä½ è¯´ä¸è¦å¦¥å56å²ï¼Œå­©å­ä¹Ÿç»“å©šäº†ä½ é—®ä»–å–œæ¬¢é‚£ä¸ªå§‘å¨˜ä¹ˆä»–æ„£äº†æ„£è¯´ï¼šå–œæ¬¢å§60å²ï¼Œè¾›è‹¦äº†ä¸€è¾ˆå­ï¼Œæƒ³å‡ºå»èµ°èµ°èº«è¾¹çš„é‚£ä¸ªäººè¿‡äº†30å¹´ä½ ä¾æ—§åˆ†ä¸æ¸…åˆ°åº•å–œä¸å–œæ¬¢ä½ ä»¬å¼€å§‹è§„åˆ’æ—…æ¸¸è·¯çº¿è¿™ä¹ˆå¤šå¹´äº†ä½ ä»¬è¿˜æ˜¯å­˜åœ¨åˆ†æ­§ï¼Œè¿˜æ˜¯åœ¨äº‰åµæŸä¸ªç¬é—´ï¼Œä½ è§‰å¾—è¿™æ ·å¯èƒ½ä¹ŸæŒºå¥½ä¸€åˆ‡éƒ½å‡†å¤‡å¥½äº†å„¿å­è¯´ï¼šçˆ¸å¦ˆï¼Œæˆ‘å·¥ä½œå¤ªå¿™äº†å¯ä»¥å¸®æˆ‘ç…§é¡¾ä¸€ä¸‹å­©å­ä¹ˆä½ ä»¬é€€äº†æœºç¥¨ï¼Œåˆå›åˆ°äº†30å¹´å‰ 70å²ï¼Œå­©å­çš„å­©å­ä¹Ÿé•¿å¤§äº†ï¼Œä¸ç”¨å¤©å¤©æ“å¿ƒäº†ä½ ä¸‹å®šå†³å¿ƒè¯´ï¼šä¸€å®šè¦å»ç©ä¸€è¶Ÿå¯æ˜¯æ‰‹è¾¹çš„æ‹æ–åªèƒ½æ”¯æŒä½ èµ°åˆ°æ¥¼ä¸‹çš„èŠ±å›­75å²ï¼Œä½ åœ¨åŒ»é™¢çš„ç—…åºŠä¸Šèº«è¾¹èšæ»¡äº†äººï¼Œä½ è¿·è¿·ç³Šç³Šçš„çœ‹è§åŒ»ç”Ÿæ‘‡äº†æ‘‡å¤´å‘¨å›´é‚£äº›äººç¥æƒ…è‚ƒç©†ä½ æ˜ç™½äº†ï¼Œä½ è¦æ­»æ‰äº†ä½ æ²¡æœ‰æ„Ÿåˆ°ä¸€ä¸å®³æ€•ä½ çªç„¶é—®è‡ªå·±ï¼Œæˆ‘åˆ°åº•æ˜¯ä»€ä¹ˆæ—¶å€™æ­»æ‰çš„å‘¢ï¼Ÿä½ æƒ³èµ·æ¥30å²çš„é‚£åœºå©šç¤¼åŸæ¥ï¼Œé‚£æ—¶å€™ï¼Œä½ å°±æ­»æ‰äº†å§ ä¾ç…§æƒ¯ä¾‹æ­»å‰çš„3ç§’ï¼Œä½ çš„å¤§è„‘è¦èµ°é©¬ç¯å€’å™ä½ è¿™75ä¸ªå¹´å¤´çš„ä¸€ç”Ÿç”»é¢ä¸€å¼ ä¸€å¼ çš„è¿‡1ç§’2ç§’ä¸¤ç§’è¿‡å»äº†ä½ é¢æ— è¡¨æƒ…çš„çœ‹ç€è¿™ä¸¤ç§’å†…çš„å›å¿†ç¬¬3ç§’çªç„¶ä½ ç¬‘äº†åŸæ¥å·²ç»å›åˆ°äº†15å²çš„é‚£ä¸€å¹´ ä½ çœ‹è§ä¸€ä¸ªç”·å­©ä»–å¼ç€ä¸€è¢‹ç‰›å¥¶ï¼ŒèƒŒç€ä¹¦åŒ…ä»å¦ä¸€ä¸ªå¥³å­©å®¶çš„é˜³å°ä¸‹è·‘è¿‡é‚£ä¸ªç”·å­©æœçª—æˆ·é‡Œçœ‹äº†çœ‹é‚£æ˜¯15å²çš„ä½ æš—æ‹çš„é‚£ä¸ªå¥³å­©å­ä½ æƒ³ä¸èµ·æ¥å¥¹é•¿ä»€ä¹ˆæ ·å­äº†æœ€åä¸€ç§’ä½ åŠªåŠ›çš„å›å¿†ç€ç„¶åç»ˆäºç¬‘äº†å‡ºæ¥3ç§’è¿‡å»äº†èº«è¾¹çš„äººçªç„¶é—´å¼€å§‹åšå••å¤§å“­ä½ å¯èƒ½å¬ä¸æ¸…äº†ä½ æœ€åå¬åˆ°çš„å˜ˆæ‚çš„å£°éŸ³æ˜¯ä¸€ç¾¤åäº”å…­çš„å°‘å¹´ èµ·ç€å“„è¯´çš„ç­”åº”ä»–ç­”åº”ä»–ç­”åº”ä»–ä¸çˆ±ä½ ï¼Œä¸åº¦ç”Ÿ çƒ­è¯„ï¼šå–ä¸€ä½è´¦å·å·²æ³¨é”€çš„è¯„è®ºï¼šâ€œæœ‰äº›äºº27å²å°±æ­»äº†ï¼Œç›´åˆ°72å²æ‰è¢«åŸ‹ä¸Šâ€ã€‚èƒ½å¤Ÿæƒ³æ¸…æ¥šè¿‡å»ï¼ŒæŠ“å¾—ä½ç°åœ¨ï¼Œæ”¾çœ¼åœ¨æœªæ¥å§ï¼Œåšä¸€ä¸ªèƒ½æ´»åˆ°72å²çš„ç³Šæ¶‚è›‹ã€‚","categories":[{"name":"ç”Ÿæ´»ç¢ç‰‡åŒ–-æ®µå­","slug":"ç”Ÿæ´»ç¢ç‰‡åŒ–-æ®µå­","permalink":"https://mykkto.github.io/categories/%E7%94%9F%E6%B4%BB%E7%A2%8E%E7%89%87%E5%8C%96-%E6%AE%B5%E5%AD%90/"}],"tags":[{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"https://mykkto.github.io/tags/%E7%94%9F%E6%B4%BB/"},{"name":"æ®µå­","slug":"æ®µå­","permalink":"https://mykkto.github.io/tags/%E6%AE%B5%E5%AD%90/"},{"name":"æ„Ÿæ…¨","slug":"æ„Ÿæ…¨","permalink":"https://mykkto.github.io/tags/%E6%84%9F%E6%85%A8/"}],"author":"mykk"},{"title":"SpringCloud and Alibabaåˆé›†","slug":"03-javaåˆ†å¸ƒå¼/01-springcloud/00_SpringCloud","date":"2022-01-10T16:42:15.000Z","updated":"2023-06-11T02:53:45.171Z","comments":true,"path":"posts/58914314.html","link":"","permalink":"https://mykkto.github.io/posts/58914314.html","excerpt":"","text":"æ¡ˆä¾‹ä»£ç ä»“åº“https://gitee.com/TK_LIMR/springcloud2021To2021.git åˆ†è§£çš„ç›®å½•1ã€é¡¹ç›®æ„å»ºandæŠ€æœ¯é€‰å‹2ã€EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°4ã€ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°5ã€Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨6ã€OpenFeignæœåŠ¡æ¥å£è°ƒç”¨7ã€Hystrixæ–­è·¯å™¨8ã€zuulè·¯ç”±ç½‘å…³9ã€Gatewayæ–°ä¸€ä»£ç½‘å…³10ã€Seataå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡11ã€Sentinelå®ç°ç†”æ–­ä¸é™æµ12ã€NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ13ã€Sleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è¿½è¸ª14ã€Streamæ¶ˆæ¯é©±åŠ¨15ã€Bus æ¶ˆæ¯æ€»çº¿16ã€configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒé£Ÿç”¨æŠ€å·§1ã€åŒæ—¶å¯åŠ¨å¤šä¸ªSpringbootIDEA SpringBootå¤šä¸ªé¡¹ç›® å¼€å¯ RunDashboardï¼Œ åœ¨é¡¹ç›®æ ¹ç›®å½• .idea æ–‡ä»¶å¤¹ ä¸­ workspace.xmlæ–‡ä»¶ä¸­åŠ å…¥ &lt;component name=\"RunDashboard\"&gt; &lt;option name=\"configurationTypes\"&gt; &lt;set&gt; &lt;option value=\"SpringBootApplicationConfigurationType\" /&gt; &lt;/set&gt; &lt;/option&gt; &lt;/component&gt; 2ã€æœ¬åœ°hostsé…ç½®windown 10ä½ç½®ï¼šC:\\Windows\\System32\\drivers\\etc","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"åˆé›†","slug":"åˆé›†","permalink":"https://mykkto.github.io/tags/%E5%90%88%E9%9B%86/"}],"author":"mykk"},{"title":"KKè¯­å½•ï¼ˆæ—¥è®°ï¼‰","slug":"02-æŠ€æœ¯ä¹‹å¤–/02_è¯­å½•","date":"2022-01-10T15:12:19.000Z","updated":"2022-01-11T13:41:21.196Z","comments":true,"path":"posts/bd37926a.html","link":"","permalink":"https://mykkto.github.io/posts/bd37926a.html","excerpt":"","text":"","categories":[{"name":"ç”Ÿæ´»ç¢ç‰‡åŒ–","slug":"ç”Ÿæ´»ç¢ç‰‡åŒ–","permalink":"https://mykkto.github.io/categories/%E7%94%9F%E6%B4%BB%E7%A2%8E%E7%89%87%E5%8C%96/"}],"tags":[{"name":"è¯­å½•","slug":"è¯­å½•","permalink":"https://mykkto.github.io/tags/%E8%AF%AD%E5%BD%95/"},{"name":"æ—¥è®°","slug":"æ—¥è®°","permalink":"https://mykkto.github.io/tags/%E6%97%A5%E8%AE%B0/"},{"name":"è¯ç—¨","slug":"è¯ç—¨","permalink":"https://mykkto.github.io/tags/%E8%AF%9D%E7%97%A8/"}],"author":"mykk"},{"title":"ç¾æ–‡","slug":"02-æŠ€æœ¯ä¹‹å¤–/01_ç¾æ–‡","date":"2022-01-10T14:33:12.000Z","updated":"2022-01-11T14:21:18.841Z","comments":true,"path":"posts/c3e91221.html","link":"","permalink":"https://mykkto.github.io/posts/c3e91221.html","excerpt":"","text":"","categories":[{"name":"ç”Ÿæ´»ç¢ç‰‡åŒ–","slug":"ç”Ÿæ´»ç¢ç‰‡åŒ–","permalink":"https://mykkto.github.io/categories/%E7%94%9F%E6%B4%BB%E7%A2%8E%E7%89%87%E5%8C%96/"}],"tags":[{"name":"ç¾æ–‡","slug":"ç¾æ–‡","permalink":"https://mykkto.github.io/tags/%E7%BE%8E%E6%96%87/"}],"author":"mykk"},{"title":"æ•£åˆ—ç”Ÿæ´»ç¢ç‰‡","slug":"01-èœå•/03_éšç¬”ï¼ˆè¯­å½•ï¼‰","date":"2022-01-10T13:22:55.000Z","updated":"2023-06-11T02:53:45.147Z","comments":true,"path":"posts/1565718c.html","link":"","permalink":"https://mykkto.github.io/posts/1565718c.html","excerpt":"","text":"2022å¹´07æœˆ30æ—¥ æ¯å¤©ä¸Šç­å‰ï¼Œä»ä¸€åŒç»¿è‰²æ‹–é‹åˆ‡æ¢åˆ°é»‘è‰²ï¼Œä»¿ä½›æˆäº†æˆ‘çš„è‚Œè‚‰è®°å¿† 2022å¹´08æœˆ02æ—¥ å½“ä¿¡å¿µä¹Ÿè¦å»ä¾æ‰˜ä»–äººä¹‹æ—¶ï¼Œå¤šåŠå°±å®Œäº† 2022å¹´08æœˆ07æ—¥ ç«‹ç§‹ï¼š è†ç”°äººä¼¼ä¹ä¸æ“…é•¿è¯´è°ï¼Œé…¸æ‰å˜è´¨çš„é£Ÿæï¼Œæ€»èƒ½è¯´æ˜¯åšå·¥æ‰‹æ³•å¯¼è‡´çš„å£æ„Ÿé—®é¢˜ã€‚ 2022å¹´08æœˆ10æ—¥ äºŒæœŸæ ¸é…¸çš„äººæµå·²ç»å¤§åˆ°éœ€è¦ç”¨ç«æŠ€çš„æ–¹å¼ï¼Œè¿˜å¥½æˆ‘è·‘å¾—å¿«ï¼Œä¹Ÿæœ‰äº›æ’é˜Ÿçš„å¤©èµ‹ã€‚ï¼ˆæ—è¾¹çš„å¤§å–‡å­ï¼šè·‘çš„å¿«çš„å…ˆåšï¼Œæ…¢çš„é è¾¹ï¼‰ 2022å¹´08æœˆ13æ—¥ ç§©åºæ˜¯ç”¨æ¥æªå¡ä¸‹å±‚é˜¶çº§çš„è°è¨€ 2022å¹´08æœˆ17æ—¥ åŸåˆ™ï¼š ä¸è¿½é«˜ï¼šå®å¯é”™å¤±ä¸€æ¬¡ï¼Œä¸äºè¯¯å…¥ä¸€å›ä¸è¿½é«˜ï¼ä¸è¿½é«˜ï¼ä¸è¿½é«˜ï¼3ç‚¹ä»¥ä¸Šä¸è¿½ï¼ 2022å¹´08æœˆ19æ—¥ æˆ‘æ˜¯ä¸ªæ‡’æƒ°çš„äººï¼Œä¹°æ—©é¤åè½¦ä¹Ÿä¸æ­¥è¡Œ æˆ‘æ˜¯ä¸ªå€”å¼ºçš„äººï¼Œä¹˜ä¸€ç«™ä¹Ÿä¸åœ¨æ¥¼ä¸‹ä¹° 2022å¹´08æœˆ19æ—¥ æˆ‘æƒ³ï¼Œæˆ‘å¹¶æ²¡æœ‰å®Œå…¨æ‘†çƒ‚ 2022å¹´09æœˆ10æ—¥ æˆ‘æ—¶å¸¸åŒå‹äººæåˆ°ï¼šâ€œæ‰“å·¥æ—¶çœ‹ä¸åˆ°æœªæ¥çš„â€ï¼Œ ä½†æ˜¯é‡åˆ°é‚£äº›ä¸å¤ªé è°±çš„å¹´è½»äººæƒ³åˆ›ä¸šæ—¶ï¼Œæˆ‘ä¹Ÿè¯•ç€åŠä»–ä»¬ä¸‰æ€ æˆ–è®¸åªæ˜¯æˆ‘è‡ªå·±æ²¡å‹‡æ°”ç½¢äº†ã€‚ 2022å¹´09æœˆ17æ—¥ å¥½ä¹…æ²¡åƒé›ªç³•ï¼Œä¸æ˜¯æˆ‘æ²¡é’±ï¼Œä¹Ÿä¸æ˜¯æˆ‘è®¨åŒï¼Œåªæ˜¯ä¼¼ä¹æ²¡é‚£ä¹ˆæƒ³äº† 2022å¹´09æœˆ20æ—¥ äººç¾¤ä¸­ç”¨å……æ–¥ç€ä¸åŒåˆºé¼»çš„å‘³é“ï¼Œåœ¨å¥¹ä»¬ç§°ä¸ºé¦™å‘³çš„ä¸œè¥¿ï¼Œä¸æˆ‘è€Œè¨€ä¸è¿‡æ˜¯ä¸åŒåº¦æ•°çš„é…’ç²¾ 2022å¹´11æœˆ25æ—¥ æˆ‘ä¾ç„¶æ˜¯ä¸ªè¯å” ï¼Œåªæ˜¯ç°å®ä¸­è®²çš„å°‘äº†ï¼Œå†™çš„å¤šäº† 2022å¹´12æœˆ21æ—¥ å¦‚æœä¸€äº›è¯¯è§£å¯¹æˆ‘çš„åˆ©ç›Šä¸å½±å“ï¼Œæˆ‘ä¹Ÿä¾¿ä¸ä¼šè§£é‡Š","categories":[{"name":"æ–‡ç« èœå•åˆé›†","slug":"æ–‡ç« èœå•åˆé›†","permalink":"https://mykkto.github.io/categories/%E6%96%87%E7%AB%A0%E8%8F%9C%E5%8D%95%E5%90%88%E9%9B%86/"}],"tags":[{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"https://mykkto.github.io/tags/%E7%94%9F%E6%B4%BB/"},{"name":"éšè®°","slug":"éšè®°","permalink":"https://mykkto.github.io/tags/%E9%9A%8F%E8%AE%B0/"},{"name":"è¯­å½•","slug":"è¯­å½•","permalink":"https://mykkto.github.io/tags/%E8%AF%AD%E5%BD%95/"}],"author":"mykk"},{"title":"â˜…æœ¬ç«™æ ¸å¿ƒæ–‡ç« ç›®å½•â˜…","slug":"01-èœå•/02_æ–°èœå•é›†åˆ","date":"2022-01-09T14:55:55.000Z","updated":"2023-06-11T02:53:45.147Z","comments":true,"path":"posts/f747eac7.html","link":"","permalink":"https://mykkto.github.io/posts/f747eac7.html","excerpt":"","text":"ä¸€ã€SpringCloudå…¨å®¶æ¡¶(not only)- 1ã€æ³¨å†Œä¸­å¿ƒç¯‡ï¼ˆ1ï¼‰SpringCloud-Eureka =============SpringCloud-Eureka============== ï¼ˆ2ï¼‰Springcloud-Zookeeper =============Springcloud-Zookeeper=========== ï¼ˆ3ï¼‰SpringCloud-Consul =============SpringCloud-Consul============== ï¼ˆ4ï¼‰SpringCloud-Alibaba-Nacosï¼ˆæ³¨å†Œä¸­å¿ƒ+é…ç½®ä¸­å¿ƒï¼‰ =============SpringCloud-Alibaba-Nacos======== - 2ã€æœåŠ¡è°ƒç”¨ç¯‡ï¼ˆ1ï¼‰SpringCloud-OpenFeign =============SpringCloud-OpenFeign============= - 3ã€è´Ÿè½½å‡è¡¡ç¯‡ï¼ˆ1ï¼‰SpringCloud-Ribbon =============SpringCloud-Ribbon================ - 4ã€ç†”æ–­é™æµç¯‡ï¼ˆ1ï¼‰SpringCloud-Hystrix =============SpringCloud-Hystrix================ ï¼ˆ2ï¼‰SpringCloud-Alibaba-Sentinel =============SpringCloud-Alibaba-Sentinel======= - 5ã€è·¯ç”±ç½‘å…³ç¯‡ï¼ˆ1ï¼‰SpringCloud-Zuul =============SpringCloud-Zuul=================== ï¼ˆ2ï¼‰SpringCloud-Gateway =============SpringCloud-Gateway================= - 6ã€åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆ1ï¼‰SpringCloud-Alibaba-Seata =============SpringCloud-Alibaba-Seata=========== - 7ã€é…ç½®ä¸­å¿ƒç¯‡ï¼ˆ1ï¼‰SpringCloud-Config =============SpringCloud-Config=================== - 8ã€æœç´¢å¼•æ“ç¯‡ï¼ˆ1ï¼‰ES =============SpringCloud-Config=================== - Nã€è€æŠ€æœ¯(å¾…æ·˜æ±°)ï¼ˆ1ï¼‰SpringCloud-Busåˆ†å¸ƒå¼èŠ‚ç‚¹é“¾æ¥ =============SpringCloud-Bus======================= ï¼ˆ2ï¼‰SpringCloud-Streamæ¶ˆæ¯é©±åŠ¨ =============SpringCloud-Stream==================== ï¼ˆ3ï¼‰SpringCloud-Sleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª =============SpringCloud-Sleuth====================","categories":[{"name":"æ–‡ç« èœå•åˆé›†","slug":"æ–‡ç« èœå•åˆé›†","permalink":"https://mykkto.github.io/categories/%E6%96%87%E7%AB%A0%E8%8F%9C%E5%8D%95%E5%90%88%E9%9B%86/"}],"tags":[{"name":"æŠ€æœ¯æ€»çº²","slug":"æŠ€æœ¯æ€»çº²","permalink":"https://mykkto.github.io/tags/%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BA%B2/"},{"name":"springå…¨å®¶æ¡¶","slug":"springå…¨å®¶æ¡¶","permalink":"https://mykkto.github.io/tags/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/"}],"author":"mykk"},{"title":"(æ—§)ç®€ä¹¦æ–‡ç« è¿‡å¾€ä¸¤å¹´çº²è¦","slug":"01-èœå•/01_æ—§èœå•åˆé›†","date":"2022-01-09T11:19:19.000Z","updated":"2023-06-11T02:53:45.149Z","comments":true,"path":"posts/c3e91221.html","link":"","permalink":"https://mykkto.github.io/posts/c3e91221.html","excerpt":"","text":"1ã€æŠ€æœ¯ï¼ˆè¾ƒä¸ºç³»ç»Ÿç¼–æ’ï¼‰1ã€javaæ•°æ®ç»“æ„ä¸ç®—æ³• â˜…https://www.jianshu.com/p/929ca9e209e8 2ã€javaè®¾è®¡æ¨¡å¼https://www.jianshu.com/p/63df8cd03619 8ã€javaå•ä½“æ¶æ„æŠ€æœ¯æ ˆhttps://www.jianshu.com/p/0a4a1ced23c7 9ã€javaåˆ†å¸ƒå¼æ¶æ„æŠ€æœ¯æ ˆhttps://www.jianshu.com/p/00aa796bb5b8 10ã€æ¡†æ¶ä¹‹å¤–æŠ€æœ¯æ ˆæ±‡æ€»https://www.jianshu.com/p/d0167f082cbf N1ã€å†…åŠ›ç¯‡æ±‡æ€»0-javaå†…åŠ›â€”â€”æ€»çº² - ç®€ä¹¦ (jianshu.com) 11ã€Liunxhttps://www.jianshu.com/p/409970d8d0f1 12ã€å‰ç«¯å¤§æ‚çƒ©https://www.jianshu.com/p/82fa0c99e019 13ã€å„é¡¹ç›®æ•´åˆåˆ†è§£å¤§æ‚çƒ©https://www.jianshu.com/p/d30b07569dc3 14ã€é¢è¯•é¢˜æ±‡æ€»ï¼šæŠ€æœ¯=é¢è¯•é¢˜+é¡¹ç›®æ€»ç»“ â˜…https://www.jianshu.com/p/5e3b81aef034 15ã€ä¸€äº›ä¸é”™çš„ç½‘ç«™ï¼šhttps://www.jianshu.com/p/53bf0d4a930d 16ã€éšæ€§è®°å½•ä¸€å°ç‚¹éšæ€§è®°å½•ä¸€å°ç‚¹ 2021-07-15è‡³æœªæ¥ 7ã€å·¥å…·ä»£ç å¤‡ä»½UT-å·¥å…·ä»£ç  JDKå„ç‰ˆæœ¬æ¼”å˜ 4ã€netty 5ã€JVMã€é‡é‡çº§ã€‘ nã€å¤§æ•°æ®nã€å‰ç«¯nã€golangnã€ä»¥å¤ªåŠnã€åŒºå—é“¾nã€scala 2ã€å·¥ä½œï¼Œåšå®¢ï¼Œå…¬ä¼—å·ç­‰æ‰€å­¦æŠ€æœ¯æ±‡æ€»3ã€å¿ƒå¾—ï¼ˆå·¥ä½œï¼‰4ã€è¯­å½•ï¼ˆæ„Ÿæ‚Ÿï¼‰","categories":[{"name":"æ–‡ç« èœå•åˆé›†","slug":"æ–‡ç« èœå•åˆé›†","permalink":"https://mykkto.github.io/categories/%E6%96%87%E7%AB%A0%E8%8F%9C%E5%8D%95%E5%90%88%E9%9B%86/"}],"tags":[{"name":"ç®€ä¹¦","slug":"ç®€ä¹¦","permalink":"https://mykkto.github.io/tags/%E7%AE%80%E4%B9%A6/"},{"name":"æŠ€æœ¯æ€»çº²","slug":"æŠ€æœ¯æ€»çº²","permalink":"https://mykkto.github.io/tags/%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BA%B2/"}],"author":"mykk"}],"categories":[{"name":"ä¸“åˆŠç¯‡","slug":"ä¸“åˆŠç¯‡","permalink":"https://mykkto.github.io/categories/%E4%B8%93%E5%88%8A%E7%AF%87/"},{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"https://mykkto.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"},{"name":"è®¡ç®—æœºè¯­è¨€","slug":"è®¡ç®—æœºè¯­è¨€","permalink":"https://mykkto.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/"},{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://mykkto.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"},{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"},{"name":"æ¶ˆæ¯ä¸­é—´ä»¶","slug":"æ¶ˆæ¯ä¸­é—´ä»¶","permalink":"https://mykkto.github.io/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"å†…åŠ›ç¯‡","slug":"å†…åŠ›ç¯‡","permalink":"https://mykkto.github.io/categories/%E5%86%85%E5%8A%9B%E7%AF%87/"},{"name":"docker","slug":"docker","permalink":"https://mykkto.github.io/categories/docker/"},{"name":"é¡¹ç›®-é‡‘è","slug":"é¡¹ç›®-é‡‘è","permalink":"https://mykkto.github.io/categories/%E9%A1%B9%E7%9B%AE-%E9%87%91%E8%9E%8D/"},{"name":"é«˜é˜¶ç¯‡","slug":"é«˜é˜¶ç¯‡","permalink":"https://mykkto.github.io/categories/%E9%AB%98%E9%98%B6%E7%AF%87/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://mykkto.github.io/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://mykkto.github.io/categories/%E5%8D%9A%E5%AE%A2/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://mykkto.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"ç”Ÿæ´»ç¢ç‰‡åŒ–-æ®µå­","slug":"ç”Ÿæ´»ç¢ç‰‡åŒ–-æ®µå­","permalink":"https://mykkto.github.io/categories/%E7%94%9F%E6%B4%BB%E7%A2%8E%E7%89%87%E5%8C%96-%E6%AE%B5%E5%AD%90/"},{"name":"ç”Ÿæ´»ç¢ç‰‡åŒ–","slug":"ç”Ÿæ´»ç¢ç‰‡åŒ–","permalink":"https://mykkto.github.io/categories/%E7%94%9F%E6%B4%BB%E7%A2%8E%E7%89%87%E5%8C%96/"},{"name":"æ–‡ç« èœå•åˆé›†","slug":"æ–‡ç« èœå•åˆé›†","permalink":"https://mykkto.github.io/categories/%E6%96%87%E7%AB%A0%E8%8F%9C%E5%8D%95%E5%90%88%E9%9B%86/"}],"tags":[{"name":"é”","slug":"é”","permalink":"https://mykkto.github.io/tags/%E9%94%81/"},{"name":"redisson","slug":"redisson","permalink":"https://mykkto.github.io/tags/redisson/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://mykkto.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"docker","slug":"docker","permalink":"https://mykkto.github.io/tags/docker/"},{"name":"doris","slug":"doris","permalink":"https://mykkto.github.io/tags/doris/"},{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"https://mykkto.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"},{"name":"spark","slug":"spark","permalink":"https://mykkto.github.io/tags/spark/"},{"name":"scala","slug":"scala","permalink":"https://mykkto.github.io/tags/scala/"},{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://mykkto.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"jvm","slug":"jvm","permalink":"https://mykkto.github.io/tags/jvm/"},{"name":"juc","slug":"juc","permalink":"https://mykkto.github.io/tags/juc/"},{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://mykkto.github.io/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"},{"name":"gateway","slug":"gateway","permalink":"https://mykkto.github.io/tags/gateway/"},{"name":"ç°åº¦å‘å¸ƒ","slug":"ç°åº¦å‘å¸ƒ","permalink":"https://mykkto.github.io/tags/%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/"},{"name":"nginx","slug":"nginx","permalink":"https://mykkto.github.io/tags/nginx/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://mykkto.github.io/tags/%E9%9D%A2%E8%AF%95/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"https://mykkto.github.io/tags/%E4%BA%8B%E5%8A%A1/"},{"name":"spring-tx","slug":"spring-tx","permalink":"https://mykkto.github.io/tags/spring-tx/"},{"name":"amqp","slug":"amqp","permalink":"https://mykkto.github.io/tags/amqp/"},{"name":"rabbitmq","slug":"rabbitmq","permalink":"https://mykkto.github.io/tags/rabbitmq/"},{"name":"netty","slug":"netty","permalink":"https://mykkto.github.io/tags/netty/"},{"name":"nio","slug":"nio","permalink":"https://mykkto.github.io/tags/nio/"},{"name":"ç½‘ç»œç¼–ç¨‹","slug":"ç½‘ç»œç¼–ç¨‹","permalink":"https://mykkto.github.io/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"},{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://mykkto.github.io/tags/%E6%8A%80%E6%9C%AF/"},{"name":"è®°å½•","slug":"è®°å½•","permalink":"https://mykkto.github.io/tags/%E8%AE%B0%E5%BD%95/"},{"name":"docker-compose","slug":"docker-compose","permalink":"https://mykkto.github.io/tags/docker-compose/"},{"name":"dockerfile","slug":"dockerfile","permalink":"https://mykkto.github.io/tags/dockerfile/"},{"name":"dockerç½‘ç»œ","slug":"dockerç½‘ç»œ","permalink":"https://mykkto.github.io/tags/docker%E7%BD%91%E7%BB%9C/"},{"name":"Flink","slug":"Flink","permalink":"https://mykkto.github.io/tags/Flink/"},{"name":"hadoop","slug":"hadoop","permalink":"https://mykkto.github.io/tags/hadoop/"},{"name":"kafka","slug":"kafka","permalink":"https://mykkto.github.io/tags/kafka/"},{"name":"springboot","slug":"springboot","permalink":"https://mykkto.github.io/tags/springboot/"},{"name":"vue","slug":"vue","permalink":"https://mykkto.github.io/tags/vue/"},{"name":"å­—èŠ‚ç ","slug":"å­—èŠ‚ç ","permalink":"https://mykkto.github.io/tags/%E5%AD%97%E8%8A%82%E7%A0%81/"},{"name":"åŸç†","slug":"åŸç†","permalink":"https://mykkto.github.io/tags/%E5%8E%9F%E7%90%86/"},{"name":"java","slug":"java","permalink":"https://mykkto.github.io/tags/java/"},{"name":"ShardingSphere","slug":"ShardingSphere","permalink":"https://mykkto.github.io/tags/ShardingSphere/"},{"name":"åˆ†åº“åˆ†è¡¨","slug":"åˆ†åº“åˆ†è¡¨","permalink":"https://mykkto.github.io/tags/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/"},{"name":"jdbc","slug":"jdbc","permalink":"https://mykkto.github.io/tags/jdbc/"},{"name":"lua","slug":"lua","permalink":"https://mykkto.github.io/tags/lua/"},{"name":"openresty","slug":"openresty","permalink":"https://mykkto.github.io/tags/openresty/"},{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"seata","slug":"seata","permalink":"https://mykkto.github.io/tags/seata/"},{"name":"åˆ†å¸ƒå¼äº‹åŠ¡","slug":"åˆ†å¸ƒå¼äº‹åŠ¡","permalink":"https://mykkto.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"},{"name":"blog","slug":"blog","permalink":"https://mykkto.github.io/tags/blog/"},{"name":"éƒ¨ç½²","slug":"éƒ¨ç½²","permalink":"https://mykkto.github.io/tags/%E9%83%A8%E7%BD%B2/"},{"name":"å°å§¿åŠ¿","slug":"å°å§¿åŠ¿","permalink":"https://mykkto.github.io/tags/%E5%B0%8F%E5%A7%BF%E5%8A%BF/"},{"name":"ç†”æ–­å™¨","slug":"ç†”æ–­å™¨","permalink":"https://mykkto.github.io/tags/%E7%86%94%E6%96%AD%E5%99%A8/"},{"name":"sentinel","slug":"sentinel","permalink":"https://mykkto.github.io/tags/sentinel/"},{"name":"é™æµ","slug":"é™æµ","permalink":"https://mykkto.github.io/tags/%E9%99%90%E6%B5%81/"},{"name":"é›†ç¾¤","slug":"é›†ç¾¤","permalink":"https://mykkto.github.io/tags/%E9%9B%86%E7%BE%A4/"},{"name":"nacos","slug":"nacos","permalink":"https://mykkto.github.io/tags/nacos/"},{"name":"AQS","slug":"AQS","permalink":"https://mykkto.github.io/tags/AQS/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://mykkto.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"JUC","slug":"JUC","permalink":"https://mykkto.github.io/tags/JUC/"},{"name":"oracle","slug":"oracle","permalink":"https://mykkto.github.io/tags/oracle/"},{"name":"å®‰è£…","slug":"å®‰è£…","permalink":"https://mykkto.github.io/tags/%E5%AE%89%E8%A3%85/"},{"name":"æœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"æœåŠ¡æ³¨å†Œä¸å‘ç°","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"},{"name":"é…ç½®ä¸­å¿ƒ","slug":"é…ç½®ä¸­å¿ƒ","permalink":"https://mykkto.github.io/tags/%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"},{"name":"æœåŠ¡è·Ÿè¸ª","slug":"æœåŠ¡è·Ÿè¸ª","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E8%B7%9F%E8%B8%AA/"},{"name":"sleuth","slug":"sleuth","permalink":"https://mykkto.github.io/tags/sleuth/"},{"name":"æ¶ˆæ¯é©±åŠ¨","slug":"æ¶ˆæ¯é©±åŠ¨","permalink":"https://mykkto.github.io/tags/%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/"},{"name":"stream","slug":"stream","permalink":"https://mykkto.github.io/tags/stream/"},{"name":"bus","slug":"bus","permalink":"https://mykkto.github.io/tags/bus/"},{"name":"èŠ‚ç‚¹é“¾æ¥","slug":"èŠ‚ç‚¹é“¾æ¥","permalink":"https://mykkto.github.io/tags/%E8%8A%82%E7%82%B9%E9%93%BE%E6%8E%A5/"},{"name":"config","slug":"config","permalink":"https://mykkto.github.io/tags/config/"},{"name":"è·¯ç”±ç½‘å…³","slug":"è·¯ç”±ç½‘å…³","permalink":"https://mykkto.github.io/tags/%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3/"},{"name":"alibaba","slug":"alibaba","permalink":"https://mykkto.github.io/tags/alibaba/"},{"name":"Gateway","slug":"Gateway","permalink":"https://mykkto.github.io/tags/Gateway/"},{"name":"linux","slug":"linux","permalink":"https://mykkto.github.io/tags/linux/"},{"name":"mysql","slug":"mysql","permalink":"https://mykkto.github.io/tags/mysql/"},{"name":"netflix","slug":"netflix","permalink":"https://mykkto.github.io/tags/netflix/"},{"name":"zuul","slug":"zuul","permalink":"https://mykkto.github.io/tags/zuul/"},{"name":"æ–­è·¯å™¨","slug":"æ–­è·¯å™¨","permalink":"https://mykkto.github.io/tags/%E6%96%AD%E8%B7%AF%E5%99%A8/"},{"name":"Hystrix","slug":"Hystrix","permalink":"https://mykkto.github.io/tags/Hystrix/"},{"name":"è¿œç¨‹è°ƒç”¨æœåŠ¡","slug":"è¿œç¨‹è°ƒç”¨æœåŠ¡","permalink":"https://mykkto.github.io/tags/%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1/"},{"name":"openfeign","slug":"openfeign","permalink":"https://mykkto.github.io/tags/openfeign/"},{"name":"è´Ÿè½½å‡è¡¡","slug":"è´Ÿè½½å‡è¡¡","permalink":"https://mykkto.github.io/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"},{"name":"ribbon","slug":"ribbon","permalink":"https://mykkto.github.io/tags/ribbon/"},{"name":"hexo","slug":"hexo","permalink":"https://mykkto.github.io/tags/hexo/"},{"name":"github","slug":"github","permalink":"https://mykkto.github.io/tags/github/"},{"name":"seo","slug":"seo","permalink":"https://mykkto.github.io/tags/seo/"},{"name":"ç™¾åº¦","slug":"ç™¾åº¦","permalink":"https://mykkto.github.io/tags/%E7%99%BE%E5%BA%A6/"},{"name":"è°·æ­Œ","slug":"è°·æ­Œ","permalink":"https://mykkto.github.io/tags/%E8%B0%B7%E6%AD%8C/"},{"name":"Consul","slug":"Consul","permalink":"https://mykkto.github.io/tags/Consul/"},{"name":"Zookeeper","slug":"Zookeeper","permalink":"https://mykkto.github.io/tags/Zookeeper/"},{"name":"Eureka","slug":"Eureka","permalink":"https://mykkto.github.io/tags/Eureka/"},{"name":"æ­å»º","slug":"æ­å»º","permalink":"https://mykkto.github.io/tags/%E6%90%AD%E5%BB%BA/"},{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"https://mykkto.github.io/tags/%E7%94%9F%E6%B4%BB/"},{"name":"æ®µå­","slug":"æ®µå­","permalink":"https://mykkto.github.io/tags/%E6%AE%B5%E5%AD%90/"},{"name":"æ„Ÿæ…¨","slug":"æ„Ÿæ…¨","permalink":"https://mykkto.github.io/tags/%E6%84%9F%E6%85%A8/"},{"name":"åˆé›†","slug":"åˆé›†","permalink":"https://mykkto.github.io/tags/%E5%90%88%E9%9B%86/"},{"name":"è¯­å½•","slug":"è¯­å½•","permalink":"https://mykkto.github.io/tags/%E8%AF%AD%E5%BD%95/"},{"name":"æ—¥è®°","slug":"æ—¥è®°","permalink":"https://mykkto.github.io/tags/%E6%97%A5%E8%AE%B0/"},{"name":"è¯ç—¨","slug":"è¯ç—¨","permalink":"https://mykkto.github.io/tags/%E8%AF%9D%E7%97%A8/"},{"name":"ç¾æ–‡","slug":"ç¾æ–‡","permalink":"https://mykkto.github.io/tags/%E7%BE%8E%E6%96%87/"},{"name":"éšè®°","slug":"éšè®°","permalink":"https://mykkto.github.io/tags/%E9%9A%8F%E8%AE%B0/"},{"name":"æŠ€æœ¯æ€»çº²","slug":"æŠ€æœ¯æ€»çº²","permalink":"https://mykkto.github.io/tags/%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BA%B2/"},{"name":"springå…¨å®¶æ¡¶","slug":"springå…¨å®¶æ¡¶","permalink":"https://mykkto.github.io/tags/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/"},{"name":"ç®€ä¹¦","slug":"ç®€ä¹¦","permalink":"https://mykkto.github.io/tags/%E7%AE%80%E4%B9%A6/"}]}