{"meta":{"title":"jack","subtitle":"jackã®åšå®¢","description":"ä¸“ç§‘ | è®¡ç®—æœºä¸ç½‘ç»œ | ç®€ä¹¦ä½œè€…","author":"jack","url":"https://mykkto.github.io","root":"/"},"pages":[{"title":"404","date":"2019-08-10T08:41:10.000Z","updated":"2022-01-06T14:09:33.725Z","comments":true,"path":"404.html","permalink":"https://mykkto.github.io/404.html","excerpt":"","text":""},{"title":"","date":"2022-01-06T14:09:33.869Z","updated":"2022-01-06T14:09:33.869Z","comments":true,"path":"baidu_verify_xxxxxxx.html","permalink":"https://mykkto.github.io/baidu_verify_xxxxxxx.html","excerpt":"","text":"wvlc3L96QK"},{"title":"","date":"2022-01-06T14:09:33.871Z","updated":"2022-01-06T14:09:33.871Z","comments":true,"path":"google1xxxxxxx0.html","permalink":"https://mykkto.github.io/google1xxxxxxx0.html","excerpt":"","text":"google-site-verification: google110e5e5e14c8dcf0.html"},{"title":"æ”¾æ¾ä¸€ä¸‹","date":"2019-08-10T08:41:10.000Z","updated":"2022-01-06T14:09:33.745Z","comments":true,"path":"List/index.html","permalink":"https://mykkto.github.io/List/index.html","excerpt":"","text":"å½±éŸ³èµ„æºå…±äº«"},{"title":"about","date":"2019-10-24T16:00:00.000Z","updated":"2022-01-06T14:09:33.867Z","comments":true,"path":"about/index.html","permalink":"https://mykkto.github.io/about/index.html","excerpt":"","text":""},{"title":"archives","date":"2019-10-24T16:00:00.000Z","updated":"2022-01-06T14:09:33.867Z","comments":true,"path":"archives/index.html","permalink":"https://mykkto.github.io/archives/index.html","excerpt":"","text":""},{"title":"categories","date":"2019-10-24T16:00:00.000Z","updated":"2022-01-06T14:09:33.869Z","comments":true,"path":"categories/index.html","permalink":"https://mykkto.github.io/categories/index.html","excerpt":"","text":""},{"title":"ç•™è¨€æ¿","date":"2022-01-06T15:45:01.231Z","updated":"2022-01-06T15:45:01.231Z","comments":true,"path":"contact/index.html","permalink":"https://mykkto.github.io/contact/index.html","excerpt":"","text":"ç•…æ‰€æ¬²è¨€ åœ¨è¿™é‡Œå¯ä»¥ç•™ä¸‹ä½ çš„è¶³è¿¹ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹ç•™è¨€ï¼Œæ¬¢è¿äº¤æ¢å‹é“¾ï¼Œä¸€èµ·äº¤æµå­¦ä¹ ï¼ å‹é“¾ jackã®å‹é“¾ä¿¡æ¯ åšå®¢åç§°: jckã®åšå®¢ åšå®¢ç½‘å€: https://mykkto.github.io/"},{"title":"ç»Ÿè®¡","date":"2020-10-31T02:11:28.000Z","updated":"2022-01-06T14:09:33.869Z","comments":true,"path":"census/index.html","permalink":"https://mykkto.github.io/census/index.html","excerpt":"","text":""},{"title":"å‹é“¾","date":"2019-07-19T08:42:10.000Z","updated":"2022-01-06T14:09:33.871Z","comments":true,"path":"friends/index.html","permalink":"https://mykkto.github.io/friends/index.html","excerpt":"","text":""},{"title":"èµ„æºåˆ†äº«","date":"2019-07-19T08:40:27.000Z","updated":"2022-01-06T14:09:33.872Z","comments":true,"path":"resource/index.html","permalink":"https://mykkto.github.io/resource/index.html","excerpt":"","text":""},{"title":"tags","date":"2019-07-19T08:40:27.000Z","updated":"2022-01-06T14:09:33.873Z","comments":true,"path":"tags/index.html","permalink":"https://mykkto.github.io/tags/index.html","excerpt":"","text":""},{"title":"ç›¸å†Œ","date":"2022-01-08T15:55:11.896Z","updated":"2022-01-06T14:09:33.734Z","comments":true,"path":"List/galleries/index.html","permalink":"https://mykkto.github.io/List/galleries/index.html","excerpt":"","text":""},{"title":"å¬å¬éŸ³ä¹","date":"2019-07-19T08:40:27.000Z","updated":"2022-01-06T14:09:33.747Z","comments":true,"path":"List/tools/index.html","permalink":"https://mykkto.github.io/List/tools/index.html","excerpt":"","text":""},{"title":"è§†é¢‘","date":"2019-08-10T08:41:10.000Z","updated":"2022-01-06T14:09:33.745Z","comments":true,"path":"List/movies/index.html","permalink":"https://mykkto.github.io/List/movies/index.html","excerpt":"","text":""},{"title":"å¬å¬éŸ³ä¹","date":"2019-07-19T08:40:27.000Z","updated":"2022-01-06T14:09:33.746Z","comments":true,"path":"List/music/index.html","permalink":"https://mykkto.github.io/List/music/index.html","excerpt":"","text":""},{"title":"ä¹–å·§å°ç‹—","date":"2022-01-06T14:09:33.734Z","updated":"2022-01-06T14:09:33.734Z","comments":true,"path":"List/galleries/ä¹–å·§å°ç‹—/index.html","permalink":"https://mykkto.github.io/List/galleries/%E4%B9%96%E5%B7%A7%E5%B0%8F%E7%8B%97/index.html","excerpt":"","text":""},{"title":"äºŒæ¬¡å…ƒé£","date":"2022-01-06T14:09:33.735Z","updated":"2022-01-06T14:09:33.735Z","comments":true,"path":"List/galleries/äºŒæ¬¡å…ƒé£/index.html","permalink":"https://mykkto.github.io/List/galleries/%E4%BA%8C%E6%AC%A1%E5%85%83%E9%A3%8E/index.html","excerpt":"","text":""},{"title":"åŠ¨æ¼«äººç‰©","date":"2022-01-06T14:09:33.736Z","updated":"2022-01-06T14:09:33.736Z","comments":true,"path":"List/galleries/åŠ¨æ¼«äººç‰©/index.html","permalink":"https://mykkto.github.io/List/galleries/%E5%8A%A8%E6%BC%AB%E4%BA%BA%E7%89%A9/index.html","excerpt":"","text":""},{"title":"åŠ¨æ¼«æ’ç”»","date":"2022-01-06T14:09:33.737Z","updated":"2022-01-06T14:09:33.737Z","comments":true,"path":"List/galleries/åŠ¨æ¼«æ’ç”»/index.html","permalink":"https://mykkto.github.io/List/galleries/%E5%8A%A8%E6%BC%AB%E6%8F%92%E7%94%BB/index.html","excerpt":"","text":""},{"title":"åŠ¨æ¼«é£æ™¯","date":"2022-01-06T14:09:33.738Z","updated":"2022-01-06T14:09:33.738Z","comments":true,"path":"List/galleries/åŠ¨æ¼«é£æ™¯/index.html","permalink":"https://mykkto.github.io/List/galleries/%E5%8A%A8%E6%BC%AB%E9%A3%8E%E6%99%AF/index.html","excerpt":"","text":""},{"title":"å‘†èŒçŒ«å’ª","date":"2022-01-06T14:09:33.738Z","updated":"2022-01-06T14:09:33.738Z","comments":true,"path":"List/galleries/å‘†èŒçŒ«å’ª/index.html","permalink":"https://mykkto.github.io/List/galleries/%E5%91%86%E8%90%8C%E7%8C%AB%E5%92%AA/index.html","excerpt":"","text":""},{"title":"åŸå¸‚é£å…‰","date":"2022-01-06T14:09:33.739Z","updated":"2022-01-06T14:09:33.739Z","comments":true,"path":"List/galleries/åŸå¸‚é£å…‰/index.html","permalink":"https://mykkto.github.io/List/galleries/%E5%9F%8E%E5%B8%82%E9%A3%8E%E5%85%89/index.html","excerpt":"","text":""},{"title":"ç‚«é…·è·‘è½¦","date":"2022-01-08T15:55:21.871Z","updated":"2022-01-06T14:09:33.742Z","comments":true,"path":"List/galleries/ç‚«é…·è·‘è½¦/index.html","permalink":"https://mykkto.github.io/List/galleries/%E7%82%AB%E9%85%B7%E8%B7%91%E8%BD%A6/index.html","excerpt":"","text":""},{"title":"æ¸…æ–°èŠ±å‰","date":"2022-01-06T14:09:33.740Z","updated":"2022-01-06T14:09:33.740Z","comments":true,"path":"List/galleries/æ¸…æ–°èŠ±å‰/index.html","permalink":"https://mykkto.github.io/List/galleries/%E6%B8%85%E6%96%B0%E8%8A%B1%E5%8D%89/index.html","excerpt":"","text":""},{"title":"ç”œç¾é£Ÿå“","date":"2022-01-06T14:09:33.743Z","updated":"2022-01-06T14:09:33.743Z","comments":true,"path":"List/galleries/ç”œç¾é£Ÿå“/index.html","permalink":"https://mykkto.github.io/List/galleries/%E7%94%9C%E7%BE%8E%E9%A3%9F%E5%93%81/index.html","excerpt":"","text":""},{"title":"è‡ªç„¶é£æ™¯","date":"2022-01-06T14:09:33.744Z","updated":"2022-01-06T14:09:33.744Z","comments":true,"path":"List/galleries/è‡ªç„¶é£æ™¯/index.html","permalink":"https://mykkto.github.io/List/galleries/%E8%87%AA%E7%84%B6%E9%A3%8E%E6%99%AF/index.html","excerpt":"","text":""},{"title":"ç’€ç’¨æ˜Ÿç©º","date":"2022-01-06T14:09:33.743Z","updated":"2022-01-06T14:09:33.743Z","comments":true,"path":"List/galleries/ç’€ç’¨æ˜Ÿç©º/index.html","permalink":"https://mykkto.github.io/List/galleries/%E7%92%80%E7%92%A8%E6%98%9F%E7%A9%BA/index.html","excerpt":"","text":""}],"posts":[{"title":"äº‘åŸç”Ÿ_KubeSphere","slug":"03javaDistributed/04redis/01_Redis_Lock","date":"2022-04-07T13:01:06.000Z","updated":"2022-04-07T14:31:41.341Z","comments":true,"path":"posts/9843ee7f.html","link":"","permalink":"https://mykkto.github.io/posts/9843ee7f.html","excerpt":"","text":"ä¸€ã€æ¦‚è¿°1ã€2ã€3ã€4ã€5ã€äºŒã€1ã€2ã€3ã€4ã€5ã€ä¸‰ã€1ã€2ã€3ã€4ã€5ã€","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"jvm","slug":"jvm","permalink":"https://mykkto.github.io/tags/jvm/"},{"name":"å­—èŠ‚ç ","slug":"å­—èŠ‚ç ","permalink":"https://mykkto.github.io/tags/%E5%AD%97%E8%8A%82%E7%A0%81/"}],"author":"mykk"},{"title":"Luaè„šæœ¬è¯­è¨€åŸºç¡€","slug":"06scriptLanguage/01lua/01_lua","date":"2022-04-03T15:17:13.000Z","updated":"2022-04-05T01:55:06.141Z","comments":true,"path":"posts/fafe363a.html","link":"","permalink":"https://mykkto.github.io/posts/fafe363a.html","excerpt":"","text":"ä¸€ã€æ¦‚è¿°1ã€æ¦‚å¿µLuaæ˜¯ä¸€ç§è½»é‡ã€å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ã€‚è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åˆ°å…¶ä»–åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚ 2ã€ç‰¹æ€§è·Ÿå…¶ä»–è¯­è¨€è¿›è¡Œæ¯”è¾ƒï¼ŒLuaæœ‰å…¶è‡ªèº«çš„ç‰¹ç‚¹ï¼š ï¼ˆ1ï¼‰è½»é‡çº§ Luaç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ï¼Œç¼–è¯‘åä»…ä»…ä¸€ç™¾ä½™åƒå­—èŠ‚ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åµŒå…¥åˆ°å…¶ä»–ç¨‹åºä¸­ã€‚ ï¼ˆ2ï¼‰å¯æ‰©å±• Luaæä¾›éå¸¸ä¸°å¯Œæ˜“äºä½¿ç”¨çš„æ‰©å±•æ¥å£å’Œæœºåˆ¶ï¼Œç”±å®¿ä¸»è¯­è¨€(é€šå¸¸æ˜¯Cæˆ–C++)æä¾›åŠŸèƒ½ï¼ŒLuaå¯ä»¥ä½¿ç”¨å®ƒä»¬ï¼Œå°±åƒå†…ç½®çš„åŠŸèƒ½ä¸€æ ·ã€‚ ï¼ˆ3ï¼‰æ”¯æŒé¢å‘è¿‡ç¨‹ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹ 3ã€åº”ç”¨åœºæ™¯Luaåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­å¾—åˆ°å¤§é‡åº”ç”¨ï¼Œåœºæ™¯çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹: æ¸¸æˆå¼€å‘ã€ç‹¬ç«‹åº”ç”¨è„šæœ¬ã€webåº”ç”¨è„šæœ¬ã€æ‰©å±•å’Œæ•°æ®åº“æ’ä»¶ã€ç³»ç»Ÿå®‰å…¨ä¸Šã€‚ äºŒã€å®‰è£…1ã€å®˜ç½‘åœ¨linuxä¸Šå®‰è£…Luaéå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸‹è½½æºç åŒ…å¹¶åœ¨ç»ˆç«¯è§£å‹ã€ç¼–è¯‘å³å¯ä½¿ç”¨ã€‚ Luaçš„å®˜ç½‘åœ°å€ä¸º:https://www.lua.org 2ã€ä¸‹è½½å¹¶ä¸”è§£å‹1ã€ä¸‹è½½wget https://www.lua.org/ftp/lua-5.4.1.tar.gz 2ã€å®‰è£…ä¾èµ–libreadline-devä¾èµ–åŒ…ï¼Œéœ€è¦é€šè¿‡å‘½ä»¤æ¥è¿›è¡Œå®‰è£… yum install -y readline-devel 3ã€è§£å‹tar zxvf lua-5.4.1.tar.gz 4ã€ç¼–è¯‘å®‰è£…cd lua-5.4.1 make linux make install 5ã€éªŒè¯lua -v ä¸‰ã€Luaçš„è¯­æ³•1ã€ç¬¬ä¸€ä¸ªç¨‹åº1ã€è¿›å…¥æ§åˆ¶å°æ“ä½œ1ã€ç”¨ luaè¿›å…¥ 2ã€ç¼–å†™è¾“å‡ºè¯­å¥ï¼Œprint(â€œxxxxâ€) 3ã€ctrl+D é€€å‡ºæ§åˆ¶å° 2ã€lua æ–‡ä»¶è¿è¡Œ1ã€åˆ›å»º test.lua 2ã€ç¼–å†™è¯­å¥ï¼Œä¿å­˜ 3ã€è¿è¡Œ 3ã€luaç›´æ¥è¿è¡Œ 1ã€åˆ›å»º test2.lua 2ã€ç¼–å†™è¯­å¥çš„æ—¶å€™å‰ç¼€åŠ ä¸Šå£°æ˜ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ #!/usr/local/bin/lua 3ã€æ–‡ä»¶èµ‹æƒé™ï¼Œè¿è¡Œ chmod 755 test2.lua ./test2.lua 2ã€æ³¨é‡Š1ã€å•è¡Œæ³¨é‡Šçš„è¯­æ³•ä¸ºï¼š--æ³¨é‡Šå†…å®¹ 2ã€å¤šè¡Œæ³¨é‡Šçš„è¯­æ³•ä¸º:--[[ æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹ --]] 3ã€å–æ¶ˆå¤šè¡Œå¦‚æœæƒ³å–æ¶ˆå¤šè¡Œæ³¨é‡Šï¼Œåªéœ€è¦åœ¨ç¬¬ä¸€ä¸ªâ€“ä¹‹å‰åœ¨åŠ ä¸€ä¸ª-å³å¯ï¼Œå¦‚ï¼š ---[[ æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹ --]] 3ã€æ ‡è¯†ç¬¦æ¢å¥è¯è¯´æ ‡è¯†ç¬¦å°±æ˜¯æˆ‘ä»¬çš„å˜é‡åï¼ŒLuaå®šä¹‰å˜é‡åä»¥ä¸€ä¸ªå­—æ¯ A åˆ° Z æˆ– a åˆ° z æˆ–ä¸‹åˆ’çº¿ _ å¼€å¤´ååŠ ä¸Š0ä¸ªæˆ–å¤šä¸ªå­—æ¯ï¼Œä¸‹åˆ’çº¿ï¼Œæ•°å­—ï¼ˆ0åˆ°9ï¼‰ã€‚è¿™å—å»ºè®®å¤§å®¶æœ€å¥½ä¸è¦ä½¿ç”¨ä¸‹åˆ’çº¿åŠ å¤§å†™å­—æ¯çš„æ ‡è¯†ç¬¦ï¼Œå› ä¸ºLuaçš„ä¿ç•™å­—ä¹Ÿæ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œå®¹æ˜“å‘ç”Ÿå†²çªã€‚æ³¨æ„Luaæ˜¯åŒºåˆ†å¤§å°å†™å­—æ¯çš„ã€‚ ç®€å•æ¥è¯´å‚è€ƒjavaè§„èŒƒå°±å¥½ 4ã€å…³é”®å­—ä¸‹åˆ—æ˜¯Luaçš„å…³é”®å­—ï¼Œå¤§å®¶åœ¨å®šä¹‰å¸¸é‡ã€å˜é‡æˆ–å…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰æ ‡è¯†ç¬¦éƒ½è¦é¿å…ä½¿ç”¨ä»¥ä¸‹è¿™äº›å…³é”®å­—ï¼š and break do else elseif end false for function if in local nil not or repeat return then true until while goto ä¸€èˆ¬çº¦å®šï¼Œä»¥ä¸‹åˆ’çº¿å¼€å¤´è¿æ¥ä¸€ä¸²å¤§å†™å­—æ¯çš„åå­—ï¼ˆæ¯”å¦‚ _VERSIONï¼‰è¢«ä¿ç•™ç”¨äº Lua å†…éƒ¨å…¨å±€å˜é‡ã€‚è¿™ä¸ªä¹Ÿæ˜¯ä¸Šé¢æˆ‘ä»¬ä¸å»ºè®®è¿™ä¹ˆå®šä¹‰æ ‡è¯†ç¬¦çš„åŸå› ã€‚ 5ã€è¿ç®—ç¬¦Luaä¸­æ”¯æŒçš„è¿ç®—ç¬¦æœ‰ç®—æœ¯è¿ç®—ç¬¦ã€å…³ç³»è¿ç®—ç¬¦ã€é€»è¾‘è¿ç®—ç¬¦ã€å…¶ä»–è¿ç®—ç¬¦ã€‚ ç®—æœ¯è¿ç®—ç¬¦: + åŠ æ³• - å‡æ³• * ä¹˜æ³• / é™¤æ³• % å–ä½™ ^ ä¹˜å¹‚ - è´Ÿå· ä¾‹å¦‚: 10+20 --&gt;30 20-10 --&gt;10 10*20 --&gt;200 20/10 --&gt;2 3%2 --&gt;1 10^2 --&gt;100 -10 --&gt;-10 å…³ç³»è¿ç®—ç¬¦ == ç­‰äº ~= ä¸ç­‰äº &gt; å¤§äº &lt; å°äº &gt;= å¤§äºç­‰äº &lt;= å°äºç­‰äº ä¾‹å¦‚: 10==10 --&gt;true 10~=10 --&gt;false 20&gt;10 --&gt;true 20&lt;10 --&gt;false 20&gt;=10 --&gt;true 20&lt;=10 --&gt;false é€»è¾‘è¿ç®—ç¬¦ and é€»è¾‘ä¸ A and B &amp;&amp; or é€»è¾‘æˆ– A or B || not é€»è¾‘é å–åï¼Œå¦‚æœä¸ºtrue,åˆ™è¿”å›false ! é€»è¾‘è¿ç®—ç¬¦å¯ä»¥ä½œä¸ºifçš„åˆ¤æ–­æ¡ä»¶ï¼Œè¿”å›çš„ç»“æœå¦‚ä¸‹: A = true B = true A and B --&gt;true A or B --&gt;true not A --&gt;false ------------------------------------------------------------------------------------------------ A = true B = false A and B --&gt;false A or B --&gt;true not A --&gt;false ------------------------------------------------------------------------------------------------ A = false B = true A and B --&gt;false A or B --&gt;true not A --&gt;true å…¶ä»–è¿ç®—ç¬¦ .. è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸² # ä¸€å…ƒé¢„ç®—æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²æˆ–è¡¨çš„é•¿åº¦ ä¾‹å¦‚: &gt; \"HELLO \"..\"WORLD\" --&gt;HELLO WORLD &gt; #\"HELLO\" --&gt;5 6ã€å…¨å±€å˜é‡&amp;å±€éƒ¨å˜é‡åœ¨Luaè¯­è¨€ä¸­ï¼Œå…¨å±€å˜é‡æ— é¡»å£°æ˜å³å¯ä½¿ç”¨ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ€»æ˜¯è®¤ä¸ºæ˜¯å…¨å±€çš„ï¼Œå¦‚æœæœªæå‰èµ‹å€¼ï¼Œé»˜è®¤ä¸ºnil: è¦æƒ³å£°æ˜ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œéœ€è¦ä½¿ç”¨localæ¥å£°æ˜ 7ã€Luaæ•°æ®ç±»å‹Luaæœ‰8ä¸ªæ•°æ®ç±»å‹ nil(ç©ºï¼Œæ— æ•ˆå€¼) boolean(å¸ƒå°”ï¼Œtrue/false) number(æ•°å€¼) string(å­—ç¬¦ä¸²) function(å‡½æ•°) tableï¼ˆè¡¨ï¼‰ thread(çº¿ç¨‹) userdataï¼ˆç”¨æˆ·æ•°æ®ï¼‰ å¯ä»¥ä½¿ç”¨typeå‡½æ•°æµ‹è¯•ç»™å®šå˜é‡æˆ–è€…çš„ç±»å‹ï¼š print(type(nil)) --&gt;nil print(type(true)) --&gt; boolean print(type(1.1*1.1)) --&gt; number print(type(\"Hello world\")) --&gt; string print(type(type(X))) --&gt; string ï¼Œtypeå‡½æ•°è¿”å›çš„ä¹Ÿæ˜¯å­—ç¬¦ä¸²ç±»å‹ print(type(print)) --&gt; function print(type(type)) --&gt;function print(type{}) --&gt;table print(type(io.stdin)) --&gt;userdata nilnilæ˜¯ä¸€ç§åªæœ‰ä¸€ä¸ªnilå€¼çš„ç±»å‹ï¼Œå®ƒçš„ä½œç”¨å¯ä»¥ç”¨æ¥ä¸å…¶ä»–æ‰€æœ‰å€¼è¿›è¡ŒåŒºåˆ†ï¼Œä¹Ÿå¯ä»¥å½“æƒ³è¦ç§»é™¤ä¸€ä¸ªå˜é‡æ—¶ï¼Œåªéœ€è¦å°†è¯¥å˜é‡åèµ‹å€¼ä¸ºnil,åƒåœ¾å›æ”¶å°±ä¼šä¼šé‡Šæ”¾è¯¥å˜é‡æ‰€å ç”¨çš„å†…å­˜ã€‚ booleanbooleanç±»å‹å…·æœ‰ä¸¤ä¸ªå€¼ï¼Œtrueå’Œfalseã€‚booleanç±»å‹ä¸€èˆ¬è¢«ç”¨æ¥åšæ¡ä»¶åˆ¤æ–­çš„çœŸä¸å‡ã€‚åœ¨Luaè¯­è¨€ä¸­ï¼Œåªä¼šå°†falseå’Œnilè§†ä¸ºå‡ï¼Œå…¶ä»–çš„éƒ½è§†ä¸ºçœŸï¼Œç‰¹åˆ«æ˜¯åœ¨æ¡ä»¶æ£€æµ‹ä¸­0å’Œç©ºå­—ç¬¦ä¸²éƒ½ä¼šè®¤ä¸ºæ˜¯çœŸï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„å¤§å¤šæ•°è¯­è¨€ä¸å¤ªä¸€æ ·ã€‚ numberåœ¨Lua5.3ç‰ˆæœ¬å¼€å§‹ï¼ŒLuaè¯­è¨€ä¸ºæ•°å€¼æ ¼å¼æä¾›äº†ä¸¤ç§é€‰æ‹©:integer(æ•´å‹)å’Œfloat(åŒç²¾åº¦æµ®ç‚¹å‹)[å’Œå…¶ä»–è¯­è¨€ä¸å¤ªä¸€æ ·ï¼Œfloatä¸ä»£è¡¨å•ç²¾åº¦ç±»å‹]ã€‚ æ•°å€¼å¸¸é‡çš„è¡¨ç¤ºæ–¹å¼: &gt;4 --&gt;4 &gt;0.4 --&gt;0.4 &gt;4.75e-3 --&gt;0.00475 &gt;4.75e3 --&gt;4750 ä¸ç®¡æ˜¯æ•´å‹è¿˜æ˜¯åŒç²¾åº¦æµ®ç‚¹å‹ï¼Œä½¿ç”¨type()å‡½æ•°æ¥å–å…¶ç±»å‹ï¼Œéƒ½ä¼šè¿”å›çš„æ˜¯number &gt;type(3) --&gt;number &gt;type(3.3) --&gt;number æ‰€ä»¥å®ƒä»¬ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ï¼ŒåŒæ—¶ï¼Œå…·æœ‰ç›¸åŒç®—æœ¯å€¼çš„æ•´å‹å€¼å’Œæµ®ç‚¹å‹å€¼åœ¨Luaè¯­è¨€ä¸­æ˜¯ç›¸ç­‰çš„ stringLuaè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å³å¯ä»¥è¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€æ•´æœ¬ä¹¦ç±ã€‚åœ¨Luaè¯­è¨€ä¸­ï¼Œæ“ä½œ100Kæˆ–è€…1Mä¸ªå­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²çš„ç¨‹åºå¾ˆå¸¸è§ã€‚ å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·æ¥å£°æ˜å­—ç¬¦ä¸² &gt;a = \"hello\" &gt;b = 'world' &gt;print(a) --&gt;hello &gt;print(b) --&gt;world å¦‚æœå£°æ˜çš„å­—ç¬¦ä¸²æ¯”è¾ƒé•¿æˆ–è€…æœ‰å¤šè¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œå£°æ˜ html = [[ &lt;html&gt; &lt;head&gt; &lt;title&gt;Lua-string&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;a href=\"http://www.lua.org\"&gt;Lua&lt;/a&gt; &lt;/body&gt; &lt;/html&gt; ]] tableâ€‹ tableæ˜¯Luaè¯­è¨€ä¸­æœ€ä¸»è¦å’Œå¼ºå¤§çš„æ•°æ®ç»“æ„ã€‚ä½¿ç”¨è¡¨ï¼Œ Lua è¯­è¨€å¯ä»¥ä»¥ä¸€ç§ç®€å•ã€ç»Ÿä¸€ä¸”é«˜æ•ˆçš„æ–¹å¼è¡¨ç¤ºæ•°ç»„ã€é›†åˆã€è®°å½•å’Œå…¶ä»–å¾ˆå¤šæ•°æ®ç»“æ„ã€‚ Luaè¯­è¨€ä¸­çš„è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è¾…åŠ©æ•°ç»„ã€‚è¿™ç§æ•°ç»„æ¯”Javaä¸­çš„æ•°ç»„æ›´åŠ çµæ´»ï¼Œå¯ä»¥ä½¿ç”¨æ•°å€¼åšç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æˆ–å…¶ä»–ä»»æ„ç±»å‹çš„å€¼ä½œç´¢å¼•(é™¤nilå¤–)ã€‚ åˆ›å»ºè¡¨çš„æœ€ç®€å•æ–¹å¼: &gt; a = {} åˆ›å»ºæ•°ç»„: â€‹ æˆ‘ä»¬éƒ½çŸ¥é“æ•°ç»„å°±æ˜¯ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ æŒ‰ç…§ä¸€å®šé¡ºåºæ’åˆ—çš„é›†åˆï¼Œé‚£ä¹ˆä½¿ç”¨tableå¦‚ä½•åˆ›å»ºä¸€ä¸ªæ•°ç»„å‘¢? &gt;arr = {\"TOM\",\"JERRY\",\"ROSE\"} â€‹ è¦æƒ³è·å–æ•°ç»„ä¸­çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å†…å®¹æ¥è·å–: print(arr[0]) nil print(arr[1]) TOM print(arr[2]) JERRY print(arr[3]) ROSE â€‹ ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ•°ç»„çš„ä¸‹æ ‡é»˜è®¤æ˜¯ä»1å¼€å§‹çš„ã€‚æ‰€ä»¥ä¸Šè¿°åˆ›å»ºæ•°ç»„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥åˆ›å»º &gt;arr = {} &gt;arr[1] = \"TOM\" &gt;arr[2] = \"JERRY\" &gt;arr[3] = \"ROSE\" ä¸Šé¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œè¡¨çš„ç´¢å¼•å³å¯ä»¥æ˜¯æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç­‰å…¶ä»–çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç´¢å¼•æ›´æ”¹ä¸ºå­—ç¬¦ä¸²æ¥åˆ›å»º &gt;arr = {} &gt;arr[\"X\"] = 10 &gt;arr[\"Y\"] = 20 &gt;arr[\"Z\"] = 30 å½“ç„¶ï¼Œå¦‚æœæƒ³è¦è·å–è¿™äº›æ•°ç»„ä¸­çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ æ–¹å¼ä¸€ &gt;print(arr[\"X\"]) &gt;print(arr[\"Y\"]) &gt;print(arr[\"Z\"]) æ–¹å¼äºŒ &gt;print(arr.X) &gt;print(arr.Y) &gt;print(arr.Z) å½“å‰tableçš„çµæ´»ä¸è¿›äºæ­¤ï¼Œè¿˜æœ‰æ›´çµæ´»çš„å£°æ˜æ–¹å¼ &gt;arr = {\"TOM\",X=10,\"JERRY\",Y=20,\"ROSE\",Z=30} å¦‚ä½•è·å–ä¸Šé¢çš„å€¼? TOM : arr[1] 10 : arr[\"X\"] | arr.X JERRY: arr[2] 20 : arr[\"Y\"] | arr.Y ROESE? functionåœ¨ Luaè¯­è¨€ä¸­ï¼Œå‡½æ•°ï¼ˆ Function ï¼‰æ˜¯å¯¹è¯­å¥å’Œè¡¨è¾¾å¼è¿›è¡ŒæŠ½è±¡çš„ä¸»è¦æ–¹å¼ã€‚ å®šä¹‰å‡½æ•°çš„è¯­æ³•ä¸º: function functionName(params) end å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ä¸ªæ•°ä¸å®šä¹‰å‡½æ•°æ—¶ä½¿ç”¨çš„å‚æ•°ä¸ªæ•°ä¸ä¸€è‡´çš„æ—¶å€™ï¼ŒLua è¯­è¨€ä¼šé€šè¿‡ æŠ›å¼ƒå¤šä½™å‚æ•°å’Œå°†ä¸è¶³çš„å‚æ•°è®¾ä¸º nil çš„æ–¹å¼æ¥è°ƒæ•´å‚æ•°çš„ä¸ªæ•°ã€‚ function f(a,b) print(a,b) end f() --&gt; nil nil f(2) --&gt; 2 nil f(2,6) --&gt; 2 6 f(2.6.8) --&gt; 2 6 (8è¢«ä¸¢å¼ƒ) å¯å˜é•¿å‚æ•°å‡½æ•° function add(...) a,b,c=... print(a) print(b) print(c) end add(1,2,3) --&gt; 1 2 3 å‡½æ•°è¿”å›å€¼å¯ä»¥æœ‰å¤šä¸ªï¼Œè¿™ç‚¹å’ŒJavaä¸å¤ªä¸€æ · function f(a,b) return a,b end x,y=f(11,22) --&gt; x=11,y=22 threadthreadç¿»è¯‘è¿‡æ¥æ˜¯çº¿ç¨‹çš„æ„æ€ï¼Œåœ¨Luaä¸­ï¼Œthreadç”¨æ¥è¡¨ç¤ºæ‰§è¡Œçš„ç‹¬ç«‹çº¿è·¯ï¼Œç”¨æ¥æ‰§è¡ŒååŒç¨‹åºã€‚ userdatauserdataæ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œç”¨äºè¡¨ç¤ºä¸€ç§ç”±åº”ç”¨ç¨‹åºæˆ–C/C++è¯­è¨€åº“æ‰€åˆ›å»ºçš„ç±»å‹ã€‚ 8ã€Luaæ§åˆ¶ç»“æ„Lua è¯­è¨€æä¾›äº†ä¸€ç»„ç²¾ç®€ä¸”å¸¸ç”¨çš„æ§åˆ¶ç»“æ„ï¼ŒåŒ…æ‹¬ç”¨äºæ¡ä»¶æ‰§è¡Œçš„è¯ ä»¥åŠç”¨äºå¾ªç¯çš„ whileã€ repeat å’Œ forã€‚ æ‰€æœ‰çš„æ§åˆ¶ç»“æ„è¯­æ³•ä¸Šéƒ½æœ‰ä¸€ä¸ªæ˜¾å¼çš„ç»ˆç»“ç¬¦ï¼š end ç”¨äºç»ˆç»“ ifã€ for åŠ while ç»“æ„ï¼Œ until ç”¨äºç»ˆç»“ repeat ç»“æ„ã€‚ if then elseif elseifè¯­å¥å…ˆæµ‹è¯•å…¶æ¡ä»¶ï¼Œå¹¶æ ¹æ®æ¡ä»¶æ˜¯å¦æ»¡è¶³æ‰§è¡Œç›¸åº”çš„ then éƒ¨åˆ†æˆ– else éƒ¨åˆ†ã€‚ else éƒ¨åˆ† æ˜¯å¯é€‰çš„ã€‚ function testif(a) if a&gt;0 then print(\"aæ˜¯æ­£æ•°\") end end function testif(a) if a&gt;0 then print(\"aæ˜¯æ­£æ•°\") else print(\"aæ˜¯è´Ÿæ•°\") end end å¦‚æœè¦ç¼–å†™åµŒå¥—çš„ if è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨ elseifã€‚ å®ƒç±»ä¼¼äºåœ¨ else åé¢ç´§è·Ÿä¸€ä¸ªifã€‚æ ¹æ®ä¼ å…¥çš„å¹´é¾„è¿”å›ä¸åŒçš„ç»“æœï¼Œå¦‚ age&lt;=18 é’å°‘å¹´ï¼Œ age&gt;18 , age &lt;=45 é’å¹´ age&gt;45 , age&lt;=60 ä¸­å¹´äºº age&gt;60 è€å¹´äºº function show(age) if age&lt;=18 then return \"é’å°‘å¹´\" elseif age&gt;18 and age&lt;=45 then return \"é’å¹´\" elseif age&gt;45 and age&lt;=60 then return \"ä¸­å¹´äºº\" elseif age&gt;60 then return \"è€å¹´äºº\" end end whileå¾ªç¯é¡¾åæ€ä¹‰ï¼Œå½“æ¡ä»¶ä¸ºçœŸæ—¶ while å¾ªç¯ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ã€‚ Lua è¯­è¨€å…ˆæµ‹è¯• while è¯­å¥ çš„æ¡ä»¶ï¼Œè‹¥æ¡ä»¶ä¸ºå‡åˆ™å¾ªç¯ç»“æŸï¼›å¦åˆ™ï¼Œ Lua ä¼šæ‰§è¡Œå¾ªç¯ä½“å¹¶ä¸æ–­åœ°é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚ è¯­æ³•ï¼š while æ¡ä»¶ do å¾ªç¯ä½“ end ä¾‹å­:å®ç°æ•°ç»„çš„å¾ªç¯ function testWhile() local i = 1 while i&lt;=10 do print(i) i=i+1 end end repeatå¾ªç¯é¡¾åæ€ä¹‰ï¼Œ repeat-untilè¯­å¥ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ç›´åˆ°æ¡ä»¶ä¸ºçœŸæ—¶ç»“æŸã€‚ ç”±äºæ¡ä»¶æµ‹è¯•åœ¨å¾ªç¯ä½“ä¹‹åæ‰§è¡Œï¼Œæ‰€ä»¥å¾ªç¯ä½“è‡³å°‘ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ è¯­æ³• repeat å¾ªç¯ä½“ until æ¡ä»¶ function testRepeat() local i = 10 repeat print(i) i=i-1 until i &lt; 1 end forå¾ªç¯æ•°å€¼å‹forå¾ªç¯ è¯­æ³• for param=exp1,exp2,exp3 do å¾ªç¯ä½“ end paramçš„å€¼ä»exp1å˜åŒ–åˆ°exp2ä¹‹å‰çš„æ¯æ¬¡å¾ªç¯ä¼šæ‰§è¡Œ å¾ªç¯ä½“ï¼Œå¹¶åœ¨æ¯æ¬¡å¾ªç¯ç»“æŸåå°†æ­¥é•¿(step)exp3å¢åŠ åˆ°paramä¸Šã€‚exp3å¯é€‰ï¼Œå¦‚æœä¸è®¾ç½®é»˜è®¤ä¸º1 äººè¯ï¼šä»è¾“å‡º1å¼€å§‹ï¼Œæ¯æ¬¡ +10ï¼Œå°äº100ï¼ˆ1ï¼Œ11ï¼Œ21ï¼Œâ€¦,91ï¼‰ for i = 1,100,10 do print(i) end æ³›å‹forå¾ªç¯ æ³›å‹forå¾ªç¯é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°æ¥éå†æ‰€æœ‰å€¼ï¼Œç±»ä¼¼äºjavaä¸­çš„foreachè¯­å¥ã€‚ è¯­æ³• for i,v in ipairs(x) do å¾ªç¯ä½“ end iæ˜¯æ•°ç»„ç´¢å¼•å€¼ï¼Œvæ˜¯å¯¹åº”ç´¢å¼•çš„æ•°ç»„å…ƒç´ å€¼ï¼Œipairsæ˜¯Luaæä¾›çš„ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°ï¼Œç”¨æ¥è¿­ä»£æ•°ç»„ï¼Œxæ˜¯è¦éå†çš„æ•°ç»„ã€‚ ä¾‹å¦‚: arr = {\"TOME\",\"JERRY\",\"ROWS\",\"LUCY\"} for i,v in ipairs(arr) do print(i,v) end ä¸Šè¿°å®ä¾‹è¾“å‡ºçš„ç»“æœä¸º 1 TOM 2 JERRY 3 ROWS 4 LUCY ä½†æ˜¯å¦‚æœå°†arrçš„å€¼è¿›è¡Œä¿®æ”¹ä¸º arr = {\"TOME\",\"JERRY\",\"ROWS\",x=\"JACK\",\"LUCY\"} åŒæ ·çš„ä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±åªèƒ½çœ‹åˆ°å’Œä¹‹å‰ä¸€æ ·çš„ç»“æœï¼Œè€Œå…¶ä¸­çš„xä¸ºJACKå°±æ— æ³•éå†å‡ºæ¥ï¼Œç¼ºå¤±äº†æ•°æ®ï¼Œå¦‚æœè§£å†³å‘¢? æˆ‘ä»¬å¯ä»¥å°†è¿­ä»£å™¨å‡½æ•°å˜æˆpairs,å¦‚ for i,v in pairs(arr) do print(i,v) end ä¸Šè¿°å®ä¾‹å°±è¾“å‡ºçš„ç»“æœä¸º 1 TOM 2 JERRY 3 ROWS 4 LUCY x JACK å››ã€OpenResty1ã€åŸºæœ¬æ“ä½œ1ã€æ˜¯ä»€ä¹ˆOpenRestyæ˜¯ä¸€ä¸ªåŸºäºNginxä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚æ‰€ä»¥æœ¬èº«OpenRestyå†…éƒ¨å°±å·²ç»é›†æˆäº†Nginxå’ŒLuaï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ã€‚ 2ã€å®‰è£…è¯¦æƒ…å¯è§ã€OpenRestyã€‘ 1ã€æ‹‰å–docker pull openresty/openresty 2ã€æŒ‚è½½å¹¶å¯åŠ¨è¯´æ˜ä¸‹ï¼š å®Œå…¨åŸºäºä¸Šé¢çš„nginxé…ç½®çš„ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå”¯ä¸€ä¿®æ”¹çš„æ˜¯ nginx.confé…ç½®æ–‡ä»¶ï¼Œè¿™è¾¹æŒ‚è½½æ”¹æˆäº† nginx2.confï¼Œç”¨äºä¿ç•™ä¹‹å‰çš„ï¼ˆè‡ªå·±æ‡’è€Œå·²ï¼‰ æ–°å¢äº†ï¼Œluaæ–‡ä»¶æŒ‚è½½ ä¿®æ”¹äº†å®¹å™¨å†…çš„æŒ‚è½½ä½ç½®ï¼Œå› ä¸º openrestyå®¹å™¨ä½ç½®ä¸ä¸€æ ·äº†(å¤–éƒ¨è¿˜æ˜¯ä¸å˜ï¼Œå®¹å™¨å†…çš„ä½ç½®å˜äº†) docker run -d -p 443:443 -p 80:80 --name openresty -v /root/nginx/www:/usr/local/openresty/nginx/html -v /root/nginx/conf/nginx2.conf:/usr/local/openresty/nginx/conf/nginx.conf -v /root/nginx/logs:/usr/local/openresty/nginx/logs -v /root/nginx/lls/:/usr/local/openresty/nginx/ssl -v /root/nginx/lua/:/usr/local/openresty/nginx/lua openresty/openresty 2ã€ngx_luaçš„ä½¿ç”¨ä½¿ç”¨Luaç¼–å†™Nginxè„šæœ¬çš„åŸºæœ¬æ„å»ºå—æ˜¯æŒ‡ä»¤ã€‚æŒ‡ä»¤ç”¨äºæŒ‡å®šä½•æ—¶è¿è¡Œç”¨æˆ·Luaä»£ç ä»¥åŠå¦‚ä½•ä½¿ç”¨ç»“æœã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æ‰§è¡ŒæŒ‡ä»¤çš„é¡ºåºã€‚ å…ˆæ¥è§£é‡Šä¸‹*çš„ä½œç”¨ *ï¼šæ—  ï¼Œ å³ xxx_by_lua ,æŒ‡ä»¤åé¢è·Ÿçš„æ˜¯ luaæŒ‡ä»¤ *:_fileï¼Œå³ xxx_by_lua_file æŒ‡ä»¤åé¢è·Ÿçš„æ˜¯ luaæ–‡ä»¶ *:_block,å³ xxx_by_lua_block åœ¨0.9.17ç‰ˆåæ›¿æ¢init_by_lua_file init_by_lua*è¯¥æŒ‡ä»¤åœ¨æ¯æ¬¡Nginxé‡æ–°åŠ è½½é…ç½®æ—¶æ‰§è¡Œï¼Œå¯ä»¥ç”¨æ¥å®Œæˆä¸€äº›è€—æ—¶æ¨¡å—çš„åŠ è½½ï¼Œæˆ–è€…åˆå§‹åŒ–ä¸€äº›å…¨å±€é…ç½®ã€‚ init_worker_by_lua*è¯¥æŒ‡ä»¤ç”¨äºå¯åŠ¨ä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œå¦‚å¿ƒè·³æ£€æŸ¥ã€å®šæ—¶æ‹‰å–æœåŠ¡å™¨é…ç½®ç­‰ã€‚ set_by_lua*è¯¥æŒ‡ä»¤åªè¦ç”¨æ¥åšå˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¸€æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶å°†ç»“æœèµ‹å€¼ç»™Nginxä¸­æŒ‡å®šçš„å˜é‡ã€‚ rewrite_by_lua*è¯¥æŒ‡ä»¤ç”¨äºæ‰§è¡Œå†…éƒ¨URLé‡å†™æˆ–è€…å¤–éƒ¨é‡å®šå‘ï¼Œå…¸å‹çš„å¦‚ä¼ªé™æ€åŒ–URLé‡å†™ï¼Œæœ¬é˜¶æ®µåœ¨rewriteå¤„ç†é˜¶æ®µçš„æœ€åé»˜è®¤æ‰§è¡Œã€‚ access_by_lua*è¯¥æŒ‡ä»¤ç”¨äºè®¿é—®æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªå…è®¸å†…ç½‘IPè®¿é—®ã€‚ content_by_lua*è¯¥æŒ‡ä»¤æ˜¯åº”ç”¨æœ€å¤šçš„æŒ‡ä»¤ï¼Œå¤§éƒ¨åˆ†ä»»åŠ¡æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µå®Œæˆçš„ï¼Œå…¶ä»–çš„è¿‡ç¨‹å¾€å¾€ä¸ºè¿™ä¸ªé˜¶æ®µå‡†å¤‡æ•°æ®ï¼Œæ­£å¼å¤„ç†åŸºæœ¬éƒ½åœ¨æœ¬é˜¶æ®µã€‚ header_filter_by_lua*è¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®åº”ç­”æ¶ˆæ¯çš„å¤´éƒ¨ä¿¡æ¯ã€‚ body_filter_by_lua*è¯¥æŒ‡ä»¤æ˜¯å¯¹å“åº”æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æˆªæ–­ã€æ›¿æ¢ã€‚ log_by_lua*è¯¥æŒ‡ä»¤ç”¨äºåœ¨logè¯·æ±‚å¤„ç†é˜¶æ®µï¼Œç”¨Luaä»£ç å¤„ç†æ—¥å¿—ï¼Œä½†å¹¶ä¸æ›¿æ¢åŸæœ‰logå¤„ç†ã€‚ balancer_by_lua*è¯¥æŒ‡ä»¤ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç°ä¸Šæ¸¸æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å™¨ç®—æ³• ssl_certificate_by_*è¯¥æŒ‡ä»¤ä½œç”¨åœ¨Nginxå’Œä¸‹æ¸¸æœåŠ¡å¼€å§‹ä¸€ä¸ªSSLæ¡æ‰‹æ“ä½œæ—¶å°†å…è®¸æœ¬é…ç½®é¡¹çš„Luaä»£ç ã€‚ éœ€æ±‚:http://192.168.200.133?name=å¼ ä¸‰&amp;gender=1 Nginxæ¥æ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ®genderä¼ å…¥çš„å€¼ï¼Œå¦‚æœgenderä¼ å…¥çš„æ˜¯1ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤º å¼ ä¸‰å…ˆç”Ÿ,å¦‚æœgenderä¼ å…¥çš„æ˜¯0ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰å¥³å£«,å¦‚æœæœªä¼ æˆ–è€…ä¼ å…¥çš„ä¸æ˜¯1å’Œ2åˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰ã€‚ å®ç°ä»£ç  æ³¨æ„ï¼šåŠ å…¥é…ç½®æ–‡ä»¶çš„æ—¶å€™ #å†…å®¹è¦å»æ‰ location /getByGender { default_type 'text/html'; set_by_lua $name \" #è·å–è¯·æ±‚urlä¸Šçš„å€¼ nameï¼Œgender local uri_args = ngx.req.get_uri_args() gender = uri_args['gender'] name = uri_args['name'] if gender=='1' then return name..'å…ˆç”Ÿ' elseif gender=='0' then return name..'å¥³å£«' else return name end \"; #è§£å†³ä¹±ç é—®é¢˜ charset utf-8; return 200 $name; } 3ã€ngx_luaæ“ä½œRedis1ã€ApiåŠå…¶è¯­å¥è¯´æ˜lua-resty-redisæä¾›äº†è®¿é—®Redisçš„è¯¦ç»†APIï¼ŒåŒ…æ‹¬åˆ›å»ºå¯¹æ¥ã€è¿æ¥ã€æ“ä½œã€æ•°æ®å¤„ç†ç­‰ã€‚è¿™äº›APIåŸºæœ¬ä¸Šä¸Redisçš„æ“ä½œä¸€ä¸€å¯¹åº”ã€‚ ï¼ˆ1ï¼‰redis = require \"resty.redis\" ï¼ˆ2ï¼‰new è¯­æ³•: redis,err = redis:new(),åˆ›å»ºä¸€ä¸ªRediså¯¹è±¡ã€‚ ï¼ˆ3ï¼‰connect è¯­æ³•:ok,err=redis:connect(host,port[,options_table]),è®¾ç½®è¿æ¥Redisçš„è¿æ¥ä¿¡æ¯ã€‚ ok:è¿æ¥æˆåŠŸè¿”å› 1ï¼Œè¿æ¥å¤±è´¥è¿”å›nil err:è¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ ï¼ˆ4ï¼‰set_timeout è¯­æ³•: redis:set_timeout(time) ï¼Œè®¾ç½®è¯·æ±‚æ“ä½œRedisçš„è¶…æ—¶æ—¶é—´ã€‚ ï¼ˆ5ï¼‰close è¯­æ³•: ok,err = redis:close(),å…³é—­å½“å‰è¿æ¥ï¼ŒæˆåŠŸè¿”å›1ï¼Œå¤±è´¥è¿”å›nilå’Œé”™è¯¯ä¿¡æ¯ ï¼ˆ6ï¼‰rediså‘½ä»¤å¯¹åº”çš„æ–¹æ³• åœ¨lua-resty-redisä¸­ï¼Œæ‰€æœ‰çš„Rediså‘½ä»¤éƒ½æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œæ–¹æ³•åå­—å’Œå‘½ä»¤åå­—ç›¸åŒï¼Œåªæ˜¯å…¨éƒ¨ä¸ºå°å†™ã€‚ 2ã€å®ç°location /testRedis { default_type \"text/html\"; content_by_lua_block{ local redis = require \"resty.redis\" -- å¼•å…¥Redis local redisObj = redis:new() --åˆ›å»ºRediså¯¹è±¡ redisObj:set_timeout(1000) --è®¾ç½®è¶…æ—¶æ•°æ®ä¸º1s local ok,err = redisObj:connect(\"10.0.4.7\",6379) --è®¾ç½®redisè¿æ¥ä¿¡æ¯ï¼Œè¿™è¾¹ä¸è¦ç”¨127.0.0.1 if not ok then --åˆ¤æ–­æ˜¯å¦è¿æ¥æˆåŠŸ ngx.say(\"failed to connection redis\",err) return end ok,err = redisObj:set(\"username\",\"TOM\")--å­˜å…¥æ•°æ® if not ok then --åˆ¤æ–­æ˜¯å¦å­˜å…¥æˆåŠŸ ngx.say(\"failed to set username\",err) return end local res,err = redisObj:get(\"username\") --ä»redisä¸­è·å–æ•°æ® ngx.say(res) --å°†æ•°æ®å†™ä¼šæ¶ˆæ¯ä½“ä¸­ redisObj:close() } } 4ã€ngx_luaæ“ä½œMysql1ã€æŸ¥è¯¢1ã€å‡†å¤‡driverClass=com.mysql.jdbc.Driver url=jdbc:mysql://10.0.4.7:3306/nginx_db username=root password=root 2ã€å»ºåº“ create table users( id int primary key auto_increment, username varchar(30), birthday date, salary double ); insert into users(id,username,birthday,salary) values(null,\"TOM\",\"1988-11-11\",10000.0); insert into users(id,username,birthday,salary) values(null,\"JERRY\",\"1989-11-11\",20000.0); insert into users(id,username,birthday,salary) values(null,\"ROWS\",\"1990-11-11\",30000.0); insert into users(id,username,birthday,salary) values(null,\"LUCY\",\"1991-11-11\",40000.0); insert into users(id,username,birthday,salary) values(null,\"JACK\",\"1992-11-11\",50000.0); 3ã€Apiè¯¦è§£ï¼ˆ1ï¼‰å¼•å…¥\"resty.mysql\"æ¨¡å— local mysql = require \"resty.mysql\" ï¼ˆ2ï¼‰new åˆ›å»ºä¸€ä¸ªMySQLè¿æ¥å¯¹è±¡ï¼Œé‡åˆ°é”™è¯¯æ—¶ï¼Œdbä¸ºnilï¼Œerrä¸ºé”™è¯¯æè¿°ä¿¡æ¯ è¯­æ³•: db,err = mysql:new() ï¼ˆ3ï¼‰connect å°è¯•è¿æ¥åˆ°ä¸€ä¸ªMySQLæœåŠ¡å™¨ è¯­æ³•:ok,err=db:connect(options),optionsæ˜¯ä¸€ä¸ªå‚æ•°çš„Luaè¡¨ç»“æ„ï¼Œé‡Œé¢åŒ…å«æ•°æ®åº“è¿æ¥çš„ç›¸å…³ä¿¡æ¯ host:æœåŠ¡å™¨ä¸»æœºåæˆ–IPåœ°å€ port:æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º3306 user:ç™»å½•çš„ç”¨æˆ·å password:ç™»å½•å¯†ç  database:ä½¿ç”¨çš„æ•°æ®åº“å ï¼ˆ4ï¼‰set_timeout è®¾ç½®å­è¯·æ±‚çš„è¶…æ—¶æ—¶é—´(ms)ï¼ŒåŒ…æ‹¬connectæ–¹æ³• è¯­æ³•:db:set_timeout(time) ï¼ˆ5ï¼‰close å…³é—­å½“å‰MySQLè¿æ¥å¹¶è¿”å›çŠ¶æ€ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›1ï¼›å¦‚æœå‡ºç°ä»»ä½•é”™è¯¯ï¼Œåˆ™å°†è¿”å›nilå’Œé”™è¯¯æè¿°ã€‚ è¯­æ³•:db:close() ï¼ˆ6ï¼‰send_query å¼‚æ­¥å‘è¿œç¨‹MySQLå‘é€ä¸€ä¸ªæŸ¥è¯¢ã€‚å¦‚æœæˆåŠŸåˆ™è¿”å›æˆåŠŸå‘é€çš„å­—èŠ‚æ•°ï¼›å¦‚æœé”™è¯¯ï¼Œåˆ™è¿”å›nilå’Œé”™è¯¯æè¿° è¯­æ³•:bytes,err=db:send_query(sql) ï¼ˆ7ï¼‰read_result ä»MySQLæœåŠ¡å™¨è¿”å›ç»“æœä¸­è¯»å–ä¸€è¡Œæ•°æ®ã€‚resè¿”å›ä¸€ä¸ªæè¿°OKåŒ…æˆ–ç»“æœé›†åŒ…çš„Luaè¡¨,è¯­æ³•: res, err, errcode, sqlstate = db:read_result() res, err, errcode, sqlstate = db:read_result(rows) :rowsæŒ‡å®šè¿”å›ç»“æœé›†çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ä¸º4 å¦‚æœæ˜¯æŸ¥è¯¢ï¼Œåˆ™è¿”å›ä¸€ä¸ªå®¹çº³å¤šè¡Œçš„æ•°ç»„ã€‚æ¯è¡Œæ˜¯ä¸€ä¸ªæ•°æ®åˆ—çš„key-valueå¯¹ï¼Œå¦‚ { {id=1,username=\"TOM\",birthday=\"1988-11-11\",salary=10000.0}, {id=2,username=\"JERRY\",birthday=\"1989-11-11\",salary=20000.0} } å¦‚æœæ˜¯å¢åˆ æ”¹ï¼Œåˆ™è¿”å›ç±»ä¸Šå¦‚ä¸‹æ•°æ® { insert_id = 0, server_status=2, warning_count=1, affected_rows=2, message=nil } è¿”å›å€¼: res:æ“ä½œçš„ç»“æœé›† err:é”™è¯¯ä¿¡æ¯ errcode:MySQLçš„é”™è¯¯ç ï¼Œæ¯”å¦‚1064 sqlstate:è¿”å›ç”±5ä¸ªå­—ç¬¦ç»„æˆçš„æ ‡å‡†SQLé”™è¯¯ç ï¼Œæ¯”å¦‚42000 4ã€å®ç°location /mysqlSearch{ default_type 'text/html'; content_by_lua_block{ local mysql = require \"resty.mysql\" local db = mysql:new() local ok,err = db:connect{ host=\"10.0.4.7\", #ä¸è¦ç”¨127.0.0.1 port=3306, user=\"root\", password=\"root\", database=\"lua_db\" } db:set_timeout(1000) db:send_query(\"select * from users where id =1\") local res,err,errcode,sqlstate = db:read_result() ngx.say(res[1].id..\",\"..res[1].username..\",\"..res[1].birthday..\",\"..res[1].salary) db:close() } } 5ã€ğŸ¤ä¼˜åŒ–:location /mysqlSearch { default_type 'text/html'; content_by_lua_block{ local mysql = require \"resty.mysql\" local db = mysql:new() local ok,err = db:connect{ host=\"10.0.4.7\", port=3306, user=\"root\", password=\"root\", database=\"lua_db\" } db:set_timeout(1000) local uri_args = ngx.req.get_uri_args() local reqId = uri_args['id'] db:send_query(\"select * from users where id =\"..reqId) local res,err,errcode,sqlstate = db:read_result() ngx.say(res[1].id..\",\"..res[1].username..\",\"..res[1].birthday..\",\"..res[1].salary) db:close() } } 6ã€ğŸ›°lua-cjsonread_result()å¾—åˆ°çš„ç»“æœreséƒ½æ˜¯tableç±»å‹ï¼Œè¦æƒ³åœ¨é¡µé¢ä¸Šå±•ç¤ºï¼Œå°±å¿…é¡»çŸ¥é“tableçš„å…·ä½“æ•°æ®ç»“æ„æ‰èƒ½è¿›è¡Œéå†è·å–ã€‚å¤„ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸€ç§ç®€å•æ–¹å¼cjsonï¼Œä½¿ç”¨å®ƒå°±å¯ä»¥å°†tableç±»å‹çš„æ•°æ®è½¬æ¢æˆjsonå­—ç¬¦ä¸²ï¼ŒæŠŠjsonå­—ç¬¦ä¸²å±•ç¤ºåœ¨é¡µé¢ä¸Šå³å¯ã€‚ æ­¥éª¤ä¸€ï¼šå¼•å…¥cjson local cjson = require \"cjson\" æ­¥éª¤äºŒï¼šè°ƒç”¨cjsonçš„encodeæ–¹æ³•è¿›è¡Œç±»å‹è½¬æ¢ cjson.encode(res) ä¼˜åŒ–ä»£ç ï¼š location /mysqlSearch { default_type 'text/html'; content_by_lua_block{ local mysql = require \"resty.mysql\" local db = mysql:new() local cjson = require \"cjson\" local ok,err = db:connect{ host=\"10.0.4.7\", port=3306, user=\"root\", password=\"root\", database=\"lua_db\" } db:set_timeout(1000) local uri_args = ngx.req.get_uri_args() local reqId = uri_args['id'] db:send_query(\"select * from users where id =\"..reqId) local res,err,errcode,sqlstate = db:read_result() ngx.say(cjson.encode(res)) for i,v in ipairs(res) do ngx.say(v.id..\",\"..v.username..\",\"..v.birthday..\",\"..v.salary) end db:close() } } 2ã€å¢åˆ æ”¹location /mysql { default_type 'text/html'; content_by_lua_block{ local mysql = require \"resty.mysql\" local db = mysql:new() local cjson = require \"cjson\" local ok,err = db:connect{ host=\"10.0.4.7\", port=3306, user=\"root\", password=\"root\", database=\"lua_db\" } db:set_timeout(1000) local uri_args = ngx.req.get_uri_args() local reqId = uri_args['id'] local reqType = uri_args['reqType'] db:send_query(\"select * from users where id =\"..reqId) if reqType == 'search' then local res,err,errcode,sqlstate = db:read_result() ngx.say(cjson.encode(res)) for i,v in ipairs(res) do ngx.say(v.id..\",\"..v.username..\",\"..v.birthday..\",\"..v.salary) end elseif reqType == 'add' then local res,err,errcode,sqlstate = db:query(\"insert into users(id,username,birthday,salary) values(6,'zhangsan','2023-11-11',32222.0)\") elseif reqType == 'update' then local res,err,errcode,sqlstate = db:query(\"update users set username='lisi' where id = 6\") elseif reqType == 'delete' then local res,err,errcode,sqlstate = db:query(\"delete from users where id = 6\") end db:close() } } 5ã€Rdisç¼“å­˜é¢„çƒ­ä½¿ç”¨ngx_luaæ¨¡å—å®ŒæˆRedisç¼“å­˜é¢„çƒ­ã€‚ æ­¥éª¤: ï¼ˆ1ï¼‰å…ˆå¾—æœ‰ä¸€å¼ è¡¨(users) ï¼ˆ2ï¼‰æµè§ˆå™¨è¾“å…¥å¦‚ä¸‹åœ°å€ http://10.0.4.7?username=TOM ï¼ˆ3ï¼‰ä»è¡¨ä¸­æŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œæ­¤æ—¶è·å–çš„ç»“æœä¸ºtableç±»å‹ ï¼ˆ4ï¼‰ä½¿ç”¨cjsonå°†tableæ•°æ®è½¬æ¢æˆjsonå­—ç¬¦ä¸² ï¼ˆ5ï¼‰å°†æŸ¥è¯¢çš„ç»“æœæ•°æ®å­˜å…¥Redisä¸­ init_by_lua_block{ redis = require \"resty.redis\" mysql = require \"resty.mysql\" cjson = require \"cjson\" } location /redisPreheat{ default_type \"text/html\"; content_by_lua_block{ --è·å–è¯·æ±‚çš„å‚æ•°username local param = ngx.req.get_uri_args()[\"username\"] --å»ºç«‹mysqlæ•°æ®åº“çš„è¿æ¥ local db = mysql:new() local ok,err = db:connect{ host=\"10.0.4.7\", port=3306, user=\"root\", password=\"root\", database=\"lua_db\" } if not ok then ngx.say(\"failed connect to mysql:\",err) return end --è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ db:set_timeout(1000) --æŸ¥è¯¢æ•°æ® local sql = \"\"; if not param then sql=\"select * from users\" else sql=\"select * from users where username=\"..\"'\"..param..\"'\" end local res,err,errcode,sqlstate=db:query(sql) if not res then ngx.say(\"failed to query from mysql:\",err) return end --è¿æ¥redis local rd = redis:new() ok,err = rd:connect(\"10.0.4.7\",6379) if not ok then ngx.say(\"failed to connect to redis:\",err) return end rd:set_timeout(1000) --å¾ªç¯éå†æ•°æ® for i,v in ipairs(res) do rd:set(\"user_\"..v.username,cjson.encode(v)) end ngx.say(\"success\") rd:close() db:close() } } å‘ç°: + è‹±æ–‡å­—æ¯æœ‰å°å›¾æ ‡ :c â€”&gt; â°ğŸ¤ å…³äºæ’¤å›ï¼Œvim","categories":[{"name":"è®¡ç®—æœºè¯­è¨€","slug":"è®¡ç®—æœºè¯­è¨€","permalink":"https://mykkto.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://mykkto.github.io/tags/nginx/"},{"name":"lua","slug":"lua","permalink":"https://mykkto.github.io/tags/lua/"},{"name":"openresty","slug":"openresty","permalink":"https://mykkto.github.io/tags/openresty/"}],"author":"mykk"},{"title":"SpringCloud-Alibaba-Seata å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡","slug":"03javaDistributed/01springcloud/16_SpringCloudAlibaba-Seata","date":"2022-03-25T12:11:33.000Z","updated":"2022-03-27T16:04:53.002Z","comments":true,"path":"posts/e1138fa5.html","link":"","permalink":"https://mykkto.github.io/posts/e1138fa5.html","excerpt":"","text":"ä¸€ã€åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜1ã€åˆ†å¸ƒå¼å‰ å•æœºå•åº“æ²¡è¿™ä¸ªé—®é¢˜ ä»1ï¼š1 -&gt; 1ï¼šN -&gt; Nï¼šN 2ã€åˆ†å¸ƒå¼ä¹‹åå•ä½“åº”ç”¨è¢«æ‹†åˆ†æˆå¾®æœåŠ¡åº”ç”¨ï¼ŒåŸæ¥çš„ä¸‰ä¸ªæ¨¡å—è¢«æ‹†åˆ†æˆä¸‰ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸‰ä¸ªç‹¬ç«‹çš„æ•°æ®æºï¼Œä¸šåŠ¡æ“ä½œéœ€è¦è°ƒç”¨ä¸‰ä¸ªæœåŠ¡æ¥å®Œæˆã€‚æ­¤æ—¶æ¯ä¸ªæœåŠ¡å†…éƒ¨çš„æ•°æ®ä¸€è‡´æ€§ç”±æœ¬åœ°**äº‹åŠ¡æ¥ä¿è¯ï¼Œä½†æ˜¯å…¨å±€**çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜æ²¡æ³•ä¿è¯ã€‚ 3ã€ä¸€å¥è¯ä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ äºŒã€Seataç®€ä»‹1ã€æ˜¯ä»€ä¹ˆSeataæ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºåœ¨å¾®æœåŠ¡æ¶æ„ä¸‹æä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚ 2ã€èƒ½å¹²å˜›ï¼ˆâ˜…ï¼‰1ã€ID(1)+ç»„ä»¶(3)1ã€IDå…¨å±€å”¯ä¸€çš„äº‹åŠ¡IDï¼šTransaction ID XID 2ã€ç»„ä»¶Transaction Coordinator (TC)ã€æ‰“å·¥äººã€‘ äº‹åŠ¡åè°ƒå™¨ï¼Œç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»šï¼› Transaction Manager (TM)ã€è€æ¿ã€‘ æ§åˆ¶å…¨å±€äº‹åŠ¡çš„è¾¹ç•Œï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›æ»šçš„å†³è®®ï¼› Resource Manager (RM)ã€ä»»åŠ¡ã€‘ æ§åˆ¶åˆ†æ”¯äº‹åŠ¡ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œã€çŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æ¥æ”¶äº‹åŠ¡åè°ƒå™¨çš„æŒ‡ä»¤ï¼Œé©±åŠ¨åˆ†æ”¯ï¼ˆæœ¬åœ°ï¼‰äº‹åŠ¡çš„æäº¤å’Œå›æ»š 2ã€å¤„ç†è¿‡ç¨‹1ã€TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XIDï¼› 2ã€XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ï¼› 3ã€RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ï¼› 4ã€TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®®ï¼› 5ã€TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ã€‚ 3ã€æ€ä¹ˆç”¨1ã€æœ¬åœ°å•ä½“æ¶æ„ä¸Šï¼Œæœ¬åœ°ä½¿ç”¨springï¼š@Transactional 2ã€å…¨å±€åˆ†å¸ƒå¼ä¸Šï¼Œå…¨å±€ä½¿ç”¨Seataï¼š@GlobalTransactional ä¸‰ã€Seata-Serverå®‰è£…1ã€å®˜ç½‘1ã€åœ°å€http://seata.io/zh-cn/ 2ã€ä¸‹è½½åœ°å€https://github.com/seata/seata/releases é€‰æ‹© 1.0.0 GA ç¨³å®šç‰ˆ 2ã€é…ç½®seata-server-1.0.0.zip è§£å‹åˆ°æŒ‡å®šç›®å½•å¹¶ä¿®æ”¹confç›®å½•ä¸‹çš„file.confé…ç½®æ–‡ä»¶ 1ã€file.confï¼ˆserviceæ¨¡å—ï¼‰vgroup_mapping.my_test_tx_group = \"fsp_tx_group\" 2ã€file.confï¼ˆstoreæ¨¡å—ï¼‰mode = \"db\" url = \"jdbc:mysql://127.0.0.1:3306/seata\" user = \"root\" password = \"ä½ è‡ªå·±å¯†ç \" 3ã€å¯¼å…¥å»ºè¡¨sql-- -------------------------------- The script used when storeMode is 'db' -------------------------------- -- the table to store GlobalSession data CREATE TABLE IF NOT EXISTS `global_table` ( `xid` VARCHAR(128) NOT NULL, `transaction_id` BIGINT, `status` TINYINT NOT NULL, `application_id` VARCHAR(32), `transaction_service_group` VARCHAR(32), `transaction_name` VARCHAR(128), `timeout` INT, `begin_time` BIGINT, `application_data` VARCHAR(2000), `gmt_create` DATETIME, `gmt_modified` DATETIME, PRIMARY KEY (`xid`), KEY `idx_gmt_modified_status` (`gmt_modified`, `status`), KEY `idx_transaction_id` (`transaction_id`) ) ENGINE = InnoDB DEFAULT CHARSET = utf8; -- the table to store BranchSession data CREATE TABLE IF NOT EXISTS `branch_table` ( `branch_id` BIGINT NOT NULL, `xid` VARCHAR(128) NOT NULL, `transaction_id` BIGINT, `resource_group_id` VARCHAR(32), `resource_id` VARCHAR(256), `branch_type` VARCHAR(8), `status` TINYINT, `client_id` VARCHAR(64), `application_data` VARCHAR(2000), `gmt_create` DATETIME(6), `gmt_modified` DATETIME(6), PRIMARY KEY (`branch_id`), KEY `idx_xid` (`xid`) ) ENGINE = InnoDB DEFAULT CHARSET = utf8; -- the table to store lock data CREATE TABLE IF NOT EXISTS `lock_table` ( `row_key` VARCHAR(128) NOT NULL, `xid` VARCHAR(96), `transaction_id` BIGINT, `branch_id` BIGINT NOT NULL, `resource_id` VARCHAR(256), `table_name` VARCHAR(32), `pk` VARCHAR(36), `gmt_create` DATETIME, `gmt_modified` DATETIME, PRIMARY KEY (`row_key`), KEY `idx_branch_id` (`branch_id`) ) ENGINE = InnoDB DEFAULT CHARSET = utf8; 4ã€å¯åŠ¨1ã€å¯åŠ¨cacosï¼Œseate 2ã€æŸ¥çœ‹ nacos æ§åˆ¶å° å››ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡1ã€å®æˆ˜ä¸šåŠ¡è¯´æ˜1ã€è¯¦ç»†è¿™é‡Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸‰ä¸ªæœåŠ¡ï¼Œä¸€ä¸ªè®¢å•æœåŠ¡ï¼Œä¸€ä¸ªåº“å­˜æœåŠ¡ï¼Œä¸€ä¸ªè´¦æˆ·æœåŠ¡ã€‚ å½“ç”¨æˆ·ä¸‹å•æ—¶ï¼Œä¼šåœ¨è®¢å•æœåŠ¡ä¸­åˆ›å»ºä¸€ä¸ªè®¢å•ï¼Œç„¶åé€šè¿‡è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ¥æ‰£å‡ä¸‹å•å•†å“çš„åº“å­˜ï¼Œå†é€šè¿‡è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ¥æ‰£å‡ç”¨æˆ·è´¦æˆ·é‡Œé¢çš„ä½™é¢ï¼Œæœ€ååœ¨è®¢å•æœåŠ¡ä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆã€‚ è¯¥æ“ä½œè·¨è¶Šä¸‰ä¸ªæ•°æ®åº“ï¼Œæœ‰ä¸¤æ¬¡è¿œç¨‹è°ƒç”¨ï¼Œå¾ˆæ˜æ˜¾ä¼šæœ‰åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚ 2ã€è°ƒç”¨æµç¨‹ä¸‹è®¢å•â€”&gt;æ‰£åº“å­˜â€”&gt;å‡è´¦æˆ·(ä½™é¢) 2ã€å»ºåº“å»ºè¡¨0ã€å»ºåº“CREATE DATABASE seata_order; CREATE DATABASE seata_storage; CREATE DATABASE seata_account; 1ã€è®¢å•seata_orderï¼šå­˜å‚¨è®¢å•çš„æ•°æ®åº“ï¼› è¡¨è¯­å¥ï¼š CREATE TABLE t_order ( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `product_id` BIGINT(11) DEFAULT NULL COMMENT 'äº§å“id', `count` INT(11) DEFAULT NULL COMMENT 'æ•°é‡', `money` DECIMAL(11,0) DEFAULT NULL COMMENT 'é‡‘é¢', `status` INT(1) DEFAULT NULL COMMENT 'è®¢å•çŠ¶æ€ï¼š0ï¼šåˆ›å»ºä¸­ï¼›1ï¼šå·²å®Œç»“' ) ENGINE=INNODB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8; SELECT * FROM t_order; 2ã€åº“å­˜seata_storageï¼šå­˜å‚¨åº“å­˜çš„æ•°æ®åº“ï¼› è¡¨è¯­å¥ï¼š CREATE TABLE t_storage ( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `product_id` BIGINT(11) DEFAULT NULL COMMENT 'äº§å“id', `total` INT(11) DEFAULT NULL COMMENT 'æ€»åº“å­˜', `used` INT(11) DEFAULT NULL COMMENT 'å·²ç”¨åº“å­˜', `residue` INT(11) DEFAULT NULL COMMENT 'å‰©ä½™åº“å­˜' ) ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO seata_storage.t_storage(`id`, `product_id`, `total`, `used`, `residue`) VALUES ('1', '1', '100', '0', '100'); SELECT * FROM t_storage; 3ã€è´¦æˆ·ä¿¡æ¯seata_accountï¼šå­˜å‚¨è´¦æˆ·ä¿¡æ¯çš„æ•°æ®åº“ã€‚ è¡¨è¯­å¥ï¼š CREATE TABLE t_account ( `id` BIGINT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT 'id', `user_id` BIGINT(11) DEFAULT NULL COMMENT 'ç”¨æˆ·id', `total` DECIMAL(10,0) DEFAULT NULL COMMENT 'æ€»é¢åº¦', `used` DECIMAL(10,0) DEFAULT NULL COMMENT 'å·²ç”¨ä½™é¢', `residue` DECIMAL(10,0) DEFAULT '0' COMMENT 'å‰©ä½™å¯ç”¨é¢åº¦' ) ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; INSERT INTO seata_account.t_account(`id`, `user_id`, `total`, `used`, `residue`) VALUES ('1', '1', '1000', '0', '1000'); SELECT * FROM t_account; 4ã€å›æ»šæ—¥å¿—è¡¨æŒ‰ç…§ä¸Šè¿°3åº“åˆ†åˆ«å»ºå¯¹åº”çš„å›æ»šæ—¥å¿—è¡¨ -- the table to store seata xid data -- 0.7.0+ add context -- you must to init this sql for you business databese. the seata server not need it. -- æ­¤è„šæœ¬å¿…é¡»åˆå§‹åŒ–åœ¨ä½ å½“å‰çš„ä¸šåŠ¡æ•°æ®åº“ä¸­ï¼Œç”¨äºAT æ¨¡å¼XIDè®°å½•ã€‚ä¸serverç«¯æ— å…³ï¼ˆæ³¨ï¼šä¸šåŠ¡æ•°æ®åº“ï¼‰ -- æ³¨æ„æ­¤å¤„0.3.0+ å¢åŠ å”¯ä¸€ç´¢å¼• ux_undo_log DROP TABLE `undo_log`; CREATE TABLE `undo_log` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT, `branch_id` BIGINT(20) NOT NULL, `xid` VARCHAR(100) NOT NULL, `context` VARCHAR(128) NOT NULL, `rollback_info` LONGBLOB NOT NULL, `log_status` INT(11) NOT NULL, `log_created` DATETIME NOT NULL, `log_modified` DATETIME NOT NULL, `ext` VARCHAR(100) DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`) ) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8; 5ã€æ•ˆæœ äº”ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡1ã€ä¸šåŠ¡éœ€æ±‚ä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;æ‰£ä½™é¢-&gt;æ”¹(è®¢å•)çŠ¶æ€ 2ã€æ–°å»ºè®¢å•Order-Module1ã€modelseata-order-service2001 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;seata-order-service2001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--nacos--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--seata--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-seata&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;!--feign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--web-actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mysql-druid--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.37&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 2001 spring: application: name: seata-order-service cloud: alibaba: seata: #è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°éœ€è¦ä¸seata-serverä¸­çš„å¯¹åº” tx-service-group: fsp_tx_group nacos: discovery: server-addr: 106.52.23.202:8848 datasource: driver-class-name: com.mysql.jdbc.Driver url: jdbc:mysql://106.52.23.202:3306/seata_order username: root password: root feign: hystrix: enabled: false logging: level: io: seata: info mybatis: mapperLocations: classpath:mapper/*.xml 4ã€file.confyml åŒå±‚ç›®å½•ä¸‹ éœ€è¦ä¿®æ”¹çš„æ˜¯ mysql url,username,password transport { # tcp udt unix-domain-socket type = \"TCP\" #NIO NATIVE server = \"NIO\" #enable heartbeat heartbeat = true #thread factory for netty thread-factory { boss-thread-prefix = \"NettyBoss\" worker-thread-prefix = \"NettyServerNIOWorker\" server-executor-thread-prefix = \"NettyServerBizHandler\" share-boss-worker = false client-selector-thread-prefix = \"NettyClientSelector\" client-selector-thread-size = 1 client-worker-thread-prefix = \"NettyClientWorkerThread\" # netty boss thread size,will not be used for UDT boss-thread-size = 1 #auto default pin or 8 worker-thread-size = 8 } shutdown { # when destroy server, wait seconds wait = 3 } serialization = \"seata\" compressor = \"none\" } service { vgroup_mapping.fsp_tx_group = \"default\" #ä¿®æ”¹è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§° default.grouplist = \"127.0.0.1:8091\" enableDegrade = false disable = false max.commit.retry.timeout = \"-1\" max.rollback.retry.timeout = \"-1\" disableGlobalTransaction = false } client { async.commit.buffer.limit = 10000 lock { retry.internal = 10 retry.times = 30 } report.retry.count = 5 tm.commit.retry.count = 1 tm.rollback.retry.count = 1 } ## transaction log store store { ## store mode: fileã€db mode = \"db\" ## file store file { dir = \"sessionStore\" # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions max-branch-session-size = 16384 # globe session size , if exceeded throws exceptions max-global-session-size = 512 # file buffer size , if exceeded allocate new buffer file-write-buffer-cache-size = 16384 # when recover batch read size session.reload.read_size = 100 # async, sync flush-disk-mode = async } ## database store db { ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc. datasource = \"dbcp\" ## mysql/oracle/h2/oceanbase etc. db-type = \"mysql\" driver-class-name = \"com.mysql.jdbc.Driver\" url = \"jdbc:mysql://106.52.23.202:3306/seata\" user = \"root\" password = \"root\" min-conn = 1 max-conn = 3 global.table = \"global_table\" branch.table = \"branch_table\" lock-table = \"lock_table\" query-limit = 100 } } lock { ## the lock store mode: localã€remote mode = \"remote\" local { ## store locks in user's database } remote { ## store locks in the seata's server } } recovery { #schedule committing retry period in milliseconds committing-retry-period = 1000 #schedule asyn committing retry period in milliseconds asyn-committing-retry-period = 1000 #schedule rollbacking retry period in milliseconds rollbacking-retry-period = 1000 #schedule timeout retry period in milliseconds timeout-retry-period = 1000 } transaction { undo.data.validation = true undo.log.serialization = \"jackson\" undo.log.save.days = 7 #schedule delete expired undo_log in milliseconds undo.log.delete.period = 86400000 undo.log.table = \"undo_log\" } ## metrics settings metrics { enabled = false registry-type = \"compact\" # multi exporters use comma divided exporter-list = \"prometheus\" exporter-prometheus-port = 9898 } support { ## spring spring { # auto proxy the DataSource bean datasource.autoproxy = false } } 5ã€registry.confregistry { # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa type = \"nacos\" nacos { serverAddr = \"106.52.23.202:8848\" namespace = \"\" cluster = \"default\" } eureka { serviceUrl = \"http://localhost:8761/eureka\" application = \"default\" weight = \"1\" } redis { serverAddr = \"localhost:6379\" db = \"0\" } zk { cluster = \"default\" serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } consul { cluster = \"default\" serverAddr = \"127.0.0.1:8500\" } etcd3 { cluster = \"default\" serverAddr = \"http://localhost:2379\" } sofa { serverAddr = \"127.0.0.1:9603\" application = \"default\" region = \"DEFAULT_ZONE\" datacenter = \"DefaultDataCenter\" cluster = \"default\" group = \"SEATA_GROUP\" addressWaitTime = \"3000\" } file { name = \"file.conf\" } } config { # fileã€nacos ã€apolloã€zkã€consulã€etcd3 type = \"file\" nacos { serverAddr = \"localhost\" namespace = \"\" } consul { serverAddr = \"127.0.0.1:8500\" } apollo { app.id = \"seata-server\" apollo.meta = \"http://192.168.1.204:8801\" } zk { serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } etcd3 { serverAddr = \"http://localhost:2379\" } file { name = \"file.conf\" } } 6ã€ä¸šåŠ¡ç±»1ã€domainpackage com.kk.springcloud.domain; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; @Data @AllArgsConstructor @NoArgsConstructor public class CommonResult&lt;T&gt; { private Integer code; private String message; private T data; public CommonResult(Integer code, String message) { this (code, message, null); } } package com.kk.springcloud.domain; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; import java.math.BigDecimal; @Data @AllArgsConstructor @NoArgsConstructor public class Order { private Long id; private Long userId; private Long productId; private Integer count; private BigDecimal money; /** * è®¢å•çŠ¶æ€ï¼š0ï¼šåˆ›å»ºä¸­ï¼›1ï¼šå·²å®Œç»“ */ private Integer status; } 2ã€daopackage com.kk.springcloud.dao; import com.kk.springcloud.domain.Order; import org.apache.ibatis.annotations.Mapper; import org.apache.ibatis.annotations.Param; @Mapper public interface OrderDao { /** * åˆ›å»ºè®¢å• */ void create(Order order); /** * ä¿®æ”¹è®¢å•é‡‘é¢ */ void update(@Param(\"userId\") Long userId, @Param(\"status\") Integer status); } OrderMapper.xml &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\" &gt; &lt;mapper namespace=\"com.kk.springcloud.dao.OrderDao\"&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.kk.springcloud.domain.Order\"&gt; &lt;id column=\"id\" property=\"id\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"user_id\" property=\"userId\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"product_id\" property=\"productId\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"count\" property=\"count\" jdbcType=\"INTEGER\"/&gt; &lt;result column=\"money\" property=\"money\" jdbcType=\"DECIMAL\"/&gt; &lt;result column=\"status\" property=\"status\" jdbcType=\"INTEGER\"/&gt; &lt;/resultMap&gt; &lt;insert id=\"create\"&gt; INSERT INTO `t_order` (`id`, `user_id`, `product_id`, `count`, `money`, `status`) VALUES (NULL, #{userId}, #{productId}, #{count}, #{money}, 0); &lt;/insert&gt; &lt;update id=\"update\"&gt; UPDATE `t_order` SET status = 1 WHERE user_id = #{userId} AND status = #{status}; &lt;/update&gt; &lt;/mapper&gt; 3ã€serivce OrderService OrderServiceImpl package com.kk.springcloud.service; import com.kk.springcloud.domain.Order; public interface OrderService { /** * åˆ›å»ºè®¢å• */ void create(Order order); } package com.kk.springcloud.service; import com.kk.springcloud.dao.OrderDao; import com.kk.springcloud.domain.Order; import io.seata.spring.annotation.GlobalTransactional; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Service; import javax.annotation.Resource; @Service @Slf4j public class OrderServiceImpl implements OrderService { @Resource private OrderDao orderDao; @Resource private StorageService storageService; @Resource private AccountService accountService; /** * åˆ›å»ºè®¢å•-&gt;è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜-&gt;è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡è´¦æˆ·ä½™é¢-&gt;ä¿®æ”¹è®¢å•çŠ¶æ€ * ç®€å•è¯´ï¼š * ä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;å‡ä½™é¢-&gt;æ”¹çŠ¶æ€ * rollbackFor = Exception.class ,ä»»ä½•å¼‚å¸¸éƒ½å›æ»š */ @Override @GlobalTransactional(name = \"fsp-create-order\", rollbackFor = Exception.class) public void create(Order order) { log.info (\"===å¼€å§‹ä¸‹å•===\"); //æœ¬åº”ç”¨åˆ›å»ºè®¢å• orderDao.create (order); //è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜ log.info (\"-------&gt;order-serviceä¸­æ‰£å‡åº“å­˜å¼€å§‹\"); storageService.decrease (order.getProductId ( ), order.getCount ( )); log.info (\"-------&gt;order-serviceä¸­æ‰£å‡åº“å­˜ç»“æŸ\"); //è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡ä½™é¢ log.info (\"-------&gt;order-serviceä¸­æ‰£å‡ä½™é¢å¼€å§‹\"); accountService.decrease (order.getUserId ( ), order.getMoney ( )); log.info (\"-------&gt;order-serviceä¸­æ‰£å‡ä½™é¢ç»“æŸ\"); //ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆ log.info (\"-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€å¼€å§‹\"); orderDao.update (order.getUserId ( ), 0); log.info (\"-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ç»“æŸ\"); log.info (\"-------&gt;ä¸‹å•ç»“æŸ\"); } } AccountService package com.kk.springcloud.service; import com.kk.springcloud.domain.CommonResult; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestParam; import java.math.BigDecimal; @FeignClient(value = \"seata-account-service\") public interface AccountService { /** * æ‰£å‡è´¦æˆ·ä½™é¢ */ //@RequestMapping(value = \"/account/decrease\", method = RequestMethod.POST, produces = \"application/json; charset=UTF-8\") @PostMapping(\"/account/decrease\") CommonResult decrease(@RequestParam(\"userId\") Long userId, @RequestParam(\"money\") BigDecimal money); } StorageService package com.kk.springcloud.service; import com.kk.springcloud.domain.CommonResult; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestParam; @FeignClient(value = \"seata-storage-service\") public interface StorageService { /** * æ‰£å‡åº“å­˜ */ @PostMapping(value = \"/storage/decrease\") CommonResult decrease(@RequestParam(\"productId\") Long productId, @RequestParam(\"count\") Integer count); } 4ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.domain.CommonResult; import com.kk.springcloud.domain.Order; import com.kk.springcloud.service.OrderService; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class OrderController { @Autowired private OrderService orderService; /** * åˆ›å»ºè®¢å• */ @GetMapping(\"/order/create\") public CommonResult create(Order order) { orderService.create(order); return new CommonResult(200, \"è®¢å•åˆ›å»ºæˆåŠŸ!\"); } } 7ã€Configé…ç½® MybatisConfig package com.kk.springcloud.config; import org.mybatis.spring.annotation.MapperScan; import org.springframework.context.annotation.Configuration; @Configuration @MapperScan({\"com.kk.springcloud.dao\"}) public class MyBatisConfig { } DataSourceProxyConfig package com.kk.springcloud.config; import com.alibaba.druid.pool.DruidDataSource; import io.seata.rm.datasource.DataSourceProxy; import org.apache.ibatis.session.SqlSessionFactory; import org.mybatis.spring.SqlSessionFactoryBean; import org.mybatis.spring.transaction.SpringManagedTransactionFactory; import org.springframework.beans.factory.annotation.Value; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.core.io.support.PathMatchingResourcePatternResolver; import javax.sql.DataSource; /* * @Description: ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç† * @Author: é˜¿K * @CreateDate: 2022/3/27 13:31 * @Param: * @Return: **/ @Configuration public class DataSourceProxyConfig { @Value(\"${mybatis.mapperLocations}\") private String mapperLocations; @Bean @ConfigurationProperties(prefix = \"spring.datasource\") public DataSource druidDataSource() { return new DruidDataSource ( ); } @Bean public DataSourceProxy dataSourceProxy(DataSource dataSource) { return new DataSourceProxy (dataSource); } @Bean public SqlSessionFactory sqlSessionFactoryBean(DataSourceProxy dataSourceProxy) throws Exception { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean ( ); sqlSessionFactoryBean.setDataSource (dataSourceProxy); sqlSessionFactoryBean.setMapperLocations (new PathMatchingResourcePatternResolver ( ).getResources (mapperLocations)); sqlSessionFactoryBean.setTransactionFactory (new SpringManagedTransactionFactory ( )); return sqlSessionFactoryBean.getObject ( ); } } 8ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.openfeign.EnableFeignClients; @EnableDiscoveryClient @EnableFeignClients @SpringBootApplication(exclude = DataSourceAutoConfiguration.class)//å–æ¶ˆæ•°æ®æºçš„è‡ªåŠ¨åˆ›å»º public class SeataOrderMainApp2001 { public static void main(String[] args) { SpringApplication.run (SeataOrderMainApp2001.class, args); } } 3ã€æ–°å»ºåº“å­˜Storage-Module1ã€modelseata-storage-service2002 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;seata-order-service2001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--nacos--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--seata--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-seata&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;!--feign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--web-actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--mysql-druid--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.37&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 2002 spring: application: name: seata-storage-service cloud: alibaba: seata: tx-service-group: fsp_tx_group nacos: discovery: server-addr: 106.52.23.202:8848 datasource: driver-class-name: com.mysql.jdbc.Driver url: jdbc:mysql://106.52.23.202:3306/seata_storage username: root password: root logging: level: io: seata: info mybatis: mapperLocations: classpath:mapper/*.xml 4ã€file.confvgroup_mapping.fsp_tx_group = \"default\" transport { # tcp udt unix-domain-socket type = \"TCP\" #NIO NATIVE server = \"NIO\" #enable heartbeat heartbeat = true #thread factory for netty thread-factory { boss-thread-prefix = \"NettyBoss\" worker-thread-prefix = \"NettyServerNIOWorker\" server-executor-thread-prefix = \"NettyServerBizHandler\" share-boss-worker = false client-selector-thread-prefix = \"NettyClientSelector\" client-selector-thread-size = 1 client-worker-thread-prefix = \"NettyClientWorkerThread\" # netty boss thread size,will not be used for UDT boss-thread-size = 1 #auto default pin or 8 worker-thread-size = 8 } shutdown { # when destroy server, wait seconds wait = 3 } serialization = \"seata\" compressor = \"none\" } service { #vgroup-&gt;rgroup vgroup_mapping.fsp_tx_group = \"default\" #only support single node default.grouplist = \"127.0.0.1:8091\" #degrade current not support enableDegrade = false #disable disable = false #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, default permanent max.commit.retry.timeout = \"-1\" max.rollback.retry.timeout = \"-1\" disableGlobalTransaction = false } client { async.commit.buffer.limit = 10000 lock { retry.internal = 10 retry.times = 30 } report.retry.count = 5 tm.commit.retry.count = 1 tm.rollback.retry.count = 1 } transaction { undo.data.validation = true undo.log.serialization = \"jackson\" undo.log.save.days = 7 #schedule delete expired undo_log in milliseconds undo.log.delete.period = 86400000 undo.log.table = \"undo_log\" } support { ## spring spring { # auto proxy the DataSource bean datasource.autoproxy = false } } 5ã€registry.confregistry { # file ã€nacos ã€eurekaã€redisã€zk type = \"nacos\" nacos { serverAddr = \"106.52.23.202:8848\" namespace = \"\" cluster = \"default\" } eureka { serviceUrl = \"http://localhost:8761/eureka\" application = \"default\" weight = \"1\" } redis { serverAddr = \"localhost:6381\" db = \"0\" } zk { cluster = \"default\" serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } file { name = \"file.conf\" } } config { # fileã€nacos ã€apolloã€zk type = \"file\" nacos { serverAddr = \"localhost\" namespace = \"\" cluster = \"default\" } apollo { app.id = \"fescar-server\" apollo.meta = \"http://192.168.1.204:8801\" } zk { serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } file { name = \"file.conf\" } } 6ã€ä¸šåŠ¡ç±»1ã€domainpackage com.kk.springcloud.domain; import lombok.Data; @Data public class Storage { private Long id; /** * äº§å“id */ private Long productId; /** * æ€»åº“å­˜ */ private Integer total; /** * å·²ç”¨åº“å­˜ */ private Integer used; /** * å‰©ä½™åº“å­˜ */ private Integer residue; } 2ã€daopackage com.kk.springcloud.dao; import org.apache.ibatis.annotations.Mapper; import org.apache.ibatis.annotations.Param; @Mapper public interface StorageDao { /** * æ‰£å‡åº“å­˜ */ void decrease(@Param(\"productId\") Long productId, @Param(\"count\") Integer count); } &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\" &gt; &lt;mapper namespace=\"com.kk.springcloud.dao.StorageDao\"&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.kk.springcloud.domain.Storage\"&gt; &lt;id column=\"id\" property=\"id\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"product_id\" property=\"productId\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"total\" property=\"total\" jdbcType=\"INTEGER\"/&gt; &lt;result column=\"used\" property=\"used\" jdbcType=\"INTEGER\"/&gt; &lt;result column=\"residue\" property=\"residue\" jdbcType=\"INTEGER\"/&gt; &lt;/resultMap&gt; &lt;update id=\"decrease\"&gt; UPDATE t_storage SET used = used + #{count}, residue = residue - #{count} WHERE product_id = #{productId} &lt;/update&gt; &lt;/mapper&gt; 3ã€serivcepackage com.kk.springcloud.service; public interface StorageService { /** * æ‰£å‡åº“å­˜ */ void decrease(Long productId, Integer count); } package com.kk.springcloud.service; import com.kk.springcloud.dao.StorageDao; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Service; import javax.annotation.Resource; @Service @Slf4j public class StorageServiceImpl implements StorageService { @Resource private StorageDao storageDao; /** * æ‰£å‡åº“å­˜ */ @Override public void decrease(Long productId, Integer count) { log.info (\"-------&gt;storage-serviceä¸­æ‰£å‡åº“å­˜å¼€å§‹\"); storageDao.decrease (productId, count); log.info (\"-------&gt;storage-serviceä¸­æ‰£å‡åº“å­˜ç»“æŸ\"); } } 4ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.service.StorageService; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class StorageController { @Autowired private StorageService storageService; /** * æ‰£å‡åº“å­˜ */ @RequestMapping(\"/storage/decrease\") public CommonResult decrease(Long productId, Integer count) { storageService.decrease (productId, count); return new CommonResult (200, \"æ‰£å‡åº“å­˜æˆåŠŸï¼\"); } } 7ã€Configé…ç½® MybatisConfig package com.kk.springcloud.config; import org.mybatis.spring.annotation.MapperScan; import org.springframework.context.annotation.Configuration; @Configuration @MapperScan({\"com.kk.springcloud.dao\"}) public class MyBatisConfig { } DataSourceProxyConfig package com.kk.springcloud.config; import com.alibaba.druid.pool.DruidDataSource; import io.seata.rm.datasource.DataSourceProxy; import org.apache.ibatis.session.SqlSessionFactory; import org.mybatis.spring.SqlSessionFactoryBean; import org.mybatis.spring.transaction.SpringManagedTransactionFactory; import org.springframework.beans.factory.annotation.Value; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.core.io.support.PathMatchingResourcePatternResolver; import javax.sql.DataSource; /* * @Description: ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç† * @Author: é˜¿K * @CreateDate: 2022/3/27 13:31 * @Param: * @Return: **/ @Configuration public class DataSourceProxyConfig { @Value(\"${mybatis.mapperLocations}\") private String mapperLocations; @Bean @ConfigurationProperties(prefix = \"spring.datasource\") public DataSource druidDataSource() { return new DruidDataSource ( ); } @Bean public DataSourceProxy dataSourceProxy(DataSource dataSource) { return new DataSourceProxy (dataSource); } @Bean public SqlSessionFactory sqlSessionFactoryBean(DataSourceProxy dataSourceProxy) throws Exception { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean ( ); sqlSessionFactoryBean.setDataSource (dataSourceProxy); sqlSessionFactoryBean.setMapperLocations (new PathMatchingResourcePatternResolver ( ).getResources (mapperLocations)); sqlSessionFactoryBean.setTransactionFactory (new SpringManagedTransactionFactory ( )); return sqlSessionFactoryBean.getObject ( ); } } 8ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication(exclude = DataSourceAutoConfiguration.class) @EnableDiscoveryClient @EnableFeignClients public class SeataStorageServiceApplication2002 { public static void main(String[] args) { SpringApplication.run (SeataStorageServiceApplication2002.class, args); } } 4ã€æ–°å»ºè´¦æˆ·Account-Module1ã€modelseata-account-service2003 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;seata-account-service2003&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--nacos--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--seata--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-seata&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;!--feign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.37&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 2003 spring: application: name: seata-account-service cloud: alibaba: seata: tx-service-group: fsp_tx_group nacos: discovery: server-addr: 106.52.23.202:8848 datasource: driver-class-name: com.mysql.jdbc.Driver url: jdbc:mysql://106.52.23.202:3306/seata_account username: root password: root feign: hystrix: enabled: false logging: level: io: seata: info mybatis: mapperLocations: classpath:mapper/*.xml 4ã€file.conftransport { # tcp udt unix-domain-socket type = \"TCP\" #NIO NATIVE server = \"NIO\" #enable heartbeat heartbeat = true #thread factory for netty thread-factory { boss-thread-prefix = \"NettyBoss\" worker-thread-prefix = \"NettyServerNIOWorker\" server-executor-thread-prefix = \"NettyServerBizHandler\" share-boss-worker = false client-selector-thread-prefix = \"NettyClientSelector\" client-selector-thread-size = 1 client-worker-thread-prefix = \"NettyClientWorkerThread\" # netty boss thread size,will not be used for UDT boss-thread-size = 1 #auto default pin or 8 worker-thread-size = 8 } shutdown { # when destroy server, wait seconds wait = 3 } serialization = \"seata\" compressor = \"none\" } service { vgroup_mapping.fsp_tx_group = \"default\" #ä¿®æ”¹è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§° default.grouplist = \"127.0.0.1:8091\" enableDegrade = false disable = false max.commit.retry.timeout = \"-1\" max.rollback.retry.timeout = \"-1\" disableGlobalTransaction = false } client { async.commit.buffer.limit = 10000 lock { retry.internal = 10 retry.times = 30 } report.retry.count = 5 tm.commit.retry.count = 1 tm.rollback.retry.count = 1 } ## transaction log store store { ## store mode: fileã€db mode = \"db\" ## file store file { dir = \"sessionStore\" # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions max-branch-session-size = 16384 # globe session size , if exceeded throws exceptions max-global-session-size = 512 # file buffer size , if exceeded allocate new buffer file-write-buffer-cache-size = 16384 # when recover batch read size session.reload.read_size = 100 # async, sync flush-disk-mode = async } ## database store db { ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc. datasource = \"dbcp\" ## mysql/oracle/h2/oceanbase etc. db-type = \"mysql\" driver-class-name = \"com.mysql.jdbc.Driver\" url = \"jdbc:mysql://106.52.23.202:3306/seata\" user = \"root\" password = \"root\" min-conn = 1 max-conn = 3 global.table = \"global_table\" branch.table = \"branch_table\" lock-table = \"lock_table\" query-limit = 100 } } lock { ## the lock store mode: localã€remote mode = \"remote\" local { ## store locks in user's database } remote { ## store locks in the seata's server } } recovery { #schedule committing retry period in milliseconds committing-retry-period = 1000 #schedule asyn committing retry period in milliseconds asyn-committing-retry-period = 1000 #schedule rollbacking retry period in milliseconds rollbacking-retry-period = 1000 #schedule timeout retry period in milliseconds timeout-retry-period = 1000 } transaction { undo.data.validation = true undo.log.serialization = \"jackson\" undo.log.save.days = 7 #schedule delete expired undo_log in milliseconds undo.log.delete.period = 86400000 undo.log.table = \"undo_log\" } ## metrics settings metrics { enabled = false registry-type = \"compact\" # multi exporters use comma divided exporter-list = \"prometheus\" exporter-prometheus-port = 9898 } support { ## spring spring { # auto proxy the DataSource bean datasource.autoproxy = false } } 5ã€registry.confregistry { # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa type = \"nacos\" nacos { serverAddr = \"106.52.23.202:8848\" namespace = \"\" cluster = \"default\" } eureka { serviceUrl = \"http://localhost:8761/eureka\" application = \"default\" weight = \"1\" } redis { serverAddr = \"localhost:6379\" db = \"0\" } zk { cluster = \"default\" serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } consul { cluster = \"default\" serverAddr = \"127.0.0.1:8500\" } etcd3 { cluster = \"default\" serverAddr = \"http://localhost:2379\" } sofa { serverAddr = \"127.0.0.1:9603\" application = \"default\" region = \"DEFAULT_ZONE\" datacenter = \"DefaultDataCenter\" cluster = \"default\" group = \"SEATA_GROUP\" addressWaitTime = \"3000\" } file { name = \"file.conf\" } } config { # fileã€nacos ã€apolloã€zkã€consulã€etcd3 type = \"file\" nacos { serverAddr = \"localhost\" namespace = \"\" } consul { serverAddr = \"127.0.0.1:8500\" } apollo { app.id = \"seata-server\" apollo.meta = \"http://192.168.1.204:8801\" } zk { serverAddr = \"127.0.0.1:2181\" session.timeout = 6000 connect.timeout = 2000 } etcd3 { serverAddr = \"http://localhost:2379\" } file { name = \"file.conf\" } } 6ã€ä¸šåŠ¡ç±»1ã€domainpackage com.kk.springclpid.domain; import lombok.Data; import java.math.BigDecimal; @Data public class Account { private Long id; /** * ç”¨æˆ·id */ private Long userId; /** * æ€»é¢åº¦ */ private BigDecimal total; /** * å·²ç”¨é¢åº¦ */ private BigDecimal used; /** * å‰©ä½™é¢åº¦ */ private BigDecimal residue; } 2ã€daopackage com.kk.springcloud.dao; import org.apache.ibatis.annotations.Mapper; import org.apache.ibatis.annotations.Param; import java.math.BigDecimal; @Mapper public interface AccountDao { /** * æ‰£å‡è´¦æˆ·ä½™é¢ */ void decrease(@Param(\"userId\") Long userId, @Param(\"money\") BigDecimal money); } &lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt; &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\" &gt; &lt;mapper namespace=\"com.kk.springcloud.dao.AccountDao\"&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.kk.springcloud.domain.Account\"&gt; &lt;id column=\"id\" property=\"id\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"user_id\" property=\"userId\" jdbcType=\"BIGINT\"/&gt; &lt;result column=\"total\" property=\"total\" jdbcType=\"DECIMAL\"/&gt; &lt;result column=\"used\" property=\"used\" jdbcType=\"DECIMAL\"/&gt; &lt;result column=\"residue\" property=\"residue\" jdbcType=\"DECIMAL\"/&gt; &lt;/resultMap&gt; &lt;update id=\"decrease\"&gt; UPDATE t_account SET residue = residue - #{money},used = used + #{money} WHERE user_id = #{userId}; &lt;/update&gt; &lt;/mapper&gt; 3ã€serivcepackage com.kk.springcloud.service; import org.springframework.web.bind.annotation.RequestParam; import java.math.BigDecimal; public interface AccountService { /** * æ‰£å‡è´¦æˆ·ä½™é¢ * * @param userId ç”¨æˆ·id * @param money é‡‘é¢ */ void decrease(@RequestParam(\"userId\") Long userId, @RequestParam(\"money\") BigDecimal money); } package com.kk.springcloud.service; import com.kk.springcloud.dao.AccountDao; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.stereotype.Service; import javax.annotation.Resource; import java.math.BigDecimal; import java.util.concurrent.TimeUnit; @Service public class AccountServiceImpl implements AccountService { private static final Logger LOGGER = LoggerFactory.getLogger (AccountServiceImpl.class); @Resource AccountDao accountDao; /** * æ‰£å‡è´¦æˆ·ä½™é¢ */ @Override public void decrease(Long userId, BigDecimal money) { LOGGER.info (\"-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢å¼€å§‹\"); //æ¨¡æ‹Ÿè¶…æ—¶å¼‚å¸¸ï¼Œå…¨å±€äº‹åŠ¡å›æ»š //æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹ try { TimeUnit.SECONDS.sleep (30); } catch (InterruptedException e) { e.printStackTrace ( ); } accountDao.decrease (userId, money); LOGGER.info (\"-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢ç»“æŸ\"); } } 4ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.service.AccountService; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RequestParam; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; import java.math.BigDecimal; @RestController public class AccountController { @Resource AccountService accountService; /** * æ‰£å‡è´¦æˆ·ä½™é¢ */ @RequestMapping(\"/account/decrease\") public CommonResult decrease(@RequestParam(\"userId\") Long userId, @RequestParam(\"money\") BigDecimal money) { accountService.decrease (userId, money); return new CommonResult (200, \"æ‰£å‡è´¦æˆ·ä½™é¢æˆåŠŸï¼\"); } } 7ã€Configé…ç½® MybatisConfig package com.kk.springcloud.config; import org.mybatis.spring.annotation.MapperScan; import org.springframework.context.annotation.Configuration; @Configuration @MapperScan({\"com.kk.springcloud.dao\"}) public class MyBatisConfig { } DataSourceProxyConfig package com.kk.springcloud.config; import com.alibaba.druid.pool.DruidDataSource; import io.seata.rm.datasource.DataSourceProxy; import org.apache.ibatis.session.SqlSessionFactory; import org.mybatis.spring.SqlSessionFactoryBean; import org.mybatis.spring.transaction.SpringManagedTransactionFactory; import org.springframework.beans.factory.annotation.Value; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.core.io.support.PathMatchingResourcePatternResolver; import javax.sql.DataSource; /* * @Description: ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç† * @Author: é˜¿K * @CreateDate: 2022/3/27 13:31 * @Param: * @Return: **/ @Configuration public class DataSourceProxyConfig { @Value(\"${mybatis.mapperLocations}\") private String mapperLocations; @Bean @ConfigurationProperties(prefix = \"spring.datasource\") public DataSource druidDataSource() { return new DruidDataSource ( ); } @Bean public DataSourceProxy dataSourceProxy(DataSource dataSource) { return new DataSourceProxy (dataSource); } @Bean public SqlSessionFactory sqlSessionFactoryBean(DataSourceProxy dataSourceProxy) throws Exception { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean ( ); sqlSessionFactoryBean.setDataSource (dataSourceProxy); sqlSessionFactoryBean.setMapperLocations (new PathMatchingResourcePatternResolver ( ).getResources (mapperLocations)); sqlSessionFactoryBean.setTransactionFactory (new SpringManagedTransactionFactory ( )); return sqlSessionFactoryBean.getObject ( ); } } 8ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication(exclude = DataSourceAutoConfiguration.class) @EnableDiscoveryClient @EnableFeignClients public class SeataAccountMainApp2003 { public static void main(String[] args) { SpringApplication.run (SeataAccountMainApp2003.class, args); } } å…­ã€Test1ã€åˆå§‹æƒ…å†µ 2ã€æ­£å¸¸ä¸‹å•1ã€è¯·æ±‚http://localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100 2ã€æ•°æ®åº“æƒ…å†µ 3ã€æ— æ³¨è§£è¶…æ—¶å¼‚å¸¸ï¼Œæ²¡åŠ @GlobalTransactional 1ã€AccountServiceImplæ·»åŠ è¶…æ—¶ 2ã€æ•°æ®åº“æƒ…å†µ 3ã€æ•…éšœæƒ…å†µ å½“åº“å­˜å’Œè´¦æˆ·é‡‘é¢æ‰£å‡åï¼Œè®¢å•çŠ¶æ€å¹¶æ²¡æœ‰è®¾ç½®ä¸ºå·²ç»å®Œæˆï¼Œæ²¡æœ‰ä»é›¶æ”¹ä¸º1 è€Œä¸”ç”±äºfeignçš„é‡è¯•æœºåˆ¶ï¼Œè´¦æˆ·ä½™é¢è¿˜æœ‰å¯èƒ½è¢«å¤šæ¬¡æ‰£å‡ 4ã€æœ‰æ³¨è§£è¶…æ—¶å¼‚å¸¸ï¼Œæ·»åŠ @GlobalTransactional 1ã€AccountServiceImplæ·»åŠ è¶…æ—¶ 2ã€OrderServiceImpl@GlobalTransactional @GlobalTransactional(name = \"fsp-create-order\",rollbackFor = Exception.class) public void create(Order order) { ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ } 3ã€ç»“æœ ä¸‹å•åæ•°æ®åº“æ•°æ®å¹¶æ²¡æœ‰ä»»ä½•æ”¹å˜ è®°å½•éƒ½æ·»åŠ ä¸è¿›æ¥ ä¸ƒã€ä¸€éƒ¨åˆ†è¡¥å……1ã€å†çœ‹TC/TM/RMä¸‰å¤§ç»„ä»¶åˆ†å¸ƒå¼äº‹åŠ¡çš„æ‰§è¡Œæµç¨‹ 1ã€TM å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆTM å‘ TC æ³¨å†Œå…¨å±€äº‹åŠ¡è®°å½•ï¼‰ï¼› 2ã€æŒ‰ä¸šåŠ¡åœºæ™¯ï¼Œç¼–æ’æ•°æ®åº“ã€æœåŠ¡ç­‰äº‹åŠ¡å†…èµ„æºï¼ˆRM å‘ TC æ±‡æŠ¥èµ„æºå‡†å¤‡çŠ¶æ€ ï¼‰ï¼› 3ã€TM ç»“æŸåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸€é˜¶æ®µç»“æŸï¼ˆTM é€šçŸ¥ TC æäº¤/å›æ»šåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ï¼› 4ã€TC æ±‡æ€»äº‹åŠ¡ä¿¡æ¯ï¼Œå†³å®šåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æäº¤è¿˜æ˜¯å›æ»šï¼› 5ã€TC é€šçŸ¥æ‰€æœ‰ RM æäº¤/å›æ»š èµ„æºï¼Œäº‹åŠ¡äºŒé˜¶æ®µç»“æŸã€‚ 2ã€ATæ¨¡å¼å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥1ã€æ˜¯ä»€ä¹ˆ 2ã€ä¸€é˜¶æ®µåŠ è½½åœ¨ä¸€é˜¶æ®µï¼ŒSeata ä¼šæ‹¦æˆªâ€œä¸šåŠ¡ SQLâ€ï¼Œ1 è§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œä¸šåŠ¡ SQLâ€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€œbefore imageâ€ï¼Œ2 æ‰§è¡Œâ€œä¸šåŠ¡ SQLâ€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹åï¼Œ3 å…¶ä¿å­˜æˆâ€œafter imageâ€ï¼Œæœ€åç”Ÿæˆè¡Œé”ã€‚ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§ã€‚ 3ã€äºŒé˜¶æ®µæäº¤äºŒé˜¶æ®µå¦‚æ˜¯é¡ºåˆ©æäº¤çš„è¯ï¼Œå› ä¸ºâ€œä¸šåŠ¡ SQLâ€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œæ‰€ä»¥Seataæ¡†æ¶åªéœ€å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯ã€‚ 3ã€äºŒé˜¶æ®µå›æ»šäºŒé˜¶æ®µå›æ»šï¼šäºŒé˜¶æ®µå¦‚æœæ˜¯å›æ»šçš„è¯ï¼ŒSeata å°±éœ€è¦å›æ»šä¸€é˜¶æ®µå·²ç»æ‰§è¡Œçš„â€œä¸šåŠ¡ SQLâ€ï¼Œè¿˜åŸä¸šåŠ¡æ•°æ®ã€‚å›æ»šæ–¹å¼ä¾¿æ˜¯ç”¨â€œbefore imageâ€è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œ â€œafter imageâ€ï¼Œå¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰è„å†™ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†ã€‚ 3ã€è¡¥å…… å‚è€ƒæ–‡æ¡£ â†“docker å®‰è£…é—®é¢˜ï¼šhttps://www.cnblogs.com/youngyajun/p/14002547.html docker ç½‘ç»œé—®é¢˜ï¼šhttps://blog.csdn.net/tilyp/article/details/103371360 docker è¿è¡Œé—®é¢˜ï¼šhttps://www.manongdao.com/article-2421258.html","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"seata","slug":"seata","permalink":"https://mykkto.github.io/tags/seata/"},{"name":"åˆ†å¸ƒå¼äº‹åŠ¡","slug":"åˆ†å¸ƒå¼äº‹åŠ¡","permalink":"https://mykkto.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"}],"author":"mykk"},{"title":"äº‘ä¸»æœºéƒ¨ç½²å¹¶åŒæ­¥æ›´æ–°äºŒçº§åŸŸå","slug":"00blog/01_blogSynGithub","date":"2022-03-20T08:17:13.000Z","updated":"2022-04-05T13:56:19.487Z","comments":true,"path":"posts/829b453d.html","link":"","permalink":"https://mykkto.github.io/posts/829b453d.html","excerpt":"","text":"ä¸€ã€æœ¬åœ°æ‹‰å–é…ç½®1ã€åˆ›å»ºå¹¶å¯åŠ¨1ã€æ‹‰å–docker pull nginx 2ã€å¯åŠ¨docker run --name nginx-test -p 80:80 -d nginx â€“ name å®¹å™¨å‘½å -v æ˜ å°„ç›®å½• -d è®¾ç½®å®¹å™¨åå°è¿è¡Œ -p æœ¬æœºç«¯å£æ˜ å°„ å°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„80ç«¯å£ 2ã€æ˜ å°„åˆ°æœ¬åœ°1ã€åˆ›å»ºé¦–å…ˆåœ¨æœ¬æœºåˆ›å»ºnginxçš„ä¸€äº›æ–‡ä»¶å­˜å‚¨ç›®å½• mkdir -p /root/nginx/www /root/nginx/logs /root/nginx/conf www: nginxå­˜å‚¨ç½‘ç«™ç½‘é¡µçš„ç›®å½• logs: nginxæ—¥å¿—ç›®å½• conf: nginxé…ç½®æ–‡ä»¶ç›®å½• 2ã€æ˜ å°„ï¼ˆ1ï¼‰å…ˆæŸ¥çœ‹å®¹å™¨ docker ps -a ï¼ˆ2ï¼‰æ˜ å°„ docker cp 481e121fb29f:/etc/nginx/nginx.conf /root/nginx/conf 3ã€å¯åŠ¨å®¹å™¨éœ€è¦è¯´æ˜ä¸‹ï¼Œngxin-test å®¹å™¨æ˜¯ä¸ºäº†è·å¾—å®¹å™¨çš„é…ç½®æ–‡ä»¶ï¼Œæœ€ç»ˆä½¿ç”¨çš„æ˜¯ nginx-web ç›®å‰å·²ç»å¯åŠ¨ nginx-test 80ç«¯å£ï¼Œè‹¥æ˜¯ nginx-webæŒ‡å®šçš„ä¹Ÿæ˜¯ 80ï¼Œå°±éœ€è¦å…³é—­ nginx-testäº† docker stop nginx-test 1ã€æ–°å®¹å™¨æ˜ å°„åˆ›å»ºæ–°nginxå®¹å™¨nginx-web,å¹¶å°†www,logs,confç›®å½•æ˜ å°„åˆ°æœ¬åœ° docker run -d -p 80:80 --name nginx-web -v /root/nginx/www:/usr/share/nginx/html -v /root/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/logs:/var/log/nginx nginx 2ã€å¯åŠ¨docker start nginx-web äºŒã€ä¸‹è½½git1ã€ä¸‹è½½yum install git 2ã€é…ç½®github ä»£ç†git config --global url.\"https://ghproxy.com/https://github.com\".insteadOf \"https://github.com\" 3ã€æ‹‰å–git clone https://github.com/mykkTo/mykkTo.github.io.git 4ã€å‰ªåˆ‡æ–‡ä»¶mv /root/nginx/www/mykkTo.github.io/* /root/nginx/www ä¸‰ã€å®šæ—¶ä»»åŠ¡1ã€ç¼–å†™shellè„šæœ¬#!/bin/bash #åˆ é™¤åŸå§‹é™æ€é¡µé¢æ•°æ®ä»¥åŠæ‹‰å–çš„æ–‡ä»¶å¤¹ rm -rf /root/nginx/www/* rm -rf /root/nginx/mykkTo.github.iopwd #æ‹‰å–ï¼Œå‰ªåˆ‡åˆ°80æ˜ å°„ä¸‹ cd /root/nginx/ git clone https://github.com/mykkTo/mykkTo.github.io.git mv /root/nginx/mykkTo.github.io/* /root/nginx/www #å¤åˆ¶ä»¤ç‰Œç”¨æˆ·ç™¾åº¦ç«™é•¿éªŒè¯ä½¿ç”¨ cp /root/nginx/baidu_verify_code-Os7hLX61vV.html /root/nginx/www/baidu_verify_code-Os7hLX61vV.html #æ›¿æ¢æ–‡æœ¬ï¼Œç”¨äºç™¾åº¦ç«™é•¿seoæ˜ å°„ sed 's/github.io/cn/g' /root/nginx/www/baidu_urls.txt&gt;/root/nginx/www/baidu_urls1.txt sed 's/https/http/g' /root/nginx/www/baidu_urls1.txt&gt;/root/nginx/www/baidu_urls2.txt echo \"============æˆåŠŸ=========\" 2ã€åˆ›å»ºå®šæ—¶ä»»åŠ¡crontab -e service crond start å››ã€SSLè¯ä¹¦1ã€æ˜¯ä»€ä¹ˆæ•°æ®åŠ å¯†ï¼šå¼€å¯ HTTPS ç»¿è‰²åŠ å¯†é€šé“ï¼Œç½‘ç«™æ•°æ®çš„åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢ç½‘ç«™æ ¸å¿ƒæ•°æ®è¢«çªƒå–æˆ–ç¯¡æ”¹ã€‚ ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠ http è®¿é—®çš„å˜æˆ httpsï¼Œå¹¶ä¸”æµè§ˆå™¨æ˜¾ç¤ºå®‰å…¨ï¼Œä¸åœ¨æ˜¯ä¸å®‰å…¨äº† 2ã€è·å–è¯ä¹¦1ã€ä¸‹è½½ 2ã€ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹ 3ã€é‡æŒ‚è½½1ã€åˆ æ‰ä¹‹å‰çš„å®¹å™¨docker rm -f nginx-web 2ã€é‡æ–°æŒ‚è½½1ã€æ–°å¢äº† 443ç«¯å£æ˜ å°„ï¼Œç›®å½•æŒ‚è½½ 2ã€å®¹å™¨å¤–ï¼Œåœ¨nginxåº•ä¸‹ï¼Œåˆ›å»ºæ–°ç›®å½• mkdir lls 3ã€åˆ›å»ºå®¹å™¨ å¤šåŠ äº†ä¸¤ä¸ªé…ç½® docker run -d -p 443:443 -p 80:80 --name nginx-web -v /root/nginx/www:/usr/share/nginx/html -v /root/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/logs:/var/log/nginx -v /root/nginx/lls/:/etc/nginx/ssl nginx 4ã€ä¿®æ”¹é…ç½®nginx.conf user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; events { worker_connections 1024; } http { limit_req_zone $binary_remote_addr zone=mylimit:10m rate=2r/s; include /etc/nginx/mime.types; default_type application/octet-stream; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; access_log /var/log/nginx/access.log main; sendfile on; #tcp_nopush on; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf; server{ listen 443 ssl; #å¯¹åº”çš„åŸŸåï¼ŒæŠŠmykkto.cnæ”¹æˆä½ ä»¬è‡ªå·±çš„åŸŸåå°±å¯ä»¥äº† server_name mykkto.cn; #è¯ä¹¦çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ ssl_certificate /etc/nginx/ssl/7526194_www.mykkto.cn.pem; ssl_certificate_key /etc/nginx/ssl/7526194_www.mykkto.cn.key; #ä»¥ä¸‹éƒ½æ˜¯ä¸€äº›åŠ å¯†è§„åˆ™ ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; ssl_prefer_server_ciphers on; #è¿™æ˜¯æˆ‘çš„ä¸»é¡µè®¿é—®åœ°å€ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯é™æ€çš„htmlç½‘é¡µï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨locationå°±å¯ä»¥å®Œæˆäº†ã€‚ location / { #æ–‡ä»¶å¤¹ï¼ˆè¿™ä¸ªå…¶å®æŒ‚è½½çš„å°±æ˜¯å¤–éƒ¨çš„wwwç›®å½•ä¸‹çš„é™æ€èµ„æºï¼‰ root //usr/share/nginx/html; #ä¸»é¡µæ–‡ä»¶ index index.html; } } server { listen 80; #è¿™è¾¹ç©ºæ ¼éš”å¼€ï¼Œé…ç½®äº†ä¸¤ä¸ªï¼Œå› ä¸ºåŠ äº†wwwä¹Ÿè¦é…ç½® server_name mykkto.cn www.mykkto.cn; rewrite ^/(.*)$ https://mykkto.cn:443/$1 permanent; # location / { # limit_req zone=mylimit; #} } } 5ã€é‡å¯å¹¶æµ‹è¯•1ã€é‡å¯docker restart nginx-web 2ã€æµ‹è¯•1ã€è®¿é—®ï¼Œwww.mykkto.cnmï¼Œè‡ªåŠ¨è·³è½¬ 2ã€è®¿é—®ï¼Œmykkto.cnï¼Œè‡ªåŠ¨è·³è½¬ äº”ã€IPé»‘åå•é™åˆ¶1ã€å‰è¨€1ã€ç”¨åˆ°ä»€ä¹ˆæŠ€æœ¯æ ˆé¦–å…ˆï¼ŒåŸºæœ¬æ¶æ„æ˜¯ docker+nginx+lua+mysqlè¿™æ˜¯æœ€åˆçš„æƒ³æ³•ï¼Œä½†æ˜¯ä½œè€…ç”¨äº†dockeræ­å»ºçš„nginxï¼Œluaæ¨¡å—é›†æˆä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥æ›¿æ¢æˆäº†ï¼ŒOpenRestyã€‚ 2ã€ä»€ä¹ˆæ˜¯ OpenRestyç®€å•æ¥è¯´å°±æ˜¯ lua + nginxï¼Œå½“ç„¶è¿˜æœ‰æ›´å¤šåŠŸèƒ½ï¼Œè‡ªå·±ç™¾åº¦å§ 3ã€é‡åˆ°çš„é—®é¢˜ç®€å•æè¿°ä¸‹ï¼Œä¸Šé¢ç”¨åˆ°çš„ nginx.confå†™æ³•ï¼Œå‰ç¼€ user nginx; ä¼šå¯¼è‡´æ— æ³•è¿è¡Œï¼Œå› ä¸ºopenrestyæ²¡æœ‰è¿™ä¸ªç”¨æˆ·ï¼Œå¯ä»¥è‡ªå·±æ–°å»ºï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯æ”¹å†™é…ç½®ã€‚ 2ã€æ­å»º OpenResty1ã€æ‹‰å–docker pull openresty/openresty 2ã€æŒ‚è½½å¹¶å¯åŠ¨è¯´æ˜ä¸‹ï¼š å®Œå…¨åŸºäºä¸Šé¢çš„nginxé…ç½®çš„ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå”¯ä¸€ä¿®æ”¹çš„æ˜¯ nginx.confé…ç½®æ–‡ä»¶ï¼Œè¿™è¾¹æŒ‚è½½æ”¹æˆäº† nginx2.confï¼Œç”¨äºä¿ç•™ä¹‹å‰çš„ï¼ˆè‡ªå·±æ‡’è€Œå·²ï¼‰ æ–°å¢äº†ï¼Œluaæ–‡ä»¶æŒ‚è½½ ä¿®æ”¹äº†å®¹å™¨å†…çš„æŒ‚è½½ä½ç½®ï¼Œå› ä¸º openrestyå®¹å™¨ä½ç½®ä¸ä¸€æ ·äº†(å¤–éƒ¨è¿˜æ˜¯ä¸å˜ï¼Œå®¹å™¨å†…çš„ä½ç½®å˜äº†) docker run -d -p 443:443 -p 80:80 --name openresty -v /root/nginx/www:/usr/local/openresty/nginx/html -v /root/nginx/conf/nginx2.conf:/usr/local/openresty/nginx/conf/nginx.conf -v /root/nginx/logs:/usr/local/openresty/nginx/logs -v /root/nginx/lls/:/usr/local/openresty/nginx/ssl -v /root/nginx/lua/:/usr/local/openresty/nginx/lua openresty/openresty 3ã€é…ç½®æ–‡ä»¶ä¿®æ”¹1ã€åˆå§‹åŒ–è¿™æ˜¯è‡ªå¸¦çš„ï¼Œå¯ä»¥è‡ªå·± DIY # nginx.conf -- docker-openresty # # This file is installed to: # `/usr/local/openresty/nginx/conf/nginx.conf` # and is the file loaded by nginx at startup, # unless the user specifies otherwise. # # It tracks the upstream OpenResty's `nginx.conf`, but removes the `server` # section and adds this directive: # `include /etc/nginx/conf.d/*.conf;` # # The `docker-openresty` file `nginx.vh.default.conf` is copied to # `/etc/nginx/conf.d/default.conf`. It contains the `server section # of the upstream `nginx.conf`. # # See https://github.com/openresty/docker-openresty/blob/master/README.md#nginx-config-files # #user nobody; #worker_processes 1; # Enables the use of JIT for regular expressions to speed-up their processing. pcre_jit on; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; # Enables or disables the use of underscores in client request header fields. # When the use of underscores is disabled, request header fields whose names contain underscores are marked as invalid and become subject to the ignore_invalid_headers directive. # underscores_in_headers off; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; # Log in JSON Format # log_format nginxlog_json escape=json '{ \"timestamp\": \"$time_iso8601\", ' # '\"remote_addr\": \"$remote_addr\", ' # '\"body_bytes_sent\": $body_bytes_sent, ' # '\"request_time\": $request_time, ' # '\"response_status\": $status, ' # '\"request\": \"$request\", ' # '\"request_method\": \"$request_method\", ' # '\"host\": \"$host\",' # '\"upstream_addr\": \"$upstream_addr\",' # '\"http_x_forwarded_for\": \"$http_x_forwarded_for\",' # '\"http_referrer\": \"$http_referer\", ' # '\"http_user_agent\": \"$http_user_agent\", ' # '\"http_version\": \"$server_protocol\", ' # '\"nginx_access\": true }'; # access_log /dev/stdout nginxlog_json; # See Move default writable paths to a dedicated directory (#119) # https://github.com/openresty/docker-openresty/issues/119 client_body_temp_path /var/run/openresty/nginx-client-body; proxy_temp_path /var/run/openresty/nginx-proxy; fastcgi_temp_path /var/run/openresty/nginx-fastcgi; uwsgi_temp_path /var/run/openresty/nginx-uwsgi; scgi_temp_path /var/run/openresty/nginx-scgi; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf; # Don't reveal OpenResty version to clients. # server_tokens off; } 2ã€å¼•å…¥ä¹‹å‰çš„é…ç½®åœ¨åˆå§‹çš„åŸºç¡€ä¸ŠåŠ ä¸Šï¼Œä¸¤ä¸ªä¹‹å‰å†™å¥½çš„ server å—ï¼Œä»¥åŠluaè„šæœ¬ç”¨äºæµ‹è¯• # nginx.conf -- docker-openresty # # This file is installed to: # `/usr/local/openresty/nginx/conf/nginx.conf` # and is the file loaded by nginx at startup, # unless the user specifies otherwise. # # It tracks the upstream OpenResty's `nginx.conf`, but removes the `server` # section and adds this directive: # `include /etc/nginx/conf.d/*.conf;` # # The `docker-openresty` file `nginx.vh.default.conf` is copied to # `/etc/nginx/conf.d/default.conf`. It contains the `server section # of the upstream `nginx.conf`. # # See https://github.com/openresty/docker-openresty/blob/master/README.md#nginx-config-files # #user nobody; #worker_processes 1; # Enables the use of JIT for regular expressions to speed-up their processing. pcre_jit on; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; # Enables or disables the use of underscores in client request header fields. # When the use of underscores is disabled, request header fields whose names contain underscores are marked as invalid and become subject to the ignore_invalid_headers directive. # underscores_in_headers off; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; # Log in JSON Format # log_format nginxlog_json escape=json '{ \"timestamp\": \"$time_iso8601\", ' # '\"remote_addr\": \"$remote_addr\", ' # '\"body_bytes_sent\": $body_bytes_sent, ' # '\"request_time\": $request_time, ' # '\"response_status\": $status, ' # '\"request\": \"$request\", ' # '\"request_method\": \"$request_method\", ' # '\"host\": \"$host\",' # '\"upstream_addr\": \"$upstream_addr\",' # '\"http_x_forwarded_for\": \"$http_x_forwarded_for\",' # '\"http_referrer\": \"$http_referer\", ' # '\"http_user_agent\": \"$http_user_agent\", ' # '\"http_version\": \"$server_protocol\", ' # '\"nginx_access\": true }'; # access_log /dev/stdout nginxlog_json; # See Move default writable paths to a dedicated directory (#119) # https://github.com/openresty/docker-openresty/issues/119 client_body_temp_path /var/run/openresty/nginx-client-body; proxy_temp_path /var/run/openresty/nginx-proxy; fastcgi_temp_path /var/run/openresty/nginx-fastcgi; uwsgi_temp_path /var/run/openresty/nginx-uwsgi; scgi_temp_path /var/run/openresty/nginx-scgi; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; include /etc/nginx/conf.d/*.conf; server{ listen 443 ssl; #å¯¹åº”çš„åŸŸåï¼ŒæŠŠmykkto.cnæ”¹æˆä½ ä»¬è‡ªå·±çš„åŸŸåå°±å¯ä»¥äº† server_name mykkto.cn; #è¯ä¹¦çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ ssl_certificate /usr/local/openresty/nginx/ssl/7526194_www.mykkto.cn.pem; ssl_certificate_key /usr/local/openresty/nginx/ssl/7526194_www.mykkto.cn.key; #ä»¥ä¸‹éƒ½æ˜¯ä¸€äº›åŠ å¯†è§„åˆ™ ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; ssl_prefer_server_ciphers on; #è¿™æ˜¯æˆ‘çš„ä¸»é¡µè®¿é—®åœ°å€ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯é™æ€çš„htmlç½‘é¡µï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨locationå°±å¯ä»¥å®Œæˆäº†ã€‚ location / { #æ–‡ä»¶å¤¹ï¼ˆè¿™ä¸ªå…¶å®æŒ‚è½½çš„å°±æ˜¯å¤–éƒ¨çš„wwwç›®å½•ä¸‹çš„é™æ€èµ„æºï¼‰ root /usr/local/openresty/nginx/html; #ä¸»é¡µæ–‡ä»¶ index index.html; } #luaè„šæœ¬ç”¨äºæµ‹è¯• location /lua { default_type 'text/html'; content_by_lua 'ngx.say(\"&lt;h1&gt; hello,openrestry&lt;/h1&gt;\")'; } } server { listen 80; #è¿™è¾¹ç©ºæ ¼éš”å¼€ï¼Œé…ç½®äº†ä¸¤ä¸ªï¼Œå› ä¸ºåŠ äº†wwwä¹Ÿè¦é…ç½® server_name mykkto.cn www.mykkto.cn; rewrite ^/(.*)$ https://mykkto.cn:443/$1 permanent; # location / { # limit_req zone=mylimit; #} } # Don't reveal OpenResty version to clients. # server_tokens off; } 3ã€æµ‹è¯•luaè„šæœ¬ å‚è€ƒ â†“â€”â€” ã€ä¸€åˆ°ä¸‰ã€‘å‚è€ƒâ€”â€”â€”â€“ https://www.cnblogs.com/zltech/p/13517231.html https://www.cnblogs.com/thepoy/p/14848080.html https://www.cnblogs.com/jianqingwang/p/6726589.html â€”â€” ã€ä¸€åˆ°ä¸‰ã€‘å‚è€ƒâ€”â€”â€”â€“ SSLè¯ä¹¦å‚è€ƒ&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; https://www.cnblogs.com/zeussbook/p/11231820.html https://www.cnblogs.com/yuyeblog/p/13582127.html https://www.cnblogs.com/makalochen/p/14241052.html#%E5%A4%9A%E7%9B%AE%E5%BD%95%E6%8C%82%E8%BD%BD IPé»‘åå•å‚è€ƒ&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; https://www.jb51.net/article/168907.htm https://blog.csdn.net/weixin_33971205/article/details/89861486","categories":[{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://mykkto.github.io/categories/%E5%8D%9A%E5%AE%A2/"}],"tags":[{"name":"blog","slug":"blog","permalink":"https://mykkto.github.io/tags/blog/"},{"name":"éƒ¨ç½²","slug":"éƒ¨ç½²","permalink":"https://mykkto.github.io/tags/%E9%83%A8%E7%BD%B2/"},{"name":"å°å§¿åŠ¿","slug":"å°å§¿åŠ¿","permalink":"https://mykkto.github.io/tags/%E5%B0%8F%E5%A7%BF%E5%8A%BF/"}],"author":"mykk"},{"title":"SpringCloud-Alibaba-Sentinel å®ç°ç†”æ–­ä¸é™æµ","slug":"03javaDistributed/01springcloud/15_SpringCloudAlibaba-Sentinel","date":"2022-03-13T07:17:13.000Z","updated":"2022-03-24T14:45:15.973Z","comments":true,"path":"posts/32724da3.html","link":"","permalink":"https://mykkto.github.io/posts/32724da3.html","excerpt":"","text":"ä¸€ã€æ¦‚è¿°1ã€å®˜ç½‘https://github.com/alibaba/Sentinel https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D 2ã€æ˜¯ä»€ä¹ˆä¸€å¥è¯è§£é‡Šï¼Œå°±æ˜¯ç±»ä¼¼äº Hystrix 3ã€å»å“ªä¸‹https://github.com/alibaba/Sentinel/releases 4ã€èƒ½å¹²å˜› æœåŠ¡ä½¿ç”¨ä¸­çš„å„ç§é—®é¢˜ æœåŠ¡é›ªå´© æœåŠ¡é™çº§ æœåŠ¡ç†”æ–­ æœåŠ¡é™æµ äºŒã€å®‰è£…æ§åˆ¶å°1ã€sentinelç»„ä»¶ç”±ä¸¤éƒ¨åˆ†æ„æˆ åå° å‰å°8080 2ã€å®‰è£…æ­¥éª¤1ã€æ‹‰å–é•œåƒdocker pull bladex/sentinel-dashboard:1.7.0 2ã€å¯åŠ¨å¹¶åˆ›å»ºå®¹å™¨docker run --name sentinel -d -p 8858:8858 bladex/sentinel-dashboard:1.7.0 3ã€è®¿é—®ip:8858 ç™»å½•è´¦å·å¯†ç å‡ä¸ºsentinel ä¸‰ã€åˆå§‹åŒ–å·¥ç¨‹1ã€å¯åŠ¨å‡†å¤‡å·¥ä½œå¯åŠ¨ sentinel ï¼ˆ8858ï¼‰ï¼Œnacosï¼ˆ8848ï¼‰ 2ã€model1ã€å»ºmodelcloudalibaba-sentinel-service8401 2ã€pom&lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt; &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-sentinel-service8401&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt; &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶+actuator --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;4.6.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: #NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: 101.34.180.133:8848 sentinel: transport: #é…ç½®Sentinel dashboardåœ°å€ # dashboard: 101.34.180.133:8858 # dashboard: 106.52.23.202:8080 # é¡¹ç›®å’Œ sentinel ä¸åœ¨åŒä¸€å°æœºå™¨æ— æ³•æŸ¥çœ‹å®æ—¶ç›‘æ§ dashboard: localhost:8080 #é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ port: 8719 # æœ¬åœ°æœºå™¨ip(dockerå®¹å™¨å¿…é¡»åŠ ä¸Š) # client-ip: 169.254.135.77 management: endpoints: web: exposure: include: '*' 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @SpringBootApplication @EnableDiscoveryClient public class SpringCloudSentinelMain8401 { public static void main(String[] args) { SpringApplication.run (SpringCloudSentinelMain8401.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class FlowLimitController { @GetMapping(\"/testA\") public String testA() { return \"------testA\"; } @GetMapping(\"/testB\") public String testB() { return \"------testB\"; } } 3ã€æ“ä½œ sentinelæ§åˆ¶å°1ã€åˆšè¿›æ¥ç©ºç©ºå¦‚ä¹Ÿï¼Œå•¥éƒ½æ²¡æœ‰ 2ã€æ‡’åŠ è½½è¯´æ˜ Sentinelé‡‡ç”¨çš„æ‡’åŠ è½½è¯´æ˜ éœ€è¦æ‰§è¡Œä¸€æ¬¡ http://localhost:8401/testA http://localhost:8401/testB è¿™è¾¹éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šå¦‚æœä½ çš„å®æ—¶ç›‘æ§æ²¡æœ‰æ•°æ®ï¼Œå¯èƒ½æ˜¯å› ä¸º sentinel å’Œé¡¹ç›®ä¸å†åŒä¸€ä¸ª æœºå™¨æˆ–è€… sentinelè®¿é—®ä¸åˆ° é¡¹ç›®å°±ç›‘æ§ä¸åˆ°äº† å››ã€æµæ§åˆ¶è§„åˆ™1ã€åŸºæœ¬ä»‹ç» 2ã€æµæ§æ¨¡å¼1ã€ç›´æ¥(é»˜è®¤)è¡¨ç¤ºï¼š1ç§’é’Ÿå†…æŸ¥è¯¢1æ¬¡å°±æ˜¯OKï¼Œè‹¥è¶…è¿‡æ¬¡æ•°1ï¼Œå°±ç›´æ¥-å¿«é€Ÿå¤±è´¥ï¼ŒæŠ¥é»˜è®¤é”™è¯¯ 1ã€é…ç½®å†…å®¹ 2ã€æµ‹è¯•æ•ˆæœè®¿é—®ï¼šhttp://localhost:8401/testA 3ã€ç»“è®ºæ€è€ƒç›´æ¥è°ƒç”¨é»˜è®¤æŠ¥é”™ä¿¡æ¯ï¼ŒæŠ€æœ¯æ–¹é¢OKï¼Œ ä½†æ˜¯å¦åº”è¯¥æœ‰æˆ‘ä»¬è‡ªå·±çš„åç»­å¤„ç†ï¼Œç±»ä¼¼æœ‰ä¸ªfallbackçš„å…œåº•æ–¹æ³• 2ã€å…³è”1ã€æ˜¯ä»€ä¹ˆ å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·± å½“ä¸Aå…³è”çš„èµ„æºBè¾¾åˆ°é˜€å€¼åï¼Œå°±é™æµAè‡ªå·± Bæƒ¹äº‹ï¼ŒAæŒ‚äº† 2ã€é…ç½®Aå½“å…³è”èµ„æº /testB çš„ qps é˜€å€¼è¶…è¿‡1æ—¶ï¼Œå°±é™æµ /testA çš„Restè®¿é—®åœ°å€ï¼Œå½“å…³è”èµ„æºåˆ°é˜ˆå€¼åé™åˆ¶é…ç½®å¥½çš„èµ„æºå 3ã€postmanæ¨¡æ‹Ÿå¹¶å‘å¯†é›†è®¿é—®testBåˆ›å»ºä¸€ä¸ªé›†åˆå¹¶å‘æµ‹è¯•æ–‡ä»¶å¤¹ å°†æµ‹è¯•çš„urlæ”¾è¿›æ–‡ä»¶å¤¹ 4ã€æµ‹è¯•å¯åŠ¨å¹¶å‘å¯¹ /testB runï¼Œå†æ¬¡è¿‡ç¨‹ä¸­è®¿é—® /testB å‘ç°å‡ºé”™ 3ã€é“¾è·¯ å¤šä¸ªè¯·æ±‚è°ƒç”¨äº†åŒä¸€ä¸ªå¾®æœåŠ¡ 2Xï¼ˆæµæ§æ¨¡å¼æ€»ç»“ï¼‰ ç›´æ¥ï¼šå¯¹å½“å‰èµ„æºé™æµ å…³è”ï¼šé«˜ä¼˜å…ˆçº§èµ„æºè§¦å‘é˜ˆå€¼ï¼Œå¯¹ä½ä¼˜å…ˆçº§èµ„æºé™æµã€‚ é“¾è·¯ï¼šé˜ˆå€¼ç»Ÿè®¡æ—¶ï¼Œåªç»Ÿè®¡ä»æŒ‡å®šèµ„æºè¿›å…¥å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œæ˜¯å¯¹è¯·æ±‚æ¥æºçš„é™æµ 3ã€æµæ§æ•ˆæœ1ã€å¿«é€Ÿå¤±è´¥è¾¾åˆ°å³°å€¼ï¼Œç›´æ¥å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼ˆBlocked by Sentinel (flow limiting)ï¼‰ æºç ï¼ˆä¿®æ”¹æ‰©å±•ä½ç½®ï¼‰ï¼šcom.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController 2ã€WarmUpï¼ˆé¢„çƒ­ï¼‰1ã€å…¬å¼é˜ˆå€¼é™¤ä»¥coldFactor(é»˜è®¤å€¼ä¸º3),ç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜ˆå€¼ 2ã€å®˜ç½‘ é»˜è®¤coldFactorä¸º3ï¼Œå³è¯·æ±‚ QPS ä» threshold / 3 å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„ QPS é˜ˆå€¼ã€‚ é™æµï¼Œå†·å¯åŠ¨ https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8 3ã€æºç com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController 4ã€WarmUpé…ç½® é»˜è®¤ coldFactor ä¸º 3ï¼Œå³è¯·æ±‚QPSä»(threshold / 3) å¼€å§‹ï¼Œç»å¤šå°‘é¢„çƒ­æ—¶é•¿æ‰é€æ¸å‡è‡³è®¾å®šçš„ QPS é˜ˆå€¼ã€‚ æ¡ˆä¾‹ï¼Œé˜€å€¼ä¸º10+é¢„çƒ­æ—¶é•¿è®¾ç½®5ç§’ã€‚ç³»ç»Ÿåˆå§‹åŒ–çš„é˜€å€¼ä¸º10 / 3 çº¦ç­‰äº3,å³é˜€å€¼åˆšå¼€å§‹ä¸º3ï¼›ç„¶åè¿‡äº†5ç§’åé˜€å€¼æ‰æ…¢æ…¢å‡é«˜æ¢å¤åˆ°10 5ã€ç‚¹å‡»æµ‹è¯•å¤šæ¬¡ç‚¹å‡»http://localhost:8401/testB åˆšå¼€å§‹ä¸è¡Œï¼Œåç»­æ…¢æ…¢OK 6ã€åº”ç”¨åœºæ™¯å¦‚ï¼šç§’æ€ç³»ç»Ÿåœ¨å¼€å¯çš„ç¬é—´ï¼Œä¼šæœ‰å¾ˆå¤šæµé‡ä¸Šæ¥ï¼Œå¾ˆæœ‰å¯èƒ½æŠŠç³»ç»Ÿæ‰“æ­»ï¼Œé¢„çƒ­æ–¹å¼å°±æ˜¯æŠŠä¸ºäº†ä¿æŠ¤ç³»ç»Ÿï¼Œå¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾è¿›æ¥ï¼Œæ…¢æ…¢çš„æŠŠé˜€å€¼å¢é•¿åˆ°è®¾ç½®çš„é˜€å€¼ã€‚ 3ã€æ’é˜Ÿç­‰å¾…1ã€è¯´æ˜åŒ€é€Ÿæ’é˜Ÿï¼Œé˜ˆå€¼å¿…é¡»è®¾ç½®ä¸ºQPS 2ã€å®˜ç½‘https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6 3ã€æºç com.alibaba.csp.sentinel.slots.block.flow.controller.RateLimiterController 4ã€é…ç½® åŒ€é€Ÿæ’é˜Ÿï¼Œè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜€å€¼ç±»å‹å¿…é¡»è®¾æˆQPSï¼Œå¦åˆ™æ— æ•ˆã€‚ è®¾ç½®å«ä¹‰ï¼š /testB æ¯ç§’1æ¬¡è¯·æ±‚ï¼Œè¶…è¿‡çš„è¯å°±æ’é˜Ÿç­‰å¾…ï¼Œç­‰å¾…çš„è¶…æ—¶æ—¶é—´ä¸º20000æ¯«ç§’ã€‚ 5ã€æµ‹è¯• äº”ã€é™çº§è§„åˆ™1ã€å®˜ç½‘https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7 2ã€åŸºæœ¬ä»‹ç»1ã€è¯´æ˜ Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçŠ¶æ€æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…æ—¶æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ï¼Œå¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œè®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶å®ƒçš„èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ã€‚ å½“èµ„æºè¢«é™çº§åï¼Œåœ¨æ¥ä¸‹æ¥çš„é™çº§æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¯¥èµ„æºçš„è°ƒç”¨éƒ½è‡ªåŠ¨ç†”æ–­ï¼ˆé»˜è®¤è¡Œä¸ºæ˜¯æŠ›å‡º DegradeExceptionï¼‰ 2ã€hystrixæ¯”è¾ƒSentinelçš„æ–­è·¯å™¨æ˜¯æ²¡æœ‰åŠå¼€çŠ¶æ€çš„ åŠå¼€çš„çŠ¶æ€ç³»ç»Ÿè‡ªåŠ¨å»æ£€æµ‹æ˜¯å¦è¯·æ±‚æœ‰å¼‚å¸¸ï¼Œæ²¡æœ‰å¼‚å¸¸å°±å…³é—­æ–­è·¯å™¨æ¢å¤ä½¿ç”¨ï¼Œæœ‰å¼‚å¸¸åˆ™ç»§ç»­æ‰“å¼€æ–­è·¯å™¨ä¸å¯ç”¨ã€‚å…·ä½“å¯ä»¥å‚è€ƒHystrix ä»¥ä¸‹æ˜¯hystrixæ–­è·¯å™¨ç»“æ„å›¾ 3ã€é™çº§ç­–ç•¥å®æˆ˜1ã€RT 1ã€ä»£ç @GetMapping(\"/testD\") public String testD() { //æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹ try { TimeUnit.SECONDS.sleep (1); } catch (InterruptedException e) { e.printStackTrace ( ); } log.info (\"testD æµ‹è¯•RT\"); return \"------testD\"; } 2ã€é…ç½® 3ã€jmeterå‹æµ‹ 4ã€ç»“æœ 2ã€å¼‚å¸¸æ¯”ä¾‹1ã€æ˜¯ä»€ä¹ˆ 2ã€ä»£ç @GetMapping(\"/testD\") public String testD() { log.info (\"testD æµ‹è¯•å¼‚å¸¸æ¯”ä¾‹\"); int age = 10 / 0; return \"------testD\"; } 3ã€é…ç½® 4ã€jmeter 5ã€ç»“è®º 3ã€å¼‚å¸¸æ•°1ã€æ˜¯ä»€ä¹ˆ 2ã€éœ€çŸ¥å¼‚å¸¸æ•°æ˜¯æŒ‰ç…§åˆ†é’Ÿç»Ÿè®¡çš„ 3ã€ä»£ç @GetMapping(\"/testE\") public String testE() { log.info (\"testE æµ‹è¯•å¼‚å¸¸æ¯”ä¾‹\"); int age = 10 / 0; return \"------testE æµ‹è¯•å¼‚å¸¸æ¯”ä¾‹\"; } 4ã€é…ç½® 5ã€jmeter å…­ã€çƒ­ç‚¹keyé™æµ1ã€åŸºæœ¬ä»‹ç»1ã€æ˜¯ä»€ä¹ˆä½•ä¸ºçƒ­ç‚¹ çƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æˆ–è€…é™åˆ¶æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„TopNæ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™æµæˆ–è€…å…¶å®ƒæ“ä½œ 2ã€å®˜ç½‘https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81 3ã€å…œåº•æ–¹æ³•sentinelç³»ç»Ÿé»˜è®¤çš„æç¤ºï¼šBlocked by Sentinel (flow limiting) å¯ä»¥æŒ‡å®šï¼Œè‡ªå®šä¹‰å…œåº•æ–¹æ³• ä»HystrixCommand åˆ°@SentinelResource 2ã€æ¡ˆä¾‹1ã€ä»£ç @GetMapping(\"/testHotKey\") @SentinelResource(value = \"testHotKey\", blockHandler = \"dealHandler_testHotKey\") public String testHotKey(@RequestParam(value = \"p1\", required = false) String p1, @RequestParam(value = \"p2\", required = false) String p2) { return \"------testHotKey\"; } public String dealHandler_testHotKey(String p1, String p2, BlockException exception) { return \"-----dealHandler_testHotKey\"; } 2ã€é…ç½®è¯´æ˜ é™æµæ¨¡å¼åªæ”¯æŒQPSæ¨¡å¼ï¼Œå›ºå®šå†™æ­»äº†ã€‚ï¼ˆè¿™æ‰å«çƒ­ç‚¹ï¼‰@SentinelResourceæ³¨è§£çš„æ–¹æ³•å‚æ•°ç´¢å¼•ï¼Œ0ä»£è¡¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ1ä»£è¡¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨å•æœºé˜€å€¼ä»¥åŠç»Ÿè®¡çª—å£æ—¶é•¿è¡¨ç¤ºåœ¨æ­¤çª—å£æ—¶é—´è¶…è¿‡é˜€å€¼å°±é™æµã€‚ä¸Šé¢çš„æŠ“å›¾å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æœ‰å€¼çš„è¯ï¼Œ1ç§’çš„QPSä¸º1ï¼Œè¶…è¿‡å°±é™æµï¼Œé™æµåè°ƒç”¨ dealHandler_testHotKeyæ”¯æŒæ–¹æ³•ã€‚ 3ã€é…ç½® @SentinelResource(value = \"testHotKey\",blockHandler = \"dealHandler_testHotKey\") æ–¹æ³•testHotKeyé‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°åªè¦QPSè¶…è¿‡æ¯ç§’1æ¬¡ï¼Œé©¬ä¸Šé™çº§å¤„ç† 4ã€æµ‹è¯•http://localhost:8401/testHotKey?p1=abc http://localhost:8401/testHotKey?p1=abc&amp;p2=33 http://localhost:8401/testHotKey?p2=33 3ã€å‚æ•°é«˜çº§é€‰é¡¹1ã€ä½œç”¨ä¸Šè¿°æ¡ˆä¾‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°p1ï¼Œå½“QPSè¶…è¿‡1ç§’1æ¬¡ç‚¹å‡»åé©¬ä¸Šè¢«é™æµ è‹¥æ˜¯æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œp1ç‰¹ä¾‹ä¸º5 ï¼ŒQPS é˜ˆå€¼ä¸º 200å°±å¯ä»¥é€šè¿‡ è¿™ä¸ªå®ç° 2ã€é…ç½® 3ã€æµ‹è¯•http://localhost:8401/testHotKey?p1=5 http://localhost:8401/testHotKey?p1=3 4ã€ç»“è®ºå½“p1ç­‰äº5çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200 å½“p1ä¸ç­‰äº5çš„æ—¶å€™ï¼Œé˜ˆå€¼ä¸ºå¹³å¸¸çš„ 1 çƒ­ç‚¹å‚æ•°çš„æ³¨æ„ç‚¹ï¼Œå‚æ•°å¿…é¡»æ˜¯åŸºæœ¬ç±»å‹æˆ–è€…String ä¸ƒã€@SentinelResource1ã€æŒ‰èµ„æºåç§°é™æµ+åç»­å¤„ç†1ã€ä»£ç 1ã€ä»£ç  package com.kk.springcloud.controller; import com.alibaba.csp.sentinel.annotation.SentinelResource; import com.alibaba.csp.sentinel.slots.block.BlockException; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class RateLimitController { @GetMapping(\"/byResource\") @SentinelResource(value = \"byResource\",blockHandler = \"handleException\") public CommonResult byResource() { return new CommonResult (200,\"æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK\",new Payment (2020L,\"serial001\")); } public CommonResult handleException(BlockException exception) { return new CommonResult(444,exception.getClass().getCanonicalName()+\"\\t æœåŠ¡ä¸å¯ç”¨\"); } } 2ã€pom &lt;dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; 2ã€é…ç½®æµæ§è§„åˆ™1ã€æ­¥éª¤ 2ã€å›¾å½¢é…ç½®å’Œä»£ç å…³ç³» 3ã€é…ç½®è¯´æ˜è¡¨ç¤º1ç§’é’Ÿå†…æŸ¥è¯¢æ¬¡æ•°å¤§äº1ï¼Œå°±è·‘åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„å¤„æµï¼Œé™æµ 3ã€æµ‹è¯•1ç§’é’Ÿç‚¹å‡»1ä¸‹ï¼ŒOK è¶…è¿‡ä¸Šè¿°ï¼Œç–¯ç‹‚ç‚¹å‡»ï¼Œè¿”å›äº†è‡ªå·±å®šä¹‰çš„é™æµå¤„ç†ä¿¡æ¯ï¼Œé™æµå‘ç”Ÿ 2ã€æŒ‰ç…§Urlåœ°å€é™æµ+åç»­å¤„ç†1ã€ä½œç”¨é€šè¿‡è®¿é—®çš„URLæ¥é™æµï¼Œä¼šè¿”å›Sentinelè‡ªå¸¦é»˜è®¤çš„é™æµå¤„ç†ä¿¡æ¯ 2ã€ä»£ç @GetMapping(\"/rateLimit/byUrl\") @SentinelResource(value = \"byUrl\") public CommonResult byUrl() { return new CommonResult (200, \"æŒ‰urlé™æµæµ‹è¯•OK\", new Payment (2020L, \"serial002\")); } 3ã€è®¿é—®ï¼ˆ1æ¬¡ï¼‰ä¸ºäº†åˆ·æ–°å®æ—¶é…ç½®ï¼Œçº¿ä¸Šå°±æ²¡å¿…è¦è¿™ä¸ªæ“ä½œäº† http://localhost:8401//rateLimit/byUrl 4ã€é…ç½® 5ã€è®¿é—®ï¼ˆç‹‚ç‚¹ï¼‰ 3ã€å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜1 ç³»ç»Ÿé»˜è®¤çš„ï¼Œæ²¡æœ‰ä½“ç°æˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡è¦æ±‚ã€‚ 2 ä¾ç…§ç°æœ‰æ¡ä»¶ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„å¤„ç†æ–¹æ³•åˆå’Œä¸šåŠ¡ä»£ç è€¦åˆåœ¨ä¸€å—ï¼Œä¸ç›´è§‚ã€‚ 3 æ¯ä¸ªä¸šåŠ¡æ–¹æ³•éƒ½æ·»åŠ ä¸€ä¸ªå…œåº•çš„ï¼Œé‚£ä»£ç è†¨èƒ€åŠ å‰§ã€‚ 4 å…¨å±€ç»Ÿä¸€çš„å¤„ç†æ–¹æ³•æ²¡æœ‰ä½“ç° 4ã€ç”¨æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘1ã€è‡ªå®šä¹‰é™æµå¤„ç†ç±»åˆ›å»ºCustomerBlockHandlerç±»ç”¨äºè‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘ package com.kk.springcloud.handler; import com.alibaba.csp.sentinel.slots.block.BlockException; import com.kk.springcloud.entities.CommonResult; public class CustomerBlockHandler { public static CommonResult handleException(BlockException exception) { return new CommonResult (2020, \"è‡ªå®šä¹‰çš„é™æµå¤„ç†ä¿¡æ¯......CustomerBlockHandler\"); } } 2ã€ä½¿ç”¨/** * è‡ªå®šä¹‰é€šç”¨çš„é™æµå¤„ç†é€»è¾‘ï¼Œ blockHandlerClass = CustomerBlockHandler.class blockHandler = handleException ä¸Šè¿°é…ç½®ï¼šæ‰¾CustomerBlockHandlerç±»é‡Œçš„handleException2æ–¹æ³•è¿›è¡Œå…œåº•å¤„ç† */ /** * è‡ªå®šä¹‰é€šç”¨çš„é™æµå¤„ç†é€»è¾‘ */ @GetMapping(\"/rateLimit/customerBlockHandler\") @SentinelResource(value = \"customerBlockHandler\", blockHandlerClass = CustomerBlockHandler.class, blockHandler = \"handleException\") public CommonResult customerBlockHandler() { return new CommonResult (200, \"æŒ‰å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘\"); } 3ã€é…ç½® 4ã€é…ç½®è¯´æ˜ 5ã€æµ‹è¯• 5ã€æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜ å…«ã€æœåŠ¡ç†”æ–­åŠŸèƒ½1ã€æ•´åˆsentinelæ•´åˆribbon+openFeign+fallback 2ã€Ribbon1ã€ç”Ÿäº§è€…1ã€å»ºmodelcloudalibaba-provider-payment9003 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-provider-payment9003&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt;&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 9003 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: localhost:8848 #é…ç½®Nacosåœ°å€ management: endpoints: web: exposure: include: '*' 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @EnableDiscoveryClient @SpringBootApplication public class PaymentMain9003 { public static void main(String[] args) { SpringApplication.run (PaymentMain9003.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import java.util.HashMap; @RestController public class PaymentController { @Value(\"${server.port}\") private String serverPort; public static HashMap&lt;Long, Payment&gt; hashMap = new HashMap&lt;&gt; ( ); static { hashMap.put (1L, new Payment (1L, \"28a8c1e3bc2742d8848569891fb42181\")); hashMap.put (2L, new Payment (2L, \"bba8c1e3bc2742d8848569891ac32182\")); hashMap.put (3L, new Payment (3L, \"6ua8c1e3bc2742d8848569891xt92183\")); } @GetMapping(value = \"/paymentSQL/{id}\") public CommonResult&lt;Payment&gt; paymentSQL(@PathVariable(\"id\") Long id) { Payment payment = hashMap.get (id); CommonResult&lt;Payment&gt; result = new CommonResult (200, \"from mysql,serverPort: \" + serverPort, payment); return result; } } 6ã€å¯åŠ¨åŒä¸€ä¸ªæœåŠ¡ï¼Œå¯åŠ¨9003ï¼Œ9004 -Dserver.port=9004 7ã€æµ‹è¯•http://localhost:9003/paymentSQL/1 http://localhost:9004/paymentSQL/1 2ã€æ¶ˆè´¹è€…1ã€modelæ–°å»ºcloudalibaba-consumer-nacos-order84 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-consumer-nacos-order84&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 84 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: localhost:8848 sentinel: transport: #é…ç½®Sentinel dashboardåœ°å€ dashboard: localhost:8080 #é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ port: 8719 #æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…) service-url: nacos-user-service: http://nacos-payment-provider 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @EnableDiscoveryClient @SpringBootApplication public class OrderNacosMain84 { public static void main(String[] args) { SpringApplication.run (OrderNacosMain84.class,args); } } 5ã€é…ç½®ç±»1ã€rabbion è´Ÿè½½é…ç½® package com.kk.springcloud.config; import org.springframework.cloud.client.loadbalancer.LoadBalanced; import org.springframework.context.annotation.Bean; import org.springframework.stereotype.Component; import org.springframework.web.client.RestTemplate; @Component public class ApplicationContextConfig { @Bean @LoadBalanced public RestTemplate getRestTemplate() { return new RestTemplate ( ); } } 6ã€ä¸šåŠ¡ç±»1ã€åªé…ç½®fallbackï¼ˆæœ¬ä¾‹sentinelæ— é…ç½®ï¼‰ 2ã€åªé…ç½®blockHandler package com.kk.springcloud.controller; import com.alibaba.csp.sentinel.annotation.SentinelResource; import com.alibaba.csp.sentinel.slots.block.BlockException; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; @RestController @Slf4j public class CircleBreakerController { public static final String SERVICE_URL = \"http://nacos-payment-provider\"; @Resource private RestTemplate restTemplate; @RequestMapping(\"/consumer/fallback/{id}\") @SentinelResource(value = \"fallback\", blockHandler = \"blockHandler\") //blockHandlerè´Ÿè´£åœ¨sentinelé‡Œé¢é…ç½®çš„é™çº§é™æµ public CommonResult&lt;Payment&gt; fallback(@PathVariable Long id) { CommonResult&lt;Payment&gt; result = restTemplate.getForObject (SERVICE_URL + \"/paymentSQL/\" + id, CommonResult.class, id); if (id == 4) { throw new IllegalArgumentException (\"éæ³•å‚æ•°å¼‚å¸¸....\"); } else if (result.getData ( ) == null) { throw new NullPointerException (\"NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•\"); } return result; } // å…œåº• public CommonResult handlerFallback(@PathVariable Long id, Throwable e) { Payment payment = new Payment (id, \"null\"); return new CommonResult&lt;&gt; (444, \"å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹ \" + e.getMessage ( ), payment); } // é™çº§ public CommonResult blockHandler(@PathVariable Long id, BlockException blockException) { Payment payment = new Payment (id, \"null\"); return new CommonResult&lt;&gt; (445, \"blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException \" + blockException.getMessage ( ), payment); } } 3ã€fallbackå’ŒblockHandleréƒ½é…ç½® package com.kk.springcloud.controller; import com.alibaba.csp.sentinel.annotation.SentinelResource; import com.alibaba.csp.sentinel.slots.block.BlockException; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; @RestController @Slf4j public class CircleBreakerController { public static final String SERVICE_URL = \"http://nacos-payment-provider\"; @Resource private RestTemplate restTemplate; @RequestMapping(\"/consumer/fallback/{id}\") @SentinelResource(value = \"fallback\", fallback = \"handlerFallback\", blockHandler = \"blockHandler\") public CommonResult&lt;Payment&gt; fallback(@PathVariable Long id) { CommonResult&lt;Payment&gt; result = restTemplate.getForObject (SERVICE_URL + \"/paymentSQL/\" + id, CommonResult.class, id); if (id == 4) { throw new IllegalArgumentException (\"éæ³•å‚æ•°å¼‚å¸¸....\"); } else if (result.getData ( ) == null) { throw new NullPointerException (\"NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•\"); } return result; } // å…œåº• public CommonResult handlerFallback(@PathVariable Long id, Throwable e) { Payment payment = new Payment (id, \"null\"); return new CommonResult&lt;&gt; (444, \"fallback,æ— æ­¤æµæ°´,exception \" + e.getMessage ( ), payment); } // é™çº§ public CommonResult blockHandler(@PathVariable Long id, BlockException blockException) { Payment payment = new Payment (id, \"null\"); return new CommonResult&lt;&gt; (445, \"blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException \" + blockException.getMessage ( ), payment); } } é™çº§ä¼˜å…ˆäºé™æµï¼šè‹¥ blockHandler å’Œ fallback éƒ½è¿›è¡Œäº†é…ç½®ï¼Œåˆ™è¢«é™æµé™çº§è€ŒæŠ›å‡º BlockException æ—¶åªä¼šè¿›å…¥ blockHandler å¤„ç†é€»è¾‘ã€‚ 4ã€å±æ€§å¿½ç•¥ ç›´æ¥æŠ›åˆ°å‰å°å¯¹ç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œç»†èŠ‚æ³¨æ„ 3ã€Feign1ã€modelä¿®æ”¹84æ¨¡å— 2ã€pom&lt;!--SpringCloud openfeign --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; 3ã€yml# æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ feign: sentinel: enabled: true 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.openfeign.EnableFeignClients; @EnableDiscoveryClient @SpringBootApplication @EnableFeignClients public class OrderNacosMain84 { public static void main(String[] args) { SpringApplication.run (OrderNacosMain84.class,args); } } 5ã€ä¸šåŠ¡ç±»1ã€è¿œç¨‹è°ƒæœåŠ¡æ¥å£package com.kk.springcloud.serivice; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; /** * @auther mykk * @create 2022å¹´3æœˆ24æ—¥ 21:45:49 * ä½¿ç”¨ fallback æ–¹å¼æ˜¯æ— æ³•è·å–å¼‚å¸¸ä¿¡æ¯çš„ï¼Œ * å¦‚æœæƒ³è¦è·å–å¼‚å¸¸ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ fallbackFactoryå‚æ•° */ @FeignClient(value = \"nacos-payment-provider\", fallback = PaymentFallbackService.class)//è°ƒç”¨ä¸­å…³é—­9003æœåŠ¡æä¾›è€… public interface PaymentService { @GetMapping(value = \"/paymentSQL/{id}\") CommonResult&lt;Payment&gt; paymentSQL(@PathVariable(\"id\") Long id); } 2ã€å…œåº•å®ç°package com.kk.springcloud.serivice; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import org.springframework.stereotype.Component; @Component public class PaymentFallbackService implements PaymentService { @Override public CommonResult&lt;Payment&gt; paymentSQL(Long id) { return new CommonResult&lt;&gt; (444, \"æœåŠ¡é™çº§è¿”å›,æ²¡æœ‰è¯¥æµæ°´ä¿¡æ¯\", new Payment (id, \"errorSerial......\")); } } 3ã€Controller//==================OpenFeign @Resource private PaymentService paymentService; @GetMapping(value = \"/consumer/openfeign/{id}\") public CommonResult&lt;Payment&gt; paymentSQL(@PathVariable(\"id\") Long id) { if (id == 4) { throw new RuntimeException (\"æ²¡æœ‰è¯¥id\"); } return paymentService.paymentSQL (id); } 6ã€æµ‹è¯•æµ‹è¯•84è°ƒç”¨9003ï¼Œæ­¤æ—¶æ•…æ„å…³é—­9003/9004å¾®æœåŠ¡æä¾›è€…ï¼Œçœ‹84æ¶ˆè´¹ä¾§è‡ªåŠ¨é™çº§ï¼Œä¸ä¼šè¢«è€—æ­» 4ã€ç†”æ–­æ¡†æ¶æ¯”è¾ƒ ä¹ã€æŒä¹…åŒ–è§„åˆ™1ã€æ˜¯ä»€ä¹ˆä¸€æ—¦æˆ‘ä»¬é‡å¯åº”ç”¨ï¼Œsentinelè§„åˆ™å°†æ¶ˆå¤±ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦å°†é…ç½®è§„åˆ™è¿›è¡ŒæŒä¹…åŒ– 2ã€æ€ä¹ˆç©å°†é™æµé…ç½®è§„åˆ™æŒä¹…åŒ–è¿›Nacosä¿å­˜ï¼Œåªè¦åˆ·æ–°8401æŸä¸ªreståœ°å€ï¼Œsentinelæ§åˆ¶å°çš„æµæ§è§„åˆ™å°±èƒ½çœ‹åˆ°ï¼Œåªè¦Nacosé‡Œé¢çš„é…ç½®ä¸åˆ é™¤ï¼Œé’ˆå¯¹8401ä¸Šsentinelä¸Šçš„æµæ§è§„åˆ™æŒç»­æœ‰æ•ˆ 3ã€å®æˆ˜1ã€modelä¿®æ”¹cloudalibaba-sentinel-service8401 2ã€pom &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-sentinel-service8401&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba sentinel-datasource-nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt; &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt; &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--SpringCloud ailibaba sentinel --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶+actuator --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;4.6.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€yml server: port: 8401 spring: application: name: cloudalibaba-sentinel-service cloud: nacos: discovery: #NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ server-addr: 101.34.180.133:8848 sentinel: transport: #é…ç½®Sentinel dashboardåœ°å€ # dashboard: 101.34.180.133:8858 # dashboard: 106.52.23.202:8080 # é¡¹ç›®å’Œ sentinel ä¸åœ¨åŒä¸€å°æœºå™¨æ— æ³•æŸ¥çœ‹å®æ—¶ç›‘æ§ dashboard: localhost:8080 #é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£ port: 8719 datasource: ds1: nacos: server-addr: 101.34.180.133:8848 dataId: cloudalibaba-sentinel-service groupId: DEFAULT_GROUP data-type: json rule-type: flow # æœ¬åœ°æœºå™¨ip(dockerå®¹å™¨å¿…é¡»åŠ ä¸Š) # client-ip: 169.254.135.77 feign: sentinel: enabled: true # æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ management: endpoints: web: exposure: include: '*' 4ã€æ·»åŠ Nacosä¸šåŠ¡è§„åˆ™é…ç½®[ { \"resource\": \"/rateLimit/byUrl\", \"limitApp\": \"default\", \"grade\": 1, \"count\": 1, \"strategy\": 0, \"controlBehavior\": 0, \"clusterMode\": false } ] 5ã€å¯åŠ¨å¯åŠ¨8401ååˆ·æ–°sentinelå‘ç°ä¸šåŠ¡è§„åˆ™æœ‰äº† 6ã€æµ‹è¯•ï¼ˆè®¿é—®ï¼‰å¿«é€Ÿè®¿é—®æµ‹è¯•æ¥å£ http://localhost:8401/rateLimit/byUrl åäºŒã€å‚è€ƒæ–‡æ¡£ â†“https://www.cnblogs.com/linjiqin/p/15369091.html https://www.jianshu.com/p/373eb512ec48 https://m.imooc.com/article/details?article_id=289384 https://www.cnblogs.com/yunqing/p/11406225.html","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"ç†”æ–­å™¨","slug":"ç†”æ–­å™¨","permalink":"https://mykkto.github.io/tags/%E7%86%94%E6%96%AD%E5%99%A8/"},{"name":"sentinel","slug":"sentinel","permalink":"https://mykkto.github.io/tags/sentinel/"},{"name":"é™æµ","slug":"é™æµ","permalink":"https://mykkto.github.io/tags/%E9%99%90%E6%B5%81/"}],"author":"mykk"},{"title":"Nacos é«˜å¯ç”¨é›†ç¾¤ï¼ˆdocker-composeï¼‰","slug":"03javaDistributed/02docker/01_docker(nacos)","date":"2022-03-12T03:17:13.000Z","updated":"2022-03-13T14:07:39.865Z","comments":true,"path":"posts/d9c3bea0.html","link":"","permalink":"https://mykkto.github.io/posts/d9c3bea0.html","excerpt":"","text":"ä¸€ã€æ¶æ„1ã€å‰è¨€æœ¬æ¥è¿™éƒ¨åˆ†æ˜¯è¦åœ¨ Spring-nacos æ‰‹å†Œä¸­ ï¼Œä½†æ˜¯åé¢æ­å»ºé‡åˆ°å¾ˆå¤šå‘æ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œå°±å•ç‹¬æ•´ç†åå†™å‡ºè¿™ç¯‡ã€‚ 2ã€æ¶æ„å›¾ ä¸€ä¸ªngxin è´Ÿè½½ ä¸‰ä¸ª nacosèŠ‚ç‚¹ï¼Œmysql ä¸»ä»ä¸¤ä¸ªèŠ‚ç‚¹ äºŒã€æ­å»º mysql ä¸»ä»1ã€æ‹‰å–å’Œåˆ›å»º# 1ã€æ‹‰å– [root@VM_0_17_centos ~]docker pull mysql:5.7.13 # 2ã€å¯åŠ¨ [root@VM_0_17_centos ~]docker run --name master -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7.13 # å‚æ•°è¯´æ˜ --name ä¸ºå®¹å™¨æŒ‡å®šåç§°ï¼Œè¿™é‡Œæ˜¯master -p å°†å®¹å™¨çš„æŒ‡å®šç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„æŒ‡å®šç«¯å£ï¼Œè¿™é‡Œæ˜¯å°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306ç«¯å£ -e è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œæ˜¯æŒ‡å®šrootè´¦å·çš„å¯†ç ä¸ºroot -d åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID mysql:5.7.13 æŒ‡å®šè¿è¡Œçš„mysqlç‰ˆ # 3ã€æŸ¥çœ‹æ˜¯å¦å¯åŠ¨,ä»¥æœ‰å®¹å™¨ [root@VM_0_17_centos ~]# docker ps -a 2ã€å¼€æ”¾ç«¯å£firewall-cmd --zone=public --add-port=3306/tcp --permanent firewall-cmd --reload # è¯´æ˜ --permanent æ°¸ä¹…å¼€å¯ï¼Œé¿å…ä¸‹æ¬¡å¼€æœºéœ€è¦å†æ¬¡æ‰‹åŠ¨å¼€å¯ç«¯å£ 3ã€åˆ›å»º[ä¸»å®¹å™¨]çš„å¤åˆ¶è´¦å·ä½¿ç”¨Navicatå‹å¥½çš„å›¾åƒåŒ–ç•Œé¢æ‰§è¡ŒSQL GRANT REPLICATION SLAVE ON *.* to 'backup'@'%' identified by 'backup'; show grants for 'backup'@'%'; 4ã€ä¿®æ”¹MySQL[ä¸»å®¹å™¨]é…ç½®ç¯å¢ƒ1ã€åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š/usr/local/mysql/master/usr/local/mysql/slave1/usr/local/mysql/slave2 [root@VM_0_17_centos ~]# mkdir -p /usr/local/mysql/master /usr/local/mysql/slave1 /usr/local/mysql/slave2 2ã€æ‹·è´ä¸€ä»½MySQLé…ç½®æ–‡ä»¶[root@VM_0_17_centos local]# docker cp master:/etc/mysql/my.cnf /usr/local/mysql/master/my.cnf 3ã€è¿›åˆ°masterç›®å½•ä¸‹ï¼Œå·²å­˜åœ¨æ‹·è´çš„my.cnf[root@VM_0_17_centos master]# ll total 4 -rw-r--r-- 1 root root 1801 May 10 10:27 my.cnf 4ã€ä¿®æ”¹my.cnfï¼Œåœ¨ [mysqld] èŠ‚ç‚¹æœ€ååŠ ä¸Šåä¿å­˜log-bin=mysql-bin server-id=1 log-bin=mysql-bin ä½¿ç”¨binary loggingï¼Œmysql-binæ˜¯logæ–‡ä»¶åçš„å‰ç¼€ server-id=1 å”¯ä¸€æœåŠ¡å™¨IDï¼Œé0æ•´æ•°ï¼Œä¸èƒ½å’Œå…¶ä»–æœåŠ¡å™¨çš„server-idé‡å¤ 5ã€å°†ä¿®æ”¹åçš„æ–‡ä»¶è¦†ç›–Dockerä¸­MySQLä¸­çš„é…ç½®æ–‡ä»¶docker cp /usr/local/mysql/master/my.cnf master:/etc/mysql/my.cnf 6ã€é‡å¯ mysql çš„docker , è®©é…ç½®ç”Ÿæ•ˆ[root@VM_0_17_centos master]# docker restart master 5ã€è¿è¡ŒMySQL [ä»]å®¹å™¨1ã€é¦–å…ˆè¿è¡Œä»å®¹å™¨[root@VM_0_17_centos ~]# docker run --name slave1 -p 3307:3306 -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7.13 2ã€ä¸ä¸»å®¹å™¨ç›¸ä¼¼ï¼Œæ‹·è´é…ç½®æ–‡ä»¶è‡³slave1ç›®å½•ä¿®æ”¹åè¦†ç›–å›Dockerä¸­log-bin=mysql-bin server-id=2 3ã€åˆ«å¿˜è®°ï¼Œé‡å¯slave1å®¹å™¨ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ[root@VM_0_17_centos master]# docker slave1 master 6ã€é…ç½®ä¸»ä»å¤åˆ¶1ã€ä½¿ç”¨Navicatè¿æ¥ [slave1]åæ–°å»ºæŸ¥è¯¢ï¼Œæ‰§è¡Œä»¥ä¸‹SQLCHANGE MASTER TO MASTER_HOST='è¿æ¥Navicatçš„ip', MASTER_PORT=3306, MASTER_USER='backup', MASTER_PASSWORD='backup'; START SLAVE; MASTER_HOST å¡«Navicatè¿æ¥é…ç½®ä¸­çš„ipåº”è¯¥å°±å¯ä»¥ MASTER_PORT ä¸»å®¹å™¨çš„ç«¯å£ MASTER_USER åŒæ­¥è´¦å·çš„ç”¨æˆ·å MASTER_PASSWORD åŒæ­¥è´¦å·çš„å¯†ç  2ã€æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸshow slave status; 7ã€æ£€æŸ¥ä¸»ä» ä¸‰ã€æ­å»º nacos é›†ç¾¤1ã€å‰è¨€docker-composeé…ç½®çš„æºç ï¼Œå·²ç»ä¸Šä¼ åˆ° github,å¯ç›´æ¥clone ï¼š https://github.com/mykkTo/nacos-cluster-docker.git 2ã€é…ç½®æ–‡ä»¶è¯´æ˜1ã€Nacoså…±ç”¨çš„init.d/custom.propertiesï¼Œä¸å®˜æ–¹ä¿æŒä¸€è‡´ï¼ŒæŒ‰éœ€ä½¿ç”¨ 2ã€docker-compose-nacos1.yml ä»¥ 1ä¸ºä¾‹ï¼Œ å¸¦ä¸ªéƒ½å¤§åŒå°å¼‚ 3ã€å¯åŠ¨ nacos é›†ç¾¤1ã€å°†æºä»£ç é…ç½®ä¿®æ”¹åï¼Œåˆ†åˆ«ä¸Šä¼ åˆ°ä¸‰å°ä¸»æœº 101.34.180.133 å¯¹åº” nacos-1 106.52.23.202 å¯¹åº” nacos-2 119.45.122.161 å¯¹åº” nacos-3 2ã€å¯åŠ¨å®¹å™¨åˆ†åˆ«åœ¨å„ä¸»æœºä¸Šè¿›å…¥å„è‡ªå¯¹åº”çš„nacosç›®å½•ä¸­ï¼Œå¯åŠ¨å®¹å™¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 133æœåŠ¡å™¨ï¼š $ cd nacos-cluster-docker/nacos-1 $ docker-compose -f docker-compose-nacos1.yml up -d 202æœåŠ¡å™¨ï¼š $ cd nacos-cluster-docker/nacos-2 $ docker-compose -f docker-compose-nacos2.yml up -d 161æœåŠ¡å™¨ï¼š $ cd nacos-cluster-docker/nacos-3 $ docker-compose -f docker-compose-nacos3.yml up -d 3ã€æŸ¥çœ‹æ—¥å¿—æŸ¥çœ‹æ—¥å¿—åˆ†åˆ«åœ¨å¯¹åº”çš„nacos-*ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ tail -f cluster-logs/nacos*/nacos.log 4ã€åœæ­¢å®¹å™¨$ docker-compose -f docker-compose-nacos1.yml stop 5ã€è®¿é—®Nacos UIç•Œé¢ è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°Nacosé›†ç¾¤å„èŠ‚ç‚¹å·²ç»æ­£å¸¸äº†ï¼ŒLEADERä¸FOLLOWERå·²ç»é€‰å‡ºï¼Œä¸€åˆ‡æ­£å¸¸äº† å››ã€nginx è´Ÿè½½1ã€åˆ›å»ºå¹¶å¯åŠ¨1ã€æ‹‰å–docker pull nginx 2ã€å¯åŠ¨docker run --name nginx-test -p 80:80 -d nginx â€“ name å®¹å™¨å‘½å -v æ˜ å°„ç›®å½• -d è®¾ç½®å®¹å™¨åå°è¿è¡Œ -p æœ¬æœºç«¯å£æ˜ å°„ å°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„80ç«¯å£ 2ã€æ˜ å°„åˆ°æœ¬åœ°1ã€åˆ›å»ºé¦–å…ˆåœ¨æœ¬æœºåˆ›å»ºnginxçš„ä¸€äº›æ–‡ä»¶å­˜å‚¨ç›®å½• mkdir -p /root/nginx/www /root/nginx/logs /root/nginx/conf www: nginxå­˜å‚¨ç½‘ç«™ç½‘é¡µçš„ç›®å½• logs: nginxæ—¥å¿—ç›®å½• conf: nginxé…ç½®æ–‡ä»¶ç›®å½• 2ã€æ˜ å°„ï¼ˆ1ï¼‰å…ˆæŸ¥çœ‹å®¹å™¨ docker ps -a ï¼ˆ2ï¼‰æ˜ å°„ docker cp 481e121fb29f:/etc/nginx/nginx.conf /root/nginx/conf 3ã€å¯åŠ¨å®¹å™¨éœ€è¦è¯´æ˜ä¸‹ï¼Œngxin-test å®¹å™¨æ˜¯ä¸ºäº†è·å¾—å®¹å™¨çš„é…ç½®æ–‡ä»¶ï¼Œæœ€ç»ˆä½¿ç”¨çš„æ˜¯ nginx-web ç›®å‰å·²ç»å¯åŠ¨ nginx-test 80ç«¯å£ï¼Œè‹¥æ˜¯ nginx-webæŒ‡å®šçš„ä¹Ÿæ˜¯ 80ï¼Œå°±éœ€è¦å…³é—­ nginx-testäº† docker stop nginx-test 1ã€æ–°å®¹å™¨æ˜ å°„åˆ›å»ºæ–°nginxå®¹å™¨nginx-web,å¹¶å°†www,logs,confç›®å½•æ˜ å°„åˆ°æœ¬åœ° docker run -d -p 80:80 --name nginx-web -v /root/nginx/www:/usr/share/nginx/html -v /root/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/logs:/var/log/nginx nginx 2ã€å¯åŠ¨docker start nginx-web 4ã€é…ç½®è´Ÿè½½å‡è¡¡1ã€è¿›å…¥ é…ç½®åœ¨ root åº•ä¸‹ 2ã€é…ç½®æºç user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; events { worker_connections 1024; } http { #gzip on; upstream nacos-cluster { server 101.34.180.133:8848; server 106.52.23.202:8848; server 119.45.122.161:8848; } server { listen 80; location /{ proxy_pass http://nacos-cluster; } } } ä¸»è¦çš„æ˜¯è¿™å— è¯´æ˜ä¸‹ï¼š æ–°æ‰‹å¯èƒ½ä¸å¤ªä¼šnginxï¼Œlisten ä¸º 80 æ˜¯å› ä¸ºä½ å®¹å™¨å¯åŠ¨æ—¶å€™æ˜¯ 80ï¼Œå½“è®¿é—® 80çš„æ—¶å€™è½¬åˆ° ä»¥ä¸Šä¸‰ä¸ª ip è´Ÿè½½è½®è®­ï¼Œè¿˜å¯ä»¥è®¾ç½®æƒé‡å¯ä»¥å»çœ‹æ–‡æ¡£ 3ã€é‡å¯docker restart nginx-web äº”ã€Spring-bootè¿æ¥1ã€ymlé…ç½® 2ã€æŸ¥çœ‹å®¢æˆ·ç«¯ å…­ã€é—®é¢˜æ±‡æ€»1ã€å…³äº 503å¼‚å¸¸ä¿¡æ¯ï¼šjava.lang.IllegalStateException: failed to req API:/nacos/v1/ns/instance after all servers([101.34.180.133:8848]) tried: failed to req API:101.34.180.133:8848/nacos/v1/ns/instance. code:503 msg: server is DOWN now, please try again later! ä¸ªäººè§è§£ï¼šè¿™ä¸ªé—®é¢˜åšä¸»è®¤ä¸ºæ˜¯é›†ç¾¤èŠ‚ç‚¹å°‘äº3ä¸ªå‡ºç°çš„ï¼Œå› ä¸ºæœåŠ¡å™¨è¿‡æœŸäº†ä¸€å°å‰©ä¸‹äº† ä¸¤å°ï¼Œæ‰€ä»¥æŠ¥è¿™ä¸ªé”™è¯¯ï¼Œä¸‰å°æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚ ä¸ƒã€å‚è€ƒæ–‡æ¡£ â†“https://www.cnblogs.com/hellxz/p/nacos-cluster-docker.html https://docs.docker.com/compose/install/ https://www.cnblogs.com/bigband/p/13515219.html https://my.oschina.net/u/3773384/blog/1810111 https://www.jianshu.com/p/658911a8cff3 https://www.yht7.com/news/92162 https://blog.csdn.net/weixin_40461281/article/details/92586378 https://www.cnblogs.com/ilinuxer/p/6916969.html https://blog.csdn.net/weixin_40461281/article/details/92586378","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"nacos","slug":"nacos","permalink":"https://mykkto.github.io/tags/nacos/"},{"name":"é›†ç¾¤","slug":"é›†ç¾¤","permalink":"https://mykkto.github.io/tags/%E9%9B%86%E7%BE%A4/"},{"name":"docker-compose","slug":"docker-compose","permalink":"https://mykkto.github.io/tags/docker-compose/"}],"author":"mykk"},{"title":"é«˜é˜¶é¢è¯•é¢˜ï¼šJUC-AQS","slug":"05interviewQuestions/01multithreading/01_Interview-JUC-AQS","date":"2022-03-09T13:32:10.000Z","updated":"2022-03-30T15:03:13.619Z","comments":true,"path":"posts/3fb37166.html","link":"","permalink":"https://mykkto.github.io/posts/3fb37166.html","excerpt":"","text":"ä¸€ã€æ˜¯ä»€ä¹ˆ1ã€å­—é¢æ„æ€æŠ½è±¡çš„é˜Ÿåˆ—åŒæ­¥å™¨ ç»“æ„å…³ç³»å›¾ï¼š 2ã€æŠ€æœ¯è§£é‡Š ç”¨æ¥æ„å»ºé”æˆ–è€…å…¶å®ƒåŒæ­¥å™¨ç»„ä»¶çš„é‡é‡çº§åŸºç¡€æ¡†æ¶åŠæ•´ä¸ªJUCä½“ç³»çš„åŸºçŸ³ã€‚ é€šè¿‡å†…ç½®çš„FIFO1é˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œï¼Œå¹¶é€šè¿‡ä¸€ä¸ªintç±»å˜é‡è¡¨ç¤ºæŒæœ‰é”çš„çŠ¶æ€ CLHï¼šCraigã€Landin and Hagersten é˜Ÿåˆ—ï¼Œæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼ŒAQSä¸­çš„é˜Ÿåˆ—æ˜¯CLHå˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—FIFO äºŒã€AQS=JUCï¼ˆåŸºçŸ³ï¼‰AQSä¸ºä»€ä¹ˆæ˜¯JUCå†…å®¹ä¸­æœ€é‡è¦çš„åŸºçŸ³ 1ã€AQSæœ‰å…³çš„é” ReentrantLock CountDownLatch ReentrantReadWriteLock Semaphore â€¦â€¦â€¦â€¦â€¦ç­‰ç­‰ 2ã€è¿›ä¸€æ­¥ç†è§£é”å’ŒåŒæ­¥å™¨çš„å…³ç³» é”ï¼Œé¢å‘é”çš„ä½¿ç”¨è€…ï¼š å®šä¹‰äº†ç¨‹åºå‘˜å’Œé”äº¤äº’çš„ä½¿ç”¨å±‚APIï¼Œéšè—äº†å®ç°ç»†èŠ‚ï¼Œä½ è°ƒç”¨å³å¯ã€‚ åŒæ­¥å™¨ï¼Œé¢å‘é”çš„å®ç°è€… æ¯”å¦‚Javaå¹¶å‘å¤§ç¥DougLeeï¼Œæå‡ºç»Ÿä¸€è§„èŒƒå¹¶ç®€åŒ–äº†é”çš„å®ç°ï¼Œå±è”½äº†åŒæ­¥çŠ¶æ€ç®¡ç†ã€é˜»å¡çº¿ç¨‹æ’é˜Ÿå’Œé€šçŸ¥ã€å”¤é†’æœºåˆ¶ç­‰ã€‚ ä¸‰ã€èƒ½å¹²å˜›1ã€åŠ é”ä¼šå¯¼è‡´é˜»å¡æœ‰é˜»å¡å°±éœ€è¦æ’é˜Ÿï¼Œå®ç°æ’é˜Ÿå¿…ç„¶éœ€è¦é˜Ÿåˆ— 2ã€è¯´æ˜è§£é‡ŠæŠ¢åˆ°èµ„æºçš„çº¿ç¨‹ç›´æ¥ä½¿ç”¨å¤„ç†ä¸šåŠ¡ï¼ŒæŠ¢ä¸åˆ°èµ„æºçš„å¿…ç„¶æ¶‰åŠä¸€ç§æ’é˜Ÿç­‰å€™æœºåˆ¶ã€‚æŠ¢å èµ„æºå¤±è´¥çš„çº¿ç¨‹ç»§ç»­å»ç­‰å¾…(ç±»ä¼¼é“¶è¡Œä¸šåŠ¡åŠç†çª—å£éƒ½æ»¡äº†ï¼Œæš‚æ—¶æ²¡æœ‰å—ç†çª—å£çš„é¡¾å®¢åªèƒ½å»å€™å®¢åŒºæ’é˜Ÿç­‰å€™)ï¼Œä½†ç­‰å€™çº¿ç¨‹ä»ç„¶ä¿ç•™è·å–é”çš„å¯èƒ½ä¸”è·å–é”æµç¨‹ä»åœ¨ç»§ç»­(å€™å®¢åŒºçš„é¡¾å®¢ä¹Ÿåœ¨ç­‰ç€å«å·ï¼Œè½®åˆ°äº†å†å»å—ç†çª—å£åŠç†ä¸šåŠ¡)ã€‚ æ—¢ç„¶è¯´åˆ°äº†æ’é˜Ÿç­‰å€™æœºåˆ¶ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¼šæœ‰æŸç§é˜Ÿåˆ—å½¢æˆï¼Œè¿™æ ·çš„é˜Ÿåˆ—æ˜¯ä»€ä¹ˆæ•°æ®ç»“æ„å‘¢ï¼Ÿ å¦‚æœå…±äº«èµ„æºè¢«å ç”¨ï¼Œå°±éœ€è¦ä¸€å®šçš„é˜»å¡ç­‰å¾…å”¤é†’æœºåˆ¶æ¥ä¿è¯é”åˆ†é…ã€‚è¿™ä¸ªæœºåˆ¶ä¸»è¦ç”¨çš„æ˜¯CLHé˜Ÿåˆ—çš„å˜ä½“å®ç°çš„ï¼Œå°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°±æ˜¯AQSçš„æŠ½è±¡è¡¨ç°ã€‚å®ƒå°†è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆé˜Ÿåˆ—çš„ç»“ç‚¹ï¼ˆNodeï¼‰ï¼Œé€šè¿‡CASã€è‡ªæ—‹ä»¥åŠLockSupport.park()çš„æ–¹å¼ï¼Œç»´æŠ¤stateå˜é‡çš„çŠ¶æ€ï¼Œä½¿å¹¶å‘è¾¾åˆ°åŒæ­¥çš„æ•ˆæœã€‚ LockSupport.park()ï¼šé˜»å¡å½“å‰çº¿ç¨‹çš„æ‰§è¡Œï¼Œä¸”éƒ½ä¸ä¼šé‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„é”èµ„æºï¼› å››ã€AQS è§£è¯»1ã€AQSæ¦‚è¿°1ã€å®˜ç½‘è§£é‡Š 2ã€é˜»å¡-&gt;é˜Ÿåˆ—æœ‰é˜»å¡å°±éœ€è¦æ’é˜Ÿï¼Œå®ç°æ’é˜Ÿå¿…ç„¶éœ€è¦é˜Ÿåˆ— AQSä½¿ç”¨ä¸€ä¸ªvolatileçš„intç±»å‹çš„æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çš„æ’é˜Ÿå·¥ä½œå°†æ¯æ¡è¦å»æŠ¢å èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªNodeèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ï¼Œé€šè¿‡CASå®Œæˆå¯¹Stateå€¼çš„ä¿®æ”¹ã€‚ 2ã€AQSå†…éƒ¨ä½“ç³»æ¶æ„ 1ã€AQSè‡ªèº«1ã€AQSçš„intå˜é‡ â˜…1ã€AQSçš„åŒæ­¥çŠ¶æ€Stateæˆå‘˜å˜é‡ 2ã€é“¶è¡ŒåŠç†ä¸šåŠ¡çš„å—ç†çª—å£çŠ¶æ€ï¼ˆé€šä¿—ç†è§£ï¼‰ é›¶å°±æ˜¯æ²¡äººï¼ˆè‡ªç”±çŠ¶æ€ï¼‰ï¼Œå¯ä»¥åŠç† å¤§äºç­‰äº1ï¼Œæœ‰äººå ç”¨çª—å£ï¼Œç­‰ç€å» 2ã€AQSçš„CLHé˜Ÿåˆ—1ã€CLHé˜Ÿåˆ—(ä¸‰ä¸ªå¤§ç‰›çš„åå­—ç»„æˆ)ï¼Œä¸ºä¸€ä¸ªåŒå‘é˜Ÿåˆ— 2ã€é“¶è¡Œå€™å®¢åŒºçš„ç­‰å¾…é¡¾å®¢ï¼ˆé€šä¿—ç†è§£ï¼‰ 3ã€å°æ€»ç»“ æœ‰é˜»å¡å°±éœ€è¦æ’é˜Ÿï¼Œå®ç°æ’é˜Ÿå¿…ç„¶éœ€è¦é˜Ÿåˆ— stateå˜é‡+CLHåŒç«¯é˜Ÿåˆ— 2ã€å†…éƒ¨ç±»Nodeå†…éƒ¨ç±»Node(Nodeç±»åœ¨AQSç±»å†…éƒ¨) 1ã€Nodeçš„intå˜é‡ â˜…1ã€Nodeçš„ç­‰å¾…çŠ¶æ€waitStateæˆå‘˜å˜é‡ 2ã€è¯´æ˜ ç­‰å€™åŒºå…¶å®ƒé¡¾å®¢(å…¶å®ƒçº¿ç¨‹)çš„ç­‰å¾…çŠ¶æ€ é˜Ÿåˆ—ä¸­æ¯ä¸ªæ’é˜Ÿçš„ä¸ªä½“å°±æ˜¯ä¸€ä¸ª Node 2ã€Nodeæ­¤ç±»è¯¦è§£1ã€å†…éƒ¨ç»“æ„ 2ã€å±æ€§è¯´æ˜ 3ã€AQSåŒæ­¥é˜Ÿåˆ—çš„åŸºæœ¬ç»“æ„ CLHï¼šCraigã€Landin and Hagersten é˜Ÿåˆ—ï¼Œæ˜¯ä¸ªå•å‘é“¾è¡¨ï¼ŒAQSä¸­çš„é˜Ÿåˆ—æ˜¯CLHå˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—ï¼ˆFIFOï¼‰ FIFOï¼šé˜Ÿåˆ—ä¸­ç”¨åˆ°äº†å“¨å…µèŠ‚ç‚¹ï¼ˆå‚€å„¡èŠ‚ç‚¹ï¼‰æ—¢ï¼Œå¤´èŠ‚ç‚¹ï¼ˆå¥½å¤„å°±æ˜¯ä¸ç”¨å»åˆ¤ç©ºï¼Œå› ä¸ºæœ‰å¤´èŠ‚ç‚¹ï¼‰ äº”ã€ä»ReentrantLockå¼€å§‹è§£è¯»AQS1ã€è¯´æ˜Lockæ¥å£çš„å®ç°ç±»ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ã€èšåˆã€‘äº†ä¸€ä¸ªã€é˜Ÿåˆ—åŒæ­¥å™¨ã€‘çš„å­ç±»å®Œæˆçº¿ç¨‹è®¿é—®æ§åˆ¶çš„ 1ã€å¯ä»¥çœ‹å‡ºå†…éƒ¨å­ç±» Syncï¼Œç»§æ‰¿äº† AQS 2ã€çœ‹ä¸‹ç±» UMLå›¾ï¼ŒSync åº•ä¸‹åˆæœ‰ä¸¤ä¸ªå­ç±»ï¼ˆåˆ†åˆ«ä¸ºå…¬å¹³å’Œéå…¬å¹³ï¼‰ 2ã€å…¬å¹³é”å’Œéå…¬å¹³é”1ã€å…ˆä»åˆ›å»ºå…¥æ‰‹ 2ã€è¿½æº¯1ã€é»˜è®¤æ„é€ æ–¹æ³•ï¼Œé»˜è®¤ä¸ä¼ å‚æ„é€  2ã€å¸¦å‚ä¼ å…¥ï¼Œæ­¤æ—¶åˆ¤æ–­æ˜¯éå…¬å¹³è¿˜æ˜¯å…¬å¹³ 3ã€å¾ˆæ˜æ˜¾è¿™æ˜¯ä¸¤ä¸ªç±»ï¼Œåˆ†åˆ«ç»§æ‰¿ä¸Syncï¼Œä¸Šé¢æœ‰æåˆ° 3ã€çœ‹æºç 1ã€çœ‹å·®å¼‚1ã€å¯ä»¥æ˜æ˜¾çœ‹å‡ºå…¬å¹³é”ä¸éå…¬å¹³é”çš„lock()æ–¹æ³•å”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºå…¬å¹³é”åœ¨è·å–åŒæ­¥çŠ¶æ€æ—¶å¤šäº†ä¸€ä¸ªé™åˆ¶æ¡ä»¶ hasQueuedPredecessors() hasQueuedPredecessorsæ˜¯å…¬å¹³é”åŠ é”æ—¶åˆ¤æ–­ç­‰å¾…é˜Ÿåˆ—ä¸­æ˜¯å¦å­˜åœ¨æœ‰æ•ˆèŠ‚ç‚¹çš„æ–¹æ³• 2ã€å¯¹æ¯”å…¬å¹³é”ï¼šå…¬å¹³é”è®²ç©¶å…ˆæ¥å…ˆåˆ°ï¼Œçº¿ç¨‹åœ¨è·å–é”æ—¶ï¼Œå¦‚æœè¿™ä¸ªé”çš„ç­‰å¾…é˜Ÿåˆ—ä¸­å·²ç»æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼› éå…¬å¹³é”ï¼šä¸ç®¡æ˜¯å¦æœ‰ç­‰å¾…é˜Ÿåˆ—ï¼Œå¦‚æœå¯ä»¥è·å–é”ï¼Œåˆ™ç«‹åˆ»å æœ‰é”å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªæ’é˜Ÿçº¿ç¨‹åœ¨unpark()ï¼Œä¹‹åè¿˜æ˜¯éœ€è¦ç«äº‰é”ï¼ˆå­˜åœ¨çº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼‰ 3ã€å¿…è°ƒ lock()åœ¨åˆ›å»ºå®Œå…¬å¹³/éå…¬å¹³é”ï¼Œè°ƒç”¨lockæ–¹æ³•è¿›è¡ŒåŠ é”ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨ acquire æ–¹æ³• 3ã€æºç Apiè§£è¯»1ã€lock() 2ã€acquire() ä¸‰ä¸ªèµ°å‘ 1ã€tryAcquire() -&gt; tryAcquire () ç”±äºå­ç±» FairSync å®ç° 2ã€è°ƒç”¨ addWaiter() -&gt; enq() å…¥é˜Ÿæ“ä½œ 3ã€acquireQueued() -&gt; cancelAcquire() å‚è€ƒæ–‡æ¡£https://www.cnblogs.com/tong-yuan/p/11768904.html https://baijiahao.baidu.com/s?id=1718317852417206951&amp;wfr=spider&amp;for=pc https://blog.csdn.net/hengyunabc/article/details/28126139 å“¨å…µèŠ‚ç‚¹è§£è¯»ï¼šhttps://www.cnblogs.com/litexy/p/9749544.html","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://mykkto.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"AQS","slug":"AQS","permalink":"https://mykkto.github.io/tags/AQS/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://mykkto.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"JUC","slug":"JUC","permalink":"https://mykkto.github.io/tags/JUC/"}],"author":"mykk"},{"title":"Oracle11g(dockerç‰ˆ)","slug":"04base/04oracle/01_oracle11g-docker","date":"2022-02-28T04:49:31.000Z","updated":"2022-02-28T12:53:16.635Z","comments":true,"path":"posts/42dbeac3.html","link":"","permalink":"https://mykkto.github.io/posts/42dbeac3.html","excerpt":"","text":"ä¸€ã€Dockerå®‰è£…å’Œé…ç½®1ã€é•œåƒæ‹‰å–ï¼ˆç¬¬ä¸‰æ–¹ï¼‰docker pull registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g 2ã€ä¸‹è½½å®Œåï¼ŒæŸ¥çœ‹docker images 3ã€åˆ›å»ºå®¹å™¨docker run -d -p 1521:1521 --name oracle11g registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g 4ã€å¯åŠ¨å®¹å™¨ï¼Œæ“ä½œ1ã€å¯åŠ¨docker start oracle11g 2ã€è¿›å…¥å®¹å™¨docker exec -it oracle11g bash 3ã€åˆ‡æ¢rootç”¨æˆ·su root å¯†ç ï¼šhelowin æ³¨æ„ï¼šç°åœ¨è¿˜ä¸èƒ½é€€å‡ºï¼Œç»§ç»­æ“ä½œ 5ã€ç¼–è¾‘profileæ–‡ä»¶é…ç½®ORACLEç¯å¢ƒå˜é‡åœ¨dockerä¸­æŸ¥æ‰¾å¹¶ç¼–è¾‘profileæ–‡ä»¶ vi /etc/profile export ORACLE_HOME=/home/oracle/app/oracle/product/11.2.0/dbhome_2 export ORACLE_SID=helowin export PATH=$ORACLE_HOME/bin:$PATH åœ¨æœ€åä¸ŠåŠ ï¼š ä¿å­˜å¹¶é€€å‡º ï¼šwq 6ã€oracleçš„é…ç½®1. åˆ›å»ºè½¯è¿æ¥ln -s $ORACLE_HOME/bin/sqlplus /usr/bin 2.åˆ‡æ¢åˆ°oracle ç”¨æˆ·è¿™é‡Œè¿˜è¦è¯´ä¸€ä¸‹ï¼Œä¸€å®šè¦å†™ä¸­é—´çš„ - å¿…é¡»è¦ï¼Œå¦åˆ™è½¯è¿æ¥æ— æ•ˆ su - oracle 7ã€oracleæ•°æ®åº“çš„æ“ä½œ1. ç™»å½•sqlpluså¹¶ä¿®æ”¹sysã€systemç”¨æˆ·å¯†ç sqlplus /nolog conn /as sysdba 2. ä¿®æ”¹å’Œåˆ›å»ºç”¨æˆ·alter user system identified by system; alter user sys identified by sys; ä¹Ÿå¯ä»¥åˆ›å»ºç”¨æˆ· create user test identified by test; å¹¶ç»™ç”¨æˆ·èµ‹äºˆæƒé™ grant connect,resource,dba to test; 3. scottç”¨æˆ·çš„å¼€å¯--è§£é”scottç”¨æˆ·ï¼ˆå®‰è£…æ—¶è‹¥ä½¿ç”¨é»˜è®¤æƒ…å†µæ²¡æœ‰è§£é”å’Œè®¾ç½®å¯†ç è¿›è¡Œä¸‹åˆ—æ“ä½œï¼Œè¦è¶…çº§ç®¡ç†å‘˜æ“ä½œï¼‰ alter user scott account unlock; --è§£é”scottç”¨æˆ·çš„å¯†ç ã€æ­¤å¥ä¹Ÿå¯ä»¥ç”¨æ¥é‡ç½®å¯†ç ã€‘ alter user scott identified by tiger; äºŒã€å®¢æˆ·ç«¯è¿æ¥1ã€navicatè¿æ¥æ‰“å¼€navicatåï¼ˆnavicat12ä¸ç”¨é…ç½®oci.dllæ–‡ä»¶äº†ï¼‰ 2ã€pl/sql è¿æ¥101.xx.xxx.133:1521/helowinXDBå¯†ç ï¼štiger ä¸‰ã€å…¶ä»–åŠŸèƒ½1ã€scottèµ‹äºˆæœ€é«˜æƒé™åˆ†ä¸¤æ¡è¿è¡Œ CONN / AS SYSDBA; GRANT DBA TO SCOTT; å‚è€ƒhttps://www.cnblogs.com/laoluoits/p/13942119.html https://www.cnblogs.com/flyingsand/p/9463460.html","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://mykkto.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"oracle","slug":"oracle","permalink":"https://mykkto.github.io/tags/oracle/"},{"name":"docker","slug":"docker","permalink":"https://mykkto.github.io/tags/docker/"},{"name":"å®‰è£…","slug":"å®‰è£…","permalink":"https://mykkto.github.io/tags/%E5%AE%89%E8%A3%85/"}],"author":"mykk"},{"title":"SpringCloud-Alibaba-Nacos æœåŠ¡æ³¨å†Œ+é…ç½®ä¸­å¿ƒ","slug":"03javaDistributed/01springcloud/14_SpringCloudAlibaba-Nacos","date":"2022-02-23T13:12:31.000Z","updated":"2022-03-12T14:19:29.990Z","comments":true,"path":"posts/af0a257d.html","link":"","permalink":"https://mykkto.github.io/posts/af0a257d.html","excerpt":"","text":"å‹æƒ…é“¾æ¥-æ—©æœŸNacosæ–‡ç« ä¸€ã€Nacosç®€ä»‹1ã€æ˜¯ä»€ä¹ˆé¡¹ç›®æ–‡æ¡£ï¼šhttps://github.com/alibaba/Nacos ä½¿ç”¨æ–‡æ¡£ï¼šhttps://nacos.io/zh-cn/index.html ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚ Nacos = Eureka+Config +Bus 2ã€èƒ½å¹²å˜› æ›¿ä»£EurekaåšæœåŠ¡æ³¨å†Œä¸­å¿ƒ æ›¿ä»£ConfigåšæœåŠ¡é…ç½®ä¸­å¿ƒ 3ã€æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ äºŒã€å®‰è£…ï¼ˆdockerï¼‰1ã€pullé•œåƒæ¨èç¨³å®šç‰ˆç‰ˆæœ¬(å®˜æ–¹æ¨è1.3.1),å¦‚æœä¸æŒ‡å®šç‰ˆæœ¬çš„è¯åˆ™å°±æ˜¯latestç‰ˆæœ¬(å¯¹åº”nacosçš„1.4ç‰ˆæœ¬) docker pull nacos/nacos-server:1.3.1 2ã€è¿è¡Œå¹¶åˆ›å»ºå®¹å™¨docker run --name nacosName -e MODE=standalone -d -v /mnt/logs/nacos:/home/logs/nacos -p 8848:8848 nacos/nacos-server:1.1.4 -d åå°è¿è¡Œ -p å¤–éƒ¨è®¿é—®ç«¯å£:å†…éƒ¨è¢«æ˜ å°„ç«¯å£ Dockerç›¸å¯¹äºè™šæ‹Ÿæœº å¤–éƒ¨è®¿é—®ç«¯å£å°±æ˜¯ å¤–ç½‘è®¿é—®çš„ç«¯å£ å†…éƒ¨è¢«æ˜ å°„ç«¯å£å°±æ˜¯ è¯¥é•œåƒåœ¨dockeré‡Œé¢çš„ç«¯å£ â€“name å®¹å™¨çš„åç§° é•œåƒåç§°ï¼šç‰ˆæœ¬å· nacos/nacos-server:1.3.1 ï¼ˆè¿è¡Œè¯¥é•œåƒï¼‰ -e ç¯å¢ƒå˜é‡è®¾ç½® -e MODE=standalone -v æ˜ å°„åˆ°centosä¸Šçš„æŸä¸ªç›®å½•:é…ç½®æŸä¸ªå®¹å™¨çš„ç›®å½• -v /mnt/logs/nacos:/home/logs/nacos 3ã€æŸ¥çœ‹å¯åŠ¨æ—¥å¿— #æŸ¥çœ‹å·²ç»å¯åŠ¨çš„å®¹å™¨ è·å–å®¹å™¨ID docker ps #æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„è¾“å‡ºæ—¥å¿— docker logs --since 10m nacosçš„å®¹å™¨id #æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„è¾“å‡ºæ—¥å¿— 4ã€è®¿é—®http://lhttp://localhost:8848/nacos ç™»å½•è´¦å· ç™»å½•å¯†ç  nacos nacos ä¸‰ã€Nacosï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰1ã€åŸºäºNacosç”Ÿäº§è€…1ã€å»ºmodelcloudalibaba-provider-payment9001 2ã€pom1ã€çˆ¶pom &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;2.1.0.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; 2ã€æœ¬æ¨¡å—pom &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-provider-payment9001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 9001 spring: application: name: nacos-payment-provider cloud: nacos: discovery: server-addr: 101.34.180.133:8848 #é…ç½®Nacosåœ°å€ management: endpoints: web: exposure: include: '*' 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @EnableDiscoveryClient @SpringBootApplication public class PaymentMain9001 { public static void main(String[] args) { SpringApplication.run (PaymentMain9001.class, args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; @RestController public class PaymentController { @Value(\"${server.port}\") private String serverPort; @GetMapping(value = \"/payment/nacos/{id}\") public String getPayment(@PathVariable(\"id\") Integer id) { return \"nacos registry, serverPort: \" + serverPort + \"\\t id\" + id; } } 6ã€æµ‹è¯•1ã€è®¿é—®ï¼šhttp://localhost:9001/payment/nacos/1 2ã€nacoså®¢æˆ·ç«¯ 7ã€æ˜ å°„å‡ºä¸€æ¨¡ä¸€æ ·çš„9002ï¼Œæµ‹è¯•è´Ÿè½½1ã€å¤åˆ¶é…ç½® 2ã€ç¼–å†™é…ç½® -DServer.port=9002 3ã€æŸ¥çœ‹æ˜¯å¦æˆåŠŸå¯åŠ¨ 2ã€åŸºäºNacosæ¶ˆè´¹è€…1ã€å»ºmodelcloudalibaba-consumer-nacos-order83 2ã€pomä¸ºä»€ä¹ˆnacosæ”¯æŒè´Ÿè½½å‡è¡¡ &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-consumer-nacos-order83&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud ailibaba nacos --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 83 spring: application: name: nacos-order-consumer cloud: nacos: discovery: server-addr: 101.34.180.133:8848 #é…ç½®Nacosåœ°å€ #æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…) service-url: nacos-user-service: http://nacos-payment-provider 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @EnableDiscoveryClient @SpringBootApplication public class OrderNacosMain83 { public static void main(String[] args) { SpringApplication.run(OrderNacosMain83.class,args); } } 5ã€ä¸šåŠ¡ç±»ApplicationContextBeanï¼š package com.kk.springcloud.config; import org.springframework.cloud.client.loadbalancer.LoadBalanced; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.web.client.RestTemplate; @Configuration public class ApplicationContextBean { @Bean @LoadBalanced public RestTemplate getRestTempe() { return new RestTemplate ( ); } } OrderNacosControllerï¼š package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; @RestController public class OrderNacosController { @Resource private RestTemplate restTemplate; @Value(\"${service-url.nacos-user-service}\") private String serverURL; @GetMapping(\"/consumer/payment/nacos/{id}\") public String paymentInfo(@PathVariable(\"id\") Long id) { return restTemplate.getForObject (serverURL + \"/payment/nacos/\" + id, String.class); } } 6ã€æµ‹è¯•1ã€å®¢æˆ·ç«¯æ³¨å†Œ 2ã€è®¿é—®ï¼šhttp://localhost:83/consumer/payment/nacos/13 1,2,1,2,1,2 åˆ‡æ¢æ•ˆæœå­˜åœ¨ 3ã€æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”1ã€nacoså…¨æ™¯å›¾ 2ã€Nacoså’ŒCAP 3ã€Nacos æ”¯æŒAPå’ŒCPæ¨¡å¼çš„åˆ‡æ¢Cæ˜¯æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼›è€ŒAçš„å®šä¹‰æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šæ”¶åˆ°å“åº”ã€‚ ä½•æ—¶é€‰æ‹©ä½¿ç”¨ä½•ç§æ¨¡å¼ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸éœ€è¦å­˜å‚¨æœåŠ¡çº§åˆ«çš„ä¿¡æ¯ä¸”æœåŠ¡å®ä¾‹æ˜¯é€šè¿‡nacos-clientæ³¨å†Œï¼Œå¹¶èƒ½å¤Ÿä¿æŒå¿ƒè·³ä¸ŠæŠ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©APæ¨¡å¼ã€‚å½“å‰ä¸»æµçš„æœåŠ¡å¦‚ Spring cloud å’Œ Dubbo æœåŠ¡ï¼Œéƒ½é€‚ç”¨äºAPæ¨¡å¼ï¼ŒAPæ¨¡å¼ä¸ºäº†æœåŠ¡çš„å¯èƒ½æ€§è€Œå‡å¼±äº†ä¸€è‡´æ€§ï¼Œå› æ­¤APæ¨¡å¼ä¸‹åªæ”¯æŒæ³¨å†Œä¸´æ—¶å®ä¾‹ã€‚ å¦‚æœéœ€è¦åœ¨æœåŠ¡çº§åˆ«ç¼–è¾‘æˆ–è€…å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆ CP æ˜¯å¿…é¡»ï¼ŒK8SæœåŠ¡å’ŒDNSæœåŠ¡åˆ™é€‚ç”¨äºCPæ¨¡å¼ã€‚CPæ¨¡å¼ä¸‹åˆ™æ”¯æŒæ³¨å†ŒæŒä¹…åŒ–å®ä¾‹ï¼Œæ­¤æ—¶åˆ™æ˜¯ä»¥ Raft åè®®ä¸ºé›†ç¾¤è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹æ³¨å†Œå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ³¨å†ŒæœåŠ¡ï¼Œå¦‚æœæœåŠ¡ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ã€‚ curl -X PUT â€˜$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=serverMode&amp;value=CPâ€™ å››ã€Nacosï¼ˆé…ç½®ä¸­å¿ƒï¼‰1ã€å»ºmodel1ã€å»ºmodelcloudalibaba-config-nacos-client3377 2ã€pom&lt;!--nacos-config--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloudalibaba-config-nacos-client3377&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--nacos-config--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--nacos-discovery--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--web + actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€yml1ã€whyé…ç½®ä¸¤ä¸ªspringbootä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œbootstrapä¼˜å…ˆçº§é«˜äºapplication 2ã€bootstrap.ymlfile-extension: yaml #æŒ‡å®šyamlæ ¼å¼çš„é…ç½® # nacosé…ç½® server: port: 3377 spring: application: name: nacos-config-client cloud: nacos: discovery: server-addr: localhost:8848 #NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€ config: server-addr: localhost:8848 #Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€ file-extension: yaml #æŒ‡å®šyamlæ ¼å¼çš„é…ç½® 3ã€application.ymlspring: profiles: active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @EnableDiscoveryClient @SpringBootApplication public class NacosConfigClientMain3377 { public static void main(String[] args) { SpringApplication.run (NacosConfigClientMain3377.class, args); } } 5ã€ä¸šåŠ¡ç±»@RefreshScope package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.cloud.context.config.annotation.RefreshScope; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController @RefreshScope //åœ¨æ§åˆ¶å™¨ç±»åŠ å…¥@RefreshScopeæ³¨è§£ä½¿å½“å‰ç±»ä¸‹çš„é…ç½®æ”¯æŒNacosçš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ã€‚ public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/config/info\") public String getConfigInfo() { return configInfo; } } 2ã€é…ç½®ä¸­å¿ƒåŸºç¡€1ã€è§„åˆ™${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension} 2ã€æ–°å¢é…ç½®æ–‡ä»¶ nacos-config-client-dev.yaml config: info: nacos to info 3ã€å¯¹åº”é…ç½®è¯´æ˜ prefix é»˜è®¤ä¸º spring.application.name çš„å€¼ spring.profile.active å³ä¸ºå½“å‰ç¯å¢ƒå¯¹åº”çš„ profileï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.profile.active æ¥é…ç½®ã€‚ file-exetension ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ spring.cloud.nacos.config.file-extension æ¥é…ç½® 4ã€å†å²é…ç½®ï¼ˆå›æ»šï¼‰Nacosä¼šè®°å½•é…ç½®æ–‡ä»¶çš„å†å²ç‰ˆæœ¬é»˜è®¤ä¿ç•™30å¤©ï¼Œæ­¤å¤–è¿˜æœ‰ä¸€é”®å›æ»šåŠŸèƒ½ï¼Œå›æ»šæ“ä½œå°†ä¼šè§¦å‘é…ç½®æ›´æ–° nacos-config-client-dev.yaml DEFAULT_GROUP 3ã€æµ‹è¯• å¯åŠ¨ 3377 è®¿é—®ï¼šhttp://localhost:3377/config/info æµ‹è¯•è‡ªå¸¦åˆ·æ–°åŠŸèƒ½ ä¿®æ”¹ä¸‹Nacosä¸­çš„yamlé…ç½®æ–‡ä»¶ï¼Œå†æ¬¡è°ƒç”¨æŸ¥çœ‹é…ç½®çš„æ¥å£ï¼Œå°±ä¼šå‘ç°é…ç½®å·²ç»åˆ·æ–° 4ã€é…ç½®ä¸­å¿ƒåˆ†ç±»1ã€Nacosçš„å›¾å½¢åŒ–ç®¡ç†ç•Œé¢1ã€é…ç½®ç®¡ç† 2ã€åç§°ç©ºé—´ 3ã€ä¸‰ç§æ–¹æ¡ˆåŠ è½½é…ç½®1ã€DataIDæ–¹æ¡ˆï¼ˆ1ï¼‰è¯´æ˜ æŒ‡å®šspring.profile.activeå’Œé…ç½®æ–‡ä»¶çš„DataIDæ¥ä½¿ä¸åŒç¯å¢ƒä¸‹è¯»å–ä¸åŒçš„é…ç½® ï¼ˆ2ï¼‰æ–°å»ºä¸¤ä¸ªé…ç½® ï¼ˆ3ï¼‰é…ç½®æ˜¯ä»€ä¹ˆå°±åŠ è½½ä»€ä¹ˆ 2ã€Groupæ–¹æ¡ˆï¼ˆ1ï¼‰è¯´æ˜ é€šè¿‡Groupå®ç°ç¯å¢ƒåŒºåˆ† ï¼ˆ2ï¼‰æ–°å»ºç»„ ï¼ˆ3ï¼‰æ§åˆ¶å°ä¸Šçš„æ•ˆæœ ï¼ˆ4ï¼‰Springbootä¸Šçš„é…ç½® åœ¨configä¸‹å¢åŠ ä¸€æ¡groupçš„é…ç½®å³å¯ã€‚å¯é…ç½®ä¸ºDEV_GROUPæˆ–TEST_GROUP 3ã€Namespaceæ–¹æ¡ˆï¼ˆ1ï¼‰æ–°å»ºdev/testçš„Namespace ï¼ˆ2ï¼‰å›åˆ°æœåŠ¡ç®¡ç†-æœåŠ¡åˆ—è¡¨æŸ¥çœ‹ ï¼ˆ3ï¼‰æŒ‰ç…§åŸŸåé…ç½®å¡«å†™ ï¼ˆ4ï¼‰ymlé…ç½®æ–‡ä»¶ application.yml bootstrap.yml äº”ã€â˜… Nacosï¼ˆé›†ç¾¤å’ŒæŒä¹…åŒ–ï¼‰1ã€åŸºæœ¬è¯´æ˜1ã€æ¶æ„å›¾ 2ã€å®˜æ–¹ä¿¡æ¯ 2ã€NacosæŒä¹…åŒ–é…ç½®è§£é‡Š1ã€Nacosé»˜è®¤è‡ªå¸¦çš„æ˜¯åµŒå…¥å¼æ•°æ®åº“derby2ã€derbyåˆ‡æ¢åˆ°mysql æ­¥éª¤ï¼ˆ1ï¼‰è¿›å…¥å®¹å™¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„é…ç½®æ–‡ä»¶ ï¼ˆ2ï¼‰åœ¨æ•°æ®åº“æ‰§è¡Œä»¥ä¸Š sql schema.sql CREATE DATABASE nacos_config; USE nacos_config; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = config_info */ /******************************************/ CREATE TABLE `config_info` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'id', `data_id` VARCHAR(255) NOT NULL COMMENT 'data_id', `group_id` VARCHAR(255) DEFAULT NULL, `content` LONGTEXT NOT NULL COMMENT 'content', `md5` VARCHAR(32) DEFAULT NULL COMMENT 'md5', `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'ä¿®æ”¹æ—¶é—´', `src_user` TEXT COMMENT 'source user', `src_ip` VARCHAR(20) DEFAULT NULL COMMENT 'source ip', `app_name` VARCHAR(128) DEFAULT NULL, `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'ç§Ÿæˆ·å­—æ®µ', `c_desc` VARCHAR(256) DEFAULT NULL, `c_use` VARCHAR(64) DEFAULT NULL, `effect` VARCHAR(64) DEFAULT NULL, `type` VARCHAR(64) DEFAULT NULL, `c_schema` TEXT, PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = config_info_aggr */ /******************************************/ CREATE TABLE `config_info_aggr` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'id', `data_id` VARCHAR(255) NOT NULL COMMENT 'data_id', `group_id` VARCHAR(255) NOT NULL COMMENT 'group_id', `datum_id` VARCHAR(255) NOT NULL COMMENT 'datum_id', `content` LONGTEXT NOT NULL COMMENT 'å†…å®¹', `gmt_modified` DATETIME NOT NULL COMMENT 'ä¿®æ”¹æ—¶é—´', `app_name` VARCHAR(128) DEFAULT NULL, `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'ç§Ÿæˆ·å­—æ®µ', PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='å¢åŠ ç§Ÿæˆ·å­—æ®µ'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = config_info_beta */ /******************************************/ CREATE TABLE `config_info_beta` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'id', `data_id` VARCHAR(255) NOT NULL COMMENT 'data_id', `group_id` VARCHAR(128) NOT NULL COMMENT 'group_id', `app_name` VARCHAR(128) DEFAULT NULL COMMENT 'app_name', `content` LONGTEXT NOT NULL COMMENT 'content', `beta_ips` VARCHAR(1024) DEFAULT NULL COMMENT 'betaIps', `md5` VARCHAR(32) DEFAULT NULL COMMENT 'md5', `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'ä¿®æ”¹æ—¶é—´', `src_user` TEXT COMMENT 'source user', `src_ip` VARCHAR(20) DEFAULT NULL COMMENT 'source ip', `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'ç§Ÿæˆ·å­—æ®µ', PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_beta'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = config_info_tag */ /******************************************/ CREATE TABLE `config_info_tag` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'id', `data_id` VARCHAR(255) NOT NULL COMMENT 'data_id', `group_id` VARCHAR(128) NOT NULL COMMENT 'group_id', `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'tenant_id', `tag_id` VARCHAR(128) NOT NULL COMMENT 'tag_id', `app_name` VARCHAR(128) DEFAULT NULL COMMENT 'app_name', `content` LONGTEXT NOT NULL COMMENT 'content', `md5` VARCHAR(32) DEFAULT NULL COMMENT 'md5', `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'ä¿®æ”¹æ—¶é—´', `src_user` TEXT COMMENT 'source user', `src_ip` VARCHAR(20) DEFAULT NULL COMMENT 'source ip', PRIMARY KEY (`id`), UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_tag'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = config_tags_relation */ /******************************************/ CREATE TABLE `config_tags_relation` ( `id` BIGINT(20) NOT NULL COMMENT 'id', `tag_name` VARCHAR(128) NOT NULL COMMENT 'tag_name', `tag_type` VARCHAR(64) DEFAULT NULL COMMENT 'tag_type', `data_id` VARCHAR(255) NOT NULL COMMENT 'data_id', `group_id` VARCHAR(128) NOT NULL COMMENT 'group_id', `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'tenant_id', `nid` BIGINT(20) NOT NULL AUTO_INCREMENT, PRIMARY KEY (`nid`), UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`), KEY `idx_tenant_id` (`tenant_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_tag_relation'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = group_capacity */ /******************************************/ CREATE TABLE `group_capacity` ( `id` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID', `group_id` VARCHAR(128) NOT NULL DEFAULT '' COMMENT 'Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤', `quota` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `usage` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'ä½¿ç”¨é‡', `max_size` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `max_aggr_count` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `max_aggr_size` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `max_history_count` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'æœ€å¤§å˜æ›´å†å²æ•°é‡', `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'ä¿®æ”¹æ—¶é—´', PRIMARY KEY (`id`), UNIQUE KEY `uk_group_id` (`group_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨'; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = his_config_info */ /******************************************/ CREATE TABLE `his_config_info` ( `id` BIGINT(64) UNSIGNED NOT NULL, `nid` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT, `data_id` VARCHAR(255) NOT NULL, `group_id` VARCHAR(128) NOT NULL, `app_name` VARCHAR(128) DEFAULT NULL COMMENT 'app_name', `content` LONGTEXT NOT NULL, `md5` VARCHAR(32) DEFAULT NULL, `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00', `src_user` TEXT, `src_ip` VARCHAR(20) DEFAULT NULL, `op_type` CHAR(10) DEFAULT NULL, `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'ç§Ÿæˆ·å­—æ®µ', PRIMARY KEY (`nid`), KEY `idx_gmt_create` (`gmt_create`), KEY `idx_gmt_modified` (`gmt_modified`), KEY `idx_did` (`data_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='å¤šç§Ÿæˆ·æ”¹é€ '; /******************************************/ /* æ•°æ®åº“å…¨å = nacos_config */ /* è¡¨åç§° = tenant_capacity */ /******************************************/ CREATE TABLE `tenant_capacity` ( `id` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID', `tenant_id` VARCHAR(128) NOT NULL DEFAULT '' COMMENT 'Tenant ID', `quota` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'é…é¢ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `usage` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'ä½¿ç”¨é‡', `max_size` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `max_aggr_count` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°', `max_aggr_size` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ0è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼', `max_history_count` INT(10) UNSIGNED NOT NULL DEFAULT '0' COMMENT 'æœ€å¤§å˜æ›´å†å²æ•°é‡', `gmt_create` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` DATETIME NOT NULL DEFAULT '2010-05-05 00:00:00' COMMENT 'ä¿®æ”¹æ—¶é—´', PRIMARY KEY (`id`), UNIQUE KEY `uk_tenant_id` (`tenant_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨'; CREATE TABLE `tenant_info` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'id', `kp` VARCHAR(128) NOT NULL COMMENT 'kp', `tenant_id` VARCHAR(128) DEFAULT '' COMMENT 'tenant_id', `tenant_name` VARCHAR(128) DEFAULT '' COMMENT 'tenant_name', `tenant_desc` VARCHAR(256) DEFAULT NULL COMMENT 'tenant_desc', `create_source` VARCHAR(32) DEFAULT NULL COMMENT 'create_source', `gmt_create` BIGINT(20) NOT NULL COMMENT 'åˆ›å»ºæ—¶é—´', `gmt_modified` BIGINT(20) NOT NULL COMMENT 'ä¿®æ”¹æ—¶é—´', PRIMARY KEY (`id`), UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`), KEY `idx_tenant_id` (`tenant_id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='tenant_info'; CREATE TABLE users ( username VARCHAR(50) NOT NULL PRIMARY KEY, PASSWORD VARCHAR(500) NOT NULL, enabled BOOLEAN NOT NULL ); CREATE TABLE roles ( username VARCHAR(50) NOT NULL, role VARCHAR(50) NOT NULL ); INSERT INTO users (username, PASSWORD, enabled) VALUES ('nacos', '$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu', TRUE); INSERT INTO roles (username, role) VALUES ('nacos', 'ROLE_ADMIN'); ï¼ˆ3ï¼‰åœ¨ application.propertiesä¿®æ”¹é…ç½® ä»¥ä¸Š äº”ä¸ªé…ç½®å‡è¦ä¿®æ”¹ ï¼ˆ4ï¼‰æ”¹å®Œä¹‹åé‡å¯ ï¼ˆ5ï¼‰é‡æ–°ç™»å½•å®¢æˆ·ç«¯ï¼Œå‘ç°ä»¥å‰çš„æ•°æ®æ²¡æœ‰äº†ï¼Œè¯´æ˜åˆ‡æ¢æˆåŠŸ 3ã€é«˜å¯ç”¨é›†ç¾¤æ­å»º1ã€æ¶æ„å›¾ æœ€ç»ˆè½åœ°ï¼šNacos é«˜å¯ç”¨é›†ç¾¤ï¼ˆdocker-composeï¼‰å‚è€ƒæ–‡ç« https://www.jianshu.com/p/d2c81d647323 https://blog.csdn.net/wwwwwww31311/article/details/113066637 https://www.cnblogs.com/hellxz/p/nacos-cluster-docker.html","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"æœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"æœåŠ¡æ³¨å†Œä¸å‘ç°","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"},{"name":"é…ç½®ä¸­å¿ƒ","slug":"é…ç½®ä¸­å¿ƒ","permalink":"https://mykkto.github.io/tags/%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"},{"name":"nacos","slug":"nacos","permalink":"https://mykkto.github.io/tags/nacos/"}],"author":"mykk"},{"title":"SpringCloud-Sleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è·Ÿè¸ª","slug":"03javaDistributed/01springcloud/13_SpringCloud-Sleuth","date":"2022-02-21T18:22:22.000Z","updated":"2022-02-22T12:02:54.409Z","comments":true,"path":"posts/35c50dd0.html","link":"","permalink":"https://mykkto.github.io/posts/35c50dd0.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€ä¸ºä»€ä¹ˆå‡ºç°â€‹ åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„çš„æœåŠ¡èŠ‚ç‚¹è°ƒç”¨æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œæ¯ä¸€ä¸ªå‰æ®µè¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯ï¼Œé“¾è·¯ä¸­çš„ä»»ä½•ä¸€ç¯å‡ºç°é«˜å»¶æ—¶æˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·æ•´ä¸ªè¯·æ±‚æœ€åçš„å¤±è´¥ã€‚ 2ã€æ˜¯ä»€ä¹ˆ1ã€å®˜ç½‘https://github.com/spring-cloud/spring-cloud-sleuth 2ã€è¯´æ˜Spring Cloud Sleuthæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æä¾›è¿½è¸ªè§£å†³æ–¹æ¡ˆå¹¶ä¸”å…¼å®¹æ”¯æŒäº†zipkin 2ã€æ­å»ºé“¾è·¯ç›‘æ§æ­¥éª¤1ã€zipkin1ã€ä¸‹è½½ SpringCloudä»Fç‰ˆèµ·å·²ä¸éœ€è¦è‡ªå·±æ„å»ºZipkin Serveräº†ï¼Œåªéœ€è°ƒç”¨jaråŒ…å³å¯ https://repo1.maven.org/maven2/io/zipkin/java/zipkin-server/ zipkin-server-2.12.9-exec.jar 2ã€è¿è¡Œ jarjava -jar zipkin-server-2.12.9-exec.jar 3ã€è¿è¡Œæ§åˆ¶å° 3ã€æœåŠ¡ç”Ÿäº§è€…1ã€å»ºmodelcloud-provider-sleuth8001 2ã€pom&lt;!--åŒ…å«äº†sleuth+zipkin--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-provider-sleuth8001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--åŒ…å«äº†sleuth+zipkin--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--eureka-client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt;&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt; &lt;/dependency&gt; &lt;!--mysql-connector-java--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--jdbc--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€yml server: port: 8001 spring: application: name: cloud-payment-service zipkin: base-url: http://106.52.23.202:9411 sleuth: sampler: #é‡‡æ ·ç‡å€¼ä»‹äº 0 åˆ° 1 ä¹‹é—´ï¼Œ1 åˆ™è¡¨ç¤ºå…¨éƒ¨é‡‡é›† probability: 1 datasource: type: com.alibaba.druid.pool.DruidDataSource # å½“å‰æ•°æ®æºæ“ä½œç±»å‹ driver-class-name: org.gjt.mm.mysql.Driver # mysqlé©±åŠ¨åŒ… url: jdbc:mysql://101.34.180.133:3306/spring_cloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false username: root password: a1b2c3 eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka # é›†ç¾¤ç‰ˆ defaultZone: http://localhost:7001/eureka # å•æœºç‰ˆ instance: instance-id: payment8001 #è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºIPåœ°å€ prefer-ip-address: true #Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯30ç§’) lease-renewal-interval-in-seconds: 1 #EurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯90ç§’)ï¼Œè¶…æ—¶å°†å‰”é™¤æœåŠ¡ lease-expiration-duration-in-seconds: 2 mybatis: mapperLocations: classpath:mapper/*.xml type-aliases-package: com.kk.springcloud.entities # æ‰€æœ‰Entityåˆ«åç±»æ‰€åœ¨åŒ… 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication @EnableEurekaClient public class SleuthZipkinMain8001 { public static void main(String[] args) { SpringApplication.run (SleuthZipkinMain8001.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class PromentController { @GetMapping(\"/payment/zipkin\") public String paymentZipkin() { return \"hi ,i'am paymentzipkin server fall backï¼Œwelcome to kk demo ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~\"; } } 4ã€æœåŠ¡æ¶ˆè´¹è€…1ã€å»ºmodelcloud-consumer-order81 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumer-sleuth80&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--åŒ…å«äº†sleuth+zipkin--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt;&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 81 spring: application: name: cloud-order-service zipkin: base-url: http://106.52.23.202:9411 sleuth: sampler: probability: 1 eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ defaultZone: http://eureka7001.com:7001/eureka 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; import org.springframework.context.annotation.Bean; import org.springframework.web.client.RestTemplate; @SpringBootApplication @EnableEurekaClient public class ConsumerSleuthMain81 { public static void main(String[] args) { SpringApplication.run (ConsumerSleuthMain80.class,args); } @Bean public RestTemplate restTemplate() { return new RestTemplate(); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; @RestController public class ConsumerController { public static final String PAYMENT_URL = \"http://CLOUD-PAYMENT-SERVICE\"; @Resource private RestTemplate restTemplate; // ====================&gt; zipkin+sleuth @GetMapping(\"/consumer/payment/zipkin\") public String paymentZipkin() { String result = restTemplate.getForObject (PAYMENT_URL + \"/payment/zipkin/\", String.class); return result; } } 5ã€æµ‹è¯•1ã€è®¿é—® http://localhost:81/consumer/payment/zipkin 2ã€æ‰“å¼€ zipkinå®¢æˆ·ç«¯ http://106.52.23.202:9411/","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æœåŠ¡è·Ÿè¸ª","slug":"æœåŠ¡è·Ÿè¸ª","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E8%B7%9F%E8%B8%AA/"},{"name":"sleuth","slug":"sleuth","permalink":"https://mykkto.github.io/tags/sleuth/"}],"author":"mykk"},{"title":"SpringCloud-Streamæ¶ˆæ¯é©±åŠ¨","slug":"03javaDistributed/01springcloud/12_SpringCloud-Stream","date":"2022-02-19T14:52:16.000Z","updated":"2022-02-21T15:47:07.124Z","comments":true,"path":"posts/e867710e.html","link":"","permalink":"https://mykkto.github.io/posts/e867710e.html","excerpt":"","text":"å‹æƒ…é“¾æ¥rabitMQå®‰è£…ï¼ˆdockerï¼‰ 1ã€æ¶ˆæ¯é©±åŠ¨æ¦‚è¿°1ã€æ˜¯ä»€ä¹ˆå±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚,é™ä½åˆ‡æ¢æˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ å®˜ç½‘ï¼šhttps://m.wang1314.com/doc/webapp/topic/20971999.html 2ã€è®¾è®¡æ€æƒ³1ã€æ ‡å‡†MQ Messageï¼šç”Ÿäº§è€…/æ¶ˆè´¹è€…ä¹‹é—´é æ¶ˆæ¯åª’ä»‹ä¼ é€’ä¿¡æ¯å†…å®¹ MessageChannelï¼ˆæ¶ˆæ¯é€šé“ï¼‰ï¼šæ¶ˆæ¯å¿…é¡»èµ°ç‰¹å®šçš„é€šé“ æ¶ˆæ¯é€šé“é‡Œçš„æ¶ˆæ¯å¦‚ä½•è¢«æ¶ˆè´¹å‘¢ï¼Œè°è´Ÿè´£æ”¶å‘å¤„ç† æ¶ˆæ¯é€šé“MessageChannelçš„å­æ¥å£SubscribableChannelï¼Œç”±MessageHandleræ¶ˆæ¯å¤„ç†å™¨æ‰€è®¢é˜… 2ã€ä¸ºä»€ä¹ˆç”¨Cloud Stream1ã€æ¦‚å¿µæ¯”æ–¹è¯´æˆ‘ä»¬ç”¨åˆ°äº†RabbitMQå’ŒKafkaï¼Œç”±äºè¿™ä¸¤ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶çš„æ¶æ„ä¸Šçš„ä¸åŒï¼ŒåƒRabbitMQæœ‰exchangeï¼Œkafkaæœ‰Topicå’ŒPartitionsåˆ†åŒºï¼Œ è¿™äº›ä¸­é—´ä»¶çš„å·®å¼‚æ€§å¯¼è‡´æˆ‘ä»¬å®é™…é¡¹ç›®å¼€å‘ç»™æˆ‘ä»¬é€ æˆäº†ä¸€å®šçš„å›°æ‰°ï¼Œæˆ‘ä»¬å¦‚æœç”¨äº†ä¸¤ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„å…¶ä¸­ä¸€ç§ï¼Œåé¢çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘æƒ³å¾€å¦å¤–ä¸€ç§æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œè¿ç§»ï¼Œè¿™æ—¶å€™æ— ç–‘å°±æ˜¯ä¸€ä¸ªç¾éš¾æ€§çš„ï¼Œä¸€å¤§å †ä¸œè¥¿éƒ½è¦é‡æ–°æ¨å€’é‡æ–°åšï¼Œå› ä¸ºå®ƒè·Ÿæˆ‘ä»¬çš„ç³»ç»Ÿè€¦åˆäº†ï¼Œè¿™æ—¶å€™springcloud Streamç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§è§£è€¦åˆçš„æ–¹å¼ã€‚ 2ã€Streamä¸­çš„æ¶ˆæ¯é€šä¿¡æ–¹å¼éµå¾ªäº†å‘å¸ƒ-è®¢é˜…æ¨¡å¼Topicä¸»é¢˜è¿›è¡Œå¹¿æ’­ï¼š åœ¨RabbitMQå°±æ˜¯Exchange åœ¨Kakfaä¸­å°±æ˜¯Topic 3ã€Spring Cloud Streamæ ‡å‡†æµç¨‹å¥—è·¯ Binderï¼š å¾ˆæ–¹ä¾¿çš„è¿æ¥ä¸­é—´ä»¶ï¼Œå±è”½å·®å¼‚ Channelï¼š é€šé“ï¼Œæ˜¯é˜Ÿåˆ—Queueçš„ä¸€ç§æŠ½è±¡ï¼Œåœ¨æ¶ˆæ¯é€šè®¯ç³»ç»Ÿä¸­å°±æ˜¯å®ç°å­˜å‚¨å’Œè½¬å‘çš„åª’ä»‹ï¼Œé€šè¿‡Channelå¯¹é˜Ÿåˆ—è¿›è¡Œé…ç½® Sourceå’ŒSinkï¼š ç®€å•çš„å¯ç†è§£ä¸ºå‚ç…§å¯¹è±¡æ˜¯Spring Cloud Streamè‡ªèº«ï¼Œä»Streamå‘å¸ƒæ¶ˆæ¯å°±æ˜¯è¾“å‡ºï¼Œæ¥å—æ¶ˆæ¯å°±æ˜¯è¾“å…¥ 4ã€ç¼–ç APIå’Œå¸¸ç”¨æ³¨è§£ 2ã€æ¡ˆä¾‹è¯´æ˜å·¥ç¨‹ä¸­æ–°å»ºä¸‰ä¸ªå­æ¨¡å— cloud-stream-rabbitmq-provider8801ï¼Œ ä½œä¸ºç”Ÿäº§è€…è¿›è¡Œå‘æ¶ˆæ¯æ¨¡å— cloud-stream-rabbitmq-consumer8802ï¼Œä½œä¸ºæ¶ˆæ¯æ¥æ”¶æ¨¡å— cloud-stream-rabbitmq-consumer8803 ä½œä¸ºæ¶ˆæ¯æ¥æ”¶æ¨¡å— 3ã€æ¶ˆæ¯é©±åŠ¨ä¹‹ç”Ÿäº§è€…1ã€æ–°å»ºModulecloud-stream-rabbitmq-provider8801 2ã€pom&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-stream-rabbitmq-provider8801&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--åŸºç¡€é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlbindings: # æœåŠ¡çš„æ•´åˆå¤„ç† output: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰ content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½® server: port: 8801 spring: application: name: cloud-stream-provider cloud: stream: binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼› defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ type: rabbit # æ¶ˆæ¯ç»„ä»¶ç±»å‹ environment: # è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½® spring: rabbitmq: host: 101.34.180.133 port: 5672 username: guest password: guest bindings: # æœåŠ¡çš„æ•´åˆå¤„ç† output: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰ content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½® eureka: client: # å®¢æˆ·ç«¯è¿›è¡ŒEurekaæ³¨å†Œçš„é…ç½® service-url: defaultZone: http://localhost:7001/eureka instance: lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰ lease-expiration-duration-in-seconds: 5 # å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰ instance-id: send-8801.com # åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§° prefer-ip-address: true # è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class StreamMQMain8801 { public static void main(String[] args) { SpringApplication.run (StreamMQMain8801.class, args); } } 5ã€ä¸šåŠ¡ç±»1ã€æ¥å£package com.kk.springcloud.service; public interface IMessageProvider { String send(); } 2ã€æ¥å£å®ç°package com.kk.springcloud.service.impl; import com.kk.springcloud.service.IMessageProvider; import org.springframework.cloud.stream.annotation.EnableBinding; import org.springframework.cloud.stream.messaging.Source; import org.springframework.messaging.MessageChannel; import org.springframework.integration.support.MessageBuilder; import javax.annotation.Resource; import java.util.UUID; @EnableBinding(Source.class) // å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªæ¶ˆæ¯çš„å‘é€ç®¡é“çš„å®šä¹‰ public class MessageProviderImpl implements IMessageProvider { @Resource private MessageChannel output; // æ¶ˆæ¯çš„å‘é€ç®¡é“ @Override public String send() { String serial = UUID.randomUUID ( ).toString ( ); this.output.send (MessageBuilder.withPayload (serial).build ( )); // åˆ›å»ºå¹¶å‘é€æ¶ˆæ¯ System.out.println (\"***serial: \" + serial); return serial; } } 3ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.service.IMessageProvider; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController public class SendMessageController { @Resource private IMessageProvider messageProvider; @GetMapping(value = \"/sendMessage\") public String sendMessage() { return messageProvider.send ( ); } } 6ã€æµ‹è¯• å¯åŠ¨eurekaï¼Œä»¥åŠrabbitMqï¼Œä»¥åŠ8801 è®¿é—®ï¼šhttp://localhost:8801/sendMessage 4ã€æ¶ˆæ¯é©±åŠ¨ä¹‹æ¶ˆè´¹è€…1ã€æ–°å»ºModulecloud-stream-rabbitmq-consumer8802 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-stream-rabbitmq-consumer8802&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--åŸºç¡€é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 8802 spring: application: name: cloud-stream-consumer cloud: stream: binders: # åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼› defaultRabbit: # è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ type: rabbit # æ¶ˆæ¯ç»„ä»¶ç±»å‹ environment: # è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½® spring: rabbitmq: host: 101.34.180.133 port: 5672 username: guest password: guest bindings: # æœåŠ¡çš„æ•´åˆå¤„ç† input: # è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§° destination: studyExchange # è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰ content-type: application/json # è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºå¯¹è±¡jsonï¼Œå¦‚æœæ˜¯æ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€ binder: defaultRabbit # è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½® eureka: client: # å®¢æˆ·ç«¯è¿›è¡ŒEurekaæ³¨å†Œçš„é…ç½® service-url: defaultZone: http://localhost:7001/eureka instance: lease-renewal-interval-in-seconds: 2 # è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰ lease-expiration-duration-in-seconds: 5 # å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰ instance-id: receive-8802.com # åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§° prefer-ip-address: true # è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class StreamMQMain8802 { public static void main(String[] args) { SpringApplication.run (StreamMQMain8802.class, args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.service; import org.springframework.beans.factory.annotation.Value; import org.springframework.cloud.stream.annotation.EnableBinding; import org.springframework.cloud.stream.annotation.StreamListener; import org.springframework.cloud.stream.messaging.Sink; import org.springframework.messaging.Message; import org.springframework.stereotype.Component; @Component @EnableBinding(Sink.class) public class ReceiveMessageListener { @Value(\"${server.port}\") private String serverPort; @StreamListener(Sink.INPUT) public void input(Message&lt;String&gt; message) { System.out.println (\"æ¶ˆè´¹è€…1å·ï¼Œ-------&gt;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\" + message.getPayload ( ) + \"\\t port: \" + serverPort); } } 6ã€æµ‹è¯•urlï¼šhttp://localhost:8801/sendMessage 5ã€åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–1ã€ä¾ç…§8802ï¼Œcloneå‡ºæ¥ä¸€ä»½è¿è¡Œ8803 cloud-stream-rabbitmq-consumer8803 @SpringBootApplication public class StreamMQMain8803 { public static void main(String[] args) { SpringApplication.run (StreamMQMain8803.class, args); } } - ```java @Component @EnableBinding(Sink.class) public class ReceiveMessageListener { @Value(\"${server.port}\") private String serverPort; @StreamListener(Sink.INPUT) public void input(Message&lt;String&gt; message) { System.out.println (\"æ¶ˆè´¹è€…2å·ï¼Œ-------&gt;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\" + message.getPayload ( ) + \"\\t port: \" + serverPort); } } 2ã€å¯åŠ¨ 3ã€è¿è¡Œåæœ‰ä¸¤ä¸ªé—®é¢˜ æœ‰é‡å¤æ¶ˆè´¹é—®é¢˜ æ¶ˆæ¯æŒä¹…åŒ–é—®é¢˜ 4ã€é‡å¤æ¶ˆè´¹é—®é¢˜ç›®å‰æ˜¯8802/8803åŒæ—¶éƒ½æ”¶åˆ°äº†ï¼Œå­˜åœ¨é‡å¤æ¶ˆè´¹é—®é¢˜ å¦‚ä½•è§£å†³ï¼šåˆ†ç»„å’ŒæŒä¹…åŒ–å±æ€§groupæ¯”å¦‚åœ¨å¦‚ä¸‹åœºæ™¯ä¸­ï¼Œè®¢å•ç³»ç»Ÿæˆ‘ä»¬åšé›†ç¾¤éƒ¨ç½²ï¼Œéƒ½ä¼šä»RabbitMQä¸­è·å–è®¢å•ä¿¡æ¯ï¼Œé‚£å¦‚æœä¸€ä¸ªè®¢å•åŒæ—¶è¢«ä¸¤ä¸ªæœåŠ¡è·å–åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆæ•°æ®é”™è¯¯ï¼Œæˆ‘ä»¬å¾—é¿å…è¿™ç§æƒ…å†µã€‚è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Streamä¸­çš„æ¶ˆæ¯åˆ†ç»„æ¥è§£å†³ æ³¨æ„åœ¨Streamä¸­å¤„äºåŒä¸€ä¸ªgroupä¸­çš„å¤šä¸ªæ¶ˆè´¹è€…æ˜¯ç«äº‰å…³ç³»ï¼Œå°±èƒ½å¤Ÿä¿è¯æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªåº”ç”¨æ¶ˆè´¹ä¸€æ¬¡ã€‚ä¸åŒç»„æ˜¯å¯ä»¥å…¨é¢æ¶ˆè´¹çš„(é‡å¤æ¶ˆè´¹)ï¼Œ åŒä¸€ç»„å†…ä¼šå‘ç”Ÿç«äº‰å…³ç³»ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªå¯ä»¥æ¶ˆè´¹ã€‚ 5ã€åˆ†ç»„1ã€åŸç†å¾®æœåŠ¡åº”ç”¨æ”¾ç½®äºåŒä¸€ä¸ªgroupä¸­ï¼Œå°±èƒ½å¤Ÿä¿è¯æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªåº”ç”¨æ¶ˆè´¹ä¸€æ¬¡ã€‚ä¸åŒçš„ç»„æ˜¯å¯ä»¥æ¶ˆè´¹çš„ï¼ŒåŒä¸€ä¸ªç»„å†…ä¼šå‘ç”Ÿç«äº‰å…³ç³»ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªå¯ä»¥æ¶ˆè´¹ã€‚ 2ã€åˆ’åˆ†ç»„(ä¸åŒç»„) 8802/8803éƒ½å˜æˆä¸åŒç»„ï¼Œgroupä¸¤ä¸ªä¸åŒç»„ï¼ˆkkA,kkBï¼‰ 8802ä¿®æ”¹YML group: kkA 8803ä¿®æ”¹YML group: kkB 3ã€ç»“è®º(ä¸åŒç»„)ä¸åŒç»„çš„è¿˜æ˜¯é‡å¤æ¶ˆè´¹ 4ã€åˆ’åˆ†ç»„(ä¸åŒç»„)ä¸¤è¾¹éƒ½é…ç½®ä¸ºï¼škkA 5ã€ç»“è®º(ä¸åŒç»„)åŒä¸€ä¸ªç»„çš„å¤šä¸ªå¾®æœåŠ¡å®ä¾‹ï¼Œæ¯æ¬¡åªä¼šæœ‰ä¸€ä¸ªæ‹¿åˆ°ã€‚ï¼ˆè§£å†³é‡å¤æ¶ˆè´¹é—®é¢˜ï¼‰ 6ã€æŒä¹…åŒ–ç›®å‰ä¸¤ä¸ªæ¶ˆè´¹è€…8802/8803éƒ½æ˜¯å½’ç±»äº kkAåˆ†ç»„ 1ã€ä¸‹é¢è¦åšçš„æ˜¯å°† 8802åˆ†ç»„é…ç½®æ³¨é‡Š 2ã€å…³é—­8002/8003æœåŠ¡ 3ã€8801å…ˆå‘é€4æ¡æ¶ˆæ¯åˆ°rabbitmq 4ã€å¯åŠ¨8802ï¼ˆæ— åˆ†ç»„ï¼‰ï¼Œæ²¡æœ‰ä»»ä½•æ‰“å° 5ã€å¯åŠ¨8803ï¼ˆæœ‰åˆ†ç»„ï¼‰ï¼Œæ¥æ”¶ç¦»çº¿æ•°æ®","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æ¶ˆæ¯é©±åŠ¨","slug":"æ¶ˆæ¯é©±åŠ¨","permalink":"https://mykkto.github.io/tags/%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/"},{"name":"stream","slug":"stream","permalink":"https://mykkto.github.io/tags/stream/"}],"author":"mykk"},{"title":"SpringCloud-Busåˆ†å¸ƒå¼èŠ‚ç‚¹é“¾æ¥","slug":"03javaDistributed/01springcloud/11_SpringCloud-Bus","date":"2022-02-06T03:49:12.000Z","updated":"2022-02-19T15:18:53.939Z","comments":true,"path":"posts/699f8954.html","link":"","permalink":"https://mykkto.github.io/posts/699f8954.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€æ˜¯ä»€ä¹ˆBusæ”¯æŒä¸¤ç§æ¶ˆæ¯ä»£ç†ï¼šRabbitMQ å’Œ Kafka Spring Cloud Bus é…åˆ Spring Cloud Config ä½¿ç”¨å¯ä»¥å®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°ã€‚ Spring Cloud Busæ˜¯ç”¨æ¥å°†åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹ä¸è½»é‡çº§æ¶ˆæ¯ç³»ç»Ÿé“¾æ¥èµ·æ¥çš„æ¡†æ¶ï¼Œå®ƒæ•´åˆäº†Javaçš„äº‹ä»¶å¤„ç†æœºåˆ¶å’Œæ¶ˆæ¯ä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚ Spring Clud Busç›®å‰æ”¯æŒRabbitMQå’ŒKafkaã€‚ 2ã€èƒ½å¹²å˜›Spring Cloud Busèƒ½ç®¡ç†å’Œä¼ æ’­åˆ†å¸ƒå¼ç³»ç»Ÿé—´çš„æ¶ˆæ¯ï¼Œå°±åƒä¸€ä¸ªåˆ†å¸ƒå¼æ‰§è¡Œå™¨ï¼Œå¯ç”¨äºå¹¿æ’­çŠ¶æ€æ›´æ”¹ã€äº‹ä»¶æ¨é€ç­‰ï¼Œä¹Ÿå¯ä»¥å½“ä½œå¾®æœåŠ¡é—´çš„é€šä¿¡é€šé“ã€‚ 3ã€ä¸ºä½•è¢«ç§°ä¸ºæ€»çº¿ä»€ä¹ˆæ˜¯æ€»çº¿åœ¨å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨è½»é‡çº§çš„æ¶ˆæ¯ä»£ç†æ¥æ„å»ºä¸€ä¸ªå…±ç”¨çš„æ¶ˆæ¯ä¸»é¢˜ï¼Œå¹¶è®©ç³»ç»Ÿä¸­æ‰€æœ‰å¾®æœåŠ¡å®ä¾‹éƒ½è¿æ¥ä¸Šæ¥ã€‚ç”±äºè¯¥ä¸»é¢˜ä¸­äº§ç”Ÿçš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰å®ä¾‹ç›‘å¬å’Œæ¶ˆè´¹ï¼Œæ‰€ä»¥ç§°å®ƒä¸ºæ¶ˆæ¯æ€»çº¿ã€‚åœ¨æ€»çº¿ä¸Šçš„å„ä¸ªå®ä¾‹ï¼Œéƒ½å¯ä»¥æ–¹ä¾¿åœ°å¹¿æ’­ä¸€äº›éœ€è¦è®©å…¶ä»–è¿æ¥åœ¨è¯¥ä¸»é¢˜ä¸Šçš„å®ä¾‹éƒ½çŸ¥é“çš„æ¶ˆæ¯ã€‚ åŸºæœ¬åŸç†ConfigClientå®ä¾‹éƒ½ç›‘å¬MQä¸­åŒä¸€ä¸ªtopic(é»˜è®¤æ˜¯springCloudBus)ã€‚å½“ä¸€ä¸ªæœåŠ¡åˆ·æ–°æ•°æ®çš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªä¿¡æ¯æ”¾å…¥åˆ°Topicä¸­ï¼Œè¿™æ ·å…¶å®ƒç›‘å¬åŒä¸€Topicçš„æœåŠ¡å°±èƒ½å¾—åˆ°é€šçŸ¥ï¼Œç„¶åå»æ›´æ–°è‡ªèº«çš„é…ç½®ã€‚ 2ã€RabbitMQç¯å¢ƒé…ç½®1ã€å®‰è£…å®‰è£…dockerï¼šhttps://www.jianshu.com/p/f554c85b25c1 1ã€æ‹‰å–docker pull rabbitmq:3.7.7-management 2ã€åˆ›å»ºå®¹å™¨å¹¶å¯åŠ¨docker run -d --hostname localhost --name myrabbit -p 15672:15672 -p 5672:5672 rabbitmq:3.7.7-management -d åå°è¿è¡Œå®¹å™¨ï¼› â€“name æŒ‡å®šå®¹å™¨åï¼› -p æŒ‡å®šæœåŠ¡è¿è¡Œçš„ç«¯å£ï¼ˆ5672ï¼šåº”ç”¨è®¿é—®ç«¯å£ï¼›15672ï¼šæ§åˆ¶å°Webç«¯å£å·ï¼‰ï¼› -v æ˜ å°„ç›®å½•æˆ–æ–‡ä»¶ï¼› â€“hostname ä¸»æœºåï¼ˆRabbitMQçš„ä¸€ä¸ªé‡è¦æ³¨æ„äº‹é¡¹æ˜¯å®ƒæ ¹æ®æ‰€è°“çš„ â€œèŠ‚ç‚¹åç§°â€ å­˜å‚¨æ•°æ®ï¼Œé»˜è®¤ä¸ºä¸»æœºåï¼‰ï¼› -e æŒ‡å®šç¯å¢ƒå˜é‡ï¼› é»˜è®¤çš„ç”¨æˆ·åï¼šguestï¼› é»˜è®¤ç”¨æˆ·åçš„å¯†ç ï¼šguestï¼‰ 3ã€è®¿é—®http://localhost:15672/ ï¼ˆæ¢æˆè‡ªå·±æœåŠ¡å™¨çš„IPï¼‰ 3ã€SpringCloud Bus åŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­1ã€æ¼”ç¤ºå¹¿æ’­æ•ˆæœï¼Œå¢åŠ å¤æ‚åº¦ä»¥3355ä¸ºæ¨¡æ¿å†åˆ¶ä½œä¸€ä¸ª3366 1ã€å»ºmodelcloud-config-client-3366 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-config-client-3366-2&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€bootstrap.ymlserver: port: 3366 spring: application: name: config-client cloud: #Configå®¢æˆ·ç«¯é…ç½® config: label: master #åˆ†æ”¯åç§° name: config #é…ç½®æ–‡ä»¶åç§° profile: dev #è¯»å–åç¼€åç§° ä¸Šè¿°3ä¸ªç»¼åˆï¼šmasteråˆ†æ”¯ä¸Šconfig-dev.ymlçš„é…ç½®æ–‡ä»¶è¢«è¯»å–http://config-3344.com:3344/master/config-dev.yml uri: http://localhost:3344 #é…ç½®ä¸­å¿ƒåœ°å€ eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient public class ConfigClientMain3366 { public static void main(String[] args) { SpringApplication.run (ConfigClientMain3366.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.cloud.context.config.annotation.RefreshScope; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController @RefreshScope public class ConfigClientController { @Value(\"${server.port}\") private String serverPort; @Value(\"${mytest.info}\") private String configInfo; @GetMapping(\"/configInfo\") public String configInfo() { return \"serverPort: \" + serverPort + \"\\t\\n\\n configInfo: \" + configInfo; } } 2ã€ç»™cloud-config-center-3344é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ1ã€pom&lt;!--æ·»åŠ æ¶ˆæ¯æ€»çº¿RabbitMQæ”¯æŒ--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bus-amqp&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€yml##rabbitmqç›¸å…³é…ç½®,æš´éœ²busåˆ·æ–°é…ç½®çš„ç«¯ç‚¹ management: endpoints: #æš´éœ²busåˆ·æ–°é…ç½®çš„ç«¯ç‚¹ web: exposure: include: 'bus-refresh' 3ã€ç»™cloud-config-client-3355å®¢æˆ·ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ1ã€pom&lt;!--æ·»åŠ æ¶ˆæ¯æ€»çº¿RabbitMQæ”¯æŒ--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bus-amqp&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€bootstrap.yml#rabbitmqç›¸å…³é…ç½® 15672æ˜¯Webç®¡ç†ç•Œé¢çš„ç«¯å£ï¼›5672æ˜¯MQè®¿é—®çš„ç«¯å£ rabbitmq: host: localhost port: 5672 username: guest password: guest server: port: 3355 spring: application: name: config-client cloud: #Configå®¢æˆ·ç«¯é…ç½® config: label: master #åˆ†æ”¯åç§° name: config #é…ç½®æ–‡ä»¶åç§° profile: dev #è¯»å–åç¼€åç§° ä¸Šè¿°3ä¸ªç»¼åˆï¼šmasteråˆ†æ”¯ä¸Šconfig-dev.ymlçš„é…ç½®æ–‡ä»¶è¢«è¯»å–http://config-3344.com:3344/master/config-dev.yml uri: http://localhost:3344 #é…ç½®ä¸­å¿ƒåœ°å€ #rabbitmqç›¸å…³é…ç½® 15672æ˜¯Webç®¡ç†ç•Œé¢çš„ç«¯å£ï¼›5672æ˜¯MQè®¿é—®çš„ç«¯å£ rabbitmq: host: 106.xx.xx.xx port: 5672 username: guest password: guest eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ # æš´éœ²ç›‘æ§ç«¯ç‚¹ management: endpoints: web: exposure: include: \"*\" 4ã€ç»™cloud-config-client-3366å®¢æˆ·ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒåŒä¸Š5ã€æµ‹è¯•1ã€ä¿®æ”¹Githubä¸Šé…ç½®æ–‡ä»¶å¢åŠ ç‰ˆæœ¬å· 2ã€å‘é€ post è¯·æ±‚curl -X POST \"http://localhost:3344/actuator/bus-refresh 3ã€é…ç½®ä¸­å¿ƒhttp://config-3344.com:3344/config-dev.yml åŒæ­¥æ›´æ–°äº†é…ç½®ä¿¡æ¯ 4ã€å®¢æˆ·ç«¯http://localhost:3355/configInfo å‘ç°å¹¶æ²¡æœ‰æ›´æ–°ï¼Œè¿è¡ŒæŒ‡å®š å®šç‚¹è¯•è¯•ï¼šcurl -X POST \"http://localhost:3355/actuator/bus-refresh è¿è¡Œåå‘ç°å°±æ›´æ–°äº†ï¼Œå¾ˆå¥‡æ€ªå“¦ 5ã€ç»“è®ºä¸€æ¬¡ä¿®æ”¹ï¼Œå¹¿æ’­é€šçŸ¥ï¼Œå¤„å¤„ç”Ÿæ•ˆï¼ˆç›®å‰åªæœ‰æœåŠ¡ç«¯æ˜¯è¿™æ ·çš„ï¼Œå®¢æˆ·ç«¯åªèƒ½æ‰‹åŠ¨ï¼Œé—®é¢˜åŸå› æœªçŸ¥ï¼‰ 4ã€SpringCloud Bus åŠ¨æ€åˆ·æ–°å®šç‚¹(å±€éƒ¨)é€šçŸ¥1ã€æ¦‚å¿µæŒ‡å®šå…·ä½“æŸä¸€ä¸ªå®ä¾‹ç”Ÿæ•ˆè€Œä¸æ˜¯å…¨éƒ¨ 2ã€å…¬å¼http://localhost:é…ç½®ä¸­å¿ƒçš„ç«¯å£å·/actuator/bus-refresh/{destination} /bus/refreshè¯·æ±‚ä¸å†å‘é€åˆ°å…·ä½“çš„æœåŠ¡å®ä¾‹ä¸Šï¼Œè€Œæ˜¯å‘ç»™config serverå¹¶é€šè¿‡destinationå‚æ•°ç±»æŒ‡å®šéœ€è¦æ›´æ–°é…ç½®çš„æœåŠ¡æˆ–å®ä¾‹ 3ã€æ¡ˆä¾‹åªåˆ·æ–° 3355 curl -X POST \"http://localhost:3344/actuator/bus-refresh/config-client:3355\" å‚è€ƒï¼šhttps://blog.csdn.net/haoweng4800/article/details/102946846 https://www.cnblogs.com/huanshilang/p/12585877.html https://www.jianshu.com/p/efac7bd8941f","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"bus","slug":"bus","permalink":"https://mykkto.github.io/tags/bus/"},{"name":"èŠ‚ç‚¹é“¾æ¥","slug":"èŠ‚ç‚¹é“¾æ¥","permalink":"https://mykkto.github.io/tags/%E8%8A%82%E7%82%B9%E9%93%BE%E6%8E%A5/"}],"author":"mykk"},{"title":"SpringCloud-Configåˆ†å¸ƒå¼é…ç½®","slug":"03javaDistributed/01springcloud/10_SpringCloud-Config","date":"2022-02-04T01:33:12.000Z","updated":"2022-02-11T12:43:26.690Z","comments":true,"path":"posts/fc38d8b7.html","link":"","permalink":"https://mykkto.github.io/posts/fc38d8b7.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€å®˜ç½‘https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/ 2ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„â€”é…ç½®é—®é¢˜ å¾®æœåŠ¡æ„å‘³ç€è¦å°†å•ä½“åº”ç”¨ä¸­çš„ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸ªå­æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡çš„ç²’åº¦ç›¸å¯¹è¾ƒå°ï¼Œå› æ­¤ç³»ç»Ÿä¸­ä¼šå‡ºç°å¤§é‡çš„æœåŠ¡ã€‚ç”±äºæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å¿…è¦çš„é…ç½®ä¿¡æ¯æ‰èƒ½è¿è¡Œï¼Œæ‰€ä»¥ä¸€å¥—é›†ä¸­å¼çš„ã€åŠ¨æ€çš„é…ç½®ç®¡ç†è®¾æ–½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ â€‹ SpringCloudæä¾›äº†ConfigServeræ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¯ä¸€ä¸ªå¾®æœåŠ¡è‡ªå·±å¸¦ç€ä¸€ä¸ªapplication.ymlï¼Œä¸Šç™¾ä¸ªé…ç½®æ–‡ä»¶çš„ç®¡ç†ã€‚ 3ã€æ˜¯ä»€ä¹ˆ SpringCloud Configä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒï¼Œé…ç½®æœåŠ¡å™¨ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®ã€‚ 4ã€æ€ä¹ˆç©SpringCloud Configåˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤éƒ¨åˆ†ã€‚ æœåŠ¡ç«¯ä¹Ÿç§°ä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨ï¼Œç”¨æ¥è¿æ¥é…ç½®æœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›è·å–é…ç½®ä¿¡æ¯ï¼ŒåŠ å¯†/è§£å¯†ä¿¡æ¯ç­‰è®¿é—®æ¥å£ å®¢æˆ·ç«¯åˆ™æ˜¯é€šè¿‡æŒ‡å®šçš„é…ç½®ä¸­å¿ƒæ¥ç®¡ç†åº”ç”¨èµ„æºï¼Œä»¥åŠä¸ä¸šåŠ¡ç›¸å…³çš„é…ç½®å†…å®¹ï¼Œå¹¶åœ¨å¯åŠ¨çš„æ—¶å€™ä»é…ç½®ä¸­å¿ƒè·å–å’ŒåŠ è½½é…ç½®ä¿¡æ¯é…ç½®æœåŠ¡å™¨é»˜è®¤é‡‡ç”¨gitæ¥å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·å°±æœ‰åŠ©äºå¯¹ç¯å¢ƒé…ç½®è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡gitå®¢æˆ·ç«¯å·¥å…·æ¥æ–¹ä¾¿çš„ç®¡ç†å’Œè®¿é—®é…ç½®å†…å®¹ã€‚ 5ã€èƒ½å¹²å˜› é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶ ä¸åŒç¯å¢ƒä¸åŒé…ç½®ï¼ŒåŠ¨æ€åŒ–çš„é…ç½®æ›´æ–°ï¼Œåˆ†ç¯å¢ƒéƒ¨ç½²æ¯”å¦‚dev/test/prod/beta/release è¿è¡ŒæœŸé—´åŠ¨æ€è°ƒæ•´é…ç½®ï¼Œä¸å†éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡éƒ¨ç½²çš„æœºå™¨ä¸Šç¼–å†™é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ä¼šå‘é…ç½®ä¸­å¿ƒç»Ÿä¸€æ‹‰å–é…ç½®è‡ªå·±çš„ä¿¡æ¯ å½“é…ç½®å‘ç”Ÿå˜åŠ¨æ—¶ï¼ŒæœåŠ¡ä¸éœ€è¦é‡å¯å³å¯æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–å¹¶åº”ç”¨æ–°çš„é…ç½® å°†é…ç½®ä¿¡æ¯ä»¥RESTæ¥å£çš„å½¢å¼æš´éœ²ï¼Œpostã€curlè®¿é—®åˆ·æ–°å‡å¯â€¦â€¦ 6ã€ä¸GitHubæ•´åˆé…ç½®ç”±äºSpringCloud Configé»˜è®¤ä½¿ç”¨Gitæ¥å­˜å‚¨é…ç½®æ–‡ä»¶(ä¹Ÿæœ‰å…¶å®ƒæ–¹å¼,æ¯”å¦‚æ”¯æŒSVNå’Œæœ¬åœ°æ–‡ä»¶)ï¼Œä½†æœ€æ¨èçš„è¿˜æ˜¯Gitï¼Œè€Œä¸”ä½¿ç”¨çš„æ˜¯http/httpsè®¿é—®çš„å½¢å¼ 2ã€ConfigæœåŠ¡ç«¯é…ç½®1ã€åˆ›å»ºgithubä»“åº“1ã€æ–°å»ºä»“åº“ç”¨ä½ è‡ªå·±çš„è´¦å·åœ¨GitHub/gitee ä¸Šæ–°å»ºä¸€ä¸ªåä¸ºspringcloud-configçš„æ–°Repository 2ã€è·å¾—åˆšæ–°å»ºçš„gitåœ°å€https://gitee.com/TK_LIMR/spring-cloud-config.git 3ã€æœ¬åœ°ç¡¬ç›˜ç›®å½•ä¸Šæ–°å»ºgitä»“åº“å¹¶clonegit clone https://gitee.com/TK_LIMR/spring-cloud-config.git 4ã€ç¼–è¾‘application.ymlç¯å¢ƒ# ä¸åŒçš„å¼€å‘ç¯å¢ƒï¼Œä¸åŒçš„å¾®æœåŠ¡åå­— spring: profiles: active: - dev --- spring: profiles: dev #å¼€å‘ç¯å¢ƒ application: name: microservicecloud-config-kk-dev config: info: version1 --- spring: profiles: test #æµ‹è¯•ç¯å¢ƒ application: name: microservicecloud-config-kk-test # è¯·ä¿å­˜ä¸ºUTF-8æ ¼å¼ 5ã€ä¸Šä¼ åˆ°giteeä¸Šï¼ˆ1ï¼‰git add . ï¼ˆ2ï¼‰git commit -m \"init yml\" ï¼ˆ3ï¼‰git push origin master 2ã€é¡¹ç›®æ­å»º1ã€å»ºmodelæ–°å»ºModuleæ¨¡å—cloud-config-center-3344 2ã€pom&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-config-center-3344&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 3344 spring: application: name: cloud-config-center #æ³¨å†Œè¿›EurekaæœåŠ¡å™¨çš„å¾®æœåŠ¡å cloud: config: server: git: uri: https://gitee.com/TK_LIMR/spring-cloud-config.git #GitHubä¸Šé¢çš„gitä»“åº“åå­— ####æƒé™ç™»å½•(è¿™é‡Œå¡«å†™è‡ªå·±çš„) force-pull: true username: xxxxxxxx@163.com password: xxxxxxxx ####æœç´¢ç›®å½• search-paths: - springcloud-config ####è¯»å–åˆ†æ”¯ label: master #æœåŠ¡æ³¨å†Œåˆ°eurekaåœ°å€ eureka: client: service-url: defaultZone: http://localhost:7001/eureka 4ã€ä¸»å¯åŠ¨@EnableConfigServer package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.config.server.EnableConfigServer; @SpringBootApplication @EnableConfigServer public class ConfigCenterMain3344 { public static void main(String[] args) { SpringApplication.run (ConfigCenterMain3344.class,args); } } 5ã€æœ¬åœ°hostsé…ç½®127.0.0.1 config-3344.com 6ã€å¯åŠ¨æµ‹è¯•ç”Ÿäº§ï¼šhttp://config-3344.com:3344/master/config-prod.yml å¼€å‘ï¼šhttp://config-3344.com:3344/master/config-dev.yml æµ‹è¯•ï¼šhttp://config-3344.com:3344/master/config-test.yml 3ã€é…ç½®è¯»å–è§„åˆ™1ã€å®˜ç½‘ 2ã€/{label}/{application}-{profile}.ymlå‚æ•°è¯´æ˜ï¼š/åˆ†æ”¯/æœåŠ¡å/ç¯å¢ƒ 1ã€masteråˆ†æ”¯http://config-3344.com:3344/master/config-dev.yml http://config-3344.com:3344/master/config-test.yml http://config-3344.com:3344/master/config-prod.yml 2ã€devåˆ†æ”¯http://config-3344.com:3344/dev/config-dev.yml http://config-3344.com:3344/dev/config-test.yml http://config-3344.com:3344/dev/config-prod.yml 3ã€/{application}-{profile}.ymlå‚æ•°è¯´æ˜ï¼š/æœåŠ¡å/ç¯å¢ƒ http://config-3344.com:3344/config-dev.yml http://config-3344.com:3344/config-test.yml http://config-3344.com:3344/config-prod.yml http://config-3344.com:3344/config-xxxx.yml(ä¸å­˜åœ¨çš„é…ç½®) 4ã€/{application}/{profile}[/{label}]å‚æ•°è¯´æ˜ï¼š/æœåŠ¡å/ç¯å¢ƒ/åˆ†æ”¯ http://config-3344.com:3344/config/dev/master http://config-3344.com:3344/config/test/master http://config-3344.com:3344/config/test/dev 5ã€å‚æ•°è¯´æ˜/{label}-{name}-{profiles}.yml labelï¼šåˆ†æ”¯(branch)name ï¼šæœåŠ¡åprofilesï¼šç¯å¢ƒ(dev/test/prod) 3ã€Configå®¢æˆ·ç«¯é…ç½®1ã€å»ºmodelå’Œæµ‹è¯•1ã€å»ºmodelæ–°å»ºcloud-config-client-3355 2ã€pom&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-config-client-3355&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€bootstrap.ymlapplicaiton.yml æ˜¯ç”¨æˆ·çº§çš„èµ„æºé…ç½®é¡¹bootstrap.yml æ˜¯ç³»ç»Ÿçº§çš„ï¼Œä¼˜å…ˆçº§æ›´åŠ é«˜ server: port: 3355 spring: application: name: config-client cloud: #Configå®¢æˆ·ç«¯é…ç½® config: label: master #åˆ†æ”¯åç§° name: config #é…ç½®æ–‡ä»¶åç§° profile: dev #è¯»å–åç¼€åç§° ä¸Šè¿°3ä¸ªç»¼åˆï¼šmasteråˆ†æ”¯ä¸Šconfig-dev.ymlçš„é…ç½®æ–‡ä»¶è¢«è¯»å–http://config-3344.com:3344/master/config-dev.yml uri: http://localhost:3344 #é…ç½®ä¸­å¿ƒåœ°å€ eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient public class ConfigClientMain3355 { public static void main(String[] args) { SpringApplication.run (ConfigClientMain3355.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class ConfigClientController { @Value(\"${config.info}\") private String configInfo; @GetMapping(\"/configInfo\") public String getConfigInfo() { return configInfo; } } 6ã€æµ‹è¯•1ã€å¯åŠ¨Configé…ç½®ä¸­å¿ƒ3344å¾®æœåŠ¡å¹¶è‡ªæµ‹ http://config-3344.com:3344/master/config-prod.yml http://config-3344.com:3344/master/config-dev.yml 2ã€å¯åŠ¨3355ä½œä¸ºClientå‡†å¤‡è®¿é—® http://localhost:3355/configInfo 2ã€åŠ¨æ€åˆ·æ–°é—®é¢˜ Linuxè¿ç»´ä¿®æ”¹GitHubä¸Šçš„é…ç½®æ–‡ä»¶å†…å®¹åšè°ƒæ•´ åˆ·æ–°3344ï¼Œå‘ç°ConfigServeré…ç½®ä¸­å¿ƒç«‹åˆ»å“åº” åˆ·æ–°3355ï¼Œå‘ç°ConfigClientå®¢æˆ·ç«¯æ²¡æœ‰ä»»ä½•å“åº” 3355æ²¡æœ‰å˜åŒ–é™¤éè‡ªå·±é‡å¯æˆ–è€…é‡æ–°åŠ è½½ éš¾åˆ°æ¯æ¬¡è¿ç»´ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯éƒ½éœ€è¦é‡å¯ï¼Ÿï¼Ÿå™©æ¢¦ 4ã€Configå®¢æˆ·ç«¯ä¹‹åŠ¨æ€åˆ·æ–°æ“ä½œ3355æ¨¡å— 1ã€POMå¼•å…¥actuatorç›‘æ§&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€ä¿®æ”¹YMLï¼Œæš´éœ²ç›‘æ§ç«¯å£# æš´éœ²ç›‘æ§ç«¯ç‚¹ management: endpoints: web: exposure: include: \"*\" 3ã€ä¸šåŠ¡ç±»Controllerä¿®æ”¹@RefreshScope package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.cloud.context.config.annotation.RefreshScope; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController @RefreshScope public class ConfigClientController { @Value(\"${spring.application.name}\") private String configInfo; @GetMapping(\"/configInfo\") public String getConfigInfo() { return configInfo; } } 4ã€æ­¤æ—¶ä¿®æ”¹githubâ€”&gt; 3344 â€”-&gt;33551ã€æ·»åŠ ä¸€ä¸ªç‰ˆæœ¬å·ä¸º1 2ã€æ­¤æ—¶çœ‹ä¸‹3344ï¼ˆconfigæœåŠ¡ç«¯ï¼‰ï¼Œæ²¡æœ‰é‡å¯çš„çŠ¶æ€ä¸‹ æ²¡æœ‰æ›´æ–°ï¼ 3ã€æ­¤æ—¶çœ‹ä¸‹3355ï¼ˆconfigå®¢æˆ·ç«¯ï¼‰ï¼Œæ²¡æœ‰é‡å¯çš„çŠ¶æ€ä¸‹ æ²¡æœ‰æ›´æ–°ï¼ 4ã€æ€»ç»“ï¼šæ˜¯ä¸ä¼šæ›´æ–°çš„ 5ã€è§£å†³ï¼šéœ€è¦è¿ç»´äººå‘˜è¿è¡Œè§£å†³ å¿…é¡»æ˜¯POSTè¯·æ±‚ curl -X POST \"http://localhost:3355/actuator/refresh\" 5ã€è¿˜å­˜åœ¨çš„é—®é¢˜ æ¯ä¸ªå¾®æœåŠ¡éƒ½è¦æ‰§è¡Œä¸€æ¬¡postè¯·æ±‚ï¼Œæ‰‹åŠ¨åˆ·æ–°ï¼Ÿ å†™å¾ªç¯ä»£ç è§£å†³ï¼ˆshellè„šæœ¬ï¼‰ å¯å¦å¹¿æ’­ï¼Œä¸€æ¬¡é€šçŸ¥ï¼Œå¤„å¤„ç”Ÿæ•ˆï¼Ÿ é¸¡è‚‹æ‰€åœ¨ å¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„nacos æ›¿æ¢è§£å†³ æ•´åˆSpringCloud-Busè§£å†³","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"é…ç½®ä¸­å¿ƒ","slug":"é…ç½®ä¸­å¿ƒ","permalink":"https://mykkto.github.io/tags/%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"},{"name":"config","slug":"config","permalink":"https://mykkto.github.io/tags/config/"}],"author":"mykk"},{"title":"SpringCloud-Gaywaylè·¯ç”±ç½‘å…³","slug":"03javaDistributed/01springcloud/09_SpringCloud-GateWay","date":"2022-02-02T01:22:13.000Z","updated":"2022-03-12T04:02:33.569Z","comments":true,"path":"posts/d633875f.html","link":"","permalink":"https://mykkto.github.io/posts/d633875f.html","excerpt":"","text":"ä¸€ã€æ¦‚è¿°ç®€ä»‹1ã€å®˜ç½‘1ã€ä¸Šä¸€ä»£zuul 1.Xhttps://github.com/Netflix/zuul/wiki 2ã€Gatewayhttps://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/ 2ã€æ˜¯ä»€ä¹ˆ1ã€æ¦‚è¿°Gatewayæ˜¯åœ¨Springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡ï¼ŒåŸºäºSpring 5ï¼ŒSpring Boot 2å’Œ Project Reactorç­‰æŠ€æœ¯ã€‚Gatewayæ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±ï¼Œä»¥åŠæä¾›ä¸€äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œ ä¾‹å¦‚ï¼šç†”æ–­ã€é™æµã€é‡è¯•ç­‰ 2ã€ä¸€å¥è¯SpringCloud Gateway ä½¿ç”¨çš„Webfluxä¸­çš„reactor-nettyå“åº”å¼ç¼–ç¨‹ç»„ä»¶ï¼Œåº•å±‚ä½¿ç”¨äº†Nettyé€šè®¯æ¡†æ¶ã€‚ 3ã€èƒ½å¹²å˜› åå‘ä»£ç† é‰´æƒ æµé‡æ§åˆ¶ ç†”æ–­ æ—¥å¿—ç›‘æ§ â€¦â€¦ 4ã€ç½‘å…³åœ¨å¾®æœåŠ¡çš„ä½ç½® 5ã€GateWayä¼˜äºZuulçš„åœ°æ–¹1ã€æˆ‘ä»¬ä¸ºä»€ä¹ˆé€‰æ‹©Gatewayï¼Ÿ1ã€neflixä¸å¤ªé è°±ï¼Œzuul2.0ä¸€ç›´è·³ç¥¨ï¼Œè¿Ÿè¿Ÿä¸å‘å¸ƒ2ã€SpringCloud Gatewayå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ åŸºäºSpring Framework 5, Project Reactor å’Œ Spring Boot 2.0 è¿›è¡Œæ„å»ºï¼› åŠ¨æ€è·¯ç”±ï¼šèƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§ï¼› å¯ä»¥å¯¹è·¯ç”±æŒ‡å®š Predicateï¼ˆæ–­è¨€ï¼‰å’Œ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼› é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½ï¼› é›†æˆ Spring Cloud æœåŠ¡å‘ç°åŠŸèƒ½ï¼› æ˜“äºç¼–å†™çš„ Predicateï¼ˆæ–­è¨€ï¼‰å’Œ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼› è¯·æ±‚é™æµåŠŸèƒ½ï¼› æ”¯æŒè·¯å¾„é‡å†™ã€‚ 3ã€SpringCloud Gateway ä¸ Zuulçš„åŒºåˆ« Zuul 1.xï¼Œæ˜¯ä¸€ä¸ªåŸºäº é˜»å¡ I/ O çš„ API Gateway Zuul 1.x åŸºäºServlet 2. 5ä½¿ç”¨é˜»å¡æ¶æ„å®ƒä¸æ”¯æŒä»»ä½•é•¿è¿æ¥(å¦‚ WebSocket) Zuul çš„è®¾è®¡æ¨¡å¼å’ŒNginxè¾ƒåƒï¼Œæ¯æ¬¡ I/ O æ“ä½œéƒ½æ˜¯ä»å·¥ä½œçº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œï¼Œè¯·æ±‚çº¿ç¨‹è¢«é˜»å¡åˆ°å·¥ä½œçº¿ç¨‹å®Œæˆï¼Œä½†æ˜¯å·®åˆ«æ˜¯Nginx ç”¨C++ å®ç°ï¼ŒZuul ç”¨ Java å®ç°ï¼Œè€Œ JVM æœ¬èº«ä¼šæœ‰ç¬¬ä¸€æ¬¡åŠ è½½è¾ƒæ…¢çš„æƒ…å†µï¼Œä½¿å¾—Zuul çš„æ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚ Zuul 2.xç†å¿µæ›´å…ˆè¿›ï¼Œæƒ³åŸºäºNettyéé˜»å¡å’Œæ”¯æŒé•¿è¿æ¥ï¼Œä½†SpringCloudç›®å‰è¿˜æ²¡æœ‰æ•´åˆã€‚ Zuul 2.xçš„æ€§èƒ½è¾ƒ Zuul 1.x æœ‰è¾ƒå¤§æå‡ã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œæ ¹æ®å®˜æ–¹æä¾›çš„åŸºå‡†æµ‹è¯•ï¼Œ Spring Cloud Gateway çš„ RPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰æ˜¯Zuul çš„ 1. 6 å€ã€‚ Spring Cloud Gateway å»ºç«‹ åœ¨ Spring Framework 5ã€ Project Reactor å’Œ Spring Boot 2 ä¹‹ä¸Šï¼Œ ä½¿ç”¨éé˜»å¡ APIã€‚ Spring Cloud Gateway è¿˜ æ”¯æŒ WebSocketï¼Œ å¹¶ä¸”ä¸Springç´§å¯†é›†æˆæ‹¥æœ‰æ›´å¥½çš„å¼€å‘ä½“éªŒ 2ã€Zuul1.xæ¨¡å‹Springcloudä¸­æ‰€é›†æˆçš„Zuulç‰ˆæœ¬ï¼Œé‡‡ç”¨çš„æ˜¯Tomcatå®¹å™¨ï¼Œä½¿ç”¨çš„æ˜¯ä¼ ç»Ÿçš„Servlet IOå¤„ç†æ¨¡å‹ã€‚ Servletçš„ç”Ÿå‘½å‘¨æœŸ?servletç”±servlet containerè¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ containerå¯åŠ¨æ—¶æ„é€ servletå¯¹è±¡å¹¶è°ƒç”¨servlet init()è¿›è¡Œåˆå§‹åŒ–ï¼› containerè¿è¡Œæ—¶æ¥å—è¯·æ±‚ï¼Œå¹¶ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸€èˆ¬ä»çº¿ç¨‹æ± ä¸­è·å–ç©ºé—²çº¿ç¨‹ï¼‰ç„¶åè°ƒç”¨service()ã€‚ containerå…³é—­æ—¶è°ƒç”¨servlet destory()é”€æ¯servletï¼› 3ã€GateWayæ¨¡å‹WebFluxæ˜¯ä»€ä¹ˆ https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux-new-framework ä¼ ç»Ÿçš„Webæ¡†æ¶ï¼Œæ¯”å¦‚è¯´ï¼šstruts2ï¼Œspringmvcç­‰éƒ½æ˜¯åŸºäºServlet APIä¸Servletå®¹å™¨åŸºç¡€ä¹‹ä¸Šè¿è¡Œçš„ã€‚ä½†æ˜¯åœ¨Servlet3.1ä¹‹åæœ‰äº†å¼‚æ­¥éé˜»å¡çš„æ”¯æŒã€‚è€ŒWebFluxæ˜¯ä¸€ä¸ªå…¸å‹éé˜»å¡å¼‚æ­¥çš„æ¡†æ¶ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯åŸºäºReactorçš„ç›¸å…³APIå®ç°çš„ã€‚ç›¸å¯¹äºä¼ ç»Ÿçš„webæ¡†æ¶æ¥è¯´ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨è¯¸å¦‚Nettyï¼ŒUndertowåŠæ”¯æŒServlet3.1çš„å®¹å™¨ä¸Šã€‚éé˜»å¡å¼+å‡½æ•°å¼ç¼–ç¨‹ï¼ˆSpring5å¿…é¡»è®©ä½ ä½¿ç”¨java8ï¼‰ äºŒã€ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ1ã€Route(è·¯ç”±)è·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDï¼Œç›®æ ‡URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”± 2ã€Predicate(æ–­è¨€)å‚è€ƒçš„æ˜¯Java8çš„java.util.function.Predicateå¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹(ä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°)ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”± 3ã€Filter(è¿‡æ»¤)æŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚ 4ã€æ€»ä½“webè¯·æ±‚ï¼Œé€šè¿‡ä¸€äº›åŒ¹é…æ¡ä»¶ï¼Œå®šä½åˆ°çœŸæ­£çš„æœåŠ¡èŠ‚ç‚¹ã€‚å¹¶åœ¨è¿™ä¸ªè½¬å‘è¿‡ç¨‹çš„å‰åï¼Œè¿›è¡Œä¸€äº›ç²¾ç»†åŒ–æ§åˆ¶ã€‚predicateå°±æ˜¯æˆ‘ä»¬çš„åŒ¹é…æ¡ä»¶ï¼›è€Œfilterï¼Œå°±å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ— æ‰€ä¸èƒ½çš„æ‹¦æˆªå™¨ã€‚æœ‰äº†è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œå†åŠ ä¸Šç›®æ ‡uriï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªå…·ä½“çš„è·¯ç”±äº† ä¸‰ã€Gatewayå·¥ä½œæµç¨‹1ã€å®˜ç½‘å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚ç„¶ååœ¨ Gateway Handler Mapping ä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ° Gateway Web Handlerã€‚ Handler å†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆâ€œpreâ€ï¼‰æˆ–ä¹‹åï¼ˆâ€œpostâ€ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚ Filteråœ¨â€œpreâ€ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰ï¼Œåœ¨â€œpostâ€ç±»å‹çš„è¿‡æ»¤å™¨ä¸­å¯ä»¥åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ï¼Œæ—¥å¿—çš„è¾“å‡ºï¼Œæµé‡ç›‘æ§ç­‰æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚ 2ã€æ ¸å¿ƒé€»è¾‘è·¯ç”±è½¬å‘+æ‰§è¡Œè¿‡æ»¤å™¨é“¾ å››ã€å…¥é—¨æ¡ˆä¾‹1ã€æ¨¡å—åˆ›å»ºæ­¥éª¤1ã€å»ºmodelcloud-gateway-gateway9527 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-gateway-gateway9527&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--gateway--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--eureka-client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®ç±»--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 9527 spring: application: name: cloud-gateway eureka: instance: hostname: cloud-gateway-service client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†… service-url: register-with-eureka: true fetch-registry: true defaultZone: http://eureka7001.com:7001/eureka 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient public class GatewayMain9527 { public static void main(String[] args) { SpringApplication.run (GatewayMain9527.class,args); } } 2ã€ç½‘å…³æ˜ å°„é…ç½®1ã€ymlé…ç½®spring: application: name: cloud-gateway cloud: gateway: routes: - id: payment_routh #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/get/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_routh2 #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± 2ã€é…ç½®è¯´æ˜ 4ã€æµ‹è¯•1ã€å¯åŠ¨ eurekaé›†ç¾¤ï¼Œå¯åŠ¨8001/8002ï¼Œå¯åŠ¨ç½‘å…³9527 æ·»åŠ ç½‘å…³å‰uriï¼šhttp://localhost:8001/payment/get/1 æ·»åŠ ç½‘å…³åuriï¼šhttp://localhost:9527/payment/get/1 3ã€YMLé…ç½®è¯´æ˜Gatewayç½‘å…³è·¯ç”±æœ‰ä¸¤ç§é…ç½®æ–¹å¼ï¼š 1ã€æ–¹å¼ä¸€ï¼šåœ¨é…ç½®æ–‡ä»¶ymlä¸­é…ç½®æ—¢ä¸Šé¢æ¡ˆä¾‹çš„æ–¹å¼ 1ã€æ–¹å¼äºŒï¼šä»£ç ä¸­æ³¨å…¥RouteLocatorçš„Beanpackage com.kk.springcloud.config; import org.springframework.cloud.gateway.route.RouteLocator; import org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class GatewayConfig { /** * é…ç½®äº†ä¸€ä¸ªidä¸ºroute-nameçš„è·¯ç”±è§„åˆ™ï¼Œ * å½“è®¿é—®åœ°å€ http://localhost:9527/kkæ—¶ä¼šè‡ªåŠ¨è½¬å‘åˆ°åœ°å€ï¼šhttp://news.baidu.com/ * * @param builder * @return */ @Bean public RouteLocator customRouteLocator(RouteLocatorBuilder builder) { RouteLocatorBuilder.Builder routes = builder.routes ( ); routes.route (\"path_route_mykk\", r -&gt; r.path (\"/kk\").uri (\"http://www.baidu.com/\")).build ( ); return routes.build ( ); } @Bean public RouteLocator customRouteLocator2(RouteLocatorBuilder builder) { RouteLocatorBuilder.Builder routes = builder.routes ( ); routes.route (\"path_route_mykk2\", r -&gt; r.path (\"/kkz\").uri (\"http://www.weibo.com/kkz\")).build ( ); return routes.build ( ); } } äº”ã€å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±1ã€æ¦‚è¿°é»˜è®¤æƒ…å†µä¸‹Gatewayä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„æœåŠ¡åˆ—è¡¨ï¼Œä»¥æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åä¸ºè·¯å¾„åˆ›å»ºåŠ¨æ€è·¯ç”±è¿›è¡Œè½¬å‘ï¼Œä»è€Œå®ç°åŠ¨æ€è·¯ç”±çš„åŠŸèƒ½ 2ã€å¯åŠ¨ä¸€ä¸ªeureka7001 + ä¸¤ä¸ªæœåŠ¡æä¾›è€…8001/8002 4ã€yml1ã€éœ€è¦æ³¨æ„çš„æ˜¯uriçš„åè®®ä¸ºlbï¼Œè¡¨ç¤ºå¯ç”¨Gatewayçš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚ 2ã€lb://serviceNameæ˜¯spring cloud gatewayåœ¨å¾®æœåŠ¡ä¸­è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºçš„è´Ÿè½½å‡è¡¡uri server: port: 9527 spring: application: name: cloud-gateway cloud: gateway: discovery: locator: enabled: true #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”± routes: - id: payment_routh #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/get/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_routh2 #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± eureka: instance: hostname: cloud-gateway-service client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†… service-url: register-with-eureka: true fetch-registry: true defaultZone: http://eureka7001.com:7001/eureka 5ã€æµ‹è¯•urlï¼šhttp://localhost:9527/payment/lb å…­ã€Predicate(æ–­è¨€)çš„ä½¿ç”¨1ã€å¯åŠ¨çœ‹ä¸‹æ—¥å¿— 2ã€Route Predicate FactoriesSpring Cloud Gateway åˆ›å»º Route å¯¹è±¡æ—¶ï¼Œ ä½¿ç”¨ RoutePredicateFactory åˆ›å»º Predicate å¯¹è±¡ï¼ŒPredicate å¯¹è±¡å¯ä»¥èµ‹å€¼ç»™ Routeã€‚ Spring Cloud Gateway åŒ…å«è®¸å¤šå†…ç½®çš„Route Predicate Factoriesã€‚ æ‰€æœ‰è¿™äº›è°“è¯æ˜¯éƒ½åŒ¹é…HTTPè¯·æ±‚çš„ä¸åŒå±æ€§ã€‚å¤šç§è°“è¯å·¥å‚å¯ä»¥ç»„åˆï¼Œå¹¶é€šè¿‡é€»è¾‘ and ç»„åˆã€‚ 3ã€å¸¸ç”¨çš„Route Predicate1ã€After Route Predicateå¿…é¡»è¦åœ¨é…ç½®æ–­è¨€çš„æ—¶åŒºçš„æ—¶é—´ä¹‹åå¯¹åº”çš„uriè¯·æ±‚æ‰èƒ½ç”Ÿæ•ˆ package com.kk.test; import java.time.ZonedDateTime; public class Test { public static void main(String[] args) { ZonedDateTime zbj = ZonedDateTime.now ( ); // é»˜è®¤æ—¶åŒº System.out.println (zbj); // ZonedDateTime zny = ZonedDateTime.now(ZoneId.of(\"America/New_York\")); // ç”¨æŒ‡å®šæ—¶åŒºè·å–å½“å‰æ—¶é—´ // System.out.println(zny); } } - After=2022-02-03T13:53:16.164+08:00[Asia/Shanghai] # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± spring: application: name: cloud-gateway cloud: gateway: discovery: locator: enabled: true #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”± routes: - id: payment_routh #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/get/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - After=2022-02-03T13:53:16.164+08:00[Asia/Shanghai] # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_routh2 #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± 2ã€Before Route Predicateå¿…é¡»è¦åœ¨é…ç½®æ–­è¨€çš„æ—¶åŒºçš„æ—¶é—´ä¹‹å‰å¯¹åº”çš„uriè¯·æ±‚æ‰èƒ½ç”Ÿæ•ˆ - Before=2022-02-03T13:53:16.164+08:00[Asia/Shanghai] # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± 3ã€Between Route Predicateå¿…é¡»è¦åœ¨é…ç½®æ–­è¨€çš„æ—¶åŒºçš„æ—¶é—´èŒƒå›´å†…å¯¹åº”çš„uriè¯·æ±‚æ‰èƒ½ç”Ÿæ•ˆ - Between=2022-02-03T13:53:16.164+08:00[Asia/Shanghai],2022-12-03T13:53:16.164+08:00[Asia/Shanghai] # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± 4ã€Cookie Route Predicateå¿…é¡»æ˜¾ç¤ºçš„æŒ‡å®šæºå¸¦çš„cookieä¿¡æ¯ï¼Œæ‰èƒ½è®¿é—®å¯¹åº”çš„uri - Cookie=username,mykk # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± 1ã€ä¸å¸¦cookieçš„æƒ…å†µ curl http://localhost:9527/payment/get/1 2ã€æºå¸¦cookieçš„æƒ…å†µ curl http://localhost:9527/payment/get/1 --cookie \"username=mykk\" 5ã€Header Route Predicateå¿…é¡»æ˜¾ç¤ºçš„æŒ‡å®šæºå¸¦çš„è¯·æ±‚å¤´Header ä¿¡æ¯ï¼Œæ‰èƒ½è®¿é—®å¯¹åº”çš„uriã€‚ ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯å±æ€§åç§°å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™ä¸ªå±æ€§å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ™æ‰§è¡Œã€‚ - Header=X-Request-Id, \\d+ # è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼ 1ã€ä¸å¸¦Headerçš„æƒ…å†µ curl http://localhost:9527/payment/get/1 2ã€æºå¸¦Headerçš„æƒ…å†µ curl http://localhost:9527/payment/get/1 -H \"X-Request-Id:123\" 6ã€Host Route Predicateå¿…é¡»æ˜¾ç¤ºçš„æºå¸¦æŒ‡å®šè§„åˆ™çš„ä¸»æœºåœ°å€ Hostä¿¡æ¯ ï¼Œæ‰èƒ½è®¿é—®å¯¹åº”çš„uriã€‚ - Host=**.mykk.com è®¿é—®æµ‹è¯• curl http://localhost:9527/payment/get/1 -H \"Host:www.mykk.com\" curl http://localhost:9527/payment/get/1 -H \"Host:news.mykk.com\" 7ã€Method Route Predicateå¿…é¡»æ˜¾ç¤ºçš„æŒ‡å®šè¯·æ±‚æ–¹å¼ ï¼Œæ‰èƒ½è®¿é—®å¯¹åº”çš„uriã€‚ - Method=GET # è¯·æ±‚æ–¹å¼ 8ã€Path Route Predicateè·¯ç”±åˆ°æŒ‡å®šçš„è·¯å¾„ 9ã€Query Route Predicateå¿…é¡»æ˜¾ç¤ºçš„æºå¸¦æŒ‡å®šè§„åˆ™çš„ è¯·æ±‚å‚æ•° ï¼Œæ‰èƒ½è®¿é—®å¯¹åº”çš„uriã€‚ è¯´æ˜ï¼šæ”¯æŒä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å±æ€§åï¼Œä¸€ä¸ªä¸ºå±æ€§å€¼ï¼Œå±æ€§å€¼å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚ æµ‹è¯•ï¼š urlï¼šcurl http://localhost:9527/payment/get/1?username=111 ä¸ƒã€Filterçš„ä½¿ç”¨1ã€æ¦‚è¿°è·¯ç”±è¿‡æ»¤å™¨å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨åªèƒ½æŒ‡å®šè·¯ç”±è¿›è¡Œä½¿ç”¨ã€‚ Spring Cloud Gateway å†…ç½®äº†å¤šç§è·¯ç”±è¿‡æ»¤å™¨ï¼Œä»–ä»¬éƒ½ç”±GatewayFilterçš„å·¥å‚ç±»æ¥äº§ç”Ÿ 1ã€ç”Ÿå‘½å‘¨æœŸå‰ç½®ï¼špre åç½®ï¼špost 2ã€ç§ç±»å•ä¸€ï¼šGatewayFilter https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#the-addrequestparameter-gatewayfilter-factory 31ç§ä¹‹å¤š å…¨å±€ï¼šGlobalFilter 2ã€å¸¸ç”¨çš„GatewayFilterAddRequestParameter filters: - AddRequestParameter=X-Request-Id,1024 #è¿‡æ»¤å™¨å·¥å‚ä¼šåœ¨åŒ¹é…çš„è¯·æ±‚å¤´åŠ ä¸Šä¸€å¯¹è¯·æ±‚å¤´ï¼Œåç§°ä¸ºX-Request-Idå€¼ä¸º1024 server: port: 9527 spring: application: name: cloud-gateway cloud: gateway: discovery: locator: enabled: true #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”± routes: - id: payment_routh #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ filters: - AddRequestParameter=X-Request-Id,1024 #è¿‡æ»¤å™¨å·¥å‚ä¼šåœ¨åŒ¹é…çš„è¯·æ±‚å¤´åŠ ä¸Šä¸€å¯¹è¯·æ±‚å¤´ï¼Œåç§°ä¸ºX-Request-Idå€¼ä¸º1024 predicates: - Path=/payment/get/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - After=2022-02-03T13:53:16.164+08:00[Asia/Shanghai] # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± # - Cookie=username,mykk # - Header=X-Request-Id, \\d+ # è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼ # - Host=**.mykk.com # - Method=GET # è¯·æ±‚æ–¹å¼ - Query=username, \\d+ # è¦æœ‰å‚æ•°åusernameå¹¶ä¸”å€¼è¿˜è¦æ˜¯æ•´æ•°æ‰èƒ½è·¯ç”± - id: payment_routh2 #payment_route #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ uri: lb://cloud-payment-service #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± eureka: instance: hostname: cloud-gateway-service client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†… service-url: register-with-eureka: true fetch-registry: true defaultZone: http://eureka7001.com:7001/eureka 3ã€è‡ªå®šä¹‰è¿‡æ»¤å™¨è‡ªå®šä¹‰å…¨å±€GlobalFilter 1ã€ä¸¤ä¸ªä¸»è¦æ¥å£ä»‹ç»implements GlobalFilter,Ordered 2ã€èƒ½å¹²å˜› å…¨å±€æ—¥å¿—è®°å½• ç»Ÿä¸€ç½‘å…³é‰´æƒ â€¦â€¦ 3ã€ä»£ç package com.kk.springcloud.config.config; import org.springframework.cloud.gateway.filter.GatewayFilterChain; import org.springframework.cloud.gateway.filter.GlobalFilter; import org.springframework.core.Ordered; import org.springframework.http.HttpStatus; import org.springframework.stereotype.Component; import org.springframework.web.server.ServerWebExchange; import reactor.core.publisher.Mono; import java.util.Date; @Component public class MyLogGateWayFilter implements GlobalFilter, Ordered { @Override // è¿‡æ»¤é€»è¾‘ public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) { System.out.println(\"time:\"+new Date ()+\"\\t æ‰§è¡Œäº†è‡ªå®šä¹‰çš„å…¨å±€è¿‡æ»¤å™¨: \"+\"MyLogGateWayFilter\"+\"hello\"); String uname = exchange.getRequest().getQueryParams().getFirst(\"uname\"); if (uname == null) { System.out.println(\"****ç”¨æˆ·åä¸ºnullï¼Œæ— æ³•ç™»å½•\"); exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE); return exchange.getResponse().setComplete(); } return chain.filter(exchange); } // ä¼˜å…ˆçº§ï¼Œè¶Šå°‘è¶Šå¤§ @Override public int getOrder() { return 0; } } æµ‹è¯•ï¼šcurl http://localhost:9527/payment/get/1?uname=11","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"è·¯ç”±ç½‘å…³","slug":"è·¯ç”±ç½‘å…³","permalink":"https://mykkto.github.io/tags/%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3/"},{"name":"alibaba","slug":"alibaba","permalink":"https://mykkto.github.io/tags/alibaba/"},{"name":"gateway","slug":"gateway","permalink":"https://mykkto.github.io/tags/gateway/"}],"author":"mykk"},{"title":"mysqlå¼€å¯è¿œç¨‹è¿æ¥","slug":"04base/03mysql/01_Mysql_smallPosture","date":"2022-01-27T14:27:39.000Z","updated":"2022-03-12T03:59:47.139Z","comments":true,"path":"posts/bf62bc57.html","link":"","permalink":"https://mykkto.github.io/posts/bf62bc57.html","excerpt":"","text":"1ã€å‰è¨€æœ€è¿‘å¿«è¿‡å¹´äº†ï¼Œå›å»è‚¯å®šæ˜¯è¦æ•²ä»£ç ï¼Œå†™åšæ–‡çš„ï¼Œè¿‘æœŸåœ¨å†™SpringCloudå…¨å®¶æ¡¶ï¼Œæ•°æ®åº“ä¸€ç›´æ˜¯åœ¨æœ¬åœ°ï¼Œæƒ³ç€è¿˜æœ‰å‡ å°äº‘æœºåœ¨äº‘ä¸Šè¿è¡Œç€ï¼Œäºæ˜¯è¿æ¥äº†ä¸‹ï¼Œå‡ºç°äº†å¦‚ä¸‹é—®é¢˜ï¼š ä¹‹å‰è¿˜æ˜¯å¥½çš„ï¼Œå¯èƒ½æŒºä¹…æ²¡ç”¨çš„æƒé™è‡ªå·±å…³é—­äº†ï¼Œå®‰è£…æ˜¯docker å¯ä»¥å‚è€ƒä¹‹å‰åšä¸»çš„ç®€ä¹¦æ–‡ç«  ï¼š https://www.jianshu.com/p/f554c85b25c1 ç‰ˆæœ¬é¡ºä¾¿è¯´ä¸‹5.7.35 MySQL Community Server (GPL) 2ã€å¼€å¯è¿œç¨‹è¿æ¥#å¼€å¯è¿œç¨‹è¿æ¥ GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'a1b2c3' WITH GRANT OPTION; #root ç”¨æˆ·å #a1b2c3 å¯†ç  #åˆ·æ–°æƒé™ï¼Œç«‹å³ç”Ÿæ•ˆ flush privileges; 3ã€ä¿®æ”¹å¯†ç #ä¿®æ”¹å¯†ç (5.7.35) set password = password ('a1b2c3'); #ä¿®æ”¹å¯†ç ï¼ˆé«˜ç‰ˆæœ¬ 8.0+ï¼‰ update mysql.user set authentication_string=password('a1b2c3') where user='a1b2c3'; #åˆ·æ–°æƒé™ï¼Œç«‹å³ç”Ÿæ•ˆ flush privileges;","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://mykkto.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"å°å§¿åŠ¿","slug":"å°å§¿åŠ¿","permalink":"https://mykkto.github.io/tags/%E5%B0%8F%E5%A7%BF%E5%8A%BF/"},{"name":"linux","slug":"linux","permalink":"https://mykkto.github.io/tags/linux/"},{"name":"mysql","slug":"mysql","permalink":"https://mykkto.github.io/tags/mysql/"}],"author":"mykk"},{"title":"SpringCloud-Zuulè·¯ç”±ç½‘å…³","slug":"03javaDistributed/01springcloud/08_SpringCloud_Zuul","date":"2022-01-25T13:38:21.000Z","updated":"2022-02-02T03:29:00.626Z","comments":true,"path":"posts/d633875f.html","link":"","permalink":"https://mykkto.github.io/posts/d633875f.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€å®˜ç½‘https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/2.2.1.RELEASE/reference/html/#router-and-filter-zuul 2ã€æ˜¯ä»€ä¹ˆZuulæ˜¯ä¸€ç§æä¾›åŠ¨æ€è·¯ç”±ã€ç›‘è§†ã€å¼¹æ€§ã€å®‰å…¨æ€§ç­‰åŠŸèƒ½çš„è¾¹ç¼˜æœåŠ¡ã€‚ Zuulæ˜¯Netflixå‡ºå“çš„ä¸€ä¸ªåŸºäºJVMè·¯ç”±å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ã€‚ APIç½‘å…³ä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡æä¾›äº†ç»Ÿä¸€çš„è®¿é—®å…¥å£ï¼Œå®¢æˆ·ç«¯é€šè¿‡APIç½‘å…³è®¿é—®ç›¸å…³æœåŠ¡ã€‚APIç½‘å…³çš„å®šä¹‰ç±»ä¼¼äºè®¾è®¡æ¨¡å¼ä¸­çš„é—¨é¢æ¨¡å¼ï¼Œå®ƒç›¸å½“äºæ•´ä¸ªå¾®æœåŠ¡æ¶æ„ä¸­çš„é—¨é¢ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯çš„è®¿é—®éƒ½é€šè¿‡å®ƒæ¥è¿›è¡Œè·¯ç”±åŠè¿‡æ»¤ã€‚å®ƒå®ç°äº†è¯·æ±‚è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€æ ¡éªŒè¿‡æ»¤ã€æœåŠ¡å®¹é”™ã€æœåŠ¡èšåˆç­‰åŠŸèƒ½ã€‚ ZuulåŒ…å«äº†å¦‚ä¸‹æœ€ä¸»è¦çš„åŠŸèƒ½ï¼šä»£ç†+è·¯ç”±+è¿‡æ»¤ä¸‰å¤§åŠŸèƒ½ 3ã€èƒ½å¹²å˜›1ã€è·¯ç”±2ã€è¿‡æ»¤3ã€è´Ÿè½½å‡è¡¡4ã€ç°åº¦å‘å¸ƒï¼ˆé‡‘ä¸é›€å‘å¸ƒï¼‰èµ·æºæ˜¯ï¼ŒçŸ¿äº•å·¥äººå‘ç°ï¼Œé‡‘ä¸é›€å¯¹ç“¦æ–¯æ°”ä½“å¾ˆæ•æ„Ÿï¼ŒçŸ¿å·¥ä¼šåœ¨ä¸‹äº•ä¹‹å‰ï¼Œå…ˆæ”¾ä¸€åªé‡‘ä¸é›€åˆ°äº•ä¸­ï¼Œå¦‚æœé‡‘ä¸é›€ä¸å«äº†ï¼Œå°±ä»£è¡¨ç“¦æ–¯æµ“åº¦é«˜ã€‚ åœ¨ç°åº¦å‘å¸ƒå¼€å§‹åï¼Œå…ˆå¯åŠ¨ä¸€ä¸ªæ–°ç‰ˆæœ¬åº”ç”¨ï¼Œä½†æ˜¯å¹¶ä¸ç›´æ¥å°†æµé‡åˆ‡è¿‡æ¥ï¼Œè€Œæ˜¯æµ‹è¯•äººå‘˜å¯¹æ–°ç‰ˆæœ¬è¿›è¡Œçº¿ä¸Šæµ‹è¯•ï¼Œå¯åŠ¨çš„è¿™ä¸ªæ–°ç‰ˆæœ¬åº”ç”¨ï¼Œå°±æ˜¯æˆ‘ä»¬çš„é‡‘ä¸é›€ã€‚å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå¯ä»¥å°†å°‘é‡çš„ç”¨æˆ·æµé‡å¯¼å…¥åˆ°æ–°ç‰ˆæœ¬ä¸Šï¼Œç„¶åå†å¯¹æ–°ç‰ˆæœ¬åšè¿è¡ŒçŠ¶æ€è§‚å¯Ÿï¼Œæ”¶é›†å„ç§è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚æœæ­¤æ—¶å¯¹æ–°æ—§ç‰ˆæœ¬åšå„ç§æ•°æ®å¯¹æ¯”ï¼Œå°±æ˜¯æ‰€è°“çš„A/Bæµ‹è¯•ã€‚æ–°ç‰ˆæœ¬æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œé‚£ä¹ˆé€æ­¥æ‰©å¤§èŒƒå›´ã€æµé‡ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·éƒ½è¿ç§»åˆ°æ–°ç‰ˆæœ¬ä¸Šé¢æ¥ã€‚ 2ã€è·¯ç”±åŸºæœ¬é…ç½®è·¯ç”±åŠŸèƒ½è´Ÿè´£å°†å¤–éƒ¨è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„æœåŠ¡å®ä¾‹ä¸Šå»ï¼Œæ˜¯å®ç°ç»Ÿä¸€è®¿é—®å…¥å£çš„åŸºç¡€ 1ã€å»ºModelcloud-zuul-gateway9527 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-zuul-gateway9527&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 9527 spring: application: name: cloud-zuul-gateway eureka: client: service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka defaultZone: http://eureka7001.com:7001/eureka instance: instance-id: gateway-9527.com prefer-ip-address: true 4ã€hostsä¿®æ”¹(æœ¬åœ°ç¯å¢ƒ)å› ä¸ºæ˜¯æœ¬åœ°ç¯å¢ƒï¼ŒæœåŠ¡å™¨ï¼ŒåŸŸåç­‰èµ„æºæœ‰é™ æ·»åŠ é…ç½®é¡¹ï¼šC:\\Windows\\System32\\drivers\\etc 127.0.0.1 myzuul.com 5ã€ä¸»å¯åŠ¨æ³¨æ„ï¼š@EnableZuulProxy package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.zuul.EnableZuulProxy; @SpringBootApplication @EnableZuulProxy public class ZuulMain9527 { public static void main(String[] args) { SpringApplication.run (ZuulMain9527.class,args); } } 6ã€å¯åŠ¨é¡ºåº1ã€eurekaé›†ç¾¤ 2ã€8006ç”Ÿäº§è€… 3ã€9527ç½‘å…³ 7ã€æµ‹è¯•1ã€ä¸ç”¨è·¯ç”±http://localhost:8001/payment/consul controller @GetMapping(\"/payment/consul\") public String paymentInfo() { return \"springcloud with consul: \" + serverPort + \"\\t\\t\" + UUID.randomUUID ( ).toString ( ); } 2ã€è·¯ç”±ï¼ˆ1ï¼‰zuulæ˜ å°„é…ç½®+æ³¨å†Œä¸­å¿ƒæ³¨å†Œåå¯¹å¤–æš´éœ²çš„æœåŠ¡åç§°+restè°ƒç”¨åœ°å€ ï¼ˆ2ï¼‰urlï¼š http://myzuul.com:9527/cloud-payment-service/payment/consul ![](C:\\Users\\my_kk\\Documents\\Tencent Files\\763856958\\FileRecv_posts\\03javafenbushi\\01springcloud\\20220201141019.png) 3ã€è·¯ç”±è®¿é—®æ˜ å°„è§„åˆ™1ã€åç§°ä»£ç†1ã€ymlè¯¦è§£zuul: routes: # è·¯ç”±æ˜ å°„é…ç½® mypayment.path: /mypayment/** #IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mypayment.serviceId: cloud-payment-service # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° server: port: 9527 spring: application: name: cloud-zuul-gateway eureka: client: service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka defaultZone: http://eureka7001.com:7001/eureka instance: instance-id: gateway-9527.com prefer-ip-address: true zuul: routes: # è·¯ç”±æ˜ å°„é…ç½® mypayment.path: /mypayment/** #IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mypayment.serviceId: cloud-payment-service # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° 2ã€æµ‹è¯•1ã€è·¯ç”±è®¿é—®ï¼šOKhttp://myzuul.com:9527/mypayment/payment/consul 2ã€åŸè·¯å¾„è®¿é—®ï¼šOKhttp://myzuul.com:9527/cloud-payment-service/payment/consul 2ã€å¿½ç•¥åŸæœ‰çœŸå®æœåŠ¡å1ã€ymlé…ç½®zuul: ignored-services: cloud-payment-service #å¿½ç•¥æœåŠ¡å 2ã€æµ‹è¯•1ã€ä½¿ç”¨æœåŠ¡åè®¿é—®ï¼ˆå¤±è´¥ï¼‰ï¼šhttp://myzuul.com:9527/cloud-payment-service/payment/consul ![](C:\\Users\\my_kk\\Documents\\Tencent Files\\763856958\\FileRecv_posts\\03javafenbushi\\01springcloud\\20220201165024.png) 2ã€æ˜ å°„è®¿é—®ï¼šä¾æ—§å¯ä»¥ï¼ äº”è§’æ˜Ÿï¼šæ‰¹é‡å¿½ç•¥zuul: ignored-services: \"*\" 3ã€è·¯ç”±è½¬å‘å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½1ã€ç”Ÿäº§è€…ï¼šSMSçŸ­ä¿¡æ¨¡å—(8008)1ã€å»ºmodelcloud-provider-sms8008 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-provider-sms8008&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 8008 ###æœåŠ¡åç§°(æœåŠ¡æ³¨å†Œåˆ°eurekaåç§°) spring: application: name: cloud-provider-sms eureka: client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†… service-url: register-with-eureka: true fetch-registry: true defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka #defaultZone: http://127.0.0.1:7001/eureka,http://127.0.0.1:7002/eureka #defaultZone: http://eureka7001.com:7001/eureka # eurekaé›†ç¾¤åŠ @è€æœ¬ç‰ˆ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient public class SMSMain8008 { public static void main(String[] args) { SpringApplication.run (SMSMain8008.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class SMSController { @Value(\"${server.port}\") private String serverPort; @GetMapping(\"/sms\") public String sms() { return \"sms provider service: \"+\"\\t\"+serverPort; } } 6ã€å¯åŠ¨æœåŠ¡ 2ã€ç½‘å…³ï¼šzuulï¼ˆ9527ï¼‰1ã€ymlzuul: # ignored-services: cloud-payment-service #å¿½ç•¥æœåŠ¡å routes: # è·¯ç”±æ˜ å°„é…ç½® mysms.path: /mysms/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mysms.serviceId: cloud-provider-sms # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° server: port: 9527 spring: application: name: cloud-zuul-gateway eureka: client: service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka defaultZone: http://eureka7001.com:7001/eureka instance: instance-id: gateway-9527.com prefer-ip-address: true zuul: # ignored-services: cloud-payment-service #å¿½ç•¥æœåŠ¡å routes: # è·¯ç”±æ˜ å°„é…ç½® mysms.path: /mysms/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mysms.serviceId: cloud-provider-sms # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° mypayment.path: /mypayment/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mypayment.serviceId: cloud-payment-service # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° 2ã€è¯´æ˜ç”±äºZuulè‡ªåŠ¨é›†æˆäº†Ribbonå’ŒHystrixï¼Œæ‰€ä»¥Zuulå¤©ç”Ÿå°±æœ‰è´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å®¹é”™èƒ½åŠ› 3ã€æµ‹è¯•è´Ÿè½½æ•ˆæœurlï¼š 4ã€è®¾ç½®ç»Ÿä¸€å…¬å…±å‰ç¼€ymlé…ç½®zuul: prefix: /mykk server: port: 9527 spring: application: name: cloud-zuul-gateway eureka: client: service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka,http://eureka7003.com:7003/eureka defaultZone: http://eureka7001.com:7001/eureka instance: instance-id: gateway-9527.com prefer-ip-address: true zuul: prefix: /mykk # ignored-services: cloud-payment-service #å¿½ç•¥æœåŠ¡å routes: # è·¯ç”±æ˜ å°„é…ç½® mysms.path: /mysms/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mysms.serviceId: cloud-provider-sms # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° mypayment.path: /mypayment/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mypayment.serviceId: cloud-payment-service # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° æµ‹è¯•urlï¼ˆ1ï¼‰http://myzuul.com:9527/mykk/mypayment/payment/consul ï¼ˆ2ï¼‰http://myzuul.com:9527/mykk/mysms/sms 4ã€æŸ¥çœ‹è·¯ç”±ä¿¡æ¯1ã€POM&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€yml# å¼€å¯æŸ¥çœ‹è·¯ç”±çš„ç«¯ç‚¹ management: endpoints: web: exposure: include: 'routes' 3ã€æŸ¥çœ‹è·¯ç”±è¯¦ç»†ä¿¡æ¯urlï¼šhttp://localhost:9527/actuator/routes 5ã€è¿‡æ»¤å™¨1ã€åŠŸèƒ½è¿‡æ»¤åŠŸèƒ½è´Ÿè´£å¯¹è¯·æ±‚è¿‡ç¨‹è¿›è¡Œé¢å¤–çš„å¤„ç†ï¼Œæ˜¯è¯·æ±‚æ ¡éªŒè¿‡æ»¤åŠæœåŠ¡èšåˆçš„åŸºç¡€ã€‚ 2ã€è¿‡æ»¤å™¨çš„ç”Ÿå‘½å‘¨æœŸ 3ã€ZuulFilter1ã€è¿‡æ»¤ç±»å‹ preï¼šåœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡å‰æ‰§è¡Œï¼Œæ¯”å¦‚æƒé™æ ¡éªŒã€æ‰“å°æ—¥å¿—ç­‰åŠŸèƒ½ï¼› routingï¼šåœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡æ—¶æ‰§è¡Œ postï¼šåœ¨è¯·æ±‚è¢«è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡åæ‰§è¡Œï¼Œæ¯”å¦‚ç»™ç›®æ ‡æœåŠ¡çš„å“åº”æ·»åŠ å¤´ä¿¡æ¯ï¼Œæ”¶é›†ç»Ÿè®¡æ•°æ®ç­‰åŠŸèƒ½ï¼› errorï¼šè¯·æ±‚åœ¨å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œã€‚ 2ã€è¿‡æ»¤é¡ºåºæ•°å­—å°çš„å…ˆæ‰§è¡Œ 3ã€è¿‡æ»¤æ˜¯å¦å¼€å¯shouldFilteræ–¹æ³•ä¸ºtrueèµ° 4ã€æ‰§è¡Œé€»è¾‘è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ 4ã€æ¡ˆä¾‹Case1ã€è¯´æ˜å‰ç½®è¿‡æ»¤å™¨ï¼Œç”¨äºåœ¨è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡å‰æ‰“å°è¯·æ±‚æ—¥å¿— 2ã€è‡ªå®šä¹‰è¿‡æ»¤å™¨è¿‡æ»¤å™¨ä»£ç ï¼š package com.kk.springcloud.filter; import com.netflix.zuul.ZuulFilter; import com.netflix.zuul.context.RequestContext; import com.netflix.zuul.exception.ZuulException; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Component; import javax.servlet.http.HttpServletRequest; import java.util.Date; @Component @Slf4j public class PreLogFilter extends ZuulFilter { /** * å®šä¹‰è¿‡æ»¤å™¨çš„ç±»å‹ * pre:åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰æ‰§è¡Œ * route:åœ¨è·¯ç”±è¯·æ±‚çš„æ—¶å€™æ‰§è¡Œ * post:è¯·æ±‚è·¯ç”±ä»¥åæ‰§è¡Œ * error:å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯çš„æ—¶å€™æ‰§è¡Œ * * @return è¿‡æ»¤å™¨çš„ç±»å‹ */ @Override public String filterType() { return \"pre\"; } /** * è¿‡æ»¤å™¨æ‰§è¡Œçš„é¡ºåºï¼Œé…ç½®å¤šä¸ªæœ‰é¡ºåºçš„è¿‡æ»¤ * æ‰§è¡Œé¡ºåºä»å°åˆ°å¤§ * * @return æ‰§è¡Œé¡ºåº */ @Override public int filterOrder() { // ä¼˜å…ˆçº§ä¸º0ï¼Œæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½ return 1; } /** * æ˜¯å¦å¼€å¯è¿‡æ»¤å™¨ * true:å¼€å¯ * false:ç¦ç”¨ * * @return æ˜¯å¦å¼€å¯è¿‡æ»¤å™¨ */ @Override public boolean shouldFilter() { // æ˜¯å¦å¼€å¯ return true; } /** * è¿‡æ»¤å™¨çš„ä¸šåŠ¡å®ç° * * @return null æ²¡æœ‰æ„ä¹‰ * @throws ZuulException å¼‚å¸¸ä¿¡æ¯ */ @Override public Object run() throws ZuulException { // ä¸šåŠ¡é€»è¾‘ä»£ç  RequestContext requestContext = RequestContext.getCurrentContext ( ); HttpServletRequest request = requestContext.getRequest ( ); String host = request.getRemoteHost ( ); String method = request.getMethod ( ); String uri = request.getRequestURI ( ); log.info(\"=====&gt; Remote host:{},method:{},uri:{}\", host, method, uri); System.out.println (\"********\" + new Date ( ).getTime ( )); return null; } } 3ã€æµ‹è¯•(1)urlï¼šhttp://myzuul.com:9527/mykk/mysms/sms (2)åœ¨è°ƒç”¨8008ä¹‹å‰ä¼šæ‰“å°æ—¥å¿— 4ã€yml é…ç½®å¼€å…³â˜…è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šå¼€å¯è¿™é‡Œä¹‹åï¼Œperé…ç½®å¤±æ•ˆï¼Œä¸æ¸…æ¥šä¸ºä»€ä¹ˆï¼Œåšä¸»æäº†å¾ˆä¹…å°è¯•æ‰å‘ç°æ˜¯è¿™ä¸ªé—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨ç¡¬ç¼–ç ï¼Œåœ¨javaä¸Šé…ç½®å¼€å…³zuul: prefix: /mykk # ignored-services: cloud-payment-service #å¿½ç•¥æœåŠ¡å routes: # è·¯ç”±æ˜ å°„é…ç½® mysms.path: /mysms/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mysms.serviceId: cloud-provider-sms # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° mypayment.path: /mypayment/** # IEåœ°å€æ è¾“å…¥çš„è·¯å¾„ mypayment.serviceId: cloud-payment-service # æŒ‡å®šæœåŠ¡ç«¯çš„åç§° #ymlé…ç½®å¼€å…³ # PreLogFilter: # pre: # disable: true å‚è€ƒæ–‡ç« é“¾æ¥1ã€é™åˆ¶IPè¿‡æ»¤åšæ–‡https://www.jianshu.com/p/20d77ca5cfbc","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"netflix","slug":"netflix","permalink":"https://mykkto.github.io/tags/netflix/"},{"name":"è·¯ç”±ç½‘å…³","slug":"è·¯ç”±ç½‘å…³","permalink":"https://mykkto.github.io/tags/%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3/"},{"name":"zuul","slug":"zuul","permalink":"https://mykkto.github.io/tags/zuul/"}],"author":"mykk"},{"title":"SpringCloud-Hystrixæ–­è·¯å™¨","slug":"03javaDistributed/01springcloud/07_SpringCloud_Hystrix","date":"2022-01-23T13:19:18.000Z","updated":"2022-02-09T14:32:16.645Z","comments":true,"path":"posts/b0ab6264.html","link":"","permalink":"https://mykkto.github.io/posts/b0ab6264.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜å¤æ‚åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸­çš„åº”ç”¨ç¨‹åºæœ‰æ•°åä¸ªä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªä¾èµ–å…³ç³»åœ¨æŸäº›æ—¶å€™å°†ä¸å¯é¿å…åœ°å¤±è´¥ã€‚ æœåŠ¡é›ªå´© å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡Aè°ƒç”¨å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cï¼Œå¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cåˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œæ‰‡å‡ºâ€ã€‚å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡Açš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œæ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€. å¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºéƒ½åœ¨å‡ ç§’é’Ÿå†…é¥±å’Œã€‚æ¯”å¤±è´¥æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™äº›åº”ç”¨ç¨‹åºè¿˜å¯èƒ½å¯¼è‡´æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿå¢åŠ ï¼Œå¤‡ä»½é˜Ÿåˆ—ï¼Œçº¿ç¨‹å’Œå…¶ä»–ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå‘ç”Ÿæ›´å¤šçš„çº§è”æ•…éšœã€‚è¿™äº›éƒ½è¡¨ç¤ºéœ€è¦å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚ æ‰€ä»¥ï¼Œé€šå¸¸å½“ä½ å‘ç°ä¸€ä¸ªæ¨¡å—ä¸‹çš„æŸä¸ªå®ä¾‹å¤±è´¥åï¼Œè¿™æ—¶å€™è¿™ä¸ªæ¨¡å—ä¾ç„¶è¿˜ä¼šæ¥æ”¶æµé‡ï¼Œç„¶åè¿™ä¸ªæœ‰é—®é¢˜çš„æ¨¡å—è¿˜è°ƒç”¨äº†å…¶ä»–çš„æ¨¡å—ï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿçº§è”æ•…éšœï¼Œæˆ–è€…å«é›ªå´©ã€‚ 2ã€æ˜¯ä»€ä¹ˆ Hystrixæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å»¶è¿Ÿå’Œå®¹é”™çš„å¼€æºåº“ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œè®¸å¤šä¾èµ–ä¸å¯é¿å…çš„ä¼šè°ƒç”¨å¤±è´¥ï¼Œæ¯”å¦‚è¶…æ—¶ã€å¼‚å¸¸ç­‰ï¼ŒHystrixèƒ½å¤Ÿä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥ï¼Œé¿å…çº§è”æ•…éšœï¼Œä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ã€‚ â€œæ–­è·¯å™¨â€æœ¬èº«æ˜¯ä¸€ç§å¼€å…³è£…ç½®ï¼Œå½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœä¹‹åï¼Œé€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§ï¼ˆç±»ä¼¼ç†”æ–­ä¿é™©ä¸ï¼‰ï¼Œå‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„ã€å¯å¤„ç†çš„å¤‡é€‰å“åº”ï¼ˆFallBackï¼‰ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…æˆ–è€…æŠ›å‡ºè°ƒç”¨æ–¹æ— æ³•å¤„ç†çš„å¼‚å¸¸ï¼Œè¿™æ ·å°±ä¿è¯äº†æœåŠ¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ä¸ä¼šè¢«é•¿æ—¶é—´ã€ä¸å¿…è¦åœ°å ç”¨ï¼Œä»è€Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è”“å»¶ï¼Œä¹ƒè‡³é›ªå´©ã€‚ 3ã€èƒ½å¹²å˜› æœåŠ¡é™çº§ æœåŠ¡ç†”æ–­ æ¥è¿‘å®æ—¶çš„ç›‘æ§ â€¦â€¦â€¦.. 4ã€å®˜ç½‘æ–‡æ¡£https://github.com/Netflix/Hystrix/wiki/How-To-Use 5ã€Hystrixåœæ›´https://github.com/Netflix/Hystrix è¢«åŠ¨ä¿®å¤bugs ä¸å†æ¥å—åˆå¹¶è¯·æ±‚ ä¸å†å‘å¸ƒæ–°ç‰ˆæœ¬ 2ã€Hystrixé‡è¦æ¦‚å¿µ1ã€æœåŠ¡é™çº§1ã€æ“ä½œæœåŠ¡å™¨å¿™ï¼Œè¯·ç¨åå†è¯•ï¼Œä¸è®©å®¢æˆ·ç«¯ç­‰å¾…å¹¶ç«‹åˆ»è¿”å›ä¸€ä¸ªå‹å¥½æç¤ºï¼Œfallback 2ã€å“ªäº›æƒ…å†µä¼šå‡ºå‘é™çº§ ç¨‹åºè¿è¡Œå¼‚å¸¸ è¶…æ—¶ æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§ çº¿ç¨‹æ± /ä¿¡å·é‡æ‰“æ»¡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§ 2ã€æœåŠ¡ç†”æ–­ç±»æ¯”ä¿é™©ä¸è¾¾åˆ°æœ€å¤§æœåŠ¡è®¿é—®åï¼Œç›´æ¥æ‹’ç»è®¿é—®ï¼Œæ‹‰é—¸é™ç”µï¼Œç„¶åè°ƒç”¨æœåŠ¡é™çº§çš„æ–¹æ³•å¹¶è¿”å›å‹å¥½æç¤º å°±æ˜¯ä¿é™©ä¸ï¼šæœåŠ¡çš„é™çº§-&gt;è¿›è€Œç†”æ–­-&gt;æ¢å¤è°ƒç”¨é“¾è·¯ 3ã€æœåŠ¡é™æµç§’æ€é«˜å¹¶å‘ç­‰æ“ä½œï¼Œä¸¥ç¦ä¸€çªèœ‚çš„è¿‡æ¥æ‹¥æŒ¤ï¼Œå¤§å®¶æ’é˜Ÿï¼Œä¸€ç§’é’ŸNä¸ªï¼Œæœ‰åºè¿›è¡Œ 3ã€hystrixæ¡ˆä¾‹1ã€æ„å»º1ã€å»ºmodelæ–°å»ºcloud-provider-hystrix-payment8001 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-provider-hystrix-payment8001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--hystrix--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--eureka client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--web--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt;&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 8001 spring: application: name: cloud-provider-hystrix-payment eureka: client: register-with-eureka: true fetch-registry: true service-url: #defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka defaultZone: http://eureka7001.com:7001/eureka 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient //æœ¬æœåŠ¡å¯åŠ¨åä¼šè‡ªåŠ¨æ³¨å†Œè¿›eurekaæœåŠ¡ä¸­ public class PaymentHystrixMain8001 { public static void main(String[] args) { SpringApplication.run (PaymentHystrixMain8001.class,args); } } 5ã€ä¸šåŠ¡ç±»1ã€servicepackage com.kk.springcloud.service.imp; import com.kk.springcloud.service.PaymentHystrixServoce; import org.springframework.stereotype.Service; import java.util.concurrent.TimeUnit; @Service public class PaymentHystrixServoceImpl implements PaymentHystrixServoce { /** * æ­£å¸¸è®¿é—®ï¼Œä¸€åˆ‡OK * * @param id * @return */ public String paymentInfo_OK(Integer id) { return \"çº¿ç¨‹æ± :\" + Thread.currentThread ( ).getName ( ) + \"paymentInfo_OK,id: \" + id + \"\\t\" + \"O(âˆ©_âˆ©)O\"; } /** * è¶…æ—¶è®¿é—®ï¼Œæ¼”ç¤ºé™çº§ * * @param id * @return */ public String paymentInfo_TimeOut(Integer id) { try { TimeUnit.SECONDS.sleep (3); } catch (InterruptedException e) { e.printStackTrace ( ); } return \"çº¿ç¨‹æ± :\" + Thread.currentThread ( ).getName ( ) + \"paymentInfo_TimeOut,id: \" + id + \"\\t\" + \"O(âˆ©_âˆ©)Oï¼Œè€—è´¹3ç§’\"; } } 2ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.service.imp.PaymentHystrixServoceImpl; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; @RestController @Slf4j public class PaymentHystrixController { @Autowired private PaymentHystrixServoceImpl paymentService; @Value(\"${server.port}\") private String serverPort; @GetMapping(\"/payment/hystrix/ok/{id}\") public String paymentInfo_OK(@PathVariable(\"id\") Integer id) { String result = paymentService.paymentInfo_OK(id); log.info(\"****result: \"+result); return result; } @GetMapping(\"/payment/hystrix/timeout/{id}\") public String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id) throws InterruptedException { String result = paymentService.paymentInfo_TimeOut(id); log.info(\"****result: \"+result); return result; } } 6ã€æµ‹è¯•1ã€å¯åŠ¨é¡ºåºå…ˆå¯åŠ¨eurekaï¼Œå†å¯åŠ¨hystrix 8001 2ã€è®¿é—® successçš„æ–¹æ³•ï¼š http://localhost:8001/payment/hystrix/ok/1 æ¯æ¬¡è°ƒç”¨è€—è´¹3 ç§’é’Ÿ http://localhost:8001/payment/hystrix/timeout/1 2ã€é«˜å¹¶å‘æµ‹è¯•ä¸Šè¿°åœ¨éé«˜å¹¶å‘æƒ…å½¢ä¸‹ï¼Œè¿˜èƒ½å‹‰å¼ºæ»¡è¶³ 1ã€Jmeterå‹æµ‹æµ‹è¯•1ã€å¼€å¯Jmeterï¼Œæ¥20000ä¸ªå¹¶å‘å‹æ­»8001ï¼Œ20000ä¸ªè¯·æ±‚éƒ½å»è®¿é—®paymentInfo_TimeOutæœåŠ¡ 2ã€å†æ¥ä¸€ä¸ªè®¿é—®ä»3ç§’åˆ°ä¸æ­¢3ç§’ http://localhost:8001/payment/hystrix/timeout/1 ä»ç§’å›åˆ°å»¶è¿Ÿä¸€ç§’å¤š http://localhost:8001/payment/hystrix/ok/1 3ã€çœ‹æ¼”ç¤ºç»“æœä¸¤ä¸ªéƒ½åœ¨è‡ªå·±è½¬åœˆåœˆ ä¸ºä»€ä¹ˆä¼šè¢«å¡æ­»ï¼štomcatçš„é»˜è®¤çš„å·¥ä½œçº¿ç¨‹æ•°è¢«æ‰“æ»¡ äº†ï¼Œæ²¡æœ‰å¤šä½™çš„çº¿ç¨‹æ¥åˆ†è§£å‹åŠ›å’Œå¤„ç†ã€‚ 2ã€Jmeterå‹æµ‹ç»“è®ºä¸Šé¢è¿˜æ˜¯æœåŠ¡æä¾›è€…8001è‡ªå·±æµ‹è¯•ï¼Œå‡å¦‚æ­¤æ—¶å¤–éƒ¨çš„æ¶ˆè´¹è€…80ä¹Ÿæ¥è®¿é—®ï¼Œé‚£æ¶ˆè´¹è€…åªèƒ½å¹²ç­‰ï¼Œæœ€ç»ˆå¯¼è‡´æ¶ˆè´¹ç«¯80ä¸æ»¡æ„ï¼ŒæœåŠ¡ç«¯8001ç›´æ¥è¢«æ‹–æ­» 3ã€çœ‹çƒ­é—¹ä¸å«Œå¼ƒäº‹å¤§ï¼Œ80æ–°å»ºåŠ å…¥cloud-consumer-feign-hystrix-order80 1ã€POM&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumer-feign-hystrix-order80&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--hystrix--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--eureka client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--web--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬åŸºç¡€é€šç”¨é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 2ã€YMLserver: port: 80 eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ 3ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication @EnableFeignClients public class OrderHystrixMain80 { public static void main(String[] args) { SpringApplication.run (OrderHystrixMain80.class,args); } } 4ã€ä¸šåŠ¡ç±» service package com.kk.springcloud.service; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.stereotype.Component; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; @Component @FeignClient(value = \"CLOUD-PROVIDER-HYSTRIX-PAYMENT\") public interface PaymentHystrixService { @GetMapping(\"/payment/hystrix/ok/{id}\") String paymentInfo_OK(@PathVariable(\"id\") Integer id); @GetMapping(\"/payment/hystrix/timeout/{id}\") String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id); } controller package com.kk.springcloud.controller; import com.kk.springcloud.service.PaymentHystrixService; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController @Slf4j public class OrderHystirxController { @Resource private PaymentHystrixService paymentHystrixService; @GetMapping(\"/consumer/payment/hystrix/ok/{id}\") public String paymentInfo_OK(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_OK (id); return result; } @GetMapping(\"/consumer/payment/hystrix/timeout/{id}\") public String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_TimeOut (id); return result; } } 5ã€æµ‹è¯• éœ€è¦å¯åŠ¨çš„æœåŠ¡ url http://localhost/consumer/payment/hystrix/ok/1 6ã€é«˜å¹¶å‘æµ‹è¯• 2Wä¸ªçº¿ç¨‹å‹8001 æ¶ˆè´¹ç«¯80å¾®æœåŠ¡å†å»è®¿é—®æ­£å¸¸çš„Okå¾®æœåŠ¡8001åœ°å€ï¼Œhttp://localhost/consumer/payment/hystrix/ok/1 æ¶ˆè´¹è€…80ï¼Œo(â•¥ï¹â•¥)o è¦ä¹ˆè½¬åœˆåœˆç­‰å¾…ï¼ˆ2Wä¸ªå¹¶å‘ï¼‰ è¦ä¹ˆæ¶ˆè´¹ç«¯æŠ¥è¶…æ—¶é”™è¯¯ï¼ˆ20Wä¸ªå¹¶å‘ï¼Œå†²å®ï¼‰ 3ã€æ•…éšœç°è±¡å’Œå¯¼è‡´åŸå›  8001åŒä¸€å±‚æ¬¡çš„å…¶å®ƒæ¥å£æœåŠ¡è¢«å›°æ­»ï¼Œå› ä¸ºtomcatçº¿ç¨‹æ± é‡Œé¢çš„å·¥ä½œçº¿ç¨‹å·²ç»è¢«æŒ¤å å®Œæ¯• 80æ­¤æ—¶è°ƒç”¨8001ï¼Œå®¢æˆ·ç«¯è®¿é—®å“åº”ç¼“æ…¢ï¼Œè½¬åœˆåœˆ 4ã€ä¸Šè¯‰ç»“è®ºæ­£å› ä¸ºæœ‰ä¸Šè¿°æ•…éšœæˆ–ä¸ä½³è¡¨ç°ï¼Œæ‰æœ‰æˆ‘ä»¬çš„é™çº§/å®¹é”™/é™æµç­‰æŠ€æœ¯è¯ç”Ÿ 5ã€å¦‚ä½•è§£å†³ï¼Ÿè§£å†³çš„è¦æ±‚1ã€è¶…æ—¶å¯¼è‡´æœåŠ¡å™¨å˜æ…¢(è½¬åœˆ)è¶…æ—¶ä¸å†ç­‰å¾… 2ã€å‡ºé”™(å®•æœºæˆ–ç¨‹åºè¿è¡Œå‡ºé”™)å‡ºé”™è¦æœ‰å…œåº•ï¼ˆé™çº§ï¼‰ 3ã€è§£å†³ å¯¹æ–¹æœåŠ¡(8001)è¶…æ—¶äº†ï¼Œè°ƒç”¨è€…(80)ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§ å¯¹æ–¹æœåŠ¡(8001)downæœºäº†ï¼Œè°ƒç”¨è€…(80)ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§ å¯¹æ–¹æœåŠ¡(8001)OKï¼Œè°ƒç”¨è€…(80)è‡ªå·±å‡ºæ•…éšœæˆ–æœ‰è‡ªæˆ‘è¦æ±‚ï¼ˆè‡ªå·±çš„ç­‰å¾…æ—¶é—´å°äºæœåŠ¡æä¾›è€…ï¼‰ï¼Œè‡ªå·±å¤„ç†é™çº§ 3-1å®æˆ˜ï¼šæœåŠ¡é™çº§1ã€é™çº§é…ç½®æ³¨è§£@HystrixCommand 2ã€8001å…ˆä»è‡ªèº«æ‰¾é—®é¢˜è®¾ç½®è‡ªèº«è°ƒç”¨è¶…æ—¶æ—¶é—´çš„å³°å€¼ï¼Œå³°å€¼å†…å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè¶…è¿‡äº†éœ€è¦æœ‰å…œåº•çš„æ–¹æ³•å¤„ç†ï¼Œä½œæœåŠ¡é™çº§fallbackã€‚ 3ã€8001fallback1ã€ä¸šåŠ¡ç±»å¯ç”¨1ã€ä»£ç 8001ï¼ˆ8002ï¼‰PaymentServiceImpl @HystrixCommand(fallbackMethod = \"paymentInfo_TimeOutHandler\", commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"3000\") }) ----------------------- public String paymentInfo_TimeOutHandler(Integer id) { return \"/(ã„’oã„’)/è°ƒç”¨æ”¯ä»˜æ¥å£è¶…æ—¶æˆ–å¼‚å¸¸ï¼š\\t\" + \"\\tå½“å‰çº¿ç¨‹æ± åå­—\" + Thread.currentThread ( ).getName ( ); } package com.kk.springcloud.service.imp; import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand; import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty; import org.springframework.stereotype.Service; import java.util.concurrent.TimeUnit; @Service public class PaymentHystrixServoceImpl { /** * æ­£å¸¸è®¿é—®ï¼Œä¸€åˆ‡OK * * @param id * @return */ public String paymentInfo_OK(Integer id) { return \"çº¿ç¨‹æ± :\" + Thread.currentThread ( ).getName ( ) + \"paymentInfo_OK,id: \" + id + \"\\t\" + \"O(âˆ©_âˆ©)O\"; } /** * è¶…æ—¶è®¿é—®ï¼Œæ¼”ç¤ºé™çº§ * * @param id * @return */ @HystrixCommand(fallbackMethod = \"paymentInfo_TimeOutHandler\", commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"3000\") }) public String paymentInfo_TimeOut(Integer id) { int age = 10/0; try { TimeUnit.SECONDS.sleep (3); } catch (InterruptedException e) { e.printStackTrace ( ); } return \"çº¿ç¨‹æ± :\" + Thread.currentThread ( ).getName ( ) + \"paymentInfo_TimeOut,id: \" + id + \"\\t\" + \"O(âˆ©_âˆ©)Oï¼Œè€—è´¹3ç§’\"; } public String paymentInfo_TimeOutHandler(Integer id) { return \"/(ã„’oã„’)/è°ƒç”¨æ”¯ä»˜æ¥å£è¶…æ—¶æˆ–å¼‚å¸¸ï¼š\\t\" + \"\\tå½“å‰çº¿ç¨‹æ± åå­—\" + Thread.currentThread ( ).getName ( ); } } 2ã€@HystrixCommandæŠ¥å¼‚å¸¸åå¦‚ä½•å¤„ç†ä¸€æ—¦è°ƒç”¨æœåŠ¡æ–¹æ³•å¤±è´¥å¹¶æŠ›å‡ºäº†é”™è¯¯ä¿¡æ¯åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨@HystrixCommandæ ‡æ³¨å¥½çš„ fallbackMethodè°ƒç”¨ç±»ä¸­çš„æŒ‡å®šæ–¹æ³• 2ã€ä¸»å¯åŠ¨ç±»æ¿€æ´»æ·»åŠ æ–°æ³¨è§£@EnableCircuitBreaker 3ã€åˆ¶é€ é—®é¢˜ï¼šæµ‹è¯•é™çº§æ•ˆæœ ä¸Šå›¾æ•…æ„åˆ¶é€ ä¸¤ä¸ªå¼‚å¸¸ï¼š 1 int age = 10/0; è®¡ç®—å¼‚å¸¸ 2 æˆ‘ä»¬èƒ½æ¥å—3ç§’é’Ÿï¼Œå®ƒè¿è¡Œ5ç§’é’Ÿï¼Œè¶…æ—¶å¼‚å¸¸ã€‚ å½“å‰æœåŠ¡ä¸å¯ç”¨äº†ï¼ŒåšæœåŠ¡é™çº§ï¼Œå…œåº•çš„æ–¹æ¡ˆéƒ½æ˜¯ paymentInfo_TimeOutHandler æ— è®ºæ˜¯å»¶è¿ŸæŒ‡å®šæ—¶é—´è¿˜æ˜¯å¼‚å¸¸ï¼Œéƒ½ä¼šåˆ°å¯¹åº”æ–¹æ³•é™çº§ 4ã€80fallback1ã€è¯´æ˜80è®¢å•å¾®æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ›´å¥½çš„ä¿æŠ¤è‡ªå·±ï¼Œè‡ªå·±ä¹Ÿä¾æ ·ç”»è‘«èŠ¦è¿›è¡Œå®¢æˆ·ç«¯é™çº§ä¿æŠ¤ 2ã€æ³¨æ„ç‚¹æˆ‘ä»¬è‡ªå·±é…ç½®è¿‡çš„çƒ­éƒ¨ç½²æ–¹å¼å¯¹javaä»£ç çš„æ”¹åŠ¨æ˜æ˜¾ï¼Œä½†å¯¹@HystrixCommandå†…å±æ€§çš„ä¿®æ”¹å»ºè®®é‡å¯å¾®æœåŠ¡ 3ã€ymlfeign: hystrix: enabled: true server: port: 80 eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ feign: hystrix: enabled: true 4ã€ä¸»å¯åŠ¨@EnableHystrix package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.hystrix.EnableHystrix; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication @EnableFeignClients @EnableHystrix public class OrderHystrixMain80 { public static void main(String[] args) { SpringApplication.run (OrderHystrixMain80.class,args); } } 5ã€ä¸šåŠ¡ç±» @HystrixCommand(fallbackMethod = \"paymentTimeOutFallbackMethod\", commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"1500\") }) ------------------ public String paymentTimeOutFallbackMethod(@PathVariable(\"id\") Integer id) { return \"æˆ‘æ˜¯æ¶ˆè´¹è€…80,å¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,o(â•¥ï¹â•¥)o\"; } package com.kk.springcloud.controller; import com.kk.springcloud.service.PaymentHystrixService; import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand; import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController @Slf4j public class OrderHystirxController { @Resource private PaymentHystrixService paymentHystrixService; @GetMapping(\"/consumer/payment/hystrix/ok/{id}\") @HystrixCommand(fallbackMethod = \"paymentTimeOutFallbackMethod\", commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"1500\") }) public String paymentInfo_OK(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_OK (id); return result; } public String paymentTimeOutFallbackMethod(@PathVariable(\"id\") Integer id) { return \"æˆ‘æ˜¯æ¶ˆè´¹è€…80,å¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,o(â•¥ï¹â•¥)o\"; } @GetMapping(\"/consumer/payment/hystrix/timeout/{id}\") public String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_TimeOut (id); return result; } } 6ã€æµ‹è¯•urlï¼šhttp://localhost//consumer/payment/hystrix/ok/1 5ã€ç›®å‰é—®é¢˜ æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯¹åº”ä¸€ä¸ªå…œåº•çš„æ–¹æ³•ï¼Œä»£ç è†¨èƒ€ ç»Ÿä¸€å’Œè‡ªå®šä¹‰çš„åˆ†å¼€ 6ã€é—®é¢˜è§£å†³1ã€æ¯ä¸ªæ–¹æ³•é…ç½®ä¸€ä¸ªï¼Ÿï¼Ÿï¼Ÿè†¨èƒ€ï¼ˆfeignæ¥å£ç³»åˆ—ï¼‰@DefaultProperties(defaultFallback = \"\") æ¯ä¸ªæ–¹æ³•é…ç½®ä¸€ä¸ªæœåŠ¡é™çº§æ–¹æ³•ï¼ŒæŠ€æœ¯ä¸Šå¯ä»¥ï¼Œå®é™…ä¸Šå‚»X é™¤äº†ä¸ªåˆ«é‡è¦æ ¸å¿ƒä¸šåŠ¡æœ‰ä¸“å±ï¼Œå…¶å®ƒæ™®é€šçš„å¯ä»¥é€šè¿‡@DefaultProperties(defaultFallback = â€œâ€) ç»Ÿä¸€è·³è½¬åˆ°ç»Ÿä¸€å¤„ç†ç»“æœé¡µé¢ é€šç”¨çš„å’Œç‹¬äº«çš„å„è‡ªåˆ†å¼€ï¼Œé¿å…äº†ä»£ç è†¨èƒ€ï¼Œåˆç†å‡å°‘äº†ä»£ç é‡ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~ ----------------- @DefaultProperties(defaultFallback = \"payment_Global_FallbackMethod\") ----------------- @HystrixCommand //åŠ äº†@DefaultPropertieså±æ€§æ³¨è§£ï¼Œå¹¶ä¸”æ²¡æœ‰å†™å…·ä½“æ–¹æ³•åå­—ï¼Œå°±ç”¨ç»Ÿä¸€å…¨å±€çš„ ----------------- public String payment_Global_FallbackMethod() { return \"Globalå¼‚å¸¸å¤„ç†ä¿¡æ¯ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~\"; } package com.kk.springcloud.controller; import com.kk.springcloud.service.PaymentHystrixService; import com.netflix.hystrix.contrib.javanica.annotation.DefaultProperties; import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand; import com.netflix.hystrix.contrib.javanica.annotation.HystrixProperty; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController @Slf4j @DefaultProperties(defaultFallback = \"payment_Global_FallbackMethod\") public class OrderHystirxController { @Resource private PaymentHystrixService paymentHystrixService; @GetMapping(\"/consumer/payment/hystrix/ok/{id}\") @HystrixCommand(fallbackMethod = \"paymentTimeOutFallbackMethod\", commandProperties = { @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"1500\") }) public String paymentInfo_OK(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_OK (id); return result; } public String paymentTimeOutFallbackMethod(@PathVariable(\"id\") Integer id) { return \"æˆ‘æ˜¯æ¶ˆè´¹è€…80,å¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,o(â•¥ï¹â•¥)o\"; } @GetMapping(\"/consumer/payment/hystrix/timeout/{id}\") @HystrixCommand //åŠ äº†@DefaultPropertieså±æ€§æ³¨è§£ï¼Œå¹¶ä¸”æ²¡æœ‰å†™å…·ä½“æ–¹æ³•åå­—ï¼Œå°±ç”¨ç»Ÿä¸€å…¨å±€çš„ public String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id) { String result = paymentHystrixService.paymentInfo_TimeOut (id); return result; } public String payment_Global_FallbackMethod() { return \"Globalå¼‚å¸¸å¤„ç†ä¿¡æ¯ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~\"; } } 2ã€å’Œä¸šåŠ¡é€»è¾‘æ··ä¸€èµ·ï¼Ÿï¼Ÿï¼Ÿæ··ä¹±åŸå› ï¼šæœåŠ¡é™çº§ï¼Œå®¢æˆ·ç«¯å»è°ƒç”¨æœåŠ¡ç«¯ï¼Œç¢°ä¸ŠæœåŠ¡ç«¯å®•æœºæˆ–å…³é—­ æœ¬æ¬¡æ¡ˆä¾‹æœåŠ¡é™çº§å¤„ç†æ˜¯åœ¨å®¢æˆ·ç«¯80å®ç°å®Œæˆçš„ï¼Œä¸æœåŠ¡ç«¯8001æ²¡æœ‰å…³ç³»åªéœ€è¦ä¸ºFeignå®¢æˆ·ç«¯å®šä¹‰çš„æ¥å£æ·»åŠ ä¸€ä¸ªæœåŠ¡é™çº§å¤„ç†çš„å®ç°ç±»å³å¯å®ç°è§£è€¦ æœªæ¥æˆ‘ä»¬è¦é¢å¯¹çš„å¼‚å¸¸ è¿è¡Œ è¶…æ—¶ å®•æœº æ ¹æ®cloud-consumer-feign-hystrix-order80å·²ç»æœ‰çš„PaymentHystrixServiceæ¥å£ï¼Œé‡æ–°æ–°å»ºä¸€ä¸ªç±»(PaymentFallbackService)å®ç°è¯¥æ¥å£ï¼Œç»Ÿä¸€ä¸ºæ¥å£é‡Œé¢çš„æ–¹æ³•è¿›è¡Œå¼‚å¸¸å¤„ç† serviceç»Ÿä¸€å¤„ç†å¼‚å¸¸ä¸šåŠ¡ package com.kk.springcloud.service.impl; import com.kk.springcloud.service.PaymentHystrixService; import org.springframework.stereotype.Component; @Component public class PaymentFallbackService implements PaymentHystrixService { // å¦‚æœä¸‹æ¸¸çš„æœåŠ¡æ¥å£æŒ‚æ‰ï¼Œåˆ™è¿›å…¥è¿™ä¸ªå®ç°ç±» @Override public String paymentInfo_OK(Integer id) { return \"æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œæç¤ºæ¥è‡ªï¼šcloud-consumer-feign-order80\"; } @Override public String paymentInfo_TimeOut(Integer id) { return \"æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œæç¤ºæ¥è‡ªï¼šcloud-consumer-feign-order80\"; } } yml # ç”¨äºæœåŠ¡é™çº§ åœ¨æ³¨è§£@FeignClientä¸­æ·»åŠ fallbackFactoryå±æ€§å€¼ feign: hystrix: enabled: true #åœ¨Feignä¸­å¼€å¯Hystrix openFeignï¼šè°ƒç”¨ä¸‹æ¸¸çš„æ¥å£ fallback = PaymentFallbackService.class package com.kk.springcloud.service; import com.kk.springcloud.service.impl.PaymentFallbackService; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.stereotype.Component; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; @Component @FeignClient(value = \"CLOUD-PROVIDER-HYSTRIX-PAYMENT\",fallback = PaymentFallbackService.class) public interface PaymentHystrixService { @GetMapping(\"/payment/hystrix/ok/{id}\") String paymentInfo_OK(@PathVariable(\"id\") Integer id); @GetMapping(\"/payment/hystrix/timeout/{id}\") String paymentInfo_TimeOut(@PathVariable(\"id\") Integer id); } æµ‹è¯•ï¼šhttp://localhost/consumer/payment/hystrix/ok/1 æ­£å¸¸è®¿é—®ï¼š æ•…æ„å…³é—­å¾®æœåŠ¡8001åè®¿é—®ï¼š 3-2å®æˆ˜ï¼šæœåŠ¡ç†”æ–­1ã€æ–­è·¯å™¨ä¸€å¥è¯å°±æ˜¯å®¶é‡Œçš„ä¿é™©ä¸ 2ã€ç†”æ–­æ˜¯ä»€ä¹ˆç†”æ–­æœºåˆ¶æ¦‚è¿°ï¼šç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ã€‚å½“æ‰‡å‡ºé“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡å‡ºé”™ä¸å¯ç”¨æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡ŒæœåŠ¡çš„é™çº§ï¼Œè¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯ã€‚å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨å“åº”æ­£å¸¸åï¼Œæ¢å¤è°ƒç”¨é“¾è·¯ã€‚ åœ¨Spring Cloudæ¡†æ¶é‡Œï¼Œç†”æ–­æœºåˆ¶é€šè¿‡Hystrixå®ç°ã€‚Hystrixä¼šç›‘æ§å¾®æœåŠ¡é—´è°ƒç”¨çš„çŠ¶å†µï¼Œå½“å¤±è´¥çš„è°ƒç”¨åˆ°ä¸€å®šé˜ˆå€¼ï¼Œç¼ºçœæ˜¯5ç§’å†…20æ¬¡è°ƒç”¨å¤±è´¥ï¼Œå°±ä¼šå¯åŠ¨ç†”æ–­æœºåˆ¶ã€‚ç†”æ–­æœºåˆ¶çš„æ³¨è§£æ˜¯@HystrixCommandã€‚ 3ã€å®æ“ä¿®æ”¹cloud-provider-hystrix-payment8001 1ã€PaymentService//æœåŠ¡ç†”æ–­ @HystrixCommand(fallbackMethod = \"paymentCircuitBreaker_fallback\", commandProperties = { @HystrixProperty(name = \"circuitBreaker.enabled\", value = \"true\"),//æ˜¯å¦å¼€å¯æ–­è·¯å™¨ @HystrixProperty(name = \"circuitBreaker.requestVolumeThreshold\", value = \"10\"),//è¯·æ±‚æ¬¡æ•° @HystrixProperty(name = \"circuitBreaker.sleepWindowInMilliseconds\", value = \"10000\"),//æ—¶é—´èŒƒå›´ @HystrixProperty(name = \"circuitBreaker.errorThresholdPercentage\", value = \"60\"),//å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åè·³é—¸ }) public String paymentCircuitBreaker(@PathVariable(\"id\") Integer id) { if (id &lt; 0) { throw new RuntimeException (\"******id ä¸èƒ½è´Ÿæ•°\"); } String serialNumber = IdUtil.simpleUUID ( ); return Thread.currentThread ( ).getName ( ) + \"\\t\" + \"è°ƒç”¨æˆåŠŸï¼Œæµæ°´å·: \" + serialNumber; } public String paymentCircuitBreaker_fallback(@PathVariable(\"id\") Integer id) { return \"id ä¸èƒ½è´Ÿæ•°ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~ id: \" + id; } 2ã€PaymentController@GetMapping(\"/payment/circuit/{id}\") public String paymentCircuitBreaker(@PathVariable(\"id\") Integer id) { String result = paymentService.paymentCircuitBreaker (id); log.info (\"****result: \" + result); return result; } 4ã€æµ‹è¯•æ­£ç¡®ï¼šhttp://localhost:8001/payment/circuit/1 é”™è¯¯ï¼šhttp://localhost:8001/payment/circuit/-1 5ã€åŸç†(å°æ€»ç»“)1ã€ç†”æ–­ç±»å‹ ç†”æ–­æ‰“å¼€ è¯·æ±‚ä¸å†è¿›è¡Œè°ƒç”¨å½“å‰æœåŠ¡ï¼Œå†…éƒ¨è®¾ç½®æ—¶é’Ÿä¸€èˆ¬ä¸ºMTTRï¼ˆå¹³å‡æ•…éšœå¤„ç†æ—¶é—´)ï¼Œå½“æ‰“å¼€æ—¶é•¿è¾¾åˆ°æ‰€è®¾æ—¶é’Ÿåˆ™è¿›å…¥åŠç†”æ–­çŠ¶æ€ ç†”æ–­å…³é—­ ç†”æ–­å…³é—­ä¸ä¼šå¯¹æœåŠ¡è¿›è¡Œç†”æ–­ ç†”æ–­åŠå¼€ éƒ¨åˆ†è¯·æ±‚æ ¹æ®è§„åˆ™è°ƒç”¨å½“å‰æœåŠ¡ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸä¸”ç¬¦åˆè§„åˆ™åˆ™è®¤ä¸ºå½“å‰æœåŠ¡æ¢å¤æ­£å¸¸ï¼Œå…³é—­ç†”æ–­ 2ã€å®˜ç½‘æ–­è·¯å™¨æµç¨‹å›¾1ã€æ–­è·¯å™¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¼€å§‹èµ·ä½œç”¨æ¶‰åŠåˆ°æ–­è·¯å™¨çš„ä¸‰ä¸ªé‡è¦å‚æ•°ï¼šå¿«ç…§æ—¶é—´çª—ã€è¯·æ±‚æ€»æ•°é˜€å€¼ã€é”™è¯¯ç™¾åˆ†æ¯”é˜€å€¼ã€‚1ï¼šå¿«ç…§æ—¶é—´çª—ï¼šæ–­è·¯å™¨ç¡®å®šæ˜¯å¦æ‰“å¼€éœ€è¦ç»Ÿè®¡ä¸€äº›è¯·æ±‚å’Œé”™è¯¯æ•°æ®ï¼Œè€Œç»Ÿè®¡çš„æ—¶é—´èŒƒå›´å°±æ˜¯å¿«ç…§æ—¶é—´çª—ï¼Œé»˜è®¤ä¸ºæœ€è¿‘çš„10ç§’ã€‚ 2ï¼šè¯·æ±‚æ€»æ•°é˜€å€¼ï¼šåœ¨å¿«ç…§æ—¶é—´çª—å†…ï¼Œå¿…é¡»æ»¡è¶³è¯·æ±‚æ€»æ•°é˜€å€¼æ‰æœ‰èµ„æ ¼ç†”æ–­ã€‚é»˜è®¤ä¸º20ï¼Œæ„å‘³ç€åœ¨10ç§’å†…ï¼Œå¦‚æœè¯¥hystrixå‘½ä»¤çš„è°ƒç”¨æ¬¡æ•°ä¸è¶³20æ¬¡ï¼Œå³ä½¿æ‰€æœ‰çš„è¯·æ±‚éƒ½è¶…æ—¶æˆ–å…¶ä»–åŸå› å¤±è´¥ï¼Œæ–­è·¯å™¨éƒ½ä¸ä¼šæ‰“å¼€ã€‚ 3ï¼šé”™è¯¯ç™¾åˆ†æ¯”é˜€å€¼ï¼šå½“è¯·æ±‚æ€»æ•°åœ¨å¿«ç…§æ—¶é—´çª—å†…è¶…è¿‡äº†é˜€å€¼ï¼Œæ¯”å¦‚å‘ç”Ÿäº†30æ¬¡è°ƒç”¨ï¼Œå¦‚æœåœ¨è¿™30æ¬¡è°ƒç”¨ä¸­ï¼Œæœ‰15æ¬¡å‘ç”Ÿäº†è¶…æ—¶å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¶…è¿‡50%çš„é”™è¯¯ç™¾åˆ†æ¯”ï¼Œåœ¨é»˜è®¤è®¾å®š50%é˜€å€¼æƒ…å†µä¸‹ï¼Œè¿™æ—¶å€™å°±ä¼šå°†æ–­è·¯å™¨æ‰“å¼€ 2ã€æ–­è·¯å™¨å¼€å¯æˆ–è€…å…³é—­çš„æ¡ä»¶ å½“æ»¡è¶³ä¸€å®šçš„é˜€å€¼çš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡20ä¸ªè¯·æ±‚æ¬¡æ•°ï¼‰ å½“å¤±è´¥ç‡è¾¾åˆ°ä¸€å®šçš„æ—¶å€™ï¼ˆé»˜è®¤10ç§’å†…è¶…è¿‡50%çš„è¯·æ±‚å¤±è´¥ï¼‰ åˆ°è¾¾ä»¥ä¸Šé˜€å€¼ï¼Œæ–­è·¯å™¨å°†ä¼šå¼€å¯ å½“å¼€å¯çš„æ—¶å€™ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¸ä¼šè¿›è¡Œè½¬å‘ ä¸€æ®µæ—¶é—´ä¹‹åï¼ˆé»˜è®¤æ˜¯5ç§’ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æ–­è·¯å™¨æ˜¯åŠå¼€çŠ¶æ€ï¼Œä¼šè®©å…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¿›è¡Œè½¬å‘ã€‚å¦‚æœæˆåŠŸï¼Œæ–­è·¯å™¨ä¼šå…³é—­ï¼Œè‹¥å¤±è´¥ï¼Œç»§ç»­å¼€å¯ã€‚é‡å¤4å’Œ5 3ã€æ–­è·¯å™¨æ‰“å¼€ä¹‹å1ï¼šå†æœ‰è¯·æ±‚è°ƒç”¨çš„æ—¶å€™ï¼Œå°†ä¸ä¼šè°ƒç”¨ä¸»é€»è¾‘ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨é™çº§fallbackã€‚é€šè¿‡æ–­è·¯å™¨ï¼Œå®ç°äº†è‡ªåŠ¨åœ°å‘ç°é”™è¯¯å¹¶å°†é™çº§é€»è¾‘åˆ‡æ¢ä¸ºä¸»é€»è¾‘ï¼Œå‡å°‘å“åº”å»¶è¿Ÿçš„æ•ˆæœã€‚ 2ï¼šåŸæ¥çš„ä¸»é€»è¾‘è¦å¦‚ä½•æ¢å¤å‘¢ï¼Ÿå¯¹äºè¿™ä¸€é—®é¢˜ï¼Œhystrixä¹Ÿä¸ºæˆ‘ä»¬å®ç°äº†è‡ªåŠ¨æ¢å¤åŠŸèƒ½ã€‚å½“æ–­è·¯å™¨æ‰“å¼€ï¼Œå¯¹ä¸»é€»è¾‘è¿›è¡Œç†”æ–­ä¹‹åï¼Œhystrixä¼šå¯åŠ¨ä¸€ä¸ªä¼‘çœ æ—¶é—´çª—ï¼Œåœ¨è¿™ä¸ªæ—¶é—´çª—å†…ï¼Œé™çº§é€»è¾‘æ˜¯ä¸´æ—¶çš„æˆä¸ºä¸»é€»è¾‘ï¼Œå½“ä¼‘çœ æ—¶é—´çª—åˆ°æœŸï¼Œæ–­è·¯å™¨å°†è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œé‡Šæ”¾ä¸€æ¬¡è¯·æ±‚åˆ°åŸæ¥çš„ä¸»é€»è¾‘ä¸Šï¼Œå¦‚æœæ­¤æ¬¡è¯·æ±‚æ­£å¸¸è¿”å›ï¼Œé‚£ä¹ˆæ–­è·¯å™¨å°†ç»§ç»­é—­åˆï¼Œä¸»é€»è¾‘æ¢å¤ï¼Œå¦‚æœè¿™æ¬¡è¯·æ±‚ä¾ç„¶æœ‰é—®é¢˜ï¼Œæ–­è·¯å™¨ç»§ç»­è¿›å…¥æ‰“å¼€çŠ¶æ€ï¼Œä¼‘çœ æ—¶é—´çª—é‡æ–°è®¡æ—¶ã€‚ 4ã€â˜… Allé…ç½®//========================All @HystrixCommand(fallbackMethod = \"str_fallbackMethod\", groupKey = \"strGroupCommand\", commandKey = \"strCommand\", threadPoolKey = \"strThreadPool\", commandProperties = { // è®¾ç½®éš”ç¦»ç­–ç•¥ï¼ŒTHREAD è¡¨ç¤ºçº¿ç¨‹æ±  SEMAPHOREï¼šä¿¡å·æ± éš”ç¦» @HystrixProperty(name = \"execution.isolation.strategy\", value = \"THREAD\"), // å½“éš”ç¦»ç­–ç•¥é€‰æ‹©ä¿¡å·æ± éš”ç¦»çš„æ—¶å€™ï¼Œç”¨æ¥è®¾ç½®ä¿¡å·æ± çš„å¤§å°ï¼ˆæœ€å¤§å¹¶å‘æ•°ï¼‰ @HystrixProperty(name = \"execution.isolation.semaphore.maxConcurrentRequests\", value = \"10\"), // é…ç½®å‘½ä»¤æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´ @HystrixProperty(name = \"execution.isolation.thread.timeoutinMilliseconds\", value = \"10\"), // æ˜¯å¦å¯ç”¨è¶…æ—¶æ—¶é—´ @HystrixProperty(name = \"execution.timeout.enabled\", value = \"true\"), // æ‰§è¡Œè¶…æ—¶çš„æ—¶å€™æ˜¯å¦ä¸­æ–­ @HystrixProperty(name = \"execution.isolation.thread.interruptOnTimeout\", value = \"true\"), // æ‰§è¡Œè¢«å–æ¶ˆçš„æ—¶å€™æ˜¯å¦ä¸­æ–­ @HystrixProperty(name = \"execution.isolation.thread.interruptOnCancel\", value = \"true\"), // å…è®¸å›è°ƒæ–¹æ³•æ‰§è¡Œçš„æœ€å¤§å¹¶å‘æ•° @HystrixProperty(name = \"fallback.isolation.semaphore.maxConcurrentRequests\", value = \"10\"), // æœåŠ¡é™çº§æ˜¯å¦å¯ç”¨ï¼Œæ˜¯å¦æ‰§è¡Œå›è°ƒå‡½æ•° @HystrixProperty(name = \"fallback.enabled\", value = \"true\"), // æ˜¯å¦å¯ç”¨æ–­è·¯å™¨ @HystrixProperty(name = \"circuitBreaker.enabled\", value = \"true\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œæ–­è·¯å™¨ç†”æ–­çš„æœ€å°è¯·æ±‚æ•°ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤è¯¥å€¼ä¸º 20 çš„æ—¶å€™ï¼Œ // å¦‚æœæ»šåŠ¨æ—¶é—´çª—ï¼ˆé»˜è®¤10ç§’ï¼‰å†…ä»…æ”¶åˆ°äº†19ä¸ªè¯·æ±‚ï¼Œ å³ä½¿è¿™19ä¸ªè¯·æ±‚éƒ½å¤±è´¥äº†ï¼Œæ–­è·¯å™¨ä¹Ÿä¸ä¼šæ‰“å¼€ã€‚ @HystrixProperty(name = \"circuitBreaker.requestVolumeThreshold\", value = \"20\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œè¡¨ç¤ºåœ¨æ»šåŠ¨æ—¶é—´çª—ä¸­ï¼Œåœ¨è¯·æ±‚æ•°é‡è¶…è¿‡ // circuitBreaker.requestVolumeThreshold çš„æƒ…å†µä¸‹ï¼Œå¦‚æœé”™è¯¯è¯·æ±‚æ•°çš„ç™¾åˆ†æ¯”è¶…è¿‡50, // å°±æŠŠæ–­è·¯å™¨è®¾ç½®ä¸º \"æ‰“å¼€\" çŠ¶æ€ï¼Œå¦åˆ™å°±è®¾ç½®ä¸º \"å…³é—­\" çŠ¶æ€ã€‚ @HystrixProperty(name = \"circuitBreaker.errorThresholdPercentage\", value = \"50\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®å½“æ–­è·¯å™¨æ‰“å¼€ä¹‹åçš„ä¼‘çœ æ—¶é—´çª—ã€‚ ä¼‘çœ æ—¶é—´çª—ç»“æŸä¹‹åï¼Œ // ä¼šå°†æ–­è·¯å™¨ç½®ä¸º \"åŠå¼€\" çŠ¶æ€ï¼Œå°è¯•ç†”æ–­çš„è¯·æ±‚å‘½ä»¤ï¼Œå¦‚æœä¾ç„¶å¤±è´¥å°±å°†æ–­è·¯å™¨ç»§ç»­è®¾ç½®ä¸º \"æ‰“å¼€\" çŠ¶æ€ï¼Œ // å¦‚æœæˆåŠŸå°±è®¾ç½®ä¸º \"å…³é—­\" çŠ¶æ€ã€‚ @HystrixProperty(name = \"circuitBreaker.sleepWindowinMilliseconds\", value = \"5000\"), // æ–­è·¯å™¨å¼ºåˆ¶æ‰“å¼€ @HystrixProperty(name = \"circuitBreaker.forceOpen\", value = \"false\"), // æ–­è·¯å™¨å¼ºåˆ¶å…³é—­ @HystrixProperty(name = \"circuitBreaker.forceClosed\", value = \"false\"), // æ»šåŠ¨æ—¶é—´çª—è®¾ç½®ï¼Œè¯¥æ—¶é—´ç”¨äºæ–­è·¯å™¨åˆ¤æ–­å¥åº·åº¦æ—¶éœ€è¦æ”¶é›†ä¿¡æ¯çš„æŒç»­æ—¶é—´ @HystrixProperty(name = \"metrics.rollingStats.timeinMilliseconds\", value = \"10000\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®æ»šåŠ¨æ—¶é—´çª—ç»Ÿè®¡æŒ‡æ ‡ä¿¡æ¯æ—¶åˆ’åˆ†\"æ¡¶\"çš„æ•°é‡ï¼Œæ–­è·¯å™¨åœ¨æ”¶é›†æŒ‡æ ‡ä¿¡æ¯çš„æ—¶å€™ä¼šæ ¹æ® // è®¾ç½®çš„æ—¶é—´çª—é•¿åº¦æ‹†åˆ†æˆå¤šä¸ª \"æ¡¶\" æ¥ç´¯è®¡å„åº¦é‡å€¼ï¼Œæ¯ä¸ª\"æ¡¶\"è®°å½•äº†ä¸€æ®µæ—¶é—´å†…çš„é‡‡é›†æŒ‡æ ‡ã€‚ // æ¯”å¦‚ 10 ç§’å†…æ‹†åˆ†æˆ 10 ä¸ª\"æ¡¶\"æ”¶é›†è¿™æ ·ï¼Œæ‰€ä»¥ timeinMilliseconds å¿…é¡»èƒ½è¢« numBuckets æ•´é™¤ã€‚å¦åˆ™ä¼šæŠ›å¼‚å¸¸ @HystrixProperty(name = \"metrics.rollingStats.numBuckets\", value = \"10\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®å¯¹å‘½ä»¤æ‰§è¡Œçš„å»¶è¿Ÿæ˜¯å¦ä½¿ç”¨ç™¾åˆ†ä½æ•°æ¥è·Ÿè¸ªå’Œè®¡ç®—ã€‚å¦‚æœè®¾ç½®ä¸º false, é‚£ä¹ˆæ‰€æœ‰çš„æ¦‚è¦ç»Ÿè®¡éƒ½å°†è¿”å› -1ã€‚ @HystrixProperty(name = \"metrics.rollingPercentile.enabled\", value = \"false\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®ç™¾åˆ†ä½ç»Ÿè®¡çš„æ»šåŠ¨çª—å£çš„æŒç»­æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚ @HystrixProperty(name = \"metrics.rollingPercentile.timeInMilliseconds\", value = \"60000\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®ç™¾åˆ†ä½ç»Ÿè®¡æ»šåŠ¨çª—å£ä¸­ä½¿ç”¨ â€œ æ¡¶ â€çš„æ•°é‡ã€‚ @HystrixProperty(name = \"metrics.rollingPercentile.numBuckets\", value = \"60000\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯ä¸ª â€œæ¡¶â€ ä¸­ä¿ç•™çš„æœ€å¤§æ‰§è¡Œæ¬¡æ•°ã€‚å¦‚æœåœ¨æ»šåŠ¨æ—¶é—´çª—å†…å‘ç”Ÿè¶…è¿‡è¯¥è®¾å®šå€¼çš„æ‰§è¡Œæ¬¡æ•°ï¼Œ // å°±ä»æœ€åˆçš„ä½ç½®å¼€å§‹é‡å†™ã€‚ä¾‹å¦‚ï¼Œå°†è¯¥å€¼è®¾ç½®ä¸º100, æ»šåŠ¨çª—å£ä¸º10ç§’ï¼Œè‹¥åœ¨10ç§’å†…ä¸€ä¸ª â€œæ¡¶ â€ä¸­å‘ç”Ÿäº†500æ¬¡æ‰§è¡Œï¼Œ // é‚£ä¹ˆè¯¥ â€œæ¡¶â€ ä¸­åªä¿ç•™ æœ€åçš„100æ¬¡æ‰§è¡Œçš„ç»Ÿè®¡ã€‚å¦å¤–ï¼Œå¢åŠ è¯¥å€¼çš„å¤§å°å°†ä¼šå¢åŠ å†…å­˜é‡çš„æ¶ˆè€—ï¼Œå¹¶å¢åŠ æ’åºç™¾åˆ†ä½æ•°æ‰€éœ€çš„è®¡ç®—æ—¶é—´ã€‚ @HystrixProperty(name = \"metrics.rollingPercentile.bucketSize\", value = \"100\"), // è¯¥å±æ€§ç”¨æ¥è®¾ç½®é‡‡é›†å½±å“æ–­è·¯å™¨çŠ¶æ€çš„å¥åº·å¿«ç…§ï¼ˆè¯·æ±‚çš„æˆåŠŸã€ é”™è¯¯ç™¾åˆ†æ¯”ï¼‰çš„é—´éš”ç­‰å¾…æ—¶é—´ã€‚ @HystrixProperty(name = \"metrics.healthSnapshot.intervalinMilliseconds\", value = \"500\"), // æ˜¯å¦å¼€å¯è¯·æ±‚ç¼“å­˜ @HystrixProperty(name = \"requestCache.enabled\", value = \"true\"), // HystrixCommandçš„æ‰§è¡Œå’Œäº‹ä»¶æ˜¯å¦æ‰“å°æ—¥å¿—åˆ° HystrixRequestLog ä¸­ @HystrixProperty(name = \"requestLog.enabled\", value = \"true\"), }, threadPoolProperties = { // è¯¥å‚æ•°ç”¨æ¥è®¾ç½®æ‰§è¡Œå‘½ä»¤çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œè¯¥å€¼ä¹Ÿå°±æ˜¯å‘½ä»¤æ‰§è¡Œçš„æœ€å¤§å¹¶å‘é‡ @HystrixProperty(name = \"coreSize\", value = \"10\"), // è¯¥å‚æ•°ç”¨æ¥è®¾ç½®çº¿ç¨‹æ± çš„æœ€å¤§é˜Ÿåˆ—å¤§å°ã€‚å½“è®¾ç½®ä¸º -1 æ—¶ï¼Œçº¿ç¨‹æ± å°†ä½¿ç”¨ SynchronousQueue å®ç°çš„é˜Ÿåˆ—ï¼Œ // å¦åˆ™å°†ä½¿ç”¨ LinkedBlockingQueue å®ç°çš„é˜Ÿåˆ—ã€‚ @HystrixProperty(name = \"maxQueueSize\", value = \"-1\"), // è¯¥å‚æ•°ç”¨æ¥ä¸ºé˜Ÿåˆ—è®¾ç½®æ‹’ç»é˜ˆå€¼ã€‚ é€šè¿‡è¯¥å‚æ•°ï¼Œ å³ä½¿é˜Ÿåˆ—æ²¡æœ‰è¾¾åˆ°æœ€å¤§å€¼ä¹Ÿèƒ½æ‹’ç»è¯·æ±‚ã€‚ // è¯¥å‚æ•°ä¸»è¦æ˜¯å¯¹ LinkedBlockingQueue é˜Ÿåˆ—çš„è¡¥å……,å› ä¸º LinkedBlockingQueue // é˜Ÿåˆ—ä¸èƒ½åŠ¨æ€ä¿®æ”¹å®ƒçš„å¯¹è±¡å¤§å°ï¼Œè€Œé€šè¿‡è¯¥å±æ€§å°±å¯ä»¥è°ƒæ•´æ‹’ç»è¯·æ±‚çš„é˜Ÿåˆ—å¤§å°äº†ã€‚ @HystrixProperty(name = \"queueSizeRejectionThreshold\", value = \"5\"), } ) public String strConsumer() { return \"hello 2020\"; } public String str_fallbackMethod() { return \"*****fall back str_fallbackMethod\"; } 3-3å®æˆ˜ï¼šæœåŠ¡é™æµé‡‡ç”¨alibabaçš„Sentinelï¼Œåé¢æ‰©å±• 4ã€hystrixå·¥ä½œæµç¨‹ 1 åˆ›å»º HystrixCommandï¼ˆç”¨åœ¨ä¾èµ–çš„æœåŠ¡è¿”å›å•ä¸ªæ“ä½œç»“æœçš„æ—¶å€™ï¼‰ æˆ– HystrixObserableCommandï¼ˆç”¨åœ¨ä¾èµ–çš„æœåŠ¡è¿”å›å¤šä¸ªæ“ä½œç»“æœçš„æ—¶å€™ï¼‰ å¯¹è±¡ã€‚2 å‘½ä»¤æ‰§è¡Œã€‚å…¶ä¸­ HystrixComand å®ç°äº†ä¸‹é¢å‰ä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼›è€Œ HystrixObservableCommand å®ç°äº†åä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼šexecute()ï¼šåŒæ­¥æ‰§è¡Œï¼Œä»ä¾èµ–çš„æœåŠ¡è¿”å›ä¸€ä¸ªå•ä¸€çš„ç»“æœå¯¹è±¡ï¼Œ æˆ–æ˜¯åœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ã€‚queue()ï¼šå¼‚æ­¥æ‰§è¡Œï¼Œ ç›´æ¥è¿”å› ä¸€ä¸ªFutureå¯¹è±¡ï¼Œ å…¶ä¸­åŒ…å«äº†æœåŠ¡æ‰§è¡Œç»“æŸæ—¶è¦è¿”å›çš„å•ä¸€ç»“æœå¯¹è±¡ã€‚observe()ï¼šè¿”å› Observable å¯¹è±¡ï¼Œå®ƒä»£è¡¨äº†æ“ä½œçš„å¤šä¸ªç»“æœï¼Œå®ƒæ˜¯ä¸€ä¸ª Hot Obserableï¼ˆä¸è®º â€œäº‹ä»¶æºâ€ æ˜¯å¦æœ‰ â€œè®¢é˜…è€…â€ï¼Œéƒ½ä¼šåœ¨åˆ›å»ºåå¯¹äº‹ä»¶è¿›è¡Œå‘å¸ƒï¼Œæ‰€ä»¥å¯¹äº Hot Observable çš„æ¯ä¸€ä¸ª â€œè®¢é˜…è€…â€ éƒ½æœ‰å¯èƒ½æ˜¯ä» â€œäº‹ä»¶æºâ€ çš„ä¸­é€”å¼€å§‹çš„ï¼Œå¹¶å¯èƒ½åªæ˜¯çœ‹åˆ°äº†æ•´ä¸ªæ“ä½œçš„å±€éƒ¨è¿‡ç¨‹ï¼‰ã€‚toObservable()ï¼š åŒæ ·ä¼šè¿”å› Observable å¯¹è±¡ï¼Œä¹Ÿä»£è¡¨äº†æ“ä½œçš„å¤šä¸ªç»“æœï¼Œä½†å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªCold Observableï¼ˆæ²¡æœ‰ â€œè®¢é˜…è€…â€ çš„æ—¶å€™å¹¶ä¸ä¼šå‘å¸ƒäº‹ä»¶ï¼Œè€Œæ˜¯è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°æœ‰ â€œè®¢é˜…è€…â€ ä¹‹åæ‰å‘å¸ƒäº‹ä»¶ï¼Œæ‰€ä»¥å¯¹äº Cold Observable çš„è®¢é˜…è€…ï¼Œå®ƒå¯ä»¥ä¿è¯ä»ä¸€å¼€å§‹çœ‹åˆ°æ•´ä¸ªæ“ä½œçš„å…¨éƒ¨è¿‡ç¨‹ï¼‰ã€‚3 è‹¥å½“å‰å‘½ä»¤çš„è¯·æ±‚ç¼“å­˜åŠŸèƒ½æ˜¯è¢«å¯ç”¨çš„ï¼Œ å¹¶ä¸”è¯¥å‘½ä»¤ç¼“å­˜å‘½ä¸­ï¼Œ é‚£ä¹ˆç¼“å­˜çš„ç»“æœä¼šç«‹å³ä»¥ Observable å¯¹è±¡çš„å½¢å¼ è¿”å›ã€‚4 æ£€æŸ¥æ–­è·¯å™¨æ˜¯å¦ä¸ºæ‰“å¼€çŠ¶æ€ã€‚å¦‚æœæ–­è·¯å™¨æ˜¯æ‰“å¼€çš„ï¼Œé‚£ä¹ˆHystrixä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œè€Œæ˜¯è½¬æ¥åˆ° fallback å¤„ç†é€»è¾‘ï¼ˆç¬¬ 8 æ­¥ï¼‰ï¼›å¦‚æœæ–­è·¯å™¨æ˜¯å…³é—­çš„ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨èµ„æºæ¥æ‰§è¡Œå‘½ä»¤ï¼ˆç¬¬ 5 æ­¥ï¼‰ã€‚5 çº¿ç¨‹æ± /è¯·æ±‚é˜Ÿåˆ—/ä¿¡å·é‡æ˜¯å¦å æ»¡ã€‚å¦‚æœå‘½ä»¤ä¾èµ–æœåŠ¡çš„ä¸“æœ‰çº¿ç¨‹æ± å’Œè¯·æ±‚é˜Ÿåˆ—ï¼Œæˆ–è€…ä¿¡å·é‡ï¼ˆä¸ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ï¼‰å·²ç»è¢«å æ»¡ï¼Œ é‚£ä¹ˆ Hystrix ä¹Ÿä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œ è€Œæ˜¯è½¬æ¥åˆ° fallback å¤„ç†é€»è¾‘ï¼ˆç¬¬8æ­¥ï¼‰ã€‚6 Hystrix ä¼šæ ¹æ®æˆ‘ä»¬ç¼–å†™çš„æ–¹æ³•æ¥å†³å®šé‡‡å–ä»€ä¹ˆæ ·çš„æ–¹å¼å»è¯·æ±‚ä¾èµ–æœåŠ¡ã€‚HystrixCommand.run() ï¼šè¿”å›ä¸€ä¸ªå•ä¸€çš„ç»“æœï¼Œæˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚HystrixObservableCommand.construct()ï¼š è¿”å›ä¸€ä¸ªObservable å¯¹è±¡æ¥å‘å°„å¤šä¸ªç»“æœï¼Œæˆ–é€šè¿‡ onError å‘é€é”™è¯¯é€šçŸ¥ã€‚7 Hystrixä¼šå°† â€œæˆåŠŸâ€ã€â€å¤±è´¥â€ã€â€æ‹’ç»â€ã€â€è¶…æ—¶â€ ç­‰ä¿¡æ¯æŠ¥å‘Šç»™æ–­è·¯å™¨ï¼Œ è€Œæ–­è·¯å™¨ä¼šç»´æŠ¤ä¸€ç»„è®¡æ•°å™¨æ¥ç»Ÿè®¡è¿™äº›æ•°æ®ã€‚æ–­è·¯å™¨ä¼šä½¿ç”¨è¿™äº›ç»Ÿè®¡æ•°æ®æ¥å†³å®šæ˜¯å¦è¦å°†æ–­è·¯å™¨æ‰“å¼€ï¼Œæ¥å¯¹æŸä¸ªä¾èµ–æœåŠ¡çš„è¯·æ±‚è¿›è¡Œ â€œç†”æ–­/çŸ­è·¯â€ã€‚8 å½“å‘½ä»¤æ‰§è¡Œå¤±è´¥çš„æ—¶å€™ï¼Œ Hystrix ä¼šè¿›å…¥ fallback å°è¯•å›é€€å¤„ç†ï¼Œ æˆ‘ä»¬é€šå¸¸ä¹Ÿç§°è¯¥æ“ä½œä¸º â€œæœåŠ¡é™çº§â€ã€‚è€Œèƒ½å¤Ÿå¼•èµ·æœåŠ¡é™çº§å¤„ç†çš„æƒ…å†µæœ‰ä¸‹é¢å‡ ç§ï¼šç¬¬4æ­¥ï¼š å½“å‰å‘½ä»¤å¤„äºâ€ç†”æ–­/çŸ­è·¯â€çŠ¶æ€ï¼Œæ–­è·¯å™¨æ˜¯æ‰“å¼€çš„æ—¶å€™ã€‚ç¬¬5æ­¥ï¼š å½“å‰å‘½ä»¤çš„çº¿ç¨‹æ± ã€ è¯·æ±‚é˜Ÿåˆ—æˆ– è€…ä¿¡å·é‡è¢«å æ»¡çš„æ—¶å€™ã€‚ç¬¬6æ­¥ï¼šHystrixObservableCommand.construct() æˆ– HystrixCommand.run() æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ã€‚9 å½“Hystrixå‘½ä»¤æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œ å®ƒä¼šå°†å¤„ç†ç»“æœç›´æ¥è¿”å›æˆ–æ˜¯ä»¥Observable çš„å½¢å¼è¿”å›ã€‚ tipsï¼šå¦‚æœæˆ‘ä»¬æ²¡æœ‰ä¸ºå‘½ä»¤å®ç°é™çº§é€»è¾‘æˆ–è€…åœ¨é™çº§å¤„ç†é€»è¾‘ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œ Hystrix ä¾ç„¶ä¼šè¿”å›ä¸€ä¸ª Observable å¯¹è±¡ï¼Œ ä½†æ˜¯å®ƒä¸ä¼šå‘å°„ä»»ä½•ç»“æœæ•°æ®ï¼Œ è€Œæ˜¯é€šè¿‡ onError æ–¹æ³•é€šçŸ¥å‘½ä»¤ç«‹å³ä¸­æ–­è¯·æ±‚ï¼Œå¹¶é€šè¿‡onError()æ–¹æ³•å°†å¼•èµ·å‘½ä»¤å¤±è´¥çš„å¼‚å¸¸å‘é€ç»™è°ƒç”¨è€…ã€‚ 5ã€æœåŠ¡ç›‘æ§HystrixDashboard1ã€æ¦‚è¿°é™¤äº†éš”ç¦»ä¾èµ–æœåŠ¡çš„è°ƒç”¨ä»¥å¤–ï¼ŒHystrixè¿˜æä¾›äº†å‡†å®æ—¶çš„è°ƒç”¨ç›‘æ§ï¼ˆHystrix Dashboardï¼‰ï¼ŒHystrixä¼šæŒç»­åœ°è®°å½•æ‰€æœ‰é€šè¿‡Hystrixå‘èµ·çš„è¯·æ±‚çš„æ‰§è¡Œä¿¡æ¯ï¼Œå¹¶ä»¥ç»Ÿè®¡æŠ¥è¡¨å’Œå›¾å½¢çš„å½¢å¼å±•ç¤ºç»™ç”¨æˆ·ï¼ŒåŒ…æ‹¬æ¯ç§’æ‰§è¡Œå¤šå°‘è¯·æ±‚å¤šå°‘æˆåŠŸï¼Œå¤šå°‘å¤±è´¥ç­‰ã€‚Netflixé€šè¿‡hystrix-metrics-event-streamé¡¹ç›®å®ç°äº†å¯¹ä»¥ä¸ŠæŒ‡æ ‡çš„ç›‘æ§ã€‚Spring Cloudä¹Ÿæä¾›äº†Hystrix Dashboardçš„æ•´åˆï¼Œå¯¹ç›‘æ§å†…å®¹è½¬åŒ–æˆå¯è§†åŒ–ç•Œé¢ã€‚ 2ã€ä»ªè¡¨ç›˜90011ã€å»ºmodelæ–°å»ºcloud-consumer-hystrix-dashboard9001 2ã€POM&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt; &lt;/dependency&gt; &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumer-hystrix-dashboard9001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 9001 4ã€@EnableHystrixDashboardpackage com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard; @SpringBootApplication @EnableHystrixDashboard public class HystrixDashboardMain9001 { public static void main(String[] args) { SpringApplication.run (HystrixDashboardMain9001.class,args); } } 5ã€æ‰€æœ‰Providerå¾®æœåŠ¡æä¾›ç±»(8001/8002/8003)éƒ½éœ€è¦ç›‘æ§ä¾èµ–é…ç½® &lt;!-- actuatorç›‘æ§ä¿¡æ¯å®Œå–„ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; 6ã€è¿›å…¥é¢æ¿http://localhost:9001/hystrix 3ã€æ–­è·¯å™¨æ¼”ç¤º(æœåŠ¡ç›‘æ§hystrixDashboard)1ã€ä¿®æ”¹cloud-provider-hystrix-payment80011ã€æ³¨æ„æ–°ç‰ˆæœ¬æ³¨æ„:æ–°ç‰ˆæœ¬Hystrixéœ€è¦åœ¨ä¸»å¯åŠ¨ç±»MainAppHystrix8001ä¸­æŒ‡å®šç›‘æ§è·¯å¾„ æŠ¥é”™ä¿¡æ¯ï¼šUnable to connect to Command Metric Stream. /** *æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloudå‡çº§åçš„å‘ *ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯\"/hystrix.stream\"ï¼Œ *åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„servletå°±å¯ä»¥äº† */ @Bean public ServletRegistrationBean getServlet() { HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet(); ServletRegistrationBean registrationBean = new ServletRegistrationBean(streamServlet); registrationBean.setLoadOnStartup(1); registrationBean.addUrlMappings(\"/hystrix.stream\"); registrationBean.setName(\"HystrixMetricsStreamServlet\"); return registrationBean; } package com.kk.springcloud; import com.netflix.hystrix.contrib.metrics.eventstream.HystrixMetricsStreamServlet; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.web.servlet.ServletRegistrationBean; import org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; import org.springframework.context.annotation.Bean; @SpringBootApplication @EnableEurekaClient //æœ¬æœåŠ¡å¯åŠ¨åä¼šè‡ªåŠ¨æ³¨å†Œè¿›eurekaæœåŠ¡ä¸­ @EnableCircuitBreaker public class PaymentHystrixMain8001 { public static void main(String[] args) { SpringApplication.run (PaymentHystrixMain8001.class, args); } /** * æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloudå‡çº§åçš„å‘ * ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯\"/hystrix.stream\"ï¼Œ * åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„servletå°±å¯ä»¥äº† */ @Bean public ServletRegistrationBean getServlet() { HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet ( ); ServletRegistrationBean registrationBean = new ServletRegistrationBean (streamServlet); registrationBean.setLoadOnStartup (1); registrationBean.addUrlMappings (\"/hystrix.stream\"); registrationBean.setName (\"HystrixMetricsStreamServlet\"); return registrationBean; } } 2ã€ç›‘æ§æµ‹è¯•1ã€9001ç›‘æ§8001http://localhost:8001/hystrix.stream 1ï¼šDelayï¼šè¯¥å‚æ•°ç”¨æ¥æ§åˆ¶æœåŠ¡å™¨ä¸Šè½®è¯¢ç›‘æ§ä¿¡æ¯çš„å»¶è¿Ÿæ—¶é—´ï¼Œé»˜è®¤ä¸º2000æ¯«ç§’ï¼Œå¯ä»¥é€šè¿‡é…ç½®è¯¥å±æ€§æ¥é™ä½å®¢æˆ·ç«¯çš„ç½‘ç»œå’ŒCPUæ¶ˆè€—ã€‚ 2ï¼šTitleï¼šè¯¥å‚æ•°å¯¹åº”äº†å¤´éƒ¨æ ‡é¢˜Hystrix Streamä¹‹åçš„å†…å®¹ï¼Œé»˜è®¤ä¼šä½¿ç”¨å…·ä½“ç›‘æ§å®ä¾‹çš„URLï¼Œå¯ä»¥é€šè¿‡é…ç½®è¯¥ä¿¡æ¯æ¥å±•ç¤ºæ›´åˆé€‚çš„æ ‡é¢˜ã€‚ 2ã€è®¿é—®æ­£ç¡®ï¼šhttp://localhost:8001/payment/circuit/1 é”™è¯¯ï¼šhttp://localhost:8001/payment/circuit/-1 3ã€â˜… å¦‚ä½•çœ‹ä»ªè¡¨ç›˜ 4ã€ææ‡‚ä¸€ä¸ªæ‰èƒ½çœ‹æ‡‚å¤æ‚çš„","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"netflix","slug":"netflix","permalink":"https://mykkto.github.io/tags/netflix/"},{"name":"æ–­è·¯å™¨","slug":"æ–­è·¯å™¨","permalink":"https://mykkto.github.io/tags/%E6%96%AD%E8%B7%AF%E5%99%A8/"},{"name":"Hystrix","slug":"Hystrix","permalink":"https://mykkto.github.io/tags/Hystrix/"}],"author":"mykk"},{"title":"SpringCloud-OpenFeignè¿œç¨‹è°ƒç”¨æœåŠ¡","slug":"03javaDistributed/01springcloud/06_SpringCloud_OpenFeign","date":"2022-01-21T13:32:13.000Z","updated":"2022-01-25T15:12:13.313Z","comments":true,"path":"posts/a723ac51.html","link":"","permalink":"https://mykkto.github.io/posts/a723ac51.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€æ˜¯ä»€ä¹ˆhttps://github.com/spring-cloud/spring-cloud-openfeign Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„WebæœåŠ¡å®¢æˆ·ç«¯ï¼Œè®©ç¼–å†™WebæœåŠ¡å®¢æˆ·ç«¯å˜å¾—éå¸¸å®¹æ˜“ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶åœ¨æ¥å£ä¸Šæ·»åŠ æ³¨è§£å³å¯ 2ã€èƒ½å¹²å˜›1ã€ Feignèƒ½å¹²ä»€ä¹ˆFeignæ—¨åœ¨ä½¿ç¼–å†™Java Httpå®¢æˆ·ç«¯å˜å¾—æ›´å®¹æ˜“ã€‚å‰é¢åœ¨ä½¿ç”¨Ribbon+RestTemplateæ—¶ï¼Œåˆ©ç”¨RestTemplateå¯¹httpè¯·æ±‚çš„å°è£…å¤„ç†ï¼Œå½¢æˆäº†ä¸€å¥—æ¨¡ç‰ˆåŒ–çš„è°ƒç”¨æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œç”±äºå¯¹æœåŠ¡ä¾èµ–çš„è°ƒç”¨å¯èƒ½ä¸æ­¢ä¸€å¤„ï¼Œå¾€å¾€ä¸€ä¸ªæ¥å£ä¼šè¢«å¤šå¤„è°ƒç”¨ï¼Œæ‰€ä»¥é€šå¸¸éƒ½ä¼šé’ˆå¯¹æ¯ä¸ªå¾®æœåŠ¡è‡ªè¡Œå°è£…ä¸€äº›å®¢æˆ·ç«¯ç±»æ¥åŒ…è£…è¿™äº›ä¾èµ–æœåŠ¡çš„è°ƒç”¨ã€‚æ‰€ä»¥ï¼ŒFeignåœ¨æ­¤åŸºç¡€ä¸Šåšäº†è¿›ä¸€æ­¥å°è£…ï¼Œç”±ä»–æ¥å¸®åŠ©æˆ‘ä»¬å®šä¹‰å’Œå®ç°ä¾èµ–æœåŠ¡æ¥å£çš„å®šä¹‰ã€‚åœ¨Feignçš„å®ç°ä¸‹ï¼Œæˆ‘ä»¬åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®å®ƒ(ä»¥å‰æ˜¯Daoæ¥å£ä¸Šé¢æ ‡æ³¨Mapperæ³¨è§£,ç°åœ¨æ˜¯ä¸€ä¸ªå¾®æœåŠ¡æ¥å£ä¸Šé¢æ ‡æ³¨ä¸€ä¸ªFeignæ³¨è§£å³å¯)ï¼Œå³å¯å®Œæˆå¯¹æœåŠ¡æä¾›æ–¹çš„æ¥å£ç»‘å®šï¼Œç®€åŒ–äº†ä½¿ç”¨Spring cloud Ribbonæ—¶ï¼Œè‡ªåŠ¨å°è£…æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯çš„å¼€å‘é‡ã€‚ 2ã€Feigné›†æˆäº†Ribbonåˆ©ç”¨Ribbonç»´æŠ¤äº†Paymentçš„æœåŠ¡åˆ—è¡¨ä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡è½®è¯¢å®ç°äº†å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ã€‚è€Œä¸Ribbonä¸åŒçš„æ˜¯ï¼Œé€šè¿‡feignåªéœ€è¦å®šä¹‰æœåŠ¡ç»‘å®šæ¥å£ä¸”ä»¥å£°æ˜å¼çš„æ–¹æ³•ï¼Œä¼˜é›…è€Œç®€å•çš„å®ç°äº†æœåŠ¡è°ƒç”¨ 3ã€åŒºåˆ«1ã€feignFeignæ˜¯Spring Cloudç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯Feignå†…ç½®äº†Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚Feignçš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼šä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-feign&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€openfeignOpenFeignæ˜¯Spring Cloud åœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†SpringMVCçš„æ³¨è§£ï¼Œå¦‚@RequesMappingç­‰ç­‰ã€‚OpenFeignçš„@FeignClientå¯ä»¥è§£æSpringMVCçš„@RequestMappingæ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€OpenFeignä½¿ç”¨æ­¥éª¤1ã€å»ºmodelæ–°å»ºcloud-consumer-feign-order80 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumer-feign-order80&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--openfeign--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--eureka client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--web--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬åŸºç¡€é€šç”¨é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ymlserver: port: 80 eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication @EnableFeignClients public class OrderFeignMain80 { public static void main(String[] args) { SpringApplication.run (OrderFeignMain80.class,args); } } 5ã€ä¸šåŠ¡ç±»1ã€æ–°å»ºPaymentFeignServiceæ¥å£å¹¶æ–°å¢æ³¨è§£@FeignClientpackage com.kk.springcloud.service; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import org.springframework.cloud.openfeign.FeignClient; import org.springframework.stereotype.Component; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; @Component @FeignClient(value = \"CLOUD-PAYMENT-SERVICE\") public interface PaymentFeignService { @GetMapping(value = \"/payment/get/{id}\") CommonResult&lt;Payment&gt; getPaymentById(@PathVariable(\"id\") Long id); } 2ã€æ§åˆ¶å±‚Controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import com.kk.springcloud.service.PaymentFeignService; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController public class OrderFeignController { @Resource private PaymentFeignService paymentFeignService; @GetMapping(value = \"consumer/payment/get/{id}\") public CommonResult&lt;Payment&gt; getPaymentById(@PathVariable(\"id\") Long id){ return paymentFeignService.getPaymentById (id); } } 6ã€æµ‹è¯•1ã€å¯åŠ¨é¡ºåº å¯åŠ¨ 7001/7002 eurekaé›†ç¾¤ å¯åŠ¨ 8001/8002 ç”Ÿäº§è€…é›†ç¾¤ å¯åŠ¨ OpenFeign:80 æ¶ˆè´¹è€… 2ã€è®¿é—®http://localhost/consumer/payment/get/1 3ã€Feignè‡ªå¸¦è´Ÿè½½å‡è¡¡é…ç½®é¡¹ 7ã€å°ç»“ 3ã€OpenFeignè¶…æ—¶æ§åˆ¶1ã€æ¨¡æ‹Ÿè¶…æ—¶è¶…æ—¶è®¾ç½®ï¼Œæ•…æ„è®¾ç½®è¶…æ—¶æ¼”ç¤ºå‡ºé”™æƒ…å†µ 1ã€æœåŠ¡æä¾›æ–¹8001æ•…æ„å†™æš‚åœç¨‹åºcom.kk.springcloud.controller.PaymentController; @GetMapping(value = \"/payment/feign/timeout\") public String paymentFeignTimeOut() { System.out.println (\"*****paymentFeignTimeOut from port: \" + serverPort); //æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹ try { TimeUnit.SECONDS.sleep (3); } catch (InterruptedException e) { e.printStackTrace ( ); } return serverPort; } 2ã€æœåŠ¡æ¶ˆè´¹æ–¹80æ·»åŠ è¶…æ—¶æ–¹æ³•PaymentFeignServicecom.kk.springcloud.service.PaymentFeignService @GetMapping(value = \"/payment/feign/timeout\") String paymentFeignTimeOut(); 3ã€æœåŠ¡æ¶ˆè´¹æ–¹80æ·»åŠ è¶…æ—¶æ–¹æ³•OrderFeignControllercom.kk.springcloud.controller.OrderFeignController @GetMapping(value = \"/consumer/payment/feign/timeout\") public String paymentFeignTimeOut() { return paymentFeignService.paymentFeignTimeOut ( ); } 4ã€æµ‹è¯•urlï¼šhttp://localhost/consumer/payment/feign/timeout 5ã€å°ç»“OpenFeigné»˜è®¤ç­‰å¾…1ç§’é’Ÿï¼Œè¶…è¿‡åæŠ¥é”™ 2ã€æ˜¯ä»€ä¹ˆ1ã€æ¦‚è¿°é»˜è®¤Feignå®¢æˆ·ç«¯åªç­‰å¾…ä¸€ç§’é’Ÿï¼Œä½†æ˜¯æœåŠ¡ç«¯å¤„ç†éœ€è¦è¶…è¿‡1ç§’é’Ÿï¼Œå¯¼è‡´Feignå®¢æˆ·ç«¯ä¸æƒ³ç­‰å¾…äº†ï¼Œç›´æ¥è¿”å›æŠ¥é”™ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„æƒ…å†µï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦è®¾ç½®Feignå®¢æˆ·ç«¯çš„è¶…æ—¶æ§åˆ¶ã€‚ 2ã€é»˜è®¤æ”¯æŒRibbon 3ã€è¶…æ—¶æ—¶é—´é…ç½®#è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒribbon) ribbon: #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´ ReadTimeout: 5000 #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´ ConnectTimeout: 5000 4ã€OpenFeignæ—¥å¿—æ‰“å°åŠŸèƒ½1ã€æ˜¯ä»€ä¹ˆFeign æä¾›äº†æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ¥è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼Œä»è€Œäº†è§£ Feign ä¸­ Http è¯·æ±‚çš„ç»†èŠ‚ã€‚è¯´ç™½äº†å°±æ˜¯å¯¹Feignæ¥å£çš„è°ƒç”¨æƒ…å†µè¿›è¡Œç›‘æ§å’Œè¾“å‡º 2ã€æ—¥å¿—çº§åˆ« NONEï¼šé»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—ï¼› BASICï¼šä»…è®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç åŠæ‰§è¡Œæ—¶é—´ï¼› HEADERSï¼šé™¤äº† BASIC ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯ï¼› FULLï¼šé™¤äº† HEADERS ä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®ã€‚ 3ã€é…ç½®æ—¥å¿— beanpackage com.kk.springcloud.config; import feign.Logger; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class OpenFeignConfig { @Configuration public class FeignConfig { @Bean Logger.Level feignLoggerLevel() { return Logger.Level.FULL; } } } 4ã€ymlä¸­é…ç½®logging: level: # feignæ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£ com.kk.springcloud.service.PaymentFeignService: debug server: port: 80 eureka: client: register-with-eureka: false service-url: defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/ #è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒribbon) ribbon: #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´ ReadTimeout: 5000 #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´ ConnectTimeout: 5000 logging: level: # feignæ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£ com.kk.springcloud.service.PaymentFeignService: debug 5ã€åå°å¯åŠ¨æŸ¥çœ‹","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"netflix","slug":"netflix","permalink":"https://mykkto.github.io/tags/netflix/"},{"name":"è¿œç¨‹è°ƒç”¨æœåŠ¡","slug":"è¿œç¨‹è°ƒç”¨æœåŠ¡","permalink":"https://mykkto.github.io/tags/%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1/"},{"name":"openfeign","slug":"openfeign","permalink":"https://mykkto.github.io/tags/openfeign/"}],"author":"mykk"},{"title":"SpringCloud- Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡","slug":"03javaDistributed/01springcloud/05_SpringCloud_Ribbon","date":"2022-01-17T14:42:11.000Z","updated":"2022-01-19T15:44:00.931Z","comments":true,"path":"posts/9091e07b.html","link":"","permalink":"https://mykkto.github.io/posts/9091e07b.html","excerpt":"","text":"1ã€æ¦‚è¿°1ã€æ˜¯ä»€ä¹ˆ Spring Cloud Ribbonæ˜¯åŸºäºNetflix Ribbonå®ç°çš„ä¸€å¥—å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å·¥å…·ã€‚ ç®€å•çš„è¯´ï¼ŒRibbonæ˜¯Netflixå‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨ã€‚Ribbonå®¢æˆ·ç«¯ç»„ä»¶æä¾›ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹å¦‚è¿æ¥è¶…æ—¶ï¼Œé‡è¯•ç­‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºLoad Balancerï¼ˆç®€ç§°LBï¼‰åé¢æ‰€æœ‰çš„æœºå™¨ï¼ŒRibbonä¼šè‡ªåŠ¨çš„å¸®åŠ©ä½ åŸºäºæŸç§è§„åˆ™ï¼ˆå¦‚ç®€å•è½®è¯¢ï¼Œéšæœºè¿æ¥ç­‰ï¼‰å»è¿æ¥è¿™äº›æœºå™¨ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“ä½¿ç”¨Ribbonå®ç°è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚ 2ã€å®˜ç½‘èµ„æ–™1ã€æ–‡æ¡£https://github.com/Netflix/ribbon/wiki/Getting-Started 2ã€Ribbonç›®å‰ä¹Ÿè¿›å…¥ç»´æŠ¤æ¨¡å¼ æœªæ¥æ›¿æ¢æ–¹æ¡ˆï¼š 3ã€èƒ½å¹²å—1ã€LBï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ç®€å•çš„è¯´å°±æ˜¯å°†ç”¨æˆ·çš„è¯·æ±‚å¹³æ‘Šçš„åˆ†é…åˆ°å¤šä¸ªæœåŠ¡ä¸Šï¼Œä»è€Œè¾¾åˆ°ç³»ç»Ÿçš„HAï¼ˆé«˜å¯ç”¨ï¼‰ã€‚å¸¸è§çš„è´Ÿè½½å‡è¡¡æœ‰è½¯ä»¶Nginxï¼ŒLVSï¼Œç¡¬ä»¶ F5ç­‰ã€‚ æ€»ç»“ï¼šRibbon = è´Ÿè½½å‡è¡¡+RestTemplateè°ƒç”¨ 2ã€åŒºåˆ«ï¼ˆribbon VS nginxï¼‰ Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨è°ƒç”¨å¾®æœåŠ¡æ¥å£æ—¶å€™ï¼Œä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ°JVMæœ¬åœ°ï¼Œä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æŠ€æœ¯ã€‚ 3ã€åˆ’åˆ†1ã€é›†ä¸­å¼LB å³åœ¨æœåŠ¡çš„æ¶ˆè´¹æ–¹å’Œæä¾›æ–¹ä¹‹é—´ä½¿ç”¨ç‹¬ç«‹çš„LBè®¾æ–½(å¯ä»¥æ˜¯ç¡¬ä»¶ï¼Œå¦‚F5, ä¹Ÿå¯ä»¥æ˜¯è½¯ä»¶ï¼Œå¦‚nginx), ç”±è¯¥è®¾æ–½è´Ÿè´£æŠŠè®¿é—®è¯·æ±‚é€šè¿‡æŸç§ç­–ç•¥è½¬å‘è‡³æœåŠ¡çš„æä¾›æ–¹ï¼› 2ã€è¿›ç¨‹å†…LB å°†LBé€»è¾‘é›†æˆåˆ°æ¶ˆè´¹æ–¹ï¼Œæ¶ˆè´¹æ–¹ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·çŸ¥æœ‰å“ªäº›åœ°å€å¯ç”¨ï¼Œç„¶åè‡ªå·±å†ä»è¿™äº›åœ°å€ä¸­é€‰æ‹©å‡ºä¸€ä¸ªåˆé€‚çš„æœåŠ¡å™¨ã€‚ Ribbonå°±å±äºè¿›ç¨‹å†…LBï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç±»åº“ï¼Œé›†æˆäºæ¶ˆè´¹æ–¹è¿›ç¨‹ï¼Œæ¶ˆè´¹æ–¹é€šè¿‡å®ƒæ¥è·å–åˆ°æœåŠ¡æä¾›æ–¹çš„åœ°å€ã€‚ 2ã€Ribbonæ¡ˆä¾‹1ã€æ¶æ„è¯´æ˜ Ribbonåœ¨å·¥ä½œæ—¶åˆ†æˆä¸¤æ­¥ ç¬¬ä¸€æ­¥å…ˆé€‰æ‹© EurekaServer ,å®ƒä¼˜å…ˆé€‰æ‹©åœ¨åŒä¸€ä¸ªåŒºåŸŸå†…è´Ÿè½½è¾ƒå°‘çš„server. ç¬¬äºŒæ­¥å†æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥ï¼Œåœ¨ä»serverå–åˆ°çš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåœ°å€ã€‚å…¶ä¸­Ribbonæä¾›äº†å¤šç§ç­–ç•¥ï¼šæ¯”å¦‚è½®è¯¢ã€éšæœºå’Œæ ¹æ®å“åº”æ—¶é—´åŠ æƒã€‚ æ€»ç»“ï¼šRibbonå…¶å®å°±æ˜¯ä¸€ä¸ªè½¯è´Ÿè½½å‡è¡¡çš„å®¢æˆ·ç«¯ç»„ä»¶ï¼Œä»–å¯ä»¥å’Œå…¶ä»–æ‰€éœ€è¯·æ±‚çš„å®¢æˆ·ç«¯ç»“åˆä½¿ç”¨ï¼Œå’Œeurekaç»“åˆåªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå®ä¾‹ã€‚ 2ã€POM1ã€åæ ‡&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt; &lt;/dependency&gt; 2ã€eureka-client è‡ªå¸¦ ribbonè¯æ˜å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°spring-cloud-starter-netflix-eureka-client ç¡®å®å¼•å…¥äº†Ribbon 3ã€äºŒè¯´RestTemplateçš„ä½¿ç”¨1ã€å®˜ç½‘https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html 2ã€getForObjectæ–¹æ³•/getForEntityï¼ˆè¯»ï¼‰ è¿”å›å¯¹è±¡ä¸ºå“åº”ä½“ä¸­æ•°æ®è½¬åŒ–æˆçš„å¯¹è±¡ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç†è§£ä¸ºJson è¿”å›å¯¹è±¡ä¸ºResponseEntityå¯¹è±¡ï¼ŒåŒ…å«äº†å“åº”ä¸­çš„ä¸€äº›é‡è¦ä¿¡æ¯ï¼Œæ¯”å¦‚å“åº”å¤´ã€å“åº”çŠ¶æ€ç ã€å“åº”ä½“ç­‰ 3ã€postForObject/postForEntity(å†™)å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•ç”¨ä¾‹çš„å†…å®¹æ˜¯å‘æŒ‡å®šçš„URLæäº¤ä¸€ä¸ªPost(å¸–å­). @Test void testSimple() { // è¯·æ±‚åœ°å€ String url = \"http://jsonplaceholder.typicode.com/posts\"; // è¦å‘é€çš„æ•°æ®å¯¹è±¡ PostDTO postDTO = new PostDTO(); postDTO.setUserId(110); postDTO.setTitle(\"zimug å‘å¸ƒæ–‡ç« \"); postDTO.setBody(\"zimug å‘å¸ƒæ–‡ç«  æµ‹è¯•å†…å®¹\"); // å‘é€postè¯·æ±‚ï¼Œå¹¶è¾“å‡ºç»“æœ PostDTO result = restTemplate.postForObject(url, postDTO, PostDTO.class); System.out.println(result); } ä¸Šé¢çš„æ‰€æœ‰çš„postForObjectè¯·æ±‚ä¼ å‚æ–¹æ³•ï¼ŒpostForEntityéƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹æ³•ä¸Šä¹Ÿå‡ ä¹æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯åœ¨è¿”å›ç»“æœæ¥æ”¶çš„æ—¶å€™ç•¥æœ‰å·®åˆ«ã€‚ä½¿ç”¨ResponseEntity&lt;T&gt; responseEntityæ¥æ¥æ”¶å“åº”ç»“æœã€‚ç”¨responseEntity.getBody()è·å–å“åº”ä½“ã€‚å“åº”ä½“å†…å®¹åŒpostForObjectæ–¹æ³•è¿”å›ç»“æœä¸€è‡´ã€‚å‰©ä¸‹çš„è¿™äº›å“åº”ä¿¡æ¯å°±æ˜¯postForEntityæ¯”postForObjectå¤šå‡ºæ¥çš„å†…å®¹ HttpStatus statusCode = responseEntity.getStatusCode(); è·å–æ•´ä½“çš„å“åº”çŠ¶æ€ä¿¡æ¯ int statusCodeValue = responseEntity.getStatusCodeValue(); è·å–å“åº”ç å€¼ HttpHeaders headers = responseEntity.getHeaders(); è·å–å“åº”å¤´ç­‰ @Test public void testEntityPoJo() { // è¯·æ±‚åœ°å€ String url = \"http://jsonplaceholder.typicode.com/posts\"; // è¦å‘é€çš„æ•°æ®å¯¹è±¡ PostDTO postDTO = new PostDTO(); postDTO.setUserId(110); postDTO.setTitle(\"zimug å‘å¸ƒæ–‡ç« \"); postDTO.setBody(\"zimug å‘å¸ƒæ–‡ç«  æµ‹è¯•å†…å®¹\"); // å‘é€postè¯·æ±‚ï¼Œå¹¶è¾“å‡ºç»“æœ ResponseEntity&lt;String&gt; responseEntity = restTemplate.postForEntity(url, postDTO, String.class); String body = responseEntity.getBody(); // è·å–å“åº”ä½“ System.out.println(\"HTTP å“åº”bodyï¼š\" + postDTO.toString()); //ä»¥ä¸‹æ˜¯postForEntityæ¯”postForObjectå¤šå‡ºæ¥çš„å†…å®¹ HttpStatus statusCode = responseEntity.getStatusCode(); // è·å–å“åº”ç  int statusCodeValue = responseEntity.getStatusCodeValue(); // è·å–å“åº”ç å€¼ HttpHeaders headers = responseEntity.getHeaders(); // è·å–å“åº”å¤´ System.out.println(\"HTTP å“åº”çŠ¶æ€ï¼š\" + statusCode); System.out.println(\"HTTP å“åº”çŠ¶æ€ç ï¼š\" + statusCodeValue); System.out.println(\"HTTP Headersä¿¡æ¯ï¼š\" + headers); } 4ã€GETè¯·æ±‚æ–¹æ³•&lt;T&gt; T getForObject(String url, Class&lt;T&gt; responseType, Object... uriVariables); &lt;T&gt; T getForObject(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables); &lt;T&gt; T getForObject(URI url, Class&lt;T&gt; responseType); &lt;T&gt; ResponseEntity&lt;T&gt; getForEntity(String url, Class&lt;T&gt; responseType, Object... uriVariables); &lt;T&gt; ResponseEntity&lt;T&gt; getForEntity(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables); &lt;T&gt; ResponseEntity&lt;T&gt; getForEntity(URI var1, Class&lt;T&gt; responseType); 5ã€POSTè¯·æ±‚æ–¹æ³• &lt;T&gt; T postForObject(String url, @Nullable Object request, Class&lt;T&gt; responseType, Object... uriVariables); &lt;T&gt; T postForObject(String url, @Nullable Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables); &lt;T&gt; T postForObject(URI url, @Nullable Object request, Class&lt;T&gt; responseType); &lt;T&gt; ResponseEntity&lt;T&gt; postForEntity(String url, @Nullable Object request, Class&lt;T&gt; responseType, Object... uriVariables); &lt;T&gt; ResponseEntity&lt;T&gt; postForEntity(String url, @Nullable Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables); &lt;T&gt; ResponseEntity&lt;T&gt; postForEntity(URI url, @Nullable Object request, Class&lt;T&gt; responseType); 3ã€Ribbonæ ¸å¿ƒç»„ä»¶IRule1ã€IRuleï¼šæ ¹æ®ç‰¹å®šç®—æ³•ä¸­ä»æœåŠ¡åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ªè¦è®¿é—®çš„æœåŠ¡ è½®è¯¢: com.netflix.loadbalancer.RoundRobinRule éšæœº: com.netflix.loadbalancer.RandomRule com.netflix.loadbalancer.RetryRule å…ˆæŒ‰ç…§RoundRobinRuleçš„ç­–ç•¥è·å–æœåŠ¡ï¼Œå¦‚æœè·å–æœåŠ¡å¤±è´¥åˆ™åœ¨æŒ‡å®šæ—¶é—´å†…ä¼šè¿›è¡Œé‡è¯•ï¼Œè·å–å¯ç”¨çš„æœåŠ¡ WeightedResponseTimeRule å¯¹RoundRobinRuleçš„æ‰©å±•ï¼Œå“åº”é€Ÿåº¦è¶Šå¿«çš„å®ä¾‹é€‰æ‹©æƒé‡è¶Šå¤§ï¼Œè¶Šå®¹æ˜“è¢«é€‰æ‹© BestAvailableRule ä¼šå…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„æœåŠ¡ AvailabilityFilteringRule å…ˆè¿‡æ»¤æ‰æ•…éšœå®ä¾‹ï¼Œå†é€‰æ‹©å¹¶å‘è¾ƒå°çš„å®ä¾‹ ZoneAvoidanceRule é»˜è®¤è§„åˆ™,å¤åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§é€‰æ‹©æœåŠ¡å™¨ 2ã€æ¡ˆä¾‹ä¿®æ”¹cloud-consumer-order801ã€ç»†èŠ‚è¯´æ˜å®˜æ–¹æ–‡æ¡£æ˜ç¡®ç»™å‡ºäº†è­¦å‘Šï¼šè¿™ä¸ªè‡ªå®šä¹‰é…ç½®ç±»ä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ï¼Œå¦åˆ™æˆ‘ä»¬è‡ªå®šä¹‰çš„è¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æ‰€å…±äº«ï¼Œè¾¾ä¸åˆ°ç‰¹æ®ŠåŒ–å®šåˆ¶çš„ç›®çš„äº†ã€‚ 2ã€æ–°å»ºpackagecom.kk.myrule 3ã€æ–°å»ºMySelfRuleè§„åˆ™ç±»package com.kk.myrule; import com.netflix.loadbalancer.IRule; import com.netflix.loadbalancer.RandomRule; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class MySelfRule { @Bean public IRule myRule() { return new RandomRule ( );//å®šä¹‰ä¸ºéšæœº } } 4ã€ä¸»å¯åŠ¨ç±»æ·»åŠ @RibbonClient@RibbonClient(name = \"CLOUD-PAYMENT-SERVICE\",configuration=MySelfRule.class) 5ã€æµ‹è¯•å¯åŠ¨ï¼šï¼ˆ1ï¼‰eurekaï¼ˆå•ä¸ªæˆ–è€…é›†ç¾¤éƒ½è¡Œï¼‰ï¼Œï¼ˆ2ï¼‰ç”Ÿäº§è€…8001ï¼ˆå•ä¸ªæˆ–è€…é›†ç¾¤éƒ½è¡Œï¼‰ï¼Œï¼ˆ3ï¼‰æ¶ˆè´¹è€…80 http://localhost/consumer/payment/get/1 4ã€Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•1ã€åŸç†è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šrestæ¥å£ç¬¬å‡ æ¬¡è¯·æ±‚æ•° % æœåŠ¡å™¨é›†ç¾¤æ€»æ•°é‡ = å®é™…è°ƒç”¨æœåŠ¡å™¨ä½ç½®ä¸‹æ ‡ ï¼Œæ¯æ¬¡æœåŠ¡é‡å¯åŠ¨årestæ¥å£è®¡æ•°ä»1å¼€å§‹ã€‚ List instances = discoveryClient.getInstances(â€œCLOUD-PAYMENT-SERVICEâ€); å¦‚ï¼š List [0] instances = 127.0.0.1:8002 List [1] instances = 127.0.0.1:8001 8001+ 8002 ç»„åˆæˆä¸ºé›†ç¾¤ï¼Œå®ƒä»¬å…±è®¡2å°æœºå™¨ï¼Œé›†ç¾¤æ€»æ•°ä¸º2ï¼Œ æŒ‰ç…§è½®è¯¢ç®—æ³•åŸç†ï¼š å½“æ€»è¯·æ±‚æ•°ä¸º1æ—¶ï¼š 1 % 2 =1 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º1 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8001å½“æ€»è¯·æ±‚æ•°ä½2æ—¶ï¼š 2 % 2 =0 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º0 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8002å½“æ€»è¯·æ±‚æ•°ä½3æ—¶ï¼š 3 % 2 =1 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º1 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8001å½“æ€»è¯·æ±‚æ•°ä½4æ—¶ï¼š 4 % 2 =0 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º0 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8002å¦‚æ­¤ç±»æ¨â€¦â€¦ 2ã€RoundRobinRuleæºç  è¿™é‡Œä¸æ˜¯æ­»å¾ªç¯ï¼Œè€Œæ˜¯è‡ªæ—‹é”ï¼ŒcompareAndSetï¼ˆCASæ“ä½œï¼ŒJUCä¸­ä¹è§‚é”çš„åº•å±‚å®ç°ï¼‰ 3ã€æ‰‹å†™1ã€8001å’Œ8002åˆ†åˆ«åŠ å…¥ @Value(\"${server.port}\") private String serverPort; @GetMapping(value = \"/payment/lb\") public String getPaymentLB() { return serverPort; } 2ã€å»æ‰æ³¨è§£@LoadBalanced 3ã€æ–°å»ºLoadBalanceræ¥å£package com.kk.springcloud.lb; import org.springframework.cloud.client.ServiceInstance; import java.util.List; public interface LoadBalancer { ServiceInstance instances(List&lt;ServiceInstance&gt; serviceInstances); } 4ã€æ–°å»ºMyLBpackage com.kk.springcloud.lb; import org.springframework.cloud.client.ServiceInstance; import org.springframework.stereotype.Component; import java.util.List; import java.util.concurrent.atomic.AtomicInteger; @Component public class MyLB implements LoadBalancer { private AtomicInteger atomicInteger = new AtomicInteger (0); @Override public ServiceInstance instances(List&lt;ServiceInstance&gt; serviceInstances) { int index = getAndIncrement ( ) % serviceInstances.size ( ); return serviceInstances.get (index); } public final int getAndIncrement() { int current; int next; do { current = this.atomicInteger.get ( ); next = current &gt;= 2147483647 ? 0 : current + 1; } while (!this.atomicInteger.compareAndSet (current, next)); System.out.println (\"*****next: \" + next); return next; } } 5ã€OrderController@Resource private LoadBalancer loadBalancer; @GetMapping(\"/consumer/payment/lb\") public String getPaymentLB() { List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances (\"CLOUD-PAYMENT-SERVICE\"); if (instances == null || instances.size ( ) &lt;= 0) { return null; } ServiceInstance serviceInstance = loadBalancer.instances (instances); URI uri = serviceInstance.getUri ( ); return restTemplate.getForObject (uri + \"/payment/lb\", String.class); } package com.kk.springcloud.controller; import com.kk.springcloud.lb.LoadBalancer; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import lombok.extern.slf4j.Slf4j; import org.springframework.cloud.client.ServiceInstance; import org.springframework.cloud.client.discovery.DiscoveryClient; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; import java.net.URI; import java.util.List; @RestController @Slf4j public class OrderController { //public static final String PAYMENT_URL = \"http://localhost:8001\"; public static final String PAYMENT_URL = \"http://cloud-payment-service\"; //å¯ä»¥è·å–æ³¨å†Œä¸­å¿ƒä¸Šçš„æœåŠ¡åˆ—è¡¨ @Resource private DiscoveryClient discoveryClient; @Resource private LoadBalancer loadBalancer; @GetMapping(\"/consumer/payment/lb\") public String getPaymentLB() { List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances (\"CLOUD-PAYMENT-SERVICE\"); if (instances == null || instances.size ( ) &lt;= 0) { return null; } ServiceInstance serviceInstance = loadBalancer.instances (instances); URI uri = serviceInstance.getUri ( ); return restTemplate.getForObject (uri + \"/payment/lb\", String.class); } @Resource private RestTemplate restTemplate; @GetMapping(\"/consumer/payment/create\") public CommonResult&lt;Payment&gt; create(Payment payment) { return restTemplate.postForObject (PAYMENT_URL + \"/payment/create\", payment, CommonResult.class); //å†™æ“ä½œ } @GetMapping(\"/consumer/payment/get/{id}\") public CommonResult&lt;Payment&gt; getPayment(@PathVariable(\"id\") Long id) { return restTemplate.getForObject (PAYMENT_URL + \"/payment/get/\" + id, CommonResult.class); } } 6ã€æµ‹è¯•http://localhost/consumer/payment/lb æ³¨æ„ï¼š8001å’Œ8002åˆ«åé…ç½®éƒ½è¦é…å¥½å¦åˆ™è‡ªå®šä¹‰ç®—æ³• è·å–çš„urlä¼šæŠ¥é”™","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"netflix","slug":"netflix","permalink":"https://mykkto.github.io/tags/netflix/"},{"name":"è´Ÿè½½å‡è¡¡","slug":"è´Ÿè½½å‡è¡¡","permalink":"https://mykkto.github.io/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"},{"name":"ribbon","slug":"ribbon","permalink":"https://mykkto.github.io/tags/ribbon/"}],"author":"mykk"},{"title":"hexo + github åœ¨ç™¾åº¦å’Œè°·æ­Œ SEOç«™ç‚¹æ”¶å½•","slug":"00blog/01_seo","date":"2022-01-16T14:41:15.000Z","updated":"2022-01-16T15:15:19.628Z","comments":true,"path":"posts/f1d997d.html","link":"","permalink":"https://mykkto.github.io/posts/f1d997d.html","excerpt":"","text":"1ã€ç™¾åº¦ seo1ã€ç™»é™†ç™¾åº¦ç«™é•¿ç®¡ç†https://ziyuan.baidu.com/linksubmit/url?sitename=http://site:abc.github.io 2ã€å¡«å†™è‡ªå·±çš„blogåœ°å€ 3ã€hexoè®¾ç½®æ ¡éªŒC:\\Users\\Administrator\\Desktop\\myblog\\mykkTo.github.io\\themes\\matery\\layout\\_partial 4ã€æˆåŠŸ 5ã€ç«™ç‚¹æ”¶å½•https://mykkto.github.io/baidu_urls.txt 2ã€è°·æ­Œ seoå‚è€ƒhttps://www.jianshu.com/p/9be9b4786f97","categories":[{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://mykkto.github.io/categories/%E5%8D%9A%E5%AE%A2/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://mykkto.github.io/tags/hexo/"},{"name":"github","slug":"github","permalink":"https://mykkto.github.io/tags/github/"},{"name":"seo","slug":"seo","permalink":"https://mykkto.github.io/tags/seo/"},{"name":"ç™¾åº¦","slug":"ç™¾åº¦","permalink":"https://mykkto.github.io/tags/%E7%99%BE%E5%BA%A6/"},{"name":"è°·æ­Œ","slug":"è°·æ­Œ","permalink":"https://mykkto.github.io/tags/%E8%B0%B7%E6%AD%8C/"}],"author":"mykk"},{"title":"SpringCloud-Consul","slug":"03javaDistributed/01springcloud/04_SpringCloud_Consul","date":"2022-01-16T13:42:11.000Z","updated":"2022-01-17T15:12:15.319Z","comments":true,"path":"posts/51c7125f.html","link":"","permalink":"https://mykkto.github.io/posts/51c7125f.html","excerpt":"","text":"1ã€Consulç®€ä»‹1ã€æ˜¯ä»€ä¹ˆ Consul æ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ç³»ç»Ÿï¼Œç”± HashiCorp å…¬å¸ç”¨ Go è¯­è¨€å¼€å‘ã€‚ æä¾›äº†å¾®æœåŠ¡ç³»ç»Ÿä¸­çš„æœåŠ¡æ²»ç†ã€é…ç½®ä¸­å¿ƒã€æ§åˆ¶æ€»çº¿ç­‰åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ ¹æ®éœ€è¦å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·ä½¿ç”¨ä»¥æ„å»ºå…¨æ–¹ä½çš„æœåŠ¡ç½‘æ ¼ï¼Œæ€»ä¹‹Consulæä¾›äº†ä¸€ç§å®Œæ•´çš„æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚ å®ƒå…·æœ‰å¾ˆå¤šä¼˜ç‚¹ã€‚åŒ…æ‹¬ï¼š åŸºäº raft åè®®ï¼Œæ¯”è¾ƒç®€æ´ï¼› æ”¯æŒå¥åº·æ£€æŸ¥, åŒæ—¶æ”¯æŒ HTTP å’Œ DNS åè®® æ”¯æŒè·¨æ•°æ®ä¸­å¿ƒçš„ WAN é›†ç¾¤ æä¾›å›¾å½¢ç•Œé¢ è·¨å¹³å°ï¼Œæ”¯æŒ Linuxã€Macã€Windows 2ã€èƒ½å¹²å˜›1ã€æœåŠ¡å‘ç°æä¾›HTTPå’ŒDNSä¸¤ç§å‘ç°æ–¹å¼ã€‚ 2ã€å¥åº·ç›‘æµ‹æ”¯æŒå¤šç§æ–¹å¼ï¼ŒHTTPã€TCPã€Dockerã€Shellè„šæœ¬å®šåˆ¶åŒ–ç›‘æ§ 3ã€KVå­˜å‚¨Keyã€Valueçš„å­˜å‚¨æ–¹å¼ 4ã€å¤šæ•°æ®ä¸­å¿ƒConsulæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒ 5ã€å¯è§†åŒ–Webç•Œé¢3ã€å®˜ç½‘æ–‡æ¡£1ã€ä¸‹è½½åœ°å€https://www.consul.io/downloads.html 2ã€å­¦ä¹ æ–‡æ¡£https://www.springcloud.cc/spring-cloud-consul.html 2ã€å®‰è£…å¹¶è¿è¡ŒConsul1ã€å®˜ç½‘å®‰è£…https://www.consul.io/downloads 2ã€å®‰è£…è¯´æ˜ä¸‹è½½å®Œæˆååªæœ‰ä¸€ä¸ªconsul.exeæ–‡ä»¶ï¼Œç¡¬ç›˜è·¯å¾„ä¸‹åŒå‡»è¿è¡Œï¼ŒæŸ¥çœ‹ç‰ˆæœ¬å·ä¿¡æ¯ 3ã€ä½¿ç”¨å¼€å‘æ¨¡å¼å¯åŠ¨ï¼ˆ1ï¼‰å‘½ä»¤ï¼šconsul agent -dev ï¼ˆ2ï¼‰é€šè¿‡ä»¥ä¸‹åœ°å€å¯ä»¥è®¿é—®Consulçš„é¦–é¡µï¼šhttp://localhost:8500 ï¼ˆ3ï¼‰æ•ˆæœï¼š 3ã€æœåŠ¡æä¾›è€…1ã€å»ºmodelcloud-providerconsul-payment8006 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-providerconsul-payment8006&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud consul-server --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€yml###consulæœåŠ¡ç«¯å£å· server: port: 8006 spring: application: name: consul-provider-payment ####consulæ³¨å†Œä¸­å¿ƒåœ°å€ cloud: consul: host: localhost port: 8500 discovery: #hostname: 127.0.0.1 service-name: ${spring.application.name} 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class Payment8006 { public static void main(String[] args) { SpringApplication.run (Payment8006.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; import java.util.UUID; @RestController public class PaymentController { @Value(\"${server.port}\") private String serverPort; @GetMapping(\"/payment/consul\") public String paymentInfo() { return \"springcloud with consul: \" + serverPort + \"\\t\\t\" + UUID.randomUUID ( ).toString ( ); } } 5ã€æµ‹è¯•1ã€è®¿é—®http://localhost:8006/payment/consul 2ã€æ§åˆ¶å° 4ã€æœåŠ¡æ¶ˆè´¹è€…1ã€å»ºmodelcloud-consumerconsul-order82 2ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumerconsul-order82&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--SpringCloud consul-server --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€yml###consulæœåŠ¡ç«¯å£å· server: port: 82 spring: application: name: cloud-consumer-order ####consulæ³¨å†Œä¸­å¿ƒåœ°å€ cloud: consul: host: localhost port: 8500 discovery: #hostname: 127.0.0.1 service-name: ${spring.application.name} 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @SpringBootApplication @EnableDiscoveryClient public class OrderConsulMain82 { public static void main(String[] args) { SpringApplication.run (OrderConsulMain82.class,args); } } 5ã€ä¸šåŠ¡ç±»1ã€Beané…ç½®ç±»package com.kk.springcloud.config; import org.springframework.cloud.client.loadbalancer.LoadBalanced; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.web.client.RestTemplate; @Configuration public class ApplicationContextBean { @Bean @LoadBalanced public RestTemplate getRestTemplate() { return new RestTemplate ( ); } } 2ã€Controllerpackage com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; @RestController public class OrderConsulController { public static final String INVOKE_URL = \"http://cloud-provider-payment\"; //consul-provider-payment @Autowired private RestTemplate restTemplate; @GetMapping(value = \"/consumer/payment/consul\") public String paymentInfo() { String result = restTemplate.getForObject (INVOKE_URL + \"/payment/consul\", String.class); System.out.println (\"æ¶ˆè´¹è€…è°ƒç”¨æ”¯ä»˜æœåŠ¡(consule)---&gt;result:\" + result); return result; } } 6ã€æµ‹è¯•1ã€å®¢æˆ·ç«¯ 2ã€è®¿é—®http://localhost/consumer/payment/consul 5ã€ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹1ã€CAPCAPç†è®ºå…³æ³¨ç²’åº¦æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯æ•´ä½“ç³»ç»Ÿè®¾è®¡çš„ç­–ç•¥ C:Consistencyï¼ˆå¼ºä¸€è‡´æ€§ï¼‰ A:Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ P:Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ 2ã€CAPå›¾æœ€å¤šåªèƒ½åŒæ—¶è¾ƒå¥½çš„æ»¡è¶³ä¸¤ä¸ªã€‚ CAPç†è®ºçš„æ ¸å¿ƒæ˜¯ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶å¾ˆå¥½çš„æ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªéœ€æ±‚ï¼Œå› æ­¤ï¼Œæ ¹æ® CAP åŸç†å°† NoSQL æ•°æ®åº“åˆ†æˆäº†æ»¡è¶³ CA åŸåˆ™ã€æ»¡è¶³ CP åŸåˆ™å’Œæ»¡è¶³ AP åŸåˆ™ä¸‰ å¤§ç±»ï¼šCA - å•ç‚¹é›†ç¾¤ï¼Œæ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸åœ¨å¯æ‰©å±•æ€§ä¸Šä¸å¤ªå¼ºå¤§ã€‚CP - æ»¡è¶³ä¸€è‡´æ€§ï¼Œåˆ†åŒºå®¹å¿å¿…çš„ç³»ç»Ÿï¼Œé€šå¸¸æ€§èƒ½ä¸æ˜¯ç‰¹åˆ«é«˜ã€‚AP - æ»¡è¶³å¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹å¿æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸å¯èƒ½å¯¹ä¸€è‡´æ€§è¦æ±‚ä½ä¸€äº›ã€‚ 3ã€AP-CPæ¶æ„å›¾1ã€AP(Eureka)APæ¶æ„ å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼Œç³»ç»ŸBå¯ä»¥è¿”å›æ—§å€¼ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ç»“è®ºï¼šè¿èƒŒäº†ä¸€è‡´æ€§Cçš„è¦æ±‚ï¼Œåªæ»¡è¶³å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³AP 2ã€CP(Zookeeper/Consul)CPæ¶æ„ å½“ç½‘ç»œåˆ†åŒºå‡ºç°åï¼Œä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œå°±å¿…é¡»æ‹’æ¥è¯·æ±‚ï¼Œå¦åˆ™æ— æ³•ä¿è¯ä¸€è‡´æ€§ç»“è®ºï¼šè¿èƒŒäº†å¯ç”¨æ€§Açš„è¦æ±‚ï¼Œåªæ»¡è¶³ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œå³CP","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"æœåŠ¡æ³¨å†Œä¸å‘ç°","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"},{"name":"Consul","slug":"Consul","permalink":"https://mykkto.github.io/tags/Consul/"}],"author":"mykk"},{"title":"Springcloud-Zookeeper(å¿«é€Ÿå…¥é—¨)","slug":"03javaDistributed/01springcloud/03_SpringCloud-Zookeeper","date":"2022-01-15T15:01:12.000Z","updated":"2022-01-17T15:12:07.880Z","comments":true,"path":"posts/c0125b8a.html","link":"","permalink":"https://mykkto.github.io/posts/c0125b8a.html","excerpt":"","text":"å®‰è£…å‚è€ƒã€åé¢å†™ã€‘https://blog.csdn.net/zhou_fan_xi/article/details/103275955 å®‰è£…å®Œï¼Œwindownè®¿é—®æµ‹è¯• telnet 106.52.23.202 2181 1ã€æ³¨å†Œä¸­å¿ƒZookeeperåŸºæœ¬æ¦‚è¿° zookeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒå·¥å…·ï¼Œå¯ä»¥å®ç°æ³¨å†Œä¸­å¿ƒåŠŸèƒ½ å…³é—­LinuxæœåŠ¡å™¨é˜²ç«å¢™åæ‰èƒ½å¯åŠ¨zookeeperæœåŠ¡å™¨ zookeeperæœåŠ¡å™¨å–ä»£EurekaæœåŠ¡å™¨ï¼Œzkä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒ 2ã€æœåŠ¡æä¾›è€…1ã€å»ºmodelæ–°å»ºcloud-provider-payment8004 2ã€å†™pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-provider-payment8004&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt;&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆzookeeperå®¢æˆ·ç«¯ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt; &lt;!--å…ˆæ’é™¤è‡ªå¸¦çš„zookeeper3.5.3--&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;!--æ·»åŠ zookeeper3.4.9ç‰ˆæœ¬--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.4.9&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€æ”¹yml#8004è¡¨ç¤ºæ³¨å†Œåˆ°zookeeperæœåŠ¡å™¨çš„æ”¯ä»˜æœåŠ¡æä¾›è€…ç«¯å£å· server: port: 8004 #æœåŠ¡åˆ«å----æ³¨å†Œzookeeperåˆ°æ³¨å†Œä¸­å¿ƒåç§° spring: application: name: cloud-provider-payment cloud: zookeeper: connect-string: 106.52.23.202:2181 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @SpringBootApplication @EnableDiscoveryClient//è¯¥æ³¨è§£ç”¨äºå‘ä½¿ç”¨consulæˆ–è€…zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶æ³¨å†ŒæœåŠ¡ public class PaymentMain8004 { public static void main(String[] args) { SpringApplication.run (PaymentMain8004.class,args); } } 5ã€ä¸šåŠ¡ç±»package com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import java.util.UUID; @RestController public class PaymentController { @Value(\"${server.port}\") private String serverPort; @RequestMapping(value = \"/payment/zk\") public String paymentzk() { return \"springcloud with zookeeper: \" + serverPort + \"\\t\" + UUID.randomUUID ( ).toString ( ); } } 6ã€å¯åŠ¨8004æ³¨å†Œè¿›zookeeper1ã€liunxå¯åŠ¨ zookeeper#æŸ¥çœ‹æ‰§è¡Œè·¯å¾„ [root@VM-0-13-centos bin]# pwd /root/zookeeper-3.4.9/bin #å¯åŠ¨ [root@VM-0-13-centos bin]# ./zkServer.sh start #åœæ­¢ [root@VM-0-13-centos bin]# ./zkServer.sh stop #é‡å¯ [root@VM-0-13-centos bin]# ./zkServer.sh restart 7ã€æµ‹è¯•1ã€è®¿é—®æœåŠ¡http://localhost:8004/payment/zk 2ã€æŸ¥çœ‹æœåŠ¡ç«¯è¢«æ˜¯å¦è¢«æ³¨å†Œ#è¿›å…¥ zookeeperå®¢æˆ·ç«¯ [root@VM-0-13-centos bin]# ./zkCli.sh WatchedEvent state:SyncConnected type:None path:null #æŸ¥çœ‹åºåˆ— [zk: localhost:2181(CONNECTED) 0] ls /services/cloud-provider-payment [a6293666-45c1-490e-adb8-bee63f121983] #æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ [zk: localhost:2181(CONNECTED) 1] ls /services/cloud-provider-payment/a6293666-45c1-490e-adb8-bee63f121983 [] [zk: localhost:2181(CONNECTED) 2] get /services/cloud-provider-payment/a6293666-45c1-490e-adb8-bee63f121983 {\"name\":\"cloud-provider-payment\",\"id\":\"a6293666-45c1-490e-adb8-bee63f121983\",\"address\":\"FYYX-2020GVNPLA\",\"port\":8004,\"sslPort\":null,\"payload\":{\"@class\":\"org.springframework.cloud.zookeeper.discovery.ZookeeperInstance\",\"id\":\"application-1\",\"name\":\"cloud-provider-payment\",\"metadata\":{}},\"registrationTimeUTC\":1642423897607,\"serviceType\":\"DYNAMIC\",\"uriSpec\":{\"parts\":[{\"value\":\"scheme\",\"variable\":true},{\"value\":\"://\",\"variable\":false},{\"value\":\"address\",\"variable\":true},{\"value\":\":\",\"variable\":false},{\"value\":\"port\",\"variable\":true}]}} 8ã€æ€è€ƒæœåŠ¡èŠ‚ç‚¹æ˜¯ä¸´æ—¶èŠ‚ç‚¹è¿˜æ˜¯æŒä¹…èŠ‚ç‚¹ï¼Ÿï¼Ÿ ï¼ˆ1ï¼‰å½“æˆ‘å…³é—­ 8004èŠ‚ç‚¹åï¼Œzookeeper ä¾æ—§ä¼šæŒç»­å‘å¿ƒè·³ï¼Œå½“æœ‰æ¥æ”¶åˆ°åé¦ˆåˆ™è¿˜æœ‰åºåˆ—å·ï¼Œæ²¡æœ‰åˆ™è¿”å›ç©º[] ï¼ˆ2ï¼‰ç„¶åå†æ¬¡å¯åŠ¨ï¼Œåˆ™è¿”å›ä¸€ä¸ªæ–°çš„åºåˆ—ï¼Œç”±æ­¤è¯´æ˜è¿™æ˜¯ä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ 3ã€æœåŠ¡æ¶ˆè´¹è€…1ã€å»ºmodelæ–°å»ºcloud-consumerzk-order81 2ã€å†™pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumerzk-order81&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBootæ•´åˆzookeeperå®¢æˆ·ç«¯ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt; &lt;!--å…ˆæ’é™¤è‡ªå¸¦çš„zookeeper--&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;!--æ·»åŠ zookeeper3.4.9ç‰ˆæœ¬--&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.4.9&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€æ”¹yml#81è¡¨ç¤ºæ³¨å†Œåˆ°zookeeperæœåŠ¡å™¨çš„æ”¯ä»˜æœåŠ¡æä¾›è€…ç«¯å£å· server: port: 81 #æœåŠ¡åˆ«å----æ³¨å†Œzookeeperåˆ°æ³¨å†Œä¸­å¿ƒåç§° spring: application: name: cloud-consumer-order cloud: zookeeper: connect-string: 106.52.23.202:2181 4ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; @SpringBootApplication @EnableDiscoveryClient public class OrderZK81 { public static void main(String[] args) { SpringApplication.run (OrderZK81.class,args); } } 5ã€ä¸šåŠ¡ç±»1ã€é…ç½®Beanpackage com.kk.springcloud.config; import org.springframework.cloud.client.loadbalancer.LoadBalanced; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.web.client.RestTemplate; @Configuration public class ApplicationContextBean { @Bean @LoadBalanced// ç»™äºˆ RestTemplate è´Ÿè½½å‡è¡¡çš„èƒ½åŠ› public RestTemplate getRestTemplate() { return new RestTemplate ( ); } } 2ã€Controllerpackage com.kk.springcloud.controller; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; @RestController public class OrderZKController81 { public static final String INVOKE_URL = \"http://cloud-provider-payment\"; @Autowired private RestTemplate restTemplate; @RequestMapping(value = \"/consumer/payment/zk\") public String paymentInfo() { String result = restTemplate.getForObject (INVOKE_URL + \"/payment/zk\", String.class); System.out.println (\"æ¶ˆè´¹è€…è°ƒç”¨æ”¯ä»˜æœåŠ¡(zookeeper)---&gt;result:\" + result); return result; } } 6ã€æµ‹è¯•1ã€zookeeper[zk: localhost:2181(CONNECTED) 21] ls /services [cloud-provider-payment, cloud-consumer-order] 2ã€è®¿é—®http://localhost:81/consumer/payment/zk","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"æœåŠ¡æ³¨å†Œä¸å‘ç°","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"},{"name":"Zookeeper","slug":"Zookeeper","permalink":"https://mykkto.github.io/tags/Zookeeper/"}],"author":"mykk"},{"title":"SpringCloud-Eureka","slug":"03javaDistributed/01springcloud/02_SpringCloud-Eureka","date":"2022-01-14T14:35:22.000Z","updated":"2022-01-17T15:11:52.902Z","comments":true,"path":"posts/402d692e.html","link":"","permalink":"https://mykkto.github.io/posts/402d692e.html","excerpt":"","text":"1ã€EurekaåŸºç¡€çŸ¥è¯†1ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç† Spring Cloud å°è£…äº† Netflix å…¬å¸å¼€å‘çš„ Eureka æ¨¡å—æ¥å®ç°æœåŠ¡æ²»ç† åœ¨ä¼ ç»Ÿçš„rpcè¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œç®¡ç†æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æœåŠ¡æ²»ç†ï¼Œç®¡ç†æœåŠ¡äºæœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚ 2ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œ1ã€æ¦‚å¿µ Eurekaé‡‡ç”¨äº†CSçš„è®¾è®¡æ¶æ„ï¼ŒEureka Server ä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚è€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨ Eurekaçš„å®¢æˆ·ç«¯è¿æ¥åˆ° Eureka Serverå¹¶ç»´æŒå¿ƒè·³è¿æ¥ã€‚è¿™æ ·ç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡ Eureka Server æ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ åœ¨æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­ï¼Œæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€‚å½“æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰è‡ªå·±æœåŠ¡å™¨çš„ä¿¡æ¯ æ¯”å¦‚ æœåŠ¡åœ°å€é€šè®¯åœ°å€ç­‰ä»¥åˆ«åæ–¹å¼æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šã€‚å¦ä¸€æ–¹ï¼ˆæ¶ˆè´¹è€…|æœåŠ¡æä¾›è€…ï¼‰ï¼Œä»¥è¯¥åˆ«åçš„æ–¹å¼å»æ³¨å†Œä¸­å¿ƒä¸Šè·å–åˆ°å®é™…çš„æœåŠ¡é€šè®¯åœ°å€ï¼Œç„¶åå†å®ç°æœ¬åœ°RPCè°ƒç”¨RPCè¿œç¨‹è°ƒç”¨æ¡†æ¶æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šåœ¨äºæ³¨å†Œä¸­å¿ƒï¼Œå› ä¸ºä½¿ç”¨æ³¨å†Œä¸­å¿ƒç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¸€ä¸ªä¾èµ–å…³ç³»(æœåŠ¡æ²»ç†æ¦‚å¿µ)ã€‚åœ¨ä»»ä½•rpcè¿œç¨‹æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ(å­˜æ”¾æœåŠ¡åœ°å€ç›¸å…³ä¿¡æ¯(æ¥å£åœ°å€)) 2ã€å›¾è§£ 3ã€Eurekaä¸¤ç»„ä»¶1ã€EurekaServeræä¾›æœåŠ¡æ³¨å†ŒæœåŠ¡å„ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹é€šè¿‡é…ç½®å¯åŠ¨åï¼Œä¼šåœ¨EurekaServerä¸­è¿›è¡Œæ³¨å†Œï¼Œè¿™æ ·EurekaServerä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒæœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çœ‹åˆ°ã€‚ 2ã€EurekaClienté€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¿é—®æ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–Eureka Serverçš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢(round-robin)è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨ã€‚åœ¨åº”ç”¨å¯åŠ¨åï¼Œå°†ä¼šå‘Eureka Serverå‘é€å¿ƒè·³(é»˜è®¤å‘¨æœŸä¸º30ç§’)ã€‚å¦‚æœEureka Serveråœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEurekaServerå°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤ï¼ˆé»˜è®¤90ç§’ï¼‰ 2ã€å•æœºEurekaæ„å»ºæ­¥éª¤1ã€eurekaServerç«¯æœåŠ¡æ³¨å†Œä¸­å¿ƒ1ã€å»ºmodelcloud-eureka-server7001 2ã€å†™pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-eureka-server7001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--eureka-server--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--boot web actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬é€šç”¨é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€æ”¹ymlserver: port: 7001 eureka: instance: hostname: localhost #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: #falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚ register-with-eureka: false #falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡ fetch-registry: false service-url: #è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ã€‚ defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/ 4ã€ä¸»å¯åŠ¨@SpringBootApplication @EnableEurekaServer public class EurekaMain7001 { public static void main(String[] args) { SpringApplication.run (EurekaMain7001.class,args); } } 5ã€æµ‹è¯•1ã€è®¿é—®ï¼šhttp://localhost:7001/ 2ã€è¿”å›ç»“æœé¡µé¢ No application available æ²¡æœ‰æœåŠ¡è¢«å‘ç° O(âˆ©_âˆ©)Oå› ä¸ºæ²¡æœ‰æ³¨å†ŒæœåŠ¡è¿›æ¥å½“ç„¶ä¸å¯èƒ½æœ‰æœåŠ¡è¢«å‘ç° 2ã€EurekaClientç«¯provider-80011ã€å»ºmodel(ä¸å˜)cloud-provider-payment8001 2ã€å†™pomï¼ˆå¢åŠ ï¼‰ä»¥å‰è€ç‰ˆæœ¬ï¼Œåˆ«å†ä½¿ç”¨ &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt; &lt;/dependency&gt; ç°åœ¨æ–°ç‰ˆæœ¬,å½“å‰ä½¿ç”¨ &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; 3ã€æ”¹yml(å¢åŠ )eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: defaultZone: http://localhost:7001/eureka 4ã€ä¸»å¯åŠ¨(æ·»åŠ )@EnableEurekaClient 5ã€æµ‹è¯•ï¼ˆ1ï¼‰å…ˆè¦å¯åŠ¨EurekaServerï¼Œå†å¯åŠ¨8001 ï¼ˆ2ï¼‰è®¿é—®ï¼šhttp://localhost:7001/ 6ã€è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ 3ã€EurekaClientç«¯consumer-801ã€å»ºmodelï¼ˆä¸å˜ï¼‰2ã€å†™pomï¼ˆåŒä¸Šï¼‰ &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--å¼•å…¥å…¬å…±éƒ¨åˆ†--&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; 3ã€æ”¹ymlï¼ˆåŒä¸Šï¼‰eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: defaultZone: http://localhost:7001/eureka 4ã€ä¸»å¯åŠ¨ï¼ˆåŒä¸Šï¼‰@SpringBootApplication @EnableEurekaClient public class PaymentMain8001 { public static void main(String[] args) { SpringApplication.run (PaymentMain8001.class, args); } } 5ã€æµ‹è¯•ï¼ˆ1ï¼‰å…ˆè¦å¯åŠ¨EurekaServerï¼Œå†å¯åŠ¨80 ï¼ˆ2ï¼‰è®¿é—®ï¼šhttp://localhost/consumer/payment/get/1 3ã€é›†ç¾¤Eurekaæ„å»ºæ­¥éª¤1ã€Eurekaé›†ç¾¤åŸç†è¯´æ˜1ã€å›¾è§£ 2ã€é—®é¢˜ï¼šå¾®æœåŠ¡RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æœ€æ ¸å¿ƒçš„æ˜¯ä»€ä¹ˆ3ã€è§£å†³æ–¹æ¡ˆï¼šé«˜å¯ç”¨ï¼Œè¯•æƒ³ä½ çš„æ³¨å†Œä¸­å¿ƒåªæœ‰ä¸€ä¸ªonly oneï¼Œä¼šå¯¼è‡´æ•´ä¸ªä¸ºæœåŠ¡ç¯å¢ƒä¸å¯ç”¨ï¼Œæ‰€ä»¥ è§£å†³åŠæ³•ï¼šæ­å»ºEurekaæ³¨å†Œä¸­å¿ƒé›†ç¾¤ ï¼Œå®ç°è´Ÿè½½å‡è¡¡+æ•…éšœå®¹é”™ 2ã€EurekaServeré›†ç¾¤ç¯å¢ƒæ„å»ºæ­¥éª¤1ã€å»ºmodelæ–°å»ºcloud-eureka-server7002ï¼Œå‚è€ƒ7001 2ã€å†™pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-eureka-server7002&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!--eureka-server--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; &lt;!--boot web actuator--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ä¸€èˆ¬é€šç”¨é…ç½®--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 3ã€ä¿®é…ç½®ç”±äºæœ¬åœ°ä¸»æœºåªæœ‰ä¸€å°ï¼Œä¸ºäº†æ¨¡æ‹Ÿä¸¤å°ï¼ˆå¤šå°)ï¼Œåˆ™å°† å¤šä¸ªipï¼ˆåŸŸåeureka7001.com,eureka7002.com) æŒ‡å‘æœ¬åœ°(127.0.0.1) 1ã€æ‰¾åˆ°å¯¹åº”çš„é…ç½®ç›®å½•C:\\Windows\\System32\\drivers\\etc 2ã€å†™å…¥é…ç½®æ–‡ä»¶ 127.0.0.1 eureka7001.com127.0.0.1 eureka7002.com 4ã€æ”¹yml1ã€7001server: port: 7001 eureka: instance: hostname: eureka7001.com #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: register-with-eureka: false #falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚ fetch-registry: false #falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡ service-url: defaultZone: http://eureka7002.com:7002/eureka/ 2ã€7002server: port: 7002 eureka: instance: hostname: eureka7002.com #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: register-with-eureka: false #falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚ fetch-registry: false #falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡ service-url: defaultZone: http://eureka7001.com:7001/eureka/ 5ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer; @SpringBootApplication @EnableEurekaServer public class EurekaMain7002 { public static void main(String[] args) { SpringApplication.run (EurekaMain7002.class,args); } } 3ã€æ”¯ä»˜8001å‘å¸ƒåˆ°Eurekaé›†ç¾¤1ã€ä¿®æ”¹ymlä¸»è¦ä¿®æ”¹ä¸€å¤„ï¼šdefaultZone: server: port: 8001 spring: application: name: cloud-payment-service datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: org.gjt.mm.mysql.Driver url: jdbc:mysql://localhost:3306/spring_cloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false username: root password: a1b2c3 eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://localhost:7001/eureka defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka # é›†ç¾¤ç‰ˆ mybatis: mapperLocations: classpath:mapper/*.xml type-aliases-package: com.kk.springclond.entities 4ã€è®¢å•80å‘å¸ƒåˆ°Eurekaé›†ç¾¤1ã€ä¿®æ”¹ymlä¸»è¦ä¿®æ”¹ä¸€å¤„ï¼šdefaultZone: server: port: 80 spring: application: name: cloud-consumer-service eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://localhost:7001/eureka defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka # é›†ç¾¤ç‰ˆ 5ã€æµ‹è¯•æµç¨‹æµ‹è¯•ä»¥ä¸Šé…ç½®æ˜¯å¦ç”Ÿæ•ˆ 1ã€å¯åŠ¨é›†ç¾¤å…ˆè¦å¯åŠ¨EurekaServerï¼Œ7001/7002æœåŠ¡ 2ã€å¯åŠ¨ç”Ÿäº§è€…å†è¦å¯åŠ¨æœåŠ¡æä¾›è€…providerï¼Œ8001 3ã€å¯åŠ¨æ¶ˆè´¹è€…å†è¦å¯åŠ¨æ¶ˆè´¹è€…ï¼Œ80 4ã€æµ‹è¯•http://localhost/consumer/payment/get/1 6ã€æ”¯ä»˜8001é›†ç¾¤æ„å»ºã€8002ã€‘1ã€æ–¹å¼ä¸€ï¼šç›´æ¥æŠŠæ•´ä»½8001 copyå‡ºä¸€ä¸ªæ–°çš„ï¼Œéœ€æ”¹yml ï¼Œportå³å¯ã€æ¨èã€‘ server: port: 8002 2ã€æ–¹å¼äºŒï¼šï¼ˆ1ï¼‰æ‰“å¼€ideaé…ç½®ï¼Œå–æ¶ˆå‹¾é€‰å•ä¸€æœåŠ¡æŒ‰é’® ï¼ˆ2ï¼‰ä¿®æ”¹yml server: port: 8002 ï¼ˆ3ï¼‰å¯åŠ¨ 7ã€è´Ÿè½½å‡è¡¡1ã€è®¢å•80è°ƒç”¨è°ƒæ•´åœ¨è°ƒç”¨çš„æ—¶å€™ä¸èƒ½å†™æ­»æˆip+ç«¯å£ï¼Œéœ€è¦ä½¿ç”¨æœåŠ¡åï¼šcloud-payment-service 2ã€@LoadBalancedæ³¨è§£ä½¿ç”¨@LoadBalancedæ³¨è§£èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡çš„èƒ½åŠ› ä¿®æ”¹é…ç½®ä¿¡æ¯æ·»åŠ æ³¨è§£ã€80ç«¯å£ã€‘ 8ã€æµ‹è¯•è´Ÿè½½å‡è¡¡1ã€å¯åŠ¨é¡ºåºè¯´æ˜ï¼ˆ1ï¼‰å…ˆè¦å¯åŠ¨EurekaServerï¼Œ7001/7002æœåŠ¡ ï¼ˆ2ï¼‰å†è¦å¯åŠ¨æœåŠ¡æä¾›è€…providerï¼Œ8001/8002æœåŠ¡ 2ã€è®¿é—®http://localhost/consumer/payment/get/1 3ã€ç»“æœï¼ˆ1ï¼‰è¾¾åˆ°è´Ÿè½½æ•ˆæœ ï¼ˆ2ï¼‰8001/8002ç«¯å£äº¤æ›¿å‡ºç° 4ã€å°ç»“Ribbonå’ŒEurekaæ•´åˆåConsumerå¯ä»¥ç›´æ¥è°ƒç”¨æœåŠ¡è€Œä¸ç”¨å†å…³å¿ƒåœ°å€å’Œç«¯å£å·ï¼Œä¸”è¯¥æœåŠ¡è¿˜æœ‰è´Ÿè½½åŠŸèƒ½äº† 4ã€actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„1ã€ä¸»æœºåç§°:æœåŠ¡åç§°ä¿®æ”¹1ã€å½“å‰é—®é¢˜å«æœ‰ä¸»æœºååç§° 2ã€ä¿®æ”¹8001instance: instance-id: payment8001 å®Œæ•´ yml server: port: 8001 spring: application: name: cloud-payment-service datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: org.gjt.mm.mysql.Driver url: jdbc:mysql://localhost:3306/spring_cloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false username: root password: a1b2c3 eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://localhost:7001/eureka defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka # é›†ç¾¤ç‰ˆ instance: instance-id: payment8001 mybatis: mapperLocations: classpath:mapper/*.xml type-aliases-package: com.kk.springclond.entities 3ã€æ•ˆæœå…¶å®å°±æ˜¯å–åˆ«å 2ã€è®¿é—®ä¿¡æ¯æœ‰IPä¿¡æ¯æç¤º1ã€é—®é¢˜ï¼šæ²¡æœ‰IPæç¤º 2ã€ä¿®æ”¹8001prefer-ip-address: true #è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºIPåœ°å€ 3ã€æ•ˆæœ 5ã€æœåŠ¡å‘ç°Discovery1ã€æ¦‚è¿°å¯¹äºæ³¨å†Œè¿›eurekaé‡Œé¢çš„å¾®æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡å‘ç°æ¥è·å¾—è¯¥æœåŠ¡çš„ä¿¡æ¯ 2ã€ä¿®æ”¹8001çš„Controller1ã€å¢åŠ @Resource private DiscoveryClient discoveryClient; @Value(\"${server.port}\") private String serverPort; /** * æŸ¥çœ‹æ³¨å†ŒæœåŠ¡çš„ä¿¡æ¯ * @return */ @GetMapping(value = \"/payment/discovery\") public Object discovery() { // ç›®å‰å·²ç»æ³¨å†Œçš„å¾®æœåŠ¡åˆ—è¡¨ List&lt;String&gt; services = discoveryClient.getServices ( ); for (String element : services) { log.info (element); } // æ ¹æ®åç§°è·å–çš„å¾®æœåŠ¡å®ä¾‹ï¼ˆå°±åƒç±»å’Œå¯¹è±¡çš„å…³ç³»ï¼‰ List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances (\"CLOUD-PAYMENT-SERVICE\"); for (ServiceInstance element : instances) { log.info (element.getServiceId ( ) + \"\\t\" + element.getHost ( ) + \"\\t\" + element.getPort ( ) + \"\\t\" + element.getUri ( )); } return this.discoveryClient; } 2ã€å…¨éƒ¨package com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import com.kk.springcloud.service.PaymentService; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Value; import org.springframework.cloud.client.ServiceInstance; import org.springframework.cloud.client.discovery.DiscoveryClient; import org.springframework.web.bind.annotation.*; import javax.annotation.Resource; import java.util.List; @RestController @Slf4j /* * @Description: * @Author: é˜¿K * @CreateDate: 2022/1/16 18:11 * @Param: * @Return: **/ public class PaymentController { @Resource private PaymentService paymentService; @Resource private DiscoveryClient discoveryClient; @Value(\"${server.port}\") private String serverPort; /** * æŸ¥çœ‹æ³¨å†ŒæœåŠ¡çš„ä¿¡æ¯ * * @return */ @GetMapping(value = \"/payment/discovery\") public Object discovery() { // ç›®å‰å·²ç»æ³¨å†Œçš„å¾®æœåŠ¡åˆ—è¡¨ List&lt;String&gt; services = discoveryClient.getServices ( ); for (String element : services) { log.info (element); } // æ ¹æ®åç§°è·å–çš„å¾®æœåŠ¡å®ä¾‹ï¼ˆå°±åƒç±»å’Œå¯¹è±¡çš„å…³ç³»ï¼‰ List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances (\"CLOUD-PAYMENT-SERVICE\"); for (ServiceInstance element : instances) { log.info (element.getServiceId ( ) + \"\\t\" + element.getHost ( ) + \"\\t\" + element.getPort ( ) + \"\\t\" + element.getUri ( )); } return this.discoveryClient; } @PostMapping(value = \"/payment/create\") public CommonResult create(@RequestBody Payment payment) { int result = paymentService.create (payment); log.info (\"*****æ’å…¥ç»“æœ1ï¼š\" + result + \"111\"); if (result &gt; 0) { //æˆåŠŸ return new CommonResult (200, \"æ’å…¥æ•°æ®åº“æˆåŠŸ\", result); } else { return new CommonResult (444, \"æ’å…¥æ•°æ®åº“å¤±è´¥\", null); } } @GetMapping(value = \"/payment/get/{id}\") public CommonResult getPaymentById(@PathVariable(\"id\") Long id) { Payment payment = paymentService.getPaymentById (id); log.info (\"*****æŸ¥è¯¢ç»“æœï¼š\" + payment); if (payment != null) { //è¯´æ˜æœ‰æ•°æ®ï¼Œèƒ½æŸ¥è¯¢æˆåŠŸ return new CommonResult (200, \"æŸ¥è¯¢æˆåŠŸ8081\", payment); } else { return new CommonResult (444, \"æ²¡æœ‰å¯¹åº”è®°å½•ï¼ŒæŸ¥è¯¢IDï¼š\" + id, null); } } } 3ã€8001ä¸»å¯åŠ¨1ã€å¢åŠ @EnableDiscoveryClient 2ã€å…¨éƒ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient// æ­¤æ³¨è§£åæœŸè‹¥æ˜¯ä¸ç”¨ Eurekaï¼Œå°†è¢«ä¸‹æ–¹æ³¨è§£æ‰€ä»£æ›¿ @EnableDiscoveryClient// æœåŠ¡æ³¨å†Œå‘ç° public class PaymentMain8001 { public static void main(String[] args) { SpringApplication.run (PaymentMain8001.class, args); } } 4ã€æµ‹è¯•1ã€å¯åŠ¨é¡ºåºå…ˆè¦å¯åŠ¨EurekaServerï¼Œå†å¯åŠ¨8001ä¸»å¯åŠ¨ç±»ï¼Œéœ€è¦ç¨ç­‰ä¸€ä¼šå„¿ 2ã€è®¿é—®http://localhost:8001/payment/discovery 6ã€Eurekaè‡ªæˆ‘ä¿æŠ¤1ã€æ•…éšœç°è±¡ä¿æŠ¤æ¨¡å¼ä¸»è¦ç”¨äºä¸€ç»„å®¢æˆ·ç«¯å’ŒEureka Serverä¹‹é—´å­˜åœ¨ç½‘ç»œåˆ†åŒºåœºæ™¯ä¸‹çš„ä¿æŠ¤ã€‚ä¸€æ—¦è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼ŒEureka Serverå°†ä¼šå°è¯•ä¿æŠ¤å…¶æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†åˆ é™¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šæ³¨é”€ä»»ä½•å¾®æœåŠ¡ã€‚ å¦‚æœåœ¨Eureka Serverçš„é¦–é¡µçœ‹åˆ°ä»¥ä¸‹è¿™æ®µæç¤ºï¼Œåˆ™è¯´æ˜Eurekaè¿›å…¥äº†ä¿æŠ¤æ¨¡å¼ï¼šEMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEYâ€™RE NOT.RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE 2ã€å¯¼è‡´åŸå› æ­¤ä¸¾å±äºCAPé‡Œé¢çš„APåˆ†æ”¯ ä¸€å¥è¯ï¼šæŸæ—¶åˆ»æŸä¸€ä¸ªå¾®æœåŠ¡ä¸å¯ç”¨äº†ï¼ŒEurekaä¸ä¼šç«‹åˆ»æ¸…ç†ï¼Œä¾æ—§ä¼šå¯¹è¯¥å¾®æœåŠ¡çš„ä¿¡æ¯è¿›è¡Œä¿å­˜ 1ã€é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆä¼šäº§ç”ŸEurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Ÿ ä¸ºäº†é˜²æ­¢EurekaClientå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ ä¸ EurekaServerç½‘ç»œä¸é€šæƒ…å†µä¸‹ï¼ŒEurekaServerä¸ä¼šç«‹åˆ»å°†EurekaClientæœåŠ¡å‰”é™¤ 2ã€é—®é¢˜äºŒï¼šä»€ä¹ˆæ˜¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Ÿ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœEurekaServeråœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡å®ä¾‹çš„å¿ƒè·³ï¼ŒEurekaServerå°†ä¼šæ³¨é”€è¯¥å®ä¾‹ï¼ˆé»˜è®¤90ç§’ï¼‰ã€‚ä½†æ˜¯å½“ç½‘ç»œåˆ†åŒºæ•…éšœå‘ç”Ÿ(å»¶æ—¶ã€å¡é¡¿ã€æ‹¥æŒ¤)æ—¶ï¼Œå¾®æœåŠ¡ä¸EurekaServerä¹‹é—´æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œä»¥ä¸Šè¡Œä¸ºå¯èƒ½å˜å¾—éå¸¸å±é™©äº†â€”â€”å› ä¸ºå¾®æœåŠ¡æœ¬èº«å…¶å®æ˜¯å¥åº·çš„ï¼Œæ­¤æ—¶æœ¬ä¸åº”è¯¥æ³¨é”€è¿™ä¸ªå¾®æœåŠ¡ã€‚Eurekaé€šè¿‡â€œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”å½“EurekaServerèŠ‚ç‚¹åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶ï¼ˆå¯èƒ½å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºæ•…éšœï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚ 3ã€æ€ä¹ˆç¦æ­¢è‡ªæˆ‘ä¿æŠ¤1ã€æ³¨å†Œä¸­å¿ƒ7001ï¼ˆ1ï¼‰å‡ºå‚é»˜è®¤ï¼Œè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶æ˜¯å¼€å¯çš„ eureka.server.enable-self-preservation=true ï¼ˆ2ï¼‰ä½¿ç”¨eureka.server.enable-self-preservation = false å¯ä»¥ç¦ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ server: port: 7001 eureka: instance: hostname: eureka7001.com #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§° client: register-with-eureka: false #falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚ fetch-registry: false #falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡ service-url: defaultZone: http://eureka7002.com:7002/eureka/ server: #å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä¿è¯ä¸å¯ç”¨æœåŠ¡è¢«åŠæ—¶è¸¢é™¤ enable-self-preservation: false eviction-interval-timer-in-ms: 2000 ï¼ˆ3ï¼‰æ•ˆæœ 2ã€ç”Ÿäº§è€…80011ã€é»˜è®¤ï¼ˆ1ï¼‰å•ä½ä¸ºç§’(é»˜è®¤æ˜¯30ç§’) eureka.instance.lease-renewal-interval-in-seconds=30 ï¼ˆ2ï¼‰å•ä½ä¸ºç§’(é»˜è®¤æ˜¯90ç§’) eureka.instance.lease-expiration-duration-in-seconds=90 2ã€é…ç½® server: port: 8001 spring: application: name: cloud-payment-service datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: org.gjt.mm.mysql.Driver url: jdbc:mysql://localhost:3306/spring_cloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false username: root password: a1b2c3 eureka: client: #è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚ register-with-eureka: true #æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡ fetchRegistry: true service-url: #defaultZone: http://localhost:7001/eureka defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka # é›†ç¾¤ç‰ˆ instance: instance-id: payment8001 prefer-ip-address: true #è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºIPåœ°å€ #å¿ƒè·³æ£€æµ‹ä¸ç»­çº¦æ—¶é—´ #å¼€å‘æ—¶è®¾ç½®å°äº›ï¼Œä¿è¯æœåŠ¡å…³é—­åæ³¨å†Œä¸­å¿ƒèƒ½å³ä½¿å‰”é™¤æœåŠ¡ #Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯30ç§’) lease-renewal-interval-in-seconds: 1 #EurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯90ç§’)ï¼Œè¶…æ—¶å°†å‰”é™¤æœåŠ¡ lease-expiration-duration-in-seconds: 2 mybatis: mapperLocations: classpath:mapper/*.xml type-aliases-package: com.kk.springclond.entities 3ã€æµ‹è¯•ï¼ˆ1ï¼‰å…ˆå¯åŠ¨7001ï¼Œåœ¨å¯åŠ¨8001 ï¼ˆ2ï¼‰å†å…³é—­8001ï¼Œå‘ç°æœåŠ¡å·²ç»è¢«åˆ é™¤äº† 7ã€Eurekaåœæ›´``https://github.com/Netflix/eureka/wiki` æŠ€æœ¯é€‰å‹å¯ä»¥è€ƒè™‘ zookeeperã€nacos(alibaba)","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"æœåŠ¡æ³¨å†Œä¸å‘ç°","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"},{"name":"Eureka","slug":"Eureka","permalink":"https://mykkto.github.io/tags/Eureka/"}],"author":"mykk"},{"title":"SpringCloud é¡¹ç›®æ„å»º and æŠ€æœ¯é€‰å‹","slug":"03javaDistributed/01springcloud/01_SpringCloud-Build","date":"2022-01-12T15:42:15.000Z","updated":"2022-03-12T04:03:28.126Z","comments":true,"path":"posts/9df20094.html","link":"","permalink":"https://mykkto.github.io/posts/9df20094.html","excerpt":"","text":"1ã€ç‰ˆæœ¬ 2ã€å®˜ç½‘åœ°å€ã€Spring Cloudã€‘1ã€è‹±æ–‡https://cloud.spring.io/spring-cloud-static/Hoxton.SR1/reference/htmlsingle/ 2ã€ä¸­æ–‡https://www.bookstack.cn/read/spring-cloud-docs/docs-index.md 3ã€springboothttps://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/htmlsingle/ 3ã€é¡¹ç›®æ­å»º-çˆ¶å·¥ç¨‹æ„å»º çˆ¶å·¥ç¨‹åæ ‡ &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;!-- ç»Ÿä¸€ç®¡ç†jaråŒ…ç‰ˆæœ¬ --&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;junit.version&gt;4.12&lt;/junit.version&gt; &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt; &lt;lombok.version&gt;1.16.18&lt;/lombok.version&gt; &lt;mysql.version&gt;5.1.47&lt;/mysql.version&gt; &lt;druid.version&gt;1.1.16&lt;/druid.version&gt; &lt;mybatis.spring.boot.version&gt;1.3.0&lt;/mybatis.spring.boot.version&gt; &lt;/properties&gt; &lt;!-- å­æ¨¡å—ç»§æ‰¿ä¹‹åï¼Œæä¾›ä½œç”¨ï¼šé”å®šç‰ˆæœ¬+å­modlueä¸ç”¨å†™groupIdå’Œversion --&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!--spring boot 2.2.2--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt; &lt;version&gt;2.2.2.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--spring cloud Hoxton.SR1--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;Hoxton.SR1&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt; &lt;version&gt;2.1.0.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;${mysql.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;${druid.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${mybatis.spring.boot.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;${junit.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;${log4j.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;${lombok.version}&lt;/version&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;fork&gt;true&lt;/fork&gt; &lt;addResources&gt;true&lt;/addResources&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; 4ã€é¡¹ç›®æ­å»º-Restå¾®æœåŠ¡å·¥ç¨‹æ„å»º1ã€åæ ‡&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-provider-payment8001&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.10&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-jdbc --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 2ã€ymlserver: port: 8001 spring: application: name: cloud-payment-service datasource: type: com.alibaba.druid.pool.DruidDataSource driver-class-name: org.gjt.mm.mysql.Driver url: jdbc:mysql://localhost:3306/spring_cloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false username: root password: a1b2c3 mybatis: mapperLocations: classpath:mapper/*.xml type-aliases-package: com.kk.springclond.entities 3ã€ä¸»å¯åŠ¨@SpringBootApplication public class PaymentMain8001 { public static void main(String[] args) { SpringApplication.run (PaymentMain8001.class, args); } } 4ã€ä¸šåŠ¡ç±»1ã€å»ºè¡¨CREATE TABLE `payment` ( `id` bigint NOT NULL AUTO_INCREMENT , `serial` varchar(255) NULL , PRIMARY KEY (`id`) ) 2ã€å®ä½“ï¼ˆentityï¼‰ï¼ˆ1ï¼‰é€šç”¨è¿”å›ç»“æœå®ä½“@Data @AllArgsConstructor @NoArgsConstructor public class CommonResult&lt;T&gt; { private Integer code; private String message; private T data; public CommonResult(Integer code, String message) { this(code,message,null); } } ï¼ˆ2ï¼‰Payment@Data @AllArgsConstructor @NoArgsConstructor public class Payment { private Long id; private String serial; } 3ã€daoå±‚1ã€æ¥å£PaymentDaoç¼–å†™package com.kk.springcloud.dao; import com.kk.springcloud.entities.Payment; import org.apache.ibatis.annotations.Mapper; import org.apache.ibatis.annotations.Param; @Mapper public interface PaymentDao { public int create(Payment payment); //å†™ public Payment getPaymentById(@Param(\"id\") Long id); //è¯»å– } 2ã€mybatisçš„æ˜ å°„æ–‡ä»¶PaymentMapper.xmlï¼ˆ1ï¼‰è·¯å¾„src\\main\\resources\\mapper\\PaymentMapper.xml ï¼ˆ2ï¼‰å¤´æ–‡ä»¶&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt; &lt;mapper namespace=\"com.kk.springcloud.dao.PaymentDao\"&gt; &lt;insert id=\"create\" parameterType=\"com.kk.springcloud.entities.Payment\" useGeneratedKeys=\"true\" keyProperty=\"id\"&gt; insert into payment(serial) values(${serial}); &lt;/insert&gt; &lt;resultMap id=\"BaseResultMap\" type=\"com.kk.springcloud.entities.Payment\"&gt; &lt;id column=\"id\" property=\"id\" jdbcType=\"BIGINT\"&gt;&lt;/id&gt; &lt;id column=\"serial\" property=\"serial\" jdbcType=\"VARCHAR\"&gt;&lt;/id&gt; &lt;/resultMap&gt; &lt;select id=\"getPaymentById\" parameterType=\"Long\" resultMap=\"BaseResultMap\"&gt; select * from payment where id=#{id} &lt;/select&gt; &lt;/mapper&gt; 4ã€service1ã€æ¥å£package com.kk.springcloud.service; import com.kk.springcloud.entities.Payment; import org.apache.ibatis.annotations.Param; public interface PaymentService { public int create(Payment payment); //å†™ public Payment getPaymentById(@Param(\"id\") Long id); //è¯»å– } 2ã€å®ç°ç±»package com.kk.springcloud.service.impl; import com.kk.springcloud.dao.PaymentDao; import com.kk.springcloud.entities.Payment; import com.kk.springcloud.service.PaymentService; import org.springframework.stereotype.Service; import javax.annotation.Resource; @Service public class PaymentServiceImpl implements PaymentService { @Resource private PaymentDao paymentDao; public int create(Payment payment) { return paymentDao.create (payment); } public Payment getPaymentById(Long id) { return paymentDao.getPaymentById (id); } } 5ã€controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import com.kk.springcloud.service.PaymentService; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RestController; import javax.annotation.Resource; @RestController @Slf4j public class PaymentController { @Resource private PaymentService paymentService; @PostMapping(value = \"/payment/create\") public CommonResult create(Payment payment) { int result = paymentService.create (payment); log.info (\"*****æ’å…¥ç»“æœï¼š\" + result); if (result &gt; 0) { //æˆåŠŸ return new CommonResult (200, \"æ’å…¥æ•°æ®åº“æˆåŠŸ\", result); } else { return new CommonResult (444, \"æ’å…¥æ•°æ®åº“å¤±è´¥\", null); } } @GetMapping(value = \"/payment/get/{id}\") public CommonResult getPaymentById(@PathVariable(\"id\") Long id) { Payment payment = paymentService.getPaymentById (id); log.info (\"*****æŸ¥è¯¢ç»“æœï¼š\" + payment); if (payment != null) { //è¯´æ˜æœ‰æ•°æ®ï¼Œèƒ½æŸ¥è¯¢æˆåŠŸ return new CommonResult (200, \"æŸ¥è¯¢æˆåŠŸ\", payment); } else { return new CommonResult (444, \"æ²¡æœ‰å¯¹åº”è®°å½•ï¼ŒæŸ¥è¯¢IDï¼š\" + id, null); } } } 5ã€æµ‹è¯•1ã€æ’å…¥ï¼šä½¿ç”¨postè¯·æ±‚æ‰èƒ½è¢«æ’å…¥ï¼Œæ‰€ä»¥åœ¨urlä¸Šæ— æ•ˆï¼Œå¯ä»¥ä½¿ç”¨postmanhttp://localhost:8001/payment/create?serial=mykk02 2ã€æŸ¥è¯¢ï¼šgetè¯·æ±‚ï¼Œurlï¼Œpostmançš†å¯http://localhost:8001/payment/get/1 5ã€çƒ­éƒ¨ç½²1ã€å­å·¥ç¨‹ pomä¸Šé¢çš„ä¾èµ–å·²ç»æœ‰åŠ äº†ï¼Œæ˜¯è¿™ä¸ª 2ã€çˆ¶å·¥ç¨‹ pomæ’ä»¶ä¸Šé¢çš„ä¾èµ–å·²ç»æœ‰åŠ äº†ï¼Œæ˜¯è¿™ä¸ª 3ã€è®¾ç½®è‡ªåŠ¨ç¼–è¯‘ 4ã€å¼€å¯è‡ªåŠ¨æ›´æ–°1ã€æ‰“å¼€è®¾ç½®é¢æ¿ctrl + shift + alt + /åŒæ—¶æŒ‰ä½ï¼Œç‚¹å‡»ç¬¬ä¸€ä¸ªRegistry... 2ã€ä¸¤ä¸ªæ‰“å‹¾ 5ã€é‡å¯ IDEA6ã€é¡¹ç›®æ­å»º-Orderè®¢å•å¾®æœåŠ¡æ„å»º1ã€åæ ‡&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-consumer-order80&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 2ã€ymlserver: port: 80 3ã€ä¸»å¯åŠ¨package com.kk.springcloud; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication public class OrderMain80 { public static void main(String[] args) { SpringApplication.run (OrderMain80.class,args); } } 4ã€ä¸šåŠ¡ç±»1ã€åˆ›å»ºentities å°†cloud-provider-payment8001å·¥ç¨‹ä¸‹çš„entitiesåŒ…ä¸‹çš„ä¸¤ä¸ªå®ä½“ç±»å¤åˆ¶è¿‡æ¥ 2ã€RestTemplate1ã€å®˜ç½‘ï¼š https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html 2ã€æ˜¯ä»€ä¹ˆ 3ã€æ€ä¹ˆç”¨ 3ã€é…ç½®ç±»ApplicationContextConfig package com.kk.springcloud.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.web.client.RestTemplate; @Configuration public class ApplicationContextConfig { @Bean public RestTemplate getRestTemplate(){ return new RestTemplate(); } } 4ã€åˆ›å»º controllerpackage com.kk.springcloud.controller; import com.kk.springcloud.entities.CommonResult; import com.kk.springcloud.entities.Payment; import lombok.extern.slf4j.Slf4j; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; import javax.annotation.Resource; @RestController @Slf4j public class OrderController { public static final String PAYMENT_URL = \"http://localhost:8001\"; @Resource private RestTemplate restTemplate; @GetMapping(\"/consumer/payment/create\") public CommonResult&lt;Payment&gt; create(Payment payment) { return restTemplate.postForObject (PAYMENT_URL + \"/payment/create\", payment, CommonResult.class); //å†™æ“ä½œ } @GetMapping(\"/consumer/payment/get/{id}\") public CommonResult&lt;Payment&gt; getPayment(@PathVariable(\"id\") Long id) { return restTemplate.getForObject (PAYMENT_URL + \"/payment/get/\" + id, CommonResult.class); } } 5ã€æµ‹è¯•1ã€å…ˆå¯åŠ¨cloud-provider-payment80012ã€å†å¯åŠ¨cloud-consumer-order803ã€æµ‹è¯•æ¶ˆè´¹è€…æ¥å£http://localhost/consumer/payment/get/1 æ³¨æ„ç‚¹ï¼šè¢«è°ƒç”¨çš„ç”Ÿäº§è€…æ¥å£ä¼ å‚è®°å¾—åŠ æ³¨è§£ 7ã€é¡¹ç›®é‡æ„1ã€è§‚å¯Ÿé—®é¢˜1ã€ç³»ç»Ÿä¸­æœ‰é‡å¤éƒ¨åˆ†ï¼Œé‡æ„ 2ã€æ–°å»ºå…¬å…±æ¨¡å—ã€cloud-api-commonsã€‘1ã€pom&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/cn.hutool/hutool-all --&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;5.1.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; 2ã€å®ä½“å°†è®¢å•æ¨¡å—å’Œæ”¯ä»˜æ¨¡å—å…¬å…±å®ä½“æ”¾åˆ°è¿™é‡Œ 3ã€æ”¹é€ è®¢å•å’Œæ”¯ä»˜1ã€åˆ é™¤å„è‡ªçš„åŸå…ˆæœ‰è¿‡çš„entitiesæ–‡ä»¶å¤¹2ã€å„è‡ªåˆ†åˆ«å¼•å…¥å…¬å…±æ¨¡å—&lt;!--å¼•å…¥å…¬å…±éƒ¨åˆ†--&gt; &lt;dependency&gt; &lt;groupId&gt;com.kk&lt;/groupId&gt; &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt; 7ã€é¡¹ç›®æ¨¡å—ç»“æ„å›¾","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æ­å»º","slug":"æ­å»º","permalink":"https://mykkto.github.io/tags/%E6%90%AD%E5%BB%BA/"}],"author":"mykk"},{"title":"å—åŸæ•…äºº","slug":"02informalessay/01duanzi/01_nanchengguren","date":"2022-01-10T17:33:22.000Z","updated":"2022-01-11T12:37:38.397Z","comments":true,"path":"posts/f2c0d8e3.html","link":"","permalink":"https://mykkto.github.io/posts/f2c0d8e3.html","excerpt":"","text":"æ‘˜è‡ªï¼šå—åŸæ•…äºº ç¬¬8æœŸå†…å®¹ï¼š 18å²ï¼Œä½ è¯»äº†å¤§å­¦ã€‚20å²ï¼Œä½ å¤§äºŒç»“æŸï¼Œå¼€å§‹æ‚”æ¨è‡ªå·±å‰ä¸¤å¹´å¹¼ç¨šçš„è¡Œä¸ºäºæ˜¯å¼€å§‹åŠªåŠ›22å²ä½ å¤§å­¦æ¯•ä¸šäº†ï¼Œå´å‘ç°æ‰¾ä¸åˆ°ä¸€ä»½ä»¤è‡ªå·±æ»¡æ„çš„å·¥ä½œ26å²ï¼Œä½ çœ‹ç€èº«è¾¹çš„äººéƒ½ç»“äº†å©šå©šç¤¼çš„ä»½å­é’±é€å¹´é€’å¢æ˜¥èŠ‚å›å®¶ï¼Œçˆ¶æ¯ä»å¸¦ä½ ä¸²äº²æˆšå˜æˆäº†å¸¦ä½ å»è§ç›¸äº²å¯¹è±¡è§äº†åå‡ ä¸ªå§‘å¨˜ä½ æ¯æ¬¡éƒ½è§‰å¾—å’Œé‚£ä¸ªå¥¹æ¯”å·®äº†ä¸€ç‚¹28å²é‚£å¹´ï¼Œä½ é‡åˆ°äº†ä¸€ä¸ªå’Œä½ é­é‡å·®ä¸å¤šçš„å§‘å¨˜ä½ ä»¬æœ‰ä¸€æ­æ²¡ä¸€æ­çš„èŠç€å¥¹è¯´ï¼šä½ è¿˜ä¸é”™ä½ å–äº†ä¸€å£å¯ä¹è¯´ï¼šä½ ä¹Ÿæ˜¯ä½ è¿˜ä¸ç¡®å®šå–œä¸å–œæ¬¢å¥¹åŒæ–¹å®¶é•¿å°±å·²ç»æ‘†å¥½äº†è®¢å©šå®´ç»“å©šçš„å‰ä¸€å‘¨ï¼Œä½ å’Œæœ‹å‹å‡ºå»å–é…’ä½ è¯´ï¼Œä¸æƒ³ç»“å©šæœ‹å‹è¯´ï¼Œä½ å•Šï¼Œå°±æ˜¯æƒ³å¤ªå¤šã€‚è°ä¸æ˜¯è¿™ä¹ˆè¿‡æ¥çš„ï¼Ÿ 29å²ï¼Œä½ ä»¬ç»ˆäºç»“äº†å©šå©šç¤¼åŠçš„ä¸å¤§ä¸å°ï¼Œæœ‹å‹æ¥çš„ä¸å¤šä¸å°‘æ”’äº†å‡ å¹´æƒ³è¦å»å®ç°ç†æƒ³çš„é’±æ­åœ¨äº†è¿™ä¸€åœºç™¾äººçš„ç§äººåº™ä¼šä¸Šå©šç¤¼è¿›è¡Œåˆ°ä¸­é—´å¸ä»ªå¸¦ç€æ ‡å‡†çš„å•†ä¸šåŒ–å¾®ç¬‘å¯¹ç€å°ä¸‹çš„äº²æœ‹å–Šé“è¦ä¸è¦è®©ä»–ä»¬äº²ä¸€ä¸ªï¼å°ä¸‹é‚£äº›äººè·Ÿç€ä¸€èµ·èµ·å“„ä¸çŸ¥é“ä¸ºä»€ä¹ˆä½ ç®€ç®€å•å•çš„äº²äº†ä¸€å£ä¿©äººæ¢å¤åˆ°äº†ä¸€å¼€å§‹çš„ç«™ä½ä½ å°å£°è¯´äº†ä¸€å¥ï¼šæˆ‘çˆ±ä½ é‚£ä¸ªæ˜¨å¤©è¿˜çœ‹ä¸æƒ¯ä½ å€’è…¾æ¨¡å‹çš„æ–°å¨˜æ„£äº†ä¸€ä¸‹è¯´ï¼šæˆ‘ä¹Ÿçˆ±ä½ ä½ ä¸ç¡®å®šå¥¹æ˜¯ä¸æ˜¯å¯¹ä½ è¯´çš„å°±åƒä½ ä¸ç¡®å®šæ˜¯ä¸æ˜¯å¯¹å¥¹è¯´çš„ä¸€æ ·å©šç¤¼ç»“æŸåï¼Œå¹¶æ²¡æœ‰ä½ æƒ³è±¡çš„æµªæ¼«ä½ å¬ç€å¤–å±‹çš„æ–°å¨˜ä¸€ç¬”ä¸€ç¬”çš„ç®—ç€ä»½å­é’±æƒ³ç€ä¸è¿‡æ‰ä¸¤å¹´ï¼Œæ€ä¹ˆå°±å˜æˆè¿™æ ·äº†æƒ³ç€æƒ³ç€ï¼Œæ´æˆ¿å¤œå°±ç¡ç€äº† 30å²ï¼Œå¥¹æ€€å­•äº†è¾æ‰äº†å·¥ä½œï¼Œåœ¨å®¶å…»èƒä½ åœ¨å…¬å¸é€æ¸æœ‰äº†ç‚¹åœ°ä½æ‰‹é‡Œç®¡ç€åæ¥ä¸ªäººç‹¬ç«‹è´Ÿè´£ä¸€ä¸ªé¡¹ç›®ç»“å©šå‰é™ªå«çš„é‚£è¾†20ä¸‡å·¦å³çš„è½¦ä¹Ÿå˜æˆäº†ä½ ä¸€ä¸ªäººçš„ç‹¬äº«ä½†ä½ ä¾ç„¶ä¸æ•¢æ”¾æ¾æ¯æ¬¡åŠ ç­ç”µè¯é‚£å¤´éƒ½æ˜¯æŠ±æ€¨ä¸å§”å±ˆä½†ä½ ä¸èƒ½äº‰è¾©ä»€ä¹ˆè°è®©å¥¹æ€€äº†ä½ çš„å­©å­åœ¨è¿™ä¸€åˆ»ä¸è®ºæ˜¯å¥¹çš„çˆ¶æ¯è¿˜æ˜¯ä½ çš„çˆ¶æ¯éƒ½æ— æ¡ä»¶çš„ç«™åœ¨è¿™ä¸€è¾¹31å²ï¼Œå­©å­è½åœ°äº†å‰å‰ååè¿å­•æ£€å¸¦ä½é™¢è´¹èŠ±äº†10ä¸‡å—é’±ä¸è¿‡æ— æ‰€è°“ä½ çœ‹ç€ä½ çš„å­©å­ï¼Œæ€ä¹ˆçœ‹æ€ä¹ˆå–œæ¬¢é«˜å…´çš„ä»¿ä½›è¿™æ˜¯ä½ çš„æ–°ç”Ÿ32å²ï¼Œè¿™æ˜¯äººç”Ÿæœ€ä¸æ„¿æ„é‡å¤çš„ä¸€å¹´å¹³å‡ç¡çœ 3å°æ—¶å­©å­æ¯ä¸€ä¸ªå°æ—¶éƒ½è¦é—¹è…¾ä¸€æ¬¡ç¬¬äºŒå¤©æ‹–ç€ç¡ä¸é†’çš„çœ¼ç›å»ä¸Šç­è€æ¿è¯´ä½ ä¸Šç­ä¸å¹²æ´»å›å®¶åª³å¦‡è¯´ä½ ä¸å¹²æ´»ä½ æƒ³äº†åŠå¤©ä¸æ˜ç™½ï¼Œé‚£è°å¹²æ´»å‘¢ï¼Ÿé‚£è¾†å¼€äº†3å¹´çš„è½¦æˆä¸ºäº†ä½ çœŸæ­£çš„å®¶ä½ ä¸åœ¨æŠ±æ€¨è·¯ä¸Šæ‹¥å µçš„äº¤é€šä½ ç”šè‡³å¼€å§‹å¸Œæœ›å†å¤šå µä¸€ä¼šå›åˆ°å®¶ï¼Œä½ å…³äº†å‘åŠ¨æœºåœ¨è½¦ä¸Šç‚¹äº†ä¸€æ ¹çƒŸè¿™æ˜¯ä½ æ¯å¤©æœ€å¹¸ç¦çš„ååˆ†é’Ÿè½¦å‰æ˜¯åŠŸååˆ©ç¦„ï¼Œè½¦å°¾æ˜¯æŸ´ç±³æ²¹ç› 35å² ä½ å› ä¸ºèº«ä½“è¶Šæ¥è¶Šå·®åŠ ç­è¶Šæ¥è¶Šå°‘æ™‹å‡çš„é€Ÿåº¦ä¹Ÿè¶Šæ¥è¶Šç¼“æ…¢é‚£å¤©ä¸‹ç­ï¼Œåª³å¦‡å‘Šè¯‰ä½ å­©å­è¦ä¸Šå¹¼å„¿å›­äº†åŒè¯­çš„ä¸€ä¸ªæœˆ3000ä½ çš±äº†çš±çœ‰å¤´ï¼Œé‚£è¾¹å°±å·²ç»ä¸è€çƒ¦äº†â€œå››å•å…ƒçš„è€ç‹å®¶å­©å­ï¼Œä¸€ä¸ªæœˆ6000â€â€œä½ å·²ç»è¿™æ ·äº†ï¼Œä½ æƒ³è®©å­©å­ä¹Ÿè¾“ï¼Ÿâ€ä½ æ²¡è¯´è¯ï¼Œå›å±‹ç»™åª³å¦‡è½¬äº†6000å—é’±è¿™ç¬”é’±ï¼Œä½ åŸæœ¬æ‰“ç®—ç»™è‡ªå·±è¿‡ä¸ªç”Ÿæ—¥ï¼Œä¹°ä¸ªæ–°ç”µè„‘ 38å²ï¼Œå­©å­ä¸Šäº†ä¸€å¹´çº§è€å¸ˆè¯´ä¸€å¹´çº§æœ€å…³é”®ï¼Œæ‰“å¥½åŸºç¡€å¾ˆé‡è¦ä½ ç¬‘ç€è¯´ï¼Œæ˜¯æ˜¯æ˜¯ï¼Œè€å¸ˆæ‚¨å¤šç…§é¡¾æ–°ç”Ÿæ¥å¾…çš„è€å¸ˆçœ‹ç€ä½ ä¸æ˜äº‹ç†çš„è„¸ç»™ä½ æŒ‡äº†ä¸€æ¡æ˜è·¯â€œè¯¾å¤–è¾…å¯¼ç­ï¼Œä¸€ä¸ªæœˆ2200â€40å²çš„æ—¶å€™ï¼Œå­©å­ä¸Šäº†ä¸‰å¹´çº§è€å¸ˆè¯´ï¼Œä¸‰å¹´çº§ï¼Œæœ€å…³é”®ï¼Œæ‰¿ä¸Šå¯ä¸‹å¾ˆé‡è¦ä½ ç¬‘ç€è¯´ï¼šæ˜¯æ˜¯æ˜¯ï¼Œæ­£æ‰“ç®—å†æŠ¥ä¸ªè¡¥ä¹ ç­ 44å²ï¼Œå­©å­ä¸Šäº†åˆä¸­æœ‰ä¸€å¤©å›åˆ°å®¶ï¼Œå¥¹å¯¹ä½ è¯´çˆ¸çˆ¸ï¼Œæˆ‘æƒ³å­¦é’¢ç´ä½ æ²¡ä»€ä¹ˆçŠ¹è±«çš„ä½ ä»¥ä¸ºè¿™äº›å¹´ï¼Œä½ å·²ç»ä¹ æƒ¯äº†ä½†é‚£å¥â€œçˆ¸çˆ¸ç°åœ¨ä¹°ä¸èµ·â€ä½ å§‹ç»ˆè¯´ä¸å‡ºå£å¥½åœ¨å­©å­æ¯”è¾ƒæ‡‚äº‹å¥¹è¯´ï¼šçˆ¸çˆ¸æ²¡äº‹ï¼Œè¦ä¸æˆ‘å…ˆå­¦é™¶ç¬›ä¹Ÿå¯ä»¥ä½ çœ‹ç€è¿™ä¹ˆæ‡‚äº‹çš„å­©å­ï¼Œå´å¼€å¿ƒä¸èµ·æ¥ 46å²ï¼Œå­©å­ä¸Šäº†ä¸€ä¸ªä¸å¥½ä¸å·®çš„é«˜ä¸­æœ‰ä¸€å¤©ä½ åœ¨å¼€ä¼šï¼Œæ¥åˆ°äº†è€å¸ˆçš„ç”µè¯ç”µè¯é‡Œè¯´ä½ çš„å­©å­åœ¨å­¦æ ¡æ‰“æ¶äº†å«ä½ å»ä¸€è¶Ÿä½ å”¯å”¯è¯ºè¯ºçš„å’Œé‚£ä¸ªæ¯”ä½ è¿˜å°5å²çš„é¢†å¯¼è¯·äº†ä¸ªå‡åˆ°å­¦æ ¡åˆè¢«è€å¸ˆè®­äº†ä¸€é€šæ— éå°è¯å°±æ˜¯é‚£ä¸€å¥ä½ ä»¬åšå®¶é•¿çš„å°±çŸ¥é“å·¥ä½œï¼Œèƒ½ä¸èƒ½é™ªé™ªå­©å­ä½ çœ‹ç€è¿™ä¸ªè€å¸ˆï¼Œæœ‰ç‚¹å¯ç¬‘å¥½åƒå½“æ—¶è¯´ï¼šå®¶é•¿åœ¨å¤–è¾›è‹¦ç‚¹å¤šèµšç‚¹é’±è®©å­©å­å¤šè¡¥è¡¥è¯¾çš„å’Œä»–ä¸æ˜¯ä¸€ä¸ªäºº 50å²ï¼Œå­©å­ä¸Šäº†å¤§å­¦å¾ˆäº‰æ°”ï¼Œæ˜¯ä¸€ä¸ªä¸€æœ¬ä»–å­¦çš„ä¸“ä¸šä½ æœ‰ç‚¹çœ‹ä¸æ‡‚ä½ åªçŸ¥é“å·¥ä½œä¸ä¸€å®šå¥½æ‰¾è€Œä¸”å­¦è´¹è¿˜æ­»è´µä½ å’Œä»–æ·±å¤œæƒ³èŠèŠå‡†å¤‡äº†åŠæ–¤ç™½é…’ï¼Œä¸€ç¢ŸèŠ±ç”Ÿç±³ä½ è¯´ç€é‚£äº›æ›¾ç»ä½ æœ€è®¨åŒçš„è¯è¿˜æ˜¯è¦ä¸ºä»¥åå·¥ä½œç€æƒ³æŒ‘ä¸ªçƒ­é—¨çš„ä¸“ä¸šæ´»ç€æ¯”çƒ­çˆ±é‡è¦ä½ ä»¬ä»äº¤æµå˜æˆäº†äº‰åµä½ å‘ç°ï¼Œä½ è€äº†è€åˆ°å¯èƒ½éƒ½æ‰“ä¸è¿‡è¿™ä¸ª18å²çš„å­©å­ä½ è¯´ä¸è¿‡ä»–ï¼Œåªèƒ½è¯´ä¸€å¥ï¼šæˆ‘æ˜¯ä½ çˆ¸çˆ¸ï¼å­©å­çœ‹ç€ä½ ï¼ŒçŸ¥é“å†æ€ä¹ˆäº‰è¾©éƒ½æ²¡ç”¨è¿™åœºç¡®ç«‹ä½ æœ€åå¨ä¸¥çš„é…’å±€ä¸æ¬¢è€Œæ•£ä½ å¬çš„ä¸çœŸåˆ‡åœ¨å­©å­å›è‡ªå·±å±‹çš„è·¯ä¸Šå¥½åƒå¨å¨äº†ä¸€å¥â€œæˆ‘ä¸æƒ³æ´»çš„åƒä½ ä¸€æ ·â€æ€ä¹ˆå°±å“­äº†å‘¢ï¼Ÿ50å²çš„äººäº†ä¸€å®šæ˜¯é…’å¤ªè¾£äº†ï¼Œå¯¹ä¸å¯¹ä¸€å®šæ˜¯é…’å¤ªè¾£äº† 55å²ï¼Œå­©å­å·¥ä½œäº†ï¼Œä¼¼ä¹æœ‰ä¸€ç‚¹ç†è§£ä½ äº†ä½†ä½ å´åäº†è¿‡æ¥ï¼Œä½ è¯´ä¸è¦å¦¥å56å²ï¼Œå­©å­ä¹Ÿç»“å©šäº†ä½ é—®ä»–å–œæ¬¢é‚£ä¸ªå§‘å¨˜ä¹ˆä»–æ„£äº†æ„£è¯´ï¼šå–œæ¬¢å§60å²ï¼Œè¾›è‹¦äº†ä¸€è¾ˆå­ï¼Œæƒ³å‡ºå»èµ°èµ°èº«è¾¹çš„é‚£ä¸ªäººè¿‡äº†30å¹´ä½ ä¾æ—§åˆ†ä¸æ¸…åˆ°åº•å–œä¸å–œæ¬¢ä½ ä»¬å¼€å§‹è§„åˆ’æ—…æ¸¸è·¯çº¿è¿™ä¹ˆå¤šå¹´äº†ä½ ä»¬è¿˜æ˜¯å­˜åœ¨åˆ†æ­§ï¼Œè¿˜æ˜¯åœ¨äº‰åµæŸä¸ªç¬é—´ï¼Œä½ è§‰å¾—è¿™æ ·å¯èƒ½ä¹ŸæŒºå¥½ä¸€åˆ‡éƒ½å‡†å¤‡å¥½äº†å„¿å­è¯´ï¼šçˆ¸å¦ˆï¼Œæˆ‘å·¥ä½œå¤ªå¿™äº†å¯ä»¥å¸®æˆ‘ç…§é¡¾ä¸€ä¸‹å­©å­ä¹ˆä½ ä»¬é€€äº†æœºç¥¨ï¼Œåˆå›åˆ°äº†30å¹´å‰ 70å²ï¼Œå­©å­çš„å­©å­ä¹Ÿé•¿å¤§äº†ï¼Œä¸ç”¨å¤©å¤©æ“å¿ƒäº†ä½ ä¸‹å®šå†³å¿ƒè¯´ï¼šä¸€å®šè¦å»ç©ä¸€è¶Ÿå¯æ˜¯æ‰‹è¾¹çš„æ‹æ–åªèƒ½æ”¯æŒä½ èµ°åˆ°æ¥¼ä¸‹çš„èŠ±å›­75å²ï¼Œä½ åœ¨åŒ»é™¢çš„ç—…åºŠä¸Šèº«è¾¹èšæ»¡äº†äººï¼Œä½ è¿·è¿·ç³Šç³Šçš„çœ‹è§åŒ»ç”Ÿæ‘‡äº†æ‘‡å¤´å‘¨å›´é‚£äº›äººç¥æƒ…è‚ƒç©†ä½ æ˜ç™½äº†ï¼Œä½ è¦æ­»æ‰äº†ä½ æ²¡æœ‰æ„Ÿåˆ°ä¸€ä¸å®³æ€•ä½ çªç„¶é—®è‡ªå·±ï¼Œæˆ‘åˆ°åº•æ˜¯ä»€ä¹ˆæ—¶å€™æ­»æ‰çš„å‘¢ï¼Ÿä½ æƒ³èµ·æ¥30å²çš„é‚£åœºå©šç¤¼åŸæ¥ï¼Œé‚£æ—¶å€™ï¼Œä½ å°±æ­»æ‰äº†å§ ä¾ç…§æƒ¯ä¾‹æ­»å‰çš„3ç§’ï¼Œä½ çš„å¤§è„‘è¦èµ°é©¬ç¯å€’å™ä½ è¿™75ä¸ªå¹´å¤´çš„ä¸€ç”Ÿç”»é¢ä¸€å¼ ä¸€å¼ çš„è¿‡1ç§’2ç§’ä¸¤ç§’è¿‡å»äº†ä½ é¢æ— è¡¨æƒ…çš„çœ‹ç€è¿™ä¸¤ç§’å†…çš„å›å¿†ç¬¬3ç§’çªç„¶ä½ ç¬‘äº†åŸæ¥å·²ç»å›åˆ°äº†15å²çš„é‚£ä¸€å¹´ ä½ çœ‹è§ä¸€ä¸ªç”·å­©ä»–å¼ç€ä¸€è¢‹ç‰›å¥¶ï¼ŒèƒŒç€ä¹¦åŒ…ä»å¦ä¸€ä¸ªå¥³å­©å®¶çš„é˜³å°ä¸‹è·‘è¿‡é‚£ä¸ªç”·å­©æœçª—æˆ·é‡Œçœ‹äº†çœ‹é‚£æ˜¯15å²çš„ä½ æš—æ‹çš„é‚£ä¸ªå¥³å­©å­ä½ æƒ³ä¸èµ·æ¥å¥¹é•¿ä»€ä¹ˆæ ·å­äº†æœ€åä¸€ç§’ä½ åŠªåŠ›çš„å›å¿†ç€ç„¶åç»ˆäºç¬‘äº†å‡ºæ¥3ç§’è¿‡å»äº†èº«è¾¹çš„äººçªç„¶é—´å¼€å§‹åšå••å¤§å“­ä½ å¯èƒ½å¬ä¸æ¸…äº†ä½ æœ€åå¬åˆ°çš„å˜ˆæ‚çš„å£°éŸ³æ˜¯ä¸€ç¾¤åäº”å…­çš„å°‘å¹´ èµ·ç€å“„è¯´çš„ç­”åº”ä»–ç­”åº”ä»–ç­”åº”ä»–ä¸çˆ±ä½ ï¼Œä¸åº¦ç”Ÿ çƒ­è¯„ï¼šå–ä¸€ä½è´¦å·å·²æ³¨é”€çš„è¯„è®ºï¼šâ€œæœ‰äº›äºº27å²å°±æ­»äº†ï¼Œç›´åˆ°72å²æ‰è¢«åŸ‹ä¸Šâ€ã€‚èƒ½å¤Ÿæƒ³æ¸…æ¥šè¿‡å»ï¼ŒæŠ“å¾—ä½ç°åœ¨ï¼Œæ”¾çœ¼åœ¨æœªæ¥å§ï¼Œåšä¸€ä¸ªèƒ½æ´»åˆ°72å²çš„ç³Šæ¶‚è›‹ã€‚","categories":[{"name":"ç”Ÿæ´»ç¢ç‰‡åŒ–-æ®µå­","slug":"ç”Ÿæ´»ç¢ç‰‡åŒ–-æ®µå­","permalink":"https://mykkto.github.io/categories/%E7%94%9F%E6%B4%BB%E7%A2%8E%E7%89%87%E5%8C%96-%E6%AE%B5%E5%AD%90/"}],"tags":[{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"https://mykkto.github.io/tags/%E7%94%9F%E6%B4%BB/"},{"name":"æ®µå­","slug":"æ®µå­","permalink":"https://mykkto.github.io/tags/%E6%AE%B5%E5%AD%90/"},{"name":"æ„Ÿæ…¨","slug":"æ„Ÿæ…¨","permalink":"https://mykkto.github.io/tags/%E6%84%9F%E6%85%A8/"}],"author":"mykk"},{"title":"SpringCloud and Alibabaåˆé›†","slug":"03javaDistributed/01springcloud/00_SpringCloud","date":"2022-01-10T16:42:15.000Z","updated":"2022-02-21T15:50:41.674Z","comments":true,"path":"posts/58914314.html","link":"","permalink":"https://mykkto.github.io/posts/58914314.html","excerpt":"","text":"æ¡ˆä¾‹ä»£ç ä»“åº“https://gitee.com/TK_LIMR/springcloud2021To2021.git åˆ†è§£çš„ç›®å½•1ã€é¡¹ç›®æ„å»ºandæŠ€æœ¯é€‰å‹2ã€EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°4ã€ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°5ã€Ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨6ã€OpenFeignæœåŠ¡æ¥å£è°ƒç”¨7ã€Hystrixæ–­è·¯å™¨8ã€zuulè·¯ç”±ç½‘å…³9ã€Gatewayæ–°ä¸€ä»£ç½‘å…³10ã€Seataå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡11ã€Sentinelå®ç°ç†”æ–­ä¸é™æµ12ã€NacosæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ13ã€Sleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è¿½è¸ª14ã€Streamæ¶ˆæ¯é©±åŠ¨15ã€Bus æ¶ˆæ¯æ€»çº¿16ã€configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒé£Ÿç”¨æŠ€å·§1ã€åŒæ—¶å¯åŠ¨å¤šä¸ªSpringbootIDEA SpringBootå¤šä¸ªé¡¹ç›® å¼€å¯ RunDashboardï¼Œ åœ¨é¡¹ç›®æ ¹ç›®å½• .idea æ–‡ä»¶å¤¹ ä¸­ workspace.xmlæ–‡ä»¶ä¸­åŠ å…¥ &lt;component name=\"RunDashboard\"&gt; &lt;option name=\"configurationTypes\"&gt; &lt;set&gt; &lt;option value=\"SpringBootApplicationConfigurationType\" /&gt; &lt;/set&gt; &lt;/option&gt; &lt;/component&gt; 2ã€æœ¬åœ°hostsé…ç½®windown 10ä½ç½®ï¼šC:\\Windows\\System32\\drivers\\etc","categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"}],"tags":[{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"åˆé›†","slug":"åˆé›†","permalink":"https://mykkto.github.io/tags/%E5%90%88%E9%9B%86/"}],"author":"mykk"},{"title":"KKè¯­å½•ï¼ˆæ—¥è®°ï¼‰","slug":"02informalessay/02_è¯­å½•","date":"2022-01-10T15:12:19.000Z","updated":"2022-01-11T13:41:21.196Z","comments":true,"path":"posts/bd37926a.html","link":"","permalink":"https://mykkto.github.io/posts/bd37926a.html","excerpt":"","text":"","categories":[{"name":"ç”Ÿæ´»ç¢ç‰‡åŒ–","slug":"ç”Ÿæ´»ç¢ç‰‡åŒ–","permalink":"https://mykkto.github.io/categories/%E7%94%9F%E6%B4%BB%E7%A2%8E%E7%89%87%E5%8C%96/"}],"tags":[{"name":"è¯­å½•","slug":"è¯­å½•","permalink":"https://mykkto.github.io/tags/%E8%AF%AD%E5%BD%95/"},{"name":"æ—¥è®°","slug":"æ—¥è®°","permalink":"https://mykkto.github.io/tags/%E6%97%A5%E8%AE%B0/"},{"name":"è¯ç—¨","slug":"è¯ç—¨","permalink":"https://mykkto.github.io/tags/%E8%AF%9D%E7%97%A8/"}],"author":"mykk"},{"title":"ç¾æ–‡","slug":"02informalessay/01_ç¾æ–‡","date":"2022-01-10T14:33:12.000Z","updated":"2022-01-11T14:21:18.841Z","comments":true,"path":"posts/c3e91221.html","link":"","permalink":"https://mykkto.github.io/posts/c3e91221.html","excerpt":"","text":"","categories":[{"name":"ç”Ÿæ´»ç¢ç‰‡åŒ–","slug":"ç”Ÿæ´»ç¢ç‰‡åŒ–","permalink":"https://mykkto.github.io/categories/%E7%94%9F%E6%B4%BB%E7%A2%8E%E7%89%87%E5%8C%96/"}],"tags":[{"name":"ç¾æ–‡","slug":"ç¾æ–‡","permalink":"https://mykkto.github.io/tags/%E7%BE%8E%E6%96%87/"}],"author":"mykk"},{"title":"ç”Ÿæ´»ç¢ç‰‡æ–‡ç« é›†åˆæ±‡æ€»","slug":"01menu/03_éšç¬”ï¼ˆè¯­å½•ï¼‰","date":"2022-01-10T13:22:55.000Z","updated":"2022-01-10T13:55:50.327Z","comments":true,"path":"posts/1565718c.html","link":"","permalink":"https://mykkto.github.io/posts/1565718c.html","excerpt":"","text":"1ã€ç¾æ–‡2ã€è¯­å½•3ã€ç”µå½±4ã€ç¾å›¾5ã€å¿ƒå¾—","categories":[{"name":"æ–‡ç« èœå•åˆé›†","slug":"æ–‡ç« èœå•åˆé›†","permalink":"https://mykkto.github.io/categories/%E6%96%87%E7%AB%A0%E8%8F%9C%E5%8D%95%E5%90%88%E9%9B%86/"}],"tags":[{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"https://mykkto.github.io/tags/%E7%94%9F%E6%B4%BB/"},{"name":"æ€»çº²","slug":"æ€»çº²","permalink":"https://mykkto.github.io/tags/%E6%80%BB%E7%BA%B2/"},{"name":"åˆ†äº«","slug":"åˆ†äº«","permalink":"https://mykkto.github.io/tags/%E5%88%86%E4%BA%AB/"}],"author":"mykk"},{"title":"(æ–°)æŠ€æœ¯æ–‡ç« é›†åˆæ±‡æ€»","slug":"01menu/02_æ–°èœå•é›†åˆ","date":"2022-01-09T14:55:55.000Z","updated":"2022-01-10T16:16:03.843Z","comments":true,"path":"posts/f747eac7.html","link":"","permalink":"https://mykkto.github.io/posts/f747eac7.html","excerpt":"","text":"ä¸€ã€æŠ€æœ¯ï¼ˆè¾ƒä¸ºç³»ç»Ÿç¼–æ’ï¼‰1ã€javaæ•°æ®ç»“æ„ä¸ç®—æ³• â˜…11 https://www.jianshu.com/p/929ca9e209e8 2ã€javaè®¾è®¡æ¨¡å¼https://www.jianshu.com/p/63df8cd03619 8ã€javaå•ä½“æ¶æ„æŠ€æœ¯æ ˆhttps://www.jianshu.com/p/0a4a1ced23c7 9ã€javaåˆ†å¸ƒå¼æ¶æ„æŠ€æœ¯æ ˆhttps://www.jianshu.com/p/00aa796bb5b8 10ã€æ¡†æ¶ä¹‹å¤–æŠ€æœ¯æ ˆæ±‡æ€»https://www.jianshu.com/p/d0167f082cbf N1ã€å†…åŠ›ç¯‡æ±‡æ€»0-javaå†…åŠ›â€”â€”æ€»çº² - ç®€ä¹¦ (jianshu.com) 11ã€Liunxhttps://www.jianshu.com/p/409970d8d0f1 12ã€å‰ç«¯å¤§æ‚çƒ©https://www.jianshu.com/p/82fa0c99e019 13ã€å„é¡¹ç›®æ•´åˆåˆ†è§£å¤§æ‚çƒ©https://www.jianshu.com/p/d30b07569dc3 14ã€é¢è¯•é¢˜æ±‡æ€»ï¼šæŠ€æœ¯=é¢è¯•é¢˜+é¡¹ç›®æ€»ç»“ â˜…https://www.jianshu.com/p/5e3b81aef034 15ã€ä¸€äº›ä¸é”™çš„ç½‘ç«™ï¼šhttps://www.jianshu.com/p/53bf0d4a930d 16ã€éšæ€§è®°å½•ä¸€å°ç‚¹éšæ€§è®°å½•ä¸€å°ç‚¹ 2021-07-15è‡³æœªæ¥ 7ã€å·¥å…·ä»£ç å¤‡ä»½UT-å·¥å…·ä»£ç  JDKå„ç‰ˆæœ¬æ¼”å˜ 4ã€netty 5ã€JVMã€é‡é‡çº§ã€‘ nã€å¤§æ•°æ®nã€å‰ç«¯nã€golangnã€ä»¥å¤ªåŠnã€åŒºå—é“¾nã€scala 2ã€å·¥ä½œï¼Œåšå®¢ï¼Œå…¬ä¼—å·ç­‰æ‰€å­¦æŠ€æœ¯æ±‡æ€»3ã€å¿ƒå¾—ï¼ˆå·¥ä½œï¼‰4ã€è¯­å½•ï¼ˆæ„Ÿæ‚Ÿï¼‰","categories":[{"name":"æ–‡ç« èœå•åˆé›†","slug":"æ–‡ç« èœå•åˆé›†","permalink":"https://mykkto.github.io/categories/%E6%96%87%E7%AB%A0%E8%8F%9C%E5%8D%95%E5%90%88%E9%9B%86/"}],"tags":[{"name":"ç®€ä¹¦","slug":"ç®€ä¹¦","permalink":"https://mykkto.github.io/tags/%E7%AE%80%E4%B9%A6/"},{"name":"æŠ€æœ¯æ€»çº²","slug":"æŠ€æœ¯æ€»çº²","permalink":"https://mykkto.github.io/tags/%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BA%B2/"}],"author":"mykk"},{"title":"(æ—§)ç®€ä¹¦æ–‡ç« è¿‡å¾€ä¸¤å¹´çº²è¦","slug":"01menu/01_æ—§èœå•åˆé›†","date":"2022-01-09T11:19:19.000Z","updated":"2022-01-10T16:12:51.476Z","comments":true,"path":"posts/c3e91221.html","link":"","permalink":"https://mykkto.github.io/posts/c3e91221.html","excerpt":"","text":"1ã€æŠ€æœ¯ï¼ˆè¾ƒä¸ºç³»ç»Ÿç¼–æ’ï¼‰1ã€javaæ•°æ®ç»“æ„ä¸ç®—æ³• â˜…https://www.jianshu.com/p/929ca9e209e8 2ã€javaè®¾è®¡æ¨¡å¼https://www.jianshu.com/p/63df8cd03619 8ã€javaå•ä½“æ¶æ„æŠ€æœ¯æ ˆhttps://www.jianshu.com/p/0a4a1ced23c7 9ã€javaåˆ†å¸ƒå¼æ¶æ„æŠ€æœ¯æ ˆhttps://www.jianshu.com/p/00aa796bb5b8 10ã€æ¡†æ¶ä¹‹å¤–æŠ€æœ¯æ ˆæ±‡æ€»https://www.jianshu.com/p/d0167f082cbf N1ã€å†…åŠ›ç¯‡æ±‡æ€»0-javaå†…åŠ›â€”â€”æ€»çº² - ç®€ä¹¦ (jianshu.com) 11ã€Liunxhttps://www.jianshu.com/p/409970d8d0f1 12ã€å‰ç«¯å¤§æ‚çƒ©https://www.jianshu.com/p/82fa0c99e019 13ã€å„é¡¹ç›®æ•´åˆåˆ†è§£å¤§æ‚çƒ©https://www.jianshu.com/p/d30b07569dc3 14ã€é¢è¯•é¢˜æ±‡æ€»ï¼šæŠ€æœ¯=é¢è¯•é¢˜+é¡¹ç›®æ€»ç»“ â˜…https://www.jianshu.com/p/5e3b81aef034 15ã€ä¸€äº›ä¸é”™çš„ç½‘ç«™ï¼šhttps://www.jianshu.com/p/53bf0d4a930d 16ã€éšæ€§è®°å½•ä¸€å°ç‚¹éšæ€§è®°å½•ä¸€å°ç‚¹ 2021-07-15è‡³æœªæ¥ 7ã€å·¥å…·ä»£ç å¤‡ä»½UT-å·¥å…·ä»£ç  JDKå„ç‰ˆæœ¬æ¼”å˜ 4ã€netty 5ã€JVMã€é‡é‡çº§ã€‘ nã€å¤§æ•°æ®nã€å‰ç«¯nã€golangnã€ä»¥å¤ªåŠnã€åŒºå—é“¾nã€scala 2ã€å·¥ä½œï¼Œåšå®¢ï¼Œå…¬ä¼—å·ç­‰æ‰€å­¦æŠ€æœ¯æ±‡æ€»3ã€å¿ƒå¾—ï¼ˆå·¥ä½œï¼‰4ã€è¯­å½•ï¼ˆæ„Ÿæ‚Ÿï¼‰","categories":[{"name":"æ–‡ç« èœå•åˆé›†","slug":"æ–‡ç« èœå•åˆé›†","permalink":"https://mykkto.github.io/categories/%E6%96%87%E7%AB%A0%E8%8F%9C%E5%8D%95%E5%90%88%E9%9B%86/"}],"tags":[{"name":"ç®€ä¹¦","slug":"ç®€ä¹¦","permalink":"https://mykkto.github.io/tags/%E7%AE%80%E4%B9%A6/"},{"name":"æŠ€æœ¯æ€»çº²","slug":"æŠ€æœ¯æ€»çº²","permalink":"https://mykkto.github.io/tags/%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BA%B2/"}],"author":"mykk"}],"categories":[{"name":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","slug":"åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ","permalink":"https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"},{"name":"è®¡ç®—æœºè¯­è¨€","slug":"è®¡ç®—æœºè¯­è¨€","permalink":"https://mykkto.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/"},{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://mykkto.github.io/categories/%E5%8D%9A%E5%AE%A2/"},{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://mykkto.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://mykkto.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"ç”Ÿæ´»ç¢ç‰‡åŒ–-æ®µå­","slug":"ç”Ÿæ´»ç¢ç‰‡åŒ–-æ®µå­","permalink":"https://mykkto.github.io/categories/%E7%94%9F%E6%B4%BB%E7%A2%8E%E7%89%87%E5%8C%96-%E6%AE%B5%E5%AD%90/"},{"name":"ç”Ÿæ´»ç¢ç‰‡åŒ–","slug":"ç”Ÿæ´»ç¢ç‰‡åŒ–","permalink":"https://mykkto.github.io/categories/%E7%94%9F%E6%B4%BB%E7%A2%8E%E7%89%87%E5%8C%96/"},{"name":"æ–‡ç« èœå•åˆé›†","slug":"æ–‡ç« èœå•åˆé›†","permalink":"https://mykkto.github.io/categories/%E6%96%87%E7%AB%A0%E8%8F%9C%E5%8D%95%E5%90%88%E9%9B%86/"}],"tags":[{"name":"jvm","slug":"jvm","permalink":"https://mykkto.github.io/tags/jvm/"},{"name":"å­—èŠ‚ç ","slug":"å­—èŠ‚ç ","permalink":"https://mykkto.github.io/tags/%E5%AD%97%E8%8A%82%E7%A0%81/"},{"name":"nginx","slug":"nginx","permalink":"https://mykkto.github.io/tags/nginx/"},{"name":"lua","slug":"lua","permalink":"https://mykkto.github.io/tags/lua/"},{"name":"openresty","slug":"openresty","permalink":"https://mykkto.github.io/tags/openresty/"},{"name":"springcloud-alibaba","slug":"springcloud-alibaba","permalink":"https://mykkto.github.io/tags/springcloud-alibaba/"},{"name":"seata","slug":"seata","permalink":"https://mykkto.github.io/tags/seata/"},{"name":"åˆ†å¸ƒå¼äº‹åŠ¡","slug":"åˆ†å¸ƒå¼äº‹åŠ¡","permalink":"https://mykkto.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"},{"name":"blog","slug":"blog","permalink":"https://mykkto.github.io/tags/blog/"},{"name":"éƒ¨ç½²","slug":"éƒ¨ç½²","permalink":"https://mykkto.github.io/tags/%E9%83%A8%E7%BD%B2/"},{"name":"å°å§¿åŠ¿","slug":"å°å§¿åŠ¿","permalink":"https://mykkto.github.io/tags/%E5%B0%8F%E5%A7%BF%E5%8A%BF/"},{"name":"ç†”æ–­å™¨","slug":"ç†”æ–­å™¨","permalink":"https://mykkto.github.io/tags/%E7%86%94%E6%96%AD%E5%99%A8/"},{"name":"sentinel","slug":"sentinel","permalink":"https://mykkto.github.io/tags/sentinel/"},{"name":"é™æµ","slug":"é™æµ","permalink":"https://mykkto.github.io/tags/%E9%99%90%E6%B5%81/"},{"name":"nacos","slug":"nacos","permalink":"https://mykkto.github.io/tags/nacos/"},{"name":"é›†ç¾¤","slug":"é›†ç¾¤","permalink":"https://mykkto.github.io/tags/%E9%9B%86%E7%BE%A4/"},{"name":"docker-compose","slug":"docker-compose","permalink":"https://mykkto.github.io/tags/docker-compose/"},{"name":"AQS","slug":"AQS","permalink":"https://mykkto.github.io/tags/AQS/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://mykkto.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"JUC","slug":"JUC","permalink":"https://mykkto.github.io/tags/JUC/"},{"name":"oracle","slug":"oracle","permalink":"https://mykkto.github.io/tags/oracle/"},{"name":"docker","slug":"docker","permalink":"https://mykkto.github.io/tags/docker/"},{"name":"å®‰è£…","slug":"å®‰è£…","permalink":"https://mykkto.github.io/tags/%E5%AE%89%E8%A3%85/"},{"name":"æœåŠ¡æ³¨å†Œä¸å‘ç°","slug":"æœåŠ¡æ³¨å†Œä¸å‘ç°","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/"},{"name":"é…ç½®ä¸­å¿ƒ","slug":"é…ç½®ä¸­å¿ƒ","permalink":"https://mykkto.github.io/tags/%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"},{"name":"springcloud","slug":"springcloud","permalink":"https://mykkto.github.io/tags/springcloud/"},{"name":"æœåŠ¡è·Ÿè¸ª","slug":"æœåŠ¡è·Ÿè¸ª","permalink":"https://mykkto.github.io/tags/%E6%9C%8D%E5%8A%A1%E8%B7%9F%E8%B8%AA/"},{"name":"sleuth","slug":"sleuth","permalink":"https://mykkto.github.io/tags/sleuth/"},{"name":"æ¶ˆæ¯é©±åŠ¨","slug":"æ¶ˆæ¯é©±åŠ¨","permalink":"https://mykkto.github.io/tags/%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/"},{"name":"stream","slug":"stream","permalink":"https://mykkto.github.io/tags/stream/"},{"name":"bus","slug":"bus","permalink":"https://mykkto.github.io/tags/bus/"},{"name":"èŠ‚ç‚¹é“¾æ¥","slug":"èŠ‚ç‚¹é“¾æ¥","permalink":"https://mykkto.github.io/tags/%E8%8A%82%E7%82%B9%E9%93%BE%E6%8E%A5/"},{"name":"config","slug":"config","permalink":"https://mykkto.github.io/tags/config/"},{"name":"è·¯ç”±ç½‘å…³","slug":"è·¯ç”±ç½‘å…³","permalink":"https://mykkto.github.io/tags/%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3/"},{"name":"alibaba","slug":"alibaba","permalink":"https://mykkto.github.io/tags/alibaba/"},{"name":"gateway","slug":"gateway","permalink":"https://mykkto.github.io/tags/gateway/"},{"name":"linux","slug":"linux","permalink":"https://mykkto.github.io/tags/linux/"},{"name":"mysql","slug":"mysql","permalink":"https://mykkto.github.io/tags/mysql/"},{"name":"netflix","slug":"netflix","permalink":"https://mykkto.github.io/tags/netflix/"},{"name":"zuul","slug":"zuul","permalink":"https://mykkto.github.io/tags/zuul/"},{"name":"æ–­è·¯å™¨","slug":"æ–­è·¯å™¨","permalink":"https://mykkto.github.io/tags/%E6%96%AD%E8%B7%AF%E5%99%A8/"},{"name":"Hystrix","slug":"Hystrix","permalink":"https://mykkto.github.io/tags/Hystrix/"},{"name":"è¿œç¨‹è°ƒç”¨æœåŠ¡","slug":"è¿œç¨‹è°ƒç”¨æœåŠ¡","permalink":"https://mykkto.github.io/tags/%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1/"},{"name":"openfeign","slug":"openfeign","permalink":"https://mykkto.github.io/tags/openfeign/"},{"name":"è´Ÿè½½å‡è¡¡","slug":"è´Ÿè½½å‡è¡¡","permalink":"https://mykkto.github.io/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"},{"name":"ribbon","slug":"ribbon","permalink":"https://mykkto.github.io/tags/ribbon/"},{"name":"hexo","slug":"hexo","permalink":"https://mykkto.github.io/tags/hexo/"},{"name":"github","slug":"github","permalink":"https://mykkto.github.io/tags/github/"},{"name":"seo","slug":"seo","permalink":"https://mykkto.github.io/tags/seo/"},{"name":"ç™¾åº¦","slug":"ç™¾åº¦","permalink":"https://mykkto.github.io/tags/%E7%99%BE%E5%BA%A6/"},{"name":"è°·æ­Œ","slug":"è°·æ­Œ","permalink":"https://mykkto.github.io/tags/%E8%B0%B7%E6%AD%8C/"},{"name":"Consul","slug":"Consul","permalink":"https://mykkto.github.io/tags/Consul/"},{"name":"Zookeeper","slug":"Zookeeper","permalink":"https://mykkto.github.io/tags/Zookeeper/"},{"name":"Eureka","slug":"Eureka","permalink":"https://mykkto.github.io/tags/Eureka/"},{"name":"æ­å»º","slug":"æ­å»º","permalink":"https://mykkto.github.io/tags/%E6%90%AD%E5%BB%BA/"},{"name":"ç”Ÿæ´»","slug":"ç”Ÿæ´»","permalink":"https://mykkto.github.io/tags/%E7%94%9F%E6%B4%BB/"},{"name":"æ®µå­","slug":"æ®µå­","permalink":"https://mykkto.github.io/tags/%E6%AE%B5%E5%AD%90/"},{"name":"æ„Ÿæ…¨","slug":"æ„Ÿæ…¨","permalink":"https://mykkto.github.io/tags/%E6%84%9F%E6%85%A8/"},{"name":"åˆé›†","slug":"åˆé›†","permalink":"https://mykkto.github.io/tags/%E5%90%88%E9%9B%86/"},{"name":"è¯­å½•","slug":"è¯­å½•","permalink":"https://mykkto.github.io/tags/%E8%AF%AD%E5%BD%95/"},{"name":"æ—¥è®°","slug":"æ—¥è®°","permalink":"https://mykkto.github.io/tags/%E6%97%A5%E8%AE%B0/"},{"name":"è¯ç—¨","slug":"è¯ç—¨","permalink":"https://mykkto.github.io/tags/%E8%AF%9D%E7%97%A8/"},{"name":"ç¾æ–‡","slug":"ç¾æ–‡","permalink":"https://mykkto.github.io/tags/%E7%BE%8E%E6%96%87/"},{"name":"æ€»çº²","slug":"æ€»çº²","permalink":"https://mykkto.github.io/tags/%E6%80%BB%E7%BA%B2/"},{"name":"åˆ†äº«","slug":"åˆ†äº«","permalink":"https://mykkto.github.io/tags/%E5%88%86%E4%BA%AB/"},{"name":"ç®€ä¹¦","slug":"ç®€ä¹¦","permalink":"https://mykkto.github.io/tags/%E7%AE%80%E4%B9%A6/"},{"name":"æŠ€æœ¯æ€»çº²","slug":"æŠ€æœ¯æ€»çº²","permalink":"https://mykkto.github.io/tags/%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BA%B2/"}]}