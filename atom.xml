<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>jack</title>
  
  <subtitle>jackã®åšå®¢</subtitle>
  <link href="https://mykkto.github.io/atom.xml" rel="self"/>
  
  <link href="https://mykkto.github.io/"/>
  <updated>2023-04-25T14:35:09.350Z</updated>
  <id>https://mykkto.github.io/</id>
  
  <author>
    <name>jack</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Scalaè¯­è¨€å…¥æ‰‹çº²è¦ï¼ˆå®Œç»“ï¼‰</title>
    <link href="https://mykkto.github.io/posts/6dd7f78f.html"/>
    <id>https://mykkto.github.io/posts/6dd7f78f.html</id>
    <published>2023-04-02T04:11:10.000Z</published>
    <updated>2023-04-25T14:35:09.350Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><h3 id="1ã€é—²èŠ"><a href="#1ã€é—²èŠ" class="headerlink" title="1ã€é—²èŠ"></a>1ã€é—²èŠ</h3><p>æœ€è¿‘åšä¸»åœ¨å‡†å¤‡è½¬å¤§æ•°æ®ï¼Œäºæ˜¯å­¦ä¹ Flink,å»å¹´22å¹´5æœˆæœ‰æ–‡ç« ï¼Œä¸è¿‡æ›´æ–°åˆ° DataStream Api ç”¨æ³•ï¼Œæ—¶é—´è¯­ä¹‰å’Œçª—å£ç­‰ç­‰è¿˜æ²¡æœ‰æ›´æ–°ï¼Œ</p><p>ç›®å‰åˆçˆ±ä¸Šäº† Scala ï¼Œä¼—æ‰€å‘¨çŸ¥Flink æˆ–è€…æ˜¯ Spark è¿™äº›æµæ‰¹è®¡ç®—æ¡†æ¶çš„ç¿˜æ¥šéƒ½æœ‰å®ƒçš„èº«å½±ï¼Œå³ä½¿ä¸åœ¨å¤§æ•°æ®ï¼Œåœ¨java é¡¹ç›®å¼€å‘ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼›</p><p>scala å’Œ java ï¼Œå°±åƒ C and C++  ,å…¶å® scala ä¹Ÿå¯ä»¥ç§°ä¸º java ++ ï¼Œå®ƒçš„è¯­æ³•ç®€å•ï¼Œå¼€å‘é«˜æ•ˆï¼Œå…¶å®å³ä½¿ä½ æ˜¯javaå¼€å‘ä¹Ÿå¯ä»¥ç©ä»–</p><p>ä»Šå¤©åšä¸»å¼€äº†è¿™ä¸ªä¸“æ ï¼Œå°±æ˜¯æƒ³æäº†æ··åˆå¼€å‘ï¼Œä¸‹åˆæäº†åŠå¤©ç»ˆäºæå®š SpringBoot (scala + java) çš„jar æ‰“åŒ…éƒ¨ç½² maven é¡¹ç›®</p><p>å½“ç„¶äº†ï¼Œè¿™ä¸ªä¸“æ ä¹Ÿä¼šæ˜¯å®Œæ•´çš„ scala å­¦ä¹ æ•™ç¨‹ï¼</p><p>å®Œç»“æ’’èŠ±ï¼~ æ¸©é¦¨æç¤ºï¼Œæœ€å¥½æ˜¯æœ‰javaåŸºç¡€ï¼Œå› ä¸ºå¤§å¤šæ•°æ¡ˆä¾‹æ˜¯å’Œjava å¯¹æ¯”</p><h3 id="2ã€SpringBoot-Scala-and-Java"><a href="#2ã€SpringBoot-Scala-and-Java" class="headerlink" title="2ã€SpringBoot(Scala and Java)"></a>2ã€SpringBoot(Scala and Java)</h3><h4 id="1ã€å‡†å¤‡å¼€å‘ç¯å¢ƒ"><a href="#1ã€å‡†å¤‡å¼€å‘ç¯å¢ƒ" class="headerlink" title="1ã€å‡†å¤‡å¼€å‘ç¯å¢ƒ"></a>1ã€å‡†å¤‡å¼€å‘ç¯å¢ƒ</h4><p>é¦–å…ˆ jdk8 å°±ä¸è¯´äº†ï¼Œé»˜è®¤ä½ å·²ç»å®‰è£…äº†ï¼Œç›®å‰æä¾›çš„æ˜¯scala å®‰è£…</p><p>æ³¨æ„ï¼šå½“å‰é€‚é…ç‰ˆæœ¬ JDK1.8  ï¼ŒSdk 2.12.11</p><p>1ã€é…ç½®ç¯å¢ƒå˜é‡,å…³äºSDK è¯„è®ºåŒºè§ ğŸ‘‡</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202304022129484.png"></p><p>2ã€æµ‹è¯•</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202304022130615.png"></p><p>3ã€idea  ä¸­ scala ç‰ˆæœ¬æ’ä»¶åœ°å€</p><p><a href="https://plugins.jetbrains.com/plugin/1347-scala/versions/stable">https://plugins.jetbrains.com/plugin/1347-scala/versions/stable</a></p><p>4ã€é¡¹ç›®é…ç½®ç­‰éœ€è¦é…ç½®</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202304022151004.png"></p><h4 id="2ã€ç¼–ç "><a href="#2ã€ç¼–ç " class="headerlink" title="2ã€ç¼–ç "></a>2ã€ç¼–ç </h4><p>pom æ–‡ä»¶</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scalaTest01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scala.version</span><span class="token punctuation">&gt;</span></span>2.12.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scala.version</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--        &lt;spark.version&gt;3.0.1&lt;/spark.version&gt;--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--        å› ä¸ºæˆ‘ä»¬éœ€è¦ä½¿ç”¨Scalaä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åŠ å…¥scala-libraryä¾èµ–--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.scala-lang<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scala-library<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.12.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>                    <span class="token comment">&lt;!-- main æ–¹æ³•å…¥å£ï¼Œå¯ä»¥æ˜¯java ä¹Ÿå¯ä»¥æ˜¯ scala ,Springboot é¡¹ç›®çš„è¯åˆ™æ˜¯ä¸»å¯åŠ¨å™¨ --&gt;</span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">&gt;</span></span>com.JavaDemo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includeSystemScope</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includeSystemScope</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>repackage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.scala-tools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-scala-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.15.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>scala-compile-first<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.scala<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--                            &lt;goal&gt;testCompile&lt;/goal&gt;--&gt;</span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jvmArgs</span><span class="token punctuation">&gt;</span></span>                                <span class="token comment">&lt;!-- éœ€è¦çš„é…ç½® --&gt;</span>                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jvmArg</span><span class="token punctuation">&gt;</span></span>-Xss8m<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jvmArg</span><span class="token punctuation">&gt;</span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jvmArgs</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>scala-test-compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>testCompile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼šscala å’Œ java è¦åˆ†å¼€ï¼Œä¸ç„¶ç¼–è¯‘ä¼šå‡ºé—®é¢˜</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202304022141350.png"></p><p>1ã€JavaDemo.java ï¼Œjavaä»£ç è°ƒç”¨ scala</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>chapter01<span class="token punctuation">.</span></span><span class="token class-name">Car</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaDemo</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Car</span> car <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span> <span class="token punctuation">(</span><span class="token number">2009</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>car<span class="token punctuation">)</span><span class="token punctuation">;</span>        car<span class="token punctuation">.</span><span class="token function">drive</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"java:"</span><span class="token operator">+</span>car<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€Car.scala (Object)</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>chapter01</span><span class="token keyword">class</span> Car<span class="token punctuation">(</span><span class="token keyword">val</span> year<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">private</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span> <span class="token keyword">var</span> miles<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">def</span> drive<span class="token punctuation">(</span>distance<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    miles <span class="token operator">+=</span> distance    println<span class="token punctuation">(</span><span class="token string">"scala:"</span> <span class="token operator">+</span> miles<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">override</span> <span class="token keyword">def</span> toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"year:"</span> <span class="token operator">+</span> year <span class="token operator">+</span> <span class="token string">" miles:"</span> <span class="token operator">+</span> miles<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€TestScala$.scala (class)</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>chapter01</span><span class="token keyword">object</span> TestScala <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> str1<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token builtin">String</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span>    <span class="token keyword">var</span> str2<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"hello"</span>    println<span class="token punctuation">(</span>str1 <span class="token operator">==</span> str2<span class="token punctuation">)</span>    <span class="token keyword">var</span> age<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">25</span>    <span class="token keyword">var</span> sal<span class="token operator">:</span> <span class="token builtin">Float</span> <span class="token operator">=</span> <span class="token number">3.2f</span>    <span class="token keyword">var</span> height<span class="token operator">:</span> <span class="token builtin">Double</span> <span class="token operator">=</span> <span class="token number">176.51</span>    <span class="token comment">// æ ¼å¼åŒ–å­—ç¬¦ä¸²</span>    printf<span class="token punctuation">(</span><span class="token string">"åå­—--%s å¹´é¾„%d è–ªèµ„%f èº«é«˜%f"</span><span class="token punctuation">,</span> str1<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sal<span class="token punctuation">,</span> height<span class="token punctuation">)</span>    println<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// scala æ”¯æŒä½¿ç”¨ $è¾“å‡ºå†…å®¹ï¼Œç¼–è¯‘å™¨ä¼šè§£æå¯¹åº” $å˜é‡</span>    println<span class="token punctuation">(</span>s<span class="token string">"å½“ä¸‹çš„ä¿¡æ¯ï¼š\n$str1,\tå¹´é¾„ï¼š$age\tè–ªèµ„ï¼š$sal\tèº«é«˜ï¼š$height"</span><span class="token punctuation">)</span>    <span class="token comment">// æ·»åŠ è®¡ç®—å†…å®¹</span>    println<span class="token punctuation">(</span>s<span class="token string">"å½“ä¸‹çš„ä¿¡æ¯ï¼š\n$str1,\tå¹´é¾„ï¼š$age\tè–ªèµ„ï¼š${sal * 1.2}\tèº«é«˜ï¼š$height"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ ¸å¿ƒï¼šæ‰“åŒ…"><a href="#æ ¸å¿ƒï¼šæ‰“åŒ…" class="headerlink" title="æ ¸å¿ƒï¼šæ‰“åŒ…"></a>æ ¸å¿ƒï¼šæ‰“åŒ…</h4><p>æ³¨æ„ï¼šé¡ºåºå¿…é¡»è¦è¿™æ ·ï¼Œclean(maven) -&gt; ç¼–è¯‘ï¼ˆé‚£ä¸ªé”¤å­æ•²ä¸€ä¸‹ï¼‰ -&gt; package(maven)</p><p>ç¬¬ä¸€æ­¥ï¼Œclear ä¿è¯æ¸…ç©º</p><p>ç¬¬äºŒæ­¥ï¼Œç¼–è¯‘ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæŠŠjava and scala ç¼–è¯‘å®Œæˆ</p><p>ç¬¬ä¸‰æ­¥ï¼Œç¡®è®¤äº†ï¼Œç¼–è¯‘å‡º scala and java çš„ class æ‰æ‰“åŒ…æ‰ä¼šæˆåŠŸï¼Œæ³¨æ„åŒ…å†…è¦æœ‰ lib åŒ…å« scalaçš„ä¾èµ– </p><h2 id="ä¸€ã€æ•°æ®ç±»å‹"><a href="#ä¸€ã€æ•°æ®ç±»å‹" class="headerlink" title="ä¸€ã€æ•°æ®ç±»å‹"></a>ä¸€ã€æ•°æ®ç±»å‹</h2><h3 id="1ã€å˜é‡å’Œå¸¸é‡"><a href="#1ã€å˜é‡å’Œå¸¸é‡" class="headerlink" title="1ã€å˜é‡å’Œå¸¸é‡"></a>1ã€å˜é‡å’Œå¸¸é‡</h3><h4 id="1ã€æ³¨é‡Š"><a href="#1ã€æ³¨é‡Š" class="headerlink" title="1ã€æ³¨é‡Š"></a>1ã€æ³¨é‡Š</h4><p><font color="red">Scala æ³¨é‡Šä½¿ç”¨å’Œ Java å®Œå…¨ä¸€æ ·</font></p><p>åŸºæœ¬è¯­æ³•</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>å•è¡Œæ³¨é‡Šï¼š<span class="token comment">//</span><span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span>å¤šè¡Œæ³¨é‡Šï¼š<span class="token comment">/* */</span><span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span>æ–‡æ¡£æ³¨é‡Šï¼š<span class="token comment">/****/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€å˜é‡å’Œå¸¸é‡"><a href="#2ã€å˜é‡å’Œå¸¸é‡" class="headerlink" title="2ã€å˜é‡å’Œå¸¸é‡"></a>2ã€å˜é‡å’Œå¸¸é‡</h4><p>ï¼ˆ1ï¼‰Java å˜é‡å’Œå¸¸é‡è¯­æ³•</p><p>å˜é‡ç±»å‹ å˜é‡åç§° =  åˆå§‹å€¼                int a = 10</p><p>final å¸¸é‡ç±»å‹ å¸¸é‡åç§° =  åˆå§‹å€¼         final int b = 20</p><p>ï¼ˆ2ï¼‰scala ä¸­çš„è¯­æ³•</p><p>var  å˜é‡å [:  å˜é‡ç±»å‹] =  åˆå§‹å€¼          var a:Int = 10</p><p>val  å¸¸é‡å [:  å¸¸é‡ç±»å‹] =  åˆå§‹å€¼          val b:Int = 20</p><p><font color="red">æ³¨æ„ ï¼šèƒ½ç”¨å¸¸é‡çš„åœ°æ–¹ä¸ç”¨å˜é‡</font></p><h4 id="3ã€æ ‡è¯†ç¬¦å‘½åè§„èŒƒ"><a href="#3ã€æ ‡è¯†ç¬¦å‘½åè§„èŒƒ" class="headerlink" title="3ã€æ ‡è¯†ç¬¦å‘½åè§„èŒƒ"></a>3ã€æ ‡è¯†ç¬¦å‘½åè§„èŒƒ</h4><p>Scala ä¸­çš„æ ‡è¯†ç¬¦å£°æ˜ï¼ŒåŸºæœ¬å’Œ Java æ˜¯ä¸€è‡´çš„ ï¼Œä½†æ˜¯ç»†èŠ‚ä¸Šä¼šæœ‰æ‰€å˜åŒ–ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§è§„åˆ™ï¼š</p><p>â€‹    ( 1 )ä»¥å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿å¼€å¤´ï¼Œåæ¥å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿</p><p>â€‹    ( 2 )ä»¥æ“ä½œç¬¦å¼€å¤´ï¼Œä¸”åªåŒ…å«æ“ä½œç¬¦(+ - * / # !ç­‰)</p><p>â€‹    ( 3 )ç”¨åå¼•å·`â€¦.`åŒ…æ‹¬çš„ä»»æ„å­—ç¬¦ä¸²ï¼Œå³ä½¿æ˜¯ Scala å…³é”®å­—( 39 ä¸ª)ä¹Ÿå¯ä»¥</p><p>â€¢  package, import, class, object, trait, extends, with, type, for</p><p>â€¢  private, protected, abstract, sealed, final, implicit, lazy, override</p><p>â€¢  try, catch, finally, throw</p><p>â€¢  if, else, match, case, do, while, for, return, yield</p><p>â€¢  def, val, var</p><p>â€¢  this, super</p><p>â€¢  new</p><p>â€¢  true, false, null</p><h4 id="4ã€å­—ç¬¦ä¸²è¾“å‡º"><a href="#4ã€å­—ç¬¦ä¸²è¾“å‡º" class="headerlink" title="4ã€å­—ç¬¦ä¸²è¾“å‡º"></a>4ã€å­—ç¬¦ä¸²è¾“å‡º</h4><p>1ã€åŸºæœ¬è¯­æ³•</p><p>â€‹    ( 1 )å­—ç¬¦ä¸²ï¼Œé€šè¿‡+å·è¿æ¥</p><p>â€‹    ( 2 ) printf ç”¨æ³•ï¼šå­—ç¬¦ä¸²ï¼Œé€šè¿‡%ä¼ å€¼ã€‚</p><p>â€‹    ( 3 )å­—ç¬¦ä¸²æ¨¡æ¿ (æ’å€¼å­—ç¬¦ä¸²)  ï¼šé€šè¿‡$è·å–å˜é‡å€¼</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>demo1</span><span class="token keyword">object</span> Test01 <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> name<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"jinlian"</span>    <span class="token keyword">var</span> age<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">18</span>    <span class="token comment">// ( 1 )å­—ç¬¦ä¸²ï¼Œé€šè¿‡+å·è¿æ¥</span>    println<span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> age<span class="token punctuation">)</span>    <span class="token comment">// ( 2 ) printf ç”¨æ³•å­—ç¬¦ä¸²ï¼Œé€šè¿‡%ä¼ å€¼ã€‚</span>    printf<span class="token punctuation">(</span><span class="token string">"name=%s age=%d\n"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>    <span class="token comment">// ( 3 )å­—ç¬¦ä¸²ï¼Œé€šè¿‡$å¼•ç”¨</span>    <span class="token comment">//å¤šè¡Œå­—ç¬¦ä¸²ï¼Œåœ¨ Scalaä¸­ï¼Œåˆ©ç”¨ä¸‰ä¸ªåŒå¼•å·åŒ…å›´å¤šè¡Œå­—ç¬¦ä¸²å°±å¯ä»¥å®ç°ã€‚</span>    <span class="token comment">// è¾“å…¥çš„å†…å®¹ï¼Œå¸¦æœ‰ç©ºæ ¼ã€\t ä¹‹ç±»ï¼Œå¯¼è‡´æ¯ä¸€è¡Œçš„å¼€å§‹ä½ç½®ä¸èƒ½æ•´æ´å¯¹é½ã€‚</span>    <span class="token comment">// åº”ç”¨ scala çš„ stripMargin æ–¹æ³•ï¼Œåœ¨ scala ä¸­ stripMargin é»˜è®¤</span>    <span class="token comment">// æ˜¯ â€œ|â€ä½œä¸ºè¿æ¥ç¬¦ï¼Œ//åœ¨å¤šè¡Œæ¢è¡Œçš„è¡Œå¤´å‰é¢åŠ ä¸€ä¸ªâ€œ|â€ç¬¦å·å³å¯ã€‚</span>    <span class="token keyword">val</span> s <span class="token operator">=</span>    <span class="token triple-quoted-string string">"""      |select      |from ,      | user      |where name="zhangsan"    """</span><span class="token punctuation">.</span>stripMargin    println<span class="token punctuation">(</span>s<span class="token punctuation">)</span>    <span class="token comment">//å¦‚æœéœ€è¦å¯¹å˜é‡è¿›è¡Œè¿ç®—ï¼Œé‚£ä¹ˆå¯ä»¥åŠ ${}</span>    <span class="token keyword">val</span> s1 <span class="token operator">=</span>      s<span class="token triple-quoted-string string">"""         |select         |name,         |  age         |from user         |where name="$name" and age=${age + 2}    """</span><span class="token punctuation">.</span>stripMargin    println<span class="token punctuation">(</span>s1<span class="token punctuation">)</span>    <span class="token keyword">val</span> s2 <span class="token operator">=</span> s<span class="token string">"name=$name"</span>    println<span class="token punctuation">(</span>s2<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡ºï¼š</p><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">jinlian 18name=jinlian age=18selectfrom , userwhere name="zhangsan"    selectname,  agefrom userwhere name="jinlian" and age=20    name=jinlian<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€é”®ç›˜è¾“å…¥"><a href="#5ã€é”®ç›˜è¾“å…¥" class="headerlink" title="5ã€é”®ç›˜è¾“å…¥"></a>5ã€é”®ç›˜è¾“å…¥</h4><p>1ã€åŸºæœ¬è¯­æ³•</p><p>StdIn.readLine()ã€StdIn.readShort()ã€StdIn.readDouble()</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>demo1</span><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>StdIn<span class="token keyword">object</span> Test02 <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment">// 1 è¾“å…¥å§“å</span>    println<span class="token punctuation">(</span><span class="token string">"input name:"</span><span class="token punctuation">)</span>    <span class="token keyword">var</span> name <span class="token operator">=</span> StdIn<span class="token punctuation">.</span>readLine<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// 2 è¾“å…¥å¹´é¾„</span>    println<span class="token punctuation">(</span><span class="token string">"input age:"</span><span class="token punctuation">)</span>    <span class="token keyword">var</span> age <span class="token operator">=</span> StdIn<span class="token punctuation">.</span>readShort<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// 3 è¾“å…¥è–ªæ°´</span>    println<span class="token punctuation">(</span><span class="token string">"input sal:"</span><span class="token punctuation">)</span>    <span class="token keyword">var</span> sal <span class="token operator">=</span> StdIn<span class="token punctuation">.</span>readDouble<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// 4 æ‰“å°</span>    println<span class="token punctuation">(</span><span class="token string">"name="</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>    println<span class="token punctuation">(</span><span class="token string">"age="</span> <span class="token operator">+</span> age<span class="token punctuation">)</span>    println<span class="token punctuation">(</span><span class="token string">"sal="</span> <span class="token operator">+</span> sal<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">input name:å¤§æ ¹input age:18input sal:18000.6name=å¤§æ ¹age=18sal=18000.6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2ã€æ•°æ®ç±»å‹"><a href="#2ã€æ•°æ®ç±»å‹" class="headerlink" title="2ã€æ•°æ®ç±»å‹"></a>2ã€æ•°æ®ç±»å‹</h3><h4 id="1ã€æ•´æ•°å‹"><a href="#1ã€æ•´æ•°å‹" class="headerlink" title="1ã€æ•´æ•°å‹"></a>1ã€æ•´æ•°å‹</h4><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>Byte [1]</td><td>8 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -128  åˆ° 127</td></tr><tr><td>Short [2]</td><td>16 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -32768  åˆ° 32767</td></tr><tr><td>Int [4]</td><td>32 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -2147483648  åˆ° 2147483647</td></tr><tr><td>Long [8]</td><td>64 ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -9223372036854775808  åˆ°9223372036854775807 = 2 çš„(64-1)æ¬¡æ–¹-1</td></tr></tbody></table><p>Scala ç¨‹åºä¸­å˜é‡å¸¸å£°æ˜ä¸º Int å‹ ï¼Œé™¤éä¸è¶³ä»¥è¡¨ç¤ºå¤§æ•°ï¼Œæ‰ä½¿ç”¨ Long</p><h4 id="2ã€æµ®ç‚¹å‹"><a href="#2ã€æµ®ç‚¹å‹" class="headerlink" title="2ã€æµ®ç‚¹å‹"></a>2ã€æµ®ç‚¹å‹</h4><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>Float [4]</td><td>32  ä½, IEEE 754 æ ‡å‡†çš„å•ç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td>Double [8]</td><td>64   ä½ IEEE 754 æ ‡å‡†çš„åŒç²¾åº¦æµ®ç‚¹æ•°</td></tr></tbody></table><p>Scala çš„æµ®ç‚¹å‹å¸¸é‡é»˜è®¤ä¸º Double å‹ï¼Œå£°æ˜ Float å‹å¸¸é‡ï¼Œé¡»ååŠ â€˜fâ€™æˆ–â€˜Fâ€™</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>demo2</span><span class="token keyword">object</span> Test01 <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment">// å»ºè®®ï¼Œåœ¨å¼€å‘ä¸­éœ€è¦é«˜ç²¾åº¦å°æ•°æ—¶ï¼Œè¯·é€‰æ‹© Double</span>    <span class="token keyword">var</span> n7 <span class="token operator">=</span> <span class="token number">2.2345678912f</span>    <span class="token keyword">var</span> n8 <span class="token operator">=</span> <span class="token number">2.2345678912</span>    println<span class="token punctuation">(</span><span class="token string">"n7="</span> <span class="token operator">+</span> n7<span class="token punctuation">)</span>    println<span class="token punctuation">(</span><span class="token string">"n8="</span> <span class="token operator">+</span> n8<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">n7=2.2345679n8=2.2345678912<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="3ã€å­—ç¬¦å‹"><a href="#3ã€å­—ç¬¦å‹" class="headerlink" title="3ã€å­—ç¬¦å‹"></a>3ã€å­—ç¬¦å‹</h4><p>å­—ç¬¦ç±»å‹å¯ä»¥è¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œå­—ç¬¦ç±»å‹æ˜¯ Char</p><p>1ã€åŸºæœ¬è¯­æ³•</p><p>â€‹    ( 1 )å­—ç¬¦å¸¸é‡æ˜¯ç”¨å•å¼•å· ' '  æ‹¬èµ·æ¥çš„å•ä¸ªå­—ç¬¦ã€‚</p><p>â€‹    ( 2 ) \t   ï¼šä¸€ä¸ªåˆ¶è¡¨ä½ï¼Œå®ç°å¯¹é½çš„åŠŸèƒ½</p><p>â€‹    ( 3 ) \n   ï¼šæ¢è¡Œç¬¦</p><p>â€‹    ( 4 ) \   ï¼šè¡¨ç¤º\</p><p>â€‹    ( 5 ) "   ï¼šè¡¨ç¤º"</p><h4 id="4ã€å¸ƒå°”å‹"><a href="#4ã€å¸ƒå°”å‹" class="headerlink" title="4ã€å¸ƒå°”å‹"></a>4ã€å¸ƒå°”å‹</h4><p>â€‹    ( 1 ) Booolean ç±»å‹æ•°æ®åªå…è®¸å–å€¼ true å’Œ false</p><p>â€‹    ( 2 ) boolean ç±»å‹å  1 ä¸ªå­—èŠ‚</p><h4 id="5ã€Unitã€Nullã€Nothing-é‡ç‚¹"><a href="#5ã€Unitã€Nullã€Nothing-é‡ç‚¹" class="headerlink" title="5ã€Unitã€Nullã€Nothing (é‡ç‚¹)"></a>5ã€Unitã€Nullã€Nothing (é‡ç‚¹)</h4><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>Unit</td><td>è¡¨ç¤ºæ— å€¼ï¼Œå’Œå…¶ä»–è¯­è¨€ä¸­ void ç­‰åŒã€‚ç”¨ä½œä¸è¿”å›ä»»ä½•ç»“æœçš„æ–¹æ³•çš„ç»“æœç±»å‹ã€‚  Unit åªæœ‰ä¸€ä¸ªå®ä¾‹å€¼ï¼Œå†™æˆ()ã€‚</td></tr><tr><td>Null</td><td>null , Null ç±»å‹åªæœ‰ä¸€ä¸ªå®ä¾‹å€¼ null</td></tr><tr><td>Nothing</td><td>Nothing ç±»å‹åœ¨Scala çš„ç±»å±‚çº§æœ€ä½ç«¯ï¼›å®ƒæ˜¯ä»»ä½•å…¶ä»–ç±»å‹çš„å­ç±»å‹ã€‚    å½“ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç¡®å®šæ²¡æœ‰æ­£å¸¸çš„è¿”å›å€¼ï¼Œå¯ä»¥ç”¨Nothing æ¥æŒ‡å®šè¿”å›ç±» å‹ï¼Œè¿™æ ·æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠè¿”å›çš„å€¼(å¼‚å¸¸)èµ‹ç»™å…¶å®ƒçš„å‡½æ•°æˆ–è€…å˜é‡(å…¼å®¹æ€§)</td></tr></tbody></table><p>1ã€Unit</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>demo2</span><span class="token keyword">object</span> Test02 <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">def</span> sayOK<span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    print<span class="token punctuation">(</span>sayOK<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">ï¼ˆï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2ã€Null</p><p>Null ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œ Null ç±»ä¼¼äº Java ä¸­çš„ <strong>null</strong> å¼•ç”¨ã€‚<strong>Null</strong> å¯ä»¥èµ‹å€¼ç»™ä»»æ„å¼•ç”¨ç±»å‹ï¼Œä½†æ˜¯ä¸èƒ½èµ‹å€¼ç»™å€¼ç±»å‹</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">var</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> Cat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cat <span class="token operator">=</span> <span class="token keyword">null</span>   <span class="token comment">// æ­£ç¡®</span><span class="token keyword">var</span> n1<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// é”™è¯¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€Nothing</p><p>å¯ä»¥ä½œä¸ºæ²¡æœ‰æ­£å¸¸è¿”å›å€¼çš„æ–¹æ³•çš„è¿”å›ç±»å‹ï¼Œéå¸¸ç›´è§‚çš„å‘Šè¯‰ä½ è¿™ä¸ªæ–¹æ³•ä¸ä¼šæ­£å¸¸è¿”å›ï¼Œè€Œä¸”ç”±äº Nothing æ˜¯å…¶ä»–ä»»æ„ç±»å‹çš„å­ç±»ï¼Œä»–è¿˜èƒ½è·Ÿè¦æ±‚è¿”å›å€¼çš„æ–¹æ³•å…¼å®¹</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">def</span> test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Nothing</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> Exception<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  test<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-bat" data-language="bat"><code class="language-bat">Exception in thread "main" java.lang.Exceptionat com.com.demo2.Test02$.test$1(Test02.scala:6)at com.com.demo2.Test02$.main(Test02.scala:9)at com.com.demo2.Test02.main(Test02.scala)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€ç±»å‹è½¬æ¢"><a href="#3ã€ç±»å‹è½¬æ¢" class="headerlink" title="3ã€ç±»å‹è½¬æ¢"></a>3ã€ç±»å‹è½¬æ¢</h3><h4 id="1ã€ç±»å‹è‡ªåŠ¨è½¬æ¢"><a href="#1ã€ç±»å‹è‡ªåŠ¨è½¬æ¢" class="headerlink" title="1ã€ç±»å‹è‡ªåŠ¨è½¬æ¢"></a>1ã€ç±»å‹è‡ªåŠ¨è½¬æ¢</h4><p>è‡ªåŠ¨ç±»å‹è½¬æ¢(éšå¼è½¬æ¢),ç±»å‹è‡ªåŠ¨æå‡</p><h4 id="2ã€å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#2ã€å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="2ã€å¼ºåˆ¶ç±»å‹è½¬æ¢"></a>2ã€å¼ºåˆ¶ç±»å‹è½¬æ¢</h4><p>è‡ªåŠ¨ç±»å‹è½¬æ¢çš„é€†è¿‡ç¨‹ï¼Œå°†ç²¾åº¦å¤§çš„æ•°å€¼ç±»å‹è½¬æ¢ä¸ºç²¾åº¦å°çš„æ•°å€¼ç±»å‹ã€‚ä½¿ç”¨æ—¶è¦åŠ ä¸Šå¼ºåˆ¶è½¬å‡½æ•°ï¼Œä½†å¯èƒ½é€ æˆç²¾åº¦é™ä½æˆ–æº¢å‡ºï¼Œæ ¼å¤–è¦æ³¨æ„ã€‚</p><p>è¯­æ³•</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">Java  <span class="token operator">:</span> int num <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token number">2.5</span>    Scala <span class="token operator">:</span> <span class="token keyword">var</span> num <span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">2.7</span><span class="token punctuation">.</span>toInt                    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="3ã€æ•°å€¼ç±»å‹å’Œ-String-ç±»å‹é—´è½¬æ¢"><a href="#3ã€æ•°å€¼ç±»å‹å’Œ-String-ç±»å‹é—´è½¬æ¢" class="headerlink" title="3ã€æ•°å€¼ç±»å‹å’Œ String ç±»å‹é—´è½¬æ¢"></a>3ã€æ•°å€¼ç±»å‹å’Œ <strong>String</strong> ç±»å‹é—´è½¬æ¢</h4><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// ( 1 )åŸºæœ¬ç±»å‹è½¬ String ç±»å‹(è¯­æ³•ï¼šå°†åŸºæœ¬ç±»å‹çš„å€¼+"" å³å¯)  var str1 : String = true + ""</span>  <span class="token keyword">var</span> str2<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token number">4.5</span> <span class="token operator">+</span> <span class="token string">""</span>  <span class="token keyword">var</span> str3<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token string">""</span>  <span class="token comment">// ( 2 ) String ç±»å‹è½¬åŸºæœ¬æ•°å€¼ç±»å‹(è¯­æ³•ï¼šè°ƒç”¨ç›¸å…³ API )</span>  <span class="token keyword">var</span> s1<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"12"</span>  <span class="token keyword">var</span> n1<span class="token operator">:</span> <span class="token builtin">Byte</span> <span class="token operator">=</span> s1<span class="token punctuation">.</span>toByte  <span class="token keyword">var</span> n2<span class="token operator">:</span> <span class="token builtin">Short</span> <span class="token operator">=</span> s1<span class="token punctuation">.</span>toShort  <span class="token keyword">var</span> n3<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> s1<span class="token punctuation">.</span>toInt  <span class="token keyword">var</span> n4<span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> s1<span class="token punctuation">.</span>toLong<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äºŒã€è¿ç®—ç¬¦"><a href="#äºŒã€è¿ç®—ç¬¦" class="headerlink" title="äºŒã€è¿ç®—ç¬¦"></a>äºŒã€è¿ç®—ç¬¦</h2><h3 id="1ã€ç®—æœ¯è¿ç®—ç¬¦"><a href="#1ã€ç®—æœ¯è¿ç®—ç¬¦" class="headerlink" title="1ã€ç®—æœ¯è¿ç®—ç¬¦"></a>1ã€ç®—æœ¯è¿ç®—ç¬¦</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¿ç®—</th><th>èŒƒä¾‹</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>+</td><td>æ­£å·</td><td>+3</td><td>3</td></tr><tr><td>-</td><td>è´Ÿå·</td><td>b=4; -b</td><td>-4</td></tr><tr><td>+</td><td>åŠ </td><td>5+5</td><td>10</td></tr><tr><td>-</td><td>å‡</td><td>6-4</td><td>2</td></tr><tr><td>*</td><td>ä¹˜</td><td>3*4</td><td>12</td></tr><tr><td>/</td><td>é™¤</td><td>5/5</td><td>1</td></tr><tr><td>%</td><td>å–æ¨¡(å–ä½™)</td><td>7%5</td><td>2</td></tr><tr><td>+</td><td>å­—ç¬¦ä¸²ç›¸åŠ </td><td>â€œHeâ€+â€lloâ€</td><td>â€œHelloâ€</td></tr></tbody></table><h3 id="2ã€æ¯”è¾ƒï¼ˆå…³ç³»ï¼‰è¿ç®—ç¬¦"><a href="#2ã€æ¯”è¾ƒï¼ˆå…³ç³»ï¼‰è¿ç®—ç¬¦" class="headerlink" title="2ã€æ¯”è¾ƒï¼ˆå…³ç³»ï¼‰è¿ç®—ç¬¦"></a>2ã€æ¯”è¾ƒï¼ˆå…³ç³»ï¼‰è¿ç®—ç¬¦</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¿ç®—</th><th>èŒƒä¾‹</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>==</td><td>ç›¸ç­‰äº</td><td>4==3</td><td>false</td></tr><tr><td>!=</td><td>ä¸ç­‰äº</td><td>4 ï¼=3</td><td>true</td></tr><tr><td>&lt;</td><td>å°äº</td><td>4&lt;3</td><td>false</td></tr><tr><td>&gt;</td><td>å¤§äº</td><td>4&gt;3</td><td>true</td></tr><tr><td>&lt;=</td><td>å°äºç­‰äº</td><td>4&lt;=3</td><td>false</td></tr><tr><td>&gt;=</td><td>å¤§äºç­‰äº</td><td>4&gt;=3</td><td>true</td></tr></tbody></table><p>Java ï¼š</p><p><font color="red">==æ¯”è¾ƒä¸¤ä¸ªå˜é‡æœ¬èº«çš„å€¼ï¼Œå³ä¸¤ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­çš„é¦–åœ°å€ ï¼›</font></p><p><font color="red">equals æ¯”è¾ƒå­—ç¬¦ä¸²ä¸­æ‰€åŒ…å«çš„å†…å®¹æ˜¯å¦ç›¸åŒã€‚</font></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span><span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token boolean">false</span><span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><font color="red">Scala ï¼š==æ›´åŠ ç±»ä¼¼äº Java ä¸­çš„ equals ï¼Œå‚ç…§ jd å·¥å…·</font></p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token keyword">val</span> s1 <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token keyword">val</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token builtin">String</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span>println<span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span>println<span class="token punctuation">(</span>s1<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>è¾“å‡ºç»“æœï¼š<span class="token boolean">true</span><span class="token boolean">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€é€»è¾‘è¿ç®—ç¬¦"><a href="#3ã€é€»è¾‘è¿ç®—ç¬¦" class="headerlink" title="3ã€é€»è¾‘è¿ç®—ç¬¦"></a>3ã€é€»è¾‘è¿ç®—ç¬¦</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td>&amp;&amp;</td><td>é€»è¾‘ä¸</td><td>(A &amp;&amp; B)  è¿ç®—ç»“æœä¸º false</td></tr><tr><td>||</td><td>é€»è¾‘æˆ–</td><td>(A || B)  è¿ç®—ç»“æœä¸º true</td></tr><tr><td>!</td><td>é€»è¾‘é</td><td>!(A &amp;&amp; B)  è¿ç®—ç»“æœä¸º true</td></tr></tbody></table><h3 id="4ã€èµ‹å€¼è¿ç®—ç¬¦"><a href="#4ã€èµ‹å€¼è¿ç®—ç¬¦" class="headerlink" title="4ã€èµ‹å€¼è¿ç®—ç¬¦"></a>4ã€èµ‹å€¼è¿ç®—ç¬¦</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td>=</td><td>ç®€å•çš„èµ‹å€¼è¿ç®—ç¬¦ï¼Œå°†ä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼èµ‹ç»™ä¸€ä¸ªå·¦å€¼</td><td>C = A + B  å°† A + B  è¡¨è¾¾å¼ç»“æœèµ‹å€¼ç»™ C</td></tr><tr><td>+=</td><td>ç›¸åŠ åå†èµ‹å€¼</td><td>C += A ç­‰äº C = C + A</td></tr><tr><td>-=</td><td>ç›¸å‡åå†èµ‹å€¼</td><td>C -= A ç­‰äº C = C - A</td></tr><tr><td>*=</td><td>ç›¸ä¹˜åå†èµ‹å€¼</td><td>C *= A ç­‰äº C = C * A</td></tr><tr><td>/=</td><td>ç›¸é™¤åå†èµ‹å€¼</td><td>C /= A ç­‰äº C = C / A</td></tr><tr><td>%=</td><td>æ±‚ä½™åå†èµ‹å€¼</td><td>C %= A ç­‰äº C = C % A</td></tr><tr><td>&lt;&lt;=</td><td>å·¦ç§»åèµ‹å€¼</td><td>C &lt;&lt;= 2 ç­‰äº C = C &lt;&lt; 2</td></tr><tr><td>&gt;&gt;=</td><td>å³ç§»åèµ‹å€¼</td><td>C &gt;&gt;= 2  ç­‰äº C = C &gt;&gt; 2</td></tr><tr><td>&amp;=</td><td>æŒ‰ä½ä¸åèµ‹å€¼</td><td>C &amp;= 2    ç­‰äº C = C &amp; 2</td></tr><tr><td>^=</td><td>æŒ‰ä½å¼‚æˆ–åèµ‹å€¼</td><td>C ^= 2    ç­‰äº C = C ^ 2</td></tr><tr><td>|=</td><td>æŒ‰ä½æˆ–åèµ‹å€¼</td><td>C |= 2    ç­‰äº C = C | 2</td></tr></tbody></table><h3 id="5ã€ä½è¿ç®—ç¬¦"><a href="#5ã€ä½è¿ç®—ç¬¦" class="headerlink" title="5ã€ä½è¿ç®—ç¬¦"></a>5ã€ä½è¿ç®—ç¬¦</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td>&amp;</td><td>æŒ‰ä½ä¸è¿ç®—ç¬¦</td><td>(a &amp; b)  è¾“å‡ºç»“æœ  12   ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š   0000 1100</td></tr><tr><td>|</td><td>æŒ‰ä½æˆ–è¿ç®—ç¬¦</td><td>(a | b)  è¾“å‡ºç»“æœ 61   ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š   0011 1101</td></tr><tr><td>^</td><td>æŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦</td><td>(a ^ b)  è¾“å‡ºç»“æœ 49   ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š   0011 0001</td></tr><tr><td>~</td><td>æŒ‰ä½å–åè¿ç®—ç¬¦</td><td>(~a )  è¾“å‡ºç»“æœ -61   ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š   1100 0011 ï¼Œ   åœ¨ä¸€ä¸ªæœ‰ç¬¦å·äºŒè¿›åˆ¶æ•°çš„è¡¥ç å½¢å¼ã€‚</td></tr><tr><td>&lt;&lt;</td><td>å·¦ç§»åŠ¨è¿ç®—ç¬¦</td><td>a &lt;&lt; 2  è¾“å‡ºç»“æœ 240   ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š   0011 0000</td></tr><tr><td>&gt;&gt;</td><td>å³ç§»åŠ¨è¿ç®—ç¬¦</td><td>a &gt;&gt; 2  è¾“å‡ºç»“æœ  15   ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š   0000 1111</td></tr><tr><td>&gt;&gt;&gt;</td><td>æ— ç¬¦å·å³ç§»</td><td>a &gt;&gt;&gt;2  è¾“å‡ºç»“æœ  15,  äºŒè¿›åˆ¶è§£é‡Š: 0000 1111</td></tr></tbody></table><h3 id="6ã€è¿ç®—ç¬¦æœ¬è´¨"><a href="#6ã€è¿ç®—ç¬¦æœ¬è´¨" class="headerlink" title="6ã€è¿ç®—ç¬¦æœ¬è´¨"></a>6ã€è¿ç®—ç¬¦æœ¬è´¨</h3><p>åœ¨ Scala ä¸­å…¶å®æ˜¯æ²¡æœ‰è¿ç®—ç¬¦çš„ ï¼Œæ‰€æœ‰è¿ç®—ç¬¦éƒ½æ˜¯æ–¹æ³•ã€‚</p><p>1 ) å½“è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œç‚¹.å¯ä»¥çœç•¥</p><p>2 ) å¦‚æœå‡½æ•°å‚æ•°åªæœ‰ä¸€ä¸ªï¼Œæˆ–è€…æ²¡æœ‰å‚æ•° ï¼Œ()å¯ä»¥çœç•¥</p><h2 id="ä¸‰ã€æµç¨‹æ§åˆ¶"><a href="#ä¸‰ã€æµç¨‹æ§åˆ¶" class="headerlink" title="ä¸‰ã€æµç¨‹æ§åˆ¶"></a>ä¸‰ã€æµç¨‹æ§åˆ¶</h2><h3 id="1ã€åˆ†æ”¯æ§åˆ¶"><a href="#1ã€åˆ†æ”¯æ§åˆ¶" class="headerlink" title="1ã€åˆ†æ”¯æ§åˆ¶"></a>1ã€åˆ†æ”¯æ§åˆ¶</h3><p>if else å•åˆ†æ”¯ï¼ŒåŒåˆ†æ”¯ï¼Œå¤šåˆ†æ”¯ï¼ŒåµŒå¥—åˆ†æ”¯ å…¶å®å’Œjavaä¸€æ ·ï¼Œä¸åŒçš„æ˜¯å¯ä»¥è¿”å›</p><p>1ã€è¾“å…¥å¹´é¾„ï¼Œæ‰“å°å¹´çºªï¼Œè¿”å›String</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">var</span> age <span class="token operator">=</span> StdIn<span class="token punctuation">.</span>readInt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> res <span class="token operator">:</span><span class="token builtin">String</span> <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&lt;</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token string">"ç«¥å¹´"</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>age<span class="token operator">&gt;=</span><span class="token number">18</span> <span class="token operator">&amp;&amp;</span> age<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token string">"ä¸­å¹´"</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>  <span class="token string">"è€å¹´"</span><span class="token punctuation">}</span>println<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€Scala ä¸­è¿”å›å€¼ç±»å‹ä¸ä¸€è‡´ï¼Œå–å®ƒä»¬å…±åŒçš„ç¥–å…ˆç±»å‹</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">var</span> age <span class="token operator">=</span> StdIn<span class="token punctuation">.</span>readInt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> res<span class="token operator">:</span> <span class="token builtin">Any</span> <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&lt;</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token string">"ç«¥å¹´"</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&gt;=</span> <span class="token number">18</span> <span class="token operator">&amp;&amp;</span> age <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token string">"ä¸­å¹´"</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token number">100</span><span class="token punctuation">}</span>println<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€ä¸‰å…ƒè¿ç®—å®ç°</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">var</span> age <span class="token operator">=</span> StdIn<span class="token punctuation">.</span>readInt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">val</span> res<span class="token operator">:</span> <span class="token builtin">Any</span> <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&lt;</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token string">"ç«¥å¹´"</span> <span class="token keyword">else</span> <span class="token string">"æˆå¹´"</span><span class="token string">"ä¸èµ·ä½œç”¨"</span>println<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1ã€Switch-åˆ†æ”¯ç»“æ„"><a href="#1ã€Switch-åˆ†æ”¯ç»“æ„" class="headerlink" title="1ã€Switch åˆ†æ”¯ç»“æ„"></a>1ã€<strong>Switch</strong> åˆ†æ”¯ç»“æ„</h4><p>åœ¨ Scala ä¸­æ²¡æœ‰ Switch ï¼Œè€Œæ˜¯ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥å¤„ç†</p><p>æ¨¡å¼åŒ¹é…æ¶‰ä¸‹é¢çš„ç« èŠ‚æè¿°</p><h3 id="2ã€å¾ªç¯æ§åˆ¶ï¼ˆforï¼‰"><a href="#2ã€å¾ªç¯æ§åˆ¶ï¼ˆforï¼‰" class="headerlink" title="2ã€å¾ªç¯æ§åˆ¶ï¼ˆforï¼‰"></a>2ã€å¾ªç¯æ§åˆ¶ï¼ˆforï¼‰</h3><h4 id="1ã€èŒƒå›´æ•°æ®å¾ªç¯ï¼ˆToï¼‰"><a href="#1ã€èŒƒå›´æ•°æ®å¾ªç¯ï¼ˆToï¼‰" class="headerlink" title="1ã€èŒƒå›´æ•°æ®å¾ªç¯ï¼ˆToï¼‰"></a>1ã€èŒƒå›´æ•°æ®å¾ªç¯ï¼ˆToï¼‰</h4><p>è¾“å‡º 1-3 ï¼ˆåŒ…å«1 and 3ï¼‰ï¼Œå‰åé—­åˆåŒºé—´</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      print<span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>è¾“å‡ºï¼š<span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€èŒƒå›´æ•°æ®å¾ªç¯-Until"><a href="#2ã€èŒƒå›´æ•°æ®å¾ªç¯-Until" class="headerlink" title="2ã€èŒƒå›´æ•°æ®å¾ªç¯(Until)"></a>2ã€èŒƒå›´æ•°æ®å¾ªç¯(<strong>Until</strong>)</h4><p>è¾“å‡º 1-3 ï¼ˆåŒ…å«1 ä¸åŒ…å« 3ï¼‰,å‰é—­åˆåå¼€</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> until <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      println<span class="token punctuation">(</span><span class="token string">" "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>    <span class="token punctuation">}</span>è¾“å‡ºï¼š<span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€å¾ªç¯å®ˆå«"><a href="#3ã€å¾ªç¯å®ˆå«" class="headerlink" title="3ã€å¾ªç¯å®ˆå«"></a>3ã€å¾ªç¯å®ˆå«</h4><p>å¾ªç¯å®ˆå«ï¼Œå³å¾ªç¯ä¿æŠ¤å¼(ä¹Ÿç§°æ¡ä»¶åˆ¤æ–­å¼ï¼Œå®ˆå«)ã€‚ä¿æŠ¤å¼ä¸º true åˆ™è¿›å…¥å¾ªç¯ ä½“å†…éƒ¨ï¼Œä¸º false åˆ™è·³è¿‡ï¼Œç±»ä¼¼äº continue</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">3</span> <span class="token keyword">if</span> i <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      print<span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// --------ç­‰ä»·äº---------</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span>        print<span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>è¾“å‡ºï¼š<span class="token number">1</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€å¾ªç¯æ­¥é•¿"><a href="#4ã€å¾ªç¯æ­¥é•¿" class="headerlink" title="4ã€å¾ªç¯æ­¥é•¿"></a>4ã€å¾ªç¯æ­¥é•¿</h4><p>è¾“å‡º 1 åˆ° 10 ä»¥å†…çš„æ‰€æœ‰å¥‡æ•°</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">10</span> by <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      println<span class="token punctuation">(</span><span class="token string">"i="</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>    <span class="token punctuation">}</span>è¾“å‡ºï¼š<span class="token number">1</span> <span class="token number">3</span> <span class="token number">5</span> <span class="token number">7</span> <span class="token number">9</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€åµŒå¥—å¾ªç¯"><a href="#5ã€åµŒå¥—å¾ªç¯" class="headerlink" title="5ã€åµŒå¥—å¾ªç¯"></a>5ã€åµŒå¥—å¾ªç¯</h4><p>è¯´æ˜ ï¼šæ²¡æœ‰å…³é”®å­—ï¼Œæ‰€ä»¥èŒƒå›´åä¸€å®šè¦åŠ  ï¼›æ¥éš”æ–­é€»è¾‘</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">3</span><span class="token punctuation">;</span> j <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      println<span class="token punctuation">(</span><span class="token string">" i ="</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">" j = "</span> <span class="token operator">+</span> j<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// --------ç­‰ä»·äº---------</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        println<span class="token punctuation">(</span><span class="token string">"i ="</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">" j="</span> <span class="token operator">+</span> j<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>è¾“å‡ºï¼ši <span class="token operator">=</span><span class="token number">1</span> j<span class="token operator">=</span><span class="token number">1</span>i <span class="token operator">=</span><span class="token number">1</span> j<span class="token operator">=</span><span class="token number">2</span>i <span class="token operator">=</span><span class="token number">1</span> j<span class="token operator">=</span><span class="token number">3</span>i <span class="token operator">=</span><span class="token number">2</span> j<span class="token operator">=</span><span class="token number">1</span>i <span class="token operator">=</span><span class="token number">2</span> j<span class="token operator">=</span><span class="token number">2</span>i <span class="token operator">=</span><span class="token number">2</span> j<span class="token operator">=</span><span class="token number">3</span>i <span class="token operator">=</span><span class="token number">3</span> j<span class="token operator">=</span><span class="token number">1</span>i <span class="token operator">=</span><span class="token number">3</span> j<span class="token operator">=</span><span class="token number">2</span>i <span class="token operator">=</span><span class="token number">3</span> j<span class="token operator">=</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ã€å¼•å…¥å˜é‡"><a href="#6ã€å¼•å…¥å˜é‡" class="headerlink" title="6ã€å¼•å…¥å˜é‡"></a>6ã€å¼•å…¥å˜é‡</h4><p>â€‹    ( 1 ) for æ¨å¯¼å¼ä¸€è¡Œä¸­æœ‰å¤šä¸ªè¡¨è¾¾å¼æ—¶ï¼Œæ‰€ä»¥è¦åŠ  <strong>;</strong>  æ¥éš”æ–­é€»è¾‘ </p><p>â€‹    ( 2 ) for æ¨å¯¼å¼æœ‰ä¸€ä¸ªä¸æˆæ–‡çš„çº¦å®šï¼šå½“ for æ¨å¯¼å¼ä»…åŒ…å«å•ä¸€è¡¨è¾¾å¼æ—¶ä½¿ç”¨åœ†æ‹¬å·ï¼Œå½“åŒ…å«å¤šä¸ªè¡¨è¾¾å¼æ—¶ï¼Œä¸€èˆ¬æ¯è¡Œä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¹¶ç”¨èŠ±æ‹¬å·ä»£æ›¿åœ†æ‹¬å·</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">    <span class="token keyword">for</span> <span class="token punctuation">{</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">3</span>         j <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">-</span> i<span class="token punctuation">}</span> <span class="token punctuation">{</span>      println<span class="token punctuation">(</span><span class="token string">"i="</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">" j="</span> <span class="token operator">+</span> j<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// --------ç­‰ä»·äº---------</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">-</span> i      println<span class="token punctuation">(</span><span class="token string">"i="</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">" j="</span> <span class="token operator">+</span> j<span class="token punctuation">)</span>    <span class="token punctuation">}</span>è¾“å‡ºï¼ši<span class="token operator">=</span><span class="token number">1</span> j<span class="token operator">=</span><span class="token number">3</span>i<span class="token operator">=</span><span class="token number">2</span> j<span class="token operator">=</span><span class="token number">2</span>i<span class="token operator">=</span><span class="token number">3</span> j<span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="7ã€å¾ªç¯è¿”å›å€¼"><a href="#7ã€å¾ªç¯è¿”å›å€¼" class="headerlink" title="7ã€å¾ªç¯è¿”å›å€¼"></a>7ã€å¾ªç¯è¿”å›å€¼</h4><p>è¯´æ˜ï¼šå°†éå†è¿‡ç¨‹ä¸­å¤„ç†çš„ç»“æœè¿”å›åˆ°ä¸€ä¸ªæ–° Vector é›†åˆä¸­ï¼Œä½¿ç”¨ yield å…³é”®å­—</p><p>æ³¨æ„ ï¼šå¼€å‘ä¸­å¾ˆå°‘ä½¿ç”¨</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">    <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">yield</span> <span class="token punctuation">{</span>      i <span class="token operator">*</span> <span class="token number">2</span>    <span class="token punctuation">}</span>    println<span class="token punctuation">(</span>res<span class="token punctuation">)</span>è¾“å‡ºï¼šVector<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="8ã€å€’å™æ‰“å°"><a href="#8ã€å€’å™æ‰“å°" class="headerlink" title="8ã€å€’å™æ‰“å°"></a>8ã€å€’å™æ‰“å°</h4><p>å¦‚æœæƒ³å€’åºæ‰“å°ä¸€ç»„æ•°æ®ï¼Œå¯ä»¥ç”¨ reverse</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">10</span> reverse<span class="token punctuation">)</span> <span class="token punctuation">{</span>      print<span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">}</span>è¾“å‡ºï¼š<span class="token number">10</span> <span class="token number">9</span> <span class="token number">8</span> <span class="token number">7</span> <span class="token number">6</span> <span class="token number">5</span> <span class="token number">4</span> <span class="token number">3</span> <span class="token number">2</span> <span class="token number">1</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€å¾ªç¯æ§åˆ¶ï¼ˆwhileï¼‰"><a href="#3ã€å¾ªç¯æ§åˆ¶ï¼ˆwhileï¼‰" class="headerlink" title="3ã€å¾ªç¯æ§åˆ¶ï¼ˆwhileï¼‰"></a>3ã€å¾ªç¯æ§åˆ¶ï¼ˆwhileï¼‰</h3><h4 id="1ã€while"><a href="#1ã€while" class="headerlink" title="1ã€while"></a>1ã€while</h4><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">" "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>    i <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€do-while"><a href="#2ã€do-while" class="headerlink" title="2ã€do..while"></a>2ã€do..while</h4><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">do</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">" "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>    i <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4ã€å¾ªç¯ä¸­æ–­"><a href="#4ã€å¾ªç¯ä¸­æ–­" class="headerlink" title="4ã€å¾ªç¯ä¸­æ–­"></a>4ã€å¾ªç¯ä¸­æ–­</h3><h4 id="1ã€å¼‚å¸¸æ–¹å¼ä¸­æ–­"><a href="#1ã€å¼‚å¸¸æ–¹å¼ä¸­æ–­" class="headerlink" title="1ã€å¼‚å¸¸æ–¹å¼ä¸­æ–­"></a>1ã€å¼‚å¸¸æ–¹å¼ä¸­æ–­</h4><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">try</span><span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>elem <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>      println<span class="token punctuation">(</span>elem<span class="token punctuation">)</span>      <span class="token keyword">if</span> ï¼ˆelem <span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> RuntimeException    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> e <span class="token keyword">=&gt;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€break-æ–¹å¼"><a href="#2ã€break-æ–¹å¼" class="headerlink" title="2ã€break æ–¹å¼"></a>2ã€break æ–¹å¼</h4><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  breakable <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>elem <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      println<span class="token punctuation">(</span>elem<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>elem <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> break    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€continue"><a href="#3ã€continue" class="headerlink" title="3ã€continue"></a>3ã€continue</h4><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>elem <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    breakable  <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>elem <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        break<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>      println<span class="token punctuation">(</span>elem<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5ã€å¤šé‡å¾ªç¯"><a href="#5ã€å¤šé‡å¾ªç¯" class="headerlink" title="5ã€å¤šé‡å¾ªç¯"></a>5ã€å¤šé‡å¾ªç¯</h3><p>ä¹ä¹ä¹˜æ³•è¡¨:åµŒå¥—å’Œå¤šé‡ä¸€æ ·ï¼Œæ— éæ˜¯for å¥— for</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>   <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token number">9</span><span class="token punctuation">;</span>j <span class="token keyword">&lt;-</span> <span class="token number">1</span> to <span class="token namespace">i</span><span class="token punctuation">)</span>print<span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token string">"*"</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> j<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="å››ã€å‡½æ•°å¼ç¼–ç¨‹"><a href="#å››ã€å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="å››ã€å‡½æ•°å¼ç¼–ç¨‹"></a>å››ã€å‡½æ•°å¼ç¼–ç¨‹</h2><h3 id="1ã€åŸºæœ¬å‡½æ•°"><a href="#1ã€åŸºæœ¬å‡½æ•°" class="headerlink" title="1ã€åŸºæœ¬å‡½æ•°"></a>1ã€åŸºæœ¬å‡½æ•°</h3><h4 id="1ã€åŸºæœ¬è¯­æ³•"><a href="#1ã€åŸºæœ¬è¯­æ³•" class="headerlink" title="1ã€åŸºæœ¬è¯­æ³•"></a>1ã€åŸºæœ¬è¯­æ³•</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202304051843727.png"></p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">def</span> test<span class="token punctuation">(</span>arg1<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span><span class="token punctuation">{</span>    print<span class="token punctuation">(</span>arg1<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// è°ƒç”¨</span>  test<span class="token punctuation">(</span><span class="token string">"hello scala"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€å‡½æ•°å’Œæ–¹æ³•çš„åŒºåˆ«"><a href="#2ã€å‡½æ•°å’Œæ–¹æ³•çš„åŒºåˆ«" class="headerlink" title="2ã€å‡½æ•°å’Œæ–¹æ³•çš„åŒºåˆ«"></a>2ã€å‡½æ•°å’Œæ–¹æ³•çš„åŒºåˆ«</h4><p>1ã€æ ¸å¿ƒæ¦‚å¿µ</p><p>â€‹    ( 1 )ä¸ºå®ŒæˆæŸä¸€åŠŸèƒ½çš„ç¨‹åºè¯­å¥çš„é›†åˆï¼Œç§°ä¸ºå‡½æ•°</p><p>â€‹    ( 2 )ç±»ä¸­çš„å‡½æ•°ç§°ä¹‹æ–¹æ³•</p><p>2ã€åŒºåˆ«</p><p>â€‹    ( 1 ) Scala è¯­è¨€å¯ä»¥åœ¨ä»»ä½•çš„è¯­æ³•ç»“æ„ä¸­å£°æ˜ä»»ä½•çš„è¯­æ³•</p><p>â€‹    ( 2 )å‡½æ•°æ²¡æœ‰é‡è½½å’Œé‡å†™çš„æ¦‚å¿µï¼›æ–¹æ³•å¯ä»¥è¿›è¡Œé‡è½½å’Œé‡å†™</p><p>â€‹    ( 3 ) Scala ä¸­å‡½æ•°å¯ä»¥åµŒå¥—å®šä¹‰</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// (2)æ–¹æ³•å¯ä»¥è¿›è¡Œé‡è½½å’Œé‡å†™ï¼Œç¨‹åºå¯ä»¥æ‰§è¡Œ</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment">// ( 1 ) Scala è¯­è¨€å¯ä»¥åœ¨ä»»ä½•çš„è¯­æ³•ç»“æ„ä¸­å£°æ˜ä»»ä½•çš„è¯­æ³• </span>    <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Date    <span class="token keyword">new</span> Date<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// (2)å‡½æ•°æ²¡æœ‰é‡è½½å’Œé‡å†™çš„æ¦‚å¿µï¼Œç¨‹åºæŠ¥é”™</span>    <span class="token keyword">def</span> test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>      println<span class="token punctuation">(</span><span class="token string">"æ— å‚ï¼Œæ— è¿”å›å€¼"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    test<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> test<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>      println<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// ( 3 ) Scala ä¸­å‡½æ•°å¯ä»¥åµŒå¥—å®šä¹‰</span>    <span class="token keyword">def</span> test2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token keyword">def</span> test3<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>        println<span class="token punctuation">(</span><span class="token string">"å‡½æ•°å¯ä»¥åµŒå¥—å®šä¹‰"</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€å‡½æ•°çš„å®šä¹‰"><a href="#3ã€å‡½æ•°çš„å®šä¹‰" class="headerlink" title="3ã€å‡½æ•°çš„å®šä¹‰"></a>3ã€å‡½æ•°çš„å®šä¹‰</h4><p>â€‹    ( 1 )å‡½æ•° 1 ï¼šæ— å‚ï¼Œæ— è¿”å›å€¼</p><p>â€‹    ( 2 )å‡½æ•° 2 ï¼šæ— å‚ï¼Œæœ‰è¿”å›å€¼</p><p>â€‹    ( 3 )å‡½æ•° 3 ï¼šæœ‰å‚ï¼Œæ— è¿”å›å€¼</p><p>â€‹    ( 4 )å‡½æ•° 4 ï¼šæœ‰å‚ï¼Œæœ‰è¿”å›å€¼</p><p>â€‹    ( 5 )å‡½æ•° 5 ï¼šå¤šå‚ï¼Œæ— è¿”å›å€¼</p><p>â€‹    ( 6 )å‡½æ•° 6 ï¼šå¤šå‚ï¼Œæœ‰è¿”å›å€¼</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment">// å‡½æ•° 1 ï¼šæ— å‚ï¼Œæ— è¿”å›å€¼</span>  <span class="token keyword">def</span> test1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"æ— å‚ï¼Œæ— è¿”å›å€¼"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  test1<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// å‡½æ•° 2 ï¼šæ— å‚ï¼Œæœ‰è¿”å›å€¼</span>  <span class="token keyword">def</span> test2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"æ— å‚ï¼Œæœ‰è¿”å›å€¼"</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>test2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// å‡½æ•° 3 ï¼šæœ‰å‚ï¼Œæ— è¿”å›å€¼</span>  <span class="token keyword">def</span> test3<span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>s<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  test3<span class="token punctuation">(</span><span class="token string">"jinlian"</span><span class="token punctuation">)</span>  <span class="token comment">// å‡½æ•° 4 ï¼šæœ‰å‚ï¼Œæœ‰è¿”å›å€¼</span>  <span class="token keyword">def</span> test4<span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> s <span class="token operator">+</span> <span class="token string">"æœ‰å‚ï¼Œæœ‰è¿”å›å€¼"</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>test4<span class="token punctuation">(</span><span class="token string">"hello "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// å‡½æ•° 5 ï¼šå¤šå‚ï¼Œæ— è¿”å›å€¼</span>  <span class="token keyword">def</span> test5<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>s<span class="token string">"$name, $age"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  test5<span class="token punctuation">(</span><span class="token string">"dalang"</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€å‡½æ•°çš„å‚æ•°"><a href="#4ã€å‡½æ•°çš„å‚æ•°" class="headerlink" title="4ã€å‡½æ•°çš„å‚æ•°"></a>4ã€å‡½æ•°çš„å‚æ•°</h4><p>â€‹    ( 1 )å¯å˜å‚æ•°</p><p>â€‹    ( 2 )å¦‚æœå‚æ•°åˆ—è¡¨ä¸­å­˜åœ¨å¤šä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå¯å˜å‚æ•°ä¸€èˆ¬æ”¾ç½®åœ¨æœ€å</p><p>â€‹    ( 3 )å‚æ•°é»˜è®¤å€¼ï¼Œä¸€èˆ¬å°†æœ‰é»˜è®¤å€¼çš„å‚æ•°æ”¾ç½®åœ¨å‚æ•°åˆ—è¡¨çš„åé¢</p><p>â€‹    ( 4 )å¸¦åå‚æ•°</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// ( 1 )å¯å˜å‚æ•°</span>  <span class="token keyword">def</span> test<span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">String</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>s<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// æœ‰è¾“å…¥å‚æ•°ï¼šè¾“å‡º Array</span>  test<span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"Scala"</span><span class="token punctuation">)</span>  <span class="token comment">// æ— è¾“å…¥å‚æ•°ï¼šè¾“å‡º List()</span>  test<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment">// ( 2 )å¦‚æœå‚æ•°åˆ—è¡¨ä¸­å­˜åœ¨å¤šä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå¯å˜å‚æ•°ä¸€èˆ¬æ”¾ç½®åœ¨æœ€å</span>  <span class="token keyword">def</span> test2<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token builtin">String</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> s<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  test2<span class="token punctuation">(</span><span class="token string">"jinlian"</span><span class="token punctuation">,</span> <span class="token string">"dalang"</span><span class="token punctuation">,</span> <span class="token string">"ximenqing"</span><span class="token punctuation">)</span>      <span class="token comment">// (3)å‚æ•°é»˜è®¤å€¼</span>  <span class="token keyword">def</span> test3<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>s<span class="token string">"$name, $age"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// å¦‚æœå‚æ•°ä¼ é€’äº†å€¼ï¼Œé‚£ä¹ˆä¼šè¦†ç›–é»˜è®¤å€¼</span>  test3<span class="token punctuation">(</span><span class="token string">"jinlian"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>  <span class="token comment">// å¦‚æœå‚æ•°æœ‰é»˜è®¤å€¼ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå¯ä»¥çœç•¥è¿™ä¸ªå‚æ•°</span>  test3<span class="token punctuation">(</span><span class="token string">"dalang"</span><span class="token punctuation">)</span>      <span class="token comment">// ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°†æœ‰é»˜è®¤å€¼çš„å‚æ•°æ”¾ç½®åœ¨å‚æ•°åˆ—è¡¨çš„åé¢</span>  <span class="token keyword">def</span> test4<span class="token punctuation">(</span>sex<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"ç”·"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>s<span class="token string">"$name, $sex"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// Scala å‡½æ•°ä¸­å‚æ•°ä¼ é€’æ˜¯ï¼Œä»å·¦åˆ°å³</span>  test4<span class="token punctuation">(</span><span class="token string">"wusong"</span><span class="token punctuation">)</span>  <span class="token comment">// ( 4 )å¸¦åå‚æ•°</span>  test4<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"ximenqing"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€å‡½æ•°è‡³ç®€åŸåˆ™-é‡ç‚¹"><a href="#5ã€å‡½æ•°è‡³ç®€åŸåˆ™-é‡ç‚¹" class="headerlink" title="5ã€å‡½æ•°è‡³ç®€åŸåˆ™(é‡ç‚¹)"></a>5ã€å‡½æ•°è‡³ç®€åŸåˆ™(é‡ç‚¹)</h4><p>å‡½æ•°è‡³ç®€åŸåˆ™ï¼šèƒ½çœåˆ™çœï¼Œå¤§é“è‡³ç®€</p><p>â€‹    ( 1 ) return å¯ä»¥çœç•¥ï¼ŒScala ä¼šä½¿ç”¨å‡½æ•°ä½“çš„æœ€åä¸€è¡Œä»£ç ä½œä¸ºè¿”å›å€¼</p><p>â€‹    ( 2 )å¦‚æœå‡½æ•°ä½“åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¯ä»¥çœç•¥èŠ±æ‹¬å·</p><p>â€‹    ( 3 )è¿”å›å€¼ç±»å‹å¦‚æœèƒ½å¤Ÿæ¨æ–­å‡ºæ¥ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥( :å’Œè¿”å›å€¼ç±»å‹ä¸€èµ·çœç•¥)</p><p>â€‹    ( 4 )å¦‚æœæœ‰ return ï¼Œåˆ™ä¸èƒ½çœç•¥è¿”å›å€¼ç±»å‹ï¼Œå¿…é¡»æŒ‡å®š</p><p>â€‹    ( 5 )å¦‚æœå‡½æ•°æ˜ç¡®å£°æ˜ unit ï¼Œé‚£ä¹ˆå³ä½¿å‡½æ•°ä½“ä¸­ä½¿ç”¨ return å…³é”®å­—ä¹Ÿä¸èµ·ä½œç”¨</p><p>â€‹    ( 6 ) Scala å¦‚æœæœŸæœ›æ˜¯æ— è¿”å›å€¼ç±»å‹ï¼Œå¯ä»¥çœç•¥ç­‰å·</p><p>â€‹    ( 7 )å¦‚æœå‡½æ•°æ— å‚ï¼Œä½†æ˜¯å£°æ˜äº†å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆè°ƒç”¨æ—¶ï¼Œå°æ‹¬å·ï¼Œå¯åŠ å¯ä¸åŠ </p><p>â€‹    ( 8 )å¦‚æœå‡½æ•°æ²¡æœ‰å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆå°æ‹¬å·å¯ä»¥çœç•¥ï¼Œè°ƒç”¨æ—¶å°æ‹¬å·å¿…é¡»çœç•¥</p><p>â€‹    ( 9 )å¦‚æœä¸å…³å¿ƒåç§°ï¼Œåªå…³å¿ƒé€»è¾‘å¤„ç†ï¼Œé‚£ä¹ˆå‡½æ•°å(def)å¯ä»¥çœç•¥</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// ( 0 )å‡½æ•°æ ‡å‡†å†™æ³•</span>  <span class="token keyword">def</span> f<span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> s <span class="token operator">+</span> <span class="token string">" jinlian"</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//( 1 )  return å¯ä»¥çœç•¥,Scala ä¼šä½¿ç”¨å‡½æ•°ä½“çš„æœ€åä¸€è¡Œä»£ç ä½œä¸ºè¿”å›å€¼</span>  <span class="token keyword">def</span> f1<span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    s <span class="token operator">+</span> <span class="token string">" jinlian"</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>f1<span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ( 2 )å¦‚æœå‡½æ•°ä½“åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¯ä»¥çœç•¥èŠ±æ‹¬å·</span>  <span class="token keyword">def</span> f2<span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token string">" jinlian"</span>  <span class="token comment">// ( 3 )è¿”å›å€¼ç±»å‹å¦‚æœèƒ½å¤Ÿæ¨æ–­å‡ºæ¥ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥( :å’Œè¿”å›å€¼ç±»å‹ä¸€èµ·çœç•¥</span>  <span class="token keyword">def</span> f3<span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token string">" jinlian"</span>  println<span class="token punctuation">(</span>f3<span class="token punctuation">(</span><span class="token string">"Hello3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ( 4 )å¦‚æœæœ‰ return ï¼Œåˆ™ä¸èƒ½çœç•¥è¿”å›å€¼ç±»å‹ï¼Œå¿…é¡»æŒ‡å®šã€‚</span>  <span class="token keyword">def</span> f4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"ximenqing4"</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>f4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ( 5 )å¦‚æœå‡½æ•°æ˜ç¡®å£°æ˜ unit ï¼Œé‚£ä¹ˆå³ä½¿å‡½æ•°ä½“ä¸­ä½¿ç”¨ return å…³é”®å­—ä¹Ÿ ä¸èµ·ä½œç”¨</span>  <span class="token keyword">def</span> f5<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"dalang5"</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>f5<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ( 6 ) Scala å¦‚æœæœŸæœ›æ˜¯æ— è¿”å›å€¼ç±»å‹,å¯ä»¥çœç•¥ç­‰å·</span>  <span class="token comment">// å°†æ— è¿”å›å€¼çš„å‡½æ•°ç§°ä¹‹ä¸ºè¿‡ç¨‹</span>  <span class="token keyword">def</span> f6<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token string">"dalang6"</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>f6<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ( 7 )å¦‚æœå‡½æ•°æ— å‚ï¼Œä½†æ˜¯å£°æ˜äº†å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆè°ƒç”¨æ—¶ï¼Œå°æ‹¬å·ï¼Œå¯åŠ å¯ä¸åŠ </span>  <span class="token keyword">def</span> f7<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"dalang7"</span>  println<span class="token punctuation">(</span>f7<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>f7<span class="token punctuation">)</span>  <span class="token comment">// ( 8 )å¦‚æœå‡½æ•°æ²¡æœ‰å‚æ•°åˆ—è¡¨ï¼Œé‚£ä¹ˆå°æ‹¬å·å¯ä»¥çœç•¥,è°ƒç”¨æ—¶å°æ‹¬å·å¿…é¡»çœç•¥</span>  <span class="token keyword">def</span> f8 <span class="token operator">=</span> <span class="token string">"dalang"</span>  <span class="token comment">//println(f8())</span>  println<span class="token punctuation">(</span>f8<span class="token punctuation">)</span>  <span class="token comment">// ( 9 )å¦‚æœä¸å…³å¿ƒåç§°ï¼Œåªå…³å¿ƒé€»è¾‘å¤„ç†ï¼Œé‚£ä¹ˆå‡½æ•°å( def )å¯ä»¥çœç•¥</span>    <span class="token comment">// æœ‰å…¥å‚çœç•¥è¿”å›å€¼</span>  <span class="token keyword">def</span> f9 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"wusong"</span><span class="token operator">+</span>x<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// å…¥å‚æ˜¯å‡½æ•°</span>  <span class="token comment">// æ–¹å¼ä¸€ï¼š</span>  <span class="token keyword">def</span> f10<span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Unit</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    f<span class="token punctuation">(</span><span class="token string">"11"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  f10<span class="token punctuation">(</span>f9<span class="token punctuation">)</span>    <span class="token comment">// æ–¹å¼äºŒï¼š</span>  println<span class="token punctuation">(</span>f10<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"wusong"</span><span class="token operator">+</span>x<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2ã€é«˜çº§å‡½æ•°"><a href="#2ã€é«˜çº§å‡½æ•°" class="headerlink" title="2ã€é«˜çº§å‡½æ•°"></a>2ã€é«˜çº§å‡½æ•°</h3><h4 id="1ã€é«˜é˜¶ç”¨æ³•"><a href="#1ã€é«˜é˜¶ç”¨æ³•" class="headerlink" title="1ã€é«˜é˜¶ç”¨æ³•"></a>1ã€é«˜é˜¶ç”¨æ³•</h4><p>1ã€å‡½æ•°å¯ä»¥ä½œä¸ºå€¼è¿›è¡Œä¼ é€’</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// å®šä¹‰å‡½æ•°</span><span class="token keyword">def</span> foo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  print<span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">def</span> foo2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  print<span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span>  <span class="token number">1</span><span class="token punctuation">}</span><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// ( 1 )è°ƒç”¨ foo å‡½æ•°ï¼ŒæŠŠè¿”å›å€¼ç»™å˜é‡ f</span>  <span class="token keyword">var</span> result01 <span class="token operator">=</span> foo  <span class="token comment">// ( 2 )åœ¨è¢«è°ƒç”¨å‡½æ•° foo åé¢åŠ ä¸Š _ ï¼Œç›¸å½“äºæŠŠå‡½æ•° foo å½“æˆä¸€ä¸ªæ•´ä½“ï¼Œ ä¼ é€’ç»™å˜é‡ f1</span>  <span class="token keyword">var</span> result02 <span class="token operator">=</span> foo _  <span class="token comment">// ( 3 )å¦‚æœæ˜ç¡®å˜é‡ç±»å‹ï¼Œé‚£ä¹ˆä¸ä½¿ç”¨ä¸‹åˆ’çº¿ä¹Ÿå¯ä»¥å°†å‡½æ•°ä½œä¸ºæ•´ä½“ä¼ é€’ç»™å˜é‡</span>  <span class="token keyword">var</span> result03<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Int</span> <span class="token operator">=</span> foo2<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// å®šä¹‰å‚æ•°å‡½æ•°ï¼ˆå‡½æ•°ç­¾åï¼‰</span>  <span class="token keyword">def</span> add <span class="token punctuation">(</span>a<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">,</span>b<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">Int</span> <span class="token operator">=</span> a<span class="token operator">+</span>b      <span class="token comment">// å®šä¹‰è°ƒç”¨å‡½æ•°</span>  <span class="token keyword">def</span> fun1<span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    f<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>      <span class="token comment">// å°† addå‡½æ•°ä½œä¸ºå‚æ•° ä¼ é€’</span>  fun1<span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€å‡½æ•°å¯ä»¥ä½œä¸ºå‡½æ•°è¿”å›å€¼è¿”å›</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">def</span> fun1<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">def</span> fun2<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    fun2 _  <span class="token punctuation">}</span>  <span class="token keyword">var</span> f <span class="token operator">=</span> fun1<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ç®€åŒ–äº† fun1()()</span>  fun1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€åŒ¿åå‡½æ•°"><a href="#2ã€åŒ¿åå‡½æ•°" class="headerlink" title="2ã€åŒ¿åå‡½æ•°"></a>2ã€åŒ¿åå‡½æ•°</h4><p>æ²¡æœ‰åå­—çš„å‡½æ•°å°±æ˜¯åŒ¿åå‡½æ•°ã€‚</p><p>(x:Int)=&gt;{å‡½æ•°ä½“}</p><p>x ï¼šè¡¨ç¤ºè¾“å…¥å‚æ•°ç±»å‹ ï¼›Int ï¼šè¡¨ç¤ºè¾“å…¥å‚æ•°ç±»å‹ ï¼›å‡½æ•°ä½“ï¼š è¡¨ç¤ºå…·ä½“ä»£ç é€»è¾‘ </p><p>éœ€æ±‚ 1 ï¼šä¼ é€’çš„å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°</p><p>â€‹    ( 1 )å‚æ•°çš„ç±»å‹å¯ä»¥çœç•¥ï¼Œä¼šæ ¹æ®å½¢å‚è¿›è¡Œè‡ªåŠ¨çš„æ¨å¯¼</p><p>â€‹    ( 2 )ç±»å‹çœç•¥ä¹‹å ï¼Œå‘ç°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œåˆ™åœ†æ‹¬å·å¯ä»¥çœç•¥ ï¼›å…¶ä»–æƒ…å†µï¼šæ²¡æœ‰å‚æ•°å’Œå‚ æ•°è¶…è¿‡ 1 çš„æ°¸è¿œä¸èƒ½çœç•¥åœ†æ‹¬å·ã€‚</p><p>â€‹    ( 3 )åŒ¿åå‡½æ•°å¦‚æœåªæœ‰ä¸€è¡Œï¼Œ åˆ™å¤§æ‹¬å·ä¹Ÿå¯ä»¥çœç•¥</p><p>â€‹    ( 4 )å¦‚æœå‚æ•°åªå‡ºç°ä¸€æ¬¡ï¼Œåˆ™å‚æ•°çœç•¥ä¸”åé¢å‚æ•°å¯ä»¥ç”¨_ä»£æ›¿</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// ( 1 )å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼šå‚æ•°åŒ…å«æ•°æ®å’Œé€»è¾‘å‡½æ•°</span>  <span class="token keyword">def</span> operation<span class="token punctuation">(</span>arr <span class="token operator">:</span>Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span>op<span class="token operator">:</span><span class="token builtin">Int</span> <span class="token keyword">=&gt;</span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>elem <span class="token keyword">&lt;-</span> arr<span class="token punctuation">)</span><span class="token keyword">yield</span>  op <span class="token punctuation">(</span>elem<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// ( 2 )å®šä¹‰é€»è¾‘å‡½æ•°</span>  <span class="token keyword">def</span> op<span class="token punctuation">(</span>ele<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    ele<span class="token operator">+</span><span class="token number">1</span>  <span class="token punctuation">}</span>  <span class="token comment">// ( 3 )æ ‡å‡†å‡½æ•°è°ƒç”¨</span>  <span class="token keyword">var</span> arr <span class="token operator">=</span> operation<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>op<span class="token punctuation">)</span>  print<span class="token punctuation">(</span>arr<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ( 4 )é‡‡ç”¨åŒ¿åå‡½æ•°</span>  <span class="token keyword">var</span> arr1 <span class="token operator">=</span> operation<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>ele<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token keyword">=&gt;</span><span class="token punctuation">{</span>    ele<span class="token operator">+</span><span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  print<span class="token punctuation">(</span>arr1<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 1ã€å‚æ•°çš„ç±»å‹å¯ä»¥çœç•¥ï¼Œä¼šæ ¹æ®å½¢å‚è¿›è¡Œè‡ªåŠ¨çš„æ¨å¯¼</span>  <span class="token keyword">var</span> array1 <span class="token operator">=</span> operation<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token keyword">=&gt;</span><span class="token punctuation">{</span>    ele<span class="token operator">+</span><span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  print<span class="token punctuation">(</span>array1<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">// 2ã€ç±»å‹çœç•¥ä¹‹åï¼Œå‘ç°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œåˆ™åœ†æ‹¬å·å¯ä»¥çœç•¥ï¼›</span>  <span class="token comment">// å…¶ä»–æƒ…å†µï¼šæ²¡æœ‰å‚æ•°å’Œå‚æ•°è¶…è¿‡ 1 çš„æ°¸è¿œä¸èƒ½çœç•¥åœ†æ‹¬å·</span>  <span class="token keyword">var</span> array2 <span class="token operator">=</span> operation<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ele<span class="token keyword">=&gt;</span><span class="token punctuation">{</span>    ele<span class="token operator">+</span><span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  print<span class="token punctuation">(</span>array2<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">// 3ã€åŒ¿åå‡½æ•°å¦‚æœåªæœ‰ä¸€è¡Œï¼Œåˆ™å¤§æ‹¬å·ä¹Ÿå¯ä»¥çœç•¥</span>  <span class="token keyword">var</span> array3 <span class="token operator">=</span> operation<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ele<span class="token keyword">=&gt;</span> ele<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>  print<span class="token punctuation">(</span>array3<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// 4ã€å¦‚æœå‚æ•°åªå‡ºç°ä¸€æ¬¡ï¼Œåˆ™å‚æ•°çœç•¥ä¸”åé¢å‚æ•°å¯ä»¥ç”¨_ä»£æ›¿</span>  <span class="token keyword">var</span> array4 <span class="token operator">=</span> operation<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>_<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>  print<span class="token punctuation">(</span>array4<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éœ€æ±‚ 2 ï¼šä¼ é€’çš„å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// å®šä¹‰å‡½æ•°</span>  <span class="token keyword">def</span> calculator<span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> op<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    op<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">// ( 1 )æ ‡å‡†ç‰ˆ</span>  println<span class="token punctuation">(</span>calculator<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>    x <span class="token operator">+</span> y  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ( 2 )å¦‚æœåªæœ‰ä¸€è¡Œï¼Œåˆ™å¤§æ‹¬å·ä¹Ÿå¯ä»¥çœç•¥</span>  println<span class="token punctuation">(</span>calculator<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ( 3 )å‚æ•°çš„ç±»å‹å¯ä»¥çœç•¥ï¼Œä¼šæ ¹æ®å½¢å‚è¿›è¡Œè‡ªåŠ¨çš„æ¨å¯¼</span>  println<span class="token punctuation">(</span>calculator<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ( 4 )å¦‚æœå‚æ•°åªå‡ºç°ä¸€æ¬¡ï¼Œåˆ™å‚æ•°çœç•¥ä¸”åé¢å‚æ•°å¯ä»¥ç”¨_ä»£æ›¿</span>  println<span class="token punctuation">(</span>calculator<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> _<span class="token operator">+</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€é«˜é˜¶å‡½æ•°æ¡ˆä¾‹"><a href="#3ã€é«˜é˜¶å‡½æ•°æ¡ˆä¾‹" class="headerlink" title="3ã€é«˜é˜¶å‡½æ•°æ¡ˆä¾‹"></a>3ã€é«˜é˜¶å‡½æ•°æ¡ˆä¾‹</h4><p>éœ€æ±‚ ï¼šæ¨¡æ‹Ÿ Map æ˜ å°„ã€Filter è¿‡æ»¤ã€  Reduce èšåˆ</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// ( 1 ) map æ˜ å°„</span>  <span class="token keyword">def</span> map<span class="token punctuation">(</span>arr<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> op<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>elem <span class="token keyword">&lt;-</span> arr<span class="token punctuation">)</span> <span class="token keyword">yield</span> op<span class="token punctuation">(</span>elem<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">val</span> arr <span class="token operator">=</span> map<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x <span class="token keyword">=&gt;</span> x <span class="token operator">*</span> x<span class="token punctuation">)</span>  <span class="token comment">//    println(arr.mkString(","))</span>  <span class="token comment">// ( 2 ) filter è¿‡æ»¤ã€‚æœ‰å‚æ•°ï¼Œä¸”å‚æ•°å†åé¢åªä½¿ç”¨ä¸€æ¬¡ï¼Œåˆ™å‚æ•°çœç•¥ä¸”åé¢å‚æ•°ç”¨_è¡¨ç¤º</span>  <span class="token keyword">def</span> filter<span class="token punctuation">(</span>arr<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> op<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Boolean</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> arr1<span class="token operator">:</span> ArrayBuffer<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> ArrayBuffer<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>elem <span class="token keyword">&lt;-</span> arr <span class="token keyword">if</span> op<span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">)</span> arr1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>elem<span class="token punctuation">)</span>    arr1<span class="token punctuation">.</span>toArray  <span class="token punctuation">}</span>  <span class="token keyword">var</span> arr1 <span class="token operator">=</span> filter<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _ <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>arr1<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€å‡½æ•°æŸ¯é‡ŒåŒ–-amp-é—­åŒ…"><a href="#4ã€å‡½æ•°æŸ¯é‡ŒåŒ–-amp-é—­åŒ…" class="headerlink" title="4ã€å‡½æ•°æŸ¯é‡ŒåŒ–&amp;é—­åŒ…"></a>4ã€å‡½æ•°æŸ¯é‡ŒåŒ–&amp;é—­åŒ…</h4><p>é—­åŒ… ï¼šå‡½æ•°å¼ç¼–ç¨‹çš„æ ‡é…</p><p>é—­åŒ… ï¼šå¦‚æœä¸€ä¸ªå‡½æ•°ï¼Œè®¿é—®åˆ°äº†å®ƒçš„å¤–éƒ¨(å±€éƒ¨)å˜é‡çš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å’Œä»–æ‰€å¤„çš„ ç¯å¢ƒï¼Œç§°ä¸ºé—­åŒ…</p><p>å‡½æ•°æŸ¯é‡ŒåŒ– ï¼šæŠŠä¸€ä¸ªå‚æ•°åˆ—è¡¨çš„å¤šä¸ªå‚æ•°ï¼Œå˜æˆå¤šä¸ªå‚æ•°åˆ—è¡¨ã€‚</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">def</span> f1 <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> a<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">10</span>      <span class="token keyword">def</span> f2<span class="token punctuation">(</span>b<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>        a <span class="token operator">+</span> b      <span class="token punctuation">}</span>      f2 _    <span class="token punctuation">}</span>    <span class="token comment">// åœ¨è°ƒç”¨æ—¶ï¼Œf1 å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå±€éƒ¨å˜é‡ a åº”è¯¥éšç€æ ˆç©ºé—´é‡Šæ”¾æ‰</span>    <span class="token keyword">var</span> f <span class="token operator">=</span> f1    <span class="token comment">// ä½†æ˜¯åœ¨æ­¤å¤„ï¼Œå˜é‡ a å…¶å®å¹¶æ²¡æœ‰é‡Šæ”¾ï¼Œè€Œæ˜¯åŒ…å«åœ¨äº† f2 å‡½æ•°çš„å†…éƒ¨ï¼Œå½¢ æˆäº†é—­åˆçš„æ•ˆæœ</span>    print<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//    println(f1()(3))</span>    <span class="token comment">// å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œå…¶å®å°±æ˜¯å°†å¤æ‚çš„å‚æ•°é€»è¾‘å˜å¾—ç®€å•åŒ–,å‡½æ•°æŸ¯é‡ŒåŒ–ä¸€å®šå­˜åœ¨é—­åŒ…</span>    <span class="token keyword">def</span> f3<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>b<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> a<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">10</span>      a <span class="token operator">+</span> b    <span class="token punctuation">}</span>    println<span class="token punctuation">(</span>f3<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€é€’å½’"><a href="#5ã€é€’å½’" class="headerlink" title="5ã€é€’å½’"></a>5ã€é€’å½’</h4><p>ä¸€ä¸ªå‡½æ•°/æ–¹æ³•åœ¨å‡½æ•°/æ–¹æ³•ä½“å†…åˆè°ƒç”¨äº†æœ¬èº«ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºé€’å½’è°ƒç”¨</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// é˜¶ä¹˜</span>  <span class="token comment">// é€’å½’ç®—æ³•</span>  <span class="token comment">// 1) æ–¹æ³•è°ƒç”¨è‡ªèº«</span>  <span class="token comment">// 2) æ–¹æ³•å¿…é¡»è¦æœ‰è·³å‡ºçš„é€»è¾‘</span>  <span class="token comment">// 3) æ–¹æ³•è°ƒç”¨è‡ªèº«æ—¶ï¼Œä¼ é€’çš„å‚æ•°åº”è¯¥æœ‰è§„å¾‹</span>  <span class="token comment">// 4) scala ä¸­çš„é€’å½’å¿…é¡»å£°æ˜å‡½æ•°è¿”å›å€¼ç±»å‹</span>  <span class="token keyword">def</span> test<span class="token punctuation">(</span>i<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>      <span class="token number">1</span>    <span class="token keyword">else</span>      i <span class="token operator">*</span> test<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  print<span class="token punctuation">(</span>test<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ã€æ§åˆ¶æŠ½è±¡"><a href="#6ã€æ§åˆ¶æŠ½è±¡" class="headerlink" title="6ã€æ§åˆ¶æŠ½è±¡"></a>6ã€æ§åˆ¶æŠ½è±¡</h4><p><strong>Java åªæœ‰å€¼è°ƒç”¨ ï¼›Scala æ—¢æœ‰å€¼è°ƒç”¨ï¼Œåˆæœ‰åè°ƒç”¨ã€‚</strong></p><p>1ã€å€¼è°ƒç”¨ï¼šæŠŠè®¡ç®—åçš„å€¼ä¼ é€’è¿‡å»</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">def</span> f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span><span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"f....."</span><span class="token punctuation">)</span>    <span class="token number">10</span>  <span class="token punctuation">}</span>  foo<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">def</span> foo<span class="token punctuation">(</span>a<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">Unit</span><span class="token operator">=</span><span class="token punctuation">{</span>  println<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€åè°ƒç”¨ï¼šæŠŠä»£ç ä¼ é€’è¿‡å»</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">def</span> f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"fã€‚ã€‚ã€‚"</span><span class="token punctuation">)</span>    <span class="token number">10</span>  <span class="token punctuation">}</span>  <span class="token keyword">def</span> foo<span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  foo<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment">// ( 1 )ä¼ é€’ä»£ç å—</span>  foo<span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token number">10</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// ( 2 ) å°æ‹¬å·å¯ä»¥çœç•¥</span>  foo <span class="token punctuation">{</span>    <span class="token number">10</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€è‡ªå®šä¹‰ä¸€ä¸ª while</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">def</span> myWhile<span class="token punctuation">(</span>flag<span class="token operator">:</span> <span class="token keyword">=&gt;</span><span class="token builtin">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">(</span>op<span class="token operator">:</span> <span class="token keyword">=&gt;</span><span class="token builtin">Unit</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">Unit</span><span class="token operator">=</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>      op      myWhile<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">var</span> i<span class="token operator">:</span><span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">1</span>  myWhile<span class="token punctuation">(</span>i<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    print<span class="token punctuation">(</span><span class="token string">" "</span><span class="token operator">+</span>i<span class="token punctuation">)</span>    i <span class="token operator">+=</span><span class="token number">1</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="7ã€æƒ°æ€§åŠ è½½"><a href="#7ã€æƒ°æ€§åŠ è½½" class="headerlink" title="7ã€æƒ°æ€§åŠ è½½"></a>7ã€æƒ°æ€§åŠ è½½</h4><p>å½“<strong>å‡½æ•°è¿”å›å€¼è¢«å£°æ˜ä¸º lazy</strong>æ—¶ ï¼Œå‡½æ•°çš„<strong>æ‰§è¡Œå°†è¢«æ¨è¿Ÿ</strong> ï¼Œç›´åˆ°æˆ‘ä»¬<strong>é¦–æ¬¡å¯¹æ­¤å–å€¼ï¼Œè¯¥å‡½ æ•°æ‰ä¼šæ‰§è¡Œ</strong>ã€‚è¿™ç§å‡½æ•°æˆ‘ä»¬ç§°ä¹‹ä¸ºæƒ°æ€§å‡½æ•°ã€‚</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">def</span> sum<span class="token punctuation">(</span>n1<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">,</span>n2<span class="token operator">:</span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    print<span class="token punctuation">(</span><span class="token string">"sum è¢«æ‰§è¡Œ"</span><span class="token punctuation">)</span>    n1<span class="token operator">+</span>n2  <span class="token punctuation">}</span>  <span class="token comment">// lazy ä¸èƒ½ä¿®é¥° var ç±»å‹çš„å˜é‡</span>  <span class="token keyword">lazy</span> <span class="token keyword">val</span> res <span class="token operator">=</span> sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">//println(res)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ ï¼šlazy ä¸èƒ½ä¿®é¥° var ç±»å‹çš„å˜é‡</p><h3 id="3ã€ScalaåŒ…"><a href="#3ã€ScalaåŒ…" class="headerlink" title="3ã€ScalaåŒ…"></a>3ã€ScalaåŒ…</h3><h2 id="äº”ã€ç±»å’Œå¯¹è±¡"><a href="#äº”ã€ç±»å’Œå¯¹è±¡" class="headerlink" title="äº”ã€ç±»å’Œå¯¹è±¡"></a>äº”ã€ç±»å’Œå¯¹è±¡</h2><p>Scala çš„é¢å‘å¯¹è±¡æ€æƒ³å’Œ Java çš„é¢å‘å¯¹è±¡æ€æƒ³å’Œæ¦‚å¿µæ˜¯ä¸€è‡´çš„ã€‚</p><p>Scala ä¸­è¯­æ³•å’Œ Java ä¸åŒ ï¼Œè¡¥å……äº†æ›´å¤šçš„åŠŸèƒ½ã€‚</p><h3 id="1ã€ScalaåŒ…"><a href="#1ã€ScalaåŒ…" class="headerlink" title="1ã€ScalaåŒ…"></a>1ã€ScalaåŒ…</h3><p> Scala åŒ…çš„ä¸‰å¤§ä½œç”¨(<strong>å’Œ Java ä¸€æ ·</strong>)</p><p>â€‹    ( 1 )åŒºåˆ†ç›¸åŒåå­—çš„ç±»</p><p>â€‹    ( 2 )å½“ç±»å¾ˆå¤šæ—¶ï¼Œå¯ä»¥å¾ˆå¥½çš„ç®¡ç†ç±»</p><p>â€‹    ( 3 )æ§åˆ¶è®¿é—®èŒƒå›´</p><h4 id="1ã€åŒ…å‘½å"><a href="#1ã€åŒ…å‘½å" class="headerlink" title="1ã€åŒ…å‘½å"></a>1ã€åŒ…å‘½å</h4><p>è§„åˆ™ï¼š</p><p>åªèƒ½åŒ…å«æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ã€å°åœ†ç‚¹. ï¼Œä½†ä¸èƒ½ç”¨æ•°å­—å¼€å¤´ï¼Œä¹Ÿä¸è¦ä½¿ç”¨å…³é”®å­—ã€‚</p><p>è§„èŒƒï¼š</p><p><strong>com</strong>.<strong>å…¬å¸å</strong>.<strong>é¡¹ç›®å</strong>.ä¸šåŠ¡æ¨¡å—å</p><h4 id="2ã€åŒ…ç®¡ç†é£æ ¼"><a href="#2ã€åŒ…ç®¡ç†é£æ ¼" class="headerlink" title="2ã€åŒ…ç®¡ç†é£æ ¼"></a>2ã€åŒ…ç®¡ç†é£æ ¼</h4><p>Scala æœ‰ä¸¤ç§åŒ…çš„ç®¡ç†é£æ ¼</p><ul><li>ä¸€ç§æ–¹å¼å’Œ Java çš„åŒ…ç®¡ç†é£æ ¼ç›¸åŒï¼Œæ¯ä¸ªæºæ–‡ä»¶ä¸€ä¸ªåŒ…(åŒ… åå’Œæºæ–‡ä»¶æ‰€åœ¨è·¯å¾„ä¸è¦æ±‚å¿…é¡»ä¸€è‡´ )</li><li>é€šè¿‡åµŒå¥—çš„é£æ ¼è¡¨ç¤ºå±‚çº§å…³ç³»</li></ul><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com</span> <span class="token punctuation">{</span>  <span class="token keyword">package</span> <span class="token namespace">kk</span> <span class="token punctuation">{</span>    <span class="token keyword">package</span> <span class="token namespace">scala</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬äºŒç§é£æ ¼æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><p>â€‹    ( 1 )ä¸€ä¸ªæºæ–‡ä»¶ä¸­å¯ä»¥å£°æ˜å¤šä¸ª package</p><p>â€‹    ( 2 )å­åŒ…ä¸­çš„ç±»å¯ä»¥ç›´æ¥è®¿é—®çˆ¶åŒ…ä¸­çš„å†…å®¹ï¼Œè€Œæ— éœ€å¯¼åŒ…</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com</span> <span class="token punctuation">{</span>  <span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span></span>Inner <span class="token comment">//çˆ¶åŒ…è®¿é—®å­åŒ…éœ€è¦å¯¼åŒ…</span>  <span class="token keyword">object</span> Outer <span class="token punctuation">{</span>    <span class="token keyword">val</span> out<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"out"</span>    <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>      println<span class="token punctuation">(</span>Inner<span class="token punctuation">.</span>in<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">package</span> <span class="token namespace">kk</span> <span class="token punctuation">{</span>    <span class="token keyword">object</span> Inner <span class="token punctuation">{</span>      <span class="token keyword">val</span> in<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"in"</span>      <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>        println<span class="token punctuation">(</span>Outer<span class="token punctuation">.</span>out<span class="token punctuation">)</span> <span class="token comment">//å­åŒ…è®¿é—®çˆ¶åŒ…æ— éœ€å¯¼åŒ…</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">package</span> <span class="token namespace">other</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€åŒ…å¯¹è±¡"><a href="#3ã€åŒ…å¯¹è±¡" class="headerlink" title="3ã€åŒ…å¯¹è±¡"></a>3ã€åŒ…å¯¹è±¡</h4><p>åœ¨ Scala ä¸­å¯ä»¥ä¸ºæ¯ä¸ªåŒ…å®šä¹‰ä¸€ä¸ª<font color="red">åŒå</font>çš„åŒ…å¯¹è±¡ ï¼Œå®šä¹‰åœ¨åŒ…å¯¹è±¡ä¸­çš„æˆå‘˜ ï¼Œä½œä¸ºå…¶<font color="red">å¯¹åº”åŒ…ä¸‹</font>æ‰€æœ‰ class å’Œ object çš„å…±äº«å˜é‡ ï¼Œå¯ä»¥è¢«ç›´æ¥è®¿é—®</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202304081716620.png"></p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">object</span> com <span class="token punctuation">{</span>  <span class="token keyword">val</span> name <span class="token operator">=</span> <span class="token string">"mykk"</span>  <span class="token keyword">def</span> testMenthod<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åµŒå¥—åŒ…ç®¡ç†</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com</span> <span class="token punctuation">{</span>  <span class="token keyword">object</span> Outer <span class="token punctuation">{</span>    <span class="token keyword">val</span> out<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"out"</span>    <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>      println<span class="token punctuation">(</span>name<span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">package</span> <span class="token namespace">object</span> com <span class="token punctuation">{</span>  <span class="token keyword">val</span> name <span class="token operator">=</span> <span class="token string">"mykk"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€å¯¼åŒ…è¯´æ˜"><a href="#4ã€å¯¼åŒ…è¯´æ˜" class="headerlink" title="4ã€å¯¼åŒ…è¯´æ˜"></a>4ã€å¯¼åŒ…è¯´æ˜</h4><p>1 ) å’Œ Java ä¸€æ · ï¼Œå¯ä»¥åœ¨é¡¶éƒ¨ä½¿ç”¨ import å¯¼å…¥ ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­çš„æ‰€æœ‰ç±»éƒ½å¯ä»¥ä½¿ç”¨ã€‚ </p><p>2 ) å±€éƒ¨å¯¼å…¥ï¼šä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Œä»€ä¹ˆæ—¶å€™å¯¼å…¥ã€‚  åœ¨å…¶ä½œç”¨èŒƒå›´å†…éƒ½å¯ä»¥ä½¿ç”¨              </p><p>3 ) é€šé…ç¬¦å¯¼å…¥ï¼šimport java.util._</p><p>4 ) ç»™ç±»èµ·åï¼š import java.util. {ArrayList=&gt;JL}</p><p>5 ) å¯¼å…¥ç›¸åŒåŒ…çš„å¤šä¸ªç±»ï¼šimport java.util. {HashSet, ArrayList}</p><p>6 )å±è”½ç±»ï¼š import java.util. {ArrayList =&gt;<em>,</em>}</p><p>7 ) å¯¼å…¥åŒ…çš„ç»å¯¹è·¯å¾„ï¼š new _root_.java.util.HashMap</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">java</span> <span class="token punctuation">{</span>  <span class="token keyword">package</span> <span class="token namespace">util</span> <span class="token punctuation">{</span>    <span class="token keyword">class</span> HashMap <span class="token punctuation">{</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>import com.kk.Fruit</th><th>å¼•å…¥ com.kk åŒ…ä¸‹ Fruit (class å’Œ object)</th></tr></thead><tbody><tr><td>import com.kk._</td><td>å¼•å…¥ com.kk ä¸‹çš„æ‰€æœ‰æˆå‘˜</td></tr><tr><td>import com.kk.Fruit._</td><td>å¼•å…¥ Fruit(object)çš„æ‰€æœ‰æˆå‘˜</td></tr><tr><td>import com.kk. {Fruit,Vegetable}</td><td>å¼•å…¥ com.kk ä¸‹çš„ Fruit å’Œ Vegetable</td></tr><tr><td>import com.kk. {Fruit=&gt;Shuiguo}</td><td>å¼•å…¥ com.kk åŒ…ä¸‹çš„ Fruit å¹¶æ›´åä¸º Shuiguo</td></tr><tr><td>import com.kk. {Fruit=&gt;Shuiguo,_}</td><td>å¼•å…¥ com.kk åŒ…ä¸‹çš„æ‰€æœ‰æˆå‘˜ï¼Œå¹¶å°† Fruit æ›´åä¸º Shuiguo</td></tr><tr><td>import com.kk. {Fruit=&gt;<em>,</em>}</td><td>å¼•å…¥ com.kkåŒ…ä¸‹å±è”½ Fruit ç±»</td></tr><tr><td>new _root_.java.util.HashMap</td><td>å¼•å…¥çš„ Java çš„ç»å¯¹è·¯å¾„</td></tr></tbody></table><p>Scala ä¸­çš„ä¸‰ä¸ªé»˜è®¤å¯¼å…¥åˆ†åˆ«æ˜¯</p><p><strong>import</strong> <strong>java.lang._</strong></p><p><strong>import</strong> <strong>scala._</strong></p><p><strong>import</strong> <strong>scala</strong>.<strong>Predef.</strong></p><h3 id="2ã€ç±»å’Œå¯¹è±¡"><a href="#2ã€ç±»å’Œå¯¹è±¡" class="headerlink" title="2ã€ç±»å’Œå¯¹è±¡"></a>2ã€ç±»å’Œå¯¹è±¡</h3><p>ç±» ï¼šå¯ä»¥çœ‹æˆä¸€ä¸ªæ¨¡æ¿</p><p>å¯¹è±¡ ï¼šè¡¨ç¤ºå…·ä½“çš„äº‹ç‰©</p><h4 id="1ã€å®šä¹‰ç±»"><a href="#1ã€å®šä¹‰ç±»" class="headerlink" title="1ã€å®šä¹‰ç±»"></a>1ã€å®šä¹‰ç±»</h4><p>ä¸€èˆ¬ ï¼Œä¸€ä¸ª.java æœ‰ä¸€ä¸ª public ç±»</p><p><font color="red">Scala ä¸­æ²¡æœ‰public ï¼Œä¸€ä¸ª.scala ä¸­å¯ä»¥å†™å¤šä¸ªç±»</font></p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token comment">// ( 1 ) Scala è¯­æ³•ä¸­ï¼Œç±»å¹¶ä¸å£°æ˜ä¸º public ï¼Œæ‰€æœ‰è¿™äº›ç±»éƒ½å…·æœ‰å…¬æœ‰å¯è§æ€§(å³é»˜ è®¤å°±æ˜¯ public )</span><span class="token keyword">class</span> Person <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">// ( 2 )ä¸€ä¸ª Scala æºæ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªç±»</span><span class="token keyword">class</span> Teacher <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€å±æ€§"><a href="#2ã€å±æ€§" class="headerlink" title="2ã€å±æ€§"></a>2ã€å±æ€§</h4><p><strong>[**ä¿®é¥°ç¬¦</strong>]<strong>**var</strong>|<strong>val</strong>  å±æ€§åç§°  <strong>[</strong> ï¼šç±»å‹<strong>]=</strong>  å±æ€§å€¼</p><p>æ³¨ ï¼šBean å±æ€§(@BeanPropetry)ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆè§„èŒƒçš„ setXxx/getXxx æ–¹æ³•</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo6</span><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span>BeanProperty<span class="token keyword">class</span> Person <span class="token punctuation">{</span>  <span class="token keyword">var</span> name<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"bobo"</span> <span class="token comment">//å®šä¹‰å±æ€§</span>  <span class="token keyword">var</span> age<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> _ <span class="token comment">// _è¡¨ç¤ºç»™å±æ€§ä¸€ä¸ªé»˜è®¤å€¼</span>  <span class="token comment">//Bean å±æ€§( @BeanProperty)</span>  <span class="token annotation punctuation">@BeanProperty</span> <span class="token keyword">var</span> sex<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"ç”·"</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> Person<span class="token punctuation">(</span><span class="token punctuation">)</span>    println<span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span>    person<span class="token punctuation">.</span>setSex<span class="token punctuation">(</span><span class="token string">"å¥³"</span><span class="token punctuation">)</span>    println<span class="token punctuation">(</span>person<span class="token punctuation">.</span>getSex<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€æ–¹æ³•"><a href="#3ã€æ–¹æ³•" class="headerlink" title="3ã€æ–¹æ³•"></a>3ã€æ–¹æ³•</h4><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span> Person <span class="token punctuation">{</span>  <span class="token keyword">def</span> sum<span class="token punctuation">(</span>n1<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> n2<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    n1 <span class="token operator">+</span> n2  <span class="token punctuation">}</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token keyword">val</span> person <span class="token operator">=</span> <span class="token keyword">new</span> Person<span class="token punctuation">(</span><span class="token punctuation">)</span>      println<span class="token punctuation">(</span>person<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€åˆ›å»ºå¯¹è±¡"><a href="#4ã€åˆ›å»ºå¯¹è±¡" class="headerlink" title="4ã€åˆ›å»ºå¯¹è±¡"></a>4ã€åˆ›å»ºå¯¹è±¡</h4><p><strong>val</strong> <strong>|</strong> <strong>var</strong> å¯¹è±¡å  <strong>[</strong> ï¼šç±»å‹<strong>]</strong>    <strong>=</strong> <strong>new</strong>  ç±»å‹<strong>()</strong></p><p>â€‹    ( 1 ) val ä¿®é¥°å¯¹è±¡ï¼Œä¸èƒ½æ”¹å˜å¯¹è±¡çš„å¼•ç”¨( å³ï¼šå†…å­˜åœ°å€)  ï¼Œå¯ä»¥æ”¹å˜å¯¹è±¡å±æ€§çš„å€¼ã€‚</p><p>â€‹    ( 2 ) var ä¿®é¥°å¯¹è±¡ï¼Œ å¯ä»¥ä¿®æ”¹å¯¹è±¡çš„å¼•ç”¨å’Œä¿®æ”¹å¯¹è±¡çš„å±æ€§å€¼</p><p>â€‹    ( 3 ) è‡ªåŠ¨æ¨å¯¼å˜é‡ç±»å‹ä¸èƒ½å¤šæ€ï¼Œæ‰€ä»¥å¤šæ€éœ€è¦æ˜¾ç¤ºå£°æ˜</p><h4 id="5ã€æ„é€ å™¨"><a href="#5ã€æ„é€ å™¨" class="headerlink" title="5ã€æ„é€ å™¨"></a>5ã€æ„é€ å™¨</h4><p>å’Œ Java ä¸€æ ·ï¼ŒScala æ„é€ å¯¹è±¡ä¹Ÿéœ€è¦è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥æœ‰ä»»æ„å¤šä¸ªæ„é€ æ–¹æ³•ã€‚</p><p>Scala ç±»çš„æ„é€ å™¨åŒ…æ‹¬ï¼š<strong>ä¸»æ„é€ å™¨å’Œè¾…åŠ©æ„é€ å™¨</strong></p><p>è¯­æ³•ï¼š</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span>  ç±»å<span class="token punctuation">(</span>å½¢å‚åˆ—è¡¨<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//  ä¸»æ„é€ å™¨</span>  <span class="token comment">//  ç±»ä½“</span>  <span class="token keyword">def</span>   <span class="token keyword">this</span><span class="token punctuation">(</span>å½¢å‚åˆ—è¡¨<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//  è¾…åŠ©æ„é€ å™¨</span>  <span class="token punctuation">}</span>  <span class="token keyword">def</span>   <span class="token keyword">this</span><span class="token punctuation">(</span>å½¢å‚åˆ—è¡¨<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//è¾…åŠ©æ„é€ å™¨å¯ä»¥æœ‰å¤šä¸ª...</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯´æ˜ï¼š</p><p>â€‹    ( 1 )è¾…åŠ©æ„é€ å™¨ ï¼Œå‡½æ•°çš„åç§° this ï¼Œå¯ä»¥æœ‰å¤šä¸ª ï¼Œç¼–è¯‘å™¨é€šè¿‡å‚æ•°çš„ä¸ªæ•°åŠç±»å‹æ¥åŒºåˆ†</p><p>â€‹    ( 2 )è¾…åŠ©æ„é€ æ–¹æ³•ä¸èƒ½ç›´æ¥æ„å»ºå¯¹è±¡ ï¼Œå¿…é¡»ç›´æ¥æˆ–è€…é—´æ¥è°ƒç”¨ä¸»æ„é€ æ–¹æ³•</p><p>â€‹    ( 3 )<font color="red">æ„é€ å™¨è°ƒç”¨å…¶ä»–å¦å¤–çš„æ„é€ å™¨ï¼Œ è¦æ±‚è¢«è°ƒç”¨æ„é€ å™¨å¿…é¡»æå‰å£°æ˜</font></p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo6</span><span class="token keyword">class</span> Person <span class="token punctuation">{</span>  <span class="token keyword">var</span> name<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> _  <span class="token keyword">var</span> age<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> _  <span class="token keyword">def</span> <span class="token keyword">this</span><span class="token punctuation">(</span>age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age    println<span class="token punctuation">(</span><span class="token string">"è¾…åŠ©æ„é€ å™¨"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">def</span> <span class="token keyword">this</span><span class="token punctuation">(</span>age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span><span class="token string">"ä¸»æ„é€ å™¨"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">object</span> Person <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> Person<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ã€æ„é€ å™¨å‚æ•°"><a href="#6ã€æ„é€ å™¨å‚æ•°" class="headerlink" title="6ã€æ„é€ å™¨å‚æ•°"></a>6ã€æ„é€ å™¨å‚æ•°</h4><p>Scala ç±»çš„ä¸»æ„é€ å™¨å‡½æ•°çš„å½¢å‚åŒ…æ‹¬ä¸‰ç§ç±»å‹ï¼šæœªç”¨ä»»ä½•ä¿®é¥°ã€  var ä¿®é¥°ã€  val ä¿®é¥°     </p><p>â€‹    ( 1 )æœªç”¨ä»»ä½•ä¿®é¥°ç¬¦ä¿®é¥°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡</p><p>â€‹    ( 2 ) var ä¿®é¥°å‚æ•°ï¼Œä½œä¸ºç±»çš„æˆå‘˜å±æ€§ä½¿ç”¨ï¼Œå¯ä»¥ä¿®æ”¹</p><p>â€‹    ( 3 ) val ä¿®é¥°å‚æ•°ï¼Œä½œä¸ºç±»åªè¯»å±æ€§ä½¿ç”¨ï¼Œä¸èƒ½ä¿®æ”¹</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> Person<span class="token punctuation">(</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">"ç”·"</span><span class="token punctuation">)</span>  <span class="token comment">// ( 1 )æœªç”¨ä»»ä½•ä¿®é¥°ç¬¦ä¿®é¥°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡</span>   printf<span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment">// ( 2 ) var ä¿®é¥°å‚æ•°ï¼Œä½œä¸ºç±»çš„æˆå‘˜å±æ€§ä½¿ç”¨ï¼Œå¯ä»¥ä¿®æ”¹</span>  person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">19</span>  println<span class="token punctuation">(</span>person<span class="token punctuation">.</span>age<span class="token punctuation">)</span>  <span class="token comment">// ( 3 ) val ä¿®é¥°å‚æ•°ï¼Œä½œä¸ºç±»çš„åªè¯»å±æ€§ä½¿ç”¨ï¼Œä¸èƒ½ä¿®æ”¹</span>  person<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token string">"å¥³"</span>  println<span class="token punctuation">(</span>person<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€ä¸‰ç‰¹æ€§"><a href="#3ã€ä¸‰ç‰¹æ€§" class="headerlink" title="3ã€ä¸‰ç‰¹æ€§"></a>3ã€ä¸‰ç‰¹æ€§</h3><p>java ä¸‰ç‰¹æ€§å’Œscalaä¸‰ç‰¹æ€§æ˜¯ä¸€æ ·çš„ï¼Œåˆ†åˆ«æ˜¯ï¼š<strong>å°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€</strong></p><h4 id="1ã€å°è£…"><a href="#1ã€å°è£…" class="headerlink" title="1ã€å°è£…"></a>1ã€å°è£…</h4><p>å°è£…å°±æ˜¯æŠŠæŠ½è±¡å‡ºçš„æ•°æ®å’Œå¯¹æ•°æ®çš„æ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œæ•°æ®è¢«ä¿æŠ¤åœ¨å†…éƒ¨ï¼Œç¨‹åºçš„å…¶å®ƒ éƒ¨åˆ†åªæœ‰é€šè¿‡è¢«æˆæƒçš„æ“ä½œ(æˆå‘˜æ–¹æ³•)ï¼Œæ‰èƒ½å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚  Java å°è£…æ“ä½œå¦‚ä¸‹ï¼Œ</p><p>â€‹    ( 1 )å°†å±æ€§è¿›è¡Œç§æœ‰åŒ–</p><p>â€‹    ( 2 )æä¾›ä¸€ä¸ªå…¬å…±çš„ set æ–¹æ³•ï¼Œç”¨äºå¯¹å±æ€§èµ‹å€¼</p><p>â€‹    ( 3 )æä¾›ä¸€ä¸ªå…¬å…±çš„ get æ–¹æ³•ï¼Œç”¨äºè·å–å±æ€§çš„å€¼</p><p>Scala ä¸­çš„ public å±æ€§ï¼Œåº•å±‚<font color="red">å®é™…ä¸º private</font> ï¼Œå¹¶é€šè¿‡ get æ–¹æ³•(obj.field())å’Œ set æ–¹æ³•     (obj.field_=(value))å¯¹å…¶è¿›è¡Œæ“ä½œã€‚æ‰€ä»¥ Scala å¹¶ä¸æ¨èå°†å±æ€§è®¾ä¸º private ï¼Œå†ä¸ºå…¶è®¾ç½® public çš„ get å’Œ set æ–¹æ³•çš„åšæ³•ã€‚ä½†ç”±äºå¾ˆå¤š Java æ¡†æ¶éƒ½åˆ©ç”¨åå°„è°ƒç”¨ getXXX å’Œ setXXX æ–¹ æ³•ï¼Œæœ‰æ—¶å€™ä¸ºäº†å’Œè¿™äº›æ¡†æ¶å…¼å®¹ï¼Œä¹Ÿä¼šä¸º Scala çš„å±æ€§è®¾ç½® getXXX å’Œ setXXX æ–¹æ³•(é€šè¿‡ <font color="red">@BeanProperty</font> æ³¨è§£å®ç°)ã€‚</p><p><strong>è®¿é—®æƒé™ï¼š</strong></p><p>åœ¨ Java ä¸­ï¼Œè®¿é—®æƒé™åˆ†ä¸ºï¼špublicï¼Œprivateï¼Œprotected å’Œé»˜è®¤ã€‚åœ¨ Scala ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ç±»ä¼¼çš„ä¿®é¥°ç¬¦è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚ä½†æ˜¯ä½¿ç”¨ä¸Šæœ‰åŒºåˆ«ã€‚ </p><p>ï¼ˆ1ï¼‰Scala ä¸­å±æ€§å’Œæ–¹æ³•çš„é»˜è®¤è®¿é—®æƒé™ä¸º publicï¼Œä½† Scala ä¸­æ—  public å…³é”®å­—ã€‚ </p><p>ï¼ˆ2ï¼‰private ä¸ºç§æœ‰æƒé™ï¼Œåªåœ¨ç±»çš„å†…éƒ¨å’Œä¼´ç”Ÿå¯¹è±¡ä¸­å¯ç”¨ã€‚ </p><p>ï¼ˆ3ï¼‰<font color="red">protected ä¸ºå—ä¿æŠ¤æƒé™ï¼ŒScala ä¸­å—ä¿æŠ¤æƒé™æ¯” Java ä¸­æ›´ä¸¥æ ¼ï¼ŒåŒç±»ã€å­ç±»å¯ä»¥è®¿é—®ï¼ŒåŒåŒ…æ— æ³•è®¿é—®</font></p><p>ï¼ˆ4ï¼‰<font color="red">private[åŒ…å]å¢åŠ åŒ…è®¿é—®æƒé™ï¼ŒåŒ…åä¸‹çš„å…¶ä»–ç±»ä¹Ÿå¯ä»¥ä½¿ç”¨ </font></p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo6</span><span class="token keyword">class</span> Person <span class="token punctuation">{</span>  <span class="token keyword">private</span> <span class="token keyword">var</span> name<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"bobo"</span>  <span class="token keyword">protected</span> <span class="token keyword">var</span> age<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">18</span>  <span class="token keyword">private</span><span class="token punctuation">[</span>demo6<span class="token punctuation">]</span> <span class="token keyword">var</span> sex<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"ç”·"</span>  <span class="token keyword">def</span> say<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>name<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">object</span> Person <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> person <span class="token operator">=</span> <span class="token keyword">new</span> Person    person<span class="token punctuation">.</span>say<span class="token punctuation">(</span><span class="token punctuation">)</span>    println<span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span>    println<span class="token punctuation">(</span>person<span class="token punctuation">.</span>age<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> Teacher <span class="token keyword">extends</span> Person <span class="token punctuation">{</span>  <span class="token keyword">def</span> test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age    <span class="token keyword">this</span><span class="token punctuation">.</span>sex  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> Animal <span class="token punctuation">{</span>  <span class="token keyword">def</span> test<span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">new</span> Person<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sex  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€ç»§æ‰¿å’Œå¤šæ€"><a href="#2ã€ç»§æ‰¿å’Œå¤šæ€" class="headerlink" title="2ã€ç»§æ‰¿å’Œå¤šæ€"></a>2ã€ç»§æ‰¿å’Œå¤šæ€</h4><p><strong>ç»§æ‰¿ï¼š</strong></p><p><strong>class</strong> <strong>å­ç±»å</strong> <strong>extends</strong> <strong>çˆ¶ç±»å</strong> <strong>{</strong> <strong>ç±»ä½“</strong> <strong>}</strong></p><ul><li>å­ç±»ç»§æ‰¿çˆ¶ç±»çš„<strong>å±æ€§</strong>å’Œ<strong>æ–¹æ³•</strong></li><li>scala æ˜¯å•ç»§æ‰¿</li><li>ç»§æ‰¿çš„è°ƒç”¨é¡ºåºï¼šçˆ¶ç±»æ„é€ å™¨-&gt;å­ç±»æ„é€ å™¨</li></ul><p><strong>åŠ¨æ€ç»‘å®šï¼š</strong>Scala ä¸­å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯åŠ¨æ€ç»‘å®šï¼Œè€Œ Java ä¸­åªæœ‰æ–¹æ³•ä¸ºåŠ¨æ€ç»‘å®š</p><p>é‡å†™ï¼šjava å’Œ scalaåŒºåˆ«</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span> Person <span class="token punctuation">{</span>  <span class="token keyword">val</span> name<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"person"</span>  <span class="token keyword">def</span> hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"hello person"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> Teacher <span class="token keyword">extends</span> Person <span class="token punctuation">{</span>  <span class="token keyword">override</span> <span class="token keyword">val</span> name<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"teacher"</span>  <span class="token keyword">override</span> <span class="token keyword">def</span> hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"hello teacher"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">object</span> Test <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> teacher<span class="token operator">:</span> Teacher <span class="token operator">=</span> <span class="token keyword">new</span> Teacher<span class="token punctuation">(</span><span class="token punctuation">)</span>    println<span class="token punctuation">(</span>teacher<span class="token punctuation">.</span>name<span class="token punctuation">)</span>    teacher<span class="token punctuation">.</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> teacher1<span class="token operator">:</span> Person <span class="token operator">=</span> <span class="token keyword">new</span> Teacher    println<span class="token punctuation">(</span>teacher1<span class="token punctuation">.</span>name<span class="token punctuation">)</span>    teacher1<span class="token punctuation">.</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>scala æ‰“å°</p><pre class="line-numbers language-print" data-language="print"><code class="language-print">teacherhello teacherteacherhello teacher<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>java æ‰“å°</p><pre class="line-numbers language-print" data-language="print"><code class="language-print">teacherhello teacherpersonhello teacher<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4ã€æŠ½è±¡ç±»"><a href="#4ã€æŠ½è±¡ç±»" class="headerlink" title="4ã€æŠ½è±¡ç±»"></a>4ã€æŠ½è±¡ç±»</h3><h4 id="1ã€å±æ€§å’Œæ–¹æ³•"><a href="#1ã€å±æ€§å’Œæ–¹æ³•" class="headerlink" title="1ã€å±æ€§å’Œæ–¹æ³•"></a>1ã€å±æ€§å’Œæ–¹æ³•</h4><p><strong>1ã€åŸºæœ¬è¯­æ³•</strong></p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>å®šä¹‰æŠ½è±¡ç±»ï¼š <span class="token keyword">abstract</span> <span class="token keyword">class</span> Person<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">//é€šè¿‡ abstract å…³é”®å­—æ ‡è®°æŠ½è±¡ç±»</span>â€‹<span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span>å®šä¹‰æŠ½è±¡å±æ€§ï¼š<span class="token keyword">val</span><span class="token operator">|</span><span class="token keyword">var</span> name<span class="token operator">:</span><span class="token builtin">String</span> <span class="token comment">//ä¸€ä¸ªå±æ€§æ²¡æœ‰åˆå§‹åŒ–ï¼Œå°±æ˜¯æŠ½è±¡å±æ€§</span>â€‹<span class="token punctuation">(</span> <span class="token number">3</span> <span class="token punctuation">)</span>å®šä¹‰æŠ½è±¡æ–¹æ³•ï¼š<span class="token keyword">def</span>   hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">String</span> <span class="token comment">//åªå£°æ˜è€Œæ²¡æœ‰å®ç°çš„æ–¹æ³•ï¼Œå°±æ˜¯æŠ½è±¡æ–¹æ³•</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2ã€ç»§æ‰¿ &amp; é‡å†™</strong></p><p>â€‹    ( 1 ) å¦‚æœçˆ¶ç±»ä¸ºæŠ½è±¡ç±»ï¼Œé‚£ä¹ˆå­ç±»éœ€è¦å°†æŠ½è±¡çš„å±æ€§å’Œæ–¹æ³•å®ç°ï¼Œå¦åˆ™å­ç±»ä¹Ÿéœ€å£°æ˜ ä¸ºæŠ½è±¡ç±»</p><p>â€‹    ( 2 ) é‡å†™éæŠ½è±¡æ–¹æ³•éœ€è¦ç”¨ override ä¿®é¥°ï¼Œé‡å†™æŠ½è±¡æ–¹æ³•åˆ™å¯ä»¥ä¸åŠ  overrideã€‚</p><p>â€‹    ( 3 ) å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ä½¿ç”¨ super å…³é”®å­—</p><p>â€‹    ( 4 ) å­ç±»å¯¹æŠ½è±¡å±æ€§è¿›è¡Œå®ç°ï¼Œçˆ¶ç±»æŠ½è±¡å±æ€§å¯ä»¥ç”¨ var ä¿®é¥°ï¼›</p><p>  ï¼ˆ 5 ï¼‰å­ç±»å¯¹éæŠ½è±¡å±æ€§é‡å†™ ï¼Œçˆ¶ç±»éæŠ½è±¡å±æ€§åªæ”¯æŒ val ç±»å‹ï¼Œè€Œä¸æ”¯æŒ var</p><h4 id="2ã€åŒ¿åå­ç±»"><a href="#2ã€åŒ¿åå­ç±»" class="headerlink" title="2ã€åŒ¿åå­ç±»"></a>2ã€åŒ¿åå­ç±»</h4><p>å’Œ Java ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡åŒ…å«å¸¦æœ‰å®šä¹‰æˆ–é‡å†™çš„ä»£ç å—çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªåŒ¿åçš„å­ç±»</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">abstract</span> <span class="token keyword">class</span> Person <span class="token punctuation">{</span>  <span class="token keyword">val</span> name<span class="token operator">:</span> <span class="token builtin">String</span>  <span class="token keyword">def</span> hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span><span class="token punctuation">}</span><span class="token keyword">object</span> Test <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> person <span class="token operator">=</span> <span class="token keyword">new</span> Person <span class="token punctuation">{</span>      <span class="token keyword">override</span> <span class="token keyword">val</span> name<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"teacher"</span>      <span class="token keyword">override</span> <span class="token keyword">def</span> hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> println<span class="token punctuation">(</span><span class="token string">"hello teacher"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5ã€å•ä¾‹å¯¹è±¡ï¼ˆä¼´ç”Ÿå¯¹è±¡ï¼‰"><a href="#5ã€å•ä¾‹å¯¹è±¡ï¼ˆä¼´ç”Ÿå¯¹è±¡ï¼‰" class="headerlink" title="5ã€å•ä¾‹å¯¹è±¡ï¼ˆä¼´ç”Ÿå¯¹è±¡ï¼‰"></a>5ã€å•ä¾‹å¯¹è±¡ï¼ˆä¼´ç”Ÿå¯¹è±¡ï¼‰</h3><p>Scalaè¯­è¨€æ˜¯<font color="red">å®Œå…¨é¢å‘å¯¹è±¡</font>çš„è¯­è¨€ ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰é™æ€çš„æ“ä½œ ( å³åœ¨Scalaä¸­æ²¡æœ‰é™æ€çš„æ¦‚å¿µ) ã€‚ä½†æ˜¯ä¸ºäº†èƒ½å¤Ÿå’ŒJavaè¯­è¨€äº¤äº’(å› ä¸ºJavaä¸­æœ‰é™æ€æ¦‚å¿µ)ï¼Œå°±äº§ç”Ÿäº†ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡æ¥<font color="red">æ¨¡æ‹Ÿç±»å¯¹è±¡</font> ï¼Œè¯¥å¯¹è±¡ä¸º<font color="red">å•ä¾‹å¯¹è±¡</font>ã€‚è‹¥å•ä¾‹å¯¹è±¡åä¸ç±»åä¸€è‡´ï¼Œåˆ™ç§°è¯¥å•ä¾‹å¯¹è±¡è¿™ä¸ªç±»çš„<font color="red">ä¼´ç”Ÿå¯¹è±¡</font> ï¼Œè¿™ä¸ªç±»çš„æ‰€æœ‰â€œé™æ€â€å†…å®¹éƒ½å¯ä»¥<font color="red">æ”¾ç½®åœ¨å®ƒçš„ä¼´ç”Ÿå¯¹è±¡ä¸­å£°æ˜</font></p><h4 id="1ã€å•ä¾‹å¯¹è±¡è¯­æ³•"><a href="#1ã€å•ä¾‹å¯¹è±¡è¯­æ³•" class="headerlink" title="1ã€å•ä¾‹å¯¹è±¡è¯­æ³•"></a>1ã€å•ä¾‹å¯¹è±¡è¯­æ³•</h4><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">object</span> TestScala <span class="token punctuation">{</span>  <span class="token keyword">val</span> context<span class="token operator">:</span><span class="token builtin">String</span><span class="token operator">=</span><span class="token string">"obj"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>â€‹    ( 1 )å•ä¾‹å¯¹è±¡é‡‡ç”¨ object å…³é”®å­—å£°æ˜</p><p>â€‹    ( 2 )å•ä¾‹å¯¹è±¡å¯¹åº”çš„ç±»ç§°ä¹‹ä¸ºä¼´ç”Ÿç±» ï¼Œä¼´ç”Ÿå¯¹è±¡çš„åç§°åº”è¯¥å’Œä¼´ç”Ÿç±»åä¸€è‡´ã€‚</p><p>â€‹    ( 3 )å•ä¾‹å¯¹è±¡ä¸­çš„å±æ€§å’Œæ–¹æ³•éƒ½å¯ä»¥é€šè¿‡ä¼´ç”Ÿå¯¹è±¡å(ç±»å)ç›´æ¥è°ƒç”¨è®¿é—®ã€‚</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token comment">//ï¼ˆ1ï¼‰ä¼´ç”Ÿå¯¹è±¡é‡‡ç”¨ object å…³é”®å­—å£°æ˜</span><span class="token keyword">object</span> Person <span class="token punctuation">{</span>  <span class="token keyword">var</span> country<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"China"</span><span class="token punctuation">}</span><span class="token comment">//ï¼ˆ2ï¼‰ä¼´ç”Ÿå¯¹è±¡å¯¹åº”çš„ç±»ç§°ä¹‹ä¸ºä¼´ç”Ÿç±»ï¼Œä¼´ç”Ÿå¯¹è±¡çš„åç§°åº”è¯¥å’Œä¼´ç”Ÿç±»åä¸€è‡´ã€‚</span><span class="token keyword">class</span> Person <span class="token punctuation">{</span>  <span class="token keyword">var</span> name<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"bobo"</span><span class="token punctuation">}</span><span class="token keyword">object</span> Test <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment">//ï¼ˆ3ï¼‰ä¼´ç”Ÿå¯¹è±¡ä¸­çš„å±æ€§å’Œæ–¹æ³•éƒ½å¯ä»¥é€šè¿‡ä¼´ç”Ÿå¯¹è±¡åï¼ˆç±»åï¼‰ç›´æ¥è°ƒç”¨è®¿é—®ã€‚</span>    println<span class="token punctuation">(</span>Person<span class="token punctuation">.</span>country<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºï¼šChina<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€apply-æ–¹æ³•"><a href="#2ã€apply-æ–¹æ³•" class="headerlink" title="2ã€apply æ–¹æ³•"></a>2ã€<strong>apply</strong> æ–¹æ³•</h4><p>â€‹    ( 1 )é€šè¿‡ä¼´ç”Ÿå¯¹è±¡çš„ apply æ–¹æ³•ï¼Œå®ç°ä¸ä½¿ç”¨ new æ–¹æ³•åˆ›å»ºå¯¹è±¡</p><p>â€‹    ( 2 )å¦‚æœæƒ³è®©ä¸»æ„é€ å™¨å˜æˆç§æœ‰çš„ï¼Œå¯ä»¥åœ¨()ä¹‹å‰åŠ ä¸Šprivate</p><p>â€‹    ( 3 ) apply æ–¹æ³•å¯ä»¥é‡è½½</p><p>â€‹    ( 4 ) Scala ä¸­ <strong>obj(arg)**çš„è¯­å¥å®é™…æ˜¯åœ¨è°ƒç”¨è¯¥å¯¹è±¡çš„ **apply</strong> æ–¹æ³•ï¼Œå³ obj.apply(arg)ã€‚ç”¨ä»¥ç»Ÿä¸€é¢å‘å¯¹è±¡ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹çš„é£æ ¼</p><p>â€‹    ( 5 )å½“ä½¿ç”¨ new å…³é”®å­—æ„å»ºå¯¹è±¡æ—¶ï¼Œè°ƒç”¨çš„å…¶å®æ˜¯ç±»çš„æ„é€ æ–¹æ³•ï¼Œå½“ç›´æ¥ä½¿ç”¨ç±»åæ„ å»ºå¯¹è±¡æ—¶ï¼Œè°ƒç”¨çš„å…¶å®æ—¶ä¼´ç”Ÿå¯¹è±¡çš„ apply æ–¹æ³•</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token comment">//ï¼ˆ2ï¼‰å¦‚æœæƒ³è®©ä¸»æ„é€ å™¨å˜æˆç§æœ‰çš„ï¼Œå¯ä»¥åœ¨()ä¹‹å‰åŠ ä¸Š private</span><span class="token keyword">class</span> Person <span class="token keyword">private</span><span class="token punctuation">(</span>cName<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> name<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> cName<span class="token operator">+</span><span class="token string">"_qq"</span><span class="token punctuation">}</span><span class="token keyword">object</span> Person <span class="token punctuation">{</span>  <span class="token keyword">def</span> apply<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"apply ç©ºå‚è¢«è°ƒç”¨"</span><span class="token punctuation">)</span>    <span class="token keyword">new</span> Person<span class="token punctuation">(</span><span class="token string">"xx"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">def</span> apply<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"apply æœ‰å‚è¢«è°ƒç”¨"</span><span class="token punctuation">)</span>    <span class="token keyword">new</span> Person<span class="token punctuation">(</span>name<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">object</span> Test <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment">//ï¼ˆ1ï¼‰é€šè¿‡ä¼´ç”Ÿå¯¹è±¡çš„ apply æ–¹æ³•ï¼Œå®ç°ä¸ä½¿ç”¨ new å…³é”®å­—åˆ›å»ºå¯¹è±¡ã€‚</span>    <span class="token keyword">val</span> p1 <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token punctuation">)</span>    println<span class="token punctuation">(</span><span class="token string">"p1.name="</span> <span class="token operator">+</span> p1<span class="token punctuation">.</span>name<span class="token punctuation">)</span>    <span class="token keyword">val</span> p2 <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">"bobo"</span><span class="token punctuation">)</span>    println<span class="token punctuation">(</span><span class="token string">"p2.name="</span> <span class="token operator">+</span> p2<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºï¼š<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>apply ç©ºå‚è¢«è°ƒç”¨p1<span class="token punctuation">.</span>name<span class="token operator">=</span>xx_qqapply æœ‰å‚è¢«è°ƒç”¨p2<span class="token punctuation">.</span>name<span class="token operator">=</span>bobo_qq<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6ã€ç‰¹è´¨ï¼ˆTraitï¼‰"><a href="#6ã€ç‰¹è´¨ï¼ˆTraitï¼‰" class="headerlink" title="6ã€ç‰¹è´¨ï¼ˆTraitï¼‰"></a>6ã€ç‰¹è´¨ï¼ˆTraitï¼‰</h3><ul><li>Scala è¯­è¨€ä¸­ï¼Œé‡‡ç”¨ç‰¹è´¨ trait (ç‰¹å¾)æ¥<font color="red">ä»£æ›¿æ¥å£</font>çš„æ¦‚å¿µ ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¤šä¸ªç±»å…·æœ‰ç›¸åŒçš„ç‰¹è´¨(ç‰¹å¾)æ—¶ï¼Œå°±å¯ä»¥å°†è¿™ä¸ªç‰¹è´¨(ç‰¹å¾)ç‹¬ç«‹å‡ºæ¥ï¼Œé‡‡ç”¨å…³é”®å­— trait å£°æ˜</li><li>Scala ä¸­çš„ trait ä¸­å³<font color="red">å¯ä»¥æœ‰æŠ½è±¡å±æ€§å’Œæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æœ‰å…·ä½“çš„å±æ€§å’Œæ–¹æ³• ï¼Œä¸€ä¸ªç±»å¯ä»¥æ··å…¥(mixin)å¤šä¸ªç‰¹è´¨ã€‚ç±»ä¼¼äº Java ä¸­çš„æŠ½è±¡ç±»</font></li><li>Scala å¼•å…¥ trait ç‰¹å¾ï¼Œ<font color="red">ç¬¬ä¸€å¯ä»¥æ›¿ä»£ Java çš„æ¥å£ï¼Œç¬¬äºŒä¸ªä¹Ÿæ˜¯å¯¹å•ç»§æ‰¿æœºåˆ¶çš„ä¸€ç§è¡¥å……</font></li></ul><h4 id="1ã€ç‰¹è´¨å£°æ˜"><a href="#1ã€ç‰¹è´¨å£°æ˜" class="headerlink" title="1ã€ç‰¹è´¨å£°æ˜"></a>1ã€ç‰¹è´¨å£°æ˜</h4><p><strong><font color="red">é€šè¿‡æŸ¥çœ‹å­—èŠ‚ç ï¼Œå¯ä»¥çœ‹åˆ°ç‰¹è´¨=æŠ½è±¡ç±»+æ¥å£</font></strong></p><p>1ã€è¯­æ³•</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">trait</span> ç‰¹è´¨å <span class="token punctuation">{</span><span class="token keyword">trait</span> ä¸»ä½“<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>2ã€æ¡ˆä¾‹</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">trait</span> PersonTrait <span class="token punctuation">{</span>  <span class="token comment">// å£°æ˜å±æ€§</span>  <span class="token keyword">var</span> name<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> _  <span class="token comment">// å£°æ˜æ–¹æ³•</span>  <span class="token keyword">def</span> eat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>  <span class="token comment">// æŠ½è±¡å±æ€§</span>  <span class="token keyword">var</span> age<span class="token operator">:</span> <span class="token builtin">Int</span>  <span class="token comment">// æŠ½è±¡æ–¹æ³•</span>  <span class="token keyword">def</span> say<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€ç‰¹è´¨åŸºæœ¬è¯­æ³•"><a href="#2ã€ç‰¹è´¨åŸºæœ¬è¯­æ³•" class="headerlink" title="2ã€ç‰¹è´¨åŸºæœ¬è¯­æ³•"></a>2ã€ç‰¹è´¨åŸºæœ¬è¯­æ³•</h4><p>ä¸€ä¸ªç±»å…·æœ‰æŸç§ç‰¹è´¨ï¼ˆç‰¹å¾ï¼‰ï¼Œå°±æ„å‘³ç€è¿™ä¸ªç±»æ»¡è¶³äº†è¿™ä¸ªç‰¹è´¨ï¼ˆç‰¹å¾ï¼‰çš„æ‰€æœ‰è¦ç´ ï¼Œ æ‰€ä»¥åœ¨ä½¿ç”¨æ—¶ï¼Œä¹Ÿé‡‡ç”¨äº† <font color="red">extends å…³é”®å­—</font>ï¼Œå¦‚æœæœ‰å¤šä¸ªç‰¹è´¨æˆ–å­˜åœ¨çˆ¶ç±»ï¼Œé‚£ä¹ˆéœ€è¦é‡‡ç”¨<font color="red"> with å…³é”®å­—</font>è¿æ¥</p><p>1ã€è¯­æ³•</p><p><strong><font color="red">æ²¡æœ‰çˆ¶ç±»</font>**ï¼šclass ç±»å **extends</strong> ç‰¹è´¨ 1 <strong>with</strong> ç‰¹è´¨ 2 <strong>with</strong> ç‰¹è´¨ 3 â€¦ </p><p><strong><font color="red">æœ‰çˆ¶ç±»</font>**ï¼šclass ç±»å **extends</strong> çˆ¶ç±» <strong>with</strong> ç‰¹è´¨ 1 <strong>with</strong> ç‰¹è´¨ 2 <strong>with</strong> ç‰¹è´¨ 3â€¦ </p><p>2ã€è¯´æ˜</p><p>ï¼ˆ1ï¼‰ç±»å’Œç‰¹è´¨çš„å…³ç³»ï¼šä½¿ç”¨ç»§æ‰¿çš„å…³ç³»ã€‚ </p><p>ï¼ˆ2ï¼‰å½“ä¸€ä¸ªç±»å»ç»§æ‰¿ç‰¹è´¨æ—¶ï¼Œç¬¬ä¸€ä¸ªè¿æ¥è¯æ˜¯ extendsï¼Œåé¢æ˜¯ withã€‚ </p><p>ï¼ˆ3ï¼‰å¦‚æœä¸€ä¸ªç±»åœ¨åŒæ—¶ç»§æ‰¿ç‰¹è´¨å’Œçˆ¶ç±»æ—¶ï¼Œåº”å½“æŠŠçˆ¶ç±»å†™åœ¨ extends åã€‚ </p><p>3ã€æ¡ˆä¾‹</p><ul><li>æ‰€æœ‰çš„ Java æ¥å£éƒ½å¯ä»¥å½“åš Scala ç‰¹è´¨ä½¿ç”¨</li><li><strong>åŠ¨æ€æ··å…¥</strong>ï¼šå¯çµæ´»çš„æ‰©å±•ç±»çš„åŠŸèƒ½<ul><li><strong>åŠ¨æ€æ··å…¥ï¼šåˆ›å»ºå¯¹è±¡æ—¶æ··å…¥</strong> <strong>trait</strong>ï¼Œè€Œæ— éœ€ä½¿ç±»æ··å…¥è¯¥ <strong>trait</strong></li><li>å¦‚æœæ··å…¥çš„ trait ä¸­æœ‰æœªå®ç°çš„æ–¹æ³•ï¼Œåˆ™éœ€è¦å®ç°</li></ul></li></ul><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">trait</span> PersonTrait <span class="token punctuation">{</span>  <span class="token comment">// å£°æ˜å±æ€§</span>  <span class="token keyword">var</span> name<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> _  <span class="token comment">// å£°æ˜æ–¹æ³•</span>  <span class="token keyword">def</span> eat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>  <span class="token comment">// æŠ½è±¡å±æ€§</span>  <span class="token keyword">var</span> age<span class="token operator">:</span> <span class="token builtin">Int</span>  <span class="token comment">// æŠ½è±¡æ–¹æ³•</span>  <span class="token keyword">def</span> say<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span><span class="token punctuation">}</span><span class="token keyword">trait</span> SexTrait <span class="token punctuation">{</span>  <span class="token keyword">var</span> sex<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">}</span><span class="token comment">//ï¼ˆ2ï¼‰ä¸€ä¸ªç±»å¯ä»¥å®ç°/ç»§æ‰¿å¤šä¸ªç‰¹è´¨</span><span class="token comment">//ï¼ˆ3ï¼‰æ‰€æœ‰çš„ Java æ¥å£éƒ½å¯ä»¥å½“åš Scala ç‰¹è´¨ä½¿ç”¨</span><span class="token keyword">class</span> Teacher <span class="token keyword">extends</span> PersonTrait <span class="token keyword">with</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable <span class="token punctuation">{</span>  <span class="token keyword">override</span> <span class="token keyword">def</span> say<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"say"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">override</span> <span class="token keyword">var</span> age<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> _<span class="token punctuation">}</span><span class="token keyword">object</span> TestTrait <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> teacher <span class="token operator">=</span> <span class="token keyword">new</span> Teacher    teacher<span class="token punctuation">.</span>say<span class="token punctuation">(</span><span class="token punctuation">)</span>    teacher<span class="token punctuation">.</span>eat<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">//ï¼ˆ4ï¼‰åŠ¨æ€æ··å…¥ï¼šå¯çµæ´»çš„æ‰©å±•ç±»çš„åŠŸèƒ½</span>    <span class="token keyword">val</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> Teacher <span class="token keyword">with</span> SexTrait <span class="token punctuation">{</span>      <span class="token keyword">override</span> <span class="token keyword">var</span> sex<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"ç”·"</span>    <span class="token punctuation">}</span>    <span class="token comment">//è°ƒç”¨æ··å…¥ trait çš„å±æ€§</span>    println<span class="token punctuation">(</span>t2<span class="token punctuation">.</span>sex<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>è¾“å‡ºï¼šsayç”·<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€ç‰¹è´¨å åŠ "><a href="#3ã€ç‰¹è´¨å åŠ " class="headerlink" title="3ã€ç‰¹è´¨å åŠ "></a>3ã€ç‰¹è´¨å åŠ </h4><p>ç”±äºä¸€ä¸ªç±»å¯ä»¥æ··å…¥å¤šä¸ª traitï¼Œä¸” trait ä¸­å¯ä»¥æœ‰å…·ä½“çš„å±æ€§å’Œæ–¹æ³•ï¼Œè‹¥æ··å…¥çš„ç‰¹è´¨ä¸­å…·æœ‰ç›¸åŒçš„æ–¹æ³•ï¼ˆæ–¹æ³•åï¼Œå‚æ•°åˆ—è¡¨ï¼Œè¿”å›å€¼å‡ç›¸åŒï¼‰ï¼Œå¿…ç„¶ä¼šå‡ºç°ç»§æ‰¿å†²çªé—®é¢˜ã€‚ å†²çªåˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š</p><p>ç¬¬ä¸€ç§ï¼Œä¸€ä¸ªç±»ï¼ˆSubï¼‰æ··å…¥çš„ä¸¤ä¸ª traitï¼ˆTraitAï¼ŒTraitBï¼‰ä¸­å…·æœ‰ç›¸åŒçš„å…·ä½“æ–¹æ³•ï¼Œä¸”ä¸¤ä¸ª trait ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè§£å†³è¿™ç±»å†²çªé—®é¢˜ï¼Œç›´æ¥åœ¨ç±»ï¼ˆSubï¼‰ä¸­é‡å†™å†²çªæ–¹æ³•</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202304142246982.png"></p><p>ç¬¬äºŒç§ï¼Œä¸€ä¸ªç±»ï¼ˆSubï¼‰æ··å…¥çš„ä¸¤ä¸ª traitï¼ˆTraitAï¼ŒTraitBï¼‰ä¸­å…·æœ‰ç›¸åŒçš„å…·ä½“æ–¹æ³•ï¼Œä¸”ä¸¤ä¸ª trait ç»§æ‰¿è‡ªç›¸åŒçš„ traitï¼ˆTraitCï¼‰ï¼ŒåŠæ‰€è°“çš„â€œé’»çŸ³é—®é¢˜â€ï¼Œè§£å†³è¿™ç±»å†²çªé—®é¢˜ï¼ŒScala é‡‡ç”¨äº†<strong>ç‰¹è´¨å åŠ </strong>çš„ç­–ç•¥</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202304142247872.png"></p><p>æ‰€è°“çš„<strong>ç‰¹è´¨å åŠ </strong>ï¼Œå°±æ˜¯å°†æ··å…¥çš„å¤šä¸ª trait ä¸­çš„å†²çªæ–¹æ³•å åŠ èµ·æ¥ï¼Œæ¡ˆä¾‹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">trait</span> Surname <span class="token punctuation">{</span>  <span class="token keyword">def</span> describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"kang"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">trait</span> Name1 <span class="token keyword">extends</span> Surname <span class="token punctuation">{</span>  <span class="token keyword">override</span> <span class="token keyword">def</span> describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"jie-"</span> <span class="token operator">+</span> <span class="token keyword">super</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">trait</span> Name2 <span class="token keyword">extends</span> Surname <span class="token punctuation">{</span>  <span class="token keyword">override</span> <span class="token keyword">def</span> describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"kun-"</span> <span class="token operator">+</span> <span class="token keyword">super</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> MyBall <span class="token keyword">extends</span> Name2 <span class="token keyword">with</span> Name1 <span class="token punctuation">{</span>  <span class="token keyword">override</span> <span class="token keyword">def</span> describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"my name is  "</span> <span class="token operator">+</span> <span class="token keyword">super</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">object</span> TestTrait <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token keyword">new</span> MyBall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>è¾“å‡ºï¼šmy name is  jie<span class="token operator">-</span>kun<span class="token operator">-</span>kang<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€ç‰¹è´¨è‡ªèº«ç±»å‹"><a href="#4ã€ç‰¹è´¨è‡ªèº«ç±»å‹" class="headerlink" title="4ã€ç‰¹è´¨è‡ªèº«ç±»å‹"></a>4ã€ç‰¹è´¨è‡ªèº«ç±»å‹</h4><p>è‡ªèº«ç±»å‹å¯å®ç°ä¾èµ–æ³¨å…¥çš„åŠŸèƒ½</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span> User<span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token keyword">val</span> age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token keyword">trait</span> Dao <span class="token punctuation">{</span>  <span class="token keyword">def</span> insert<span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"insert into database :"</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">trait</span> APP <span class="token punctuation">{</span>  _<span class="token operator">:</span> Dao <span class="token keyword">=&gt;</span>  <span class="token keyword">def</span> login<span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"login :"</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>name<span class="token punctuation">)</span>    insert<span class="token punctuation">(</span>user<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">object</span> MyApp <span class="token keyword">extends</span> APP <span class="token keyword">with</span> Dao <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    login<span class="token punctuation">(</span><span class="token keyword">new</span> User<span class="token punctuation">(</span><span class="token string">"mykk"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>è¾“å‡ºï¼šlogin <span class="token operator">:</span>mykkinsert into database <span class="token operator">:</span>mykk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆæ‰“å°äº†ç»§æ‰¿çš„ï¼Œåœ¨æ‰“å°äº†å®ç°çš„</p><h4 id="5ã€ç‰¹è´¨å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«"><a href="#5ã€ç‰¹è´¨å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«" class="headerlink" title="5ã€ç‰¹è´¨å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«"></a>5ã€ç‰¹è´¨å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«</h4><p>1.ä¼˜å…ˆä½¿ç”¨ç‰¹è´¨ã€‚ä¸€ä¸ªç±»æ‰©å±•å¤šä¸ªç‰¹è´¨æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†å´åªèƒ½æ‰©å±•ä¸€ä¸ªæŠ½è±¡ç±»</p><p>2.å¦‚æœä½ éœ€è¦æ„é€ å‡½æ•°å‚æ•°ï¼Œä½¿ç”¨æŠ½è±¡ç±»ã€‚å› ä¸ºæŠ½è±¡ç±»å¯ä»¥å®šä¹‰<font color="red">å¸¦å‚æ•°çš„æ„é€ å‡½æ•°</font>ï¼Œè€Œç‰¹è´¨ä¸è¡Œï¼ˆæœ‰æ— å‚æ„é€ ï¼‰</p><h3 id="7ã€æ‰©å±•"><a href="#7ã€æ‰©å±•" class="headerlink" title="7ã€æ‰©å±•"></a>7ã€æ‰©å±•</h3><h4 id="1ã€ç±»å‹æ£€æŸ¥å’Œè½¬æ¢"><a href="#1ã€ç±»å‹æ£€æŸ¥å’Œè½¬æ¢" class="headerlink" title="1ã€ç±»å‹æ£€æŸ¥å’Œè½¬æ¢"></a>1ã€<strong>ç±»å‹æ£€æŸ¥å’Œè½¬æ¢</strong></h4><p>æœ‰ç‚¹ç±»ä¼¼äºåå°„çš„é‚£å‡ ä¸ªä½œç”¨</p><p>ï¼ˆ1ï¼‰obj.isInstanceOf[T]ï¼šåˆ¤æ–­ obj æ˜¯ä¸æ˜¯ T ç±»å‹</p><p>ï¼ˆ2ï¼‰obj.asInstanceOf[T]ï¼šå°† obj å¼ºè½¬æˆ T ç±»å‹</p><p>ï¼ˆ3ï¼‰classOf è·å–å¯¹è±¡çš„ç±»å</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span> Person <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">object</span> Person <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> person <span class="token operator">=</span> <span class="token keyword">new</span> Person    <span class="token comment">//ï¼ˆ1ï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæŸä¸ªç±»å‹çš„å®ä¾‹</span>    <span class="token keyword">val</span> bool<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> person<span class="token punctuation">.</span>isInstanceOf<span class="token punctuation">[</span>Person<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">//ï¼ˆ2ï¼‰å°†å¯¹è±¡è½¬æ¢ä¸ºæŸä¸ªç±»å‹çš„å®ä¾‹</span>      <span class="token keyword">val</span> p1<span class="token operator">:</span> Person <span class="token operator">=</span> person<span class="token punctuation">.</span>asInstanceOf<span class="token punctuation">[</span>Person<span class="token punctuation">]</span>      println<span class="token punctuation">(</span>p1<span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">//ï¼ˆ3ï¼‰è·å–ç±»çš„ä¿¡æ¯</span>    <span class="token keyword">val</span> pClass<span class="token operator">:</span> Class<span class="token punctuation">[</span>Person<span class="token punctuation">]</span> <span class="token operator">=</span> classOf<span class="token punctuation">[</span>Person<span class="token punctuation">]</span>    println<span class="token punctuation">(</span>pClass<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€æšä¸¾ç±»å’Œåº”ç”¨ç±»"><a href="#2ã€æšä¸¾ç±»å’Œåº”ç”¨ç±»" class="headerlink" title="2ã€æšä¸¾ç±»å’Œåº”ç”¨ç±»"></a>2ã€<strong>æšä¸¾ç±»å’Œåº”ç”¨ç±»</strong></h4><p>1ã€è¯´æ˜</p><p>æšä¸¾ç±»ï¼šéœ€è¦ç»§æ‰¿ Enumeration </p><p>åº”ç”¨ç±»ï¼šéœ€è¦ç»§æ‰¿ App</p><p>2ã€æ¡ˆä¾‹</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">object</span> Test <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>Color<span class="token punctuation">.</span>RED<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">// æšä¸¾ç±»</span><span class="token keyword">object</span> Color <span class="token keyword">extends</span> Enumeration <span class="token punctuation">{</span>  <span class="token keyword">val</span> RED <span class="token operator">=</span> Value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> YELLOW <span class="token operator">=</span> Value<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> BLUE <span class="token operator">=</span> Value<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">// åº”ç”¨ç±»ï¼šå¯ä»¥ç›´æ¥æ‰“å°ï¼Œåƒmainæ–¹æ³•</span><span class="token keyword">object</span> Test20 <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  println<span class="token punctuation">(</span><span class="token string">"xxxxxxxxxxx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€Type-å®šä¹‰æ–°ç±»å‹"><a href="#3ã€Type-å®šä¹‰æ–°ç±»å‹" class="headerlink" title="3ã€Type å®šä¹‰æ–°ç±»å‹"></a>3ã€<strong>Type</strong> <strong>å®šä¹‰æ–°ç±»å‹</strong></h4><p>ä½¿ç”¨ type å…³é”®å­—å¯ä»¥å®šä¹‰æ–°çš„æ•°æ®æ•°æ®ç±»å‹åç§°ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ç±»å‹çš„ä¸€ä¸ªåˆ«å</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">object</span> Test <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">type</span> S <span class="token operator">=</span> <span class="token builtin">String</span>    <span class="token keyword">var</span> v<span class="token operator">:</span> S <span class="token operator">=</span> <span class="token string">"abc"</span>    <span class="token keyword">def</span> test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> S <span class="token operator">=</span> <span class="token string">"xyz"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å…­ã€é›†åˆ"><a href="#å…­ã€é›†åˆ" class="headerlink" title="å…­ã€é›†åˆ"></a>å…­ã€é›†åˆ</h2><p>1ã€Scala çš„é›†åˆæœ‰ä¸‰å¤§ç±»ï¼šåºåˆ— Seqã€é›† Setã€æ˜ å°„ Mapï¼Œæ‰€æœ‰çš„é›†åˆéƒ½æ‰©å±•è‡ª Iterable ç‰¹è´¨ã€‚ </p><p>2ã€å¯¹äºå‡ ä¹æ‰€æœ‰çš„é›†åˆç±»ï¼ŒScala éƒ½åŒæ—¶æä¾›äº†<strong>å¯å˜</strong>å’Œ<strong>ä¸å¯å˜</strong>çš„ç‰ˆæœ¬ï¼Œåˆ†åˆ«ä½äºä»¥ä¸‹ä¸¤ä¸ªåŒ… </p><ul><li>ä¸å¯å˜é›†åˆï¼šscala.collection.<strong>immutable</strong> </li><li>å¯å˜é›†åˆï¼š scala.collection.<strong>mutable</strong> </li></ul><p>3ã€Scala ä¸å¯å˜é›†åˆï¼Œå°±æ˜¯æŒ‡è¯¥é›†åˆå¯¹è±¡ä¸å¯ä¿®æ”¹ï¼Œæ¯æ¬¡ä¿®æ”¹å°±ä¼šè¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œä¸ä¼šå¯¹åŸå¯¹è±¡è¿›è¡Œä¿®æ”¹ã€‚ç±»ä¼¼äº java ä¸­çš„ String å¯¹è±¡ </p><p>4ã€å¯å˜é›†åˆï¼Œå°±æ˜¯è¿™ä¸ªé›†åˆå¯ä»¥ç›´æ¥å¯¹åŸå¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸ä¼šè¿”å›æ–°çš„å¯¹è±¡ã€‚ç±»ä¼¼äº java ä¸­ StringBuilder å¯¹è±¡</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202304142329151.png"></p><p>1ï¼‰Setã€Map æ˜¯ Java ä¸­ä¹Ÿæœ‰çš„é›†åˆ </p><p>2ï¼‰Seq æ˜¯ Java æ²¡æœ‰çš„ï¼Œæˆ‘ä»¬å‘ç° List å½’å±åˆ° Seq äº†ï¼Œå› æ­¤è¿™é‡Œçš„ List å°±å’Œ Java ä¸æ˜¯åŒä¸€ä¸ª </p><p>æ¦‚å¿µäº† </p><p>3ï¼‰æˆ‘ä»¬å‰é¢çš„ for å¾ªç¯æœ‰ä¸€ä¸ª 1 to 3ï¼Œå°±æ˜¯ IndexedSeq ä¸‹çš„ Range </p><p>4ï¼‰String ä¹Ÿæ˜¯å±äº IndexedSeq </p><p>5ï¼‰æˆ‘ä»¬å‘ç°ç»å…¸çš„æ•°æ®ç»“æ„æ¯”å¦‚ Queue å’Œ Stack è¢«å½’å±åˆ° LinearSeq(çº¿æ€§åºåˆ—) </p><p>6ï¼‰Scala ä¸­çš„ Map ä½“ç³»æœ‰ä¸€ä¸ª SortedMapï¼Œè¯´æ˜ Scala çš„ Map å¯ä»¥æ”¯æŒæ’åº </p><ol start="7"><li>  IndexedSeq å’Œ LinearSeq çš„åŒºåˆ«ï¼š</li></ol><ul><li><strong>IndexedSeq</strong> æ˜¯é€šè¿‡ç´¢å¼•æ¥æŸ¥æ‰¾å’Œå®šä½ï¼Œå› æ­¤é€Ÿåº¦å¿«ï¼Œæ¯”å¦‚ String å°±æ˜¯ä¸€ä¸ªç´¢å¼•é›†åˆï¼Œé€šè¿‡ç´¢å¼•å³å¯å®šä½</li><li><strong>LinearSeq</strong> æ˜¯çº¿å‹çš„ï¼Œå³æœ‰å¤´å°¾çš„æ¦‚å¿µï¼Œè¿™ç§æ•°æ®ç»“æ„ä¸€èˆ¬æ˜¯é€šè¿‡éå†æ¥æŸ¥æ‰¾</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202304142338538.png"></p><h3 id="1ã€æ•°ç»„"><a href="#1ã€æ•°ç»„" class="headerlink" title="1ã€æ•°ç»„"></a>1ã€æ•°ç»„</h3><h4 id="1ã€ä¸å¯å˜æ•°ç»„"><a href="#1ã€ä¸å¯å˜æ•°ç»„" class="headerlink" title="1ã€ä¸å¯å˜æ•°ç»„"></a>1ã€ä¸å¯å˜æ•°ç»„</h4><p><strong>1ã€æ–¹å¼ä¸€ï¼š</strong>val arr1 = new Array[Int](10)</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">object</span> Test01 <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">// 1ã€å®šä¹‰æ•°ç»„</span>  <span class="token keyword">val</span> arr1 <span class="token operator">=</span> <span class="token keyword">new</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>arr1<span class="token punctuation">.</span>length<span class="token punctuation">)</span>  <span class="token comment">// 2ã€èµ‹å€¼</span>  arr1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span>  arr1<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">// 3ã€éå† 1</span>  println<span class="token punctuation">(</span>arr1<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// éå† 2</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> arr1<span class="token punctuation">)</span> print<span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// éå† 3</span>  <span class="token comment">//arr1.foreach(print)</span>  arr1<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> print<span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 4ã€å¢åŠ å…ƒç´ (ç”±äºåˆ›å»ºçš„æ˜¯ä¸å¯å˜æ•°ç»„ï¼Œå¢åŠ å…ƒç´ ï¼Œå…¶å®æ˜¯äº§ç”Ÿæ–°çš„æ•°ç»„</span>  print<span class="token punctuation">(</span>arr1<span class="token punctuation">)</span>  <span class="token keyword">var</span> arr2<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr1 <span class="token operator">:</span><span class="token operator">+</span> <span class="token number">5</span>  print<span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2ã€æ–¹å¼äºŒï¼š</strong></p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> arr1 <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"mykk"</span><span class="token punctuation">)</span>arr1<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>print<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="2ã€å¯å˜æ•°ç»„"><a href="#2ã€å¯å˜æ•°ç»„" class="headerlink" title="2ã€å¯å˜æ•°ç»„"></a>2ã€å¯å˜æ•°ç»„</h4><p>ï¼ˆ1ï¼‰[Any]å­˜æ”¾ä»»æ„æ•°æ®ç±»å‹ </p><p>ï¼ˆ2ï¼‰ArrayBuffer æ˜¯æœ‰åºçš„é›†åˆ</p><p>ï¼ˆ3ï¼‰ArrayBuffer éœ€è¦å¼•å…¥ scala.collection.mutable.ArrayBuffer</p><p>ï¼ˆ4ï¼‰å¢åŠ å…ƒç´ ä½¿ç”¨çš„æ˜¯ append æ–¹æ³•()ï¼Œæ”¯æŒå¯å˜å‚æ•°</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>mutable<span class="token punctuation">.</span></span>ArrayBuffer<span class="token keyword">object</span> Test02 <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">// 1ã€å®šä¹‰</span>  <span class="token keyword">val</span> arr1 <span class="token operator">=</span> ArrayBuffer<span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">// 2ã€éå†</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> arr1<span class="token punctuation">)</span> print<span class="token punctuation">(</span><span class="token string">" "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token string">"arr1.hash="</span> <span class="token operator">+</span> arr1<span class="token punctuation">.</span>hashCode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 3ã€å¢åŠ å…ƒç´ </span>  arr1<span class="token punctuation">.</span>+<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// è¿½åŠ æ•°æ®</span>  arr1<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token comment">// å‘æ•°ç»„æœ€åè¿½åŠ æ•°æ®</span>  arr1<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">// å‘æŒ‡å®šçš„ä½ç½®æ’å…¥æ•°æ®</span>  println<span class="token punctuation">(</span><span class="token string">"arr1.hash="</span> <span class="token operator">+</span> arr1<span class="token punctuation">.</span>hashCode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> arr1<span class="token punctuation">)</span> print<span class="token punctuation">(</span><span class="token string">" "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 4ã€ä¿®æ”¹å…ƒç´ </span>  arr1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">9</span> <span class="token comment">//ä¿®æ”¹ç¬¬ 2 ä¸ªå…ƒç´ çš„å€¼</span><span class="token punctuation">}</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>è¾“å‡ºï¼š <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span>arr1<span class="token punctuation">.</span>hash<span class="token operator">=</span><span class="token number">387518613</span>arr1<span class="token punctuation">.</span>hash<span class="token operator">=</span><span class="token operator">-</span><span class="token number">253706129</span> <span class="token number">7</span> <span class="token number">8</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€ä¸å¯å˜-amp-å¯å˜è½¬æ¢"><a href="#3ã€ä¸å¯å˜-amp-å¯å˜è½¬æ¢" class="headerlink" title="3ã€ä¸å¯å˜ &amp; å¯å˜è½¬æ¢"></a>3ã€ä¸å¯å˜ &amp; å¯å˜è½¬æ¢</h4><p>arr1.toBuffer //<strong>ä¸å¯å˜æ•°ç»„è½¬å¯å˜æ•°ç»„</strong>ï¼Œè¿”å›ä¸€ä¸ªï¼Œæœ¬èº«ä¸å˜</p><p>arr2.toArray //<strong>å¯å˜æ•°ç»„è½¬ä¸å¯å˜æ•°ç»„</strong> ï¼Œè¿”å›ä¸€ä¸ªï¼Œæœ¬èº«ä¸å˜</p><h4 id="4ã€å¤šç»´æ•°ç»„"><a href="#4ã€å¤šç»´æ•°ç»„" class="headerlink" title="4ã€å¤šç»´æ•°ç»„"></a>4ã€å¤šç»´æ•°ç»„</h4><p>1ã€å®šä¹‰</p><p>val arr = Array.ofDim[Double](3,4)</p><p>2ã€æ¡ˆä¾‹</p><p>äºŒç»´æ•°ç»„ä¸­æœ‰ä¸‰ä¸ªä¸€ç»´æ•°ç»„ï¼Œæ¯ä¸ªä¸€ç»´æ•°ç»„ä¸­æœ‰å››ä¸ªå…ƒç´ </p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">object</span> DimArray <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">//ï¼ˆ1ï¼‰åˆ›å»ºäº†ä¸€ä¸ªäºŒç»´æ•°ç»„, æœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ï¼Œå«æœ‰ 4 ä¸ªå…ƒç´ ä¸€ç»´æ•°ç»„()</span>  <span class="token keyword">var</span> arr <span class="token operator">=</span> Array<span class="token punctuation">.</span>ofDim<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ2ï¼‰éå†äºŒç»´æ•°ç»„</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token keyword">&lt;-</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>      print<span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    println<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2ã€Listé›†åˆ"><a href="#2ã€Listé›†åˆ" class="headerlink" title="2ã€Listé›†åˆ"></a>2ã€Listé›†åˆ</h3><h4 id="1ã€ä¸å¯å˜List"><a href="#1ã€ä¸å¯å˜List" class="headerlink" title="1ã€ä¸å¯å˜List"></a>1ã€ä¸å¯å˜List</h4><p>ï¼ˆ1ï¼‰List é»˜è®¤ä¸ºä¸å¯å˜é›†åˆ </p><p>ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ª Listï¼ˆæ•°æ®æœ‰é¡ºåºï¼Œå¯é‡å¤ï¼‰ </p><p>ï¼ˆ3ï¼‰é›†åˆé—´åˆå¹¶ï¼šå°†ä¸€ä¸ªæ•´ä½“æ‹†æˆä¸€ä¸ªä¸€ä¸ªçš„ä¸ªä½“ï¼Œç§°ä¸ºæ‰å¹³åŒ–</p><p>ï¼ˆ4ï¼‰ç©ºé›†åˆå…ƒç´  Nil</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">object</span> TestList1 <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">//ï¼ˆ1ï¼‰List é»˜è®¤ä¸ºä¸å¯å˜é›†åˆ</span>  <span class="token comment">//ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ª Listï¼ˆæ•°æ®æœ‰é¡ºåºï¼Œå¯é‡å¤ï¼‰</span>  <span class="token keyword">val</span> list<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  list<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> print<span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ç©ºé›†åˆ Nil</span>  <span class="token keyword">val</span> list0 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">::</span> <span class="token number">2</span> <span class="token operator">::</span> <span class="token number">3</span> <span class="token operator">::</span> <span class="token number">4</span> <span class="token operator">::</span> Nil  list0<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> print<span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// å¢åŠ å…ƒç´ </span>  <span class="token keyword">val</span> list1 <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">::</span> <span class="token number">6</span> <span class="token operator">::</span> list <span class="token comment">// ::çš„è¿ç®—è§„åˆ™ä»å³å‘å·¦</span>  list1<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> print<span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ ä½ç½®</span>  <span class="token keyword">val</span> list2 <span class="token operator">=</span> list<span class="token punctuation">.</span>+<span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  list2<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> print<span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//å–æŒ‡å®šæ•°æ®</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€å¯å˜-ListBuffer"><a href="#2ã€å¯å˜-ListBuffer" class="headerlink" title="2ã€å¯å˜ ListBuffer"></a>2ã€<strong>å¯å˜</strong> <strong>ListBuffer</strong></h4><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>mutable<span class="token punctuation">.</span></span>ListBuffer<span class="token keyword">object</span> TestList2 <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">// åˆ›å»ºå¯å˜é›†åˆ</span>  <span class="token keyword">var</span> buffer <span class="token operator">=</span> ListBuffer<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment">// å‘é›†åˆä¸­æ·»åŠ æ•°æ®</span>  buffer<span class="token punctuation">.</span>+<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  buffer<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  buffer<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">77</span><span class="token punctuation">)</span><span class="token comment">// åœ¨æ¸¸æ ‡1ä½ç½®å‰é¢åŠ å…¥77</span><span class="token comment">//  buffer.foreach(println)</span>  <span class="token comment">// ä¿®æ”¹</span>  buffer<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">66</span>  buffer<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>  buffer<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span><span class="token punctuation">{</span>print<span class="token punctuation">(</span>x<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// åˆ é™¤</span><span class="token comment">//  buffer.-=(5)</span><span class="token comment">//  buffer.remove(5)</span>  buffer<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span><span class="token punctuation">{</span>print<span class="token punctuation">(</span>x<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€Seté›†åˆ"><a href="#3ã€Seté›†åˆ" class="headerlink" title="3ã€Seté›†åˆ"></a>3ã€Seté›†åˆ</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒScala ä½¿ç”¨çš„æ˜¯ä¸å¯å˜é›†åˆï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å¯å˜é›†åˆï¼Œéœ€è¦å¼• scala.collection.mutable.Set åŒ…</p><h4 id="1ã€ä¸å¯å˜Set"><a href="#1ã€ä¸å¯å˜Set" class="headerlink" title="1ã€ä¸å¯å˜Set"></a>1ã€ä¸å¯å˜Set</h4><p>ï¼ˆ1ï¼‰Set é»˜è®¤æ˜¯ä¸å¯å˜é›†åˆï¼Œæ•°æ®æ— åº </p><p>ï¼ˆ2ï¼‰æ•°æ®ä¸å¯é‡å¤ </p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">object</span> SetTest01 <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">//ï¼ˆ1ï¼‰Set é»˜è®¤æ˜¯ä¸å¯å˜é›†åˆï¼Œæ•°æ®æ— åº</span>  <span class="token keyword">val</span> set <span class="token operator">=</span> Set<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ2ï¼‰æ•°æ®ä¸å¯é‡å¤</span>  <span class="token keyword">val</span> set1 <span class="token operator">=</span> Set<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ3ï¼‰éå†é›†åˆ</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token keyword">&lt;-</span> set1<span class="token punctuation">)</span> <span class="token punctuation">{</span>    print<span class="token punctuation">(</span>x<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡ºï¼š<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token number">5</span> <span class="token number">1</span> <span class="token number">6</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€å¯å˜Set"><a href="#2ã€å¯å˜Set" class="headerlink" title="2ã€å¯å˜Set"></a>2ã€å¯å˜Set</h4><p>åˆ›å»ºå¯å˜é›†åˆ mutable.Set </p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">object</span> SetTest02 <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">//ï¼ˆ1ï¼‰åˆ›å»ºå¯å˜é›†åˆ</span>  <span class="token keyword">val</span> set <span class="token operator">=</span> mutable<span class="token punctuation">.</span>Set<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ3ï¼‰é›†åˆæ·»åŠ å…ƒç´ </span>  set <span class="token operator">+=</span> <span class="token number">8</span>  <span class="token comment">//ï¼ˆ4ï¼‰å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Set</span>  <span class="token keyword">val</span> ints <span class="token operator">=</span> set<span class="token punctuation">.</span>+<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>ints<span class="token punctuation">)</span>  println<span class="token punctuation">(</span>set<span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ5ï¼‰åˆ é™¤æ•°æ®</span>  set <span class="token operator">-=</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// å»æ‰5è¿™ä¸ªå…ƒç´ </span>  println<span class="token punctuation">(</span>set<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>è¾“å‡ºï¼š<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>Set<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>Set<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h3 id="4ã€Mapé›†åˆ"><a href="#4ã€Mapé›†åˆ" class="headerlink" title="4ã€Mapé›†åˆ"></a>4ã€Mapé›†åˆ</h3><h4 id="1ã€ä¸å¯å˜Map"><a href="#1ã€ä¸å¯å˜Map" class="headerlink" title="1ã€ä¸å¯å˜Map"></a>1ã€ä¸å¯å˜Map</h4><p>å¦‚æœ key ä¸å­˜åœ¨ï¼Œè¿”å› è‡ªå®šä¹‰ æ¯”å¦‚ 0 </p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">object</span> MapTest1 <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">//ï¼ˆ1ï¼‰åˆ›å»ºä¸å¯å˜é›†åˆ Map</span>  <span class="token keyword">val</span> map <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">"a"</span> <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"b"</span> <span class="token operator">-&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"c"</span> <span class="token operator">-&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ3ï¼‰è®¿é—®æ•°æ®</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>elem <span class="token keyword">&lt;-</span> map<span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// ä½¿ç”¨ get è®¿é—® map é›†åˆçš„æ•°æ®ï¼Œä¼šè¿”å›ç‰¹æ®Šç±»å‹ Option(é€‰é¡¹):æœ‰å€¼ï¼ˆSomeï¼‰ï¼Œæ— å€¼(None)</span>    print<span class="token punctuation">(</span>elem <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> map<span class="token punctuation">.</span>get<span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">.</span>get <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  println  <span class="token comment">//ï¼ˆ4ï¼‰å¦‚æœ key ä¸å­˜åœ¨ï¼Œè¿”å› 0</span>  println<span class="token punctuation">(</span>map<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>map<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">//ï¼ˆ2ï¼‰å¾ªç¯æ‰“å°</span>  map<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>    print<span class="token punctuation">(</span>kv<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>è¾“å‡ºï¼š<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>a<span class="token operator">=</span><span class="token number">1</span> b<span class="token operator">=</span><span class="token number">2</span> c<span class="token operator">=</span><span class="token number">3</span> <span class="token number">1</span><span class="token number">0</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€å¯å˜Map"><a href="#2ã€å¯å˜Map" class="headerlink" title="2ã€å¯å˜Map"></a>2ã€å¯å˜Map</h4><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>mutable</span><span class="token keyword">object</span> MapTest2 <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">//ï¼ˆ1ï¼‰åˆ›å»ºå¯å˜é›†åˆ</span>  <span class="token keyword">val</span> map <span class="token operator">=</span> mutable<span class="token punctuation">.</span>Map<span class="token punctuation">(</span><span class="token string">"a"</span> <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"b"</span> <span class="token operator">-&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"c"</span> <span class="token operator">-&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ3ï¼‰å‘é›†åˆå¢åŠ æ•°æ®</span>  map<span class="token punctuation">.</span>+<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"d"</span> <span class="token operator">-&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment">// å°†æ•°å€¼ 4 æ·»åŠ åˆ°é›†åˆï¼Œå¹¶æŠŠé›†åˆä¸­åŸå€¼ 1 è¿”å›</span>  <span class="token keyword">val</span> maybeInt<span class="token operator">:</span> Option<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> map<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>maybeInt<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// è®¾ç½®çš„0æ˜¯å¤±è´¥çš„å€¼ï¼ŒæˆåŠŸçš„æ˜¯1</span>  <span class="token comment">//ï¼ˆ4ï¼‰åˆ é™¤æ•°æ®</span>  map<span class="token punctuation">.</span>-<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ5ï¼‰ä¿®æ”¹æ•°æ®</span>  map<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>  map<span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">5</span>  <span class="token comment">//ï¼ˆ2ï¼‰æ‰“å°é›†åˆ</span>  map<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>    print<span class="token punctuation">(</span>kv <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>è¾“å‡ºï¼š<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token number">1</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5ã€å…ƒç»„"><a href="#5ã€å…ƒç»„" class="headerlink" title="5ã€å…ƒç»„"></a>5ã€å…ƒç»„</h3><h4 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h4><p>å…ƒç»„ä¹Ÿæ˜¯å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥å­˜æ”¾å„ç§ç›¸åŒæˆ–ä¸åŒç±»å‹çš„æ•°æ®ã€‚è¯´çš„ç®€å•ç‚¹ï¼Œå°±æ˜¯å°†å¤šä¸ªæ— å…³çš„æ•°æ®å°è£…ä¸ºä¸€ä¸ªæ•´ä½“ï¼Œç§°ä¸ºå…ƒç»„</p><p><strong>æ³¨æ„ï¼šå…ƒç»„ä¸­æœ€å¤§åªèƒ½æœ‰ 22 ä¸ªå…ƒç´ </strong></p><h4 id="2ã€æ¡ˆä¾‹"><a href="#2ã€æ¡ˆä¾‹" class="headerlink" title="2ã€æ¡ˆä¾‹"></a>2ã€æ¡ˆä¾‹</h4><p>ï¼ˆ1ï¼‰å£°æ˜å…ƒç»„çš„æ–¹å¼ï¼š(å…ƒç´  1ï¼Œå…ƒç´  2ï¼Œå…ƒç´  3) </p><p>ï¼ˆ2ï¼‰è®¿é—®å…ƒç»„ </p><p>ï¼ˆ3ï¼‰Map ä¸­çš„é”®å€¼å¯¹å…¶å®å°±æ˜¯å…ƒç»„,åªä¸è¿‡å…ƒç»„çš„å…ƒç´ ä¸ªæ•°ä¸º 2ï¼Œç§°ä¹‹ä¸ºå¯¹å¶ </p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">object</span> TestTuple <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">//ï¼ˆ1ï¼‰å£°æ˜å…ƒç»„çš„æ–¹å¼ï¼š(å…ƒç´  1ï¼Œå…ƒç´  2ï¼Œå…ƒç´  3)</span>  <span class="token comment">//å£°æ˜ä¸€ä¸ª3å…ƒç»„</span>  <span class="token keyword">val</span> tuple<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Boolean</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token string">"mykk"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token comment">//ï¼ˆ2ï¼‰è®¿é—®å…ƒç»„</span>  <span class="token comment">//ï¼ˆ2.1ï¼‰é€šè¿‡å…ƒç´ çš„é¡ºåºè¿›è¡Œè®¿é—®ï¼Œè°ƒç”¨æ–¹å¼ï¼š_é¡ºåºå·</span>  println<span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_1<span class="token punctuation">)</span>  println<span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>  println<span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_3<span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ2.2ï¼‰é€šè¿‡ç´¢å¼•è®¿é—®æ•°æ®</span>  println<span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>productElement<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ2.3ï¼‰é€šè¿‡è¿­ä»£å™¨è®¿é—®æ•°æ®</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>elem <span class="token keyword">&lt;-</span> tuple<span class="token punctuation">.</span>productIterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>    print<span class="token punctuation">(</span>elem <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">//ï¼ˆ3ï¼‰Map ä¸­çš„é”®å€¼å¯¹å…¶å®å°±æ˜¯å…ƒç»„,åªä¸è¿‡å…ƒç»„çš„å…ƒç´ ä¸ªæ•°ä¸º 2ï¼Œç§°ä¹‹ä¸ºå¯¹å¶</span>  <span class="token keyword">val</span> map <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">"a"</span> <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"b"</span> <span class="token operator">-&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"c"</span> <span class="token operator">-&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> map1 <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  map<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>tuple <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_1 <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> tuple<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>è¾“å‡ºï¼š<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token number">40</span>mykk<span class="token boolean">true</span><span class="token number">40</span><span class="token number">40</span> mykk <span class="token boolean">true</span> a<span class="token operator">=</span><span class="token number">1</span>b<span class="token operator">=</span><span class="token number">2</span>c<span class="token operator">=</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6ã€é˜Ÿåˆ—"><a href="#6ã€é˜Ÿåˆ—" class="headerlink" title="6ã€é˜Ÿåˆ—"></a>6ã€é˜Ÿåˆ—</h3><p>Scala ä¹Ÿæä¾›äº†é˜Ÿåˆ—ï¼ˆQueueï¼‰çš„æ•°æ®ç»“æ„ï¼Œé˜Ÿåˆ—çš„ç‰¹ç‚¹å°±æ˜¯å…ˆè¿›å…ˆå‡ºã€‚è¿›é˜Ÿå’Œå‡ºé˜Ÿçš„æ–¹æ³•åˆ†åˆ«ä¸º enqueue å’Œ dequeue</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>mutable</span><span class="token keyword">object</span> TestQueue <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token keyword">val</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> mutable<span class="token punctuation">.</span>Queue<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  queue<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>queue<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>queue<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>queue<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7ã€å¹¶è¡Œé›†åˆ"><a href="#7ã€å¹¶è¡Œé›†åˆ" class="headerlink" title="7ã€å¹¶è¡Œé›†åˆ"></a>7ã€å¹¶è¡Œé›†åˆ</h3><p>Scala ä¸ºäº†å……åˆ†ä½¿ç”¨å¤šæ ¸ CPUï¼Œæä¾›äº†å¹¶è¡Œé›†åˆï¼ˆæœ‰åˆ«äºå‰é¢çš„ä¸²è¡Œé›†åˆï¼‰ï¼Œç”¨äºå¤šæ ¸ç¯å¢ƒçš„å¹¶è¡Œè®¡ç®—</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">object</span> TestPar <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token keyword">val</span> result1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> to <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> Thread<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName <span class="token punctuation">}</span>  <span class="token keyword">val</span> result2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> to <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span>par<span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> Thread<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>result1<span class="token punctuation">)</span>  println<span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8ã€é›†åˆå¸¸ç”¨å‡½æ•°"><a href="#8ã€é›†åˆå¸¸ç”¨å‡½æ•°" class="headerlink" title="8ã€é›†åˆå¸¸ç”¨å‡½æ•°"></a>8ã€é›†åˆå¸¸ç”¨å‡½æ•°</h3><h4 id="1ã€åŸºæœ¬å±æ€§å’Œå¸¸ç”¨æ“ä½œ"><a href="#1ã€åŸºæœ¬å±æ€§å’Œå¸¸ç”¨æ“ä½œ" class="headerlink" title="1ã€åŸºæœ¬å±æ€§å’Œå¸¸ç”¨æ“ä½œ"></a>1ã€<strong>åŸºæœ¬å±æ€§å’Œå¸¸ç”¨æ“ä½œ</strong></h4><p>ï¼ˆ1ï¼‰è·å–é›†åˆé•¿åº¦ </p><p>ï¼ˆ2ï¼‰è·å–é›†åˆå¤§å° </p><p>ï¼ˆ3ï¼‰å¾ªç¯éå† </p><p>ï¼ˆ4ï¼‰è¿­ä»£å™¨ </p><p>ï¼ˆ5ï¼‰ç”Ÿæˆå­—ç¬¦ä¸² </p><p>ï¼ˆ6ï¼‰æ˜¯å¦åŒ…å« </p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">val</span> list<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token comment">//ï¼ˆ1ï¼‰è·å–é›†åˆé•¿åº¦</span>println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token comment">//ï¼ˆ2ï¼‰è·å–é›†åˆå¤§å°,ç­‰åŒäº length</span>println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token comment">//ï¼ˆ3ï¼‰å¾ªç¯éå†</span>list<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span><span class="token comment">//ï¼ˆ4ï¼‰è¿­ä»£å™¨</span><span class="token keyword">for</span> <span class="token punctuation">(</span>elem <span class="token keyword">&lt;-</span> list<span class="token punctuation">.</span>iterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>  println<span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">//ï¼ˆ5ï¼‰ç”Ÿæˆå­—ç¬¦ä¸²</span>println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//ï¼ˆ6ï¼‰æ˜¯å¦åŒ…å«</span>println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€è¡ç”Ÿé›†åˆ"><a href="#2ã€è¡ç”Ÿé›†åˆ" class="headerlink" title="2ã€è¡ç”Ÿé›†åˆ"></a>2ã€<strong>è¡ç”Ÿé›†åˆ</strong></h4><p>ï¼ˆ1ï¼‰è·å–é›†åˆçš„å¤´</p><p>ï¼ˆ2ï¼‰è·å–é›†åˆçš„å°¾ï¼ˆä¸æ˜¯å¤´çš„å°±æ˜¯å°¾ï¼‰ </p><p>ï¼ˆ3ï¼‰é›†åˆæœ€åä¸€ä¸ªæ•°æ® </p><p>ï¼ˆ4ï¼‰é›†åˆåˆå§‹æ•°æ®ï¼ˆä¸åŒ…å«æœ€åä¸€ä¸ªï¼‰ </p><p>ï¼ˆ5ï¼‰åè½¬ </p><p>ï¼ˆ6ï¼‰å–å‰ï¼ˆåï¼‰n ä¸ªå…ƒç´  </p><p>ï¼ˆ7ï¼‰å»æ‰å‰ï¼ˆåï¼‰n ä¸ªå…ƒç´  </p><p>ï¼ˆ8ï¼‰å¹¶é›† </p><p>ï¼ˆ9ï¼‰äº¤é›† </p><p>ï¼ˆ10ï¼‰å·®é›† </p><p>ï¼ˆ11ï¼‰æ‹‰é“¾ </p><p>ï¼ˆ12ï¼‰æ»‘çª— </p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token keyword">val</span> list1<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> list2<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ1ï¼‰è·å–é›†åˆçš„å¤´</span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>head<span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ2ï¼‰è·å–é›†åˆçš„å°¾ï¼ˆä¸æ˜¯å¤´çš„å°±æ˜¯å°¾ï¼‰</span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>tail<span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ3ï¼‰é›†åˆæœ€åä¸€ä¸ªæ•°æ®</span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>last<span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ4ï¼‰é›†åˆåˆå§‹æ•°æ®ï¼ˆä¸åŒ…å«æœ€åä¸€ä¸ªï¼‰</span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>init<span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ5ï¼‰åè½¬</span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>reverse<span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ6ï¼‰å–å‰ï¼ˆåï¼‰n ä¸ªå…ƒç´ </span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>takeRight<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ7ï¼‰å»æ‰å‰ï¼ˆåï¼‰n ä¸ªå…ƒç´ </span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>dropRight<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ8ï¼‰å¹¶é›†</span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>union<span class="token punctuation">(</span>list2<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ9ï¼‰äº¤é›†</span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>intersect<span class="token punctuation">(</span>list2<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ10ï¼‰å·®é›†</span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>diff<span class="token punctuation">(</span>list2<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ11ï¼‰æ‹‰é“¾ æ³¨:å¦‚æœä¸¤ä¸ªé›†åˆçš„å…ƒç´ ä¸ªæ•°ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆä¼šå°†åŒç­‰æ•°é‡çš„æ•°æ®è¿›è¡Œæ‹‰é“¾ï¼Œå¤šä½™çš„æ•°æ®çœç•¥ä¸ç”¨</span>  println<span class="token punctuation">(</span>list1<span class="token punctuation">.</span>zip<span class="token punctuation">(</span>list2<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ12ï¼‰æ»‘çª—</span>  list1<span class="token punctuation">.</span>sliding<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token number">1</span>List<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token number">7</span>List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>æ‹‰é“¾ï¼Œå°±æ˜¯å°†Aé›†åˆ<span class="token number">0</span>å…ƒç´ å’ŒBé›†åˆ<span class="token number">0</span>å…ƒç´ ç»„åˆæˆkey value<span class="token punctuation">,</span>ä»¥æ­¤ç±»æ¨List<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>æ»‘çª—ï¼Œ<span class="token number">2</span><span class="token operator">-</span><span class="token number">5</span>åŒºé—´ä¹‹å¤–çš„åŒºé—´ï¼Œä»ä¸­é—´å‰ªæˆä¸¤æ®µList<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€é›†åˆè®¡ç®—ç®€å•å‡½æ•°"><a href="#3ã€é›†åˆè®¡ç®—ç®€å•å‡½æ•°" class="headerlink" title="3ã€é›†åˆè®¡ç®—ç®€å•å‡½æ•°"></a>3ã€<strong>é›†åˆè®¡ç®—ç®€å•å‡½æ•°</strong></h4><p>ï¼ˆ1ï¼‰æ±‚å’Œ </p><p>ï¼ˆ2ï¼‰æ±‚ä¹˜ç§¯ </p><p>ï¼ˆ3ï¼‰æœ€å¤§å€¼ </p><p>ï¼ˆ4ï¼‰æœ€å°å€¼ </p><p>ï¼ˆ5ï¼‰æ’åº</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token keyword">val</span> list<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ1ï¼‰æ±‚å’Œ</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>sum<span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ2ï¼‰æ±‚ä¹˜ç§¯</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>product<span class="token punctuation">)</span>    <span class="token comment">//ï¼ˆ3ï¼‰æœ€å¤§å€¼</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>max<span class="token punctuation">)</span>    <span class="token comment">//ï¼ˆ4ï¼‰æœ€å°å€¼</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>min<span class="token punctuation">)</span>    <span class="token comment">//ï¼ˆ5ï¼‰æ’åº</span>  <span class="token comment">// ï¼ˆ5.1ï¼‰æŒ‰ç…§å…ƒç´ å¤§å°æ’åº</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ï¼ˆ5.2ï¼‰æŒ‰ç…§å…ƒç´ çš„ç»å¯¹å€¼å¤§å°æ’åº</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> x<span class="token punctuation">.</span>abs<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ï¼ˆ5.3ï¼‰æŒ‰å…ƒç´ å¤§å°å‡åºæ’åº</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>sortWith<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">&lt;</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// ï¼ˆ5.4ï¼‰æŒ‰å…ƒç´ å¤§å°é™åºæ’åº</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>sortWith<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">&gt;</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token number">8</span><span class="token number">5040</span><span class="token number">6</span><span class="token operator">-</span><span class="token number">7</span>List<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ï¼ˆ1ï¼‰sorted </p><p>å¯¹ä¸€ä¸ªé›†åˆè¿›è¡Œè‡ªç„¶æ’åºï¼Œé€šè¿‡ä¼ é€’éšå¼çš„ Ordering </p><p>ï¼ˆ2ï¼‰sortBy </p><p>å¯¹ä¸€ä¸ªå±æ€§æˆ–å¤šä¸ªå±æ€§è¿›è¡Œæ’åºï¼Œé€šè¿‡å®ƒçš„ç±»å‹</p><p>ï¼ˆ3ï¼‰sortWith </p><p>åŸºäºå‡½æ•°çš„æ’åºï¼Œé€šè¿‡ä¸€ä¸ª comparator å‡½æ•°ï¼Œå®ç°è‡ªå®šä¹‰æ’åºçš„é€»è¾‘</p><h4 id="4ã€é›†åˆè®¡ç®—é«˜çº§å‡½æ•°"><a href="#4ã€é›†åˆè®¡ç®—é«˜çº§å‡½æ•°" class="headerlink" title="4ã€é›†åˆè®¡ç®—é«˜çº§å‡½æ•°"></a>4ã€<strong>é›†åˆè®¡ç®—é«˜çº§å‡½æ•°</strong></h4><p>ï¼ˆ1ï¼‰è¿‡æ»¤ </p><p>éå†ä¸€ä¸ªé›†åˆå¹¶ä»ä¸­è·å–æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„å…ƒç´ ç»„æˆä¸€ä¸ªæ–°çš„é›†åˆ </p><p>ï¼ˆ2ï¼‰<strong>è½¬åŒ–/æ˜ å°„ï¼ˆmapï¼‰</strong></p><p>å°†é›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜ å°„åˆ°æŸä¸€ä¸ªå‡½æ•°</p><p>ï¼ˆ3ï¼‰æ‰å¹³åŒ– </p><p>ï¼ˆ4ï¼‰æ‰å¹³åŒ–+æ˜ å°„ æ³¨ï¼šflatMap ç›¸å½“äºå…ˆè¿›è¡Œ map æ“ä½œï¼Œåœ¨è¿›è¡Œ flatten æ“ä½œ </p><p>é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ çš„å­å…ƒç´ æ˜ å°„åˆ°æŸä¸ªå‡½æ•°å¹¶è¿”å›æ–°é›†åˆ </p><p>ï¼ˆ5ï¼‰**åˆ†ç»„(group)**ï¼šæŒ‰ç…§æŒ‡å®šçš„è§„åˆ™å¯¹é›†åˆçš„å…ƒç´ è¿›è¡Œåˆ†ç»„</p><p>ï¼ˆ6ï¼‰ç®€åŒ–ï¼ˆå½’çº¦ï¼‰ </p><p> ï¼ˆ7ï¼‰æŠ˜å </p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token keyword">val</span> list<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> nestedList<span class="token operator">:</span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> wordList<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">,</span> <span class="token string">"hello mykk"</span><span class="token punctuation">,</span> <span class="token string">"hello scala"</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ1ï¼‰è¿‡æ»¤</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ2ï¼‰è½¬åŒ–/æ˜ å°„</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>map<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ3ï¼‰æ‰å¹³åŒ–,å¹³é“ºï¼šç±»ä¼¼äºæŠŠæ‰€æœ‰çš„å¶å­èŠ‚ç‚¹æ”¾åˆ°åŒä¸€çº§</span>  println<span class="token punctuation">(</span>nestedList<span class="token punctuation">.</span>flatten<span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ4ï¼‰æ‰å¹³åŒ–+æ˜ å°„ æ³¨ï¼šflatMap ç›¸å½“äºå…ˆè¿›è¡Œ map æ“ä½œï¼Œåœ¨è¿›è¡Œ flattenæ“ä½œ</span>  println<span class="token punctuation">(</span>wordList<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//ï¼ˆ5ï¼‰åˆ†ç»„</span>  println<span class="token punctuation">(</span>list<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> x <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>List<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span>hello<span class="token punctuation">,</span> world<span class="token punctuation">,</span> hello<span class="token punctuation">,</span> mykk<span class="token punctuation">,</span> hello<span class="token punctuation">,</span> scala<span class="token punctuation">)</span>Map<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-&gt;</span> List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token operator">-&gt;</span> List<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Reduce ç®€åŒ–ï¼ˆå½’çº¦ï¼‰ ï¼šé€šè¿‡æŒ‡å®šçš„é€»è¾‘å°†é›†åˆä¸­çš„æ•°æ®è¿›è¡Œèšåˆï¼Œä»è€Œå‡å°‘æ•°æ®ï¼Œæœ€ç»ˆè·å–ç»“æœ</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token keyword">val</span> list <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment">// å°†æ•°æ®ä¸¤ä¸¤ç»“åˆï¼Œå®ç°è¿ç®—è§„åˆ™</span>  <span class="token keyword">val</span> i<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> list<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">-</span> y<span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token string">"i = "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>  <span class="token comment">// ä»æºç çš„è§’åº¦ï¼Œreduce åº•å±‚è°ƒç”¨çš„å…¶å®å°±æ˜¯ reduceLeft</span>  <span class="token comment">//val i1 = list.reduceLeft((x,y) =&gt; x-y)</span>    <span class="token comment">// ((4-3)-2-1) = -2</span>  <span class="token keyword">val</span> i2 <span class="token operator">=</span> list<span class="token punctuation">.</span>reduceRight<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">-</span> y<span class="token punctuation">)</span>  println<span class="token punctuation">(</span>i2<span class="token punctuation">)</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">8</span><span class="token operator">-</span><span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>**Fold æ–¹æ³•(æŠ˜å )**ï¼šåŒ–ç®€çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token keyword">val</span> list <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment">// fold æ–¹æ³•ä½¿ç”¨äº†å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œå­˜åœ¨ä¸¤ä¸ªå‚æ•°åˆ—è¡¨</span>  <span class="token comment">// ç¬¬ä¸€ä¸ªå‚æ•°åˆ—è¡¨ä¸º ï¼š é›¶å€¼ï¼ˆåˆå§‹å€¼ï¼‰</span>  <span class="token comment">// ç¬¬äºŒä¸ªå‚æ•°åˆ—è¡¨ä¸ºï¼š ç®€åŒ–è§„åˆ™</span>  <span class="token comment">// fold åº•å±‚å…¶å®ä¸º foldLeft</span>  <span class="token comment">//åœ¨å…ƒç´ 1ä¹‹å‰ï¼Œæ”¾ä¸€ä¸ª0åˆå§‹å€¼è®¡ç®—</span>  <span class="token keyword">val</span> i <span class="token operator">=</span> list<span class="token punctuation">.</span>foldLeft<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token comment">//   (0-1)-2)-3)-4</span>  println<span class="token punctuation">(</span>i<span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token string">"æ¨å¯¼è¿‡ç¨‹"</span><span class="token punctuation">)</span>  <span class="token comment">//  val i1 = list.foldRight(10)((x, y) =&gt; x - y)</span>  <span class="token keyword">val</span> i1 <span class="token operator">=</span> list<span class="token punctuation">.</span>foldRight<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">" x= "</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">" ,y="</span> <span class="token operator">+</span> y<span class="token punctuation">)</span>    x <span class="token operator">-</span> y  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 10æ”¾åœ¨å€’æ•°ç¬¬äºŒä¸ª</span>  println<span class="token punctuation">(</span>i1<span class="token punctuation">)</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">-</span><span class="token number">10</span>æ¨å¯¼è¿‡ç¨‹ x<span class="token operator">=</span> <span class="token number">4</span> <span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token number">10</span> x<span class="token operator">=</span> <span class="token number">3</span> <span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token operator">-</span><span class="token number">6</span> x<span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token number">9</span> x<span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token operator">-</span><span class="token number">7</span><span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¡ˆä¾‹ï¼šä¸¤ä¸ªé›†åˆåˆå¹¶</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>mutable</span><span class="token keyword">object</span> TestFold <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">// ä¸¤ä¸ª Map çš„æ•°æ®åˆå¹¶</span>  <span class="token keyword">val</span> map1 <span class="token operator">=</span> mutable<span class="token punctuation">.</span>Map<span class="token punctuation">(</span><span class="token string">"a"</span> <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"b"</span> <span class="token operator">-&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"c"</span> <span class="token operator">-&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> map2 <span class="token operator">=</span> mutable<span class="token punctuation">.</span>Map<span class="token punctuation">(</span><span class="token string">"a"</span> <span class="token operator">-&gt;</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"b"</span> <span class="token operator">-&gt;</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"d"</span> <span class="token operator">-&gt;</span> <span class="token number">6</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> map3<span class="token operator">:</span> mutable<span class="token punctuation">.</span>Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> map2<span class="token punctuation">.</span>foldLeft<span class="token punctuation">(</span>map1<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">(</span>map<span class="token punctuation">,</span> kv<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">val</span> k <span class="token operator">=</span> kv<span class="token punctuation">.</span>_1      <span class="token keyword">val</span> v <span class="token operator">=</span> kv<span class="token punctuation">.</span>_2      print<span class="token punctuation">(</span>map<span class="token punctuation">.</span>toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span>      print<span class="token punctuation">(</span>kv<span class="token punctuation">.</span>toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span>      print<span class="token punctuation">(</span><span class="token string">"map.getOrElse(k, 0)="</span><span class="token operator">+</span>map<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span>      map<span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> map<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> v      println<span class="token punctuation">(</span> <span class="token string">"map(k)"</span> <span class="token operator">+</span> map<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>      map    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>map3<span class="token punctuation">)</span><span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>Map<span class="token punctuation">(</span>b <span class="token operator">-&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> a <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">-&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>map<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>map<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token number">7</span>Map<span class="token punctuation">(</span>b <span class="token operator">-&gt;</span> <span class="token number">7</span><span class="token punctuation">,</span> a <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">-&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>map<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>map<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token number">6</span>Map<span class="token punctuation">(</span>b <span class="token operator">-&gt;</span> <span class="token number">7</span><span class="token punctuation">,</span> d <span class="token operator">-&gt;</span> <span class="token number">6</span><span class="token punctuation">,</span> a <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">-&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>map<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>map<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token number">5</span>Map<span class="token punctuation">(</span>b <span class="token operator">-&gt;</span> <span class="token number">7</span><span class="token punctuation">,</span> d <span class="token operator">-&gt;</span> <span class="token number">6</span><span class="token punctuation">,</span> a <span class="token operator">-&gt;</span> <span class="token number">5</span><span class="token punctuation">,</span> c <span class="token operator">-&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€æ™®é€š-WordCount-æ¡ˆä¾‹"><a href="#5ã€æ™®é€š-WordCount-æ¡ˆä¾‹" class="headerlink" title="5ã€æ™®é€š WordCount æ¡ˆä¾‹"></a>5ã€<strong>æ™®é€š</strong> <strong>WordCount</strong> <strong>æ¡ˆä¾‹</strong></h4><p>æ¡ˆä¾‹ï¼šå•è¯è®¡æ•°ï¼šå°†é›†åˆä¸­å‡ºç°çš„ç›¸åŒçš„å•è¯ï¼Œè¿›è¡Œè®¡æ•°ï¼Œå–è®¡æ•°æ’åå‰ä¸‰çš„ç»“æœ</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">object</span> TestWordCount <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">// å•è¯è®¡æ•°ï¼šå°†é›†åˆä¸­å‡ºç°çš„ç›¸åŒçš„å•è¯ï¼Œè¿›è¡Œè®¡æ•°ï¼Œå–è®¡æ•°æ’åå‰ä¸‰çš„ç»“æœ</span>  <span class="token keyword">val</span> stringList <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token string">"Hello Scala Hbase kafka"</span><span class="token punctuation">,</span> <span class="token string">"Hello scala Hbase"</span><span class="token punctuation">,</span> <span class="token string">"Hello Scala"</span><span class="token punctuation">,</span> <span class="token string">"Hello "</span><span class="token punctuation">)</span>  <span class="token comment">// 1ã€æ‰“æ•£ï¼šå°†æ¯ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªä¸€ä¸ªå•è¯</span>  <span class="token keyword">val</span> wordList<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> stringList<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>str <span class="token keyword">=&gt;</span> str<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>wordList<span class="token punctuation">)</span>  <span class="token comment">// 2ã€å°†ç›¸åŒçš„å•è¯æ”¾ç½®åœ¨ä¸€èµ·</span>  <span class="token keyword">val</span> wordToWordsMap<span class="token operator">:</span> Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordList<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>word <span class="token keyword">=&gt;</span> word<span class="token punctuation">)</span>  println<span class="token punctuation">(</span>wordToWordsMap<span class="token punctuation">.</span>keys<span class="token punctuation">)</span>  println<span class="token punctuation">(</span>wordToWordsMap<span class="token punctuation">.</span>values<span class="token punctuation">)</span>  <span class="token comment">// 3ã€å¯¹ç›¸åŒçš„å•è¯è¿›è¡Œè®¡æ•°</span>  <span class="token keyword">val</span> wordToCountMap<span class="token operator">:</span> Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordToWordsMap<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> tuple<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>wordToCountMap<span class="token punctuation">)</span>  <span class="token comment">// 4ã€å¯¹è®¡æ•°å®Œæˆåçš„ç»“æœè¿›è¡Œæ’åºï¼ˆé™åºï¼‰</span>  <span class="token keyword">val</span> sortList<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordToCountMap<span class="token punctuation">.</span>toList<span class="token punctuation">.</span>sortWith <span class="token punctuation">{</span>    <span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>      left<span class="token punctuation">.</span>_2 <span class="token operator">&gt;</span> right<span class="token punctuation">.</span>_2    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>sortList<span class="token punctuation">)</span><span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>List<span class="token punctuation">(</span>Hello<span class="token punctuation">,</span> Scala<span class="token punctuation">,</span> Hbase<span class="token punctuation">,</span> kafka<span class="token punctuation">,</span> Hello<span class="token punctuation">,</span> scala<span class="token punctuation">,</span> Hbase<span class="token punctuation">,</span> Hello<span class="token punctuation">,</span> Scala<span class="token punctuation">,</span> Hello<span class="token punctuation">)</span>Set<span class="token punctuation">(</span>Hbase<span class="token punctuation">,</span> Scala<span class="token punctuation">,</span> kafka<span class="token punctuation">,</span> Hello<span class="token punctuation">,</span> scala<span class="token punctuation">)</span>HashMap<span class="token punctuation">.</span>HashMapValues<span class="token punctuation">(</span>List<span class="token punctuation">(</span>Hbase<span class="token punctuation">,</span> Hbase<span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>Scala<span class="token punctuation">,</span> Scala<span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>kafka<span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>Hello<span class="token punctuation">,</span> Hello<span class="token punctuation">,</span> Hello<span class="token punctuation">,</span> Hello<span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span>scala<span class="token punctuation">)</span><span class="token punctuation">)</span>Map<span class="token punctuation">(</span>Hbase <span class="token operator">-&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> Scala <span class="token operator">-&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> kafka <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> Hello <span class="token operator">-&gt;</span> <span class="token number">4</span><span class="token punctuation">,</span> scala <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token punctuation">(</span>Hello<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>Hbase<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>Scala<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>kafka<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>scala<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ã€å¤æ‚-WordCount-æ¡ˆä¾‹"><a href="#6ã€å¤æ‚-WordCount-æ¡ˆä¾‹" class="headerlink" title="6ã€å¤æ‚ WordCount æ¡ˆä¾‹"></a>6ã€<strong>å¤æ‚</strong> <strong>WordCount</strong> <strong>æ¡ˆä¾‹</strong></h4><p>æ¡ˆä¾‹ï¼šå’Œä¸Šé¢ä¸€æ ·ï¼Œå†™æ³•ä¸ä¸€æ ·</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">object</span> TestWordCount <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token keyword">val</span> tupleList <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Hello Scala Spark World "</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"Hello Scala Spark"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"Hello Scala"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"Hello "</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// é‡å¤å¤åˆ¶ å‚æ•°1ä¸ªæ•°ä¸º å‚æ•°2ä¸ª</span>  <span class="token comment">//  val stringList: List[String] = tupleList.map(t =&gt; (t._1 + "") * t._2)</span>  <span class="token comment">//  println(stringList)</span>  <span class="token keyword">val</span> wordToCountList<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> tupleList<span class="token punctuation">.</span>flatMap <span class="token punctuation">{</span>    t <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>      <span class="token comment">//</span>      <span class="token keyword">val</span> strings <span class="token operator">=</span> t<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>      strings<span class="token punctuation">.</span>map<span class="token punctuation">(</span>word <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>word<span class="token punctuation">,</span> t<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>wordToCountList<span class="token punctuation">)</span>  <span class="token keyword">val</span> wordToTupleMap<span class="token operator">:</span> Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordToCountList<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span>t <span class="token keyword">=&gt;</span> t<span class="token punctuation">.</span>_1<span class="token punctuation">)</span>  println<span class="token punctuation">(</span>wordToTupleMap<span class="token punctuation">.</span>keys<span class="token punctuation">)</span>  println<span class="token punctuation">(</span>wordToTupleMap<span class="token punctuation">.</span>values<span class="token punctuation">)</span>  <span class="token keyword">val</span> stringToInts<span class="token operator">:</span> Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordToTupleMap<span class="token punctuation">.</span>mapValues <span class="token punctuation">{</span>    datas <span class="token keyword">=&gt;</span> datas<span class="token punctuation">.</span>map<span class="token punctuation">(</span>t <span class="token keyword">=&gt;</span> t<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>stringToInts<span class="token punctuation">)</span>  <span class="token comment">// é”™è¯¯çš„</span>  <span class="token keyword">val</span> count1<span class="token operator">:</span> Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> stringToInts<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> tuple<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// æ­£ç¡®çš„</span>  <span class="token keyword">val</span> count2<span class="token operator">:</span> Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> stringToInts<span class="token punctuation">.</span>map<span class="token punctuation">(</span>tuple <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>tuple<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> tuple<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>count2<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸ƒã€æ¨¡å¼åŒ¹é…"><a href="#ä¸ƒã€æ¨¡å¼åŒ¹é…" class="headerlink" title="ä¸ƒã€æ¨¡å¼åŒ¹é…"></a>ä¸ƒã€<strong>æ¨¡å¼åŒ¹é…</strong></h2><p>Scala ä¸­çš„æ¨¡å¼åŒ¹é…ç±»ä¼¼äº Java ä¸­çš„ switch è¯­æ³•</p><h3 id="1ã€åŸºæœ¬è¯­æ³•-1"><a href="#1ã€åŸºæœ¬è¯­æ³•-1" class="headerlink" title="1ã€åŸºæœ¬è¯­æ³•"></a>1ã€åŸºæœ¬è¯­æ³•</h3><p>æ¨¡å¼åŒ¹é…è¯­æ³•ä¸­ï¼Œé‡‡ç”¨ match å…³é”®å­—å£°æ˜ï¼Œæ¯ä¸ªåˆ†æ”¯é‡‡ç”¨ case å…³é”®å­—è¿›è¡Œå£°æ˜ï¼Œå½“éœ€ è¦åŒ¹é…æ—¶ï¼Œä¼šä»ç¬¬ä¸€ä¸ª case åˆ†æ”¯å¼€å§‹ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œé‚£ä¹ˆæ‰§è¡Œå¯¹åº”çš„é€»è¾‘ä»£ç ï¼Œå¦‚æœåŒ¹é…ä¸æˆåŠŸï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªåˆ†æ”¯è¿›è¡Œåˆ¤æ–­ã€‚å¦‚æœæ‰€æœ‰ case éƒ½ä¸åŒ¹é…ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œ case _åˆ†æ”¯ï¼Œç±»ä¼¼äº Java ä¸­ default è¯­å¥ã€‚ </p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">object</span> TestMatchCase <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token keyword">var</span> a<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">10</span>  <span class="token keyword">var</span> b<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">20</span>  <span class="token keyword">var</span> operator<span class="token operator">:</span> <span class="token builtin">Char</span> <span class="token operator">=</span> <span class="token string">'-'</span>  <span class="token keyword">var</span> result <span class="token operator">=</span> operator <span class="token keyword">match</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token string">'+'</span> <span class="token keyword">=&gt;</span> a <span class="token operator">+</span> b    <span class="token keyword">case</span> <span class="token string">'-'</span> <span class="token keyword">=&gt;</span> a <span class="token operator">-</span> b    <span class="token keyword">case</span> <span class="token string">'*'</span> <span class="token keyword">=&gt;</span> a <span class="token operator">*</span> b    <span class="token keyword">case</span> <span class="token string">'/'</span> <span class="token keyword">=&gt;</span> a <span class="token operator">/</span> b    <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> <span class="token string">"string"</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ï¼ˆ1ï¼‰å¦‚æœæ‰€æœ‰ case éƒ½ä¸åŒ¹é…ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œ case _ åˆ†æ”¯ï¼Œç±»ä¼¼äº Java ä¸­ default è¯­å¥ï¼Œ è‹¥æ­¤æ—¶æ²¡æœ‰ case _ åˆ†æ”¯ï¼Œé‚£ä¹ˆä¼šæŠ›å‡º MatchErrorã€‚ </p><p>ï¼ˆ2ï¼‰æ¯ä¸ª case ä¸­ï¼Œä¸éœ€è¦ä½¿ç”¨ break è¯­å¥ï¼Œè‡ªåŠ¨ä¸­æ–­ caseã€‚ </p><p>ï¼ˆ3ï¼‰match case è¯­å¥å¯ä»¥åŒ¹é…ä»»ä½•ç±»å‹ï¼Œè€Œä¸åªæ˜¯å­—é¢é‡ã€‚ </p><p>ï¼ˆ4ï¼‰=&gt; åé¢çš„ä»£ç å—ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª case è¯­å¥ä¹‹å‰çš„ä»£ç æ˜¯<strong>ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œ</strong>ï¼Œå¯ä»¥ ä½¿ç”¨{}æ‹¬èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ä¸æ‹¬</p><h3 id="2ã€æ¨¡å¼å®ˆå«"><a href="#2ã€æ¨¡å¼å®ˆå«" class="headerlink" title="2ã€æ¨¡å¼å®ˆå«"></a>2ã€æ¨¡å¼å®ˆå«</h3><p>å¦‚æœæƒ³è¦è¡¨è¾¾åŒ¹é…æŸä¸ªèŒƒå›´çš„æ•°æ®ï¼Œå°±éœ€è¦åœ¨æ¨¡å¼åŒ¹é…ä¸­å¢åŠ æ¡ä»¶å®ˆå«</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> abs<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">=</span> x <span class="token keyword">match</span> <span class="token punctuation">{</span>  <span class="token keyword">case</span> i<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token keyword">if</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token keyword">=&gt;</span> i  <span class="token keyword">case</span> j<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token keyword">if</span> j <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">=&gt;</span> <span class="token operator">-</span>j  <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> <span class="token string">"type illegal"</span><span class="token punctuation">}</span>println<span class="token punctuation">(</span>abs<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€æ¨¡å¼åŒ¹é…ç±»å‹"><a href="#3ã€æ¨¡å¼åŒ¹é…ç±»å‹" class="headerlink" title="3ã€æ¨¡å¼åŒ¹é…ç±»å‹"></a>3ã€<strong>æ¨¡å¼åŒ¹é…ç±»å‹</strong></h3><h4 id="1ã€åŒ¹é…å¸¸é‡"><a href="#1ã€åŒ¹é…å¸¸é‡" class="headerlink" title="1ã€åŒ¹é…å¸¸é‡"></a>1ã€<strong>åŒ¹é…å¸¸é‡</strong></h4><p>Scala ä¸­ï¼Œæ¨¡å¼åŒ¹é…å¯ä»¥åŒ¹é…æ‰€æœ‰çš„å­—é¢é‡ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ï¼Œæ•°å­—ï¼Œå¸ƒå°”å€¼ç­‰ç­‰</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">println<span class="token punctuation">(</span>describe<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// è¾“å…¥å®šä¹‰çš„ä»¥å¤–ï¼Œæ¯”å¦‚6ï¼Œåˆ™ä¼šå¼‚å¸¸</span><span class="token keyword">def</span> describe<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Any</span><span class="token punctuation">)</span> <span class="token operator">=</span> x <span class="token keyword">match</span> <span class="token punctuation">{</span>  <span class="token keyword">case</span> <span class="token number">5</span> <span class="token keyword">=&gt;</span> <span class="token string">"Int five"</span>  <span class="token keyword">case</span> <span class="token string">"hello"</span> <span class="token keyword">=&gt;</span> <span class="token string">"String hello"</span>  <span class="token keyword">case</span> <span class="token boolean">true</span> <span class="token keyword">=&gt;</span> <span class="token string">"Boolean true"</span>  <span class="token keyword">case</span> <span class="token string">'+'</span> <span class="token keyword">=&gt;</span> <span class="token string">"Char +"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€åŒ¹é…ç±»å‹"><a href="#2ã€åŒ¹é…ç±»å‹" class="headerlink" title="2ã€åŒ¹é…ç±»å‹"></a>2ã€åŒ¹é…ç±»å‹</h4><p>éœ€è¦è¿›è¡Œç±»å‹åˆ¤æ–­æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‰æ–‡æ‰€å­¦çš„ isInstanceOf[T]å’Œ asInstanceOf[T]ï¼Œä¹Ÿå¯ä½¿ ç”¨æ¨¡å¼åŒ¹é…å®ç°åŒæ ·çš„åŠŸèƒ½</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token keyword">def</span> describe<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Any</span><span class="token punctuation">)</span> <span class="token operator">=</span> x <span class="token keyword">match</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> i<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token keyword">=&gt;</span> <span class="token string">"Int"</span>    <span class="token keyword">case</span> s<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token keyword">=&gt;</span> <span class="token string">"String hello"</span>    <span class="token keyword">case</span> m<span class="token operator">:</span> List<span class="token punctuation">[</span>_<span class="token punctuation">]</span> <span class="token keyword">=&gt;</span> <span class="token string">"List"</span>    <span class="token keyword">case</span> c<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token keyword">=&gt;</span> <span class="token string">"Array[Int]"</span>    <span class="token keyword">case</span> someThing <span class="token keyword">=&gt;</span> <span class="token string">"something else "</span> <span class="token operator">+</span> someThing  <span class="token punctuation">}</span>  <span class="token comment">//æ³›å‹æ“¦é™¤</span>  println<span class="token punctuation">(</span>describe<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>describe<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//æ•°ç»„ä¾‹å¤–ï¼Œå¯ä¿ç•™æ³›å‹</span>  println<span class="token punctuation">(</span>describe<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>describe<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>ListListArray<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span>something <span class="token keyword">else</span> <span class="token punctuation">[</span>Ljava<span class="token punctuation">.</span>lang<span class="token punctuation">.</span><span class="token builtin">String</span><span class="token punctuation">;</span><span class="token annotation punctuation">@38082d64</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€åŒ¹é…æ•°ç»„"><a href="#3ã€åŒ¹é…æ•°ç»„" class="headerlink" title="3ã€åŒ¹é…æ•°ç»„"></a>3ã€åŒ¹é…æ•°ç»„</h4><p>scala æ¨¡å¼åŒ¹é…å¯ä»¥å¯¹é›†åˆè¿›è¡Œç²¾ç¡®çš„åŒ¹é…ï¼Œä¾‹å¦‚åŒ¹é…åªæœ‰ä¸¤ä¸ªå…ƒç´ çš„ã€ä¸”ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º 0 çš„æ•°ç»„</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token keyword">for</span> <span class="token punctuation">(</span>arr <span class="token keyword">&lt;-</span> Array<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Array<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Array<span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¯¹ä¸€ä¸ªæ•°ç»„é›†åˆè¿›è¡Œéå†</span>    <span class="token keyword">val</span> result <span class="token operator">=</span> arr <span class="token keyword">match</span> <span class="token punctuation">{</span>      <span class="token keyword">case</span> Array<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token string">"0"</span> <span class="token comment">//åŒ¹é… Array(0) è¿™ä¸ªæ•°ç»„</span>      <span class="token keyword">case</span> Array<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> y <span class="token comment">//åŒ¹é…æœ‰ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ ï¼Œ ç„¶åå°†å°†å…ƒç´ å€¼èµ‹ç»™å¯¹åº”çš„ x, y</span>      <span class="token keyword">case</span> Array<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token string">"ä»¥ 0 å¼€å¤´çš„æ•°ç»„"</span> <span class="token comment">//åŒ¹é…ä»¥ 0 å¼€å¤´å’Œæ•°ç»„</span>      <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> <span class="token string">"something else"</span>    <span class="token punctuation">}</span>    println<span class="token punctuation">(</span><span class="token string">"result = "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span>  <span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>result <span class="token operator">=</span> <span class="token number">0</span>result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span>result <span class="token operator">=</span> ä»¥ <span class="token number">0</span> å¼€å¤´çš„æ•°ç»„result <span class="token operator">=</span> something <span class="token keyword">else</span>result <span class="token operator">=</span> something <span class="token keyword">else</span>result <span class="token operator">=</span> hello<span class="token punctuation">,</span><span class="token number">90</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€åŒ¹é…åˆ—è¡¨"><a href="#4ã€åŒ¹é…åˆ—è¡¨" class="headerlink" title="4ã€åŒ¹é…åˆ—è¡¨"></a>4ã€åŒ¹é…åˆ—è¡¨</h4><p>æ–¹å¼ä¸€ï¼š</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token comment">//list æ˜¯ä¸€ä¸ªå­˜æ”¾ List é›†åˆçš„æ•°ç»„</span>  <span class="token comment">//å¦‚æœè¦åŒ¹é… List(88) è¿™æ ·çš„åªå«æœ‰ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨,å¹¶åŸå€¼è¿”å›.åº”è¯¥æ€ä¹ˆå†™</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>list <span class="token keyword">&lt;-</span> Array<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> List<span class="token punctuation">(</span><span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> result <span class="token operator">=</span> list <span class="token keyword">match</span> <span class="token punctuation">{</span>      <span class="token keyword">case</span> List<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token string">"0"</span> <span class="token comment">//åŒ¹é… List(0)</span>      <span class="token keyword">case</span> List<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> y <span class="token comment">//åŒ¹é…æœ‰ä¸¤ä¸ªå…ƒç´ çš„ List</span>      <span class="token keyword">case</span> List<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token string">"0 ..."</span>      <span class="token comment">//      case data =&gt; data // å¦‚æœæ”¾åœ¨ case _å‰åˆ™æ­¤è¾“å‡ºï¼Œåº•ä¸‹ä¸è¾“å‡º,åˆ™å¯ä»¥è¾“å‡º88</span>      <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> <span class="token string">"something else"</span>    <span class="token punctuation">}</span>    println<span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">0</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>something <span class="token keyword">else</span>something <span class="token keyword">else</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ–¹å¼äºŒï¼š</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token keyword">val</span> list<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>  list <span class="token keyword">match</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> first <span class="token operator">::</span> second <span class="token operator">::</span> rest <span class="token keyword">=&gt;</span> println<span class="token punctuation">(</span>first <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> second <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> rest<span class="token punctuation">)</span><span class="token comment">//    case first :: second =&gt; println(first + "-" + second)</span><span class="token comment">//    case first =&gt; println(first)</span>    <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> println<span class="token punctuation">(</span><span class="token string">"something else"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span>List<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€åŒ¹é…å…ƒç»„"><a href="#5ã€åŒ¹é…å…ƒç»„" class="headerlink" title="5ã€åŒ¹é…å…ƒç»„"></a>5ã€åŒ¹é…å…ƒç»„</h4><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token comment">//å¯¹ä¸€ä¸ªå…ƒç»„é›†åˆè¿›è¡Œéå†</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>tuple <span class="token keyword">&lt;-</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> result <span class="token operator">=</span> tuple <span class="token keyword">match</span> <span class="token punctuation">{</span>      <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token string">"0 ..."</span> <span class="token comment">//æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ 0 çš„å…ƒç»„</span>      <span class="token keyword">case</span> <span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token string">""</span> <span class="token operator">+</span> y <span class="token operator">+</span> <span class="token string">"0"</span> <span class="token comment">// åŒ¹é…åä¸€ä¸ªå…ƒç´ æ˜¯ 0 çš„å¯¹å¶å…ƒç»„</span>      <span class="token keyword">case</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token string">""</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> b      <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> <span class="token string">"something else"</span> <span class="token comment">//é»˜è®¤</span>    <span class="token punctuation">}</span>    println<span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">10</span><span class="token number">1</span> <span class="token number">1</span>something <span class="token keyword">else</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰©å±•ï¼š</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">object</span> TestMatchCase <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token comment">//ç‰¹æ®Šçš„æ¨¡å¼åŒ¹é… 1 ï¼šæ‰“å°å…ƒç»„ç¬¬ä¸€ä¸ªå…ƒç´ </span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>elem <span class="token keyword">&lt;-</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    print<span class="token punctuation">(</span>elem<span class="token punctuation">.</span>_1 <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span> <span class="token comment">// ç©ºæ ¼é—´éš”å¼€</span>  <span class="token punctuation">}</span>  println  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">&lt;-</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    print<span class="token punctuation">(</span>word <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span> <span class="token comment">// ç©ºæ ¼é—´éš”å¼€</span>  <span class="token punctuation">}</span>  println  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">&lt;-</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    print<span class="token punctuation">(</span>word <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span> <span class="token comment">// ç©ºæ ¼é—´éš”å¼€</span>  <span class="token punctuation">}</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">&lt;-</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    print<span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span> <span class="token comment">// ç©ºæ ¼é—´éš”å¼€</span>  <span class="token punctuation">}</span>  println  println<span class="token punctuation">(</span><span class="token string">"--------------"</span><span class="token punctuation">)</span>  <span class="token comment">//ç‰¹æ®Šçš„æ¨¡å¼åŒ¹é… 2 ï¼šç»™å…ƒç»„å…ƒç´ å‘½å</span>  <span class="token keyword">var</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"zs"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span><span class="token string">"--------------"</span><span class="token punctuation">)</span>  <span class="token comment">//ç‰¹æ®Šçš„æ¨¡å¼åŒ¹é… 3 ï¼šéå†é›†åˆä¸­çš„å…ƒç»„ï¼Œç»™ count * 2</span>  <span class="token keyword">var</span> list<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//println(list.map(t =&gt; (t._1, t._2 * 2)))</span>  println<span class="token punctuation">(</span>    list<span class="token punctuation">.</span>map <span class="token punctuation">{</span>      <span class="token keyword">case</span> <span class="token punctuation">(</span>word<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>word<span class="token punctuation">,</span> count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">)</span>  <span class="token keyword">var</span> list1 <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>    list1<span class="token punctuation">.</span>map <span class="token punctuation">{</span>      <span class="token keyword">case</span> <span class="token punctuation">(</span>groupkey<span class="token punctuation">,</span> <span class="token punctuation">(</span>word<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>word<span class="token punctuation">,</span> count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">)</span><span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>a b c a b c a b c <span class="token number">1</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span>zs<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>List<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>List<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ã€åŒ¹é…å¯¹è±¡åŠæ ·ä¾‹ç±»"><a href="#6ã€åŒ¹é…å¯¹è±¡åŠæ ·ä¾‹ç±»" class="headerlink" title="6ã€åŒ¹é…å¯¹è±¡åŠæ ·ä¾‹ç±»"></a>6ã€åŒ¹é…å¯¹è±¡åŠæ ·ä¾‹ç±»</h4><ul><li><p>val user = User(â€œzhangsanâ€,11)ï¼Œè¯¥è¯­å¥åœ¨æ‰§è¡Œæ—¶ï¼Œå®é™…è°ƒç”¨çš„æ˜¯ User ä¼´ç”Ÿå¯¹è±¡ä¸­çš„ <strong>apply</strong> æ–¹æ³•ï¼Œå› æ­¤ä¸ç”¨ <strong>new</strong> <strong>å…³é”®å­—</strong>å°±èƒ½æ„é€ å‡ºç›¸åº”çš„å¯¹è±¡</p></li><li><p>å½“å°† <strong>User(â€œzhangsanâ€, 11)**å†™åœ¨ case åæ—¶[case User(â€œzhangsanâ€, 11) =&gt; â€œyesâ€]ï¼Œä¼šé»˜è®¤è°ƒç”¨ **unapply</strong> æ–¹æ³•(å¯¹è±¡æå–å™¨)ï¼Œ<strong>user</strong> <strong>ä½œä¸º</strong> <strong>unapply</strong> <strong>æ–¹æ³•çš„å‚æ•°</strong>ï¼Œunapply æ–¹æ³•å°† user å¯¹è±¡çš„ name å’Œ age å±æ€§æå–å‡ºæ¥ï¼Œä¸ User(â€œzhangsanâ€, 11)ä¸­çš„å±æ€§å€¼è¿›è¡ŒåŒ¹é…</p></li><li><p>case ä¸­å¯¹è±¡çš„ unapply æ–¹æ³•(æå–å™¨)è¿”å› Someï¼Œä¸”æ‰€æœ‰å±æ€§å‡ä¸€è‡´ï¼Œæ‰ç®—åŒ¹é…æˆåŠŸ, å±æ€§ä¸ä¸€è‡´ï¼Œæˆ–è¿”å› Noneï¼Œåˆ™åŒ¹é…å¤±è´¥</p></li><li><p>è‹¥åªæå–å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œåˆ™æå–å™¨ä¸º <strong>unapply</strong>(obj:Obj):<strong>Option[**T</strong>]** </p><p>è‹¥æå–å¯¹è±¡çš„å¤šä¸ªå±æ€§ï¼Œåˆ™æå–å™¨ä¸º <strong>unapply</strong>(obj:Obj):<strong>Option[</strong>(T1,T2,T3â€¦)<strong>]</strong> </p><p>è‹¥æå–å¯¹è±¡çš„å¯å˜ä¸ªå±æ€§ï¼Œåˆ™æå–å™¨ä¸º <strong>unapplySeq</strong>(obj:Obj):<strong>Option[**Seq[T]</strong>]**</p></li></ul><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">class</span> User<span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token keyword">val</span> age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token keyword">object</span> User <span class="token punctuation">{</span>  <span class="token keyword">def</span> apply<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> User <span class="token operator">=</span> <span class="token keyword">new</span> User<span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>  <span class="token keyword">def</span> unapply<span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span><span class="token operator">:</span> Option<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>      None    <span class="token keyword">else</span>      Some<span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>age<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">object</span> TestMatchUnapply <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> user<span class="token operator">:</span> User <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> result <span class="token operator">=</span> user <span class="token keyword">match</span> <span class="token punctuation">{</span>      <span class="token keyword">case</span> User<span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token string">"yes"</span>      <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> <span class="token string">"no"</span>    <span class="token punctuation">}</span>    println<span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç®€åŒ–å†™æ³•ï¼š</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">case</span> <span class="token keyword">class</span> User<span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token keyword">val</span> age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token keyword">object</span> TestMatchUnapply <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">val</span> user<span class="token operator">:</span> User <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> result <span class="token operator">=</span> user <span class="token keyword">match</span> <span class="token punctuation">{</span>      <span class="token keyword">case</span> User<span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token string">"yes"</span>      <span class="token keyword">case</span> _ <span class="token keyword">=&gt;</span> <span class="token string">"no"</span>    <span class="token punctuation">}</span>    println<span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4ã€å˜é‡å£°æ˜ä¸­çš„æ¨¡å¼åŒ¹é…"><a href="#4ã€å˜é‡å£°æ˜ä¸­çš„æ¨¡å¼åŒ¹é…" class="headerlink" title="4ã€å˜é‡å£°æ˜ä¸­çš„æ¨¡å¼åŒ¹é…"></a>4ã€<strong>å˜é‡å£°æ˜ä¸­çš„æ¨¡å¼åŒ¹é…</strong></h3><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7</span><span class="token keyword">object</span> TestMatchCase <span class="token keyword">extends</span> App <span class="token punctuation">{</span>  <span class="token keyword">case</span> <span class="token keyword">class</span> Person<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span>  <span class="token keyword">val</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>s<span class="token string">"x=$x,y=$y"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> Array<span class="token punctuation">(</span>first<span class="token punctuation">,</span> second<span class="token punctuation">,</span> _<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>s<span class="token string">"first=$first,second=$second"</span><span class="token punctuation">)</span>    <span class="token keyword">val</span> Person<span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>  println<span class="token punctuation">(</span>s<span class="token string">"name=$name,age=$age"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token number">2</span>first<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>second<span class="token operator">=</span><span class="token number">7</span>name<span class="token operator">=</span>zhangsan<span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token number">16</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5ã€for-è¡¨è¾¾å¼ä¸­çš„æ¨¡å¼åŒ¹é…"><a href="#5ã€for-è¡¨è¾¾å¼ä¸­çš„æ¨¡å¼åŒ¹é…" class="headerlink" title="5ã€for è¡¨è¾¾å¼ä¸­çš„æ¨¡å¼åŒ¹é…"></a>5ã€<strong>for</strong> <strong>è¡¨è¾¾å¼ä¸­çš„æ¨¡å¼åŒ¹é…</strong></h3><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"> <span class="token keyword">val</span> map <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">"A"</span> <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"B"</span> <span class="token operator">-&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"C"</span> <span class="token operator">-&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">&lt;-</span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//ç›´æ¥å°† map ä¸­çš„ k-v éå†å‡ºæ¥</span>    println<span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">" -&gt; "</span> <span class="token operator">+</span> v<span class="token punctuation">)</span> <span class="token comment">//3 ä¸ª</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span><span class="token string">"----------------------"</span><span class="token punctuation">)</span>  <span class="token comment">//éå† value=0 çš„ k-v ,å¦‚æœ v ä¸æ˜¯ 0,è¿‡æ»¤</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">&lt;-</span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">" --&gt; "</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// B-&gt;0</span>  <span class="token punctuation">}</span>  println<span class="token punctuation">(</span><span class="token string">"----------------------"</span><span class="token punctuation">)</span>  <span class="token comment">//if v == 0 æ˜¯ä¸€ä¸ªè¿‡æ»¤çš„æ¡ä»¶</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">&lt;-</span> map <span class="token keyword">if</span> v <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">" ---&gt; "</span> <span class="token operator">+</span> v<span class="token punctuation">)</span> <span class="token comment">// A-&gt;1 å’Œ c-&gt;33</span>  <span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>A <span class="token operator">-&gt;</span> <span class="token number">1</span>B <span class="token operator">-&gt;</span> <span class="token number">0</span>C <span class="token operator">-&gt;</span> <span class="token number">3</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>B <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>A <span class="token operator">--</span><span class="token operator">-&gt;</span> <span class="token number">1</span>C <span class="token operator">--</span><span class="token operator">-&gt;</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å…«ã€å¼‚å¸¸"><a href="#å…«ã€å¼‚å¸¸" class="headerlink" title="å…«ã€å¼‚å¸¸"></a>å…«ã€å¼‚å¸¸</h2><p>è¯­æ³•å¤„ç†ä¸Šå’Œ <strong>Java</strong> <strong>ç±»ä¼¼</strong>ï¼Œä½†æ˜¯åˆä¸å°½ç›¸åŒ</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token keyword">try</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> ex<span class="token operator">:</span> ArithmeticException <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>      <span class="token comment">// å‘ç”Ÿç®—æœ¯å¼‚å¸¸</span>      println<span class="token punctuation">(</span><span class="token string">"å‘ç”Ÿç®—æœ¯å¼‚å¸¸"</span><span class="token punctuation">)</span>      ex<span class="token punctuation">.</span>printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">case</span> ex<span class="token operator">:</span> Exception <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>      <span class="token comment">// å¯¹å¼‚å¸¸å¤„ç†</span>      println<span class="token punctuation">(</span><span class="token string">"å‘ç”Ÿäº†å¼‚å¸¸ 1"</span><span class="token punctuation">)</span>      println<span class="token punctuation">(</span><span class="token string">"å‘ç”Ÿäº†å¼‚å¸¸ 2"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token string">"finally"</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>å‘ç”Ÿç®—æœ¯å¼‚å¸¸<span class="token keyword">finally</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ArithmeticException<span class="token operator">:</span> <span class="token operator">/</span> by zeroat com<span class="token punctuation">.</span>kk1<span class="token punctuation">.</span>demo7<span class="token punctuation">.</span>TestMatchCase$<span class="token punctuation">.</span>delayedEndpoint$com$kk1$demo7$TestMatchCase$<span class="token number">1</span><span class="token punctuation">(</span>TestMatchCase<span class="token punctuation">.</span>scala<span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">)</span>ã€‚ã€‚ã€‚ã€‚ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>ä¸ç®¡æœ‰æ²¡æœ‰å¼‚å¸¸æ•è·ï¼Œéƒ½ä¼šæ‰§è¡Œ finallyï¼Œå› æ­¤é€šå¸¸å¯ä»¥åœ¨ finally ä»£ç å—ä¸­é‡Šæ”¾èµ„æº</p></li><li><p>å¯ä»¥æœ‰å¤šä¸ª catchï¼Œåˆ†åˆ«æ•è·å¯¹åº”çš„å¼‚å¸¸ï¼Œè¿™æ—¶éœ€è¦æŠŠèŒƒå›´å°çš„å¼‚å¸¸ç±»å†™åœ¨å‰é¢ï¼Œ æŠŠèŒƒå›´å¤§çš„å¼‚å¸¸ç±»å†™åœ¨åé¢ï¼Œå¦åˆ™ç¼–è¯‘é”™è¯¯</p></li><li><p>Scala æ²¡æœ‰ â€œcheckedï¼ˆç¼–è¯‘æœŸï¼‰â€å¼‚å¸¸</p></li><li><p>ç”¨ throw å…³é”®å­—ï¼ŒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ã€‚æ‰€æœ‰å¼‚å¸¸éƒ½æ˜¯ Throwable çš„å­ç±»å‹ã€‚throw è¡¨ </p><p>è¾¾å¼æ˜¯æœ‰ç±»å‹çš„ï¼Œå°±æ˜¯ Nothingï¼Œå› ä¸º Nothing æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ï¼Œæ‰€ä»¥ throw è¡¨è¾¾å¼å¯ä»¥ç”¨åœ¨éœ€è¦ç±»å‹çš„åœ°æ–¹</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">Nothing</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> Exception<span class="token punctuation">(</span><span class="token string">"ä¸å¯¹"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><ul><li><p>java æä¾›äº† throws å…³é”®å­—æ¥å£°æ˜å¼‚å¸¸ã€‚å¯ä»¥ä½¿ç”¨æ–¹æ³•å®šä¹‰å£°æ˜å¼‚å¸¸ã€‚å®ƒå‘è°ƒç”¨è€…å‡½æ•°æä¾›äº†æ­¤æ–¹æ³•å¯èƒ½å¼•å‘æ­¤å¼‚å¸¸çš„ä¿¡æ¯ã€‚å®ƒæœ‰åŠ©äºè°ƒç”¨å‡½æ•°å¤„ç†å¹¶å°†è¯¥ä»£ç åŒ…å«åœ¨ try-catch å—ä¸­ï¼Œä»¥é¿å…ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ã€‚åœ¨ Scala ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ throws æ³¨è§£æ¥å£°æ˜å¼‚å¸¸ </p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    f11<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token annotation punctuation">@throws</span><span class="token punctuation">(</span>classOf<span class="token punctuation">[</span>NumberFormatException<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> f11<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"abc"</span><span class="token punctuation">.</span>toInt  <span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>Exception in thread <span class="token string">"main"</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>NumberFormatException<span class="token operator">:</span> For input string<span class="token operator">:</span> <span class="token string">"abc"</span>ã€‚ã€‚ã€‚ã€‚ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="ä¹ã€éšå¼è½¬æ¢"><a href="#ä¹ã€éšå¼è½¬æ¢" class="headerlink" title="ä¹ã€éšå¼è½¬æ¢"></a>ä¹ã€éšå¼è½¬æ¢</h2><p><strong>å½“ç¼–è¯‘å™¨ç¬¬ä¸€æ¬¡ç¼–è¯‘å¤±è´¥çš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰çš„ç¯å¢ƒä¸­æŸ¥æ‰¾èƒ½è®©ä»£ç ç¼–è¯‘é€šè¿‡çš„æ–¹æ³•ï¼Œç”¨äºå°†ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œå®ç°äºŒæ¬¡ç¼–è¯‘</strong></p><h3 id="1ã€éšå¼å‡½æ•°"><a href="#1ã€éšå¼å‡½æ•°" class="headerlink" title="1ã€éšå¼å‡½æ•°"></a>1ã€éšå¼å‡½æ•°</h3><p><strong>å£°æ˜ï¼šimplicit</strong></p><p>è¯´æ˜ï¼šéšå¼è½¬æ¢å¯ä»¥åœ¨ä¸ä¿®æ”¹ä»»ä½•ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ‰©å±•æŸä¸ªç±»çš„åŠŸèƒ½</p><p>éœ€æ±‚ï¼šé€šè¿‡éšå¼è½¬åŒ–ä¸º Int ç±»å‹å¢åŠ æ–¹æ³•</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>demo7</span><span class="token keyword">class</span> MyRichInt<span class="token punctuation">(</span><span class="token keyword">val</span> <span class="token keyword">self</span><span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">def</span> myMax<span class="token punctuation">(</span>i<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span> <span class="token operator">&lt;</span> i<span class="token punctuation">)</span> i <span class="token keyword">else</span> <span class="token keyword">self</span>  <span class="token punctuation">}</span>  <span class="token keyword">def</span> myMin<span class="token punctuation">(</span>i<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span> <span class="token operator">&lt;</span> i<span class="token punctuation">)</span> <span class="token keyword">self</span> <span class="token keyword">else</span> i  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">object</span> TestImplicitFunction <span class="token punctuation">{</span>  <span class="token comment">// ä½¿ç”¨ implicit å…³é”®å­—å£°æ˜çš„å‡½æ•°ç§°ä¹‹ä¸ºéšå¼å‡½æ•°</span>  <span class="token keyword">implicit</span> <span class="token keyword">def</span> convert<span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> MyRichInt <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">new</span> MyRichInt<span class="token punctuation">(</span>arg<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment">// å½“æƒ³è°ƒç”¨å¯¹è±¡åŠŸèƒ½æ—¶ï¼Œå¦‚æœç¼–è¯‘é”™è¯¯ï¼Œ</span>    <span class="token comment">// é‚£ä¹ˆç¼–è¯‘å™¨ä¼šå°è¯•åœ¨å½“å‰ä½œç”¨åŸŸèŒƒå›´å†…æŸ¥æ‰¾èƒ½è°ƒç”¨å¯¹åº”åŠŸèƒ½çš„è½¬æ¢è§„åˆ™ï¼Œ</span>    <span class="token comment">// è¿™ä¸ªè°ƒç”¨è¿‡ç¨‹æ˜¯ç”±ç¼–è¯‘å™¨å®Œæˆçš„ï¼Œ</span>    <span class="token comment">// æ‰€ä»¥ç§°ä¹‹ä¸ºéšå¼è½¬æ¢ã€‚ ä¹Ÿç§°ä¹‹ä¸ºè‡ªåŠ¨è½¬æ¢</span>    println<span class="token punctuation">(</span><span class="token number">2.</span>myMax<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2ã€éšå¼å‚æ•°"><a href="#2ã€éšå¼å‚æ•°" class="headerlink" title="2ã€éšå¼å‚æ•°"></a>2ã€éšå¼å‚æ•°</h3><p>æ™®é€šæ–¹æ³•æˆ–è€…å‡½æ•°ä¸­çš„å‚æ•°å¯ä»¥é€šè¿‡ <strong>implicit</strong> å…³é”®å­—å£°æ˜ä¸ºéšå¼å‚æ•°ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œ å°±å¯ä»¥ä¼ å…¥è¯¥å‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç›¸åº”çš„ä½œç”¨åŸŸå¯»æ‰¾ç¬¦åˆæ¡ä»¶çš„éšå¼å€¼</p><ul><li>åŒä¸€ä¸ªä½œç”¨åŸŸä¸­ï¼Œç›¸åŒç±»å‹çš„éšå¼å€¼åªèƒ½æœ‰ä¸€ä¸ª</li><li>ç¼–è¯‘å™¨æŒ‰ç…§éšå¼å‚æ•°çš„ç±»å‹å»å¯»æ‰¾å¯¹åº”ç±»å‹çš„éšå¼å€¼ï¼Œä¸éšå¼å€¼çš„åç§°æ— å…³</li><li>éšå¼å‚æ•°ä¼˜å…ˆäºé»˜è®¤å‚æ•°</li></ul><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">object</span> TestImplicitParameter <span class="token punctuation">{</span>  <span class="token keyword">implicit</span> <span class="token keyword">val</span> str<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"hello world!"</span>  <span class="token keyword">def</span> hello<span class="token punctuation">(</span><span class="token keyword">implicit</span> arg<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"good bey world!"</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span>arg<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    hello  <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>hello world<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€éšå¼ç±»"><a href="#3ã€éšå¼ç±»" class="headerlink" title="3ã€éšå¼ç±»"></a>3ã€éšå¼ç±»</h3><p>åœ¨ Scala2.10 åæä¾›äº†éšå¼ç±»ï¼Œå¯ä»¥ä½¿ç”¨ <strong>implicit</strong> å£°æ˜ç±»ï¼Œéšå¼ç±»çš„éå¸¸å¼ºå¤§ï¼ŒåŒæ ·å¯ä»¥æ‰©å±•ç±»çš„åŠŸèƒ½ï¼Œåœ¨é›†åˆä¸­éšå¼ç±»ä¼šå‘æŒ¥é‡è¦çš„ä½œç”¨</p><ul><li>å…¶æ‰€å¸¦çš„æ„é€ å‚æ•°æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ª</li><li>éšå¼ç±»å¿…é¡»è¢«å®šä¹‰åœ¨â€œç±»â€æˆ–â€œä¼´ç”Ÿå¯¹è±¡â€æˆ–â€œåŒ…å¯¹è±¡â€é‡Œï¼Œå³éšå¼ç±»ä¸èƒ½æ˜¯<strong>é¡¶çº§çš„</strong></li></ul><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">object</span> TestImplicitClass <span class="token punctuation">{</span>  <span class="token keyword">implicit</span> <span class="token keyword">class</span> MyRichInt<span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">def</span> myMax<span class="token punctuation">(</span>i<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token operator">&lt;</span> i<span class="token punctuation">)</span> i <span class="token keyword">else</span> arg    <span class="token punctuation">}</span>    <span class="token keyword">def</span> myMin<span class="token punctuation">(</span>i<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token operator">&lt;</span> i<span class="token punctuation">)</span> arg <span class="token keyword">else</span> i    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    println<span class="token punctuation">(</span><span class="token number">1.</span>myMax<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åã€æ³›å‹"><a href="#åã€æ³›å‹" class="headerlink" title="åã€æ³›å‹"></a>åã€æ³›å‹</h2><h3 id="1ã€åå˜å’Œé€†å˜"><a href="#1ã€åå˜å’Œé€†å˜" class="headerlink" title="1ã€åå˜å’Œé€†å˜"></a>1ã€<strong>åå˜å’Œé€†å˜</strong></h3><p>1ã€è¯­æ³•</p><p>class MyList[<font color="red">+T</font>]{ //åå˜ }  </p><p>class MyList[<font color="red">-T</font>]{ //é€†å˜ } </p><p>class MyList[<font color="red">T</font>] //ä¸å˜ </p><p>2ã€è¯´æ˜</p><p>åå˜ï¼šSon æ˜¯ Father çš„å­ç±»ï¼Œåˆ™ MyList[Son] ä¹Ÿä½œä¸º MyList[Father]çš„â€œå­ç±»â€</p><p>é€†å˜ï¼šSon æ˜¯ Father çš„å­ç±»ï¼Œåˆ™ MyList[Son]ä½œä¸º MyList[Father]çš„â€œçˆ¶ç±»â€</p><p>ä¸å˜ï¼šSon æ˜¯ Father çš„å­ç±»ï¼Œåˆ™ MyList[Father]ä¸ MyList[Son]â€œæ— çˆ¶å­å…³ç³»â€</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token comment">//æ³›å‹æ¨¡æ¿</span><span class="token comment">//  class MyList&lt;T&gt;{}</span><span class="token comment">//ä¸å˜</span><span class="token comment">//  class MyList[T]{}</span><span class="token comment">//åå˜</span><span class="token keyword">class</span> MyList<span class="token punctuation">[</span><span class="token operator">+</span>T<span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">//é€†å˜</span><span class="token comment">//  class MyList[-T]{}</span><span class="token keyword">class</span> Parent <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">class</span> Child <span class="token keyword">extends</span> Parent <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">class</span> SubChild <span class="token keyword">extends</span> Child <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">object</span> Scala_TestGeneric <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> s<span class="token operator">:</span> MyList<span class="token punctuation">[</span>Child<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> MyList<span class="token punctuation">[</span>SubChild<span class="token punctuation">]</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2ã€æ³›å‹ä¸Šä¸‹é™"><a href="#2ã€æ³›å‹ä¸Šä¸‹é™" class="headerlink" title="2ã€æ³›å‹ä¸Šä¸‹é™"></a>2ã€<strong>æ³›å‹ä¸Šä¸‹é™</strong></h3><p>1ã€è¯­æ³•</p><p>Class PersonList[T &lt;: Person]{ //æ³›å‹ä¸Šé™ } </p><p>Class PersonList[T &gt;: Person]{ //æ³›å‹ä¸‹é™ }</p><p>2ã€è¯´æ˜ï¼šæ³›å‹çš„ä¸Šä¸‹é™çš„ä½œç”¨æ˜¯å¯¹ä¼ å…¥çš„æ³›å‹è¿›è¡Œé™å®š</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">class</span> Parent <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">class</span> Child <span class="token keyword">extends</span> Parent <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">class</span> SubChild <span class="token keyword">extends</span> Child <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">object</span> Scala_TestGeneric <span class="token punctuation">{</span>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>    test<span class="token punctuation">(</span>classOf<span class="token punctuation">[</span>SubChild<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">//test[Child](new SubChild)</span>  <span class="token punctuation">}</span>  <span class="token comment">//æ³›å‹é€šé…ç¬¦ä¹‹ä¸Šé™</span>  <span class="token keyword">def</span> test<span class="token punctuation">[</span>A <span class="token operator">&lt;</span><span class="token operator">:</span> Child<span class="token punctuation">]</span><span class="token punctuation">(</span>a<span class="token operator">:</span>Class<span class="token punctuation">[</span>A<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span><span class="token punctuation">{</span>   println<span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token comment">//æ³›å‹é€šé…ç¬¦ä¹‹ä¸‹é™</span><span class="token comment">//  def test[A &gt;: Child](a:Class[A]): Unit ={</span><span class="token comment">//   println(a)</span><span class="token comment">//  }</span>  <span class="token comment">//æ³›å‹é€šé…ç¬¦ä¹‹ä¸‹é™ å½¢å¼æ‰©å±•</span>  <span class="token keyword">def</span> test<span class="token punctuation">[</span>A <span class="token operator">&gt;</span><span class="token operator">:</span> Child<span class="token punctuation">]</span><span class="token punctuation">(</span>a<span class="token operator">:</span>A<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span><span class="token punctuation">{</span>    println<span class="token punctuation">(</span>a<span class="token punctuation">.</span>getClass<span class="token punctuation">.</span>getName<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>è¾“å‡º<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token keyword">class</span> com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>demo7<span class="token punctuation">.</span>SubChild<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€ä¸Šä¸‹æ–‡é™å®š"><a href="#3ã€ä¸Šä¸‹æ–‡é™å®š" class="headerlink" title="3ã€ä¸Šä¸‹æ–‡é™å®š"></a>3ã€<strong>ä¸Šä¸‹æ–‡é™å®š</strong></h3><p>1ã€è¯­æ³•</p><p>def f[<font color="red">A : B</font>](a: A) = println(a) //ç­‰åŒäº def f[<font color="red">A</font>](a:A)<font color="red">(implicit arg:B[A])</font>=println(a)</p><p>2ã€è¯´æ˜</p><p>ä¸Šä¸‹æ–‡é™å®šæ˜¯å°†æ³›å‹å’Œéšå¼è½¬æ¢çš„ç»“åˆäº§ç‰©ï¼Œä»¥ä¸‹ä¸¤è€…åŠŸèƒ½ç›¸åŒï¼Œä½¿ç”¨ä¸Šä¸‹æ–‡é™å®š[A :  Ordering]ä¹‹åï¼Œæ–¹æ³•å†…æ— æ³•ä½¿ç”¨éšå¼å‚æ•°åè°ƒç”¨éšå¼å‚æ•°ï¼Œéœ€è¦é€šè¿‡ <font color="red">implicitly[Ordering[A]] </font>ï¼Œè·å–éšå¼å˜é‡ï¼Œå¦‚æœæ­¤æ—¶æ— æ³•æŸ¥æ‰¾åˆ°å¯¹åº”ç±»å‹çš„éšå¼å˜é‡ï¼Œä¼šå‘ç”Ÿå‡ºé”™è¯¯</p><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala"><span class="token keyword">def</span> f<span class="token punctuation">[</span>A<span class="token operator">:</span>Ordering<span class="token punctuation">]</span><span class="token punctuation">(</span>a<span class="token operator">:</span>A<span class="token punctuation">,</span>b<span class="token operator">:</span>A<span class="token punctuation">)</span> <span class="token operator">=</span>implicitly<span class="token punctuation">[</span>Ordering<span class="token punctuation">[</span>A<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>compare<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token keyword">def</span> f<span class="token punctuation">[</span>A<span class="token punctuation">]</span><span class="token punctuation">(</span>a<span class="token operator">:</span> A<span class="token punctuation">,</span> b<span class="token operator">:</span> A<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> ord<span class="token operator">:</span> Ordering<span class="token punctuation">[</span>A<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> ord<span class="token punctuation">.</span>compare<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å‚è€ƒæ–‡ç« -â†“"><a href="#å‚è€ƒæ–‡ç« -â†“" class="headerlink" title="å‚è€ƒæ–‡ç«  â†“"></a>å‚è€ƒæ–‡ç«  â†“</h2><p>springbootæ··åˆåŒè¯­è¨€å¼€å‘é—®é¢˜ï¼š</p><p><a href="https://www.cnblogs.com/zlslch/p/8553958.html">https://www.cnblogs.com/zlslch/p/8553958.html</a></p><p><a href="https://www.jianshu.com/p/6d241e5dbe7e">https://www.jianshu.com/p/6d241e5dbe7e</a></p><p><a href="https://blog.csdn.net/u014331143/article/details/127609845">https://blog.csdn.net/u014331143/article/details/127609845</a></p><p>SpringMVCå‚è€ƒï¼š<a href="https://vimsky.com/examples/detail/scala-class-org.springframework.beans.factory.annotation.Autowired.html">https://vimsky.com/examples/detail/scala-class-org.springframework.beans.factory.annotation.Autowired.html</a></p><p>é›†åˆï¼š</p><p><a href="https://blog.csdn.net/chaohui2638457321/article/details/121904744">https://blog.csdn.net/chaohui2638457321/article/details/121904744</a></p><p><a href="https://blog.csdn.net/shuyv/article/details/121254677">https://blog.csdn.net/shuyv/article/details/121254677</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="è®¡ç®—æœºè¯­è¨€" scheme="https://mykkto.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/"/>
    
    
    <category term="å¤§æ•°æ®" scheme="https://mykkto.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    <category term="spark" scheme="https://mykkto.github.io/tags/spark/"/>
    
    <category term="scala" scheme="https://mykkto.github.io/tags/scala/"/>
    
  </entry>
  
  <entry>
    <title>é¢è¯•é¢˜-03(å…³äºCloud)</title>
    <link href="https://mykkto.github.io/posts/45f5cab5.html"/>
    <id>https://mykkto.github.io/posts/45f5cab5.html</id>
    <published>2023-02-15T14:28:51.000Z</published>
    <updated>2023-04-12T15:41:49.238Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h2><p>é¸£è°¢ç»™ç«™é•¿æŠ•ç¨¿é—®é¢˜çš„åŒè¡Œæœ‹å‹ï¼Œå±…å¤šéƒ½æ˜¯å°ä¼™ä¼´é¢è¯•è¢«é—®åˆ°çš„é—®é¢˜ï¼Œä»¥åŠæ‰©å±•</p><p>æœ¬ç« é’ˆå¯¹ ä¸­é«˜å¼€å²—ä½é¢˜ç›®ç”„é€‰ï¼Œå¦‚æœ‰ä¸è¶³è¿˜è¯·è¯„è®ºåŒºæŒ‡æ•™ï¼Œæ„Ÿè°¢ï¼</p><h2 id="ç›®å½•ï¼š"><a href="#ç›®å½•ï¼š" class="headerlink" title="ç›®å½•ï¼š"></a>ç›®å½•ï¼š</h2><ul><li><p>ä½ æœ‰è¿‡SpringCloud ï¼Ÿ</p></li><li><p>æ³¨å†Œä¸­å¿ƒ</p><ul><li>é‚£å‡ æ¬¾ï¼Ÿå¯¹æ¯”ï¼Ÿ</li><li>æœåŠ¡å‘ç°æµç¨‹ï¼ŒåŸç†ï¼Ÿ</li></ul></li><li><p>ç†”æ–­å™¨</p><ul><li>é‚£å‡ æ¬¾ï¼Ÿå¯¹æ¯”ï¼Ÿ</li></ul></li><li><p>MySQL</p><ul><li>æ‰§è¡Œæµç¨‹ï¼ˆ5.7 ï¼‰</li><li></li></ul></li></ul><h2 id="ä¸€ã€ä½ æœ‰è¿‡SpringCloud-ï¼Ÿ"><a href="#ä¸€ã€ä½ æœ‰è¿‡SpringCloud-ï¼Ÿ" class="headerlink" title="ä¸€ã€ä½ æœ‰è¿‡SpringCloud ï¼Ÿ"></a>ä¸€ã€ä½ æœ‰è¿‡SpringCloud ï¼Ÿ</h2><p>å½“ç„¶ï¼Œå¦‚æœæŒ‰ç…§å‚å•†åˆ†ä¸ºä¸¤ç§ï¼šNetflix å’Œ alibaba ï¼›å¦‚æœæŒ‰ç…§æŠ€æœ¯æ ˆåˆ™åˆ†ä¸ºï¼Œæ³¨å†Œä¸­å¿ƒã€é…ç½®ä¸­å¿ƒã€ç½‘å…³ã€ç†”æ–­å™¨ã€æœåŠ¡è°ƒç”¨ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€é“¾è·¯è¿½è¸ªç­‰ï¼Œä¸è¿‡æ ¸å¿ƒçš„ç»„ä»¶æœ‰äº”å¤§ï¼Œcloudæ˜¯ eureka,feign,ribbon,hystrix,zuulï¼Œalibbaba:nacos,sentinel,gateway.</p><p>ç¤¾åŒºæ´»è·ƒï¼Œä½ åœ¨ç”Ÿäº§ä¸Šé‡åˆ°çš„é—®é¢˜ä¸æ˜¯ç¬¬ä¸€ä¸ªé‡åˆ°ï¼Œæ•™ç¨‹å¤š</p><h3 id="1ã€å¸¸è§„é¢˜ï¼ˆæ”¾æ¾ç‰ˆï¼‰"><a href="#1ã€å¸¸è§„é¢˜ï¼ˆæ”¾æ¾ç‰ˆï¼‰" class="headerlink" title="1ã€å¸¸è§„é¢˜ï¼ˆæ”¾æ¾ç‰ˆï¼‰"></a>1ã€å¸¸è§„é¢˜ï¼ˆæ”¾æ¾ç‰ˆï¼‰</h3><h4 id="1-Nacoså¦‚ä½•æ”¯æ’‘é˜¿é‡Œå†…éƒ¨æ•°åä¸‡æœåŠ¡æ³¨å†Œå‹åŠ›"><a href="#1-Nacoså¦‚ä½•æ”¯æ’‘é˜¿é‡Œå†…éƒ¨æ•°åä¸‡æœåŠ¡æ³¨å†Œå‹åŠ›" class="headerlink" title="1.Nacoså¦‚ä½•æ”¯æ’‘é˜¿é‡Œå†…éƒ¨æ•°åä¸‡æœåŠ¡æ³¨å†Œå‹åŠ›"></a>1.Nacoså¦‚ä½•æ”¯æ’‘é˜¿é‡Œå†…éƒ¨æ•°åä¸‡æœåŠ¡æ³¨å†Œå‹åŠ›</h4><p>Nacoså†…éƒ¨æ¥æ”¶åˆ°æ³¨å†Œçš„è¯·æ±‚æ—¶ï¼Œä¸ä¼šç«‹å³å†™æ•°æ®ï¼Œè€Œæ˜¯å°†æœåŠ¡æ³¨å†Œçš„ä»»åŠ¡æ”¾å…¥ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—å°±ç«‹å³å“åº”ç»™å®¢æˆ·ç«¯ã€‚ç„¶ååˆ©ç”¨çº¿ç¨‹æ± è¯»å–é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå¼‚æ­¥æ¥å®Œæˆå®ä¾‹æ›´æ–°ï¼Œä»è€Œæé«˜å¹¶å‘å†™èƒ½åŠ›ã€‚</p><h4 id="2-Nacoså¦‚ä½•é¿å…å¹¶å‘è¯»å†™å†²çªé—®é¢˜"><a href="#2-Nacoså¦‚ä½•é¿å…å¹¶å‘è¯»å†™å†²çªé—®é¢˜" class="headerlink" title="2.Nacoså¦‚ä½•é¿å…å¹¶å‘è¯»å†™å†²çªé—®é¢˜"></a>2.Nacoså¦‚ä½•é¿å…å¹¶å‘è¯»å†™å†²çªé—®é¢˜</h4><p>Nacosåœ¨æ›´æ–°å®ä¾‹åˆ—è¡¨æ—¶ï¼Œä¼šé‡‡ç”¨CopyOnWriteæŠ€æœ¯ï¼Œé¦–å…ˆå°†æ—§çš„å®ä¾‹åˆ—è¡¨æ‹·è´ä¸€ä»½ï¼Œç„¶åæ›´æ–°æ‹·è´çš„å®ä¾‹åˆ—è¡¨ï¼Œå†ç”¨æ›´æ–°åçš„å®ä¾‹åˆ—è¡¨æ¥è¦†ç›–æ—§çš„å®ä¾‹åˆ—è¡¨ã€‚</p><p>è¿™æ ·åœ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¸ä¼šå¯¹è¯»å®ä¾‹åˆ—è¡¨çš„è¯·æ±‚äº§ç”Ÿå½±å“ï¼Œä¹Ÿä¸ä¼šå‡ºç°è„è¯»é—®é¢˜äº†ã€‚</p><h4 id="3-Nacosä¸Eurekaçš„åŒºåˆ«æœ‰å“ªäº›"><a href="#3-Nacosä¸Eurekaçš„åŒºåˆ«æœ‰å“ªäº›" class="headerlink" title="3.Nacosä¸Eurekaçš„åŒºåˆ«æœ‰å“ªäº›"></a>3.Nacosä¸Eurekaçš„åŒºåˆ«æœ‰å“ªäº›</h4><ul><li><p><strong>å®ä¾‹ç±»å‹</strong>ï¼šNacosçš„å®ä¾‹æœ‰æ°¸ä¹…å’Œä¸´æ—¶å®ä¾‹ä¹‹åˆ†ï¼›è€ŒEurekaåªæ”¯æŒä¸´æ—¶å®ä¾‹</p></li><li><p><strong>å¥åº·æ£€æµ‹</strong>ï¼šNacoså¯¹ä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼æ£€æµ‹ï¼Œå¯¹æ°¸ä¹…å®ä¾‹é‡‡ç”¨ä¸»åŠ¨è¯·æ±‚æ¥æ£€æµ‹ï¼›Eurekaåªæ”¯æŒå¿ƒè·³æ¨¡å¼</p></li><li><p><strong>æœåŠ¡å‘ç°</strong>ï¼šNacosæ”¯æŒå®šæ—¶æ‹‰å–å’Œè®¢é˜…æ¨é€ä¸¤ç§æ¨¡å¼ï¼›Eurekaåªæ”¯æŒå®šæ—¶æ‹‰å–æ¨¡å¼</p></li><li><p><strong>CAPç†è®º</strong>ï¼šeurekaåªæ”¯æŒAPï¼Œnacosæ”¯æŒCPå’ŒAPä¸¤ç§</p><ul><li><p>nacosæ˜¯æ ¹æ®é…ç½®è¯†åˆ«CPæˆ–APæ¨¡å¼,å¦‚æœæ³¨å†ŒNacosçš„clientèŠ‚ç‚¹æ³¨å†Œæ—¶æ˜¯ephemeral=trueå³ä¸ºä¸´æ—¶èŠ‚ç‚¹,é‚£ä¹ˆNaocsé›†ç¾¤å¯¹è¿™ä¸ªclientèŠ‚ç‚¹æ•ˆæœå°±æ˜¯AP,åä¹‹åˆ™æ˜¯CP,å³ä¸æ˜¯ä¸´æ—¶èŠ‚ç‚¹</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#falseä¸ºæ°¸ä¹…å®ä¾‹ï¼Œtrueè¡¨ç¤ºä¸´æ—¶å®ä¾‹å¼€å¯ï¼Œæ³¨å†Œä¸ºä¸´æ—¶å®ä¾‹</span><span class="token attr-name"> spring.cloud.nacos.discovery.ephemeral</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul></li></ul><ul><li><p><strong>è¿æ¥æ–¹å¼ï¼š</strong></p><ul><li>nacosä½¿ç”¨çš„æ˜¯nettyå’ŒæœåŠ¡ç›´æ¥è¿›è¡Œè¿æ¥,å±äºé•¿è¿æ¥</li><li>eurekaæ˜¯ä½¿ç”¨å®šæ—¶å‘é€å’ŒæœåŠ¡è¿›è¡Œè”ç³»,å±äºçŸ­è¿æ¥</li></ul></li><li></li></ul><h4 id="4-Sentinelçš„é™æµä¸Gatewayçš„é™æµæœ‰ä»€ä¹ˆå·®åˆ«"><a href="#4-Sentinelçš„é™æµä¸Gatewayçš„é™æµæœ‰ä»€ä¹ˆå·®åˆ«" class="headerlink" title="4.Sentinelçš„é™æµä¸Gatewayçš„é™æµæœ‰ä»€ä¹ˆå·®åˆ«"></a>4.Sentinelçš„é™æµä¸Gatewayçš„é™æµæœ‰ä»€ä¹ˆå·®åˆ«</h4><p>é™æµç®—æ³•å¸¸è§çš„æœ‰ä¸‰ç§å®ç°ï¼šæ»‘åŠ¨æ—¶é—´çª—å£ã€ä»¤ç‰Œæ¡¶ç®—æ³•ã€æ¼æ¡¶ç®—æ³•ã€‚Gatewayåˆ™é‡‡ç”¨äº†åŸºäºRediså®ç°çš„ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚</p><p>è€ŒSentinelå†…éƒ¨å´æ¯”è¾ƒå¤æ‚ï¼š</p><ul><li>é»˜è®¤é™æµæ¨¡å¼æ˜¯åŸºäºæ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•</li><li>æ’é˜Ÿç­‰å¾…çš„é™æµæ¨¡å¼åˆ™åŸºäºæ¼æ¡¶ç®—æ³•</li><li>è€Œçƒ­ç‚¹å‚æ•°é™æµåˆ™æ˜¯åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•</li></ul><h4 id="5-Sentinelçš„çº¿ç¨‹éš”ç¦»ä¸Hystixçš„çº¿ç¨‹éš”ç¦»æœ‰ä»€ä¹ˆå·®åˆ«"><a href="#5-Sentinelçš„çº¿ç¨‹éš”ç¦»ä¸Hystixçš„çº¿ç¨‹éš”ç¦»æœ‰ä»€ä¹ˆå·®åˆ«" class="headerlink" title="5.Sentinelçš„çº¿ç¨‹éš”ç¦»ä¸Hystixçš„çº¿ç¨‹éš”ç¦»æœ‰ä»€ä¹ˆå·®åˆ«"></a>5.Sentinelçš„çº¿ç¨‹éš”ç¦»ä¸Hystixçš„çº¿ç¨‹éš”ç¦»æœ‰ä»€ä¹ˆå·®åˆ«</h4><p>Hystixé»˜è®¤æ˜¯åŸºäºçº¿ç¨‹æ± å®ç°çš„çº¿ç¨‹éš”ç¦»ï¼Œæ¯ä¸€ä¸ªè¢«éš”ç¦»çš„ä¸šåŠ¡éƒ½è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹è¿‡å¤šä¼šå¸¦æ¥é¢å¤–çš„CPUå¼€é”€ï¼Œæ€§èƒ½ä¸€èˆ¬ï¼Œä½†æ˜¯éš”ç¦»æ€§æ›´å¼ºã€‚</p><p>Sentinelæ˜¯åŸºäºä¿¡å·é‡ï¼ˆè®¡æ•°å™¨ï¼‰å®ç°çš„çº¿ç¨‹éš”ç¦»ï¼Œä¸ç”¨åˆ›å»ºçº¿ç¨‹æ± ï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œä½†æ˜¯éš”ç¦»æ€§ä¸€èˆ¬ã€‚</p><h3 id="1ã€æ³¨å†Œä¸­å¿ƒ"><a href="#1ã€æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="1ã€æ³¨å†Œä¸­å¿ƒ"></a>1ã€æ³¨å†Œä¸­å¿ƒ</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220223225739.png"></p><h4 id="Eureka"><a href="#Eureka" class="headerlink" title="====Eureka====="></a>====Eureka=====</h4><p>åŒ…å«2ä¸ªç»„ä»¶ï¼šeureka server å’Œeureka client</p><p>æ³¨å†Œä¸­å¿ƒï¼ŒåŒ…å«äº†æœåŠ¡å‘ç°ã€æ²»ç†ç­‰åŠŸèƒ½ã€‚@EnableEurekaServerï¼Œä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼›</p><p>@EnableEurekaClientï¼Œä½œä¸ºæœåŠ¡çš„æä¾›è€…ã€æˆ–æ¶ˆè´¹è€…ã€‚ä¸‹é¢åˆ†æä¸‹æœåŠ¡å‘ç°å’Œæ²»ç†ã€‚</p><h4 id="1ã€æ³¨å†ŒæœåŠ¡äºå‘ç°æµç¨‹ï¼ˆeurekaï¼‰"><a href="#1ã€æ³¨å†ŒæœåŠ¡äºå‘ç°æµç¨‹ï¼ˆeurekaï¼‰" class="headerlink" title="1ã€æ³¨å†ŒæœåŠ¡äºå‘ç°æµç¨‹ï¼ˆeurekaï¼‰"></a>1ã€æ³¨å†ŒæœåŠ¡äºå‘ç°æµç¨‹ï¼ˆeurekaï¼‰</h4><ul><li>å½“EurekaClientå¯åŠ¨åï¼Œé¦–å…ˆä¼šæ‰§è¡ŒæœåŠ¡æ³¨å†Œã€‚</li><li>EurekaClientå°†æœåŠ¡ä¿¡æ¯å°è£…æˆInstanceInfoå¯¹è±¡ï¼Œé€šè¿‡EurekaHttpClientè°ƒç”¨registeræ–¹æ³•å‘é€POSTè¯·æ±‚æ‰§è¡ŒæœåŠ¡æ³¨å†Œ</li><li>EurekaServeræä¾›äº†åŸºäºJerseyçš„Resté£æ ¼çš„æ¥å£ï¼Œåœ¨ApplicationResourceç±»ä¸­æä¾›äº†addInstanceæ–¹æ³•ç”¨æ¥æ¥æ”¶æ³¨å†Œä¿¡æ¯ã€‚å¦‚æœæ³¨å†ŒæœåŠ¡å™¨ä¿¡æ¯é€šè¿‡æ ¡éªŒï¼Œå°†æœåŠ¡ä¿¡æ¯ä¿å­˜è‡³æœ¬åœ°æ³¨å†Œè¡¨ã€‚æ•°æ®ç»“æ„ä¸ºåŒå±‚ConcurrentHashMapï¼Œå¤–å±‚mapï¼škeyæ˜¯åº”ç”¨åï¼Œå†…å±‚mapï¼škeyæ˜¯åº”ç”¨å®ä¾‹ä¿¡æ¯ç¼–å·ï¼Œvalueæ˜¯InstanceInfo</li><li>EurekaClientæ¥æ”¶å¹¶è§£ææ³¨å†Œç»“æœï¼Œåˆ¤æ–­httpResponseçš„statusCodeï¼Œå¦‚æœæ˜¯204åˆ™ä»£è¡¨æ³¨å†ŒæˆåŠŸ</li><li>è°ƒç”¨replicateToPeersæ–¹æ³•å°†æ­¤æ¬¡æ³¨å†Œä¿¡æ¯å¤åˆ¶åˆ°å¯¹ç­‰çš„EurekaèŠ‚ç‚¹</li></ul><p><strong>å®¢æˆ·ç«¯æ³¨å†Œ</strong>ï¼šEurekaå®¢æˆ·ç«¯åœ¨å¯åŠ¨æ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªå¿ƒè·³çš„å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯ä¼šå¯¹å®¢æˆ·ç«¯å¿ƒè·³åšå‡ºå“åº”ï¼Œå¦‚æœå“åº”çŠ¶æ€ç ä¸º404æ—¶ï¼Œè¡¨ç¤ºæœåŠ¡ç«¯æ²¡æœ‰è¯¥å®¢æˆ·ç«¯çš„æœåŠ¡ä¿¡æ¯ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯åˆ™ä¼šå‘æœåŠ¡ç«¯å‘é€æ³¨å†Œè¯·æ±‚ã€‚</p><p><strong>æœåŠ¡ç«¯å¦‚ä½•ä¿å­˜å®¢æˆ·ç«¯æ³¨å†Œä¿¡æ¯</strong>ï¼šå®¢æˆ·ç«¯é€šè¿‡Jerseyæ¡†æ¶ï¼Œå°†è‡ªå·±çš„æ³¨å†Œä¿¡æ¯å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¿å­˜åœ¨ä¸€ä¸ªConcurrentHashMapå¯¹è±¡ä¸­ã€‚</p><p><strong>å®¢æˆ·ç«¯å¦‚ä½•æ‹‰å–æœåŠ¡ç«¯å·²ä¿å­˜çš„æœåŠ¡ä¿¡æ¯ï¼š</strong>å®¢æˆ·ç«¯é€šè¿‡ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å®šæ—¶å‘æœåŠ¡ç«¯æ‹‰å–ä¿¡æ¯ï¼Œæ¯æ¬¡æ‹‰å–ååˆ·æ–°æœ¬åœ°å·²ä¿å­˜çš„ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨æ—¶ç›´æ¥ä»æœ¬åœ°è·å–ã€‚</p><h4 id="2ã€Eurekaå¿ƒè·³æœºåˆ¶"><a href="#2ã€Eurekaå¿ƒè·³æœºåˆ¶" class="headerlink" title="2ã€Eurekaå¿ƒè·³æœºåˆ¶"></a>2ã€Eurekaå¿ƒè·³æœºåˆ¶</h4><p><strong>å¿ƒè·³æœºåˆ¶</strong></p><p>å®¢æˆ·ç«¯æ¯éš”30sæƒ³æœåŠ¡ç«¯å‘é€ä¸€æ¬¡å¿ƒè·³ï¼Œå‘Šè¯‰æœåŠ¡ç«¯è‡ªå·±è¿˜æ´»ç€ã€‚</p><p><strong>æœåŠ¡å‰”é™¤æœºåˆ¶</strong></p><p>å¦‚æœå¼€äº†è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å®¢æˆ·ç«¯åŒ…æ‹¬æ²¡æœ‰é•¿æ—¶é—´æ²¡æœ‰å‘é€å¿ƒè·³çš„å®¢æˆ·ç«¯éƒ½ä¸ä¼šè¢«å‰”é™¤ã€‚<br>æ²¡å¼€è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œæ³¨å†Œåˆ°eurekaçš„æœåŠ¡å¯èƒ½ç”±äºå†…å­˜æº¢å‡ºæˆ–ç½‘ç»œæ•…éšœç­‰åŸå› ä½¿å¾—æœåŠ¡ä¸èƒ½æ­£å¸¸çš„å·¥ä½œï¼Œè€ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒå¹¶æœªæ”¶åˆ°â€œæœåŠ¡ä¸‹çº¿â€çš„è¯·æ±‚ã€‚æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ¨å¯åŠ¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œé»˜è®¤æ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤ä¸º60ç§’ï¼‰å°†å½“å‰æ¸…å•ä¸­è¶…æ—¶ï¼ˆé»˜è®¤ä¸º90ç§’ï¼‰æ²¡æœ‰ç»­çº¦çš„æœåŠ¡å‰”é™¤ï¼Œè¿™ä¸ªæ“ä½œè¢«ç§°ä¸ºå¤±æ•ˆå‰”é™¤</p><p><strong>Eurekaä¸ºä»€ä¹ˆè¦é‡‡ç”¨è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶</strong></p><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„CAPç†è®ºä¸­ï¼ŒEurekaé‡‡ç”¨çš„APï¼Œä¹Ÿå°±æ˜¯Eureakä¿è¯äº†æœåŠ¡çš„å¯ç”¨æ€§ï¼ˆAï¼‰ï¼Œè€Œèˆå¼ƒäº†æ•°æ®çš„ä¸€è‡´æ€§ï¼ˆCï¼‰ã€‚å½“ç½‘ç»œå‘ç”Ÿåˆ†åŒºæ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šè®¯å°†ä¼šç»ˆæ­¢ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯åœ¨ä¸€å®šçš„æ—¶é—´å†…å°†æ”¶ä¸åˆ°å¤§éƒ¨åˆ†çš„å®¢æˆ·ç«¯çš„ä¸€ä¸ªå¿ƒè·³ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™å°†è¿™äº›æ”¶ä¸åˆ°å¿ƒè·³</p><h4 id="3ã€Eurekaå®šæ—¶ä»»åŠ¡"><a href="#3ã€Eurekaå®šæ—¶ä»»åŠ¡" class="headerlink" title="3ã€Eurekaå®šæ—¶ä»»åŠ¡"></a>3ã€Eurekaå®šæ—¶ä»»åŠ¡</h4><h5 id="æ‹‰å–æœåŠ¡å™¨æ³¨å†Œå®ä¾‹"><a href="#æ‹‰å–æœåŠ¡å™¨æ³¨å†Œå®ä¾‹" class="headerlink" title="æ‹‰å–æœåŠ¡å™¨æ³¨å†Œå®ä¾‹"></a>æ‹‰å–æœåŠ¡å™¨æ³¨å†Œå®ä¾‹</h5><ul><li>è¯¥ä»»åŠ¡é€šè¿‡ ScheduledExecutorService æ¥å®ç°ä»»åŠ¡è°ƒåº¦ï¼Œæ‰§è¡Œå‘¨æœŸé»˜è®¤ä¸º 60 ç§’ä¸€æ¬¡</li><li>è·å–çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œå…¨é‡è·å–å’Œå¢é‡è·å–ã€‚ç¬¬ä¸€æ¬¡å…¨é‡è·å–ï¼Œåç»­å¢é‡è·å–ï¼›è·å–åˆ°æœåŠ¡å™¨æ³¨å†Œå®ä¾‹ä¿¡æ¯åï¼Œä¿å­˜ã€æˆ–æ›´æ–°åˆ°æœ¬åœ°</li></ul><p><strong>ç»­çº¦</strong><br>è¯¥ä»»åŠ¡é€šè¿‡ ScheduledExecutorService æ¥å®ç°ä»»åŠ¡è°ƒåº¦ï¼Œé»˜è®¤å‘¨æœŸä¸º 30 ç§’ä¸€æ¬¡ï¼Œ<br>é€šè¿‡ renew() æ–¹æ³•å‘èµ·ç»­çº¦è¯·æ±‚ã€‚å°† AppNameã€AppIdã€ä»¥åŠInstanceInfoä½œä¸ºå‚æ•°ï¼Œé€šè¿‡EurekaHttpClientå‘é€Httpè¯·æ±‚ EurekaServer é€šè¿‡ renewLease() æ–¹æ³•æ¥æ”¶ç»­çº¦è¯·æ±‚é¦–å…ˆæ ¹æ®AppNameä»æ³¨å†Œè¡¨ä¸­è·å–å¯¹åº”çš„æœåŠ¡ä¿¡æ¯ï¼Œå¹¶æ›´æ–°ä¸€äº›å±æ€§å¦‚renewsLastMinã€lastUpdateTimestamp<br>EurekaServer è¿”å›ç»“æœï¼Œ200 æˆ–è€… 404ï¼ŒEurekaClient æ¥æ”¶ç»­çº¦ç»“æœï¼›å¦‚æœæ˜¯ 404 åˆ™å‘èµ·ä¸€æ¬¡ register è¯·æ±‚ï¼›å¦‚æœæ˜¯ 200 åˆ™è¡¨ç¤ºç»­çº¦æˆåŠŸ</p><h4 id="Nacos"><a href="#Nacos" class="headerlink" title="=====Nacos====="></a>=====Nacos=====</h4><h4 id="1ã€Nacos-ä¸­çš„ä¿æŠ¤é˜ˆå€¼ä½œç”¨"><a href="#1ã€Nacos-ä¸­çš„ä¿æŠ¤é˜ˆå€¼ä½œç”¨" class="headerlink" title="1ã€Nacos ä¸­çš„ä¿æŠ¤é˜ˆå€¼ä½œç”¨"></a>1ã€Nacos ä¸­çš„ä¿æŠ¤é˜ˆå€¼ä½œç”¨</h4><p>å‡å¦‚ç°åœ¨æœ‰ä¸€ä¸ªæœåŠ¡ï¼Œæœ¬æ¥æœ‰10ä¸ªå®ä¾‹ï¼Œä½†æ˜¯ç°åœ¨æŒ‚æ‰äº†8ä¸ªï¼Œå‰©ä¸‹2ä¸ªæ­£å¸¸å®ä¾‹ï¼Œæ­¤æ—¶æœ¬æ¥ç”±10ä¸ªå®ä¾‹å¤„ç†çš„æµé‡ï¼Œå°±å…¨éƒ¨äº¤ç»™è¿™ä¸ªä¸¤ä¸ªæ­£å¸¸å®ä¾‹æ¥å¤„ç†äº†ï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªå®ä¾‹å¾ˆæœ‰å¯èƒ½æ˜¯å¤„ç†ä¸è¿‡æ¥çš„ï¼Œæœ€ç»ˆå¯¼è‡´è¢«å‹å®ï¼Œä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼›</p><p>Nacosæä¾›äº†ä¿æŠ¤é˜ˆå€¼è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æŸä¸ªæœåŠ¡è®¾ç½®ä¸€ä¸ª0-1çš„é˜ˆå€¼ï¼Œæ¯”å¦‚0.5ï¼Œé‚£å°±è¡¨ç¤ºï¼Œä¸€æ—¦å®ä¾‹ä¸­åªå‰©ä¸‹ä¸€åŠçš„å¥åº·å®ä¾‹äº†ï¼Œæ¯”å¦‚10ä¸ªå®ä¾‹ï¼Œåªå‰©ä¸‹5ä¸ªå¥åº·å®ä¾‹äº†ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…åœ¨è¿›è¡ŒæœåŠ¡å‘ç°æ—¶ï¼Œåˆ™ä¼šæŠŠè¯¥æœåŠ¡çš„æ‰€æœ‰å®ä¾‹ï¼Œä¹ŸåŒ…æ‹¬ä¸å¥åº·çš„å®ä¾‹éƒ½æ‹‰å–åˆ°æœ¬åœ°ï¼Œç„¶åå†ä»æ‰€æœ‰å®ä¾‹ä¸­è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œé€‰å‡ºä¸€ä¸ªå®ä¾‹è¿›è¡Œè°ƒç”¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€‰å‡ºæ¥çš„å³å¯èƒ½æ˜¯ä¸€ä¸ªå¥åº·çš„å®ä¾‹ï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‚æ‰çš„å®ä¾‹ï¼Œä½†æ˜¯é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¾ˆå¥½çš„ä¿æŠ¤çš„å‰©ä¸‹çš„å¥åº·å®ä¾‹ï¼Œè‡³å°‘ä¿è¯äº†ä¸€éƒ¨åˆ†è¯·æ±‚èƒ½æ­£å¸¸çš„è®¿é—®ï¼Œè€Œä¸è‡³äºæ‰€æœ‰è¯·æ±‚éƒ½ä¸èƒ½æ­£å¸¸è®¿é—®ï¼Œè¿™å°±æ˜¯Nacosä¸­çš„ä¿æŠ¤é˜ˆå€¼ï¼ŒåŒæ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½åœ¨Spring Cloud Tencentä¸­å«å…¨æ­»å…¨æ´»ã€‚</p><h4 id="2ã€Nacosä¸­çš„è´Ÿè½½å‡è¡¡"><a href="#2ã€Nacosä¸­çš„è´Ÿè½½å‡è¡¡" class="headerlink" title="2ã€Nacosä¸­çš„è´Ÿè½½å‡è¡¡"></a>2ã€Nacosä¸­çš„è´Ÿè½½å‡è¡¡</h4><p>Nacosçš„è´Ÿè½½å‡è¡¡æŒ‡çš„æ˜¯ï¼Œåœ¨è¿›è¡ŒæœåŠ¡å‘ç°æ—¶è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¼šæ ¹æ®æœåŠ¡åä»Nacosä¸­æ‹‰å–æ‰€æœ‰çš„å®ä¾‹ä¿¡æ¯ï¼Œæ‹‰å–å®ä¾‹æ—¶ï¼Œæ ¹æ®éšæœºç­–ç•¥åªæ‹‰å–åˆ°æ‰€æœ‰å®ä¾‹ä¸­çš„æŸä¸€ä¸ªï¼Œè¿™å°±æ˜¯Nacosä¸­çš„è´Ÿè½½å‡è¡¡ï¼Œå®ƒè·ŸRibbonçš„è´Ÿè½½å‡è¡¡å¹¶ä¸å†²çªï¼Œå¯ä»¥ç†è§£ä¸ºRibbonçš„è´Ÿè½½å‡è¡¡æ˜¯å‘ç”Ÿåœ¨Nacosçš„è´Ÿè½½å‡è¡¡ä¹‹åçš„</p><h4 id="3ã€Nacosçš„å°±è¿‘è®¿é—®æ˜¯ä»€ä¹ˆ"><a href="#3ã€Nacosçš„å°±è¿‘è®¿é—®æ˜¯ä»€ä¹ˆ" class="headerlink" title="3ã€Nacosçš„å°±è¿‘è®¿é—®æ˜¯ä»€ä¹ˆ"></a>3ã€Nacosçš„å°±è¿‘è®¿é—®æ˜¯ä»€ä¹ˆ</h4><p>åœ¨Nacosä¸­ï¼Œä¸€ä¸ªæœåŠ¡å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥ç»™å®ä¾‹è®¾ç½®cluster-nameï¼Œå°±æ˜¯å¯ä»¥å†è¿›ä¸€æ­¥çš„ç»™æ‰€æœ‰å®ä¾‹åˆ’åˆ†é›†ç¾¤ï¼Œé‚£å¦‚æœç°åœ¨æŸä¸ªæœåŠ¡Aæƒ³è¦è°ƒç”¨æœåŠ¡Bï¼Œé‚£ä¹ˆNaocsä¼šçœ‹è°ƒç”¨æœåŠ¡Açš„å®ä¾‹æ˜¯å±äºå“ªä¸ªé›†ç¾¤çš„ï¼Œå¹¶ä¸”è°ƒç”¨æœåŠ¡Bæ—¶ï¼Œé‚£å°±ä¼šè°ƒç”¨åŒæ ·é›†ç¾¤ä¸‹çš„æœåŠ¡Bå®ä¾‹ï¼Œæ ¹æ®cluster-nameæ¥åˆ¤æ–­ä¸¤ä¸ªå®ä¾‹æ˜¯ä¸æ˜¯åŒä¸€ä¸ªé›†ç¾¤ï¼Œè¿™å°±æ˜¯Nacosçš„å°±è¿‘è®¿é—®</p><h4 id="4ã€Nacosä¸­ä¿è¯çš„æ˜¯CPè¿˜æ˜¯AP"><a href="#4ã€Nacosä¸­ä¿è¯çš„æ˜¯CPè¿˜æ˜¯AP" class="headerlink" title="4ã€Nacosä¸­ä¿è¯çš„æ˜¯CPè¿˜æ˜¯AP"></a>4ã€Nacosä¸­ä¿è¯çš„æ˜¯CPè¿˜æ˜¯AP</h4><p>é€šå¸¸æˆ‘ä»¬è¯´ï¼ŒNacosæŠ€èƒ½ä¿è¯CPï¼Œä¹Ÿèƒ½ä¿è¯APï¼Œå…·ä½“çœ‹å¦‚ä½•é…ç½®ï¼Œä½†å…¶å®åªä¸è¿‡æ˜¯Nacosä¸­çš„æ³¨å†Œä¸­å¿ƒèƒ½ä¿è¯CPæˆ–APï¼ŒNacosä¸­çš„é…ç½®ä¸­å¿ƒå…¶å®æ²¡ä»€ä¹ˆCPæˆ–APï¼Œå› ä¸ºé…ç½®ä¸­å¿ƒçš„æ•°æ®æ˜¯å­˜åœ¨ä¸€ä¸ªMysqlä¸­çš„ï¼Œåªæœ‰æ³¨å†Œä¸­å¿ƒçš„æ•°æ®éœ€è¦è¿›è¡Œé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„åŒæ­¥ï¼Œä»è€Œæ¶‰åŠåˆ°æ˜¯CPè¿˜æ˜¯APï¼Œå¦‚æœæ³¨å†Œçš„èŠ‚ç‚¹æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±æ˜¯APï¼Œå¦‚æœæ˜¯éä¸´æ—¶èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±æ˜¯CPï¼Œé»˜è®¤æ˜¯ä¸´æ—¶èŠ‚ç‚¹ã€‚</p><h4 id="5ã€å¦‚ä½•ç†è§£Nacosä¸­çš„å‘½åç©ºé—´"><a href="#5ã€å¦‚ä½•ç†è§£Nacosä¸­çš„å‘½åç©ºé—´" class="headerlink" title="5ã€å¦‚ä½•ç†è§£Nacosä¸­çš„å‘½åç©ºé—´"></a>5ã€å¦‚ä½•ç†è§£Nacosä¸­çš„å‘½åç©ºé—´</h4><p>åœ¨Nacosä¸­ï¼Œä¸ç®¡æ˜¯é…ç½®è¿˜æ˜¯æœåŠ¡ï¼Œéƒ½æ˜¯å±äºæŸä¸€ä¸ªå‘½åç©ºé—´ä¸­çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯pulibcçš„ï¼Œå¯ä»¥åœ¨Nacosä¸­æ–°å¢å‘½åç©ºé—´ï¼Œä¹Ÿå°±ç›¸å½“äºå¼€è¾Ÿäº†å¦å¤–ä¸€å¥—å­˜æ”¾æœåŠ¡å’Œé…ç½®çš„åœ°æ–¹ï¼Œå‘½åç©ºé—´ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œå®Œå…¨ä¸å†²çªçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Nacosä¸­çš„å‘½åç©ºé—´æ¥å®ç°ä¸åŒç¯å¢ƒã€ä¸åŒç§Ÿæˆ·ä¹‹é—´çš„æœåŠ¡æ³¨å†Œå’Œé…ç½®</p><h4 id="6ã€ä½ è§‰å¾—æ³¨å†Œä¸­å¿ƒåº”è¯¥æ˜¯CPè¿˜æ˜¯AP"><a href="#6ã€ä½ è§‰å¾—æ³¨å†Œä¸­å¿ƒåº”è¯¥æ˜¯CPè¿˜æ˜¯AP" class="headerlink" title="6ã€ä½ è§‰å¾—æ³¨å†Œä¸­å¿ƒåº”è¯¥æ˜¯CPè¿˜æ˜¯AP"></a>6ã€ä½ è§‰å¾—æ³¨å†Œä¸­å¿ƒåº”è¯¥æ˜¯CPè¿˜æ˜¯AP</h4><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ³¨å†Œä¸­å¿ƒåº”è¯¥æ˜¯APï¼›å¦‚æœæ³¨å†Œä¸­å¿ƒæ˜¯CPçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œå®ä¾‹æˆ–ç§»é™¤å®ä¾‹æ—¶ï¼Œéƒ½è¦ç­‰å¾…æ³¨å†Œä¸­å¿ƒé›†ç¾¤ä¸­çš„æ•°æ®è¾¾åˆ°ä¸€è‡´åï¼Œæ‰ç®—æ³¨å†Œæˆ–ç§»é™¤æˆåŠŸï¼Œè€Œè¿™æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œéšç€ä¸šåŠ¡åº”ç”¨è§„æ¨¡çš„å¢å¤§ï¼Œåº”ç”¨é¢‘ç¹çš„ä¸Šä¸‹çº¿ï¼Œä¼šå½±å“åˆ°æœåŠ¡å‘ç°çš„æ•ˆç‡ä»¥åŠæœåŠ¡è°ƒç”¨äº†ï¼›</p><p>è€Œå¦‚æœæ³¨å†Œä¸­å¿ƒæ˜¯APçš„ï¼Œé‚£ä¹ˆæ³¨å†Œä¸­å¿ƒé›†ç¾¤ä¸ç®¡å‡ºç°äº†ä»€ä¹ˆæƒ…å†µï¼Œå°±ç®—é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´æ•°æ®å‡ºç°äº†ä¸ä¸€è‡´ï¼Œå¯¹äºä¸šåŠ¡åº”ç”¨è€Œè¨€ï¼Œå¯èƒ½æ‹‰å–åˆ°äº†ä¸€ä¸ªå·²ç»ä¸‹çº¿äº†çš„æœåŠ¡èŠ‚ç‚¹ï¼Œä½†æ˜¯å¾®æœåŠ¡æ¡†æ¶æˆ–ç»„ä»¶éƒ½æä¾›äº†æœåŠ¡å®¹é”™å’Œé‡è¯•åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p><p>è€Œå¦‚æœæ˜¯APï¼Œå¯¹äºæ³¨å†Œä¸­å¿ƒè€Œè¨€å°±ä¸éœ€è¦æ¶ˆè€—å¤ªå¤šå®æ—¶æ€§æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§äº†ï¼Œæ—¢ä¿è¯æœ€ç»ˆä¸€è‡´æ€§å°±å¯ä»¥äº†ï¼Œè¿™æ ·æ³¨å†Œä¸­å¿ƒçš„å‹åŠ›ä¼šå°ä¸€ç‚¹ï¼›</p><p>Zookeeperï¼ˆCPï¼‰æ¥ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œä½†æ˜¯å¦‚æœé›†ç¾¤ä¸­å¦‚æœå¤§å¤šæ•°èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œå°±ç®—è¿˜å‰©ä¸‹ä¸€äº›ZookeeperèŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸èƒ½æä¾›æœåŠ¡çš„ï¼Œæ‰€ä»¥è¿™ä¸ªä¹Ÿä¸å¤ªåˆé€‚ï¼Œæ‰€ä»¥ç»¼åˆæ¥çœ‹ï¼Œæ³¨å†Œä¸­å¿ƒåº”è¯¥ä¿è¯APä¼šæ›´å¥½ï¼Œå°±åƒEurakaã€Nacosä»–ä»¬é»˜è®¤ä¿è¯çš„å°±æ˜¯APã€‚</p><h4 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="===Zookeeper===="></a>===Zookeeper====</h4><h4 id="1ã€æ˜¯ä»€ä¹ˆ"><a href="#1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h4><p>zookeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒå·¥å…·ï¼Œä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚</p><h4 id="2ã€8å¤§åº”ç”¨åœºæ™¯"><a href="#2ã€8å¤§åº”ç”¨åœºæ™¯" class="headerlink" title="2ã€8å¤§åº”ç”¨åœºæ™¯"></a>2ã€<strong>8å¤§åº”ç”¨åœºæ™¯</strong></h4><p><strong>ï¼ˆ1ï¼‰æ•°æ®å‘å¸ƒä¸è®¢é˜…ï¼ˆé…ç½®ä¸­å¿ƒï¼‰</strong></p><p>å‘å¸ƒä¸è®¢é˜…å³æ‰€è°“çš„é…ç½®ç®¡ç†ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å°†æ•°æ®å‘å¸ƒåˆ°ZooKeeperèŠ‚ç‚¹ä¸Šï¼Œä¾›è®¢é˜…è€…åŠ¨æ€è·å– </p><p>æ•°æ®ï¼Œå®ç°é…ç½®ä¿¡æ¯çš„é›†ä¸­å¼ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°ã€‚ä¾‹å¦‚å…¨å±€çš„é…ç½®ä¿¡æ¯ï¼Œåœ°å€åˆ—è¡¨ç­‰å°±éå¸¸é€‚åˆä½¿ </p><p>ç”¨ã€‚</p><p>æ•°æ®å‘å¸ƒ/è®¢é˜…çš„ä¸€ä¸ªå¸¸è§çš„åœºæ™¯æ˜¯é…ç½®ä¸­å¿ƒï¼Œå‘å¸ƒè€…æŠŠæ•°æ®å‘å¸ƒåˆ° ZooKeeper çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—çš„ </p><p>èŠ‚ç‚¹ä¸Šï¼Œä¾›è®¢é˜…è€…è¿›è¡Œæ•°æ®è®¢é˜…ï¼Œè¾¾åˆ°åŠ¨æ€è·å–æ•°æ®çš„ç›®çš„ã€‚</p><p>å…¨å±€é…ç½®ä¿¡æ¯é€šå¸¸æœ‰3ä¸ªç‰¹æ€§ï¼š</p><ul><li>æ•°æ®é‡å°</li><li>æ•°æ®å†…å®¹å˜åŒ–é¢‘ç¹</li><li>é›†ç¾¤ä¸­å„æœºå™¨é…ç½®å…±äº«ã€ä¸€è‡´</li></ul><p>ZooKeeper é‡‡ç”¨çš„æ˜¯æ¨æ‹‰ç»“åˆçš„æ–¹å¼ã€‚ </p><ol><li><p>æ¨: æœåŠ¡ç«¯ä¼šæ¨ç»™æ³¨å†Œäº†ç›‘æ§èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ Wathcer äº‹ä»¶é€šçŸ¥ </p></li><li><p>æ‹‰: å®¢æˆ·ç«¯è·å¾—é€šçŸ¥åï¼Œç„¶åä¸»åŠ¨åˆ°æœåŠ¡ç«¯æ‹‰å–æœ€æ–°çš„æ•°æ®</p></li></ol><p><strong>ï¼ˆ2ï¼‰åˆ†å¸ƒå¼é”</strong></p><p>å¤„äºä¸åŒèŠ‚ç‚¹ä¸Šä¸åŒçš„æœåŠ¡ï¼Œå®ƒä»¬å¯èƒ½éœ€è¦é¡ºåºçš„è®¿é—®ä¸€äº›èµ„æºï¼Œè¿™é‡Œéœ€è¦ä¸€æŠŠåˆ†å¸ƒå¼çš„é”ã€‚ </p><p>åˆ†å¸ƒå¼é”å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼šå†™é”ã€è¯»é”ã€æ—¶åºé”ã€‚ </p><p>å†™é”ï¼šåœ¨zkä¸Šåˆ›å»ºçš„ä¸€ä¸ªä¸´æ—¶çš„æ— ç¼–å·çš„èŠ‚ç‚¹ã€‚ç”±äºæ˜¯æ— åºç¼–å·ï¼Œåœ¨åˆ›å»ºæ—¶ä¸ä¼šè‡ªåŠ¨ç¼–å·ï¼Œå¯¼è‡´åª </p><p>èƒ½å®¢æˆ·ç«¯æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¾—åˆ°é”ï¼Œç„¶åè¿›è¡Œå†™å…¥ã€‚ </p><p>è¯»é”ï¼šåœ¨zkä¸Šåˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æœ‰ç¼–å·çš„èŠ‚ç‚¹ï¼Œè¿™æ ·å³ä½¿ä¸‹æ¬¡æœ‰å®¢æˆ·ç«¯åŠ å…¥æ˜¯åŒæ—¶åˆ›å»ºç›¸åŒçš„èŠ‚ç‚¹ </p><p>æ—¶ï¼Œä»–ä¹Ÿä¼šè‡ªåŠ¨ç¼–å·ï¼Œä¹Ÿå¯ä»¥è·å¾—é”å¯¹è±¡ï¼Œç„¶åå¯¹å…¶è¿›è¡Œè¯»å–ã€‚ </p><p>æ—¶åºé”ï¼šåœ¨zkä¸Šåˆ›å»ºçš„ä¸€ä¸ªä¸´æ—¶çš„æœ‰ç¼–å·çš„èŠ‚ç‚¹æ ¹æ®ç¼–å·çš„å¤§å°æ§åˆ¶é”ã€‚ </p><p><strong>ï¼ˆ3ï¼‰è´Ÿè½½å‡è¡¡</strong></p><p>è¿™é‡Œè¯´çš„è´Ÿè½½å‡è¡¡æ˜¯æŒ‡è½¯è´Ÿè½½å‡è¡¡ã€‚åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä¸ºäº†ä¿è¯é«˜å¯ç”¨æ€§ï¼Œé€šå¸¸åŒä¸€ä¸ªåº”ç”¨æˆ–åŒä¸€ä¸ªæœåŠ¡çš„æä¾›æ–¹éƒ½ä¼šéƒ¨ç½²å¤šä»½ï¼Œè¾¾åˆ°å¯¹ç­‰æœåŠ¡ã€‚è€Œæ¶ˆè´¹è€…å°±éœ€è¦åœ¨è¿™äº›å¯¹ç­‰çš„æœåŠ¡å™¨ä¸­é€‰æ‹©ä¸€ä¸ªæ¥æ‰§è¡Œç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œå…¶ä¸­æ¯”è¾ƒå…¸å‹çš„æ˜¯æ¶ˆæ¯ä¸­é—´ä»¶ä¸­çš„ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡ã€‚</p><p>æ¶ˆæ¯ä¸­é—´ä»¶ä¸­å‘å¸ƒè€…å’Œè®¢é˜…è€…çš„è´Ÿè½½å‡è¡¡ï¼Œlinkedin å¼€æºçš„ KafkaMQ å’Œé˜¿é‡Œå¼€æºçš„ metaq éƒ½æ˜¯é€šè¿‡ zookeeper æ¥åšåˆ°ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…çš„è´Ÿè½½å‡è¡¡ã€‚è¿™é‡Œä»¥metaqä¸ºä¾‹å¦‚è®²ä¸‹ï¼š ç”Ÿäº§è€…è´Ÿè½½å‡è¡¡ï¼šmetaq å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™å¿…é¡»é€‰æ‹©ä¸€å° broker ä¸Šçš„ä¸€ä¸ªåˆ†åŒºæ¥å‘é€æ¶ˆæ¯ï¼Œå› æ­¤metaq åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæŠŠæ‰€æœ‰ brokerå’Œå¯¹åº”çš„åˆ†åŒºä¿¡æ¯å…¨éƒ¨æ³¨å†Œåˆ°ZKæŒ‡å®šèŠ‚ç‚¹ä¸Šï¼Œé»˜è®¤çš„ç­–ç•¥æ˜¯ä¸€ä¸ªä¾æ¬¡è½®è¯¢çš„è¿‡ç¨‹ï¼Œç”Ÿäº§è€…åœ¨é€šè¿‡ZKè·å–åˆ†åŒºåˆ—è¡¨ä¹‹åï¼Œä¼šæŒ‰ç…§ brokerIdå’Œpartitionçš„é¡ºåºæ’åˆ—ç»„ç»‡æˆä¸€ä¸ªæœ‰åºçš„åˆ†åŒºåˆ—è¡¨ï¼Œå‘é€çš„æ—¶å€™æŒ‰ç…§ä»å¤´åˆ°å°¾å¾ªç¯å¾€å¤çš„æ–¹å¼é€‰æ‹©ä¸€ä¸ªåˆ†åŒºæ¥å‘é€æ¶ˆæ¯ã€‚ </p><p>æ¶ˆè´¹è´Ÿè½½å‡è¡¡ï¼š</p><p>åœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ä¼šæ¶ˆè´¹ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºä¸­çš„æ¶ˆæ¯ï¼Œä½†æ˜¯ä¸€ä¸ªåˆ†åŒºåªä¼šç”±ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ¶ˆè´¹ã€‚MetaQçš„æ¶ˆè´¹ç­–ç•¥æ˜¯ï¼š</p><p>æ¯ä¸ªåˆ†åŒºé’ˆå¯¹åŒä¸€ä¸ªgroupåªæŒ‚è½½ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚ å¦‚æœåŒä¸€ä¸ªgroupçš„æ¶ˆè´¹è€…æ•°ç›®å¤§äºåˆ†åŒºæ•°ç›®ï¼Œåˆ™å¤šå‡ºæ¥çš„æ¶ˆè´¹è€…å°†ä¸å‚ä¸æ¶ˆè´¹ã€‚</p><p>å¦‚æœåŒä¸€ä¸ªgroupçš„æ¶ˆè´¹è€…æ•°ç›®å°äºåˆ†åŒºæ•°ç›®ï¼Œåˆ™æœ‰éƒ¨åˆ†æ¶ˆè´¹è€…éœ€è¦é¢å¤–æ‰¿æ‹…æ¶ˆè´¹ä»»åŠ¡ã€‚</p><p>åœ¨æŸä¸ªæ¶ˆè´¹è€…æ•…éšœæˆ–è€…é‡å¯ç­‰æƒ…å†µä¸‹ï¼Œå…¶ä»–æ¶ˆè´¹è€…ä¼šæ„ŸçŸ¥åˆ°è¿™ä¸€å˜åŒ–ï¼ˆé€šè¿‡ zookeeper watchæ¶ˆè´¹è€…åˆ—è¡¨ï¼‰ï¼Œç„¶åé‡æ–°è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä¿è¯æ‰€æœ‰çš„åˆ†åŒºéƒ½æœ‰æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€‚</p><p><strong>ï¼ˆ4ï¼‰å‘½åæœåŠ¡</strong></p><p>ä½œä¸ºåˆ†å¸ƒå¼å‘½åæœåŠ¡ï¼Œå‘½åæœåŠ¡æ˜¯æŒ‡é€šè¿‡æŒ‡å®šçš„åå­—æ¥è·å–èµ„æºæˆ–è€…æœåŠ¡çš„åœ°å€ï¼Œåˆ©ç”¨ZooKeeper åˆ›å»ºä¸€ä¸ªå…¨å±€çš„è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„å°±å¯ä»¥ä½œä¸ºä¸€ä¸ªåå­—ï¼ŒæŒ‡å‘é›†ç¾¤ä¸­çš„é›†ç¾¤ï¼Œæä¾›çš„æœåŠ¡çš„åœ°å€ï¼Œæˆ–è€…ä¸€ä¸ªè¿œç¨‹çš„å¯¹è±¡ç­‰ç­‰</p><p><strong>ï¼ˆ5ï¼‰åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥</strong></p><p>Zookeeperä¸­ç‰¹æœ‰çš„Watcheræ³¨å†Œäºå¼‚æ­¥é€šçŸ¥æœºåˆ¶ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¸åŒæœºå™¨ï¼Œç”šè‡³ä¸åŒç³»ç»Ÿä¹‹é—´çš„åè°ƒä¸é€šçŸ¥ï¼Œä»è€Œå®ç°å¯¹æ•°æ®å˜æ›´çš„å®æ—¶å¤„ç†ã€‚é€šå¸¸çš„åšæ³•æ˜¯ä¸åŒçš„å®¢æˆ·ç«¯éƒ½å¯¹Zookeeperä¸Šçš„åŒä¸€ä¸ªæ•°æ®èŠ‚ç‚¹è¿›è¡ŒWatcheræ³¨å†Œï¼Œç›‘å¬æ•°æ®èŠ‚ç‚¹çš„å˜åŒ–ï¼ˆåŒ…æ‹¬èŠ‚ç‚¹æœ¬èº«å’Œå­èŠ‚ç‚¹ï¼‰ï¼Œè‹¥æ•°æ®èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆæ‰€æœ‰è®¢é˜…çš„å®¢æˆ·ç«¯éƒ½èƒ½å¤Ÿæ¥æ”¶åˆ°ç›¸åº”çš„Watcheré€šçŸ¥ï¼Œå¹¶ä½œå‡ºç›¸åº”å¤„ç†ã€‚</p><p>åœ¨ç»å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿæœºå™¨é—´çš„é€šä¿¡æ— å¤–ä¹å¿ƒè·³æ£€æµ‹ã€å·¥ä½œè¿›åº¦æ±‡æŠ¥å’Œç³»ç»Ÿè°ƒåº¦ã€‚è¿™ä¸‰ç§ç±»å‹çš„æœºå™¨é€šä¿¡æ–¹å¼éƒ½å¯ä»¥ä½¿ç”¨zookeeperæ¥å®ç°ï¼š</p><p>1ã€å¿ƒè·³æ£€æµ‹ï¼Œä¸åŒæœºå™¨é—´éœ€è¦æ£€æµ‹åˆ°å½¼æ­¤æ˜¯å¦åœ¨æ­£å¸¸è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨Zookeeperå®ç°æœºå™¨é—´çš„å¿ƒè·³æ£€æµ‹ï¼ŒåŸºäºå…¶ä¸´æ—¶èŠ‚ç‚¹ç‰¹æ€§ï¼ˆä¸´æ—¶èŠ‚ç‚¹çš„ç”Ÿå­˜å‘¨æœŸæ˜¯å®¢æˆ·ç«¯ä¼šè¯ï¼Œå®¢æˆ·ç«¯è‹¥å½“å³åï¼Œå…¶ä¸´æ—¶èŠ‚ç‚¹è‡ªç„¶ä¸å†å­˜åœ¨ï¼‰ï¼Œå¯ä»¥è®©ä¸åŒæœºå™¨éƒ½åœ¨Zookeeperçš„ä¸€ä¸ªæŒ‡å®šèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸´æ—¶å­èŠ‚ç‚¹ï¼Œä¸åŒçš„æœºå™¨ä¹‹é—´å¯ä»¥æ ¹æ®è¿™ä¸ªä¸´æ—¶å­èŠ‚ç‚¹æ¥åˆ¤æ–­å¯¹åº”çš„å®¢æˆ·ç«¯æœºå™¨æ˜¯å¦å­˜æ´»ã€‚é€šè¿‡Zookeeperå¯ä»¥å¤§å¤§å‡å°‘ç³»ç»Ÿè€¦åˆã€‚</p><p>2ã€å·¥ä½œè¿›åº¦æ±‡æŠ¥ï¼Œé€šå¸¸ä»»åŠ¡è¢«åˆ†å‘åˆ°ä¸åŒæœºå™¨åï¼Œéœ€è¦å®æ—¶åœ°å°†è‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œè¿›åº¦æ±‡æŠ¥ç»™åˆ†å‘ç³»ç»Ÿï¼Œå¯ä»¥åœ¨Zookeeperä¸Šé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªä»»åŠ¡å®¢æˆ·ç«¯éƒ½åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸‹é¢åˆ›å»ºä¸´æ—¶å­èŠ‚ç‚¹ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥åˆ¤æ–­æœºå™¨æ˜¯å¦å­˜æ´»ï¼ŒåŒæ—¶å„ä¸ªæœºå™¨å¯ä»¥å°†è‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œè¿›åº¦å†™åˆ°è¯¥ä¸´æ—¶èŠ‚ç‚¹ä¸­å»ï¼Œä»¥ä¾¿ä¸­å¿ƒç³»ç»Ÿèƒ½å¤Ÿå®æ—¶è·å–ä»»åŠ¡çš„æ‰§è¡Œè¿›åº¦ã€‚</p><p>3ã€ç³»ç»Ÿè°ƒåº¦ï¼ŒZookeeperèƒ½å¤Ÿå®ç°å¦‚ä¸‹ç³»ç»Ÿè°ƒåº¦æ¨¡å¼ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿç”±æ§åˆ¶å°å’Œä¸€äº›å®¢æˆ·ç«¯ç³»ç»Ÿä¸¤éƒ¨åˆ†æ„æˆï¼Œæ§åˆ¶å°çš„èŒè´£å°±æ˜¯éœ€è¦å°†ä¸€äº›æŒ‡ä»¤ä¿¡æ¯å‘é€ç»™æ‰€æœ‰çš„å®¢æˆ·ç«¯ï¼Œä»¥æ§åˆ¶ä»–ä»¬è¿›è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ï¼Œåå°ç®¡ç†äººå‘˜åœ¨æ§åˆ¶å°ä¸Šåšä¸€äº›æ“ä½œï¼Œå®é™…ä¸Šå°±æ˜¯ä¿®æ”¹Zookeeperä¸ŠæŸäº›èŠ‚ç‚¹çš„æ•°æ®ï¼ŒZookeeperå¯ä»¥æŠŠæ•°æ®å˜æ›´ä»¥æ—¶é—´é€šçŸ¥çš„å½¢å¼å‘é€ç»™è®¢é˜…å®¢æˆ·ç«¯ã€‚</p><p><strong>ï¼ˆ6ï¼‰é›†ç¾¤ç®¡ç†</strong></p><p>Zookeeperçš„ä¸¤å¤§ç‰¹æ€§ï¼ˆèŠ‚ç‚¹ç‰¹æ€§å’Œwatcheræœºåˆ¶ï¼‰ï¼š</p><p>1ã€å®¢æˆ·ç«¯å¦‚æœå¯¹Zookeeperçš„æ•°æ®èŠ‚ç‚¹æ³¨å†ŒWatcherç›‘å¬ï¼Œé‚£ä¹ˆå½“è¯¥æ•°æ®åŠè¯¶å•å†…å®¹æˆ–æ˜¯å…¶å­èŠ‚ç‚¹åˆ—è¡¨å‘ç”Ÿå˜æ›´æ—¶ï¼ŒZookeeperæœåŠ¡å™¨å°±ä¼šå‘è®¢é˜…çš„å®¢æˆ·ç«¯å‘é€å˜æ›´é€šçŸ¥ã€‚</p><p>2ã€å¯¹åœ¨Zookeeperä¸Šåˆ›å»ºçš„ä¸´æ—¶èŠ‚ç‚¹ï¼Œä¸€æ—¦å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ä¼šè¯å¤±æ•ˆï¼Œé‚£ä¹ˆä¸´æ—¶èŠ‚ç‚¹ä¹Ÿä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</p><p>æœºå™¨åœ¨çº¿ç‡æœ‰è¾ƒé«˜è¦æ±‚çš„åœºæ™¯ï¼Œèƒ½å¤Ÿå¿«é€Ÿå¯¹é›†ç¾¤ä¸­æœºå™¨å˜åŒ–ä½œå‡ºå“åº”ã€‚è¿™æ ·çš„åœºæ™¯ä¸­ï¼Œå¾€å¾€æœ‰ä¸€ä¸ªç›‘æ§ç³»ç»Ÿï¼Œå®æ—¶æ£€æµ‹é›†ç¾¤æœºå™¨æ˜¯å¦å­˜æ´»ã€‚è¿‡å»çš„åšæ³•é€šå¸¸æ˜¯ï¼šç›‘æ§ç³»ç»Ÿé€šè¿‡æŸç§æ‰‹æ®µï¼ˆæ¯”å¦‚pingï¼‰å®šæ—¶æ£€æµ‹æ¯ä¸ªæœºå™¨ï¼Œæˆ–è€…æ¯ä¸ªæœºå™¨è‡ªå·±å®šæ—¶å‘ç›‘æ§ç³»ç»Ÿæ±‡æŠ¥â€œæˆ‘è¿˜æ´»ç€â€ã€‚è¿™ç§åšæ³•å¯è¡Œï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„é—®é¢˜ï¼š</p><ol><li><p>  é›†ç¾¤ä¸­æœºå™¨æœ‰å˜åŠ¨çš„æ—¶å€™ï¼Œç‰µè¿ä¿®æ”¹çš„ä¸œè¥¿æ¯”è¾ƒå¤šã€‚</p></li><li><p>  æœ‰ä¸€å®šçš„å»¶æ—¶ã€‚</p></li></ol><p>åˆ©ç”¨ZooKeeperæœ‰ä¸¤ä¸ªç‰¹æ€§ï¼Œå°±å¯ä»¥å®æ—¶å¦ä¸€ç§é›†ç¾¤æœºå™¨å­˜æ´»æ€§ç›‘æ§ç³»ç»Ÿã€‚å¯ä»¥å®ç°é›†ç¾¤æœºå™¨å­˜æ´»ç›‘æ§ç³»ç»Ÿï¼Œè‹¥ç›‘æ§ç³»ç»Ÿåœ¨/clusterServersèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€ä¸ªWatcherç›‘å¬ï¼Œé‚£ä¹ˆä½†å‡¡è¿›è¡ŒåŠ¨æ€æ·»åŠ æœºå™¨çš„æ“ä½œï¼Œå°±ä¼šåœ¨/clusterServersèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼š/clusterServers/[Hostname]ï¼Œè¿™æ ·ï¼Œç›‘æ§ç³»ç»Ÿå°±èƒ½å¤Ÿå®æ—¶ç›‘æµ‹æœºå™¨çš„å˜åŠ¨æƒ…å†µã€‚</p><p>ä¸‹é¢é€šè¿‡åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†ç³»ç»Ÿçš„å…¸å‹åº”ç”¨æ¥å­¦ä¹ Zookeeperå¦‚ä½•å®ç°é›†ç¾¤ç®¡ç†ã€‚</p><p>åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†ç³»ç»Ÿçš„æ ¸å¿ƒå·¥ä½œå°±æ˜¯æ”¶é›†åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šçš„ç³»ç»Ÿæ—¥å¿—ï¼Œåœ¨å…¸å‹çš„æ—¥å¿—ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸­ï¼Œæ•´ä¸ªæ—¥å¿—ç³»ç»Ÿä¼šæŠŠæ‰€æœ‰éœ€è¦æ”¶é›†çš„æ—¥å¿—æœºå™¨åˆ†ä¸ºå¤šä¸ªç»„åˆ«ï¼Œæ¯ä¸ªç»„åˆ«å¯¹åº”ä¸€ä¸ªæ”¶é›†å™¨ï¼Œè¿™ä¸ªæ”¶é›†å™¨å…¶å®å°±æ˜¯ä¸€ä¸ªåå°æœºå™¨ï¼Œç”¨äºæ”¶é›†æ—¥å¿—ï¼Œå¯¹äºå¤§è§„æ¨¡çš„åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†ç³»ç»Ÿåœºæ™¯ï¼Œé€šå¸¸éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p><p>1ã€å˜åŒ–çš„æ—¥å¿—æºæœºå™¨</p><p>2ã€å˜åŒ–çš„æ”¶é›†å™¨æœºå™¨</p><p>æ— è®ºæ˜¯æ—¥å¿—æºæœºå™¨è¿˜æ˜¯æ”¶é›†å™¨æœºå™¨çš„å˜æ›´ï¼Œæœ€ç»ˆéƒ½å¯ä»¥å½’ç»“ä¸ºå¦‚ä½•å¿«é€Ÿã€åˆç†ã€åŠ¨æ€åœ°ä¸ºæ¯ä¸ªæ”¶é›†å™¨åˆ†é…å¯¹åº”çš„æ—¥å¿—æºæœºå™¨ã€‚</p><p>aã€æ³¨å†Œæ”¶é›†å™¨æœºå™¨ï¼Œåœ¨Zookeeperä¸Šåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ”¶é›†å™¨çš„æ ¹èŠ‚ç‚¹ï¼Œä¾‹å¦‚/logs/collectorçš„æ”¶é›†å™¨èŠ‚ç‚¹ï¼Œæ¯ä¸ªæ”¶é›†å™¨æœºå™¨å¯åŠ¨æ—¶éƒ½ä¼šåœ¨æ”¶é›†å™¨èŠ‚ç‚¹ä¸‹åˆ›å»ºè‡ªå·±çš„èŠ‚ç‚¹ï¼Œå¦‚/logs/collector/[Hostname]<br> <img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303212315402.png"></p><p>bã€ä»»åŠ¡åˆ†å‘ï¼Œæ‰€æœ‰æ”¶é›†å™¨æœºå™¨éƒ½åˆ›å»ºå®Œå¯¹åº”èŠ‚ç‚¹åï¼Œç³»ç»Ÿæ ¹æ®æ”¶é›†å™¨èŠ‚ç‚¹ä¸‹å­èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œå°†æ‰€æœ‰æ—¥å¿—æºæœºå™¨åˆ†æˆå¯¹åº”çš„è‹¥å¹²ç»„ï¼Œç„¶åå°†åˆ†ç»„åçš„æœºå™¨åˆ—è¡¨åˆ†åˆ«å†™åˆ°è¿™äº›æ”¶é›†å™¨æœºå™¨åˆ›å»ºçš„å­èŠ‚ç‚¹ï¼Œå¦‚/logs/collector/host1ï¼ˆæŒä¹…èŠ‚ç‚¹ï¼‰ä¸Šå»ã€‚è¿™æ ·ï¼Œæ”¶é›†å™¨æœºå™¨å°±èƒ½å¤Ÿæ ¹æ®è‡ªå·±å¯¹åº”çš„æ”¶é›†å™¨èŠ‚ç‚¹ä¸Šè·å–æ—¥å¿—æºæœºå™¨åˆ—è¡¨ï¼Œè¿›è€Œå¼€å§‹è¿›è¡Œæ—¥å¿—æ”¶é›†å·¥ä½œã€‚</p><p>cã€çŠ¶æ€æ±‡æŠ¥ï¼Œå®Œæˆä»»åŠ¡åˆ†å‘åï¼Œæœºå™¨éšæ—¶ä¼šå®•æœºï¼Œæ‰€ä»¥éœ€è¦æœ‰ä¸€ä¸ªæ”¶é›†å™¨çš„çŠ¶æ€æ±‡æŠ¥æœºåˆ¶ï¼Œæ¯ä¸ªæ”¶é›†å™¨æœºå™¨ä¸Šåˆ›å»ºå®ŒèŠ‚ç‚¹åï¼Œè¿˜éœ€è¦å†å¯¹åº”å­èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªçŠ¶æ€å­èŠ‚ç‚¹ï¼Œå¦‚/logs/collector/host/statusï¼ˆä¸´æ—¶èŠ‚ç‚¹ï¼‰ï¼Œæ¯ä¸ªæ”¶é›†å™¨æœºå™¨éƒ½éœ€è¦å®šæœŸå‘è¯¥ç»“ç‚¹å†™å…¥è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯ï¼Œè¿™å¯çœ‹åšæ˜¯å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œé€šå¸¸æ”¶é›†å™¨æœºå™¨éƒ½ä¼šå†™å…¥æ—¥å¿—æ”¶é›†çŠ¶æ€ä¿¡æ¯ï¼Œæ—¥å¿—ç³»ç»Ÿé€šè¿‡åˆ¤æ–­çŠ¶æ€å­èŠ‚ç‚¹æœ€åçš„æ›´æ–°æ—¶é—´æ¥ç¡®å®šæ”¶é›†å™¨æœºå™¨æ˜¯å¦å­˜æ´»ã€‚</p><p>dã€åŠ¨æ€åˆ†é…ï¼Œè‹¥æ”¶é›†å™¨æœºå™¨å®•æœºï¼Œåˆ™éœ€è¦åŠ¨æ€è¿›è¡Œæ”¶é›†ä»»åŠ¡çš„åˆ†é…ï¼Œæ”¶é›†ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­å…³æ³¨/logs/collectorèŠ‚ç‚¹ä¸‹æ‰€æœ‰å­èŠ‚ç‚¹çš„å˜æ›´ï¼Œä¸€æ—¦æœ‰æœºå™¨åœæ­¢æ±‡æŠ¥æˆ–æœ‰æ–°æœºå™¨åŠ å…¥ï¼Œå°±å¼€å§‹è¿›è¡Œä»»åŠ¡çš„é‡æ–°åˆ†é…ï¼Œæ­¤æ—¶é€šå¸¸ç”±ä¸¤ç§åšæ³•ï¼š</p><p>1ã€å…¨å±€åŠ¨æ€åˆ†é…ï¼Œå½“æ”¶é›†å™¨æœºå™¨å®•æœºæˆ–æœ‰æ–°çš„æœºå™¨åŠ å…¥ï¼Œç³»ç»Ÿæ ¹æ®æ–°çš„æ”¶é›†å™¨æœºå™¨åˆ—è¡¨ï¼Œç«‹å³å¯¹æ‰€æœ‰çš„æ—¥å¿—æºæœºå™¨é‡æ–°è¿›è¡Œä¸€æ¬¡åˆ†ç»„ï¼Œç„¶åå°†å…¶åˆ†é…ç»™å‰©ä¸‹çš„æ”¶é›†å™¨æœºå™¨ã€‚</p><p>2ã€å±€éƒ¨åŠ¨æ€åˆ†é…ï¼Œæ¯ä¸ªæ”¶é›†å™¨æœºå™¨åœ¨æ±‡æŠ¥è‡ªå·±æ—¥å¿—æ”¶é›†çŠ¶æ€çš„åŒæ—¶ï¼Œä¹Ÿä¼šæŠŠè‡ªå·±çš„è´Ÿè½½æ±‡æŠ¥ä¸Šå»ï¼Œå¦‚æœä¸€ä¸ªæœºå™¨å®•æœºäº†ï¼Œé‚£ä¹ˆæ—¥å¿—ç³»ç»Ÿå°±ä¼šæŠŠä¹‹å‰åˆ†é…ç»™è¿™ä¸ªæœºå™¨çš„ä»»åŠ¡é‡æ–°åˆ†é…åˆ°é‚£äº›è´Ÿè½½è¾ƒä½çš„æœºå™¨ï¼ŒåŒæ ·ï¼Œå¦‚æœæœ‰æ–°æœºå™¨åŠ å…¥ï¼Œä¼šä»é‚£äº›è´Ÿè½½é«˜çš„æœºå™¨ä¸Šè½¬ç§»ä¸€éƒ¨åˆ†ä»»åŠ¡ç»™æ–°æœºå™¨</p><p><strong>ï¼ˆ8ï¼‰åˆ†å¸ƒå¼é˜Ÿåˆ—</strong></p><p>åˆ†å¸ƒå¼é˜Ÿåˆ—åˆ†ä¸ºä¸¤ç§ï¼š </p><p>1ã€å½“ä¸€ä¸ªé˜Ÿåˆ—çš„æˆå‘˜éƒ½èšé½æ—¶ï¼Œè¿™ä¸ªé˜Ÿåˆ—æ‰å¯ç”¨ï¼Œå¦åˆ™ä¸€ç›´ç­‰å¾…æ‰€æœ‰æˆå‘˜åˆ°è¾¾ï¼Œè¿™ç§æ˜¯åŒæ­¥é˜Ÿ </p><p>åˆ—ã€‚ </p><p>aï¼‰ä¸€ä¸ªjobç”±å¤šä¸ªtaskç»„æˆï¼Œåªæœ‰æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œjobæ‰è¿è¡Œå®Œæˆã€‚ </p><p>bï¼‰å¯ä¸ºjobåˆ›å»ºä¸€ä¸ª/jobç›®å½•ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸‹ï¼Œä¸ºæ¯ä¸ªå®Œæˆçš„taskåˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„Znodeï¼Œä¸€æ—¦ </p><p>ä¸´æ—¶èŠ‚ç‚¹æ•°ç›®è¾¾åˆ°taskæ€»æ•°ï¼Œåˆ™è¡¨æ˜jobè¿è¡Œå®Œæˆã€‚ </p><p>2ã€é˜Ÿåˆ—æŒ‰ç…§FIFOæ–¹å¼è¿›è¡Œå…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œï¼Œä¾‹å¦‚å®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹ã€‚ </p><h4 id="3ã€Zookeeperçš„å·¥ä½œåŸç†"><a href="#3ã€Zookeeperçš„å·¥ä½œåŸç†" class="headerlink" title="3ã€Zookeeperçš„å·¥ä½œåŸç†"></a>3ã€<strong>Zookeeper</strong>çš„å·¥ä½œåŸç†</h4><p>Zookeeperçš„æ ¸å¿ƒæ˜¯åŸå­å¹¿æ’­ï¼Œè¿™ä¸ªæœºåˆ¶ä¿è¯äº†å„ä¸ªServerä¹‹é—´çš„åŒæ­¥ã€‚å®ç°è¿™ä¸ªæœºåˆ¶çš„åè®®å«åš </p><p>Zabåè®®ã€‚ </p><p>Zabåè®®æœ‰ä¸¤ç§æ¨¡å¼ï¼Œå®ƒä»¬ åˆ†åˆ«æ˜¯æ¢å¤æ¨¡å¼ï¼ˆé€‰ä¸»ï¼‰å’Œå¹¿æ’­æ¨¡å¼ï¼ˆåŒæ­¥ï¼‰ã€‚ </p><p>Zookeeper æ˜¯é€šè¿‡ Zab åè®®æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚Zabåè®®è¦æ±‚æ¯ä¸ª Leader éƒ½è¦ç»å†ä¸‰ä¸ªé˜¶æ®µï¼šå‘ç°ï¼ŒåŒæ­¥ï¼Œå¹¿æ’­ã€‚ </p><p>å½“æœåŠ¡å¯åŠ¨æˆ–è€…åœ¨é¢†å¯¼è€…å´©æºƒåï¼ŒZabå°±è¿›å…¥äº†æ¢å¤æ¨¡å¼ï¼Œå½“é¢†å¯¼è€…è¢«é€‰ä¸¾å‡ºæ¥ï¼Œä¸”å¤§å¤šæ•°Server </p><p>å®Œæˆäº†å’Œ leaderçš„çŠ¶æ€åŒæ­¥ä»¥åï¼Œæ¢å¤æ¨¡å¼å°±ç»“æŸäº†ã€‚çŠ¶æ€åŒæ­¥ä¿è¯äº†leaderå’ŒServerå…·æœ‰ç›¸åŒçš„ </p><p>ç³»ç»ŸçŠ¶æ€ã€‚ </p><p>ä¸ºäº†ä¿è¯äº‹åŠ¡çš„é¡ºåºä¸€è‡´æ€§ï¼Œzookeeperé‡‡ç”¨äº†é€’å¢çš„äº‹åŠ¡idå·ï¼ˆzxidï¼‰æ¥æ ‡è¯†äº‹åŠ¡ã€‚æ‰€æœ‰çš„æè®® </p><p>ï¼ˆproposalï¼‰éƒ½åœ¨è¢«æå‡ºçš„æ—¶å€™åŠ ä¸Šäº†zxidã€‚å®ç°ä¸­zxidæ˜¯ä¸€ä¸ª64ä½çš„æ•°å­—ï¼Œå®ƒé«˜32ä½æ˜¯epochç”¨ </p><p>æ¥æ ‡è¯†leaderå…³ç³»æ˜¯å¦æ”¹å˜ï¼Œæ¯æ¬¡ä¸€ä¸ªleaderè¢«é€‰å‡ºæ¥ï¼Œå®ƒéƒ½ä¼šæœ‰ä¸€ä¸ªæ–°çš„epochï¼ˆçºªå…ƒï¼‰ï¼Œæ ‡è¯†å½“å‰å±äºé‚£ä¸ªleaderçš„ç»Ÿæ²»æ—¶æœŸã€‚ä½32ä½ç”¨äºé€’å¢è®¡æ•°ã€‚ </p><p>epochï¼šå¯ä»¥ç†è§£ä¸ºçš‡å¸çš„å¹´å·ï¼Œå½“æ–°çš„çš‡å¸leaderäº§ç”Ÿåï¼Œå°†æœ‰ä¸€ä¸ªæ–°çš„epochå¹´å·ã€‚ </p><p>æ¯ä¸ªServeråœ¨å·¥ä½œè¿‡ç¨‹ä¸­æœ‰ä¸‰ç§çŠ¶æ€ï¼š </p><p>LOOKINGï¼šå½“å‰Serverä¸çŸ¥é“leaderæ˜¯è°ï¼Œæ­£åœ¨æœå¯»ã€‚ </p><p>LEADINGï¼šå½“å‰Serverå³ä¸ºé€‰ä¸¾å‡ºæ¥çš„leaderã€‚ </p><p>FOLLOWINGï¼šleaderå·²ç»é€‰ä¸¾å‡ºæ¥ï¼Œå½“å‰Serverä¸ä¹‹åŒæ­¥ã€‚ </p><h4 id="4ã€Zookeeper-çš„é€šçŸ¥æœºåˆ¶æ˜¯"><a href="#4ã€Zookeeper-çš„é€šçŸ¥æœºåˆ¶æ˜¯" class="headerlink" title="4ã€Zookeeper çš„é€šçŸ¥æœºåˆ¶æ˜¯"></a>4ã€<strong>Zookeeper</strong> <strong>çš„é€šçŸ¥æœºåˆ¶æ˜¯</strong></h4><p>Zookeeper å…è®¸å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯çš„æŸä¸ª znode æ³¨å†Œä¸€ä¸ª Watcher ç›‘å¬ï¼Œå½“æœåŠ¡ç«¯çš„ä¸€äº›æŒ‡å®šäº‹ä»¶ </p><p>è§¦å‘äº†è¿™ä¸ª Watcher ï¼ŒæœåŠ¡ç«¯ä¼šå‘æŒ‡å®šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªäº‹ä»¶é€šçŸ¥æ¥å®ç°åˆ†å¸ƒå¼çš„é€šçŸ¥åŠŸèƒ½ï¼Œç„¶åå®¢ </p><p>æˆ·ç«¯æ ¹æ® Watcher é€šçŸ¥çŠ¶æ€å’Œäº‹ä»¶ç±»å‹åšå‡ºä¸šåŠ¡ä¸Šçš„æ”¹å˜ã€‚</p><p>å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š </p><ul><li><p>å®¢æˆ·ç«¯æ³¨å†Œ Watcher </p><ul><li>1ã€è°ƒç”¨ getDataã€getChildrenã€exist ä¸‰ä¸ª API ï¼Œä¼ å…¥Watcher å¯¹è±¡ã€‚ </li><li>2ã€æ ‡è®°è¯·æ±‚ request ï¼Œå°è£… Watcher åˆ° WatchRegistration ã€‚</li><li>3ã€å°è£…æˆ Packet å¯¹è±¡ï¼Œå‘æœåŠ¡ç«¯å‘é€ request ã€‚</li><li>4ã€æ”¶åˆ°æœåŠ¡ç«¯å“åº”åï¼Œå°† Watcher æ³¨å†Œåˆ° ZKWatcherManager ä¸­è¿›è¡Œç®¡ç†ã€‚ </li><li>5ã€ è¯·æ±‚è¿”å›ï¼Œå®Œæˆæ³¨å†Œã€‚ </li></ul></li><li><p>æœåŠ¡ç«¯å¤„ç† Watcher </p><ul><li>1ã€æœåŠ¡ç«¯æ¥æ”¶ Watcher å¹¶å­˜å‚¨ã€‚ </li><li>2ã€Watcher è§¦å‘ </li><li>3ã€è°ƒç”¨ process æ–¹æ³•æ¥è§¦å‘ Watcher ã€‚ </li></ul></li><li><p>å®¢æˆ·ç«¯å›è°ƒ Watcher </p><ul><li>1ï¼Œå®¢æˆ·ç«¯ SendThread çº¿ç¨‹æ¥æ”¶äº‹ä»¶é€šçŸ¥ï¼Œäº¤ç”± EventThread çº¿ç¨‹å›è°ƒWatcher ã€‚ </li><li>2ï¼Œå®¢æˆ·ç«¯ çš„ Watcher æœºåˆ¶åŒæ ·æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸€æ—¦è¢«è§¦å‘åï¼Œè¯¥ Watcher å°±å¤±æ•ˆäº†ã€‚ </li><li>client ç«¯ä¼šå¯¹æŸä¸ª znode å»ºç«‹ä¸€ä¸ª watcher äº‹ä»¶ï¼Œå½“è¯¥ znode å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™äº› client ä¼šæ”¶ åˆ° zk çš„é€šçŸ¥ï¼Œç„¶å client å¯ä»¥æ ¹æ® znode å˜åŒ–æ¥åšå‡ºä¸šåŠ¡ä¸Šçš„æ”¹å˜ç­‰ã€‚</li></ul></li></ul><h4 id="5ã€Zookeeper-å¯¹èŠ‚ç‚¹çš„-watch-ç›‘å¬é€šçŸ¥æ˜¯æ°¸ä¹…çš„å—"><a href="#5ã€Zookeeper-å¯¹èŠ‚ç‚¹çš„-watch-ç›‘å¬é€šçŸ¥æ˜¯æ°¸ä¹…çš„å—" class="headerlink" title="5ã€Zookeeper å¯¹èŠ‚ç‚¹çš„ watch ç›‘å¬é€šçŸ¥æ˜¯æ°¸ä¹…çš„å—"></a>5ã€<strong>Zookeeper</strong> <strong>å¯¹èŠ‚ç‚¹çš„</strong> <strong>watch</strong> <strong>ç›‘å¬é€šçŸ¥æ˜¯æ°¸ä¹…çš„å—</strong></h4><p><strong>ä¸€æ¬¡æ€§</strong>çš„ã€‚æ— è®ºæ˜¯æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œä¸€æ—¦ä¸€ä¸ª Watcher è¢«è§¦å‘ï¼Œ Zookeeper éƒ½ä¼šå°†å…¶ä» </p><p>ç›¸åº”çš„å­˜å‚¨ä¸­ç§»é™¤ã€‚è¿™æ ·çš„è®¾è®¡æœ‰æ•ˆçš„å‡è½»äº†æœåŠ¡ç«¯çš„å‹åŠ›ï¼Œä¸ç„¶å¯¹äºæ›´æ–°éå¸¸é¢‘ç¹çš„èŠ‚ç‚¹ï¼ŒæœåŠ¡ </p><p>ç«¯ä¼šä¸æ–­çš„å‘å®¢æˆ·ç«¯å‘é€äº‹ä»¶é€šçŸ¥ï¼Œæ— è®ºå¯¹äºç½‘ç»œè¿˜æ˜¯æœåŠ¡ç«¯çš„å‹åŠ›éƒ½éå¸¸å¤§ã€‚</p><h4 id="6ã€Zookeeper-é›†ç¾¤ä¸­æœ‰å“ªäº›è§’è‰²"><a href="#6ã€Zookeeper-é›†ç¾¤ä¸­æœ‰å“ªäº›è§’è‰²" class="headerlink" title="6ã€Zookeeper é›†ç¾¤ä¸­æœ‰å“ªäº›è§’è‰²"></a>6ã€<strong>Zookeeper</strong> <strong>é›†ç¾¤ä¸­æœ‰å“ªäº›è§’è‰²</strong></h4><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303232346317.png"></p><h4 id="7ã€Zookeeper-é›†ç¾¤ä¸­Serveræœ‰å“ªäº›å·¥ä½œçŠ¶æ€"><a href="#7ã€Zookeeper-é›†ç¾¤ä¸­Serveræœ‰å“ªäº›å·¥ä½œçŠ¶æ€" class="headerlink" title="7ã€Zookeeper é›†ç¾¤ä¸­Serveræœ‰å“ªäº›å·¥ä½œçŠ¶æ€"></a>7ã€<strong>Zookeeper</strong> <strong>é›†ç¾¤ä¸­</strong>Server<strong>æœ‰å“ªäº›å·¥ä½œçŠ¶æ€</strong></h4><p><strong>LOOKING</strong> </p><p>å¯»æ‰¾ Leader çŠ¶æ€ï¼›å½“æœåŠ¡å™¨å¤„äºè¯¥çŠ¶æ€æ—¶ï¼Œå®ƒä¼šè®¤ä¸ºå½“å‰é›†ç¾¤ä¸­æ²¡æœ‰ Leader ï¼Œå› æ­¤éœ€è¦è¿›å…¥</p><p>Leader é€‰ä¸¾çŠ¶æ€ </p><p><strong>FOLLOWING</strong> </p><p>è·Ÿéšè€…çŠ¶æ€ï¼›è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Follower </p><p><strong>LEADING</strong> </p><p>é¢†å¯¼è€…çŠ¶æ€ï¼›è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Leader </p><p><strong>OBSERVING</strong> </p><p>è§‚å¯Ÿè€…çŠ¶æ€ï¼›è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Observer</p><h4 id="8ã€"><a href="#8ã€" class="headerlink" title="8ã€"></a>8ã€</h4><h4 id="9ã€"><a href="#9ã€" class="headerlink" title="9ã€"></a>9ã€</h4><h4 id="10ã€"><a href="#10ã€" class="headerlink" title="10ã€"></a>10ã€</h4><h4 id="11ã€"><a href="#11ã€" class="headerlink" title="11ã€"></a>11ã€</h4><h4 id="12ã€"><a href="#12ã€" class="headerlink" title="12ã€"></a>12ã€</h4><h4 id="13ã€"><a href="#13ã€" class="headerlink" title="13ã€"></a>13ã€</h4><h4 id="14ã€"><a href="#14ã€" class="headerlink" title="14ã€"></a>14ã€</h4><h4 id="15ã€"><a href="#15ã€" class="headerlink" title="15ã€"></a>15ã€</h4><h4 id="16ã€"><a href="#16ã€" class="headerlink" title="16ã€"></a>16ã€</h4><h4 id="17ã€"><a href="#17ã€" class="headerlink" title="17ã€"></a>17ã€</h4><h4 id="18ã€"><a href="#18ã€" class="headerlink" title="18ã€"></a>18ã€</h4><h3 id="2ã€ç†”æ–­å™¨"><a href="#2ã€ç†”æ–­å™¨" class="headerlink" title="2ã€ç†”æ–­å™¨"></a>2ã€ç†”æ–­å™¨</h3><h4 id="1ã€å¯¹æ¯”å›¾"><a href="#1ã€å¯¹æ¯”å›¾" class="headerlink" title="1ã€å¯¹æ¯”å›¾"></a>1ã€å¯¹æ¯”å›¾</h4><h3 id="3ã€ç½‘å…³"><a href="#3ã€ç½‘å…³" class="headerlink" title="3ã€ç½‘å…³"></a>3ã€ç½‘å…³</h3><h3 id="4ã€"><a href="#4ã€" class="headerlink" title="4ã€"></a>4ã€</h3><h3 id="5ã€"><a href="#5ã€" class="headerlink" title="5ã€"></a>5ã€</h3><h2 id="äºŒã€Mysqlé«˜çº§é¢åŸº"><a href="#äºŒã€Mysqlé«˜çº§é¢åŸº" class="headerlink" title="äºŒã€Mysqlé«˜çº§é¢åŸº"></a>äºŒã€Mysqlé«˜çº§é¢åŸº</h2><p>é«˜çº§ç‰¹æ€§æœ¬å‘¨æ•´ç†å¤§çº²ï¼š<br>1ã€æ‰§è¡Œæµç¨‹ï¼ˆ5.7 and 8.0 æš‚ä¸æ•´ç†ï¼‰ï¼Œé€»è¾‘æ¶æ„ï¼ˆä¸‰å±‚ï¼‰ï¼›å›¾ã€æ¦‚è¿°ï¼Œç™½è¯æ€»ç»“<br>2ã€å­˜å‚¨å¼•æ“ï¼ˆInnoDB MyISAM ï¼ˆæ ¸å¿ƒå¯¹æ¯”å›¾ï¼‰â€¦è¾¹ç¼˜5ç§ç®€è¿°-äº†è§£ï¼‰ï¼›è£…é€¼ï¼šé˜¿é‡Œè‡ªå®šä¹‰å¼•æ“ï¼šXtradb<br>3ã€ç´¢å¼•è¿­ä»£è®¾è®¡ï¼ˆæ˜¯éèšç°‡ç´¢å¼•ï¼ŒäºŒçº§ã€è”åˆç´¢å¼•ï¼‰ï¼Œç´¢å¼•ä½¿ç”¨å¸¸è§ï¼ˆ11 yes 7 notï¼‰ï¼›è¾¹ç¼˜æ‰€ä»¥ä½ æ¥å£å¯¹æ¯”ï¼ˆHASHã€AVLã€Bã€B+ï¼‰ã€Explainè°ƒä¼˜é˜¿é‡Œã€ä¸‰èŒƒå¼ ERæ¨¡å‹<br>Nã€äº‹åŠ¡ï¼ˆæ˜¾å¼ã€éšå¼ï¼‰ï¼Œé”ï¼ˆè¡¨é”ï¼šSé”ã€Xé”ã€æ„å‘é”ã€è‡ªå¢é”ã€å…ƒæ•°æ®é”ï¼›è¡Œé”ï¼šè®°å½•é”ã€é—´éš™é”ã€ä¸´é”®é”ã€æ’å…¥æ„å‘é”ï¼›ä¹è§‚æ‚²è§‚é”â€¦..ï¼‰ æ‰©å±•å¾…å®šï¼Ÿ</p><h3 id="1-ç²¾ç®€"><a href="#1-ç²¾ç®€" class="headerlink" title="1| ç²¾ç®€"></a>1| ç²¾ç®€</h3><h4 id="1ã€æ‰§è¡Œæµç¨‹"><a href="#1ã€æ‰§è¡Œæµç¨‹" class="headerlink" title="1ã€æ‰§è¡Œæµç¨‹"></a>1ã€æ‰§è¡Œæµç¨‹</h4><p><strong>SQLæµç¨‹</strong> </p><p>sqlè¯­å¥ -&gt; æŸ¥è¯¢ç¼“å­˜ -&gt; è§£æå™¨ -&gt; ä¼˜åŒ–å™¨ -&gt; æ‰§è¡Œå™¨</p><p><strong>å®Œæ•´æµç¨‹</strong></p><p> å®¢æˆ·ç«¯ç¨‹åº connectors &gt;&gt; è¿æ¥æ±  &gt;&gt; SQLæ¥å£ &gt;&gt; è§£æå™¨ &gt;&gt; ä¼˜åŒ–å™¨ &gt;&gt; æŸ¥è¯¢ç¼“å­˜ &gt;&gt; æ’ä»¶å¼å­˜å‚¨å¼•æ“ &gt;&gt; Fileï¼ˆæ–‡ä»¶ç³»ç»Ÿ/æ—¥å¿—æ–‡ä»¶ï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302171540587.png"></p><blockquote><ol><li>å®¢æˆ·ç«¯ç¨‹åº : åŒ…æ‹¬ä¸€äº›mysqlå·¥å…·å¦‚ï¼šnative æˆ–è€…è¯­è¨€å·¥å…·å¦‚ï¼šphp ã€go ã€python</li><li>è¿æ¥æ±   : æä¾›å¤šä¸ªç”¨æˆ·å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº¤äº’çš„çº¿ç¨‹</li><li>SQLæ¥å£ : æ¥æ”¶sqlå‘½ä»¤ï¼Œè¿”å›æŸ¥è¯¢ç»“æœ</li><li>è§£æå™¨  : è¿›è¡Œsqlè¯­æ³•çš„è§£æã€è¯­æ„è§£æã€ç”Ÿæˆè¯­æ³•æ ‘</li><li>ä¼˜åŒ–å™¨  : mysqlæ ¸å¿ƒç»„ä»¶ï¼Œå¯¹sqlå‘½ä»¤è¿›è¡Œä¼˜åŒ–</li><li>ç¼“å­˜    : ä»¥key -&gt; valueæ–¹å¼ç¼“å­˜æŸ¥è¯¢ç»“æœ (å¦‚æœæŸ¥è¯¢sqlæŒ‡ä»¤æœ‰ç¼“å­˜ç›´æ¥åœ¨SQLæ¥å£éƒ¨åˆ†è¿”å›ç¼“å­˜ç»“æœ)</li><li>å­˜å‚¨å¼•æ“ : ä¸åº•å±‚æ–‡ä»¶è¿›è¡Œäº¤äº’ï¼ŒæŸ¥è¯¢æ•°æ®æ–‡ä»¶ç³»ç»Ÿã€æ—¥å¿—æ–‡ä»¶ç­‰</li></ol></blockquote><p><strong>mysql serverä¸‰å±‚æ¶æ„</strong></p><p>1ã€è¿æ¥å±‚</p><p>mysqlæœåŠ¡å™¨æœ‰ä¸“é—¨çš„tcpè¿æ¥æ± é™åˆ¶æœ€å¤§è¿æ¥æ•°ï¼Œé‡‡ç”¨é•¿è¿æ¥æ¨¡å¼å¤ç”¨tcpè¿æ¥ï¼Œè¿›è¡Œè¿æ¥äº¤äº’</p><p>2ã€æœåŠ¡å±‚ </p><ul><li>Interface æ¥å£</li><li>è§£æå™¨</li><li>æŸ¥è¯¢ä¼˜åŒ–å™¨</li><li>æŸ¥è¯¢ç¼“å­˜ç»„ä»¶</li></ul><p>3ã€å¼•æ“å±‚</p><p>æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“å±‚ï¼ŒçœŸæ­£çš„è´Ÿè´£äº†mysqlä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼Œå¯¹ç‰©ç†æœåŠ¡å™¨çº§åˆ«ç»´æŠ¤çš„åº•å±‚æ•°æ®æ‰§è¡Œæ“ä½œï¼ŒæœåŠ¡å™¨é€šè¿‡apiä¸å­˜å‚¨å¼•æ“é€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰çš„åŠŸèƒ½ä¸åŒï¼Œæ”¯æŒäºŒå¼€å¼•æ“ã€é˜¿é‡Œï¼šXtradbã€‘</p><h4 id="2ã€èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•"><a href="#2ã€èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•" class="headerlink" title="2ã€èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•"></a>2ã€èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•</h4><p>å¯¹æ¯”ï¼š</p><ul><li>èšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯è¡Œæ•°æ®ï¼›è€Œéèšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯èšç°‡ç´¢å¼•ï¼ˆé€šå¸¸æ˜¯ä¸»é”® IDï¼‰ã€‚</li><li>èšç°‡ç´¢å¼•æŸ¥è¯¢æ•ˆç‡æ›´é«˜ï¼Œè€Œéèšç°‡ç´¢å¼•éœ€è¦è¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œå› æ­¤æ€§èƒ½ä¸å¦‚èšç°‡ç´¢å¼•ã€‚</li><li>èšç°‡ç´¢å¼•ä¸€èˆ¬ä¸ºä¸»é”®ç´¢å¼•ï¼Œè€Œä¸»é”®ä¸€ä¸ªè¡¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªï¼Œå› æ­¤èšç°‡ç´¢å¼•ä¸€ä¸ªè¡¨ä¸­ä¹Ÿåªèƒ½æœ‰ä¸€ä¸ªï¼Œè€Œéèšç°‡ç´¢å¼•åˆ™æ²¡æœ‰æ•°é‡ä¸Šçš„é™åˆ¶</li></ul><p><strong>èšç°‡ç´¢å¼• id å¯¹åº”çš„ B+ æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</strong> </p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302252030574.png"></p><p><strong>åœ¨ student ä¸­éèšç°‡ç´¢å¼• class_id å¯¹åº” B+ æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</strong> </p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302252030261.png"></p><h4 id="3ã€å­˜å‚¨å¼•æ“"><a href="#3ã€å­˜å‚¨å¼•æ“" class="headerlink" title="3ã€å­˜å‚¨å¼•æ“"></a>3ã€å­˜å‚¨å¼•æ“</h4><p>å¯¹æ¯”å›¾ï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302251609760.png"></p><p><strong>MyISAM</strong> <strong>ä¸</strong> <strong>InnoDBä¸¤ç§å¼•æ“ä¸­ç´¢å¼•çš„åŒºåˆ«</strong></p><p>â‘  åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®ä¸»é”®å€¼å¯¹èšç°‡ç´¢å¼•è¿›è¡Œä¸€æ¬¡æŸ¥æ‰¾å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œè€Œåœ¨MyISAMä¸­å´éœ€è¦è¿›è¡Œä¸€æ¬¡å›è¡¨æ“ä½œï¼Œæ„å‘³ç€MyISAMä¸­å»ºç«‹çš„ç´¢å¼•ç›¸å½“äºå…¨éƒ¨éƒ½æ˜¯äºŒçº§ç´¢å¼•ã€‚</p><p>â‘¡ InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ï¼Œè€ŒMyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚</p><p>â‘¢ InnoDBçš„éèšç°‡ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼ï¼Œè€ŒMyISAMç´¢å¼•è®°å½•çš„æ˜¯åœ°å€ã€‚æ¢å¥è¯è¯´ï¼ŒInnoDBçš„æ‰€æœ‰éèšç°‡ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚</p><p>â‘£ MyISAMçš„å›è¡¨æ“ä½œæ˜¯ååˆ†å¿«é€Ÿçš„ï¼Œå› ä¸ºæ˜¯æ‹¿ç€åœ°å€åç§»é‡ç›´æ¥åˆ°æ–‡ä»¶ä¸­å–æ•°æ®çš„ï¼Œåè§‚InnoDBæ˜¯é€šè¿‡è·å–ä¸»é”®ä¹‹åå†å»èšç°‡ç´¢å¼•é‡Œæ‰¾è®°å½•ï¼Œè™½ç„¶è¯´ä¹Ÿä¸æ…¢ï¼Œä½†è¿˜æ˜¯æ¯”ä¸ä¸Šç›´æ¥ç”¨åœ°å€å»è®¿é—®ã€‚</p><p>â‘¤ InnoDBè¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆMyISAMå¯ä»¥æ²¡æœ‰ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥éç©ºä¸”å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ã€‚å¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å‹ã€‚</p><p>è¡¥å……1ï¼šInnoDBçš„é€»è¾‘ç»“æ„å›¾ï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302252055728.png"></p><h4 id="4ã€ä¸ºä»€ä¹ˆè¦†ç›–ç´¢å¼•ä¸ç”¨å›è¡¨"><a href="#4ã€ä¸ºä»€ä¹ˆè¦†ç›–ç´¢å¼•ä¸ç”¨å›è¡¨" class="headerlink" title="4ã€ä¸ºä»€ä¹ˆè¦†ç›–ç´¢å¼•ä¸ç”¨å›è¡¨"></a>4ã€ä¸ºä»€ä¹ˆè¦†ç›–ç´¢å¼•ä¸ç”¨å›è¡¨</h4><p>ä¸€çº§ç´¢å¼•ï¼šèšç°‡ç´¢å¼•å³ä¸»é”®ç´¢å¼•<br>äºŒçº§ç´¢å¼•ï¼šéèšç°‡ç´¢å¼•</p><p>ä¸€çº§B+Treeï¼šå¶å­èŠ‚ç‚¹ä¿å­˜ç€é”®ï¼ˆidçš„å€¼ï¼‰å’Œæ•°æ®ï¼ˆå…¨éƒ¨å­—æ®µçš„å€¼ï¼‰<br>äºŒçº§B+Treeï¼šå¶å­èŠ‚ç‚¹ä¿å­˜ç€é”®ï¼ˆç´¢å¼•å­—æ®µçš„å€¼ï¼‰å’Œæ•°æ®ï¼ˆä¸»é”®ç´¢å¼•å€¼ï¼‰</p><p>æŸ¥è¯¢ ä¸€çº§ç´¢å¼•ï¼Œæ ¹æ®ä¸€çº§B+TreeæŸ¥è¯¢åˆ°æ•°æ®ï¼Œç›´æ¥è¿”å›æ•°æ®<br>æŸ¥è¯¢ äºŒçº§ç´¢å¼•ï¼Œæ ¹æ®äºŒçº§B+TreeæŸ¥è¯¢åˆ°å¯¹åº”çš„èšç°‡ç´¢å¼•ï¼Œå†æ ¹æ®èšç°‡ç´¢å¼•åœ¨ä¸€çº§B+Treeé‡ŒæŸ¥è¯¢åˆ°ç›¸åº”æ•°æ®</p><p>æŸ¥è¯¢ ä¸€çº§ç´¢å¼•åªéœ€è¦æ‰«æä¸€æ¬¡B+Treeã€‚<br>æŸ¥è¯¢ äºŒçº§ç´¢å¼•éœ€è¦æ‰«æä¸¤æ¬¡B+Treeã€‚æ ¹æ®äºŒçº§B+Treeæ‰«æçš„ç»“æœï¼Œå†å»ä¸€çº§B+Treeé‡Œè¿›è¡Œæ‰«æå°±å«å›è¡¨æ“ä½œã€‚</p><p>å¦‚æœä½¿ç”¨ç»„åˆç´¢å¼•ï¼Œå°±å¯ä»¥åˆ©ç”¨è¦†ç›–ç´¢å¼•é¿å…å›è¡¨æ“ä½œ<br>ä¾‹å¦‚ï¼šè¡¨ä¸€å…±æœ‰äº”ä¸ªå­—æ®µï¼šaï¼ˆä¸»é”®ç´¢å¼•ï¼‰ï¼Œb_c_dï¼ˆç»„åˆç´¢å¼•ï¼‰ï¼Œeï¼ˆæ²¡æœ‰ç´¢å¼•ï¼‰</p><p>å¦‚æœç”¨æˆ·æŸ¥è¯¢æ—¶åªæŸ¥ b,c,d ä¾‹ï¼šSELECT <code>b</code>, <code>c</code>, <code>d</code> FROM <code>table</code> WHERE <code>b</code> = 3 AND <code>c</code> = 7 AND <code>d</code> = 5;</p><p>å› ä¸ºæŸ¥è¯¢çš„å­—æ®µ b,c,dçš„å€¼ï¼ˆB+Treeé‡Œçš„é”®ï¼‰ å·²ç»åœ¨B+Treeé‡Œäº†ï¼Œæ‰€ä»¥å°±å¯ä»¥ç›´æ¥è¿”å›ï¼Œä¸ç”¨å†æ‹¿èšç°‡ç´¢å¼•å»ä¸€çº§B+Treeé‡Œè¿›è¡ŒæŸ¥è¯¢<br>å¦‚æœæŸ¥è¯¢å­—æ®µä¸º a,b,c,d å› ä¸ºaä¸ºä¸»é”®ç´¢å¼•ï¼Œä¹Ÿä¿å­˜å†äºŒçº§B+Treeçš„å¶å­èŠ‚ç‚¹é‡Œï¼Œæ‰€ä»¥ä¹Ÿä¸ç”¨å›è¡¨æŸ¥è¯¢<br>å¦‚æœæŸ¥è¯¢å­—æ®µä¸º a,b,c,d,e å› ä¸ºeæ²¡æœ‰åœ¨è¿™ä¸ªäºŒçº§B+Treeé‡Œï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œå›è¡¨æ“ä½œï¼Œæ‹¿ç€ä¸»é”®ç´¢å¼•å†å»ä¸€çº§B+Treeé‡Œè¿›è¡ŒæŸ¥è¯¢ã€‚</p><h4 id="5ã€B-tree"><a href="#5ã€B-tree" class="headerlink" title="5ã€B+tree"></a>5ã€B+tree</h4><p>æ—¶é—´å¤æ‚åº¦ï¼š<strong>O(logN)</strong></p><p>B+Treeæ˜¯B-Treeçš„å˜ç§ï¼Œæˆ‘ä»¬ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼‰ä¸º4é˜¶ï¼ˆ4æŒ‡é’ˆ3keyï¼‰çš„b+treeä¸ºä¾‹</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302252105651.png"></p><p>æœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°ï¼ŒB+Tree ä¸ B-Treeç›¸æ¯”ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç‚¹åŒºåˆ«ï¼š </p><ul><li>æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹ã€‚ </li><li>å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚ </li><li>éå¶å­èŠ‚ç‚¹ä»…ä»…èµ·åˆ°ç´¢å¼•æ•°æ®ä½œç”¨ï¼Œå…·ä½“çš„æ•°æ®éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ã€‚ </li></ul><p>MySQLç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„B+Treeè¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸB+Treeçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œåˆ©äºæ’åºã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302252123348.png"></p><h4 id="6ã€SQLä¼˜åŒ–ï¼ˆæ…¢SQLä¼˜åŒ–ï¼‰"><a href="#6ã€SQLä¼˜åŒ–ï¼ˆæ…¢SQLä¼˜åŒ–ï¼‰" class="headerlink" title="6ã€SQLä¼˜åŒ–ï¼ˆæ…¢SQLä¼˜åŒ–ï¼‰"></a>6ã€SQLä¼˜åŒ–ï¼ˆæ…¢SQLä¼˜åŒ–ï¼‰</h4><p>ç¬¬ä¸€æ­¥ï¼šå¯ä»¥ç”¨ <code>explain</code> æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</p><p>å¸¸è§æ¡ˆä¾‹ä¼˜åŒ–ï¼š</p><p>1-1ã€<strong>insert</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> tb_test <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> tb_test <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> tb_test <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'jerry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¼˜åŒ–ï¼Œé€šè¿‡æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> tb_test <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Cat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'Jerry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> tb_test <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'Cat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">'Jerry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> tb_test <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'Cat'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">'Jerry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">commit</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1-2ã€<strong>å¤§æ‰¹é‡æ’å…¥æ•°æ®</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒåŠ ä¸Šå‚æ•° -â€“local-infile</span>mysql â€“<span class="token operator">-</span><span class="token keyword">local</span><span class="token operator">-</span><span class="token keyword">infile</span> <span class="token operator">-</span>u root <span class="token operator">-</span>p<span class="token comment">-- è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º1ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³</span><span class="token keyword">set</span> <span class="token keyword">global</span> local_infile <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">-- æ‰§è¡ŒloadæŒ‡ä»¤å°†å‡†å¤‡å¥½çš„æ•°æ®ï¼ŒåŠ è½½åˆ°è¡¨ç»“æ„ä¸­</span><span class="token keyword">load</span> <span class="token keyword">data</span> <span class="token keyword">local</span> <span class="token keyword">infile</span> <span class="token string">'/root/sql1.log'</span> <span class="token keyword">into</span> <span class="token keyword">table</span> tb_user <span class="token keyword">fields</span><span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span> <span class="token keyword">lines</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\n'</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸»é”®é¡ºåºæ’å…¥æ€§èƒ½é«˜äºä¹±åºæ’å…¥</p><p>2-1ã€<strong>ä¸»é”®ä¼˜åŒ–</strong></p><ul><li>æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦ã€‚ </li><li>æ’å…¥æ•°æ®æ—¶ï¼Œå°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨AUTO_INCREMENTè‡ªå¢ä¸»é”®ã€‚ï¼ˆå•è°ƒé€’å¢ï¼Œé«˜å¹¶å‘IDï¼šé›ªèŠ±ç®—æ³•ï¼‰</li><li>å°½é‡ä¸è¦ä½¿ç”¨UUIDåšä¸»é”®æˆ–è€…æ˜¯å…¶ä»–è‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å·ã€‚ </li><li>ä¸šåŠ¡æ“ä½œæ—¶ï¼Œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹ã€‚ </li></ul><p>3-1ã€<strong>order by</strong> ä¼˜åŒ–</p><ul><li>æ ¹æ®æ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œå¤šå­—æ®µæ’åºæ—¶ï¼Œä¹Ÿéµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚</li><li> å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•</li><li>å¤šå­—æ®µæ’åº, ä¸€ä¸ªå‡åºä¸€ä¸ªé™åºï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„è”åˆç´¢å¼•åœ¨åˆ›å»ºæ—¶çš„è§„åˆ™ï¼ˆASC/DESCï¼‰</li><li>å¦‚æœä¸å¯é¿å…çš„å‡ºç°filesortï¼Œå¤§æ•°æ®é‡æ’åºæ—¶ï¼Œå¯ä»¥é€‚å½“å¢å¤§æ’åºç¼“å†²åŒºå¤§å° sort_buffer_size(é»˜è®¤256k</li></ul><p>ç§‘æ™®ï¼š</p><p>1ã€æœ€å·¦å‰ç¼€æ³•åˆ™ï¼ˆæœ€å·¦åŸåˆ™ï¼‰ï¼š</p><p>æ¯”å¦‚ï¼Œage å­—æ®µæœ‰ç´¢å¼•ï¼Œphone æ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ’åºçš„æ—¶å€™ï¼Œå…ˆå†™age å†™åœ¨å·¦è¾¹</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302252153639.png"></p><p>2ã€Using filesort and Using index</p><ul><li>MySQLçš„æ’åºï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š </li><li>Using filesort : é€šè¿‡è¡¨çš„ç´¢å¼•æˆ–å…¨è¡¨æ‰«æï¼Œè¯»å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œç„¶ååœ¨æ’åºç¼“å†²åŒºsort bufferä¸­å®Œæˆæ’åºæ“ä½œï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å« FileSort æ’åºã€‚ </li><li>Using index : é€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜ã€‚ </li><li>å¯¹äºä»¥ä¸Šçš„ä¸¤ç§æ’åºæ–¹å¼ï¼ŒUsing indexçš„æ€§èƒ½é«˜ï¼Œè€ŒUsing filesortçš„æ€§èƒ½ä½ï¼Œæˆ‘ä»¬åœ¨ä¼˜åŒ–æ’åºæ“ä½œæ—¶ï¼Œå°½é‡è¦ä¼˜åŒ–ä¸º Using indexã€‚ </li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302252150380.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302252150422.png"></p><p>3ã€è¦†ç›–ç´¢å¼•ï¼š</p><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå‡å°‘select *ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•å‘¢ï¼Ÿè¦†ç›–ç´¢å¼•æ˜¯æŒ‡æŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œä¸”éœ€è¦è¿”å›çš„åˆ—ï¼Œåœ¨è¯¥ç´¢å¼•ä¸­å·²ç»å…¨éƒ¨èƒ½å¤Ÿæ‰¾åˆ°</p><p>4-1ã€ <strong>group by ** **ä¼˜åŒ–</strong> </p><ul><li>åœ¨åˆ†ç»„æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥æé«˜æ•ˆç‡</li><li>åˆ†ç»„æ“ä½œæ—¶ï¼Œç´¢å¼•çš„ä½¿ç”¨ä¹Ÿæ˜¯æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„</li></ul><p>5-1ã€<strong>limit ** **ä¼˜åŒ–</strong></p><p>ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»º è¦†ç›–ç´¢å¼• èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–ç´¢å¼•åŠ å­æŸ¥è¯¢å½¢å¼è¿›è¡Œä¼˜åŒ–</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_sku t <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> tb_sku <span class="token keyword">order</span> <span class="token keyword">by</span> id<span class="token keyword">limit</span> <span class="token number">2000000</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> a <span class="token keyword">where</span> t<span class="token punctuation">.</span>id <span class="token operator">=</span> a<span class="token punctuation">.</span>id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>6-1ã€<strong>count</strong> <strong>ä¼˜åŒ–</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302262102677.png"></p><p>æŒ‰ç…§æ•ˆç‡æ’åºçš„è¯ï¼Œcount(å­—æ®µ) &lt; count(ä¸»é”® id) &lt; count(1) â‰ˆ count(*)ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨ count(*)ã€‚</p><p><strong>7-1ã€update</strong> <strong>ä¼˜åŒ–</strong></p><p>æˆ‘ä»¬ä¸»è¦éœ€è¦æ³¨æ„ä¸€ä¸‹updateè¯­å¥æ‰§è¡Œæ—¶çš„æ³¨æ„äº‹é¡¹ã€‚(åŠ ç´¢å¼•çš„å­—æ®µ)</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> course <span class="token keyword">set</span> name <span class="token operator">=</span> <span class="token string">'javaEE'</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å½“æˆ‘ä»¬åœ¨æ‰§è¡Œåˆ é™¤çš„SQLè¯­å¥æ—¶ï¼Œä¼šé”å®šidä¸º1è¿™ä¸€è¡Œçš„æ•°æ®ï¼Œç„¶åäº‹åŠ¡æäº¤ä¹‹åï¼Œè¡Œé”é‡Šæ”¾ã€‚</p><p>ä½†æ˜¯å½“æˆ‘ä»¬åœ¨æ‰§è¡Œå¦‚ä¸‹SQLæ—¶ã€‚(æœªåŠ ç´¢å¼•çš„å­—æ®µ)</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> course <span class="token keyword">set</span> name <span class="token operator">=</span> <span class="token string">'SpringBoot'</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'PHP'</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å½“æˆ‘ä»¬å¼€å¯å¤šä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œä¸Šè¿°çš„SQLæ—¶ï¼Œæˆ‘ä»¬å‘ç°è¡Œé”å‡çº§ä¸ºäº†è¡¨é”ã€‚ å¯¼è‡´è¯¥updateè¯­å¥çš„æ€§èƒ½å¤§å¤§é™ä½ã€‚ </p><p><strong>InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•åŠ çš„é” ,å¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™ä¼šä»è¡Œé”å‡çº§ä¸ºè¡¨é” ã€‚</strong></p><h4 id="7ã€ç´¢å¼•å¤±æ•ˆ"><a href="#7ã€ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="7ã€ç´¢å¼•å¤±æ•ˆ"></a>7ã€ç´¢å¼•å¤±æ•ˆ</h4><p>1ã€<strong>ç´¢å¼•åˆ—è¿ç®—</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302262217534.png"></p><p>2ã€<strong>å­—ç¬¦ä¸²ä¸åŠ å¼•å·</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302262219304.png"></p><p>æˆ‘ä»¬ä¼šæ˜æ˜¾çš„å‘ç°ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ï¼Œå¯¹äºæŸ¥è¯¢ç»“æœï¼Œæ²¡ä»€ä¹ˆå½±å“ï¼Œä½†æ˜¯æ•°æ®åº“å­˜åœ¨éšå¼ç±»å‹è½¬æ¢ï¼Œç´¢å¼•å°†å¤±æ•ˆ</p><p>3ã€<strong>æ¨¡ç³ŠæŸ¥è¯¢</strong></p><p>åœ¨likeæ¨¡ç³ŠæŸ¥è¯¢ä¸­ï¼Œåœ¨å…³é”®å­—åé¢åŠ %ï¼Œç´¢å¼•å¯ä»¥ç”Ÿæ•ˆã€‚è€Œå¦‚æœåœ¨å…³é”®å­—å‰é¢åŠ äº†%ï¼Œç´¢å¼•å°†ä¼šå¤±æ•ˆã€‚ </p><p>4ã€<strong>or</strong> <strong>è¿æ¥æ¡ä»¶</strong></p><p>å½“orè¿æ¥çš„æ¡ä»¶ï¼Œå·¦å³ä¸¤ä¾§å­—æ®µéƒ½æœ‰ç´¢å¼•æ—¶ï¼Œç´¢å¼•æ‰ä¼šç”Ÿæ•ˆ</p><p>5ã€<strong>æ•°æ®åˆ†å¸ƒå½±å“</strong></p><p><strong>ï¼ˆ1ï¼‰åŸºæœ¬æ•°å€¼ï¼Œæ•°æ®ä¸åŒ</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302262236450.png"></p><p>MySQLåœ¨æŸ¥è¯¢æ—¶ï¼Œä¼šè¯„ä¼°ä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡ä¸èµ°å…¨è¡¨æ‰«æçš„æ•ˆç‡ï¼Œå¦‚æœèµ°å…¨è¡¨æ‰«ææ›´å¿«ï¼Œåˆ™æ”¾å¼ƒç´¢å¼•ï¼Œèµ°å…¨è¡¨æ‰«æã€‚ <strong>å› ä¸ºç´¢å¼•æ˜¯ç”¨æ¥ç´¢å¼•å°‘é‡æ•°æ®çš„ï¼Œå¦‚æœé€šè¿‡ç´¢å¼•æŸ¥è¯¢è¿”å›å¤§æ‰¹é‡çš„æ•°æ®ï¼Œåˆ™è¿˜ä¸å¦‚èµ°å…¨è¡¨æ‰«ææ¥çš„å¿«ï¼Œæ­¤æ—¶ç´¢å¼•å°±ä¼šå¤±æ•ˆ</strong></p><p><strong>ï¼ˆ2ï¼‰is null   ã€ is not null</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302262242400.png"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åšä¸€ä¸ªæ“ä½œå°†professionå­—æ®µå€¼å…¨éƒ¨æ›´æ–°ä¸ºnullï¼Œå†æ¬¡çœ‹ä¸‹æ‰§è¡Œè®¡åˆ’</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302262243088.png"></p><p>æœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°ï¼Œä¸€æ¨¡ä¸€æ ·çš„SQLè¯­å¥ï¼Œå…ˆåæ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œç»“æœæŸ¥è¯¢è®¡åˆ’æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§ ç°è±¡ï¼Œè¿™æ˜¯å’Œæ•°æ®åº“çš„æ•°æ®åˆ†å¸ƒæœ‰å…³ç³»ã€‚æŸ¥è¯¢æ—¶MySQLä¼šè¯„ä¼°ï¼Œèµ°ç´¢å¼•å¿«ï¼Œè¿˜æ˜¯å…¨è¡¨æ‰«æå¿«ï¼Œå¦‚æœå…¨è¡¨æ‰«ææ›´å¿«ï¼Œåˆ™æ”¾å¼ƒç´¢å¼•èµ°å…¨è¡¨æ‰«æã€‚ å› æ­¤ï¼Œis null ã€is not nullæ˜¯å¦èµ°ç´¢å¼•ï¼Œå¾—å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œå¹¶ä¸æ˜¯å›ºå®šçš„</p><p><strong>ï¼ˆ3ï¼‰æ€»ç»“ï¼š</strong></p><p>æ•°æ®åˆ†å¸ƒä¼šæ ¹æ®ç´¢å¼•æ•°æ®é‡å’Œå…¨è¡¨æ‰«æå¿«æ…¢æ¯”è¾ƒï¼Œå“ªä¸ªå¿«èµ°å“ªé‡Œ</p><p>8ã€ç´¢å¼•è®¾è®¡åŸåˆ™</p><ul><li>é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼Œä¸”æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹çš„è¡¨å»ºç«‹ç´¢å¼•ã€‚ </li><li>é’ˆå¯¹äºå¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼ˆwhereï¼‰ã€æ’åºï¼ˆorder byï¼‰ã€åˆ†ç»„ï¼ˆgroup byï¼‰æ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•</li><li>å°½é‡é€‰æ‹©åŒºåˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•ï¼Œå°½é‡å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜ã€‚ (eg:0,1é‚£ç§çŠ¶æ€ä¸è¦å»ºç«‹</li><li>å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå­—æ®µçš„é•¿åº¦è¾ƒé•¿ï¼Œå¯ä»¥é’ˆå¯¹äºå­—æ®µçš„ç‰¹ç‚¹ï¼Œå»ºç«‹å‰ç¼€ç´¢å¼•ã€‚ </li><li>å°½é‡ä½¿ç”¨è”åˆç´¢å¼•ï¼Œå‡å°‘å•åˆ—ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•å¾ˆå¤šæ—¶å€™å¯ä»¥è¦†ç›–ç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œé¿å…å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ </li><li>è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡ï¼Œç´¢å¼•å¹¶ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•ç»“æ„çš„ä»£ä»·ä¹Ÿå°±è¶Šå¤§ï¼Œä¼šå½±å“å¢åˆ æ”¹çš„æ•ˆç‡ã€‚</li></ul><h2 id="ä¸‰ã€MQ"><a href="#ä¸‰ã€MQ" class="headerlink" title="ä¸‰ã€MQ"></a>ä¸‰ã€MQ</h2><p>æ‰§è¡Œæµç¨‹ ã€æ¶ˆæ¯å¯é æ€§æŠ•é€’ï¼ˆç°æœ‰ä¼ä¸šå°è£…äº†ã€‚ã€‚ã€‚ï¼‰-å°æ€»ç»“ã€</p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092229549.png"></p><h3 id="1ã€å¸¸è§„"><a href="#1ã€å¸¸è§„" class="headerlink" title="1ã€å¸¸è§„"></a>1ã€å¸¸è§„</h3><h4 id="1ã€ä»€ä¹ˆæ˜¯MQï¼Œä¼˜ç¼ºç‚¹"><a href="#1ã€ä»€ä¹ˆæ˜¯MQï¼Œä¼˜ç¼ºç‚¹" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯MQï¼Œä¼˜ç¼ºç‚¹"></a>1ã€ä»€ä¹ˆæ˜¯MQï¼Œä¼˜ç¼ºç‚¹</h4><p>æ¶ˆæ¯é˜Ÿåˆ—</p><p>å¼‚æ­¥å¤„ç†ï¼Œæé«˜ååé‡</p><p>åº”ç”¨è§£è€¦ï¼Œæ¯”å¦‚å‘é€çŸ­ä¿¡</p><p>æµé‡å‰Šå³°ï¼Œå¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦æ§åˆ¶è¯·æ±‚é‡</p><p>å¢åŠ ç³»ç»Ÿå¤æ‚åº¦ï¼Œéœ€è¦ä¿è¯æ¶ˆæ¯ä¸é‡å¤æ¶ˆè´¹ï¼Œä¿è¯ä¸€è‡´æ€§ï¼Œæ¶ˆæ¯å¯é æ€§</p><h4 id="2ã€ä»€ä¹ˆæ˜¯RabbitMqï¼Ÿä¸ºä»€ä¹ˆç”¨ï¼Ÿåº”ç”¨åœºæ™¯ï¼Ÿ"><a href="#2ã€ä»€ä¹ˆæ˜¯RabbitMqï¼Ÿä¸ºä»€ä¹ˆç”¨ï¼Ÿåº”ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="2ã€ä»€ä¹ˆæ˜¯RabbitMqï¼Ÿä¸ºä»€ä¹ˆç”¨ï¼Ÿåº”ç”¨åœºæ™¯ï¼Ÿ"></a>2ã€ä»€ä¹ˆæ˜¯RabbitMqï¼Ÿä¸ºä»€ä¹ˆç”¨ï¼Ÿåº”ç”¨åœºæ™¯ï¼Ÿ</h4><p>åŸºäºerlangè¯­è¨€å¼€å‘ï¼ŒåŸºäºAMQPåè®®çš„æ¶ˆæ¯ä¸­é—´ä»¶</p><p>ç¤¾åŒºæ´»è·ƒï¼Œå›½å†…ä½¿ç”¨çš„å…¬å¸ä¹Ÿå¤šï¼Œååé‡ä¸‡çº§åˆ°åä¸‡çº§åˆ«ï¼Œå®Œå–„çš„ç®¡ç†ç•Œé¢ã€‚æˆç†Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><p>åº”ç”¨åœºæ™¯ï¼šæœåŠ¡é—´å¼‚æ­¥é€šä¿¡ï¼Œé¡ºåºæ¶ˆè´¹ï¼Œå®šæ—¶ä»»åŠ¡ï¼Œè¯·æ±‚å‰Šå³°</p><h4 id="3ã€RabbitMQåŸºæœ¬æ¦‚å¿µ"><a href="#3ã€RabbitMQåŸºæœ¬æ¦‚å¿µ" class="headerlink" title="3ã€RabbitMQåŸºæœ¬æ¦‚å¿µ?"></a>3ã€<strong>RabbitMQåŸºæœ¬æ¦‚å¿µ?</strong></h4><p>Exchange äº¤æ¢æœº</p><p>Queue æ¶ˆæ¯é˜Ÿåˆ—</p><p>Binding ç»‘å®šï¼Œå°†äº¤æ¢æœºå’Œé˜Ÿåˆ—æŒ‰è·¯ç”±è§„åˆ™ç»‘å®šèµ·æ¥</p><p>Routing Key è·¯ç”±å…³é”®å­—ï¼Œexchangeæ ¹æ®è¿™ä¸ªå…³é”®å­—è¿›è¡Œæ¶ˆæ¯æŠ•é€’</p><p>VHost ç›¸å½“äºæŸä¸ªæ•°æ®åº“</p><p>Producer æ¶ˆæ¯ç”Ÿäº§è€…</p><p>Consumer æ¶ˆæ¯æ¶ˆè´¹è€…</p><h4 id="4ã€RabbitMqå·¥ä½œæ¨¡å¼ï¼Ÿ"><a href="#4ã€RabbitMqå·¥ä½œæ¨¡å¼ï¼Ÿ" class="headerlink" title="4ã€RabbitMqå·¥ä½œæ¨¡å¼ï¼Ÿ"></a>4ã€RabbitMqå·¥ä½œæ¨¡å¼ï¼Ÿ</h4><ol><li>ç®€å•æ¨¡å¼ HelloWorld ï¼šä¸€ä¸ªç”Ÿäº§è€…ã€ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰ã€‚</li><li>å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ Work Queue ï¼šä¸€ä¸ªç”Ÿäº§è€…ã€å¤šä¸ªæ¶ˆè´¹è€…ï¼ˆç«äº‰å…³ç³»ï¼‰ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰ã€‚</li><li>å‘å¸ƒè®¢é˜…æ¨¡å¼ Publish/subscribe ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º fanout çš„äº¤æ¢æœºï¼Œå¹¶ä¸”äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šå°†æ¶ˆæ¯å‘é€åˆ°ç»‘å®šçš„é˜Ÿåˆ—ã€‚</li><li>è·¯ç”±æ¨¡å¼ Routing ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º direct çš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®š routing keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ® routing key å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚</li><li>é€šé…ç¬¦æ¨¡å¼ Topic ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º topic çš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®šé€šé…ç¬¦æ–¹å¼çš„ routing keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ® routing key å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚</li></ol><h4 id="5ã€RabbitMqå¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åºæ€§"><a href="#5ã€RabbitMqå¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åºæ€§" class="headerlink" title="5ã€RabbitMqå¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åºæ€§?"></a>5ã€RabbitMqå¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åºæ€§?</h4><p>ä¸€ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€…</p><h4 id="6ã€RabbitMqå¦‚ä½•ä¿è¯æ¶ˆè´¹ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹ï¼Ÿ"><a href="#6ã€RabbitMqå¦‚ä½•ä¿è¯æ¶ˆè´¹ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹ï¼Ÿ" class="headerlink" title="6ã€RabbitMqå¦‚ä½•ä¿è¯æ¶ˆè´¹ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹ï¼Ÿ"></a>6ã€RabbitMqå¦‚ä½•ä¿è¯æ¶ˆè´¹ä¸ä¼šè¢«é‡å¤æ¶ˆè´¹ï¼Ÿ</h4><p>æ ¹æ®ä¸šåŠ¡æ¥ï¼Œæ¯”å¦‚è®¢å•æœ‰çŠ¶æ€ã€‚æˆ–è€…å®šä¹‰å”¯ä¸€æ ‡è¯†ï¼Œæ¶ˆè´¹åç¼“å­˜åˆ°redisã€‚åœ¨æ­¤æ¶ˆè´¹æ—¶å€™åˆ¤æ–­ä¸€ä¸‹redisã€‚</p><h4 id="7ã€RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§"><a href="#7ã€RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§" class="headerlink" title="7ã€RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§?"></a>7ã€RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§?</h4><p>ç”Ÿäº§è€…ä¸¢å¤±æ¶ˆæ¯ï¼š</p><p>1.ä½¿ç”¨äº‹åŠ¡æœºåˆ¶ï¼Œç‰ºç‰²æ€§èƒ½</p><p>2.ä½¿ç”¨confirmæ¨¡å¼ï¼Œå‘é€æˆåŠŸä¹‹åï¼Œä¼šè¿”å›ackåˆ°ç”Ÿäº§è€…</p><p>æ¶ˆæ¯é˜Ÿåˆ—ä¸¢å¤±æ¶ˆæ¯ï¼š</p><p>1.æ¶ˆæ¯æŒä¹…åŒ–</p><p>Exchange è®¾ç½®æŒä¹…åŒ– ,Queue è®¾ç½®æŒä¹…åŒ–ï¼Œdurableè®¾ç½®ä¸ºtrue</p><p>MessageæŒä¹…åŒ–å‘é€ï¼šå‘é€æ¶ˆæ¯è®¾ç½®å‘é€æ¨¡å¼deliveryMode=2ï¼Œä»£è¡¨æŒä¹…åŒ–æ¶ˆæ¯</p><p>æ¶ˆè´¹è€…ä¸¢å¤±æ¶ˆæ¯</p><p>1.ACKç¡®è®¤æœºåˆ¶</p><p>æ¶ˆè´¹è€…ç¡®è®¤æ¶ˆè´¹åï¼ŒRabbitMqæ‰ä¼šå°†æ¶ˆæ¯åˆ é™¤</p><h4 id="8ã€RabbitMQéƒ¨ç½²æ–¹å¼"><a href="#8ã€RabbitMQéƒ¨ç½²æ–¹å¼" class="headerlink" title="8ã€RabbitMQéƒ¨ç½²æ–¹å¼?"></a>8ã€RabbitMQéƒ¨ç½²æ–¹å¼?</h4><p>1.å•æœºæ¨¡å¼ 2.æ™®é€šé›†ç¾¤(ä¸»ä») 3.é•œåƒé›†ç¾¤</p><h4 id="9ã€ä»€ä¹ˆæ˜¯RocketMQï¼Ÿ"><a href="#9ã€ä»€ä¹ˆæ˜¯RocketMQï¼Ÿ" class="headerlink" title="9ã€ä»€ä¹ˆæ˜¯RocketMQï¼Ÿ"></a>9ã€ä»€ä¹ˆæ˜¯<strong>RocketMQï¼Ÿ</strong></h4><p>javaå¼€å‘ï¼Œé¢å‘äº’è”ç½‘é›†ç¾¤åŒ–ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œå¯¹åœ¨çº¿ä¸šåŠ¡çš„å“åº”æ—¶å»¶åšäº†å¾ˆå¤šçš„ä¼˜åŒ–ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥åšåˆ°æ¯«ç§’çº§çš„å“åº”ï¼Œæ¯ç§’é’Ÿå¤§æ¦‚èƒ½å¤„ç†å‡ åä¸‡æ¡æ¶ˆæ¯</p><h4 id="10ã€RocketMqå®ç°æ¶ˆæ¯äº‹åŠ¡çš„æµç¨‹ï¼Ÿ"><a href="#10ã€RocketMqå®ç°æ¶ˆæ¯äº‹åŠ¡çš„æµç¨‹ï¼Ÿ" class="headerlink" title="10ã€RocketMqå®ç°æ¶ˆæ¯äº‹åŠ¡çš„æµç¨‹ï¼Ÿ"></a>10ã€RocketMqå®ç°æ¶ˆæ¯äº‹åŠ¡çš„æµç¨‹ï¼Ÿ</h4><p>1.æœåŠ¡Aå‘é€ä¸€ä¸ªåŠäº‹åŠ¡æ¶ˆæ¯(half æ¶ˆæ¯)åˆ°RocketMqä¸­,ä¿è¯æœåŠ¡Aå’ŒRocketMqæ­£å¸¸é€šä¿¡,æ— æ³•æ­£å¸¸é€šä¿¡åˆ™å›æ»š,æ­£å¸¸åˆ™å¼€å§‹æœ¬åœ°äº‹åŠ¡ï¼Œå¤„ç†æœ¬åœ°ä¸šåŠ¡é€»è¾‘å¹¶æäº¤äº‹åŠ¡.</p><p>2.äº‹åŠ¡æäº¤æˆåŠŸåˆ™å‘RocketMqå‘é€æäº¤ï¼Œè¡¨ç¤ºå°† half æ¶ˆæ¯æäº¤ï¼Œå°† half æ¶ˆæ¯å†™å…¥åˆ°ç£ç›˜.äº‹åŠ¡æäº¤å¤±è´¥åˆ™å‘RocketMqå‘é€å›æ»šï¼Œåˆ é™¤ half æ¶ˆæ¯.</p><p>3.å¦‚æœRocketMqæŒ‡å®šæ—¶é—´æ²¡æœ‰æ”¶åˆ°æäº¤æˆ–è€…å›æ»šæ¶ˆæ¯ï¼Œå°†å°è¯•è°ƒç”¨æœåŠ¡Aæä¾›çš„ä¸€ä¸ªæ¥å£æ¥åˆ¤æ–­half æ¶ˆæ¯å¯¹äºçš„ä¸šåŠ¡æ˜¯å¦æˆåŠŸï¼ŒæˆåŠŸåˆ™æŒä¹…åŒ–ï¼Œå¤±è´¥åˆ™åˆ é™¤</p><p>4.æœåŠ¡Bæ¶ˆè´¹RocketMqä¸­çš„æ¶ˆæ¯ï¼Œå¤„ç†æœ¬åœ°ä¸šåŠ¡ï¼Œæäº¤äº‹åŠ¡</p><h4 id="11ã€RocketMqçš„half-æ¶ˆæ¯æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#11ã€RocketMqçš„half-æ¶ˆæ¯æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="11ã€RocketMqçš„half æ¶ˆæ¯æ˜¯ä»€ä¹ˆï¼Ÿ"></a>11ã€RocketMqçš„half æ¶ˆæ¯æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>halfæ¶ˆæ¯åªæœ‰è¢«æäº¤åæ‰ä¼šè¢«æ¶ˆè´¹è€…æ¶ˆè´¹</p><h4 id="12ã€ä¸ºä»€ä¹ˆè¦å…ˆå‘é€-half-æ¶ˆæ¯ï¼Ÿ"><a href="#12ã€ä¸ºä»€ä¹ˆè¦å…ˆå‘é€-half-æ¶ˆæ¯ï¼Ÿ" class="headerlink" title="12ã€ä¸ºä»€ä¹ˆè¦å…ˆå‘é€ half æ¶ˆæ¯ï¼Ÿ"></a>12ã€ä¸ºä»€ä¹ˆè¦å…ˆå‘é€ half æ¶ˆæ¯ï¼Ÿ</h4><p>ä¸ºäº†ä¿è¯æœåŠ¡ A å’Œ RocketMqä¹‹é—´æ˜¯å¦èƒ½æ­£å¸¸é€šä¿¡</p><h4 id="13ã€å¦‚æœæœåŠ¡-A-æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ"><a href="#13ã€å¦‚æœæœåŠ¡-A-æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="13ã€å¦‚æœæœåŠ¡ A æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ"></a>13ã€å¦‚æœæœåŠ¡ A æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ</h4><p>æœ¬åœ°äº‹åŠ¡è¿›è¡Œå›æ»šï¼Œåœ¨å‘ RocketMqå‘é€ rollback æ“ä½œã€‚</p><h4 id="14ã€æœåŠ¡-B-æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ"><a href="#14ã€æœåŠ¡-B-æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="14ã€æœåŠ¡ B æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ"></a>14ã€æœåŠ¡ B æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ</h4><p>å¯ä»¥è¿›è¡Œå¤šæ¬¡é‡è¯•ï¼Œç›´åˆ°æˆåŠŸã€‚å¦‚æœé‡è¯•å¤šæ¬¡åï¼Œè¿˜æ˜¯æäº¤å¤±è´¥ï¼Œé‚£ä¹ˆ MQ ä¼šåœ¨ä¸€å®šæ—¶é—´åï¼Œç»§ç»­å°†è¿™æ¡æ¶ˆæ¯æ¨é€ç»™æœåŠ¡ Bï¼ŒæœåŠ¡ B å°±å¯ä»¥ç»§ç»­æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶æäº¤äº†ï¼Œç›´åˆ°æˆåŠŸã€‚ä¿è¯æœ€ç»ˆä¸€è‡´æ€§</p><h4 id="15ã€å¦‚ä½•ä¿è¯RocketMqæ¶ˆæ¯ä¸ä¸¢å¤±"><a href="#15ã€å¦‚ä½•ä¿è¯RocketMqæ¶ˆæ¯ä¸ä¸¢å¤±" class="headerlink" title="15ã€å¦‚ä½•ä¿è¯RocketMqæ¶ˆæ¯ä¸ä¸¢å¤±?"></a>15ã€å¦‚ä½•ä¿è¯RocketMqæ¶ˆæ¯ä¸ä¸¢å¤±?</h4><p>ç”Ÿäº§é˜¶æ®µåªè¦å‘é€è¿”å›okçŠ¶æ€å°±ä»£è¡¨æˆåŠŸ,</p><p>å¼‚æ­¥å‘é€åœ¨å›è°ƒä¸­å¯ä»¥æ£€æŸ¥å‘é€çŠ¶æ€okå°±ä»£è¡¨æˆåŠŸ,</p><p>å­˜å‚¨é˜¶æ®µä¿®æ”¹åˆ·ç›˜ç­–ç•¥ä¸ºåŒæ­¥åˆ·ç›˜ã€‚é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥åˆ·ç›˜çš„ã€‚</p><p>é›†ç¾¤éƒ¨ç½²ï¼Œä¸€ä¸»å¤šä»ã€‚é»˜è®¤å¼‚æ­¥å¤åˆ¶ï¼Œè®¾ç½®åŒæ­¥å¤åˆ¶ï¼Œç‰ºç‰²æ€§èƒ½</p><p>ä¸»èŠ‚ç‚¹è®¾ç½®åŒæ­¥å¤åˆ¶ brokerRole=SYNC_MASTER</p><h3 id="2ã€è¿›é˜¶"><a href="#2ã€è¿›é˜¶" class="headerlink" title="2ã€è¿›é˜¶"></a>2ã€è¿›é˜¶</h3><h4 id="1ã€Rabbitmq-æ‰§è¡Œæµç¨‹"><a href="#1ã€Rabbitmq-æ‰§è¡Œæµç¨‹" class="headerlink" title="1ã€Rabbitmq æ‰§è¡Œæµç¨‹"></a>1ã€Rabbitmq æ‰§è¡Œæµç¨‹</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092235471.png"></p><ul><li>Brokerï¼šæ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Serverå°±æ˜¯ Message Broker</li><li>Virtual hostï¼šå‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠ AMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºç½‘ ç»œä¸­çš„ namespace æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ª RabbitMQ server æä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤š ä¸ªvhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ vhost åˆ›å»º exchangeï¼queue ç­‰</li><li>Connectionï¼špublisherï¼consumer å’Œ broker ä¹‹é—´çš„ TCP è¿æ¥</li><li>Channelï¼šå¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ª Connectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹ TCP Connection çš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channel æ˜¯åœ¨ connection å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ ç¨‹ï¼Œé€šå¸¸æ¯ä¸ªthreadåˆ›å»ºå•ç‹¬çš„ channel è¿›è¡Œé€šè®¯ï¼ŒAMQP method åŒ…å«äº†channel id å¸®åŠ©å®¢æˆ·ç«¯å’Œ message broker è¯†åˆ« channelï¼Œæ‰€ä»¥ channel ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channel ä½œä¸ºè½»é‡çº§çš„ Connection æå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹ TCP connection çš„å¼€é”€</li><li>Exchangeï¼šmessage åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œåˆ†å‘æ¶ˆæ¯åˆ° queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šdirect (point-to-point), topic (publish-subscribe) and fanout (multicast)</li><li>Queueï¼šæ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾… consumer å–èµ°</li><li>Bindingï¼šexchange å’Œ queue ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbinding ä¸­å¯ä»¥åŒ…å« routing keyã€‚Binding ä¿¡æ¯è¢«ä¿å­˜åˆ° exchange ä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äº message çš„åˆ†å‘ä¾æ®</li></ul><h4 id="2ã€MQæ¶ˆæ¯å¯é æ€§æŠ•é€’"><a href="#2ã€MQæ¶ˆæ¯å¯é æ€§æŠ•é€’" class="headerlink" title="2ã€MQæ¶ˆæ¯å¯é æ€§æŠ•é€’"></a>2ã€MQæ¶ˆæ¯å¯é æ€§æŠ•é€’</h4><p>0ã€<strong>ä¸»è¦å®ç°æ­¥éª¤</strong></p><ul><li>ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶</li><li>æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶</li><li>æŒä¹…åŒ–ï¼ˆäº¤æ¢æœºï¼Œé˜Ÿåˆ—ï¼Œæ¶ˆæ¯ï¼‰</li><li>å¤±è´¥é‡è¯•æœºåˆ¶</li><li>æ¶ˆæ¯å †ç§¯é—®é¢˜</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303072220195.png"></p><p>1ã€<strong>ç”Ÿäº§è€…æ¶ˆæ¯ç¡®è®¤</strong></p><p>ï¼ˆ1ï¼‰publisher-comfirmï¼šæ¶ˆæ¯æˆåŠŸå‘é€åˆ°exchangeï¼Œè¿”å›ackæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæ²¡æœ‰åˆ°è¾¾äº¤æ¢æœºï¼Œè¿”å›nackæ¶ˆæ¯ï¼Œå‘é€è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰æ”¶åˆ°å›æ‰§</p><p>ï¼ˆ2ï¼‰æ¶ˆæ¯æˆåŠŸå‘é€åˆ°exchangeï¼Œä½†æ²¡æœ‰è·¯ç”±åˆ°queueï¼Œå›è°ƒReturnCallback</p><p>ï¼ˆ3ï¼‰ç¡®è®¤æœºåˆ¶å‘é€æ¶ˆæ¯æ—¶ï¼Œéœ€è¦ç»™æ¯ä¸ªæ¶ˆæ¯è®¾ç½®ä¸€ä¸ªå…¨å±€å”¯ä¸€idï¼Œä»¥åŒºåˆ†ä¸åŒæ¶ˆæ¯ï¼Œé¿å…ackå†²çª</p><p>2ã€<strong>æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶</strong></p><p>RabbitMQæ˜¯<strong>é˜…åå³ç„š</strong>æœºåˆ¶ï¼ŒRabbitMQç¡®è®¤æ¶ˆæ¯è¢«æ¶ˆè´¹è€…æ¶ˆè´¹åä¼šç«‹åˆ»åˆ é™¤ã€‚</p><p>è€ŒRabbitMQæ˜¯é€šè¿‡æ¶ˆè´¹è€…å›æ‰§æ¥ç¡®è®¤æ¶ˆè´¹è€…æ˜¯å¦æˆåŠŸå¤„ç†æ¶ˆæ¯çš„ï¼šæ¶ˆè´¹è€…è·å–æ¶ˆæ¯åï¼Œåº”è¯¥å‘RabbitMQå‘é€ACKå›æ‰§ï¼Œè¡¨æ˜è‡ªå·±å·²ç»å¤„ç†æ¶ˆæ¯ã€‚</p><p>è®¾æƒ³è¿™æ ·çš„åœºæ™¯ï¼š</p><p>1ï¼‰RabbitMQæŠ•é€’æ¶ˆæ¯ç»™æ¶ˆè´¹è€…</p><p>2ï¼‰æ¶ˆè´¹è€…è·å–æ¶ˆæ¯åï¼Œè¿”å›ACKç»™RabbitMQ</p><p>3ï¼‰RabbitMQåˆ é™¤æ¶ˆæ¯</p><p>4ï¼‰æ¶ˆè´¹è€…å®•æœºï¼Œæ¶ˆæ¯å°šæœªå¤„ç†</p><p>è¿™æ ·ï¼Œæ¶ˆæ¯å°±ä¸¢å¤±äº†ã€‚å› æ­¤æ¶ˆè´¹è€…è¿”å›ACKçš„æ—¶æœºéå¸¸é‡è¦ã€‚</p><p>è€ŒSpringAMQPåˆ™å…è®¸é…ç½®ä¸‰ç§ç¡®è®¤æ¨¡å¼ï¼š</p><p>â€¢manualï¼šæ‰‹åŠ¨ackï¼Œéœ€è¦åœ¨ä¸šåŠ¡ä»£ç ç»“æŸåï¼Œè°ƒç”¨apiå‘é€ackã€‚</p><p>â€¢autoï¼šè‡ªåŠ¨ackï¼Œç”±springç›‘æµ‹listenerä»£ç æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œæ²¡æœ‰å¼‚å¸¸åˆ™è¿”å›ackï¼›æŠ›å‡ºå¼‚å¸¸åˆ™è¿”å›nack</p><p>â€¢noneï¼šå…³é—­ackï¼ŒMQå‡å®šæ¶ˆè´¹è€…è·å–æ¶ˆæ¯åä¼šæˆåŠŸå¤„ç†ï¼Œå› æ­¤æ¶ˆæ¯æŠ•é€’åç«‹å³è¢«åˆ é™¤</p><p>ç”±æ­¤å¯çŸ¥ï¼š</p><p>noneæ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯æŠ•é€’æ˜¯ä¸å¯é çš„ï¼Œå¯èƒ½ä¸¢å¤±</p><p>autoæ¨¡å¼ç±»ä¼¼äº‹åŠ¡æœºåˆ¶ï¼Œå‡ºç°å¼‚å¸¸æ—¶è¿”å›nackï¼Œæ¶ˆæ¯å›æ»šåˆ°mqï¼›æ²¡æœ‰å¼‚å¸¸ï¼Œè¿”å›ack</p><p>manualï¼šè‡ªå·±æ ¹æ®ä¸šåŠ¡æƒ…å†µï¼Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¯¥ack</p><p>ä¸€èˆ¬ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨é»˜è®¤çš„autoå³å¯</p><p>3ã€<strong>æŒä¹…åŒ–</strong></p><p>ï¼ˆ1ï¼‰äº¤æ¢æœºæŒä¹…åŒ–</p><p>RabbitMQä¸­äº¤æ¢æœºé»˜è®¤æ˜¯éæŒä¹…åŒ–çš„ï¼Œmqé‡å¯åå°±ä¸¢å¤±ã€‚</p><p>SpringAMQPä¸­å¯ä»¥é€šè¿‡ä»£ç æŒ‡å®šäº¤æ¢æœºæŒä¹…åŒ–ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">simpleExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">// ä¸‰ä¸ªå‚æ•°ï¼šäº¤æ¢æœºåç§°ã€æ˜¯å¦æŒä¹…åŒ–ã€å½“æ²¡æœ‰queueä¸å…¶ç»‘å®šæ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">"simple.direct"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>äº‹å®ä¸Šï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç”±SpringAMQPå£°æ˜çš„äº¤æ¢æœºéƒ½æ˜¯æŒä¹…åŒ–çš„ã€‚</p><p>å¯ä»¥åœ¨RabbitMQæ§åˆ¶å°çœ‹åˆ°æŒä¹…åŒ–çš„äº¤æ¢æœºéƒ½ä¼šå¸¦ä¸Š<code>D</code>çš„æ ‡ç¤ºï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303051551218.png"></p><p>ï¼ˆ2ï¼‰é˜Ÿåˆ—æŒä¹…åŒ–</p><p>RabbitMQä¸­é˜Ÿåˆ—é»˜è®¤æ˜¯éæŒä¹…åŒ–çš„ï¼Œmqé‡å¯åå°±ä¸¢å¤±ã€‚</p><p>SpringAMQPä¸­å¯ä»¥é€šè¿‡ä»£ç æŒ‡å®šäº¤æ¢æœºæŒä¹…åŒ–ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">simpleQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">// ä½¿ç”¨QueueBuilderæ„å»ºé˜Ÿåˆ—ï¼Œdurableå°±æ˜¯æŒä¹…åŒ–çš„</span>    <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token string">"simple.queue"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>äº‹å®ä¸Šï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç”±SpringAMQPå£°æ˜çš„é˜Ÿåˆ—éƒ½æ˜¯æŒä¹…åŒ–çš„ã€‚</p><p>å¯ä»¥åœ¨RabbitMQæ§åˆ¶å°çœ‹åˆ°æŒä¹…åŒ–çš„é˜Ÿåˆ—éƒ½ä¼šå¸¦ä¸ŠDçš„æ ‡ç¤ºï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303051517011.png"></p><p>ï¼ˆ3ï¼‰æ¶ˆæ¯æŒä¹…åŒ–</p><p>åˆ©ç”¨SpringAMQPå‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥è®¾ç½®æ¶ˆæ¯çš„å±æ€§ï¼ˆMessagePropertiesï¼‰ï¼ŒæŒ‡å®šdelivery-modeï¼š</p><ul><li>1ï¼šéæŒä¹…åŒ–</li><li>2ï¼šæŒä¹…åŒ–</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringAMQPå‘å‡ºçš„ä»»ä½•æ¶ˆæ¯éƒ½æ˜¯æŒä¹…åŒ–çš„ï¼Œä¸ç”¨ç‰¹æ„æŒ‡å®šã€‚</p><p>4ã€<strong>å¤±è´¥é‡è¯•æœºåˆ¶</strong></p><p><strong>æ­¥éª¤ï¼š</strong></p><p>æœ¬åœ°é‡è¯•æœºåˆ¶ -ã€‹ æ­»ä¿¡é˜Ÿåˆ—</p><p>4-1ã€<strong>æœ¬åœ°é‡è¯•</strong></p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Springçš„retryæœºåˆ¶ï¼Œåœ¨æ¶ˆè´¹è€…å‡ºç°å¼‚å¸¸æ—¶åˆ©ç”¨æœ¬åœ°é‡è¯•ï¼Œè€Œä¸æ˜¯æ— é™åˆ¶çš„requeueåˆ°mqé˜Ÿåˆ—ã€‚</p><p>ä¿®æ”¹consumeræœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹ï¼š</p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>    <span class="token key atrule">listener</span><span class="token punctuation">:</span>      <span class="token key atrule">simple</span><span class="token punctuation">:</span>        <span class="token key atrule">retry</span><span class="token punctuation">:</span>          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># å¼€å¯æ¶ˆè´¹è€…å¤±è´¥é‡è¯•</span>          <span class="token key atrule">initial-interval</span><span class="token punctuation">:</span> 1000ms <span class="token comment"># åˆå§‹çš„å¤±è´¥ç­‰å¾…æ—¶é•¿ä¸º1ç§’</span>          <span class="token key atrule">multiplier</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># å¤±è´¥çš„ç­‰å¾…æ—¶é•¿å€æ•°ï¼Œä¸‹æ¬¡ç­‰å¾…æ—¶é•¿ = multiplier * last-interval</span>          <span class="token key atrule">max-attempts</span><span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment"># æœ€å¤§é‡è¯•æ¬¡æ•°</span>          <span class="token key atrule">stateless</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># trueæ— çŠ¶æ€ï¼›falseæœ‰çŠ¶æ€ã€‚å¦‚æœä¸šåŠ¡ä¸­åŒ…å«äº‹åŠ¡ï¼Œè¿™é‡Œæ”¹ä¸ºfalse</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“è®ºï¼š</p><ul><li>å¼€å¯æœ¬åœ°é‡è¯•æ—¶ï¼Œæ¶ˆæ¯å¤„ç†è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ä¼šrequeueåˆ°é˜Ÿåˆ—ï¼Œè€Œæ˜¯åœ¨æ¶ˆè´¹è€…æœ¬åœ°é‡è¯•</li><li><strong>é‡è¯•è¾¾åˆ°æœ€å¤§æ¬¡æ•°åï¼ŒSpringä¼šè¿”å›ackï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒ</strong></li></ul><p>4-2ã€<strong>å¤±è´¥ç­–ç•¥</strong></p><p>åœ¨ä¹‹å‰çš„æµ‹è¯•ä¸­ï¼Œè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™æ˜¯ç”±Springå†…éƒ¨æœºåˆ¶å†³å®šçš„ã€‚</p><p>åœ¨å¼€å¯é‡è¯•æ¨¡å¼åï¼Œé‡è¯•æ¬¡æ•°è€—å°½ï¼Œå¦‚æœæ¶ˆæ¯ä¾ç„¶å¤±è´¥ï¼Œåˆ™éœ€è¦æœ‰MessageRecoveryæ¥å£æ¥å¤„ç†ï¼Œå®ƒåŒ…å«ä¸‰ç§ä¸åŒçš„å®ç°ï¼š</p><ul><li>RejectAndDontRequeueRecovererï¼šé‡è¯•è€—å°½åï¼Œç›´æ¥rejectï¼Œä¸¢å¼ƒæ¶ˆæ¯ã€‚é»˜è®¤å°±æ˜¯è¿™ç§æ–¹å¼</li><li>ImmediateRequeueMessageRecovererï¼šé‡è¯•è€—å°½åï¼Œè¿”å›nackï¼Œæ¶ˆæ¯é‡æ–°å…¥é˜Ÿ</li><li><strong>RepublishMessageRecovererï¼šé‡è¯•è€—å°½åï¼Œå°†å¤±è´¥æ¶ˆæ¯æŠ•é€’åˆ°æŒ‡å®šçš„äº¤æ¢æœºï¼ˆæ­»ä¿¡ï¼Œæƒ°æ€§ï¼Œå¼‚å¸¸äº¤æ¢æœºï¼‰</strong></li></ul><p>æ¯”è¾ƒä¼˜é›…çš„ä¸€ç§å¤„ç†æ–¹æ¡ˆæ˜¯RepublishMessageRecovererï¼Œå¤±è´¥åå°†æ¶ˆæ¯æŠ•é€’åˆ°ä¸€ä¸ªæŒ‡å®šçš„ï¼Œä¸“é—¨å­˜æ”¾å¼‚å¸¸æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œåç»­ç”±äººå·¥é›†ä¸­å¤„ç†ã€‚</p><p>1ï¼‰åœ¨consumeræœåŠ¡ä¸­å®šä¹‰å¤„ç†å¤±è´¥æ¶ˆæ¯çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">errorMessageExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">"error.direct"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">errorQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">"error.queue"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">errorBinding</span><span class="token punctuation">(</span><span class="token class-name">Queue</span> errorQueue<span class="token punctuation">,</span> <span class="token class-name">DirectExchange</span> errorMessageExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>errorQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>errorMessageExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ï¼‰å®šä¹‰ä¸€ä¸ªRepublishMessageRecovererï¼Œå…³è”é˜Ÿåˆ—å’Œäº¤æ¢æœº</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">MessageRecoverer</span> <span class="token function">republishMessageRecoverer</span><span class="token punctuation">(</span><span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RepublishMessageRecoverer</span><span class="token punctuation">(</span>rabbitTemplate<span class="token punctuation">,</span> <span class="token string">"error.direct"</span><span class="token punctuation">,</span> <span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>4-3ã€<strong>æ­»ä¿¡é˜Ÿåˆ—</strong></p><p>ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä¼šæˆä¸ºæ­»ä¿¡ï¼Ÿ</p><blockquote><p>æ¶ˆæ¯è¢«æ¶ˆè´¹è€…rejectæˆ–è€…è¿”å›nack ï¼Œæ‹’ç»</p><p>æ¶ˆæ¯è¶…æ—¶æœªæ¶ˆè´¹ï¼ˆTTLï¼‰</p><p>æ™®é€šé˜Ÿåˆ—æ»¡äº†ï¼ˆå¯æŒ‡å®šåˆ°æ­»ä¿¡ï¼Œä¸æ˜¯ä¸€å®šæ­»ä¿¡ä¹Ÿå¯ä»¥æ˜¯æƒ°æ€§ï¼‰</p></blockquote><p>å¦‚æœè¿™ä¸ªåŒ…å«æ­»ä¿¡çš„é˜Ÿåˆ—é…ç½®äº†<code>dead-letter-exchange</code>å±æ€§ï¼ŒæŒ‡å®šäº†ä¸€ä¸ªäº¤æ¢æœºï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¸­çš„æ­»ä¿¡å°±ä¼šæŠ•é€’åˆ°è¿™ä¸ªäº¤æ¢æœºä¸­ï¼Œè€Œè¿™ä¸ªäº¤æ¢æœºç§°ä¸º<strong>æ­»ä¿¡äº¤æ¢æœº</strong>ï¼ˆDead Letter Exchangeï¼Œæ£€æŸ¥DLXï¼‰</p><p>é˜Ÿåˆ—å°†æ­»ä¿¡æŠ•é€’ç»™æ­»ä¿¡äº¤æ¢æœºæ—¶ï¼Œå¿…é¡»çŸ¥é“ä¸¤ä¸ªä¿¡æ¯ï¼š</p><ul><li>æ­»ä¿¡äº¤æ¢æœºåç§°</li><li>æ­»ä¿¡äº¤æ¢æœºä¸æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šçš„RoutingKey</li></ul><p>è¿™æ ·æ‰èƒ½ç¡®ä¿æŠ•é€’çš„æ¶ˆæ¯èƒ½åˆ°è¾¾æ­»ä¿¡äº¤æ¢æœºï¼Œå¹¶ä¸”æ­£ç¡®çš„è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚</p><p>4-4ã€<strong>æ­»ä¿¡ä½œä¸ºé‡è¯•æœºåˆ¶ç­–ç•¥</strong></p><p>åœ¨å¤±è´¥é‡è¯•ç­–ç•¥ä¸­ï¼Œé»˜è®¤çš„RejectAndDontRequeueRecovererä¼šåœ¨æœ¬åœ°é‡è¯•æ¬¡æ•°è€—å°½åï¼Œå‘é€rejectç»™RabbitMQï¼Œæ¶ˆæ¯å˜æˆæ­»ä¿¡ï¼Œè¢«ä¸¢å¼ƒã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç»™simple.queueæ·»åŠ ä¸€ä¸ªæ­»ä¿¡äº¤æ¢æœºï¼Œç»™æ­»ä¿¡äº¤æ¢æœºç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ã€‚è¿™æ ·æ¶ˆæ¯å˜æˆæ­»ä¿¡åä¹Ÿä¸ä¼šä¸¢å¼ƒï¼Œè€Œæ˜¯æœ€ç»ˆæŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœºï¼Œè·¯ç”±åˆ°ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å£°æ˜æ™®é€šçš„ simple.queueé˜Ÿåˆ—ï¼Œå¹¶ä¸”ä¸ºå…¶æŒ‡å®šæ­»ä¿¡äº¤æ¢æœºï¼šdl.direct</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">simpleQueue2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token string">"simple.queue"</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šé˜Ÿåˆ—åç§°ï¼Œå¹¶æŒä¹…åŒ–</span>        <span class="token punctuation">.</span><span class="token function">deadLetterExchange</span><span class="token punctuation">(</span><span class="token string">"dl.direct"</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// å£°æ˜æ­»ä¿¡äº¤æ¢æœº dl.direct</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">dlExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">"dl.direct"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// å£°æ˜å­˜å‚¨æ­»ä¿¡çš„é˜Ÿåˆ— dl.queue</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">dlQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">"dl.queue"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// å°†æ­»ä¿¡é˜Ÿåˆ— ä¸ æ­»ä¿¡äº¤æ¢æœºç»‘å®š</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">dlBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token function">dlQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token function">dlExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">"simple"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¶ˆè´¹è€…ç¡®è®¤æ¨¡å¼: auto<br>    acknowledge-mode: auto<br>    ç‰¹å¾: å½“æ¶ˆæ¯ä¸èƒ½è¢«æ¶ˆè´¹æ—¶,ä¼šé‡æ–°å…¥é˜Ÿ,å†æ¬¡æŠ•é€’ç»™æ¶ˆè´¹è€…è¿›è¡Œè¢«æ¶ˆè´¹<br>    default-requeue-rejected: false # æ‹’ç»æ¶ˆæ¯é‡æ–°å…¥é˜Ÿ,å¦‚æœé˜Ÿåˆ—ç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœºåˆ™æ¶ˆæ¯ä¼šæŠ•é€’åˆ°æ­»ä¿¡äº¤æ¢æœºå¹¶è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—</p><p>æœ¬åœ°é‡è¯•ï¼šåº•ä¸‹æ˜¯ä¸‰ç§æ–¹æ¡ˆï¼Œä¸æ˜¯ä¸‰ä¸ªæ­¥éª¤ï¼Œéœ€è¦æ³¨æ„</p><p>â€‹    å½“æœ¬åœ°é‡è¯•æ¬¡æ•°è€—å°½æ—¶,å¦‚æœå½“å‰é˜Ÿåˆ—æ²¡æœ‰ç»‘å®šæ­»ä¿¡äº¤æ¢æœºæˆ–é”™è¯¯é˜Ÿåˆ—,åˆ™æ¶ˆæ¯ä¸¢å¼ƒ<br>â€‹    å¦‚æœæä¾›äº†å¼‚å¸¸é˜Ÿåˆ—,åˆ™æ¶ˆæ¯æŠ•é€’åˆ°å¼‚å¸¸å¯¹è±¡<br>â€‹    å¦‚æœé˜Ÿåˆ—ç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœº,åˆ™æ¶ˆæ¯ä»¥æ­»ä¿¡çš„å½¢å¼å­˜æ”¾åˆ°æ­»ä¿¡é˜Ÿåˆ—</p><p>5ã€<strong>æƒ°æ€§é˜Ÿåˆ—</strong></p><p>5-1ã€<strong>å †ç§¯é—®é¢˜</strong></p><p>å½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦è¶…è¿‡äº†æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå°±ä¼šå¯¼è‡´é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å †ç§¯ï¼Œç›´åˆ°é˜Ÿåˆ—å­˜å‚¨æ¶ˆæ¯è¾¾åˆ°ä¸Šé™ã€‚ä¹‹åå‘é€çš„æ¶ˆæ¯å°±ä¼šæˆä¸ºæ­»ä¿¡ï¼Œå¯èƒ½ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™å°±æ˜¯æ¶ˆæ¯å †ç§¯é—®é¢˜ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303052229466.png"></p><p><strong>è§£å†³æ¶ˆæ¯å †ç§¯æ€è·¯ï¼š</strong></p><ul><li>å¢åŠ æ›´å¤šæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è¯´çš„work queueæ¨¡å¼</li><li>åœ¨æ¶ˆè´¹è€…å†…å¼€å¯çº¿ç¨‹æ± åŠ å¿«æ¶ˆæ¯å¤„ç†é€Ÿåº¦</li><li>æ‰©å¤§é˜Ÿåˆ—å®¹ç§¯ï¼Œæé«˜å †ç§¯ä¸Šé™</li></ul><p>5-2ã€<strong>æƒ°æ€§é˜Ÿåˆ—</strong></p><p>ä»RabbitMQçš„3.6.0ç‰ˆæœ¬å¼€å§‹ï¼Œå°±å¢åŠ äº†Lazy Queuesçš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯æƒ°æ€§é˜Ÿåˆ—ã€‚æƒ°æ€§é˜Ÿåˆ—çš„ç‰¹å¾å¦‚ä¸‹ï¼š</p><ul><li>æ¥æ”¶åˆ°æ¶ˆæ¯åç›´æ¥å­˜å…¥ç£ç›˜è€Œéå†…å­˜</li><li>æ¶ˆè´¹è€…è¦æ¶ˆè´¹æ¶ˆæ¯æ—¶æ‰ä¼šä»ç£ç›˜ä¸­è¯»å–å¹¶åŠ è½½åˆ°å†…å­˜</li><li>æ”¯æŒæ•°ç™¾ä¸‡æ¡çš„æ¶ˆæ¯å­˜å‚¨</li></ul><p>5-2-1ã€<strong>åŸºäºå‘½ä»¤è¡Œè®¾ç½®lazy-queue</strong></p><p>è€Œè¦è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—ä¸ºæƒ°æ€§é˜Ÿåˆ—ï¼Œåªéœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—æ—¶ï¼ŒæŒ‡å®šx-queue-modeå±æ€§ä¸ºlazyå³å¯ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå°†ä¸€ä¸ªè¿è¡Œä¸­çš„é˜Ÿåˆ—ä¿®æ”¹ä¸ºæƒ°æ€§é˜Ÿåˆ—ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rabbitmqctl set_policy Lazy <span class="token string">"^simple.queue$"</span> <span class="token string">'{"queue-mode":"lazy"}'</span> --apply-to queues  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‘½ä»¤è§£è¯»ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rabbitmqctl ï¼šRabbitMQçš„å‘½ä»¤è¡Œå·¥å…·set_policy ï¼šæ·»åŠ ä¸€ä¸ªç­–ç•¥Lazy ï¼šç­–ç•¥åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰<span class="token string">"^lazy-queue$"</span> ï¼šç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é˜Ÿåˆ—çš„åå­—<span class="token string">'{"queue-mode":"lazy"}'</span> ï¼šè®¾ç½®é˜Ÿåˆ—æ¨¡å¼ä¸ºlazyæ¨¡å¼--apply-to queuesï¼šç­–ç•¥çš„ä½œç”¨å¯¹è±¡ï¼Œæ˜¯æ‰€æœ‰çš„é˜Ÿåˆ—<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5-2-2ã€åŸºäº@Beanå£°æ˜lazy-queue</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303052228644.png"></p><p>5-2-3ã€åŸºäº@RabbitListenerå£°æ˜LazyQueue</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303052230941.png"></p><p><strong>å°ç»“ï¼š</strong></p><p>æ¶ˆæ¯å †ç§¯é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Ÿ</p><ul><li>é˜Ÿåˆ—ä¸Šç»‘å®šå¤šä¸ªæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦</li><li>ä½¿ç”¨æƒ°æ€§é˜Ÿåˆ—ï¼Œå¯ä»¥å†mqä¸­ä¿å­˜æ›´å¤šæ¶ˆæ¯</li></ul><p>æƒ°æ€§é˜Ÿåˆ—çš„ä¼˜ç‚¹æœ‰å“ªäº›ï¼Ÿ</p><ul><li>åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯ä¸Šé™é«˜</li><li>æ²¡æœ‰é—´æ­‡æ€§çš„page-outï¼Œæ€§èƒ½æ¯”è¾ƒç¨³å®š</li></ul><p>æƒ°æ€§é˜Ÿåˆ—çš„ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿ</p><ul><li>åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯æ—¶æ•ˆæ€§ä¼šé™ä½</li><li>æ€§èƒ½å—é™äºç£ç›˜çš„IO</li></ul><h2 id="å››ã€Redis"><a href="#å››ã€Redis" class="headerlink" title="å››ã€Redis"></a>å››ã€Redis</h2><p>ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€åå¤§æ•°æ®ç»“æ„</p><h3 id="1ã€å¸¸è§„ï¼ˆæ”¾æ¾ç‰ˆï¼‰"><a href="#1ã€å¸¸è§„ï¼ˆæ”¾æ¾ç‰ˆï¼‰" class="headerlink" title="1ã€å¸¸è§„ï¼ˆæ”¾æ¾ç‰ˆï¼‰"></a>1ã€å¸¸è§„ï¼ˆæ”¾æ¾ç‰ˆï¼‰</h3><h4 id="1ã€redisæœ‰å“ªäº›æ•°æ®ç»“æ„"><a href="#1ã€redisæœ‰å“ªäº›æ•°æ®ç»“æ„" class="headerlink" title="1ã€redisæœ‰å“ªäº›æ•°æ®ç»“æ„?"></a>1ã€redisæœ‰å“ªäº›æ•°æ®ç»“æ„?</h4><p>å­—ç¬¦ä¸²Stringã€å­—å…¸Hashã€åˆ—è¡¨Listã€é›†åˆSetã€æœ‰åºé›†åˆSortedSet</p><p>HyperLogLog ï¼šç½‘ç«™çš„UVç»Ÿè®¡</p><p>Geoï¼šè·å–ä½ç½®çš„è·ç¦»</p><p>Bitmap:ä½å›¾</p><p>Streamï¼šæ¶ˆæ¯é˜Ÿåˆ—</p><h4 id="2ã€ä¸ºä»€ä¹ˆè¦ç”¨redis"><a href="#2ã€ä¸ºä»€ä¹ˆè¦ç”¨redis" class="headerlink" title="2ã€ä¸ºä»€ä¹ˆè¦ç”¨redis?"></a>2ã€ä¸ºä»€ä¹ˆè¦ç”¨redis?</h4><p>å¯ä»¥åšç¼“å­˜ï¼Œè€—æ—¶é—´çš„sqlï¼Œä¸”ä¸é¢‘ç¹å˜åŠ¨çš„å¯ä»¥ç¼“å­˜åˆ°redisï¼Œæé«˜å“åº”é€Ÿåº¦</p><p>æé«˜å¹¶å‘ï¼Œå¤§é‡çš„è¯·æ±‚å…ˆè¯·æ±‚åˆ°redisï¼Œè€Œä¸æ˜¯ç›´æ¥è¯·æ±‚åˆ°æ•°æ®åº“</p><p>å¯ä»¥åšåˆ†å¸ƒå¼é”ã€‚</p><h4 id="3ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”ï¼Ÿ"><a href="#3ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”ï¼Ÿ" class="headerlink" title="3ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”ï¼Ÿ"></a>3ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”ï¼Ÿ</h4><p>setnxæ¥è·å–é”ï¼Œexpireæ¥æ·»åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢èµ„æºå ç”¨è¿‡ä¹…</p><h4 id="4ã€æ‰¾å‡ºredisä¸­ä»¥æŸä¸ªå‰ç¼€å¼€å¤´çš„å¤§é‡çš„keyï¼Ÿ"><a href="#4ã€æ‰¾å‡ºredisä¸­ä»¥æŸä¸ªå‰ç¼€å¼€å¤´çš„å¤§é‡çš„keyï¼Ÿ" class="headerlink" title="4ã€æ‰¾å‡ºredisä¸­ä»¥æŸä¸ªå‰ç¼€å¼€å¤´çš„å¤§é‡çš„keyï¼Ÿ"></a>4ã€æ‰¾å‡ºredisä¸­ä»¥æŸä¸ªå‰ç¼€å¼€å¤´çš„å¤§é‡çš„keyï¼Ÿ</h4><p>keys xx* ä½¿ç”¨keysä¼šé€ æˆé˜»å¡</p><p>scan 0 match key1111* count 20 ä¸ä¼šé€ æˆé˜»å¡</p><h4 id="5ã€å¦‚ä½•ä½¿ç”¨redisåšæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"><a href="#5ã€å¦‚ä½•ä½¿ç”¨redisåšæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="5ã€å¦‚ä½•ä½¿ç”¨redisåšæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"></a>5ã€å¦‚ä½•ä½¿ç”¨redisåšæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</h4><p>listç»“æ„ä½œä¸ºé˜Ÿåˆ—ï¼Œrpushç”Ÿäº§æ¶ˆæ¯ï¼Œlpopæ¶ˆè´¹æ¶ˆæ¯ï¼Œéœ€è¦è‡ªå·±å®ç°é˜»å¡ã€‚blpopæ²¡æœ‰æ¶ˆæ¯ä¼šé˜»å¡ï¼Œç­‰åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚</p><h4 id="6ã€å¤§é‡çš„keyåœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"><a href="#6ã€å¤§é‡çš„keyåœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" class="headerlink" title="6ã€å¤§é‡çš„keyåœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"></a>6ã€å¤§é‡çš„keyåœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œéœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h4><p>rediså¯èƒ½ä¼šå‡ºç°å¡é¡¿ç°è±¡ï¼Œå¹¶å‘é‡å¤§å¯èƒ½å‡ºç°ç¼“å­˜é›ªå´©ï¼Œå¯ä»¥åœ¨è¿‡æœŸæ—¶é—´æ·»åŠ ä¸€ä¸ªéšæœºæ•°</p><h4 id="7ã€ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Œç¼“å­˜å‡»ç©¿ï¼Ÿ"><a href="#7ã€ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Œç¼“å­˜å‡»ç©¿ï¼Ÿ" class="headerlink" title="7ã€ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Œç¼“å­˜å‡»ç©¿ï¼Ÿ"></a>7ã€ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Œç¼“å­˜å‡»ç©¿ï¼Ÿ</h4><p>ç¼“å­˜ç©¿é€ï¼šå¯¹ç©ºå€¼ç¼“å­˜ï¼Œè®¾ç½®å¯è®¿é—®çš„åå•ï¼ˆç™½åå•ï¼‰ï¼Œé‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨</p><p>ç¼“å­˜å‡»ç©¿: ä¸€ä¸ªkeyè¿‡æœŸæ—¶ï¼Œå¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ã€‚åŠ äº’æ–¥é”å’Œçƒ­ç‚¹æ•°æ®ä¸è¿‡æœŸã€‚</p><h4 id="8ã€redisçš„çº¿ç¨‹æ¨¡å‹ï¼Ÿ"><a href="#8ã€redisçš„çº¿ç¨‹æ¨¡å‹ï¼Ÿ" class="headerlink" title="8ã€redisçš„çº¿ç¨‹æ¨¡å‹ï¼Ÿ"></a>8ã€redisçš„çº¿ç¨‹æ¨¡å‹ï¼Ÿ</h4><p>redisä½¿ç”¨æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„ï¼Œé‡‡ç”¨ioå¤šè·¯å¤ç”¨ç¨‹åºç›‘å¬å¤šä¸ªsocketï¼Œ</p><p>å°†äº§ç”Ÿäº‹ä»¶çš„socketå‹å…¥å†…å­˜é˜Ÿåˆ—ï¼Œäº‹ä»¶åˆ†æ´¾å™¨æ ¹æ®äº‹ä»¶ç±»å‹é€‰æ‹©å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚</p><h4 id="9ã€redis-ä¸ºä»€ä¹ˆä½¿ç”¨å•è¿›ç¨‹ã€å•çº¿ç¨‹ä¹Ÿå¾ˆå¿«"><a href="#9ã€redis-ä¸ºä»€ä¹ˆä½¿ç”¨å•è¿›ç¨‹ã€å•çº¿ç¨‹ä¹Ÿå¾ˆå¿«" class="headerlink" title="9ã€redis ä¸ºä»€ä¹ˆä½¿ç”¨å•è¿›ç¨‹ã€å•çº¿ç¨‹ä¹Ÿå¾ˆå¿«?"></a>9ã€redis ä¸ºä»€ä¹ˆä½¿ç”¨å•è¿›ç¨‹ã€å•çº¿ç¨‹ä¹Ÿå¾ˆå¿«?</h4><p>1.åŸºäºå†…å­˜çš„æ“ä½œ</p><p>2.ä½¿ç”¨äº† I/O å¤šè·¯å¤ç”¨æ¨¡å‹</p><p>3.å•çº¿ç¨‹å¯ä»¥é¿å…ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶</p><h4 id="10ã€redisè¿‡æœŸç­–ç•¥"><a href="#10ã€redisè¿‡æœŸç­–ç•¥" class="headerlink" title="10ã€redisè¿‡æœŸç­–ç•¥?"></a>10ã€redisè¿‡æœŸç­–ç•¥?</h4><p>å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤ã€‚</p><p>å®šæœŸåˆ é™¤ï¼šæ¯éš”ä¸€æ®µæ—¶é—´åˆ é™¤</p><p>æƒ°æ€§åˆ é™¤ï¼šè·å–çš„æ—¶å€™åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</p><h4 id="11ã€redisçš„å†…å­˜æ·˜æ±°æœºåˆ¶ï¼Ÿ"><a href="#11ã€redisçš„å†…å­˜æ·˜æ±°æœºåˆ¶ï¼Ÿ" class="headerlink" title="11ã€redisçš„å†…å­˜æ·˜æ±°æœºåˆ¶ï¼Ÿ"></a>11ã€redisçš„å†…å­˜æ·˜æ±°æœºåˆ¶ï¼Ÿ</h4><ul><li>noeviction: å½“å†…å­˜ä¸è¶³æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™</li><li>allkeys-lruï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ keyï¼ˆè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼‰ã€‚</li><li>allkeys-randomï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œéšæœºç§»é™¤æŸä¸ª keyã€‚</li><li>volatile-lruï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ keyã€‚</li><li>volatile-randomï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ª keyã€‚</li><li>volatile-ttlï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­ï¼Œæœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„ key ä¼˜å…ˆç§»é™¤</li></ul><h4 id="12ã€redis-çš„æŒä¹…åŒ–æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"><a href="#12ã€redis-çš„æŒä¹…åŒ–æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="12ã€redis çš„æŒä¹…åŒ–æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ"></a>12ã€<strong>redis çš„æŒä¹…åŒ–æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</strong></h4><p>Rdbï¼šrdbä¼šå‘¨æœŸæ€§å¯¹redisçš„æ•°æ®è¿›è¡ŒæŒä¹…åŒ–</p><p>Aofï¼šå°†æ¯æ¡å†™å…¥å‘½ä»¤å†™å…¥æ—¥å¿—ä¸­ï¼Œåœ¨redisé‡å¯çš„æ—¶å€™é€šè¿‡æ—¥å¿—æ–‡ä»¶é‡æ„æ•°æ®</p><p>Rdbä¼šäº§ç”Ÿå¤šä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶ä»£è¡¨æŸä¸€ä¸ªæ—¶åˆ»çš„redisæ•°æ®ã€‚å¯¹äºaofæ¥è¯´ï¼ŒåŸºäºrdbæ¢å¤æ•°æ®ä¼šæ›´å¿«ã€‚</p><p>redis æ•…éšœRdbä¼šä¸¢å¤±æ›´å¤šçš„æ•°æ®ï¼ŒRdbå¿«ç…§éƒ½æ˜¯éš”5åˆ†é’Ÿæˆ–è€…æ›´é•¿æ—¶é—´ç”Ÿæˆï¼Œè€Œaofæ¯éš”ä¸€ç§’å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥åªä¼šä¸¢å¤±ä¸€ç§’é’Ÿçš„æ•°æ®ã€‚</p><h4 id="13ã€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´ï¼Ÿ"><a href="#13ã€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´ï¼Ÿ" class="headerlink" title="13ã€å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´ï¼Ÿ"></a>13ã€<strong>å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´ï¼Ÿ</strong></h4><p>è¯»çš„æ—¶å€™å…ˆè¯»ç¼“å­˜ï¼Œæ²¡æœ‰çš„è¯è¯»æ•°æ®åº“ï¼Œæ”¾å…¥ç¼“å­˜ï¼Œè¿”å›ç»“æœã€‚æ›´æ–°çš„æ—¶å€™å…ˆæ›´æ–°æ•°æ®åº“ï¼Œç„¶ååˆ é™¤ç¼“å­˜ã€‚</p><p>ä¸ºä»€ä¹ˆæ˜¯åˆ é™¤è€Œä¸æ˜¯æ›´æ–°?</p><p>å› ä¸ºæ›´æ–°å¯èƒ½æ˜¯æ›´æ–°ä¸€ä¸ªæˆ–å‡ ä¸ªå­—æ®µï¼Œç¼“å­˜å¯èƒ½ç¼“å­˜çš„æ˜¯ä¸€ä¸ªç»“æœé›†ã€‚</p><p>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œåœ¨åˆ é™¤ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜åˆ é™¤å¤±è´¥ï¼Ÿ</p><p>è§£å†³æ–¹æ¡ˆ:å…ˆåˆ é™¤ç¼“å­˜ï¼Œåœ¨åˆ é™¤æ•°æ®åº“ï¼Œåˆ é™¤æ•°æ®åº“å¤±è´¥é‚£æ•°æ®è¿˜æ˜¯æ²¡å˜ã€‚</p><h4 id="14ã€redis-çš„å¹¶å‘ç«äº‰é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿäº†è§£redis-äº‹åŠ¡çš„-CAS-æ–¹æ¡ˆå—ï¼Ÿ"><a href="#14ã€redis-çš„å¹¶å‘ç«äº‰é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿäº†è§£redis-äº‹åŠ¡çš„-CAS-æ–¹æ¡ˆå—ï¼Ÿ" class="headerlink" title="14ã€redis çš„å¹¶å‘ç«äº‰é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿäº†è§£redis äº‹åŠ¡çš„ CAS æ–¹æ¡ˆå—ï¼Ÿ"></a>14ã€r<strong>edis çš„å¹¶å‘ç«äº‰é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿäº†è§£redis äº‹åŠ¡çš„ CAS æ–¹æ¡ˆå—ï¼Ÿ</strong></h4><p><strong>å¤šä¸ªå®¢æˆ·ç«¯åŒäº‹å†™ä¸€ä¸ªkeyï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´</strong></p><p><strong>rediså¤©ç„¶æ”¯æŒä¹è§‚é”</strong></p><p>watch ç›‘æ§keyï¼Œmultiå¼€å§‹äº‹åŠ¡,åœ¨æ‰§è¡Œexecå‘½ä»¤å‰å€¼è¢«ä¿®æ”¹åˆ™ä¼šå›æ»šã€‚</p><h4 id="15ã€Redis-çš„-LRU-ç®—æ³•æ€ä¹ˆå®ç°çš„"><a href="#15ã€Redis-çš„-LRU-ç®—æ³•æ€ä¹ˆå®ç°çš„" class="headerlink" title="15ã€Redis çš„ LRU ç®—æ³•æ€ä¹ˆå®ç°çš„?"></a>15ã€Redis çš„ LRU ç®—æ³•æ€ä¹ˆå®ç°çš„?</h4><p>æ‹¿åˆ°nä¸ªkeyï¼Œå’Œç¼“å†²æ± ä¸­çš„keyæ¯”è¾ƒæœ€å¤§ç©ºé—²æ—¶é—´ï¼Œæ¯”ç¼“å­˜æ± çš„keyæœ€å¤§ç©ºé—²æ—¶é—´è¿˜å¤§ï¼Œåˆ™æ›¿æ¢ç¼“å­˜æ± çš„keyï¼Œç„¶åä»ç¼“å­˜æ± ä¸­ç§»é™¤æœ€å¤§ç©ºé—²æ—¶é—´çš„keyã€‚</p><h4 id="16ã€Redis-æ€ä¹ˆä¿è¯é«˜å¯ç”¨ã€æœ‰å“ªäº›é›†ç¾¤æ¨¡å¼ï¼Ÿ"><a href="#16ã€Redis-æ€ä¹ˆä¿è¯é«˜å¯ç”¨ã€æœ‰å“ªäº›é›†ç¾¤æ¨¡å¼ï¼Ÿ" class="headerlink" title="16ã€Redis æ€ä¹ˆä¿è¯é«˜å¯ç”¨ã€æœ‰å“ªäº›é›†ç¾¤æ¨¡å¼ï¼Ÿ"></a>16ã€Redis æ€ä¹ˆä¿è¯é«˜å¯ç”¨ã€æœ‰å“ªäº›é›†ç¾¤æ¨¡å¼ï¼Ÿ</h4><p>ä¸»ä»ï¼Œå“¨å…µï¼Œé›†ç¾¤</p><p><strong>1.ä¸»ä»å¤åˆ¶</strong></p><p>1.å¼€å¯é…ç½®</p><ul><li>åœ¨ slave ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼šslaveof <master ip=""> <master port=""></master></master></li><li>åœ¨ slave é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ï¼šslaveof <master ip=""> <master port=""></master></master></li><li>ä½¿ç”¨å¯åŠ¨å‘½ä»¤ï¼šâ€“slaveof <master ip=""> <master port=""></master></master></li></ul><p>2.å»ºç«‹å¥—æ¥å­—(<strong>socket</strong>)è¿æ¥ 3.<strong>å‘é€PINGå‘½ä»¤</strong> 4.èº«ä»½éªŒè¯ 5.å‘é€CAPA(åŒæ­¥å¤åˆ¶çš„èƒ½åŠ›)</p><p>6.æ•°æ®åŒæ­¥ 7.å‘½ä»¤ä¼ æ’­</p><p>å‡ºç°æ•…éšœéœ€è¦æ‰‹åŠ¨æ›´æ”¹é…ç½®</p><p><strong>2.å“¨å…µ</strong></p><p>å“¨å…µï¼ˆSentinelï¼‰ æ˜¯ Redis çš„é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆï¼Œç”±å¤šä¸ªå“¨å…µç›‘æ§ä¸»æœåŠ¡å™¨ã€‚ç›‘æ§çš„ä¸»æœåŠ¡å™¨æ•…éšœçš„æ—¶å€™ï¼Œå¯ä»¥å°†ä»æœåŠ¡å™¨å‡çº§ä¸ºä¸»æœåŠ¡å™¨</p><p><strong>3.é›†ç¾¤</strong></p><p><strong>å“¨å…µæ¨¡å¼çš„ç¼ºç‚¹å°±æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½æ”¾åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œæ— æ³•æ¯”è¾ƒå¥½çš„è¿›è¡Œæ°´å¹³æ‰©å±•ã€‚</strong></p><p><strong>é›†ç¾¤æ¨¡å¼ï¼š</strong></p><p><strong>å»ä¸­å¿ƒåŒ–ï¼Œ</strong>å°†æ•°æ®æŒ‰æ§½å­˜å‚¨åˆ†å¸ƒåœ¨å¤šä¸ª Redis èŠ‚ç‚¹ä¸Šã€‚é›†ç¾¤å…±æœ‰ 16384 ä¸ªæ§½ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å¤„ç†éƒ¨åˆ†æ§½ã€‚</p><p>æ‰€æœ‰çš„ Redis èŠ‚ç‚¹å½¼æ­¤äº’è”ï¼Œé€šè¿‡ PING-PONG æœºåˆ¶æ¥è¿›è¡ŒèŠ‚ç‚¹é—´çš„å¿ƒè·³æ£€æµ‹ã€‚</p><p>ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œä»èŠ‚ç‚¹å‘æ‰€æœ‰æœ‰æŠ•ç¥¨çš„ä¸»èŠ‚ç‚¹å‘èµ·é€‰ä¸¾ï¼Œè·å¾—ç¥¨æ•°&gt;2n+1åˆ™å‡çº§ä¸ºä¸»èŠ‚ç‚¹.</p><h3 id="2ã€äºŒé˜¶ï¼ˆæ•£è£…ï¼‰"><a href="#2ã€äºŒé˜¶ï¼ˆæ•£è£…ï¼‰" class="headerlink" title="2ã€äºŒé˜¶ï¼ˆæ•£è£…ï¼‰"></a>2ã€äºŒé˜¶ï¼ˆæ•£è£…ï¼‰</h3><h4 id="â€”â€”â€”æ¦‚è¿°â€”â€”â€”"><a href="#â€”â€”â€”æ¦‚è¿°â€”â€”â€”" class="headerlink" title="â€”â€”â€”æ¦‚è¿°â€”â€”â€”-"></a>â€”â€”â€”æ¦‚è¿°â€”â€”â€”-</h4><h4 id="1ã€Redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹"><a href="#1ã€Redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹" class="headerlink" title="1ã€Redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹"></a>1ã€Redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹</h4><p>ä¼˜ç‚¹</p><ul><li>è¯»å†™æ€§èƒ½ä¼˜å¼‚ï¼Œ Redisèƒ½è¯»çš„é€Ÿåº¦æ˜¯110000æ¬¡/sï¼Œå†™çš„é€Ÿåº¦æ˜¯81000æ¬¡/sã€‚</li><li>æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œæ”¯æŒAOFå’ŒRDBä¸¤ç§æŒä¹…åŒ–æ–¹å¼ã€‚</li><li>æ”¯æŒäº‹åŠ¡ï¼ŒRedisçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼ŒåŒæ—¶Redisè¿˜æ”¯æŒå¯¹å‡ ä¸ªæ“ä½œåˆå¹¶åçš„åŸå­æ€§æ‰§è¡Œã€‚</li><li>æ•°æ®ç»“æ„ä¸°å¯Œï¼Œé™¤äº†æ”¯æŒstringç±»å‹çš„valueå¤–è¿˜æ”¯æŒhashã€setã€zsetã€listç­‰æ•°æ®ç»“æ„ã€‚</li><li>æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œä¸»æœºä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æœºï¼Œå¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>æ•°æ®åº“å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œä¸èƒ½ç”¨ä½œæµ·é‡æ•°æ®çš„é«˜æ€§èƒ½è¯»å†™ï¼Œå› æ­¤Redisé€‚åˆçš„åœºæ™¯ä¸»è¦å±€é™åœ¨è¾ƒå°æ•°æ®é‡çš„é«˜æ€§èƒ½æ“ä½œå’Œè¿ç®—ä¸Šã€‚</li><li>Redis ä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œä¸»æœºä»æœºçš„å®•æœºéƒ½ä¼šå¯¼è‡´å‰ç«¯éƒ¨åˆ†è¯»å†™è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…æœºå™¨é‡å¯æˆ–è€…æ‰‹åŠ¨åˆ‡æ¢å‰ç«¯çš„IPæ‰èƒ½æ¢å¤ã€‚</li><li>ä¸»æœºå®•æœºï¼Œå®•æœºå‰æœ‰éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»æœºï¼Œåˆ‡æ¢IPåè¿˜ä¼šå¼•å…¥æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</li><li>Redis è¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ä¸ºé¿å…è¿™ä¸€é—®é¢˜ï¼Œè¿ç»´äººå‘˜åœ¨ç³»ç»Ÿä¸Šçº¿æ—¶å¿…é¡»ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œè¿™å¯¹èµ„æºé€ æˆäº†å¾ˆå¤§çš„æµªè´¹ã€‚</li></ul><h4 id="2ã€ä¸ºä»€ä¹ˆè¦ç”¨-Redis-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜"><a href="#2ã€ä¸ºä»€ä¹ˆè¦ç”¨-Redis-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜" class="headerlink" title="2ã€ä¸ºä»€ä¹ˆè¦ç”¨ Redis /ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜"></a>2ã€ä¸ºä»€ä¹ˆè¦ç”¨ Redis /ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜</h4><p>ä¸»è¦ä»â€œé«˜æ€§èƒ½â€å’Œâ€œé«˜å¹¶å‘â€è¿™ä¸¤ç‚¹æ¥çœ‹å¾…è¿™ä¸ªé—®é¢˜ã€‚</p><h5 id="é«˜æ€§èƒ½ï¼š"><a href="#é«˜æ€§èƒ½ï¼š" class="headerlink" title="é«˜æ€§èƒ½ï¼š"></a>é«˜æ€§èƒ½ï¼š</h5><p>å‡å¦‚ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æ•°æ®åº“ä¸­çš„æŸäº›æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šæ¯”è¾ƒæ…¢ï¼Œå› ä¸ºæ˜¯ä»ç¡¬ç›˜ä¸Šè¯»å–çš„ã€‚å°†è¯¥ç”¨æˆ·è®¿é—®çš„æ•°æ®å­˜åœ¨æ•°ç¼“å­˜ä¸­ï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡å†è®¿é—®è¿™äº›æ•°æ®çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–äº†ã€‚æ“ä½œç¼“å­˜å°±æ˜¯ç›´æ¥æ“ä½œå†…å­˜ï¼Œæ‰€ä»¥é€Ÿåº¦ç›¸å½“å¿«ã€‚å¦‚æœæ•°æ®åº“ä¸­çš„å¯¹åº”æ•°æ®æ”¹å˜çš„ä¹‹åï¼ŒåŒæ­¥æ”¹å˜ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å³å¯ï¼</p><h5 id="é«˜å¹¶å‘ï¼š"><a href="#é«˜å¹¶å‘ï¼š" class="headerlink" title="é«˜å¹¶å‘ï¼š"></a>é«˜å¹¶å‘ï¼š</h5><p>ç›´æ¥æ“ä½œç¼“å­˜èƒ½å¤Ÿæ‰¿å—çš„è¯·æ±‚æ˜¯è¿œè¿œå¤§äºç›´æ¥è®¿é—®æ•°æ®åº“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠæ•°æ®åº“ä¸­çš„éƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç¼“å­˜ä¸­å»ï¼Œè¿™æ ·ç”¨æˆ·çš„ä¸€éƒ¨åˆ†è¯·æ±‚ä¼šç›´æ¥åˆ°ç¼“å­˜è¿™é‡Œè€Œä¸ç”¨ç»è¿‡æ•°æ®åº“ã€‚ï¼ˆç”¨æˆ·ä¼šè¯ä¿¡æ¯ï¼Œå­—å…¸æ•°æ®ï¼Œç½‘å…³é»‘ç™½åå•â€¦ï¼‰</p><h4 id="3ã€ä¸ºä»€ä¹ˆè¦ç”¨-Redis-è€Œä¸ç”¨-map-guava-åšç¼“å­˜"><a href="#3ã€ä¸ºä»€ä¹ˆè¦ç”¨-Redis-è€Œä¸ç”¨-map-guava-åšç¼“å­˜" class="headerlink" title="3ã€ä¸ºä»€ä¹ˆè¦ç”¨ Redis è€Œä¸ç”¨ map/guava åšç¼“å­˜?"></a>3ã€ä¸ºä»€ä¹ˆè¦ç”¨ Redis è€Œä¸ç”¨ map/guava åšç¼“å­˜?</h4><p>ç¼“å­˜åˆ†ä¸ºæœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ã€‚ä»¥ Java ä¸ºä¾‹ï¼Œä½¿ç”¨è‡ªå¸¦çš„ map æˆ–è€… guava å®ç°çš„æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œæœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯è½»é‡ä»¥åŠå¿«é€Ÿï¼Œç”Ÿå‘½å‘¨æœŸéšç€ jvm çš„é”€æ¯è€Œç»“æŸï¼Œå¹¶ä¸”åœ¨å¤šå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½éœ€è¦å„è‡ªä¿å­˜ä¸€ä»½ç¼“å­˜ï¼Œç¼“å­˜ä¸å…·æœ‰ä¸€è‡´æ€§ã€‚</p><p>ä½¿ç”¨ redis æˆ– memcached ä¹‹ç±»çš„ç§°ä¸ºåˆ†å¸ƒå¼ç¼“å­˜ï¼Œåœ¨å¤šå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œå„å®ä¾‹å…±ç”¨ä¸€ä»½ç¼“å­˜æ•°æ®ï¼Œç¼“å­˜å…·æœ‰ä¸€è‡´æ€§ã€‚ç¼ºç‚¹æ˜¯éœ€è¦ä¿æŒ redis æˆ– memcachedæœåŠ¡çš„é«˜å¯ç”¨ï¼Œæ•´ä¸ªç¨‹åºæ¶æ„ä¸Šè¾ƒä¸ºå¤æ‚ã€‚</p><h4 id="4ã€Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"><a href="#4ã€Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" class="headerlink" title="4ã€Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"></a>4ã€Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</h4><p>1ã€å®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œéå¸¸å¿«é€Ÿã€‚æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äº HashMapï¼ŒHashMap çš„ä¼˜åŠ¿å°±æ˜¯æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼›</p><p>2ã€æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•ï¼ŒRedis ä¸­çš„æ•°æ®ç»“æ„æ˜¯ä¸“é—¨è¿›è¡Œè®¾è®¡çš„ï¼›</p><p>3ã€é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€— CPUï¼Œä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ï¼›</p><p>4ã€ä½¿ç”¨å¤šè·¯ I/O å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡ IOï¼›</p><p>5ã€ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ï¼ŒRedis ç›´æ¥è‡ªå·±æ„å»ºäº† VM æœºåˆ¶ ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ï¼›</p><h4 id="â€”â€“æ•°æ®ç»“æ„â€”"><a href="#â€”â€“æ•°æ®ç»“æ„â€”" class="headerlink" title="â€”â€“æ•°æ®ç»“æ„â€”-"></a>â€”â€“æ•°æ®ç»“æ„â€”-</h4><h4 id="1ã€åº”ç”¨åœºæ™¯"><a href="#1ã€åº”ç”¨åœºæ™¯" class="headerlink" title="1ã€åº”ç”¨åœºæ™¯"></a>1ã€åº”ç”¨åœºæ™¯</h4><ul><li>è®¡æ•°å™¨</li></ul><p>å¯ä»¥å¯¹ String è¿›è¡Œè‡ªå¢è‡ªå‡è¿ç®—ï¼Œä»è€Œå®ç°è®¡æ•°å™¨åŠŸèƒ½ã€‚Redis è¿™ç§å†…å­˜å‹æ•°æ®åº“çš„è¯»å†™æ€§èƒ½éå¸¸é«˜ï¼Œå¾ˆé€‚åˆå­˜å‚¨é¢‘ç¹è¯»å†™çš„è®¡æ•°é‡ã€‚</p><ul><li>ç¼“å­˜</li></ul><p>å°†çƒ­ç‚¹æ•°æ®æ”¾åˆ°å†…å­˜ä¸­ï¼Œè®¾ç½®å†…å­˜çš„æœ€å¤§ä½¿ç”¨é‡ä»¥åŠæ·˜æ±°ç­–ç•¥æ¥ä¿è¯ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚</p><ul><li>ä¼šè¯ç¼“å­˜</li></ul><p>å¯ä»¥ä½¿ç”¨ Redis æ¥ç»Ÿä¸€å­˜å‚¨å¤šå°åº”ç”¨æœåŠ¡å™¨çš„ä¼šè¯ä¿¡æ¯ã€‚å½“åº”ç”¨æœåŠ¡å™¨ä¸å†å­˜å‚¨ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼Œä¹Ÿå°±ä¸å†å…·æœ‰çŠ¶æ€ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥è¯·æ±‚ä»»æ„ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ï¼Œä»è€Œæ›´å®¹æ˜“å®ç°é«˜å¯ç”¨æ€§ä»¥åŠå¯ä¼¸ç¼©æ€§ã€‚</p><ul><li>å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰</li></ul><p>é™¤åŸºæœ¬çš„ä¼šè¯tokenä¹‹å¤–ï¼ŒRedisè¿˜æä¾›å¾ˆç®€ä¾¿çš„FPCå¹³å°ã€‚ä»¥Magentoä¸ºä¾‹ï¼ŒMagentoæä¾›ä¸€ä¸ªæ’ä»¶æ¥ä½¿ç”¨Redisä½œä¸ºå…¨é¡µç¼“å­˜åç«¯ã€‚æ­¤å¤–ï¼Œå¯¹WordPressçš„ç”¨æˆ·æ¥è¯´ï¼ŒPantheonæœ‰ä¸€ä¸ªéå¸¸å¥½çš„æ’ä»¶ wp-redisï¼Œè¿™ä¸ªæ’ä»¶èƒ½å¸®åŠ©ä½ ä»¥æœ€å¿«é€Ÿåº¦åŠ è½½ä½ æ›¾æµè§ˆè¿‡çš„é¡µé¢ã€‚</p><ul><li>æŸ¥æ‰¾è¡¨</li></ul><p>ä¾‹å¦‚ DNS è®°å½•å°±å¾ˆé€‚åˆä½¿ç”¨ Redis è¿›è¡Œå­˜å‚¨ã€‚æŸ¥æ‰¾è¡¨å’Œç¼“å­˜ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åˆ©ç”¨äº† Redis å¿«é€Ÿçš„æŸ¥æ‰¾ç‰¹æ€§ã€‚ä½†æ˜¯æŸ¥æ‰¾è¡¨çš„å†…å®¹ä¸èƒ½å¤±æ•ˆï¼Œè€Œç¼“å­˜çš„å†…å®¹å¯ä»¥å¤±æ•ˆï¼Œå› ä¸ºç¼“å­˜ä¸ä½œä¸ºå¯é çš„æ•°æ®æ¥æºã€‚</p><ul><li>æ¶ˆæ¯é˜Ÿåˆ—(å‘å¸ƒ/è®¢é˜…åŠŸèƒ½)</li></ul><p>List æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¯ä»¥é€šè¿‡ lpush å’Œ rpop å†™å…¥å’Œè¯»å–æ¶ˆæ¯ã€‚ä¸è¿‡æœ€å¥½ä½¿ç”¨ Kafkaã€RabbitMQ ç­‰æ¶ˆæ¯ä¸­é—´ä»¶ã€‚</p><ul><li>åˆ†å¸ƒå¼é”å®ç°</li></ul><p>åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ— æ³•ä½¿ç”¨å•æœºç¯å¢ƒä¸‹çš„é”æ¥å¯¹å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„è¿›ç¨‹è¿›è¡ŒåŒæ­¥ã€‚å¯ä»¥ä½¿ç”¨ Redis è‡ªå¸¦çš„ SETNX å‘½ä»¤å®ç°åˆ†å¸ƒå¼é”ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ RedLock åˆ†å¸ƒå¼é”å®ç°ã€‚</p><ul><li>å…¶å®ƒ</li></ul><p>Set å¯ä»¥å®ç°äº¤é›†ã€å¹¶é›†ç­‰æ“ä½œï¼Œä»è€Œå®ç°å…±åŒå¥½å‹ç­‰åŠŸèƒ½ã€‚ZSet å¯ä»¥å®ç°æœ‰åºæ€§æ“ä½œï¼Œä»è€Œå®ç°æ’è¡Œæ¦œç­‰åŠŸèƒ½ã€‚</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ä¸¤ç§åˆ†ç‚¹ä¸Šä¸ºåŠŸèƒ½ï¼Œä¸‹ä¸ºç»“æ„â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</p><p>expireï¼šè®¾ç½®keyçš„è¿‡æœŸæ—¶é—´</p><p>persistï¼šè®¾ç½®keyæ°¸ä¹…æœ‰æ•ˆ</p><ul><li><strong>5ç§åŸºç¡€æ•°æ®ç±»å‹</strong>ï¼šStringã€Listã€Setã€Zsetã€Hashã€‚</li><li><strong>ä¸‰ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹</strong>ï¼š HyperLogLogsï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰ï¼Œ Bitmaps (ä½å›¾) ï¼Œ geospatial ï¼ˆåœ°ç†ä½ç½®)</li></ul><p><strong>Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼š</strong></p><blockquote><p>åº•å±‚æ•°æ®ç»“æ„ï¼š<strong>SDSå³åŠ¨æ€å­—ç¬¦ä¸²</strong>ï¼Œæœ€å¤§å®¹é‡512Mï¼Œæ¯æ¬¡æœ€å¤šæ‰©å®¹1Mï¼Œæ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„æ€æ˜¯redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚jpgå›¾ç‰‡æˆ–åºåˆ—åŒ–çš„å¯¹è±¡<br>åº”ç”¨åœºæ™¯ï¼šåˆ†å¸ƒå¼é”ã€è®¡æ•°å™¨(å¦‚è®¿é—®æ¬¡æ•°ã€ç‚¹èµè½¬å‘æ•°é‡)<br>å¸¸ç”¨æ–¹æ³•ï¼šset ã€getã€strlen ã€incr ã€ decr ã€setnxã€setexã€exists</p></blockquote><p><strong>listï¼ˆåŒå‘åˆ—è¡¨ï¼‰ï¼š</strong></p><blockquote><p>ç‰¹ç‚¹ï¼šå•å€¼å¤šé”®ï¼Œç”¨æ¥å­˜å‚¨å¤šä¸ªæœ‰åºçš„å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªåˆ—è¡¨æœ€å¤šå¯ä»¥å­˜å‚¨2^32-1ä¸ªå…ƒç´ ã€‚å¯ä»¥å®ç°é˜Ÿåˆ—å’Œæ ˆ<br>åº•å±‚æ•°æ®ç»“æ„ï¼š<strong>å¿«è¡¨</strong><br>åº”ç”¨åœºæ™¯ï¼šæ¶ˆæ¯é˜Ÿåˆ— ã€æ–‡ç« åˆ—è¡¨<br>å¸¸ç”¨æ–¹æ³•ï¼šlpush ã€lrang ã€rpush ã€lpop ã€rpop ã€llenã€lindexã€rpoplpushã€linsert</p></blockquote><p><strong>Hashï¼ˆå“ˆå¸Œï¼‰ï¼š</strong></p><blockquote><p>åº•å±‚æ•°æ®ç»“æ„ï¼š<strong>å‹ç¼©åˆ—è¡¨</strong>ã€<strong>å“ˆå¸Œè¡¨</strong>ã€‚<br>ç‰¹ç‚¹ï¼šæŒ‡vï¼ˆå€¼ï¼‰æœ¬èº«åˆæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆk-vï¼‰ç»“æ„<br>åº”ç”¨åœºæ™¯ï¼šç¼“å­˜ç”¨æˆ·ä¿¡æ¯ã€è´­ç‰©è½¦ç­‰ã€‚<br>å¸¸ç”¨æ–¹æ³•ï¼šhset ã€hget ã€hkeys ã€hvals ã€hmset ã€hmget ã€hgetAll ã€hlen ã€hdel ã€hsetnx ã€hexists</p></blockquote><p><strong>setï¼ˆé›†åˆï¼‰ï¼š</strong></p><blockquote><p>ç‰¹ç‚¹ï¼šç”¨æ¥ä¿å­˜å¤šä¸ªçš„å­—ç¬¦ä¸²å…ƒç´ ï¼Œä½†æ˜¯ä¸å…è®¸é‡å¤å…ƒç´ ï¼Œå…ƒç´ æ˜¯æ— åºçš„ã€‚å¯ä»¥å®ç°å¹¶é›†ã€äº¤é›†ã€å·®é›†çš„æ“ä½œ<br>åº•å±‚æ•°æ®ç»“æ„ï¼š<strong>å“ˆå¸Œè¡¨</strong>ã€<strong>æ•´æ•°é›†</strong><br>åº”ç”¨åœºæ™¯ï¼šæŠ½å¥–ã€å…±åŒå…³æ³¨ã€QQå†…æ¨ç­‰ã€‚<br>å¸¸ç”¨æ–¹æ³•ï¼šsadd ã€smembers ã€sismember ã€scard ã€srem ã€srandmemberã€spopã€smoveã€sdiffã€sinterã€sunion</p></blockquote><p><strong>zsetï¼ˆæœ‰åºé›†åˆï¼‰ï¼š</strong></p><blockquote><p>ç‰¹ç‚¹ï¼šæœ‰åºä¸é‡å¤çš„é›†åˆã€‚å’Œ set ç›¸â½sorted set å¢åŠ äº†â¼€ä¸ªæƒé‡å‚æ•° scoreï¼Œå¯ä»¥æ ¹æ®scoreè¿›è¡Œæ’åºï¼Œä½†scoreæ˜¯å¯ä»¥é‡å¤çš„ï¼Œvalueæ˜¯ä¸å¯ä»¥é‡å¤çš„ã€‚<br>åº•å±‚æ•°æ®ç»“æ„ï¼š<strong>å‹ç¼©åˆ—è¡¨</strong>ã€<strong>è·³è¡¨</strong><br>åº”ç”¨åœºæ™¯ï¼šæ’è¡Œæ¦œã€æŠ–éŸ³çƒ­æœ<br>å¸¸ç”¨æ–¹æ³•ï¼šzadd ã€zrange ã€zrangebyscore(æŒ‰scoreä»å°åˆ°å¤§) ã€zrem ã€zcard ã€zcount ã€zrevrange(æŒ‰scoreä»å¤§åˆ°å°ï¼‰</p></blockquote><h4 id="â€”â€“æŒä¹…åŒ–â€”"><a href="#â€”â€“æŒä¹…åŒ–â€”" class="headerlink" title="â€”â€“æŒä¹…åŒ–â€”-"></a>â€”â€“æŒä¹…åŒ–â€”-</h4><h4 id="1ã€Redis-çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#1ã€Redis-çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="1ã€Redis çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿ"></a>1ã€Redis çš„æŒä¹…åŒ–æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿ</h4><p>Redis æä¾›ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ RDBï¼ˆé»˜è®¤ï¼‰ å’Œ AOF æœºåˆ¶:</p><p><strong>RDBï¼šæ˜¯Redis DataBaseç¼©å†™å¿«ç…§</strong></p><p>RDBæ˜¯Redisé»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ã€‚æŒ‰ç…§ä¸€å®šçš„æ—¶é—´å°†å†…å­˜çš„æ•°æ®ä»¥å¿«ç…§çš„å½¢å¼ä¿å­˜åˆ°ç¡¬ç›˜ä¸­ï¼Œå¯¹åº”äº§ç”Ÿçš„æ•°æ®æ–‡ä»¶ä¸ºdump.rdbã€‚é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„saveå‚æ•°æ¥å®šä¹‰å¿«ç…§çš„å‘¨æœŸã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303112207073.png"></p><p>ä¼˜ç‚¹ï¼š</p><ul><li>1ã€åªæœ‰ä¸€ä¸ªæ–‡ä»¶ dump.rdbï¼Œæ–¹ä¾¿æŒä¹…åŒ–ã€‚</li><li>2ã€å®¹ç¾æ€§å¥½ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä¿å­˜åˆ°å®‰å…¨çš„ç£ç›˜ã€‚</li><li>3ã€æ€§èƒ½æœ€å¤§åŒ–ï¼Œfork å­è¿›ç¨‹æ¥å®Œæˆå†™æ“ä½œï¼Œè®©ä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤ï¼Œæ‰€ä»¥æ˜¯ IO æœ€å¤§åŒ–ã€‚ä½¿ç”¨å•ç‹¬å­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¸»è¿›ç¨‹ä¸ä¼šè¿›è¡Œä»»ä½• IO æ“ä½œï¼Œä¿è¯äº† redis çš„é«˜æ€§èƒ½</li><li>4.ç›¸å¯¹äºæ•°æ®é›†å¤§æ—¶ï¼Œæ¯” AOF çš„å¯åŠ¨æ•ˆç‡æ›´é«˜ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>1ã€æ•°æ®å®‰å…¨æ€§ä½ã€‚RDB æ˜¯é—´éš”ä¸€æ®µæ—¶é—´è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ä¹‹é—´ redis å‘ç”Ÿæ•…éšœï¼Œä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼æ›´é€‚åˆæ•°æ®è¦æ±‚ä¸ä¸¥è°¨çš„æ—¶å€™)</li><li>2ã€AOFï¼ˆAppend-only file)æŒä¹…åŒ–æ–¹å¼ï¼šæ˜¯æŒ‡æ‰€æœ‰çš„å‘½ä»¤è¡Œè®°å½•ä»¥ redis å‘½ä»¤è¯· æ±‚åè®®çš„æ ¼å¼å®Œå…¨æŒä¹…åŒ–å­˜å‚¨)ä¿å­˜ä¸º aof æ–‡ä»¶ã€‚</li></ul><p><strong>AOFï¼šæŒä¹…åŒ–</strong></p><p>AOFæŒä¹…åŒ–(å³Append Only FileæŒä¹…åŒ–)ï¼Œåˆ™æ˜¯å°†Redisæ‰§è¡Œçš„æ¯æ¬¡å†™å‘½ä»¤è®°å½•åˆ°å•ç‹¬çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå½“é‡å¯Redisä¼šé‡æ–°å°†æŒä¹…åŒ–çš„æ—¥å¿—ä¸­æ–‡ä»¶æ¢å¤æ•°æ®ã€‚</p><p>å½“ä¸¤ç§æ–¹å¼åŒæ—¶å¼€å¯æ—¶ï¼Œæ•°æ®æ¢å¤Redisä¼šä¼˜å…ˆé€‰æ‹©AOFæ¢å¤ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å®‰å…¨ï¼Œæ‰€æœ‰å†™å…¥çš„æ•°æ®éƒ½ä¸ä¼šä¸¢å¤±ã€‚</li><li>AOFæ–‡ä»¶æ˜“è¯»ï¼Œå¯ä¿®æ”¹ã€‚</li></ul><p>è¯¦æƒ…äº†è§£ï¼š</p><ul><li>1ã€æ•°æ®å®‰å…¨ï¼Œaof æŒä¹…åŒ–å¯ä»¥é…ç½® appendfsync å±æ€§ï¼Œæœ‰ alwaysï¼Œæ¯è¿›è¡Œä¸€æ¬¡ å‘½ä»¤æ“ä½œå°±è®°å½•åˆ° aof æ–‡ä»¶ä¸­ä¸€æ¬¡ã€‚</li><li>2ã€é€šè¿‡ append æ¨¡å¼å†™æ–‡ä»¶ï¼Œå³ä½¿ä¸­é€”æœåŠ¡å™¨å®•æœºï¼Œå¯ä»¥é€šè¿‡ redis-check-aof å·¥å…·è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li><li>3ã€AOF æœºåˆ¶çš„ rewrite æ¨¡å¼ã€‚AOF æ–‡ä»¶æ²¡è¢« rewrite ä¹‹å‰ï¼ˆæ–‡ä»¶è¿‡å¤§æ—¶ä¼šå¯¹å‘½ä»¤ è¿›è¡Œåˆå¹¶é‡å†™ï¼‰ï¼Œå¯ä»¥åˆ é™¤å…¶ä¸­çš„æŸäº›å‘½ä»¤ï¼ˆæ¯”å¦‚è¯¯æ“ä½œçš„ flushallï¼‰</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>1ã€AOF æ–‡ä»¶æ¯” RDB æ–‡ä»¶å¤§ï¼Œä¸”æ¢å¤é€Ÿåº¦æ…¢ã€‚</li><li>2ã€æ•°æ®é›†å¤§çš„æ—¶å€™ï¼Œæ¯” rdb å¯åŠ¨æ•ˆç‡ä½ã€‚</li></ul><p>ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>AOFæ–‡ä»¶æ¯”RDBæ›´æ–°é¢‘ç‡é«˜ï¼Œä¼˜å…ˆä½¿ç”¨AOFè¿˜åŸæ•°æ®ã€‚</li><li>AOFæ¯”RDBæ›´å®‰å…¨ä¹Ÿæ›´å¤§</li><li>RDBæ€§èƒ½æ¯”AOFå¥½</li><li>å¦‚æœä¸¤ä¸ªéƒ½é…äº†ä¼˜å…ˆåŠ è½½AOF</li></ul><h4 id="2ã€å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–æ–¹å¼"><a href="#2ã€å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–æ–¹å¼" class="headerlink" title="2ã€å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–æ–¹å¼"></a>2ã€å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–æ–¹å¼</h4><ul><li>ä¸€èˆ¬æ¥è¯´ï¼Œ å¦‚æœæƒ³è¾¾åˆ°è¶³ä»¥åª²ç¾PostgreSQLçš„æ•°æ®å®‰å…¨æ€§ï¼Œä½ åº”è¯¥åŒæ—¶ä½¿ç”¨ä¸¤ç§æŒä¹…åŒ–åŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ Redis é‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼Œå› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´ã€‚</li><li>å¦‚æœä½ éå¸¸å…³å¿ƒä½ çš„æ•°æ®ï¼Œ ä½†ä»ç„¶å¯ä»¥æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆä½ å¯ä»¥åªä½¿ç”¨RDBæŒä¹…åŒ–ã€‚</li><li>æœ‰å¾ˆå¤šç”¨æˆ·éƒ½åªä½¿ç”¨AOFæŒä¹…åŒ–ï¼Œä½†å¹¶ä¸æ¨èè¿™ç§æ–¹å¼ï¼Œå› ä¸ºå®šæ—¶ç”ŸæˆRDBå¿«ç…§ï¼ˆsnapshotï¼‰éå¸¸ä¾¿äºè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œ å¹¶ä¸” RDB æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦æ¯”AOFæ¢å¤çš„é€Ÿåº¦è¦å¿«ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨RDBè¿˜å¯ä»¥é¿å…AOFç¨‹åºçš„bugã€‚</li><li>å¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼ã€‚</li></ul><h4 id="3ã€RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹"><a href="#3ã€RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹" class="headerlink" title="3ã€RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹"></a>3ã€RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹</h4><ul><li>å¦‚æœRedisè¢«å½“åšç¼“å­˜ä½¿ç”¨ï¼Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œå®ç°åŠ¨æ€æ‰©å®¹ç¼©å®¹ã€‚</li><li>å¦‚æœRedisè¢«å½“åšä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨ä½¿ç”¨ï¼Œå¿…é¡»ä½¿ç”¨å›ºå®šçš„keys-to-nodesæ˜ å°„å…³ç³»ï¼ŒèŠ‚ç‚¹çš„æ•°é‡ä¸€æ—¦ç¡®å®šä¸èƒ½å˜åŒ–ã€‚å¦åˆ™çš„è¯(å³RedisèŠ‚ç‚¹éœ€è¦åŠ¨æ€å˜åŒ–çš„æƒ…å†µï¼‰ï¼Œå¿…é¡»ä½¿ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œæ•°æ®å†å¹³è¡¡çš„ä¸€å¥—ç³»ç»Ÿï¼Œè€Œå½“å‰åªæœ‰Redisé›†ç¾¤å¯ä»¥åšåˆ°è¿™æ ·ã€‚</li></ul><h4 id="â€”è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â€”"><a href="#â€”è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â€”" class="headerlink" title="â€”è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â€”"></a>â€”è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥â€”</h4><h4 id="1ã€Redisçš„è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥"><a href="#1ã€Redisçš„è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥" class="headerlink" title="1ã€Redisçš„è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥"></a>1ã€Redisçš„è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒRedisæ˜¯key-valueæ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®Redisä¸­ç¼“å­˜çš„keyçš„è¿‡æœŸæ—¶é—´ã€‚Redisçš„è¿‡æœŸç­–ç•¥å°±æ˜¯æŒ‡å½“Redisä¸­ç¼“å­˜çš„keyè¿‡æœŸäº†ï¼ŒRediså¦‚ä½•å¤„ç†ã€‚</p><p>è¿‡æœŸç­–ç•¥é€šå¸¸æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li>å®šæ—¶è¿‡æœŸï¼šæ¯ä¸ªè®¾ç½®è¿‡æœŸæ—¶é—´çš„keyéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œåˆ°è¿‡æœŸæ—¶é—´å°±ä¼šç«‹å³æ¸…é™¤ã€‚è¯¥ç­–ç•¥å¯ä»¥ç«‹å³æ¸…é™¤è¿‡æœŸçš„æ•°æ®ï¼Œå¯¹å†…å­˜å¾ˆå‹å¥½ï¼›ä½†æ˜¯ä¼šå ç”¨å¤§é‡çš„CPUèµ„æºå»å¤„ç†è¿‡æœŸçš„æ•°æ®ï¼Œä»è€Œå½±å“ç¼“å­˜çš„å“åº”æ—¶é—´å’Œååé‡ã€‚</li><li>æƒ°æ€§è¿‡æœŸï¼šåªæœ‰å½“è®¿é—®ä¸€ä¸ªkeyæ—¶ï¼Œæ‰ä¼šåˆ¤æ–­è¯¥keyæ˜¯å¦å·²è¿‡æœŸï¼Œè¿‡æœŸåˆ™æ¸…é™¤ã€‚è¯¥ç­–ç•¥å¯ä»¥æœ€å¤§åŒ–åœ°èŠ‚çœCPUèµ„æºï¼Œå´å¯¹å†…å­˜éå¸¸ä¸å‹å¥½ã€‚æç«¯æƒ…å†µå¯èƒ½å‡ºç°å¤§é‡çš„è¿‡æœŸkeyæ²¡æœ‰å†æ¬¡è¢«è®¿é—®ï¼Œä»è€Œä¸ä¼šè¢«æ¸…é™¤ï¼Œå ç”¨å¤§é‡å†…å­˜ã€‚</li><li>å®šæœŸè¿‡æœŸï¼šæ¯éš”ä¸€å®šçš„æ—¶é—´ï¼Œä¼šæ‰«æä¸€å®šæ•°é‡çš„æ•°æ®åº“çš„expireså­—å…¸ä¸­ä¸€å®šæ•°é‡çš„keyï¼Œå¹¶æ¸…é™¤å…¶ä¸­å·²è¿‡æœŸçš„keyã€‚è¯¥ç­–ç•¥æ˜¯å‰ä¸¤è€…çš„ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆã€‚é€šè¿‡è°ƒæ•´å®šæ—¶æ‰«æçš„æ—¶é—´é—´éš”å’Œæ¯æ¬¡æ‰«æçš„é™å®šè€—æ—¶ï¼Œå¯ä»¥åœ¨ä¸åŒæƒ…å†µä¸‹ä½¿å¾—CPUå’Œå†…å­˜èµ„æºè¾¾åˆ°æœ€ä¼˜çš„å¹³è¡¡æ•ˆæœã€‚<br>(expireså­—å…¸ä¼šä¿å­˜æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyçš„è¿‡æœŸæ—¶é—´æ•°æ®ï¼Œå…¶ä¸­ï¼Œkeyæ˜¯æŒ‡å‘é”®ç©ºé—´ä¸­çš„æŸä¸ªé”®çš„æŒ‡é’ˆï¼Œvalueæ˜¯è¯¥é”®çš„æ¯«ç§’ç²¾åº¦çš„UNIXæ—¶é—´æˆ³è¡¨ç¤ºçš„è¿‡æœŸæ—¶é—´ã€‚é”®ç©ºé—´æ˜¯æŒ‡è¯¥Redisé›†ç¾¤ä¸­ä¿å­˜çš„æ‰€æœ‰é”®ã€‚)</li></ul><p>Redisä¸­åŒæ—¶ä½¿ç”¨äº†æƒ°æ€§è¿‡æœŸå’Œå®šæœŸè¿‡æœŸä¸¤ç§è¿‡æœŸç­–ç•¥ã€‚</p><h4 id="2ã€å¯¹è¿‡æœŸçš„æ•°æ®æ€ä¹ˆå¤„ç†å‘¢"><a href="#2ã€å¯¹è¿‡æœŸçš„æ•°æ®æ€ä¹ˆå¤„ç†å‘¢" class="headerlink" title="2ã€å¯¹è¿‡æœŸçš„æ•°æ®æ€ä¹ˆå¤„ç†å‘¢?"></a>2ã€å¯¹è¿‡æœŸçš„æ•°æ®æ€ä¹ˆå¤„ç†å‘¢?</h4><p>é™¤äº†ç¼“å­˜æœåŠ¡å™¨è‡ªå¸¦çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥ä¹‹å¤–ï¼ˆRedisé»˜è®¤çš„æœ‰6ä¸­ç­–ç•¥å¯ä¾›é€‰æ‹©ï¼‰ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰çš„ç¼“å­˜æ·˜æ±°ï¼Œå¸¸è§çš„ç­–ç•¥æœ‰ä¸¤ç§ï¼š</p><ol><li>å®šæ—¶å»æ¸…ç†è¿‡æœŸçš„ç¼“å­˜ï¼›</li><li>å½“æœ‰ç”¨æˆ·è¯·æ±‚è¿‡æ¥æ—¶ï¼Œå†åˆ¤æ–­è¿™ä¸ªè¯·æ±‚æ‰€ç”¨åˆ°çš„ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸçš„è¯å°±å»åº•å±‚ç³»ç»Ÿå¾—åˆ°æ–°æ•°æ®å¹¶æ›´æ–°ç¼“å­˜ã€‚</li></ol><p>ä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼Œç¬¬ä¸€ç§çš„ç¼ºç‚¹æ˜¯ç»´æŠ¤å¤§é‡ç¼“å­˜çš„keyæ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œç¬¬äºŒç§çš„ç¼ºç‚¹å°±æ˜¯æ¯æ¬¡ç”¨æˆ·è¯·æ±‚è¿‡æ¥éƒ½è¦åˆ¤æ–­ç¼“å­˜å¤±æ•ˆï¼Œé€»è¾‘ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼å…·ä½“ç”¨å“ªç§æ–¹æ¡ˆï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„åº”ç”¨åœºæ™¯æ¥æƒè¡¡ã€‚</p><h4 id="â€”å†…å­˜ç›¸å…³â€”"><a href="#â€”å†…å­˜ç›¸å…³â€”" class="headerlink" title="â€”å†…å­˜ç›¸å…³â€”"></a>â€”å†…å­˜ç›¸å…³â€”</h4><h4 id="1ã€MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®"><a href="#1ã€MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®" class="headerlink" title="1ã€MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®"></a>1ã€MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®</h4><p>rediså†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šæ–½è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚</p><h4 id="2ã€Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›"><a href="#2ã€Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›" class="headerlink" title="2ã€Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›"></a>2ã€Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›</h4><p>Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥æ˜¯æŒ‡åœ¨Redisçš„ç”¨äºç¼“å­˜çš„å†…å­˜ä¸è¶³æ—¶ï¼Œæ€ä¹ˆå¤„ç†éœ€è¦æ–°å†™å…¥ä¸”éœ€è¦ç”³è¯·é¢å¤–ç©ºé—´çš„æ•°æ®ã€‚</p><p>å…¨å±€çš„é”®ç©ºé—´é€‰æ‹©æ€§ç§»é™¤</p><ul><li>noevictionï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚</li><li>allkeys-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚ï¼ˆè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼‰</li><li>allkeys-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚</li></ul><p>è®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´é€‰æ‹©æ€§ç§»é™¤</p><ul><li>volatile-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyã€‚</li><li>volatile-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ªkeyã€‚</li><li>volatile-ttlï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œæœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„keyä¼˜å…ˆç§»é™¤ã€‚</li></ul><p><strong>æ€»ç»“</strong></p><p>Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥çš„é€‰å–å¹¶ä¸ä¼šå½±å“è¿‡æœŸçš„keyçš„å¤„ç†ã€‚å†…å­˜æ·˜æ±°ç­–ç•¥ç”¨äºå¤„ç†å†…å­˜ä¸è¶³æ—¶çš„éœ€è¦ç”³è¯·é¢å¤–ç©ºé—´çš„æ•°æ®ï¼›è¿‡æœŸç­–ç•¥ç”¨äºå¤„ç†è¿‡æœŸçš„ç¼“å­˜æ•°æ®ã€‚</p><h4 id="3ã€Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆ"><a href="#3ã€Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆ" class="headerlink" title="3ã€Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆ"></a>3ã€Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆ</h4><p>å¦‚æœè¾¾åˆ°è®¾ç½®çš„ä¸Šé™ï¼ŒRedisçš„å†™å‘½ä»¤ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼ˆä½†æ˜¯è¯»å‘½ä»¤è¿˜å¯ä»¥æ­£å¸¸è¿”å›ã€‚ï¼‰æˆ–è€…ä½ å¯ä»¥é…ç½®å†…å­˜æ·˜æ±°æœºåˆ¶ï¼Œå½“Redisè¾¾åˆ°å†…å­˜ä¸Šé™æ—¶ä¼šå†²åˆ·æ‰æ—§çš„å†…å®¹ã€‚</p><h4 id="4ã€Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–"><a href="#4ã€Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–" class="headerlink" title="4ã€Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–"></a>4ã€Rediså¦‚ä½•åšå†…å­˜ä¼˜åŒ–</h4><p>å¯ä»¥å¥½å¥½åˆ©ç”¨Hash,list,sorted set,setç­‰é›†åˆç±»å‹æ•°æ®ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹å¾ˆå¤šå°çš„Key-Valueå¯ä»¥ç”¨æ›´ç´§å‡‘çš„æ–¹å¼å­˜æ”¾åˆ°ä¸€èµ·ã€‚å°½å¯èƒ½ä½¿ç”¨æ•£åˆ—è¡¨ï¼ˆhashesï¼‰ï¼Œæ•£åˆ—è¡¨ï¼ˆæ˜¯è¯´æ•£åˆ—è¡¨é‡Œé¢å­˜å‚¨çš„æ•°å°‘ï¼‰ä½¿ç”¨çš„å†…å­˜éå¸¸å°ï¼Œæ‰€ä»¥ä½ åº”è¯¥å°½å¯èƒ½çš„å°†ä½ çš„æ•°æ®æ¨¡å‹æŠ½è±¡åˆ°ä¸€ä¸ªæ•£åˆ—è¡¨é‡Œé¢ã€‚æ¯”å¦‚ä½ çš„webç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ï¼Œä¸è¦ä¸ºè¿™ä¸ªç”¨æˆ·çš„åç§°ï¼Œå§“æ°ï¼Œé‚®ç®±ï¼Œå¯†ç è®¾ç½®å•ç‹¬çš„keyï¼Œè€Œæ˜¯åº”è¯¥æŠŠè¿™ä¸ªç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯å­˜å‚¨åˆ°ä¸€å¼ æ•£åˆ—è¡¨é‡Œé¢</p><p>è¡¥å……ï¼šä½†æ˜¯æ³¨æ„ keyç²’åº¦è¦è¶³å¤Ÿç»†ï¼ˆxxx-yy-zzz-***ï¼‰</p><h4 id="â€”çº¿ç¨‹æ¨¡å‹â€”"><a href="#â€”çº¿ç¨‹æ¨¡å‹â€”" class="headerlink" title="â€”çº¿ç¨‹æ¨¡å‹â€”"></a>â€”çº¿ç¨‹æ¨¡å‹â€”</h4><h4 id="1ã€Redisçº¿ç¨‹æ¨¡å‹"><a href="#1ã€Redisçº¿ç¨‹æ¨¡å‹" class="headerlink" title="1ã€Redisçº¿ç¨‹æ¨¡å‹"></a>1ã€Redisçº¿ç¨‹æ¨¡å‹</h4><p>RedisåŸºäºReactoræ¨¡å¼å¼€å‘äº†ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼Œè¿™ä¸ªå¤„ç†å™¨è¢«ç§°ä¸ºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚å®ƒçš„ç»„æˆç»“æ„ä¸º4éƒ¨åˆ†ï¼šå¤šä¸ªå¥—æ¥å­—ã€IOå¤šè·¯å¤ç”¨ç¨‹åºã€æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ã€äº‹ä»¶å¤„ç†å™¨ã€‚å› ä¸ºæ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨é˜Ÿåˆ—çš„æ¶ˆè´¹æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥Redisæ‰å«å•çº¿ç¨‹æ¨¡å‹ã€‚</p><ul><li>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ï¼ˆmultiplexingï¼‰ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œ å¹¶æ ¹æ®å¥—æ¥å­—ç›®å‰æ‰§è¡Œçš„ä»»åŠ¡æ¥ä¸ºå¥—æ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ã€‚</li><li>å½“è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡å¥½æ‰§è¡Œè¿æ¥åº”ç­”ï¼ˆacceptï¼‰ã€è¯»å–ï¼ˆreadï¼‰ã€å†™å…¥ï¼ˆwriteï¼‰ã€å…³é—­ï¼ˆcloseï¼‰ç­‰æ“ä½œæ—¶ï¼Œ ä¸æ“ä½œç›¸å¯¹åº”çš„æ–‡ä»¶äº‹ä»¶å°±ä¼šäº§ç”Ÿï¼Œ è¿™æ—¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šè°ƒç”¨å¥—æ¥å­—ä¹‹å‰å…³è”å¥½çš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚</li></ul><p>è™½ç„¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œï¼Œ ä½†é€šè¿‡ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ¥ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œ æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ—¢å®ç°äº†é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œ åˆå¯ä»¥å¾ˆå¥½åœ°ä¸ redis æœåŠ¡å™¨ä¸­å…¶ä»–åŒæ ·ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„æ¨¡å—è¿›è¡Œå¯¹æ¥ï¼Œ è¿™ä¿æŒäº† Redis å†…éƒ¨å•çº¿ç¨‹è®¾è®¡çš„ç®€å•æ€§ã€‚</p><h4 id="â€”â€“äº‹åŠ¡â€”â€“"><a href="#â€”â€“äº‹åŠ¡â€”â€“" class="headerlink" title="â€”â€“äº‹åŠ¡â€”â€“"></a>â€”â€“äº‹åŠ¡â€”â€“</h4><p>Redis äº‹åŠ¡çš„æœ¬è´¨æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚äº‹åŠ¡æ”¯æŒä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ã€‚åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæŒ‰ç…§é¡ºåºä¸²è¡ŒåŒ–æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åºåˆ—ä¸­ã€‚</p><p>æ€»ç»“è¯´ï¼šredisäº‹åŠ¡å°±æ˜¯ä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤ã€‚</p><h4 id="0ã€ç«™é•¿ç®€ä¹¦ï¼Œredisäº‹åŠ¡ï¼ˆè¿˜æœ‰luaç§’æ€æ¡ˆä¾‹ï¼‰"><a href="#0ã€ç«™é•¿ç®€ä¹¦ï¼Œredisäº‹åŠ¡ï¼ˆè¿˜æœ‰luaç§’æ€æ¡ˆä¾‹ï¼‰" class="headerlink" title="0ã€ç«™é•¿ç®€ä¹¦ï¼Œredisäº‹åŠ¡ï¼ˆè¿˜æœ‰luaç§’æ€æ¡ˆä¾‹ï¼‰"></a>0ã€ç«™é•¿ç®€ä¹¦ï¼Œredisäº‹åŠ¡ï¼ˆè¿˜æœ‰luaç§’æ€æ¡ˆä¾‹ï¼‰</h4><p><a href="https://www.jianshu.com/p/879efff5f7b4">https://www.jianshu.com/p/879efff5f7b4</a></p><p>ä»è¾“å…¥Multiå‘½ä»¤å¼€å§‹(å¼€å¯äº‹åŠ¡)ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œç›´åˆ°è¾“å…¥Execåï¼ŒRedisä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œã€‚</p><p>ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡discardæ¥æ”¾å¼ƒç»„é˜Ÿ</p><p>ï¼ˆ1ï¼‰ç»„é˜Ÿæ¡ˆä¾‹</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">127.0.0.1<span class="token punctuation">:</span>6379&gt; multiOK127.0.0.1<span class="token punctuation">:</span><span class="token function">6379</span><span class="token punctuation">(</span>TX<span class="token punctuation">)</span>&gt; set k1 v1QUEUED127.0.0.1<span class="token punctuation">:</span><span class="token function">6379</span><span class="token punctuation">(</span>TX<span class="token punctuation">)</span>&gt; set k2 v2QUEUED127.0.0.1<span class="token punctuation">:</span><span class="token function">6379</span><span class="token punctuation">(</span>TX<span class="token punctuation">)</span>&gt; exec1<span class="token punctuation">)</span> OK2<span class="token punctuation">)</span> OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ï¼ˆ2ï¼‰æ”¾å¼ƒç»„é˜Ÿ</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">127.0.0.1<span class="token punctuation">:</span>6379&gt; multiOK127.0.0.1<span class="token punctuation">:</span><span class="token function">6379</span><span class="token punctuation">(</span>TX<span class="token punctuation">)</span>&gt; set k1 v1QUEUED127.0.0.1<span class="token punctuation">:</span><span class="token function">6379</span><span class="token punctuation">(</span>TX<span class="token punctuation">)</span>&gt; set k2 v2QUEUED127.0.0.1<span class="token punctuation">:</span><span class="token function">6379</span><span class="token punctuation">(</span>TX<span class="token punctuation">)</span>&gt; discard1<span class="token punctuation">)</span> OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ï¼ˆ3ï¼‰ä»»ä½•ä¸€ä¸ªç»„é˜Ÿå¤±è´¥ï¼Œéƒ½ä¸ä¼šæ‰§è¡Œ</p><pre class="line-numbers language-ruby" data-language="ruby"><code class="language-ruby"><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token operator">&gt;</span> multi<span class="token constant">OK</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token punctuation">(</span><span class="token constant">TX</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> set k1 v1<span class="token constant">QUEUED</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token punctuation">(</span><span class="token constant">TX</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> set k2 v2<span class="token constant">QUEUED</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token punctuation">(</span><span class="token constant">TX</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> set k3<span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token constant">ERR</span> wrong number of arguments <span class="token keyword">for</span> <span class="token string">'set'</span> command<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token punctuation">(</span><span class="token constant">TX</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> exec<span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token constant">EXECABORT</span> <span class="token constant">Transaction</span> discarded because of previous errors<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€äº‹åŠ¡çš„é”™è¯¯å¤„ç†</p><p>ï¼ˆ1ï¼‰ç»„é˜Ÿä¸­æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆã€‚ï¼ˆå°±æ˜¯ä¸Šé¢3çš„æ“ä½œï¼‰</p><p>ï¼ˆ2ï¼‰å¦‚æœæ‰§è¡Œé˜¶æ®µæŸä¸ªå‘½ä»¤æŠ¥å‡ºäº†é”™è¯¯ï¼Œåˆ™åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œå…¶ä»–çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šå›æ»šã€‚</p><p>æ¡ˆä¾‹ï¼šå­—ç¬¦ä¸²+1</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">127.0.0.1<span class="token punctuation">:</span>6379&gt; multi OK127.0.0.1<span class="token punctuation">:</span><span class="token function">6379</span><span class="token punctuation">(</span>TX<span class="token punctuation">)</span>&gt; set k1 v1QUEUED127.0.0.1<span class="token punctuation">:</span><span class="token function">6379</span><span class="token punctuation">(</span>TX<span class="token punctuation">)</span>&gt; incr k1QUEUED127.0.0.1<span class="token punctuation">:</span><span class="token function">6379</span><span class="token punctuation">(</span>TX<span class="token punctuation">)</span>&gt; exec1<span class="token punctuation">)</span> OK2<span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR value is not an integer or out of range<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1ã€ç›¸å…³å‘½ä»¤"><a href="#1ã€ç›¸å…³å‘½ä»¤" class="headerlink" title="1ã€ç›¸å…³å‘½ä»¤"></a>1ã€<strong>ç›¸å…³å‘½ä»¤</strong></h4><ul><li>MULTI ï¼šå¼€å¯äº‹åŠ¡ï¼Œredisä¼šå°†åç»­çš„å‘½ä»¤é€ä¸ªæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åä½¿ç”¨EXECå‘½ä»¤æ¥åŸå­åŒ–æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ç³»åˆ—ã€‚</li><li>EXECï¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œå‘½ä»¤ã€‚</li><li>DISCARDï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚</li><li>WATCHï¼šç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªkey,å¦‚æœäº‹åŠ¡åœ¨æ‰§è¡Œå‰ï¼Œè¿™ä¸ªkey(æˆ–å¤šä¸ªkey)è¢«å…¶ä»–å‘½ä»¤ä¿®æ”¹ï¼Œåˆ™äº‹åŠ¡è¢«ä¸­æ–­ï¼Œä¸ä¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„ä»»ä½•å‘½ä»¤ã€‚</li><li>UNWATCHï¼šå–æ¶ˆWATCHå¯¹æ‰€æœ‰keyçš„ç›‘è§†ã€‚</li></ul><h4 id="2ã€æ‰§è¡Œçš„3ä¸ªé˜¶æ®µ"><a href="#2ã€æ‰§è¡Œçš„3ä¸ªé˜¶æ®µ" class="headerlink" title="2ã€æ‰§è¡Œçš„3ä¸ªé˜¶æ®µ"></a>2ã€<strong>æ‰§è¡Œçš„3ä¸ªé˜¶æ®µ</strong></h4><ul><li><strong>å¼€å¯</strong>ï¼šä»¥MULTIå¼€å§‹ä¸€ä¸ªäº‹åŠ¡</li><li><strong>å…¥é˜Ÿ</strong>ï¼šå°†å¤šä¸ªå‘½ä»¤å…¥é˜Ÿåˆ°äº‹åŠ¡ä¸­ï¼Œæ¥åˆ°è¿™äº›å‘½ä»¤å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ”¾åˆ°ç­‰å¾…æ‰§è¡Œçš„äº‹åŠ¡é˜Ÿåˆ—é‡Œé¢</li><li><strong>æ‰§è¡Œ</strong>ï¼šç”±EXECå‘½ä»¤è§¦å‘äº‹åŠ¡</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303121523348.png"></p><h4 id="3ã€Redis-å¯¹-ACIDçš„æ”¯æŒæ€§ç†è§£"><a href="#3ã€Redis-å¯¹-ACIDçš„æ”¯æŒæ€§ç†è§£" class="headerlink" title="3ã€Redis å¯¹ ACIDçš„æ”¯æŒæ€§ç†è§£"></a>3ã€Redis å¯¹ ACIDçš„æ”¯æŒæ€§ç†è§£</h4><ul><li><strong>åŸå­æ€§atomicity</strong></li></ul><blockquote><p>Rediså®˜æ–¹æ–‡æ¡£ç»™çš„ç†è§£æ˜¯ï¼Œ<strong>Redisçš„äº‹åŠ¡æ˜¯åŸå­æ€§çš„ï¼šæ‰€æœ‰çš„å‘½ä»¤ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ</strong>ã€‚è€Œä¸æ˜¯å®Œå…¨æˆåŠŸã€‚</p></blockquote><ul><li><strong>ä¸€è‡´æ€§consistency</strong></li></ul><blockquote><p>redisäº‹åŠ¡å¯ä»¥ä¿è¯å‘½ä»¤å¤±è´¥çš„æƒ…å†µä¸‹å¾—ä»¥å›æ»šï¼Œæ•°æ®èƒ½æ¢å¤åˆ°æ²¡æœ‰æ‰§è¡Œä¹‹å‰çš„æ ·å­ï¼Œæ˜¯ä¿è¯ä¸€è‡´æ€§çš„ï¼Œé™¤éredisè¿›ç¨‹æ„å¤–ç»ˆç»“ã€‚</p></blockquote><ul><li><strong>éš”ç¦»æ€§Isolation</strong></li></ul><blockquote><p>redisäº‹åŠ¡æ˜¯ä¸¥æ ¼éµå®ˆéš”ç¦»æ€§çš„ï¼ŒåŸå› æ˜¯redisæ˜¯å•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å¼(v6.0ä¹‹å‰ï¼‰ï¼Œå¯ä»¥ä¿è¯å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘½ä»¤æ‰“æ–­ã€‚ä½†æ˜¯ï¼ŒRedisä¸åƒå…¶å®ƒç»“æ„åŒ–æ•°æ®åº“æœ‰éš”ç¦»çº§åˆ«è¿™ç§è®¾è®¡ã€‚</p></blockquote><ul><li><strong>æŒä¹…æ€§Durability</strong></li></ul><blockquote><p><strong>redisäº‹åŠ¡æ˜¯ä¸ä¿è¯æŒä¹…æ€§çš„</strong>ï¼Œè¿™æ˜¯å› ä¸ºredisæŒä¹…åŒ–ç­–ç•¥ä¸­ä¸ç®¡æ˜¯RDBè¿˜æ˜¯AOFéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä¸ä¿è¯æŒä¹…æ€§æ˜¯å‡ºäºå¯¹æ€§èƒ½çš„è€ƒè™‘ã€‚</p></blockquote><h4 id="4ã€Redisäº‹åŠ¡æ”¯æŒéš”ç¦»æ€§å—"><a href="#4ã€Redisäº‹åŠ¡æ”¯æŒéš”ç¦»æ€§å—" class="headerlink" title="4ã€Redisäº‹åŠ¡æ”¯æŒéš”ç¦»æ€§å—"></a>4ã€Redisäº‹åŠ¡æ”¯æŒéš”ç¦»æ€§å—</h4><p>Redis æ˜¯å•è¿›ç¨‹ç¨‹åºï¼Œå¹¶ä¸”å®ƒä¿è¯åœ¨æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œä¸ä¼šå¯¹äº‹åŠ¡è¿›è¡Œä¸­æ–­ï¼Œäº‹åŠ¡å¯ä»¥è¿è¡Œç›´åˆ°æ‰§è¡Œå®Œæ‰€æœ‰äº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¸ºæ­¢ã€‚å› æ­¤ï¼ŒRedis çš„äº‹åŠ¡æ˜¯æ€»æ˜¯å¸¦æœ‰éš”ç¦»æ€§çš„ã€‚</p><h4 id="5ã€Redisäº‹åŠ¡ä¿è¯åŸå­æ€§å—ï¼Œæ”¯æŒå›æ»šå—"><a href="#5ã€Redisäº‹åŠ¡ä¿è¯åŸå­æ€§å—ï¼Œæ”¯æŒå›æ»šå—" class="headerlink" title="5ã€Redisäº‹åŠ¡ä¿è¯åŸå­æ€§å—ï¼Œæ”¯æŒå›æ»šå—"></a>5ã€Redisäº‹åŠ¡ä¿è¯åŸå­æ€§å—ï¼Œæ”¯æŒå›æ»šå—</h4><p>Redisä¸­ï¼Œå•æ¡å‘½ä»¤æ˜¯åŸå­æ€§æ‰§è¡Œçš„ï¼Œä½†äº‹åŠ¡ä¸ä¿è¯åŸå­æ€§ï¼Œä¸”æ²¡æœ‰å›æ»šã€‚äº‹åŠ¡ä¸­ä»»æ„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶ä½™çš„å‘½ä»¤ä»ä¼šè¢«æ‰§è¡Œã€‚</p><h4 id="6ã€Redisäº‹åŠ¡å…¶ä»–å®ç°"><a href="#6ã€Redisäº‹åŠ¡å…¶ä»–å®ç°" class="headerlink" title="6ã€Redisäº‹åŠ¡å…¶ä»–å®ç°"></a>6ã€Redisäº‹åŠ¡å…¶ä»–å®ç°</h4><ul><li>åŸºäºLuaè„šæœ¬ï¼ŒRediså¯ä»¥ä¿è¯è„šæœ¬å†…çš„å‘½ä»¤ä¸€æ¬¡æ€§ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œï¼Œ<br>å…¶åŒæ—¶ä¹Ÿä¸æä¾›äº‹åŠ¡è¿è¡Œé”™è¯¯çš„å›æ»šï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœéƒ¨åˆ†å‘½ä»¤è¿è¡Œé”™è¯¯ï¼Œå‰©ä¸‹çš„å‘½ä»¤è¿˜æ˜¯ä¼šç»§ç»­è¿è¡Œå®Œ</li><li>åŸºäºä¸­é—´æ ‡è®°å˜é‡ï¼Œé€šè¿‡å¦å¤–çš„æ ‡è®°å˜é‡æ¥æ ‡è¯†äº‹åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œè¯»å–æ•°æ®æ—¶å…ˆè¯»å–è¯¥æ ‡è®°å˜é‡åˆ¤æ–­æ˜¯å¦äº‹åŠ¡æ‰§è¡Œå®Œæˆã€‚ä½†è¿™æ ·ä¼šéœ€è¦é¢å¤–å†™ä»£ç å®ç°ï¼Œæ¯”è¾ƒç¹ç</li></ul><h4 id="â€”â€”é›†ç¾¤æ–¹æ¡ˆâ€”â€”"><a href="#â€”â€”é›†ç¾¤æ–¹æ¡ˆâ€”â€”" class="headerlink" title="â€”â€”é›†ç¾¤æ–¹æ¡ˆâ€”â€”-"></a>â€”â€”é›†ç¾¤æ–¹æ¡ˆâ€”â€”-</h4><h4 id="1ã€ä¸»ä»å¤åˆ¶"><a href="#1ã€ä¸»ä»å¤åˆ¶" class="headerlink" title="1ã€ä¸»ä»å¤åˆ¶"></a>1ã€ä¸»ä»å¤åˆ¶</h4><p>å•æœºçš„ redisï¼Œèƒ½å¤Ÿæ‰¿è½½çš„ QPS å¤§æ¦‚å°±åœ¨ä¸Šä¸‡åˆ°å‡ ä¸‡ä¸ç­‰ã€‚å¯¹äºç¼“å­˜æ¥è¯´ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨æ¥æ”¯æ’‘è¯»é«˜å¹¶å‘çš„ã€‚å› æ­¤æ¶æ„åšæˆä¸»ä»(master-slave)æ¶æ„ï¼Œä¸€ä¸»å¤šä»ï¼Œä¸»è´Ÿè´£å†™ï¼Œå¹¶ä¸”å°†æ•°æ®å¤åˆ¶åˆ°å…¶å®ƒçš„ slave èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»ã€‚æ‰€æœ‰çš„è¯»è¯·æ±‚å…¨éƒ¨èµ°ä»èŠ‚ç‚¹ã€‚è¿™æ ·ä¹Ÿå¯ä»¥å¾ˆè½»æ¾å®ç°æ°´å¹³æ‰©å®¹ï¼Œæ”¯æ’‘è¯»é«˜å¹¶å‘ã€‚</p><p>redis replication -&gt; ä¸»ä»æ¶æ„ -&gt; è¯»å†™åˆ†ç¦» -&gt; æ°´å¹³æ‰©å®¹æ”¯æ’‘è¯»é«˜å¹¶å‘</p><p>redis replication çš„æ ¸å¿ƒæœºåˆ¶</p><ul><li>redis é‡‡ç”¨å¼‚æ­¥æ–¹å¼å¤åˆ¶æ•°æ®åˆ° slave èŠ‚ç‚¹ï¼Œä¸è¿‡ redis2.8 å¼€å§‹ï¼Œslave node ä¼šå‘¨æœŸæ€§åœ°ç¡®è®¤è‡ªå·±æ¯æ¬¡å¤åˆ¶çš„æ•°æ®é‡ï¼›</li><li>ä¸€ä¸ª master node æ˜¯å¯ä»¥é…ç½®å¤šä¸ª slave node çš„ï¼›</li><li>slave node ä¹Ÿå¯ä»¥è¿æ¥å…¶ä»–çš„ slave nodeï¼›</li><li>slave node åšå¤åˆ¶çš„æ—¶å€™ï¼Œä¸ä¼š block(é˜»å¡) master node çš„æ­£å¸¸å·¥ä½œï¼›ï¼ˆå¼‚æ­¥æ‰€ä»¥ä¸ä¼šblockï¼‰</li><li>slave node åœ¨åšå¤åˆ¶çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼š block å¯¹è‡ªå·±çš„æŸ¥è¯¢æ“ä½œï¼Œå®ƒä¼šç”¨æ—§çš„æ•°æ®é›†æ¥æä¾›æœåŠ¡ï¼›ä½†æ˜¯å¤åˆ¶å®Œæˆçš„æ—¶å€™ï¼Œéœ€è¦åˆ é™¤æ—§æ•°æ®é›†ï¼ŒåŠ è½½æ–°æ•°æ®é›†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šæš‚åœå¯¹å¤–æœåŠ¡äº†ï¼›</li><li>slave node ä¸»è¦ç”¨æ¥è¿›è¡Œæ¨ªå‘æ‰©å®¹ï¼Œåšè¯»å†™åˆ†ç¦»ï¼Œæ‰©å®¹çš„ slave node å¯ä»¥æé«˜è¯»çš„ååé‡ã€‚</li></ul><p>æ³¨æ„ï¼Œå¦‚æœé‡‡ç”¨äº†ä¸»ä»æ¶æ„ï¼Œé‚£ä¹ˆå»ºè®®å¿…é¡»å¼€å¯ master node çš„æŒä¹…åŒ–ï¼Œä¸å»ºè®®ç”¨ slave node ä½œä¸º master node çš„æ•°æ®çƒ­å¤‡ï¼Œå› ä¸ºé‚£æ ·çš„è¯ï¼Œå¦‚æœä½ å…³æ‰ master çš„æŒä¹…åŒ–ï¼Œå¯èƒ½åœ¨ master å®•æœºé‡å¯çš„æ—¶å€™æ•°æ®æ˜¯ç©ºçš„ï¼Œç„¶åå¯èƒ½ä¸€ç»è¿‡å¤åˆ¶ï¼Œ slave node çš„æ•°æ®ä¹Ÿä¸¢äº†ã€‚</p><p>å¦å¤–ï¼Œmaster çš„å„ç§å¤‡ä»½æ–¹æ¡ˆï¼Œä¹Ÿéœ€è¦åšã€‚ä¸‡ä¸€æœ¬åœ°çš„æ‰€æœ‰æ–‡ä»¶ä¸¢å¤±äº†ï¼Œä»å¤‡ä»½ä¸­æŒ‘é€‰ä¸€ä»½ rdb å»æ¢å¤ masterï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿å¯åŠ¨çš„æ—¶å€™ï¼Œæ˜¯æœ‰æ•°æ®çš„ï¼Œå³ä½¿é‡‡ç”¨äº†åç»­è®²è§£çš„é«˜å¯ç”¨æœºåˆ¶ï¼Œslave node å¯ä»¥è‡ªåŠ¨æ¥ç®¡ master nodeï¼Œä½†ä¹Ÿå¯èƒ½ sentinel è¿˜æ²¡æ£€æµ‹åˆ° master failureï¼Œmaster node å°±è‡ªåŠ¨é‡å¯äº†ï¼Œè¿˜æ˜¯å¯èƒ½å¯¼è‡´ä¸Šé¢æ‰€æœ‰çš„ slave node æ•°æ®è¢«æ¸…ç©ºã€‚</p><p><strong>ä½œç”¨ï¼š</strong></p><ul><li><strong>æ•°æ®å†—ä½™</strong>ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</li><li><strong>æ•…éšœæ¢å¤</strong>ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li><li><strong>é«˜å¯ç”¨åŸºçŸ³</strong>ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€ã€‚</li></ul><p>ä¸»ä»åº“ä¹‹é—´é‡‡ç”¨çš„æ˜¯<strong>è¯»å†™åˆ†ç¦»</strong>çš„æ–¹å¼ã€‚</p><ul><li>è¯»æ“ä½œï¼šä¸»åº“ã€ä»åº“éƒ½å¯ä»¥æ¥æ”¶ï¼›</li><li>å†™æ“ä½œï¼šé¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œç„¶åï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303122214522.png"></p><ul><li><strong>å…¨é‡ï¼ˆåŒæ­¥ï¼‰å¤åˆ¶</strong>ï¼šæ¯”å¦‚ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶</li><li><strong>å¢é‡ï¼ˆåŒæ­¥ï¼‰å¤åˆ¶</strong>ï¼šåªä¼šæŠŠä¸»ä»åº“ç½‘ç»œæ–­è¿æœŸé—´ä¸»åº“æ”¶åˆ°çš„å‘½ä»¤ï¼ŒåŒæ­¥ç»™ä»åº“</li></ul><p><strong>Redis å…¨é‡å¤åˆ¶çš„ä¸‰ä¸ªé˜¶æ®µï¼ˆredis ä¸»ä»å¤åˆ¶çš„æ ¸å¿ƒåŸç†ï¼‰ï¼š</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303122215886.png"></p><p>å½“å¯åŠ¨ä¸€ä¸ª slave node çš„æ—¶å€™ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ª <code>PSYNC</code> å‘½ä»¤ç»™ master nodeã€‚</p><p>å¦‚æœè¿™æ˜¯ slave node åˆæ¬¡è¿æ¥åˆ° master nodeï¼Œé‚£ä¹ˆä¼šè§¦å‘ä¸€æ¬¡ <code>full resynchronization</code> å…¨é‡å¤åˆ¶ã€‚æ­¤æ—¶ master ä¼šå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œå¼€å§‹ç”Ÿæˆä¸€ä»½ <code>RDB</code> å¿«ç…§æ–‡ä»¶ï¼Œ</p><p>åŒæ—¶è¿˜ä¼šå°†ä»å®¢æˆ·ç«¯ client æ–°æ”¶åˆ°çš„æ‰€æœ‰å†™å‘½ä»¤ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚<code>RDB</code> æ–‡ä»¶ç”Ÿæˆå®Œæ¯•åï¼Œ master ä¼šå°†è¿™ä¸ª <code>RDB</code> å‘é€ç»™ slaveï¼Œslave ä¼šå…ˆå†™å…¥æœ¬åœ°ç£ç›˜ï¼Œç„¶åå†ä»æœ¬åœ°ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œ</p><p>æ¥ç€ master ä¼šå°†å†…å­˜ä¸­ç¼“å­˜çš„å†™å‘½ä»¤å‘é€åˆ° slaveï¼Œslave ä¹Ÿä¼šåŒæ­¥è¿™äº›æ•°æ®ã€‚</p><p>slave node å¦‚æœè·Ÿ master node æœ‰ç½‘ç»œæ•…éšœï¼Œæ–­å¼€äº†è¿æ¥ï¼Œä¼šè‡ªåŠ¨é‡è¿ï¼Œè¿æ¥ä¹‹å master node ä»…ä¼šå¤åˆ¶ç»™ slave éƒ¨åˆ†ç¼ºå°‘çš„æ•°æ®ã€‚</p><ul><li>æ‰€æœ‰çš„slaveèŠ‚ç‚¹æ•°æ®çš„å¤åˆ¶å’ŒåŒæ­¥éƒ½ç”±masterèŠ‚ç‚¹æ¥å¤„ç†ï¼Œä¼šç…§æˆmasterèŠ‚ç‚¹å‹åŠ›å¤ªå¤§ï¼Œä½¿ç”¨ä¸»ä»ä»ç»“æ„æ¥è§£å†³</li></ul><hr><p><strong>é˜¿Kç«™é•¿æç¤º</strong>ï¼›ä¸€ä¸‹3é˜¶æ®µçœ‹ä¸‹ç†è§£å°±å¥½ï¼Œé¢è¯•ä¸Šé¢è¿™äº›ç‚¹å›ç­”</p><p><strong>ç¬¬ä¸€é˜¶æ®µï¼šä¸»ä»åº“é—´å»ºç«‹è¿æ¥ã€åå•†åŒæ­¥çš„è¿‡ç¨‹</strong>ï¼Œä¸»è¦æ˜¯ä¸ºå…¨é‡å¤åˆ¶åšå‡†å¤‡ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œä»åº“å’Œä¸»åº“å»ºç«‹èµ·è¿æ¥ï¼Œå¹¶å‘Šè¯‰ä¸»åº“å³å°†è¿›è¡ŒåŒæ­¥ï¼Œä¸»åº“ç¡®è®¤å›å¤åï¼Œä¸»ä»åº“é—´å°±å¯ä»¥å¼€å§‹åŒæ­¥äº†ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œä»åº“ç»™ä¸»åº“å‘é€ psync å‘½ä»¤ï¼Œè¡¨ç¤ºè¦è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¸»åº“æ ¹æ®è¿™ä¸ªå‘½ä»¤çš„å‚æ•°æ¥å¯åŠ¨å¤åˆ¶ã€‚psync å‘½ä»¤åŒ…å«äº†ä¸»åº“çš„ runID å’Œå¤åˆ¶è¿›åº¦ offset ä¸¤ä¸ªå‚æ•°ã€‚runIDï¼Œæ˜¯æ¯ä¸ª Redis å®ä¾‹å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªéšæœº IDï¼Œç”¨æ¥å”¯ä¸€æ ‡è®°è¿™ä¸ªå®ä¾‹ã€‚å½“ä»åº“å’Œä¸»åº“ç¬¬ä¸€æ¬¡å¤åˆ¶æ—¶ï¼Œå› ä¸ºä¸çŸ¥é“ä¸»åº“çš„ runIDï¼Œæ‰€ä»¥å°† runID è®¾ä¸ºâ€œï¼Ÿâ€ã€‚offsetï¼Œæ­¤æ—¶è®¾ä¸º -1ï¼Œè¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶ã€‚ä¸»åº“æ”¶åˆ° psync å‘½ä»¤åï¼Œä¼šç”¨ FULLRESYNC å“åº”å‘½ä»¤å¸¦ä¸Šä¸¤ä¸ªå‚æ•°ï¼šä¸»åº“ runID å’Œä¸»åº“ç›®å‰çš„å¤åˆ¶è¿›åº¦ offsetï¼Œè¿”å›ç»™ä»åº“ã€‚ä»åº“æ”¶åˆ°å“åº”åï¼Œä¼šè®°å½•ä¸‹è¿™ä¸¤ä¸ªå‚æ•°ã€‚è¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼ŒFULLRESYNC å“åº”è¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶é‡‡ç”¨çš„å…¨é‡å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»åº“ä¼šæŠŠå½“å‰æ‰€æœ‰çš„æ•°æ®éƒ½å¤åˆ¶ç»™ä»åº“ã€‚</p><p><strong>ç¬¬äºŒé˜¶æ®µï¼šä¸»åº“å°†æ‰€æœ‰æ•°æ®åŒæ­¥ç»™ä»åº“</strong>ã€‚ä»åº“æ”¶åˆ°æ•°æ®åï¼Œåœ¨æœ¬åœ°å®Œæˆæ•°æ®åŠ è½½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¾èµ–äºå†…å­˜å¿«ç…§ç”Ÿæˆçš„ RDB æ–‡ä»¶ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œä¸»åº“æ‰§è¡Œ bgsave å‘½ä»¤ï¼Œç”Ÿæˆ RDB æ–‡ä»¶ï¼Œæ¥ç€å°†æ–‡ä»¶å‘ç»™ä»åº“ã€‚ä»åº“æ¥æ”¶åˆ° RDB æ–‡ä»¶åï¼Œä¼šå…ˆæ¸…ç©ºå½“å‰æ•°æ®åº“ï¼Œç„¶ååŠ è½½ RDB æ–‡ä»¶ã€‚è¿™æ˜¯å› ä¸ºä»åº“åœ¨é€šè¿‡ replicaof å‘½ä»¤å¼€å§‹å’Œä¸»åº“åŒæ­¥å‰ï¼Œå¯èƒ½ä¿å­˜äº†å…¶ä»–æ•°æ®ã€‚ä¸ºäº†é¿å…ä¹‹å‰æ•°æ®çš„å½±å“ï¼Œä»åº“éœ€è¦å…ˆæŠŠå½“å‰æ•°æ®åº“æ¸…ç©ºã€‚åœ¨ä¸»åº“å°†æ•°æ®åŒæ­¥ç»™ä»åº“çš„è¿‡ç¨‹ä¸­ï¼Œä¸»åº“ä¸ä¼šè¢«é˜»å¡ï¼Œä»ç„¶å¯ä»¥æ­£å¸¸æ¥æ”¶è¯·æ±‚ã€‚å¦åˆ™ï¼ŒRedis çš„æœåŠ¡å°±è¢«ä¸­æ–­äº†ã€‚ä½†æ˜¯ï¼Œè¿™äº›è¯·æ±‚ä¸­çš„å†™æ“ä½œå¹¶æ²¡æœ‰è®°å½•åˆ°åˆšåˆšç”Ÿæˆçš„ RDB æ–‡ä»¶ä¸­ã€‚ä¸ºäº†ä¿è¯ä¸»ä»åº“çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¸»åº“ä¼šåœ¨å†…å­˜ä¸­ç”¨ä¸“é—¨çš„ replication bufferï¼Œè®°å½• RDB æ–‡ä»¶ç”Ÿæˆåæ”¶åˆ°çš„æ‰€æœ‰å†™æ“ä½œã€‚</p><p><strong>ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼šä¸»åº“ä¼šæŠŠç¬¬äºŒé˜¶æ®µæ‰§è¡Œè¿‡ç¨‹ä¸­æ–°æ”¶åˆ°çš„å†™å‘½ä»¤ï¼Œå†å‘é€ç»™ä»åº“</strong>ã€‚å…·ä½“çš„æ“ä½œæ˜¯ï¼Œå½“ä¸»åº“å®Œæˆ RDB æ–‡ä»¶å‘é€åï¼Œå°±ä¼šæŠŠæ­¤æ—¶ replication buffer ä¸­çš„ä¿®æ”¹æ“ä½œå‘ç»™ä»åº“ï¼Œä»åº“å†é‡æ–°æ‰§è¡Œè¿™äº›æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸»ä»åº“å°±å®ç°åŒæ­¥äº†ã€‚</p><p><strong>Redis å¢é‡å¤åˆ¶çš„æµç¨‹ï¼š</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303122304116.png"></p><p><strong>Redis ä¸ºä»€ä¹ˆä¸»ä»å…¨é‡å¤åˆ¶ä½¿ç”¨RDBè€Œä¸ä½¿ç”¨AOFï¼Ÿ</strong></p><p>1ã€RDBæ–‡ä»¶å†…å®¹æ˜¯ç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆä¸åŒæ•°æ®ç±»å‹æ•°æ®åšäº†é’ˆå¯¹æ€§ä¼˜åŒ–ï¼‰ï¼Œæ–‡ä»¶å¾ˆå°ã€‚è€ŒAOFæ–‡ä»¶è®°å½•çš„æ˜¯æ¯ä¸€æ¬¡å†™æ“ä½œçš„å‘½ä»¤ï¼Œå†™æ“ä½œè¶Šå¤šæ–‡ä»¶ä¼šå˜å¾—å¾ˆå¤§ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬å¾ˆå¤šå¯¹åŒä¸€ä¸ªkeyçš„å¤šæ¬¡å†—ä½™æ“ä½œã€‚åœ¨ä¸»ä»å…¨é‡æ•°æ®åŒæ­¥æ—¶ï¼Œä¼ è¾“RDBæ–‡ä»¶å¯ä»¥å°½é‡é™ä½å¯¹ä¸»åº“æœºå™¨ç½‘ç»œå¸¦å®½çš„æ¶ˆè€—ï¼Œä»åº“åœ¨åŠ è½½RDBæ–‡ä»¶æ—¶ï¼Œä¸€æ˜¯æ–‡ä»¶å°ï¼Œè¯»å–æ•´ä¸ªæ–‡ä»¶çš„é€Ÿåº¦ä¼šå¾ˆå¿«ï¼ŒäºŒæ˜¯å› ä¸ºRDBæ–‡ä»¶å­˜å‚¨çš„éƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œä»åº“ç›´æ¥æŒ‰ç…§RDBåè®®è§£æè¿˜åŸæ•°æ®å³å¯ï¼Œé€Ÿåº¦ä¼šéå¸¸å¿«ï¼Œè€ŒAOFéœ€è¦ä¾æ¬¡é‡æ”¾æ¯ä¸ªå†™å‘½ä»¤ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šç»å†å†—é•¿çš„å¤„ç†é€»è¾‘ï¼Œæ¢å¤é€Ÿåº¦ç›¸æ¯”RDBä¼šæ…¢å¾—å¤šï¼Œæ‰€ä»¥ä½¿ç”¨RDBè¿›è¡Œä¸»ä»å…¨é‡å¤åˆ¶çš„æˆæœ¬æœ€ä½ã€‚</p><p>2ã€å‡è®¾è¦ä½¿ç”¨AOFåšå…¨é‡å¤åˆ¶ï¼Œæ„å‘³ç€å¿…é¡»æ‰“å¼€AOFåŠŸèƒ½ï¼Œæ‰“å¼€AOFå°±è¦é€‰æ‹©æ–‡ä»¶åˆ·ç›˜çš„ç­–ç•¥ï¼Œé€‰æ‹©ä¸å½“ä¼šä¸¥é‡å½±å“Redisæ€§èƒ½ã€‚è€ŒRDBåªæœ‰åœ¨éœ€è¦å®šæ—¶å¤‡ä»½å’Œä¸»ä»å…¨é‡å¤åˆ¶æ•°æ®æ—¶æ‰ä¼šè§¦å‘ç”Ÿæˆä¸€æ¬¡å¿«ç…§ã€‚è€Œåœ¨å¾ˆå¤šä¸¢å¤±æ•°æ®ä¸æ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ï¼Œå…¶å®æ˜¯ä¸éœ€è¦å¼€å¯AOFçš„ã€‚</p><p><strong>Redis ä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰ä»åº“çš„ä»åº“çš„è®¾è®¡ï¼Ÿ</strong></p><p>ä¸€æ¬¡å…¨é‡å¤åˆ¶ä¸­ï¼Œå¯¹äºä¸»åº“æ¥è¯´ï¼Œéœ€è¦å®Œæˆä¸¤ä¸ªè€—æ—¶çš„æ“ä½œï¼š<strong>ç”Ÿæˆ RDB æ–‡ä»¶å’Œä¼ è¾“ RDB æ–‡ä»¶</strong>ã€‚</p><p>å¦‚æœä»åº“æ•°é‡å¾ˆå¤šï¼Œè€Œä¸”éƒ½è¦å’Œä¸»åº“è¿›è¡Œå…¨é‡å¤åˆ¶çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä¸»åº“å¿™äº fork å­è¿›ç¨‹ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œè¿›è¡Œæ•°æ®å…¨é‡å¤åˆ¶ã€‚fork è¿™ä¸ªæ“ä½œä¼šé˜»å¡ä¸»çº¿ç¨‹å¤„ç†æ­£å¸¸è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ä¸»åº“å“åº”åº”ç”¨ç¨‹åºçš„è¯·æ±‚é€Ÿåº¦å˜æ…¢ã€‚æ­¤å¤–ï¼Œä¼ è¾“ RDB æ–‡ä»¶ä¹Ÿä¼šå ç”¨ä¸»åº“çš„ç½‘ç»œå¸¦å®½ï¼ŒåŒæ ·ä¼šç»™ä¸»åº“çš„èµ„æºä½¿ç”¨å¸¦æ¥å‹åŠ›ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰å¥½çš„è§£å†³æ–¹æ³•å¯ä»¥åˆ†æ‹…ä¸»åº“å‹åŠ›å‘¢ï¼Ÿ</p><p>å…¶å®æ˜¯æœ‰çš„ï¼Œè¿™å°±æ˜¯â€œä¸» - ä» - ä»â€æ¨¡å¼ã€‚</p><p>åœ¨åˆšæ‰ä»‹ç»çš„ä¸»ä»åº“æ¨¡å¼ä¸­ï¼Œæ‰€æœ‰çš„ä»åº“éƒ½æ˜¯å’Œä¸»åº“è¿æ¥ï¼Œæ‰€æœ‰çš„å…¨é‡å¤åˆ¶ä¹Ÿéƒ½æ˜¯å’Œä¸»åº“è¿›è¡Œçš„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡â€œä¸» - ä» - ä»â€æ¨¡å¼<strong>å°†ä¸»åº“ç”Ÿæˆ RDB å’Œä¼ è¾“ RDB çš„å‹åŠ›ï¼Œä»¥çº§è”çš„æ–¹å¼åˆ†æ•£åˆ°ä»åº“ä¸Š</strong>ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨éƒ¨ç½²ä¸»ä»é›†ç¾¤çš„æ—¶å€™ï¼Œå¯ä»¥æ‰‹åŠ¨é€‰æ‹©ä¸€ä¸ªä»åº“ï¼ˆæ¯”å¦‚é€‰æ‹©å†…å­˜èµ„æºé…ç½®è¾ƒé«˜çš„ä»åº“ï¼‰ï¼Œç”¨äºçº§è”å…¶ä»–çš„ä»åº“ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å†é€‰æ‹©ä¸€äº›ä»åº“ï¼ˆä¾‹å¦‚ä¸‰åˆ†ä¹‹ä¸€çš„ä»åº“ï¼‰ï¼Œåœ¨è¿™äº›ä»åº“ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè®©å®ƒä»¬å’Œåˆšæ‰æ‰€é€‰çš„ä»åº“ï¼Œå»ºç«‹èµ·ä¸»ä»å…³ç³»ã€‚</p><blockquote><p>replicaof æ‰€é€‰ä»åº“çš„IP 6379</p></blockquote><p>è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›ä»åº“å°±ä¼šçŸ¥é“ï¼Œåœ¨è¿›è¡ŒåŒæ­¥æ—¶ï¼Œä¸ç”¨å†å’Œä¸»åº“è¿›è¡Œäº¤äº’äº†ï¼Œåªè¦å’Œçº§è”çš„ä»åº“è¿›è¡Œå†™æ“ä½œåŒæ­¥å°±è¡Œäº†ï¼Œè¿™å°±å¯ä»¥å‡è½»ä¸»åº“ä¸Šçš„å‹åŠ›ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303122306011.png"></p><h4 id="2ã€å“¨å…µæ¨¡å¼"><a href="#2ã€å“¨å…µæ¨¡å¼" class="headerlink" title="2ã€å“¨å…µæ¨¡å¼"></a>2ã€å“¨å…µæ¨¡å¼</h4><p>å“¨å…µçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸»èŠ‚ç‚¹çš„è‡ªåŠ¨æ•…éšœè½¬ç§»ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªå…¸å‹çš„å“¨å…µé›†ç¾¤ç›‘æ§çš„é€»è¾‘å›¾ï¼šï¼ˆè‡ªåŠ¨åŒ–ä¸»ä»æ¶æ„ï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303122311211.png"></p><p><strong>å“¨å…µçš„ä½œç”¨ï¼š</strong></p><ul><li><strong>ç›‘æ§ï¼ˆMonitoringï¼‰</strong>ï¼šå“¨å…µä¼šä¸æ–­åœ°æ£€æŸ¥ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚</li><li><strong>è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆAutomatic failoverï¼‰</strong>ï¼šå½“ä¸»èŠ‚ç‚¹ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µä¼šå¼€å§‹è‡ªåŠ¨æ•…éšœè½¬ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆä¸»èŠ‚ç‚¹çš„å…¶ä¸­ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶è®©å…¶ä»–ä»èŠ‚ç‚¹æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚</li><li><strong>é…ç½®æä¾›è€…ï¼ˆConfiguration providerï¼‰</strong>ï¼šå®¢æˆ·ç«¯åœ¨åˆå§‹åŒ–æ—¶ï¼Œé€šè¿‡è¿æ¥å“¨å…µæ¥è·å¾—å½“å‰RedisæœåŠ¡çš„ä¸»èŠ‚ç‚¹åœ°å€ã€‚</li><li><strong>é€šçŸ¥ï¼ˆNotificationï¼‰</strong>ï¼šå“¨å…µå¯ä»¥å°†æ•…éšœè½¬ç§»çš„ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p>å…¶ä¸­ï¼Œç›‘æ§å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½ï¼Œä½¿å¾—å“¨å…µå¯ä»¥åŠæ—¶å‘ç°ä¸»èŠ‚ç‚¹æ•…éšœå¹¶å®Œæˆè½¬ç§»ï¼›è€Œé…ç½®æä¾›è€…å’Œé€šçŸ¥åŠŸèƒ½ï¼Œåˆ™éœ€è¦åœ¨ä¸å®¢æˆ·ç«¯çš„äº¤äº’ä¸­æ‰èƒ½ä½“ç°ã€‚</p><h4 id="3ã€é›†ç¾¤æ¨¡å¼"><a href="#3ã€é›†ç¾¤æ¨¡å¼" class="headerlink" title="3ã€é›†ç¾¤æ¨¡å¼"></a>3ã€é›†ç¾¤æ¨¡å¼</h4><p>redis é›†ç¾¤æ¨¡å¼çš„å·¥ä½œåŸç†èƒ½è¯´ä¸€ä¸‹ä¹ˆï¼Ÿåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œredis çš„ key æ˜¯å¦‚ä½•å¯»å€çš„ï¼Ÿåˆ†å¸ƒå¼å¯»å€éƒ½æœ‰å“ªäº›ç®—æ³•ï¼Ÿäº†è§£ä¸€è‡´æ€§ hash ç®—æ³•å—ï¼Ÿ</p><p><strong>ç®€ä»‹</strong></p><p>Redis Clusteræ˜¯ä¸€ç§æœåŠ¡ç«¯Shardingï¼ˆåˆ†ç‰‡ï¼‰æŠ€æœ¯ï¼Œ3.0ç‰ˆæœ¬å¼€å§‹æ­£å¼æä¾›ã€‚Redis Clusterå¹¶æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hashï¼Œè€Œæ˜¯é‡‡ç”¨slot(æ§½)çš„æ¦‚å¿µï¼Œä¸€å…±åˆ†æˆ16384ä¸ªæ§½ã€‚å°†è¯·æ±‚å‘é€åˆ°ä»»æ„èŠ‚ç‚¹ï¼Œæ¥æ”¶åˆ°è¯·æ±‚çš„èŠ‚ç‚¹ä¼šå°†æŸ¥è¯¢è¯·æ±‚å‘é€åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</p><p><strong>æ–¹æ¡ˆè¯´æ˜</strong></p><ol><li>é€šè¿‡å“ˆå¸Œçš„æ–¹å¼ï¼Œå°†æ•°æ®åˆ†ç‰‡ï¼Œæ¯ä¸ªèŠ‚ç‚¹å‡åˆ†å­˜å‚¨ä¸€å®šå“ˆå¸Œæ§½(å“ˆå¸Œå€¼)åŒºé—´çš„æ•°æ®ï¼Œé»˜è®¤åˆ†é…äº†16384 ä¸ªæ§½ä½</li><li>æ¯ä»½æ•°æ®åˆ†ç‰‡ä¼šå­˜å‚¨åœ¨å¤šä¸ªäº’ä¸ºä¸»ä»çš„å¤šèŠ‚ç‚¹ä¸Š</li><li>æ•°æ®å†™å…¥å…ˆå†™ä¸»èŠ‚ç‚¹ï¼Œå†åŒæ­¥åˆ°ä»èŠ‚ç‚¹(æ”¯æŒé…ç½®ä¸ºé˜»å¡åŒæ­¥)</li><li>åŒä¸€åˆ†ç‰‡å¤šä¸ªèŠ‚ç‚¹é—´çš„æ•°æ®ä¸ä¿æŒä¸€è‡´æ€§</li><li>è¯»å–æ•°æ®æ—¶ï¼Œå½“å®¢æˆ·ç«¯æ“ä½œçš„keyæ²¡æœ‰åˆ†é…åœ¨è¯¥èŠ‚ç‚¹ä¸Šæ—¶ï¼Œredisä¼šè¿”å›è½¬å‘æŒ‡ä»¤ï¼ŒæŒ‡å‘æ­£ç¡®çš„èŠ‚ç‚¹</li><li>æ‰©å®¹æ—¶æ—¶éœ€è¦éœ€è¦æŠŠæ—§èŠ‚ç‚¹çš„æ•°æ®è¿ç§»ä¸€éƒ¨åˆ†åˆ°æ–°èŠ‚ç‚¹</li></ol><p>åœ¨ redis cluster æ¶æ„ä¸‹ï¼Œæ¯ä¸ª redis è¦æ”¾å¼€ä¸¤ä¸ªç«¯å£å·ï¼Œæ¯”å¦‚ä¸€ä¸ªæ˜¯ 6379ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ åŠ 1w çš„ç«¯å£å·ï¼Œæ¯”å¦‚ 16379ã€‚</p><p>16379 ç«¯å£å·æ˜¯ç”¨æ¥è¿›è¡ŒèŠ‚ç‚¹é—´é€šä¿¡çš„ï¼Œä¹Ÿå°±æ˜¯ cluster bus çš„ä¸œè¥¿ï¼Œcluster bus çš„é€šä¿¡ï¼Œç”¨æ¥è¿›è¡Œæ•…éšœæ£€æµ‹ã€é…ç½®æ›´æ–°ã€æ•…éšœè½¬ç§»æˆæƒã€‚cluster bus ç”¨äº†å¦å¤–ä¸€ç§äºŒè¿›åˆ¶çš„åè®®ï¼Œ<code>gossip</code> åè®®ï¼Œç”¨äºèŠ‚ç‚¹é—´è¿›è¡Œé«˜æ•ˆçš„æ•°æ®äº¤æ¢ï¼Œå ç”¨æ›´å°‘çš„ç½‘ç»œå¸¦å®½å’Œå¤„ç†æ—¶é—´ã€‚</p><p><strong>åŸºæœ¬é€šä¿¡åŸç†ï¼ŒèŠ‚ç‚¹é—´çš„å†…éƒ¨é€šä¿¡æœºåˆ¶ï¼š</strong></p><blockquote><p>é›†ç¾¤å…ƒæ•°æ®çš„ç»´æŠ¤æœ‰ä¸¤ç§æ–¹å¼ï¼šé›†ä¸­å¼ã€Gossip åè®®ã€‚redis cluster èŠ‚ç‚¹é—´é‡‡ç”¨ gossip åè®®è¿›è¡Œé€šä¿¡ã€‚</p></blockquote><p><strong>åˆ†å¸ƒå¼å¯»å€ç®—æ³•:</strong></p><ul><li>hash ç®—æ³•ï¼ˆå¤§é‡ç¼“å­˜é‡å»ºï¼‰</li><li>ä¸€è‡´æ€§ hash ç®—æ³•ï¼ˆè‡ªåŠ¨ç¼“å­˜è¿ç§»ï¼‰+ è™šæ‹ŸèŠ‚ç‚¹ï¼ˆè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼‰</li><li>redis cluster çš„ hash slot ç®—æ³•</li></ul><p>ä¼˜ç‚¹</p><ul><li>æ— ä¸­å¿ƒæ¶æ„ï¼Œæ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œå¯¹ä¸šåŠ¡é€æ˜</li><li>å…·å¤‡Sentinelçš„ç›‘æ§å’Œè‡ªåŠ¨Failover(æ•…éšœè½¬ç§»)èƒ½åŠ›</li><li>å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯</li><li>é«˜æ€§èƒ½ï¼Œå®¢æˆ·ç«¯ç›´è¿redisæœåŠ¡ï¼Œå…å»äº†proxyä»£ç†çš„æŸè€—</li></ul><p>ç¼ºç‚¹</p><ul><li>è¿ç»´ä¹Ÿå¾ˆå¤æ‚ï¼Œæ•°æ®è¿ç§»éœ€è¦äººå·¥å¹²é¢„</li><li>åªèƒ½ä½¿ç”¨0å·æ•°æ®åº“</li><li>ä¸æ”¯æŒæ‰¹é‡æ“ä½œ(pipelineç®¡é“æ“ä½œ)</li><li>åˆ†å¸ƒå¼é€»è¾‘å’Œå­˜å‚¨æ¨¡å—è€¦åˆç­‰</li></ul><h4 id="3-1ã€åŸºäºå®¢æˆ·ç«¯åˆ†é…"><a href="#3-1ã€åŸºäºå®¢æˆ·ç«¯åˆ†é…" class="headerlink" title="3-1ã€åŸºäºå®¢æˆ·ç«¯åˆ†é…"></a>3-1ã€åŸºäºå®¢æˆ·ç«¯åˆ†é…</h4><p>Redis Shardingæ˜¯Redis Clusterå‡ºæ¥ä¹‹å‰ï¼Œä¸šç•Œæ™®éä½¿ç”¨çš„å¤šRediså®ä¾‹é›†ç¾¤æ–¹æ³•ã€‚å…¶ä¸»è¦æ€æƒ³æ˜¯é‡‡ç”¨å“ˆå¸Œç®—æ³•å°†Redisæ•°æ®çš„keyè¿›è¡Œæ•£åˆ—ï¼Œé€šè¿‡hashå‡½æ•°ï¼Œç‰¹å®šçš„keyä¼šæ˜ å°„åˆ°ç‰¹å®šçš„RedisèŠ‚ç‚¹ä¸Šã€‚Java rediså®¢æˆ·ç«¯é©±åŠ¨jedisï¼Œæ”¯æŒRedis ShardingåŠŸèƒ½ï¼Œå³ShardedJedisä»¥åŠç»“åˆç¼“å­˜æ± çš„ShardedJedisPool</p><p>ä¼˜ç‚¹</p><ul><li>ä¼˜åŠ¿åœ¨äºéå¸¸ç®€å•ï¼ŒæœåŠ¡ç«¯çš„Rediså®ä¾‹å½¼æ­¤ç‹¬ç«‹ï¼Œç›¸äº’æ— å…³è”ï¼Œæ¯ä¸ªRediså®ä¾‹åƒå•æœåŠ¡å™¨ä¸€æ ·è¿è¡Œï¼Œéå¸¸å®¹æ˜“çº¿æ€§æ‰©å±•ï¼Œç³»ç»Ÿçš„çµæ´»æ€§å¾ˆå¼º</li></ul><p>ç¼ºç‚¹</p><ul><li>ç”±äºshardingå¤„ç†æ”¾åˆ°å®¢æˆ·ç«¯ï¼Œè§„æ¨¡è¿›ä¸€æ­¥æ‰©å¤§æ—¶ç»™è¿ç»´å¸¦æ¥æŒ‘æˆ˜ã€‚</li><li>å®¢æˆ·ç«¯shardingä¸æ”¯æŒåŠ¨æ€å¢åˆ èŠ‚ç‚¹ã€‚æœåŠ¡ç«¯Rediså®ä¾‹ç¾¤æ‹“æ‰‘ç»“æ„æœ‰å˜åŒ–æ—¶ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦æ›´æ–°è°ƒæ•´ã€‚è¿æ¥ä¸èƒ½å…±äº«ï¼Œå½“åº”ç”¨è§„æ¨¡å¢å¤§æ—¶ï¼Œèµ„æºæµªè´¹åˆ¶çº¦ä¼˜åŒ–</li></ul><h4 id="3-2ã€åŸºäºä»£ç†æœåŠ¡å™¨åˆ†ç‰‡"><a href="#3-2ã€åŸºäºä»£ç†æœåŠ¡å™¨åˆ†ç‰‡" class="headerlink" title="3-2ã€åŸºäºä»£ç†æœåŠ¡å™¨åˆ†ç‰‡"></a>3-2ã€åŸºäºä»£ç†æœåŠ¡å™¨åˆ†ç‰‡</h4><p>å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°ä¸€ä¸ªä»£ç†ç»„ä»¶ï¼Œä»£ç†è§£æå®¢æˆ·ç«¯çš„æ•°æ®ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘è‡³æ­£ç¡®çš„èŠ‚ç‚¹ï¼Œæœ€åå°†ç»“æœå›å¤ç»™å®¢æˆ·ç«¯</p><p><strong>ç‰¹å¾</strong></p><ul><li>é€æ˜æ¥å…¥ï¼Œä¸šåŠ¡ç¨‹åºä¸ç”¨å…³å¿ƒåç«¯Rediså®ä¾‹ï¼Œåˆ‡æ¢æˆæœ¬ä½</li><li>Proxy çš„é€»è¾‘å’Œå­˜å‚¨çš„é€»è¾‘æ˜¯éš”ç¦»çš„</li><li>ä»£ç†å±‚å¤šäº†ä¸€æ¬¡è½¬å‘ï¼Œæ€§èƒ½æœ‰æ‰€æŸè€—</li></ul><p><strong>ä¸šç•Œå¼€æºæ–¹æ¡ˆ</strong></p><ul><li>Twtterå¼€æºçš„Twemproxy</li><li>è±Œè±†èšå¼€æºçš„Codis</li></ul><h4 id="4ã€ç”Ÿäº§ç¯å¢ƒä¸­çš„-redis-æ˜¯æ€ä¹ˆéƒ¨ç½²çš„"><a href="#4ã€ç”Ÿäº§ç¯å¢ƒä¸­çš„-redis-æ˜¯æ€ä¹ˆéƒ¨ç½²çš„" class="headerlink" title="4ã€ç”Ÿäº§ç¯å¢ƒä¸­çš„ redis æ˜¯æ€ä¹ˆéƒ¨ç½²çš„"></a>4ã€ç”Ÿäº§ç¯å¢ƒä¸­çš„ redis æ˜¯æ€ä¹ˆéƒ¨ç½²çš„</h4><p>redis clusterï¼Œ10 å°æœºå™¨ï¼Œ5 å°æœºå™¨éƒ¨ç½²äº† redis ä¸»å®ä¾‹ï¼Œå¦å¤– 5 å°æœºå™¨éƒ¨ç½²äº† redis çš„ä»å®ä¾‹ï¼Œæ¯ä¸ªä¸»å®ä¾‹æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œ5 ä¸ªèŠ‚ç‚¹å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„è¯»å†™é«˜å³°qpså¯èƒ½å¯ä»¥è¾¾åˆ°æ¯ç§’ 5 ä¸‡ï¼Œ5 å°æœºå™¨æœ€å¤šæ˜¯ 25 ä¸‡è¯»å†™è¯·æ±‚/sã€‚</p><p>æœºå™¨æ˜¯ä»€ä¹ˆé…ç½®ï¼Ÿ32G å†…å­˜+ 8 æ ¸ CPU + 1T ç£ç›˜ï¼Œä½†æ˜¯åˆ†é…ç»™ redis è¿›ç¨‹çš„æ˜¯10gå†…å­˜ï¼Œä¸€èˆ¬çº¿ä¸Šç”Ÿäº§ç¯å¢ƒï¼Œredis çš„å†…å­˜å°½é‡ä¸è¦è¶…è¿‡ 10gï¼Œè¶…è¿‡ 10g å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚</p><p>5 å°æœºå™¨å¯¹å¤–æä¾›è¯»å†™ï¼Œä¸€å…±æœ‰ 50g å†…å­˜ã€‚</p><p>å› ä¸ºæ¯ä¸ªä¸»å®ä¾‹éƒ½æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œæ‰€ä»¥æ˜¯é«˜å¯ç”¨çš„ï¼Œä»»ä½•ä¸€ä¸ªä¸»å®ä¾‹å®•æœºï¼Œéƒ½ä¼šè‡ªåŠ¨æ•…éšœè¿ç§»ï¼Œredis ä»å®ä¾‹ä¼šè‡ªåŠ¨å˜æˆä¸»å®ä¾‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ã€‚</p><p>ä½ å¾€å†…å­˜é‡Œå†™çš„æ˜¯ä»€ä¹ˆæ•°æ®ï¼Ÿæ¯æ¡æ•°æ®çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿå•†å“æ•°æ®ï¼Œæ¯æ¡æ•°æ®æ˜¯ 10kbã€‚100 æ¡æ•°æ®æ˜¯ 1mbï¼Œ10 ä¸‡æ¡æ•°æ®æ˜¯ 1gã€‚å¸¸é©»å†…å­˜çš„æ˜¯ 200 ä¸‡æ¡å•†å“æ•°æ®ï¼Œå ç”¨å†…å­˜æ˜¯ 20gï¼Œä»…ä»…ä¸åˆ°æ€»å†…å­˜çš„ 50%ã€‚ç›®å‰é«˜å³°æœŸæ¯ç§’å°±æ˜¯ 3500 å·¦å³çš„è¯·æ±‚é‡ã€‚</p><p>å…¶å®å¤§å‹çš„å…¬å¸ï¼Œä¼šæœ‰åŸºç¡€æ¶æ„çš„ team è´Ÿè´£ç¼“å­˜é›†ç¾¤çš„è¿ç»´ã€‚</p><h4 id="5ã€è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µ"><a href="#5ã€è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µ" class="headerlink" title="5ã€è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µ"></a>5ã€è¯´è¯´Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µ</h4><p>Redisé›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hash,è€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µï¼ŒRedisé›†ç¾¤æœ‰16384ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªkeyé€šè¿‡CRC16æ ¡éªŒåå¯¹16384å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ï¼Œé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½ã€‚</p><h4 id="6ã€Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#6ã€Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="6ã€Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>6ã€Redisé›†ç¾¤ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h4><p>Rediså¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œè¿™æ„å‘³è¿™åœ¨å®é™…ä¸­é›†ç¾¤åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹å¯èƒ½ä¼šä¸¢å¤±å†™æ“ä½œã€‚</p><h4 id="7ã€ä¸‰ç§é›†ç¾¤æ¨¡å¼æ€»ç»“"><a href="#7ã€ä¸‰ç§é›†ç¾¤æ¨¡å¼æ€»ç»“" class="headerlink" title="7ã€ä¸‰ç§é›†ç¾¤æ¨¡å¼æ€»ç»“"></a>7ã€ä¸‰ç§é›†ç¾¤æ¨¡å¼æ€»ç»“</h4><p><strong>è¯¦æƒ…çœ‹ç«™é•¿ç®€ä¹¦ï¼š</strong></p><p>ä¸»ä»ï¼Œå“¨å…µï¼š<a href="https://www.jianshu.com/p/f6f386a62b7d">https://www.jianshu.com/p/f6f386a62b7d</a></p><p>é›†ç¾¤ï¼š<a href="https://www.jianshu.com/p/d875a53b0167">https://www.jianshu.com/p/d875a53b0167</a></p><p>å› ä¸º Redis é›†ç¾¤æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¸»ä»å¤åˆ¶ï¼Œä¸€ç§æ˜¯ Redis Clusterï¼Œæˆ‘ä¸æ¸…æ¥šæ‚¨ é—®çš„æ˜¯å“ªä¸€ç§ã€‚ æŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œæˆ‘è®¤ä¸ºæ‚¨å¯èƒ½è¯´çš„æ˜¯ Redis å“¨å…µé›†ç¾¤å’Œ Redis Cluster çš„åŒºåˆ«ã€‚ å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥ä» 3 ä¸ªæ–¹é¢æ¥å›ç­” ï¼ŒRedis å“¨å…µé›†ç¾¤æ˜¯åŸºäºä¸»ä»å¤åˆ¶æ¥å®ç°çš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å®ç°è¯»å†™åˆ†ç¦»ï¼Œåˆ†æ‹… Redis è¯»æ“ä½œçš„å‹åŠ› ï¼Œè€Œ Redis Cluster é›†ç¾¤çš„ Slave èŠ‚ç‚¹åªæ˜¯å®ç°å†·å¤‡æœºåˆ¶ï¼Œå®ƒåªæœ‰åœ¨ Master å®•æœº ä¹‹åæ‰ä¼šå·¥ä½œã€‚ </p><p>Redis å“¨å…µé›†ç¾¤æ— æ³•åœ¨çº¿æ‰©å®¹ï¼Œæ‰€ä»¥å®ƒçš„å¹¶å‘å‹åŠ›å—é™äºå•ä¸ªæœåŠ¡å™¨çš„èµ„æºé…ç½®ã€‚ Redis Cluster æä¾›äº†åŸºäº Slot æ§½çš„æ•°æ®åˆ†ç‰‡æœºåˆ¶ï¼Œå¯ä»¥å®ç°åœ¨çº¿æ‰©å®¹æå‡å†™æ•° æ®çš„æ€§èƒ½ä»é›†ç¾¤æ¶æ„ä¸Šæ¥è¯´ï¼ŒRedis å“¨å…µé›†ç¾¤æ˜¯ä¸€ä¸»å¤šä»ï¼Œ è€Œ Redis Cluster æ˜¯å¤šä¸»å¤šä»</p><h4 id="â€”-åˆ†åŒºâ€”â€“"><a href="#â€”-åˆ†åŒºâ€”â€“" class="headerlink" title="â€”-åˆ†åŒºâ€”â€“"></a>â€”-åˆ†åŒºâ€”â€“</h4><h4 id="1ã€Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡"><a href="#1ã€Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡" class="headerlink" title="1ã€Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡"></a>1ã€Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚ä½•æé«˜å¤šæ ¸CPUçš„åˆ©ç”¨ç‡</h4><p>å¯ä»¥åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨éƒ¨ç½²å¤šä¸ªRedisçš„å®ä¾‹ï¼Œå¹¶æŠŠä»–ä»¬å½“ä½œä¸åŒçš„æœåŠ¡å™¨æ¥ä½¿ç”¨ï¼Œåœ¨æŸäº›æ—¶å€™ï¼Œæ— è®ºå¦‚ä½•ä¸€ä¸ªæœåŠ¡å™¨æ˜¯ä¸å¤Ÿçš„ï¼Œ æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å¤šä¸ªCPUï¼Œä½ å¯ä»¥è€ƒè™‘ä¸€ä¸‹åˆ†ç‰‡ï¼ˆshardï¼‰</p><h4 id="2ã€ä¸ºä»€ä¹ˆè¦åšRedisåˆ†åŒº"><a href="#2ã€ä¸ºä»€ä¹ˆè¦åšRedisåˆ†åŒº" class="headerlink" title="2ã€ä¸ºä»€ä¹ˆè¦åšRedisåˆ†åŒº"></a>2ã€ä¸ºä»€ä¹ˆè¦åšRedisåˆ†åŒº</h4><p>åˆ†åŒºå¯ä»¥è®©Redisç®¡ç†æ›´å¤§çš„å†…å­˜ï¼ŒRediså°†å¯ä»¥ä½¿ç”¨æ‰€æœ‰æœºå™¨çš„å†…å­˜ã€‚å¦‚æœæ²¡æœ‰åˆ†åŒºï¼Œä½ æœ€å¤šåªèƒ½ä½¿ç”¨ä¸€å°æœºå™¨çš„å†…å­˜ã€‚åˆ†åŒºä½¿Redisçš„è®¡ç®—èƒ½åŠ›é€šè¿‡ç®€å•åœ°å¢åŠ è®¡ç®—æœºå¾—åˆ°æˆå€æå‡ï¼ŒRedisçš„ç½‘ç»œå¸¦å®½ä¹Ÿä¼šéšç€è®¡ç®—æœºå’Œç½‘å¡çš„å¢åŠ è€Œæˆå€å¢é•¿ã€‚</p><h4 id="3ã€ä½ çŸ¥é“æœ‰å“ªäº›Redisåˆ†åŒºå®ç°æ–¹æ¡ˆ"><a href="#3ã€ä½ çŸ¥é“æœ‰å“ªäº›Redisåˆ†åŒºå®ç°æ–¹æ¡ˆ" class="headerlink" title="3ã€ä½ çŸ¥é“æœ‰å“ªäº›Redisåˆ†åŒºå®ç°æ–¹æ¡ˆ"></a>3ã€ä½ çŸ¥é“æœ‰å“ªäº›Redisåˆ†åŒºå®ç°æ–¹æ¡ˆ</h4><ul><li>å®¢æˆ·ç«¯åˆ†åŒºå°±æ˜¯åœ¨å®¢æˆ·ç«¯å°±å·²ç»å†³å®šæ•°æ®ä¼šè¢«å­˜å‚¨åˆ°å“ªä¸ªredisèŠ‚ç‚¹æˆ–è€…ä»å“ªä¸ªredisèŠ‚ç‚¹è¯»å–ã€‚å¤§å¤šæ•°å®¢æˆ·ç«¯å·²ç»å®ç°äº†å®¢æˆ·ç«¯åˆ†åŒºã€‚</li><li>ä»£ç†åˆ†åŒº æ„å‘³ç€å®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€ç»™ä»£ç†ï¼Œç„¶åä»£ç†å†³å®šå»å“ªä¸ªèŠ‚ç‚¹å†™æ•°æ®æˆ–è€…è¯»æ•°æ®ã€‚ä»£ç†æ ¹æ®åˆ†åŒºè§„åˆ™å†³å®šè¯·æ±‚å“ªäº›Rediså®ä¾‹ï¼Œç„¶åæ ¹æ®Redisçš„å“åº”ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚rediså’Œmemcachedçš„ä¸€ç§ä»£ç†å®ç°å°±æ˜¯Twemproxy</li><li>æŸ¥è¯¢è·¯ç”±(Query routing) çš„æ„æ€æ˜¯å®¢æˆ·ç«¯éšæœºåœ°è¯·æ±‚ä»»æ„ä¸€ä¸ªrediså®ä¾‹ï¼Œç„¶åç”±Rediså°†è¯·æ±‚è½¬å‘ç»™æ­£ç¡®çš„RedisèŠ‚ç‚¹ã€‚Redis Clusterå®ç°äº†ä¸€ç§æ··åˆå½¢å¼çš„æŸ¥è¯¢è·¯ç”±ï¼Œä½†å¹¶ä¸æ˜¯ç›´æ¥å°†è¯·æ±‚ä»ä¸€ä¸ªredisèŠ‚ç‚¹è½¬å‘åˆ°å¦ä¸€ä¸ªredisèŠ‚ç‚¹ï¼Œè€Œæ˜¯åœ¨å®¢æˆ·ç«¯çš„å¸®åŠ©ä¸‹ç›´æ¥redirectedåˆ°æ­£ç¡®çš„redisèŠ‚ç‚¹ã€‚</li></ul><h4 id="4ã€Redisåˆ†åŒºæœ‰ä»€ä¹ˆç¼ºç‚¹"><a href="#4ã€Redisåˆ†åŒºæœ‰ä»€ä¹ˆç¼ºç‚¹" class="headerlink" title="4ã€Redisåˆ†åŒºæœ‰ä»€ä¹ˆç¼ºç‚¹"></a>4ã€Redisåˆ†åŒºæœ‰ä»€ä¹ˆç¼ºç‚¹</h4><ul><li>æ¶‰åŠå¤šä¸ªkeyçš„æ“ä½œé€šå¸¸ä¸ä¼šè¢«æ”¯æŒã€‚ä¾‹å¦‚ä½ ä¸èƒ½å¯¹ä¸¤ä¸ªé›†åˆæ±‚äº¤é›†ï¼Œå› ä¸ºä»–ä»¬å¯èƒ½è¢«å­˜å‚¨åˆ°ä¸åŒçš„Rediså®ä¾‹ï¼ˆå®é™…ä¸Šè¿™ç§æƒ…å†µä¹Ÿæœ‰åŠæ³•ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨äº¤é›†æŒ‡ä»¤ï¼‰ã€‚</li><li>åŒæ—¶æ“ä½œå¤šä¸ªkey,åˆ™ä¸èƒ½ä½¿ç”¨Redisäº‹åŠ¡.</li><li>åˆ†åŒºä½¿ç”¨çš„ç²’åº¦æ˜¯keyï¼Œä¸èƒ½ä½¿ç”¨ä¸€ä¸ªéå¸¸é•¿çš„æ’åºkeyå­˜å‚¨ä¸€ä¸ªæ•°æ®é›†ï¼ˆThe partitioning granularity is the key, so it is not possible to shard a dataset with a single huge key like a very big sorted setï¼‰</li><li>å½“ä½¿ç”¨åˆ†åŒºçš„æ—¶å€™ï¼Œæ•°æ®å¤„ç†ä¼šéå¸¸å¤æ‚ï¼Œä¾‹å¦‚ä¸ºäº†å¤‡ä»½ä½ å¿…é¡»ä»ä¸åŒçš„Rediså®ä¾‹å’Œä¸»æœºåŒæ—¶æ”¶é›†RDB / AOFæ–‡ä»¶ã€‚</li><li>åˆ†åŒºæ—¶åŠ¨æ€æ‰©å®¹æˆ–ç¼©å®¹å¯èƒ½éå¸¸å¤æ‚ã€‚Redisé›†ç¾¤åœ¨è¿è¡Œæ—¶å¢åŠ æˆ–è€…åˆ é™¤RedisèŠ‚ç‚¹ï¼Œèƒ½åšåˆ°æœ€å¤§ç¨‹åº¦å¯¹ç”¨æˆ·é€æ˜åœ°æ•°æ®å†å¹³è¡¡ï¼Œä½†å…¶ä»–ä¸€äº›å®¢æˆ·ç«¯åˆ†åŒºæˆ–è€…ä»£ç†åˆ†åŒºæ–¹æ³•åˆ™ä¸æ”¯æŒè¿™ç§ç‰¹æ€§ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ç§é¢„åˆ†ç‰‡çš„æŠ€æœ¯ä¹Ÿå¯ä»¥è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li></ul><h4 id="â€”â€“åˆ†å¸ƒå¼é—®é¢˜â€”â€“"><a href="#â€”â€“åˆ†å¸ƒå¼é—®é¢˜â€”â€“" class="headerlink" title="â€”â€“åˆ†å¸ƒå¼é—®é¢˜â€”â€“"></a>â€”â€“åˆ†å¸ƒå¼é—®é¢˜â€”â€“</h4><h4 id="1ã€Rediså®ç°åˆ†å¸ƒå¼é”ï¼ˆç«™é•¿çš„ç®€ä¹¦ï¼‰"><a href="#1ã€Rediså®ç°åˆ†å¸ƒå¼é”ï¼ˆç«™é•¿çš„ç®€ä¹¦ï¼‰" class="headerlink" title="1ã€Rediså®ç°åˆ†å¸ƒå¼é”ï¼ˆç«™é•¿çš„ç®€ä¹¦ï¼‰"></a>1ã€Rediså®ç°åˆ†å¸ƒå¼é”ï¼ˆç«™é•¿çš„ç®€ä¹¦ï¼‰</h4><p><a href="https://www.jianshu.com/p/2e995df9ccbc">https://www.jianshu.com/p/2e995df9ccbc</a></p><p>åˆ†å¸ƒå¼é”ä¸»æµçš„å®ç°æ–¹æ¡ˆï¼š</p><ol><li>åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é”</li><li>åŸºäºç¼“å­˜ï¼ˆRedisç­‰ï¼‰</li><li>åŸºäºZookeeper<br>æ¯ä¸€ç§åˆ†å¸ƒå¼é”è§£å†³æ–¹æ¡ˆéƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š</li><li>æ€§èƒ½ï¼šredisæœ€é«˜</li><li>å¯é æ€§ï¼šzookeeperæœ€é«˜<br>è¿™é‡Œï¼Œæˆ‘ä»¬å°±åŸºäºrediså®ç°åˆ†å¸ƒå¼é”ã€‚</li></ol><p>ï¼ˆ1ï¼‰redis:å‘½ä»¤ï¼š<br>setnx è®¾ç½®é”ï¼šsetnx key val  </p><p>è®¾ç½®æˆåŠŸï¼Œè¿”å› 1 ã€‚è®¾ç½®å¤±è´¥ï¼Œè¿”å› 0 ï¼›ä½¿ç”¨SETNXå‘½ä»¤è·å–é”ï¼Œè‹¥è¿”å›0ï¼ˆkeyå·²å­˜åœ¨ï¼Œé”å·²å­˜åœ¨ï¼‰åˆ™è·å–å¤±è´¥ï¼Œåä¹‹è·å–æˆåŠŸ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx username vv1<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx username vv2<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx username vv1<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx username vv1<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>delè§£é™¤é”</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> del username<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx username vv2<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx username vv2<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx username vv2<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>expireè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ŒttlæŸ¥çœ‹è¿‡æœŸæ—¶é—´</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">127.0.0.1<span class="token punctuation">:</span>6379&gt; expire username 19<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1127.0.0.1<span class="token punctuation">:</span>6379&gt; ttl username<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 14127.0.0.1<span class="token punctuation">:</span>6379&gt; ttl username<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 12127.0.0.1<span class="token punctuation">:</span>6379&gt; ttl username<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 11127.0.0.1<span class="token punctuation">:</span>6379&gt; ttl username<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 11127.0.0.1<span class="token punctuation">:</span>6379&gt; ttl username<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 9 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ttl ä¸º -2 å·²ç»è¿‡æœŸï¼Œ-1 æ˜¯æ°¸ä¹…ç”Ÿæ•ˆ</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">127.0.0.1<span class="token punctuation">:</span>6379&gt; ttl username<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -2127.0.0.1<span class="token punctuation">:</span>6379&gt; setnx username vv2<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1127.0.0.1<span class="token punctuation">:</span>6379&gt; setnx username vv2<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0127.0.0.1<span class="token punctuation">:</span>6379&gt; setnx username vv2<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>â˜… æ—¢ä¸Šé”åˆè®¾ç½®è¿‡æœŸæ—¶é—´( nx ä¸Šé”ï¼Œex è¿‡æœŸæ—¶é—´)</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">127.0.0.1<span class="token punctuation">:</span>6379&gt; set age 10 nx ex 11OK127.0.0.1<span class="token punctuation">:</span>6379&gt; ttl age<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 7127.0.0.1<span class="token punctuation">:</span>6379&gt; ttl age<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨SETNXå®ŒæˆåŒæ­¥é”çš„æµç¨‹åŠäº‹é¡¹å¦‚ä¸‹ï¼š</p><p>ä½¿ç”¨SETNXå‘½ä»¤è·å–é”ï¼Œè‹¥è¿”å›0ï¼ˆkeyå·²å­˜åœ¨ï¼Œé”å·²å­˜åœ¨ï¼‰åˆ™è·å–å¤±è´¥ï¼Œåä¹‹è·å–æˆåŠŸ</p><p>ä¸ºäº†é˜²æ­¢è·å–é”åç¨‹åºå‡ºç°å¼‚å¸¸ï¼Œå¯¼è‡´å…¶ä»–çº¿ç¨‹/è¿›ç¨‹è°ƒç”¨SETNXå‘½ä»¤æ€»æ˜¯è¿”å›0è€Œè¿›å…¥æ­»é”çŠ¶æ€ï¼Œéœ€è¦ä¸ºè¯¥keyè®¾ç½®ä¸€ä¸ªâ€œåˆç†â€çš„è¿‡æœŸæ—¶é—´</p><p>é‡Šæ”¾é”ï¼Œä½¿ç”¨DELå‘½ä»¤å°†é”æ•°æ®åˆ é™¤</p><p><strong>å…¶å®æœ€ä½³æ–¹æ¡ˆæ˜¯ï¼šRedissionæ¡†æ¶å®ç°åˆ†å¸ƒå¼é”</strong></p><h4 id="2ã€å¦‚ä½•è§£å†³-Redis-çš„å¹¶å‘ç«äº‰-Key-é—®é¢˜"><a href="#2ã€å¦‚ä½•è§£å†³-Redis-çš„å¹¶å‘ç«äº‰-Key-é—®é¢˜" class="headerlink" title="2ã€å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜"></a>2ã€å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜</h4><p>æ‰€è°“ Redis çš„å¹¶å‘ç«äº‰ Key çš„é—®é¢˜ä¹Ÿå°±æ˜¯å¤šä¸ªç³»ç»ŸåŒæ—¶å¯¹ä¸€ä¸ª key è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯æœ€åæ‰§è¡Œçš„é¡ºåºå’Œæˆ‘ä»¬æœŸæœ›çš„é¡ºåºä¸åŒï¼Œè¿™æ ·ä¹Ÿå°±å¯¼è‡´äº†ç»“æœçš„ä¸åŒï¼</p><p>æ¨èä¸€ç§æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼é”ï¼ˆzookeeper å’Œ redis éƒ½å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ï¼‰ã€‚ï¼ˆå¦‚æœä¸å­˜åœ¨ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜ï¼Œä¸è¦ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œè¿™æ ·ä¼šå½±å“æ€§èƒ½ï¼‰</p><p>åŸºäºzookeeperä¸´æ—¶æœ‰åºèŠ‚ç‚¹å¯ä»¥å®ç°çš„åˆ†å¸ƒå¼é”ã€‚å¤§è‡´æ€æƒ³ä¸ºï¼šæ¯ä¸ªå®¢æˆ·ç«¯å¯¹æŸä¸ªæ–¹æ³•åŠ é”æ—¶ï¼Œåœ¨zookeeperä¸Šçš„ä¸è¯¥æ–¹æ³•å¯¹åº”çš„æŒ‡å®šèŠ‚ç‚¹çš„ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç¬æ—¶æœ‰åºèŠ‚ç‚¹ã€‚åˆ¤æ–­æ˜¯å¦è·å–é”çš„æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€è¦åˆ¤æ–­æœ‰åºèŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ä¸€ä¸ªã€‚å½“é‡Šæ”¾é”çš„æ—¶å€™ï¼Œåªéœ€å°†è¿™ä¸ªç¬æ—¶èŠ‚ç‚¹åˆ é™¤å³å¯ã€‚åŒæ—¶ï¼Œå…¶å¯ä»¥é¿å…æœåŠ¡å®•æœºå¯¼è‡´çš„é”æ— æ³•é‡Šæ”¾ï¼Œè€Œäº§ç”Ÿçš„æ­»é”é—®é¢˜ã€‚å®Œæˆä¸šåŠ¡æµç¨‹åï¼Œåˆ é™¤å¯¹åº”çš„å­èŠ‚ç‚¹é‡Šæ”¾é”ã€‚</p><p>åœ¨å®è·µä¸­ï¼Œå½“ç„¶æ˜¯ä»ä»¥å¯é æ€§ä¸ºä¸»ã€‚æ‰€ä»¥é¦–æ¨Zookeeperã€‚</p><h4 id="3ã€åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#3ã€åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="3ã€åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>3ã€åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h4><p>æ—¢ç„¶Redisæ˜¯å¦‚æ­¤çš„è½»é‡ï¼ˆå•å®ä¾‹åªä½¿ç”¨1Må†…å­˜ï¼‰ï¼Œä¸ºé˜²æ­¢ä»¥åçš„æ‰©å®¹ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯ä¸€å¼€å§‹å°±å¯åŠ¨è¾ƒå¤šå®ä¾‹ã€‚å³ä¾¿ä½ åªæœ‰ä¸€å°æœåŠ¡å™¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±è®©Redisä»¥åˆ†å¸ƒå¼çš„æ–¹å¼è¿è¡Œï¼Œä½¿ç”¨åˆ†åŒºï¼Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ªå®ä¾‹ã€‚</p><p>ä¸€å¼€å§‹å°±å¤šè®¾ç½®å‡ ä¸ªRediså®ä¾‹ï¼Œä¾‹å¦‚32æˆ–è€…64ä¸ªå®ä¾‹ï¼Œå¯¹å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´è¿™æ“ä½œèµ·æ¥å¯èƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯ä»é•¿ä¹…æ¥çœ‹åšè¿™ç‚¹ç‰ºç‰²æ˜¯å€¼å¾—çš„ã€‚</p><p>è¿™æ ·çš„è¯ï¼Œå½“ä½ çš„æ•°æ®ä¸æ–­å¢é•¿ï¼Œéœ€è¦æ›´å¤šçš„RedisæœåŠ¡å™¨æ—¶ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯ä»…ä»…å°†Rediså®ä¾‹ä»ä¸€å°æœåŠ¡è¿ç§»åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨è€Œå·²ï¼ˆè€Œä¸ç”¨è€ƒè™‘é‡æ–°åˆ†åŒºçš„é—®é¢˜ï¼‰ã€‚ä¸€æ—¦ä½ æ·»åŠ äº†å¦ä¸€å°æœåŠ¡å™¨ï¼Œä½ éœ€è¦å°†ä½ ä¸€åŠçš„Rediså®ä¾‹ä»ç¬¬ä¸€å°æœºå™¨è¿ç§»åˆ°ç¬¬äºŒå°æœºå™¨ã€‚</p><h4 id="4ã€ä»€ä¹ˆæ˜¯-RedLock"><a href="#4ã€ä»€ä¹ˆæ˜¯-RedLock" class="headerlink" title="4ã€ä»€ä¹ˆæ˜¯ RedLock"></a>4ã€ä»€ä¹ˆæ˜¯ RedLock</h4><p>Redis å®˜æ–¹ç«™æå‡ºäº†ä¸€ç§æƒå¨çš„åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”çš„æ–¹å¼åå« <em>Redlock</em>ï¼Œæ­¤ç§æ–¹å¼æ¯”åŸå…ˆçš„å•èŠ‚ç‚¹çš„æ–¹æ³•æ›´å®‰å…¨ã€‚å®ƒå¯ä»¥ä¿è¯ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ol><li>å®‰å…¨ç‰¹æ€§ï¼šäº’æ–¥è®¿é—®ï¼Œå³æ°¸è¿œåªæœ‰ä¸€ä¸ª client èƒ½æ‹¿åˆ°é”</li><li>é¿å…æ­»é”ï¼šæœ€ç»ˆ client éƒ½å¯èƒ½æ‹¿åˆ°é”ï¼Œä¸ä¼šå‡ºç°æ­»é”çš„æƒ…å†µï¼Œå³ä½¿åŸæœ¬é”ä½æŸèµ„æºçš„ client crash äº†æˆ–è€…å‡ºç°äº†ç½‘ç»œåˆ†åŒº</li><li>å®¹é”™æ€§ï¼šåªè¦å¤§éƒ¨åˆ† Redis èŠ‚ç‚¹å­˜æ´»å°±å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡</li></ol><h4 id="â€”â€”ç¼“å­˜å¼‚å¸¸â€”â€”"><a href="#â€”â€”ç¼“å­˜å¼‚å¸¸â€”â€”" class="headerlink" title="â€”â€”ç¼“å­˜å¼‚å¸¸â€”â€”"></a>â€”â€”ç¼“å­˜å¼‚å¸¸â€”â€”</h4><h4 id="1ã€çƒ­ç‚¹key"><a href="#1ã€çƒ­ç‚¹key" class="headerlink" title="1ã€çƒ­ç‚¹key"></a>1ã€çƒ­ç‚¹key</h4><p>ç¼“å­˜ä¸­çš„ä¸€ä¸ªKey(æ¯”å¦‚ä¸€ä¸ªä¿ƒé”€å•†å“)ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹è¿‡æœŸçš„æ—¶å€™ï¼Œæ°å¥½åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å¯¹è¿™ä¸ªKeyæœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><p>å¯¹ç¼“å­˜æŸ¥è¯¢åŠ é”ï¼Œå¦‚æœKEYä¸å­˜åœ¨ï¼Œå°±åŠ é”ï¼Œç„¶åæŸ¥DBå…¥ç¼“å­˜ï¼Œç„¶åè§£é”ï¼›å…¶ä»–è¿›ç¨‹å¦‚æœå‘ç°æœ‰é”å°±ç­‰å¾…ï¼Œç„¶åç­‰è§£é”åè¿”å›æ•°æ®æˆ–è€…è¿›å…¥DBæŸ¥è¯¢</p><h4 id="â€”â€”â€”å…¶ä»–â€”â€”â€”"><a href="#â€”â€”â€”å…¶ä»–â€”â€”â€”" class="headerlink" title="â€”â€”â€”å…¶ä»–â€”â€”â€”"></a>â€”â€”â€”å…¶ä»–â€”â€”â€”</h4><h4 id="1ã€ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§"><a href="#1ã€ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="1ã€ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§"></a>1ã€ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶çš„æ•°æ®ä¸€è‡´æ€§</h4><p>ä¸‰ç§æ–¹å¼ï¼šï¼ˆè¯¦æƒ…å¯ä»¥çœ‹ä¸€ä¸‹å‚è€ƒåšå®¢ï¼Œè¿™é‡Œç«™é•¿åšäº†å‡æ³•ï¼‰</p><ol><li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜</li><li>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</li><li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼ˆä¸»ï¼‰</li></ol><p><strong>ä¸€ã€å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜</strong></p><p>å®¹æ˜“å‡ºç°è„è¯» ä»¥åŠæµªè´¹æ€§èƒ½ï¼ˆä¸æ¨èï¼‰</p><p><strong>äºŒã€å…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</strong></p><p><strong>1ã€å­˜åœ¨é—®é¢˜ï¼š</strong></p><p>è¯¥æ–¹æ¡ˆä¼šå¯¼è‡´ä¸ä¸€è‡´çš„åŸå› æ˜¯ï¼šåŒæ—¶æœ‰ä¸€ä¸ªè¯·æ±‚Aè¿›è¡Œæ›´æ–°æ“ä½œï¼Œå¦ä¸€ä¸ªè¯·æ±‚Bè¿›è¡ŒæŸ¥è¯¢æ“ä½œã€‚é‚£ä¹ˆä¼šå‡ºç°å¦‚ä¸‹æƒ…å½¢ï¼š</p><blockquote><ul><li>ï¼ˆ1ï¼‰è¯·æ±‚Aè¿›è¡Œå†™æ“ä½œå‰ï¼Œå…ˆåˆ é™¤ç¼“å­˜</li><li>ï¼ˆ2ï¼‰è¯·æ±‚BæŸ¥è¯¢å‘ç°ç¼“å­˜ä¸å­˜åœ¨</li><li>ï¼ˆ3ï¼‰è¯·æ±‚Bå»æ•°æ®åº“æŸ¥è¯¢å¾—åˆ°æ—§å€¼</li><li>ï¼ˆ4ï¼‰è¯·æ±‚Bå°†æ—§å€¼å†™å…¥ç¼“å­˜</li><li>ï¼ˆ5ï¼‰è¯·æ±‚Aå°†æ–°å€¼å†™å…¥æ•°æ®åº“</li></ul></blockquote><p>ä¸Šè¿°æƒ…å†µå°±ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„æƒ…å½¢å‡ºç°ã€‚è€Œä¸”ï¼Œå¦‚æœä¸é‡‡ç”¨ç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ç­–ç•¥ï¼Œè¯¥æ•°æ®æ°¸è¿œéƒ½æ˜¯è„æ•°æ®ã€‚</p><p><strong>2ã€è§£å†³æ–¹æ¡ˆï¼šå»¶æ—¶åŒåˆ ç­–ç•¥ï¼š</strong>æ€§èƒ½å·®ï¼Œååé‡é™ä½</p><blockquote><p>public void write(String key,Object data){</p><p>â€‹        redis.delKey(key);</p><p>â€‹        db.updateData(data);</p><p>â€‹        Thread.sleep(1000);</p><p>â€‹        redis.delKey(key);</p><p>â€‹    }</p></blockquote><p>è½¬åŒ–ä¸ºä¸­æ–‡æè¿°å°±æ˜¯ï¼š </p><blockquote><ul><li>ï¼ˆ1ï¼‰å…ˆæ·˜æ±°ç¼“å­˜</li><li>ï¼ˆ2ï¼‰å†å†™æ•°æ®åº“</li><li>ï¼ˆ3ï¼‰ä¼‘çœ 1ç§’ï¼Œå†æ¬¡æ·˜æ±°ç¼“å­˜</li></ul></blockquote><p><strong>ä¸‰ã€å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜ï¼š</strong></p><p>â€‹      <strong>æ–¹æ¡ˆä¸€ï¼šMQ</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303142148980.png"></p><p>æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><blockquote><ul><li>ï¼ˆ1ï¼‰æ›´æ–°æ•°æ®åº“æ•°æ®ï¼›</li><li>ï¼ˆ2ï¼‰ç¼“å­˜å› ä¸ºç§ç§é—®é¢˜åˆ é™¤å¤±è´¥</li><li>ï¼ˆ3ï¼‰å°†éœ€è¦åˆ é™¤çš„keyå‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—</li><li>ï¼ˆ4ï¼‰è‡ªå·±æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å¾—éœ€è¦åˆ é™¤çš„key</li><li>ï¼ˆ5ï¼‰ç»§ç»­é‡è¯•åˆ é™¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸ</li></ul></blockquote><p>â€‹        ç„¶è€Œï¼Œè¯¥æ–¹æ¡ˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå¯¹ä¸šåŠ¡çº¿ä»£ç é€ æˆå¤§é‡çš„ä¾µå…¥ã€‚äºæ˜¯æœ‰äº†æ–¹æ¡ˆäºŒï¼Œåœ¨æ–¹æ¡ˆäºŒä¸­ï¼Œå¯åŠ¨ä¸€ä¸ªè®¢é˜…ç¨‹åºå»è®¢é˜…æ•°æ®åº“çš„binlogï¼Œè·å¾—éœ€è¦æ“ä½œçš„æ•°æ®ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¦èµ·ä¸€æ®µç¨‹åºï¼Œè·å¾—è¿™ä¸ªè®¢é˜…ç¨‹åºä¼ æ¥çš„ä¿¡æ¯ï¼Œè¿›è¡Œåˆ é™¤ç¼“å­˜æ“ä½œã€‚</p><p>â€‹      <strong>æ–¹æ¡ˆäºŒï¼šCanal</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303142148865.png"></p><p>æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><blockquote><ul><li>ï¼ˆ1ï¼‰æ›´æ–°æ•°æ®åº“æ•°æ®</li><li>ï¼ˆ2ï¼‰æ•°æ®åº“ä¼šå°†æ“ä½œä¿¡æ¯å†™å…¥binlogæ—¥å¿—å½“ä¸­</li><li>ï¼ˆ3ï¼‰è®¢é˜…ç¨‹åºæå–å‡ºæ‰€éœ€è¦çš„æ•°æ®ä»¥åŠkey</li><li>ï¼ˆ4ï¼‰å¦èµ·ä¸€æ®µéä¸šåŠ¡ä»£ç ï¼Œè·å¾—è¯¥ä¿¡æ¯</li><li>ï¼ˆ5ï¼‰å°è¯•åˆ é™¤ç¼“å­˜æ“ä½œï¼Œå‘ç°åˆ é™¤å¤±è´¥</li><li>ï¼ˆ6ï¼‰å°†è¿™äº›ä¿¡æ¯å‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—</li><li>ï¼ˆ7ï¼‰é‡æ–°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å¾—è¯¥æ•°æ®ï¼Œé‡è¯•æ“ä½œ</li></ul></blockquote><p>å¤‡æ³¨è¯´æ˜ï¼šä¸Šè¿°çš„è®¢é˜…binlogç¨‹åºåœ¨mysqlä¸­æœ‰ç°æˆçš„ä¸­é—´ä»¶å«canalï¼Œå¯ä»¥å®Œæˆè®¢é˜…binlogæ—¥å¿—çš„åŠŸèƒ½ã€‚å¦å¤–ï¼Œé‡è¯•æœºåˆ¶ï¼Œåšä¸»æ˜¯é‡‡ç”¨çš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ã€‚å¦‚æœå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œç›´æ¥åœ¨ç¨‹åºä¸­å¦èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å»é‡è¯•å³å¯ï¼Œè¿™äº›å¤§å®¶å¯ä»¥çµæ´»è‡ªç”±å‘æŒ¥ï¼Œåªæ˜¯æä¾›ä¸€ä¸ªæ€è·¯ã€‚</p><h4 id="2ã€å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥"><a href="#2ã€å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥" class="headerlink" title="2ã€å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥"></a>2ã€å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥</h4><p>ä½¿ç”¨keysæŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ã€‚</p><p>å¯¹æ–¹æ¥ç€è¿½é—®ï¼šå¦‚æœè¿™ä¸ªredisæ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨keysæŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>è¿™ä¸ªæ—¶å€™ä½ è¦å›ç­”rediså…³é”®çš„ä¸€ä¸ªç‰¹æ€§ï¼šredisçš„å•çº¿ç¨‹çš„ã€‚keysæŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨scanæŒ‡ä»¤ï¼ŒscanæŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨keysæŒ‡ä»¤é•¿ã€‚</p><h4 id="3ã€ä½¿ç”¨Redisåšè¿‡å¼‚æ­¥é˜Ÿåˆ—å—ï¼Œæ˜¯å¦‚ä½•å®ç°çš„"><a href="#3ã€ä½¿ç”¨Redisåšè¿‡å¼‚æ­¥é˜Ÿåˆ—å—ï¼Œæ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="3ã€ä½¿ç”¨Redisåšè¿‡å¼‚æ­¥é˜Ÿåˆ—å—ï¼Œæ˜¯å¦‚ä½•å®ç°çš„"></a>3ã€ä½¿ç”¨Redisåšè¿‡å¼‚æ­¥é˜Ÿåˆ—å—ï¼Œæ˜¯å¦‚ä½•å®ç°çš„</h4><p>ä½¿ç”¨listç±»å‹ä¿å­˜æ•°æ®ä¿¡æ¯ï¼Œrpushç”Ÿäº§æ¶ˆæ¯ï¼Œlpopæ¶ˆè´¹æ¶ˆæ¯ï¼Œå½“lpopæ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥sleepä¸€æ®µæ—¶é—´ï¼Œç„¶åå†æ£€æŸ¥æœ‰æ²¡æœ‰ä¿¡æ¯ï¼Œå¦‚æœä¸æƒ³sleepçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨blpop, åœ¨æ²¡æœ‰ä¿¡æ¯çš„æ—¶å€™ï¼Œä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°ä¿¡æ¯çš„åˆ°æ¥ã€‚rediså¯ä»¥é€šè¿‡pub/subä¸»é¢˜è®¢é˜…æ¨¡å¼å®ç°ä¸€ä¸ªç”Ÿäº§è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ï¼Œå½“ç„¶ä¹Ÿå­˜åœ¨ä¸€å®šçš„ç¼ºç‚¹ï¼Œå½“æ¶ˆè´¹è€…ä¸‹çº¿æ—¶ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ã€‚</p><h4 id="4ã€Rediså¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—"><a href="#4ã€Rediså¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—" class="headerlink" title="4ã€Rediså¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—"></a>4ã€Rediså¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—</h4><p>ä½¿ç”¨sortedsetï¼Œä½¿ç”¨æ—¶é—´æˆ³åšscore, æ¶ˆæ¯å†…å®¹ä½œä¸ºkey,è°ƒç”¨zaddæ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨zrangbyscoreè·å–nç§’ä¹‹å‰çš„æ•°æ®åšè½®è¯¢å¤„ç†ã€‚</p><h4 id="5ã€Rediså›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œ"><a href="#5ã€Rediså›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œ" class="headerlink" title="5ã€Rediså›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œ"></a>5ã€Rediså›æ”¶è¿›ç¨‹å¦‚ä½•å·¥ä½œ</h4><ol><li>ä¸€ä¸ªå®¢æˆ·ç«¯è¿è¡Œäº†æ–°çš„å‘½ä»¤ï¼Œæ·»åŠ äº†æ–°çš„æ•°æ®ã€‚</li><li>Redisæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœå¤§äºmaxmemoryçš„é™åˆ¶ï¼Œ åˆ™æ ¹æ®è®¾å®šå¥½çš„ç­–ç•¥è¿›è¡Œå›æ”¶ã€‚</li><li>ä¸€ä¸ªæ–°çš„å‘½ä»¤è¢«æ‰§è¡Œï¼Œç­‰ç­‰ã€‚</li><li>æ‰€ä»¥æˆ‘ä»¬ä¸æ–­åœ°ç©¿è¶Šå†…å­˜é™åˆ¶çš„è¾¹ç•Œï¼Œé€šè¿‡ä¸æ–­è¾¾åˆ°è¾¹ç•Œç„¶åä¸æ–­åœ°å›æ”¶å›åˆ°è¾¹ç•Œä»¥ä¸‹ã€‚</li></ol><p>å¦‚æœä¸€ä¸ªå‘½ä»¤çš„ç»“æœå¯¼è‡´å¤§é‡å†…å­˜è¢«ä½¿ç”¨ï¼ˆä¾‹å¦‚å¾ˆå¤§çš„é›†åˆçš„äº¤é›†ä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„é”®ï¼‰ï¼Œä¸ç”¨å¤šä¹…å†…å­˜é™åˆ¶å°±ä¼šè¢«è¿™ä¸ªå†…å­˜ä½¿ç”¨é‡è¶…è¶Šã€‚</p><h4 id="6ã€Rediså›æ”¶ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•"><a href="#6ã€Rediså›æ”¶ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•" class="headerlink" title="6ã€Rediså›æ”¶ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•"></a>6ã€Rediså›æ”¶ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•</h4><p>LRUç®—æ³•ï¼Œä¸å…·ä½“å±•å¼€äº†</p><h2 id="äº”ã€åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#äº”ã€åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="äº”ã€åˆ†å¸ƒå¼äº‹åŠ¡"></a>äº”ã€åˆ†å¸ƒå¼äº‹åŠ¡</h2><h3 id="1ã€å¸¸è§„ï¼ˆæ”¾æ¾è§£å‹ç‰ˆï¼‰"><a href="#1ã€å¸¸è§„ï¼ˆæ”¾æ¾è§£å‹ç‰ˆï¼‰" class="headerlink" title="1ã€å¸¸è§„ï¼ˆæ”¾æ¾è§£å‹ç‰ˆï¼‰"></a>1ã€å¸¸è§„ï¼ˆæ”¾æ¾è§£å‹ç‰ˆï¼‰</h3><h4 id="1ã€äº‹åŠ¡çš„ç‰¹æ€§"><a href="#1ã€äº‹åŠ¡çš„ç‰¹æ€§" class="headerlink" title="1ã€äº‹åŠ¡çš„ç‰¹æ€§"></a>1ã€äº‹åŠ¡çš„ç‰¹æ€§</h4><p>1.åŸå­æ€§ è¦ä¹ˆä¸€èµ·æˆåŠŸè¦ä¹ˆä¸€èµ·å¤±è´¥</p><p>2.ä¸€è‡´æ€§ äº‹åŠ¡æ‰§è¡Œå‰åæ•°æ®ä¿æŒä¸€è‡´æ€§çŠ¶æ€</p><p>3.éš”ç¦»æ€§ å¤šä¸ªäº‹åŠ¡ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œäº’ç›¸ä¸å½±å“</p><p>4.æŒä¹…æ€§ äº‹åŠ¡ä¸€æ—¦æäº¤æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„</p><h4 id="2ã€åˆ†å¸ƒå¼äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”çš„åŒºåˆ«"><a href="#2ã€åˆ†å¸ƒå¼äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”çš„åŒºåˆ«" class="headerlink" title="2ã€åˆ†å¸ƒå¼äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”çš„åŒºåˆ«"></a>2ã€åˆ†å¸ƒå¼äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”çš„åŒºåˆ«</h4><p>åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯è§£å†³æµç¨‹åŒ–çš„é—®é¢˜ï¼Œåˆ†å¸ƒå¼é”æ˜¯è§£å†³èµ„æºå ç”¨é—®é¢˜</p><h4 id="3ã€mysqlå¦‚ä½•å®ç°æœ¬åœ°äº‹åŠ¡"><a href="#3ã€mysqlå¦‚ä½•å®ç°æœ¬åœ°äº‹åŠ¡" class="headerlink" title="3ã€mysqlå¦‚ä½•å®ç°æœ¬åœ°äº‹åŠ¡"></a>3ã€mysqlå¦‚ä½•å®ç°æœ¬åœ°äº‹åŠ¡</h4><p>1.é€šè¿‡æ•°æ®åº“é”çš„æœºåˆ¶ï¼Œä¿éšœäº‹åŠ¡çš„éš”ç¦»æ€§ï¼›</p><p>2.é€šè¿‡ Redo Logï¼ˆé‡åšæ—¥å¿—ï¼‰æ¥ï¼Œä¿éšœäº‹åŠ¡çš„æŒä¹…æ€§ï¼›</p><p>3.é€šè¿‡ Undo Log ï¼ˆæ’¤é”€æ—¥å¿—ï¼‰æ¥ï¼Œä¿éšœäº‹åŠ¡çš„åŸå­æ€§ï¼›</p><p>4.é€šè¿‡ Undo Log ï¼ˆæ’¤é”€æ—¥å¿—ï¼‰æ¥ï¼Œä¿éšœäº‹åŠ¡çš„ä¸€è‡´æ€§ï¼›</p><h4 id="4ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#4ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="4ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"></a>4ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡</h4><p>åˆ†å¸ƒå¼äº‹åŠ¡ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸Šä¸€æ¬¡å¤§çš„æ“ä½œç”±å¤šä¸ªå°çš„æ“ä½œå®Œæˆï¼Œæ¯ä¸ªå°æ“ä½œéƒ½åœ¨ä¸åŒçš„åº”ç”¨æ‰§è¡Œï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯è¦ä¿è¯è¿™äº›æ“ä½œè¦ä¹ˆå¤±è´¥ï¼Œè¦ä¹ˆæˆåŠŸ</p><h4 id="5ã€ä»€ä¹ˆæ˜¯capå®šç†"><a href="#5ã€ä»€ä¹ˆæ˜¯capå®šç†" class="headerlink" title="5ã€ä»€ä¹ˆæ˜¯capå®šç†"></a>5ã€ä»€ä¹ˆæ˜¯capå®šç†</h4><p>webæœåŠ¡æ— æ³•åŒæ—¶æ»¡è¶³capå®šç†</p><p>c ä¸€è‡´æ€§æ€§(Consistency):æ›´æ–°æ“ä½œæˆåŠŸå¹¶è¿”å›å®¢æˆ·ç«¯å®Œæˆåï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œä¸èƒ½å­˜åœ¨ä¸­é—´çŠ¶æ€ã€‚</p><p>a å¯ç”¨æ€§(Availability):ç³»ç»Ÿæä¾›çš„æœåŠ¡å¿…é¡»ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚</p><p>p åˆ†åŒºå®¹é”™æ€§(Partition tolerance):å³ä½¿å‡ºç°å•ä¸ªç»„ä»¶æ— æ³•å¯ç”¨ï¼Œæ“ä½œä¾ç„¶å¯ä»¥å®Œæˆ</p><h4 id="6ã€ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§"><a href="#6ã€ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="6ã€ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§"></a>6ã€ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§</h4><p>æ•°æ®æ›´æ–°æˆåŠŸè¿”å›å®¢æˆ·ç«¯ä¹‹åï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ä¿æŒä¸€è‡´ï¼Œæ²¡æœ‰ä¸­é—´çŠ¶æ€</p><p>å¼ºä¸€è‡´æ€§ï¼šæ—¶åˆ»ä¿è¯æ•°æ®ä¸€è‡´æ€§</p><p>æœ€ç»ˆä¸€è‡´æ€§ï¼šä¸€æ®µæ—¶é—´åä¿è¯æ•°æ®ä¸€è‡´æ€§</p><p>å¼±ä¸€è‡´æ€§ï¼šå…è®¸å­˜åœ¨éƒ¨åˆ†æ•°æ®ä¸ä¸€è‡´</p><h4 id="7ã€ä¸ºä»€ä¹ˆåˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•åŒæ—¶ä¿è¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§"><a href="#7ã€ä¸ºä»€ä¹ˆåˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•åŒæ—¶ä¿è¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§" class="headerlink" title="7ã€ä¸ºä»€ä¹ˆåˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•åŒæ—¶ä¿è¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§"></a>7ã€ä¸ºä»€ä¹ˆåˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•<strong>åŒæ—¶ä¿è¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§</strong></h4><p>å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿè€Œè¨€ï¼Œåˆ†åŒºå®¹é”™æ€§æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„è¦æ±‚ï¼Œå› æ­¤åŸºæœ¬ä¸Šæˆ‘ä»¬åœ¨è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ—¶å€™åªèƒ½ä»ä¸€è‡´æ€§ï¼ˆCï¼‰å’Œå¯ç”¨æ€§ï¼ˆAï¼‰ä¹‹é—´è¿›è¡Œå–èˆ</p><h4 id="8ã€ä»€ä¹ˆæ˜¯baseå®šç†"><a href="#8ã€ä»€ä¹ˆæ˜¯baseå®šç†" class="headerlink" title="8ã€ä»€ä¹ˆæ˜¯baseå®šç†"></a>8ã€ä»€ä¹ˆæ˜¯baseå®šç†</h4><p>capå®šç†çš„aå’Œpçš„å»¶ä¼¸ï¼Œé€šè¿‡ç‰ºç‰²ä¸€è‡´æ€§æ¥è·å¾—å¯ç”¨æ€§ï¼Œå¹¶å…è®¸æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æœ€ç»ˆè¾¾åˆ°ä¸€è‡´çŠ¶æ€</p><h4 id="9ã€ä»€ä¹ˆæ˜¯åˆšæ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡"><a href="#9ã€ä»€ä¹ˆæ˜¯åˆšæ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡" class="headerlink" title="9ã€ä»€ä¹ˆæ˜¯åˆšæ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡"></a>9ã€ä»€ä¹ˆæ˜¯åˆšæ€§äº‹åŠ¡å’ŒæŸ”æ€§äº‹åŠ¡</h4><p>åˆšæ€§äº‹åŠ¡ï¼šé€šå¸¸æ— ä¸šåŠ¡æ”¹é€ ï¼Œå¼ºä¸€è‡´æ€§ï¼ŒåŸç”Ÿæ”¯æŒå›æ»š/éš”ç¦»æ€§ï¼Œä½å¹¶å‘ï¼Œé€‚åˆçŸ­äº‹åŠ¡</p><p>XA åè®®ï¼ˆ2PCã€JTAã€JTSï¼‰ã€3PCï¼Œä½†ç”±äºåŒæ­¥é˜»å¡ï¼Œå¤„ç†æ•ˆç‡ä½ï¼Œä¸é€‚åˆå¤§å‹ç½‘ç«™åˆ†å¸ƒå¼åœºæ™¯</p><p>æŸ”æ€§äº‹åŠ¡ï¼šä¸è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œè€Œæ˜¯è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œå…è®¸æœ‰ä¸­é—´çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯Baseç†è®º</p><p>TCC/FMTã€Sagaï¼ˆçŠ¶æ€æœºæ¨¡å¼ã€Aopæ¨¡å¼ï¼‰ã€æœ¬åœ°äº‹åŠ¡æ¶ˆæ¯ã€æ¶ˆæ¯äº‹åŠ¡ï¼ˆåŠæ¶ˆæ¯ï¼‰</p><h4 id="10ã€ä»€ä¹ˆæ˜¯XA"><a href="#10ã€ä»€ä¹ˆæ˜¯XA" class="headerlink" title="10ã€ä»€ä¹ˆæ˜¯XA"></a>10ã€ä»€ä¹ˆæ˜¯XA</h4><p>XA ï¼Œå¼ºä¸€è‡´æ€§ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®ä¸€ç›´é”ä½çŠ¶æ€ï¼Œå³ä»prepareåˆ°commitã€rollbackçš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒTMä¸€ç›´æŠŠæŒæŠ˜æ•°æ®åº“çš„é”ï¼Œå¦‚æœæœ‰å…¶ä»–äººè¦ä¿®æ”¹æ•°æ®åº“çš„è¯¥æ¡æ•°æ®ï¼Œå°±å¿…é¡»ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œå­˜åœ¨é•¿äº‹åŠ¡é£é™©ã€‚</p><h4 id="11ã€åˆ†å¸ƒå¼äº‹åŠ¡æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆ"><a href="#11ã€åˆ†å¸ƒå¼äº‹åŠ¡æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆ" class="headerlink" title="11ã€åˆ†å¸ƒå¼äº‹åŠ¡æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆ"></a>11ã€åˆ†å¸ƒå¼äº‹åŠ¡æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆ</h4><p>ä¸€ã€2pcï¼šäºŒé˜¶æ®µæäº¤ï¼Œå¼ºä¸€è‡´æ€§è®¾è®¡ï¼Œå¼•å…¥ä¸€ä¸ªäº‹åŠ¡åè°ƒè€…çš„è§’è‰²æ¥åè°ƒç®¡ç†å„å‚ä¸è€…ï¼ˆä¹Ÿå¯ç§°ä¹‹ä¸ºå„æœ¬åœ°èµ„æºï¼‰çš„æäº¤å’Œå›æ»šï¼ŒäºŒé˜¶æ®µåˆ†åˆ«æŒ‡çš„æ˜¯å‡†å¤‡å’Œæäº¤ä¸¤ä¸ªé˜¶æ®µã€‚åŒæ­¥é˜»å¡ï¼Œå­˜åœ¨é•¿äº‹åŠ¡é£é™©</p><p>ã€å‡†å¤‡æäº¤é˜¶æ®µ-æäº¤é˜¶æ®µã€‘</p><p>äºŒã€3pcï¼šåœ¨2pcä¹‹åå¤šåŠ å…¥é¢„æäº¤é˜¶æ®µï¼Œå’Œè¶…æ—¶ã€‚é¢„æäº¤é˜¶æ®µä¸»è¦æ˜¯è¯¢é—®äº‹åŠ¡å‚ä¸è€…æ˜¯å¦èƒ½æ­£å¸¸æœ‰æ¡ä»¶çš„æ‰§è¡Œ</p><p>ã€å‡†å¤‡æäº¤é˜¶æ®µ-é¢„æäº¤é˜¶æ®µ-æäº¤é˜¶æ®µã€‘</p><p>ä¸‰ã€Tccï¼š2PC å’Œ 3PC éƒ½æ˜¯æ•°æ®åº“å±‚é¢çš„ï¼Œè€Œ TCC æ˜¯ä¸šåŠ¡å±‚é¢çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œéœ€è¦è‡ªå·±å®ç°Try - Confirm - Cancelä¸‰ä¸ªæ–¹æ³•ï¼Œå­˜åœ¨ä»£ç å…¥ä¾µä¸šåŠ¡ç´§è€¦åˆé—®é¢˜</p><ul><li><p>Try æŒ‡çš„æ˜¯é¢„ç•™ï¼Œå³èµ„æºçš„é¢„ç•™å’Œé”å®šï¼Œ<strong>æ³¨æ„æ˜¯é¢„ç•™</strong>ã€‚</p></li><li><p>Confirm æŒ‡çš„æ˜¯ç¡®è®¤æ“ä½œï¼Œè¿™ä¸€æ­¥å…¶å®å°±æ˜¯çœŸæ­£çš„æ‰§è¡Œäº†ã€‚</p></li><li><p>Cancel æŒ‡çš„æ˜¯æ’¤é”€æ“ä½œï¼Œå¯ä»¥ç†è§£ä¸ºæŠŠé¢„ç•™é˜¶æ®µçš„åŠ¨ä½œæ’¤é”€äº†ã€‚</p></li></ul><p>å››ã€æ¶ˆæ¯äº‹åŠ¡ï¼šRocketMQå¾ˆå¥½æ”¯æŒæ¶ˆæ¯äº‹åŠ¡,æœ¬åœ°æ‰§è¡Œäº‹åŠ¡å‰å‘é€æ¶ˆæ¯ï¼Œæœ¬åœ°äº‹åŠ¡å¤±è´¥åˆ™ä¸¢å¼ƒæ¶ˆæ¯ï¼Œæœ¬åœ°æ‰§è¡ŒæˆåŠŸï¼Œæ¶ˆæ¯è®¢é˜…æ–¹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼ŒæˆåŠŸä¹‹åæ¶ˆè´¹æ¶ˆæ¯ã€‚</p><h4 id="12ã€2pcå’Œ3pcçš„åŒºåˆ«"><a href="#12ã€2pcå’Œ3pcçš„åŒºåˆ«" class="headerlink" title="12ã€2pcå’Œ3pcçš„åŒºåˆ«"></a>12ã€2pcå’Œ3pcçš„åŒºåˆ«</h4><p>3pcå¤šåŠ å…¥é¢„æäº¤é˜¶æ®µï¼Œå’Œè¶…æ—¶</p><h4 id="13ã€Seata-çš„atæ¨¡å¼"><a href="#13ã€Seata-çš„atæ¨¡å¼" class="headerlink" title="13ã€Seata çš„atæ¨¡å¼"></a>13ã€Seata çš„atæ¨¡å¼</h4><ul><li>Seata ATåˆ†ä¸ºä¸¤é˜¶æ®µï¼Œä¸»è¦é€»è¾‘å…¨éƒ¨åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œç¬¬äºŒé˜¶æ®µä¸»è¦åšå›æ»šæˆ–æ—¥å¿—æ¸…ç†çš„å·¥ä½œã€‚</li><li>ä¼šåœ¨æ¯ä¸ªæ•°æ®åº“ä¸­ç»´æŠ¤undo_logè¡¨</li><li>@GlobalTransactional æ³¨è§£è¡¨ç¤ºå¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡</li></ul><h4 id="14ã€2pcå’ŒSeataçš„atåŒºåˆ«"><a href="#14ã€2pcå’ŒSeataçš„atåŒºåˆ«" class="headerlink" title="14ã€2pcå’ŒSeataçš„atåŒºåˆ«"></a>14ã€2pcå’Œ<strong>Seataçš„</strong>atåŒºåˆ«</h4><p>atæ¨¡å¼æ˜¯å¢å¼ºç‰ˆçš„2pcï¼Œç¬¬ä¸€é˜¶æ®µä¸šåŠ¡æ•°æ®å’Œå›æ»šæ—¥å¿—è®°å½•åœ¨åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­æäº¤,æäº¤ä¹‹åå°±ä¼šé‡Šæ”¾èµ„æº</p><h4 id="15ã€Seataçš„å››ç§æ¨¡å¼"><a href="#15ã€Seataçš„å››ç§æ¨¡å¼" class="headerlink" title="15ã€Seataçš„å››ç§æ¨¡å¼"></a>15ã€Seataçš„å››ç§æ¨¡å¼</h4><h3 id="2ã€è¿›é˜¶-1"><a href="#2ã€è¿›é˜¶-1" class="headerlink" title="2ã€è¿›é˜¶"></a>2ã€è¿›é˜¶</h3><h4 id="1ã€è®¾è®¡ï¼š1ID-3ç»„ä»¶ï¼ˆseataï¼‰"><a href="#1ã€è®¾è®¡ï¼š1ID-3ç»„ä»¶ï¼ˆseataï¼‰" class="headerlink" title="1ã€è®¾è®¡ï¼š1ID+3ç»„ä»¶ï¼ˆseataï¼‰"></a>1ã€è®¾è®¡ï¼š1ID+3ç»„ä»¶ï¼ˆseataï¼‰</h4><h5 id="1ã€ID"><a href="#1ã€ID" class="headerlink" title="1ã€ID"></a>1ã€ID</h5><p>å…¨å±€å”¯ä¸€çš„äº‹åŠ¡IDï¼šTransaction ID XID</p><h5 id="2ã€ç»„ä»¶"><a href="#2ã€ç»„ä»¶" class="headerlink" title="2ã€ç»„ä»¶"></a>2ã€ç»„ä»¶</h5><p>Transaction Coordinator (TC)<strong>ã€ç¨‹åºå‘˜ã€‘</strong></p><p><code>äº‹åŠ¡åè°ƒå™¨</code>ï¼Œç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»šï¼›</p><p>Transaction Manager (TM)<strong>ã€ç»ç†ã€‘</strong></p><p><code>æ§åˆ¶å…¨å±€äº‹åŠ¡çš„è¾¹ç•Œ</code>ï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›æ»šçš„å†³è®®ï¼›</p><p>Resource Manager (RM)<strong>ã€ç”¨æˆ·ã€‘</strong></p><p><code>æ§åˆ¶åˆ†æ”¯äº‹åŠ¡</code>ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œã€çŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æ¥æ”¶äº‹åŠ¡åè°ƒå™¨çš„æŒ‡ä»¤ï¼Œé©±åŠ¨åˆ†æ”¯ï¼ˆæœ¬åœ°ï¼‰äº‹åŠ¡çš„æäº¤å’Œå›æ»š</p><p>XIDã€ç¨‹åºã€‘</p><h4 id="2ã€å¤„ç†è¿‡ç¨‹"><a href="#2ã€å¤„ç†è¿‡ç¨‹" class="headerlink" title="2ã€å¤„ç†è¿‡ç¨‹"></a>2ã€å¤„ç†è¿‡ç¨‹</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303302226889.png"></p><p>ATæ¨¡å¼ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><p>ä¸€é˜¶æ®µï¼š</p><p>è§£æSQLï¼Œè·å–SQLç±»å‹ï¼ˆCRUDï¼‰ã€è¡¨ä¿¡æ¯ã€æ¡ä»¶(where) ç­‰ç›¸å…³ä¿¡æ¯<br>æŸ¥è¯¢å‰é•œåƒ(æ”¹å˜ä¹‹å‰çš„æ•°æ®)ï¼Œæ ¹æ®è§£æå¾—åˆ°çš„æ¡ä»¶ä¿¡æ¯ï¼Œç”ŸæˆæŸ¥è¯¢è¯­å¥ï¼Œå®šä½æ•°æ®<br>æ‰§è¡Œä¸šåŠ¡SQLï¼Œæ›´æ–°æ•°æ®<br>æŸ¥è¯¢åé•œåƒï¼ˆæ”¹å˜åçš„æ•°æ®ï¼‰ï¼Œæ ¹æ®å‰é•œåƒçš„ç»“æœï¼Œé€šè¿‡ä¸»é”®éƒ½ç»™ä½ ä¸ºæ•°æ®<br>æ’å…¥å›æ»šæ—¥å¿—ï¼Œå°†å‰åé•œåƒæ•°æ®ä»¥åŠä¸šåŠ¡SQLç­‰ä¿¡æ¯ï¼Œç»„ç»‡æˆä¸€æ¡å›æ»šæ—¥å¿—è®°å½•ï¼Œæ’å…¥åˆ°undo Logè¡¨ä¸­<br>æäº¤å‰ï¼Œå‘TCæ³¨å†Œåˆ†æ”¯ï¼Œç”³è¯·å…¨å±€é”<br>æœ¬åœ°äº‹åŠ¡æäº¤ï¼Œä¸šåŠ¡æ•°æ®çš„æ›´ç»†è…»å’Œç”Ÿæˆçš„undoLogä¸€èµ·æäº¤<br>å°†æœ¬åœ°äº‹åŠ¡æäº¤çš„ç»“æœé€šçŸ¥ç»™TC</p><p>äºŒé˜¶æ®µï¼š</p><p>å¦‚æœTCæ”¶åˆ°çš„æ˜¯å›æ»šè¯·æ±‚</p><p>å¼€å¯æœ¬åœ°äº‹åŠ¡ï¼Œé€šè¿‡XIDå’ŒBranchIDæŸ¥æ‰¾åˆ°å¯¹åº”çš„undo Logè®°å½•<br>æ ¹æ®undoLogä¸­çš„å‰é•œåƒå’Œä¸šåŠ¡SQLçš„ç›¸å…³ä¿¡æ¯ç”Ÿæˆå¹¶æ‰§è¡Œå›æ»šè¯­å¥<br>æäº¤æœ¬åœ°äº‹åŠ¡ï¼Œå°†æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœï¼ˆåˆ†æ”¯äº‹åŠ¡å›æ»šçš„ä¿¡æ¯ï¼‰é€šçŸ¥ç»™TC<br>å¦‚æœæ²¡é—®é¢˜ï¼Œæ‰§è¡Œæäº¤æ“ä½œ</p><p>æ”¶åˆ°TCåˆ†æ”¯æäº¤è¯·æ±‚ï¼Œå°†è¯·æ±‚æ”¾å…¥åˆ°ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„é˜Ÿåˆ—ä¸­ï¼Œé©¬ä¸Šè¿”å›æäº¤æˆåŠŸçš„ç»“æœç»™TC<br>å¼‚æ­¥ä»»åŠ¡é˜¶æ®µçš„åˆ†æ”¯æäº¤è¯·æ±‚åˆ é™¤undoLogä¸­è®°å½•</p><h3 id="3ã€åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹å¼"><a href="#3ã€åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹å¼" class="headerlink" title="3ã€åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹å¼"></a>3ã€åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹å¼</h3><h4 id="1ã€"><a href="#1ã€" class="headerlink" title="1ã€"></a>1ã€</h4><h2 id="å…­ã€Spring"><a href="#å…­ã€Spring" class="headerlink" title="å…­ã€Spring"></a>å…­ã€Spring</h2><h3 id="1ã€çƒ­èº«é¢˜"><a href="#1ã€çƒ­èº«é¢˜" class="headerlink" title="1ã€çƒ­èº«é¢˜"></a>1ã€çƒ­èº«é¢˜</h3><h4 id="1-ä»€ä¹ˆæ˜¯spring"><a href="#1-ä»€ä¹ˆæ˜¯spring" class="headerlink" title="1.ä»€ä¹ˆæ˜¯spring?"></a><strong>1.ä»€ä¹ˆæ˜¯spring?</strong></h4><p>ä¸€ä¸ªè½»é‡çº§å¼€æºæ¡†æ¶ï¼Œç®€åŒ–å¼€å‘ã€‚æ ¸å¿ƒæ˜¯iocæ§åˆ¶åè½¬å’Œaopé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p><p>ç®€åŒ–å¼€å‘: é€šè¿‡åˆ‡é¢å’Œæ¨¡æ¿å‡å°‘é‡å¤æ€§ä»£ç ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥åˆ›å»ºå¯¹è±¡ï¼Œå®ç°æ¾è€¦åˆ</p><h4 id="2-ä»€ä¹ˆæ˜¯iocå’Œaopï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯iocå’Œaopï¼Ÿ" class="headerlink" title="2.ä»€ä¹ˆæ˜¯iocå’Œaopï¼Ÿ"></a><strong>2.ä»€ä¹ˆæ˜¯iocå’Œaopï¼Ÿ</strong></h4><p>iocæ§åˆ¶åè½¬ï¼Œå®ç°å¯¹è±¡çš„è€¦åˆå…³ç³»çš„ç®¡ç†ï¼Œå°†å¯¹è±¡çš„ä¾èµ–å…³ç³»äº¤ç»™iocç®¡ç†ã€‚</p><p>aopé¢å‘åˆ‡é¢ç¼–ç¨‹,åŠ¨æ€éä¾µå…¥çš„æ–¹å¼å¢å¼ºæœåŠ¡ã€‚</p><h4 id="3-aopçš„å®ç°æœºåˆ¶ï¼Ÿ"><a href="#3-aopçš„å®ç°æœºåˆ¶ï¼Ÿ" class="headerlink" title="3.aopçš„å®ç°æœºåˆ¶ï¼Ÿ"></a>3.aopçš„å®ç°æœºåˆ¶ï¼Ÿ</h4><p>é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ï¼Œä¸¤è€…åŒºåˆ«æ˜¯é™æ€ä»£ç†æ˜¯äº‹å…ˆå·²ç»å®šä¹‰å¥½çš„ï¼ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™åˆ›å»ºçš„</p><p>åŠ¨æ€ä»£ç†ï¼šåˆ†ä¸ºjdkåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†ã€‚</p><h4 id="4-jdkåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†çš„åŒºåˆ«"><a href="#4-jdkåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†çš„åŒºåˆ«" class="headerlink" title="4.jdkåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†çš„åŒºåˆ«?"></a>4.jdkåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†çš„åŒºåˆ«?</h4><p>jdkåŠ¨æ€ä»£ç†é€šè¿‡å®ç°è¢«ä»£ç†å¯¹è±¡çš„æ¥å£ï¼ŒcglibåŠ¨æ€ä»£ç†é€šè¿‡ç»§æ‰¿è¢«ä»£ç†å¯¹è±¡å®ç°</p><p>jdkåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†å®ç°æ¥å£çš„ç±»ï¼ŒcglibåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†æ²¡æœ‰è¢«finalä¿®é¥°çš„ç±»å’Œæ–¹æ³•</p><p>jdkåŠ¨æ€ä»£ç†é€šè¿‡åå°„æœºåˆ¶å®ç°ï¼ŒcglibåŠ¨æ€ä»£ç†é€šè¿‡fastClassæœºåˆ¶å®ç°</p><h4 id="5-aopæœ‰å“ªäº›é€šçŸ¥ç±»å‹ï¼Ÿ"><a href="#5-aopæœ‰å“ªäº›é€šçŸ¥ç±»å‹ï¼Ÿ" class="headerlink" title="5.aopæœ‰å“ªäº›é€šçŸ¥ç±»å‹ï¼Ÿ"></a>5.aopæœ‰å“ªäº›é€šçŸ¥ç±»å‹ï¼Ÿ</h4><p>å‰ç½®é€šçŸ¥ Before Advice:åœ¨æ–¹æ³•å‰åˆ‡å…¥</p><p>åç½®é€šçŸ¥ After Advice:åœ¨æ–¹æ³•ååˆ‡å…¥</p><p>æ­£å¸¸è¿”å›é€šçŸ¥ After Returning Advice:åœ¨æ–¹æ³•è¿”å›ååˆ‡å…¥ï¼ŒæŠ›å‡ºå¼‚å¸¸åˆ™ä¸ä¼šåˆ‡å…¥</p><p>å¼‚å¸¸é€šçŸ¥ After Throwing Advice:æŠ›å‡ºå¼‚å¸¸æ—¶åˆ‡å…¥</p><p>ç¯ç»•é€šçŸ¥ Around Advice:åœ¨æ–¹æ³•æ‰§è¡Œå‰ååˆ‡å…¥ï¼Œå¯ä»¥ä¸­æ–­æˆ–å¿½ç•¥åŸæœ‰æµç¨‹çš„æ‰§è¡Œ</p><h4 id="6-aopæœ‰å“ªäº›è¿ç”¨åœºæ™¯"><a href="#6-aopæœ‰å“ªäº›è¿ç”¨åœºæ™¯" class="headerlink" title="6.aopæœ‰å“ªäº›è¿ç”¨åœºæ™¯?"></a>6.aopæœ‰å“ªäº›è¿ç”¨åœºæ™¯?</h4><p>1.å…¨å±€å¼‚å¸¸å¤„ç† 2.é˜²æ­¢æ¥å£é‡å¤æäº¤ 3.æ¥å£å¹‚ç­‰æ€§ 4.æ—¥å¿—è®°å½• 5.äº‹åŠ¡</p><h4 id="7-aopçš„å®ç°ï¼Ÿ"><a href="#7-aopçš„å®ç°ï¼Ÿ" class="headerlink" title="7.aopçš„å®ç°ï¼Ÿ"></a>7.aopçš„å®ç°ï¼Ÿ</h4><p>@Aspectå®šä¹‰åˆ‡é¢ç±» @Pointcutå®šä¹‰åˆ‡å…¥ç‚¹</p><p>å®šä¹‰é€šçŸ¥ç±»å‹ @Befor @After @Arounr @AfterReturning @AfterThrowing</p><h4 id="8-springæœ‰å“ªäº›ä¼˜ç¼ºç‚¹"><a href="#8-springæœ‰å“ªäº›ä¼˜ç¼ºç‚¹" class="headerlink" title="8.springæœ‰å“ªäº›ä¼˜ç¼ºç‚¹?"></a>8.springæœ‰å“ªäº›ä¼˜ç¼ºç‚¹?</h4><p>1.iocå°†å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–äº¤ç»™iocå®¹å™¨ï¼Œæ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘</p><p>2.aopé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œéå…¥ä¾µæ–¹å¼å¢å¼ºæœåŠ¡ï¼Œå‡å°‘é‡å¤ä»£ç </p><p>3.å£°æ˜å¼äº‹åŠ¡ï¼Œæ–¹ä¾¿æµ‹è¯•</p><p>4.æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶</p><p>ç¼ºç‚¹ï¼šé…ç½®ç¹çï¼Œä¾èµ–åå°„å½±å“æ€§èƒ½ï¼Œå…¥é—¨æ—¶é—´é•¿</p><h4 id="9-springæœ‰å“ªäº›æ¨¡å—ç»„æˆï¼Ÿ"><a href="#9-springæœ‰å“ªäº›æ¨¡å—ç»„æˆï¼Ÿ" class="headerlink" title="9.springæœ‰å“ªäº›æ¨¡å—ç»„æˆï¼Ÿ"></a>9.springæœ‰å“ªäº›æ¨¡å—ç»„æˆï¼Ÿ</h4><p>1.spring jdbc 2.spring core 3.sping beans</p><p>4.spring aop 5.spring web 6.spring test</p><h4 id="10-springæ¡†æ¶ç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#10-springæ¡†æ¶ç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="10.springæ¡†æ¶ç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>10.springæ¡†æ¶ç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</h4><p>1.å·¥å‚æ¨¡å¼ 2.å•ä¾‹æ¨¡å¼ 3.æ¨¡æ¿æ–¹æ³• 4.ä»£ç†æ¨¡å¼ ç­‰</p><h4 id="11-springä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶"><a href="#11-springä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶" class="headerlink" title="11.springä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶?"></a>11.springä¸­æœ‰å“ªäº›ä¸åŒç±»å‹çš„äº‹ä»¶?</h4><ol><li>ä¸Šä¸‹æ–‡æ›´æ–°äº‹ä»¶ï¼ˆContextRefreshedEventï¼‰ï¼šåœ¨è°ƒç”¨ConfigurableApplicationContext æ¥å£ä¸­çš„refresh()æ–¹æ³•æ—¶è¢«è§¦å‘ã€‚</li><li>ä¸Šä¸‹æ–‡å¼€å§‹äº‹ä»¶ï¼ˆContextStartedEventï¼‰ï¼šå½“å®¹å™¨è°ƒç”¨ConfigurableApplicationContextçš„Start()æ–¹æ³•å¼€å§‹/é‡æ–°å¼€å§‹å®¹å™¨æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚</li><li>ä¸Šä¸‹æ–‡åœæ­¢äº‹ä»¶ï¼ˆContextStoppedEventï¼‰ï¼šå½“å®¹å™¨è°ƒç”¨ConfigurableApplicationContextçš„Stop()æ–¹æ³•åœæ­¢å®¹å™¨æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚</li><li>ä¸Šä¸‹æ–‡å…³é—­äº‹ä»¶ï¼ˆContextClosedEventï¼‰ï¼šå½“ApplicationContextè¢«å…³é—­æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚å®¹å™¨è¢«å…³é—­æ—¶ï¼Œå…¶ç®¡ç†çš„æ‰€æœ‰å•ä¾‹Beanéƒ½è¢«é”€æ¯ã€‚</li><li>è¯·æ±‚å¤„ç†äº‹ä»¶ï¼ˆRequestHandledEventï¼‰ï¼šåœ¨Webåº”ç”¨ä¸­ï¼Œå½“ä¸€ä¸ªhttpè¯·æ±‚ï¼ˆrequestï¼‰ç»“æŸè§¦å‘è¯¥äº‹ä»¶ã€‚å¦‚æœä¸€ä¸ªbeanå®ç°äº†ApplicationListeneræ¥å£ï¼Œå½“ä¸€ä¸ªApplicationEvent è¢«å‘å¸ƒä»¥åï¼Œbeanä¼šè‡ªåŠ¨è¢«é€šçŸ¥ã€‚</li></ol><h4 id="12-BeanFactory-å’Œ-ApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#12-BeanFactory-å’Œ-ApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="12.BeanFactory å’Œ ApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>12.<strong>BeanFactory å’Œ ApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>BeanFactory æ˜¯åŸºç¡€iocå®¹å™¨ï¼Œæ‹¥æœ‰åŸºæœ¬çš„iocå®¹å™¨åŠŸèƒ½</p><p>ApplicationContext æ˜¯BeanFactory çš„å­ç±»ï¼Œæ‹¥æœ‰BeanFactory çš„å…¨éƒ¨åŠŸèƒ½ã€‚è¿˜æ‰©å±•äº†å…¶ä»–åŠŸèƒ½:å›½é™…åŒ–</p><p>BeanFactory é‡‡ç”¨å»¶è¿ŸåŠ è½½beanï¼ŒApplicationContextä¸€æ¬¡æ€§åŠ è½½bean</p><p>BeanFactoryå’ŒApplicationContextéƒ½æ”¯æŒ BeanPostProcessorã€BeanFactoryPostProcessorã€‚</p><p>BeanFactory éœ€è¦æ‰‹åŠ¨æ³¨å†Œã€‚ApplicationContextè‡ªåŠ¨æ³¨å†Œ</p><h4 id="13-springæœ‰å“ªäº›ä¾èµ–æ³¨å…¥æ–¹å¼"><a href="#13-springæœ‰å“ªäº›ä¾èµ–æ³¨å…¥æ–¹å¼" class="headerlink" title="13.springæœ‰å“ªäº›ä¾èµ–æ³¨å…¥æ–¹å¼?"></a>13.springæœ‰å“ªäº›ä¾èµ–æ³¨å…¥æ–¹å¼?</h4><p>1.æ„é€ å™¨æ³¨å…¥ 2.setæ³¨å…¥</p><p>æ„é€ å™¨å‚æ•°å®ç°å¼ºåˆ¶ä¾èµ–ï¼Œsetteræ–¹æ³•å®ç°å¯é€‰ä¾èµ–</p><h4 id="14-ä»€ä¹ˆæ˜¯spring-beans"><a href="#14-ä»€ä¹ˆæ˜¯spring-beans" class="headerlink" title="14.ä»€ä¹ˆæ˜¯spring beans?"></a>14.ä»€ä¹ˆæ˜¯spring beans?</h4><p>å°±æ˜¯java å¯¹è±¡,å®ƒä»¬è¢«Spring IOCå®¹å™¨åˆå§‹åŒ–ï¼Œè£…é…ï¼Œç®¡ç†ã€‚</p><h4 id="15-ä¸€ä¸ªspring-beanå®šä¹‰åŒ…å«ä»€ä¹ˆ"><a href="#15-ä¸€ä¸ªspring-beanå®šä¹‰åŒ…å«ä»€ä¹ˆ" class="headerlink" title="15.ä¸€ä¸ªspring beanå®šä¹‰åŒ…å«ä»€ä¹ˆ?"></a>15.ä¸€ä¸ªspring beanå®šä¹‰åŒ…å«ä»€ä¹ˆ?</h4><p>beançš„åˆ›å»º, ç”Ÿå‘½å‘¨æœŸï¼Œä¾èµ–</p><h4 id="16-spring-beançš„ä½œç”¨åŸŸ"><a href="#16-spring-beançš„ä½œç”¨åŸŸ" class="headerlink" title="16.spring beançš„ä½œç”¨åŸŸ?"></a>16.spring beançš„ä½œç”¨åŸŸ?</h4><p>é€šçŸ¥è®¾ç½®beançš„ scopeå±æ€§æ¥å®šä¹‰beançš„ä½œç”¨åŸŸ,ä½œç”¨åŸŸç±»å‹æœ‰:</p><p><strong>1.singleton :</strong> beanåœ¨æ¯ä¸ªiocå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</p><p><strong>2.prototype</strong>ï¼šä¸€ä¸ªbeançš„å®šä¹‰å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ã€‚(å¼€é”€å¤§)</p><p><strong>3.request</strong>ï¼šæ¯æ¬¡httpè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªbean(åŸºäºwebçš„Spring ApplicationContextæƒ…å½¢ä¸‹æœ‰æ•ˆ)</p><p><strong>4.session</strong>ï¼šåœ¨ä¸€ä¸ªHTTP Sessionä¸­ï¼Œä¸€ä¸ªbeanå®šä¹‰å¯¹åº”ä¸€ä¸ªå®ä¾‹ã€‚(åŸºäºwebçš„Spring ApplicationContextæƒ…å½¢ä¸‹æœ‰æ•ˆ)</p><p><strong>5.global-session</strong>ï¼šåœ¨ä¸€ä¸ªå…¨å±€çš„HTTP Sessionä¸­ï¼Œä¸€ä¸ªbeanå®šä¹‰å¯¹åº”ä¸€ä¸ªå®ä¾‹ã€‚(åŸºäºwebçš„Spring ApplicationContextæƒ…å½¢ä¸‹æœ‰æ•ˆ)</p><h4 id="17-spring-ä¸­çš„å•ä¾‹beanæ˜¯çº¿ç¨‹å®‰å…¨ä¹ˆ"><a href="#17-spring-ä¸­çš„å•ä¾‹beanæ˜¯çº¿ç¨‹å®‰å…¨ä¹ˆ" class="headerlink" title="17.spring ä¸­çš„å•ä¾‹beanæ˜¯çº¿ç¨‹å®‰å…¨ä¹ˆ?"></a>17.spring ä¸­çš„å•ä¾‹beanæ˜¯çº¿ç¨‹å®‰å…¨ä¹ˆ?</h4><p>ä¸æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œå¤§éƒ¨åˆ†å•ä¾‹beanæ˜¯æ— çŠ¶æ€çš„ï¼Œæ¯”å¦‚ dao ç±»ï¼ŒæŸç§ç¨‹åº¦æ¥è¯´ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚</p><h4 id="18-spring-beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#18-spring-beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="18.spring beançš„ç”Ÿå‘½å‘¨æœŸ?"></a>18.spring beançš„ç”Ÿå‘½å‘¨æœŸ?</h4><p>1.å®ä¾‹åŒ–ï¼Œåˆ›å»ºbeanå¯¹è±¡</p><p>2.å±æ€§å¡«å……</p><p>3.åˆå§‹åŒ–</p><p>3.1.å®ç°äº†xxxAwareç±»å‹çš„æ¥å£ï¼Œé€šè¿‡ä¸åŒç±»å‹çš„Awareæ¥å£æ‹¿åˆ°Springå®¹å™¨çš„èµ„æº</p><p>3.1.1.ç®€å•çš„awareç±»å‹æ¥å£ BeanNameAware BeanClassLoaderAware BeanFactoryAware</p><p>3.2.å®ç°äº†beanPostProcessoræ¥å£ï¼Œåˆ™ä¼šåœ¨åˆå§‹åŒ–å‰åå›è°ƒ<code>postProcessBeforeInitialzation</code>å’Œ<code>postProcessAfterInitialization</code>æ–¹æ³•</p><p>3.3.é…ç½®äº†init-mothodæ–¹æ³•ï¼Œåˆ™ä¼šæ‰§è¡Œé…ç½®çš„æ–¹æ³•</p><p>4.é”€æ¯</p><p>4.1.beanå®ç°äº†DisposableBeanï¼Œåˆ™ä¼šå›è°ƒdestroyæ–¹æ³•</p><p>4.2.é…ç½®äº†destroy-methodæ–¹æ³•ï¼Œåˆ™ä¼šæ‰§è¡Œé…ç½®çš„æ–¹æ³•</p><h4 id="19-Autowiredå’Œ-Resource"><a href="#19-Autowiredå’Œ-Resource" class="headerlink" title="19.@Autowiredå’Œ@Resource?"></a>19.<strong>@Autowiredå’Œ</strong>@Resource?</h4><p>1.@Autowiredé»˜è®¤æŒ‰ç±»å‹è£…é…ï¼ŒæŸ¥è¯¢ç»“æœä¸ºä¸€ä¸ªæ—¶ï¼Œç›´æ¥è£…é…ã€‚æŸ¥è¯¢ç»“æœä¸ºå¤šä¸ªæ—¶ï¼ŒæŒ‰åç§°è£…é…ã€‚æŸ¥è¯¢ä¸åˆ°åˆ™æŠ¥é”™ã€‚ä¸æŠ¥é”™åˆ™è®¾ç½®å±æ€§required=falseã€‚å¯ä»¥é…å’Œ@Qualifier æŒ‰åå­—è£…é…</p><p>2.@Resourceé»˜è®¤æŒ‰åå­—è£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŒ‰ç…§ç±»å‹è£…é…ã€‚æŒ‡å®šnameå±æ€§åˆ™æŒ‰åç§°è£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ¥é”™ã€‚æŒ‡å®štypeåˆ™æŒ‰ç…§ç±»å‹è£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ¥é”™</p><h4 id="20-FactoryBean-å’Œ-BeanFactoryæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#20-FactoryBean-å’Œ-BeanFactoryæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="20.FactoryBean å’Œ BeanFactoryæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>20.<strong>FactoryBean å’Œ BeanFactoryæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><p>BeanFactory æ˜¯ Bean çš„å·¥å‚ï¼Œ ApplicationContext çš„çˆ¶ç±»ï¼ŒIOC å®¹å™¨çš„æ ¸å¿ƒï¼Œè´Ÿè´£ç”Ÿäº§å’Œç®¡ç† Bean å¯¹è±¡ã€‚</p><p>FactoryBean æ˜¯ Beanï¼Œå¯ä»¥é€šè¿‡å®ç° FactoryBean æ¥å£å®šåˆ¶å®ä¾‹åŒ– Bean çš„é€»è¾‘ï¼Œé€šè¿‡ä»£ç†ä¸€ä¸ªBeanå¯¹è±¡ï¼Œå¯¹æ–¹æ³•å‰ååšä¸€äº›æ“ä½œã€‚</p><h4 id="21-Spring-å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ"><a href="#21-Spring-å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ" class="headerlink" title="21.Spring å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ"></a>21.<strong>Spring å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–ï¼Ÿ</strong></h4><p>springé€šè¿‡ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–:</p><ul><li>singletonObjects ä¸€çº§ç¼“å­˜ï¼Œç”¨äºä¿å­˜å®ä¾‹åŒ–ã€æ³¨å…¥ã€åˆå§‹åŒ–å®Œæˆçš„beanå®ä¾‹</li><li>earlySingletonObjects äºŒçº§ç¼“å­˜ï¼Œç”¨äºä¿å­˜å®ä¾‹åŒ–å®Œæˆçš„beanå®ä¾‹</li><li>singletonFactories ä¸‰çº§ç¼“å­˜ï¼Œç”¨äºä¿å­˜beanåˆ›å»ºå·¥å‚ï¼Œä»¥ä¾¿äºåé¢æ‰©å±•æœ‰æœºä¼šåˆ›å»ºä»£ç†å¯¹è±¡ã€‚</li></ul><h4 id="22-ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼ŸäºŒçº§ç¼“å­˜ä¸è¡Œä¹ˆ"><a href="#22-ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼ŸäºŒçº§ç¼“å­˜ä¸è¡Œä¹ˆ" class="headerlink" title="22.ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼ŸäºŒçº§ç¼“å­˜ä¸è¡Œä¹ˆ?"></a>22.ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼ŸäºŒçº§ç¼“å­˜ä¸è¡Œä¹ˆ?</h4><p>ä¸‰çº§ç¼“å­˜æ˜¯ä¸ºäº†ä¿è¯ä¸ç®¡ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚</p><p>å¦‚æœä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œå¤šçº¿ç¨‹æƒ…å†µä¸‹å¯èƒ½è·å–çš„å¯¹è±¡ä¸ä¸€è‡´</p><h4 id="23-springè§£å†³å¾ªç¯ä¾èµ–çš„æ–¹æ³•"><a href="#23-springè§£å†³å¾ªç¯ä¾èµ–çš„æ–¹æ³•" class="headerlink" title="23.springè§£å†³å¾ªç¯ä¾èµ–çš„æ–¹æ³•?"></a>23.springè§£å†³å¾ªç¯ä¾èµ–çš„æ–¹æ³•?</h4><p>ä½¿ç”¨<code>@Lazy</code>æ³¨è§£ï¼Œå»¶è¿ŸåŠ è½½</p><p>ä½¿ç”¨<code>@DependsOn</code>æ³¨è§£ï¼ŒæŒ‡å®šåŠ è½½å…ˆåå…³ç³»</p><h4 id="24-springçš„äº‹åŠ¡ä¼ æ’­æ–¹å¼ï¼Ÿ"><a href="#24-springçš„äº‹åŠ¡ä¼ æ’­æ–¹å¼ï¼Ÿ" class="headerlink" title="24.springçš„äº‹åŠ¡ä¼ æ’­æ–¹å¼ï¼Ÿ"></a>24.springçš„äº‹åŠ¡ä¼ æ’­æ–¹å¼ï¼Ÿ</h4><p>required å½“å‰æ²¡æœ‰äº‹åŠ¡åˆ™åˆ›å»ºäº‹åŠ¡ï¼Œå­˜åœ¨äº‹åŠ¡åˆ™åŠ å…¥ã€‚</p><p>requires_new ä¸ç®¡æœ‰æ²¡äº‹åŠ¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡æ‰§è¡Œã€‚</p><p>supports å­˜åœ¨äº‹åŠ¡åˆ™åŠ å…¥ï¼Œä¸å­˜åœ¨åˆ™å·²éäº‹åŠ¡åªæƒ³ã€‚</p><p>not_supported ä»¥éäº‹åŠ¡æ‰§è¡Œï¼Œå­˜åœ¨äº‹åŠ¡åˆ™æŒ‚èµ·</p><p>mandatory å­˜åœ¨äº‹åŠ¡åˆ™åŠ å…¥ï¼Œä¸å­˜åœ¨åˆ™æŠ¥é”™</p><p>never ä»¥éäº‹åŠ¡æ‰§è¡Œï¼Œå­˜åœ¨äº‹åŠ¡åˆ™æŠ¥é”™</p><p>nested å­˜åœ¨äº‹åŠ¡åˆ™åµŒå¥—äº‹åŠ¡æ‰§è¡Œ</p><h4 id="25-spring-äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a href="#25-spring-äº‹åŠ¡çš„éš”ç¦»çº§åˆ«" class="headerlink" title="25.spring äº‹åŠ¡çš„éš”ç¦»çº§åˆ«?"></a>25.spring äº‹åŠ¡çš„éš”ç¦»çº§åˆ«?</h4><p>default ä½¿ç”¨æ•°æ®åº“è®¾ç½®çš„</p><p>read_uncommitted è¯»æœªæäº¤(å‡ºç°å¹»è¯»ã€è„è¯»ã€ä¸å¯é‡å¤è¯»)</p><p>read_committed è¯»å·²æäº¤,è¯»çš„éƒ½æ˜¯åˆ«çš„äº‹åŠ¡å·²æäº¤çš„ï¼ˆä¼šé€ æˆå¹»è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰sql serveré»˜è®¤çº§åˆ«</p><p>repeatable_read å¯é‡å¤è¯»ï¼Œä¿è¯å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œå…¶å€¼éƒ½å’Œäº‹åŠ¡å¼€å§‹æ—¶å€™çš„å†…å®¹æ˜¯ä¸€è‡´ï¼Œç¦æ­¢è¯»å–åˆ°åˆ«çš„äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼ˆä¼šé€ æˆå¹»è¯»)</p><p>serializable ä¸²è¡Œï¼Œä»£ä»·æœ€é«˜æœ€å¯é çš„éš”ç¦»çº§åˆ«ï¼Œè¯¥éš”ç¦»çº§åˆ«èƒ½é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚</p><p><strong>è„è¯»</strong> ï¼šè¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡èƒ½å¤Ÿè¯»å–å¦ä¸€ä¸ªäº‹åŠ¡ä¸­è¿˜æœªæäº¤çš„æ•°æ®ã€‚</p><p><strong>ä¸å¯é‡å¤è¯»</strong> ï¼šæ˜¯æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚è¯»å–çš„æ•°æ®ä¸ä¸€è‡´</p><p><strong>å¹»è¯»</strong> ï¼šæŒ‡åŒä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡æŸ¥è¯¢è¿”å›çš„ç»“æœé›†ä¸ä¸€æ ·ã€‚</p><h4 id="26-ä»€ä¹ˆæ˜¯spring-mvc"><a href="#26-ä»€ä¹ˆæ˜¯spring-mvc" class="headerlink" title="26 .ä»€ä¹ˆæ˜¯spring mvc?"></a>26 .ä»€ä¹ˆæ˜¯spring mvc?</h4><p>åŸºäºjavaå®ç°äº†mvcè®¾è®¡æ¨¡å¼è¯·æ±‚é©±åŠ¨ç±»å‹çš„è½»é‡çº§æ¡†æ¶ï¼ŒæŠŠæ¨¡å‹ï¼Œè§†å›¾ï¼Œæ§åˆ¶å™¨åˆ†ç¦»å‡ºæ¥ã€‚å°†webå±‚è¿›è¡ŒèŒè´£è§£è€¦ï¼Œç®€åŒ–å¼€å‘</p><h4 id="27-spring-mvcå·¥ä½œåŸç†ï¼Ÿ"><a href="#27-spring-mvcå·¥ä½œåŸç†ï¼Ÿ" class="headerlink" title="27.spring mvcå·¥ä½œåŸç†ï¼Ÿ"></a>27.spring mvcå·¥ä½œåŸç†ï¼Ÿ</h4><p>1.ç”¨æˆ·å‘é€è¯·æ±‚åˆ°å‰ç«¯æ§åˆ¶å™¨(DispatcherServlet)</p><p>2.å‰ç«¯æ§åˆ¶å™¨è°ƒç”¨å¤„ç†å™¨æ˜ å°„å™¨(HandlerMapping)</p><p>3.å¤„ç†å™¨æ˜ å°„å™¨æ ¹æ®urlæ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨ï¼ˆHandlerï¼‰ï¼Œç”Ÿæˆå¤„ç†å™¨å¯¹è±¡ï¼Œå¦‚æœæœ‰æ‹¦æˆªå™¨ä¸€èµ·è¿”å›ç»™å‰ç«¯æ§åˆ¶å™¨</p><p>4.å‰ç«¯æ§åˆ¶å™¨è°ƒç”¨å¤„ç†å™¨é€‚é…å™¨ï¼ˆHandlerAdapterï¼‰ï¼Œç»è¿‡é€‚é…å™¨è°ƒç”¨åç«¯æ§åˆ¶å™¨</p><p>5.æ‰§è¡Œå®Œæ¯•åè¿”å›ModelAndViewï¼Œå¤„ç†å™¨é€‚é…å™¨å°†ç»“æœè¿”å›å‰ç«¯æ§åˆ¶å™¨</p><p>6.å‰ç«¯æ§åˆ¶å™¨ä¼ ç»™è¯•å›¾è§£æå™¨ï¼ˆViewResolverï¼‰è¿›è¡Œè§£æ,è¿”å›å…·ä½“çš„è§†å›¾(view)ï¼Œè¿›è¡Œæ¸²æŸ“è¿”å›ç»™ç”¨æˆ·</p><h4 id="28-spring-iocå®¹å™¨æ„å»ºæµç¨‹"><a href="#28-spring-iocå®¹å™¨æ„å»ºæµç¨‹" class="headerlink" title="28.spring iocå®¹å™¨æ„å»ºæµç¨‹?"></a>28.spring iocå®¹å™¨æ„å»ºæµç¨‹?</h4><p>1.è·å–ä¸€ä¸ªæ–°çš„beanå·¥å‚ï¼Œé€šå¸¸æ˜¯applicationContext</p><p>2.åŠ è½½å’Œè§£æspringé…ç½®æ–‡ä»¶ï¼Œè§£æbeanå¯¹è±¡å°è£…æˆbeanDefinitionæ”¾åˆ°æœ¬åœ°ç¼“å­˜</p><p>3.å®ä¾‹åŒ–å’Œè°ƒç”¨beanFactoryPostProcessorçš„BeanDefinitionRegistryPostProcessorçš„æ‰©å±•æ–¹æ³•</p><p>4.å®ä¾‹åŒ–beanPostProcessor,åŠ è½½åˆ°beanFactoryä¸­ã€‚åœ¨beançš„åˆå§‹åŒ–å‰åè§¦å‘æ‰©å±•ç‚¹postProcessBeforeInitialization() / postProcessAfterInitialization()</p><p>5.å®ä¾‹åŒ–æ‰€æœ‰å‰©ä½™çš„beanï¼ŒåŒ…æ‹¬åˆ›å»ºbeanï¼Œå±æ€§å¡«å……ï¼Œåˆå§‹åŒ–</p><p>6.å®Œæˆå®¹å™¨åˆ·æ–°ï¼Œæ¨é€ä¸Šä¸‹æ–‡åˆ·æ–°äº‹ä»¶(contextRefresEvent)åˆ°ç›‘å¬å™¨</p><h4 id="29-spring-bootå¯åŠ¨æµç¨‹ï¼Ÿ"><a href="#29-spring-bootå¯åŠ¨æµç¨‹ï¼Ÿ" class="headerlink" title="29.spring bootå¯åŠ¨æµç¨‹ï¼Ÿ"></a>29.spring bootå¯åŠ¨æµç¨‹ï¼Ÿ</h4><p>1.åˆ›å»ºspringApplicationå®ä¾‹ä»¥åŠåˆå§‹åŒ–</p><p>2.é€šè¿‡SpringFactoriesLoaderåŠ è½½ç›‘å¬å™¨,å‘å¸ƒEventPublishingRunListener.<strong>starting()äº‹ä»¶</strong>ï¼›</p><p>3.åˆ›å»ºå’Œé…ç½®Environmentï¼Œè§¦å‘ConfigFileApplicationListenerç›‘å¬å™¨,åŠ è½½application.properties/ymlé…ç½®æ–‡ä»¶</p><p>4.åˆ›å»ºApplicationContext,å®¹å™¨åˆ·æ–°çš„äº‹å‰å‡†å¤‡ï¼Œå®¹å™¨åˆ·æ–°(iocå®¹å™¨åˆ›å»ºæµç¨‹)ï¼Œå‘å¸ƒä¸Šä¸‹æ–‡åˆ·æ–°å®Œæ¯•äº‹ä»¶</p><p>5.å‘å¸ƒSpringBootç¨‹åºå·²å¯åŠ¨äº‹ä»¶ApplicationStartedEvent</p><p>6.è°ƒç”¨ApplicationRunnerå’ŒCommandLineRunner</p><p>7.æœ€åå‘å¸ƒrefreshå®Œæ¯•ã€runneræ‰§è¡Œå®Œæ¯•çš„äº‹ä»¶</p><h4 id="30-springäº‹åŠ¡å®ç°çš„åŸç†"><a href="#30-springäº‹åŠ¡å®ç°çš„åŸç†" class="headerlink" title="30.springäº‹åŠ¡å®ç°çš„åŸç†?"></a>30.springäº‹åŠ¡å®ç°çš„åŸç†?</h4><p>é€šè¿‡aop+threadLocal+try/catchå®ç°:</p><p>åŠ¨æ€ä»£ç†ï¼šåŸºæœ¬æ‰€æœ‰è¦è¿›è¡Œé€»è¾‘å¢å¼ºçš„åœ°æ–¹éƒ½ä¼šç”¨åˆ°åŠ¨æ€ä»£ç†ï¼ŒAOP åº•å±‚ä¹Ÿæ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å®ç°ã€‚</p><p>ThreadLocalï¼šä¸»è¦ç”¨äºçº¿ç¨‹é—´çš„èµ„æºéš”ç¦»ï¼Œä»¥æ­¤å®ç°ä¸åŒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®æºã€éš”ç¦»çº§åˆ«ç­‰ç­‰ã€‚</p><p>try/catchï¼šæœ€ç»ˆæ˜¯æ‰§è¡Œ commit è¿˜æ˜¯ rollbackï¼Œæ˜¯æ ¹æ®ä¸šåŠ¡é€»è¾‘å¤„ç†æ˜¯å¦æŠ›å‡ºå¼‚å¸¸æ¥å†³å®šã€‚</p><h4 id="31-springå¸¸è§çš„æ‰©å±•ç‚¹"><a href="#31-springå¸¸è§çš„æ‰©å±•ç‚¹" class="headerlink" title="31.springå¸¸è§çš„æ‰©å±•ç‚¹?"></a>31.springå¸¸è§çš„æ‰©å±•ç‚¹?</h4><p>1.BeanFactoryPostProcessor</p><p>postProcessBeanFactory æ–¹æ³•ï¼Œåœ¨åŠ è½½å®Œ Bean å®šä¹‰ä¹‹åï¼Œåˆ›å»º Bean å®ä¾‹ä¹‹å‰è¢«è§¦å‘ï¼Œé€šå¸¸ä½¿ç”¨è¯¥æ‰©å±•ç‚¹æ¥åŠ è½½ä¸€äº›è‡ªå·±çš„ bean å®šä¹‰ã€‚</p><p>2.BeanPostProcessor</p><p>postProcessBeforeInitialization æ–¹æ³•ï¼Œæ‰§è¡Œ bean çš„åˆå§‹åŒ–æ–¹æ³•å‰è¢«è§¦å‘ï¼›</p><p>postProcessAfterInitialization æ–¹æ³•ï¼Œæ‰§è¡Œ bean çš„åˆå§‹åŒ–æ–¹æ³•åè¢«è§¦å‘ã€‚</p><p>2.InitializingBean</p><p>afterPropertiesSet æ–¹æ³•ï¼Œåœ¨ bean çš„å±æ€§å¡«å……ä¹‹åï¼Œåˆå§‹åŒ–æ–¹æ³•ï¼ˆinit-methodï¼‰ä¹‹å‰è¢«è§¦å‘</p><p>3.DisposableBean</p><p>destroy æ–¹æ³•ï¼Œåœ¨ bean çš„é”€æ¯é˜¶æ®µè¢«è§¦å‘ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨åŸºæœ¬ç­‰åŒäº</p><p>destroy-methodï¼Œä¸»ç”¨ç”¨äºæ‰§è¡Œé”€æ¯ç›¸å…³æ“ä½œã€‚</p><h4 id="32-springbootå¦‚ä½•å®ç°è‡ªåŠ¨è£…é…"><a href="#32-springbootå¦‚ä½•å®ç°è‡ªåŠ¨è£…é…" class="headerlink" title="32.springbootå¦‚ä½•å®ç°è‡ªåŠ¨è£…é…?"></a>32.springbootå¦‚ä½•å®ç°è‡ªåŠ¨è£…é…?</h4><p>å¯åŠ¨ç±»ä¸­@SpringbootApplicaiton æ³¨è§£æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª@EnableAutoConfigurationæ³¨è§£ã€‚</p><p>è¿™ä¸ªæ³¨è§£ç±»ä¸­ä½¿ç”¨@Importæ³¨è§£åŠ è½½EnableAutoConfigurationImportSelectorç±»ã€‚è¿™ä¸ªç±»æ˜¯åœ¨spring-autoConfigåŒ…ä¸­ã€‚ä»–ä¼šåŠ è½½åŒ…ä¸­çš„spring.factoriesæ–‡ä»¶å†…å®šä¹‰çš„autoconfigurationç±»ã€‚</p><h4 id="33-å¦‚ä½•è‡ªå·±å®ç°ä¸€ä¸ªstarter"><a href="#33-å¦‚ä½•è‡ªå·±å®ç°ä¸€ä¸ªstarter" class="headerlink" title="33.å¦‚ä½•è‡ªå·±å®ç°ä¸€ä¸ªstarter?"></a>33.å¦‚ä½•è‡ªå·±å®ç°ä¸€ä¸ªstarter?</h4><p>starterç®€å•æ¥è¯´å°±æ˜¯å°†ä¸€ä¸ªç¹ççš„æ“ä½œæ‰“åŒ…æˆä¸€ä¸ªjarï¼Œè®©ä½ ç›´æ¥åŠ å…¥è¿™ä¸ªä¾èµ–ï¼Œçœå»ç¹ççš„æ­¥éª¤</p><ol><li>åˆ›å»ºä¸€ä¸ªstarteré¡¹ç›®</li><li>åˆ›å»ºä¸€ä¸ªConfigurationPropertiesç”¨äºä¿å­˜ä½ çš„é…ç½®ä¿¡æ¯ï¼ˆ</li><li>åˆ›å»ºä¸€ä¸ªAutoConfigurationï¼Œå¼•ç”¨å®šä¹‰å¥½çš„é…ç½®ä¿¡æ¯ï¼›åœ¨AutoConfigurationä¸­å®ç°æ‰€æœ‰starteråº”è¯¥å®Œæˆçš„æ“ä½œï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªç±»åŠ å…¥spring.factoriesé…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå£°æ˜</li><li>æ‰“åŒ…é¡¹ç›®ï¼Œä¹‹ååœ¨ä¸€ä¸ªSpringBooté¡¹ç›®ä¸­å¼•å…¥è¯¥é¡¹ç›®ä¾èµ–ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨è¯¥starteräº†</li></ol><h3 id="2ã€â€”"><a href="#2ã€â€”" class="headerlink" title="2ã€â€”"></a>2ã€â€”</h3><h2 id="Nã€è®¾è®¡é¢˜"><a href="#Nã€è®¾è®¡é¢˜" class="headerlink" title="Nã€è®¾è®¡é¢˜"></a>Nã€è®¾è®¡é¢˜</h2><h3 id="1ã€MQå®ç°å¼‚æ­¥ç§’æ€"><a href="#1ã€MQå®ç°å¼‚æ­¥ç§’æ€" class="headerlink" title="1ã€MQå®ç°å¼‚æ­¥ç§’æ€"></a>1ã€MQå®ç°å¼‚æ­¥ç§’æ€</h3><h4 id="1ã€ä»‹ç»"><a href="#1ã€ä»‹ç»" class="headerlink" title="1ã€ä»‹ç»"></a>1ã€ä»‹ç»</h4><p>åœºæ™¯ï¼šä¸€ä¸‡ä»¶å•†å“åŒæ—¶è¢«ä¸€ä¸‡äººç§’æ€æˆåŠŸï¼Œä¼šå¯¼è‡´ç¬é—´ä¸Šä¸‡è¯·æ±‚è®¿é—®åˆ°è®¢å•æ•°æ®åº“ä¸­åˆ›å»ºè®¢å•ã€‚æ­¤æ—¶å¯¹æ•°æ®åº“çš„å‹åŠ›å°±ä¼šå¾ˆå¤§ã€‚</p><p>æ–¹æ¡ˆï¼šå¼•å…¥RocketMQè¿›è¡Œå‰Šå³°å¤„ç†ã€‚</p><p>æ¯ä¸ªè¯·æ±‚è¿›æ¥åœ¨Redisä¸­ç§’æ€åº“å­˜æˆåŠŸï¼Œå°±è®¤ä¸ºéœ€è¦ç”Ÿæˆè®¢å•ï¼Œæ­¤æ—¶å‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ°RocketMQä¸­å»ã€‚</p><p>ç„¶åè®©æ™®é€šè®¢å•ç³»ç»Ÿä»RocketMQä¸­æ¶ˆè´¹ç§’æ€æˆåŠŸçš„æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚å¯¹äºMQæ¥è¯´ï¼Œè¿™ç§ä¸Šä¸‡çš„æ¶ˆæ¯ç§¯å‹å¾ˆå®¹æ˜“å°±æ‰›ä¸‹æ¥äº†ï¼Œåªè¦è¿‡äº†é«˜å³°æœŸï¼Œè®¢å•ç³»ç»Ÿå¾ˆå¿«å°±èƒ½æ¶ˆè´¹ã€å¤„ç†å®Œã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šå¯¹è®¢å•æ•°æ®åº“é€ æˆè¿‡å¤§çš„å‹åŠ›</p><h4 id="2ã€æ¶æ„å›¾"><a href="#2ã€æ¶æ„å›¾" class="headerlink" title="2ã€æ¶æ„å›¾"></a>2ã€æ¶æ„å›¾</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202302272128319.png"></p><h4 id="3ã€æ€»ç»“"><a href="#3ã€æ€»ç»“" class="headerlink" title="3ã€æ€»ç»“"></a>3ã€æ€»ç»“</h4><ul><li>åœ¨å‰ç«¯/å®¢æˆ·ç«¯è®¾ç½®ç§’æ€ç­”é¢˜ï¼Œé”™å¼€å¤§é‡äººä¸‹å•çš„æ—¶é—´ï¼Œç»„ç»‡ä½œå¼Šå™¨åˆ·å•</li><li>ç‹¬ç«‹å‡ºæ¥ä¸€å¥—ç§’æ€ç³»ç»Ÿï¼Œä¸“é—¨è´Ÿè´£å¤„ç†ç§’æ€è¯·æ±‚</li><li>ä¼˜å…ˆåŸºäºRedisè¿›è¡Œé«˜å¹¶å‘çš„åº“å­˜æ‰£å‡ï¼Œä¸€æ—¦åº“å­˜æ‰£å®Œåˆ™ç§’æ€ç»“æŸ</li><li>ç§’æ€ç»“æŸä¹‹åï¼ŒNginxå±‚è¿‡æ»¤æ‰æ— æ•ˆçš„è¯·æ±‚ï¼Œå¤§å¹…åº¦å‰Šå‡è½¬å‘åˆ°åç«¯çš„æµé‡</li><li>ç¬æ—¶ç”Ÿæˆçš„å¤§é‡ä¸‹å•è¯·æ±‚ç›´æ¥è¿›å…¥RocketMQè¿›è¡Œå‰Šå³°ï¼Œè®¢å•ç³»ç»Ÿæ…¢æ…¢æ‹‰å–æ¶ˆæ¯å®Œæˆä¸‹å•æ“ä½œ</li></ul><p>ç§’æ€ç³»ç»Ÿè¡¥å……ï¼š<br>1ã€å¤§é‡ç”¨æˆ·å…ˆè¿›æ¥é¡µé¢è¯¦æƒ…é¡µé¢ï¼Œèµ°CDNé™æ€åŒ–åŠ é€Ÿï¼Œåˆ°Nginxé›†ç¾¤ï¼ˆåŠ¨é™åˆ†ç¦»ï¼‰ï¼Œå…¶æ¬¡å»Redisé›†ç¾¤åŠ è½½ç§’æ€æ•°æ®ï¼ˆè¿™ä¸ªæ•°æ®å¯ä»¥æäº¤å‰ç¼“å­˜é¢„çƒ­ï¼‰ï¼Œç„¶ååˆ°é¡µé¢æ¸²æŸ“ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ç†è®ºæ˜¯æ²¡æœ‰ç»è¿‡åç«¯æœåŠ¡ç³»ç»Ÿæ¸²æŸ“ï¼Œç›´æ¥å‰ç«¯æ¸²æŸ“ï¼Œå…¶å®å¯ä»¥åç«¯æ¸²æŸ“ï¼ˆä¸å»ºè®®ï¼‰<br>2ã€å¤§é‡ç³»ç»Ÿä¸‹å•ï¼Œå…ˆåˆ°å‰ç«¯ç§’æ€ç­”é¢˜ï¼ˆå½“ç„¶ä¹Ÿæœ‰çš„å¯ä»¥é€šè¿‡Nginxå¯¹è¯·æ±‚åˆ‡åˆ†åˆ†æ‰¹ï¼‰ï¼Œç„¶åæŠŠæ— æ•ˆè¯·æ±‚ç»è¿‡Nginxé›†ç¾¤è¿‡æ»¤ï¼›æœ‰æ•ˆè¯·æ±‚è¿›å…¥ç§’æ€ç³»ç»Ÿï¼Œå…³äºåº“å­˜æ•°æ®ä¼šæäº¤é¢„çƒ­åˆ°Redisé›†ç¾¤è¿›è¡Œåº“å­˜æ‰£é™¤ï¼Œå¤§é‡æˆåŠŸçš„è®¢å•è¿›å…¥RocketMQè¿›è¡Œå‰Šå³°ï¼Œè®¢å•ç³»ç»Ÿæ…¢æ…¢æ‹‰å–å®Œæˆä¸‹å•æ“ä½œ</p><h3 id="2ã€RocketMQäº‹åŠ¡æœ€ç»ˆä¸€è‡´æ€§"><a href="#2ã€RocketMQäº‹åŠ¡æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="2ã€RocketMQäº‹åŠ¡æœ€ç»ˆä¸€è‡´æ€§"></a>2ã€RocketMQäº‹åŠ¡æœ€ç»ˆä¸€è‡´æ€§</h3><h4 id="1ã€æ‰§è¡Œæµç¨‹å›¾"><a href="#1ã€æ‰§è¡Œæµç¨‹å›¾" class="headerlink" title="1ã€æ‰§è¡Œæµç¨‹å›¾"></a>1ã€æ‰§è¡Œæµç¨‹å›¾</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303012201093.png"></p><p>1ã€é¦–å…ˆæœåŠ¡ A å‘é€ä¸€ä¸ªåŠäº‹åŠ¡æ¶ˆæ¯(ä¹Ÿç§° half æ¶ˆæ¯)è‡³ MQ ä¸­ã€‚ä¸ºä»€ä¹ˆè¦å…ˆå‘é€ä¸€ä¸ª half æ¶ˆæ¯å‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†ä¿è¯æœåŠ¡ A å’Œ MQ ä¹‹é—´çš„é€šä¿¡æ­£å¸¸ï¼Œå¦‚æœæ— æ³•æ­£å¸¸é€šä¿¡ï¼Œåˆ™æœåŠ¡ A å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªå¼‚å¸¸ï¼Œä¹Ÿå°±ä¸ç”¨å¤„ç†åé¢çš„é€»è¾‘çš„äº†ã€‚</p><p>2ã€å¦‚æœ half æ¶ˆæ¯å‘é€æˆåŠŸï¼ŒMQ æ”¶åˆ°è¿™ä¸ª half æ¶ˆæ¯åï¼Œä¼šè¿”å›ä¸€ä¸ª success å“åº”ç»™æœåŠ¡ Aã€‚</p><p>3ã€æœåŠ¡ A æ¥æ”¶åˆ° MQ è¿”å›çš„ success å“åº”åï¼Œå¼€å§‹å¤„ç†æœ¬åœ°çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶æäº¤æœ¬åœ°äº‹åŠ¡ã€‚</p><p>4ã€å¦‚æœæœåŠ¡ A æœ¬åœ°äº‹åŠ¡æäº¤æˆåŠŸï¼Œåˆ™ä¼šå‘ MQ ä¸­å‘é€ commitï¼Œè¡¨ç¤ºå°† half æ¶ˆæ¯æäº¤ï¼ŒMQ å°±ä¼šæ‰§è¡Œç¬¬ 5 æ­¥æ“ä½œï¼›å¦‚æœæœåŠ¡ A æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥ï¼Œåˆ™ç›´æ¥å›æ»šæœ¬åœ°äº‹åŠ¡ï¼Œå¹¶å‘ MQ ä¸­å‘é€ rollbackï¼Œè¡¨ç¤ºå°†ä¹‹å‰çš„ half æ¶ˆæ¯è¿›è¡Œå›æ»šï¼ŒMQ æ¥æ”¶åˆ° rollback æ¶ˆæ¯åï¼Œå°±ä¼šå°† half æ¶ˆæ¯åˆ é™¤ã€‚</p><p>5ã€å¦‚æœ commitï¼Œåˆ™å°† half æ¶ˆæ¯å†™å…¥åˆ°ç£ç›˜ã€‚</p><p>6ã€å¦‚æœ MQ é•¿æ—¶é—´æ²¡æœ‰æ¥æ”¶åˆ° commit æˆ–è€… rollback æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼šæœåŠ¡ A åœ¨å¤„ç†æœ¬åœ°ä¸šåŠ¡æ—¶å®•æœºäº†ï¼Œæˆ–è€…å‘é€çš„ commitã€rollback å› ä¸ºåœ¨å¼±ç½‘ç¯å¢ƒï¼Œæ•°æ®ä¸¢å¤±äº†ã€‚é‚£ä¹ˆ MQ å°±ä¼šåœ¨ä¸€å®šæ—¶é—´åå°è¯•è°ƒç”¨æœåŠ¡ A æä¾›çš„ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£æ¥åˆ¤æ–­ half æ¶ˆæ¯çš„çŠ¶æ€ã€‚æ‰€ä»¥æœåŠ¡ A æä¾›çš„æ¥å£ï¼Œéœ€è¦å®ç°çš„ä¸šåŠ¡é€»è¾‘æ˜¯ï¼šé€šè¿‡æ•°æ®åº“ä¸­å¯¹åº”æ•°æ®çš„çŠ¶æ€æ¥åˆ¤æ–­ï¼Œä¹‹å‰çš„ half æ¶ˆæ¯å¯¹åº”çš„ä¸šåŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚å¦‚æœ MQ ä»è¿™ä¸ªæ¥å£ä¸­å¾—çŸ¥ half æ¶ˆæ¯æ‰§è¡ŒæˆåŠŸäº†ï¼Œé‚£ä¹ˆ MQ å°±ä¼šå°† half æ¶ˆæ¯æŒä¹…åŒ–åˆ°æœ¬åœ°ç£ç›˜ï¼Œå¦‚æœå¾—çŸ¥æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆå°±ä¼šå°† half æ¶ˆæ¯åˆ é™¤ã€‚</p><p>7ã€æœåŠ¡ B ä» MQ ä¸­æ¶ˆè´¹åˆ°å¯¹åº”çš„æ¶ˆæ¯ã€‚</p><p>8ã€æœåŠ¡ B å¤„ç†æœ¬åœ°ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åæäº¤æœ¬åœ°äº‹åŠ¡ã€‚</p><h4 id="2ã€é—®ç­”é¢˜"><a href="#2ã€é—®ç­”é¢˜" class="headerlink" title="2ã€é—®ç­”é¢˜"></a>2ã€é—®ç­”é¢˜</h4><p><strong>Q: half æ¶ˆæ¯æ˜¯ä¸ªå•¥ï¼Ÿ</strong></p><p>A: å®ƒå’Œæˆ‘ä»¬æ­£å¸¸å‘é€çš„æ™®é€šæ¶ˆæ¯æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨ MQ ä¸­ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ half åœ¨ MQ ä¸­ä¸ä¼šç«‹é©¬è¢«æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ï¼Œé™¤éè¿™ä¸ª half æ¶ˆæ¯è¢« commit äº†ã€‚(è‡³äºä¸ºä»€ä¹ˆæœª commit çš„ half æ¶ˆæ¯æ— æ³•è¢«æ¶ˆè´¹è€…è¯»å–åˆ°ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ MQ å†…éƒ¨ï¼Œå¯¹äºäº‹åŠ¡æ¶ˆæ¯è€Œè¨€ï¼Œåœ¨ commit ä¹‹å‰ï¼Œä¼šå…ˆæ”¾åœ¨ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ—ä¸­ï¼Œåªæœ‰ commit äº†ï¼Œæ‰ä¼šçœŸæ­£å°†æ¶ˆæ¯æ”¾åœ¨æ¶ˆè´¹è€…èƒ½è¯»å–åˆ°çš„ topic é˜Ÿåˆ—ä¸­)</p><p><strong>Q: ä¸ºä»€ä¹ˆè¦å…ˆå‘é€ half æ¶ˆæ¯ï¼Ÿ</strong></p><p>A: å‰é¢å·²ç»è§£é‡Šè¿‡äº†ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯æœåŠ¡ A å’Œ MQ ä¹‹é—´æ˜¯å¦èƒ½æ­£å¸¸é€šä¿¡ï¼Œå¦‚æœä¸¤è€…ä¹‹é—´éƒ½ä¸èƒ½æ­£å¸¸é€šä¿¡ï¼Œåé¢è¿˜ç©ä¸ªé”¤å­ï¼Œç›´æ¥è¿”å›å¼‚å¸¸å°±å¯ä»¥äº†ã€‚</p><p><strong>Q: å¦‚æœ MQ æ¥æ”¶åˆ°äº† half æ¶ˆæ¯ï¼Œä½†æ˜¯åœ¨è¿”å› success å“åº”çš„æ—¶å€™ï¼Œå› ä¸ºç½‘ç»œåŸå› ï¼Œå¯¼è‡´æœåŠ¡ A æ²¡æœ‰æ¥æ”¶åˆ° success å“åº”ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯ä»€ä¹ˆç°è±¡ï¼Ÿ</strong></p><p>A: å½“æœåŠ¡ A å‘é€ half æ¶ˆæ¯åï¼Œå®ƒä¼šç­‰å¾… MQ ç»™è‡ªå·±è¿”å› success å“åº”ï¼Œå¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°ï¼Œé‚£ä¹ˆæœåŠ¡ A ä¹Ÿä¼šç›´æ¥ç»“æŸï¼Œè¿”å›å¼‚å¸¸ï¼Œä¸å†æ‰§è¡Œåç»­é€»è¾‘ã€‚ä¸æ‰§è¡Œåç»­é€»è¾‘ï¼Œè¿™æ ·æœåŠ¡ A ä¹Ÿå°±ä¸ä¼šæäº¤ commit æ¶ˆæ¯ç»™ MQï¼ŒMQ é•¿æ—¶é—´æ²¡æ¥æ”¶åˆ° commit æ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šä¸»åŠ¨å›è°ƒæœåŠ¡ A çš„ä¸€ä¸ªæ¥å£ï¼ŒæœåŠ¡ A é€šè¿‡æ¥å£ï¼ŒæŸ¥è¯¢æœ¬åœ°æ•°æ®åï¼Œå‘ç°è¿™æ¡æ¶ˆæ¯å¯¹åº”çš„ä¸šåŠ¡å¹¶æ²¡æœ‰æ­£å¸¸æ‰§è¡Œï¼Œé‚£ä¹ˆå°±å‘Šè¯‰ MQï¼Œè¿™ä¸ª half æ¶ˆæ¯ä¸èƒ½ commitï¼Œéœ€è¦ rollbackï¼ŒMQ çŸ¥é“åï¼Œå°±å°† half æ¶ˆæ¯è¿›è¡Œåˆ é™¤ã€‚</p><p><strong>Q: å¦‚æœæœåŠ¡ A æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</strong></p><p>A: æœåŠ¡ A æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥åï¼Œå…ˆå¯¹è‡ªå·±æœ¬åœ°äº‹åŠ¡è¿›è¡Œå›æ»šï¼Œç„¶åå†å‘ MQ å‘é€ rollback æ“ä½œã€‚</p><p><strong>Q: æœåŠ¡ A æœ¬åœ°äº‹åŠ¡æäº¤æˆåŠŸæˆ–å¤±è´¥åï¼Œå‘ MQ å‘é€çš„ commit æˆ–è€… rollback æ¶ˆæ¯ï¼Œå› ä¸ºç½‘ç»œé—®é¢˜ä¸¢å¤±äº†ï¼Œåˆè¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ</strong></p><p>A: å’Œä¸Šä¸€ä¸ªé—®é¢˜ä¸€æ ·ï¼ŒMQ é•¿æ—¶é—´æ²¡æœ‰æ¥æ”¶åˆ° half æ¶ˆæ¯çš„ commit æˆ–è€… rollback æ¶ˆæ¯ï¼ŒMQ ä¼šä¸»åŠ¨å›è°ƒæœåŠ¡ A çš„æ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£æ¥åˆ¤æ–­è‡ªå·±è¯¥å¯¹è¿™ä¸ª half æ¶ˆæ¯å¦‚ä½•å¤„ç†ã€‚</p><p><strong>Q: å‰é¢è¯´çš„å…¨æ˜¯äº‹åŠ¡æ¶ˆæ¯çš„å®ç°æµç¨‹ï¼Œè¿™å’Œäº‹åŠ¡æ¶ˆæ¯å¦‚ä½•ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</strong></p><p>A: æœ‰å…³ç³»ã€‚é¦–å…ˆï¼ŒæœåŠ¡ A æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶æäº¤å’Œå‘ MQ ä¸­å‘é€æ¶ˆæ¯è¿™æ˜¯ä¸¤ä¸ªå†™æ“ä½œï¼Œç„¶åé€šè¿‡ RocketMQ çš„äº‹åŠ¡æ¶ˆæ¯ï¼Œæˆ‘ä»¬ä¿è¯äº†è¿™ä¸¤ä¸ªå†™æ“ä½œè¦ä¹ˆéƒ½æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œå¤±è´¥ã€‚ç„¶åè®©å…¶ä»–ç³»ç»Ÿï¼Œå¦‚æœåŠ¡ B é€šè¿‡æ¶ˆè´¹ MQ ä¸­çš„æ¶ˆæ¯ï¼Œç„¶åå†å»æ‰§è¡Œè‡ªå·±æœ¬åœ°çš„äº‹åŠ¡ï¼Œè¿™æ ·åˆ°æœ€åï¼ŒæœåŠ¡ A å’ŒæœåŠ¡ B è¿™ä¸¤ä¸ªç³»ç»Ÿçš„æ•°æ®çŠ¶æ€æ˜¯ä¸æ˜¯è¾¾åˆ°äº†ä¸€è‡´ï¼Ÿè¿™å°±æ˜¯æœ€ç»ˆä¸€è‡´æ€§çš„å«ä¹‰ã€‚</p><p>å¦‚æœè¦æ±‚æœåŠ¡ A å’ŒæœåŠ¡ B çš„æ•°æ®çŠ¶æ€ï¼Œåœ¨æœåŠ¡ A è¿”å›ç»™å®¢æˆ·ç«¯ä¹‹é—´ï¼Œè¿™ä¸¤è€…å°±è¾¾åˆ°ä¸€è‡´ï¼Œè¿™æ˜¯å¼ºä¸€è‡´æ€§ï¼ŒRocketMQ æ˜¯æ²¡æ³•ä¿è¯å¼ºä¸€è‡´æ€§çš„ã€‚</p><p>ç›®å‰é€šè¿‡ã€Œå¯é æ¶ˆæ¯æ¥ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€æ˜¯å¾ˆå¤šå¤§å‚éƒ½é‡‡ç”¨çš„æ–¹æ¡ˆï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ MQ å’Œè¡¥å¿æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ï¼ˆæ‰€è°“çš„å¯é æ¶ˆæ¯ï¼Œå°±æ˜¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œå¦‚ä½•ä¿è¯ MQ çš„æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œä¸‹ç¯‡æ–‡ç« ä¼šå†™ï¼Œè¿™ä¹Ÿæ˜¯é¢è¯•å¸¸è€ƒé¢˜ï¼‰</p><p><strong>Q: æœåŠ¡ B æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</strong></p><p>A: å¦‚æœæœåŠ¡ B æœ¬åœ°äº‹åŠ¡æäº¤å¤±è´¥äº†ï¼Œå¯ä»¥è¿›è¡Œå¤šæ¬¡é‡è¯•ï¼Œç›´åˆ°æˆåŠŸã€‚å¦‚æœé‡è¯•å¤šæ¬¡åï¼Œè¿˜æ˜¯æäº¤å¤±è´¥ï¼Œä¾‹å¦‚æ­¤æ—¶æœåŠ¡ B å¯¹åº”çš„ DB å®•æœºäº†ï¼Œè¿™ä¸ªæ—¶å€™åªè¦æœåŠ¡ B ä¸å‘ MQ æäº¤æœ¬æ¬¡æ¶ˆæ¯çš„ offset å³å¯ã€‚å¦‚æœä¸æäº¤ offsetï¼Œé‚£ä¹ˆ MQ ä¼šåœ¨ä¸€å®šæ—¶é—´åï¼Œç»§ç»­å°†è¿™æ¡æ¶ˆæ¯æ¨é€ç»™æœåŠ¡ Bï¼ŒæœåŠ¡ B å°±å¯ä»¥ç»§ç»­æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶æäº¤äº†ï¼Œç›´åˆ°æˆåŠŸã€‚è¿™æ ·ï¼Œä¾æ—§æ˜¯ä¿è¯äº†æœåŠ¡ A å’ŒæœåŠ¡ B æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><h3 id="3ã€"><a href="#3ã€" class="headerlink" title="3ã€"></a>3ã€</h3><h2 id="Tã€æ•£åˆ—"><a href="#Tã€æ•£åˆ—" class="headerlink" title="Tã€æ•£åˆ—"></a>Tã€æ•£åˆ—</h2><h3 id="1ã€ä¹±æ‰“"><a href="#1ã€ä¹±æ‰“" class="headerlink" title="1ã€ä¹±æ‰“"></a>1ã€ä¹±æ‰“</h3><blockquote><p>é—®é¢˜ï¼šåº“å­˜ä¸ºå•¥åˆ†ä¸º é”å®šåº“å­˜ä»€ä¹ˆçš„ï¼Œæ²¡æœ‰è¿™ä¸ªé”å®šåº“å­˜çš„è¯ï¼ŒæŠ¢è´­æˆåŠŸï¼Œç›´æ¥å¯é”€å”®åº“å­˜ -1 ï¼Œå·²é”€å”®åº“å­˜ + 1 ä¸ä¹Ÿå¯ä»¥å˜›ï¼Œä¸ºå•¥redisçš„ç§’æ€äº§å“ å’Œ æ•°æ®åº“å•†å“è¡¨ï¼Œéƒ½è¦åŠ ä¸Šä»€ä¹ˆé”å®šåº“å­˜å‘¢ï¼Ÿ</p><p>ç­”ï¼šåº“å­˜åˆ†ä¸ºé”å®šåº“å­˜å’Œå¯é”€å”®åº“å­˜çš„åŸå› æ˜¯ä¸ºäº†é¿å…è¶…å–å’Œé‡å¤é”€å”®çš„æƒ…å†µå‘ç”Ÿã€‚åœ¨ç§’æ€åœºæ™¯ä¸­ï¼Œç”±äºç”¨æˆ·çš„å¹¶å‘é‡éå¸¸é«˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤šä¸ªç”¨æˆ·åŒæ—¶ä¸‹å•æˆåŠŸï¼Œä½†å®é™…ä¸Šåº“å­˜åªæœ‰ä¸€ä¸ªï¼Œå¦‚æœä¸åŠ é”å®šåº“å­˜çš„æœºåˆ¶ï¼Œå°±ä¼šå¯¼è‡´è¶…å–çš„æƒ…å†µã€‚è€Œä¸”ï¼Œåœ¨ç”¨æˆ·ä¸‹å•ä¹‹åï¼Œè®¢å•å¹¶ä¸ä¸€å®šä¼šç«‹å³æ”¯ä»˜ï¼Œå¦‚æœå°†å¯é”€å”®åº“å­˜å‡å»ï¼Œå°±æœ‰å¯èƒ½ä¼šå‡ºç°è®¢å•æœªæ”¯ä»˜ä½†åº“å­˜å·²è¢«æ‰£å‡çš„æƒ…å†µï¼Œè¿™ä¹Ÿæ˜¯éœ€è¦é”å®šåº“å­˜çš„åŸå› ã€‚æ‰€ä»¥ï¼Œåœ¨ç§’æ€åœºæ™¯ä¸­ï¼Œä¸ºäº†ä¿è¯åº“å­˜çš„æ­£ç¡®æ€§å’Œå”®åæœåŠ¡çš„è´¨é‡ï¼Œéœ€è¦å¯¹åº“å­˜è¿›è¡Œç»†åˆ†å’Œç®¡ç†ã€‚</p></blockquote><blockquote><p>é—®é¢˜ï¼šHystrix ä¸ºå•¥æ¯æ¬¡è¯·æ±‚éƒ½ç”¨è‡ªå·±çš„çº¿ç¨‹</p><p>ç­”ï¼šHystrix æ˜¯ä¸€ç§åŸºäºçº¿ç¨‹éš”ç¦»çš„æ–­è·¯å™¨æ¨¡å¼å®ç°ã€‚ä¸ºäº†å®ç°çº¿ç¨‹éš”ç¦»ï¼ŒHystrix ä¼šåœ¨æ¯ä¸ªè¢«ä¿æŠ¤çš„ä¾èµ–æœåŠ¡è°ƒç”¨ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ± ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šè¢«åˆ†é…åˆ°è¿™ä¸ªçº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå³ä½¿è¢«ä¿æŠ¤çš„ä¾èµ–æœåŠ¡è°ƒç”¨å‘ç”Ÿæ•…éšœæˆ–å»¶è¿Ÿï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–è¯·æ±‚çš„æ‰§è¡Œï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚</p><p>Hystrix è¿˜å¯ä»¥å¯¹æ¯ä¸ªçº¿ç¨‹æ± è¿›è¡Œé…ç½®ï¼Œæ¯”å¦‚å¯ä»¥è®¾ç½®çº¿ç¨‹æ± çš„å¤§å°ã€é˜Ÿåˆ—çš„å®¹é‡ç­‰å‚æ•°ï¼Œä»¥è¾¾åˆ°æ›´å¥½çš„èµ„æºåˆ©ç”¨å’Œè´Ÿè½½å‡è¡¡æ•ˆæœã€‚å› æ­¤ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä½¿ç”¨è‡ªå·±çš„çº¿ç¨‹ï¼Œå¯ä»¥æ›´å¥½åœ°å®ç°çº¿ç¨‹éš”ç¦»ï¼Œä¿éšœç³»ç»Ÿçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚</p></blockquote><blockquote><p>é—®é¢˜ï¼šåœ¨seataåˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶ä¸‹ï¼Œå¦‚æœä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡åˆ†è¡¨è°ƒç”¨Aã€Bã€CæœåŠ¡ï¼ŒAã€Bè°ƒç”¨æˆåŠŸï¼ŒCè°ƒç”¨å¤±è´¥ï¼Œè¿›è¡Œå›æ»šã€‚åœ¨å›æ»šçš„æ—¶å€™ï¼ŒAã€Bæœ‰æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“æŒä¹…åŒ–ï¼Ÿ</p><p>ç­”ï¼šå…¶å®å·²ç»æˆåŠŸäº†ï¼Œä½†æ˜¯seataåº•å±‚è‡ªåŠ¨ç”Ÿæˆç”¨æ¥å›æ»šçš„sqlï¼ŒæŠŠä½ ä¹‹å‰æ‰§è¡Œçš„æ•°æ®åº“æ›´æ–°ï¼Œç»™åšä¸€ä¸ªåå‘æ“ä½œ</p></blockquote><blockquote><p>é—®é¢˜ï¼šè¿™ä¸ªå¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ¶ˆæ¯é˜²ä¸¢å—ï¼Ÿé‚£RabbitMQä½¿ç”¨æ‰‹åŠ¨ACKä¹Ÿå¯ä»¥å®ç°æ¶ˆæ¯é˜²ä¸¢ï¼Œå› æ­¤RabbitMQä¹Ÿç®—æ˜¯èƒ½å®ç°å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§å—ï¼Ÿ æ€»æ„Ÿè§‰æˆ‘ç†è§£é”™äº†ã€‚<br>ç­”ï¼šå¯¹çš„ï¼Œå…¶å®æ¯ä¸ªMQéƒ½æœ‰è‡ªå·±çš„åŠŸèƒ½ï¼Œå¾€åçœ‹ï¼Œå³ä½¿æ²¡æœ‰RocketMQï¼Œè‡ªå·±åšç‚¹å¼€å‘ï¼Œä¹Ÿèƒ½å®ç°ç±»ä¼¼çš„æ•ˆæœ</p></blockquote><blockquote><p>é—®é¢˜ï¼šåŸºäºå†…å­˜åˆ†æ®µç”Ÿæˆè®¢å•å·æ–¹æ¡ˆæˆ‘è§‰å¾—ç¨å¾®å¤æ‚ä¸€äº›ï¼Œè€Œä¸”è¿˜éœ€è¦ä¾é æ•°æ®åº“ä¸­çš„è¡¨æ¥å¤„ç†max idï¼Œè¿™ç§å†…å­˜åˆ†æ®µçš„æ–¹æ¡ˆè·Ÿç›´æ¥ç”¨redisçš„incrç”Ÿæˆä¸€ä¸ªè‡ªå¢çš„æ•°å­—ç›¸æ¯”æœ‰ä»€ä¹ˆå¥½å¤„å—ï¼Œç›´æ¥ç”¨rediså¤„ç†æ›´ç®€å•ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿå¾ˆé«˜</p><p>ç­”ï¼šredisçš„æ“ä½œæ˜¯éœ€è¦å»å»ºç«‹ç½‘ç»œè¿æ¥çš„ï¼Œå†…å­˜æ“ä½œç›´æ¥åœ¨å†…å­˜ä¸­è·å–çš„ï¼Œæ€§èƒ½å¿«å¾ˆå¤š</p></blockquote><blockquote><p>é—®é¢˜ï¼šè®¢å•å¼•å…¥çŠ¶æ€æœºåæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Œä¸ç”¨çš„è¯ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼ŸçŠ¶æ€æœºä¸ºä»€ä¹ˆè¦é€‰ç”¨squirrelæ¡†æ¶å‘¢ï¼Ÿ<br>ç­”ï¼šè¿™æ ·çš„å¥½å¤„å°±æ˜¯å°†è®¢å•çŠ¶æ€æµè½¬å’Œå¯¹åº”çš„ä¸šåŠ¡å¤„ç†è§£è€¦ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå†æœ‰ä¸€å †ç¹æ‚çš„ ifâ€¦else æ“ä½œï¼Œæ¯å½“éœ€è¦æ–°çš„è®¢å•çŠ¶æ€æµè½¬æ“ä½œçš„æ—¶å€™ï¼Œå¯ä»¥å»ç¼–å†™å¯¹åº”çš„ä¸€å¥—operatorå’Œprocessorç»„ä»¶æ¥å®Œæˆï¼Œå’Œå·²æœ‰ä¸šåŠ¡çš„åˆ†ç¦»åº¦å¾ˆé«˜ã€‚<br>squirrelæ¡†æ¶ é›†æˆç®€å•ä¸Šæ‰‹å¿«ï¼ŒåŠŸèƒ½å…¨é¢</p></blockquote><blockquote><p>é—®é¢˜ï¼šå•†å“è€ƒæ ¸æˆ‘è®¤ä¸ºå°±æ˜¯ï¼Œè¿è¥ä¼šé’ˆå¯¹çº¿ä¸Šå•†å“çš„ä¸€äº›é”€å”®æ•°æ®æƒ…å†µä½œåˆ†æï¼Œæ¯”å¦‚ä¸Šæ¶äº†ä¸€æ‰¹è–¯æ¡ï¼Œè¿™ä¸ªæœˆé”€é‡å¾ˆå¥½ï¼Œé‚£æˆ‘ä»¬å°±å¤šè¿›ç‚¹è´§ç‰©ï¼Œå°‘é‚£å°±å°‘è¿›ç‚¹ï¼Œä½†æ˜¯é’ˆå¯¹æµ·é‡çš„å•†å“ï¼Œä¹Ÿä¸èƒ½ä¸€ä¸ªä¸ªç»™è‚‰çœ¼å»å®¡æ ¸ï¼Œåœ¨å®¡æ ¸æ—¶å€™æœ‰é…ç½®æ¨¡ç‰ˆå•¥çš„ï¼Œå¼•å…¥å®¡æ ¸é…ç½®è§„åˆ™ï¼Œæ¯”å¦‚ä¸€ä¸ªé…ç½®æ¨¡ç‰ˆé‡Œè¾¹æœ‰å•†å“ID=ã€‹è§„åˆ™æ¨¡ç‰ˆè¿™æ ·çš„ã€‚ ä¸çŸ¥é“æˆ‘çš„ç†è§£å¯¹ä¸å¯¹?</p><p>ç­”ï¼šæ‚¨çš„ç†è§£æ˜¯æ­£ç¡®çš„ã€‚å•†å“è€ƒæ ¸é€šå¸¸æ˜¯åŸºäºçº¿ä¸Šé”€å”®æ•°æ®å¯¹å•†å“è¿›è¡Œè¯„ä¼°å’Œåˆ†æï¼Œä»¥ä¾¿è¿è¥äººå‘˜åšå‡ºæ›´åŠ æ˜æ™ºçš„å†³ç­–ï¼Œæ¯”å¦‚è°ƒæ•´å•†å“çš„è¿›è´§é‡ã€ä»·æ ¼ç­‰ï¼Œä»¥æé«˜é”€å”®ä¸šç»©å’Œåˆ©æ¶¦ã€‚ å¯¹äºæµ·é‡å•†å“çš„è€ƒæ ¸ï¼Œæ‰‹å·¥å®¡æ ¸ç¡®å®æ˜¯ä¸åˆ‡å®é™…çš„ã€‚å› æ­¤ï¼Œå¯ä»¥å¼•å…¥è‡ªåŠ¨åŒ–çš„å®¡æ ¸é…ç½®è§„åˆ™ï¼Œè¿™äº›è§„åˆ™å¯ä»¥é€šè¿‡é…ç½®æ¨¡æ¿æ¥å®ç°ï¼Œæ¯”å¦‚åŸºäºå•†å“IDã€é”€å”®é¢ã€åº“å­˜ã€å”®åæœåŠ¡è´¨é‡ç­‰æŒ‡æ ‡æ¥è®¾è®¡è§„åˆ™ï¼Œä»è€Œæ›´åŠ é«˜æ•ˆåœ°è¿›è¡Œå•†å“è€ƒæ ¸ã€‚åœ¨å…·ä½“å®ç°è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æœºå™¨å­¦ä¹ å’Œæ•°æ®åˆ†ææŠ€æœ¯ï¼Œä»å¤§é‡æ•°æ®ä¸­æŒ–æ˜å‡ºæœ‰æ•ˆè§„å¾‹å’Œæ¨¡å¼ï¼Œæé«˜å•†å“è€ƒæ ¸çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚</p></blockquote><blockquote><p>é—®é¢˜ï¼šæäº¤è®¢å•ï¼Œä¼šå‘ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯ï¼Œå¦‚æœä¸€ç›´è®¢å•æœªæ”¯ä»˜ï¼Œåˆ°äº†è§¦å‘çš„æ—¶å€™ï¼Œæ°å¥½ç”¨æˆ·ç‚¹å‡»ä»˜æ¬¾äº†ï¼Œæ­¤æ—¶å¹¶å‘åŒæ—¶è¿‡æ¥ï¼Œæ˜¯ä¸æ˜¯è¦åœ¨æ”¯ä»˜å’Œå–æ¶ˆçš„æ—¶å€™éƒ½è¦åŠ åˆ†å¸ƒå¼é”ï¼Œé‚£å¦‚æœçœŸçš„æ­¤æ—¶å–æ¶ˆäº†ï¼Œæ˜¯ä¸æ˜¯åªèƒ½é€šçŸ¥ç”¨æˆ·ï¼Œè®¢å•å·²å–æ¶ˆï¼Œè¯·é‡æ–°ä¸‹å•å—</p><p>ç­”ï¼šå¯¹äºè®¢å•æ”¯ä»˜çš„å»¶è¿Ÿæ¶ˆæ¯ï¼Œç¡®ä¿è®¢å•æ”¯ä»˜çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§æ˜¯éå¸¸é‡è¦çš„ã€‚åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§é€šå¸¸éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥é¿å…å†²çªã€‚åœ¨è®¢å•å–æ¶ˆçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é‡‡ç”¨å¼‚æ­¥é€šçŸ¥çš„æ–¹å¼å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå‘ŠçŸ¥è®¢å•å·²å–æ¶ˆï¼Œå¹¶æé†’ç”¨æˆ·é‡æ–°ä¸‹å•ã€‚åœ¨å®é™…å®ç°ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ç­‰æŠ€æœ¯æ¥å®ç°å»¶è¿Ÿæ¶ˆæ¯å’Œå¼‚æ­¥é€šçŸ¥ï¼Œä¿è¯è®¢å•æ”¯ä»˜çš„æ­£ç¡®æ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p></blockquote><blockquote><p>é—®é¢˜ï¼šæˆ‘çœ‹å¥½å¤šä¹¦éƒ½å‚è€ƒ&lt;æ·±å…¥ç†è§£javaå†…å­˜æ¨¡å‹&gt;ä¸€ä¹¦å«äº†StoreStore, StoreLoad, LoadLoad, LoadStore, ä½†æ˜¯æˆ‘å‘ç°è¿˜æœ‰ä¸€ç§å«æ³•å«Release Barrier , Store Barrier, Acquire Barrier? è¿™ä¸¤ç§å«æ³•ä»¥ä»€ä¹ˆä¸ºåŸºå‡†å«çš„???å†…å­˜å±éšœæ˜¯æ€ä¹ˆåˆ†ç±»çš„ï¼Ÿï¼Ÿï¼Ÿ</p><p>ç­”ï¼šå†…å­˜å±éšœæ˜¯æŒ‡åœ¨ç¼–ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œå®ƒèƒ½å¤Ÿç¡®ä¿åœ¨ç¨‹åºä¸­ç‰¹å®šä½ç½®å¤„çš„å†…å­˜æ“ä½œæŒ‰ç…§ç‰¹å®šé¡ºåºæ‰§è¡Œï¼Œä»è€Œä¿è¯äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å¯è§æ€§å’Œæœ‰åºæ€§ã€‚</p><p>åœ¨Javaå†…å­˜æ¨¡å‹ä¸­ï¼Œå†…å­˜å±éšœæŒ‰ç…§åŠŸèƒ½è¢«åˆ’åˆ†ä¸ºå››ç§ï¼šLoad Barrierï¼ˆè¯»å±éšœï¼‰ã€Store Barrierï¼ˆå†™å±éšœï¼‰ã€StoreLoad Barrierï¼ˆå†™-è¯»å±éšœï¼‰å’ŒLoadStore Barrierï¼ˆè¯»-å†™å±éšœï¼‰ã€‚è¿™äº›å±éšœçš„ä½œç”¨å¦‚ä¸‹ï¼š</p><p>Load Barrierï¼ˆè¯»å±éšœï¼‰ï¼šå®ƒç”¨äºç¡®ä¿æŸä¸ªçº¿ç¨‹åœ¨è¯»å–æŸä¸ªå˜é‡æ—¶ï¼Œèƒ½å¤Ÿçœ‹åˆ°å…¶ä»–çº¿ç¨‹å¯¹è¯¥å˜é‡çš„æ›´æ–°ã€‚<br>Store Barrierï¼ˆå†™å±éšœï¼‰ï¼šå®ƒç”¨äºç¡®ä¿æŸä¸ªçº¿ç¨‹åœ¨ä¿®æ”¹æŸä¸ªå˜é‡æ—¶ï¼Œå¯¹å…¶ä»–çº¿ç¨‹çš„ä¿®æ”¹å¯è§ã€‚<br>StoreLoad Barrierï¼ˆå†™-è¯»å±éšœï¼‰ï¼šå®ƒç”¨äºç¡®ä¿æŸä¸ªçº¿ç¨‹åœ¨å†™å…¥æŸä¸ªå˜é‡åï¼Œä¹‹åè¯»å–è¯¥å˜é‡æ—¶ï¼Œèƒ½å¤Ÿçœ‹åˆ°å…¶ä»–çº¿ç¨‹åœ¨å†™å…¥è¯¥å˜é‡ä¹‹å‰çš„æ“ä½œã€‚<br>LoadStore Barrierï¼ˆè¯»-å†™å±éšœï¼‰ï¼šå®ƒç”¨äºç¡®ä¿æŸä¸ªçº¿ç¨‹åœ¨è¯»å–æŸä¸ªå˜é‡æ—¶ï¼Œä¹‹å‰çš„å†™å…¥æ“ä½œå¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚<br>å¦å¤–ï¼ŒRelease Barrier å’Œ Acquire Barrier æ˜¯ä¸€ç§æ›´é«˜å±‚æ¬¡çš„å†…å­˜å±éšœæ¦‚å¿µï¼Œå®ƒä»¬æ˜¯åŸºäºå‰é¢æåˆ°çš„å››ç§å†…å­˜å±éšœè€Œå®šä¹‰çš„ã€‚Release Barrier å’Œ Acquire Barrier åˆ†åˆ«ç”¨äºç¡®ä¿æŸä¸ªçº¿ç¨‹çš„å†™æ“ä½œå¯¹å…¶ä»–çº¿ç¨‹å¯è§å’Œç¡®ä¿æŸä¸ªçº¿ç¨‹çš„è¯»æ“ä½œçœ‹åˆ°å…¶ä»–çº¿ç¨‹çš„å†™æ“ä½œã€‚åœ¨Javaå†…å­˜æ¨¡å‹ä¸­ï¼ŒRelease Barrier å¯¹åº”çš„æ˜¯ Store Store Barrier å’Œ StoreLoad Barrierï¼Œè€Œ Acquire Barrier å¯¹åº”çš„æ˜¯ LoadLoad Barrier å’Œ LoadStore Barrierã€‚</p><p>å†…å­˜å±éšœçš„åˆ†ç±»æ˜¯æ ¹æ®å…¶åŠŸèƒ½ä¸åŒæ¥åˆ’åˆ†çš„ï¼Œè€Œ Release Barrier å’Œ Acquire Barrier åˆ™æ˜¯ä¸€ç§æ›´é«˜å±‚æ¬¡çš„æ¦‚å¿µï¼Œå®ƒä»¬æ˜¯åŸºäºå‰é¢æåˆ°çš„å››ç§å†…å­˜å±éšœè€Œå®šä¹‰çš„ã€‚</p></blockquote><blockquote><p>é—®é¢˜2ï¼šèƒ½ä¸èƒ½ä¸‹è®¢å•çš„æ—¶å€™ä¸æ¨mqï¼Œåœ¨ç”¨æˆ·æ”¯ä»˜çš„æˆåŠŸåå†å‘å…¶ä»–ç³»ç»Ÿæ¨é€mqæ¶ˆæ¯å‘¢?å¦‚æœå»¶è¿Ÿæ¨é€ï¼Œç”¨æˆ·åˆšä¸‹å•å°±æ”¯ä»˜äº†ï¼Œå²‚ä¸æ˜¯è¦ç­‰åŠä¸ªå°æ—¶ï¼Œæ‰èƒ½æ”¶åˆ°çº¢åŒ…ç³»ç»Ÿå‘çš„çº¢åŒ…?</p><p>ç­”ï¼šè¿™æ˜¯ä¸¤æ¡æ¶ˆæ¯ï¼Œä¸€ä¸ªæ˜¯ä½ åˆ›å»ºè®¢å•äº†ï¼Œå®Œäº†æœ‰ä¸€ä¸ªè®¢å•åˆ›å»ºé€šçŸ¥ï¼Œä½ å¯ä»¥30åˆ†é’Ÿåæ¶ˆè´¹è¿™ä¸ªæ¶ˆæ¯ï¼Œåˆ¤æ–­ä½ çš„è®¢å•æ˜¯å¦å·²ç»è¶…è¿‡30åˆ†é’Ÿè¿˜æ²¡æ”¯ä»˜;å¦å¤–ä¸€ä¸ªæ˜¯å¦‚æœå·²ç»æ”¯ä»˜äº†ï¼Œæœ‰ä¸€ä¸ªè®¢å•æ”¯ä»˜çš„æ¶ˆæ¯ï¼Œç„¶åä½ å¾ˆå¤šç³»ç»Ÿå¯ä»¥æ¶ˆè´¹è¿™ä¸ªæ¶ˆæ¯ï¼Œåšåç»­çš„å¤„ç†</p></blockquote><h3 id="2ã€é—²èŠ"><a href="#2ã€é—²èŠ" class="headerlink" title="2ã€é—²èŠ"></a>2ã€é—²èŠ</h3><h4 id="1ã€ç¦»èŒåŸå› "><a href="#1ã€ç¦»èŒåŸå› " class="headerlink" title="1ã€ç¦»èŒåŸå› "></a>1ã€ç¦»èŒåŸå› </h4><ul><li>è–ªèµ„ä¸€æ–¹é¢ï¼Œå…¶æ¬¡æ˜¯è§¦ç¢°æ›´å¤šçš„æ˜¯è¾¹ç¼˜æŠ€æœ¯ï¼Œèƒ½æˆé•¿çš„ç©ºé—´æœ‰é™</li><li>è™½è¯´èƒ½ç¢°åˆ°ä¸€äº›æ ¸å¿ƒæŠ€æœ¯ï¼Œä½†æ˜¯æˆé•¿ä¹Ÿæ¯”è¾ƒç¼“æ…¢ï¼Œä¸æ˜¯é•¿ä¹…ä¹‹ç­–</li><li>èˆ’é€‚åœˆå¾…ä¹…äº†ï¼Œæœ‰äº›è¿«åˆ‡çš„å±æœºæ„Ÿï¼Œ æœ›å¾—åˆ°æ›´å¤šçš„æŒ‘æˆ˜å’Œå­¦ä¹ æœºä¼š</li></ul><h4 id="2ã€"><a href="#2ã€" class="headerlink" title="2ã€"></a>2ã€</h4><h2 id="å‚è€ƒ-â†“"><a href="#å‚è€ƒ-â†“" class="headerlink" title="å‚è€ƒ â†“"></a>å‚è€ƒ â†“</h2><p>MySQL æ‰§è¡Œæµç¨‹ :<a href="https://blog.csdn.net/qwer123451234123/article/details/124344299">https://blog.csdn.net/qwer123451234123/article/details/124344299</a></p><p>æ•°æ®ç»“æ„å¯è§†åŒ–æ¼”å˜ï¼š <a href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html">https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html</a></p><p>B+Treeæ—¶é—´å¤æ‚åº¦ï¼š<a href="https://blog.csdn.net/yunduanyou/article/details/128233801">https://blog.csdn.net/yunduanyou/article/details/128233801</a></p><p>1.8æµæ“ä½œé¢˜ï¼š<a href="https://blog.csdn.net/Thinkingcao/article/details/108664921">https://blog.csdn.net/Thinkingcao/article/details/108664921</a></p><p>MySQLä¸­çš„èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ï¼š<a href="https://www.jb51.net/article/251419.htm">https://www.jb51.net/article/251419.htm</a></p><p>MySQLå­˜å‚¨å¼•æ“ï¼š<a href="https://blog.csdn.net/promsing/article/details/126157969">https://blog.csdn.net/promsing/article/details/126157969</a></p><p>MySQLè¦†ç›–ç´¢å¼•ä¸ºä»€ä¹ˆä¸ç”¨å›è¡¨ï¼š<a href="https://blog.csdn.net/muwenbofx/article/details/123259858">https://blog.csdn.net/muwenbofx/article/details/123259858</a></p><p>æ…¢SQLè§£å†³ï¼š</p><p><a href="https://www.qycn.com/xzx/article/9300.html">https://www.qycn.com/xzx/article/9300.html</a></p><p><a href="https://baijiahao.baidu.com/s?id=1746620518356199899&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1746620518356199899&amp;wfr=spider&amp;for=pc</a></p><p>SpringCloudä¸Dubboçš„åŒºåˆ«ï¼š<a href="https://blog.csdn.net/weixin_51291483/article/details/109212137/">https://blog.csdn.net/weixin_51291483/article/details/109212137/</a></p><p>CNDåŠ é€Ÿï¼š<a href="https://www.likecs.com/show-204294177.html#sc=1128">https://www.likecs.com/show-204294177.html#sc=1128</a><br>ç§’æ€è®¾è®¡ï¼š<a href="https://blog.csdn.net/weixin_42405670/article/details/118138802">https://blog.csdn.net/weixin_42405670/article/details/118138802</a><br>seata é¢è¯•é¢˜ï¼š<br>ç®€å•ç‰ˆï¼š<a href="https://zhuanlan.zhihu.com/p/470281769">https://zhuanlan.zhihu.com/p/470281769</a><br>å®Œæ•´ç‰ˆï¼š<a href="https://www.cnblogs.com/crazymakercircle/p/14375424.html#autoid-h4-6-3-0">https://www.cnblogs.com/crazymakercircle/p/14375424.html#autoid-h4-6-3-0</a></p><p>Seataçš„å››ç§æ¨¡å¼ï¼š</p><p><a href="https://blog.csdn.net/wuyongde_0922/article/details/125333625">https://blog.csdn.net/wuyongde_0922/article/details/125333625</a></p><p><a href="https://blog.csdn.net/m0_58600248/article/details/126271252">https://blog.csdn.net/m0_58600248/article/details/126271252</a></p><p>Spring é¢è¯•é¢˜ï¼š<a href="https://zhuanlan.zhihu.com/p/469797333">https://zhuanlan.zhihu.com/p/469797333</a><br>MQé¢è¯•é¢˜ï¼š<a href="https://zhuanlan.zhihu.com/p/470984789">https://zhuanlan.zhihu.com/p/470984789</a></p><p>RocketMQäº‹åŠ¡æ¶ˆæ¯å¦‚ä½•ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼š<a href="https://blog.csdn.net/qq_42093488/article/details/114677515">https://blog.csdn.net/qq_42093488/article/details/114677515</a></p><p>ä¸ƒç§åˆ†å¸ƒå¼äº‹åŠ¡å®ç°ï¼š<a href="https://blog.csdn.net/qq_36963950/article/details/108909780">https://blog.csdn.net/qq_36963950/article/details/108909780</a></p><p>redisæ•°æ®ç»“æ„ï¼š<a href="https://blog.csdn.net/mz474920631/article/details/125200050">https://blog.csdn.net/mz474920631/article/details/125200050</a></p><p>TCCè½åœ°æ–‡ç« ï¼ˆæœ‰åˆé›†ï¼‰ï¼š<a href="https://blog.csdn.net/weixin_44102992/article/details/126493034?spm=1001.2014.3001.5501">https://blog.csdn.net/weixin_44102992/article/details/126493034?spm=1001.2014.3001.5501</a></p><p>TCCå’ŒRocketMQåšåˆ†å¸ƒå¼äº‹åŠ¡åŒºåˆ«ï¼š<a href="https://zhuanlan.zhihu.com/p/183753774">https://zhuanlan.zhihu.com/p/183753774</a></p><p>redisä¹‹å¦‚ä½•å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼š<a href="https://blog.csdn.net/wang0907/article/details/127830591">https://blog.csdn.net/wang0907/article/details/127830591</a></p><p>åˆ†å¸ƒå¼äº‹åŠ¡å››ç§æ–¹æ¡ˆå’Œå¯¹æ¯”ï¼š<a href="https://www.cnblogs.com/muxilaoshi/p/15429404.html">https://www.cnblogs.com/muxilaoshi/p/15429404.html</a></p><p>seata ATå’ŒXAçš„åŒºåˆ«ï¼š<a href="https://www.51cto.com/article/659139.html?u_atoken=908e9399-a703-4278-8438-3e2639de1e42&amp;u_asession=01cbB_xA5flpNlOFMXMMxwrHuPaiY7SlcCklCBZ6cSuxieaFEySACzsRygqqIcFf6yX0KNBwm7Lovlpxjd_P_q4JsKWYrT3W_NKPr8w6oU7K8PYmybX1Fb1-mAlyDPgbs_DvUNWlpfeCH_Z_6FnnXEnGBkFo3NEHBv0PZUm6pbxQU&amp;u_asig=05H6c_C18NzGqylFOgxYxOfyO9v0KX11HhF9UNuVuWDyDEKZsyCCsmlvOm93IX5QObFbfUNqdn8aQG1mI6aOKSs4Teqnna915rPIdR1R6vLUber5juuaXtMV73tq6jjhUPwNFoYr3TWz60hy4MRDOTCYy74sE94reA3i6Bm9SeXcv9JS7q8ZD7Xtz2Ly-b0kmuyAKRFSVJkkdwVUnyHAIJzdFdm6FtdJ6etcsGdFNqcU7WcMYF5aSO9Hw4ju-PP021VSW66CuWlZZ6ywL2zPMFnu3h9VXwMyh6PgyDIVSG1W8kCUCcLCVBKZk4XCs8ybF9IwNOrpX04BxodSt1A8Jz_TYwAep73xlDlF8jhaGyXHfBkISeMFkkfFA1VnMgsMutmWspDxyAEEo4kbsryBKb9Q&amp;u_aref=djAEUQI/tZgGE8x5s2Rr8+QuQKg=">https://www.51cto.com/article/659139.html?u_atoken=908e9399-a703-4278-8438-3e2639de1e42&amp;u_asession=01cbB_xA5flpNlOFMXMMxwrHuPaiY7SlcCklCBZ6cSuxieaFEySACzsRygqqIcFf6yX0KNBwm7Lovlpxjd_P_q4JsKWYrT3W_NKPr8w6oU7K8PYmybX1Fb1-mAlyDPgbs_DvUNWlpfeCH_Z_6FnnXEnGBkFo3NEHBv0PZUm6pbxQU&amp;u_asig=05H6c_C18NzGqylFOgxYxOfyO9v0KX11HhF9UNuVuWDyDEKZsyCCsmlvOm93IX5QObFbfUNqdn8aQG1mI6aOKSs4Teqnna915rPIdR1R6vLUber5juuaXtMV73tq6jjhUPwNFoYr3TWz60hy4MRDOTCYy74sE94reA3i6Bm9SeXcv9JS7q8ZD7Xtz2Ly-b0kmuyAKRFSVJkkdwVUnyHAIJzdFdm6FtdJ6etcsGdFNqcU7WcMYF5aSO9Hw4ju-PP021VSW66CuWlZZ6ywL2zPMFnu3h9VXwMyh6PgyDIVSG1W8kCUCcLCVBKZk4XCs8ybF9IwNOrpX04BxodSt1A8Jz_TYwAep73xlDlF8jhaGyXHfBkISeMFkkfFA1VnMgsMutmWspDxyAEEo4kbsryBKb9Q&amp;u_aref=djAEUQI%2FtZgGE8x5s2Rr8%2BQuQKg%3D</a></p><p>é‡‘èé¡¹ç›®seataè¯´æ˜ï¼š<a href="https://zhuanlan.zhihu.com/p/499041496">https://zhuanlan.zhihu.com/p/499041496</a></p><p>æ¥å£å¹‚ç­‰æ€§æ ¡éªŒå®ç°ï¼š<a href="https://blog.csdn.net/huchao_lingo/article/details/105540418">https://blog.csdn.net/huchao_lingo/article/details/105540418</a></p><p>æ¶ˆæ¯é˜Ÿåˆ—çš„å¯é æ€§ï¼š<a href="https://blog.csdn.net/m0_73859807/article/details/128861716">https://blog.csdn.net/m0_73859807/article/details/128861716</a></p><p>å­—èŠ‚è·³åŠ¨ï¼Œé«˜å¯ç”¨ã€ä¸é‡å¤æ¶ˆè´¹ã€å¯é ä¼ è¾“ã€é¡ºåºæ¶ˆè´¹ã€æ¶ˆæ¯å †ç§¯ï¼š<a href="https://www.cnblogs.com/binghe001/p/14443360.html">https://www.cnblogs.com/binghe001/p/14443360.html</a></p><p>ç«™é•¿ç®€ä¹¦ï¼š<a href="https://www.jianshu.com/p/2e995df9ccbc">https://www.jianshu.com/p/2e995df9ccbc</a></p><p>Redisé¢è¯•é¢˜ï¼š</p><p><a href="https://zhuanlan.zhihu.com/p/567047691">https://zhuanlan.zhihu.com/p/567047691</a></p><p><a href="https://www.cnblogs.com/javazhiyin/p/13839357.html">https://www.cnblogs.com/javazhiyin/p/13839357.html</a></p><p>Redisç¼“å­˜ä¸€è‡´æ€§ï¼š<a href="https://blog.csdn.net/a745233700/article/details/88081219">https://blog.csdn.net/a745233700/article/details/88081219</a></p><p>hystrixä¸­ä¿¡å·é‡å’Œçº¿ç¨‹æ± ï¼š<a href="https://www.cnblogs.com/chihirotan/p/11368520.html">https://www.cnblogs.com/chihirotan/p/11368520.html</a></p><p>nacosé¢è¯•ç­‰å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/482632893">https://zhuanlan.zhihu.com/p/482632893</a></p><p>eureka:</p><p><a href="https://blog.csdn.net/lyc_liyanchao/article/details/120060221">https://blog.csdn.net/lyc_liyanchao/article/details/120060221</a></p><p><a href="https://blog.csdn.net/weixin_48227718/article/details/125620401">https://blog.csdn.net/weixin_48227718/article/details/125620401</a></p><p>zookeeper:</p><p><a href="https://blog.csdn.net/weixin_43495317/article/details/123142595">https://blog.csdn.net/weixin_43495317/article/details/123142595</a></p><p><a href="https://blog.51cto.com/u_15127568/2713356">https://blog.51cto.com/u_15127568/2713356</a></p><p>seataåŸç†ï¼š</p><p><a href="https://blog.csdn.net/qq_14996421/article/details/125706271">https://blog.csdn.net/qq_14996421/article/details/125706271</a></p><p>redisåŸå­æ€§ä¿è¯ï¼š<a href="https://blog.csdn.net/u013277209/article/details/126274656">https://blog.csdn.net/u013277209/article/details/126274656</a></p><p>binlogã€redologã€undologï¼š<a href="https://zhuanlan.zhihu.com/p/474218953">https://zhuanlan.zhihu.com/p/474218953</a></p><p>FlinkCDC and ETL :<a href="https://blog.csdn.net/YiRan_Zhao/article/details/126946412">https://blog.csdn.net/YiRan_Zhao/article/details/126946412</a></p><p>ã€ç²¾ã€‘Seataå››ç§æ¨¡å¼å’ŒåŸç†ï¼ˆå…¨ï¼‰ï¼š<a href="http://www.360doc.com/content/22/0902/20/78411425_1046313419.shtml">http://www.360doc.com/content/22/0902/20/78411425_1046313419.shtml</a><br>ã€ç²¾ã€‘Seata ATæ¨¡å¼ä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼š<a href="https://www.cnblogs.com/ciel717/p/16190760.html">https://www.cnblogs.com/ciel717/p/16190760.html</a><br>ã€ç²¾ã€‘åˆ†å¸ƒå¼äº‹åŠ¡å…¨è§£ï¼š<a href="https://www.cnblogs.com/ciel717/p/16190481.html">https://www.cnblogs.com/ciel717/p/16190481.html</a></p><p>binlogè¯¦è§£ï¼š<a href="https://blog.csdn.net/m0_73311735/article/details/127935751">https://blog.csdn.net/m0_73311735/article/details/127935751</a></p><p>Redis6 IOå¤šè·¯å¤ç”¨+å¤šçº¿ç¨‹ï¼š<a href="https://blog.csdn.net/weixin_39724194/article/details/128660990">https://blog.csdn.net/weixin_39724194/article/details/128660990</a></p><p>seataæ¡ˆä¾‹ï¼Œsagaåº”ç”¨åœºæ™¯ï¼š<a href="https://www.cnblogs.com/yizhiamumu/p/16809386.html">https://www.cnblogs.com/yizhiamumu/p/16809386.html</a></p><p>å¹¶å‘çº¿ç¨‹æ•°ã€QPSä¸å¹³å‡è€—æ—¶çš„å…³ç³»ï¼š<a href="https://cloud.tencent.com/developer/article/1784548?ivk_sa=1024320u">https://cloud.tencent.com/developer/article/1784548?ivk_sa=1024320u</a></p><p>æ­£å‘ä»£ç†å’Œæ–¹å‘ä»£ç†ï¼š<a href="https://baijiahao.baidu.com/s?id=1756527779282578683&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1756527779282578683&amp;wfr=spider&amp;for=pc</a></p><hr><p>flinké¢è¯•é¢˜ï¼š<a href="https://cloud.tencent.com/developer/article/1892515">https://cloud.tencent.com/developer/article/1892515</a></p><p><a href="https://blog.csdn.net/sinat_23225111/article/details/124495260">https://blog.csdn.net/sinat_23225111/article/details/124495260</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="é¢è¯•é¢˜" scheme="https://mykkto.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
    
    <category term="springcloud" scheme="https://mykkto.github.io/tags/springcloud/"/>
    
    <category term="é¢è¯•" scheme="https://mykkto.github.io/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>JUC-æ·±åº¦é¢è¯•é¢˜ï¼ˆç²‰ä¸æŠ•ç¨¿ï¼‰</title>
    <link href="https://mykkto.github.io/posts/ee9ed7cb.html"/>
    <id>https://mykkto.github.io/posts/ee9ed7cb.html</id>
    <published>2023-01-04T12:39:21.000Z</published>
    <updated>2023-02-26T14:16:15.266Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="2022-JUC-å¤ç›˜"><a href="#2022-JUC-å¤ç›˜" class="headerlink" title="2022 JUC å¤ç›˜"></a>2022 JUC å¤ç›˜</h1><h2 id="å¤§çº²ç›®å½•"><a href="#å¤§çº²ç›®å½•" class="headerlink" title="å¤§çº²ç›®å½•"></a>å¤§çº²ç›®å½•</h2><p>[TOC]</p><h3 id="ComlpetableFutuer"><a href="#ComlpetableFutuer" class="headerlink" title="ComlpetableFutuer"></a>ComlpetableFutuer</h3><h4 id="å›é¡¾Future"><a href="#å›é¡¾Future" class="headerlink" title="å›é¡¾Future"></a>å›é¡¾Future</h4><h5 id="1future-æ¥å£å°±æ˜¯å®šä¹‰æ“ä½œä¸€æ­¥æ‰§è¡Œä¸€äº›æ–¹æ³•ï¼Œå¦‚è·å¾—å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚å–æ¶ˆä»»åŠ¡çš„æ‰§è¡Œï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å–æ¶ˆï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ã€‚"><a href="#1future-æ¥å£å°±æ˜¯å®šä¹‰æ“ä½œä¸€æ­¥æ‰§è¡Œä¸€äº›æ–¹æ³•ï¼Œå¦‚è·å¾—å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚å–æ¶ˆä»»åŠ¡çš„æ‰§è¡Œï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å–æ¶ˆï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ã€‚" class="headerlink" title="1future æ¥å£å°±æ˜¯å®šä¹‰æ“ä½œä¸€æ­¥æ‰§è¡Œä¸€äº›æ–¹æ³•ï¼Œå¦‚è·å¾—å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚å–æ¶ˆä»»åŠ¡çš„æ‰§è¡Œï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å–æ¶ˆï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ã€‚"></a>1future æ¥å£å°±æ˜¯å®šä¹‰æ“ä½œä¸€æ­¥æ‰§è¡Œä¸€äº›æ–¹æ³•ï¼Œå¦‚è·å¾—å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚å–æ¶ˆä»»åŠ¡çš„æ‰§è¡Œï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å–æ¶ˆï¼Œåˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•ã€‚</h5><h5 id="2-å®ƒå…·ä½“å®ç°æ˜¯FutureTask-å®ƒåŒæ—¶å®ç°äº†-Runnable-å’ŒFuture-æ¥å£-ã€‚é€šè¿‡å®ƒæ„é€ æ–¹æ³•æ–¹æ³•å¯ä»¥ä¼ å…¥-callable-å’Œrunnable-å…·ä½“å®ç°ç±»ã€‚"><a href="#2-å®ƒå…·ä½“å®ç°æ˜¯FutureTask-å®ƒåŒæ—¶å®ç°äº†-Runnable-å’ŒFuture-æ¥å£-ã€‚é€šè¿‡å®ƒæ„é€ æ–¹æ³•æ–¹æ³•å¯ä»¥ä¼ å…¥-callable-å’Œrunnable-å…·ä½“å®ç°ç±»ã€‚" class="headerlink" title="2 å®ƒå…·ä½“å®ç°æ˜¯FutureTask ,å®ƒåŒæ—¶å®ç°äº† Runnable å’ŒFuture  æ¥å£ ã€‚é€šè¿‡å®ƒæ„é€ æ–¹æ³•æ–¹æ³•å¯ä»¥ä¼ å…¥ callable å’Œrunnable å…·ä½“å®ç°ç±»ã€‚"></a>2 å®ƒå…·ä½“å®ç°æ˜¯FutureTask ,å®ƒåŒæ—¶å®ç°äº† Runnable å’ŒFuture  æ¥å£ ã€‚é€šè¿‡å®ƒæ„é€ æ–¹æ³•æ–¹æ³•å¯ä»¥ä¼ å…¥ callable å’Œrunnable å…·ä½“å®ç°ç±»ã€‚</h5><h5 id="3-ç»“è®ºå°±æ˜¯-é€šè¿‡futuretask-æ¥å¯ä»¥ç°å®æ€§å¤šçº¿ç¨‹çš„å¼‚æ­¥ä»»åŠ¡ã€‚"><a href="#3-ç»“è®ºå°±æ˜¯-é€šè¿‡futuretask-æ¥å¯ä»¥ç°å®æ€§å¤šçº¿ç¨‹çš„å¼‚æ­¥ä»»åŠ¡ã€‚" class="headerlink" title="3 ç»“è®ºå°±æ˜¯  é€šè¿‡futuretask æ¥å¯ä»¥ç°å®æ€§å¤šçº¿ç¨‹çš„å¼‚æ­¥ä»»åŠ¡ã€‚"></a>3 ç»“è®ºå°±æ˜¯  é€šè¿‡futuretask æ¥å¯ä»¥ç°å®æ€§å¤šçº¿ç¨‹çš„å¼‚æ­¥ä»»åŠ¡ã€‚</h5><h5 id="4-futuretask-ç»“åˆçº¿ç¨‹æ± æä¾›æ•ˆç‡"><a href="#4-futuretask-ç»“åˆçº¿ç¨‹æ± æä¾›æ•ˆç‡" class="headerlink" title="4 futuretask ç»“åˆçº¿ç¨‹æ± æä¾›æ•ˆç‡"></a>4 futuretask ç»“åˆçº¿ç¨‹æ± æä¾›æ•ˆç‡</h5><h5 id="5futuretask-ç¼ºç‚¹ï¼š-1å¦‚æœè€—æ—¶å¾ˆä¹…çš„å¼‚æ­¥å­çº¿ç¨‹å¤„ç†å®Œæˆä¹‹å-ï¼Œå†å»è°ƒç”¨-getæ–¹æ³•è·å–è®¡ç®—ä»»åŠ¡ç¨‹åºä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œåä¹‹å°±ä¼šå¯¼è‡´ä¹‹çº¿ç¨‹é˜»å¡ã€‚2isDone-æ–¹æ³•-è½®è¯¢å®¹æ˜“å¯¼è‡´cpuç©ºè½¬-è€—æŸå¯¼è‡´æ›´å¤šèµ„æºå ç”¨ã€‚"><a href="#5futuretask-ç¼ºç‚¹ï¼š-1å¦‚æœè€—æ—¶å¾ˆä¹…çš„å¼‚æ­¥å­çº¿ç¨‹å¤„ç†å®Œæˆä¹‹å-ï¼Œå†å»è°ƒç”¨-getæ–¹æ³•è·å–è®¡ç®—ä»»åŠ¡ç¨‹åºä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œåä¹‹å°±ä¼šå¯¼è‡´ä¹‹çº¿ç¨‹é˜»å¡ã€‚2isDone-æ–¹æ³•-è½®è¯¢å®¹æ˜“å¯¼è‡´cpuç©ºè½¬-è€—æŸå¯¼è‡´æ›´å¤šèµ„æºå ç”¨ã€‚" class="headerlink" title="5futuretask ç¼ºç‚¹ï¼š 1å¦‚æœè€—æ—¶å¾ˆä¹…çš„å¼‚æ­¥å­çº¿ç¨‹å¤„ç†å®Œæˆä¹‹å ï¼Œå†å»è°ƒç”¨ getæ–¹æ³•è·å–è®¡ç®—ä»»åŠ¡ç¨‹åºä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œåä¹‹å°±ä¼šå¯¼è‡´ä¹‹çº¿ç¨‹é˜»å¡ã€‚2isDone æ–¹æ³• è½®è¯¢å®¹æ˜“å¯¼è‡´cpuç©ºè½¬ è€—æŸå¯¼è‡´æ›´å¤šèµ„æºå ç”¨ã€‚"></a>5futuretask ç¼ºç‚¹ï¼š 1å¦‚æœè€—æ—¶å¾ˆä¹…çš„å¼‚æ­¥å­çº¿ç¨‹å¤„ç†å®Œæˆä¹‹å ï¼Œå†å»è°ƒç”¨ getæ–¹æ³•è·å–è®¡ç®—ä»»åŠ¡ç¨‹åºä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œåä¹‹å°±ä¼šå¯¼è‡´ä¹‹çº¿ç¨‹é˜»å¡ã€‚2isDone æ–¹æ³• è½®è¯¢å®¹æ˜“å¯¼è‡´cpuç©ºè½¬ è€—æŸå¯¼è‡´æ›´å¤šèµ„æºå ç”¨ã€‚</h5><h5 id="6é’ˆå¯¹futuretask-çš„æ”¹è¿›ä¸éœ€é€šè¿‡è½®è¯¢çš„æ–¹å¼çš„åˆ¤æ–­çš„çº¿ç¨‹ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œé€šè¿‡å›è°ƒé€šçŸ¥å‡½æ•°ã€‚å¼‚æ­¥ä»»åŠ¡çš„æ­¥éª¤ä¸Šçš„ä¾èµ–ï¼ˆä¸Šä¸€ä¸ªæ­¥éª¤æ—¶ä¸‹ä¸ªæ­¥éª¤çš„å‰æï¼‰è¿™å°±CompletableFutrureå‡ºæ¥çš„ä¼ç¬”ã€‚"><a href="#6é’ˆå¯¹futuretask-çš„æ”¹è¿›ä¸éœ€é€šè¿‡è½®è¯¢çš„æ–¹å¼çš„åˆ¤æ–­çš„çº¿ç¨‹ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œé€šè¿‡å›è°ƒé€šçŸ¥å‡½æ•°ã€‚å¼‚æ­¥ä»»åŠ¡çš„æ­¥éª¤ä¸Šçš„ä¾èµ–ï¼ˆä¸Šä¸€ä¸ªæ­¥éª¤æ—¶ä¸‹ä¸ªæ­¥éª¤çš„å‰æï¼‰è¿™å°±CompletableFutrureå‡ºæ¥çš„ä¼ç¬”ã€‚" class="headerlink" title="6é’ˆå¯¹futuretask çš„æ”¹è¿›ä¸éœ€é€šè¿‡è½®è¯¢çš„æ–¹å¼çš„åˆ¤æ–­çš„çº¿ç¨‹ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œé€šè¿‡å›è°ƒé€šçŸ¥å‡½æ•°ã€‚å¼‚æ­¥ä»»åŠ¡çš„æ­¥éª¤ä¸Šçš„ä¾èµ–ï¼ˆä¸Šä¸€ä¸ªæ­¥éª¤æ—¶ä¸‹ä¸ªæ­¥éª¤çš„å‰æï¼‰è¿™å°±CompletableFutrureå‡ºæ¥çš„ä¼ç¬”ã€‚"></a>6é’ˆå¯¹futuretask çš„æ”¹è¿›ä¸éœ€é€šè¿‡è½®è¯¢çš„æ–¹å¼çš„åˆ¤æ–­çš„çº¿ç¨‹ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œé€šè¿‡å›è°ƒé€šçŸ¥å‡½æ•°ã€‚å¼‚æ­¥ä»»åŠ¡çš„æ­¥éª¤ä¸Šçš„ä¾èµ–ï¼ˆä¸Šä¸€ä¸ªæ­¥éª¤æ—¶ä¸‹ä¸ªæ­¥éª¤çš„å‰æï¼‰è¿™å°±CompletableFutrureå‡ºæ¥çš„ä¼ç¬”ã€‚</h5><h5 id="è€ƒç‚¹-CompletableFutuer-è°ƒç”¨-runAsync-supplyAsync-ç­‰é™æ€æ–¹æ³•ä¼ å…¥ä¸€ä¸ªå‚æ•°æ—¶å€™ï¼Œå®ƒçš„çº¿ç¨‹æ± æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#è€ƒç‚¹-CompletableFutuer-è°ƒç”¨-runAsync-supplyAsync-ç­‰é™æ€æ–¹æ³•ä¼ å…¥ä¸€ä¸ªå‚æ•°æ—¶å€™ï¼Œå®ƒçš„çº¿ç¨‹æ± æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="==è€ƒç‚¹   CompletableFutuer è°ƒç”¨ runAsync supplyAsync   ç­‰é™æ€æ–¹æ³•ä¼ å…¥ä¸€ä¸ªå‚æ•°æ—¶å€™ï¼Œå®ƒçš„çº¿ç¨‹æ± æ˜¯ä»€ä¹ˆï¼Ÿ=="></a>==è€ƒç‚¹   CompletableFutuer è°ƒç”¨ <code>runAsync</code> <code>supplyAsync</code>   ç­‰é™æ€æ–¹æ³•ä¼ å…¥ä¸€ä¸ªå‚æ•°æ—¶å€™ï¼Œå®ƒçš„çº¿ç¨‹æ± æ˜¯ä»€ä¹ˆï¼Ÿ==</h5><h6 id="åœ¨è°ƒç”¨CompletableFutuer-é™æ€æ–¹æ³•é»˜è®¤ä¸ä¼ å…¥çº¿ç¨‹æ± çš„å‚æ•°æ—¶å€™ï¼ŒCompletableFutuer-çš„ForkJoinpool-ã€‚"><a href="#åœ¨è°ƒç”¨CompletableFutuer-é™æ€æ–¹æ³•é»˜è®¤ä¸ä¼ å…¥çº¿ç¨‹æ± çš„å‚æ•°æ—¶å€™ï¼ŒCompletableFutuer-çš„ForkJoinpool-ã€‚" class="headerlink" title="åœ¨è°ƒç”¨CompletableFutuer é™æ€æ–¹æ³•é»˜è®¤ä¸ä¼ å…¥çº¿ç¨‹æ± çš„å‚æ•°æ—¶å€™ï¼ŒCompletableFutuer çš„ForkJoinpool ã€‚"></a>åœ¨è°ƒç”¨CompletableFutuer é™æ€æ–¹æ³•é»˜è®¤ä¸ä¼ å…¥çº¿ç¨‹æ± çš„å‚æ•°æ—¶å€™ï¼ŒCompletableFutuer çš„ForkJoinpool ã€‚</h6><h6 id="code"><a href="#code" class="headerlink" title="code"></a>code</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ExecutorService</span> pool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">try</span><span class="token punctuation">{</span>            <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>                <span class="token keyword">try</span><span class="token punctuation">{</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"come in"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> ruset <span class="token operator">=</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> ruset<span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>pool<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token operator">==</span><span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//æ— å¼‚å¸¸æƒ…å†µ</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸Šéƒ¨çš„è®¡ç®—ç»“æœæ—¶"</span><span class="token operator">+</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionally</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span><span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¼‚å¸¸æƒ…å†µæ˜¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸»è¦çº¿ç¨‹å¿™å…¶ä»–ä»»åŠ¡å»äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>               e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>           pool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å…³é—­çº¿ç¨‹æ± </span>       <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="è€ƒç‚¹-CompletableFuture-ç§æ–¹æ³•get-å’Œjoin-ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«"><a href="#è€ƒç‚¹-CompletableFuture-ç§æ–¹æ³•get-å’Œjoin-ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«" class="headerlink" title="==è€ƒç‚¹ CompletableFuture  ç§æ–¹æ³•get  å’Œjoin ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«=="></a>==è€ƒç‚¹ CompletableFuture  ç§æ–¹æ³•get  å’Œjoin ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«==</h5><h6 id="get-æ–¹æ³•éœ€è¦å£°æ˜æŠ›å¼‚å¸¸ï¼ŒäºŒjoin-ä¸éœ€è¦-getNowæ˜¯åˆ¤æ–­çº¿ç¨‹ä»»åŠ¡æ˜¯æ˜¯å¦å®Œæˆï¼Œå¦‚æœå®Œæˆå°±è¿”å›å®Œæˆçš„çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰å°±è¿”å›getNowçš„å‚æ•°çš„çš„å€¼ï¼ŒHandleè¿™ä¸ªæ–¹æ³•å¯ä»¥è·å¾—æ­£å¸¸å’Œå¼‚å¸¸çš„å‚æ•°ç»“æœã€‚"><a href="#get-æ–¹æ³•éœ€è¦å£°æ˜æŠ›å¼‚å¸¸ï¼ŒäºŒjoin-ä¸éœ€è¦-getNowæ˜¯åˆ¤æ–­çº¿ç¨‹ä»»åŠ¡æ˜¯æ˜¯å¦å®Œæˆï¼Œå¦‚æœå®Œæˆå°±è¿”å›å®Œæˆçš„çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰å°±è¿”å›getNowçš„å‚æ•°çš„çš„å€¼ï¼ŒHandleè¿™ä¸ªæ–¹æ³•å¯ä»¥è·å¾—æ­£å¸¸å’Œå¼‚å¸¸çš„å‚æ•°ç»“æœã€‚" class="headerlink" title="get æ–¹æ³•éœ€è¦å£°æ˜æŠ›å¼‚å¸¸ï¼ŒäºŒjoin ä¸éœ€è¦  getNowæ˜¯åˆ¤æ–­çº¿ç¨‹ä»»åŠ¡æ˜¯æ˜¯å¦å®Œæˆï¼Œå¦‚æœå®Œæˆå°±è¿”å›å®Œæˆçš„çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰å°±è¿”å›getNowçš„å‚æ•°çš„çš„å€¼ï¼ŒHandleè¿™ä¸ªæ–¹æ³•å¯ä»¥è·å¾—æ­£å¸¸å’Œå¼‚å¸¸çš„å‚æ•°ç»“æœã€‚"></a>get æ–¹æ³•éœ€è¦å£°æ˜æŠ›å¼‚å¸¸ï¼ŒäºŒjoin ä¸éœ€è¦  <code>getNow</code>æ˜¯åˆ¤æ–­çº¿ç¨‹ä»»åŠ¡æ˜¯æ˜¯å¦å®Œæˆï¼Œå¦‚æœå®Œæˆå°±è¿”å›å®Œæˆçš„çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰å°±è¿”å›getNowçš„å‚æ•°çš„çš„å€¼ï¼ŒHandleè¿™ä¸ªæ–¹æ³•å¯ä»¥è·å¾—æ­£å¸¸å’Œå¼‚å¸¸çš„å‚æ•°ç»“æœã€‚</h6><h5 id="è€ƒç‚¹-CompletableFuture-æ˜¯å¦éƒ½ä¸€ç›´è°ƒç”¨é»˜è®¤çš„çº¿ç¨‹æ± å—ï¼ŒthenApply-å’ŒthenApplyAsyncè¿™ä¸¤ä¸ªæ–¹æ³•æœ‰å•¥å´åˆ«"><a href="#è€ƒç‚¹-CompletableFuture-æ˜¯å¦éƒ½ä¸€ç›´è°ƒç”¨é»˜è®¤çš„çº¿ç¨‹æ± å—ï¼ŒthenApply-å’ŒthenApplyAsyncè¿™ä¸¤ä¸ªæ–¹æ³•æœ‰å•¥å´åˆ«" class="headerlink" title="==è€ƒç‚¹ CompletableFuture  æ˜¯å¦éƒ½ä¸€ç›´è°ƒç”¨é»˜è®¤çš„çº¿ç¨‹æ± å—ï¼ŒthenApply  å’ŒthenApplyAsyncè¿™ä¸¤ä¸ªæ–¹æ³•æœ‰å•¥å´åˆ«=="></a>==è€ƒç‚¹ CompletableFuture  æ˜¯å¦éƒ½ä¸€ç›´è°ƒç”¨é»˜è®¤çš„çº¿ç¨‹æ± å—ï¼ŒthenApply  å’ŒthenApplyAsyncè¿™ä¸¤ä¸ªæ–¹æ³•æœ‰å•¥å´åˆ«==</h5><h6 id="å¦‚æœæœ‰ä¼ å…¥è‡ªå®šä¹‰çš„çº¿ç¨‹æ± å°±æŒ‰ç…§ä¼ å…¥çº¿ç¨‹æ‰§è¡Œï¼Œå½“è°ƒ-ThenRun-æ–¹æ³•æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶å€™ï¼Œåˆ™ç¬¬äºŒä¸ªä»»åŠ¡å’Œç¬¬ä¸€ä¸ªä»»åŠ¡å…±ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå½“è°ƒç”¨ThenRunAsync-æ—¶å€™æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶å€™ï¼Œåˆ™ç¬¬ä¸€ä»»åŠ¡ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹æ± ï¼Œä»ç¬¬äºŒä¸ªä»»åŠ¡å¼€å§‹ä½¿ç”¨çš„å°±æ˜¯ForkJoin-çº¿ç¨‹æ± ã€‚-è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯-å¦‚æœmian-çº¿ç¨‹æ‰§è¡Œï¼Œé‚£ä¹ˆåç»­éƒ½ç”±mainçº¿ç¨‹æ‰§è¡Œä¸ä¼šåˆ‡æ¢çº¿ç¨‹æ± ã€‚ç³»ç»Ÿä¼˜åŒ–åŸåˆ™å‡å°‘åˆ‡æ¢ï¼Œmain-çº¿ç¨‹æ‰§è¡Œæ•ˆç‡å¤ªå¿«"><a href="#å¦‚æœæœ‰ä¼ å…¥è‡ªå®šä¹‰çš„çº¿ç¨‹æ± å°±æŒ‰ç…§ä¼ å…¥çº¿ç¨‹æ‰§è¡Œï¼Œå½“è°ƒ-ThenRun-æ–¹æ³•æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶å€™ï¼Œåˆ™ç¬¬äºŒä¸ªä»»åŠ¡å’Œç¬¬ä¸€ä¸ªä»»åŠ¡å…±ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå½“è°ƒç”¨ThenRunAsync-æ—¶å€™æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶å€™ï¼Œåˆ™ç¬¬ä¸€ä»»åŠ¡ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹æ± ï¼Œä»ç¬¬äºŒä¸ªä»»åŠ¡å¼€å§‹ä½¿ç”¨çš„å°±æ˜¯ForkJoin-çº¿ç¨‹æ± ã€‚-è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯-å¦‚æœmian-çº¿ç¨‹æ‰§è¡Œï¼Œé‚£ä¹ˆåç»­éƒ½ç”±mainçº¿ç¨‹æ‰§è¡Œä¸ä¼šåˆ‡æ¢çº¿ç¨‹æ± ã€‚ç³»ç»Ÿä¼˜åŒ–åŸåˆ™å‡å°‘åˆ‡æ¢ï¼Œmain-çº¿ç¨‹æ‰§è¡Œæ•ˆç‡å¤ªå¿«" class="headerlink" title="å¦‚æœæœ‰ä¼ å…¥è‡ªå®šä¹‰çš„çº¿ç¨‹æ± å°±æŒ‰ç…§ä¼ å…¥çº¿ç¨‹æ‰§è¡Œï¼Œå½“è°ƒ    ThenRun æ–¹æ³•æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶å€™ï¼Œåˆ™ç¬¬äºŒä¸ªä»»åŠ¡å’Œç¬¬ä¸€ä¸ªä»»åŠ¡å…±ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå½“è°ƒç”¨ThenRunAsync æ—¶å€™æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶å€™ï¼Œåˆ™ç¬¬ä¸€ä»»åŠ¡ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹æ± ï¼Œä»ç¬¬äºŒä¸ªä»»åŠ¡å¼€å§‹ä½¿ç”¨çš„å°±æ˜¯ForkJoin çº¿ç¨‹æ± ã€‚==è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ å¦‚æœmian  çº¿ç¨‹æ‰§è¡Œï¼Œé‚£ä¹ˆåç»­éƒ½ç”±mainçº¿ç¨‹æ‰§è¡Œä¸ä¼šåˆ‡æ¢çº¿ç¨‹æ± ã€‚ç³»ç»Ÿä¼˜åŒ–åŸåˆ™å‡å°‘åˆ‡æ¢ï¼Œmain çº¿ç¨‹æ‰§è¡Œæ•ˆç‡å¤ªå¿«=="></a>å¦‚æœæœ‰ä¼ å…¥è‡ªå®šä¹‰çš„çº¿ç¨‹æ± å°±æŒ‰ç…§ä¼ å…¥çº¿ç¨‹æ‰§è¡Œï¼Œå½“è°ƒ    ThenRun æ–¹æ³•æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶å€™ï¼Œåˆ™ç¬¬äºŒä¸ªä»»åŠ¡å’Œç¬¬ä¸€ä¸ªä»»åŠ¡å…±ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå½“è°ƒç”¨ThenRunAsync æ—¶å€™æ‰§è¡Œç¬¬äºŒä¸ªä»»åŠ¡æ—¶å€™ï¼Œåˆ™ç¬¬ä¸€ä»»åŠ¡ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹æ± ï¼Œä»ç¬¬äºŒä¸ªä»»åŠ¡å¼€å§‹ä½¿ç”¨çš„å°±æ˜¯ForkJoin çº¿ç¨‹æ± ã€‚==è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ å¦‚æœmian  çº¿ç¨‹æ‰§è¡Œï¼Œé‚£ä¹ˆåç»­éƒ½ç”±mainçº¿ç¨‹æ‰§è¡Œä¸ä¼šåˆ‡æ¢çº¿ç¨‹æ± ã€‚ç³»ç»Ÿä¼˜åŒ–åŸåˆ™å‡å°‘åˆ‡æ¢ï¼Œmain çº¿ç¨‹æ‰§è¡Œæ•ˆç‡å¤ªå¿«==</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompleateFutureAPIDome</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ExecutorService</span> pool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è‡ªå®šä¹‰çº¿ç¨‹æ± </span>        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>            <span class="token keyword">try</span><span class="token punctuation">{</span>                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>pool<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span><span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å½“å‰çº¿ç¨‹æ± æ˜¯pool</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"222"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span><span class="token punctuation">{</span><span class="token comment">//è¿™ä¸ªä¹‹åéƒ½æ˜¯é»˜è®¤çº¿ç¨‹æ± </span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å½“å‰çº¿ç¨‹æ± æ˜¯ ForkJoin çº¿ç¨‹æ± </span>                       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"333"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰“å°å‡ºæ¥æ˜¯"</span><span class="token operator">+</span>v <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionally</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span><span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E4%B8%A4%E7%A7%8D%E7%9A%84%E5%8C%BA%E5%88%AB.png" alt="è¿™ä¸¤ç§çš„åŒºåˆ«çš„å›¾ä¾‹"></p><h3 id="Java-é”çš„å“ªäº›äº‹"><a href="#Java-é”çš„å“ªäº›äº‹" class="headerlink" title="Java é”çš„å“ªäº›äº‹"></a>Java é”çš„å“ªäº›äº‹</h3><h4 id="ä½•ä¸ºæ‚²è§‚é”ä½•ä¸ºä¹è§‚é”"><a href="#ä½•ä¸ºæ‚²è§‚é”ä½•ä¸ºä¹è§‚é”" class="headerlink" title="==ä½•ä¸ºæ‚²è§‚é”ä½•ä¸ºä¹è§‚é”=="></a>==ä½•ä¸ºæ‚²è§‚é”ä½•ä¸ºä¹è§‚é”==</h4><h5 id="æ‚²è§‚é”æ¦‚å¿µï¼šå¤§ç™½è¯çš„ï¼Œçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡å…¶ä»–çº¿ç¨‹ä¸€å®šä¼šå’Œå®ƒæŠ¢èµ„æºï¼Œå› æ­¤åœ¨è·å–æ•°æ®ä¹‹å‰ä¸€å®šæ˜¯åŠ ä¸€æŠŠé”ï¼Œç¡®ä¿æ•°æ®å®‰å…¨æ²¡æœ‰èƒŒä¿®æ”¹è¿‡ã€‚è§„åˆ™æ˜¯å…ˆåŠ é”ã€‚"><a href="#æ‚²è§‚é”æ¦‚å¿µï¼šå¤§ç™½è¯çš„ï¼Œçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡å…¶ä»–çº¿ç¨‹ä¸€å®šä¼šå’Œå®ƒæŠ¢èµ„æºï¼Œå› æ­¤åœ¨è·å–æ•°æ®ä¹‹å‰ä¸€å®šæ˜¯åŠ ä¸€æŠŠé”ï¼Œç¡®ä¿æ•°æ®å®‰å…¨æ²¡æœ‰èƒŒä¿®æ”¹è¿‡ã€‚è§„åˆ™æ˜¯å…ˆåŠ é”ã€‚" class="headerlink" title="æ‚²è§‚é”æ¦‚å¿µï¼šå¤§ç™½è¯çš„ï¼Œçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡å…¶ä»–çº¿ç¨‹ä¸€å®šä¼šå’Œå®ƒæŠ¢èµ„æºï¼Œå› æ­¤åœ¨è·å–æ•°æ®ä¹‹å‰ä¸€å®šæ˜¯åŠ ä¸€æŠŠé”ï¼Œç¡®ä¿æ•°æ®å®‰å…¨æ²¡æœ‰èƒŒä¿®æ”¹è¿‡ã€‚è§„åˆ™æ˜¯å…ˆåŠ é”ã€‚"></a>æ‚²è§‚é”æ¦‚å¿µï¼šå¤§ç™½è¯çš„ï¼Œçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡å…¶ä»–çº¿ç¨‹ä¸€å®šä¼šå’Œå®ƒæŠ¢èµ„æºï¼Œå› æ­¤åœ¨è·å–æ•°æ®ä¹‹å‰ä¸€å®šæ˜¯åŠ ä¸€æŠŠé”ï¼Œç¡®ä¿æ•°æ®å®‰å…¨æ²¡æœ‰èƒŒä¿®æ”¹è¿‡ã€‚è§„åˆ™æ˜¯å…ˆåŠ é”ã€‚</h5><h5 id="ä¹è§‚é”çš„æ¦‚å¿µï¼šçº¿ç¨‹æ‰§è¡Œçš„æ—¶å€™è®¤ä¸ºä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹å’Œå®ƒæŠ¢å èµ„æºï¼ˆå…¶ä»–çº¿ç¨‹ä¸ä¼šä¿®æ”¹æ•°æ®ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šåŠ é”ã€‚è§„åˆ™ä¸ä¼šåŠ é”ï¼Œä½†æ˜¯é€šè¿‡ç‰ˆæœ¬å¥½çš„è¿­ä»£æˆ–è€…CAS-è‡ªæ—‹æ¥åˆ¤æ–­ã€‚ï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢çš„çŠ¶æ€ï¼‰"><a href="#ä¹è§‚é”çš„æ¦‚å¿µï¼šçº¿ç¨‹æ‰§è¡Œçš„æ—¶å€™è®¤ä¸ºä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹å’Œå®ƒæŠ¢å èµ„æºï¼ˆå…¶ä»–çº¿ç¨‹ä¸ä¼šä¿®æ”¹æ•°æ®ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šåŠ é”ã€‚è§„åˆ™ä¸ä¼šåŠ é”ï¼Œä½†æ˜¯é€šè¿‡ç‰ˆæœ¬å¥½çš„è¿­ä»£æˆ–è€…CAS-è‡ªæ—‹æ¥åˆ¤æ–­ã€‚ï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢çš„çŠ¶æ€ï¼‰" class="headerlink" title="ä¹è§‚é”çš„æ¦‚å¿µï¼šçº¿ç¨‹æ‰§è¡Œçš„æ—¶å€™è®¤ä¸ºä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹å’Œå®ƒæŠ¢å èµ„æºï¼ˆå…¶ä»–çº¿ç¨‹ä¸ä¼šä¿®æ”¹æ•°æ®ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šåŠ é”ã€‚è§„åˆ™ä¸ä¼šåŠ é”ï¼Œä½†æ˜¯é€šè¿‡ç‰ˆæœ¬å¥½çš„è¿­ä»£æˆ–è€…CAS è‡ªæ—‹æ¥åˆ¤æ–­ã€‚ï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢çš„çŠ¶æ€ï¼‰"></a>ä¹è§‚é”çš„æ¦‚å¿µï¼šçº¿ç¨‹æ‰§è¡Œçš„æ—¶å€™è®¤ä¸ºä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹å’Œå®ƒæŠ¢å èµ„æºï¼ˆå…¶ä»–çº¿ç¨‹ä¸ä¼šä¿®æ”¹æ•°æ®ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šåŠ é”ã€‚è§„åˆ™ä¸ä¼šåŠ é”ï¼Œä½†æ˜¯é€šè¿‡ç‰ˆæœ¬å¥½çš„è¿­ä»£æˆ–è€…CAS è‡ªæ—‹æ¥åˆ¤æ–­ã€‚ï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢çš„çŠ¶æ€ï¼‰</h5><h4 id="æ ¹æ®8-é”ç”¨ä¾‹åœºæ™¯æ€»ç»“"><a href="#æ ¹æ®8-é”ç”¨ä¾‹åœºæ™¯æ€»ç»“" class="headerlink" title="==æ ¹æ®8 é”ç”¨ä¾‹åœºæ™¯æ€»ç»“=="></a>==æ ¹æ®8 é”ç”¨ä¾‹åœºæ™¯æ€»ç»“==</h4><h5 id="å½“å¯¹è±¡åŒæ—¶å¤šä¸ªsynchronzied-æ–¹æ³•ï¼Œå½“æŸä¸€æ—¶åˆ»å†…ï¼Œåªè¦ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨å…¶ä¸­çš„ä¸€ä¸ªsynchronzied-æ–¹æ³•-å…¶ä»–çº¿éƒ½è¦ç­‰å¾…å®ƒæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œã€‚é”æ˜¯å½“å‰å¯¹è±¡this-å› ä¸ºå¯¹è±¡æ˜¯jvm-å †é‡Œé¢"><a href="#å½“å¯¹è±¡åŒæ—¶å¤šä¸ªsynchronzied-æ–¹æ³•ï¼Œå½“æŸä¸€æ—¶åˆ»å†…ï¼Œåªè¦ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨å…¶ä¸­çš„ä¸€ä¸ªsynchronzied-æ–¹æ³•-å…¶ä»–çº¿éƒ½è¦ç­‰å¾…å®ƒæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œã€‚é”æ˜¯å½“å‰å¯¹è±¡this-å› ä¸ºå¯¹è±¡æ˜¯jvm-å †é‡Œé¢" class="headerlink" title="å½“å¯¹è±¡åŒæ—¶å¤šä¸ªsynchronzied æ–¹æ³•ï¼Œå½“æŸä¸€æ—¶åˆ»å†…ï¼Œåªè¦ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨å…¶ä¸­çš„ä¸€ä¸ªsynchronzied æ–¹æ³• å…¶ä»–çº¿éƒ½è¦ç­‰å¾…å®ƒæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œã€‚é”æ˜¯å½“å‰å¯¹è±¡this  å› ä¸ºå¯¹è±¡æ˜¯jvm å †é‡Œé¢"></a>å½“å¯¹è±¡åŒæ—¶å¤šä¸ªsynchronzied æ–¹æ³•ï¼Œå½“æŸä¸€æ—¶åˆ»å†…ï¼Œåªè¦ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨å…¶ä¸­çš„ä¸€ä¸ªsynchronzied æ–¹æ³• å…¶ä»–çº¿éƒ½è¦ç­‰å¾…å®ƒæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œã€‚é”æ˜¯å½“å‰å¯¹è±¡this  å› ä¸ºå¯¹è±¡æ˜¯jvm å †é‡Œé¢</h5><h5 id="å½“æ²¡æœ‰äº§ç”Ÿç«äº‰æ—¶å€™ï¼Œå„è‡ªæ‹¿è‡ªå·±é”çš„æ‰§è¡Œã€‚"><a href="#å½“æ²¡æœ‰äº§ç”Ÿç«äº‰æ—¶å€™ï¼Œå„è‡ªæ‹¿è‡ªå·±é”çš„æ‰§è¡Œã€‚" class="headerlink" title="å½“æ²¡æœ‰äº§ç”Ÿç«äº‰æ—¶å€™ï¼Œå„è‡ªæ‹¿è‡ªå·±é”çš„æ‰§è¡Œã€‚"></a>å½“æ²¡æœ‰äº§ç”Ÿç«äº‰æ—¶å€™ï¼Œå„è‡ªæ‹¿è‡ªå·±é”çš„æ‰§è¡Œã€‚</h5><h5 id="static-sychronzied-é”çš„æ˜¯å½“å‰-ç±»å‹æ¨¡æ¿ã€‚class-ç±»é”-jvm-çš„æ–¹æ³•åŒºé‡Œé¢-åªæœ‰å”¯ä¸€-ä¸€ä¸ª"><a href="#static-sychronzied-é”çš„æ˜¯å½“å‰-ç±»å‹æ¨¡æ¿ã€‚class-ç±»é”-jvm-çš„æ–¹æ³•åŒºé‡Œé¢-åªæœ‰å”¯ä¸€-ä¸€ä¸ª" class="headerlink" title="static sychronzied   é”çš„æ˜¯å½“å‰ ç±»å‹æ¨¡æ¿ã€‚class  (ç±»é”)  jvm çš„æ–¹æ³•åŒºé‡Œé¢   åªæœ‰å”¯ä¸€ ä¸€ä¸ª"></a>static sychronzied   é”çš„æ˜¯å½“å‰ ç±»å‹æ¨¡æ¿ã€‚class  (ç±»é”)  jvm çš„æ–¹æ³•åŒºé‡Œé¢   åªæœ‰å”¯ä¸€ ä¸€ä¸ª</h5><h5 id="å¯¹-åŒæ­¥ä»£ç å—-é”çš„-sychronzied-æ‹¬å·çš„å¯¹è±¡"><a href="#å¯¹-åŒæ­¥ä»£ç å—-é”çš„-sychronzied-æ‹¬å·çš„å¯¹è±¡" class="headerlink" title="å¯¹ åŒæ­¥ä»£ç å— é”çš„ sychronzied   æ‹¬å·çš„å¯¹è±¡"></a>å¯¹ åŒæ­¥ä»£ç å— é”çš„ sychronzied   æ‹¬å·çš„å¯¹è±¡</h5><h5 id="æ€»ä¹‹æ ¹æ®é”ä¸åŒï¼Œåˆ†ææ˜¯å¯¹è±¡é”è¿˜æ˜¯ï¼Œç±»é”ï¼Œæˆ–è€…åŒæ­¥ä»£ç å—ï¼Œå¦‚æœä¸åŒé”ï¼Œä¸é‚£ä¹ˆä¸ä¼šæœ‰ç«äº‰å…³ç³»ï¼Œå„è‡ªæ‰§è¡Œå„è‡ªäº’ä¸ç›¸å¹²æ‰°ï¼Œä½¿ç”¨é”çš„åŸåˆ™ç”¨æ— é”å°½é‡ï¼Œå®åœ¨ä¸è¡Œå°±åŒä»£ç å—ï¼Œåœ¨ä¸è¡Œä½¿ç”¨å¯¹è±¡-ï¼Œæœ€åæ‰è€ƒè™‘ç±»é”ã€‚é”ç²’åº¦å¤§å°æ’åº-åˆ°å¤§-æ— é”-lt-åŒæ­¥ä»£ç å—-lt-å¯¹è±¡é”-lt-ç±»é”"><a href="#æ€»ä¹‹æ ¹æ®é”ä¸åŒï¼Œåˆ†ææ˜¯å¯¹è±¡é”è¿˜æ˜¯ï¼Œç±»é”ï¼Œæˆ–è€…åŒæ­¥ä»£ç å—ï¼Œå¦‚æœä¸åŒé”ï¼Œä¸é‚£ä¹ˆä¸ä¼šæœ‰ç«äº‰å…³ç³»ï¼Œå„è‡ªæ‰§è¡Œå„è‡ªäº’ä¸ç›¸å¹²æ‰°ï¼Œä½¿ç”¨é”çš„åŸåˆ™ç”¨æ— é”å°½é‡ï¼Œå®åœ¨ä¸è¡Œå°±åŒä»£ç å—ï¼Œåœ¨ä¸è¡Œä½¿ç”¨å¯¹è±¡-ï¼Œæœ€åæ‰è€ƒè™‘ç±»é”ã€‚é”ç²’åº¦å¤§å°æ’åº-åˆ°å¤§-æ— é”-lt-åŒæ­¥ä»£ç å—-lt-å¯¹è±¡é”-lt-ç±»é”" class="headerlink" title="==æ€»ä¹‹æ ¹æ®é”ä¸åŒï¼Œåˆ†ææ˜¯å¯¹è±¡é”è¿˜æ˜¯ï¼Œç±»é”ï¼Œæˆ–è€…åŒæ­¥ä»£ç å—ï¼Œå¦‚æœä¸åŒé”ï¼Œä¸é‚£ä¹ˆä¸ä¼šæœ‰ç«äº‰å…³ç³»ï¼Œå„è‡ªæ‰§è¡Œå„è‡ªäº’ä¸ç›¸å¹²æ‰°ï¼Œä½¿ç”¨é”çš„åŸåˆ™ç”¨æ— é”å°½é‡ï¼Œå®åœ¨ä¸è¡Œå°±åŒä»£ç å—ï¼Œåœ¨ä¸è¡Œä½¿ç”¨å¯¹è±¡ ï¼Œæœ€åæ‰è€ƒè™‘ç±»é”ã€‚é”ç²’åº¦å¤§å°æ’åº åˆ°å¤§   æ— é”    < åŒæ­¥ä»£ç å—  < å¯¹è±¡é”   < ç±»é”=="></a>==æ€»ä¹‹æ ¹æ®é”ä¸åŒï¼Œåˆ†ææ˜¯å¯¹è±¡é”è¿˜æ˜¯ï¼Œç±»é”ï¼Œæˆ–è€…åŒæ­¥ä»£ç å—ï¼Œå¦‚æœä¸åŒé”ï¼Œä¸é‚£ä¹ˆä¸ä¼šæœ‰ç«äº‰å…³ç³»ï¼Œå„è‡ªæ‰§è¡Œå„è‡ªäº’ä¸ç›¸å¹²æ‰°ï¼Œä½¿ç”¨é”çš„åŸåˆ™ç”¨æ— é”å°½é‡ï¼Œå®åœ¨ä¸è¡Œå°±åŒä»£ç å—ï¼Œåœ¨ä¸è¡Œä½¿ç”¨å¯¹è±¡ ï¼Œæœ€åæ‰è€ƒè™‘ç±»é”ã€‚é”ç²’åº¦å¤§å°æ’åº åˆ°å¤§   æ— é”    &lt; åŒæ­¥ä»£ç å—  &lt; å¯¹è±¡é”   &lt; ç±»é”==</h5><h5 id="åŒæ­¥ä»£ç -åç¼–è¯‘çœ‹-æ˜¯ç”¨-javap-c-æŸ¥çœ‹-åº•å±‚sychronized-morritorenter-å’Œmonitorexit-ä½†ä¸ºå•¥ä¼šä¸¤ä¸ª-monitorexit"><a href="#åŒæ­¥ä»£ç -åç¼–è¯‘çœ‹-æ˜¯ç”¨-javap-c-æŸ¥çœ‹-åº•å±‚sychronized-morritorenter-å’Œmonitorexit-ä½†ä¸ºå•¥ä¼šä¸¤ä¸ª-monitorexit" class="headerlink" title="==åŒæ­¥ä»£ç  åç¼–è¯‘çœ‹ æ˜¯ç”¨  javap  -c   æŸ¥çœ‹  åº•å±‚sychronized  morritorenter   å’Œmonitorexit,ä½†ä¸ºå•¥ä¼šä¸¤ä¸ª monitorexit=="></a>==åŒæ­¥ä»£ç  åç¼–è¯‘çœ‹ æ˜¯ç”¨  javap  -c   æŸ¥çœ‹  åº•å±‚sychronized  morritorenter   å’Œmonitorexit,ä½†ä¸ºå•¥ä¼šä¸¤ä¸ª monitorexit==</h5><h6 id="æ˜¯å”¯ä¸€æ­£å¸¸æƒ…å†µè·å¾—æ‰§è¡Œå®Œæ¯•é‡Šæ”¾é”ï¼Œä½†è¦å¼‚å¸¸æƒ…å†µä¹Ÿå¯ä»¥é‡Šæ”¾é”ã€‚æ‰€ä»¥åŠ ä¸¤ä¸ªçš„-monitorexitï¼ŒäºŒå¯¹è±¡é”å’Œç±»å‹-å®ƒä»¬åç¼–è¯‘ä¹‹åå¯ä»¥çœ‹-ACC-SYCHRONIZED-ä»¥åŠç±»é”"><a href="#æ˜¯å”¯ä¸€æ­£å¸¸æƒ…å†µè·å¾—æ‰§è¡Œå®Œæ¯•é‡Šæ”¾é”ï¼Œä½†è¦å¼‚å¸¸æƒ…å†µä¹Ÿå¯ä»¥é‡Šæ”¾é”ã€‚æ‰€ä»¥åŠ ä¸¤ä¸ªçš„-monitorexitï¼ŒäºŒå¯¹è±¡é”å’Œç±»å‹-å®ƒä»¬åç¼–è¯‘ä¹‹åå¯ä»¥çœ‹-ACC-SYCHRONIZED-ä»¥åŠç±»é”" class="headerlink" title="æ˜¯å”¯ä¸€æ­£å¸¸æƒ…å†µè·å¾—æ‰§è¡Œå®Œæ¯•é‡Šæ”¾é”ï¼Œä½†è¦å¼‚å¸¸æƒ…å†µä¹Ÿå¯ä»¥é‡Šæ”¾é”ã€‚æ‰€ä»¥åŠ ä¸¤ä¸ªçš„ monitorexitï¼ŒäºŒå¯¹è±¡é”å’Œç±»å‹ å®ƒä»¬åç¼–è¯‘ä¹‹åå¯ä»¥çœ‹  ACC_SYCHRONIZED ,ä»¥åŠç±»é”"></a>æ˜¯å”¯ä¸€æ­£å¸¸æƒ…å†µè·å¾—æ‰§è¡Œå®Œæ¯•é‡Šæ”¾é”ï¼Œä½†è¦å¼‚å¸¸æƒ…å†µä¹Ÿå¯ä»¥é‡Šæ”¾é”ã€‚æ‰€ä»¥åŠ ä¸¤ä¸ªçš„ monitorexitï¼ŒäºŒå¯¹è±¡é”å’Œç±»å‹ å®ƒä»¬åç¼–è¯‘ä¹‹åå¯ä»¥çœ‹  ACC_SYCHRONIZED ,ä»¥åŠç±»é”</h6><h4 id="å…¬å¹³é”-å’Œéå…¬å¹³é”"><a href="#å…¬å¹³é”-å’Œéå…¬å¹³é”" class="headerlink" title="==å…¬å¹³é” å’Œéå…¬å¹³é”=="></a>==å…¬å¹³é” å’Œéå…¬å¹³é”==</h4><h5 id="å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œç±»ä¼¼äºæ’é˜Ÿä¹°é¥­ï¼Œå…ˆæ¥ååˆ°ï¼Œå…ˆæ¥å…ˆæœåŠ¡ï¼Œå°±æ˜¯å…¬å¹³çš„ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—"><a href="#å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œç±»ä¼¼äºæ’é˜Ÿä¹°é¥­ï¼Œå…ˆæ¥ååˆ°ï¼Œå…ˆæ¥å…ˆæœåŠ¡ï¼Œå°±æ˜¯å…¬å¹³çš„ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—" class="headerlink" title="å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œç±»ä¼¼äºæ’é˜Ÿä¹°é¥­ï¼Œå…ˆæ¥ååˆ°ï¼Œå…ˆæ¥å…ˆæœåŠ¡ï¼Œå°±æ˜¯å…¬å¹³çš„ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—"></a>å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œç±»ä¼¼äºæ’é˜Ÿä¹°é¥­ï¼Œå…ˆæ¥ååˆ°ï¼Œå…ˆæ¥å…ˆæœåŠ¡ï¼Œå°±æ˜¯å…¬å¹³çš„ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—</h5><h5 id="éå…¬å¹³é”-æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹ä¸ä¼š-æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œæœ‰çš„é”-æ’é˜Ÿï¼Œè€Œä¸”æ’é˜Ÿæ‰§è¡Œä¹‹åï¼Œå¯èƒ½ä¼šç»§ç»­å†æ¥æ’é˜Ÿåˆæ’é˜Ÿç›¸æ¯”å…¶ä»–çº¿ç¨‹ä¸å…¬å¹³çš„æŠ¢å¤ºcpuèµ„æºçš„ã€‚"><a href="#éå…¬å¹³é”-æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹ä¸ä¼š-æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œæœ‰çš„é”-æ’é˜Ÿï¼Œè€Œä¸”æ’é˜Ÿæ‰§è¡Œä¹‹åï¼Œå¯èƒ½ä¼šç»§ç»­å†æ¥æ’é˜Ÿåˆæ’é˜Ÿç›¸æ¯”å…¶ä»–çº¿ç¨‹ä¸å…¬å¹³çš„æŠ¢å¤ºcpuèµ„æºçš„ã€‚" class="headerlink" title="éå…¬å¹³é” æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹ä¸ä¼š    æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œæœ‰çš„é” æ’é˜Ÿï¼Œè€Œä¸”æ’é˜Ÿæ‰§è¡Œä¹‹åï¼Œå¯èƒ½ä¼šç»§ç»­å†æ¥æ’é˜Ÿåˆæ’é˜Ÿç›¸æ¯”å…¶ä»–çº¿ç¨‹ä¸å…¬å¹³çš„æŠ¢å¤ºcpuèµ„æºçš„ã€‚"></a>éå…¬å¹³é” æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹ä¸ä¼š    æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œæœ‰çš„é” æ’é˜Ÿï¼Œè€Œä¸”æ’é˜Ÿæ‰§è¡Œä¹‹åï¼Œå¯èƒ½ä¼šç»§ç»­å†æ¥æ’é˜Ÿåˆæ’é˜Ÿç›¸æ¯”å…¶ä»–çº¿ç¨‹ä¸å…¬å¹³çš„æŠ¢å¤ºcpuèµ„æºçš„ã€‚</h5><h5 id="ä¸ºå•¥é»˜è®¤æ˜¯éå…¬å¹³çš„ï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™ç”¨å…¬å¹³ä»€ä¹ˆæ—¶å€™ç”¨éå…¬å¹³"><a href="#ä¸ºå•¥é»˜è®¤æ˜¯éå…¬å¹³çš„ï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™ç”¨å…¬å¹³ä»€ä¹ˆæ—¶å€™ç”¨éå…¬å¹³" class="headerlink" title="==ä¸ºå•¥é»˜è®¤æ˜¯éå…¬å¹³çš„ï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™ç”¨å…¬å¹³ä»€ä¹ˆæ—¶å€™ç”¨éå…¬å¹³=="></a>==ä¸ºå•¥é»˜è®¤æ˜¯éå…¬å¹³çš„ï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™ç”¨å…¬å¹³ä»€ä¹ˆæ—¶å€™ç”¨éå…¬å¹³==</h5><h6 id="é¦–å…ˆé»˜è®¤ä½¿ç”¨éå…¬å¹³çš„æ—¶å€™ï¼Œç³»ç»Ÿå‡å°‘çº¿ç¨‹åˆ‡æ¢æ¬¡æ•°ã€‚æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå¯¹äºä½•ä¸ºä½¿ç”¨å…¬å¹³å’Œéå…¬å¹³çš„ã€‚é‚£æ ¹æ®å…·ä½“ä¸šåŠ¡å…·ä½“åˆ†æä¾‹å¦‚åŒ»é™¢æŒ‚å·çš„å¯ä»¥ä½¿ç”¨å…¬å¹³ä¿è¯æ²¡æœ‰æ¯ä¸ªäººéƒ½è¢«å«åˆ°ï¼Œéå…¬å¹³ä¾‹å¦‚ç­‰çº¢ç»¿ç¯æ—¶å€™ä¸»å¹²é“çš„è½¦è¾†æ¯”è¾ƒå¤šï¼Œéœ€è¦æ”¾è¡Œè½¦è¾†æ¬¡æ•°å¤šï¼Œæ¬¡è¦å¹²é“è½¦æµå°‘ã€‚ç”šè‡³æ²¡æœ‰è½¦ã€‚æ‰€ä»¥ä½¿ç”¨éå…¬å¹³è®©äº¤é€šæµç•…"><a href="#é¦–å…ˆé»˜è®¤ä½¿ç”¨éå…¬å¹³çš„æ—¶å€™ï¼Œç³»ç»Ÿå‡å°‘çº¿ç¨‹åˆ‡æ¢æ¬¡æ•°ã€‚æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå¯¹äºä½•ä¸ºä½¿ç”¨å…¬å¹³å’Œéå…¬å¹³çš„ã€‚é‚£æ ¹æ®å…·ä½“ä¸šåŠ¡å…·ä½“åˆ†æä¾‹å¦‚åŒ»é™¢æŒ‚å·çš„å¯ä»¥ä½¿ç”¨å…¬å¹³ä¿è¯æ²¡æœ‰æ¯ä¸ªäººéƒ½è¢«å«åˆ°ï¼Œéå…¬å¹³ä¾‹å¦‚ç­‰çº¢ç»¿ç¯æ—¶å€™ä¸»å¹²é“çš„è½¦è¾†æ¯”è¾ƒå¤šï¼Œéœ€è¦æ”¾è¡Œè½¦è¾†æ¬¡æ•°å¤šï¼Œæ¬¡è¦å¹²é“è½¦æµå°‘ã€‚ç”šè‡³æ²¡æœ‰è½¦ã€‚æ‰€ä»¥ä½¿ç”¨éå…¬å¹³è®©äº¤é€šæµç•…" class="headerlink" title="é¦–å…ˆé»˜è®¤ä½¿ç”¨éå…¬å¹³çš„æ—¶å€™ï¼Œç³»ç»Ÿå‡å°‘çº¿ç¨‹åˆ‡æ¢æ¬¡æ•°ã€‚æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå¯¹äºä½•ä¸ºä½¿ç”¨å…¬å¹³å’Œéå…¬å¹³çš„ã€‚é‚£æ ¹æ®å…·ä½“ä¸šåŠ¡å…·ä½“åˆ†æä¾‹å¦‚åŒ»é™¢æŒ‚å·çš„å¯ä»¥ä½¿ç”¨å…¬å¹³ä¿è¯æ²¡æœ‰æ¯ä¸ªäººéƒ½è¢«å«åˆ°ï¼Œéå…¬å¹³ä¾‹å¦‚ç­‰çº¢ç»¿ç¯æ—¶å€™ä¸»å¹²é“çš„è½¦è¾†æ¯”è¾ƒå¤šï¼Œéœ€è¦æ”¾è¡Œè½¦è¾†æ¬¡æ•°å¤šï¼Œæ¬¡è¦å¹²é“è½¦æµå°‘ã€‚ç”šè‡³æ²¡æœ‰è½¦ã€‚æ‰€ä»¥ä½¿ç”¨éå…¬å¹³è®©äº¤é€šæµç•…"></a>é¦–å…ˆé»˜è®¤ä½¿ç”¨éå…¬å¹³çš„æ—¶å€™ï¼Œç³»ç»Ÿå‡å°‘çº¿ç¨‹åˆ‡æ¢æ¬¡æ•°ã€‚æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå¯¹äºä½•ä¸ºä½¿ç”¨å…¬å¹³å’Œéå…¬å¹³çš„ã€‚é‚£æ ¹æ®å…·ä½“ä¸šåŠ¡å…·ä½“åˆ†æä¾‹å¦‚åŒ»é™¢æŒ‚å·çš„å¯ä»¥ä½¿ç”¨å…¬å¹³ä¿è¯æ²¡æœ‰æ¯ä¸ªäººéƒ½è¢«å«åˆ°ï¼Œéå…¬å¹³ä¾‹å¦‚ç­‰çº¢ç»¿ç¯æ—¶å€™ä¸»å¹²é“çš„è½¦è¾†æ¯”è¾ƒå¤šï¼Œéœ€è¦æ”¾è¡Œè½¦è¾†æ¬¡æ•°å¤šï¼Œæ¬¡è¦å¹²é“è½¦æµå°‘ã€‚ç”šè‡³æ²¡æœ‰è½¦ã€‚æ‰€ä»¥ä½¿ç”¨éå…¬å¹³è®©äº¤é€šæµç•…</h6><h4 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="==åå‘é”=="></a>==åå‘é”==</h4><h5 id="åå‘é”-å•çº¿ç¨‹ç«äº‰å½“çº¿ç¨‹Aç¬¬ä¸€æ¬¡ç«äº‰åˆ°é”æ—¶ï¼Œé€šè¿‡æ“ä½œä¿®æ”¹Mark-Wordä¸­çš„åå‘çº¿ç¨‹IDã€åå‘æ¨¡å¼å¦‚æœä¸å­˜åœ¨å…¶ä»–çº¿ç¨‹ç«äº‰ï¼Œé‚£ä¹ˆæŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚ï¼ˆ-å‡å°‘ç”¨æˆ·æ€å†…æ ¸æ€åˆ‡æ¢-ï¼‰"><a href="#åå‘é”-å•çº¿ç¨‹ç«äº‰å½“çº¿ç¨‹Aç¬¬ä¸€æ¬¡ç«äº‰åˆ°é”æ—¶ï¼Œé€šè¿‡æ“ä½œä¿®æ”¹Mark-Wordä¸­çš„åå‘çº¿ç¨‹IDã€åå‘æ¨¡å¼å¦‚æœä¸å­˜åœ¨å…¶ä»–çº¿ç¨‹ç«äº‰ï¼Œé‚£ä¹ˆæŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚ï¼ˆ-å‡å°‘ç”¨æˆ·æ€å†…æ ¸æ€åˆ‡æ¢-ï¼‰" class="headerlink" title="åå‘é”:å•çº¿ç¨‹ç«äº‰å½“çº¿ç¨‹Aç¬¬ä¸€æ¬¡ç«äº‰åˆ°é”æ—¶ï¼Œé€šè¿‡æ“ä½œä¿®æ”¹Mark Wordä¸­çš„åå‘çº¿ç¨‹IDã€åå‘æ¨¡å¼å¦‚æœä¸å­˜åœ¨å…¶ä»–çº¿ç¨‹ç«äº‰ï¼Œé‚£ä¹ˆæŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚ï¼ˆ==å‡å°‘ç”¨æˆ·æ€å†…æ ¸æ€åˆ‡æ¢==ï¼‰"></a>åå‘é”:å•çº¿ç¨‹ç«äº‰å½“çº¿ç¨‹Aç¬¬ä¸€æ¬¡ç«äº‰åˆ°é”æ—¶ï¼Œé€šè¿‡æ“ä½œä¿®æ”¹Mark Wordä¸­çš„åå‘çº¿ç¨‹IDã€åå‘æ¨¡å¼å¦‚æœä¸å­˜åœ¨å…¶ä»–çº¿ç¨‹ç«äº‰ï¼Œé‚£ä¹ˆæŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚ï¼ˆ==å‡å°‘ç”¨æˆ·æ€å†…æ ¸æ€åˆ‡æ¢==ï¼‰</h5><h5 id="ä½œç”¨ï¼š-å½“ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è®¿é—®ï¼Œç”±äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹é‚£å¹ºè¯¥çº¿ç¨‹åœ¨åç»­è®¿é—®æ—¶ä¾¿ä¼šè‡ªåŠ¨è·å¾—é”ã€‚"><a href="#ä½œç”¨ï¼š-å½“ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è®¿é—®ï¼Œç”±äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹é‚£å¹ºè¯¥çº¿ç¨‹åœ¨åç»­è®¿é—®æ—¶ä¾¿ä¼šè‡ªåŠ¨è·å¾—é”ã€‚" class="headerlink" title="ä½œç”¨ï¼š å½“ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è®¿é—®ï¼Œç”±äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹é‚£å¹ºè¯¥çº¿ç¨‹åœ¨åç»­è®¿é—®æ—¶ä¾¿ä¼šè‡ªåŠ¨è·å¾—é”ã€‚"></a>ä½œç”¨ï¼š å½“ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è®¿é—®ï¼Œç”±äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹é‚£å¹ºè¯¥çº¿ç¨‹åœ¨åç»­è®¿é—®æ—¶ä¾¿ä¼šè‡ªåŠ¨è·å¾—é”ã€‚</h5><h5 id="ç†è®ºè½åœ°"><a href="#ç†è®ºè½åœ°" class="headerlink" title="ç†è®ºè½åœ°"></a>ç†è®ºè½åœ°</h5><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">åœ¨å®é™…åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç°ï¼Œâ€œé”æ€»æ˜¯åŒä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œå¾ˆå°‘å‘ç”Ÿç«äº‰â€ï¼Œä¹Ÿå°±æ˜¯è¯´é”æ€»æ˜¯è¢«ç¬¬ä¸€ä¸ªå ç”¨ä»–çš„çº¿ç¨‹æ‹¥æœ‰ï¼Œè¿™ä¸ªçº¿ç¨‹å°±æ˜¯é”çš„åå‘çº¿ç¨‹ã€‚é‚£ä¹ˆåªéœ€è¦åœ¨é”ç¬¬ä¸€æ¬¡è¢«æ‹¥æœ‰çš„æ—¶å€™ï¼Œè®°å½•ä¸‹åå‘çº¿ç¨‹IDã€‚è¿™æ ·åå‘çº¿ç¨‹å°±ä¸€ç›´æŒæœ‰ç€é”(åç»­è¿™ä¸ªçº¿ç¨‹è¿›å…¥å’Œé€€å‡ºè¿™æ®µåŠ äº†åŒæ­¥é”çš„ä»£ç å—æ—¶ï¼Œä¸éœ€è¦å†æ¬¡åŠ é”å’Œé‡Šæ”¾é”ã€‚è€Œæ˜¯ç›´æ¥ä¼šå»æ£€æŸ¥é”çš„MarkWordé‡Œé¢æ˜¯ä¸æ˜¯æ”¾çš„è‡ªå·±çš„çº¿ç¨‹ID)ã€‚å¦‚æœç›¸ç­‰ï¼Œè¡¨ç¤ºåå‘é”æ˜¯åå‘äºå½“å‰çº¿ç¨‹çš„ï¼Œå°±ä¸éœ€è¦å†å°è¯•è·å¾—é”äº†ï¼Œç›´åˆ°ç«äº‰å‘ç”Ÿæ‰é‡Šæ”¾é”ã€‚ä»¥åæ¯æ¬¡åŒæ­¥ï¼Œæ£€æŸ¥é”çš„åå‘çº¿ç¨‹Dä¸å½“å‰çº¿ç¨‹IDæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ç›´æ¥è¿›å…¥åŒæ­¥ã€‚æ— éœ€æ¯æ¬¡åŠ é”è§£é”éƒ½å»CASæ›´æ–°å¯¹è±¡å¤´ã€‚å¦‚æœè‡ªå§‹è‡³ç»ˆä½¿ç”¨é”çš„çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œå¾ˆæ˜æ˜¾åå‘é”å‡ ä¹æ²¡æœ‰é¢å¤–å¼€é”€ï¼Œæ€§èƒ½æé«˜ã€‚å¦‚æœä¸ç­‰ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†ç«äº‰ï¼Œé”å·²ç»ä¸æ˜¯æ€»æ˜¯åå‘äºåŒä¸€ä¸ªçº¿ç¨‹äº†ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå°è¯•ä½¿ç”¨CASæ¥æ›¿æ¢MarkWordé‡Œé¢çš„çº¿ç¨‹IDä¸ºæ–°çº¿ç¨‹çš„IDï¼Œç«äº‰æˆåŠŸï¼Œè¡¨ç¤ºä¹‹å‰çš„çº¿ç¨‹ä¸å­˜åœ¨äº†ï¼Œ Markwordé‡Œé¢çš„çº¿ç¨‹IDä¸ºæ–°çº¿ç¨‹çš„IDï¼Œé”ä¸ä¼šå‡çº§ï¼Œä»ç„¶ä¸ºåå‘é”ï¼Œç«äº‰å¤±è´¥ï¼Œè¿™æ—¶å€™å¯èƒ½éœ€è¦å‡çº§å˜ä¸ºè½»é‡çº§é”ï¼Œæ‰èƒ½ä¿è¯çº¿ç¨‹é—´å…¬å¹³ç«äº‰é”ã€‚æ³¨æ„ï¼Œåå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹æ˜¯ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”çš„ã€‚æŠ€æœ¯å®ç°:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="æŠ€æœ¯å®ç°ï¼š"><a href="#æŠ€æœ¯å®ç°ï¼š" class="headerlink" title="æŠ€æœ¯å®ç°ï¼š"></a>æŠ€æœ¯å®ç°ï¼š</h5><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">ä¸€ä¸ªsynchronizedæ–¹æ³•è¢«ä¸€ä¸ªçº¿ç¨‹æŠ¢åˆ°äº†é”æ—¶ï¼Œé‚£è¿™ä¸ªæ–¹æ³•æ‰€åœ¨çš„å¯¹è±¡å°±ä¼šåœ¨å…¶æ‰€åœ¨çš„Mak Wordä¸­å°†åå‘é”ä¿®æ”¹çŠ¶æ€ä½ï¼ŒåŒæ—¶è¿˜ä¼šæœ‰å ç”¨å‰54ä½æ¥å­˜å‚¨çº¿ç¨‹æŒ‡é’ˆä½œä¸ºæ ‡è¯†ã€‚è‹¥è¯¥çº¿ç¨‹å†æ¬¡è®¿é—®åŒä¸€ä¸ªsynchronizedæ–¹æ³•æ—¶ï¼Œè¯¥çº¿ç¨‹åªéœ€å»å¯¹è±¡å¤´çš„Mark Word ä¸­å»åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æœ‰åå‘é”æŒ‡å‘æœ¬èº«çš„IDï¼Œæ— éœ€å†è¿›å…¥ Monitor å»ç«äº‰å¯¹è±¡äº†ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="è½»é‡é”"><a href="#è½»é‡é”" class="headerlink" title="==è½»é‡é”=="></a>==è½»é‡é”==</h4><h5 id="å®šä¹‰ï¼šå¤šçº¿ç¨‹ç«äº‰ï¼Œä½†æ˜¯ä»»æ„æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹ç«äº‰ï¼Œå³ä¸å­˜åœ¨é”ç«äº‰å¤ªè¿‡æ¿€çƒˆçš„æƒ…å†µï¼Œä¹Ÿå°±æ²¡æœ‰çº¿ç¨‹é˜»å¯¨ã€‚"><a href="#å®šä¹‰ï¼šå¤šçº¿ç¨‹ç«äº‰ï¼Œä½†æ˜¯ä»»æ„æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹ç«äº‰ï¼Œå³ä¸å­˜åœ¨é”ç«äº‰å¤ªè¿‡æ¿€çƒˆçš„æƒ…å†µï¼Œä¹Ÿå°±æ²¡æœ‰çº¿ç¨‹é˜»å¯¨ã€‚" class="headerlink" title="å®šä¹‰ï¼šå¤šçº¿ç¨‹ç«äº‰ï¼Œä½†æ˜¯ä»»æ„æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹ç«äº‰ï¼Œå³ä¸å­˜åœ¨é”ç«äº‰å¤ªè¿‡æ¿€çƒˆçš„æƒ…å†µï¼Œä¹Ÿå°±æ²¡æœ‰çº¿ç¨‹é˜»å¯¨ã€‚"></a>å®šä¹‰ï¼šå¤šçº¿ç¨‹ç«äº‰ï¼Œä½†æ˜¯ä»»æ„æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹ç«äº‰ï¼Œå³ä¸å­˜åœ¨é”ç«äº‰å¤ªè¿‡æ¿€çƒˆçš„æƒ…å†µï¼Œä¹Ÿå°±æ²¡æœ‰çº¿ç¨‹é˜»å¯¨ã€‚</h5><h5 id="ä½œç”¨ï¼šæœ‰çº¿ç¨‹æ¥å‚ä¸é”çš„ç«äº‰ï¼Œä½†æ˜¯è·å–é”çš„å†²çªæ—¶é—´æçŸ­æœ¬è´¨å°±æ˜¯è‡ªæ—‹é”CAS"><a href="#ä½œç”¨ï¼šæœ‰çº¿ç¨‹æ¥å‚ä¸é”çš„ç«äº‰ï¼Œä½†æ˜¯è·å–é”çš„å†²çªæ—¶é—´æçŸ­æœ¬è´¨å°±æ˜¯è‡ªæ—‹é”CAS" class="headerlink" title="ä½œç”¨ï¼šæœ‰çº¿ç¨‹æ¥å‚ä¸é”çš„ç«äº‰ï¼Œä½†æ˜¯è·å–é”çš„å†²çªæ—¶é—´æçŸ­æœ¬è´¨å°±æ˜¯è‡ªæ—‹é”CAS"></a>ä½œç”¨ï¼šæœ‰çº¿ç¨‹æ¥å‚ä¸é”çš„ç«äº‰ï¼Œä½†æ˜¯è·å–é”çš„å†²çªæ—¶é—´æçŸ­æœ¬è´¨å°±æ˜¯è‡ªæ—‹é”CAS</h5><h4 id="é‡é‡çº§é”"><a href="#é‡é‡çº§é”" class="headerlink" title="==é‡é‡çº§é”=="></a>==é‡é‡çº§é”==</h4><h5 id="é‡é‡çº§é”åŸç†"><a href="#é‡é‡çº§é”åŸç†" class="headerlink" title="é‡é‡çº§é”åŸç†"></a>é‡é‡çº§é”åŸç†</h5><h6 id="æŒ‡å‘äº’æ–¥é‡-é‡é‡çº§é”-çš„æŒ‡é’ˆ"><a href="#æŒ‡å‘äº’æ–¥é‡-é‡é‡çº§é”-çš„æŒ‡é’ˆ" class="headerlink" title="æŒ‡å‘äº’æ–¥é‡ (é‡é‡çº§é”)çš„æŒ‡é’ˆ"></a>æŒ‡å‘äº’æ–¥é‡ (é‡é‡çº§é”)çš„æŒ‡é’ˆ</h6><p>Javaä¸­synchronizedçš„é‡é‡çº§é”ï¼Œæ˜¯åŸºäºè¿›å…¥å’Œé€€å‡ºMonitorå¯¹è±¡å®ç°çš„ã€‚åœ¨ç¼–è¯‘æ—¶ä¼šå°†åŒæ­¥å—çš„å¼€å§‹ä½ç½®æ’å…¥monitor enteræŒ‡ä»¤ï¼Œåœ¨ç»“æŸä½ç½®æ’å…¥monitor exitæŒ‡ä»¤ã€‚<br>å½“çº¿ç¨‹æ‰§è¡Œåˆ°monitor enteræŒ‡ä»¤æ—¶ï¼Œä¼šå°è¯•è·å–å¯¹è±¡æ‰€å¯¹åº”çš„Monitoræ‰€æœ‰æƒï¼Œå¦‚æœè·å–åˆ°äº†ï¼Œå³è·å–åˆ°äº†é”ï¼Œä¼šåœ¨Monitorçš„ownerä¸­å­˜æ”¾å½“å‰çº¿ç¨‹çš„idï¼Œè¿™æ ·å®ƒå°†å¤„äºé”å®šçŠ¶æ€ï¼Œé™¤éé€€å‡ºåŒæ­¥å—ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹æ— æ³•è·å–åˆ°è¿™ä¸ªMonitorã€‚</p><h4 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="==è‡ªæ—‹é”=="></a>==è‡ªæ—‹é”==</h4><h5 id="è‡ªæ—‹é”-spinlock"><a href="#è‡ªæ—‹é”-spinlock" class="headerlink" title="è‡ªæ—‹é” (spinlock)"></a>è‡ªæ—‹é” (spinlock)</h5><h5 id="CAS-æ˜¯å®ç°è‡ªæ—‹é”çš„åŸºç¡€ï¼ŒCAS-åˆ©ç”¨-CPU-æŒ‡ä»¤ä¿è¯äº†æ“ä½œçš„åŸå­æ€§ï¼Œä»¥è¾¾åˆ°é”çš„æ•ˆæœï¼Œè‡³äºè‡ªæ—‹å‘¢ï¼Œçœ‹å­—é¢æ„æ€ä¹Ÿå¾ˆæ˜ç™½ï¼Œè‡ªå·±æ—‹è½¬ã€‚æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œå½“çº¿ç¨‹å‘ç°é”è¢«å ç”¨æ—¶ï¼Œä¼šä¸æ–­å¾ªç¯åˆ¤æ–­é”çš„çŠ¶æ€ï¼Œç›´åˆ°è·å–ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPU"><a href="#CAS-æ˜¯å®ç°è‡ªæ—‹é”çš„åŸºç¡€ï¼ŒCAS-åˆ©ç”¨-CPU-æŒ‡ä»¤ä¿è¯äº†æ“ä½œçš„åŸå­æ€§ï¼Œä»¥è¾¾åˆ°é”çš„æ•ˆæœï¼Œè‡³äºè‡ªæ—‹å‘¢ï¼Œçœ‹å­—é¢æ„æ€ä¹Ÿå¾ˆæ˜ç™½ï¼Œè‡ªå·±æ—‹è½¬ã€‚æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œå½“çº¿ç¨‹å‘ç°é”è¢«å ç”¨æ—¶ï¼Œä¼šä¸æ–­å¾ªç¯åˆ¤æ–­é”çš„çŠ¶æ€ï¼Œç›´åˆ°è·å–ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPU" class="headerlink" title="CAS æ˜¯å®ç°è‡ªæ—‹é”çš„åŸºç¡€ï¼ŒCAS åˆ©ç”¨ CPU æŒ‡ä»¤ä¿è¯äº†æ“ä½œçš„åŸå­æ€§ï¼Œä»¥è¾¾åˆ°é”çš„æ•ˆæœï¼Œè‡³äºè‡ªæ—‹å‘¢ï¼Œçœ‹å­—é¢æ„æ€ä¹Ÿå¾ˆæ˜ç™½ï¼Œè‡ªå·±æ—‹è½¬ã€‚æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œå½“çº¿ç¨‹å‘ç°é”è¢«å ç”¨æ—¶ï¼Œä¼šä¸æ–­å¾ªç¯åˆ¤æ–­é”çš„çŠ¶æ€ï¼Œç›´åˆ°è·å–ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPU"></a>CAS æ˜¯å®ç°è‡ªæ—‹é”çš„åŸºç¡€ï¼ŒCAS åˆ©ç”¨ CPU æŒ‡ä»¤ä¿è¯äº†æ“ä½œçš„åŸå­æ€§ï¼Œä»¥è¾¾åˆ°é”çš„æ•ˆæœï¼Œè‡³äºè‡ªæ—‹å‘¢ï¼Œçœ‹å­—é¢æ„æ€ä¹Ÿå¾ˆæ˜ç™½ï¼Œè‡ªå·±æ—‹è½¬ã€‚æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œå½“çº¿ç¨‹å‘ç°é”è¢«å ç”¨æ—¶ï¼Œä¼šä¸æ–­å¾ªç¯åˆ¤æ–­é”çš„çŠ¶æ€ï¼Œç›´åˆ°è·å–ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPU</h5><h5 id="CAS-æ˜¯å®ç°è‡ªæ—‹é”çš„åŸºç¡€ï¼Œè‡ªæ—‹ç¿»è¯‘æˆäººè¯å°±æ˜¯å¾ªç¯ï¼Œä¸€èˆ¬æ˜¯ç”¨ä¸€ä¸ªæ— é™å¾ªç¯å®ç°ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼Œæ‰§è¡Œä¸€ä¸ªCAS-æ“ä½œï¼Œ"><a href="#CAS-æ˜¯å®ç°è‡ªæ—‹é”çš„åŸºç¡€ï¼Œè‡ªæ—‹ç¿»è¯‘æˆäººè¯å°±æ˜¯å¾ªç¯ï¼Œä¸€èˆ¬æ˜¯ç”¨ä¸€ä¸ªæ— é™å¾ªç¯å®ç°ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼Œæ‰§è¡Œä¸€ä¸ªCAS-æ“ä½œï¼Œ" class="headerlink" title="CAS æ˜¯å®ç°è‡ªæ—‹é”çš„åŸºç¡€ï¼Œè‡ªæ—‹ç¿»è¯‘æˆäººè¯å°±æ˜¯å¾ªç¯ï¼Œä¸€èˆ¬æ˜¯ç”¨ä¸€ä¸ªæ— é™å¾ªç¯å®ç°ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼Œæ‰§è¡Œä¸€ä¸ªCAS æ“ä½œï¼Œ"></a>CAS æ˜¯å®ç°è‡ªæ—‹é”çš„åŸºç¡€ï¼Œè‡ªæ—‹ç¿»è¯‘æˆäººè¯å°±æ˜¯å¾ªç¯ï¼Œä¸€èˆ¬æ˜¯ç”¨ä¸€ä¸ªæ— é™å¾ªç¯å®ç°ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼Œæ‰§è¡Œä¸€ä¸ªCAS æ“ä½œï¼Œ</h5><p>å½“æ“ä½œæˆåŠŸè¿”å› true æ—¶ï¼Œå¾ªç¯ç»“æŸ;<br>å½“è¿”å› false æ—¶ï¼Œæ¥ç€æ‰§è¡Œå¾ªç¯ï¼Œç»§ç»­å°è¯• CAS æ“ä½œï¼Œç›´åˆ°è¿”å› trueã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/*** * å®ç°ä¸€ä¸ªè‡ªæ—‹é”ï¼Œå¤ä¹ CASæ€æƒ³ * è‡ªæ—‹é”å¥½å¤„: å¾ªåæ¯”è¾ƒè·å–æ²¡æœ‰ç±»ä¼¼waitçš„é˜»å¡ * æ°´ * é€šè¿‡CASæ“ä½œå®Œæˆè‡ªæ—‹é”ï¼ŒAçº¿ç¨‹å…ˆè¿›æ¥è°ƒç”¨myLockæ–¹æ³•è‡ªå·±æŒæœ‰é”5ç§’é’Ÿï¼ŒBéšåè¿›æ¥åå‘ç°ï¿¥å½“å‰æœ‰çº¿ç¨‹æŒæœ‰é”ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡è‡ªæ—‹ç­‰å¾…ï¼Œç›´åˆ°Aé‡Šæ”¾é”åBéšåæŠ¢åˆ°ã€‚ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockSprnk</span> <span class="token punctuation">{</span>    <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> atomicReference<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è‡ªå®šä¹‰ç±»çš„åŸå­å¼•ç”¨</span>    <span class="token comment">/**     * åŠ é”æ–¹æ³•     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lockAtmot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" come  in"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>thread<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//åˆ¤æ–­ æ˜¯å¦æœ‰çº¿ç¨‹ï¼Œæ²¡æœ‰å°±æŠŠå½“å‰æ”¾è¿›å»</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è§£é”æ–¹æ³•     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unLockAtomit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>thread<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è‡ªæ—‹çœ‹æ˜¯å¦å½“å‰çº¿ç¨‹  æ˜¯ç½®ç©º</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"è§£é”æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">LockSprnk</span> lockSprnk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LockSprnk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>            lockSprnk<span class="token punctuation">.</span><span class="token function">lockAtmot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//ä¼‘çœ 5æ¯«ç§’</span>            <span class="token keyword">try</span><span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>            lockSprnk<span class="token punctuation">.</span><span class="token function">unLockAtomit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æš‚åœ5ç§’</span>        <span class="token keyword">try</span><span class="token punctuation">{</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>            lockSprnk<span class="token punctuation">.</span><span class="token function">lockAtmot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            lockSprnk<span class="token punctuation">.</span><span class="token function">unLockAtomit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="CAS-çš„ç¼ºç‚¹ï¼šCPUçš„ç©ºè½¬-ä»¥åŠ-ABA-çš„é—®é¢˜ï¼ˆè¿™åˆä¼šå¼•å‡ºæ—¶é—´æˆ³çš„åŸå­ç±»ï¼‰"><a href="#CAS-çš„ç¼ºç‚¹ï¼šCPUçš„ç©ºè½¬-ä»¥åŠ-ABA-çš„é—®é¢˜ï¼ˆè¿™åˆä¼šå¼•å‡ºæ—¶é—´æˆ³çš„åŸå­ç±»ï¼‰" class="headerlink" title="CAS çš„ç¼ºç‚¹ï¼šCPUçš„ç©ºè½¬ ä»¥åŠ ABA çš„é—®é¢˜ï¼ˆè¿™åˆä¼šå¼•å‡ºæ—¶é—´æˆ³çš„åŸå­ç±»ï¼‰"></a>CAS çš„ç¼ºç‚¹ï¼šCPUçš„ç©ºè½¬ ä»¥åŠ ABA çš„é—®é¢˜ï¼ˆè¿™åˆä¼šå¼•å‡ºæ—¶é—´æˆ³çš„åŸå­ç±»ï¼‰</h6><h4 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="==è¯»å†™é”=="></a>==è¯»å†™é”==</h4><h5 id="ReentrantReadWriteLock"><a href="#ReentrantReadWriteLock" class="headerlink" title="ReentrantReadWriteLock"></a>ReentrantReadWriteLock</h5><h5 id="è¯»å†™é”å®šä¹‰ä¸º-ä¸€ä¸ªèµ„æºèƒ½å¤Ÿè¢«å¤šä¸ªè¯»çº¿ç¨‹è®¿é—®ï¼Œæˆ–è€…è¢«ä¸€ä¸ªå†™çº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶å­˜åœ¨è¯»å†™çº¿ç¨‹ã€‚ï¼ˆè¯»å†™äº’æ–¥ï¼Œè¯»è¯»å…±äº«ï¼Œè¯»æ˜¯ç‹¬å é”è¯»æœªå®Œæˆå†™é”æŠ¢ä¸åˆ°ï¼‰"><a href="#è¯»å†™é”å®šä¹‰ä¸º-ä¸€ä¸ªèµ„æºèƒ½å¤Ÿè¢«å¤šä¸ªè¯»çº¿ç¨‹è®¿é—®ï¼Œæˆ–è€…è¢«ä¸€ä¸ªå†™çº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶å­˜åœ¨è¯»å†™çº¿ç¨‹ã€‚ï¼ˆè¯»å†™äº’æ–¥ï¼Œè¯»è¯»å…±äº«ï¼Œè¯»æ˜¯ç‹¬å é”è¯»æœªå®Œæˆå†™é”æŠ¢ä¸åˆ°ï¼‰" class="headerlink" title="è¯»å†™é”å®šä¹‰ä¸º:ä¸€ä¸ªèµ„æºèƒ½å¤Ÿè¢«å¤šä¸ªè¯»çº¿ç¨‹è®¿é—®ï¼Œæˆ–è€…è¢«ä¸€ä¸ªå†™çº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶å­˜åœ¨è¯»å†™çº¿ç¨‹ã€‚ï¼ˆè¯»å†™äº’æ–¥ï¼Œè¯»è¯»å…±äº«ï¼Œè¯»æ˜¯ç‹¬å é”è¯»æœªå®Œæˆå†™é”æŠ¢ä¸åˆ°ï¼‰"></a>è¯»å†™é”å®šä¹‰ä¸º:ä¸€ä¸ªèµ„æºèƒ½å¤Ÿè¢«å¤šä¸ªè¯»çº¿ç¨‹è®¿é—®ï¼Œæˆ–è€…è¢«ä¸€ä¸ªå†™çº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶å­˜åœ¨è¯»å†™çº¿ç¨‹ã€‚ï¼ˆè¯»å†™äº’æ–¥ï¼Œè¯»è¯»å…±äº«ï¼Œè¯»æ˜¯ç‹¬å é”è¯»æœªå®Œæˆå†™é”æŠ¢ä¸åˆ°ï¼‰</h5><h4 id="é‚®æˆ³é”"><a href="#é‚®æˆ³é”" class="headerlink" title="==é‚®æˆ³é”=="></a>==é‚®æˆ³é”==</h4><h5 id="StampedLock"><a href="#StampedLock" class="headerlink" title="StampedLock"></a>StampedLock</h5><h6 id="ReentrantReadWriteLockçš„è¯»é”è¢«å ç”¨çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å°è¯•è·å–å†™é”çš„æ—¶å€™ä¼šè¢«é˜»å¡ã€‚ä½†æ˜¯ï¼ŒStampedLocké‡‡å–ä¹è§‚è·å–åï¼Œå…¶ä»–çº¿ç¨‹å°è¯•è·å–å†™é”æ—¶ä¸ä¼šè¢«é˜»å¡ï¼Œè¿™å…¶å®æ˜¯å¯¹è¯»é”çš„ä¼˜åŒ–ï¼Œæ‰€ä»¥ï¼Œåœ¨è·å–ä¹è§‚è¯»é”åï¼Œè¿˜éœ€è¦å¯¹ç»“æœè¿›è¡Œæ ¡éªŒã€‚"><a href="#ReentrantReadWriteLockçš„è¯»é”è¢«å ç”¨çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å°è¯•è·å–å†™é”çš„æ—¶å€™ä¼šè¢«é˜»å¡ã€‚ä½†æ˜¯ï¼ŒStampedLocké‡‡å–ä¹è§‚è·å–åï¼Œå…¶ä»–çº¿ç¨‹å°è¯•è·å–å†™é”æ—¶ä¸ä¼šè¢«é˜»å¡ï¼Œè¿™å…¶å®æ˜¯å¯¹è¯»é”çš„ä¼˜åŒ–ï¼Œæ‰€ä»¥ï¼Œåœ¨è·å–ä¹è§‚è¯»é”åï¼Œè¿˜éœ€è¦å¯¹ç»“æœè¿›è¡Œæ ¡éªŒã€‚" class="headerlink" title="ReentrantReadWriteLockçš„è¯»é”è¢«å ç”¨çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å°è¯•è·å–å†™é”çš„æ—¶å€™ä¼šè¢«é˜»å¡ã€‚ä½†æ˜¯ï¼ŒStampedLocké‡‡å–ä¹è§‚è·å–åï¼Œå…¶ä»–çº¿ç¨‹å°è¯•è·å–å†™é”æ—¶ä¸ä¼šè¢«é˜»å¡ï¼Œè¿™å…¶å®æ˜¯å¯¹è¯»é”çš„ä¼˜åŒ–ï¼Œæ‰€ä»¥ï¼Œåœ¨è·å–ä¹è§‚è¯»é”åï¼Œè¿˜éœ€è¦å¯¹ç»“æœè¿›è¡Œæ ¡éªŒã€‚"></a>ReentrantReadWriteLockçš„è¯»é”è¢«å ç”¨çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å°è¯•è·å–å†™é”çš„æ—¶å€™ä¼šè¢«é˜»å¡ã€‚ä½†æ˜¯ï¼ŒStampedLocké‡‡å–ä¹è§‚è·å–åï¼Œå…¶ä»–çº¿ç¨‹å°è¯•è·å–å†™é”æ—¶ä¸ä¼šè¢«é˜»å¡ï¼Œè¿™å…¶å®æ˜¯å¯¹è¯»é”çš„ä¼˜åŒ–ï¼Œæ‰€ä»¥ï¼Œåœ¨è·å–ä¹è§‚è¯»é”åï¼Œè¿˜éœ€è¦å¯¹ç»“æœè¿›è¡Œæ ¡éªŒã€‚</h6><h4 id="é”çš„é™çº§"><a href="#é”çš„é™çº§" class="headerlink" title="==é”çš„é™çº§=="></a>==é”çš„é™çº§==</h4><h5 id="å†™é”çš„é™çº§ï¼Œé™çº§æˆä¸ºäº†è¯»é”"><a href="#å†™é”çš„é™çº§ï¼Œé™çº§æˆä¸ºäº†è¯»é”" class="headerlink" title="å†™é”çš„é™çº§ï¼Œé™çº§æˆä¸ºäº†è¯»é”"></a>å†™é”çš„é™çº§ï¼Œé™çº§æˆä¸ºäº†è¯»é”</h5><ul><li>1 å¦‚æœåŒä¸€ä¸ªçº¿ç¨‹æŒæœ‰äº†å†™é”ï¼Œåœ¨æ²¡æœ‰é‡Šæ”¾å†™é”çš„æƒ…å†µä¸‹ï¼Œå®ƒè¿˜å¯ä»¥ç»§ç»­è·å¾—è¯»é”ã€‚è¿™å°±æ˜¯å†™é”çš„é™çº§ï¼Œé™çº§æˆä¸ºäº†è¯»é”ã€‚</li><li>2 è§„åˆ™æƒ¯ä¾‹ï¼Œå…ˆè·å–å†™é”ï¼Œç„¶åè·å–è¯»é”ï¼Œå†é‡Šæ”¾å†™é”çš„ æ¬¡åº</li><li> 3 å¦‚æœé‡Šæ”¾äº†å†™é”ï¼Œé‚£ä¹ˆå°±å®Œå…¨è½¬æ¢ä¸ºè¯»é”ã€‚</li></ul><h4 id="å¯é‡å…¥é”ï¼ˆé€’å½’é”ï¼‰"><a href="#å¯é‡å…¥é”ï¼ˆé€’å½’é”ï¼‰" class="headerlink" title="==å¯é‡å…¥é”ï¼ˆé€’å½’é”ï¼‰=="></a>==å¯é‡å…¥é”ï¼ˆé€’å½’é”ï¼‰==</h4><h5 id="æŒ‡çš„æ˜¯åŒä¸€çº¿ç¨‹å¤–å±‚å‡½æ•°è·å¾—é”ä¹‹åï¼Œå†…å±‚é€’å½’å‡½æ•°ä»ç„¶èƒ½è·å–è¯¥é”çš„ä»£ç ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚ï¼ˆå‰æè·å¾—åŒä¸€æŠŠé”ï¼‰"><a href="#æŒ‡çš„æ˜¯åŒä¸€çº¿ç¨‹å¤–å±‚å‡½æ•°è·å¾—é”ä¹‹åï¼Œå†…å±‚é€’å½’å‡½æ•°ä»ç„¶èƒ½è·å–è¯¥é”çš„ä»£ç ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚ï¼ˆå‰æè·å¾—åŒä¸€æŠŠé”ï¼‰" class="headerlink" title="æŒ‡çš„æ˜¯åŒä¸€çº¿ç¨‹å¤–å±‚å‡½æ•°è·å¾—é”ä¹‹åï¼Œå†…å±‚é€’å½’å‡½æ•°ä»ç„¶èƒ½è·å–è¯¥é”çš„ä»£ç ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚ï¼ˆå‰æè·å¾—åŒä¸€æŠŠé”ï¼‰"></a>æŒ‡çš„æ˜¯åŒä¸€çº¿ç¨‹å¤–å±‚å‡½æ•°è·å¾—é”ä¹‹åï¼Œå†…å±‚é€’å½’å‡½æ•°ä»ç„¶èƒ½è·å–è¯¥é”çš„ä»£ç ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚ï¼ˆå‰æè·å¾—åŒä¸€æŠŠé”ï¼‰</h5><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E9%80%92%E5%BD%92%E9%94%81.png" alt="é€’å½’é”"></p><h5 id="å¯é‡å…¥é”-åˆ†ä¸ºéšå¼é”-å’Œ-æ˜¾ç¤ºé”-ï¼š-sychronized-å…³é”®å­—-ä½¿ç”¨çš„é”-é»˜è®¤å¯é‡å…¥é”ï¼Œæ˜¾ç¤ºé”-reentrLock-çš„lock-å’Œunlock-é”çš„è¦æˆå¯¹å‡ºç°ï¼Œä¸ç„¶å¯¼è‡´ä¸èƒ½æœ‰æ•ˆé‡Šæ”¾é”ä»¥è‡³äºçº¿ç¨‹è¢«é˜»å¡ã€‚"><a href="#å¯é‡å…¥é”-åˆ†ä¸ºéšå¼é”-å’Œ-æ˜¾ç¤ºé”-ï¼š-sychronized-å…³é”®å­—-ä½¿ç”¨çš„é”-é»˜è®¤å¯é‡å…¥é”ï¼Œæ˜¾ç¤ºé”-reentrLock-çš„lock-å’Œunlock-é”çš„è¦æˆå¯¹å‡ºç°ï¼Œä¸ç„¶å¯¼è‡´ä¸èƒ½æœ‰æ•ˆé‡Šæ”¾é”ä»¥è‡³äºçº¿ç¨‹è¢«é˜»å¡ã€‚" class="headerlink" title="å¯é‡å…¥é”  åˆ†ä¸ºéšå¼é” å’Œ æ˜¾ç¤ºé” ï¼š sychronized å…³é”®å­— ä½¿ç”¨çš„é” é»˜è®¤å¯é‡å…¥é”ï¼Œæ˜¾ç¤ºé”      reentrLock   çš„lock å’Œunlock é”çš„è¦æˆå¯¹å‡ºç°ï¼Œä¸ç„¶å¯¼è‡´ä¸èƒ½æœ‰æ•ˆé‡Šæ”¾é”ä»¥è‡³äºçº¿ç¨‹è¢«é˜»å¡ã€‚"></a>å¯é‡å…¥é”  åˆ†ä¸ºéšå¼é” å’Œ æ˜¾ç¤ºé” ï¼š sychronized å…³é”®å­— ä½¿ç”¨çš„é” é»˜è®¤å¯é‡å…¥é”ï¼Œæ˜¾ç¤ºé”      reentrLock   çš„lock å’Œunlock é”çš„è¦æˆå¯¹å‡ºç°ï¼Œä¸ç„¶å¯¼è‡´ä¸èƒ½æœ‰æ•ˆé‡Šæ”¾é”ä»¥è‡³äºçº¿ç¨‹è¢«é˜»å¡ã€‚</h5><h4 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="==æ­»é”=="></a>==æ­»é”==</h4><h5 id="æ­»é”çš„æ¦‚å¿µï¼šä¸¤ä¸ªæˆ–ä¸¤ä¸ªçš„çº¿ç¨‹äº‰å¤ºèµ„æºï¼Œè€Œé€ æˆçš„ç›¸äº’ç­‰å¾…"><a href="#æ­»é”çš„æ¦‚å¿µï¼šä¸¤ä¸ªæˆ–ä¸¤ä¸ªçš„çº¿ç¨‹äº‰å¤ºèµ„æºï¼Œè€Œé€ æˆçš„ç›¸äº’ç­‰å¾…" class="headerlink" title="æ­»é”çš„æ¦‚å¿µï¼šä¸¤ä¸ªæˆ–ä¸¤ä¸ªçš„çº¿ç¨‹äº‰å¤ºèµ„æºï¼Œè€Œé€ æˆçš„ç›¸äº’ç­‰å¾…"></a>æ­»é”çš„æ¦‚å¿µï¼šä¸¤ä¸ªæˆ–ä¸¤ä¸ªçš„çº¿ç¨‹äº‰å¤ºèµ„æºï¼Œè€Œé€ æˆçš„ç›¸äº’ç­‰å¾…</h5><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E6%AD%BB%E9%94%81%E7%8E%B0%E8%B1%A1.png" alt="æ­»é”ç°è±¡"></p><h5 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> a<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Object</span> b<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">new</span>  <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>           <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" Aæƒ³æƒ³æ‹¿åˆ°bé”"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">try</span><span class="token punctuation">{</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>               <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>                   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" Bæƒ³æ‹¿åˆ°Aé”"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token punctuation">}</span>           <span class="token punctuation">}</span>       <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"t1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">new</span>  <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>          <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" Bæƒ³æƒ³æ‹¿åˆ°Aé”"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">{</span>                  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" Aæƒ³æ‹¿åˆ°Bé”"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"t2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="æ­»é”çš„è¯Šæ–­-JPS-l-åˆ—æ‰€æœ‰çš„çº¿ç¨‹id-å†æ ¹æ®-jstack-çº¿ç¨‹idå¥½è¯Šæ–­"><a href="#æ­»é”çš„è¯Šæ–­-JPS-l-åˆ—æ‰€æœ‰çš„çº¿ç¨‹id-å†æ ¹æ®-jstack-çº¿ç¨‹idå¥½è¯Šæ–­" class="headerlink" title="æ­»é”çš„è¯Šæ–­ JPS  -l  åˆ—æ‰€æœ‰çš„çº¿ç¨‹id    å†æ ¹æ® jstack  çº¿ç¨‹idå¥½è¯Šæ–­"></a>æ­»é”çš„è¯Šæ–­ JPS  -l  åˆ—æ‰€æœ‰çš„çº¿ç¨‹id    å†æ ¹æ® jstack  çº¿ç¨‹idå¥½è¯Šæ–­</h5><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E6%AD%BB%E9%94%81%E8%AF%8A%E6%96%AD.png" alt="æ­»é”å›¾ä¾‹1"></p><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E6%AD%BB%E9%94%812.png" alt="æ­»é”å›¾ä¾‹2"></p><h5 id="å›¾å½¢åŒ–è¯Šæ–­-æ­»é”"><a href="#å›¾å½¢åŒ–è¯Šæ–­-æ­»é”" class="headerlink" title="å›¾å½¢åŒ–è¯Šæ–­ æ­»é”"></a>å›¾å½¢åŒ–è¯Šæ–­ æ­»é”</h5><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E5%9B%BE%E5%BD%A2%E5%8C%96%E6%AD%BB%E9%94%811.png" alt="å›¾å½¢åŒ–æ­»é”1"></p><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E5%9B%BE%E5%BD%A2%E5%8C%96%E6%AD%BB%E9%94%812.png" alt="å›¾å½¢åŒ–æ­»é”2"></p><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E5%9B%BE%E5%BD%A2%E5%8C%96%E6%AD%BB%E9%94%814.png" alt="å›¾å½¢åŒ–æ­»é”4"></p><h3 id="çº¿ç¨‹ä¸­æ–­æœºåˆ¶"><a href="#çº¿ç¨‹ä¸­æ–­æœºåˆ¶" class="headerlink" title="çº¿ç¨‹ä¸­æ–­æœºåˆ¶"></a>çº¿ç¨‹ä¸­æ–­æœºåˆ¶</h3><h5 id="è€ƒç‚¹ï¼šçº¿ç¨‹å¦‚ä½•ä¸­æ–­è¿è¡Œ-è¯·ç”¨ç®€å•çš„code-ç¼–å†™ã€‚å½“è°ƒç”¨-interrupt-æ˜¯å¦é©¬ä¸Šåœæ­¢çº¿ç¨‹å‘¢-ï¼Œå¯¹æ¯”ä¸€ä¸‹isinterruptå’Œé™æ€interruptä»–ä»¬çš„æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#è€ƒç‚¹ï¼šçº¿ç¨‹å¦‚ä½•ä¸­æ–­è¿è¡Œ-è¯·ç”¨ç®€å•çš„code-ç¼–å†™ã€‚å½“è°ƒç”¨-interrupt-æ˜¯å¦é©¬ä¸Šåœæ­¢çº¿ç¨‹å‘¢-ï¼Œå¯¹æ¯”ä¸€ä¸‹isinterruptå’Œé™æ€interruptä»–ä»¬çš„æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="==è€ƒç‚¹ï¼šçº¿ç¨‹å¦‚ä½•ä¸­æ–­è¿è¡Œ ,è¯·ç”¨ç®€å•çš„code ç¼–å†™ã€‚å½“è°ƒç”¨  interrupt()æ˜¯å¦é©¬ä¸Šåœæ­¢çº¿ç¨‹å‘¢   ï¼Œå¯¹æ¯”ä¸€ä¸‹isinterruptå’Œé™æ€interruptä»–ä»¬çš„æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«=="></a>==è€ƒç‚¹ï¼šçº¿ç¨‹å¦‚ä½•ä¸­æ–­è¿è¡Œ ,è¯·ç”¨ç®€å•çš„code ç¼–å†™ã€‚å½“è°ƒç”¨  interrupt()æ˜¯å¦é©¬ä¸Šåœæ­¢çº¿ç¨‹å‘¢   ï¼Œå¯¹æ¯”ä¸€ä¸‹isinterruptå’Œé™æ€interruptä»–ä»¬çš„æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«==</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>          <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//æ˜¯å¦ä¸­æ–­</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹+"</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token keyword">break</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>              <span class="token keyword">try</span><span class="token punctuation">{</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>                  e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç¡çœ ä¸­æ–­å¼‚å¸¸çš„ å¯¼è‡´æ­»å¾ªç¯ ä¸€å®šè¦å†è°ƒç”¨ä¸€æ¬¡ï¼ŒæŠŠæ ‡å¿—ä½æ”¹è¿‡ç¨‹ï¼ˆé‡ç‚¹ï¼‰åŸå› æ˜¯æŠŠt2ä¸­æ–­æ ‡å¿—ä½ç»™æ¸…é™¤äº†ï¼Œåªæœ‰InterruptedException å¼‚å¸¸å°±ä¼šä¸­æ–­æ ‡å¿—ä½æ ‡è¯†</span>              <span class="token punctuation">}</span>              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹æ²¡æœ‰åœæ­¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"t1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// System.out.println(Thread.currentThread().isInterrupted());</span>      <span class="token keyword">try</span><span class="token punctuation">{</span>          <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MICROSECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>      <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>          t1<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä¸­æ–­ è°ƒç”¨è¿™ä¸ªæ–¹æ³• å˜æ›´ä¸­æ–­çš„æ ‡å¿—ä½ï¼ˆä¸­æ–­æ˜¯ä¸€ç§åå•†æœºåˆ¶ï¼Œä¸æ˜¯ç«‹å³åœæ­¢çº¿ç¨‹çš„æ´»å¾—ï¼Œè€Œæ˜¯è¢«ä¸­æ–­çš„çº¿ç¨‹è‡ªå·±åœæ­¢ï¼‰</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"t2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="ä¸­æ–­çš„æ€»ç»“-å…·ä½“æ¥è¯´ï¼Œå½“å¯¹ä¸€ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨-interrupt-æ—¶"><a href="#ä¸­æ–­çš„æ€»ç»“-å…·ä½“æ¥è¯´ï¼Œå½“å¯¹ä¸€ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨-interrupt-æ—¶" class="headerlink" title="ä¸­æ–­çš„æ€»ç»“:å…·ä½“æ¥è¯´ï¼Œå½“å¯¹ä¸€ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨ interrupt() æ—¶:"></a>ä¸­æ–­çš„æ€»ç»“:å…·ä½“æ¥è¯´ï¼Œå½“å¯¹ä¸€ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨ interrupt() æ—¶:</h6><p>1å¦‚æœçº¿ç¨‹å¤„äºæ­£å¸¸æ´»åŠ¨çŠ¶æ€ï¼Œé‚£ä¹ˆä¼šå°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—è®¾ç½®ä¸º trueï¼Œä»…æ­¤è€Œå·²ã€‚è¢«è®¾ç½®ä¸­æ–­æ ‡å¿—çš„çº¿ç¨‹å°†ç»§ç»­æ­£å¸¸è¿è¡Œï¼Œä¸å—å½±å“ã€‚æ‰€ä»¥ï¼Œinterrupt() å¹¶ä¸èƒ½çœŸæ­£çš„ä¸­æ–­çº¿ç¨‹ï¼Œéœ€è¦è¢«è°ƒç”¨çš„çº¿ç¨‹è‡ªå·±è¿›è¡Œé…åˆæ‰è¡Œ<br>2å¦‚æœçº¿ç¨‹å¤„äºè¢«é˜»å¡çŠ¶æ€(ä¾‹å¦‚å¤„äºsleep,wait, join ç­‰çŠ¶æ€)ï¼Œåœ¨åˆ«çš„çº¿ç¨‹ä¸­è°ƒç”¨å½“å‰çº¿ç¨‹å¯¹è±¡çš„interruptæ–¹æ³•,é‚£ä¹ˆçº¿ç¨‹å°†ç«‹å³é€€å‡ºè¢«é˜»å¡çŠ¶æ€ï¼Œå¹¶æŠ›å‡ºä¸€ä¸ªInterruptedExceptionå¼‚å¸¸ã€‚</p><h6 id="ä¸­æ–­interrupt-çš„é™æ€-æ–¹æ³•ä»–-ä¼šä¸­ä¸¤ä¸ªäº‹æƒ…ï¼Œä¸€ä¸ªæµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å°†å½“å‰çº¿ç¨‹ä¸­æ–­æŠŠæ ‡å¿—ä½æ”¹ä¸ºfalse-ã€‚æ¸…é™¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€-ï¼Œå®ä¾‹æ–¹æ³•isterrup-å’Œinterrup-å®ƒä»¬åº•å±‚éƒ½æ˜¯è°ƒç”¨çš„-ç›¸åŒçš„æ–¹æ³•ï¼Œåªä¸è¿‡é™æ€æ–¹æ³•ä¸»åŠ¨æ¸…é™¤æ ‡å¿—ä½ã€‚"><a href="#ä¸­æ–­interrupt-çš„é™æ€-æ–¹æ³•ä»–-ä¼šä¸­ä¸¤ä¸ªäº‹æƒ…ï¼Œä¸€ä¸ªæµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å°†å½“å‰çº¿ç¨‹ä¸­æ–­æŠŠæ ‡å¿—ä½æ”¹ä¸ºfalse-ã€‚æ¸…é™¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€-ï¼Œå®ä¾‹æ–¹æ³•isterrup-å’Œinterrup-å®ƒä»¬åº•å±‚éƒ½æ˜¯è°ƒç”¨çš„-ç›¸åŒçš„æ–¹æ³•ï¼Œåªä¸è¿‡é™æ€æ–¹æ³•ä¸»åŠ¨æ¸…é™¤æ ‡å¿—ä½ã€‚" class="headerlink" title="ä¸­æ–­interrupt çš„é™æ€ æ–¹æ³•ä»– ä¼šä¸­ä¸¤ä¸ªäº‹æƒ…ï¼Œä¸€ä¸ªæµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å°†å½“å‰çº¿ç¨‹ä¸­æ–­æŠŠæ ‡å¿—ä½æ”¹ä¸ºfalse ã€‚æ¸…é™¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ ï¼Œå®ä¾‹æ–¹æ³•isterrup  å’Œinterrup å®ƒä»¬åº•å±‚éƒ½æ˜¯è°ƒç”¨çš„ ç›¸åŒçš„æ–¹æ³•ï¼Œåªä¸è¿‡é™æ€æ–¹æ³•ä¸»åŠ¨æ¸…é™¤æ ‡å¿—ä½ã€‚"></a>ä¸­æ–­interrupt çš„é™æ€ æ–¹æ³•ä»– ä¼šä¸­ä¸¤ä¸ªäº‹æƒ…ï¼Œä¸€ä¸ªæµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å°†å½“å‰çº¿ç¨‹ä¸­æ–­æŠŠæ ‡å¿—ä½æ”¹ä¸ºfalse ã€‚æ¸…é™¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ ï¼Œå®ä¾‹æ–¹æ³•isterrup  å’Œinterrup å®ƒä»¬åº•å±‚éƒ½æ˜¯è°ƒç”¨çš„ ç›¸åŒçš„æ–¹æ³•ï¼Œåªä¸è¿‡é™æ€æ–¹æ³•ä¸»åŠ¨æ¸…é™¤æ ‡å¿—ä½ã€‚</h6><h3 id="LockSuppot"><a href="#LockSuppot" class="headerlink" title="LockSuppot"></a>LockSuppot</h3><h4 id="LockSupport-æ˜¯å‰é¢çš„å¯¹çº¿ç¨‹çš„ç­‰å¾…å’Œå”¤é†’-çš„ä¼˜åŒ–ï¼Œå‰é¢Objectè‡ªå¸¦çš„-wait-å’Œnotfiy-Lockä¸­çš„-await-å’Œsignal"><a href="#LockSupport-æ˜¯å‰é¢çš„å¯¹çº¿ç¨‹çš„ç­‰å¾…å’Œå”¤é†’-çš„ä¼˜åŒ–ï¼Œå‰é¢Objectè‡ªå¸¦çš„-wait-å’Œnotfiy-Lockä¸­çš„-await-å’Œsignal" class="headerlink" title="LockSupport æ˜¯å‰é¢çš„å¯¹çº¿ç¨‹çš„ç­‰å¾…å’Œå”¤é†’ çš„ä¼˜åŒ–ï¼Œå‰é¢Objectè‡ªå¸¦çš„ wait å’Œnotfiy      Lockä¸­çš„ await å’Œsignal"></a>LockSupport æ˜¯å‰é¢çš„å¯¹çº¿ç¨‹çš„ç­‰å¾…å’Œå”¤é†’ çš„ä¼˜åŒ–ï¼Œå‰é¢Objectè‡ªå¸¦çš„ wait å’Œnotfiy      Lockä¸­çš„ await å’Œsignal</h4><h4 id="sychorizied-é‡Œé¢-wait-notfiy-éœ€è¦æˆå¯¹å‡ºç°ï¼Œå¹¶ä¸”æ”¾åœ¨åŒæ­¥sychcorized-ä¿®é¥°çš„ä»£ç å—é‡Œé¢ã€‚å¦åˆ™ä¹Ÿä¼šæŠ¥å¼‚å¸¸ã€‚condition-ä¸­-lock-await-å’Œsignal-ä¹Ÿæ˜¯ä¸€æ ·è¦-lock-unlock-é‡Œé¢çš„-é¡ºåºä¹Ÿä¸èƒ½è°ƒæ¢ã€‚ç”±æ­¤ä¼˜åŒ–çš„LockSupport-èƒŒæ™¯ã€‚"><a href="#sychorizied-é‡Œé¢-wait-notfiy-éœ€è¦æˆå¯¹å‡ºç°ï¼Œå¹¶ä¸”æ”¾åœ¨åŒæ­¥sychcorized-ä¿®é¥°çš„ä»£ç å—é‡Œé¢ã€‚å¦åˆ™ä¹Ÿä¼šæŠ¥å¼‚å¸¸ã€‚condition-ä¸­-lock-await-å’Œsignal-ä¹Ÿæ˜¯ä¸€æ ·è¦-lock-unlock-é‡Œé¢çš„-é¡ºåºä¹Ÿä¸èƒ½è°ƒæ¢ã€‚ç”±æ­¤ä¼˜åŒ–çš„LockSupport-èƒŒæ™¯ã€‚" class="headerlink" title="sychorizied    é‡Œé¢ wait  notfiy  éœ€è¦æˆå¯¹å‡ºç°ï¼Œå¹¶ä¸”æ”¾åœ¨åŒæ­¥sychcorized ä¿®é¥°çš„ä»£ç å—é‡Œé¢ã€‚å¦åˆ™ä¹Ÿä¼šæŠ¥å¼‚å¸¸ã€‚condition ä¸­ lock await å’Œsignal ä¹Ÿæ˜¯ä¸€æ ·è¦ lock   unlock é‡Œé¢çš„ é¡ºåºä¹Ÿä¸èƒ½è°ƒæ¢ã€‚ç”±æ­¤ä¼˜åŒ–çš„LockSupport  èƒŒæ™¯ã€‚"></a>sychorizied    é‡Œé¢ wait  notfiy  éœ€è¦æˆå¯¹å‡ºç°ï¼Œå¹¶ä¸”æ”¾åœ¨åŒæ­¥sychcorized ä¿®é¥°çš„ä»£ç å—é‡Œé¢ã€‚å¦åˆ™ä¹Ÿä¼šæŠ¥å¼‚å¸¸ã€‚condition ä¸­ lock await å’Œsignal ä¹Ÿæ˜¯ä¸€æ ·è¦ lock   unlock é‡Œé¢çš„ é¡ºåºä¹Ÿä¸èƒ½è°ƒæ¢ã€‚ç”±æ­¤ä¼˜åŒ–çš„LockSupport  èƒŒæ™¯ã€‚</h4><h5 id="LockSupportæ˜¯ç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„åŸºæœ¬çº¿ç¨‹é˜»å¯’åŸè¯­ã€‚ä¸€ä¸ªçº¿ç¨‹é˜»å¡å·¥å…·ç±»ï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œå¯ä»¥è®©çº¿ç¨‹åœ¨ä»»æ„ä½ç½®é˜»å¡ï¼Œé˜»å¡ä¹‹åä¹Ÿæœ‰å¯¹åº”çš„å”¤é†’æ–¹æ³•ã€‚å½’æ ¹ç»“-ockSupportæ˜¯LockSupportè°ƒç”¨çš„Unsafeä¸­çš„nativeä»£ç ã€‚"><a href="#LockSupportæ˜¯ç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„åŸºæœ¬çº¿ç¨‹é˜»å¯’åŸè¯­ã€‚ä¸€ä¸ªçº¿ç¨‹é˜»å¡å·¥å…·ç±»ï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œå¯ä»¥è®©çº¿ç¨‹åœ¨ä»»æ„ä½ç½®é˜»å¡ï¼Œé˜»å¡ä¹‹åä¹Ÿæœ‰å¯¹åº”çš„å”¤é†’æ–¹æ³•ã€‚å½’æ ¹ç»“-ockSupportæ˜¯LockSupportè°ƒç”¨çš„Unsafeä¸­çš„nativeä»£ç ã€‚" class="headerlink" title="LockSupportæ˜¯ç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„åŸºæœ¬çº¿ç¨‹é˜»å¯’åŸè¯­ã€‚ä¸€ä¸ªçº¿ç¨‹é˜»å¡å·¥å…·ç±»ï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œå¯ä»¥è®©çº¿ç¨‹åœ¨ä»»æ„ä½ç½®é˜»å¡ï¼Œé˜»å¡ä¹‹åä¹Ÿæœ‰å¯¹åº”çš„å”¤é†’æ–¹æ³•ã€‚å½’æ ¹ç»“_ockSupportæ˜¯LockSupportè°ƒç”¨çš„Unsafeä¸­çš„nativeä»£ç ã€‚"></a>LockSupportæ˜¯ç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„åŸºæœ¬çº¿ç¨‹é˜»å¯’åŸè¯­ã€‚ä¸€ä¸ªçº¿ç¨‹é˜»å¡å·¥å…·ç±»ï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œå¯ä»¥è®©çº¿ç¨‹åœ¨ä»»æ„ä½ç½®é˜»å¡ï¼Œé˜»å¡ä¹‹åä¹Ÿæœ‰å¯¹åº”çš„å”¤é†’æ–¹æ³•ã€‚å½’æ ¹ç»“_ockSupportæ˜¯LockSupportè°ƒç”¨çš„Unsafeä¸­çš„nativeä»£ç ã€‚</h5><h5 id="ockSupport-æä¾›park-å’Œunpark-æ–¹æ³•å®ç°é˜»å¡çº¿ç¨‹å’Œè§£é™¤çº¿ç¨‹é˜»å¡çš„è¿‡ç¨‹ockSupportå’Œæ¯ä¸ªä½¿ç”¨å®ƒçš„çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè®¸å¯-permit-å…³è”ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç›¸å…³çš„permit-permitæœ€å¤šåªæœ‰ä¸€ä¸ªï¼Œé‡å¤è°ƒç”¨unparkä¹Ÿä¸ä¼šç§¯ç´¯å‡­è¯ã€‚"><a href="#ockSupport-æä¾›park-å’Œunpark-æ–¹æ³•å®ç°é˜»å¡çº¿ç¨‹å’Œè§£é™¤çº¿ç¨‹é˜»å¡çš„è¿‡ç¨‹ockSupportå’Œæ¯ä¸ªä½¿ç”¨å®ƒçš„çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè®¸å¯-permit-å…³è”ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç›¸å…³çš„permit-permitæœ€å¤šåªæœ‰ä¸€ä¸ªï¼Œé‡å¤è°ƒç”¨unparkä¹Ÿä¸ä¼šç§¯ç´¯å‡­è¯ã€‚" class="headerlink" title="_ockSupport æä¾›park()å’Œunpark()æ–¹æ³•å®ç°é˜»å¡çº¿ç¨‹å’Œè§£é™¤çº¿ç¨‹é˜»å¡çš„è¿‡ç¨‹ockSupportå’Œæ¯ä¸ªä½¿ç”¨å®ƒçš„çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè®¸å¯(permit)å…³è”ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç›¸å…³çš„permit, permitæœ€å¤šåªæœ‰ä¸€ä¸ªï¼Œé‡å¤è°ƒç”¨unparkä¹Ÿä¸ä¼šç§¯ç´¯å‡­è¯ã€‚"></a>_ockSupport æä¾›park()å’Œunpark()æ–¹æ³•å®ç°é˜»å¡çº¿ç¨‹å’Œè§£é™¤çº¿ç¨‹é˜»å¡çš„è¿‡ç¨‹ockSupportå’Œæ¯ä¸ªä½¿ç”¨å®ƒçš„çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè®¸å¯(permit)å…³è”ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç›¸å…³çš„permit, permitæœ€å¤šåªæœ‰ä¸€ä¸ªï¼Œé‡å¤è°ƒç”¨unparkä¹Ÿä¸ä¼šç§¯ç´¯å‡­è¯ã€‚</h5><h5 id="å½¢è±¡çš„ç†è§£"><a href="#å½¢è±¡çš„ç†è§£" class="headerlink" title="å½¢è±¡çš„ç†è§£"></a>å½¢è±¡çš„ç†è§£</h5><h5 id="çº¿ç¨‹é˜»å¡éœ€è¦æ¶ˆè€—å‡­è¯-permit-ï¼Œè¿™ä¸ªå‡­è¯æœ€å¤šåªæœ‰1ä¸ªã€‚å½“è°ƒç”¨-parkæ–¹æ³•æ—¶-å¦‚æœæœ‰å‡­è¯ï¼Œåˆ™ä¼šç›´æ¥æ¶ˆè€—æ‰è¿™ä¸ªå‡­è¯ç„¶åæ­£å¸¸é€€å‡º"><a href="#çº¿ç¨‹é˜»å¡éœ€è¦æ¶ˆè€—å‡­è¯-permit-ï¼Œè¿™ä¸ªå‡­è¯æœ€å¤šåªæœ‰1ä¸ªã€‚å½“è°ƒç”¨-parkæ–¹æ³•æ—¶-å¦‚æœæœ‰å‡­è¯ï¼Œåˆ™ä¼šç›´æ¥æ¶ˆè€—æ‰è¿™ä¸ªå‡­è¯ç„¶åæ­£å¸¸é€€å‡º" class="headerlink" title="çº¿ç¨‹é˜»å¡éœ€è¦æ¶ˆè€—å‡­è¯(permit)ï¼Œè¿™ä¸ªå‡­è¯æœ€å¤šåªæœ‰1ä¸ªã€‚å½“è°ƒç”¨ parkæ–¹æ³•æ—¶ å¦‚æœæœ‰å‡­è¯ï¼Œåˆ™ä¼šç›´æ¥æ¶ˆè€—æ‰è¿™ä¸ªå‡­è¯ç„¶åæ­£å¸¸é€€å‡º;"></a>çº¿ç¨‹é˜»å¡éœ€è¦æ¶ˆè€—å‡­è¯(permit)ï¼Œè¿™ä¸ªå‡­è¯æœ€å¤šåªæœ‰1ä¸ªã€‚å½“è°ƒç”¨ parkæ–¹æ³•æ—¶ å¦‚æœæœ‰å‡­è¯ï¼Œåˆ™ä¼šç›´æ¥æ¶ˆè€—æ‰è¿™ä¸ªå‡­è¯ç„¶åæ­£å¸¸é€€å‡º;</h5><h5 id="å¦‚æœæ— å‡­è¯ï¼Œå°±å¿…é¡»é˜»å¯’ç­‰å¾…å‡­è¯å¯ç”¨"><a href="#å¦‚æœæ— å‡­è¯ï¼Œå°±å¿…é¡»é˜»å¯’ç­‰å¾…å‡­è¯å¯ç”¨" class="headerlink" title="å¦‚æœæ— å‡­è¯ï¼Œå°±å¿…é¡»é˜»å¯’ç­‰å¾…å‡­è¯å¯ç”¨;"></a>å¦‚æœæ— å‡­è¯ï¼Œå°±å¿…é¡»é˜»å¯’ç­‰å¾…å‡­è¯å¯ç”¨;</h5><h5 id="è€Œunparkåˆ™ç›¸åï¼Œå®ƒä¼šå¢åŠ ä¸€ä¸ªå‡­è¯ï¼Œä½†å‡­è¯æœ€å¤šåªèƒ½æœ‰1ä¸ªï¼Œç´¯åŠ æ— æ•ˆã€‚"><a href="#è€Œunparkåˆ™ç›¸åï¼Œå®ƒä¼šå¢åŠ ä¸€ä¸ªå‡­è¯ï¼Œä½†å‡­è¯æœ€å¤šåªèƒ½æœ‰1ä¸ªï¼Œç´¯åŠ æ— æ•ˆã€‚" class="headerlink" title="è€Œunparkåˆ™ç›¸åï¼Œå®ƒä¼šå¢åŠ ä¸€ä¸ªå‡­è¯ï¼Œä½†å‡­è¯æœ€å¤šåªèƒ½æœ‰1ä¸ªï¼Œç´¯åŠ æ— æ•ˆã€‚"></a>è€Œunparkåˆ™ç›¸åï¼Œå®ƒä¼šå¢åŠ ä¸€ä¸ªå‡­è¯ï¼Œä½†å‡­è¯æœ€å¤šåªèƒ½æœ‰1ä¸ªï¼Œç´¯åŠ æ— æ•ˆã€‚</h5><h5 id="è€ƒç‚¹-ä¸ºä»€ä¹ˆå¯ä»¥çªç ´wait-notifyçš„åŸæœ‰è°ƒç”¨é¡ºåº-ä¸ºä»€ä¹ˆå”¤é†’ä¸¤æ¬¡åé˜»å¡ä¸¤æ¬¡"><a href="#è€ƒç‚¹-ä¸ºä»€ä¹ˆå¯ä»¥çªç ´wait-notifyçš„åŸæœ‰è°ƒç”¨é¡ºåº-ä¸ºä»€ä¹ˆå”¤é†’ä¸¤æ¬¡åé˜»å¡ä¸¤æ¬¡" class="headerlink" title="==è€ƒç‚¹ ä¸ºä»€ä¹ˆå¯ä»¥çªç ´wait/notifyçš„åŸæœ‰è°ƒç”¨é¡ºåº? ä¸ºä»€ä¹ˆå”¤é†’ä¸¤æ¬¡åé˜»å¡ä¸¤æ¬¡=="></a>==è€ƒç‚¹ ä¸ºä»€ä¹ˆå¯ä»¥çªç ´wait/notifyçš„åŸæœ‰è°ƒç”¨é¡ºåº? ä¸ºä»€ä¹ˆå”¤é†’ä¸¤æ¬¡åé˜»å¡ä¸¤æ¬¡==</h5><h6 id="ä¸ºä»€ä¹ˆå¯ä»¥çªç ´wait-notifyçš„åŸæœ‰è°ƒç”¨é¡ºåº"><a href="#ä¸ºä»€ä¹ˆå¯ä»¥çªç ´wait-notifyçš„åŸæœ‰è°ƒç”¨é¡ºåº" class="headerlink" title="ä¸ºä»€ä¹ˆå¯ä»¥çªç ´wait/notifyçš„åŸæœ‰è°ƒç”¨é¡ºåº?"></a>ä¸ºä»€ä¹ˆå¯ä»¥çªç ´wait/notifyçš„åŸæœ‰è°ƒç”¨é¡ºåº?</h6><h6 id="å› ä¸ºunparkè·å¾—äº†ä¸€ä¸ªå‡­è¯ï¼Œä¹‹åå†è°ƒç”¨parkæ–¹æ³•ï¼Œå°±å¯ä»¥åæ­£è¨€é¡ºçš„å‡­è¯æ¶ˆè´¹ï¼Œæ•…ä¸ä¼šé˜»å¡ã€‚"><a href="#å› ä¸ºunparkè·å¾—äº†ä¸€ä¸ªå‡­è¯ï¼Œä¹‹åå†è°ƒç”¨parkæ–¹æ³•ï¼Œå°±å¯ä»¥åæ­£è¨€é¡ºçš„å‡­è¯æ¶ˆè´¹ï¼Œæ•…ä¸ä¼šé˜»å¡ã€‚" class="headerlink" title="å› ä¸ºunparkè·å¾—äº†ä¸€ä¸ªå‡­è¯ï¼Œä¹‹åå†è°ƒç”¨parkæ–¹æ³•ï¼Œå°±å¯ä»¥åæ­£è¨€é¡ºçš„å‡­è¯æ¶ˆè´¹ï¼Œæ•…ä¸ä¼šé˜»å¡ã€‚"></a>å› ä¸ºunparkè·å¾—äº†ä¸€ä¸ªå‡­è¯ï¼Œä¹‹åå†è°ƒç”¨parkæ–¹æ³•ï¼Œå°±å¯ä»¥åæ­£è¨€é¡ºçš„å‡­è¯æ¶ˆè´¹ï¼Œæ•…ä¸ä¼šé˜»å¡ã€‚</h6><h6 id="å…ˆå‘æ”¾äº†å‡­è¯åç»­å¯ä»¥ç•…é€šæ— é˜»ã€‚"><a href="#å…ˆå‘æ”¾äº†å‡­è¯åç»­å¯ä»¥ç•…é€šæ— é˜»ã€‚" class="headerlink" title="å…ˆå‘æ”¾äº†å‡­è¯åç»­å¯ä»¥ç•…é€šæ— é˜»ã€‚"></a>å…ˆå‘æ”¾äº†å‡­è¯åç»­å¯ä»¥ç•…é€šæ— é˜»ã€‚</h6><h6 id="ä¸ºä»€ä¹ˆå”¤é†’ä¸¤æ¬¡åé˜»å¡ä¸¤æ¬¡ï¼Œä½†æœ€ç»ˆç»“æœè¿˜ä¼šé˜»å¡çº¿ç¨‹-å› ä¸ºå‡­è¯çš„æ•°é‡æœ€å¤šä¸º-1ï¼Œè¿ç»­è°ƒç”¨ä¸¤æ¬¡-unpark-å’Œ-è°ƒç”¨ä¸€æ¬¡-unpark-æ•ˆæœä¸€æ ·ï¼Œåªä¼šå¢åŠ ä¸€ä¸ªå‡­"><a href="#ä¸ºä»€ä¹ˆå”¤é†’ä¸¤æ¬¡åé˜»å¡ä¸¤æ¬¡ï¼Œä½†æœ€ç»ˆç»“æœè¿˜ä¼šé˜»å¡çº¿ç¨‹-å› ä¸ºå‡­è¯çš„æ•°é‡æœ€å¤šä¸º-1ï¼Œè¿ç»­è°ƒç”¨ä¸¤æ¬¡-unpark-å’Œ-è°ƒç”¨ä¸€æ¬¡-unpark-æ•ˆæœä¸€æ ·ï¼Œåªä¼šå¢åŠ ä¸€ä¸ªå‡­" class="headerlink" title="ä¸ºä»€ä¹ˆå”¤é†’ä¸¤æ¬¡åé˜»å¡ä¸¤æ¬¡ï¼Œä½†æœ€ç»ˆç»“æœè¿˜ä¼šé˜»å¡çº¿ç¨‹?å› ä¸ºå‡­è¯çš„æ•°é‡æœ€å¤šä¸º 1ï¼Œè¿ç»­è°ƒç”¨ä¸¤æ¬¡ unpark å’Œ è°ƒç”¨ä¸€æ¬¡ unpark æ•ˆæœä¸€æ ·ï¼Œåªä¼šå¢åŠ ä¸€ä¸ªå‡­"></a>ä¸ºä»€ä¹ˆå”¤é†’ä¸¤æ¬¡åé˜»å¡ä¸¤æ¬¡ï¼Œä½†æœ€ç»ˆç»“æœè¿˜ä¼šé˜»å¡çº¿ç¨‹?å› ä¸ºå‡­è¯çš„æ•°é‡æœ€å¤šä¸º 1ï¼Œè¿ç»­è°ƒç”¨ä¸¤æ¬¡ unpark å’Œ è°ƒç”¨ä¸€æ¬¡ unpark æ•ˆæœä¸€æ ·ï¼Œåªä¼šå¢åŠ ä¸€ä¸ªå‡­</h6><h6 id="è¯-è€Œè°ƒç”¨ä¸¤æ¬¡-parkå´éœ€è¦æ¶ˆè´¹ä¸¤ä¸ªå‡­è¯ï¼Œè¯ä¸å¤Ÿï¼Œä¸èƒ½æ”¾è¡Œã€‚"><a href="#è¯-è€Œè°ƒç”¨ä¸¤æ¬¡-parkå´éœ€è¦æ¶ˆè´¹ä¸¤ä¸ªå‡­è¯ï¼Œè¯ä¸å¤Ÿï¼Œä¸èƒ½æ”¾è¡Œã€‚" class="headerlink" title="è¯:è€Œè°ƒç”¨ä¸¤æ¬¡ parkå´éœ€è¦æ¶ˆè´¹ä¸¤ä¸ªå‡­è¯ï¼Œè¯ä¸å¤Ÿï¼Œä¸èƒ½æ”¾è¡Œã€‚"></a>è¯:è€Œè°ƒç”¨ä¸¤æ¬¡ parkå´éœ€è¦æ¶ˆè´¹ä¸¤ä¸ªå‡­è¯ï¼Œè¯ä¸å¤Ÿï¼Œä¸èƒ½æ”¾è¡Œã€‚</h6><h5 id="ä¸ºä»€ä¹ˆwaitå¿…é¡»å†™åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆwaitå¿…é¡»å†™åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼Ÿ" class="headerlink" title="==ä¸ºä»€ä¹ˆwaitå¿…é¡»å†™åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼Ÿ=="></a>==ä¸ºä»€ä¹ˆwaitå¿…é¡»å†™åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼Ÿ==</h5><h6 id="é¿å…-CPU-åˆ‡æ¢åˆ°å…¶ä»–ç¨‹ï¼Œè€Œå…¶ä»–çº¿ç¨‹åˆæå‰æ‰§è¡Œäº†-notify-æ–¹æ³•ï¼Œé‚£è¿™æ ·å°±è¾¾ä¸åˆ°æˆ‘ä»¬çš„é¢„æœŸï¼ˆå…ˆ-wait-å†ç”±å…¶ä»–ç¨‹æ¥å”¤é†’ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªåŒæ­¥é”æ¥ä¿æŠ¤"><a href="#é¿å…-CPU-åˆ‡æ¢åˆ°å…¶ä»–ç¨‹ï¼Œè€Œå…¶ä»–çº¿ç¨‹åˆæå‰æ‰§è¡Œäº†-notify-æ–¹æ³•ï¼Œé‚£è¿™æ ·å°±è¾¾ä¸åˆ°æˆ‘ä»¬çš„é¢„æœŸï¼ˆå…ˆ-wait-å†ç”±å…¶ä»–ç¨‹æ¥å”¤é†’ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªåŒæ­¥é”æ¥ä¿æŠ¤" class="headerlink" title="é¿å… CPU åˆ‡æ¢åˆ°å…¶ä»–ç¨‹ï¼Œè€Œå…¶ä»–çº¿ç¨‹åˆæå‰æ‰§è¡Œäº† notify æ–¹æ³•ï¼Œé‚£è¿™æ ·å°±è¾¾ä¸åˆ°æˆ‘ä»¬çš„é¢„æœŸï¼ˆå…ˆ wait å†ç”±å…¶ä»–ç¨‹æ¥å”¤é†’ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªåŒæ­¥é”æ¥ä¿æŠ¤"></a>é¿å… CPU åˆ‡æ¢åˆ°å…¶ä»–ç¨‹ï¼Œè€Œå…¶ä»–çº¿ç¨‹åˆæå‰æ‰§è¡Œäº† notify æ–¹æ³•ï¼Œé‚£è¿™æ ·å°±è¾¾ä¸åˆ°æˆ‘ä»¬çš„é¢„æœŸï¼ˆå…ˆ wait å†ç”±å…¶ä»–ç¨‹æ¥å”¤é†’ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªåŒæ­¥é”æ¥ä¿æŠ¤</h6><h5 id="sleep-ä¸wait-çš„åŒºåˆ«ï¼Ÿ"><a href="#sleep-ä¸wait-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="==sleep()ä¸wait()çš„åŒºåˆ«ï¼Ÿ=="></a>==sleep()ä¸wait()çš„åŒºåˆ«ï¼Ÿ==</h5><h6 id="ä¸»è¦æœ‰å››ä¸ªæ–¹é¢åŒºåˆ«"><a href="#ä¸»è¦æœ‰å››ä¸ªæ–¹é¢åŒºåˆ«" class="headerlink" title="ä¸»è¦æœ‰å››ä¸ªæ–¹é¢åŒºåˆ«"></a>ä¸»è¦æœ‰å››ä¸ªæ–¹é¢åŒºåˆ«</h6><ul><li>sleep() å±äºThreadç±»ï¼Œwait() å±äºObjectç±»</li><li>sleep() ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œwait() ä¼šé‡Šæ”¾å¯¹è±¡é”</li><li>sleep() å¿…é¡»æŒ‡å®šæ—¶é—´ï¼Œwait() å¯æŒ‡å®šä¹Ÿå¯ä»¥ä¸æŒ‡å®š</li><li>sleep() å¯ä»¥ä½¿ç”¨åœ¨ä»»ä½•ä»£ç å—ï¼Œwait() å¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨</li></ul><h5 id="ä¸ºä»€ä¹ˆwaitè¦å®šä¹‰åœ¨Objectä¸­è€Œä¸å®šä¹‰åœ¨Threadä¸­ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆwaitè¦å®šä¹‰åœ¨Objectä¸­è€Œä¸å®šä¹‰åœ¨Threadä¸­ï¼Ÿ" class="headerlink" title="==ä¸ºä»€ä¹ˆwaitè¦å®šä¹‰åœ¨Objectä¸­è€Œä¸å®šä¹‰åœ¨Threadä¸­ï¼Ÿ=="></a>==ä¸ºä»€ä¹ˆwaitè¦å®šä¹‰åœ¨Objectä¸­è€Œä¸å®šä¹‰åœ¨Threadä¸­ï¼Ÿ==</h5><h6 id="Javaçš„é”æ˜¯å¯¹è±¡çº§åˆ«çš„ï¼Œä¸æ˜¯çº¿ç¨‹çº§åˆ«çš„"><a href="#Javaçš„é”æ˜¯å¯¹è±¡çº§åˆ«çš„ï¼Œä¸æ˜¯çº¿ç¨‹çº§åˆ«çš„" class="headerlink" title="Javaçš„é”æ˜¯å¯¹è±¡çº§åˆ«çš„ï¼Œä¸æ˜¯çº¿ç¨‹çº§åˆ«çš„"></a>Javaçš„é”æ˜¯å¯¹è±¡çº§åˆ«çš„ï¼Œä¸æ˜¯çº¿ç¨‹çº§åˆ«çš„</h6><h6 id="sleep-ä¼‘çœ æŒ‡çš„å°±æ˜¯çº¿ç¨‹ä¼‘çœ ï¼Œæ‰€ä»¥åœ¨Threadç±»"><a href="#sleep-ä¼‘çœ æŒ‡çš„å°±æ˜¯çº¿ç¨‹ä¼‘çœ ï¼Œæ‰€ä»¥åœ¨Threadç±»" class="headerlink" title="sleep() ä¼‘çœ æŒ‡çš„å°±æ˜¯çº¿ç¨‹ä¼‘çœ ï¼Œæ‰€ä»¥åœ¨Threadç±»"></a>sleep() ä¼‘çœ æŒ‡çš„å°±æ˜¯çº¿ç¨‹ä¼‘çœ ï¼Œæ‰€ä»¥åœ¨Threadç±»</h6><h5 id="Sychronizedå’Œlockæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç”¨æ–°çš„Lockæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿä¸¾ä¾‹è¯´è¯´"><a href="#Sychronizedå’Œlockæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç”¨æ–°çš„Lockæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿä¸¾ä¾‹è¯´è¯´" class="headerlink" title="==Sychronizedå’Œlockæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç”¨æ–°çš„Lockæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿä¸¾ä¾‹è¯´è¯´=="></a>==Sychronizedå’Œlockæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç”¨æ–°çš„Lockæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿä¸¾ä¾‹è¯´è¯´==</h5><ul><li><p>åŸå§‹æ„æˆï¼š</p><ul><li><p>Synchronizedæ˜¯å…³é”®å­—å±äºJVMå±‚é¢monitorenter (åº•å±‚æ˜¯é€šè¿‡monitorå¯¹è±¡æ¥å®Œæˆï¼Œå…¶å®å’Œwait/notifyç­‰æ–¹æ³•ä¹Ÿä¾èµ–äºmonitorå¯¹è±¡åªæœ‰åœ¨åŒæ­¥å—æˆ–è€…æ–¹æ³•ä¸­æ‰èƒ½è°ƒç”¨wait/notifyç­‰æ–¹æ³•)monitorExit(æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ­£å¸¸é€€å‡ºä¸€ä¸ªæ˜¯å¼‚å¸¸é€€å‡º)</p></li><li><p>Lockæ˜¯å…·ä½“ç±» (java.utilconcurrentlocks.Lock) æ˜¯apiå±‚é¢çš„é”</p></li></ul></li><li><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><ul><li>synchronizedä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œå½“synchronizedä»£ç æ‰§è¡Œå®Œæˆåç³»ç»Ÿä¼šè‡ªåŠ¨è®©çº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å ç”¨</li><li>ReentrantLockåˆ™éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œè‹¥æ²¡æœ‰ä¸»åŠ¨é‡Šæ”¾é”ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°æ­»é”ç°è±¡éœ€è¦lock()å’Œunlock()æ–¹æ³•é…åˆtry/finallyè¯­å¥å—æ¥å®Œæˆ</li></ul></li><li><p>ç­‰å¾…æ˜¯å¦å¯ä¸­æ–­</p><ul><li>Synchronizedä¸å¯ä¸­æ–­ï¼Œé™¤éæŠ›å‡ºå¼‚å¸¸æˆ–è€…æ­£å¸¸è¿è¡Œå®Œæˆ</li><li>é™¤éæŠ›å‡ºå¼‚å¸¸æˆ–è€…æ­£å¸¸è¿è¡Œå®Œæˆ</li><li>è®¾ç½®è¶…æ—¶æ–¹æ³•tryLock(long timeoutTimeUnit unit)</li><li>lockInterruptibly()æ”¾ä»£ç å—ä¸­ï¼Œè°ƒç”¨interrupt0)æ–¹æ³•å¯ä¸­æ–­</li></ul></li><li><p>é”ç»‘å®šå¤šä¸ªæ¡ä»¶Condition</p><ul><li>synchronizedæ²¡æœ‰</li><li>ReentrantLockç”¨æ¥å®ç°åˆ†ç»„å”¤é†’éœ€è¦å”¤é†’çš„çº¿ç¨‹ä»¬ï¼Œå¯ä»¥ç²¾ç¡®å”¤é†’ï¼Œè€Œä¸æ˜¯åƒsynchronizedè¦ä¹ˆéšæœºå”¤é†’ä¸€ä¸ªå…ˆåæ›¾è¦ä¹ˆå”¤é†’å…¨éƒ¨çº¿ç¨‹ã€‚</li></ul></li></ul><h3 id="javaå†…å­˜æ¨¡å‹-ä¹‹-jMM"><a href="#javaå†…å­˜æ¨¡å‹-ä¹‹-jMM" class="headerlink" title="javaå†…å­˜æ¨¡å‹ ä¹‹ jMM"></a>javaå†…å­˜æ¨¡å‹ ä¹‹ jMM</h3><h4 id="å› ä¸ºæœ‰è¿™ä¹ˆå¤šçº§çš„ç¼“å­˜-cpuå’Œç‰©ç†ä¸»å†…å­˜çš„é€Ÿåº¦ä¸ä¸€è‡´çš„-CPUçš„è¿è¡Œå¹¶ä¸æ˜¯ç›´æ¥æ“ä½œå†…å­˜è€Œæ˜¯å…ˆæŠŠå†…å­˜é‡Œè¾¹çš„æ•°æ®è¯»åˆ°ç¼“å­˜ï¼Œè€Œå†…å­˜çš„è¯»å’Œå†™æ“ä½œçš„æ—¶å€™å°±ä¼šé€ æˆä¸ä¸€è‡´çš„é—®é¢˜"><a href="#å› ä¸ºæœ‰è¿™ä¹ˆå¤šçº§çš„ç¼“å­˜-cpuå’Œç‰©ç†ä¸»å†…å­˜çš„é€Ÿåº¦ä¸ä¸€è‡´çš„-CPUçš„è¿è¡Œå¹¶ä¸æ˜¯ç›´æ¥æ“ä½œå†…å­˜è€Œæ˜¯å…ˆæŠŠå†…å­˜é‡Œè¾¹çš„æ•°æ®è¯»åˆ°ç¼“å­˜ï¼Œè€Œå†…å­˜çš„è¯»å’Œå†™æ“ä½œçš„æ—¶å€™å°±ä¼šé€ æˆä¸ä¸€è‡´çš„é—®é¢˜" class="headerlink" title="å› ä¸ºæœ‰è¿™ä¹ˆå¤šçº§çš„ç¼“å­˜(cpuå’Œç‰©ç†ä¸»å†…å­˜çš„é€Ÿåº¦ä¸ä¸€è‡´çš„).CPUçš„è¿è¡Œå¹¶ä¸æ˜¯ç›´æ¥æ“ä½œå†…å­˜è€Œæ˜¯å…ˆæŠŠå†…å­˜é‡Œè¾¹çš„æ•°æ®è¯»åˆ°ç¼“å­˜ï¼Œè€Œå†…å­˜çš„è¯»å’Œå†™æ“ä½œçš„æ—¶å€™å°±ä¼šé€ æˆä¸ä¸€è‡´çš„é—®é¢˜"></a>å› ä¸ºæœ‰è¿™ä¹ˆå¤šçº§çš„ç¼“å­˜(cpuå’Œç‰©ç†ä¸»å†…å­˜çš„é€Ÿåº¦ä¸ä¸€è‡´çš„).CPUçš„è¿è¡Œå¹¶ä¸æ˜¯ç›´æ¥æ“ä½œå†…å­˜è€Œæ˜¯å…ˆæŠŠå†…å­˜é‡Œè¾¹çš„æ•°æ®è¯»åˆ°ç¼“å­˜ï¼Œè€Œå†…å­˜çš„è¯»å’Œå†™æ“ä½œçš„æ—¶å€™å°±ä¼šé€ æˆä¸ä¸€è‡´çš„é—®é¢˜</h4><h4 id="jVMè§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§Javaå†…å­˜æ¨¡å‹-java-Memory-Modelï¼Œç®€ç§°JMM-æ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚æ‰€ä»¥ï¼Œæ¨å¯¼å‡ºæˆ‘ä»¬éœ€è¦çŸ¥é“JMM"><a href="#jVMè§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§Javaå†…å­˜æ¨¡å‹-java-Memory-Modelï¼Œç®€ç§°JMM-æ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚æ‰€ä»¥ï¼Œæ¨å¯¼å‡ºæˆ‘ä»¬éœ€è¦çŸ¥é“JMM" class="headerlink" title="jVMè§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§Javaå†…å­˜æ¨¡å‹ java Memory Modelï¼Œç®€ç§°JMM)æ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚æ‰€ä»¥ï¼Œæ¨å¯¼å‡ºæˆ‘ä»¬éœ€è¦çŸ¥é“JMM"></a>jVMè§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§Javaå†…å­˜æ¨¡å‹ java Memory Modelï¼Œç®€ç§°JMM)æ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚æ‰€ä»¥ï¼Œæ¨å¯¼å‡ºæˆ‘ä»¬éœ€è¦çŸ¥é“JMM</h4><h4 id="JMM-Javaå†…å­˜æ¨¡å‹Java-Memory-Modeï¼Œç®€ç§°JMM-æœ¬èº«æ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µå¹¶ä¸çœŸå®å­˜åœ¨å®ƒä»…ä»…æè¿°çš„æ˜¯ä¸€ç»„çº¦å®šæˆ–è§„èŒƒï¼Œé€šè¿‡è¿™ç»„ç°èŒƒå®šä¹‰äº†ç¨‹åºä¸­-å°¤å…¶æ˜¯å¤šçº¿ç¨‹-å„äººå˜é‡çš„è¯»å†™è®¿é—®æ–¹å¼å¹¶å†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶ä»¥åŠå¦‚ä½•å˜æˆå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ï¼Œå…³å»ºæŠ€æœ¯ç‚¹éƒ½æ˜¯å›´ç»•å¤šçº¿ç¨‹çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§å±•å¼€çš„ã€‚"><a href="#JMM-Javaå†…å­˜æ¨¡å‹Java-Memory-Modeï¼Œç®€ç§°JMM-æœ¬èº«æ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µå¹¶ä¸çœŸå®å­˜åœ¨å®ƒä»…ä»…æè¿°çš„æ˜¯ä¸€ç»„çº¦å®šæˆ–è§„èŒƒï¼Œé€šè¿‡è¿™ç»„ç°èŒƒå®šä¹‰äº†ç¨‹åºä¸­-å°¤å…¶æ˜¯å¤šçº¿ç¨‹-å„äººå˜é‡çš„è¯»å†™è®¿é—®æ–¹å¼å¹¶å†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶ä»¥åŠå¦‚ä½•å˜æˆå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ï¼Œå…³å»ºæŠ€æœ¯ç‚¹éƒ½æ˜¯å›´ç»•å¤šçº¿ç¨‹çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§å±•å¼€çš„ã€‚" class="headerlink" title="JMM(Javaå†…å­˜æ¨¡å‹Java Memory Modeï¼Œç®€ç§°JMM)æœ¬èº«æ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µå¹¶ä¸çœŸå®å­˜åœ¨å®ƒä»…ä»…æè¿°çš„æ˜¯ä¸€ç»„çº¦å®šæˆ–è§„èŒƒï¼Œé€šè¿‡è¿™ç»„ç°èŒƒå®šä¹‰äº†ç¨‹åºä¸­(å°¤å…¶æ˜¯å¤šçº¿ç¨‹)å„äººå˜é‡çš„è¯»å†™è®¿é—®æ–¹å¼å¹¶å†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶ä»¥åŠå¦‚ä½•å˜æˆå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ï¼Œå…³å»ºæŠ€æœ¯ç‚¹éƒ½æ˜¯å›´ç»•å¤šçº¿ç¨‹çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§å±•å¼€çš„ã€‚"></a>JMM(Javaå†…å­˜æ¨¡å‹Java Memory Modeï¼Œç®€ç§°JMM)æœ¬èº«æ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µå¹¶ä¸çœŸå®å­˜åœ¨å®ƒä»…ä»…æè¿°çš„æ˜¯ä¸€ç»„çº¦å®šæˆ–è§„èŒƒï¼Œé€šè¿‡è¿™ç»„ç°èŒƒå®šä¹‰äº†ç¨‹åºä¸­(å°¤å…¶æ˜¯å¤šçº¿ç¨‹)å„äººå˜é‡çš„è¯»å†™è®¿é—®æ–¹å¼å¹¶å†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶ä»¥åŠå¦‚ä½•å˜æˆå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ï¼Œå…³å»ºæŠ€æœ¯ç‚¹éƒ½æ˜¯å›´ç»•å¤šçº¿ç¨‹çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§å±•å¼€çš„ã€‚</h4><h4 id="åŸåˆ™"><a href="#åŸåˆ™" class="headerlink" title="åŸåˆ™:"></a>åŸåˆ™:</h4><h5 id="JMMçš„å…³é”®æŠ€æœ¯ç‚¹éƒ½æ˜¯å›´ç»•å¤šçº¿ç¨‹çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§å±•å¼€çš„"><a href="#JMMçš„å…³é”®æŠ€æœ¯ç‚¹éƒ½æ˜¯å›´ç»•å¤šçº¿ç¨‹çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§å±•å¼€çš„" class="headerlink" title="JMMçš„å…³é”®æŠ€æœ¯ç‚¹éƒ½æ˜¯å›´ç»•å¤šçº¿ç¨‹çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§å±•å¼€çš„"></a>JMMçš„å…³é”®æŠ€æœ¯ç‚¹éƒ½æ˜¯å›´ç»•å¤šçº¿ç¨‹çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§å±•å¼€çš„</h5><h4 id="èƒ½å¹²å˜›"><a href="#èƒ½å¹²å˜›" class="headerlink" title="èƒ½å¹²å˜›?"></a>èƒ½å¹²å˜›?</h4><h4 id="é€šè¿‡JMMæ¥å®ç°çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ã€‚å±è”½å„ä¸ªç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚"><a href="#é€šè¿‡JMMæ¥å®ç°çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ã€‚å±è”½å„ä¸ªç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚" class="headerlink" title="é€šè¿‡JMMæ¥å®ç°çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ã€‚å±è”½å„ä¸ªç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚"></a>é€šè¿‡JMMæ¥å®ç°çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ã€‚å±è”½å„ä¸ªç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚</h4><h5 id="è€ƒç‚¹-JMM-çš„ä¸‰å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆè¯·å¯¹è¿™ä¸‰å¤§ç‰¹æ€§-åšä¸€ä¸ªè¯´æ˜å§"><a href="#è€ƒç‚¹-JMM-çš„ä¸‰å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆè¯·å¯¹è¿™ä¸‰å¤§ç‰¹æ€§-åšä¸€ä¸ªè¯´æ˜å§" class="headerlink" title="è€ƒç‚¹==JMM çš„ä¸‰å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆè¯·å¯¹è¿™ä¸‰å¤§ç‰¹æ€§ åšä¸€ä¸ªè¯´æ˜å§=="></a>è€ƒç‚¹==JMM çš„ä¸‰å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆè¯·å¯¹è¿™ä¸‰å¤§ç‰¹æ€§ åšä¸€ä¸ªè¯´æ˜å§==</h5><h6 id="1-å¯è§æ€§-ï¼šå½“ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¦ç«‹å³çŸ¥é“å…±äº«å˜é‡å‘ç”Ÿäº†å˜æ›´ã€‚JMMè§„å®šäº†å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ã€‚ç³»ç»Ÿä¸»å†…å­˜ä¸­å…±äº«å˜é‡è¢«å†™å…¥çš„æ—¶æœºä¸ç¡®å®šï¼Œå¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹å®¹æ˜“äº§ç”Ÿè„è¯»ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½æ“ä½œè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œä¸èƒ½ç›´æ¥è¯»å–ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçº¿ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹å˜é‡å€¼çš„ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ"><a href="#1-å¯è§æ€§-ï¼šå½“ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¦ç«‹å³çŸ¥é“å…±äº«å˜é‡å‘ç”Ÿäº†å˜æ›´ã€‚JMMè§„å®šäº†å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ã€‚ç³»ç»Ÿä¸»å†…å­˜ä¸­å…±äº«å˜é‡è¢«å†™å…¥çš„æ—¶æœºä¸ç¡®å®šï¼Œå¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹å®¹æ˜“äº§ç”Ÿè„è¯»ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½æ“ä½œè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œä¸èƒ½ç›´æ¥è¯»å–ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçº¿ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹å˜é‡å€¼çš„ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ" class="headerlink" title="1. ==å¯è§æ€§ ï¼šå½“ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¦ç«‹å³çŸ¥é“å…±äº«å˜é‡å‘ç”Ÿäº†å˜æ›´ã€‚JMMè§„å®šäº†å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ã€‚ç³»ç»Ÿä¸»å†…å­˜ä¸­å…±äº«å˜é‡è¢«å†™å…¥çš„æ—¶æœºä¸ç¡®å®šï¼Œå¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹å®¹æ˜“äº§ç”Ÿè„è¯»ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½æ“ä½œè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œä¸èƒ½ç›´æ¥è¯»å–ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçº¿ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹å˜é‡å€¼çš„ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ=="></a>1. ==å¯è§æ€§ ï¼šå½“ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¦ç«‹å³çŸ¥é“å…±äº«å˜é‡å‘ç”Ÿäº†å˜æ›´ã€‚JMMè§„å®šäº†å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ã€‚ç³»ç»Ÿä¸»å†…å­˜ä¸­å…±äº«å˜é‡è¢«å†™å…¥çš„æ—¶æœºä¸ç¡®å®šï¼Œå¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹å®¹æ˜“äº§ç”Ÿè„è¯»ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½æ“ä½œè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œä¸èƒ½ç›´æ¥è¯»å–ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçº¿ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹å˜é‡å€¼çš„ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ==</h6><h6 id="2-åŸå­æ€§-ï¼šæŒ‡åŒä¸€ä¸ªæ“ä½œä¸èƒ½è¢«æ‰“æ–­ï¼Œå¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œæ“ä½œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°"><a href="#2-åŸå­æ€§-ï¼šæŒ‡åŒä¸€ä¸ªæ“ä½œä¸èƒ½è¢«æ‰“æ–­ï¼Œå¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œæ“ä½œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°" class="headerlink" title="2. ==åŸå­æ€§ ï¼šæŒ‡åŒä¸€ä¸ªæ“ä½œä¸èƒ½è¢«æ‰“æ–­ï¼Œå¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œæ“ä½œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°=="></a>2. ==åŸå­æ€§ ï¼šæŒ‡åŒä¸€ä¸ªæ“ä½œä¸èƒ½è¢«æ‰“æ–­ï¼Œå¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œæ“ä½œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°==</h6><h6 id="3-æœ‰åºæ€§-ï¼šJAVAè§„èŒƒè§„å®šçš„JVMçº¿ç¨‹å†…éƒ¨ç»´æŒçš„é¡ºåºåŒ–è¯­åºï¼Œå¦‚æœä»£ç æ‰§è¡Œçš„æœ€ç»ˆç»“æœä¸é¡ºåºæ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆæŒ‡ä»¤æ‰§è¡Œçš„é¡ºåºä¸ä»£ç æ‰§è¡Œçš„é¡ºåºä¸ä¸€è‡´-å³æŒ‡ä»¤é‡æ–°æ’åº"><a href="#3-æœ‰åºæ€§-ï¼šJAVAè§„èŒƒè§„å®šçš„JVMçº¿ç¨‹å†…éƒ¨ç»´æŒçš„é¡ºåºåŒ–è¯­åºï¼Œå¦‚æœä»£ç æ‰§è¡Œçš„æœ€ç»ˆç»“æœä¸é¡ºåºæ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆæŒ‡ä»¤æ‰§è¡Œçš„é¡ºåºä¸ä»£ç æ‰§è¡Œçš„é¡ºåºä¸ä¸€è‡´-å³æŒ‡ä»¤é‡æ–°æ’åº" class="headerlink" title="3. ==æœ‰åºæ€§ ï¼šJAVAè§„èŒƒè§„å®šçš„JVMçº¿ç¨‹å†…éƒ¨ç»´æŒçš„é¡ºåºåŒ–è¯­åºï¼Œå¦‚æœä»£ç æ‰§è¡Œçš„æœ€ç»ˆç»“æœä¸é¡ºåºæ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆæŒ‡ä»¤æ‰§è¡Œçš„é¡ºåºä¸ä»£ç æ‰§è¡Œçš„é¡ºåºä¸ä¸€è‡´ å³æŒ‡ä»¤é‡æ–°æ’åº=="></a>3. ==æœ‰åºæ€§ ï¼šJAVAè§„èŒƒè§„å®šçš„JVMçº¿ç¨‹å†…éƒ¨ç»´æŒçš„é¡ºåºåŒ–è¯­åºï¼Œå¦‚æœä»£ç æ‰§è¡Œçš„æœ€ç»ˆç»“æœä¸é¡ºåºæ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆæŒ‡ä»¤æ‰§è¡Œçš„é¡ºåºä¸ä»£ç æ‰§è¡Œçš„é¡ºåºä¸ä¸€è‡´ å³æŒ‡ä»¤é‡æ–°æ’åº==</h6><h6 id="ä¼˜ç‚¹-JVM-æ ¹æ®å¤„ç†å™¨ç‰¹æ€§å¯¹æœºå™¨æŒ‡ä»¤é‡æ’-ä½¿æœºå™¨æŒ‡ä»¤æ›´ç¬¦åˆCPUçš„æ‰§è¡Œé¡ºåº-ï¼Œæœ€å¤§é™åº¦çš„å‘æŒ¥äº†æœºå™¨æ€§èƒ½"><a href="#ä¼˜ç‚¹-JVM-æ ¹æ®å¤„ç†å™¨ç‰¹æ€§å¯¹æœºå™¨æŒ‡ä»¤é‡æ’-ä½¿æœºå™¨æŒ‡ä»¤æ›´ç¬¦åˆCPUçš„æ‰§è¡Œé¡ºåº-ï¼Œæœ€å¤§é™åº¦çš„å‘æŒ¥äº†æœºå™¨æ€§èƒ½" class="headerlink" title="==ä¼˜ç‚¹: JVM æ ¹æ®å¤„ç†å™¨ç‰¹æ€§å¯¹æœºå™¨æŒ‡ä»¤é‡æ’ ä½¿æœºå™¨æŒ‡ä»¤æ›´ç¬¦åˆCPUçš„æ‰§è¡Œé¡ºåº ï¼Œæœ€å¤§é™åº¦çš„å‘æŒ¥äº†æœºå™¨æ€§èƒ½=="></a>==ä¼˜ç‚¹: JVM æ ¹æ®å¤„ç†å™¨ç‰¹æ€§å¯¹æœºå™¨æŒ‡ä»¤é‡æ’ ä½¿æœºå™¨æŒ‡ä»¤æ›´ç¬¦åˆCPUçš„æ‰§è¡Œé¡ºåº ï¼Œæœ€å¤§é™åº¦çš„å‘æŒ¥äº†æœºå™¨æ€§èƒ½==</h6><h6 id="ç¼ºç‚¹ï¼šæŒ‡ä»¤é‡æ’å¯ä»¥ä¿è¯ä¸²è¡Œè¯­ä¹‰çš„ä¸€è‡´ï¼Œä½†ä¸èƒ½ä¿è¯å¤šçº¿ç¨‹è¯­ä¹‰ä¹Ÿä¸€è‡´"><a href="#ç¼ºç‚¹ï¼šæŒ‡ä»¤é‡æ’å¯ä»¥ä¿è¯ä¸²è¡Œè¯­ä¹‰çš„ä¸€è‡´ï¼Œä½†ä¸èƒ½ä¿è¯å¤šçº¿ç¨‹è¯­ä¹‰ä¹Ÿä¸€è‡´" class="headerlink" title="==ç¼ºç‚¹ï¼šæŒ‡ä»¤é‡æ’å¯ä»¥ä¿è¯ä¸²è¡Œè¯­ä¹‰çš„ä¸€è‡´ï¼Œä½†ä¸èƒ½ä¿è¯å¤šçº¿ç¨‹è¯­ä¹‰ä¹Ÿä¸€è‡´=="></a>==ç¼ºç‚¹ï¼šæŒ‡ä»¤é‡æ’å¯ä»¥ä¿è¯ä¸²è¡Œè¯­ä¹‰çš„ä¸€è‡´ï¼Œä½†ä¸èƒ½ä¿è¯å¤šçº¿ç¨‹è¯­ä¹‰ä¹Ÿä¸€è‡´==</h6><p> <img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/jMM%E5%8E%9F%E7%90%86%E5%9B%BE.png" alt="JMMåŸç†å›¾"></p><h4 id="è€ƒç‚¹happens-beforeæ€»åŸåˆ™ç†è§£"><a href="#è€ƒç‚¹happens-beforeæ€»åŸåˆ™ç†è§£" class="headerlink" title="==è€ƒç‚¹happens-beforeæ€»åŸåˆ™ç†è§£=="></a>==è€ƒç‚¹happens-beforeæ€»åŸåˆ™ç†è§£==</h4><h6 id="å¦‚æœä¸€ä¸ªæ“ä½œhappens-beforeå¦ä¸€ä¸ªæ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœå°†å¯¹ç¬¬äºŒä¸ªæ“ä½œå¯è§è€Œä¸”ç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚"><a href="#å¦‚æœä¸€ä¸ªæ“ä½œhappens-beforeå¦ä¸€ä¸ªæ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœå°†å¯¹ç¬¬äºŒä¸ªæ“ä½œå¯è§è€Œä¸”ç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚" class="headerlink" title="å¦‚æœä¸€ä¸ªæ“ä½œhappens-beforeå¦ä¸€ä¸ªæ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœå°†å¯¹ç¬¬äºŒä¸ªæ“ä½œå¯è§è€Œä¸”ç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚"></a>å¦‚æœä¸€ä¸ªæ“ä½œhappens-beforeå¦ä¸€ä¸ªæ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœå°†å¯¹ç¬¬äºŒä¸ªæ“ä½œå¯è§è€Œä¸”ç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚</h6><h6 id="ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€ä¸€å®šè¦æŒ‰ç…§happens-beforeåŸåˆ™åˆ¶å®šçš„é¡ºåºæ¥æ‰§è¡Œå¦‚æœé‡æ’åºä¹‹åçš„æ‰§è¡Œç»“æœä¸æŒ‰ç…§happens-beforeå…³ç³»æ¥æ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ç§é‡æ’åºå¹¶ä¸éæ³•ã€‚"><a href="#ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€ä¸€å®šè¦æŒ‰ç…§happens-beforeåŸåˆ™åˆ¶å®šçš„é¡ºåºæ¥æ‰§è¡Œå¦‚æœé‡æ’åºä¹‹åçš„æ‰§è¡Œç»“æœä¸æŒ‰ç…§happens-beforeå…³ç³»æ¥æ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ç§é‡æ’åºå¹¶ä¸éæ³•ã€‚" class="headerlink" title="ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€ä¸€å®šè¦æŒ‰ç…§happens-beforeåŸåˆ™åˆ¶å®šçš„é¡ºåºæ¥æ‰§è¡Œå¦‚æœé‡æ’åºä¹‹åçš„æ‰§è¡Œç»“æœä¸æŒ‰ç…§happens-beforeå…³ç³»æ¥æ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ç§é‡æ’åºå¹¶ä¸éæ³•ã€‚"></a>ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€ä¸€å®šè¦æŒ‰ç…§happens-beforeåŸåˆ™åˆ¶å®šçš„é¡ºåºæ¥æ‰§è¡Œå¦‚æœé‡æ’åºä¹‹åçš„æ‰§è¡Œç»“æœä¸æŒ‰ç…§happens-beforeå…³ç³»æ¥æ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ç§é‡æ’åºå¹¶ä¸éæ³•ã€‚</h6><h5 id="happens-before-åŸåˆ™å…·ä½“ç‰ˆ"><a href="#happens-before-åŸåˆ™å…·ä½“ç‰ˆ" class="headerlink" title="happens-before åŸåˆ™å…·ä½“ç‰ˆ"></a>happens-before åŸåˆ™å…·ä½“ç‰ˆ</h5><ul><li>.1æ¬¡åºè§„åˆ™: ä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ä»£ç é¡ºåºï¼Œå†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºå†™åœ¨åé¢çš„æ“ä½œ; å‰ä¸€ä¸ªæ“ä½œçš„ç»“æœå¯ä»¥è¢«åç»­çš„æ“ä½œè·å–<br>è®²ç›´ç™½ç‚¹å°±æ˜¯å‰é¢ä¸€ä¸ªæ“ä½œæŠŠå˜é‡Xèµ‹å€¼ä¸º1ï¼Œé‚£åé¢ä¸€ä¸ªæ“ä½œè‚¯å®šèƒ½çŸ¥é“Xå·²ç»å˜æˆäº†1</li><li>2.é”å®šè§„åˆ™: ä¸ªunLockæ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢((è¿™é‡Œçš„â€œåé¢â€æ˜¯æŒ‡æ—¶é—´ä¸Šçš„å…ˆå))å¯¹åŒä¸€ä¸ªé”çš„lockæ“ä½œ;</li><li>3.volatileå˜é‡è§„åˆ™:å¯¹ä¸€ä¸ªvolatileå˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼Œå‰é¢çš„å†™å¯¹åé¢çš„è¯»æ˜¯å¯è§çš„ï¼Œè¿™é‡Œçš„â€œåé¢â€åŒæ ·æ˜¯æŒ‡æ—¶é—´ä¸Šçš„å…ˆå</li><li>4.ä¼ é€’è§„åˆ™:å¦‚æœæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œBï¼Œè€Œæ“ä½œBåˆå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCï¼Œåˆ™å¯ä»¥å¾—å‡ºæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œC</li><li>5.çº¿ç¨‹å¯åŠ¨è§„åˆ™(Thread Start Rule):Threadå¯¹è±¡çš„start()æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œ</li><li>6.çº¿ç¨‹ä¸­æ–­è§„åˆ™(Thread Interruption Rule): å¯¹çº¿ç¨‹interrupt()æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿ;å¯ä»¥é€šè¿‡Thread.interrupted()æ£€æµ‹åˆ°æ˜¯å¦å‘ç”Ÿä¸­æ–­ä¹Ÿå°±æ˜¯è¯´ä½ è¦å…ˆè°ƒç”¨interrupt()æ–¹æ³•è®¾ç½®è¿‡ä¸­æ–­æ ‡å¿—ä½ï¼Œæˆ‘æ‰èƒ½æ£€æµ‹åˆ°ä¸­æ–­å‘ç”Ÿ</li><li>7.çº¿ç¨‹ç»ˆæ­¢è§„åˆ™(Thread Termination Rule): çº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºå¯¹æ­¤çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡isAlive()ç­‰æ‰‹æ®µæ£€æµ‹çº¿ç¨‹æ˜¯å¦å·²ç»ç»ˆæ­¢æ‰§è¡Œ</li><li>8.å¯¹è±¡ç»ˆç»“è§„åˆ™(Finalizer Rule): å¯¹è±¡æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ä¹‹å‰ï¼Œæ˜¯ä¸èƒ½è°ƒç”¨finalized0)æ–¹æ³•çš„</li></ul><h3 id="volatile-å’Œ-JMM"><a href="#volatile-å’Œ-JMM" class="headerlink" title="volatile  å’Œ  JMM"></a>volatile  å’Œ  JMM</h3><h5 id="è€ƒç‚¹è¢«volatileä¿®é¥°çš„å˜é‡æœ‰ä»€ä¹ˆç‰¹ç‚¹-ï¼šå¯è§æ€§-æœ‰åºæ€§"><a href="#è€ƒç‚¹è¢«volatileä¿®é¥°çš„å˜é‡æœ‰ä»€ä¹ˆç‰¹ç‚¹-ï¼šå¯è§æ€§-æœ‰åºæ€§" class="headerlink" title="==è€ƒç‚¹è¢«volatileä¿®é¥°çš„å˜é‡æœ‰ä»€ä¹ˆç‰¹ç‚¹ ï¼šå¯è§æ€§ æœ‰åºæ€§=="></a>==è€ƒç‚¹è¢«volatileä¿®é¥°çš„å˜é‡æœ‰ä»€ä¹ˆç‰¹ç‚¹ ï¼šå¯è§æ€§ æœ‰åºæ€§==</h5><h5 id="volatileçš„å†…å­˜è¯­ä¹‰ï¼ˆä½œç”¨ï¼‰ï¼šå½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡å€¼ç«‹å³åˆ·æ–°å›ä¸»å†…å­˜ä¸­ã€‚å½“è¯»ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜è®¾ç½®ä¸ºæ— æ•ˆï¼Œé‡æ–°å›åˆ°ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°å…±äº«å˜æ‰€ä»¥volatileçš„å†™å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œè¯»çš„å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–"><a href="#volatileçš„å†…å­˜è¯­ä¹‰ï¼ˆä½œç”¨ï¼‰ï¼šå½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡å€¼ç«‹å³åˆ·æ–°å›ä¸»å†…å­˜ä¸­ã€‚å½“è¯»ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜è®¾ç½®ä¸ºæ— æ•ˆï¼Œé‡æ–°å›åˆ°ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°å…±äº«å˜æ‰€ä»¥volatileçš„å†™å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œè¯»çš„å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–" class="headerlink" title="volatileçš„å†…å­˜è¯­ä¹‰ï¼ˆä½œç”¨ï¼‰ï¼šå½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡å€¼ç«‹å³åˆ·æ–°å›ä¸»å†…å­˜ä¸­ã€‚å½“è¯»ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜è®¾ç½®ä¸ºæ— æ•ˆï¼Œé‡æ–°å›åˆ°ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°å…±äº«å˜æ‰€ä»¥volatileçš„å†™å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œè¯»çš„å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–"></a>volatileçš„å†…å­˜è¯­ä¹‰ï¼ˆä½œç”¨ï¼‰ï¼šå½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡å€¼ç«‹å³åˆ·æ–°å›ä¸»å†…å­˜ä¸­ã€‚å½“è¯»ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜è®¾ç½®ä¸ºæ— æ•ˆï¼Œé‡æ–°å›åˆ°ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°å…±äº«å˜æ‰€ä»¥volatileçš„å†™å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œè¯»çš„å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–</h5><h5 id="è€ƒç‚¹çš„é€šè¿‡ä»€ä¹ˆæ–¹å¼ä¿è¯å¯ä»¥è§æ€§å’Œæœ‰åºæ€§ï¼šæ˜¯é€šè¿‡å†…å­˜å±éšœ"><a href="#è€ƒç‚¹çš„é€šè¿‡ä»€ä¹ˆæ–¹å¼ä¿è¯å¯ä»¥è§æ€§å’Œæœ‰åºæ€§ï¼šæ˜¯é€šè¿‡å†…å­˜å±éšœ" class="headerlink" title="==è€ƒç‚¹çš„é€šè¿‡ä»€ä¹ˆæ–¹å¼ä¿è¯å¯ä»¥è§æ€§å’Œæœ‰åºæ€§ï¼šæ˜¯é€šè¿‡å†…å­˜å±éšœ=="></a>==è€ƒç‚¹çš„é€šè¿‡ä»€ä¹ˆæ–¹å¼ä¿è¯å¯ä»¥è§æ€§å’Œæœ‰åºæ€§ï¼šæ˜¯é€šè¿‡å†…å­˜å±éšœ==</h5><h6 id=""><a href="#" class="headerlink" title=""></a></h6><h5 id="è¯´è¯´å†…å­˜å±éšœåŸç†ï¼ˆ-é‡ç‚¹-ï¼‰"><a href="#è¯´è¯´å†…å­˜å±éšœåŸç†ï¼ˆ-é‡ç‚¹-ï¼‰" class="headerlink" title="è¯´è¯´å†…å­˜å±éšœåŸç†ï¼ˆ==é‡ç‚¹==ï¼‰"></a>è¯´è¯´å†…å­˜å±éšœåŸç†ï¼ˆ==é‡ç‚¹==ï¼‰</h5><h6 id="å†è¯´å†…å­˜å±éšœä¹‹å‰ï¼Œå…ˆçœ‹çœ‹å¯¹äºæœ‰åºæ€§çš„ç†è§£"><a href="#å†è¯´å†…å­˜å±éšœä¹‹å‰ï¼Œå…ˆçœ‹çœ‹å¯¹äºæœ‰åºæ€§çš„ç†è§£" class="headerlink" title="å†è¯´å†…å­˜å±éšœä¹‹å‰ï¼Œå…ˆçœ‹çœ‹å¯¹äºæœ‰åºæ€§çš„ç†è§£"></a>å†è¯´å†…å­˜å±éšœä¹‹å‰ï¼Œå…ˆçœ‹çœ‹å¯¹äºæœ‰åºæ€§çš„ç†è§£</h6><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">æœ‰åº(ç¦é‡æ’)é‡æ’åºæ˜¯æŒ‡ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†ä¼˜åŒ–ç¨‹åºæ€§èƒ½è€Œå¯¹æŒ‡ä»¤åºåˆ—è¿›è¡Œé‡æ–°æ’åºçš„ä¸€ç§æ‰‹æ®µï¼Œæœ‰æ—¶å€™ä¼šæ”¹å˜ç¨‹åºè¯­å¥çš„å…ˆåé¡ºåºä¸å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œå¯ä»¥é‡æ’åº;å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¦æ­¢é‡æ’åºä½†é‡æ’åçš„æŒ‡ä»¤ç»å¯¹ä¸èƒ½æ”¹å˜åŸæœ‰çš„ä¸²è¡Œè¯­ä¹‰!è¿™ç‚¹åœ¨å¹¶å‘è®¾è®¡ä¸­å¿…é¡»è¦é‡ç‚¹è€ƒè™‘!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h6 id="å†…å­˜å±éšœçš„åˆ†ç±»"><a href="#å†…å­˜å±éšœçš„åˆ†ç±»" class="headerlink" title="å†…å­˜å±éšœçš„åˆ†ç±»"></a>å†…å­˜å±éšœçš„åˆ†ç±»</h6><ul><li><p>ç²—åˆ†ä¸¤ç§ï¼šè¯»å±éšœ ï¼ˆåœ¨è¯»æŒ‡ä»¤ä¹‹å‰æ’å…¥è¯»å±éšœï¼Œè®©å·¥ä½œå†…å­˜æˆ–CPUé«˜é€Ÿç¼“å­˜å½“ä¸­çš„ç¼“å­˜æ•°æ®å¤±æ•ˆï¼Œé‡æ–°å›åˆ°ä¸»å†…å­˜ä¸­è·å–æœ€æ–°æ•°æ®ï¼‰å’Œå†™çš„å±éšœï¼ˆåœ¨å†™æŒ‡ä»¤ä¹‹åæ’å…¥å†™å±éšœï¼Œå¼ºåˆ¶æŠŠå†™ç¼“å†²åŒºçš„æ•°æ®åˆ·å›åˆ°ä¸»å†…å­˜ä¸­ï¼‰</p></li><li><p>ç»†åˆ†æœ‰å››ç§ï¼š</p></li></ul><table><thead><tr><th>å±éšœç±»å‹</th><th>æŒ‡ä»¤ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>LoadLoad</td><td>Load1;LoadLoad;Load2</td><td>ä¿è¯load1çš„è¯»å–æ“ä½œåœ¨load2åŠåç»­è¯»å–æ“ä½œä¹‹å‰æ‰§è¡Œ</td></tr><tr><td>StoreStore</td><td>Store1; StoreStore; Store2</td><td>åœ¨store2åŠå…¶åçš„å†™æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯store1çš„å†™æ“ä½œå·²åˆ·æ–°åˆ°ä¸»å†…å­˜</td></tr><tr><td>LoadStore</td><td>Load1: LoadStore: Store2</td><td>åœ¨stroe2åŠå…¶åçš„å†™æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯load1çš„è¯»æ“ä½œå·²è¯»å–ç»“æŸ</td></tr><tr><td>StoreLoad</td><td>Store1: Storeload: Load2</td><td>ä¿è¯store1çš„å†™æ“ä½œå·²åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹åï¼Œload2åŠå…¶åçš„è¯»æ“ä½œæ‰èƒ½æ‰§è¡Œ</td></tr></tbody></table><h4 id="Happens-beforeä¹‹volatile-çš„è§„åˆ™-ç­–ç•¥"><a href="#Happens-beforeä¹‹volatile-çš„è§„åˆ™-ç­–ç•¥" class="headerlink" title="Happens-beforeä¹‹volatile çš„è§„åˆ™ ç­–ç•¥"></a>Happens-beforeä¹‹volatile çš„è§„åˆ™ ç­–ç•¥</h4><table><thead><tr><th>ç¬¬ä¸€ä¸ªæ“ä½œ</th><th>ç¬¬äºŒä¸ªæ“ä½œ: æ™®é€šè¯»å†™</th><th>ç¬¬äºŒä¸ªæ“ä½œ: volatileè¯»</th><th>ç¬¬äºŒä¸ªæ“ä½œ: volatileè¯»</th></tr></thead><tbody><tr><td>æ™®é€šè¯»å†™</td><td>æ™®é€šè¯»å†™</td><td>æ™®é€šè¯»å†™</td><td>ä¸å¯ä»¥é‡æ’</td></tr><tr><td>volatileè¯»</td><td>ä¸å¯ä»¥é‡æ’</td><td>ä¸å¯ä»¥é‡æ’</td><td>ä¸å¯ä»¥é‡æ’</td></tr><tr><td>volatileå†™</td><td>å¯ä»¥é‡æ’</td><td>ä¸å¯ä»¥é‡æ’</td><td>ä¸å¯ä»¥é‡æ’</td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><h6 id="ç­–ç•¥çš„è®°å¿†å£è¯€"><a href="#ç­–ç•¥çš„è®°å¿†å£è¯€" class="headerlink" title="ç­–ç•¥çš„è®°å¿†å£è¯€"></a>ç­–ç•¥çš„è®°å¿†å£è¯€</h6><ul><li><p>å½“ç¬¬ä¸€ä¸ªæ“ä½œä¸ºvolatleè¯»æ—¶ï¼Œä¸è®ºç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªæ“ä½œä¿è¯äº†volatleè¯»ä¹‹åçš„æ“ä½œä¸ä¼šè¢«é‡æ’åˆ°volatileè¯»ä¹‹å‰ã€‚</p></li><li><p>å½“ç¬¬äºŒä¸ªæ“ä½œä¸ºvolatileå†™æ—¶ï¼Œä¸è®ºç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªæ“ä½œä¿è¯äº†volatileå†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«é‡æ’åˆ°volatileå†™ä¹‹åã€‚</p></li><li><p>å½“ç¬¬ä¸€ä¸ªæ“ä½œä¸ºvolatileå†™æ—¶ï¼Œç¬¬äºŒä¸ªæ“ä½œä¸ºvolatileè¯»æ—¶ï¼Œä¸èƒ½é‡æ’ã€‚</p></li></ul><h6 id="è¯»å±éšœçš„ç¤ºæ„å›¾"><a href="#è¯»å±éšœçš„ç¤ºæ„å›¾" class="headerlink" title="è¯»å±éšœçš„ç¤ºæ„å›¾"></a>è¯»å±éšœçš„ç¤ºæ„å›¾</h6><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="å†…å­˜å±éšœçš„ç†è§£å›¾"></p><h6 id="å†™å±éšœçš„ç¤ºæ„å›¾"><a href="#å†™å±éšœçš„ç¤ºæ„å›¾" class="headerlink" title="å†™å±éšœçš„ç¤ºæ„å›¾"></a>å†™å±éšœçš„ç¤ºæ„å›¾</h6><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E5%86%99%E5%B1%8F%E9%9A%9C%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="å†™å±éšœçš„ç¤ºæ„å›¾"></p><h5 id="volatie-å˜é‡å†™è¿‡ç¨‹çš„"><a href="#volatie-å˜é‡å†™è¿‡ç¨‹çš„" class="headerlink" title="volatie å˜é‡å†™è¿‡ç¨‹çš„"></a>volatie å˜é‡å†™è¿‡ç¨‹çš„</h5><ul><li><p>read: ä½œç”¨äºä¸»å†…å­˜ï¼Œå°†å˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°å·¥ä½œå†…å­˜ï¼Œä¸»å†…å­˜åˆ°å·¥ä½œå†…å­˜</p></li><li><p>load: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†readä»ä¸»å†…å­˜ä¼ è¾“çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜å˜é‡å‰¯æœ¬ä¸­ï¼Œå³æ•°æ®åŠ è½½</p></li><li><p>use: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†å·¥ä½œå†…å­˜å˜é‡å‰¯æœ¬çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“JVMé‡åˆ°éœ€è¦è¯¥å˜é‡çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶ä¼šæ‰§è¡Œè¯¥æ“ä½œ</p></li><li><p>assign: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†ä»æ‰§è¡Œå¼•è­¦æ¥æ”¶åˆ°çš„å€¼èµ‹å€¼ç»™å·¥ä½œå†…å­˜å˜é‡ï¼Œæ¯å½“JVMé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼å­—èŠ‚ç æŒ‡ä»¤æ—¶ä¼šæ‰§è¡Œè¯¥æ“ä½œ</p></li><li><p>store: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†èµ‹å€¼å®Œæ¯•çš„å·¥ä½œå˜é‡çš„å€¼å†™å›ç»™ä¸»å†…å­˜</p></li><li><p>write:ä½œç”¨äºä¸»å†…å­˜ï¼Œå°†storeä¼ è¾“è¿‡æ¥çš„å˜é‡å€¼èµ‹å€¼ç»™ä¸»å†…å­˜ä¸­çš„å˜é‡</p></li><li><p>==ç”±äºä¸Šè¿°6æ¡åªèƒ½ä¿è¯å•æ¡æŒ‡ä»¤çš„åŸå­æ€§ï¼Œé’ˆå¯¹å¤šæ¡æŒ‡ä»¤çš„ç»„åˆæ€§åŸå­ä¿è¯ï¼Œæ²¡æœ‰å¤§é¢ç§¯åŠ é”ï¼Œæ‰€ä»¥ï¼ŒJVMæä¾›äº†å¦å¤–ä¸¤ä¸ªåŸå­æŒ‡ä»¤==</p><ul><li><p>lock: ä½œç”¨äºä¸»å†…å­˜ï¼Œå°†ä¸€ä¸ªå˜é‡æ ‡è®°ä¸ºä¸€ä¸ªçº¿ç¨‹ç‹¬å çš„çŠ¶æ€ï¼Œåªæ˜¯å†™æ—¶å€™åŠ é”ï¼Œå°±åªæ˜¯é”äº†å†™å˜é‡çš„è¿‡ç¨‹ã€‚</p></li><li><p>unlock: ä½œç”¨äºä¸»å†…å­˜ï¼ŒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾ï¼Œç„¶åæ‰èƒ½è¢«å…¶ä»–çº¿ç¨‹å ç”¨</p></li></ul></li></ul><h5 id="è€ƒç‚¹volatile-çš„ä½¿ç”¨åœºæ™¯"><a href="#è€ƒç‚¹volatile-çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="==è€ƒç‚¹volatile çš„ä½¿ç”¨åœºæ™¯=="></a>==è€ƒç‚¹volatile çš„ä½¿ç”¨åœºæ™¯==</h5><ul><li><p>å•ä¸€èµ‹å€¼å¯ä»¥ï¼Œbutå«å¤åˆè¿ç®—èµ‹å€¼ä¸å¯ä»¥(i++ä¹‹ç±»)</p></li><li><p>çŠ¶æ€æ ‡å¿—ï¼Œåˆ¤æ–­ä¸šåŠ¡æ˜¯å¦ç»“æŸ  ï¼ˆå˜é‡å¯ä»¥ç”¨volatile ä¿®é¥°ï¼‰</p></li><li><p>å¼€é”€è¾ƒä½çš„è¯»ï¼Œå†™é”ç­–ç•¥  ï¼ˆå†å†™ä½¿ç”¨sychornized ä¿®é¥°  è¯»çš„å˜é‡çš„ä½¿ç”¨volatile ä¿®é¥°ï¼‰</p></li><li><p>AtomicIntegerFieldUpdaterï¼ŒAtomicLongFieldUpdaterï¼ŒAtomicReferenceFieldUpdater æ›´æ–°çš„å¯¹è±¡å±æ€§å¿…é¡»ä½¿ç”¨ public volatile ä¿®é¥°ç¬¦</p></li><li><p>DCLåŒç«¯é”çš„å‘å¸ƒ ï¼ˆå•ä¾‹æ¨¡å¼çš„ä¸­åŒé‡æ£€æŸ¥ï¼‰</p></li></ul>  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>itdachang</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SafeDoubleCheckSingleton</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SafeDoubleCheckSingleton</span> singleton<span class="token punctuation">;</span>    <span class="token comment">//ç§è‚²åŒ–æ„é€ æ–¹æ³•</span><span class="token keyword">private</span> <span class="token class-name">SafeDoubleChecksingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">//åŒé‡é”æ²¡è®¡</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span>  <span class="token class-name">SafeDoubleCheckSingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> nu11<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">//1.å¤šçº¿ç¨‹å¹¶å‘åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼šé€šè¿‡åŠ é”ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½åˆ›å»ºå¯¹è±¡</span>        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">SafeDoubleCheckSingleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> nu11<span class="token punctuation">)</span><span class="token punctuation">{</span>               <span class="token comment">//éšæ‚£ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œç”±äºé‡æ’åºï¼Œè¯¥å¯¹è±¡å¯èƒ½è¿˜æœªå®Œæˆåˆå§‹åŒ–å°±è¢«å…¶ä»–çº¿ç¨‹è¯»èŒ</span>                singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SafeDoubleCheckSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token comment">//2.å¯¹è±¡åˆ›å»ºå®Œæ¯•ï¼Œæ‰§è¡ŒgetInstance()ç‰¹ä¸éœ€è¦è·èŒé”ï¼Œç›´æ¥è¿”å›åˆ›å»ºå¯¹è±¡</span>    <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="é¢è¯•volatile-çš„æ—¶å€™ï¼Œä»è¿™ä¸ªç‚¹æ³•ä¸Šé¢åŒºè¡¨è¿°"><a href="#é¢è¯•volatile-çš„æ—¶å€™ï¼Œä»è¿™ä¸ªç‚¹æ³•ä¸Šé¢åŒºè¡¨è¿°" class="headerlink" title="é¢è¯•volatile çš„æ—¶å€™ï¼Œä»è¿™ä¸ªç‚¹æ³•ä¸Šé¢åŒºè¡¨è¿°"></a>é¢è¯•volatile çš„æ—¶å€™ï¼Œä»è¿™ä¸ªç‚¹æ³•ä¸Šé¢åŒºè¡¨è¿°</h5><table><thead><tr><th>volatileå…³é”®å­—ä¿è¯å¯è§æ€§:</th><th>å¯¹ä¸€ä¸ªè¢«volatileå…³é”®å­—ä¿®æ”¹çš„å˜é‡</th></tr></thead><tbody><tr><td></td><td>å†™æ“ä½œçš„è¯ï¼Œè¿™ä¸ªå˜é‡çš„æœ€æ–°å€¼ä¼šç«‹å³åˆ·æ–°å›åˆ°ä¸»å†…å­˜ä¸­</td></tr><tr><td></td><td>è¯»æ“ä½œçš„è¯ï¼Œæ€»æ˜¯èƒ½å¤Ÿè¯»å–åˆ°è¿™ä¸ªå˜é‡çš„æœ€æ–°å€¼ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå˜é‡æœ€åè¢«ä¿®æ”¹çš„å€¼</td></tr><tr><td></td><td>å½“æŸä¸ªçº¿ç¨‹æ”¶åˆ°é€šçŸ¥ï¼Œå»è¯»å–volatileä¿®é¥°çš„å˜é‡çš„å€¼çš„æ—¶å€™ï¼Œçº¿ç¨‹ç§æœ‰å·¥ä½œå†…å­˜çš„æ•°æ®å¤±æ•ˆï¼Œéœ€è¦é‡æ–°å›åˆ°ä¸»å†…å­˜ä¸­å»è¯»å–æœ€æ–°çš„æ•°æ®ã€‚</td></tr><tr><td>æ²¡æœ‰åŸå­æ€§</td><td>ï¼šç»“åˆçº¿ç¨‹å½“æ“ä½œå¤åˆè¿ç®—++ i çš„é—®é¢˜ä¸Šï¼Œä»–ä»¬çš„æ­¥éª¤ä¸æ˜¯åŸå­æ€§ï¼Œè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹</td></tr><tr><td>ç¦æ­¢é‡æ’åºï¼ˆæœ‰åºæ€§ï¼‰</td><td></td></tr><tr><td>==å‡­å•¥å°±ç»™æˆ‘ä»¬volatileå°±ä¼šåŠ å†…å­˜å±éšœ==</td><td>åº•å±‚çœ‹volatile ä¿®é¥°å°±æ·»åŠ  ACC_VOLATILE  ç¨‹åºå°±ä¼šæŒ‰ç…§è¿™ä¸ªåŠ å†…å­˜å±éšœ</td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">compare and swapçš„ç¼©å†™ï¼Œä¸­æ–‡ç¿»è¯‘æˆæ¯”è¾ƒå¹¶äº¤æ¢,å®ç°å¹¶å‘ç®—æ³•æ—¶å¸¸ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ã€‚å®ƒåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ä¸€ä¸€å†…å­˜ä½ç½®ã€é¢„æœŸåŸå€¼åŠæ›´æ–°å€¼ã€‚æ‰§è¡ŒCASæ“ä½œçš„æ—¶å€™ï¼Œå°†å†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼æ¯”è¾ƒ:å¦‚æœç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼å¦‚æœä¸åŒ¹é…ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒCASæ“ä½œåªæœ‰ä¸€ä¸ªä¼šæˆåŠŸã€‚CASæœ‰3ä¸ªæ“ä½œæ•°ï¼Œä½ç½®å†…å­˜å€¼Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ›´æ–°å€¼Bå½“ä¸”ä»…å½“æ—§çš„é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼Vä¿®æ”¹ä¸ºBï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšæˆ–é‡æ¥å½“å®ƒé‡æ¥é‡è¯•çš„è¿™ç§è¡Œä¸ºæˆä¸º----è‡ªæ—‹! !<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/CAS%E5%9B%BE%E4%BE%8B%E8%AF%B4%E6%98%8E.png" alt="CASçš„å›¾ä¾‹"></p><h5 id="è®¤è¯†CAS-è¦å¯¹åº•å±‚çš„unsafa-æ ¸å¿ƒç±»çš„äº†è§£"><a href="#è®¤è¯†CAS-è¦å¯¹åº•å±‚çš„unsafa-æ ¸å¿ƒç±»çš„äº†è§£" class="headerlink" title="è®¤è¯†CAS è¦å¯¹åº•å±‚çš„unsafa æ ¸å¿ƒç±»çš„äº†è§£"></a>è®¤è¯†CAS è¦å¯¹åº•å±‚çš„unsafa æ ¸å¿ƒç±»çš„äº†è§£</h5><h6 id="Unsafe"><a href="#Unsafe" class="headerlink" title="Unsafe"></a>Unsafe</h6><p>æ˜¯CASçš„æ ¸å¿ƒç±»ï¼Œç”±äºJavaæ–¹æ³•æ— æ³•ç›´æ¥è®¿é—®åº•å±‚ç³»ç»Ÿï¼Œéœ€è¦é€šè¿‡æœ¬åœ°(native) æ–¹æ³•æ¥è®¿é—®ï¼ŒUnsafeç›¸å½“äºä¸€ä¸ªåé—¨ï¼ŒåŸºäºè¯¥ç±»å¯ä»¥ç›´æ¥æ“ä½œç‰¹å®šå†…å­˜çš„æ•°æ®ã€‚Unsafeç±»å­˜åœ¨äºsun.miscåŒ…ä¸­ï¼Œå…¶å†…éƒ¨æ–¹æ³•æ“ä½œå¯ä»¥åƒCçš„æŒ‡é’ˆä¸€æ ·ç›´æ¥æ“ä½œå†…å­˜ï¼Œå› ä¸ºJavaä¸­CASæ“ä½œçš„æ‰§è¡Œä¾èµ–äºUnsafeç±»çš„æ–¹æ³•ã€‚</p><p><strong><em>æ³¨æ„Unsafeç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯nativeä¿®é¥°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´Unsafeç±»ä¸­çš„æ³•éƒ½ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿåº•å±‚èµ„æºæ‰§è¡Œç›¸åº”ä½œåŠ¡</em></strong></p><p><strong>CASå¹¶å‘åŸè¯­ä½“ç°åœ¨JAVAè¯­è¨€ä¸­å°±æ˜¯sun.misc.Unsafeç±»ä¸­çš„æ ¸å¿ƒæ–¹æ³•ã€‚==è°ƒç”¨UnSafeç±»ä¸­çš„CASæ–¹æ³•ï¼ŒJVMä¼šå¸®æˆ‘ä»¬å®ç°å‡ºCASæ±‡ç¼–æŒ‡ä»¤ã€‚è¿™æ˜¯ä¸€ç§å®Œå…¨ä¾èµ–äºç¡¬ä»¶çš„åŠŸèƒ½ï¼Œé€šè¿‡å®ƒå®ç°äº†åŸå­æ“ä½œã€‚å†æ¬¡å¼ºè°ƒï¼Œç”±äºCASæ˜¯ä¸€ç§ç³»ç»ŸåŸè¯­ï¼ŒåŸè¯­å±äºæ“ä½œç³»ç»Ÿç”¨è¯­èŒƒç•´ï¼Œæ˜¯ç”±è‹¥å¹²æ¡æŒ‡ä»¤ç»„æˆçš„ï¼Œç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå¹¶ä¸”åŸè¯­çš„æ‰§è¡Œå¿…é¡»æ˜¯è¿ç»­çš„ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸å…è®¸è¢«ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´CASæ˜¯ä¸€æ¡CPUçš„åŸå­æŒ‡ä»¤ï¼Œä¸ä¼šé€ æˆæ‰€è°“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜==ã€‚</strong></p><h6 id="JUC-ä¸‹çš„å¹¶å‘åŒ…çš„åŸå­ç±»"><a href="#JUC-ä¸‹çš„å¹¶å‘åŒ…çš„åŸå­ç±»" class="headerlink" title="JUC ä¸‹çš„å¹¶å‘åŒ…çš„åŸå­ç±»"></a>JUC ä¸‹çš„å¹¶å‘åŒ…çš„åŸå­ç±»</h6><h5 id="volatile-è§£å†³å¤šçº¿ç¨‹å†…å­˜ä¸å¯è§é—®é¢˜å¯¹äºä¸€å†™å¤šè¯»ï¼Œæ˜¯å¯ä»¥è§£å†³å˜é‡åŒæ­¥é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå¤šå†™ï¼ŒåŒæ ·æ— æ³•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚"><a href="#volatile-è§£å†³å¤šçº¿ç¨‹å†…å­˜ä¸å¯è§é—®é¢˜å¯¹äºä¸€å†™å¤šè¯»ï¼Œæ˜¯å¯ä»¥è§£å†³å˜é‡åŒæ­¥é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå¤šå†™ï¼ŒåŒæ ·æ— æ³•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚" class="headerlink" title="volatile è§£å†³å¤šçº¿ç¨‹å†…å­˜ä¸å¯è§é—®é¢˜å¯¹äºä¸€å†™å¤šè¯»ï¼Œæ˜¯å¯ä»¥è§£å†³å˜é‡åŒæ­¥é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå¤šå†™ï¼ŒåŒæ ·æ— æ³•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚"></a>volatile è§£å†³å¤šçº¿ç¨‹å†…å­˜ä¸å¯è§é—®é¢˜å¯¹äºä¸€å†™å¤šè¯»ï¼Œæ˜¯å¯ä»¥è§£å†³å˜é‡åŒæ­¥é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå¤šå†™ï¼ŒåŒæ ·æ— æ³•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</h5><h5 id="è¯´æ˜-å¦‚æœæ˜¯-count-æ“ä½œï¼Œä½¿ç”¨å¦‚ä¸‹ç±»å®ç°"><a href="#è¯´æ˜-å¦‚æœæ˜¯-count-æ“ä½œï¼Œä½¿ç”¨å¦‚ä¸‹ç±»å®ç°" class="headerlink" title="è¯´æ˜: å¦‚æœæ˜¯ count+ +æ“ä½œï¼Œä½¿ç”¨å¦‚ä¸‹ç±»å®ç°:"></a>è¯´æ˜: å¦‚æœæ˜¯ count+ +æ“ä½œï¼Œä½¿ç”¨å¦‚ä¸‹ç±»å®ç°:</h5><p>AtomicInteger count = new AtomicInteger();<br>count.addAndGet(1):</p><h5 id="å¦‚æœæ˜¯JDK8ï¼Œ-æ¨èä½¿ç”¨-LongAdder-å¯¹è±¡ï¼Œæ¯”-AtomicLong-æ€§èƒ½æ›´å¥½-å‡å°‘ä¹è§‚é”çš„é‡è¯•æ¬¡æ•°"><a href="#å¦‚æœæ˜¯JDK8ï¼Œ-æ¨èä½¿ç”¨-LongAdder-å¯¹è±¡ï¼Œæ¯”-AtomicLong-æ€§èƒ½æ›´å¥½-å‡å°‘ä¹è§‚é”çš„é‡è¯•æ¬¡æ•°" class="headerlink" title="å¦‚æœæ˜¯JDK8ï¼Œ==æ¨èä½¿ç”¨ LongAdder å¯¹è±¡ï¼Œæ¯” AtomicLong æ€§èƒ½æ›´å¥½==(å‡å°‘ä¹è§‚é”çš„é‡è¯•æ¬¡æ•°)"></a>å¦‚æœæ˜¯JDK8ï¼Œ==æ¨èä½¿ç”¨ LongAdder å¯¹è±¡ï¼Œæ¯” AtomicLong æ€§èƒ½æ›´å¥½==(å‡å°‘ä¹è§‚é”çš„é‡è¯•æ¬¡æ•°)</h5><h6 id="åœ¨LongAdder-å’ŒAtomicLong-å®ƒä»¬åœ¨å¹¶å‘é‡ä½çš„æ—¶å€™ï¼Œæ€§èƒ½å·®ä¸äº†å¤šå°‘ã€‚ä½†åœ¨é«˜å¹¶å‘çš„æ—¶å€™ï¼ŒLongAdderçš„åŸºæœ¬æ€è·¯å°±æ˜¯åˆ†æ•£çƒ­ç‚¹ï¼Œå°†valueå€¼åˆ†æ•£åˆ°ä¸€ä¸ªCeæ•°ç»„ä¸­ï¼Œä¸åŒçº¿ç¨‹ä¼šå‘½ä¸­åˆ°æ•°ç»„çš„ä¸åŒæ§½ä¸­ï¼Œå„ä¸ªçº¿ç¨‹åªå¯¹è‡ªå·±æ§½ä¸­çš„é‚£ä¸ªå€¼è¿›è¡ŒCASæ“ä½œï¼Œè¿™æ ·çƒ­ç‚¹å°±è¢«åˆ†æ•£äº†ï¼Œå†²çªçš„æ¦‚ç‡å°±å°å¾ˆå¤šã€‚å¦‚æœè¦è·å–çœŸæ­£çš„longå€¼ï¼Œåªè¦å°†å„ä¸ªæ§½ä¸­çš„å˜é‡å€¼ç´¯åŠ è¿”å›ã€‚ï¼ˆå†…éƒ¨ä¸€ä¸ªbase-å˜é‡ï¼Œä¸€ä¸ª-cell-æ•°ç»„-ï¼šbase-æ˜¯åœ¨ä½å¹¶å‘æƒ…å†µä¸‹ï¼ŒåšCASç´¯åŠ ã€‚å¦‚æœä¸€ç›´è‡ªæ—‹å¤±è´¥çš„è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥-åˆ›å»ºCellæ•°ç»„-æ¥åˆ†æ‹…å‹åŠ›ã€‚æ¯ä¸ªcellçš„å…ƒç´ éƒ½å­˜æ”¾ä¸åŒä¸åŒçº¿ç¨‹çš„ç´¯åŠ ã€‚æœ€ç»ˆæŠŠå„ä¸ªcell-æ•°ç»„å…ƒç´ çš„é‡Œé¢çš„å€¼å’Œbase-ç›¸åŠ ã€‚æ•ˆç‡ä¼šä¸€ä¸ªbase-å¤„ç†æ•°æ®å¿«ï¼‰"><a href="#åœ¨LongAdder-å’ŒAtomicLong-å®ƒä»¬åœ¨å¹¶å‘é‡ä½çš„æ—¶å€™ï¼Œæ€§èƒ½å·®ä¸äº†å¤šå°‘ã€‚ä½†åœ¨é«˜å¹¶å‘çš„æ—¶å€™ï¼ŒLongAdderçš„åŸºæœ¬æ€è·¯å°±æ˜¯åˆ†æ•£çƒ­ç‚¹ï¼Œå°†valueå€¼åˆ†æ•£åˆ°ä¸€ä¸ªCeæ•°ç»„ä¸­ï¼Œä¸åŒçº¿ç¨‹ä¼šå‘½ä¸­åˆ°æ•°ç»„çš„ä¸åŒæ§½ä¸­ï¼Œå„ä¸ªçº¿ç¨‹åªå¯¹è‡ªå·±æ§½ä¸­çš„é‚£ä¸ªå€¼è¿›è¡ŒCASæ“ä½œï¼Œè¿™æ ·çƒ­ç‚¹å°±è¢«åˆ†æ•£äº†ï¼Œå†²çªçš„æ¦‚ç‡å°±å°å¾ˆå¤šã€‚å¦‚æœè¦è·å–çœŸæ­£çš„longå€¼ï¼Œåªè¦å°†å„ä¸ªæ§½ä¸­çš„å˜é‡å€¼ç´¯åŠ è¿”å›ã€‚ï¼ˆå†…éƒ¨ä¸€ä¸ªbase-å˜é‡ï¼Œä¸€ä¸ª-cell-æ•°ç»„-ï¼šbase-æ˜¯åœ¨ä½å¹¶å‘æƒ…å†µä¸‹ï¼ŒåšCASç´¯åŠ ã€‚å¦‚æœä¸€ç›´è‡ªæ—‹å¤±è´¥çš„è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥-åˆ›å»ºCellæ•°ç»„-æ¥åˆ†æ‹…å‹åŠ›ã€‚æ¯ä¸ªcellçš„å…ƒç´ éƒ½å­˜æ”¾ä¸åŒä¸åŒçº¿ç¨‹çš„ç´¯åŠ ã€‚æœ€ç»ˆæŠŠå„ä¸ªcell-æ•°ç»„å…ƒç´ çš„é‡Œé¢çš„å€¼å’Œbase-ç›¸åŠ ã€‚æ•ˆç‡ä¼šä¸€ä¸ªbase-å¤„ç†æ•°æ®å¿«ï¼‰" class="headerlink" title="åœ¨LongAdder å’ŒAtomicLong  å®ƒä»¬åœ¨å¹¶å‘é‡ä½çš„æ—¶å€™ï¼Œæ€§èƒ½å·®ä¸äº†å¤šå°‘ã€‚ä½†åœ¨é«˜å¹¶å‘çš„æ—¶å€™ï¼ŒLongAdderçš„åŸºæœ¬æ€è·¯å°±æ˜¯åˆ†æ•£çƒ­ç‚¹ï¼Œå°†valueå€¼åˆ†æ•£åˆ°ä¸€ä¸ªCeæ•°ç»„ä¸­ï¼Œä¸åŒçº¿ç¨‹ä¼šå‘½ä¸­åˆ°æ•°ç»„çš„ä¸åŒæ§½ä¸­ï¼Œå„ä¸ªçº¿ç¨‹åªå¯¹è‡ªå·±æ§½ä¸­çš„é‚£ä¸ªå€¼è¿›è¡ŒCASæ“ä½œï¼Œè¿™æ ·çƒ­ç‚¹å°±è¢«åˆ†æ•£äº†ï¼Œå†²çªçš„æ¦‚ç‡å°±å°å¾ˆå¤šã€‚å¦‚æœè¦è·å–çœŸæ­£çš„longå€¼ï¼Œåªè¦å°†å„ä¸ªæ§½ä¸­çš„å˜é‡å€¼ç´¯åŠ è¿”å›ã€‚ï¼ˆå†…éƒ¨ä¸€ä¸ªbase  å˜é‡ï¼Œä¸€ä¸ª cell[] æ•°ç»„   ï¼šbase æ˜¯åœ¨ä½å¹¶å‘æƒ…å†µä¸‹ï¼ŒåšCASç´¯åŠ ã€‚å¦‚æœä¸€ç›´è‡ªæ—‹å¤±è´¥çš„è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥ åˆ›å»ºCellæ•°ç»„ æ¥åˆ†æ‹…å‹åŠ›ã€‚æ¯ä¸ªcellçš„å…ƒç´ éƒ½å­˜æ”¾ä¸åŒä¸åŒçº¿ç¨‹çš„ç´¯åŠ ã€‚æœ€ç»ˆæŠŠå„ä¸ªcell æ•°ç»„å…ƒç´ çš„é‡Œé¢çš„å€¼å’Œbase ç›¸åŠ ã€‚æ•ˆç‡ä¼šä¸€ä¸ªbase å¤„ç†æ•°æ®å¿«ï¼‰"></a>åœ¨LongAdder å’ŒAtomicLong  å®ƒä»¬åœ¨å¹¶å‘é‡ä½çš„æ—¶å€™ï¼Œæ€§èƒ½å·®ä¸äº†å¤šå°‘ã€‚ä½†åœ¨é«˜å¹¶å‘çš„æ—¶å€™ï¼ŒLongAdderçš„åŸºæœ¬æ€è·¯å°±æ˜¯åˆ†æ•£çƒ­ç‚¹ï¼Œå°†valueå€¼åˆ†æ•£åˆ°ä¸€ä¸ªCeæ•°ç»„ä¸­ï¼Œä¸åŒçº¿ç¨‹ä¼šå‘½ä¸­åˆ°æ•°ç»„çš„ä¸åŒæ§½ä¸­ï¼Œå„ä¸ªçº¿ç¨‹åªå¯¹è‡ªå·±æ§½ä¸­çš„é‚£ä¸ªå€¼è¿›è¡ŒCASæ“ä½œï¼Œè¿™æ ·çƒ­ç‚¹å°±è¢«åˆ†æ•£äº†ï¼Œå†²çªçš„æ¦‚ç‡å°±å°å¾ˆå¤šã€‚å¦‚æœè¦è·å–çœŸæ­£çš„longå€¼ï¼Œåªè¦å°†å„ä¸ªæ§½ä¸­çš„å˜é‡å€¼ç´¯åŠ è¿”å›ã€‚ï¼ˆå†…éƒ¨ä¸€ä¸ªbase  å˜é‡ï¼Œä¸€ä¸ª cell[] æ•°ç»„   ï¼šbase æ˜¯åœ¨ä½å¹¶å‘æƒ…å†µä¸‹ï¼ŒåšCASç´¯åŠ ã€‚å¦‚æœä¸€ç›´è‡ªæ—‹å¤±è´¥çš„è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥ åˆ›å»ºCellæ•°ç»„ æ¥åˆ†æ‹…å‹åŠ›ã€‚æ¯ä¸ªcellçš„å…ƒç´ éƒ½å­˜æ”¾ä¸åŒä¸åŒçº¿ç¨‹çš„ç´¯åŠ ã€‚æœ€ç»ˆæŠŠå„ä¸ªcell æ•°ç»„å…ƒç´ çš„é‡Œé¢çš„å€¼å’Œbase ç›¸åŠ ã€‚æ•ˆç‡ä¼šä¸€ä¸ªbase å¤„ç†æ•°æ®å¿«ï¼‰</h6><h5 id="è¯´è¯´AtomicStampedReference-å’Œ-AtomicMarkableReference-çš„åŒºåˆ«"><a href="#è¯´è¯´AtomicStampedReference-å’Œ-AtomicMarkableReference-çš„åŒºåˆ«" class="headerlink" title="è¯´è¯´AtomicStampedReference  å’Œ AtomicMarkableReference çš„åŒºåˆ«"></a>è¯´è¯´AtomicStampedReference  å’Œ AtomicMarkableReference çš„åŒºåˆ«</h5><ul><li><p>AtomicStampedReference  è§£å†³ä¿®æ”¹çŠ¶æ€æˆ³åŸ ä¿®æ”¹å¤šæ¬¡çš„åŸå­æ›´æ–°</p></li><li><p>AtomicMarkableReference è§£å†³ä¸€æ¬¡çš„çŠ¶æ€çš„ä¿®æ”¹çš„åŸå­æ›´æ–°</p></li></ul><h3 id="TheadLocadl"><a href="#TheadLocadl" class="headerlink" title="TheadLocadl"></a>TheadLocadl</h3><h4 id="å®šä¹‰ï¼š"><a href="#å®šä¹‰ï¼š" class="headerlink" title="å®šä¹‰ï¼š"></a>å®šä¹‰ï¼š</h4><h5 id="ThreadLocalæä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚è¿™äº›å˜é‡ä¸æ­£å¸¸çš„å˜é‡ä¸åŒï¼Œå› ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®ThreadLocalå®ä¾‹çš„æ—¶å€™-é€šè¿‡å…¶getæˆ–setæ–¹æ³•-éƒ½æœ‰è‡ªå·±çš„ã€ç‹¬ç«‹åˆå§‹åŒ–çš„å˜é‡å‰¯æœ¬ã€‚ThreadLocalå®ä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„ç§æœ‰é™æ€å­—æ®µï¼Œä½¿ç”¨å®ƒçš„ç›®çš„æ˜¯å¸Œæœ›å°†çŠ¶æ€-ä¾‹å¦‚ï¼Œç”¨æˆ·IDæˆ–äº‹åŠ¡1D-ä¸çº¿ç¨‹å…³è”èµ·æ¥ã€‚"><a href="#ThreadLocalæä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚è¿™äº›å˜é‡ä¸æ­£å¸¸çš„å˜é‡ä¸åŒï¼Œå› ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®ThreadLocalå®ä¾‹çš„æ—¶å€™-é€šè¿‡å…¶getæˆ–setæ–¹æ³•-éƒ½æœ‰è‡ªå·±çš„ã€ç‹¬ç«‹åˆå§‹åŒ–çš„å˜é‡å‰¯æœ¬ã€‚ThreadLocalå®ä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„ç§æœ‰é™æ€å­—æ®µï¼Œä½¿ç”¨å®ƒçš„ç›®çš„æ˜¯å¸Œæœ›å°†çŠ¶æ€-ä¾‹å¦‚ï¼Œç”¨æˆ·IDæˆ–äº‹åŠ¡1D-ä¸çº¿ç¨‹å…³è”èµ·æ¥ã€‚" class="headerlink" title="ThreadLocalæä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚è¿™äº›å˜é‡ä¸æ­£å¸¸çš„å˜é‡ä¸åŒï¼Œå› ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®ThreadLocalå®ä¾‹çš„æ—¶å€™(é€šè¿‡å…¶getæˆ–setæ–¹æ³•)éƒ½æœ‰è‡ªå·±çš„ã€ç‹¬ç«‹åˆå§‹åŒ–çš„å˜é‡å‰¯æœ¬ã€‚ThreadLocalå®ä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„ç§æœ‰é™æ€å­—æ®µï¼Œä½¿ç”¨å®ƒçš„ç›®çš„æ˜¯å¸Œæœ›å°†çŠ¶æ€(ä¾‹å¦‚ï¼Œç”¨æˆ·IDæˆ–äº‹åŠ¡1D)ä¸çº¿ç¨‹å…³è”èµ·æ¥ã€‚"></a>ThreadLocalæä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚è¿™äº›å˜é‡ä¸æ­£å¸¸çš„å˜é‡ä¸åŒï¼Œå› ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®ThreadLocalå®ä¾‹çš„æ—¶å€™(é€šè¿‡å…¶getæˆ–setæ–¹æ³•)éƒ½æœ‰è‡ªå·±çš„ã€ç‹¬ç«‹åˆå§‹åŒ–çš„å˜é‡å‰¯æœ¬ã€‚ThreadLocalå®ä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„ç§æœ‰é™æ€å­—æ®µï¼Œä½¿ç”¨å®ƒçš„ç›®çš„æ˜¯å¸Œæœ›å°†çŠ¶æ€(ä¾‹å¦‚ï¼Œç”¨æˆ·IDæˆ–äº‹åŠ¡1D)ä¸çº¿ç¨‹å…³è”èµ·æ¥ã€‚</h5><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><h5 id="å®ç°æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ä¸“å±çš„æœ¬åœ°å˜é‡å‰¯æœ¬-è‡ªå·±ç”¨è‡ªå·±çš„å˜é‡ä¸éº»çƒ¦åˆ«äººï¼Œä¸å’Œå…¶ä»–äººå…±äº«ï¼Œäººäººæœ‰ä»½ï¼Œäººå„ä¸€ä»½-ä¸»è¦è§£å†³äº†è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œé€šè¿‡ä½¿ç”¨get0å’Œsetæ–¹æ³•ï¼Œè·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®"><a href="#å®ç°æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ä¸“å±çš„æœ¬åœ°å˜é‡å‰¯æœ¬-è‡ªå·±ç”¨è‡ªå·±çš„å˜é‡ä¸éº»çƒ¦åˆ«äººï¼Œä¸å’Œå…¶ä»–äººå…±äº«ï¼Œäººäººæœ‰ä»½ï¼Œäººå„ä¸€ä»½-ä¸»è¦è§£å†³äº†è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œé€šè¿‡ä½¿ç”¨get0å’Œsetæ–¹æ³•ï¼Œè·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®" class="headerlink" title="å®ç°æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ä¸“å±çš„æœ¬åœ°å˜é‡å‰¯æœ¬(è‡ªå·±ç”¨è‡ªå·±çš„å˜é‡ä¸éº»çƒ¦åˆ«äººï¼Œä¸å’Œå…¶ä»–äººå…±äº«ï¼Œäººäººæœ‰ä»½ï¼Œäººå„ä¸€ä»½), ä¸»è¦è§£å†³äº†è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œé€šè¿‡ä½¿ç”¨get0å’Œsetæ–¹æ³•ï¼Œè·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®"></a>å®ç°æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ä¸“å±çš„æœ¬åœ°å˜é‡å‰¯æœ¬(è‡ªå·±ç”¨è‡ªå·±çš„å˜é‡ä¸éº»çƒ¦åˆ«äººï¼Œä¸å’Œå…¶ä»–äººå…±äº«ï¼Œäººäººæœ‰ä»½ï¼Œäººå„ä¸€ä»½), ä¸»è¦è§£å†³äº†è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œé€šè¿‡ä½¿ç”¨get0å’Œsetæ–¹æ³•ï¼Œè·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®</h5><p>é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰è®²è§£çš„8é”æ¡ˆä¾‹ï¼Œèµ„æºç±»æ˜¯ä½¿ç”¨åŒä¸€éƒ¨æ‰‹æœºï¼Œå¤šä¸ªçº¿ç¨‹æŠ¢å¤ºåŒä¸€éƒ¨æ‰‹æœºä½¿ç”¨ï¼Œå‡å¦‚äººæ‰‹ä¸€ä»½æ˜¯ä¸æ˜¯å¤©ä¸‹å¤ªå¹³??</p><h5 id="ThreadLocalè€ƒç‚¹"><a href="#ThreadLocalè€ƒç‚¹" class="headerlink" title="==ThreadLocalè€ƒç‚¹=="></a>==ThreadLocalè€ƒç‚¹==</h5><h6 id="ThreadLocalä¸­ThreadLocalMapçš„æ•°æ®ç»“æ„å’Œå…³ç³»"><a href="#ThreadLocalä¸­ThreadLocalMapçš„æ•°æ®ç»“æ„å’Œå…³ç³»" class="headerlink" title="ThreadLocalä¸­ThreadLocalMapçš„æ•°æ®ç»“æ„å’Œå…³ç³»?"></a>ThreadLocalä¸­ThreadLocalMapçš„æ•°æ®ç»“æ„å’Œå…³ç³»?</h6><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">Thread é‡Œé¢çš„åŒ…å«ä¸€ä¸ªThreadLocal å¼•ç”¨  è€ŒThreadLocal é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»TheadLocadlMapã€‚ ThreadLocalä¸ºkey å­˜æ”¾åœ¨value<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h6 id="ThreadLocalçš„keyæ˜¯å¼±å¼•ç”¨ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ"><a href="#ThreadLocalçš„keyæ˜¯å¼±å¼•ç”¨ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ" class="headerlink" title="ThreadLocalçš„keyæ˜¯å¼±å¼•ç”¨ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ?"></a>ThreadLocalçš„keyæ˜¯å¼±å¼•ç”¨ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ?</h6><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">å¼±å¼•ç”¨ç›¸è¾ƒäºå‰é¢çš„å¼ºå¼•ç”¨å’Œè½¯å¼•ç”¨çš„çš„è¯ï¼Œjvm æ›´ä¼šä¸»åŠ¨å»å›æ”¶ThreadLocalMap çš„key è¿™æ ·çš„ä¸ä¼šåˆ°å¯¼è‡´å†…å­˜æ³„æ¼ã€‚å½“function1æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œæ ˆé”€æ¯å¼ºå¼•ç”¨ tl ä¹Ÿå°±æ²¡æœ‰äº†ã€‚ä½†æ­¤æ—¶çº¿ç¨‹çš„ThreadLocalMapé‡ŒæŸä¸ªentryçš„keyå¼•ç”¨è¿˜æŒ‡å‘è¿™ä¸ªå¯¹è±¡è‹¥è¿™ä¸ªkeyå¼•ç”¨æ˜¯å¼ºå¼•ç”¨ï¼Œå°±ä¼šå¯¼è‡´keyæŒ‡å‘çš„ThreadLocalå¯¹è±¡åŠvæŒ‡å‘çš„å¯¹è±¡ä¸èƒ½è¢«gcå›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼;è‹¥è¿™ä¸ªkeyå¼•ç”¨æ˜¯å¼±å¼•ç”¨å°±å¤§æ¦‚ç‡ä¼šå‡å°‘å†…å­˜æ³„æ¼çš„é—®é¢˜(è¿˜æœ‰ä¸€ä¸ªkeyä¸ºnulçš„é›·ï¼Œç¬¬2ä¸ªå‘åé¢è®²)ã€‚ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆåˆç†ï¼‰ï¼Œå°±å¯ä»¥ä½¿ThreadLocalå¯¹è±¡åœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åé¡ºåˆ©è¢«å›æ”¶ä¸”Entryçš„keyå¼•ç”¨æŒ‡å‘ä¸ºnull.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€‹    </p><h6 id="ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜ä½ çŸ¥é“å—-threadLocalä¸­æœ€åä¸ºä»€ä¹ˆè¦åŠ removeæ–¹æ³•"><a href="#ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜ä½ çŸ¥é“å—-threadLocalä¸­æœ€åä¸ºä»€ä¹ˆè¦åŠ removeæ–¹æ³•" class="headerlink" title="ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜ä½ çŸ¥é“å—? threadLocalä¸­æœ€åä¸ºä»€ä¹ˆè¦åŠ removeæ–¹æ³•?"></a>ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜ä½ çŸ¥é“å—? threadLocalä¸­æœ€åä¸ºä»€ä¹ˆè¦åŠ removeæ–¹æ³•?</h6><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">ThreadLocalè‡ªå®šä¹‰çš„å˜é‡ç”¨å®Œéœ€è¦remove æ‰  ï¼Œå‡å°‘çº¿ç¨‹çš„è´Ÿæ‹…ã€‚ç‰¹åˆ«çº¿ç¨‹æ± çš„å¤ç”¨å¯¼è‡´çº¿ç¨‹å†…å­˜æ³„æ¼ ä½¿ç”¨ä¸­ try -finallyå—å›æ”¶ã€‚ä½¿ç”¨å¼±å¼•ç”¨çš„ä¸èƒ½é¿å…ç™¾åˆ†ç™¾ï¼Œå› ä¸ºå½“ThreadLocal çš„è¢«å›æ”¶ä¹‹åï¼Œçº¿ç¨‹é‡Œé¢è¿˜æœ‰å½“key ä¸ºnull çš„valueã€‚è€Œè¿™äº›valueä¸€ç›´ThraeadLocalmapå¼ºå¼•ç”¨ï¼Œè¿™æ ·çš„jvm ä¸èƒ½å›æ”¶ã€‚å¦‚æœåœ¨çº¿ç¨‹æ± å¤ç”¨çš„å¯¼å†…å­˜æ³„æ¼ã€‚å½“ä½¿ç”¨ set æ–¹æ³•å’Œget ä»¥åŠ remove æ–¹æ³• .éƒ½ä¼šå…ˆå»åˆ¤æ–­key æ˜¯å¦ä¸ºnull ,å¦‚æœæ˜¯çš„å°±ä¼šæŠŠ keyä¸ºnullçš„value ç»™å›æ”¶ã€‚é¿å…å†…å­˜æ³„æ¼å’Œå¤ç”¨å¯¼è‡´bug æ‰‹åŠ¨removeã€€ã€€æœ‰å¿…è¦çš„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å¯¹è±¡å†…å­˜å¸ƒå±€ä¹‹å¯¹è±¡å¤´"><a href="#å¯¹è±¡å†…å­˜å¸ƒå±€ä¹‹å¯¹è±¡å¤´" class="headerlink" title="å¯¹è±¡å†…å­˜å¸ƒå±€ä¹‹å¯¹è±¡å¤´"></a>å¯¹è±¡å†…å­˜å¸ƒå±€ä¹‹å¯¹è±¡å¤´</h3><h4 id="å¯¹è±¡å¤´çš„æ„æˆ"><a href="#å¯¹è±¡å¤´çš„æ„æˆ" class="headerlink" title="å¯¹è±¡å¤´çš„æ„æˆ"></a>å¯¹è±¡å¤´çš„æ„æˆ</h4><h5 id="è¿è¡Œæ—¶å…ƒæ•°æ®-Mark-Word"><a href="#è¿è¡Œæ—¶å…ƒæ•°æ®-Mark-Word" class="headerlink" title="è¿è¡Œæ—¶å…ƒæ•°æ® (Mark Word)"></a>è¿è¡Œæ—¶å…ƒæ•°æ® (Mark Word)</h5><h6 id="å“ˆå¸Œå€¼-HashCode"><a href="#å“ˆå¸Œå€¼-HashCode" class="headerlink" title="å“ˆå¸Œå€¼ (HashCode)"></a>å“ˆå¸Œå€¼ (HashCode)</h6><h6 id="GCåˆ†ä»£å¹´é¾„"><a href="#GCåˆ†ä»£å¹´é¾„" class="headerlink" title="GCåˆ†ä»£å¹´é¾„"></a>GCåˆ†ä»£å¹´é¾„</h6><h6 id="é”çŠ¶æ€æ ‡å¿—"><a href="#é”çŠ¶æ€æ ‡å¿—" class="headerlink" title="é”çŠ¶æ€æ ‡å¿—"></a>é”çŠ¶æ€æ ‡å¿—</h6><h6 id="çº¿ç¨‹æŒæœ‰çš„é”"><a href="#çº¿ç¨‹æŒæœ‰çš„é”" class="headerlink" title="çº¿ç¨‹æŒæœ‰çš„é”"></a>çº¿ç¨‹æŒæœ‰çš„é”</h6><h6 id="åå‘çº¿ç¨‹ID"><a href="#åå‘çº¿ç¨‹ID" class="headerlink" title="åå‘çº¿ç¨‹ID"></a>åå‘çº¿ç¨‹ID</h6><h6 id="åå‘æ—¶é—´æˆ³"><a href="#åå‘æ—¶é—´æˆ³" class="headerlink" title="åå‘æ—¶é—´æˆ³"></a>åå‘æ—¶é—´æˆ³</h6><h5 id="ç±»å‹æŒ‡é’ˆä¸€ä¸€æŒ‡å‘ç±»å…ƒæ•°æ®InstanceClassï¼Œç¡®å®šè¯¥å¯¹è±¡æ‰€å±çš„ç±»å‹"><a href="#ç±»å‹æŒ‡é’ˆä¸€ä¸€æŒ‡å‘ç±»å…ƒæ•°æ®InstanceClassï¼Œç¡®å®šè¯¥å¯¹è±¡æ‰€å±çš„ç±»å‹" class="headerlink" title="ç±»å‹æŒ‡é’ˆä¸€ä¸€æŒ‡å‘ç±»å…ƒæ•°æ®InstanceClassï¼Œç¡®å®šè¯¥å¯¹è±¡æ‰€å±çš„ç±»å‹"></a>ç±»å‹æŒ‡é’ˆä¸€ä¸€æŒ‡å‘ç±»å…ƒæ•°æ®InstanceClassï¼Œç¡®å®šè¯¥å¯¹è±¡æ‰€å±çš„ç±»å‹</h5><h4 id="å®ä¾‹æ•°æ®-Instance-Data-å®ƒæ˜¯å¯¹æ€¥çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¨‹åºä»£ç ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µ-åŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œæœ¬èº«æ‹¥æœ‰çš„å­—æ®µ"><a href="#å®ä¾‹æ•°æ®-Instance-Data-å®ƒæ˜¯å¯¹æ€¥çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¨‹åºä»£ç ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µ-åŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œæœ¬èº«æ‹¥æœ‰çš„å­—æ®µ" class="headerlink" title="å®ä¾‹æ•°æ® (Instance Data) :å®ƒæ˜¯å¯¹æ€¥çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¨‹åºä»£ç ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µ(åŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œæœ¬èº«æ‹¥æœ‰çš„å­—æ®µ)"></a>å®ä¾‹æ•°æ® (Instance Data) :å®ƒæ˜¯å¯¹æ€¥çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¨‹åºä»£ç ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µ(åŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œæœ¬èº«æ‹¥æœ‰çš„å­—æ®µ)</h4><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80%E4%B9%8B%E5%AF%B9%E8%B1%A1%E5%A4%B4.png" alt="å¯¹è±¡å¤´å¸ƒå±€"></p><h3 id="é”çš„å‡çº§"><a href="#é”çš„å‡çº§" class="headerlink" title="é”çš„å‡çº§"></a>é”çš„å‡çº§</h3><h4 id="sychcornizedé”-ç”±å¯¹è±¡å¤´ä¸­çš„Mark-Wordæ ¹æ®é”æ ‡å¿—ä½çš„ä¸åŒè€Œè¢«å¤ç”¨åŠé”å‡çº§ç­–ç•¥"><a href="#sychcornizedé”-ç”±å¯¹è±¡å¤´ä¸­çš„Mark-Wordæ ¹æ®é”æ ‡å¿—ä½çš„ä¸åŒè€Œè¢«å¤ç”¨åŠé”å‡çº§ç­–ç•¥" class="headerlink" title="sychcornizedé”:ç”±å¯¹è±¡å¤´ä¸­çš„Mark Wordæ ¹æ®é”æ ‡å¿—ä½çš„ä¸åŒè€Œè¢«å¤ç”¨åŠé”å‡çº§ç­–ç•¥"></a>sychcornizedé”:ç”±å¯¹è±¡å¤´ä¸­çš„Mark Wordæ ¹æ®é”æ ‡å¿—ä½çš„ä¸åŒè€Œè¢«å¤ç”¨åŠé”å‡çº§ç­–ç•¥</h4><h4 id="é”å‡çº§çš„èƒŒæ™¯"><a href="#é”å‡çº§çš„èƒŒæ™¯" class="headerlink" title="é”å‡çº§çš„èƒŒæ™¯"></a>é”å‡çº§çš„èƒŒæ™¯</h4><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">javaçš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ï¼Œå¦‚æœè¦é˜³å¡æˆ–å”¤é†’ä¸€ä¸ªçº¿ç¨‹å°±éœ€è¦æ¢ä½œç³»ç»Ÿä»‹å…¥ï¼Œéœ€è¦åœ¨æˆ·æ€ä¸æ ¸å¿ƒæ€ä¹‹é—´åˆ‡æ¢ï¼Œè¿™ç§åˆ‡æ¢ä¼šæ¶ˆæ–™å¤§é‡çš„ç³»ç»Ÿèµ„æºï¼Œå› ä¸ºç”¨æˆ·æ€ä¸å†…æ ¸æ€éƒ½æœ‰å„è‡ªä¸“ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä¸“ç”¨çš„å¯„å­˜å™¨ç­‰ï¼Œç”¨æˆ·æ€åˆ‡æ¢è‡³å†…æ ¸æ€éœ€è¦ä¼ é€’ç»™è®¸å¤šå˜é‡ã€å‚æ•°ç»™å†…æ ¸ï¼Œå†…æ ¸ä¹Ÿéœ€è¦ä¿æŠ¤å¥½ç”¨æˆ·æ€åœ¨åˆ‡æ¢æ—¶çš„ä¸€äº›å¯„å­˜å™¨å€¼ã€å˜é‡ç­‰ï¼Œä»¥ä¾¿å†…æ ¸æ€è°ƒç”¨ç»“æŸååˆ‡æ¢å›ç”¨æˆ·æ€ç»§ç»­å·¥ä½œã€‚åœ¨Javaæ—©æœŸç‰ˆæœ¬ä¸­ï¼Œsynchronizedå±äºé‡é‡çº§é”ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºç›‘è§†å™¨é” (monitor)æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lock(ç³»ç»Ÿäº’æ–¥é‡)æ¥å®ç°çš„ï¼ŒæŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹éƒ½éœ€è¦è½¬å…¥å†…æ ¸æ€å»å®Œæˆï¼Œé˜³å¯’æˆ–å”¤é†’ä¸€ä¸ªJaaçº¿ç¨‹éœ€è¦æ¢ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€åˆ‡æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ï¼Œå¦‚æœåŒæ­¥ä»£ç å—ä¸­å†…å®¹è¿‡äºç®€å•ï¼Œè¿™ç§åˆ‡æ¢çš„æ—¶é—´å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜é•¿â€ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ—©æœŸçš„synchronizedæ•ˆç‡ä½çš„åŸå› Java 6ä¹‹åï¼Œä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”æ‰€å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†è½»é‡çº§é”å’Œåå‘é”.Monitorå¯ä»¥ç†è§£ä¸ºä¸€ç§åŒæ­¥å·¥å…·ï¼Œä¹Ÿå¯ç†è§£ä¸ºä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œå¸¸å¸¸è¢«æè¿°ä¸ºä¸€ä»·Javaå¯¹è±¡ã€‚Javaå¯¹è±¡æ˜¯å¤©ç”Ÿçš„Monitorï¼Œæ¯ä¸€ä¸ªJavaå¯¹è±¡éƒ½æœ‰æˆä¸ºMonitorçš„æ½œè´¨ï¼Œå› ä¸ºåœ¨Jvaçš„è®¾è®¡ä¸­ï¼Œæ¯ä¸€ä¸ªJavaå¯¹è±¡è‡ªæ‰“å¨˜èƒé‡Œå‡ºæ¥å°±å¸¦äº†ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼Œå®ƒå«åšå†…éƒ¨é”æˆ–è€…Monitoré”ã€‚Monitorçš„æœ¬è´¨æ˜¯ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿçš„Mutex Lockå®ç°ï¼Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢éœ€è¦ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„è½¬æ¢ï¼Œæˆæœ¬éå¸¸é«˜ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é”çš„æŒ‡å‘"><a href="#é”çš„æŒ‡å‘" class="headerlink" title="é”çš„æŒ‡å‘"></a>é”çš„æŒ‡å‘</h4><h5 id="åå‘é”-MarkWordå­˜å‚¨çš„æ˜¯åå‘çš„çº¿ç¨‹ID"><a href="#åå‘é”-MarkWordå­˜å‚¨çš„æ˜¯åå‘çš„çº¿ç¨‹ID" class="headerlink" title="åå‘é”: MarkWordå­˜å‚¨çš„æ˜¯åå‘çš„çº¿ç¨‹ID;"></a>åå‘é”: MarkWordå­˜å‚¨çš„æ˜¯åå‘çš„çº¿ç¨‹ID;</h5><h5 id="è½»é‡é”-MarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘çº¿ç¨‹æ ˆä¸­Lock-Recordçš„æŒ‡é’ˆ"><a href="#è½»é‡é”-MarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘çº¿ç¨‹æ ˆä¸­Lock-Recordçš„æŒ‡é’ˆ" class="headerlink" title="è½»é‡é”: MarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘çº¿ç¨‹æ ˆä¸­Lock Recordçš„æŒ‡é’ˆ;"></a>è½»é‡é”: MarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘çº¿ç¨‹æ ˆä¸­Lock Recordçš„æŒ‡é’ˆ;</h5><h5 id="é‡é‡é”-MarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘å †ä¸­çš„monitorå¯¹è±¡çš„æŒ‡é’ˆ"><a href="#é‡é‡é”-MarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘å †ä¸­çš„monitorå¯¹è±¡çš„æŒ‡é’ˆ" class="headerlink" title="é‡é‡é”: MarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘å †ä¸­çš„monitorå¯¹è±¡çš„æŒ‡é’ˆ;"></a>é‡é‡é”: MarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘å †ä¸­çš„monitorå¯¹è±¡çš„æŒ‡é’ˆ;</h5><h4 id="åå‘é”çš„æ’¤é”€"><a href="#åå‘é”çš„æ’¤é”€" class="headerlink" title="åå‘é”çš„æ’¤é”€"></a>åå‘é”çš„æ’¤é”€</h4><h5 id="å½“æœ‰å¦å¤–çº¿ç¨‹é€æ­¥æ¥ç«äº‰é”çš„æ—¶å€™ï¼Œå°±ä¸èƒ½å†ä½¿ç”¨åå‘é”äº†ï¼Œè¦å‡çº§ä¸ºè½»é‡çº§é”"><a href="#å½“æœ‰å¦å¤–çº¿ç¨‹é€æ­¥æ¥ç«äº‰é”çš„æ—¶å€™ï¼Œå°±ä¸èƒ½å†ä½¿ç”¨åå‘é”äº†ï¼Œè¦å‡çº§ä¸ºè½»é‡çº§é”" class="headerlink" title="å½“æœ‰å¦å¤–çº¿ç¨‹é€æ­¥æ¥ç«äº‰é”çš„æ—¶å€™ï¼Œå°±ä¸èƒ½å†ä½¿ç”¨åå‘é”äº†ï¼Œè¦å‡çº§ä¸ºè½»é‡çº§é”"></a>å½“æœ‰å¦å¤–çº¿ç¨‹é€æ­¥æ¥ç«äº‰é”çš„æ—¶å€™ï¼Œå°±ä¸èƒ½å†ä½¿ç”¨åå‘é”äº†ï¼Œè¦å‡çº§ä¸ºè½»é‡çº§é”</h5><h5 id="ç«äº‰çº¿ç¨‹å°è¯•CASæ›´æ–°å¯¹è±¡å¤´å¤±è´¥ï¼Œä¼šç­‰å¾…åˆ°å…¨å±€å®‰å…¨ç‚¹ã€Šæ­¤æ—¶ä¸ä¼šæ‰§è¡Œä»»ä½•ä»£ç -æ’¤é”€åå‘é”ã€‚"><a href="#ç«äº‰çº¿ç¨‹å°è¯•CASæ›´æ–°å¯¹è±¡å¤´å¤±è´¥ï¼Œä¼šç­‰å¾…åˆ°å…¨å±€å®‰å…¨ç‚¹ã€Šæ­¤æ—¶ä¸ä¼šæ‰§è¡Œä»»ä½•ä»£ç -æ’¤é”€åå‘é”ã€‚" class="headerlink" title="ç«äº‰çº¿ç¨‹å°è¯•CASæ›´æ–°å¯¹è±¡å¤´å¤±è´¥ï¼Œä¼šç­‰å¾…åˆ°å…¨å±€å®‰å…¨ç‚¹ã€Šæ­¤æ—¶ä¸ä¼šæ‰§è¡Œä»»ä½•ä»£ç ) æ’¤é”€åå‘é”ã€‚"></a>ç«äº‰çº¿ç¨‹å°è¯•CASæ›´æ–°å¯¹è±¡å¤´å¤±è´¥ï¼Œä¼šç­‰å¾…åˆ°å…¨å±€å®‰å…¨ç‚¹ã€Šæ­¤æ—¶ä¸ä¼šæ‰§è¡Œä»»ä½•ä»£ç ) æ’¤é”€åå‘é”ã€‚</h5><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">åå‘é”çš„æ’¤é”€()åå‘é”ä½¿ç”¨ä¸€ç§ç­‰åˆ°ç«äº‰å‡ºç°æ‰é‡Šæ”¾é”çš„æœºåˆ¶ï¼Œåªæœ‰å½“å…¶ä»–çº¿ç¨‹ç«äº‰é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„åŸæ¥çº¿ç¨‹æ‰ä¼šè¢«æ’¤é”€æ’¤é”€éœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹(è¯¥æ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œ)ï¼ŒåŒæ—¶æ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦è¿˜åœ¨æ‰§è¡Œ:1ç¬¬ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œsynchronizedæ–¹æ³•(å¤„äºåŒæ­¥å—)ï¼Œå®ƒè¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå…¶å®ƒçº¿ç¨‹æ¥æŠ¢å¤ºï¼Œè¯¥åå‘é”ä¼šè¢«å–æ¶ˆæ‰å¹¶å‡ºç°é”å‡çº§æ­¤æ—¶è½»é‡çº§é”ç”±åŸæŒæœ‰åå‘é”çš„çº¿ç¨‹æŒæœ‰ï¼Œç»§ç»­æ‰§è¡Œå…¶åŒæ­¥ä»£ç ï¼Œè€Œæ­£åœ¨ç«äº‰çš„çº¿ç¨‹ä¼šè¿›å…¥è‡ªæ—‹ç­‰å¾…è·å¾—è¯¥è½»é‡çº§é”ã€‚2ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆsynchronizedæ–¹æ³•(é€€å‡ºåŒæ­¥å—)ï¼Œåˆ™å°†å¯¹è±¡å¤´è®¾ç½®æˆæ— é”çŠ¶æ€å¹¶æ’¤é”€åå‘é”ï¼Œé‡æ–°åå‘ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è½»é‡é”-1"><a href="#è½»é‡é”-1" class="headerlink" title="è½»é‡é”"></a>è½»é‡é”</h4><h5 id="è½»é‡çº§é”çš„åŠ é”"><a href="#è½»é‡çº§é”çš„åŠ é”" class="headerlink" title="è½»é‡çº§é”çš„åŠ é”"></a>è½»é‡çº§é”çš„åŠ é”</h5><h6 id="JVMä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åœ¨å½“å‰çº¿ç¨‹çš„é¾™ä¸­åˆ›å¾‹ç”¨åƒå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå®˜æ–¹æˆä¸ºDisplaced-Mark-wrdã€‚è‹¥ä¸€ä¸ªçº¿ç¨‹è·å¾—é”æ—¶å‘ç°æ˜¯é‡çº§é”ï¼Œä¼šæŠŠé”çš„MarkWordå¤åˆ¶åˆ°è‡ªå·±çš„Displaced-Mark-Wordé‡Œé¢ã€‚ç„¶åçº¿ç¨‹å°è¯•ç”¨CASå°†é”çš„MarkWordæ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºMark-Wordå·²ç»è¢«æ›¿æ¢æˆäº†å…¶ä»–çº¿ç¨‹çš„é”è®°å½•ï¼Œè¯´æ˜åœ¨ä¸å…¶å®ƒçº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰ç¨‹å°±å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚"><a href="#JVMä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åœ¨å½“å‰çº¿ç¨‹çš„é¾™ä¸­åˆ›å¾‹ç”¨åƒå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå®˜æ–¹æˆä¸ºDisplaced-Mark-wrdã€‚è‹¥ä¸€ä¸ªçº¿ç¨‹è·å¾—é”æ—¶å‘ç°æ˜¯é‡çº§é”ï¼Œä¼šæŠŠé”çš„MarkWordå¤åˆ¶åˆ°è‡ªå·±çš„Displaced-Mark-Wordé‡Œé¢ã€‚ç„¶åçº¿ç¨‹å°è¯•ç”¨CASå°†é”çš„MarkWordæ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºMark-Wordå·²ç»è¢«æ›¿æ¢æˆäº†å…¶ä»–çº¿ç¨‹çš„é”è®°å½•ï¼Œè¯´æ˜åœ¨ä¸å…¶å®ƒçº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰ç¨‹å°±å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚" class="headerlink" title="JVMä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åœ¨å½“å‰çº¿ç¨‹çš„é¾™ä¸­åˆ›å¾‹ç”¨åƒå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå®˜æ–¹æˆä¸ºDisplaced Mark wrdã€‚è‹¥ä¸€ä¸ªçº¿ç¨‹è·å¾—é”æ—¶å‘ç°æ˜¯é‡çº§é”ï¼Œä¼šæŠŠé”çš„MarkWordå¤åˆ¶åˆ°è‡ªå·±çš„Displaced Mark Wordé‡Œé¢ã€‚ç„¶åçº¿ç¨‹å°è¯•ç”¨CASå°†é”çš„MarkWordæ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºMark Wordå·²ç»è¢«æ›¿æ¢æˆäº†å…¶ä»–çº¿ç¨‹çš„é”è®°å½•ï¼Œè¯´æ˜åœ¨ä¸å…¶å®ƒçº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰ç¨‹å°±å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚"></a>JVMä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åœ¨å½“å‰çº¿ç¨‹çš„é¾™ä¸­åˆ›å¾‹ç”¨åƒå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå®˜æ–¹æˆä¸ºDisplaced Mark wrdã€‚è‹¥ä¸€ä¸ªçº¿ç¨‹è·å¾—é”æ—¶å‘ç°æ˜¯é‡çº§é”ï¼Œä¼šæŠŠé”çš„MarkWordå¤åˆ¶åˆ°è‡ªå·±çš„Displaced Mark Wordé‡Œé¢ã€‚ç„¶åçº¿ç¨‹å°è¯•ç”¨CASå°†é”çš„MarkWordæ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„é’ˆã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºMark Wordå·²ç»è¢«æ›¿æ¢æˆäº†å…¶ä»–çº¿ç¨‹çš„é”è®°å½•ï¼Œè¯´æ˜åœ¨ä¸å…¶å®ƒçº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰ç¨‹å°±å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚</h6><h6 id="è‡ªæ—‹CAS-ä¸æ–­å°è¯•å»è·å–é”ï¼Œèƒ½ä¸å‡çº§å°±ä¸å¾€ä¸Šæ…ï¼Œå°½é‡ä¸è¦é˜»å¡"><a href="#è‡ªæ—‹CAS-ä¸æ–­å°è¯•å»è·å–é”ï¼Œèƒ½ä¸å‡çº§å°±ä¸å¾€ä¸Šæ…ï¼Œå°½é‡ä¸è¦é˜»å¡" class="headerlink" title="è‡ªæ—‹CAS:ä¸æ–­å°è¯•å»è·å–é”ï¼Œèƒ½ä¸å‡çº§å°±ä¸å¾€ä¸Šæ…ï¼Œå°½é‡ä¸è¦é˜»å¡"></a>è‡ªæ—‹CAS:ä¸æ–­å°è¯•å»è·å–é”ï¼Œèƒ½ä¸å‡çº§å°±ä¸å¾€ä¸Šæ…ï¼Œå°½é‡ä¸è¦é˜»å¡</h6><h5 id="è½»é‡çº§é”çš„é‡Šæ”¾"><a href="#è½»é‡çº§é”çš„é‡Šæ”¾" class="headerlink" title="è½»é‡çº§é”çš„é‡Šæ”¾"></a>è½»é‡çº§é”çš„é‡Šæ”¾</h5><h6 id="åœ¨é‡Šæ”¾é”æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šä½¿ç”¨CASæ“ä½œå°†Displaced-Mak-Wordçš„å†…å®¹å¤åˆ¶å›é”çš„Mark-Wordé‡Œé¢ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿç«äº‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤åˆ¶çš„æ“ä½œä¼šæˆåŠŸã€‚å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹å› ä¸ºç™½æ—‹å¤šæ¬¡å¯¼è‡´è½»é‡çº§é”å‡çº§æˆäº†é‡é‡çº§é”ï¼Œé‚£ä¹ˆCASæ“ä½œä¼šå¤±è´¥ï¼Œæ­¤æ—¶ä¼šé‡Šæ”¾é”å¹¶å”¤é†’è¢«é˜³çš„çº¿ç¨‹ã€‚"><a href="#åœ¨é‡Šæ”¾é”æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šä½¿ç”¨CASæ“ä½œå°†Displaced-Mak-Wordçš„å†…å®¹å¤åˆ¶å›é”çš„Mark-Wordé‡Œé¢ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿç«äº‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤åˆ¶çš„æ“ä½œä¼šæˆåŠŸã€‚å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹å› ä¸ºç™½æ—‹å¤šæ¬¡å¯¼è‡´è½»é‡çº§é”å‡çº§æˆäº†é‡é‡çº§é”ï¼Œé‚£ä¹ˆCASæ“ä½œä¼šå¤±è´¥ï¼Œæ­¤æ—¶ä¼šé‡Šæ”¾é”å¹¶å”¤é†’è¢«é˜³çš„çº¿ç¨‹ã€‚" class="headerlink" title="åœ¨é‡Šæ”¾é”æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šä½¿ç”¨CASæ“ä½œå°†Displaced Mak Wordçš„å†…å®¹å¤åˆ¶å›é”çš„Mark Wordé‡Œé¢ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿç«äº‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤åˆ¶çš„æ“ä½œä¼šæˆåŠŸã€‚å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹å› ä¸ºç™½æ—‹å¤šæ¬¡å¯¼è‡´è½»é‡çº§é”å‡çº§æˆäº†é‡é‡çº§é”ï¼Œé‚£ä¹ˆCASæ“ä½œä¼šå¤±è´¥ï¼Œæ­¤æ—¶ä¼šé‡Šæ”¾é”å¹¶å”¤é†’è¢«é˜³çš„çº¿ç¨‹ã€‚"></a>åœ¨é‡Šæ”¾é”æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šä½¿ç”¨CASæ“ä½œå°†Displaced Mak Wordçš„å†…å®¹å¤åˆ¶å›é”çš„Mark Wordé‡Œé¢ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿç«äº‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤åˆ¶çš„æ“ä½œä¼šæˆåŠŸã€‚å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹å› ä¸ºç™½æ—‹å¤šæ¬¡å¯¼è‡´è½»é‡çº§é”å‡çº§æˆäº†é‡é‡çº§é”ï¼Œé‚£ä¹ˆCASæ“ä½œä¼šå¤±è´¥ï¼Œæ­¤æ—¶ä¼šé‡Šæ”¾é”å¹¶å”¤é†’è¢«é˜³çš„çº¿ç¨‹ã€‚</h6><h4 id="é‡é‡çº§é”-1"><a href="#é‡é‡çº§é”-1" class="headerlink" title="é‡é‡çº§é”"></a>é‡é‡çº§é”</h4><h5 id="é‡é‡çº§é”åŸç†-1"><a href="#é‡é‡çº§é”åŸç†-1" class="headerlink" title="é‡é‡çº§é”åŸç†"></a>é‡é‡çº§é”åŸç†</h5><h6 id="æŒ‡å‘äº’æ–¥é‡-é‡é‡çº§é”-çš„æŒ‡é’ˆ-1"><a href="#æŒ‡å‘äº’æ–¥é‡-é‡é‡çº§é”-çš„æŒ‡é’ˆ-1" class="headerlink" title="æŒ‡å‘äº’æ–¥é‡ (é‡é‡çº§é”)çš„æŒ‡é’ˆ"></a>æŒ‡å‘äº’æ–¥é‡ (é‡é‡çº§é”)çš„æŒ‡é’ˆ</h6><p>Javaä¸­synchronizedçš„é‡é‡çº§é”ï¼Œæ˜¯åŸºäºè¿›å…¥å’Œé€€å‡ºMonitorå¯¹è±¡å®ç°çš„ã€‚åœ¨ç¼–è¯‘æ—¶ä¼šå°†åŒæ­¥å—çš„å¼€å§‹ä½ç½®æ’å…¥monitor enteræŒ‡ä»¤ï¼Œåœ¨ç»“æŸä½ç½®æ’å…¥monitor exitæŒ‡ä»¤ã€‚<br>å½“çº¿ç¨‹æ‰§è¡Œåˆ°monitor enteræŒ‡ä»¤æ—¶ï¼Œä¼šå°è¯•è·å–å¯¹è±¡æ‰€å¯¹åº”çš„Monitoræ‰€æœ‰æƒï¼Œå¦‚æœè·å–åˆ°äº†ï¼Œå³è·å–åˆ°äº†é”ï¼Œä¼šåœ¨Monitorçš„ownerä¸­å­˜æ”¾å½“å‰çº¿ç¨‹çš„idï¼Œè¿™æ ·å®ƒå°†å¤„äºé”å®šçŠ¶æ€ï¼Œé™¤éé€€å‡ºåŒæ­¥å—ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹æ— æ³•è·å–åˆ°è¿™ä¸ªMonitorã€‚</p><h4 id="é”å‡çº§çš„æ€»ç»“"><a href="#é”å‡çº§çš„æ€»ç»“" class="headerlink" title="é”å‡çº§çš„æ€»ç»“"></a>é”å‡çº§çš„æ€»ç»“</h4><ul><li>==åœ¨æ— é”çŠ¶æ€ä¸‹==ï¼ŒMark Wordä¸­å¯ä»¥å­˜å‚¨å¯¹è±¡çš„identity hash codeå€¼ã€‚å½“å¯¹è±¡çš„hashCode0)æ–¹æ³•ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ï¼ŒJVMä¼šç”Ÿæˆå¯¹åº”çš„dentity hash codeå€¼å¹¶å°†è¯¥å€¼å­˜å‚¨åˆ°Mark Wordä¸­ã€‚</li><li>==å¯¹å¹²åç™½é”==ï¼Œåœ¨çº¿ç¨‹è·å–åå‘é”æ—¶ï¼Œä¼šç”¨Thread IDå’Œepochå€¼è¦†ç›–identity hash codeæ‰€åœ¨çš„ä½ç½®ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡çš„hashCode0)æ–¹æ³•å·²ç»è¢«è°ƒç”¨è¿‡ä¸€æ¬¡ä¹‹åï¼Œè¿™ä¸ªå¯¹è±¡ä¸èƒ½è¢«è®¾ç½®åå‘é”ã€‚å› ä¸ºå¦‚æœå¯ä»¥çš„åŒ–ï¼Œé‚£Mark Wordä¸­çš„identity hash codeå¿…ç„¶ä¼šè¢«åå‘çº¿ç¨‹idç»™è¦†ç›–ï¼Œè¿™å°±ä¼šé€ æˆåŒä¸€ä¸ªå¯¹è±¡å‰åä¸¤æ¬¡è°ƒç”¨hashCode()æ–¹æ³•å¾—åˆ°çš„ç»“æœä¸ä¸€è‡´ã€‚</li><li>==å‡çº§ä¸ºè½»é‡çº§é”æ—¶==ï¼ŒJVMä¼šåœ¨å½“å‰çº¿ç¨‹çš„æ ˆé¡ºä¸­åˆ›å¾‹ä¸€ä¸ªé”è®°å½•Lock Record)ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡çš„Mark Wordæ‹·è´ï¼Œè¯¥æ®è´ä¸­å¯ä»¥åŒ…å«identity hash codeï¼Œæ‰€ä»¥è½»é‡çº§é”å¯ä»¥å’Œidentity hash codeå…±å­˜ï¼Œå“ˆå¸Œç å’ŒGCå¹´é¾„è‡ªç„¶ä¿å­˜åœ¨æ­¤ï¼Œé‡Šæ”¾é”åä¼šå°†è¿™äº›ä¿¡æ¯å†™å›åˆ°å¯¹è±¡å¤´ã€‚</li><li>==å‡çº§ä¸ºé‡é‡çº§é”å==ï¼ŒMark Wordä¿å­˜çš„é‡é‡çº§é”æŒ‡é’ˆï¼Œä»£è¡¨é‡é‡çº§é”çš„bjectMonitorç±»é‡Œæœ‰å­—æ®µè®°å½•éåŠ é”çŠ¶æ€ä¸‹çš„Mark Wordï¼Œé”é‡Šæ”¾åä¹Ÿä¼šå°†ä¿¡æ¯å†™å›åˆ°å¯¹è±¡å¤´ã€‚</li></ul><h3 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h3><h4 id="-1"><a href="#-1" class="headerlink" title=""></a></h4><p>æ—¢ç„¶è¯´åˆ°äº†æ’é˜Ÿç­‰å€™æœºåˆ¶ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¼šæœ‰æŸç§é˜Ÿåˆ—å½¢æˆï¼Œè¿™æ ·çš„é˜Ÿåˆ—æ˜¯ä»€ä¹ˆæ•°æ®ç»“æ„å‘¢?<br>å¦‚æœå…±äº«èµ„æºè¢«å ç”¨ï¼Œå°±éœ€è¦ä¸€å®šçš„é˜»å¡ç­‰å¾…å”¤é†’æœºåˆ¶æ¥ä¿è¯é”åˆ†é…ã€‚è¿™ä¸ªæœºåˆ¶ä¸»è¦ç”¨çš„æ˜¯CLHé˜Ÿåˆ—çš„å˜ä½“å®ç°çš„ï¼Œå°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°±æ˜¯AQSåŒæ­¥é˜Ÿåˆ—çš„æŠ½è±¡è¡¨ç°ã€‚å®ƒå°†è¦è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹åŠè‡ªèº«çš„ç­‰å¾…çŠ¶æ€å°è£…æˆé˜Ÿåˆ—çš„ç»“ç‚¹å¯¹è±¡(Node)ï¼Œé€šè¿‡<br>CASã€è‡ªæ—‹ä»¥åŠLockSupport.park0)çš„æ–¹å¼ï¼Œç»´æŠ¤tateå˜é‡çš„çŠ¶æ€ï¼Œä½¿å¹¶å‘è¾¾åˆ°åŒæ­¥çš„æ•ˆæœã€‚</p><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><h5 id="AQSä½¿ç”¨ä¸€ä¸ªvolatieçš„intç±»å‹çš„æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çš„æ’é˜Ÿå·¥ä½œå°†æ¯æ¡è¦å»æŠ¢å èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªNodeèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ï¼Œé€šè¿‡CASå®Œæˆå¯¹Stateå€¼çš„ä¿®æ”¹"><a href="#AQSä½¿ç”¨ä¸€ä¸ªvolatieçš„intç±»å‹çš„æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çš„æ’é˜Ÿå·¥ä½œå°†æ¯æ¡è¦å»æŠ¢å èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªNodeèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ï¼Œé€šè¿‡CASå®Œæˆå¯¹Stateå€¼çš„ä¿®æ”¹" class="headerlink" title="AQSä½¿ç”¨ä¸€ä¸ªvolatieçš„intç±»å‹çš„æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çš„æ’é˜Ÿå·¥ä½œå°†æ¯æ¡è¦å»æŠ¢å èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªNodeèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ï¼Œé€šè¿‡CASå®Œæˆå¯¹Stateå€¼çš„ä¿®æ”¹"></a>AQSä½¿ç”¨ä¸€ä¸ªvolatieçš„intç±»å‹çš„æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çš„æ’é˜Ÿå·¥ä½œå°†æ¯æ¡è¦å»æŠ¢å èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªNodeèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ï¼Œé€šè¿‡CASå®Œæˆå¯¹Stateå€¼çš„ä¿®æ”¹</h5><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/%E7%B1%BB%E7%9A%84%E5%85%B3%E7%B3%BB.png" alt="ç±»çš„å…³ç³»"></p><p><img src="https://v1.mykkto.cn/image/blog/2023/specialcolumn/yjc/reentranLock%E6%BA%90%E7%A0%81%E4%B9%8BAQS.png"></p><p>AQS(AbstractQueuedSynchronizer)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">   <span class="token keyword">abstract</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Sync</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueuedSynchronizer</span>         <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">NonfairSync</span> <span class="token keyword">extends</span> <span class="token class-name">Sync</span><span class="token comment">//éå…¬å¹³</span>         <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">FairSync</span> <span class="token keyword">extends</span> <span class="token class-name">Sync</span>   <span class="token comment">//å…¬å¹³</span>                      <span class="token comment">//ä»¥éå…¬å¹³ä¸ºä¾‹å­è·Ÿè¸ª</span>        <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//è‡ªæ—‹ä¿®æ”¹çŠ¶æ€</span>                     <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æŠŠå½“å‰é”çš„æŒæœ‰åˆ™</span>            <span class="token keyword">else</span>                <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>ç¬¬ä¸€éƒ¨åˆ†<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token comment">/** 1å°è¯•åŠ é” 2åŠ é”å¤±è´¥çº¿ç¨‹å…¥é˜Ÿ3çº¿ç¨‹å…¥é˜Ÿåï¼Œçº¿ç¨‹è¿›å…¥é˜»å¡*/</span> <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>            <span class="token function">acquireQueued</span><span class="token punctuation">(</span><span class="token function">addWaiter</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token punctuation">.</span>EXCLUSIVE<span class="token punctuation">)</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token function">selfInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">//å…·ä½“çš„å­ç±»å®ç°NonfairSync</span>        <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">nonfairTryAcquire</span><span class="token punctuation">(</span>acquires<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token comment">/***æƒ…å†µä¸€ æŸ¥çœ‹å½“å‰çŠ¶æ€æ˜¯å¦ç­‰äº0ï¼Œå¦‚æœæ˜¯å°±è¿›å…¥è‡ªæ—‹å°è¯•ä¿®æ”¹çŠ¶æ€ï¼Œå¹¶æŠŠå½“å‰çº¿ç¨‹ è®¾ç½®é”çš„æ‹¥æœ‰è€…ã€‚è¿”å›true,å½“å‰çº¿ç¨‹çš„æ˜¯å¦å’Œé”çš„æŒæœ‰è€…ä¸€åŒä¸€çº¿ç¨‹ï¼Œæ˜¯å°±æ›´æ”¹é”çš„çŠ¶æ€ï¼Œ*/</span>     <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">nonfairTryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">final</span> <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> acquires<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">==</span> <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> nextc <span class="token operator">=</span> c <span class="token operator">+</span> acquires<span class="token punctuation">;</span> <span class="token comment">//æ›´æ–°é”çš„çŠ¶æ€</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>nextc <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// overflow</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Maximum lock count exceeded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">setState</span><span class="token punctuation">(</span>nextc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>ç¬¬äºŒéƒ¨åˆ†<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token comment">//åŠ å…¥å¯¹è±¡ç­‰</span>    <span class="token keyword">private</span> <span class="token class-name">Node</span> <span class="token function">addWaiter</span><span class="token punctuation">(</span><span class="token class-name">Node</span> mode<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Node</span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Try the fast path of enq; backup to full enq on failure</span>        <span class="token class-name">Node</span> pred <span class="token operator">=</span> tail<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>pred <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//ä¸æ˜¯ç¬¬ä¸€åˆ›å»ºé˜Ÿåˆ—ï¼Œåç»­çš„èŠ‚ç‚¹è¿›æ¥ç›´æ¥å°±æ·»åŠ çš„åŒç«¯é˜Ÿåˆ—çš„æœ«å°¾</span>            node<span class="token punctuation">.</span>prev <span class="token operator">=</span> pred<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetTail</span><span class="token punctuation">(</span>pred<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                 pred<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span>                <span class="token keyword">return</span> node<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token function">enq</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//å…¥é˜Ÿï¼Œé˜Ÿåˆ—åˆå§‹åŒ–</span>        <span class="token keyword">return</span> node<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">//  ç¬¬ä¸€è¿›å…¥é˜Ÿåˆ—çš„</span> <span class="token keyword">private</span> <span class="token class-name">Node</span> <span class="token function">enq</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Node</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">Node</span> t <span class="token operator">=</span> tail<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Must initialize</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetHead</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹é¦–å°¾ç›¸è¿  //è‡ªæ—‹</span>                    tail <span class="token operator">=</span> head<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                node<span class="token punctuation">.</span>prev <span class="token operator">=</span> t<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetTail</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// //è‡ªæ—‹</span>                    t<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span>  <span class="token comment">//æŠŠåˆšè¿›æ¥çš„èŠ‚ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ—</span>                    <span class="token keyword">return</span> t<span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token comment">//å°è¯•è·å¾—é”ï¼Œæ²¡æœ‰è·å¾—å°±é˜»å¡ç­‰å¾…å”¤é†’</span><span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">acquireQueued</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Node</span> node<span class="token punctuation">,</span> <span class="token keyword">int</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">boolean</span> failed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">boolean</span> interrupted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">final</span> <span class="token class-name">Node</span> p <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">predecessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> head <span class="token operator">&amp;&amp;</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token function">setHead</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>                    p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// help GC</span>                    failed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span> interrupted<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldParkAfterFailedAcquire</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>                    <span class="token function">parkAndCheckInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    interrupted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>failed<span class="token punctuation">)</span>                <span class="token function">cancelAcquire</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token comment">//ç­‰å¾…å”¤é†’ä¹‹å‰ä¿®æ”¹èŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">shouldParkAfterFailedAcquire</span><span class="token punctuation">(</span><span class="token class-name">Node</span> pred<span class="token punctuation">,</span> <span class="token class-name">Node</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> ws <span class="token operator">=</span> pred<span class="token punctuation">.</span>waitStatus<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ws <span class="token operator">==</span> <span class="token class-name">Node</span><span class="token punctuation">.</span>SIGNAL<span class="token punctuation">)</span>                       <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ws <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                       <span class="token keyword">do</span> <span class="token punctuation">{</span>                node<span class="token punctuation">.</span>prev <span class="token operator">=</span> pred <span class="token operator">=</span> pred<span class="token punctuation">.</span>prev<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>pred<span class="token punctuation">.</span>waitStatus <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            pred<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token function">compareAndSetWaitStatus</span><span class="token punctuation">(</span>pred<span class="token punctuation">,</span> ws<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token punctuation">.</span>SIGNAL<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">//çº¿ç¨‹é˜»å¡ ä¸­æ–­æœºåˆ¶</span> <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">parkAndCheckInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é˜»å¡</span>        <span class="token keyword">return</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä¸­æ–­æ ‡å¿—è·å¾—é”çš„çº¿ç¨‹æ ‡å¿—ï¼Œåå•†ã€‚éœ€è¦è·å¾—é”è‡ªè¡Œå†³å®šæ˜¯å¦æ˜¯å¦</span>    <span class="token punctuation">}</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>ç¬¬ä¸‰éƒ¨åˆ†<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>    <span class="token comment">/***    å–æ¶ˆç­‰å¾…        */</span>     <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">cancelAcquire</span><span class="token punctuation">(</span><span class="token class-name">Node</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// Ignore if node doesn't exist</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        node<span class="token punctuation">.</span>thread <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token class-name">Node</span> pred <span class="token operator">=</span> node<span class="token punctuation">.</span>prev<span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>pred<span class="token punctuation">.</span>waitStatus <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>            node<span class="token punctuation">.</span>prev <span class="token operator">=</span> pred <span class="token operator">=</span> pred<span class="token punctuation">.</span>prev<span class="token punctuation">;</span> <span class="token comment">//ç§»é™¤èŠ‚ç‚¹</span>        <span class="token class-name">Node</span> predNext <span class="token operator">=</span> pred<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        node<span class="token punctuation">.</span>waitStatus <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token punctuation">.</span>CANCELLED<span class="token punctuation">;</span>             <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> tail <span class="token operator">&amp;&amp;</span> <span class="token function">compareAndSetTail</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> pred<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//å°è¯•ä¿®æ”¹å½“å‰çš„çš„å°¾éƒ¨</span>            <span class="token function">compareAndSetNext</span><span class="token punctuation">(</span>pred<span class="token punctuation">,</span> predNext<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                   <span class="token keyword">int</span> ws<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>pred <span class="token operator">!=</span> head <span class="token operator">&amp;&amp;</span>                <span class="token punctuation">(</span><span class="token punctuation">(</span>ws <span class="token operator">=</span> pred<span class="token punctuation">.</span>waitStatus<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Node</span><span class="token punctuation">.</span>SIGNAL <span class="token operator">||</span>                 <span class="token punctuation">(</span>ws <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">compareAndSetWaitStatus</span><span class="token punctuation">(</span>pred<span class="token punctuation">,</span> ws<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token punctuation">.</span>SIGNAL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">//ä¿®æ”¹ å‰é¢èŠ‚ç‚¹å”¤é†’çŠ¶æ€</span>                pred<span class="token punctuation">.</span>thread <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">Node</span> next <span class="token operator">=</span> node<span class="token punctuation">.</span>next<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> next<span class="token punctuation">.</span>waitStatus <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>                    <span class="token function">compareAndSetNext</span><span class="token punctuation">(</span>pred<span class="token punctuation">,</span> predNext<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token function">unparkSuccessor</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è·å¾—é‡Šæ”¾é”å¹¶æ”¹å˜status çš„çŠ¶æ€</span>            <span class="token punctuation">}</span>            node<span class="token punctuation">.</span>next <span class="token operator">=</span> node<span class="token punctuation">;</span> <span class="token comment">// help GC</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">unparkSuccessor</span><span class="token punctuation">(</span><span class="token class-name">Node</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> ws <span class="token operator">=</span> node<span class="token punctuation">.</span>waitStatus<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ws <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token function">compareAndSetWaitStatus</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> ws<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//CAS ä¿®æ”¹å€¼</span>               <span class="token class-name">Node</span> s <span class="token operator">=</span> node<span class="token punctuation">.</span>next<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> s<span class="token punctuation">.</span>waitStatus <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            s <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span> t <span class="token operator">=</span> tail<span class="token punctuation">;</span> t <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> t <span class="token operator">!=</span> node<span class="token punctuation">;</span> t <span class="token operator">=</span> t<span class="token punctuation">.</span>prev<span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>waitStatus <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>                    s <span class="token operator">=</span> t<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>            <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è§£é”</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="AQSå®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼ï¼šExclusiveï¼ˆç‹¬å ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLockï¼‰å’ŒShareï¼ˆå…±äº«ï¼Œå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚Semaphore-CountDownLatchï¼‰"><a href="#AQSå®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼ï¼šExclusiveï¼ˆç‹¬å ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLockï¼‰å’ŒShareï¼ˆå…±äº«ï¼Œå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚Semaphore-CountDownLatchï¼‰" class="headerlink" title="AQSå®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼ï¼šExclusiveï¼ˆç‹¬å ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLockï¼‰å’ŒShareï¼ˆå…±äº«ï¼Œå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚Semaphore/CountDownLatchï¼‰"></a>AQSå®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼ï¼šExclusiveï¼ˆç‹¬å ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLockï¼‰å’ŒShareï¼ˆå…±äº«ï¼Œå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚Semaphore/CountDownLatchï¼‰</h4><h4 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h4><h5 id="transient-volatile-Node-head"><a href="#transient-volatile-Node-head" class="headerlink" title="transient volatile Node head"></a>transient volatile Node head</h5><h6 id="waiteré˜Ÿåˆ—çš„å¤´ï¼Œåˆšå¼€å§‹æ—¶æ˜¯ä¸€ä¸ªå•¥éƒ½æ²¡æœ‰çš„ç»“ç‚¹ï¼Œåé¢è§£é”ä¸€ä¸ªå»æ‰ä¸€ä¸ª"><a href="#waiteré˜Ÿåˆ—çš„å¤´ï¼Œåˆšå¼€å§‹æ—¶æ˜¯ä¸€ä¸ªå•¥éƒ½æ²¡æœ‰çš„ç»“ç‚¹ï¼Œåé¢è§£é”ä¸€ä¸ªå»æ‰ä¸€ä¸ª" class="headerlink" title="waiteré˜Ÿåˆ—çš„å¤´ï¼Œåˆšå¼€å§‹æ—¶æ˜¯ä¸€ä¸ªå•¥éƒ½æ²¡æœ‰çš„ç»“ç‚¹ï¼Œåé¢è§£é”ä¸€ä¸ªå»æ‰ä¸€ä¸ª"></a>waiteré˜Ÿåˆ—çš„å¤´ï¼Œåˆšå¼€å§‹æ—¶æ˜¯ä¸€ä¸ªå•¥éƒ½æ²¡æœ‰çš„ç»“ç‚¹ï¼Œåé¢è§£é”ä¸€ä¸ªå»æ‰ä¸€ä¸ª</h6><h5 id="transient-volatile-Node-tail"><a href="#transient-volatile-Node-tail" class="headerlink" title="transient volatile Node tail"></a>transient volatile Node tail</h5><h6 id="waiteré˜Ÿåˆ—çš„å°¾ï¼Œç¬¬ä¸€æ¬¡ä¸Šé”æ²¡é”ä¸Šçš„å¾€åè¾¹æ’ï¼Œæ¯å½“ä¸€ä¸ªå€’éœ‰è›‹æ²¡æœ‰è·å¾—é”ï¼Œå°±åŠ å…¥é˜Ÿåˆ—"><a href="#waiteré˜Ÿåˆ—çš„å°¾ï¼Œç¬¬ä¸€æ¬¡ä¸Šé”æ²¡é”ä¸Šçš„å¾€åè¾¹æ’ï¼Œæ¯å½“ä¸€ä¸ªå€’éœ‰è›‹æ²¡æœ‰è·å¾—é”ï¼Œå°±åŠ å…¥é˜Ÿåˆ—" class="headerlink" title="waiteré˜Ÿåˆ—çš„å°¾ï¼Œç¬¬ä¸€æ¬¡ä¸Šé”æ²¡é”ä¸Šçš„å¾€åè¾¹æ’ï¼Œæ¯å½“ä¸€ä¸ªå€’éœ‰è›‹æ²¡æœ‰è·å¾—é”ï¼Œå°±åŠ å…¥é˜Ÿåˆ—"></a>waiteré˜Ÿåˆ—çš„å°¾ï¼Œç¬¬ä¸€æ¬¡ä¸Šé”æ²¡é”ä¸Šçš„å¾€åè¾¹æ’ï¼Œæ¯å½“ä¸€ä¸ªå€’éœ‰è›‹æ²¡æœ‰è·å¾—é”ï¼Œå°±åŠ å…¥é˜Ÿåˆ—</h6><h5 id="volatile-int-state"><a href="#volatile-int-state" class="headerlink" title="volatile int state"></a>volatile int state</h5><h6 id="ä¸åŒçš„è‡ªå®šä¹‰åŒæ­¥å™¨äº‰ç”¨å…±äº«èµ„æºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚è‡ªå®šä¹‰åŒæ­¥å™¨åœ¨å®ç°æ—¶åªéœ€è¦å®ç°å…±äº«èµ„æºstateçš„è·å–ä¸é‡Šæ”¾æ–¹å¼å³å¯"><a href="#ä¸åŒçš„è‡ªå®šä¹‰åŒæ­¥å™¨äº‰ç”¨å…±äº«èµ„æºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚è‡ªå®šä¹‰åŒæ­¥å™¨åœ¨å®ç°æ—¶åªéœ€è¦å®ç°å…±äº«èµ„æºstateçš„è·å–ä¸é‡Šæ”¾æ–¹å¼å³å¯" class="headerlink" title="ä¸åŒçš„è‡ªå®šä¹‰åŒæ­¥å™¨äº‰ç”¨å…±äº«èµ„æºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚è‡ªå®šä¹‰åŒæ­¥å™¨åœ¨å®ç°æ—¶åªéœ€è¦å®ç°å…±äº«èµ„æºstateçš„è·å–ä¸é‡Šæ”¾æ–¹å¼å³å¯"></a>ä¸åŒçš„è‡ªå®šä¹‰åŒæ­¥å™¨äº‰ç”¨å…±äº«èµ„æºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚è‡ªå®šä¹‰åŒæ­¥å™¨åœ¨å®ç°æ—¶åªéœ€è¦å®ç°å…±äº«èµ„æºstateçš„è·å–ä¸é‡Šæ”¾æ–¹å¼å³å¯</h6><h4 id="æ–¹æ³•-æœªå…·ä½“å®ç°ï¼ŒåªæŠ›å¼‚å¸¸"><a href="#æ–¹æ³•-æœªå…·ä½“å®ç°ï¼ŒåªæŠ›å¼‚å¸¸" class="headerlink" title="æ–¹æ³•(æœªå…·ä½“å®ç°ï¼ŒåªæŠ›å¼‚å¸¸)"></a>æ–¹æ³•(æœªå…·ä½“å®ç°ï¼ŒåªæŠ›å¼‚å¸¸)</h4><h5 id="tryAcquire-int-ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›false"><a href="#tryAcquire-int-ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›false" class="headerlink" title="tryAcquire(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›false"></a>tryAcquire(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›false</h5><h5 id="tryRelease-int-ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›false"><a href="#tryRelease-int-ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›false" class="headerlink" title="tryRelease(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›false"></a>tryRelease(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›false</h5><h5 id="tryAcquireShared-int-ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æº"><a href="#tryAcquireShared-int-ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æº" class="headerlink" title="tryAcquireShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æº"></a>tryAcquireShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æº</h5><h5 id="tryReleaseShared-int-ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å›false"><a href="#tryReleaseShared-int-ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å›false" class="headerlink" title="tryReleaseShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å›false"></a>tryReleaseShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å›false</h5><h4 id="æ–¹æ³•ï¼ˆå·²å®ç°ï¼‰"><a href="#æ–¹æ³•ï¼ˆå·²å®ç°ï¼‰" class="headerlink" title="æ–¹æ³•ï¼ˆå·²å®ç°ï¼‰"></a>æ–¹æ³•ï¼ˆå·²å®ç°ï¼‰</h4><h5 id="acquire-int"><a href="#acquire-int" class="headerlink" title="acquire(int)"></a>acquire(int)</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">acquireQueued</span><span class="token punctuation">(</span><span class="token function">addWaiter</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token punctuation">.</span>EXCLUSIVE<span class="token punctuation">)</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token function">selfInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="tryAcquire-å°è¯•ç›´æ¥å»è·å–èµ„æºï¼Œå¦‚æœæˆåŠŸåˆ™ç›´æ¥è¿”å›ï¼ˆè¿™é‡Œä½“ç°äº†éå…¬å¹³é”ï¼Œæ¯ä¸ªçº¿ç¨‹è·å–é”æ—¶ä¼šå°è¯•ç›´æ¥æŠ¢å åŠ å¡ä¸€æ¬¡ï¼Œè€ŒCLHé˜Ÿåˆ—ä¸­å¯èƒ½è¿˜æœ‰åˆ«çš„çº¿ç¨‹åœ¨ç­‰å¾…ï¼‰ï¼›"><a href="#tryAcquire-å°è¯•ç›´æ¥å»è·å–èµ„æºï¼Œå¦‚æœæˆåŠŸåˆ™ç›´æ¥è¿”å›ï¼ˆè¿™é‡Œä½“ç°äº†éå…¬å¹³é”ï¼Œæ¯ä¸ªçº¿ç¨‹è·å–é”æ—¶ä¼šå°è¯•ç›´æ¥æŠ¢å åŠ å¡ä¸€æ¬¡ï¼Œè€ŒCLHé˜Ÿåˆ—ä¸­å¯èƒ½è¿˜æœ‰åˆ«çš„çº¿ç¨‹åœ¨ç­‰å¾…ï¼‰ï¼›" class="headerlink" title="tryAcquire()å°è¯•ç›´æ¥å»è·å–èµ„æºï¼Œå¦‚æœæˆåŠŸåˆ™ç›´æ¥è¿”å›ï¼ˆè¿™é‡Œä½“ç°äº†éå…¬å¹³é”ï¼Œæ¯ä¸ªçº¿ç¨‹è·å–é”æ—¶ä¼šå°è¯•ç›´æ¥æŠ¢å åŠ å¡ä¸€æ¬¡ï¼Œè€ŒCLHé˜Ÿåˆ—ä¸­å¯èƒ½è¿˜æœ‰åˆ«çš„çº¿ç¨‹åœ¨ç­‰å¾…ï¼‰ï¼›"></a>tryAcquire()å°è¯•ç›´æ¥å»è·å–èµ„æºï¼Œå¦‚æœæˆåŠŸåˆ™ç›´æ¥è¿”å›ï¼ˆè¿™é‡Œä½“ç°äº†éå…¬å¹³é”ï¼Œæ¯ä¸ªçº¿ç¨‹è·å–é”æ—¶ä¼šå°è¯•ç›´æ¥æŠ¢å åŠ å¡ä¸€æ¬¡ï¼Œè€ŒCLHé˜Ÿåˆ—ä¸­å¯èƒ½è¿˜æœ‰åˆ«çš„çº¿ç¨‹åœ¨ç­‰å¾…ï¼‰ï¼›</h5><h5 id="addWaiter-å°†è¯¥çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œå¹¶æ ‡è®°ä¸ºç‹¬å æ¨¡å¼ï¼›"><a href="#addWaiter-å°†è¯¥çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œå¹¶æ ‡è®°ä¸ºç‹¬å æ¨¡å¼ï¼›" class="headerlink" title="addWaiter()å°†è¯¥çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œå¹¶æ ‡è®°ä¸ºç‹¬å æ¨¡å¼ï¼›"></a>addWaiter()å°†è¯¥çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œå¹¶æ ‡è®°ä¸ºç‹¬å æ¨¡å¼ï¼›</h5><h5 id="acquireQueued-ä½¿çº¿ç¨‹é˜»å¡åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­è·å–èµ„æºï¼Œä¸€ç›´è·å–åˆ°èµ„æºåæ‰è¿”å›ã€‚å¦‚æœåœ¨æ•´ä¸ªç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚-è‡ªæ—‹"><a href="#acquireQueued-ä½¿çº¿ç¨‹é˜»å¡åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­è·å–èµ„æºï¼Œä¸€ç›´è·å–åˆ°èµ„æºåæ‰è¿”å›ã€‚å¦‚æœåœ¨æ•´ä¸ªç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚-è‡ªæ—‹" class="headerlink" title="acquireQueued()ä½¿çº¿ç¨‹é˜»å¡åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­è·å–èµ„æºï¼Œä¸€ç›´è·å–åˆ°èµ„æºåæ‰è¿”å›ã€‚å¦‚æœåœ¨æ•´ä¸ªç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚(è‡ªæ—‹)"></a>acquireQueued()ä½¿çº¿ç¨‹é˜»å¡åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­è·å–èµ„æºï¼Œä¸€ç›´è·å–åˆ°èµ„æºåæ‰è¿”å›ã€‚å¦‚æœåœ¨æ•´ä¸ªç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚(è‡ªæ—‹)</h5><h5 id="å¦‚æœçº¿ç¨‹åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œå®ƒæ˜¯ä¸å“åº”çš„ã€‚åªæ˜¯è·å–èµ„æºåæ‰å†è¿›è¡Œè‡ªæˆ‘ä¸­æ–­selfInterrupt-ï¼Œå°†ä¸­æ–­è¡¥ä¸Šã€‚"><a href="#å¦‚æœçº¿ç¨‹åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œå®ƒæ˜¯ä¸å“åº”çš„ã€‚åªæ˜¯è·å–èµ„æºåæ‰å†è¿›è¡Œè‡ªæˆ‘ä¸­æ–­selfInterrupt-ï¼Œå°†ä¸­æ–­è¡¥ä¸Šã€‚" class="headerlink" title="å¦‚æœçº¿ç¨‹åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œå®ƒæ˜¯ä¸å“åº”çš„ã€‚åªæ˜¯è·å–èµ„æºåæ‰å†è¿›è¡Œè‡ªæˆ‘ä¸­æ–­selfInterrupt()ï¼Œå°†ä¸­æ–­è¡¥ä¸Šã€‚"></a>å¦‚æœçº¿ç¨‹åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­è¿‡ï¼Œå®ƒæ˜¯ä¸å“åº”çš„ã€‚åªæ˜¯è·å–èµ„æºåæ‰å†è¿›è¡Œè‡ªæˆ‘ä¸­æ–­selfInterrupt()ï¼Œå°†ä¸­æ–­è¡¥ä¸Šã€‚</h5><h5 id="release-int"><a href="#release-int" class="headerlink" title="release(int)"></a>release(int)</h5><h6 id="tryRelease-int-ï¼ŒtryRelease-éƒ½ä¼šæˆåŠŸçš„ï¼Œå› ä¸ºè¿™æ˜¯ç‹¬å æ¨¡å¼ï¼Œè¯¥çº¿ç¨‹æ¥é‡Šæ”¾èµ„æºï¼Œé‚£ä¹ˆå®ƒè‚¯å®šå·²ç»æ‹¿åˆ°ç‹¬å èµ„æºäº†ï¼Œç›´æ¥å‡æ‰ç›¸åº”é‡çš„èµ„æºå³å¯-state-arg-ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚releaseæ˜¯æ ¹æ®tryRelease-çš„è¿”å›å€¼æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å·²ç»å®Œæˆèµ„æºé‡Šæ”¾ã€‚æ‰€ä»¥å®ç°æ—¶ï¼Œ-state-0-ï¼Œè¦è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚"><a href="#tryRelease-int-ï¼ŒtryRelease-éƒ½ä¼šæˆåŠŸçš„ï¼Œå› ä¸ºè¿™æ˜¯ç‹¬å æ¨¡å¼ï¼Œè¯¥çº¿ç¨‹æ¥é‡Šæ”¾èµ„æºï¼Œé‚£ä¹ˆå®ƒè‚¯å®šå·²ç»æ‹¿åˆ°ç‹¬å èµ„æºäº†ï¼Œç›´æ¥å‡æ‰ç›¸åº”é‡çš„èµ„æºå³å¯-state-arg-ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚releaseæ˜¯æ ¹æ®tryRelease-çš„è¿”å›å€¼æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å·²ç»å®Œæˆèµ„æºé‡Šæ”¾ã€‚æ‰€ä»¥å®ç°æ—¶ï¼Œ-state-0-ï¼Œè¦è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚" class="headerlink" title="tryRelease(int)ï¼ŒtryRelease()éƒ½ä¼šæˆåŠŸçš„ï¼Œå› ä¸ºè¿™æ˜¯ç‹¬å æ¨¡å¼ï¼Œè¯¥çº¿ç¨‹æ¥é‡Šæ”¾èµ„æºï¼Œé‚£ä¹ˆå®ƒè‚¯å®šå·²ç»æ‹¿åˆ°ç‹¬å èµ„æºäº†ï¼Œç›´æ¥å‡æ‰ç›¸åº”é‡çš„èµ„æºå³å¯(state-=arg)ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚releaseæ˜¯æ ¹æ®tryRelease()çš„è¿”å›å€¼æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å·²ç»å®Œæˆèµ„æºé‡Šæ”¾ã€‚æ‰€ä»¥å®ç°æ—¶ï¼Œ(state=0)ï¼Œè¦è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚"></a>tryRelease(int)ï¼ŒtryRelease()éƒ½ä¼šæˆåŠŸçš„ï¼Œå› ä¸ºè¿™æ˜¯ç‹¬å æ¨¡å¼ï¼Œè¯¥çº¿ç¨‹æ¥é‡Šæ”¾èµ„æºï¼Œé‚£ä¹ˆå®ƒè‚¯å®šå·²ç»æ‹¿åˆ°ç‹¬å èµ„æºäº†ï¼Œç›´æ¥å‡æ‰ç›¸åº”é‡çš„èµ„æºå³å¯(state-=arg)ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚releaseæ˜¯æ ¹æ®tryRelease()çš„è¿”å›å€¼æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å·²ç»å®Œæˆèµ„æºé‡Šæ”¾ã€‚æ‰€ä»¥å®ç°æ—¶ï¼Œ(state=0)ï¼Œè¦è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</h6><h6 id="unparkSuccessor-Node-ç”¨LockSupport-unpark-æ–¹æ³•å”¤é†’é˜Ÿåˆ—ä¸­æœ€æ¬ æ‰çš„é‚£ä¸ªæœªæ”¾å¼ƒçš„çº¿ç¨‹ã€‚ä¸€èˆ¬æ¥è¯´å½“å‰ç»“ç‚¹çš„åä¸€ä¸ªç»“ç‚¹å°±æ˜¯ä¸‹ä¸€ä¸ªï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½åé¢çš„ç»“ç‚¹æ”¾å¼ƒäº†ï¼Œè¿™æ—¶ä»å°¾å·´ä¸€ç›´å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½è·‘çš„å°±è®©ä»–è·‘"><a href="#unparkSuccessor-Node-ç”¨LockSupport-unpark-æ–¹æ³•å”¤é†’é˜Ÿåˆ—ä¸­æœ€æ¬ æ‰çš„é‚£ä¸ªæœªæ”¾å¼ƒçš„çº¿ç¨‹ã€‚ä¸€èˆ¬æ¥è¯´å½“å‰ç»“ç‚¹çš„åä¸€ä¸ªç»“ç‚¹å°±æ˜¯ä¸‹ä¸€ä¸ªï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½åé¢çš„ç»“ç‚¹æ”¾å¼ƒäº†ï¼Œè¿™æ—¶ä»å°¾å·´ä¸€ç›´å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½è·‘çš„å°±è®©ä»–è·‘" class="headerlink" title="unparkSuccessor(Node)  ç”¨LockSupport.unpark()æ–¹æ³•å”¤é†’é˜Ÿåˆ—ä¸­æœ€æ¬ æ‰çš„é‚£ä¸ªæœªæ”¾å¼ƒçš„çº¿ç¨‹ã€‚ä¸€èˆ¬æ¥è¯´å½“å‰ç»“ç‚¹çš„åä¸€ä¸ªç»“ç‚¹å°±æ˜¯ä¸‹ä¸€ä¸ªï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½åé¢çš„ç»“ç‚¹æ”¾å¼ƒäº†ï¼Œè¿™æ—¶ä»å°¾å·´ä¸€ç›´å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½è·‘çš„å°±è®©ä»–è·‘"></a>unparkSuccessor(Node)  ç”¨LockSupport.unpark()æ–¹æ³•å”¤é†’é˜Ÿåˆ—ä¸­æœ€æ¬ æ‰çš„é‚£ä¸ªæœªæ”¾å¼ƒçš„çº¿ç¨‹ã€‚ä¸€èˆ¬æ¥è¯´å½“å‰ç»“ç‚¹çš„åä¸€ä¸ªç»“ç‚¹å°±æ˜¯ä¸‹ä¸€ä¸ªï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½åé¢çš„ç»“ç‚¹æ”¾å¼ƒäº†ï¼Œè¿™æ—¶ä»å°¾å·´ä¸€ç›´å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½è·‘çš„å°±è®©ä»–è·‘</h6><h4 id="å†…éƒ¨ç±»"><a href="#å†…éƒ¨ç±»" class="headerlink" title="å†…éƒ¨ç±»"></a>å†…éƒ¨ç±»</h4><h5 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h5><h5 id="å˜é‡-1"><a href="#å˜é‡-1" class="headerlink" title="å˜é‡"></a>å˜é‡</h5><h6 id="volatile-Node-prev-å‰é©±"><a href="#volatile-Node-prev-å‰é©±" class="headerlink" title="volatile Node prev å‰é©±"></a>volatile Node prev å‰é©±</h6><h6 id="volatile-Node-next-åç»§"><a href="#volatile-Node-next-åç»§" class="headerlink" title="volatile Node next åç»§"></a>volatile Node next åç»§</h6><h6 id="volatile-int-waitStatus"><a href="#volatile-int-waitStatus" class="headerlink" title="volatile int waitStatus"></a>volatile int waitStatus</h6><ul><li>CANCELLED = 1ï¼šè¡¨ç¤ºå½“å‰ç»“ç‚¹å·²å–æ¶ˆè°ƒåº¦ã€‚å½“timeoutæˆ–è¢«ä¸­æ–­ï¼ˆå“åº”ä¸­æ–­çš„æƒ…å†µä¸‹ï¼‰ï¼Œä¼šè§¦å‘å˜æ›´ä¸ºæ­¤çŠ¶æ€ï¼Œè¿›å…¥è¯¥çŠ¶æ€åçš„ç»“ç‚¹å°†ä¸ä¼šå†å˜åŒ–ã€‚</li><li>é»˜è®¤å€¼0 æ–°èŠ‚ç‚¹å…¥é˜Ÿæ—¶é»˜è®¤çŠ¶æ€</li><li>SIGNAL  = -1åç»§ç»“ç‚¹åœ¨ç­‰å¾…å½“å‰ç»“ç‚¹å”¤é†’ï¼Œåè®°ç»“ç‚¹å…¥é˜Ÿæ—¶ï¼Œä¼šå°†å‰é©±ç»“ç‚¹æ›´æ–°æœªSIGNAL</li><li>CONDITION = -2è¡¨ç¤ºç»“ç‚¹ç­‰å¾…åœ¨Conditionä¸Šï¼Œå½“å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†Conditionçš„signal()æ–¹æ³•åCONDITIONçŠ¶æ€çš„ç»“ç‚¹å°†ä»ç­‰å¾…é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è·å–åŒæ­¥é”</li><li>PROPAGATE = -3å…±äº«æ¨¡å¼ä¸‹ï¼Œå‰ç»§ç»“ç‚¹ä¸ä»…ä¼šå”¤é†’å…¶åç»§ç»“ç‚¹ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½ä¼šå”¤é†’åç»§çš„åç»§ç»“ç‚¹ã€‚</li></ul><h6 id="Node-nextWaiter"><a href="#Node-nextWaiter" class="headerlink" title="Node nextWaiter"></a>Node nextWaiter</h6><h6 id="volatile-Thread-thread"><a href="#volatile-Thread-thread" class="headerlink" title="volatile Thread thread"></a>volatile Thread thread</h6><p>+æŠ¢é”çš„çº¿ç¨‹</p><h5 id="ConditionObject"><a href="#ConditionObject" class="headerlink" title="ConditionObject"></a>ConditionObject</h5><h3 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h3><h4 id="çº¿ç¨‹æ± ç”¨è¿‡å—ï¼ŸThreadPoolExecutorè°ˆè°ˆä½ çš„ç†è§£"><a href="#çº¿ç¨‹æ± ç”¨è¿‡å—ï¼ŸThreadPoolExecutorè°ˆè°ˆä½ çš„ç†è§£" class="headerlink" title="==çº¿ç¨‹æ± ç”¨è¿‡å—ï¼ŸThreadPoolExecutorè°ˆè°ˆä½ çš„ç†è§£=="></a>==çº¿ç¨‹æ± ç”¨è¿‡å—ï¼ŸThreadPoolExecutorè°ˆè°ˆä½ çš„ç†è§£==</h4><h5 id="çº¿ç¨‹-ä¼˜åŠ¿"><a href="#çº¿ç¨‹-ä¼˜åŠ¿" class="headerlink" title="çº¿ç¨‹==ä¼˜åŠ¿=="></a>çº¿ç¨‹==ä¼˜åŠ¿==</h5><ul><li>çº¿ç¨‹æ± åšçš„å·¥ä½œä¸»è¦æ˜¯æ§åˆ¶è¿è¡Œçš„çº¿ç¨‹çš„æ•°é‡.å¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—.ç„¶ååœ¨çº¿ç¨‹åˆ›å»ºåå¯åŠ¨è¿™äº›ä»»åŠ¡å¦‚æœçº¿ç¨‹æ•°é‡è¶…è¿‡äº†æœ€å¤§æ•°é‡è¶…å‡ºæ•°é‡çš„çº¿ç¨‹æ’é˜Ÿç­‰å€™,ç­‰å…¶å®ƒçº¿ç¨‹æ‰§è¡Œå®Œæ¯•,å†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚</li><li>å®ƒçš„ä¸»è¦ç‰¹ç‚¹ä¸º:çº¿ç¨‹å¤ç”¨;æ§åˆ¶æœ€å¤§å¹¶å‘æ•°:;ç®¡ç†çº¿ç¨‹</li><li>ç¬¬ä¸€:é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—</li><li>ç¬¬äºŒ:æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶,ä»»åŠ¡å¯ä»¥ä¸éœ€è¦çš„ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œ</li><li>ç¬¬ä¸‰:æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºå¦‚æœæ— é™åˆ¶çš„åˆ›å»º,ä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…è°ƒä¼˜å’Œç›‘æ§</li></ul><h4 id="çº¿ç¨‹æ± å¦‚ä½•ä½¿ç”¨"><a href="#çº¿ç¨‹æ± å¦‚ä½•ä½¿ç”¨" class="headerlink" title="çº¿ç¨‹æ± å¦‚ä½•ä½¿ç”¨"></a>çº¿ç¨‹æ± å¦‚ä½•ä½¿ç”¨</h4><h5 id="Executors-newScheduledThreadPool"><a href="#Executors-newScheduledThreadPool" class="headerlink" title="Executors.newScheduledThreadPool()"></a>Executors.newScheduledThreadPool()</h5><h5 id="JDK1-8-Executors-newScheduledThreadPool-int"><a href="#JDK1-8-Executors-newScheduledThreadPool-int" class="headerlink" title="JDK1.8  Executors.newScheduledThreadPool(int)"></a>JDK1.8  Executors.newScheduledThreadPool(int)</h5><h5 id="Executors-newFixedThreadPool-integer"><a href="#Executors-newFixedThreadPool-integer" class="headerlink" title="Executors.newFixedThreadPool(integer);"></a>Executors.newFixedThreadPool(integer);</h5><ul><li><p>åœºæ™¯ï¼šæ‰§è¡Œé•¿æœŸçš„ä»»åŠ¡ï¼Œæ€§èƒ½å¥½å¾ˆå¤š</p></li><li><p>ä¸»è¦çš„ç‰¹ç‚¹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>nThreadsï¼ŒnThreads<span class="token punctuation">,</span>keepAliveTime<span class="token operator">:</span><span class="token number">0L</span>ï¼Œ<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token class-name">MILLISECONDSnew</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                                                               <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ul><ul><li>åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± å¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°è¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚</li><li>newFixedThreadPoolåˆ›å»ºçš„çº¿ç¨‹æ±  corePoolsizeå’Œ maximumPoolsizeå€¼æ˜¯ç›¸ç­‰çš„å®ƒä½¿ç”¨çš„ LinkedBlockingQueue</li></ul><h5 id="xecutors-newSingleThreadExecutor"><a href="#xecutors-newSingleThreadExecutor" class="headerlink" title="xecutors.newSingleThreadExecutor();"></a>xecutors.newSingleThreadExecutor();</h5><ul><li><p>ä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œçš„åœºæ™¯</p></li><li><p>ä¸»è¦çš„ç‰¹ç‚¹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FinalizableDelegatedExecutorService</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span> corePoolSize<span class="token operator">:</span> <span class="token number">1</span>ï¼ŒmaxmumPoolSize<span class="token operator">:</span> <span class="token number">1</span>keepAliveTime<span class="token operator">:</span> <span class="token number">0L</span>TimeUnit<span class="token punctuation">.</span><span class="token class-name">MILLISECONDSnew</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ,å®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡,ä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåºæ‰§è¡Œã€‚</li><li>newSingleThreadExecutorå°† corePoolsizeå’Œ maximumPoolsizeéƒ½è®¾ç½®ä¸º1å®ƒä½¿ç”¨çš„LinkedBlockingQueue</li></ul></li></ul><h5 id="Executors-newCachedThreadPool"><a href="#Executors-newCachedThreadPool" class="headerlink" title="Executors.newCachedThreadPool()"></a>Executors.newCachedThreadPool()</h5><ul><li><p>é€‚ç”¨ï¼šæ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥çš„å°ç¨‹åºæˆ–è€…è´Ÿè½½æ¯”è¾ƒè½»çš„æœåŠ¡å™¨</p></li><li><p>ä¸»è¦çš„ç‰¹ç‚¹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span> corePoolSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token class-name">MAX</span> VALUE<span class="token punctuation">,</span>keepAliveTime<span class="token operator">:</span> <span class="token number">60L</span>ï¼Œ<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token class-name">SECONDSnew</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><p>åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ,å¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦,å¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹,è‹¥æ— å¯å›æ”¶,åˆ™æ–°å»ºçº¿ç¨‹ã€‚</p></li><li><p> newCachedThreadPoolå°† corePoolsizeè®¾ç½®ä¸º0,å°† maximumPoolsizeè®¾ç½®ä¸ºInteger.MAXVALUEä½¿ç”¨çš„synchronousQueue,ä¹Ÿå°±æ˜¯è¯´æ¥äº†ä»»åŠ¡å°±åˆ›å»ºçº¿ç¨‹è¿è¡Œå½“çº¿ç¨‹ç©ºé—²è¶…è¿‡60ç§’å°±é”€æ¯çº¿ç¨‹</p></li></ul></li></ul><h4 id="çº¿ç¨‹æ± çš„å‡ ä¸ªé‡è¦å‚æ•°ä»‹ç»ï¼Ÿ"><a href="#çº¿ç¨‹æ± çš„å‡ ä¸ªé‡è¦å‚æ•°ä»‹ç»ï¼Ÿ" class="headerlink" title="==çº¿ç¨‹æ± çš„å‡ ä¸ªé‡è¦å‚æ•°ä»‹ç»ï¼Ÿ=="></a>==çº¿ç¨‹æ± çš„å‡ ä¸ªé‡è¦å‚æ•°ä»‹ç»ï¼Ÿ==</h4><h5 id="7å¤§å‚æ•°"><a href="#7å¤§å‚æ•°" class="headerlink" title="7å¤§å‚æ•°"></a>7å¤§å‚æ•°</h5><h6 id="int-corePoolSize"><a href="#int-corePoolSize" class="headerlink" title="int corePoolSize"></a>int corePoolSize</h6><ul><li>çº¿ç¨‹æ± ä¸­çš„å¸¸é©»æ ¸å¿ƒçº¿ç¨‹æ•°</li></ul><h6 id="int-maximumPoolSize"><a href="#int-maximumPoolSize" class="headerlink" title="int maximumPoolSize"></a>int maximumPoolSize</h6><ul><li>çº¿ç¨‹æ± èƒ½å¤Ÿå®¹çº³åŒæ—¶æ‰§è¡Œçš„æœ€å¤§çº¿ç¨‹æ•°,æ­¤å€¼å¿…é¡»å¤§äºç­‰äº1</li></ul><h6 id="long-keepAliveTime"><a href="#long-keepAliveTime" class="headerlink" title="long keepAliveTime"></a>long keepAliveTime</h6><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">åœ¨åˆ›å»ºäº†çº¿ç¨‹æ± å,å½“æœ‰è¯·æ±‚ä»»åŠ¡æ¥ä¹‹å,å°±ä¼šå®‰æ’æ± ä¸­çš„çº¿ç¨‹å»æ‰§è¡Œè¯·æ±‚ä»»åŠ¡,è¿‘ä¼¼ç†è§£ä¸ºä»Šæ—¥å½“å€¼çº¿ç¨‹,å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ° core PoolSizeåå°±ä¼šæŠŠåˆ°è¾¾çš„ä»»åŠ¡æ”¾åˆ°ç¼“æœ‰é˜Ÿåˆ—ä¸­<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ã€‚çº¿ç¨‹æ± æ•°é‡è¶…è¿‡ core poolsizeæ—¶,å½“ç©ºé—²æ—¶é—´è¾¾åˆ° keepAliveTimeå€¼æ—¶</li><li>å¤šä½™ç©ºé—²çº¿ç¨‹ä¼šè¢«é”€æ¯ç›´åˆ°åªå‰©ä¸‹ core Poolsizeä¸ªçº¿ç¨‹ä¸ºæ­¢</li></ul><h6 id="TimeUnit-unit"><a href="#TimeUnit-unit" class="headerlink" title="TimeUnit unit"></a>TimeUnit unit</h6><ul><li>keepAliveTimeçš„å•ä½</li></ul><h6 id="BlockingQueue-workQueue"><a href="#BlockingQueue-workQueue" class="headerlink" title="BlockingQueue workQueue"></a>BlockingQueue<runnable> workQueue</runnable></h6><ul><li>ä»»åŠ¡é˜Ÿåˆ—,è¢«æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„ä»»åŠ¡ã€‚</li></ul><h6 id="ThreadFactory-threadFactory"><a href="#ThreadFactory-threadFactory" class="headerlink" title="ThreadFactory threadFactory"></a>ThreadFactory threadFactory</h6><ul><li>ç”Ÿæˆçº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹å·¥å‚,ç”¨äºåˆ›å»ºçº¿ç¨‹<strong>ä¸€èˆ¬ç”¨é»˜è®¤çš„å³å¯</strong></li></ul><h6 id="RejectedExecutionHandler-handler"><a href="#RejectedExecutionHandler-handler" class="headerlink" title="RejectedExecutionHandler handler"></a>RejectedExecutionHandler handler</h6><ul><li>æ‹’ç»ç­–ç•¥,è¡¨ç¤ºå½“é˜Ÿåˆ—æ»¡äº†å¹¶ä¸”å·¥ä½œçº¿ç¨‹å¤§äºç­‰äºçº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°(maximumpoolsize)æ—¶æ‹’ç»è¯·æ±‚æ‰§è¡Œçš„ç­–ç•¥</li></ul><h4 id="è€ƒç‚¹çº¿ç¨‹æ± åº•å±‚åŸç†"><a href="#è€ƒç‚¹çº¿ç¨‹æ± åº•å±‚åŸç†" class="headerlink" title="==è€ƒç‚¹çº¿ç¨‹æ± åº•å±‚åŸç†=="></a>==è€ƒç‚¹çº¿ç¨‹æ± åº•å±‚åŸç†==</h4><ul><li><p>åœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åç­‰å¾…æäº¤è¿‡æ¥çš„ä»»åŠ¡è¯·æ±‚</p></li><li><p>2å½“è°ƒç”¨execute(æ–¹æ³•æ·»åŠ ä¸€ä¸ªè¯·æ±‚ä»»åŠ¡æ—¶çº¿ç¨‹æ± ä¼šåšå¦‚ä¸‹åˆ¤æ–­</p></li><li><p>2.1å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äºcorePoolsize,é‚£ä¹ˆé©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡</p></li><li><p>2.2å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äºcorePoolsizeé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—</p></li><li><p>2.3å¦‚æœè¿™æ—¶å€™é˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¿˜å°äº maximumPoolsizeé‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡,</p></li><li><p>2.4å¦‚æœé˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äºmaximumPoolsizeé‚£ä¹ˆçº¿ç¨‹æ± ä¼šå¯åŠ¨é¥±å’Œæ‹’ç»ç­–ç•¥æ¥æ‰§è¡Œã€‚</p></li><li><p>3å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶,å®ƒä¼šä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œ</p></li><li><p>4å½“ä¸€ä¸ªçº¿ç¨‹æ— äº‹å¯åšè¶…è¿‡ä¸€å®šçš„æ—¶é—´( keepAliveTime)æ—¶çº¿ç¨‹æ± ä¼š==åˆ¤æ–­==</p><ul><li>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äºcorePoolsizeé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«åœæ‰æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ°corePoolsizeçš„å¤§å°</li></ul></li></ul><h4 id="ç”Ÿäº§ä¸Šä½ å¦‚ä½•è®¾ç½®åˆç†å‚æ•°ï¼Ÿ"><a href="#ç”Ÿäº§ä¸Šä½ å¦‚ä½•è®¾ç½®åˆç†å‚æ•°ï¼Ÿ" class="headerlink" title="==ç”Ÿäº§ä¸Šä½ å¦‚ä½•è®¾ç½®åˆç†å‚æ•°ï¼Ÿ=="></a>==ç”Ÿäº§ä¸Šä½ å¦‚ä½•è®¾ç½®åˆç†å‚æ•°ï¼Ÿ==</h4><h5 id="çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä½ è°ˆè°ˆ"><a href="#çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä½ è°ˆè°ˆ" class="headerlink" title="çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä½ è°ˆè°ˆ"></a>çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ä½ è°ˆè°ˆ</h5><h6 id="ä»€ä¹ˆæ˜¯æ‹’ç»ç­–ç•¥"><a href="#ä»€ä¹ˆæ˜¯æ‹’ç»ç­–ç•¥" class="headerlink" title="ä»€ä¹ˆæ˜¯æ‹’ç»ç­–ç•¥"></a>ä»€ä¹ˆæ˜¯æ‹’ç»ç­–ç•¥</h6><ul><li>ç­‰å¾…é˜Ÿåˆ—ä¹Ÿå·²ç»æ’æ»¡äº†,å†ä¹Ÿå¡ä¸ä¸‹æ–°ä»»åŠ¡äº†åŒæ—¶ï¼Œçº¿ç¨‹æ± ä¸­çš„maxçº¿ç¨‹ä¹Ÿè¾¾åˆ°äº†,æ— æ³•ç»§ç»­ä¸ºæ–°ä»»åŠ¡æœåŠ¡</li><li>è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦==æ‹’ç»ç­–ç•¥æœºåˆ¶åˆç†==çš„å¤„ç†è¿™ä¸ªé—®é¢˜</li></ul><h6 id="JDKå†…ç½®çš„æ‹’ç»ç­–ç•¥"><a href="#JDKå†…ç½®çš„æ‹’ç»ç­–ç•¥" class="headerlink" title="JDKå†…ç½®çš„æ‹’ç»ç­–ç•¥"></a>JDKå†…ç½®çš„æ‹’ç»ç­–ç•¥</h6><ul><li><p>AbortPolicyl(é»˜è®¤):ç›´æ¥æŠ›å‡º Rejected Execution Exceptionå¼‚å¸¸é˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚</p></li><li><p>CallerRunsPolicy:â€è°ƒç”¨è€…è¿è¡Œâ€ä¸€ç§è°ƒèŠ‚æœºåˆ¶,è¯¥ç­–ç•¥å‚šä¸ä¼šæŠ›å¼ƒä»»åŠ¡,ä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸,è€Œæ˜¯å°†æŸäº›ä»»åŠ¡å›é€€åˆ°è°ƒç”¨è€…ï¼Œä»è€Œé™ä½æ–°ä»»åŠ¡çš„æµé‡</p></li><li><p>Discardoldest polic:æŠ›å¼ƒé˜Ÿåˆ—ä¸­ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡,ç„¶åæŠŠå½“å‰ä»»åŠ¡åŠ å…¥é˜Ÿä¸­å°è¯•å†æ¬¡æäº¤å½“å‰ä»¼åŠ¡ã€‚</p></li><li><p>DiscardPolicy:ç›´æ¥ä¸¢å¼ƒä»»åŠ¡,ä¸äºˆä»»ä½•å¤„ç†ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœå…è®¸ä»»åŠ¡ä¸¢å¤±,è¿™æ˜¯æœ€å¥½çš„ä¸€ç§æ–¹æ¡ˆã€‚</p></li><li><p>ä»¥ä¸Šå†…ç½®æ‹’ç»ç­–ç•¥å‡å®ç°äº†RejectedExecutionHandleræ¥å£</p></li></ul><h5 id="è€ƒç‚¹ï¼šä½ åœ¨å·¥ä½œä¸­å•ä¸€çš„-å›ºå®šæ•°çš„å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•-ä½ ç”¨é‚£ä¸ªå¤š"><a href="#è€ƒç‚¹ï¼šä½ åœ¨å·¥ä½œä¸­å•ä¸€çš„-å›ºå®šæ•°çš„å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•-ä½ ç”¨é‚£ä¸ªå¤š" class="headerlink" title="==è€ƒç‚¹ï¼šä½ åœ¨å·¥ä½œä¸­å•ä¸€çš„/å›ºå®šæ•°çš„å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•,ä½ ç”¨é‚£ä¸ªå¤š?=="></a>==è€ƒç‚¹ï¼šä½ åœ¨å·¥ä½œä¸­å•ä¸€çš„/å›ºå®šæ•°çš„å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•,ä½ ç”¨é‚£ä¸ªå¤š?==</h5><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">ä¸€ä¸ªéƒ½ä¸ç”¨ï¼Œæˆ‘ä»¬ç”Ÿäº§ä¸Šåªèƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„Executorsä¸­JDKå·²ç»ç»™ä½ æä¾›äº†ï¼Œä¸ºä»€ä¹ˆä¸ç”¨?æ¥è‡ªé˜¿é‡Œå·´å·´å¼€å‘è§„èŒƒæ‰‹å†Œ[å¼ºåˆ¶]**çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨Executors å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ThreadPoolExecutor çš„æ–¹å¼ï¼Œè¿™æ ·è§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œ*è¯´æ˜:Executors è¿”å›çš„çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹:1)FixedThreadPoolå’Œ SingleThreadPoolå…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸ºlntegerMAXVALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´00Mã€‚2)CachedThreadPool å’Œ ScheduledThreadPoo1:å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸ºInteger.MAXVALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="åœ¨å·¥ä½œä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± çš„-æ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± ä½¿ç”¨"><a href="#åœ¨å·¥ä½œä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± çš„-æ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± ä½¿ç”¨" class="headerlink" title="==åœ¨å·¥ä½œä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± çš„,æ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± ä½¿ç”¨=="></a>==åœ¨å·¥ä½œä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± çš„,æ˜¯å¦è‡ªå®šä¹‰è¿‡çº¿ç¨‹æ± ä½¿ç”¨==</h5><ul><li>æŒ‰ç…§Executorsä¸­çš„ç…§çŒ«ç”»è™å°±å¥½äº†ï¼Œå°±æ˜¯æœ€å¤§çº¿ç¨‹æ•°ä¸è¦ç”¨Integer.MaxValue</li></ul><h5 id="åˆç†é…ç½®çº¿ç¨‹æ± ä½ æ˜¯å¦‚ä½•è€ƒè™‘çš„"><a href="#åˆç†é…ç½®çº¿ç¨‹æ± ä½ æ˜¯å¦‚ä½•è€ƒè™‘çš„" class="headerlink" title="==åˆç†é…ç½®çº¿ç¨‹æ± ä½ æ˜¯å¦‚ä½•è€ƒè™‘çš„?=="></a>==åˆç†é…ç½®çº¿ç¨‹æ± ä½ æ˜¯å¦‚ä½•è€ƒè™‘çš„?==</h5><ul><li><p>CPUå¯†é›†å‹</p><ul><li><pre><code class="txt">CPUå¯†é›†çš„æ„æ€æ˜¯è¯¥ä»»åŠ¡éœ€è¦å¤§é‡çš„è¿ç®—è€Œæ²¡æœ‰é˜»å¡CPUä¸€ç›´å…¨é€Ÿè¿è¡ŒCPUå¯†é›†ä»»åŠ¡åªæœ‰åœ¨çœŸæ­£çš„å¤šæ ¸CPUä¸Šæ‰å¯èƒ½å¾—åˆ°åŠ é€Ÿ(é€šè¿‡å¤šçº¿ç¨‹)ï¼Œè€Œåœ¨å•æ ¸CPUä¸Š(æ‚²å‰§å§? = =!)æ— è®ºä½ å¼€å‡ ä¸ªæ¨¡æ‹Ÿçš„å¤šçº¿ç¨‹è¯¥ä»»åŠ¡éƒ½ä¸å¯èƒ½å¾—åˆ°åŠ é€Ÿå› ä¸ºCPUæ€»çš„è¿ç®—èƒ½åŠ›å°±é‚£äº›ã€‚CPUå¯†é›†å‹ä»»åŠ¡é…ç½®å°½å¯èƒ½å°‘çš„çº¿ç¨‹æ•°é‡ä¸€èˆ¬å…¬å¼:CPUæ ¸æ•°+1ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </code></pre></li></ul></li></ul><ul><li>IOå¯†é›†å‹ï¼ˆ1Oèœœé›†å‹å³è¯¥ä»»åŠ¡éœ€è¦å¤§é‡çš„IO å³å¤§é‡çš„é˜»å¡ã€‚ï¼‰<ul><li>ç”±äº10å¯†é›†å‹ä»»åŠ¡çº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´åœ¨æ‰§è¡Œä»»åŠ¡åˆ™åº”é…ç½®å°½å¯èƒ½å¤šçš„çº¿ç¨‹å¦‚cPUæ ¸æ•°â€2</li><li>åœ¨å•çº¿ç¨‹ä¸Šè¿è¡ŒIOå¯†é›†å‹çš„ä»»åŠ¡ä¼šå¯¼è‡´æµªè´¹å¤§é‡çš„CPUè¿ç®—èƒ½åŠ›æµªè´¹åœ¨ç­‰å¾…æ‰€ä»¥åœ¨I0å¯†é›†å‹ä»»åŠ¡ä¸­ä½¿ç”¨å¤šçº¿ç¨‹å¯ä»¥å¤§å¤§çš„åŠ é€Ÿç¨‹åºè¿è¡Œå³ä½¿åœ¨å•æ ¸CPUä¸Šè¿™ç§åŠ é€Ÿä¸»è¦å°±æ˜¯åˆ©ç”¨äº†è¢«æµªè´¹æ‰çš„é˜»å¡æ—¶é—´</li><li>IOå¯†é›†å‹æ—¶,å¤§éƒ¨åˆ†çº¿ç¨‹éƒ½é˜»å¡æ•…éœ€è¦å¤šé…ç½®çº¿ç¨‹æ•°å‚è€ƒå…¬å¼:CPUæ ¸æ•°/1-é˜³å¡ç³»æ•°<br>é˜»å¡ç³»æ•°åœ¨0.8~09ä¹‹é—´<br>æ¯”å¦‚8æ ¸CPU:8/(1-09)=80ä¸ªçº¿ç¨‹æ•°</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ä¸“åˆŠç¯‡" scheme="https://mykkto.github.io/categories/%E4%B8%93%E5%88%8A%E7%AF%87/"/>
    
    
    <category term="juc" scheme="https://mykkto.github.io/tags/juc/"/>
    
    <category term="é¢è¯•é¢˜" scheme="https://mykkto.github.io/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>ç°åº¦å‘å¸ƒæ–¹æ¡ˆ</title>
    <link href="https://mykkto.github.io/posts/f83c265d.html"/>
    <id>https://mykkto.github.io/posts/f83c265d.html</id>
    <published>2022-11-27T05:22:33.000Z</published>
    <updated>2022-12-12T13:20:39.169Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä»£ç ï¼š"><a href="#ä»£ç ï¼š" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h2><p><a href="https://gitee.com/TK_LIMR/springcloud2021To2021.git">https://gitee.com/TK_LIMR/springcloud2021To2021.git</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202212042121559.png"></p><h2 id="ç›®å½•ï¼š"><a href="#ç›®å½•ï¼š" class="headerlink" title="ç›®å½•ï¼š"></a>ç›®å½•ï¼š</h2><p>ä¸€ã€gateway</p><ul><li>å‰ç½®çŸ¥è¯†</li><li>ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒ</li><li>ç°åº¦å‘å¸ƒè½åœ°æ–¹æ¡ˆ</li><li>åŸç†å›¾</li><li>æ¡ˆä¾‹ï¼š <ul><li>æœåŠ¡æ³¨å†Œ</li><li>æ„å»ºç½‘å…³</li><li>ç¼–å†™ç°åº¦ç”¨æˆ·</li></ul></li></ul><p>äºŒã€openresty</p><ul><li></li></ul><h2 id="â… ã€gateway-ç°åº¦"><a href="#â… ã€gateway-ç°åº¦" class="headerlink" title="â… ã€gateway ç°åº¦"></a>â… ã€gateway ç°åº¦</h2><h3 id="ä¸€ã€å‰ç½®çŸ¥è¯†"><a href="#ä¸€ã€å‰ç½®çŸ¥è¯†" class="headerlink" title="ä¸€ã€å‰ç½®çŸ¥è¯†"></a>ä¸€ã€å‰ç½®çŸ¥è¯†</h3><p>1.nacos æœåŠ¡æ³¨å†Œä¸å‘ç°</p><p>2.æœ¬åœ°è´Ÿè½½å‡è¡¡å™¨ç®—æ³•</p><p>3.gateway ç½‘å…³</p><p>4.ThreadLocal</p><p>1.ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Ÿ<br>2.ä»€ä¹ˆæ˜¯ç°åº¦ç­–ç•¥?<br>3.ç°åº¦å‘å¸ƒè½åœ°æ–¹æ¡ˆæœ‰å“ªäº›<br>4.ç°åº¦å‘å¸ƒæ¶æ„è®¾è®¡åŸç† nginx+luaï¼Ÿ<br>5.å¦‚ä½•åŸºäºGateWay+Nacosæ„å»ºç°åº¦ç¯å¢ƒ<br>6.GateWayè´Ÿè½½å‡è¡¡è·¯ç”±ç®—æ³•åŸç†â€”â€”æ”¹å†™<br>7.å¦‚ä½•é‡å†™æœ¬åœ°è´Ÿè½½å‡è¡¡å™¨ï¼Œèµ°ç°åº¦ç¯å¢ƒ<br>8.ä¸ºä½•ä¸åŸºäºnginx+luaå®ç°ï¼Ÿè€Œä½¿ç”¨GateWay<br>9.ä»£ç è½åœ°å®æˆ˜ï¼šæ„å»ºå¾®æœåŠ¡ç°åº¦å‘å¸ƒç¯å¢ƒ</p><h3 id="äºŒã€ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒ"><a href="#äºŒã€ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒ" class="headerlink" title="äºŒã€ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒ"></a>äºŒã€ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒ</h3><p>ç°åº¦å‘å¸ƒï¼ˆåˆåé‡‘ä¸é›€å‘å¸ƒï¼‰æ˜¯æŒ‡åœ¨é»‘ä¸ç™½ä¹‹é—´ï¼Œèƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡çš„ä¸€ç§å‘å¸ƒæ–¹å¼ã€‚åœ¨å…¶ä¸Šå¯ä»¥è¿›è¡ŒA/B testingï¼Œå³è®©ä¸€éƒ¨åˆ†ç”¨æˆ·ç»§ç»­ç”¨äº§å“ç‰¹æ€§Aï¼Œä¸€éƒ¨åˆ†ç”¨æˆ·å¼€å§‹ç”¨äº§å“ç‰¹æ€§Bï¼Œå¦‚æœç”¨æˆ·å¯¹Bæ²¡æœ‰ä»€ä¹ˆåå¯¹æ„è§ï¼Œé‚£ä¹ˆé€æ­¥æ‰©å¤§èŒƒå›´ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·éƒ½è¿ç§»åˆ°Bä¸Šé¢æ¥ã€‚ç°åº¦å‘å¸ƒå¯ä»¥ä¿è¯æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šï¼Œåœ¨åˆå§‹ç°åº¦çš„æ—¶å€™å°±å¯ä»¥å‘ç°ã€è°ƒæ•´é—®é¢˜ï¼Œä»¥ä¿è¯å…¶å½±å“åº¦ã€‚</p><p>ç°åº¦æœŸï¼šç°åº¦å‘å¸ƒå¼€å§‹åˆ°ç»“æŸæœŸé—´çš„è¿™ä¸€æ®µæ—¶é—´ï¼Œç§°ä¸ºç°åº¦æœŸã€‚</p><p>ç°åº¦å‘å¸ƒèƒ½åŠæ—©è·å¾—ç”¨æˆ·çš„æ„è§åé¦ˆï¼Œå®Œå–„äº§å“åŠŸèƒ½ï¼Œæå‡äº§å“è´¨é‡ï¼Œè®©ç”¨æˆ·å‚ä¸äº§å“æµ‹è¯•ï¼ŒåŠ å¼ºä¸ç”¨æˆ·äº’åŠ¨ï¼Œé™ä½äº§å“å‡çº§æ‰€å½±å“çš„ç”¨æˆ·èŒƒå›´ã€‚</p><p>æ•´åˆæœåŠ¡æ³¨å†Œä¸­å¿ƒ</p><h3 id="ä¸‰ã€ç°åº¦å‘å¸ƒè½åœ°æ–¹æ¡ˆ"><a href="#ä¸‰ã€ç°åº¦å‘å¸ƒè½åœ°æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€ç°åº¦å‘å¸ƒè½åœ°æ–¹æ¡ˆ"></a>ä¸‰ã€ç°åº¦å‘å¸ƒè½åœ°æ–¹æ¡ˆ</h3><p>1.nginx+lua+nacos å®ç°ï¼ˆéœ€è¦æ‡‚luaè„šæœ¬ï¼‰ï¼Œé€šè¿‡nginxå®ç°æ•ˆç‡é«˜ã€æœ¬bolg æœ‰ lua æ•™ç¨‹ã€‘</p><p>2.gateway+nacos+é‡å†™æœ¬åœ°è´Ÿè½½å‡è¡¡å™¨ ï¼ˆjavaå®ç°ï¼‰â€”javaç¨‹åºå‘˜æ¨è æ€§èƒ½æ²¡æœ‰ç›´æ¥</p><h3 id="å››ã€åŸç†å›¾"><a href="#å››ã€åŸç†å›¾" class="headerlink" title="å››ã€åŸç†å›¾"></a>å››ã€åŸç†å›¾</h3><h3 id="äº”ã€æ¡ˆä¾‹"><a href="#äº”ã€æ¡ˆä¾‹" class="headerlink" title="äº”ã€æ¡ˆä¾‹"></a>äº”ã€æ¡ˆä¾‹</h3><h2 id="â…¡ã€nginx-ç°åº¦"><a href="#â…¡ã€nginx-ç°åº¦" class="headerlink" title="â…¡ã€nginx ç°åº¦"></a>â…¡ã€nginx ç°åº¦</h2><h3 id="ä¸€ã€"><a href="#ä¸€ã€" class="headerlink" title="ä¸€ã€"></a>ä¸€ã€</h3><h3 id="äºŒã€"><a href="#äºŒã€" class="headerlink" title="äºŒã€"></a>äºŒã€</h3><h3 id="ä¸‰ã€"><a href="#ä¸‰ã€" class="headerlink" title="ä¸‰ã€"></a>ä¸‰ã€</h3><h3 id="å››ã€"><a href="#å››ã€" class="headerlink" title="å››ã€"></a>å››ã€</h3><h3 id="äº”ã€"><a href="#äº”ã€" class="headerlink" title="äº”ã€"></a>äº”ã€</h3><h2 id="å‚è€ƒæ–‡ç« -â†“"><a href="#å‚è€ƒæ–‡ç« -â†“" class="headerlink" title="å‚è€ƒæ–‡ç«  â†“"></a>å‚è€ƒæ–‡ç«  â†“</h2><p>docker-nacoså•ä½“ï¼ˆå¿«é€Ÿï¼‰</p><p><a href="https://www.jb51.net/article/248585.htm">https://www.jb51.net/article/248585.htm</a></p><p>gatway:</p><p><a href="https://blog.csdn.net/u014001523/article/details/125400266">https://blog.csdn.net/u014001523/article/details/125400266</a></p><p><a href="https://blog.csdn.net/qq_43692950/article/details/125226460?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-125226460-blog-125400266.pc_relevant_3mothn_strategy_recovery&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-125226460-blog-125400266.pc_relevant_3mothn_strategy_recovery&amp;utm_relevant_index=2">https://blog.csdn.net/qq_43692950/article/details/125226460?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-1-125226460-blog-125400266.pc_relevant_3mothn_strategy_recovery&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-1-125226460-blog-125400266.pc_relevant_3mothn_strategy_recovery&amp;utm_relevant_index=2</a></p><p>openresty:<a href="https://blog.csdn.net/u014001523/article/details/125400318">https://blog.csdn.net/u014001523/article/details/125400318</a></p><p>openfeigné‡å†™ï¼š<a href="https://www.itmuch.com/spring-cloud-sum/hystrix-threadlocal/">https://www.itmuch.com/spring-cloud-sum/hystrix-threadlocal/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ" scheme="https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"/>
    
    
    <category term="gateway" scheme="https://mykkto.github.io/tags/gateway/"/>
    
    <category term="ç°åº¦å‘å¸ƒ" scheme="https://mykkto.github.io/tags/%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/"/>
    
    <category term="nginx" scheme="https://mykkto.github.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>é¢è¯•é¢˜-01</title>
    <link href="https://mykkto.github.io/posts/726c3129.html"/>
    <id>https://mykkto.github.io/posts/726c3129.html</id>
    <published>2022-10-22T08:16:56.000Z</published>
    <updated>2023-01-02T12:57:46.754Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ç›®å½•ï¼š"><a href="#ç›®å½•ï¼š" class="headerlink" title="ç›®å½•ï¼š"></a>ç›®å½•ï¼š</h2><ul><li>Spring-tx äº‹åŠ¡å¤±æ•ˆåœºæ™¯<ul><li>æ£€æŸ¥å¼‚å¸¸</li><li>é”™è¯¯çš„ try-catch</li><li>åˆ‡é¢é¡ºåº</li><li>épublicåœºæ™¯</li><li>çˆ¶å­å®¹å™¨</li><li>æœ¬ç±»æ–¹æ³•è°ƒç”¨</li><li>åŸå­æ€§ï¼ˆé”å¤±æ•ˆï¼‰</li></ul></li><li>æ•°æ®åº“ç´¢å¼•å¤±æ•ˆåœºæ™¯</li><li></li></ul><h2 id="æºç ï¼š"><a href="#æºç ï¼š" class="headerlink" title="æºç ï¼š"></a>æºç ï¼š</h2><p><a href="https://gitee.com/TK_LIMR/springcloud2021To2021">https://gitee.com/TK_LIMR/springcloud2021To2021</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231430708.png"></p><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h3 id="ä¸€ã€Spring-tx-äº‹åŠ¡å¤±æ•ˆåœºæ™¯"><a href="#ä¸€ã€Spring-tx-äº‹åŠ¡å¤±æ•ˆåœºæ™¯" class="headerlink" title="ä¸€ã€Spring-tx äº‹åŠ¡å¤±æ•ˆåœºæ™¯"></a>ä¸€ã€Spring-tx äº‹åŠ¡å¤±æ•ˆåœºæ™¯</h3><h3 id="1ã€æ£€æŸ¥å¼‚å¸¸"><a href="#1ã€æ£€æŸ¥å¼‚å¸¸" class="headerlink" title="1ã€æ£€æŸ¥å¼‚å¸¸"></a>1ã€æ£€æŸ¥å¼‚å¸¸</h3><h4 id="1ã€å¤±æ•ˆåœºæ™¯"><a href="#1ã€å¤±æ•ˆåœºæ™¯" class="headerlink" title="1ã€å¤±æ•ˆåœºæ™¯"></a>1ã€å¤±æ•ˆåœºæ™¯</h4><h4 id="-1"><a href="#-1" class="headerlink" title=""></a></h4><p>è¿™è¾¹æ„é€ ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶æµï¼Œé€ æˆå¼‚å¸¸æ¨¡æ‹Ÿ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231431260.png"></p><p>æ•°æ®åº“æƒ…å†µ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231432351.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231432321.png"></p><p>å¾ˆæ˜æ˜¾äº‹åŠ¡å¤±æ•ˆäº†</p><h4 id="2ã€è§£å†³æ–¹æ¡ˆ"><a href="#2ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2ã€è§£å†³æ–¹æ¡ˆ"></a>2ã€è§£å†³æ–¹æ¡ˆ</h4><p>åŠ ä¸Šæ³¨è§£ï¼Œå®ç°æœ‰æ„ŸçŸ¥å›æ»š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231450351.png"></p><h3 id="2ã€é”™è¯¯çš„-try-catch"><a href="#2ã€é”™è¯¯çš„-try-catch" class="headerlink" title="2ã€é”™è¯¯çš„ try-catch"></a>2ã€é”™è¯¯çš„ try-catch</h3><h4 id="1ã€å¤±æ•ˆåœºæ™¯-1"><a href="#1ã€å¤±æ•ˆåœºæ™¯-1" class="headerlink" title="1ã€å¤±æ•ˆåœºæ™¯"></a>1ã€å¤±æ•ˆåœºæ™¯</h4><p>è‡ªå·±try åï¼Œå¤–éƒ¨è°ƒç”¨çš„æ–¹æ³•ï¼Œæ— æ„ŸçŸ¥ï¼Œåˆ™æäº¤äº†æ²¡æœ‰å›æ»š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231457909.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231457334.png"></p><h4 id="2ã€è§£å†³æ–¹æ¡ˆ-1"><a href="#2ã€è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="2ã€è§£å†³æ–¹æ¡ˆ"></a>2ã€è§£å†³æ–¹æ¡ˆ</h4><p><strong>æ–¹æ³•ä¸€ï¼š</strong></p><p>å½“ç”¨ try-catch å‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œæ˜¾ç¤ºçš„å¾€ä¸ŠæŠ›ï¼Œè®©ä¸Šå±‚è°ƒç”¨è€…æ„ŸçŸ¥</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231459121.png"></p><p><strong>æ–¹æ³•äºŒï¼š</strong></p><p>è°ƒç”¨äº‹åŠ¡æ–¹æ³•ï¼Œå›æ»šåŠŸèƒ½ï¼Œå¯ä»¥æ˜¾ç¤ºçš„æäº¤æˆ–è€…å›æ»šï¼Œå›æ»šæ•ˆæœå’Œå‘ä¸ŠæŠ›å¼‚å¸¸æ—¶ä¸€æ ·çš„</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231503903.png"></p><h3 id="3ã€åˆ‡é¢é¡ºåº"><a href="#3ã€åˆ‡é¢é¡ºåº" class="headerlink" title="3ã€åˆ‡é¢é¡ºåº"></a>3ã€åˆ‡é¢é¡ºåº</h3><h4 id="1ã€å¤±æ•ˆåœºæ™¯-2"><a href="#1ã€å¤±æ•ˆåœºæ™¯-2" class="headerlink" title="1ã€å¤±æ•ˆåœºæ™¯"></a>1ã€å¤±æ•ˆåœºæ™¯</h4><p>åŸºäºæ£€æŸ¥å¼‚å¸¸+try-catchçš„å¤„ç†åï¼Œä½¿ç”¨äº†åç½®é€šçŸ¥å‘ç°ä¾ç„¶å›æ»šå¤±è´¥</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231534763.png"></p><p><strong>åŸå› </strong></p><p>ä¸»è¦å› ä¸ºå…ˆè¿›å…¥äº‹åŠ¡ï¼Œç„¶åè¿›å…¥åç½®(æœ‰å¼‚å¸¸)ï¼Œåœ¨è¿›å…¥ç›®æ ‡æ–¹æ³•ï¼Œæ­¤æ—¶åç½®å¹¶æ²¡æœ‰å¾€äº‹åŠ¡ä¸ŠæŠ›ï¼Œæ‰€ä»¥æ— æ„ŸçŸ¥</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231637927.png"></p><h4 id="2ã€è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰"><a href="#2ã€è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰" class="headerlink" title="2ã€è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰"></a>2ã€è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰</h4><p>è®¾ç½®åç½®çš„ä¼˜å…ˆçº§é«˜äºäº‹åŠ¡ï¼Œè¿™æ ·äº‹åŠ¡åœ¨åé¢è¿è¡Œï¼Œæ—¢å¯ä»¥æ„ŸçŸ¥åˆ°å¼‚å¸¸</p><p><strong>æ–¹æ³•ä¸€</strong></p><p>åœ¨åˆ‡é¢ catch æ—¶å€™é‡‡ç”¨ æ£€æŸ¥å¼‚å¸¸ æˆ–è€… try-catch ä¸Šé¢ä¸¤ç§æ–¹æ³•åœ¨ åˆ‡é¢æ–¹æ³•æ”¹åŠ¨</p><p><strong>æ–¹æ³•äºŒ</strong></p><p>è®¾ç½®ä¼˜å…ˆçº§é«˜äºäº‹åŠ¡</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231650943.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231654793.png"></p><h3 id="4ã€épublicåœºæ™¯"><a href="#4ã€épublicåœºæ™¯" class="headerlink" title="4ã€épublicåœºæ™¯"></a>4ã€épublicåœºæ™¯</h3><h4 id="1ã€å¤±æ•ˆåœºæ™¯-3"><a href="#1ã€å¤±æ•ˆåœºæ™¯-3" class="headerlink" title="1ã€å¤±æ•ˆåœºæ™¯"></a>1ã€å¤±æ•ˆåœºæ™¯</h4><p>æ–¹æ³•è®¾ç½®ä¸ºé»˜è®¤ épublic ï¼Œäº‹åŠ¡å¤±æ•ˆ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231701980.png"></p><h4 id="2ã€è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰-1"><a href="#2ã€è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰-1" class="headerlink" title="2ã€è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰"></a>2ã€è§£å†³æ–¹æ¡ˆï¼ˆä¸æ¨èï¼‰</h4><p>ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œé»˜è®¤true åªå¯¹ public æ–¹æ³•ç”Ÿæ•ˆ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231703269.png"></p><h3 id="5ã€çˆ¶å­å®¹å™¨"><a href="#5ã€çˆ¶å­å®¹å™¨" class="headerlink" title="5ã€çˆ¶å­å®¹å™¨"></a>5ã€çˆ¶å­å®¹å™¨</h3><h4 id="1ã€å¤±æ•ˆåœºæ™¯-4"><a href="#1ã€å¤±æ•ˆåœºæ™¯-4" class="headerlink" title="1ã€å¤±æ•ˆåœºæ™¯"></a>1ã€å¤±æ•ˆåœºæ™¯</h4><p>ç®€å•æ¥è¯´å°±æ˜¯æ”¾åœ¨ controller ä¸Šè°ƒç”¨ serviceï¼Œä¹Ÿæ˜¯å¼€å‘ä¸­å¸¸è§çš„åœºæ™¯</p><p>åŸå› ï¼šå­å®¹å™¨æ‰«æèŒƒå›´è¿‡å¤§ï¼ŒæŠŠæœªåŠ äº‹åŠ¡é…ç½®çš„ service æ‰«æè¿›æ¥</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210231942105.png"></p><h4 id="2ã€è§£å†³æ–¹æ¡ˆ-2"><a href="#2ã€è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="2ã€è§£å†³æ–¹æ¡ˆ"></a>2ã€è§£å†³æ–¹æ¡ˆ</h4><p>åœ¨springbooté‡ä¸åˆ°ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªå®¹å™¨ã€‚é€šå¸¸å‡ºç°åœ¨ä¼ ç»Ÿé¡¹ç›®ï¼ˆspring+MVCæ•´åˆçš„æ—¶å€™ï¼‰ï¼Œä¼šé‡åˆ°æ‰«æçˆ¶å­å®¹å™¨ã€‚Springæ‰«spring,MVCæ‰«mvcè‡ªå·±çš„åŒ…ï¼Œå°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰«æ•´ä¸ªä¸Šå±‚åŒ…</p><h3 id="6ã€æœ¬ç±»æ–¹æ³•è°ƒç”¨"><a href="#6ã€æœ¬ç±»æ–¹æ³•è°ƒç”¨" class="headerlink" title="6ã€æœ¬ç±»æ–¹æ³•è°ƒç”¨"></a>6ã€æœ¬ç±»æ–¹æ³•è°ƒç”¨</h3><h4 id="1ã€å¤±æ•ˆåœºæ™¯-5"><a href="#1ã€å¤±æ•ˆåœºæ™¯-5" class="headerlink" title="1ã€å¤±æ•ˆåœºæ™¯"></a>1ã€å¤±æ•ˆåœºæ™¯</h4><p>æœ¬ç±»ä¸¤ä¸ªæ–¹æ³•ç›¸äº’è°ƒç”¨</p><p><strong>åŸå› </strong></p><p>æœ¬ç±»è°ƒç”¨ï¼Œä¸ç»è¿‡ä»£ç†ï¼Œå› æ­¤æ— æ³•å¢å¼ºï¼Œå¯¼è‡´ä¸¤ä¸ªäº‹åŠ¡å…¬ç”¨ä¸€ä¸ª</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210232034376.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210232038217.png"></p><h4 id="2ã€è§£å†³æ–¹æ¡ˆ-3"><a href="#2ã€è§£å†³æ–¹æ¡ˆ-3" class="headerlink" title="2ã€è§£å†³æ–¹æ¡ˆ"></a>2ã€è§£å†³æ–¹æ¡ˆ</h4><p><strong>æ–¹æ³•ä¸€</strong></p><p>è‡ªå·±æ³¨å…¥è‡ªå·±</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210232037056.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210232037020.png"></p><p><strong>æ–¹æ³•äºŒ</strong></p><p>ä» Aopä¸­ä»£ç†è°ƒç”¨</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210232044254.png"></p><h3 id="7ã€åŸå­æ€§ï¼ˆé”å¤±æ•ˆï¼‰"><a href="#7ã€åŸå­æ€§ï¼ˆé”å¤±æ•ˆï¼‰" class="headerlink" title="7ã€åŸå­æ€§ï¼ˆé”å¤±æ•ˆï¼‰"></a>7ã€åŸå­æ€§ï¼ˆé”å¤±æ•ˆï¼‰</h3><h4 id="1ã€å¤±æ•ˆåœºæ™¯-6"><a href="#1ã€å¤±æ•ˆåœºæ™¯-6" class="headerlink" title="1ã€å¤±æ•ˆåœºæ™¯"></a>1ã€å¤±æ•ˆåœºæ™¯</h4><p>Jmeter æ¨¡æ‹Ÿ100ä¸ªçº¿ç¨‹æ¯ç§’</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210232143042.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210232142003.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210232141576.png"></p><h4 id="2ã€è§£å†³æ–¹æ¡ˆ-4"><a href="#2ã€è§£å†³æ–¹æ¡ˆ-4" class="headerlink" title="2ã€è§£å†³æ–¹æ¡ˆ"></a>2ã€è§£å†³æ–¹æ¡ˆ</h4><p>ç”¨ synchronize èƒ½è§£å†³ï¼Ÿï¼Ÿ</p><p>ç­”æ¡ˆï¼šä¸èƒ½</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210232147419.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210232147341.png"></p><p><strong>@Transactional æ²¡æœ‰ä¿è¯åŸå­çš„åŸå› </strong>ï¼š</p><p>äº‹åŠ¡çš„åŸå­æ€§ä»…è¦†ç›– inset,update,delete ï¼›select è¯­å¥ä¸è¦†ç›–ï¼Œselect æ–¹æ³•ä¸é˜»å¡</p><p><strong>@Transactional å¯¼è‡´ synchronize å¤±æ•ˆçš„åŸå› </strong>ï¼š</p><p>synchronize ä»…ä¿è¯ç›®æ ‡æ–¹æ³•çš„åŸå­æ€§ï¼Œç¯ç»•æ–¹æ³•çš„è¿˜æœ‰ commit (äº‹åŠ¡æäº¤)ç­‰æ“ä½œï¼Œä»–ä»¬å¹¶æœªå¤„äº sync åŒæ­¥å—ä¸­</p><p><strong>æ–¹æ¡ˆ1ï¼šï¼ˆä¸æ¨èï¼‰</strong></p><p>ä¿®æ”¹ synchronize ä½ç½®èŒƒå›´æ‰©å¤§è‡³ä»£ç†æ–¹æ³•è°ƒç”¨(ä¸Šå±‚å¹¶å‘æ¥å£ä½ç½®)</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202210232230437.png"></p><p><strong>æ–¹æ¡ˆ2ï¼šï¼ˆæ¨èï¼‰</strong></p><p>ä¿®æ”¹ SQL è¯­å¥ æŠŠ select æ›¿æ¢æˆ select â€¦for update</p><h3 id="äºŒã€æ•°æ®åº“ç´¢å¼•å¤±æ•ˆåœºæ™¯"><a href="#äºŒã€æ•°æ®åº“ç´¢å¼•å¤±æ•ˆåœºæ™¯" class="headerlink" title="äºŒã€æ•°æ®åº“ç´¢å¼•å¤±æ•ˆåœºæ™¯"></a>äºŒã€æ•°æ®åº“ç´¢å¼•å¤±æ•ˆåœºæ™¯</h3><p><strong>1ã€like ä»¥%å¼€å¤´ï¼Œç´¢å¼•æ— æ•ˆï¼›å½“likeå‰ç¼€æ²¡æœ‰%ï¼Œåç¼€æœ‰%æ—¶ï¼Œç´¢å¼•æœ‰æ•ˆ</strong></p><p><strong>2ã€orè¯­å¥å‰åæ²¡æœ‰åŒæ—¶ä½¿ç”¨ç´¢å¼•</strong></p><p>å½“orå·¦å³æŸ¥è¯¢å­—æ®µåªæœ‰ä¸€ä¸ªæ˜¯ç´¢å¼•ï¼Œè¯¥ç´¢å¼•å¤±æ•ˆï¼Œåªæœ‰å½“orå·¦å³æŸ¥è¯¢å­—æ®µå‡ä¸ºç´¢å¼•æ—¶ï¼Œæ‰ä¼šç”Ÿæ•ˆ</p><p><strong>3ã€ç»„åˆç´¢å¼•ï¼Œä¸æ˜¯ä½¿ç”¨ç¬¬ä¸€åˆ—ç´¢å¼•ï¼Œç´¢å¼•å¤±æ•ˆ</strong></p><p><strong>4ã€å¦‚æœåˆ—ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¸€å®šè¦åœ¨æ¡ä»¶ä¸­å°†æ•°æ®ä½¿ç”¨å¼•å·å¼•ç”¨èµ·æ¥ï¼Œå¦åˆ™ä¸ä½¿ç”¨ç´¢å¼•</strong></p><p>æ•°æ®ç±»å‹å‡ºç°éšå¼è½¬åŒ–ã€‚å¦‚varcharä¸åŠ å•å¼•å·çš„è¯å¯èƒ½ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºintå‹ï¼Œä½¿ç´¢å¼•æ— æ•ˆï¼Œäº§ç”Ÿå…¨è¡¨æ‰«æã€‚</p><p><strong>5ã€åœ¨ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨notï¼Œ&lt;&gt;ï¼Œ!=</strong></p><p>ä¸ç­‰äºæ“ä½œç¬¦æ˜¯æ°¸è¿œä¸ä¼šç”¨åˆ°ç´¢å¼•çš„ï¼Œå› æ­¤å¯¹å®ƒçš„å¤„ç†åªä¼šäº§ç”Ÿå…¨è¡¨æ‰«æã€‚ ä¼˜åŒ–æ–¹æ³•ï¼š key&lt;&gt;0 æ”¹ä¸º key&gt;0 or key&lt;0ã€‚</p><p><strong>6ã€å¯¹ç´¢å¼•å­—æ®µè¿›è¡Œè®¡ç®—æ“ä½œ æˆ–è€… å­—æ®µä¸Šä½¿ç”¨å‡½æ•°ã€‚</strong></p><p><strong>7ã€å½“å…¨è¡¨æ‰«æé€Ÿåº¦æ¯”ç´¢å¼•é€Ÿåº¦å¿«æ—¶ï¼Œmysqlä¼šä½¿ç”¨å…¨è¡¨æ‰«æï¼Œæ­¤æ—¶ç´¢å¼•å¤±æ•ˆ</strong></p><h3 id="ä¸‰ã€"><a href="#ä¸‰ã€" class="headerlink" title="ä¸‰ã€"></a>ä¸‰ã€</h3><h4 id="1ã€"><a href="#1ã€" class="headerlink" title="1ã€"></a>1ã€</h4><h4 id="2ã€"><a href="#2ã€" class="headerlink" title="2ã€"></a>2ã€</h4><h4 id="3ã€"><a href="#3ã€" class="headerlink" title="3ã€"></a>3ã€</h4><h4 id="4ã€"><a href="#4ã€" class="headerlink" title="4ã€"></a>4ã€</h4><h4 id="5ã€"><a href="#5ã€" class="headerlink" title="5ã€"></a>5ã€</h4><h2 id="å‚è€ƒ-â†“"><a href="#å‚è€ƒ-â†“" class="headerlink" title="å‚è€ƒ â†“"></a>å‚è€ƒ â†“</h2><p>springboot é…ç½® jdbctemplate :<a href="https://blog.csdn.net/u014553029/article/details/101130291">https://blog.csdn.net/u014553029/article/details/101130291</a></p><p>äº‹åŠ¡å¤±æ•ˆå®Œæ•´åœºæ™¯ï¼š<a href="https://www.csdn.net/tags/MtTagg3sMjU0NTEtYmxvZwO0O0OO0O0O.html">https://www.csdn.net/tags/MtTagg3sMjU0NTEtYmxvZwO0O0OO0O0O.html</a></p><p>ç´¢å¼•å¤±æ•ˆï¼š<a href="https://m.php.cn/article/487049.html">https://m.php.cn/article/487049.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="é¢è¯•é¢˜" scheme="https://mykkto.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
    
    <category term="é¢è¯•" scheme="https://mykkto.github.io/tags/%E9%9D%A2%E8%AF%95/"/>
    
    <category term="äº‹åŠ¡" scheme="https://mykkto.github.io/tags/%E4%BA%8B%E5%8A%A1/"/>
    
    <category term="spring-tx" scheme="https://mykkto.github.io/tags/spring-tx/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ-å…¥é—¨+å®æˆ˜ç¯‡</title>
    <link href="https://mykkto.github.io/posts/faf1dfc8.html"/>
    <id>https://mykkto.github.io/posts/faf1dfc8.html</id>
    <published>2022-10-08T15:21:32.000Z</published>
    <updated>2022-11-12T15:07:08.042Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="æºä»£ç ä½ç½®"><a href="#æºä»£ç ä½ç½®" class="headerlink" title="æºä»£ç ä½ç½®"></a>æºä»£ç ä½ç½®</h2><p><a href="https://gitee.com/TK_LIMR/springcloud2021To2021">https://gitee.com/TK_LIMR/springcloud2021To2021</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210082337634.png"></p><h2 id="ç›®å½•ï¼š"><a href="#ç›®å½•ï¼š" class="headerlink" title="ç›®å½•ï¼š"></a>ç›®å½•ï¼š</h2><ul><li><p>å…¥é—¨</p><ul><li>æ¦‚è¿°</li><li>å¿«é€Ÿå…¥é—¨æ¡ˆä¾‹</li><li>å·¥ä½œæ¨¡å¼æ¡ˆä¾‹</li><li>æ•´åˆSpring</li><li>æ•´åˆSpringBoot</li></ul></li><li><p>å®æˆ˜</p><ul><li>é«˜çº§ç‰¹æ€§<ul><li>æ¶ˆæ¯å¯é æ€§æŠ•é€’ï¼ˆç”Ÿäº§è€… -&gt; MQï¼‰</li><li>Consumer ACK (MQ -&gt; æ¶ˆè´¹è€…)</li><li>æ¶ˆè´¹ç«¯é™æµ</li><li>TTL è¿‡æœŸæ—¶é—´</li><li>æ­»ä¿¡é˜Ÿåˆ—</li><li>â˜… å»¶è¿Ÿé˜Ÿåˆ— </li><li>X æ—¥å¿—ä¸ç›‘æ§ï¼ˆäº†è§£ï¼‰</li><li>X æ¶ˆæ¯å¯é æ€§åˆ†æä¸è¿½è¸ªï¼ˆæ…ç”¨ï¼‰</li><li>X ç®¡ç†</li></ul></li><li>åº”ç”¨é—®é¢˜<ul><li>æ¶ˆæ¯å¯é æ€§ä¿éšœ<ul><li>æ¶ˆæ¯è¡¥å¿æœºåˆ¶</li></ul></li><li>æ¶ˆæ¯å¹‚ç­‰æ€§å¤„ç†<ul><li>ä¹è§‚é”è§£å†³æ–¹æ¡ˆ</li></ul></li></ul></li><li>é«˜å¯ç”¨é›†ç¾¤æ­å»º</li></ul></li></ul><h2 id="â… ã€å…¥é—¨ç¯‡"><a href="#â… ã€å…¥é—¨ç¯‡" class="headerlink" title="â… ã€å…¥é—¨ç¯‡"></a>â… ã€å…¥é—¨ç¯‡</h2><h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><h3 id="1ã€MQæ¦‚è¿°"><a href="#1ã€MQæ¦‚è¿°" class="headerlink" title="1ã€MQæ¦‚è¿°"></a>1ã€MQæ¦‚è¿°</h3><h4 id="æ˜¯ä»€ä¹ˆï¼š"><a href="#æ˜¯ä»€ä¹ˆï¼š" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼š"></a>æ˜¯ä»€ä¹ˆï¼š</h4><p>MQå…¨ç§° Message Queueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œæ˜¯åœ¨æ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ä¸­ä¿å­˜æ¶ˆæ¯çš„å®¹å™¨ã€‚å¤šç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´è¿›è¡Œé€šä¿¡</p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092134272.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092134946.png"></p><h4 id="å°ç»“ï¼š"><a href="#å°ç»“ï¼š" class="headerlink" title="å°ç»“ï¼š"></a>å°ç»“ï¼š</h4><ul><li>MQï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯çš„ä¸­é—´ä»¶ </li><li>åˆ†å¸ƒå¼ç³»ç»Ÿé€šä¿¡ä¸¤ç§æ–¹å¼ï¼šç›´æ¥è¿œç¨‹è°ƒç”¨ å’Œ å€ŸåŠ©ç¬¬ä¸‰æ–¹ å®Œæˆé—´æ¥é€šä¿¡ </li><li>å‘é€æ–¹ç§°ä¸ºç”Ÿäº§è€…ï¼Œæ¥æ”¶æ–¹ç§°ä¸ºæ¶ˆè´¹è€…</li></ul><h3 id="2ã€MQä¼˜åŠ¿å’ŒåŠ£åŠ¿"><a href="#2ã€MQä¼˜åŠ¿å’ŒåŠ£åŠ¿" class="headerlink" title="2ã€MQä¼˜åŠ¿å’ŒåŠ£åŠ¿"></a>2ã€MQä¼˜åŠ¿å’ŒåŠ£åŠ¿</h3><h4 id="1ã€ä¼˜åŠ¿"><a href="#1ã€ä¼˜åŠ¿" class="headerlink" title="1ã€ä¼˜åŠ¿"></a>1ã€ä¼˜åŠ¿</h4><ul><li>åº”ç”¨è§£è€¦</li><li>å¼‚æ­¥æé€Ÿ</li><li>å‰Šå³°å¡«è°·</li></ul><h4 id="1-1ã€åº”ç”¨è§£è€¦"><a href="#1-1ã€åº”ç”¨è§£è€¦" class="headerlink" title="1-1ã€åº”ç”¨è§£è€¦"></a>1-1ã€åº”ç”¨è§£è€¦</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092141083.png"></p><p>ä¼ ç»Ÿæ–¹å¼ï¼Œè®¢å•ç³»ç»Ÿè¦å‘é€æŒ‡å®šç³»ç»Ÿï¼Œæˆ–è€…æ‰“æ–­æŒ‡å®šç³»ç»Ÿçš„å‘é€éœ€è¦ä¿®æ”¹è®¢å•ç³»ç»Ÿä»£ç </p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092143705.png"></p><p>å¼•å…¥ mqï¼Œå‘é€ç»™mqå³å¯ï¼Œé€‰æ‹©æˆ–è€…æ‰“æ–­æŒ‡å®šç³»ç»Ÿå‘é€åªéœ€è¦æ§åˆ¶ topicè§„åˆ™å³å¯ï¼Œä½¿å¾—åº”ç”¨è§£è€¦ï¼Œæå‡å®¹é”™æ€§å’Œå¯ç»´æŠ¤æ€§</p><h4 id="1-2ã€å¼‚æ­¥æé€Ÿ"><a href="#1-2ã€å¼‚æ­¥æé€Ÿ" class="headerlink" title="1-2ã€å¼‚æ­¥æé€Ÿ"></a>1-2ã€å¼‚æ­¥æé€Ÿ</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092147654.png"></p><p>ä¸€ä¸ªä¸‹å•æ“ä½œè€—æ—¶ï¼š20 + 300 + 300 + 300 = 920ms ï¼Œç”¨æˆ·ç‚¹å‡»å®Œä¸‹å•æŒ‰é’®åï¼Œéœ€è¦ç­‰å¾…920msæ‰èƒ½å¾—åˆ°ä¸‹å•å“åº”ï¼Œå¤ªæ…¢ï¼ </p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092148893.png"></p><p>ç”¨æˆ·ç‚¹å‡»å®Œä¸‹å•æŒ‰é’®åï¼Œåªéœ€ç­‰å¾…25mså°±èƒ½å¾—åˆ°ä¸‹å•å“åº” (20 + 5 = 25ms)ã€‚ </p><p>æå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿååé‡ï¼ˆå•ä½æ—¶é—´å†…å¤„ç†è¯·æ±‚çš„æ•°ç›®ï¼‰</p><h4 id="1-3ã€å‰Šå³°å¡«è°·"><a href="#1-3ã€å‰Šå³°å¡«è°·" class="headerlink" title="1-3ã€å‰Šå³°å¡«è°·"></a>1-3ã€å‰Šå³°å¡«è°·</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092150352.png"></p><p>ä¼ ç»Ÿæ¨¡å¼å½“å¤§é‡å¹¶å‘æ¥ä¸´ï¼Œå¯èƒ½å°†ç³»ç»Ÿå†²å®</p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092150963.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092200717.png"></p><p>ä½¿ç”¨äº† MQ ä¹‹åï¼Œé™åˆ¶æ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦ä¸º1000ï¼Œè¿™æ ·ä¸€æ¥ï¼Œé«˜å³°æœŸäº§ç”Ÿçš„æ•°æ®åŠ¿å¿…ä¼šè¢«ç§¯å‹åœ¨ MQ ä¸­ï¼Œé«˜å³° </p><p>å°±è¢«â€œå‰Šâ€æ‰äº†ï¼Œä½†æ˜¯å› ä¸ºæ¶ˆæ¯ç§¯å‹ï¼Œåœ¨é«˜å³°æœŸè¿‡åçš„ä¸€æ®µæ—¶é—´å†…ï¼Œæ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦è¿˜æ˜¯ä¼šç»´æŒåœ¨1000ï¼Œç›´åˆ°æ¶ˆè´¹å®Œç§¯å‹çš„æ¶ˆæ¯ï¼Œè¿™å°±å«åšâ€œå¡«è°·â€ã€‚ </p><h4 id="1-4ã€å°ç»“"><a href="#1-4ã€å°ç»“" class="headerlink" title="1-4ã€å°ç»“"></a>1-4ã€å°ç»“</h4><ul><li>åº”ç”¨è§£è€¦ï¼šæé«˜ç³»ç»Ÿå®¹é”™æ€§å’Œå¯ç»´æŠ¤æ€§</li><li>å¼‚æ­¥æé€Ÿï¼šæå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿååé‡</li><li>å‰Šå³°å¡«è°·ï¼šæé«˜ç³»ç»Ÿç¨³å®šæ€§</li></ul><h4 id="2ã€åŠ£åŠ¿"><a href="#2ã€åŠ£åŠ¿" class="headerlink" title="2ã€åŠ£åŠ¿"></a>2ã€åŠ£åŠ¿</h4><ul><li>ç³»ç»Ÿå¯ç”¨æ€§é™ä½</li><li>ç³»ç»Ÿå¤æ‚åº¦å˜é«˜</li><li>ä¸€è‡´æ€§é—®é¢˜</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092203294.png"></p><h4 id="2-1ã€ç³»ç»Ÿå¯ç”¨æ€§é™ä½"><a href="#2-1ã€ç³»ç»Ÿå¯ç”¨æ€§é™ä½" class="headerlink" title="2-1ã€ç³»ç»Ÿå¯ç”¨æ€§é™ä½"></a>2-1ã€ç³»ç»Ÿå¯ç”¨æ€§é™ä½</h4><p>ç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œç³»ç»Ÿç¨³å®šæ€§è¶Šå·®ï¼Œéœ€è¦ä¿è¯å¯ç”¨çš„è¶Šå¤šï¼›ä¸€æ—¦MQå®•æœºï¼Œå°±ä¼šå¯¹ä¸šåŠ¡å½±å“ï¼ˆå¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿï¼Ÿ  é›†ç¾¤ï¼‰</p><h4 id="2-2ã€ç³»ç»Ÿå¤æ‚åº¦æé«˜"><a href="#2-2ã€ç³»ç»Ÿå¤æ‚åº¦æé«˜" class="headerlink" title="2-2ã€ç³»ç»Ÿå¤æ‚åº¦æé«˜"></a>2-2ã€ç³»ç»Ÿå¤æ‚åº¦æé«˜</h4><p>ä¼ ç»Ÿçš„ç³»ç»Ÿæ˜¯åŒæ­¥è°ƒç”¨ï¼Œç°åœ¨é€šè¿‡MQå¼‚æ­¥è°ƒç”¨ï¼ˆå¦‚ä½•ä¿è¯æ¶ˆæ¯æ²¡æœ‰é‡å¤æ¶ˆè´¹ï¼Œæ€ä¹ˆå¤„ç†æ¶ˆæ¯ä¸¢å¤±é—®é¢˜ï¼Œä»¥åŠæ¶ˆæ¯çš„æœ‰åºæ€§ï¼‰</p><h4 id="2-3ã€ä¸€è‡´æ€§é—®é¢˜"><a href="#2-3ã€ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="2-3ã€ä¸€è‡´æ€§é—®é¢˜"></a>2-3ã€ä¸€è‡´æ€§é—®é¢˜</h4><p>Aç³»ç»Ÿå¤„ç†å®Œä¸šåŠ¡ï¼Œé€šè¿‡MQç»™ B,C,D ä¸‰ä¸ªç³»ç»Ÿå‘é€æ¶ˆæ¯ï¼Œå¦‚æœB,CæˆåŠŸã€Då¤±è´¥ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ</p><h4 id="2-4ã€å°ç»“"><a href="#2-4ã€å°ç»“" class="headerlink" title="2-4ã€å°ç»“"></a>2-4ã€å°ç»“</h4><p>æ—¢ç„¶ MQ æœ‰ä¼˜åŠ¿ä¹Ÿæœ‰åŠ£åŠ¿ï¼Œé‚£ä¹ˆä½¿ç”¨ MQ éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶å‘¢ï¼Ÿ</p><ul><li>ç”Ÿäº§è€…ä¸éœ€è¦ä»æ¶ˆè´¹è€…å¤„è·å–åé¦ˆï¼›ä¸Šå±‚ä¸éœ€è¦ç­‰å¾…ä¸‹å±‚å›è°ƒå¤„ç†ï¼Œæ‰èƒ½è®©å¼‚æ­¥æˆä¸ºå¯èƒ½</li><li>å®¹è®¸çŸ­æš‚çš„ä¸ä¸€è‡´æ€§</li><li>åœ¨è§£è€¦ã€æé€Ÿã€å‰Šå³°æ–¹é¢çš„æ”¶ç›Šï¼Œå¤§äºç®¡ç†MQçš„æˆæœ¬</li></ul><h3 id="3ã€å¸¸è§MQå¯¹æ¯”"><a href="#3ã€å¸¸è§MQå¯¹æ¯”" class="headerlink" title="3ã€å¸¸è§MQå¯¹æ¯”"></a>3ã€å¸¸è§MQå¯¹æ¯”</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092229549.png"></p><h3 id="4ã€RabbitMQç®€ä»‹"><a href="#4ã€RabbitMQç®€ä»‹" class="headerlink" title="4ã€RabbitMQç®€ä»‹"></a>4ã€RabbitMQç®€ä»‹</h3><h4 id="1ã€æ¶æ„å›¾"><a href="#1ã€æ¶æ„å›¾" class="headerlink" title="1ã€æ¶æ„å›¾"></a>1ã€æ¶æ„å›¾</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092235471.png"></p><h4 id="2ã€ç»„ä»¶è¯´æ˜ï¼ˆâ†‘ï¼‰"><a href="#2ã€ç»„ä»¶è¯´æ˜ï¼ˆâ†‘ï¼‰" class="headerlink" title="2ã€ç»„ä»¶è¯´æ˜ï¼ˆâ†‘ï¼‰"></a>2ã€ç»„ä»¶è¯´æ˜ï¼ˆâ†‘ï¼‰</h4><ul><li>Brokerï¼šæ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Serverå°±æ˜¯ Message Broker</li><li>Virtual hostï¼šå‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠ AMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºç½‘ ç»œä¸­çš„ namespace æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ª RabbitMQ server æä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤š ä¸ªvhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ vhost åˆ›å»º exchangeï¼queue ç­‰ </li><li>Connectionï¼špublisherï¼consumer å’Œ broker ä¹‹é—´çš„ TCP è¿æ¥</li><li>Channelï¼šå¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ª Connectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹ TCP Connection çš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channel æ˜¯åœ¨ connection å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ ç¨‹ï¼Œé€šå¸¸æ¯ä¸ªthreadåˆ›å»ºå•ç‹¬çš„ channel è¿›è¡Œé€šè®¯ï¼ŒAMQP method åŒ…å«äº†channel id å¸®åŠ©å®¢æˆ·ç«¯å’Œ message broker è¯†åˆ« channelï¼Œæ‰€ä»¥ channel ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channel ä½œä¸ºè½»é‡çº§çš„ Connection  æå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹ TCP connection çš„å¼€é”€</li><li>Exchangeï¼šmessage åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œåˆ†å‘æ¶ˆæ¯åˆ°  queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šdirect (point-to-point), topic (publish-subscribe) and fanout (multicast)</li><li>Queueï¼šæ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾… consumer å–èµ°</li><li>Bindingï¼šexchange å’Œ queue ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbinding ä¸­å¯ä»¥åŒ…å« routing keyã€‚Binding ä¿¡æ¯è¢«ä¿å­˜åˆ° exchange ä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äº message çš„åˆ†å‘ä¾æ®</li></ul><h4 id="3ã€RabbitMQ-6ä¸­å·¥ä½œæ¨¡å¼"><a href="#3ã€RabbitMQ-6ä¸­å·¥ä½œæ¨¡å¼" class="headerlink" title="3ã€RabbitMQ 6ä¸­å·¥ä½œæ¨¡å¼"></a>3ã€RabbitMQ 6ä¸­å·¥ä½œæ¨¡å¼</h4><p>ç®€å•æ¨¡å¼ã€work queuesã€Publish/Subscribe å‘å¸ƒä¸è®¢é˜…æ¨¡å¼ã€Routing </p><p>è·¯ç”±æ¨¡å¼ã€Topics ä¸»é¢˜æ¨¡å¼ã€RPC è¿œç¨‹è°ƒç”¨æ¨¡å¼ï¼ˆè¿œç¨‹è°ƒç”¨ï¼Œä¸å¤ªç®— MQï¼›ä¸ä½œä»‹ç»ï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092247367.png"></p><h4 id="4ã€JMS"><a href="#4ã€JMS" class="headerlink" title="4ã€JMS"></a>4ã€<strong>JMS</strong></h4><ul><li>JMS å³   Java å¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„API </li><li>JMS æ˜¯ JavaEE è§„èŒƒä¸­çš„ä¸€ç§ï¼Œç±»æ¯”JDBC</li><li>å¾ˆå¤šæ¶ˆæ¯ä¸­é—´ä»¶éƒ½å®ç°äº†JMSè§„èŒƒï¼Œä¾‹å¦‚ï¼šActiveMQã€‚RabbitMQ å®˜æ–¹æ²¡æœ‰æä¾› JMS çš„å®ç°åŒ…ï¼Œä½†æ˜¯å¼€æºç¤¾åŒºæœ‰</li></ul><h4 id="5ã€RabbitMQå°ç»“"><a href="#5ã€RabbitMQå°ç»“" class="headerlink" title="5ã€RabbitMQå°ç»“"></a>5ã€RabbitMQå°ç»“</h4><ul><li>RabbitMQ æ˜¯åŸºäº AMQP åè®®ä½¿ç”¨ Erlang è¯­è¨€å¼€å‘çš„ä¸€æ¬¾æ¶ˆæ¯é˜Ÿåˆ—äº§å“</li><li>RabbitMQæä¾›äº†6ç§å·¥ä½œæ¨¡å¼ï¼Œæˆ‘ä»¬å­¦ä¹ 5ç§</li><li>AMQP æ˜¯åè®®ï¼Œç±»æ¯”HTTP</li><li>JMS æ˜¯ API è§„èŒƒæ¥å£ï¼Œç±»æ¯” JDBC</li></ul><h2 id="äºŒã€å¿«é€Ÿå…¥é—¨"><a href="#äºŒã€å¿«é€Ÿå…¥é—¨" class="headerlink" title="äºŒã€å¿«é€Ÿå…¥é—¨"></a>äºŒã€å¿«é€Ÿå…¥é—¨</h2><h3 id="1ã€æ­¥éª¤"><a href="#1ã€æ­¥éª¤" class="headerlink" title="1ã€æ­¥éª¤"></a>1ã€æ­¥éª¤</h3><p>ä½¿ç”¨ç®€å•æ¨¡å¼å®Œæˆæ¶ˆæ¯ä¼ é€’ï¼š</p><p>â‘  åˆ›å»ºå·¥ç¨‹ï¼ˆç”Ÿæˆè€…ã€æ¶ˆè´¹è€…ï¼‰ </p><p>â‘¡ åˆ†åˆ«æ·»åŠ ä¾èµ– </p><p>â‘¢ ç¼–å†™ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ </p><p>â‘£ ç¼–å†™æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092257321.png"></p><h3 id="2ã€å°ç»“"><a href="#2ã€å°ç»“" class="headerlink" title="2ã€å°ç»“"></a>2ã€å°ç»“</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210092258177.png"></p><p>åœ¨ä¸Šå›¾çš„æ¨¡å‹ä¸­ï¼Œæœ‰ä»¥ä¸‹æ¦‚å¿µï¼š</p><ul><li>Pï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åº </li><li>Cï¼šæ¶ˆè´¹è€…ï¼šæ¶ˆæ¯çš„æ¥æ”¶è€…ï¼Œä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ï¼ˆçº¿ç¨‹ä¸€ç›´åœ¨ç›‘å¬ï¼‰</li><li>queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå›¾ä¸­çº¢è‰²éƒ¨åˆ†ã€‚ç±»ä¼¼ä¸€ä¸ªé‚®ç®±ï¼Œå¯ä»¥ç¼“å­˜æ¶ˆæ¯ï¼›ç”Ÿäº§è€…å‘å…¶ä¸­æŠ•é€’æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä»å…¶ä¸­å–å‡ºæ¶ˆæ¯</li></ul><h2 id="ä¸‰ã€å·¥ä½œæ¨¡å¼"><a href="#ä¸‰ã€å·¥ä½œæ¨¡å¼" class="headerlink" title="ä¸‰ã€å·¥ä½œæ¨¡å¼"></a>ä¸‰ã€å·¥ä½œæ¨¡å¼</h2><h3 id="1ã€Work-queues-å·¥ä½œé˜Ÿåˆ—æ¨¡å¼"><a href="#1ã€Work-queues-å·¥ä½œé˜Ÿåˆ—æ¨¡å¼" class="headerlink" title="1ã€Work queues å·¥ä½œé˜Ÿåˆ—æ¨¡å¼"></a>1ã€<strong>Work queues å·¥ä½œé˜Ÿåˆ—æ¨¡å¼</strong></h3><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210102229031.png"></p><h4 id="1ã€è¯´æ˜"><a href="#1ã€è¯´æ˜" class="headerlink" title="1ã€è¯´æ˜"></a>1ã€è¯´æ˜</h4><ul><li><strong>Work Queuesï¼š</strong>ä¸å…¥é—¨ç¨‹åºçš„ç®€å•æ¨¡å¼ç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ªæˆ–ä¸€äº›æ¶ˆè´¹ç«¯ï¼Œå¤šä¸ªæ¶ˆè´¹ç«¯å…±åŒæ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šå¯¹äºä»»åŠ¡è¿‡é‡æˆ–ä»»åŠ¡è¾ƒå¤šæƒ…å†µä½¿ç”¨å·¥ä½œé˜Ÿåˆ—å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†çš„é€Ÿåº¦ã€‚</li></ul><h4 id="2ã€ä»£ç "><a href="#2ã€ä»£ç " class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210102236513.png"></p><h4 id="3ã€å°ç»“"><a href="#3ã€å°ç»“" class="headerlink" title="3ã€å°ç»“"></a>3ã€å°ç»“</h4><ul><li>åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­å¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…ä¹‹é—´å¯¹äºåŒä¸€ä¸ªæ¶ˆæ¯çš„å…³ç³»æ˜¯<strong>ç«äº‰</strong>çš„å…³ç³»ã€‚ </li><li>Work Queues  å¯¹äºä»»åŠ¡è¿‡é‡æˆ–ä»»åŠ¡è¾ƒå¤šæƒ…å†µä½¿ç”¨å·¥ä½œé˜Ÿåˆ—å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†çš„é€Ÿåº¦ã€‚ä¾‹å¦‚ï¼šçŸ­ä¿¡æœåŠ¡éƒ¨ç½²å¤šä¸ªï¼Œåªéœ€è¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æˆåŠŸå‘é€å³å¯ã€‚</li></ul><h3 id="2ã€Pub-Sub-è®¢é˜…æ¨¡å¼"><a href="#2ã€Pub-Sub-è®¢é˜…æ¨¡å¼" class="headerlink" title="2ã€Pub/Sub è®¢é˜…æ¨¡å¼"></a>2ã€<strong>Pub/Sub è®¢é˜…æ¨¡å¼</strong></h3><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210102249529.png"></p><p>åœ¨è®¢é˜…æ¨¡å‹ä¸­ï¼Œå¤šäº†ä¸€ä¸ª Exchange è§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š</p><ul><li>Pï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™Xï¼ˆäº¤æ¢æœºï¼‰</li><li>Cï¼šæ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯çš„æ¥æ”¶è€…ï¼Œä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥</li><li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯</li><li>Xï¼šExchangeï¼šäº¤æ¢æœºï¼Œä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚Exchangeæœ‰å¸¸è§ä»¥ä¸‹3ç§ç±»å‹ï¼š<ul><li>Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—</li><li>Directï¼šå®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting key çš„é˜Ÿåˆ—</li><li>Topicï¼šé€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰çš„é˜Ÿåˆ—</li></ul></li></ul><p><strong>Exchange</strong>ï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸ Exchange ç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±</p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210102309609.png"></p><p>å°ç»“ï¼š</p><ul><li>äº¤æ¢æœºéœ€è¦ä¸é˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œç»‘å®šä¹‹åï¼›ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…éƒ½æ”¶åˆ°</li><li>å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸å·¥ä½œé˜Ÿåˆ—æ¨¡å¼çš„åŒºåˆ«ï¼š<ul><li>å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ä¸ç”¨å®šä¹‰äº¤æ¢æœºï¼Œè€Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼éœ€è¦å®šä¹‰äº¤æ¢æœº</li><li>å‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„ç”Ÿäº§æ–¹æ˜¯é¢å‘äº¤æ¢æœºå‘é€æ¶ˆæ¯ï¼Œå·¥ä½œé˜Ÿåˆ—æ¨¡å¼çš„ç”Ÿäº§æ–¹æ˜¯é¢å‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯(åº•å±‚ä½¿ç”¨é»˜è®¤äº¤æ¢æœº) </li><li>å‘å¸ƒ/è®¢é˜…æ¨¡å¼éœ€è¦è®¾ç½®é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®šï¼Œå·¥ä½œé˜Ÿåˆ—æ¨¡å¼ä¸éœ€è¦è®¾ç½®ï¼Œå®é™…ä¸Šå·¥ä½œé˜Ÿåˆ—æ¨¡å¼ä¼šå°†é˜Ÿåˆ—ç»‘å®šåˆ°é»˜è®¤çš„äº¤æ¢æœº</li></ul></li></ul><h3 id="3ã€Routing-è·¯ç”±æ¨¡å¼"><a href="#3ã€Routing-è·¯ç”±æ¨¡å¼" class="headerlink" title="3ã€Routing è·¯ç”±æ¨¡å¼"></a>3ã€<strong>Routing è·¯ç”±æ¨¡å¼</strong></h3><h4 id="1ã€æ¨¡å¼è¯´æ˜"><a href="#1ã€æ¨¡å¼è¯´æ˜" class="headerlink" title="1ã€æ¨¡å¼è¯´æ˜"></a>1ã€æ¨¡å¼è¯´æ˜</h4><ul><li>é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ª RoutingKeyï¼ˆè·¯ç”±keyï¼‰ </li><li>æ¶ˆæ¯çš„å‘é€æ–¹åœ¨å‘ Exchange å‘é€æ¶ˆæ¯ç»™ Consumer æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ RoutingKey</li><li>Exchange ä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„ Routing Key è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„ Routingkey ä¸æ¶ˆæ¯çš„ Routing key å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯</li></ul><h4 id="2ã€å›¾è§£"><a href="#2ã€å›¾è§£" class="headerlink" title="2ã€å›¾è§£"></a>2ã€å›¾è§£</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210102333166.png"></p><ul><li>Pï¼šç”Ÿäº§è€…ï¼Œå‘ Exchange å‘é€æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šæŒ‡å®šä¸€ä¸ªrouting key</li><li>Xï¼šExchangeï¼ˆäº¤æ¢æœºï¼‰ï¼Œæ¥æ”¶ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œç„¶åæŠŠæ¶ˆæ¯é€’äº¤ç»™ä¸ routing key å®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—</li><li>C1ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦ routing key ä¸º error çš„æ¶ˆæ¯</li><li>C2ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦ routing key ä¸º infoã€errorã€warning çš„æ¶ˆæ¯</li></ul><h4 id="3ã€ä»£ç "><a href="#3ã€ä»£ç " class="headerlink" title="3ã€ä»£ç "></a>3ã€ä»£ç </h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210111953871.png"></p><h4 id="4ã€å°ç»“"><a href="#4ã€å°ç»“" class="headerlink" title="4ã€å°ç»“"></a>4ã€å°ç»“</h4><p><strong>Routing</strong> æ¨¡å¼è¦æ±‚é˜Ÿåˆ—åœ¨ç»‘å®šäº¤æ¢æœºæ—¶è¦æŒ‡å®š <strong>routing key</strong>ï¼Œæ¶ˆæ¯ä¼šè½¬å‘åˆ°ç¬¦åˆ routing key çš„é˜Ÿåˆ—ã€‚</p><h3 id="4ã€Topics-é€šé…ç¬¦æ¨¡å¼"><a href="#4ã€Topics-é€šé…ç¬¦æ¨¡å¼" class="headerlink" title="4ã€Topics é€šé…ç¬¦æ¨¡å¼"></a>4ã€<strong>Topics é€šé…ç¬¦æ¨¡å¼</strong></h3><h4 id="1ã€è¯´æ˜-1"><a href="#1ã€è¯´æ˜-1" class="headerlink" title="1ã€è¯´æ˜"></a>1ã€è¯´æ˜</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210111955491.png"></p><p>Q1 Queueï¼šç»‘å®šçš„æ˜¯ usa.# ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ usa. å¼€å¤´çš„ routing key éƒ½ä¼šè¢«åŒ¹é…åˆ°</p><p>Q2 Queueï¼šç»‘å®šçš„æ˜¯ #.news ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ .news ç»“å°¾çš„ routing key éƒ½ä¼šè¢«åŒ¹é…</p><h4 id="2ã€ä»£ç -1"><a href="#2ã€ä»£ç -1" class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210112101689.png"></p><h4 id="3ã€å°ç»“-1"><a href="#3ã€å°ç»“-1" class="headerlink" title="3ã€å°ç»“"></a>3ã€å°ç»“</h4><p>Topic ä¸»é¢˜æ¨¡å¼å¯ä»¥å®ç° Pub/Sub å‘å¸ƒä¸è®¢é˜…æ¨¡å¼å’Œ Routing è·¯ç”±æ¨¡å¼çš„åŠŸèƒ½ï¼Œåªæ˜¯ Topic åœ¨é…ç½®routing key çš„æ—¶å€™å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œæ˜¾å¾—æ›´åŠ çµæ´»ã€‚</p><h3 id="5ã€å·¥ä½œæ¨¡å¼æ€»ç»“"><a href="#5ã€å·¥ä½œæ¨¡å¼æ€»ç»“" class="headerlink" title="5ã€å·¥ä½œæ¨¡å¼æ€»ç»“"></a>5ã€å·¥ä½œæ¨¡å¼æ€»ç»“</h3><ol><li><p>ç®€å•æ¨¡å¼ HelloWorld ï¼šä¸€ä¸ªç”Ÿäº§è€…ã€ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰ã€‚ </p></li><li><p>å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ Work Queue ï¼šä¸€ä¸ªç”Ÿäº§è€…ã€å¤šä¸ªæ¶ˆè´¹è€…ï¼ˆç«äº‰å…³ç³»ï¼‰ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰ã€‚ </p></li><li><p>å‘å¸ƒè®¢é˜…æ¨¡å¼ Publish/subscribe ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º fanout çš„äº¤æ¢æœºï¼Œå¹¶ä¸”äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šå°†æ¶ˆæ¯å‘é€åˆ°ç»‘å®šçš„é˜Ÿåˆ—ã€‚ </p></li><li><p>è·¯ç”±æ¨¡å¼ Routing ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º direct çš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®š routing keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ® routing key å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚ </p></li><li><p>é€šé…ç¬¦æ¨¡å¼ Topic ï¼šéœ€è¦è®¾ç½®ç±»å‹ä¸º topic çš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®šé€šé…ç¬¦æ–¹å¼çš„ routing keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ® routing key å°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚</p></li></ol><h2 id="å››ã€Spring-æ•´åˆ-RabbitMQ"><a href="#å››ã€Spring-æ•´åˆ-RabbitMQ" class="headerlink" title="å››ã€Spring æ•´åˆ RabbitMQ"></a>å››ã€Spring æ•´åˆ RabbitMQ</h2><h3 id="1ã€ä»£ç "><a href="#1ã€ä»£ç " class="headerlink" title="1ã€ä»£ç "></a>1ã€ä»£ç </h3><h4 id="1-1ã€ç”Ÿäº§è€…"><a href="#1-1ã€ç”Ÿäº§è€…" class="headerlink" title="1-1ã€ç”Ÿäº§è€…"></a>1-1ã€ç”Ÿäº§è€…</h4><p>â‘  åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ </p><p>â‘¡ æ·»åŠ ä¾èµ– </p><p>â‘¢ é…ç½®æ•´åˆ </p><p>â‘£ ç¼–å†™ä»£ç å‘é€æ¶ˆæ¯ </p><h4 id="1-2ã€æ¶ˆè´¹è€…"><a href="#1-2ã€æ¶ˆè´¹è€…" class="headerlink" title="1-2ã€æ¶ˆè´¹è€…"></a>1-2ã€æ¶ˆè´¹è€…</h4><p>â‘  åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹ </p><p>â‘¡ æ·»åŠ ä¾èµ– </p><p>â‘¢ é…ç½®æ•´åˆ </p><p>â‘£ ç¼–å†™æ¶ˆæ¯ç›‘å¬å™¨</p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210112244387.png"></p><h3 id="2ã€å°ç»“-1"><a href="#2ã€å°ç»“-1" class="headerlink" title="2ã€å°ç»“"></a>2ã€å°ç»“</h3><ul><li>ä½¿ç”¨ Spring æ•´åˆ RabbitMQ å°†ç»„ä»¶å…¨éƒ¨ä½¿ç”¨é…ç½®æ–¹å¼å®ç°ï¼Œç®€åŒ–ç¼–ç  </li><li>Spring æä¾› RabbitTemplate ç®€åŒ–å‘é€æ¶ˆæ¯ API </li><li>ä½¿ç”¨ç›‘å¬æœºåˆ¶ç®€åŒ–æ¶ˆè´¹è€…ç¼–ç </li></ul><h2 id="äº”ã€SpringBoot-æ•´åˆ-RabbitMQ"><a href="#äº”ã€SpringBoot-æ•´åˆ-RabbitMQ" class="headerlink" title="äº”ã€SpringBoot æ•´åˆ RabbitMQ"></a>äº”ã€SpringBoot æ•´åˆ RabbitMQ</h2><h3 id="1ã€ä»£ç -1"><a href="#1ã€ä»£ç -1" class="headerlink" title="1ã€ä»£ç "></a>1ã€ä»£ç </h3><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210112252668.png"></p><h2 id="â…¡ã€å®æˆ˜ç¯‡"><a href="#â…¡ã€å®æˆ˜ç¯‡" class="headerlink" title="â…¡ã€å®æˆ˜ç¯‡"></a>â…¡ã€å®æˆ˜ç¯‡</h2><h2 id="ä¸€ã€é«˜çº§ç‰¹æ€§"><a href="#ä¸€ã€é«˜çº§ç‰¹æ€§" class="headerlink" title="ä¸€ã€é«˜çº§ç‰¹æ€§"></a>ä¸€ã€é«˜çº§ç‰¹æ€§</h2><h3 id="1ã€æ¶ˆæ¯å¯é æ€§æŠ•é€’ï¼ˆç”Ÿäº§è€…-gt-MQï¼‰"><a href="#1ã€æ¶ˆæ¯å¯é æ€§æŠ•é€’ï¼ˆç”Ÿäº§è€…-gt-MQï¼‰" class="headerlink" title="1ã€æ¶ˆæ¯å¯é æ€§æŠ•é€’ï¼ˆç”Ÿäº§è€…  ->  MQï¼‰"></a>1ã€æ¶ˆæ¯å¯é æ€§æŠ•é€’ï¼ˆç”Ÿäº§è€…  -&gt;  MQï¼‰</h3><hr><h4 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h4><p>åœ¨ä½¿ç”¨ RabbitMQ çš„æ—¶å€™ï¼Œä½œä¸ºæ¶ˆæ¯å‘é€æ–¹å¸Œæœ›æœç»ä»»ä½•æ¶ˆæ¯ä¸¢å¤±æˆ–è€…æŠ•é€’å¤±è´¥åœºæ™¯ã€‚RabbitMQ ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§æ–¹å¼ç”¨æ¥æ§åˆ¶æ¶ˆæ¯çš„æŠ•é€’å¯é æ€§æ¨¡å¼ã€‚ </p><ul><li>ç¡®è®¤æ¨¡å¼</li><li>å›é€€æ¨¡å¼</li></ul><p><strong>rabbitmq æ•´ä¸ªæ¶ˆæ¯æŠ•é€’çš„è·¯å¾„ä¸ºï¼š</strong></p><p>producer  â€”&gt; rabbitmq broker â€”&gt; exchange â€”&gt; queue â€”&gt; consumer</p><ul><li>æ¶ˆæ¯ä» producer åˆ° exchange åˆ™ä¼šè¿”å›ä¸€ä¸ª confirmCallback çš„å›è°ƒ</li><li>æ¶ˆæ¯ä» exchange åˆ° queue æŠ•é€’å¤±è´¥åˆ™è¿”å›ä¸€ä¸ª returnCallback å›è°ƒ</li></ul><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸¤ä¸ª callback å›è°ƒ æ§åˆ¶æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’</p><h4 id="2ã€ä»£ç -2"><a href="#2ã€ä»£ç -2" class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210162224718.png"></p><h4 id="3ã€å°ç»“-2"><a href="#3ã€å°ç»“-2" class="headerlink" title="3ã€å°ç»“"></a>3ã€å°ç»“</h4><ul><li><p>è®¾ç½®ConnectionFactoryçš„publisher-confirms=â€trueâ€ å¼€å¯ ç¡®è®¤æ¨¡å¼</p></li><li><p>ä½¿ç”¨rabbitTemplate.setConfirmCallbackè®¾ç½®å›è°ƒå‡½æ•°ã€‚å½“æ¶ˆæ¯å‘é€åˆ°exchangeåå› </p><p>è°ƒconfirmæ–¹æ³•ã€‚åœ¨æ–¹æ³•ä¸­åˆ¤æ–­ackï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™å‘é€æˆåŠŸï¼Œå¦‚æœä¸ºfalseï¼Œåˆ™å‘ </p><p>é€å¤±è´¥ï¼Œéœ€è¦å¤„ç†</p></li><li><p>è®¾ç½®ConnectionFactoryçš„publisher-returns=â€trueâ€ å¼€å¯ é€€å›æ¨¡å¼</p></li><li><p>ä½¿ç”¨rabbitTemplate.setReturnCallbackè®¾ç½®é€€å›å‡½æ•°ï¼Œå½“æ¶ˆæ¯ä»exchangeè·¯ç”±åˆ° </p><p>queueå¤±è´¥åï¼Œå¦‚æœè®¾ç½®äº†rabbitTemplate.setMandatory(true)å‚æ•°ï¼Œåˆ™ä¼šå°†æ¶ˆæ¯é€€ </p><p>å›ç»™producerã€‚å¹¶æ‰§è¡Œå›è°ƒå‡½æ•°returnedMessage</p></li><li><p>åœ¨RabbitMQä¸­ä¹Ÿæä¾›äº†äº‹åŠ¡æœºåˆ¶ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®ï¼Œæ­¤å¤„ä¸åšè®²è§£ã€‚ </p><p>ä½¿ç”¨channelä¸‹åˆ—æ–¹æ³•ï¼Œå®Œæˆäº‹åŠ¡æ§åˆ¶ï¼š </p><p>txSelect(), ç”¨äºå°†å½“å‰channelè®¾ç½®æˆtransactionæ¨¡å¼ </p><p>txCommit()ï¼Œç”¨äºæäº¤äº‹åŠ¡ </p><p>txRollback(),ç”¨äºå›æ»šäº‹åŠ¡</p></li></ul><h3 id="2ã€Consumer-Ack"><a href="#2ã€Consumer-Ack" class="headerlink" title="2ã€Consumer Ack"></a>2ã€<strong>Consumer Ack</strong></h3><p><strong>MQ -&gt; æ¶ˆè´¹è€…</strong></p><h4 id="1ã€æ¦‚è¿°-1"><a href="#1ã€æ¦‚è¿°-1" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h4><p>ackæŒ‡Acknowledgeï¼Œç¡®è®¤ã€‚ è¡¨ç¤ºæ¶ˆè´¹ç«¯æ”¶åˆ°æ¶ˆæ¯åçš„ç¡®è®¤æ–¹å¼ã€‚ </p><p>æœ‰ä¸‰ç§ç¡®è®¤æ–¹å¼ï¼š </p><p>â€¢ è‡ªåŠ¨ç¡®è®¤ï¼šacknowledge=â€noneâ€ </p><p>â€¢ æ‰‹åŠ¨ç¡®è®¤ï¼šacknowledge=â€manualâ€ </p><p>â€¢ æ ¹æ®å¼‚å¸¸æƒ…å†µç¡®è®¤ï¼šacknowledge=â€autoâ€ï¼Œï¼ˆè¿™ç§æ–¹å¼ä½¿ç”¨éº»çƒ¦ï¼Œä¸ä½œè®²è§£ï¼‰</p><p>å…¶ä¸­è‡ªåŠ¨ç¡®è®¤æ˜¯æŒ‡ï¼Œå½“æ¶ˆæ¯ä¸€æ—¦è¢«Consumeræ¥æ”¶åˆ°ï¼Œåˆ™è‡ªåŠ¨ç¡®è®¤æ”¶åˆ°ï¼Œå¹¶å°†ç›¸åº” message RabbitMQ çš„æ¶ˆæ¯ç¼“å­˜ä¸­ç§»é™¤ã€‚ä½†æ˜¯åœ¨å®é™…ä¸šåŠ¡å¤„ç†ä¸­ï¼Œå¾ˆå¯èƒ½æ¶ˆæ¯æ¥æ”¶åˆ°ï¼Œä¸šåŠ¡å¤„ç†å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚å¦‚æœè®¾ç½®äº†æ‰‹åŠ¨ç¡®è®¤æ–¹å¼ï¼Œåˆ™éœ€è¦åœ¨ä¸šåŠ¡å¤„ç†æˆåŠŸåï¼Œè°ƒç”¨channel.basicAck()ï¼Œæ‰‹åŠ¨ç­¾æ”¶ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨channel.basicNack()æ–¹æ³•ï¼Œè®©å…¶è‡ªåŠ¨é‡æ–°å‘é€æ¶ˆæ¯ã€‚</p><h4 id="2ã€ä»£ç -3"><a href="#2ã€ä»£ç -3" class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210201914384.png"></p><h4 id="3ã€å°ç»“-3"><a href="#3ã€å°ç»“-3" class="headerlink" title="3ã€å°ç»“"></a>3ã€å°ç»“</h4><ul><li>åœ¨rabbit:listener-containeræ ‡ç­¾ä¸­è®¾ç½®acknowledgeå±æ€§ï¼Œè®¾ç½®ackæ–¹å¼ <ul><li>noneï¼šè‡ªåŠ¨ç¡®è®¤ï¼Œ</li><li>manualï¼šæ‰‹åŠ¨ç¡®è®¤ </li></ul></li><li>å¦‚æœåœ¨æ¶ˆè´¹ç«¯æ²¡æœ‰å‡ºç°å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨channel.basicAck(deliveryTag,false);æ–¹æ³•ç¡®è®¤ç­¾æ”¶æ¶ˆæ¯ </li><li>å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™åœ¨catchä¸­è°ƒç”¨ basicNackæˆ– basicRejectï¼Œæ‹’ç»æ¶ˆæ¯ï¼Œè®©MQé‡æ–°å‘é€æ¶ˆæ¯ã€‚</li></ul><h3 id="3ã€æ¶ˆæ¯å¯é æ€§æ€»ç»“"><a href="#3ã€æ¶ˆæ¯å¯é æ€§æ€»ç»“" class="headerlink" title="3ã€æ¶ˆæ¯å¯é æ€§æ€»ç»“"></a>3ã€æ¶ˆæ¯å¯é æ€§æ€»ç»“</h3><ul><li><p>æŒä¹…åŒ– </p><ul><li>exchangeè¦æŒä¹…åŒ– </li><li>queueè¦æŒä¹…åŒ– </li><li>messageè¦æŒä¹…åŒ– </li></ul></li><li><p>ç”Ÿäº§æ–¹ç¡®è®¤Confirm </p></li><li><p>æ¶ˆè´¹æ–¹ç¡®è®¤Ack</p></li><li><p>Brokeré«˜å¯ç”¨</p></li></ul><h3 id="4ã€æ¶ˆè´¹ç«¯é™æµ"><a href="#4ã€æ¶ˆè´¹ç«¯é™æµ" class="headerlink" title="4ã€æ¶ˆè´¹ç«¯é™æµ"></a>4ã€æ¶ˆè´¹ç«¯é™æµ</h3><h4 id="1ã€æ¦‚å¿µ"><a href="#1ã€æ¦‚å¿µ" class="headerlink" title="1ã€æ¦‚å¿µ"></a>1ã€æ¦‚å¿µ</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210202118692.png"></p><h4 id="2ã€ä»£ç -4"><a href="#2ã€ä»£ç -4" class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210162342353.png"></p><h4 id="3ã€å°ç»“-4"><a href="#3ã€å°ç»“-4" class="headerlink" title="3ã€å°ç»“"></a>3ã€å°ç»“</h4><ul><li>åœ¨<a href="rabbit:listener-container">rabbit:listener-container</a> ä¸­é…ç½® prefetchå±æ€§è®¾ç½®æ¶ˆè´¹ç«¯ä¸€æ¬¡æ‹‰å–å¤šå°‘æ¶ˆæ¯ </li><li>æ¶ˆè´¹ç«¯çš„ç¡®è®¤æ¨¡å¼ä¸€å®šä¸ºæ‰‹åŠ¨ç¡®è®¤ã€‚acknowledge=â€manualâ€</li></ul><h3 id="5ã€TTL-è¿‡æœŸæ—¶é—´"><a href="#5ã€TTL-è¿‡æœŸæ—¶é—´" class="headerlink" title="5ã€TTL è¿‡æœŸæ—¶é—´"></a>5ã€TTL è¿‡æœŸæ—¶é—´</h3><h4 id="1ã€æ¦‚è¿°-2"><a href="#1ã€æ¦‚è¿°-2" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h4><ul><li>TTL å…¨ç§° Time To Liveï¼ˆå­˜æ´»æ—¶é—´/è¿‡æœŸæ—¶é—´ï¼‰</li><li>å½“æ¶ˆæ¯åˆ°è¾¾å­˜æ´»æ—¶é—´åï¼Œè¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œä¼šè¢«è‡ªåŠ¨æ¸…é™¤</li><li>RabbitMQå¯ä»¥å¯¹æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå¯ä»¥å¯¹æ•´ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰è®¾ç½®è¿‡æœŸæ—¶é—´</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210202120659.png"></p><h4 id="2ã€ä»£ç -5"><a href="#2ã€ä»£ç -5" class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210202131038.png"></p><h4 id="3ã€å°ç»“-5"><a href="#3ã€å°ç»“-5" class="headerlink" title="3ã€å°ç»“"></a>3ã€å°ç»“</h4><ul><li>è®¾ç½®é˜Ÿåˆ—è¿‡æœŸæ—¶é—´ä½¿ç”¨å‚æ•°ï¼šx-message-ttlï¼Œå•ä½ï¼šms(æ¯«ç§’)ï¼Œä¼šå¯¹æ•´ä¸ªé˜Ÿåˆ—æ¶ˆæ¯ç»Ÿä¸€è¿‡æœŸ</li><li>è®¾ç½®æ¶ˆæ¯è¿‡æœŸæ—¶é—´ä½¿ç”¨å‚æ•°ï¼šexpirationã€‚å•ä½ï¼šms(æ¯«ç§’)ï¼Œå½“è¯¥æ¶ˆæ¯åœ¨é˜Ÿåˆ—å¤´éƒ¨æ—¶ï¼ˆæ¶ˆè´¹æ—¶ï¼‰ï¼Œä¼šå•ç‹¬åˆ¤æ–­è¿™ä¸€æ¶ˆæ¯æ˜¯å¦è¿‡æœŸ</li><li>å¦‚æœä¸¤è€…éƒ½è¿›è¡Œäº†è®¾ç½®ï¼Œä»¥æ—¶é—´çŸ­çš„ä¸ºå‡†</li></ul><h3 id="6ã€æ­»ä¿¡é˜Ÿåˆ—"><a href="#6ã€æ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="6ã€æ­»ä¿¡é˜Ÿåˆ—"></a>6ã€æ­»ä¿¡é˜Ÿ<strong>åˆ—</strong></h3><h4 id="1ã€æ¦‚è¿°-3"><a href="#1ã€æ¦‚è¿°-3" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h4><p><strong>æ­»ä¿¡é˜Ÿåˆ—å…¶å®è¯´çš„å°±æ˜¯ç§ä¿¡äº¤æ¢æœº</strong></p><p>æ­»ä¿¡é˜Ÿåˆ—ï¼Œè‹±æ–‡ç¼©å†™ï¼šDLX ã€‚Dead Letter Exchangeï¼ˆæ­»ä¿¡äº¤æ¢æœºï¼‰ï¼Œå½“æ¶ˆæ¯æˆä¸ºDead messageåï¼Œå¯ä»¥è¢«é‡æ–°å‘é€åˆ°å¦ä¸€ä¸ªäº¤æ¢æœºï¼Œè¿™ä¸ªäº¤æ¢æœºå°±æ˜¯DLX</p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210202139176.png"></p><p><strong>æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µï¼š</strong> </p><ol><li><p>é˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦åˆ°è¾¾é™åˆ¶ï¼› ï¼ˆèƒ½æ”¾10æ¡ï¼Œæ”¾äº†11æ¡ï¼Œ1æ¡è¶…è¿‡è¢«æˆä¸ºæ­»ä¿¡ï¼‰ï¼Œå¯ä»¥è®¾ç½®é˜Ÿåˆ—å­˜æ”¾çš„æ•°é‡</p></li><li><p>æ¶ˆè´¹è€…æ‹’æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼ŒbasicNack/basicRejectï¼›å¹¶ä¸”ä¸æŠŠæ¶ˆæ¯é‡æ–°æ”¾å…¥åŸç›®æ ‡é˜Ÿåˆ—,requeue=falseï¼› </p></li><li><p>åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯è¿‡æœŸè®¾ç½®ï¼Œæ¶ˆæ¯åˆ°è¾¾è¶…æ—¶æ—¶é—´æœªè¢«æ¶ˆè´¹ï¼›</p></li></ol><p><strong>é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº</strong></p><p>ç»™é˜Ÿåˆ—è®¾ç½®å‚æ•°ï¼š x-dead-letter-exchange å’Œ x-dead-letter-routing-key</p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210202143643.png"></p><h4 id="2ã€ä»£ç -6"><a href="#2ã€ä»£ç -6" class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210202224114.png"></p><h4 id="3ã€å°ç»“-6"><a href="#3ã€å°ç»“-6" class="headerlink" title="3ã€å°ç»“"></a>3ã€å°ç»“</h4><ul><li>æ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—å’Œæ™®é€šçš„æ²¡æœ‰åŒºåˆ«</li><li>å½“æ¶ˆæ¯æˆä¸ºæ­»ä¿¡åï¼Œå¦‚æœè¯¥é˜Ÿåˆ—ç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœºï¼Œåˆ™æ¶ˆæ¯ä¼šè¢«æ­»ä¿¡äº¤æ¢æœºé‡æ–°è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—</li><li>æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ<ul><li>é˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦åˆ°è¾¾é™åˆ¶</li><li>æ¶ˆè´¹è€…æ‹’æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸é‡å›é˜Ÿåˆ—</li><li>åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯è¿‡æœŸè®¾ç½®ï¼Œæ¶ˆæ¯åˆ°è¾¾è¶…æ—¶æ—¶é—´æœªè¢«æ¶ˆè´¹</li></ul></li></ul><h3 id="7ã€å»¶è¿Ÿé˜Ÿåˆ—"><a href="#7ã€å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="7ã€å»¶è¿Ÿé˜Ÿåˆ—"></a>7ã€å»¶è¿Ÿé˜Ÿåˆ—</h3><h4 id="1ã€æ¦‚å¿µ-1"><a href="#1ã€æ¦‚å¿µ-1" class="headerlink" title="1ã€æ¦‚å¿µ"></a>1ã€æ¦‚å¿µ</h4><p>å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå³æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—åä¸ä¼šç«‹å³è¢«æ¶ˆè´¹ï¼Œåªæœ‰åˆ°è¾¾æŒ‡å®šæ—¶é—´åï¼Œæ‰ä¼šè¢«æ¶ˆè´¹</p><p><strong>éœ€æ±‚ï¼š</strong></p><ul><li>ä¸‹å•åï¼Œ30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œå–æ¶ˆè®¢å•ï¼Œå›æ»šåº“å­˜</li><li>æ–°ç”¨æˆ·æ³¨å†ŒæˆåŠŸ7å¤©åï¼Œå‘é€çŸ­ä¿¡é—®å€™</li></ul><p><strong>å®ç°æ–¹å¼ï¼š</strong></p><ul><li>å®šæ—¶å™¨</li><li>å»¶è¿Ÿé˜Ÿåˆ—</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210202243511.png"></p><p>å¾ˆå¯æƒœï¼Œåœ¨RabbitMQä¸­å¹¶æœªæä¾›å»¶è¿Ÿé˜Ÿåˆ—åŠŸèƒ½ã€‚ </p><p>ä½†æ˜¯å¯ä»¥ä½¿ç”¨ï¼šTTL+æ­»ä¿¡é˜Ÿåˆ— ç»„åˆå®ç°å»¶è¿Ÿé˜Ÿåˆ—çš„æ•ˆæœ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210202245709.png"></p><h4 id="2ã€ä»£ç -7"><a href="#2ã€ä»£ç -7" class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><p><img src="https://v1.mykkto.cn/image/blog/2022/mq/rabbitmq/202210202245024.png"></p><h4 id="3ã€å°ç»“-7"><a href="#3ã€å°ç»“-7" class="headerlink" title="3ã€å°ç»“"></a>3ã€å°ç»“</h4><ul><li>å»¶è¿Ÿé˜Ÿåˆ— æŒ‡æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—åï¼Œå¯ä»¥è¢«å»¶è¿Ÿä¸€å®šæ—¶é—´ï¼Œå†è¿›è¡Œæ¶ˆè´¹</li><li>RabbitMQæ²¡æœ‰æä¾›å»¶è¿Ÿé˜Ÿåˆ—åŠŸèƒ½ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ ï¼š TTL + DLX æ¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—æ•ˆæœ</li></ul><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="äºŒã€åº”ç”¨é—®é¢˜"><a href="#äºŒã€åº”ç”¨é—®é¢˜" class="headerlink" title="äºŒã€åº”ç”¨é—®é¢˜"></a>äºŒã€åº”ç”¨é—®é¢˜</h2><h3 id="1ã€"><a href="#1ã€" class="headerlink" title="1ã€"></a>1ã€</h3><h2 id="å‚è€ƒæ–‡çŒ®-â†“"><a href="#å‚è€ƒæ–‡çŒ®-â†“" class="headerlink" title="å‚è€ƒæ–‡çŒ® â†“"></a>å‚è€ƒæ–‡çŒ® â†“</h2><p>windownå®‰è£… rabbitmq ï¼š<a href="https://blog.csdn.net/qq_25919879/article/details/113055350">https://blog.csdn.net/qq_25919879/article/details/113055350</a></p><p>docker å®‰è£… rabbitmqï¼š<a href="https://www.jb51.net/article/233585.htm">https://www.jb51.net/article/233585.htm</a> </p><p>docker å®‰è£…å ç•Œé¢ç«¯åŠŸèƒ½ç¼ºå¤±é—®é¢˜ï¼š<a href="https://blog.csdn.net/qq_45369827/article/details/115921401">https://blog.csdn.net/qq_45369827/article/details/115921401</a></p><p>springboot-rabbitmq ç¡®è®¤æ¨¡å¼å¼ƒç”¨é…ç½®ï¼š<a href="https://blog.csdn.net/z69183787/article/details/109371628">https://blog.csdn.net/z69183787/article/details/109371628</a></p><p>å•å…ƒæµ‹è¯•ï¼Œå‘å¸ƒç¡®è®¤å›è°ƒ ack æ€»æ˜¯ falseï¼š<a href="https://blog.csdn.net/dh554112075/article/details/90137869">https://blog.csdn.net/dh554112075/article/details/90137869</a></p><p>spring-boot æ­»ä¿¡é˜Ÿåˆ—ï¼š<a href="https://blog.csdn.net/weixin_52062043/article/details/127077941">https://blog.csdn.net/weixin_52062043/article/details/127077941</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="æ¶ˆæ¯ä¸­é—´ä»¶" scheme="https://mykkto.github.io/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
    <category term="amqp" scheme="https://mykkto.github.io/tags/amqp/"/>
    
    <category term="rabbitmq" scheme="https://mykkto.github.io/tags/rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>Netty-å®ç”¨ç¯‡</title>
    <link href="https://mykkto.github.io/posts/bb8f1edf.html"/>
    <id>https://mykkto.github.io/posts/bb8f1edf.html</id>
    <published>2022-08-21T05:22:33.000Z</published>
    <updated>2022-11-12T15:07:08.027Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="æºä»£ç ä½ç½®"><a href="#æºä»£ç ä½ç½®" class="headerlink" title="æºä»£ç ä½ç½®"></a>æºä»£ç ä½ç½®</h2><p><a href="https://gitee.com/TK_LIMR/springcloud2021To2021">https://gitee.com/TK_LIMR/springcloud2021To2021</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208201706838.png"></p><h2 id="ç›®å½•ï¼š"><a href="#ç›®å½•ï¼š" class="headerlink" title="ç›®å½•ï¼š"></a>ç›®å½•ï¼š</h2><ul><li>ç½‘ç»œç¼–ç¨‹<ul><li>ä¸‰æ¬¡æ¡æ‰‹</li><li>åŸºç¡€åé¢ä¼šåœ¨å…¶ä»–æ–‡ç« æ›´æ–°</li></ul></li><li>nio<ul><li>ä¸‰å¤§ç»„ä»¶</li><li>ByteBufferè¯¦è§£</li><li>æ–‡ä»¶ç¼–ç¨‹</li><li>ç½‘ç»œç¼–ç¨‹</li><li>nio vs bio vs aio</li></ul></li><li>netty<ul><li>å…¥é—¨</li><li>è¿›é˜¶</li><li>ä¼˜åŒ–</li><li>å®æˆ˜</li><li>æºç </li></ul></li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202208201259923.png"></p><h2 id="â… ã€NIO"><a href="#â… ã€NIO" class="headerlink" title="â… ã€NIO"></a>â… ã€NIO</h2><h2 id="ä¸€ã€ä¸‰å¤§ç»„ä»¶"><a href="#ä¸€ã€ä¸‰å¤§ç»„ä»¶" class="headerlink" title="ä¸€ã€ä¸‰å¤§ç»„ä»¶"></a>ä¸€ã€ä¸‰å¤§ç»„ä»¶</h2><h3 id="1ã€Channel-amp-Buffer"><a href="#1ã€Channel-amp-Buffer" class="headerlink" title="1ã€Channel &amp; Buffer"></a>1ã€Channel &amp; Buffer</h3><p>channel æœ‰ä¸€ç‚¹ç±»ä¼¼äº streamï¼Œå®ƒå°±æ˜¯è¯»å†™æ•°æ®çš„<strong>åŒå‘é€šé“</strong>ï¼Œå¯ä»¥ä» channel å°†æ•°æ®è¯»å…¥ bufferï¼Œä¹Ÿå¯ä»¥å°† buffer çš„æ•°æ®å†™å…¥ channelï¼Œè€Œä¹‹å‰çš„ stream è¦ä¹ˆæ˜¯è¾“å…¥ï¼Œè¦ä¹ˆæ˜¯è¾“å‡ºï¼Œchannel æ¯” stream æ›´ä¸ºåº•å±‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202208201612733.png"></p><p>å¸¸è§çš„ Channel æœ‰</p><ul><li>FileChannel</li><li>DatagramChannel</li><li>SocketChannel</li><li>ServerSocketChannel</li></ul><p>buffer åˆ™ç”¨æ¥ç¼“å†²è¯»å†™æ•°æ®ï¼Œå¸¸è§çš„ buffer æœ‰</p><ul><li>ByteBuffer<ul><li>MappedByteBuffer</li><li>DirectByteBuffer</li><li>HeapByteBuffer</li></ul></li><li>ShortBuffer</li><li>IntBuffer</li><li>LongBuffer</li><li>FloatBuffer</li><li>DoubleBuffer</li><li>CharBuffer</li></ul><h3 id="2ã€Selector"><a href="#2ã€Selector" class="headerlink" title="2ã€Selector"></a>2ã€Selector</h3><p>selector å•ä»å­—é¢æ„æ€ä¸å¥½ç†è§£ï¼Œéœ€è¦ç»“åˆæœåŠ¡å™¨çš„è®¾è®¡æ¼”åŒ–æ¥ç†è§£å®ƒçš„ç”¨é€”</p><h4 id="2-1ã€å¤šçº¿ç¨‹ç‰ˆè®¾è®¡"><a href="#2-1ã€å¤šçº¿ç¨‹ç‰ˆè®¾è®¡" class="headerlink" title="2-1ã€å¤šçº¿ç¨‹ç‰ˆè®¾è®¡"></a>2-1ã€å¤šçº¿ç¨‹ç‰ˆè®¾è®¡</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202208201636971.png"></p><h5 id="âš ï¸-å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹"><a href="#âš ï¸-å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹" class="headerlink" title="âš ï¸ å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹"></a>âš ï¸ å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹</h5><ul><li>å†…å­˜å ç”¨é«˜</li><li>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬é«˜</li><li>åªé€‚åˆè¿æ¥æ•°å°‘çš„åœºæ™¯</li></ul><h4 id="2-2ã€çº¿ç¨‹æ± ç‰ˆè®¾è®¡"><a href="#2-2ã€çº¿ç¨‹æ± ç‰ˆè®¾è®¡" class="headerlink" title="2-2ã€çº¿ç¨‹æ± ç‰ˆè®¾è®¡"></a>2-2ã€çº¿ç¨‹æ± ç‰ˆè®¾è®¡</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202208201639068.png"></p><h5 id="âš ï¸-çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹"><a href="#âš ï¸-çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹" class="headerlink" title="âš ï¸ çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹"></a>âš ï¸ çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹</h5><ul><li>é˜»å¡æ¨¡å¼ä¸‹ï¼Œçº¿ç¨‹ä»…èƒ½å¤„ç†ä¸€ä¸ª socket è¿æ¥</li><li>ä»…é€‚åˆçŸ­è¿æ¥åœºæ™¯</li></ul><h4 id="2-3ã€selector-ç‰ˆè®¾è®¡"><a href="#2-3ã€selector-ç‰ˆè®¾è®¡" class="headerlink" title="2-3ã€selector ç‰ˆè®¾è®¡"></a>2-3ã€selector ç‰ˆè®¾è®¡</h4><p>selector çš„ä½œç”¨å°±æ˜¯é…åˆä¸€ä¸ªçº¿ç¨‹æ¥ç®¡ç†å¤šä¸ª channelï¼Œè·å–è¿™äº› channel ä¸Šå‘ç”Ÿçš„äº‹ä»¶ï¼Œè¿™äº› channel å·¥ä½œåœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œä¸ä¼šè®©çº¿ç¨‹åŠæ­»åœ¨ä¸€ä¸ª channel ä¸Šã€‚é€‚åˆè¿æ¥æ•°ç‰¹åˆ«å¤šï¼Œä½†æµé‡ä½çš„åœºæ™¯ï¼ˆlow trafficï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208201647534.png"></p><p>è°ƒç”¨ selector çš„ select() ä¼šé˜»å¡ç›´åˆ° channel å‘ç”Ÿäº†è¯»å†™å°±ç»ªäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å‘ç”Ÿï¼Œselect æ–¹æ³•å°±ä¼šè¿”å›è¿™äº›äº‹ä»¶äº¤ç»™ thread æ¥å¤„ç†</p><h2 id="äºŒã€ByteBufferè¯¦è§£"><a href="#äºŒã€ByteBufferè¯¦è§£" class="headerlink" title="äºŒã€ByteBufferè¯¦è§£"></a>äºŒã€ByteBufferè¯¦è§£</h2><p>æœ‰ä¸€æ™®é€šæ–‡æœ¬æ–‡ä»¶ data.txtï¼Œå†…å®¹ä¸º</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">1234567890abcd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨ FileChannel æ¥è¯»å–æ–‡ä»¶å†…å®¹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">RandomAccessFile</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelDemo1</span> <span class="token punctuation">{</span>    <span class="token comment">// </span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">/**         * try () 1.7çš„è¯­æ³•ç³–ï¼Œæ–¹ä¾¿å…³é—­ RandomAccessFile èµ„æº         * FileChannel         * 1ã€è¾“å…¥è¾“å‡ºæµï¼ŒRandomAccessFile         */</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">RandomAccessFile</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span> <span class="token punctuation">(</span><span class="token string">"boot_netty/helloword/data.txt"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">FileChannel</span> channel <span class="token operator">=</span> file<span class="token punctuation">.</span>getChannel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">do</span> <span class="token punctuation">{</span>                <span class="token comment">// å‡†å¤‡ç¼“å†²åŒºï¼Œå‘ buffer å†™å…¥</span>                <span class="token keyword">int</span> len <span class="token operator">=</span> channel<span class="token punctuation">.</span>read <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"è¯»åˆ°å­—èŠ‚æ•°ï¼š{}"</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// æ²¡æœ‰å†…å®¹äº†</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment">// åˆ‡æ¢ buffer è¯»æ¨¡å¼</span>                <span class="token comment">// ç¿»è½¬ç¼“å†²åŒºï¼Œä¸ºå†™åšå‡†å¤‡</span>                buffer<span class="token punctuation">.</span>flip <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>hasRemaining <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// æ˜¯å¦è¿˜æœ‰å‰©ä½™æœªè¯»æ•°æ®</span>                    <span class="token keyword">byte</span> b <span class="token operator">=</span> buffer<span class="token punctuation">.</span>get <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment">// åˆ‡æ¢ buffer å†™æ¨¡å¼</span>                <span class="token comment">// æ¸…æ¥šç¼“å†²åŒºï¼Œä¸ºè¯»åšå‡†å¤‡</span>                buffer<span class="token punctuation">.</span>clear <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><blockquote><p>19:02:52.712 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š10<br>19:02:52.717 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 1<br>19:02:52.717 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 2<br>19:02:52.717 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 3<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 4<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 5<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 6<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 7<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 8<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 9<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - 0<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š6<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - a<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - b<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - c<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - d<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 -<br>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - </p><br><p>19:02:52.718 [main] DEBUG com.kk.netty.nio.ChannelDemo1 - è¯»åˆ°å­—èŠ‚æ•°ï¼š-1</p></blockquote><h3 id="1ã€ByteBuffer-æ­¥éª¤"><a href="#1ã€ByteBuffer-æ­¥éª¤" class="headerlink" title="1ã€ByteBuffer æ­¥éª¤"></a>1ã€ByteBuffer æ­¥éª¤</h3><ol><li>å‘ buffer å†™å…¥æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ channel.read(buffer)</li><li>è°ƒç”¨ flip() åˆ‡æ¢è‡³<strong>è¯»æ¨¡å¼</strong></li><li>ä» buffer è¯»å–æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ buffer.get()</li><li>è°ƒç”¨ clear() æˆ– compact() åˆ‡æ¢è‡³<strong>å†™æ¨¡å¼</strong></li><li>é‡å¤ 1~4 æ­¥éª¤</li></ol><h3 id="2ã€ByteBuffer-ç»“æ„"><a href="#2ã€ByteBuffer-ç»“æ„" class="headerlink" title="2ã€ByteBuffer ç»“æ„"></a>2ã€ByteBuffer ç»“æ„</h3><p>ByteBuffer æœ‰ä»¥ä¸‹é‡è¦å±æ€§</p><ul><li>capacity å®¹é‡</li><li>position å†™å…¥ä½ç½®ï¼Œç§»åŠ¨çš„æ¸¸æ ‡</li><li>limit  å†™å…¥æˆ–è€…è¯»å–é™åˆ¶ï¼ˆæ ¹æ®è¯»å†™æ¨¡å¼åˆ‡æ¢å†³å®šï¼‰</li></ul><h5 id="1ã€å¼€å§‹"><a href="#1ã€å¼€å§‹" class="headerlink" title="1ã€å¼€å§‹"></a>1ã€å¼€å§‹</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208201929345.png"></p><h5 id="2ã€å†™æ¨¡å¼ä¸‹ï¼Œposition-æ˜¯å†™å…¥ä½ç½®ï¼Œlimit-ç­‰äºå®¹é‡ï¼Œä¸‹å›¾è¡¨ç¤ºå†™å…¥äº†-4-ä¸ªå­—èŠ‚åçš„çŠ¶æ€"><a href="#2ã€å†™æ¨¡å¼ä¸‹ï¼Œposition-æ˜¯å†™å…¥ä½ç½®ï¼Œlimit-ç­‰äºå®¹é‡ï¼Œä¸‹å›¾è¡¨ç¤ºå†™å…¥äº†-4-ä¸ªå­—èŠ‚åçš„çŠ¶æ€" class="headerlink" title="2ã€å†™æ¨¡å¼ä¸‹ï¼Œposition æ˜¯å†™å…¥ä½ç½®ï¼Œlimit ç­‰äºå®¹é‡ï¼Œä¸‹å›¾è¡¨ç¤ºå†™å…¥äº† 4 ä¸ªå­—èŠ‚åçš„çŠ¶æ€"></a>2ã€å†™æ¨¡å¼ä¸‹ï¼Œposition æ˜¯å†™å…¥ä½ç½®ï¼Œlimit ç­‰äºå®¹é‡ï¼Œä¸‹å›¾è¡¨ç¤ºå†™å…¥äº† 4 ä¸ªå­—èŠ‚åçš„çŠ¶æ€</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208201933170.png"></p><h5 id="3ã€flip-åŠ¨ä½œå‘ç”Ÿåï¼Œposition-åˆ‡æ¢ä¸ºè¯»å–ä½ç½®ï¼Œlimit-åˆ‡æ¢ä¸ºè¯»å–é™åˆ¶"><a href="#3ã€flip-åŠ¨ä½œå‘ç”Ÿåï¼Œposition-åˆ‡æ¢ä¸ºè¯»å–ä½ç½®ï¼Œlimit-åˆ‡æ¢ä¸ºè¯»å–é™åˆ¶" class="headerlink" title="3ã€flip åŠ¨ä½œå‘ç”Ÿåï¼Œposition åˆ‡æ¢ä¸ºè¯»å–ä½ç½®ï¼Œlimit åˆ‡æ¢ä¸ºè¯»å–é™åˆ¶"></a>3ã€flip åŠ¨ä½œå‘ç”Ÿåï¼Œposition åˆ‡æ¢ä¸ºè¯»å–ä½ç½®ï¼Œlimit åˆ‡æ¢ä¸ºè¯»å–é™åˆ¶</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208201934450.png"></p><h5 id="4ã€è¯»å–-4-ä¸ªå­—èŠ‚åï¼ŒçŠ¶æ€"><a href="#4ã€è¯»å–-4-ä¸ªå­—èŠ‚åï¼ŒçŠ¶æ€" class="headerlink" title="4ã€è¯»å– 4 ä¸ªå­—èŠ‚åï¼ŒçŠ¶æ€"></a>4ã€è¯»å– 4 ä¸ªå­—èŠ‚åï¼ŒçŠ¶æ€</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208201937372.png"></p><h5 id="5ã€clear-åŠ¨ä½œå‘ç”Ÿåï¼ŒçŠ¶æ€"><a href="#5ã€clear-åŠ¨ä½œå‘ç”Ÿåï¼ŒçŠ¶æ€" class="headerlink" title="5ã€clear åŠ¨ä½œå‘ç”Ÿåï¼ŒçŠ¶æ€"></a>5ã€clear åŠ¨ä½œå‘ç”Ÿåï¼ŒçŠ¶æ€</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208201937628.png"></p><h5 id="6ã€compact-æ–¹æ³•ï¼Œæ˜¯æŠŠæœªè¯»å®Œçš„éƒ¨åˆ†å‘å‰å‹ç¼©ï¼Œç„¶ååˆ‡æ¢è‡³å†™æ¨¡å¼"><a href="#6ã€compact-æ–¹æ³•ï¼Œæ˜¯æŠŠæœªè¯»å®Œçš„éƒ¨åˆ†å‘å‰å‹ç¼©ï¼Œç„¶ååˆ‡æ¢è‡³å†™æ¨¡å¼" class="headerlink" title="6ã€compact æ–¹æ³•ï¼Œæ˜¯æŠŠæœªè¯»å®Œçš„éƒ¨åˆ†å‘å‰å‹ç¼©ï¼Œç„¶ååˆ‡æ¢è‡³å†™æ¨¡å¼"></a>6ã€compact æ–¹æ³•ï¼Œæ˜¯æŠŠæœªè¯»å®Œçš„éƒ¨åˆ†å‘å‰å‹ç¼©ï¼Œç„¶ååˆ‡æ¢è‡³å†™æ¨¡å¼</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208201938152.png"></p><h4 id="ğŸ’¡-è°ƒè¯•å·¥å…·ç±»"><a href="#ğŸ’¡-è°ƒè¯•å·¥å…·ç±»" class="headerlink" title="ğŸ’¡ è°ƒè¯•å·¥å…·ç±»"></a>ğŸ’¡ è°ƒè¯•å·¥å…·ç±»</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span><span class="token class-name">StringUtil</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span><span class="token class-name">MathUtil</span><span class="token punctuation">.</span>isOutOfBounds<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span>NEWLINE<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ByteBufferUtil</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> BYTE2CHAR <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> HEXDUMP_TABLE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">256</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> HEXPADDING <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> HEXDUMP_ROWPREFIXES <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">65536</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> BYTE2HEX <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> BYTEPADDING <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> DIGITS <span class="token operator">=</span> <span class="token string">"0123456789abcdef"</span><span class="token punctuation">.</span>toCharArray <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            HEXDUMP_TABLE<span class="token punctuation">[</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> DIGITS<span class="token punctuation">[</span>i <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">4</span> <span class="token operator">&amp;</span> <span class="token number">0x0F</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            HEXDUMP_TABLE<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> DIGITS<span class="token punctuation">[</span>i <span class="token operator">&amp;</span> <span class="token number">0x0F</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> i<span class="token punctuation">;</span>        <span class="token comment">// Generate the lookup table for hex dump paddings</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> HEXPADDING<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> padding <span class="token operator">=</span> HEXPADDING<span class="token punctuation">.</span>length <span class="token operator">-</span> i<span class="token punctuation">;</span>            <span class="token class-name">StringBuilder</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span> <span class="token punctuation">(</span>padding <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> padding<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                buf<span class="token punctuation">.</span>append <span class="token punctuation">(</span><span class="token string">"   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            HEXPADDING<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// Generate the lookup table for the start-offset header in each row (up to 64KiB).</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> HEXDUMP_ROWPREFIXES<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">StringBuilder</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span>append <span class="token punctuation">(</span>NEWLINE<span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span>append <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span>toHexString <span class="token punctuation">(</span>i <span class="token operator">&lt;&lt;</span> <span class="token number">4</span> <span class="token operator">&amp;</span> <span class="token number">0</span>xFFFFFFFFL <span class="token operator">|</span> <span class="token number">0</span>x100000000L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span>setCharAt <span class="token punctuation">(</span>buf<span class="token punctuation">.</span>length <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            buf<span class="token punctuation">.</span>append <span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            HEXDUMP_ROWPREFIXES<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// Generate the lookup table for byte-to-hex-dump conversion</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BYTE2HEX<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            BYTE2HEX<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token class-name">StringUtil</span><span class="token punctuation">.</span>byteToHexStringPadded <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// Generate the lookup table for byte dump paddings</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BYTEPADDING<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> padding <span class="token operator">=</span> BYTEPADDING<span class="token punctuation">.</span>length <span class="token operator">-</span> i<span class="token punctuation">;</span>            <span class="token class-name">StringBuilder</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span> <span class="token punctuation">(</span>padding<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> padding<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                buf<span class="token punctuation">.</span>append <span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            BYTEPADDING<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// Generate the lookup table for byte-to-char conversion</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BYTE2CHAR<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> <span class="token number">0x1f</span> <span class="token operator">||</span> i <span class="token operator">&gt;=</span> <span class="token number">0x7f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                BYTE2CHAR<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'.'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                BYTE2CHAR<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> i<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æ‰“å°æ‰€æœ‰å†…å®¹     *     * @param buffer     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">debugAll</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> oldlimit <span class="token operator">=</span> buffer<span class="token punctuation">.</span>limit <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        buffer<span class="token punctuation">.</span>limit <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>capacity <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuilder</span> origin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span> <span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        appendPrettyHexDump <span class="token punctuation">(</span>origin<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>capacity <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"+--------+-------------------- all ------------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>printf <span class="token punctuation">(</span><span class="token string">"position: [%d], limit: [%d]\n"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>position <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> oldlimit<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>        buffer<span class="token punctuation">.</span>limit <span class="token punctuation">(</span>oldlimit<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æ‰“å°å¯è¯»å–å†…å®¹     *     * @param buffer     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">debugRead</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">StringBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span> <span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        appendPrettyHexDump <span class="token punctuation">(</span>builder<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>position <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>limit <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">-</span> buffer<span class="token punctuation">.</span>position <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"+--------+-------------------- read -----------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>printf <span class="token punctuation">(</span><span class="token string">"position: [%d], limit: [%d]\n"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>position <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>limit <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">appendPrettyHexDump</span><span class="token punctuation">(</span><span class="token class-name">StringBuilder</span> dump<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> buf<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isOutOfBounds <span class="token punctuation">(</span>offset<span class="token punctuation">,</span> length<span class="token punctuation">,</span> buf<span class="token punctuation">.</span>capacity <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IndexOutOfBoundsException</span> <span class="token punctuation">(</span>                    <span class="token string">"expected: "</span> <span class="token operator">+</span> <span class="token string">"0 &lt;= offset("</span> <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token string">") &lt;= offset + length("</span> <span class="token operator">+</span> length                            <span class="token operator">+</span> <span class="token string">") &lt;= "</span> <span class="token operator">+</span> <span class="token string">"buf.capacity("</span> <span class="token operator">+</span> buf<span class="token punctuation">.</span>capacity <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span>                <span class="token string">"         +-------------------------------------------------+"</span> <span class="token operator">+</span>                        NEWLINE <span class="token operator">+</span> <span class="token string">"         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |"</span> <span class="token operator">+</span>                        NEWLINE <span class="token operator">+</span> <span class="token string">"+--------+-------------------------------------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> startIndex <span class="token operator">=</span> offset<span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> fullRows <span class="token operator">=</span> length <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> remainder <span class="token operator">=</span> length <span class="token operator">&amp;</span> <span class="token number">0xF</span><span class="token punctuation">;</span>        <span class="token comment">// Dump the rows which have 16 bytes.</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> row <span class="token operator">&lt;</span> fullRows<span class="token punctuation">;</span> row<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> rowStartIndex <span class="token operator">=</span> <span class="token punctuation">(</span>row <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> startIndex<span class="token punctuation">;</span>            <span class="token comment">// Per-row prefix.</span>            appendHexDumpRowPrefix <span class="token punctuation">(</span>dump<span class="token punctuation">,</span> row<span class="token punctuation">,</span> rowStartIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// Hex dump</span>            <span class="token keyword">int</span> rowEndIndex <span class="token operator">=</span> rowStartIndex <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span>BYTE2HEX<span class="token punctuation">[</span>getUnsignedByte <span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span><span class="token string">" |"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// ASCII dump</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span>BYTE2CHAR<span class="token punctuation">[</span>getUnsignedByte <span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// Dump the last row which has less than 16 bytes.</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>remainder <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> rowStartIndex <span class="token operator">=</span> <span class="token punctuation">(</span>fullRows <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> startIndex<span class="token punctuation">;</span>            appendHexDumpRowPrefix <span class="token punctuation">(</span>dump<span class="token punctuation">,</span> fullRows<span class="token punctuation">,</span> rowStartIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// Hex dump</span>            <span class="token keyword">int</span> rowEndIndex <span class="token operator">=</span> rowStartIndex <span class="token operator">+</span> remainder<span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span>BYTE2HEX<span class="token punctuation">[</span>getUnsignedByte <span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span>HEXPADDING<span class="token punctuation">[</span>remainder<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span><span class="token string">" |"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// Ascii dump</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> rowStartIndex<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rowEndIndex<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span>BYTE2CHAR<span class="token punctuation">[</span>getUnsignedByte <span class="token punctuation">(</span>buf<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span>BYTEPADDING<span class="token punctuation">[</span>remainder<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span>NEWLINE <span class="token operator">+</span>                <span class="token string">"+--------+-------------------------------------------------+----------------+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">appendHexDumpRowPrefix</span><span class="token punctuation">(</span><span class="token class-name">StringBuilder</span> dump<span class="token punctuation">,</span> <span class="token keyword">int</span> row<span class="token punctuation">,</span> <span class="token keyword">int</span> rowStartIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">&lt;</span> HEXDUMP_ROWPREFIXES<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>            dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span>HEXDUMP_ROWPREFIXES<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span>NEWLINE<span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span>toHexString <span class="token punctuation">(</span>rowStartIndex <span class="token operator">&amp;</span> <span class="token number">0</span>xFFFFFFFFL <span class="token operator">|</span> <span class="token number">0</span>x100000000L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span>setCharAt <span class="token punctuation">(</span>dump<span class="token punctuation">.</span>length <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            dump<span class="token punctuation">.</span>append <span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">short</span> <span class="token function">getUnsignedByte</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>get <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è°ƒç”¨æ¡ˆä¾‹"><a href="#è°ƒç”¨æ¡ˆä¾‹" class="headerlink" title="è°ƒç”¨æ¡ˆä¾‹"></a>è°ƒç”¨æ¡ˆä¾‹</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBufferUtil</span><span class="token punctuation">.</span>debugAll<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestByteBufferReadWrite</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"1ã€å…ˆæ’å…¥ a ï¼Œå†æ’å…¥ b c d"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ASCLLç ï¼ˆåè¿›åˆ¶ï¼‰ 97 = åå…­è¿›åˆ¶ 0x61 =  a</span>        buffer<span class="token punctuation">.</span>put <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token number">0x61</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å†™å…¥ä¸€ä¸ªå­—ç¬¦ a</span>        <span class="token function">debugAll</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è°ƒè¯•æ‰“å°</span>        buffer<span class="token punctuation">.</span>put <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0x62</span><span class="token punctuation">,</span><span class="token number">0x63</span><span class="token punctuation">,</span><span class="token number">0x64</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å†™å…¥å­—ç¬¦ b c d</span>        <span class="token function">debugAll</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è°ƒè¯•æ‰“å°</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">" 2ã€åˆ‡æ¢ è¯»æ¨¡å¼ï¼Œå–ä¸€ä¸ªå­—ç¬¦"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åœ¨æ²¡æœ‰åˆ‡æ¢ä¸º è¯» æ¨¡å¼çš„æ—¶å€™ï¼Œç›´æ¥æ‹¿æ˜¯æ‹¿ä¸åˆ°çš„</span>        <span class="token comment">//System.out.println (buffer.get ( ));</span>        buffer<span class="token punctuation">.</span>flip <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ‡æ¢è¯»æ¨¡å¼</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>get <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å–å‡ºä¸€ä¸ªï¼Œè¿˜å‰©3ä¸ª</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>get <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å–å‡ºä¸€ä¸ªï¼Œè¿˜å‰©2ä¸ª</span>        <span class="token function">debugAll</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è°ƒè¯•æ‰“å°</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"3ã€æœªè¯»å–çš„å¾€å‰ç§»(å‹ç¼©),ç¬¬3ã€4ä½ä¼šé—ç•™äºŒä¸ª63ã€64æ˜¯å› ä¸ºæ²¡æœ‰æ¸…é›¶ï¼Œç„¶ååé¢æ’å…¥ä¸å½±å“ï¼Œä¼šä»å·²æœ‰çš„åé¢æ’å…¥"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        buffer<span class="token punctuation">.</span>compact <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">debugAll</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è°ƒè¯•æ‰“å°</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"4ã€æ’å…¥ä¸¤ä¸ªå­—ç¬¦ï¼Œä»å·²æœ‰çš„åé¢æ’å…¥"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        buffer<span class="token punctuation">.</span>put <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0x65</span><span class="token punctuation">,</span><span class="token number">0x6f</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">debugAll</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è°ƒè¯•æ‰“å°</span>            <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€ByteBuffer-å¸¸è§-API"><a href="#3ã€ByteBuffer-å¸¸è§-API" class="headerlink" title="3ã€ByteBuffer å¸¸è§ API"></a>3ã€ByteBuffer å¸¸è§ API</h3><ul><li>åˆ†é…ç©ºé—´</li><li>å‘ buffer å†™å…¥æ•°æ®</li><li>ä» buffer è¯»å–æ•°æ®</li><li>mark å’Œ reset</li><li>å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬</li><li>Buffer çš„çº¿ç¨‹å®‰å…¨</li></ul><h4 id="3-1ã€åˆ†é…ç©ºé—´"><a href="#3-1ã€åˆ†é…ç©ºé—´" class="headerlink" title="3-1ã€åˆ†é…ç©ºé—´"></a>3-1ã€åˆ†é…ç©ºé—´</h4><p>å¯ä»¥ä½¿ç”¨ allocate æ–¹æ³•ä¸º ByteBuffer åˆ†é…ç©ºé—´ï¼Œå…¶å®ƒ buffer ç±»ä¹Ÿæœ‰è¯¥æ–¹æ³•</p><blockquote><p>Bytebuffer buf = ByteBuffer.allocate(16);</p></blockquote><h4 id="3-2ã€buffer-å†™å…¥æ•°æ®"><a href="#3-2ã€buffer-å†™å…¥æ•°æ®" class="headerlink" title="3-2ã€buffer å†™å…¥æ•°æ®"></a>3-2ã€buffer å†™å…¥æ•°æ®</h4><p>æœ‰ä¸¤ç§åŠæ³•</p><ul><li>è°ƒç”¨ channel çš„ read æ–¹æ³•</li><li>è°ƒç”¨ buffer è‡ªå·±çš„ put æ–¹æ³•</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> readBytes <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å’Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">buf<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-3ã€buffer-è¯»å–æ•°æ®"><a href="#3-3ã€buffer-è¯»å–æ•°æ®" class="headerlink" title="3-3ã€buffer è¯»å–æ•°æ®"></a>3-3ã€buffer è¯»å–æ•°æ®</h4><p>åŒæ ·æœ‰ä¸¤ç§åŠæ³•</p><ul><li>è°ƒç”¨ channel çš„ write æ–¹æ³•</li><li>è°ƒç”¨ buffer è‡ªå·±çš„ get æ–¹æ³•</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> writeBytes <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å’Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">byte</span> b <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>get æ–¹æ³•ä¼šè®© position è¯»æŒ‡é’ˆå‘åèµ°ï¼Œå¦‚æœæƒ³é‡å¤è¯»å–æ•°æ®</p><ul><li>å¯ä»¥è°ƒç”¨ rewind æ–¹æ³•å°† position é‡æ–°ç½®ä¸º 0</li><li>æˆ–è€…è°ƒç”¨ get(int i) æ–¹æ³•è·å–ç´¢å¼• i çš„å†…å®¹ï¼Œå®ƒä¸ä¼šç§»åŠ¨è¯»æŒ‡é’ˆ</li></ul><h4 id="3-4ã€mark-å’Œ-reset"><a href="#3-4ã€mark-å’Œ-reset" class="headerlink" title="3-4ã€mark å’Œ reset"></a>3-4ã€mark å’Œ reset</h4><p>mark æ˜¯åœ¨è¯»å–æ—¶ï¼Œåšä¸€ä¸ªæ ‡è®°ï¼Œå³ä½¿ position æ”¹å˜ï¼Œåªè¦è°ƒç”¨ reset å°±èƒ½å›åˆ° mark çš„ä½ç½®</p><blockquote><p><strong>æ³¨æ„</strong></p><p>rewind å’Œ flip éƒ½ä¼šæ¸…é™¤ mark ä½ç½®</p></blockquote><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="3-5ã€å­—ç¬¦ä¸²ä¸-ByteBuffer-äº’è½¬"><a href="#3-5ã€å­—ç¬¦ä¸²ä¸-ByteBuffer-äº’è½¬" class="headerlink" title="3-5ã€å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬"></a>3-5ã€å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬</h4><h4 id="-1"><a href="#-1" class="headerlink" title=""></a></h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">CharBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBufferUtil</span><span class="token punctuation">.</span>debugAll<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestButeBufferApi</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ByteBuffer</span> buffer1 <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span>encode <span class="token punctuation">(</span><span class="token string">"ä½ å¥½"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ByteBuffer</span> buffer2 <span class="token operator">=</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span>forName <span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode <span class="token punctuation">(</span><span class="token string">"ä½ å¥½"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        debugAll <span class="token punctuation">(</span>buffer1<span class="token punctuation">)</span><span class="token punctuation">;</span>        debugAll <span class="token punctuation">(</span>buffer2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">CharBuffer</span> buffer3 <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span>decode <span class="token punctuation">(</span>buffer1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>buffer3<span class="token punctuation">.</span>getClass <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>buffer3<span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| e4 bd a0 e5 a5 bd                               |......          |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| e4 bd a0 e5 a5 bd                               |......          |+--------+-------------------------------------------------+----------------+class java.nio.HeapCharBufferä½ å¥½<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-6ã€Buffer-çš„çº¿ç¨‹å®‰å…¨"><a href="#3-6ã€Buffer-çš„çº¿ç¨‹å®‰å…¨" class="headerlink" title="3-6ã€Buffer çš„çº¿ç¨‹å®‰å…¨"></a>3-6ã€Buffer çš„çº¿ç¨‹å®‰å…¨</h4><blockquote><p>Buffer æ˜¯<strong>éçº¿ç¨‹å®‰å…¨çš„</strong></p></blockquote><h3 id="4ã€Scattering-Reads"><a href="#4ã€Scattering-Reads" class="headerlink" title="4ã€Scattering Reads"></a>4ã€Scattering Reads</h3><h4 id="1ã€åˆ†æ•£é›†ä¸­è¯»"><a href="#1ã€åˆ†æ•£é›†ä¸­è¯»" class="headerlink" title="1ã€åˆ†æ•£é›†ä¸­è¯»"></a>1ã€åˆ†æ•£é›†ä¸­è¯»</h4><p>åˆ†æ•£è¯»å–ï¼Œæœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ 3parts.txt</p><pre class="line-numbers language-none"><code class="language-none">onetwothree<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¯»å–ï¼Œå¯ä»¥å°†æ•°æ®å¡«å……è‡³å¤šä¸ª buffer</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">RandomAccessFile</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBufferUtil</span><span class="token punctuation">.</span>debugAll<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestScatteringReads</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">RandomAccessFile</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span> <span class="token punctuation">(</span><span class="token string">"boot_netty/helloword/3parts.txt"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">FileChannel</span> channel <span class="token operator">=</span> file<span class="token punctuation">.</span>getChannel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ByteBuffer</span> a <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ByteBuffer</span> b <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ByteBuffer</span> c <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span>read <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            a<span class="token punctuation">.</span>flip <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            b<span class="token punctuation">.</span>flip <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            c<span class="token punctuation">.</span>flip <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            debugAll <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>            debugAll <span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>            debugAll <span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœ</p><pre class="line-numbers language-none"><code class="language-none">         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 6f 6e 65                                        |one             |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 74 77 6f                                        |two             |+--------+-------------------------------------------------+----------------+         +-------------------------------------------------+         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |+--------+-------------------------------------------------+----------------+|00000000| 74 68 72 65 65                                  |three           |+--------+-------------------------------------------------+----------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€åˆ†æ•£é›†ä¸­å†™"><a href="#2ã€åˆ†æ•£é›†ä¸­å†™" class="headerlink" title="2ã€åˆ†æ•£é›†ä¸­å†™"></a>2ã€åˆ†æ•£é›†ä¸­å†™</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">RandomAccessFile</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span><span class="token comment">/** * åˆ†æ•£é›†ä¸­å†™ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestScatteringWrites</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ByteBuffer</span> b1 <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span>encode <span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ByteBuffer</span> b2 <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span>encode <span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ByteBuffer</span> b3 <span class="token operator">=</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span>encode <span class="token punctuation">(</span><span class="token string">"ä½ å¥½ï¼Œä¸–ç•Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileChannel</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span> <span class="token punctuation">(</span><span class="token string">"boot_netty/helloword/2parts.txt"</span><span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getChannel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            file<span class="token punctuation">.</span>write <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>b1<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> b3<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5ã€Gathering-Writes"><a href="#5ã€Gathering-Writes" class="headerlink" title="5ã€Gathering Writes"></a>5ã€Gathering Writes</h3><p>ç½‘ç»œä¸Šæœ‰å¤šæ¡æ•°æ®å‘é€ç»™æœåŠ¡ç«¯ï¼Œæ•°æ®ä¹‹é—´ä½¿ç”¨ \n è¿›è¡Œåˆ†éš”<br>ä½†ç”±äºæŸç§åŸå› è¿™äº›æ•°æ®åœ¨æ¥æ”¶æ—¶ï¼Œè¢«è¿›è¡Œäº†é‡æ–°ç»„åˆï¼Œä¾‹å¦‚åŸå§‹æ•°æ®æœ‰3æ¡ä¸º</p><ul><li>Hello,world\n</li><li>Iâ€™m zhangsan\n</li><li>How are you?\n</li></ul><p>å˜æˆäº†ä¸‹é¢çš„ä¸¤ä¸ª byteBuffer (é»åŒ…ï¼ŒåŠåŒ…)</p><ul><li>Hello,world\nIâ€™m zhangsan\nHo</li><li>w are you?\n</li></ul><p>ç°åœ¨è¦æ±‚ä½ ç¼–å†™ç¨‹åºï¼Œå°†é”™ä¹±çš„æ•°æ®æ¢å¤æˆåŸå§‹çš„æŒ‰ \n åˆ†éš”çš„æ•°æ®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBufferUtil</span><span class="token punctuation">.</span>debugAll<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestGatheringWrites</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ByteBuffer</span> source <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//                     11            24</span>        source<span class="token punctuation">.</span>put <span class="token punctuation">(</span><span class="token string">"Hello,world\nI'm zhangsan\nHo"</span><span class="token punctuation">.</span>getBytes <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        split <span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>        source<span class="token punctuation">.</span>put <span class="token punctuation">(</span><span class="token string">"w are you?\nhaha!\n"</span><span class="token punctuation">.</span>getBytes <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        split <span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>        source<span class="token punctuation">.</span>flip <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// source.limit ( ) ç¼“å†²åŒºå®¹é‡é•¿åº¦</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> source<span class="token punctuation">.</span>limit <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// æ‰¾åˆ°ä¸€æ¡å®Œæ•´ä¿¡æ¯</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span>get <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// è®¡ç®—æ¯ä¸ª \n è¯ç»„çš„é•¿åº¦ï¼ˆæ¢è¡Œç¬¦å· +1 - æ¸¸æ ‡èµ·å§‹ä½ç½®ï¼‰</span>                <span class="token keyword">int</span> length <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> source<span class="token punctuation">.</span>position <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// å°†è¿™æ¡å®Œæ•´ä¿¡æ¯å­˜å…¥æ–°çš„ bytebuffer</span>                <span class="token class-name">ByteBuffer</span> target <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// ä» source è¯»ï¼Œå‘ target å†™</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    target<span class="token punctuation">.</span>put <span class="token punctuation">(</span>source<span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                debugAll <span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">// æœªè¯»çš„å¾€å‰ç§»åŠ¨</span>        source<span class="token punctuation">.</span>compact <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸‰ã€æ–‡ä»¶ç¼–ç¨‹"><a href="#ä¸‰ã€æ–‡ä»¶ç¼–ç¨‹" class="headerlink" title="ä¸‰ã€æ–‡ä»¶ç¼–ç¨‹"></a>ä¸‰ã€æ–‡ä»¶ç¼–ç¨‹</h2><h3 id="1ã€FileChannel"><a href="#1ã€FileChannel" class="headerlink" title="1ã€FileChannel"></a>1ã€FileChannel</h3><h4 id="1ã€âš ï¸-FileChannel-å·¥ä½œæ¨¡å¼"><a href="#1ã€âš ï¸-FileChannel-å·¥ä½œæ¨¡å¼" class="headerlink" title="1ã€âš ï¸ FileChannel å·¥ä½œæ¨¡å¼"></a>1ã€âš ï¸ FileChannel å·¥ä½œæ¨¡å¼</h4><blockquote><p>FileChannel åªèƒ½å·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹</p></blockquote><h4 id="2ã€è·å–"><a href="#2ã€è·å–" class="headerlink" title="2ã€è·å–"></a>2ã€è·å–</h4><p>ä¸èƒ½ç›´æ¥æ‰“å¼€ FileChannelï¼Œå¿…é¡»é€šè¿‡ FileInputStreamã€FileOutputStream æˆ–è€… RandomAccessFile æ¥è·å– FileChannelï¼Œå®ƒä»¬éƒ½æœ‰ getChannel æ–¹æ³•</p><ul><li>é€šè¿‡ FileInputStream è·å–çš„ channel åªèƒ½è¯»</li><li>é€šè¿‡ FileOutputStream è·å–çš„ channel åªèƒ½å†™</li><li>é€šè¿‡ RandomAccessFile æ˜¯å¦èƒ½è¯»å†™æ ¹æ®æ„é€  RandomAccessFile æ—¶çš„è¯»å†™æ¨¡å¼å†³å®š</li></ul><h4 id="3ã€è¯»å–"><a href="#3ã€è¯»å–" class="headerlink" title="3ã€è¯»å–"></a>3ã€è¯»å–</h4><p>ä¼šä» channel è¯»å–æ•°æ®å¡«å…… ByteBufferï¼Œè¿”å›å€¼è¡¨ç¤ºè¯»åˆ°äº†å¤šå°‘å­—èŠ‚ï¼Œ-1 è¡¨ç¤ºåˆ°è¾¾äº†æ–‡ä»¶çš„æœ«å°¾</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> readBytes <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4ã€å†™å…¥"><a href="#4ã€å†™å…¥" class="headerlink" title="4ã€å†™å…¥"></a>4ã€å†™å…¥</h4><p>å†™å…¥çš„æ­£ç¡®å§¿åŠ¿å¦‚ä¸‹ï¼Œ SocketChannel</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­˜å…¥æ•°æ®</span>buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ‡æ¢è¯»æ¨¡å¼</span><span class="token keyword">while</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ while ä¸­è°ƒç”¨ channel.write æ˜¯å› ä¸º write æ–¹æ³•å¹¶ä¸èƒ½ä¿è¯ä¸€æ¬¡å°† buffer ä¸­çš„å†…å®¹å…¨éƒ¨å†™å…¥ channel</p><h4 id="5ã€ä½ç½®"><a href="#5ã€ä½ç½®" class="headerlink" title="5ã€ä½ç½®"></a>5ã€ä½ç½®</h4><p>è·å–å½“å‰ä½ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> pos <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¾ç½®å½“å‰ä½ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> newPos <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>newPos<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è®¾ç½®å½“å‰ä½ç½®æ—¶ï¼Œå¦‚æœè®¾ç½®ä¸ºæ–‡ä»¶çš„æœ«å°¾</p><ul><li>è¿™æ—¶è¯»å–ä¼šè¿”å› -1 </li><li>è¿™æ—¶å†™å…¥ï¼Œä¼šè¿½åŠ å†…å®¹ï¼Œä½†è¦æ³¨æ„å¦‚æœ position è¶…è¿‡äº†æ–‡ä»¶æœ«å°¾ï¼Œå†å†™å…¥æ—¶åœ¨æ–°å†…å®¹å’ŒåŸæœ«å°¾ä¹‹é—´ä¼šæœ‰ç©ºæ´ï¼ˆ00ï¼‰</li></ul><h4 id="6ã€å¤§å°"><a href="#6ã€å¤§å°" class="headerlink" title="6ã€å¤§å°"></a>6ã€å¤§å°</h4><p>ä½¿ç”¨ size æ–¹æ³•è·å–æ–‡ä»¶çš„å¤§å°</p><h4 id="7ã€å¼ºåˆ¶å†™å…¥"><a href="#7ã€å¼ºåˆ¶å†™å…¥" class="headerlink" title="7ã€å¼ºåˆ¶å†™å…¥"></a>7ã€å¼ºåˆ¶å†™å…¥</h4><p>æ“ä½œç³»ç»Ÿå‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œä¼šå°†æ•°æ®ç¼“å­˜ï¼Œä¸æ˜¯ç«‹åˆ»å†™å…¥ç£ç›˜ã€‚å¯ä»¥è°ƒç”¨ force(true)  æ–¹æ³•å°†æ–‡ä»¶å†…å®¹å’Œå…ƒæ•°æ®ï¼ˆæ–‡ä»¶çš„æƒé™ç­‰ä¿¡æ¯ï¼‰ç«‹åˆ»å†™å…¥ç£ç›˜</p><h3 id="2ã€ä¸¤ä¸ª-Channel-ä¼ è¾“æ•°æ®"><a href="#2ã€ä¸¤ä¸ª-Channel-ä¼ è¾“æ•°æ®" class="headerlink" title="2ã€ä¸¤ä¸ª Channel ä¼ è¾“æ•°æ®"></a>2ã€ä¸¤ä¸ª Channel ä¼ è¾“æ•°æ®</h3><p>åŸºç¡€ç‰ˆï¼šé™åˆ¶2g</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFileChannel</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> FROM <span class="token operator">=</span> <span class="token string">"boot_netty/helloword/data.txt"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> TO <span class="token operator">=</span> <span class="token string">"boot_netty/helloword/to.txt"</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span>nanoTime <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>                <span class="token class-name">FileChannel</span> from <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span> <span class="token punctuation">(</span>FROM<span class="token punctuation">)</span><span class="token punctuation">.</span>getChannel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">FileChannel</span> <span class="token keyword">to</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span> <span class="token punctuation">(</span>TO<span class="token punctuation">)</span><span class="token punctuation">.</span>getChannel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// æ•°æ® from ä¼ è¾“åˆ°  to*ï¼ˆå°±æ˜¯ä¸€ä¸ªæ‹·è´è¿‡ç¨‹ï¼‰</span>            <span class="token comment">// æ•ˆç‡ä¼šæ¯”ä¼ ç»Ÿçš„åŸç”Ÿapi é«˜ï¼Œåº•å±‚ä¼šç”¨æ“ä½œç³»ç»Ÿçš„é›¶æ‹·è´è¿›è¡Œä¼˜åŒ–</span>            from<span class="token punctuation">.</span>transferTo <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> from<span class="token punctuation">.</span>size <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span>nanoTime <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"transferTo ç”¨æ—¶ï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000_000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¼˜åŒ–ç‰ˆï¼šå¾ªç¯æ’å…¥ï¼Œè§£å†³2gé™åˆ¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">FileChannel</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFileChannel</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> FROM <span class="token operator">=</span> <span class="token string">"boot_netty/helloword/data.txt"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> TO <span class="token operator">=</span> <span class="token string">"boot_netty/helloword/to.txt"</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span>nanoTime <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>                <span class="token class-name">FileChannel</span> from <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span> <span class="token punctuation">(</span>FROM<span class="token punctuation">)</span><span class="token punctuation">.</span>getChannel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">FileChannel</span> <span class="token keyword">to</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span> <span class="token punctuation">(</span>TO<span class="token punctuation">)</span><span class="token punctuation">.</span>getChannel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// æ•°æ® from ä¼ è¾“åˆ°  to*ï¼ˆå°±æ˜¯ä¸€ä¸ªæ‹·è´è¿‡ç¨‹ï¼‰</span>            <span class="token comment">// æ•ˆç‡ä¼šæ¯”ä¼ ç»Ÿçš„åŸç”Ÿapi é«˜ï¼Œåº•å±‚ä¼šç”¨æ“ä½œç³»ç»Ÿçš„é›¶æ‹·è´è¿›è¡Œä¼˜åŒ–</span>            <span class="token keyword">long</span> size <span class="token operator">=</span> from<span class="token punctuation">.</span>size <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// left å˜é‡ä»£è¡¨è¿˜å‰©ä½™å¤šå°‘å­—èŠ‚</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> left <span class="token operator">=</span> size<span class="token punctuation">;</span> left <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"position:"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>size <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" left:"</span> <span class="token operator">+</span> left<span class="token punctuation">)</span><span class="token punctuation">;</span>                left <span class="token operator">-=</span> from<span class="token punctuation">.</span>transferTo <span class="token punctuation">(</span>size <span class="token operator">-</span> left<span class="token punctuation">,</span> left<span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span>nanoTime <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"transferTo ç”¨æ—¶ï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000_000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€Path"><a href="#3ã€Path" class="headerlink" title="3ã€Path"></a>3ã€Path</h3><p>jdk7 å¼•å…¥äº† Path å’Œ Paths ç±»</p><ul><li>Path ç”¨æ¥è¡¨ç¤ºæ–‡ä»¶è·¯å¾„</li><li>Paths æ˜¯å·¥å…·ç±»ï¼Œç”¨æ¥è·å– Path å®ä¾‹</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> source <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç›¸å¯¹è·¯å¾„ ä½¿ç”¨ user.dir ç¯å¢ƒå˜é‡æ¥å®šä½ 1.txt</span><span class="token class-name">Path</span> source <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:\\1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»å¯¹è·¯å¾„ ä»£è¡¨äº†  d:\1.txt</span><span class="token class-name">Path</span> source <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:/1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»å¯¹è·¯å¾„ åŒæ ·ä»£è¡¨äº†  d:\1.txt</span><span class="token class-name">Path</span> projects <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:\\data"</span><span class="token punctuation">,</span> <span class="token string">"projects"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»£è¡¨äº†  d:\data\projects</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>.</code> ä»£è¡¨äº†å½“å‰è·¯å¾„</li><li><code>..</code> ä»£è¡¨äº†ä¸Šä¸€çº§è·¯å¾„</li></ul><p>ä¾‹å¦‚ç›®å½•ç»“æ„å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">d:|- data|- projects|- a|- b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"d:\\data\\projects\\a\\..\\b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­£å¸¸åŒ–è·¯å¾„</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¼šè¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">d:\data\projects\a\..\bd:\data\projects\b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="4ã€Files"><a href="#4ã€Files" class="headerlink" title="4ã€Files"></a>4ã€Files</h3><h5 id="æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨"><a href="#æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨" class="headerlink" title="æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨"></a>æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="åˆ›å»ºä¸€çº§ç›®å½•"><a href="#åˆ›å»ºä¸€çº§ç›®å½•" class="headerlink" title="åˆ›å»ºä¸€çº§ç›®å½•"></a>åˆ›å»ºä¸€çº§ç›®å½•</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/d1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">createDirectory</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException</li><li>ä¸èƒ½ä¸€æ¬¡åˆ›å»ºå¤šçº§ç›®å½•ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ NoSuchFileException</li></ul><h5 id="åˆ›å»ºå¤šçº§ç›®å½•ç”¨"><a href="#åˆ›å»ºå¤šçº§ç›®å½•ç”¨" class="headerlink" title="åˆ›å»ºå¤šçº§ç›®å½•ç”¨"></a>åˆ›å»ºå¤šçº§ç›®å½•ç”¨</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/d1/d2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">createDirectories</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="æ‹·è´æ–‡ä»¶"><a href="#æ‹·è´æ–‡ä»¶" class="headerlink" title="æ‹·è´æ–‡ä»¶"></a>æ‹·è´æ–‡ä»¶</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> source <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Path</span> target <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/target.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException</li></ul><p>å¦‚æœå¸Œæœ›ç”¨ source è¦†ç›–æ‰ targetï¼Œéœ€è¦ç”¨ StandardCopyOption æ¥æ§åˆ¶</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token class-name">StandardCopyOption</span><span class="token punctuation">.</span>REPLACE_EXISTING<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="ç§»åŠ¨æ–‡ä»¶"><a href="#ç§»åŠ¨æ–‡ä»¶" class="headerlink" title="ç§»åŠ¨æ–‡ä»¶"></a>ç§»åŠ¨æ–‡ä»¶</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> source <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Path</span> target <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token class-name">StandardCopyOption</span><span class="token punctuation">.</span>ATOMIC_MOVE<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>StandardCopyOption.ATOMIC_MOVE ä¿è¯æ–‡ä»¶ç§»åŠ¨çš„åŸå­æ€§</li></ul><h5 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> target <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/target.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ NoSuchFileException</li></ul><h5 id="åˆ é™¤ç›®å½•"><a href="#åˆ é™¤ç›®å½•" class="headerlink" title="åˆ é™¤ç›®å½•"></a>åˆ é™¤ç›®å½•</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Path</span> target <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"helloword/d1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¦‚æœç›®å½•è¿˜æœ‰å†…å®¹ï¼Œä¼šæŠ›å¼‚å¸¸ DirectoryNotEmptyException</li></ul><h5 id="éå†ç›®å½•æ–‡ä»¶"><a href="#éå†ç›®å½•æ–‡ä»¶" class="headerlink" title="éå†ç›®å½•æ–‡ä»¶"></a>éå†ç›®å½•æ–‡ä»¶</h5><p>è®¾è®¡æ¨¡å¼ï¼šè®¿é—®è€…æ¨¡å¼</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>    <span class="token comment">// ç›®å½•ä¸ªæ•°</span>    <span class="token class-name">AtomicInteger</span> direCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ–‡ä»¶ä¸ªæ•°</span>    <span class="token class-name">AtomicInteger</span> fileCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ç›®å½•å¯¹è±¡</span>    <span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token string">"C:\\Program Files\\Java\\jdk1.8.0_202"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è®¾è®¡æ¨¡å¼ï¼šè®¿é—®è€…æ¨¡å¼</span>    <span class="token class-name">Files</span><span class="token punctuation">.</span>walkFileTree <span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Path</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// è·å–ç›®å½•</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">FileVisitResult</span> <span class="token function">preVisitDirectory</span><span class="token punctuation">(</span><span class="token class-name">Path</span> dir<span class="token punctuation">,</span> <span class="token class-name">BasicFileAttributes</span> attrs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>dir <span class="token punctuation">)</span><span class="token punctuation">;</span>            direCount<span class="token punctuation">.</span>incrementAndGet <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>preVisitDirectory <span class="token punctuation">(</span>dir<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// è·å–æ–‡ä»¶</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">FileVisitResult</span> <span class="token function">visitFile</span><span class="token punctuation">(</span><span class="token class-name">Path</span> file<span class="token punctuation">,</span> <span class="token class-name">BasicFileAttributes</span> attrs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>file <span class="token punctuation">)</span><span class="token punctuation">;</span>            fileCount<span class="token punctuation">.</span>incrementAndGet <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>visitFile <span class="token punctuation">(</span>file<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>direCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 133</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fileCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1479</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»Ÿè®¡ jar çš„æ•°ç›®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>       <span class="token comment">// æ–‡ä»¶ä¸ªæ•°</span>       <span class="token class-name">AtomicInteger</span> fileCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// ç›®å½•å¯¹è±¡</span>       <span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token string">"C:\\Program Files\\Java\\jdk1.8.0_202"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// è®¾è®¡æ¨¡å¼ï¼šè®¿é—®è€…æ¨¡å¼</span>       <span class="token class-name">Files</span><span class="token punctuation">.</span>walkFileTree <span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Path</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>           <span class="token annotation punctuation">@Override</span>           <span class="token keyword">public</span> <span class="token class-name">FileVisitResult</span> <span class="token function">visitFile</span><span class="token punctuation">(</span><span class="token class-name">Path</span> file<span class="token punctuation">,</span> <span class="token class-name">BasicFileAttributes</span> attrs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>               <span class="token comment">// æ ¹æ®æ–‡ä»¶åç¼€ç­›é€‰</span>               <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span>toFile <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getName <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endsWith <span class="token punctuation">(</span><span class="token string">".jar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                   fileCount<span class="token punctuation">.</span>incrementAndGet <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token punctuation">}</span>               <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>visitFile <span class="token punctuation">(</span>file<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">}</span>       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fileCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 705</span>   <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ é™¤å¤šçº§ç›®å½•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestRemoveFile</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span><span class="token string">"j:\\test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Files</span><span class="token punctuation">.</span>walkFileTree <span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">SimpleFileVisitor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Path</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment">// å…ˆåˆ é™¤æ–‡ä»¶</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">FileVisitResult</span> <span class="token function">visitFile</span><span class="token punctuation">(</span><span class="token class-name">Path</span> file<span class="token punctuation">,</span> <span class="token class-name">BasicFileAttributes</span> attrs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>                <span class="token class-name">Files</span><span class="token punctuation">.</span>delete <span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>visitFile <span class="token punctuation">(</span>file<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">// å†åˆ é™¤ç›®å½•</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">FileVisitResult</span> <span class="token function">postVisitDirectory</span><span class="token punctuation">(</span><span class="token class-name">Path</span> dir<span class="token punctuation">,</span> <span class="token class-name">IOException</span> exc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>                <span class="token class-name">Files</span><span class="token punctuation">.</span>delete <span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>postVisitDirectory <span class="token punctuation">(</span>dir<span class="token punctuation">,</span> exc<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>âš ï¸ åˆ é™¤å¾ˆå±é™©</p><blockquote><p>åˆ é™¤æ˜¯å±é™©æ“ä½œï¼Œç¡®ä¿è¦é€’å½’åˆ é™¤çš„æ–‡ä»¶å¤¹æ²¡æœ‰é‡è¦å†…å®¹</p></blockquote><p>æ‹·è´å¤šçº§ç›®å½•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCopyMultDirectory</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> source <span class="token operator">=</span> <span class="token string">"j:\\test"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> target <span class="token operator">=</span> <span class="token string">"j:\\testTemp"</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span>currentTimeMillis <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Files</span><span class="token punctuation">.</span>walk <span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>forEach <span class="token punctuation">(</span>path <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token class-name">String</span> targetName <span class="token operator">=</span> path<span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>replace <span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// å¦‚æœæ˜¯ç›®å½•</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Files</span><span class="token punctuation">.</span>isDirectory <span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token class-name">Files</span><span class="token punctuation">.</span>createDirectories <span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span>targetName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment">// å¦‚æœæ˜¯æ–‡ä»¶</span>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Files</span><span class="token punctuation">.</span>isRegularFile <span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token class-name">Files</span><span class="token punctuation">.</span>copy <span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token class-name">Paths</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span>targetName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å››ã€ç½‘ç»œç¼–ç¨‹"><a href="#å››ã€ç½‘ç»œç¼–ç¨‹" class="headerlink" title="å››ã€ç½‘ç»œç¼–ç¨‹"></a>å››ã€ç½‘ç»œç¼–ç¨‹</h2><h3 id="1ã€éé˜»å¡-vs-é˜»å¡"><a href="#1ã€éé˜»å¡-vs-é˜»å¡" class="headerlink" title="1ã€éé˜»å¡ vs é˜»å¡"></a>1ã€éé˜»å¡ vs é˜»å¡</h3><h4 id="1-1ã€é˜»å¡"><a href="#1-1ã€é˜»å¡" class="headerlink" title="1.1ã€é˜»å¡"></a>1.1ã€é˜»å¡</h4><ul><li>é˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šå¯¼è‡´çº¿ç¨‹æš‚åœ<ul><li>ServerSocketChannel.accept ä¼šåœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶è®©çº¿ç¨‹æš‚åœ</li><li>SocketChannel.read ä¼šåœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶è®©çº¿ç¨‹æš‚åœ</li><li>é˜»å¡çš„è¡¨ç°å…¶å®å°±æ˜¯çº¿ç¨‹æš‚åœäº†ï¼Œæš‚åœæœŸé—´ä¸ä¼šå ç”¨ cpuï¼Œä½†çº¿ç¨‹ç›¸å½“äºé—²ç½®</li></ul></li><li>å•çº¿ç¨‹ä¸‹ï¼Œé˜»å¡æ–¹æ³•ä¹‹é—´ç›¸äº’å½±å“ï¼Œå‡ ä¹ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œéœ€è¦å¤šçº¿ç¨‹æ”¯æŒ</li><li>ä½†å¤šçº¿ç¨‹ä¸‹ï¼Œæœ‰æ–°çš„é—®é¢˜ï¼Œä½“ç°åœ¨ä»¥ä¸‹æ–¹é¢<ul><li>32 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 320kï¼Œ64 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 1024kï¼Œå¦‚æœè¿æ¥æ•°è¿‡å¤šï¼Œå¿…ç„¶å¯¼è‡´ OOMï¼Œå¹¶ä¸”çº¿ç¨‹å¤ªå¤šï¼Œåè€Œä¼šå› ä¸ºé¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´æ€§èƒ½é™ä½</li><li>å¯ä»¥é‡‡ç”¨çº¿ç¨‹æ± æŠ€æœ¯æ¥å‡å°‘çº¿ç¨‹æ•°å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ²»æ ‡ä¸æ²»æœ¬ï¼Œå¦‚æœæœ‰å¾ˆå¤šè¿æ¥å»ºç«‹ï¼Œä½†é•¿æ—¶é—´ inactiveï¼Œä¼šé˜»å¡çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹ï¼Œå› æ­¤ä¸é€‚åˆé•¿è¿æ¥ï¼Œåªé€‚åˆçŸ­è¿æ¥</li></ul></li><li>é˜»å¡åœ¨å“ªé‡Œ(äººè¯)<ul><li>1ã€è¿æ¥çš„é˜»å¡ï¼ˆacceptï¼‰</li><li>2ã€å†™å…¥æ•°æ®çš„é˜»å¡ï¼ˆreadï¼‰</li><li>3ã€accept çš„æ—¶å€™ä¸èƒ½ read ,read æ—¶å€™ä¸èƒ½ accept ï¼Œè¿™å°±æ˜¯é˜»å¡</li><li>4ã€ä¸€å¥è¯ï¼šè¿™ä¸ªçº¿ç¨‹æ²¡æœ‰å‘ç”Ÿï¼Œè¿˜ä¼šå°±ä¼šç­‰å¾…ï¼ˆåä¹‹ï¼šä¸ä¼šç­‰å¾…åˆ™æ˜¯éé˜»å¡ï¼‰</li></ul></li></ul><h5 id="server"><a href="#server" class="headerlink" title="server"></a>server</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// ä½¿ç”¨ nio æ¥ç†è§£é˜»å¡æ¨¡å¼ï¼Œå•çº¿ç¨‹</span>        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1ã€åˆ›å»ºæœåŠ¡ç«¯</span>        <span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2ã€ç»‘å®šç›‘å¬ç«¯å£</span>        ssc<span class="token punctuation">.</span>bind <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span> <span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3ã€åˆ›å»ºè¿æ¥é›†åˆ</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> channels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¾ªç¯è¿è¡Œç­‰å¾…</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"connection..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 4ã€accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡</span>            <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span>accept <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹åœæ­¢è¿è¡Œ</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connected... {}"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>            channels<span class="token punctuation">.</span>add <span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel <span class="token operator">:</span> channels<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// 5ã€æ¥å—å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"before read... {}"</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>                channel<span class="token punctuation">.</span>read <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å†™å…¥ï¼ˆé˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹åœæ­¢è¿è¡Œï¼‰</span>                buffer<span class="token punctuation">.</span>flip <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ‡æ¢ä¸ºè¯»æ¨¡å¼</span>                <span class="token function">debugRead</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‰“å°å¯è¯»å–çš„å†…å®¹</span>                buffer<span class="token punctuation">.</span>clear <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ‡æ¢ä¸ºå†™æ¨¡å¼</span>                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"after read...{}"</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="client"><a href="#client" class="headerlink" title="client"></a>client</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span>connect <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span> <span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"waiting..."</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208212225480.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208212234376.png"></p><h4 id="1-2ã€éé˜»å¡"><a href="#1-2ã€éé˜»å¡" class="headerlink" title="1.2ã€éé˜»å¡"></a>1.2ã€éé˜»å¡</h4><ul><li>éé˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šä¸ä¼šè®©çº¿ç¨‹æš‚åœ<ul><li>åœ¨ ServerSocketChannel.accept åœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶ï¼Œä¼šè¿”å› nullï¼Œç»§ç»­è¿è¡Œ</li><li>SocketChannel.read åœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œä¼šè¿”å› 0ï¼Œä½†çº¿ç¨‹ä¸å¿…é˜»å¡ï¼Œå¯ä»¥å»æ‰§è¡Œå…¶å®ƒ SocketChannel çš„ read æˆ–æ˜¯å»æ‰§è¡Œ ServerSocketChannel.accept </li><li>å†™æ•°æ®æ—¶ï¼Œçº¿ç¨‹åªæ˜¯ç­‰å¾…æ•°æ®å†™å…¥ Channel å³å¯ï¼Œæ— éœ€ç­‰ Channel é€šè¿‡ç½‘ç»œæŠŠæ•°æ®å‘é€å‡ºå»</li></ul></li><li>ä½†éé˜»å¡æ¨¡å¼ä¸‹ï¼Œå³ä½¿æ²¡æœ‰è¿æ¥å»ºç«‹ï¼Œå’Œå¯è¯»æ•°æ®ï¼Œçº¿ç¨‹ä»ç„¶åœ¨ä¸æ–­è¿è¡Œï¼Œç™½ç™½æµªè´¹äº† cpu</li><li>æ•°æ®å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹å®é™…è¿˜æ˜¯é˜»å¡çš„ï¼ˆAIO æ”¹è¿›çš„åœ°æ–¹ï¼‰</li></ul><h5 id="serverï¼šæœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯ä»£ç ä¸å˜"><a href="#serverï¼šæœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯ä»£ç ä¸å˜" class="headerlink" title="serverï¼šæœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯ä»£ç ä¸å˜"></a>serverï¼šæœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯ä»£ç ä¸å˜</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotBlockServer</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// ä½¿ç”¨ nio æ¥ç†è§£é˜»å¡æ¨¡å¼ï¼Œå•çº¿ç¨‹</span>        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1ã€åˆ›å»ºæœåŠ¡ç«¯</span>        <span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span>configureBlocking <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ‡æ¢ä¸ºéé˜»å¡æ¨¡å¼ï¼Œé»˜è®¤ä¸ºé˜»å¡</span>        <span class="token comment">// 2ã€ç»‘å®šç›‘å¬ç«¯å£</span>        ssc<span class="token punctuation">.</span>bind <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span> <span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3ã€åˆ›å»ºè¿æ¥é›†åˆ</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> channels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¾ªç¯è¿è¡Œç­‰å¾…</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"connection..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 4ã€accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡</span>            <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span>accept <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//éé˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹ç»§ç»­è¿è¡Œ</span>            log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"connected... {}"</span><span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>            channels<span class="token punctuation">.</span>add <span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel <span class="token operator">:</span> channels<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// 5ã€æ¥å—å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span>                <span class="token comment">// å¦‚æœæ²¡æœ‰è¯»åˆ°æ•°æ®ï¼Œread è¿”å› 0</span>                <span class="token keyword">int</span> read <span class="token operator">=</span> channel<span class="token punctuation">.</span>read <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å†™å…¥ï¼ˆéé˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹ç»§ç»­è¿è¡Œï¼‰</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"before read... {}"</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>                    buffer<span class="token punctuation">.</span>flip <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ‡æ¢ä¸ºè¯»æ¨¡å¼</span>                    debugRead <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‰“å°å¯è¯»å–çš„å†…å®¹</span>                    buffer<span class="token punctuation">.</span>clear <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ‡æ¢ä¸ºå†™æ¨¡å¼</span>                    log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"after read...{}"</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¤šä¸ªå®¢æˆ·ç«¯è°ƒè¯•å‘ç°ï¼šå…¶å®ä¸ç”¨çš„æ—¶å€™è¿˜åœ¨ä¸€ç›´æ‰“å°ï¼ŒCPUçŠ¶æ€æ˜¯æ‰“æ»¡çš„ï¼Œè‡ªç„¶ä¹Ÿæ˜¯æ€§èƒ½çš„æ¶ˆè€—</p><h4 id="1-3ã€å¤šè·¯å¤ç”¨"><a href="#1-3ã€å¤šè·¯å¤ç”¨" class="headerlink" title="1.3ã€å¤šè·¯å¤ç”¨"></a>1.3ã€å¤šè·¯å¤ç”¨</h4><p>å•çº¿ç¨‹å¯ä»¥é…åˆ Selector å®Œæˆå¯¹å¤šä¸ª Channel å¯è¯»å†™äº‹ä»¶çš„ç›‘æ§ï¼Œè¿™ç§°ä¹‹ä¸ºå¤šè·¯å¤ç”¨</p><ul><li>å¤šè·¯å¤ç”¨ä»…é’ˆå¯¹ç½‘ç»œ IOã€æ™®é€šæ–‡ä»¶ IO æ²¡æ³•åˆ©ç”¨å¤šè·¯å¤ç”¨</li><li>å¦‚æœä¸ç”¨ Selector çš„éé˜»å¡æ¨¡å¼ï¼Œçº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨åšæ— ç”¨åŠŸï¼Œè€Œ Selector èƒ½å¤Ÿä¿è¯<ul><li>æœ‰å¯è¿æ¥äº‹ä»¶æ—¶æ‰å»è¿æ¥</li><li>æœ‰å¯è¯»äº‹ä»¶æ‰å»è¯»å–</li><li>æœ‰å¯å†™äº‹ä»¶æ‰å»å†™å…¥<ul><li>é™äºç½‘ç»œä¼ è¾“èƒ½åŠ›ï¼ŒChannel æœªå¿…æ—¶æ—¶å¯å†™ï¼Œä¸€æ—¦ Channel å¯å†™ï¼Œä¼šè§¦å‘ Selector çš„å¯å†™äº‹ä»¶</li></ul></li></ul></li></ul><h3 id="2ã€Selector-1"><a href="#2ã€Selector-1" class="headerlink" title="2ã€Selector"></a>2ã€Selector</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208242246169.png"></p><p>å¥½å¤„</p><ul><li>ä¸€ä¸ªçº¿ç¨‹é…åˆ selector å°±å¯ä»¥ç›‘æ§å¤šä¸ª channel çš„äº‹ä»¶ï¼Œäº‹ä»¶å‘ç”Ÿçº¿ç¨‹é‡‡å–å¤„ç†ã€‚é¿å…éé˜»å¡æ¨¡å¼ä¸‹æ‰€åšçš„æ— ç”¨åŠŸ</li><li>è®©è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¢«å……åˆ†çš„åˆ©ç”¨</li><li>èŠ‚çº¦äº†çº¿ç¨‹çš„æ•°é‡</li><li>å‡å°‘äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</li></ul><h4 id="1ã€åˆ›å»º"><a href="#1ã€åˆ›å»º" class="headerlink" title="1ã€åˆ›å»º"></a>1ã€åˆ›å»º</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€ç»‘å®š-Channel-äº‹ä»¶"><a href="#2ã€ç»‘å®š-Channel-äº‹ä»¶" class="headerlink" title="2ã€ç»‘å®š Channel äº‹ä»¶"></a>2ã€ç»‘å®š Channel äº‹ä»¶</h4><p>ä¹Ÿç§°ä¹‹ä¸ºæ³¨å†Œäº‹ä»¶ï¼Œç»‘å®šçš„äº‹ä»¶ selector æ‰å›å…³å¿ƒ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">channel<span class="token punctuation">.</span>configureBlocking <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ ¹æ®å¸¸é‡å€¼æ¥é€‰æ‹©ç»‘å®šç±»å‹ SelectionKey.OP_ACCEPT</span><span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> channel<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> ç»‘å®šäº‹ä»¶<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>channel å¿…é¡»åœ¨éé˜»å¡æ¨¡å¼ä¸‹å·¥ä½œ</li><li>FileChannel æ²¡æœ‰éé˜»å¡æ¨¡å¼ï¼Œæ‰€ä»¥ä¸èƒ½é…åˆ selector ä½¿ç”¨</li><li>ç»‘å®šçš„äº‹ä»¶ç±»å‹<ul><li>connect - å®¢æˆ·ç«¯è¿æ¥æˆåŠŸæ—¶è§¦å‘</li><li>accept   - æœåŠ¡ç«¯æˆåŠŸè¿æ¥æ—¶è§¦å‘</li><li>read      - æ•°æ®å¯è¯»å…¥æ—¶è§¦å‘</li><li>write     -  æ•°æ®å¯å†™å…¥æ—¶è§¦å‘</li></ul></li></ul><h4 id="3ã€ç›‘å¬-Channel-äº‹ä»¶"><a href="#3ã€ç›‘å¬-Channel-äº‹ä»¶" class="headerlink" title="3ã€ç›‘å¬ Channel äº‹ä»¶"></a>3ã€ç›‘å¬ Channel äº‹ä»¶</h4><p>å¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹æ³•æ¥ç›‘å¬æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæ–¹æ³•çš„è¿”å›å€¼ä»£è¡¨æœ‰å¤šå°‘ channel å‘ç”Ÿäº†äº‹ä»¶ã€‚</p><p>æ–¹æ³•ä¸€ï¼šé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–¹æ³•äºŒï¼šé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿï¼Œæˆ–æ˜¯è¶…æ—¶ï¼ˆæ—¶é—´å•ä½ä¸º msï¼‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–¹æ³•ä¸‰ï¼šä¸ä¼šé˜»å¡ï¼Œä¹Ÿå°±æ˜¯ä¸ç®¡æœ‰æ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå°±ç«‹å³è¿”å›ï¼Œè‡ªå·±æ ¹æ®è¿”å›å€¼æ£€æŸ¥å½“å‰æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> count <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4ã€ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡"><a href="#4ã€ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡" class="headerlink" title="4ã€ğŸ’¡ select ä½•æ—¶ä¸é˜»å¡"></a>4ã€ğŸ’¡ select ä½•æ—¶ä¸é˜»å¡</h4><blockquote><ul><li>äº‹ä»¶å‘ç”Ÿæ—¶<ul><li>å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ï¼Œä¼šè§¦å‘ acceptäº‹ä»¶</li><li>å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥ï¼Œå®¢æˆ·ç«¯æ­£å¸¸ï¼Œæˆ–è€…å¼‚å¸¸å…³é—­æ—¶ï¼Œéƒ½ä¼šè§¦å‘ read äº‹ä»¶ï¼Œå¦å¤–å¦‚æœå‘é€çš„æ•°æ®å¤§äº buffer ç¼“å†²åŒºï¼Œä¼šè§¦å‘å¤šæ¬¡è¯»å–äº‹ä»¶</li><li>channel å¯å†™ï¼Œä¼šè§¦å‘ write äº‹ä»¶</li><li>åœ¨ Linux ä¸‹ nio bug å‘ç”Ÿæ—¶</li></ul></li><li>è°ƒç”¨ selector.wakeup()ï¼Œå”¤é†’</li><li>è°ƒç”¨ selector.clone()ï¼Œå…³é—­</li><li>selector æ‰€åœ¨çº¿ç¨‹ interruptï¼ˆæ‰“æ–­ï¼Œé˜»æ–­ï¼Œæš‚å®šï¼‰</li></ul></blockquote><h3 id="3ã€å¤„ç†-accept-äº‹ä»¶"><a href="#3ã€å¤„ç†-accept-äº‹ä»¶" class="headerlink" title="3ã€å¤„ç† accept äº‹ä»¶"></a>3ã€å¤„ç† accept äº‹ä»¶</h3><p>ä¸»è¦ç”¨äºå»ºç«‹è¿æ¥</p><h5 id="å®¢æˆ·ç«¯ä»£ç "><a href="#å®¢æˆ·ç«¯ä»£ç " class="headerlink" title="å®¢æˆ·ç«¯ä»£ç "></a>å®¢æˆ·ç«¯ä»£ç </h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>network<span class="token punctuation">.</span>selector</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span> <span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>            socket<span class="token punctuation">.</span>getOutputStream <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>write <span class="token punctuation">(</span><span class="token string">"hello!"</span><span class="token punctuation">.</span>getBytes <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span>read <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="æœåŠ¡ç«¯ä»£ç "><a href="#æœåŠ¡ç«¯ä»£ç " class="headerlink" title="æœåŠ¡ç«¯ä»£ç "></a>æœåŠ¡ç«¯ä»£ç </h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>network<span class="token punctuation">.</span>selector</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">SelectionKey</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">Selector</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcceptService</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// 1ã€åˆ›å»º selector ç®¡ç†å¤šä¸ª channel</span>        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ServerSocketChannel</span> channel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span>configureBlocking <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2ã€å»ºç«‹ selector å’Œ channel çš„è”ç³»(æ³¨å†Œ)</span>        channel<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// SelectionKey å½“äº‹ä»¶å‘ç”Ÿåï¼Œé€šè¿‡å®ƒå¾—åˆ°äº‹ä»¶ç±»å‹ å’Œ å“ªä¸ª channel å‘ç”Ÿäº†è¯¥äº‹ä»¶</span>        <span class="token class-name">SelectionKey</span> ckey <span class="token operator">=</span> channel<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// key åªå…³æ³¨ accept äº‹ä»¶</span>        <span class="token comment">// interestOps åªå…³æ³¨</span>        ckey<span class="token punctuation">.</span>interestOps <span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"register key:{}"</span><span class="token punctuation">,</span> ckey<span class="token punctuation">)</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span>bind <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span> <span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// 3ã€select æ–¹æ³•ï¼Œæ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹é˜»å¡ï¼›æœ‰äº‹ä»¶ï¼Œæ‰æ¢å¤è¿è¡Œ</span>            <span class="token comment">//select åœ¨äº‹ä»¶æœªå¤„ç†çš„æ—¶å€™ï¼Œå®ƒä¸ä¼šé˜»å¡ï¼›äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†æˆ–è€…å–æ¶ˆï¼Œä¸èƒ½ç½®ä¹‹ä¸ç†</span>            selector<span class="token punctuation">.</span>select <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 4ã€å¤„ç†äº‹ä»¶ï¼ŒselectedKey å†…éƒ¨åŒ…å«äº†æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶</span>            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span>selectedKeys <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç†</span>            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> keys<span class="token punctuation">.</span>iterator <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span>hasNext <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span>next <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                key<span class="token punctuation">.</span>cancel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†"><a href="#ğŸ’¡-äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†" class="headerlink" title="ğŸ’¡ äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†"></a>ğŸ’¡ äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java">äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆå–æ¶ˆï¼ˆcancelï¼‰ï¼Œä¸èƒ½ä»€ä¹ˆéƒ½ä¸åšï¼Œå¦åˆ™ä¸‹æ¬¡è¯¥äº‹ä»¶ä»ä¼šè§¦å‘ï¼Œè¿™æ˜¯å› ä¸º nioåº•å±‚ä½¿ç”¨çš„æ˜¯æ°´å¹³è§¦å‘<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4ã€å¤„ç†-read-äº‹ä»¶"><a href="#4ã€å¤„ç†-read-äº‹ä»¶" class="headerlink" title="4ã€å¤„ç† read äº‹ä»¶"></a>4ã€å¤„ç† read äº‹ä»¶</h3><h5 id="service"><a href="#service" class="headerlink" title="service"></a>service</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>network<span class="token punctuation">.</span>selector</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetSocketAddress</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBuffer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>channels<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">ByteBufferUtil</span><span class="token punctuation">.</span>debugRead<span class="token punctuation">;</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReadService</span> <span class="token punctuation">{</span>    <span class="token comment">// sscKey ã€ scKey ä¸€äººä¸€ä¸ªç®¡ç†å‘˜</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// 1ã€åˆ›å»º selector ç®¡ç†å¤šä¸ª channel</span>        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ServerSocketChannel</span> channel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span>configureBlocking <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2ã€å»ºç«‹ selector å’Œ channel çš„è”ç³»(æ³¨å†Œ)</span>        channel<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// SelectionKey å½“äº‹ä»¶å‘ç”Ÿåï¼Œé€šè¿‡å®ƒå¾—åˆ°äº‹ä»¶ç±»å‹ å’Œ å“ªä¸ª channel å‘ç”Ÿäº†è¯¥äº‹ä»¶</span>        <span class="token class-name">SelectionKey</span> sscKey <span class="token operator">=</span> channel<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// key åªå…³æ³¨ accept äº‹ä»¶</span>        <span class="token comment">// interestOps åªå…³æ³¨</span>        sscKey<span class="token punctuation">.</span>interestOps <span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"register key:{}"</span><span class="token punctuation">,</span> sscKey<span class="token punctuation">)</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span>bind <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span> <span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// 3ã€select æ–¹æ³•ï¼Œæ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹é˜»å¡ï¼›æœ‰äº‹ä»¶ï¼Œæ‰æ¢å¤è¿è¡Œ</span>            <span class="token comment">//select åœ¨äº‹ä»¶æœªå¤„ç†çš„æ—¶å€™ï¼Œå®ƒä¸ä¼šé˜»å¡ï¼›äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†æˆ–è€…å–æ¶ˆï¼Œä¸èƒ½ç½®ä¹‹ä¸ç†</span>            selector<span class="token punctuation">.</span>select <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 4ã€å¤„ç†äº‹ä»¶ï¼ŒselectedKey å†…éƒ¨åŒ…å«äº†æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶</span>            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span>selectedKeys <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç†</span>            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> keys<span class="token punctuation">.</span>iterator <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span>hasNext <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span>next <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"key:{}"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 5ã€åŒºåˆ†äº‹ä»¶ç±»å‹</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>isAcceptable <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// å¦‚æœæ˜¯ accept</span>                    <span class="token class-name">ServerSocketChannel</span> channelTest1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span>channel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> channelTest1<span class="token punctuation">.</span>accept <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    sc<span class="token punctuation">.</span>configureBlocking <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">SelectionKey</span> scKey <span class="token operator">=</span> sc<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    scKey<span class="token punctuation">.</span>interestOps <span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>isReadable <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// å¦‚æœæ˜¯ read</span>                    <span class="token comment">// æ‹¿åˆ°è§¦å‘çš„äº‹ä»¶ channel</span>                    <span class="token class-name">SocketChannel</span> channlTest2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span>channel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    channlTest2<span class="token punctuation">.</span>read <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    buffer<span class="token punctuation">.</span>flip <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    debugRead <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment">// key.cancel ( );</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡ºç»“æœï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208292359698.png"></p><p><strong>å› ä¸º select ç”¨å®Œ key æ²¡æœ‰ remove()</strong></p><h4 id="4-1ã€ä¸ºä»€ä¹ˆè¦remove"><a href="#4-1ã€ä¸ºä»€ä¹ˆè¦remove" class="headerlink" title="4.1ã€ä¸ºä»€ä¹ˆè¦remove"></a>4.1ã€ä¸ºä»€ä¹ˆè¦remove</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208302330191.png"></p><blockquote><p>å› ä¸º select åœ¨äº‹ä»¶å‘ç”Ÿåï¼Œå°±ä¼šå°†ç›¸å…³çš„ key æ”¾å…¥ selectedKeys é›†åˆï¼Œä½†ä¸ä¼šåœ¨å¤„ç†å®Œåä» selectedKeys é›†åˆä¸­ç§»é™¤ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–ç åˆ é™¤ã€‚ä¾‹å¦‚</p><ul><li>ç¬¬ä¸€æ¬¡è§¦å‘äº† ssckey ä¸Šçš„ accept äº‹ä»¶ï¼Œæ²¡æœ‰ç§»é™¤ ssckey </li><li>ç¬¬äºŒæ¬¡è§¦å‘äº† sckey ä¸Šçš„ read äº‹ä»¶ï¼Œä½†è¿™æ—¶ selectedKeys ä¸­è¿˜æœ‰ä¸Šæ¬¡çš„ ssckey ï¼Œåœ¨å¤„ç†æ—¶å› ä¸ºæ²¡æœ‰çœŸæ­£çš„ serverSocket è¿ä¸Šäº†ï¼Œå°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸</li></ul></blockquote><h4 id="4-2ã€remove-ä»£ç "><a href="#4-2ã€remove-ä»£ç " class="headerlink" title="4.2ã€remove ä»£ç "></a>4.2ã€remove ä»£ç </h4><p>æ‹¿åˆ°åå°±åˆ æ‰ï¼Œæ–¹å¼é‡å¤äº‹ä»¶å¤„ç†ï¼ˆå†™åœ¨åé¢ä¹Ÿå¯ä»¥ï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208302331079.png"></p><h4 id="4-3ã€å¤„ç†å®¢æˆ·ç«¯æ–­å¼€"><a href="#4-3ã€å¤„ç†å®¢æˆ·ç«¯æ–­å¼€" class="headerlink" title="4.3ã€å¤„ç†å®¢æˆ·ç«¯æ–­å¼€"></a>4.3ã€å¤„ç†å®¢æˆ·ç«¯æ–­å¼€</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202208312250110.png"></p><h4 id="4-4ã€ä¸å¤„ç†è¾¹ç•Œé—®é¢˜"><a href="#4-4ã€ä¸å¤„ç†è¾¹ç•Œé—®é¢˜" class="headerlink" title="4.4ã€ä¸å¤„ç†è¾¹ç•Œé—®é¢˜"></a>4.4ã€ä¸å¤„ç†è¾¹ç•Œé—®é¢˜</h4><h5 id="ä»¥-BIO-ä¸ºæ¡ˆä¾‹ä»£ç "><a href="#ä»¥-BIO-ä¸ºæ¡ˆä¾‹ä»£ç " class="headerlink" title="ä»¥ BIO ä¸ºæ¡ˆä¾‹ä»£ç "></a>ä»¥ BIO ä¸ºæ¡ˆä¾‹ä»£ç </h5><p><strong>service</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BoundaryService</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">ServerSocket</span> ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span> <span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">Socket</span> socket <span class="token operator">=</span> ss<span class="token punctuation">.</span>accept <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">InputStream</span> in <span class="token operator">=</span> socket<span class="token punctuation">.</span>getInputStream <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> read <span class="token operator">=</span> in<span class="token punctuation">.</span>read <span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span> <span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>client</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BoundDaryClient</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span> <span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> socket<span class="token punctuation">.</span>getOutputStream <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span>write <span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">.</span>getBytes <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span>write <span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">.</span>getBytes <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span>write <span class="token punctuation">(</span><span class="token string">"ä½ å¥½"</span><span class="token punctuation">.</span>getBytes <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span>close <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è¾“å‡º</strong></p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">helloworldï¿½ï¿½å¥½<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-5ã€å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œï¼ˆå®¹é‡è¶…å‡ºï¼‰"><a href="#4-5ã€å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œï¼ˆå®¹é‡è¶…å‡ºï¼‰" class="headerlink" title="4.5ã€å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œï¼ˆå®¹é‡è¶…å‡ºï¼‰"></a>4.5ã€å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œï¼ˆå®¹é‡è¶…å‡ºï¼‰</h4><p><strong>å®¹é‡è¶…å‡ºï¼Œå°±éœ€è¦è€ƒè™‘æ‰©å®¹é—®é¢˜ï¼Œè¿™è¾¹æ²¡å»è€ƒè™‘ç¼©å®¹ï¼Œnettry ä¼šæœ‰é€‚é…è¿™äº›é—®é¢˜</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209031033587.png"></p><ul><li>ä¸€ç§æ€è·¯æ˜¯å›ºå®šæ¶ˆæ¯é•¿åº¦ï¼Œæ•°æ®åŒ…å¤§å°ä¸€æ ·ï¼ŒæœåŠ¡å™¨æŒ‰é¢„å®šé•¿åº¦è¯»å–ï¼Œç¼ºç‚¹æ˜¯æµªè´¹å¸¦å®½</li><li>å¦ä¸€ç§æ€è·¯æ˜¯æŒ‰åˆ†éš”ç¬¦æ‹†åˆ†ï¼Œç¼ºç‚¹æ˜¯æ•ˆç‡ä½</li><li>TLV æ ¼å¼ï¼Œå³ Type ç±»å‹ã€Length é•¿åº¦ã€Value æ•°æ®ï¼Œç±»å‹å’Œé•¿åº¦å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥æ–¹ä¾¿è·å–æ¶ˆæ¯å¤§å°ï¼Œåˆ†é…åˆé€‚çš„ bufferï¼Œç¼ºç‚¹æ˜¯ buffer éœ€è¦æå‰åˆ†é…ï¼Œå¦‚æœå†…å®¹è¿‡å¤§ï¼Œåˆ™å½±å“ server ååé‡<ul><li>Http 1.1 æ˜¯ TLV æ ¼å¼</li><li>Http 2.0 æ˜¯ LTV æ ¼å¼</li></ul></li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209031858792.png"></p><p>**è¿™è¾¹ service ä¼šç”¨åˆ°é™„ä»¶çŸ¥è¯†ï¼Œä¼šæŠŠ bytebuffer ä½œä¸ºäº‹ä»¶æ³¨å†Œåˆ° SelectorKey ä¸Š **</p><p>æ—¢ ï¼Œ registerï¼ˆt1,t2,t3ï¼‰ç¬¬ä¸‰ä¸ªå‚æ•°ä¸Š</p><p><strong>service</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// sscKey ã€ scKey ä¸€äººä¸€ä¸ªç®¡ç†å‘˜</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>    <span class="token comment">// 1ã€åˆ›å»º selector ç®¡ç†å¤šä¸ª channel</span>    <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    ssc<span class="token punctuation">.</span>configureBlocking <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 2ã€å»ºç«‹ selector å’Œ channel çš„è”ç³»(æ³¨å†Œ)</span>    ssc<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// SelectionKey å½“äº‹ä»¶å‘ç”Ÿåï¼Œé€šè¿‡å®ƒå¾—åˆ°äº‹ä»¶ç±»å‹ å’Œ å“ªä¸ª channel å‘ç”Ÿäº†è¯¥äº‹ä»¶</span>    <span class="token class-name">SelectionKey</span> sscKey <span class="token operator">=</span> ssc<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// key åªå…³æ³¨ accept äº‹ä»¶</span>    <span class="token comment">// interestOps åªå…³æ³¨</span>    sscKey<span class="token punctuation">.</span>interestOps <span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"register key:{}"</span><span class="token punctuation">,</span> sscKey<span class="token punctuation">)</span><span class="token punctuation">;</span>    ssc<span class="token punctuation">.</span>bind <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span> <span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 3ã€select æ–¹æ³•ï¼Œæ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹é˜»å¡ï¼›æœ‰äº‹ä»¶ï¼Œæ‰æ¢å¤è¿è¡Œ</span>        <span class="token comment">//select åœ¨äº‹ä»¶æœªå¤„ç†çš„æ—¶å€™ï¼Œå®ƒä¸ä¼šé˜»å¡ï¼›äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†æˆ–è€…å–æ¶ˆï¼Œä¸èƒ½ç½®ä¹‹ä¸ç†</span>        selector<span class="token punctuation">.</span>select <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4ã€å¤„ç†äº‹ä»¶ï¼ŒselectedKey å†…éƒ¨åŒ…å«äº†æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶</span>        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span>selectedKeys <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç†</span>        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> keys<span class="token punctuation">.</span>iterator <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span>hasNext <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span>next <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            iter<span class="token punctuation">.</span>remove <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"key:{}"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 5ã€åŒºåˆ†äº‹ä»¶ç±»å‹</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>isAcceptable <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// å¦‚æœæ˜¯ accept</span>                <span class="token class-name">ServerSocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span>channel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> channel<span class="token punctuation">.</span>accept <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                sc<span class="token punctuation">.</span>configureBlocking <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// attachment</span>                <span class="token comment">// å°†ä¸€ä¸ª byteBuffer ä½œä¸ºé™„ä»¶å…³è”åˆ° selectionKey ä¸Š</span>                <span class="token class-name">SelectionKey</span> scKey <span class="token operator">=</span> sc<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                scKey<span class="token punctuation">.</span>interestOps <span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>isReadable <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// å¦‚æœæ˜¯ read</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    <span class="token comment">// æ‹¿åˆ°è§¦å‘çš„äº‹ä»¶ channel</span>                    <span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span>channel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// è·å– selectionKey ä¸Šå…³è”çš„äº‹ä»¶</span>                    <span class="token comment">//ByteBuffer buffer = ByteBuffer.allocate (16);</span>                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span>attachment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// å¦‚æœæ˜¯æ­£å¸¸æ–­å¼€ã€‚read çš„æ–¹æ³•è¿”å›å€¼æ˜¯ -1</span>                    <span class="token keyword">int</span> read <span class="token operator">=</span> channel<span class="token punctuation">.</span>read <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        key<span class="token punctuation">.</span>cancel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token comment">// å‹ç¼©è¯»å–ä¸€æ¬¡ï¼Œç¡®ä¿æ•°æ®å®Œæ•´</span>                        split <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// å¦‚æœæ¸¸æ ‡çš„èµ·å§‹ç›¸ç­‰ï¼Œè¯´æ˜å®¹é‡å·²æ»¡ï¼Œéœ€è¦æ‰©å®¹</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>position <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">==</span> buffer<span class="token punctuation">.</span>limit <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token comment">// æ‰©å®¹ä¸¤å€</span>                            <span class="token class-name">ByteBuffer</span> newBuffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>capacity <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            buffer<span class="token punctuation">.</span>flip <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                            newBuffer<span class="token punctuation">.</span>put <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                            key<span class="token punctuation">.</span>attach <span class="token punctuation">(</span>newBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// å› ä¸ºå®¢æˆ·ç«¯æ–­å¼€äº†ï¼Œå› æ­¤éœ€è¦å°† key å–æ¶ˆï¼ˆä» selector å¾—keys é›†åˆä¸­çœŸæ­£åˆ é™¤ï¼‰</span>                    key<span class="token punctuation">.</span>cancel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>client</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span>  <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    sc<span class="token punctuation">.</span>connect <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span> <span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">SocketAddress</span> address <span class="token operator">=</span> sc<span class="token punctuation">.</span>getLocalAddress <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    sc<span class="token punctuation">.</span>write <span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span>defaultCharset <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode <span class="token punctuation">(</span><span class="token string">"0123456789abcdef"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    sc<span class="token punctuation">.</span>write <span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span>defaultCharset <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode <span class="token punctuation">(</span><span class="token string">"012345Q\n6789abcdef3333\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-6ã€ByteBuffer-å¤§å°åˆ†é…"><a href="#4-6ã€ByteBuffer-å¤§å°åˆ†é…" class="headerlink" title="4.6ã€ByteBuffer å¤§å°åˆ†é…"></a>4.6ã€ByteBuffer å¤§å°åˆ†é…</h4><ul><li>æ¯ä¸ª channel éƒ½éœ€è¦è®°å½•å¯èƒ½è¢«åˆ‡åˆ†çš„æ¶ˆæ¯ï¼Œå› ä¸º ByteBuffer ä¸èƒ½è¢«å¤šä¸ª channel å…±åŒä½¿ç”¨ï¼Œå› æ­¤éœ€è¦ä¸ºæ¯ä¸ª channel ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„ ByteBuffer</li><li>ByteBuffer ä¸èƒ½å¤ªå¤§ï¼Œæ¯”å¦‚ä¸€ä¸ª ByteBuffer 1Mb çš„è¯ï¼Œè¦æ”¯æŒç™¾ä¸‡è¿æ¥å°±è¦ 1Tb å†…å­˜ï¼Œå› æ­¤éœ€è¦è®¾è®¡å¤§å°å¯å˜çš„ ByteBuffer<ul><li>ä¸€ç§æ€è·¯æ˜¯é¦–å…ˆåˆ†é…ä¸€ä¸ªè¾ƒå°çš„ bufferï¼Œä¾‹å¦‚ 4kï¼Œå¦‚æœå‘ç°æ•°æ®ä¸å¤Ÿï¼Œå†åˆ†é… 8k çš„ bufferï¼Œå°† 4k buffer å†…å®¹æ‹·è´è‡³ 8k bufferï¼Œä¼˜ç‚¹æ˜¯æ¶ˆæ¯è¿ç»­å®¹æ˜“å¤„ç†ï¼Œç¼ºç‚¹æ˜¯æ•°æ®æ‹·è´è€—è´¹æ€§èƒ½ï¼Œå‚è€ƒå®ç° <a href="http://tutorials.jenkov.com/java-performance/resizable-array.html">http://tutorials.jenkov.com/java-performance/resizable-array.html</a></li><li>å¦ä¸€ç§æ€è·¯æ˜¯ç”¨å¤šä¸ªæ•°ç»„ç»„æˆ bufferï¼Œä¸€ä¸ªæ•°ç»„ä¸å¤Ÿï¼ŒæŠŠå¤šå‡ºæ¥çš„å†…å®¹å†™å…¥æ–°çš„æ•°ç»„ï¼Œä¸å‰é¢çš„åŒºåˆ«æ˜¯æ¶ˆæ¯å­˜å‚¨ä¸è¿ç»­è§£æå¤æ‚ï¼Œä¼˜ç‚¹æ˜¯é¿å…äº†æ‹·è´å¼•èµ·çš„æ€§èƒ½æŸè€—</li></ul></li></ul><h3 id="5ã€å¤„ç†-write-äº‹ä»¶"><a href="#5ã€å¤„ç†-write-äº‹ä»¶" class="headerlink" title="5ã€å¤„ç† write äº‹ä»¶"></a>5ã€å¤„ç† write äº‹ä»¶</h3><h5 id="ä¸€æ¬¡æ€§æ— æ³•å†™å®Œçš„ä¾‹å­"><a href="#ä¸€æ¬¡æ€§æ— æ³•å†™å®Œçš„ä¾‹å­" class="headerlink" title="ä¸€æ¬¡æ€§æ— æ³•å†™å®Œçš„ä¾‹å­"></a>ä¸€æ¬¡æ€§æ— æ³•å†™å®Œçš„ä¾‹å­</h5><ul><li>éé˜»å¡æ¨¡å¼ä¸‹ï¼Œæ— æ³•ä¿è¯æŠŠ buffer ä¸­æ‰€æœ‰æ•°æ®éƒ½å†™å…¥ channelï¼Œå› æ­¤éœ€è¦è¿½è¸ª write æ–¹æ³•çš„è¿”å›å€¼ï¼ˆä»£è¡¨å®é™…å†™å…¥å­—èŠ‚æ•°ï¼‰</li><li>ç”¨ selector ç›‘å¬æ‰€æœ‰ channel çš„å¯å†™äº‹ä»¶ï¼Œæ¯ä¸ª channel éƒ½éœ€è¦ä¸€ä¸ª key æ¥è·Ÿè¸ª bufferï¼Œä½†è¿™æ ·åˆä¼šå¯¼è‡´å ç”¨å†…å­˜è¿‡å¤šï¼Œå°±æœ‰ä¸¤é˜¶æ®µç­–ç•¥<ul><li>å½“æ¶ˆæ¯å¤„ç†å™¨ç¬¬ä¸€æ¬¡å†™å…¥æ¶ˆæ¯æ—¶ï¼Œæ‰å°† channel æ³¨å†Œåˆ° selector ä¸Š</li><li>selector æ£€æŸ¥ channel ä¸Šçš„å¯å†™äº‹ä»¶ï¼Œå¦‚æœæ‰€æœ‰çš„æ•°æ®å†™å®Œäº†ï¼Œå°±å–æ¶ˆ channel çš„æ³¨å†Œ</li><li>å¦‚æœä¸å–æ¶ˆï¼Œä¼šæ¯æ¬¡å¯å†™å‡ä¼šè§¦å‘ write äº‹ä»¶</li></ul></li></ul><p><strong>service</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WriteServer</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span>configureBlocking <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span>bind <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span> <span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            selector<span class="token punctuation">.</span>select <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> selector<span class="token punctuation">.</span>selectedKeys <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>iterator <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span>hasNext <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span>next <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                iter<span class="token punctuation">.</span>remove <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>isAcceptable <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span>accept <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    sc<span class="token punctuation">.</span>configureBlocking <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">SelectionKey</span> scKey <span class="token operator">=</span> sc<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 1ã€å‘å®¢æˆ·ç«¯å‘é€å¤§é‡æ•°æ®</span>                    <span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        sb<span class="token punctuation">.</span>append <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span>defaultCharset <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>encode <span class="token punctuation">(</span>sb<span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 2ã€è¿”å›å€¼ä»£è¡¨å®é™…å†™å…¥çš„å­—èŠ‚æ•°</span>                    <span class="token keyword">int</span> write <span class="token operator">=</span> sc<span class="token punctuation">.</span>write <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"å®é™…å†™å…¥å­—èŠ‚:"</span> <span class="token operator">+</span> write<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 3ã€åˆ¤æ–­æ˜¯å¦æœ‰å‰©ä½™å†…å®¹</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>hasRemaining <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment">// 4ã€å…³æ³¨å¯å†™äº‹ä»¶(1+4)</span>                        <span class="token comment">// read 1  write 4</span>                        scKey<span class="token punctuation">.</span>interestOps <span class="token punctuation">(</span>scKey<span class="token punctuation">.</span>interestOps <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_WRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// 5ã€æŠŠæœªå†™å®Œçš„æ•°æ® æŒ‚åˆ° scKeyä¸Š</span>                        scKey<span class="token punctuation">.</span>attach <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>isWritable <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span>attachment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span>channel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> write <span class="token operator">=</span> sc<span class="token punctuation">.</span>write <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"å®é™…å†™å…¥å­—èŠ‚:"</span> <span class="token operator">+</span> write<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>buffer<span class="token punctuation">.</span>hasRemaining <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// å†™å®Œäº†(åˆ‡æ¢ä¸ºè¯»æ¨¡å¼)</span>                        key<span class="token punctuation">.</span>interestOps <span class="token punctuation">(</span>key<span class="token punctuation">.</span>interestOps <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_WRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// éœ€è¦æ¸…é™¤ buffer</span>                        key<span class="token punctuation">.</span>attach <span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>client</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WriteClient</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        sc<span class="token punctuation">.</span>connect <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span> <span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ¥æ”¶æ•°æ®</span>        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            count <span class="token operator">+=</span> sc<span class="token punctuation">.</span>read <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>count <span class="token punctuation">)</span><span class="token punctuation">;</span>            buffer<span class="token punctuation">.</span>clear <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="ğŸ’¡-write-ä¸ºä½•è¦å–æ¶ˆ"><a href="#ğŸ’¡-write-ä¸ºä½•è¦å–æ¶ˆ" class="headerlink" title="ğŸ’¡ write ä¸ºä½•è¦å–æ¶ˆ"></a>ğŸ’¡ write ä¸ºä½•è¦å–æ¶ˆ</h5><p>åªè¦å‘ channel å‘é€æ•°æ®æ—¶ï¼Œsocket ç¼“å†²å¯å†™ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šé¢‘ç¹è§¦å‘;</p><p>å› æ­¤åº”å½“åªåœ¨ socket ç¼“å†²åŒºå†™ä¸ä¸‹æ—¶å†å…³æ³¨å¯å†™äº‹ä»¶ï¼Œæ•°æ®å†™å®Œä¹‹åå†å–æ¶ˆå…³æ³¨</p><h3 id="6ã€å¤šçº¿ç¨‹ä¼˜åŒ–"><a href="#6ã€å¤šçº¿ç¨‹ä¼˜åŒ–" class="headerlink" title="6ã€å¤šçº¿ç¨‹ä¼˜åŒ–"></a>6ã€å¤šçº¿ç¨‹ä¼˜åŒ–</h3><h5 id="1ã€ç¼–ç æ€è·¯"><a href="#1ã€ç¼–ç æ€è·¯" class="headerlink" title="1ã€ç¼–ç æ€è·¯"></a>1ã€ç¼–ç æ€è·¯</h5><ul><li>ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œç”¨é˜Ÿåˆ—åœ¨ä¸­é—´è¿›è¡Œä¼ è¾“ï¼ˆè¿™é‡Œç”¨å®‰å…¨é˜Ÿåˆ—ï¼‰ï¼Œnettyåº•å±‚ä¹Ÿæ˜¯</li><li>æ ¹æ®å¤„ç†å™¨æ•°é‡ï¼Œè½®è®­ï¼ˆè¿™è¾¹1.8çš„api jvm æœ‰é—®é¢˜ï¼Œåœ¨jdk 10çš„æ—¶å€™æ‰ä¿®å¤ï¼‰</li><li>å•çº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œä¸“é—¨å¤„ç† accept äº‹ä»¶</li><li>åˆ›å»º cpu æ ¸å¿ƒæ•°çš„çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œè½®æµå¤„ç† read äº‹ä»¶</li></ul><p><strong>2ã€å¦‚ä½•æ‹¿åˆ° cpu ä¸ªæ•°</strong></p><blockquote><ul><li>Runtime.getRuntime().availableProcessors() å¦‚æœå·¥ä½œåœ¨ docker å®¹å™¨ä¸‹ï¼Œå› ä¸ºå®¹å™¨ä¸æ˜¯ç‰©ç†éš”ç¦»çš„ï¼Œä¼šæ‹¿åˆ°ç‰©ç† cpu ä¸ªæ•°ï¼Œè€Œä¸æ˜¯å®¹å™¨ç”³è¯·æ—¶çš„ä¸ªæ•°</li><li>è¿™ä¸ªé—®é¢˜ç›´åˆ° jdk 10 æ‰ä¿®å¤ï¼Œä½¿ç”¨ jvm å‚æ•° UseContainerSupport é…ç½®ï¼Œ é»˜è®¤å¼€å¯</li></ul></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultiThreadServer</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>  <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span>currentThread <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setName <span class="token punctuation">(</span><span class="token string">"boss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ServerSocketChannel</span> ssc <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span>configureBlocking <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Selector</span> boos <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SelectionKey</span> boosKey <span class="token operator">=</span> ssc<span class="token punctuation">.</span>register <span class="token punctuation">(</span>boos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        boosKey<span class="token punctuation">.</span>interestOps <span class="token punctuation">(</span><span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>        ssc<span class="token punctuation">.</span>bind <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span> <span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1ã€åˆ›å»ºå›ºå®šæ•°é‡çš„ worker å¹¶åˆå§‹åŒ–</span>        <span class="token comment">// Runtime.getRuntime ().availableProcessors () å¤„ç†å™¨æ•°é‡</span>        <span class="token class-name">Worker</span><span class="token punctuation">[</span><span class="token punctuation">]</span> workers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">[</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span>getRuntime <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>availableProcessors <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> workers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            workers<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span> <span class="token punctuation">(</span><span class="token string">"WORKER-"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">AtomicInteger</span> index <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            boos<span class="token punctuation">.</span>select <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> boos<span class="token punctuation">.</span>selectedKeys <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>iterator <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span>hasNext <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span>next <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                iter<span class="token punctuation">.</span>remove <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>isAcceptable <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">SocketChannel</span> sc <span class="token operator">=</span> ssc<span class="token punctuation">.</span>accept <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    sc<span class="token punctuation">.</span>configureBlocking <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"connected...{}"</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 2. å…³è” selector</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"before register...{}"</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// è½®è®­</span>                    workers<span class="token punctuation">[</span>index<span class="token punctuation">.</span>getAndIncrement <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span>workers<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">.</span>register <span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"after register...{}"</span><span class="token punctuation">,</span> sc<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token class-name">Thread</span> thread<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token class-name">Selector</span> selector<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> start <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// è¿˜æœªåˆå§‹åŒ–</span>        <span class="token keyword">private</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentLinkedQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// åˆå§‹åŒ–çº¿ç¨‹ å’Œ selector</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> sc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>                selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>                thread<span class="token punctuation">.</span>start <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                start <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">// å”¤é†’ select æ–¹æ³• boos</span>            selector<span class="token punctuation">.</span>wakeup <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// boos</span>            sc<span class="token punctuation">.</span>register <span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    selector<span class="token punctuation">.</span>select <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// worker-0  é˜»å¡</span>                    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> selector<span class="token punctuation">.</span>selectedKeys <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>iterator <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span>hasNext <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> iter<span class="token punctuation">.</span>next <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                        iter<span class="token punctuation">.</span>remove <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>isReadable <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span>allocate <span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">SocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span>channel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                            log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"read...{}"</span><span class="token punctuation">,</span> channel<span class="token punctuation">.</span>getRemoteAddress <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            channel<span class="token punctuation">.</span>read <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                            buffer<span class="token punctuation">.</span>flip <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                            debugAll <span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7ã€UDP"><a href="#7ã€UDP" class="headerlink" title="7ã€UDP"></a>7ã€UDP</h3><ul><li>UDP æ˜¯æ— è¿æ¥çš„ï¼Œclient å‘é€æ•°æ®ä¸ä¼šç®¡ server æ˜¯å¦å¼€å¯</li><li>server è¿™è¾¹çš„ receive æ–¹æ³•ä¼šå°†æ¥æ”¶åˆ°çš„æ•°æ®å­˜å…¥ byte bufferï¼Œä½†å¦‚æœæ•°æ®æŠ¥æ–‡è¶…è¿‡ buffer å¤§å°ï¼Œå¤šå‡ºæ¥çš„æ•°æ®ä¼šè¢«é»˜é»˜æŠ›å¼ƒ</li></ul><h2 id="äº”ã€Nio-vs-Bio-or-Aio"><a href="#äº”ã€Nio-vs-Bio-or-Aio" class="headerlink" title="äº”ã€Nio vs Bio or Aio"></a>äº”ã€Nio vs Bio or Aio</h2><h3 id="1ã€stream-vs-channel"><a href="#1ã€stream-vs-channel" class="headerlink" title="1ã€stream vs channel"></a>1ã€stream vs channel</h3><ul><li>stream ä¸ä¼šè‡ªåŠ¨ç¼“å†²æ•°æ®ï¼Œchannel ä¼šåˆ©ç”¨ç³»ç»Ÿæä¾›çš„å‘é€ç¼“å†²åŒºã€æ¥æ”¶ç¼“å†²åŒºï¼ˆæ›´ä¸ºåº•å±‚ï¼‰</li><li>stream ä»…æ”¯æŒé˜»å¡ APIï¼Œchannel åŒæ—¶æ”¯æŒé˜»å¡ã€éé˜»å¡ APIï¼Œç½‘ç»œ channel å¯é…åˆ selector å®ç°å¤šè·¯å¤ç”¨</li><li>äºŒè€…å‡ä¸ºå…¨åŒå·¥ï¼Œå³è¯»å†™å¯ä»¥åŒæ—¶è¿›è¡Œ</li></ul><h3 id="2ã€IOæ¨¡å‹"><a href="#2ã€IOæ¨¡å‹" class="headerlink" title="2ã€IOæ¨¡å‹"></a>2ã€IOæ¨¡å‹</h3><h3 id="3ã€é›¶æ‹·è´"><a href="#3ã€é›¶æ‹·è´" class="headerlink" title="3ã€é›¶æ‹·è´"></a>3ã€é›¶æ‹·è´</h3><h5 id="3-1ã€ä¼ ç»ŸIOé—®é¢˜"><a href="#3-1ã€ä¼ ç»ŸIOé—®é¢˜" class="headerlink" title="3-1ã€ä¼ ç»ŸIOé—®é¢˜"></a>3-1ã€ä¼ ç»ŸIOé—®é¢˜</h5><p>ä¼ ç»Ÿçš„ IO å°†ä¸€ä¸ªæ–‡ä»¶é€šè¿‡ socket å†™å‡º</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"helloword/data.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">RandomAccessFile</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>file<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†…éƒ¨å·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209142205360.png"></p><ol><li><p>java æœ¬èº«å¹¶ä¸å…·å¤‡ IO è¯»å†™èƒ½åŠ›ï¼Œå› æ­¤ read æ–¹æ³•è°ƒç”¨åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œå»è°ƒç”¨æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰çš„è¯»èƒ½åŠ›ï¼Œå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ã€‚è¿™æœŸé—´ç”¨æˆ·çº¿ç¨‹é˜»å¡ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨ DMAï¼ˆDirect Memory Accessï¼‰æ¥å®ç°æ–‡ä»¶è¯»ï¼Œå…¶é—´ä¹Ÿä¸ä¼šä½¿ç”¨ cpu</p><blockquote><p>DMA ä¹Ÿå¯ä»¥ç†è§£ä¸ºç¡¬ä»¶å•å…ƒï¼Œç”¨æ¥è§£æ”¾ cpu å®Œæˆæ–‡ä»¶ IO</p></blockquote></li><li><p>ä»<strong>å†…æ ¸æ€</strong>åˆ‡æ¢å›<strong>ç”¨æˆ·æ€</strong>ï¼Œå°†æ•°æ®ä»<strong>å†…æ ¸ç¼“å†²åŒº</strong>è¯»å…¥<strong>ç”¨æˆ·ç¼“å†²åŒº</strong>ï¼ˆå³ byte[] bufï¼‰ï¼Œè¿™æœŸé—´ cpu ä¼šå‚ä¸æ‹·è´ï¼Œæ— æ³•åˆ©ç”¨ DMA</p></li><li><p>è°ƒç”¨ write æ–¹æ³•ï¼Œè¿™æ—¶å°†æ•°æ®ä»<strong>ç”¨æˆ·ç¼“å†²åŒº</strong>ï¼ˆbyte[] bufï¼‰å†™å…¥ <strong>socket ç¼“å†²åŒº</strong>ï¼Œcpu ä¼šå‚ä¸æ‹·è´</p></li><li><p>æ¥ä¸‹æ¥è¦å‘ç½‘å¡å†™æ•°æ®ï¼Œè¿™é¡¹èƒ½åŠ› java åˆä¸å…·å¤‡ï¼Œå› æ­¤åˆå¾—ä»<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œè°ƒç”¨æ“ä½œç³»ç»Ÿçš„å†™èƒ½åŠ›ï¼Œä½¿ç”¨ DMA å°† <strong>socket ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</p></li></ol><p>å¯ä»¥çœ‹åˆ°ä¸­é—´ç¯èŠ‚è¾ƒå¤šï¼Œjava çš„ IO å®é™…ä¸æ˜¯ç‰©ç†è®¾å¤‡çº§åˆ«çš„è¯»å†™ï¼Œè€Œæ˜¯ç¼“å­˜çš„å¤åˆ¶ï¼Œåº•å±‚çš„çœŸæ­£è¯»å†™æ˜¯æ“ä½œç³»ç»Ÿæ¥å®Œæˆçš„</p><ul><li>ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢å‘ç”Ÿäº† 3 æ¬¡ï¼Œè¿™ä¸ªæ“ä½œæ¯”è¾ƒé‡é‡çº§</li><li>æ•°æ®æ‹·è´äº†å…± 4 æ¬¡</li></ul><h5 id="3-2ã€NIOä¼˜åŒ–"><a href="#3-2ã€NIOä¼˜åŒ–" class="headerlink" title="3-2ã€NIOä¼˜åŒ–"></a>3-2ã€NIOä¼˜åŒ–</h5><p>é€šè¿‡ DirectByteBuf </p><ul><li>ByteBuffer.allocate(10)  HeapByteBuffer ä½¿ç”¨çš„è¿˜æ˜¯ java å†…å­˜</li><li>ByteBuffer.allocateDirect(10)  DirectByteBuffer ä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿå†…å­˜</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209142208809.png"></p><p>å¤§éƒ¨åˆ†æ­¥éª¤ä¸ä¼˜åŒ–å‰ç›¸åŒï¼Œä¸å†èµ˜è¿°ã€‚å”¯æœ‰ä¸€ç‚¹ï¼šjava å¯ä»¥ä½¿ç”¨ DirectByteBuf å°†å †å¤–å†…å­˜æ˜ å°„åˆ° jvm å†…å­˜ä¸­æ¥ç›´æ¥è®¿é—®ä½¿ç”¨</p><ul><li>è¿™å—å†…å­˜ä¸å— jvm åƒåœ¾å›æ”¶çš„å½±å“ï¼Œå› æ­¤å†…å­˜åœ°å€å›ºå®šï¼Œæœ‰åŠ©äº IO è¯»å†™</li><li>java ä¸­çš„ DirectByteBuf å¯¹è±¡ä»…ç»´æŠ¤äº†æ­¤å†…å­˜çš„è™šå¼•ç”¨ï¼Œå†…å­˜å›æ”¶åˆ†æˆä¸¤æ­¥<ul><li>DirectByteBuf å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œå°†è™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ—</li><li>é€šè¿‡ä¸“é—¨çº¿ç¨‹è®¿é—®å¼•ç”¨é˜Ÿåˆ—ï¼Œæ ¹æ®è™šå¼•ç”¨é‡Šæ”¾å †å¤–å†…å­˜</li></ul></li><li>å‡å°‘äº†ä¸€æ¬¡æ•°æ®æ‹·è´ï¼Œç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢æ¬¡æ•°æ²¡æœ‰å‡å°‘</li></ul><p>è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆåº•å±‚é‡‡ç”¨äº† linux 2.1 åæä¾›çš„ sendFile æ–¹æ³•ï¼‰ï¼Œjava ä¸­å¯¹åº”ç€ä¸¤ä¸ª channel è°ƒç”¨ transferTo/transferFrom æ–¹æ³•æ‹·è´æ•°æ®</p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209142208773.png"></p><ol><li>java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ï¼Œä¸ä¼šä½¿ç”¨ cpu</li><li>æ•°æ®ä»<strong>å†…æ ¸ç¼“å†²åŒº</strong>ä¼ è¾“åˆ° <strong>socket ç¼“å†²åŒº</strong>ï¼Œcpu ä¼šå‚ä¸æ‹·è´</li><li>æœ€åä½¿ç”¨ DMA å°† <strong>socket ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</li></ol><p>å¯ä»¥çœ‹åˆ°</p><ul><li>åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢</li><li>æ•°æ®æ‹·è´äº† 3 æ¬¡</li></ul><p>è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆlinux 2.4ï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209142209047.png"></p><ol><li>java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ï¼Œä¸ä¼šä½¿ç”¨ cpu</li><li>åªä¼šå°†ä¸€äº› offset å’Œ length ä¿¡æ¯æ‹·å…¥ <strong>socket ç¼“å†²åŒº</strong>ï¼Œå‡ ä¹æ— æ¶ˆè€—</li><li>ä½¿ç”¨ DMA å°† <strong>å†…æ ¸ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</li></ol><p>æ•´ä¸ªè¿‡ç¨‹ä»…åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ•°æ®æ‹·è´äº† 2 æ¬¡ã€‚æ‰€è°“çš„ã€é›¶æ‹·è´ã€‘ï¼Œå¹¶ä¸æ˜¯çœŸæ­£æ— æ‹·è´ï¼Œè€Œæ˜¯åœ¨ä¸ä¼šæ‹·è´é‡å¤æ•°æ®åˆ° jvm å†…å­˜ä¸­ï¼Œé›¶æ‹·è´çš„ä¼˜ç‚¹æœ‰</p><ul><li>æ›´å°‘çš„ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢</li><li>ä¸åˆ©ç”¨ cpu è®¡ç®—ï¼Œå‡å°‘ cpu ç¼“å­˜ä¼ªå…±äº«</li><li>é›¶æ‹·è´é€‚åˆå°æ–‡ä»¶ä¼ è¾“</li></ul><h3 id="4ã€AIO"><a href="#4ã€AIO" class="headerlink" title="4ã€AIO"></a>4ã€AIO</h3><p>AIO ç”¨æ¥è§£å†³æ•°æ®å¤åˆ¶é˜¶æ®µçš„é˜»å¡é—®é¢˜</p><ul><li>åŒæ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹éœ€è¦ç­‰å¾…ç»“æœï¼Œè¿˜æ˜¯ç›¸å½“äºé—²ç½®</li><li>å¼‚æ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¸å¿…ç­‰å¾…ç»“æœï¼Œè€Œæ˜¯å°†æ¥ç”±æ“ä½œç³»ç»Ÿæ¥é€šè¿‡å›è°ƒæ–¹å¼ç”±å¦å¤–çš„çº¿ç¨‹æ¥è·å¾—ç»“æœ</li></ul><blockquote><p>å¼‚æ­¥æ¨¡å‹éœ€è¦åº•å±‚æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰æä¾›æ”¯æŒ</p><ul><li>Windows ç³»ç»Ÿé€šè¿‡ IOCP å®ç°äº†çœŸæ­£çš„å¼‚æ­¥ IO</li><li>Linux ç³»ç»Ÿå¼‚æ­¥ IO åœ¨ 2.6 ç‰ˆæœ¬å¼•å…¥ï¼Œä½†å…¶åº•å±‚å®ç°è¿˜æ˜¯ç”¨å¤šè·¯å¤ç”¨æ¨¡æ‹Ÿäº†å¼‚æ­¥ IOï¼Œæ€§èƒ½æ²¡æœ‰ä¼˜åŠ¿</li></ul></blockquote><h3 id="5ã€"><a href="#5ã€" class="headerlink" title="5ã€"></a>5ã€</h3><h2 id="â…¡ã€Netty"><a href="#â…¡ã€Netty" class="headerlink" title="â…¡ã€Netty"></a>â…¡ã€Netty</h2><h2 id="ä¸€ã€å…¥é—¨"><a href="#ä¸€ã€å…¥é—¨" class="headerlink" title="ä¸€ã€å…¥é—¨"></a>ä¸€ã€å…¥é—¨</h2><h3 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h3><h4 id="1ã€Nerryæ˜¯ä»€ä¹ˆ"><a href="#1ã€Nerryæ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€Nerryæ˜¯ä»€ä¹ˆ"></a>1ã€Nerryæ˜¯ä»€ä¹ˆ</h4><p>Netty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</p><h4 id="2ã€ä¼˜åŠ¿"><a href="#2ã€ä¼˜åŠ¿" class="headerlink" title="2ã€ä¼˜åŠ¿"></a>2ã€ä¼˜åŠ¿</h4><ul><li>Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š<ul><li>éœ€è¦è‡ªå·±æ„å»ºåè®®</li><li>è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…</li><li>epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%</li><li>å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal =&gt; ThreadLocalï¼ŒByteBuff =&gt; ByteBuffer</li></ul></li><li>Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶<ul><li>Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€</li><li>ä¹…ç»è€ƒéªŒï¼Œ18å¹´ï¼ŒNetty ç‰ˆæœ¬<ul><li>2.x 2004</li><li>3.x 2008</li><li>4.x 2013</li><li>5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰</li></ul></li></ul></li></ul><h4 id="3ã€åœ°ä½"><a href="#3ã€åœ°ä½" class="headerlink" title="3ã€åœ°ä½"></a>3ã€åœ°ä½</h4><p>Netty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½</p><p>ä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼</p><ul><li>Cassandra - nosql æ•°æ®åº“</li><li>Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶</li><li>Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶</li><li>RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—</li><li>ElasticSearch - æœç´¢å¼•æ“</li><li>gRPC - rpc æ¡†æ¶</li><li>Dubbo - rpc æ¡†æ¶</li><li>Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯</li><li>Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶</li></ul><h3 id="2ã€Hello-World"><a href="#2ã€Hello-World" class="headerlink" title="2ã€Hello World"></a>2ã€Hello World</h3><h4 id="1ã€ç›®æ ‡"><a href="#1ã€ç›®æ ‡" class="headerlink" title="1ã€ç›®æ ‡"></a>1ã€ç›®æ ‡</h4><p>å¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯</p><ul><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world</li><li>æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›</li></ul><p>åŠ å…¥ä¾èµ–</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>netty-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.39.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€æœåŠ¡ç«¯"><a href="#2ã€æœåŠ¡ç«¯" class="headerlink" title="2ã€æœåŠ¡ç«¯"></a>2ã€æœåŠ¡ç«¯</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span>                <span class="token punctuation">.</span>group <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>                <span class="token punctuation">.</span>channel <span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>                <span class="token punctuation">.</span>childHandler <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 3</span>                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        ch<span class="token punctuation">.</span>pipeline <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>addLast <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>                        ch<span class="token punctuation">.</span>pipeline <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>addLast <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 6</span>                            <span class="token annotation punctuation">@Override</span>                            <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">channelRead0</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bind <span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º <code>çº¿ç¨‹æ±  + Selector</code> </p></li><li><p>2 å¤„ï¼Œé€‰æ‹©æœåŠ¡ Scoket å®ç°ç±»ï¼Œå…¶ä¸­ NioServerSocketChannel è¡¨ç¤ºåŸºäº NIO çš„æœåŠ¡å™¨ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209152257915.png"></p></li><li><p>3 å¤„ï¼Œä¸ºå•¥æ–¹æ³•å« childHandlerï¼Œæ˜¯æ¥ä¸‹æ¥æ·»åŠ çš„å¤„ç†å™¨éƒ½æ˜¯ç»™ SocketChannel ç”¨çš„ï¼Œè€Œä¸æ˜¯ç»™ ServerSocketChannelã€‚ChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</p></li><li><p>4 å¤„ï¼ŒServerSocketChannel ç»‘å®šçš„ç›‘å¬ç«¯å£</p></li><li><p>5 å¤„ï¼ŒSocketChannel çš„å¤„ç†å™¨ï¼Œè§£ç  ByteBuf =&gt; String</p></li><li><p>6 å¤„ï¼ŒSocketChannel çš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå¤„ç†å™¨çš„å¤„ç†ç»“æœ</p></li></ul><h4 id="3ã€å®¢æˆ·ç«¯"><a href="#3ã€å®¢æˆ·ç«¯" class="headerlink" title="3ã€å®¢æˆ·ç«¯"></a>3ã€å®¢æˆ·ç«¯</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span>                <span class="token punctuation">.</span>group <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>                <span class="token punctuation">.</span>channel <span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>                <span class="token punctuation">.</span>handler <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 3</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        ch<span class="token punctuation">.</span>pipeline <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>addLast <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>connect <span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>                <span class="token punctuation">.</span>sync <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token comment">// 5</span>                <span class="token punctuation">.</span>channel <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token comment">// 6</span>                <span class="token punctuation">.</span>writeAndFlush <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼ŒåŒ Server</p></li><li><p>2 å¤„ï¼Œé€‰æ‹©å®¢æˆ· Socket å®ç°ç±»ï¼ŒNioSocketChannel è¡¨ç¤ºåŸºäº NIO çš„å®¢æˆ·ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209152303842.png"></p></li><li><p>3 å¤„ï¼Œæ·»åŠ  SocketChannel çš„å¤„ç†å™¨ï¼ŒChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</p></li><li><p>4 å¤„ï¼ŒæŒ‡å®šè¦è¿æ¥çš„æœåŠ¡å™¨å’Œç«¯å£</p></li><li><p>5 å¤„ï¼ŒNetty ä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚ connectï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ sync æ–¹æ³•ç­‰å¾… connect å»ºç«‹è¿æ¥å®Œæ¯•</p></li><li><p>6 å¤„ï¼Œè·å– channel å¯¹è±¡ï¼Œå®ƒå³ä¸ºé€šé“æŠ½è±¡ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œ</p></li><li><p>7 å¤„ï¼Œå†™å…¥æ¶ˆæ¯å¹¶æ¸…ç©ºç¼“å†²åŒº</p></li><li><p>8 å¤„ï¼Œæ¶ˆæ¯ä¼šç»è¿‡é€šé“ handler å¤„ç†ï¼Œè¿™é‡Œæ˜¯å°† String =&gt; ByteBuf å‘å‡º</p></li><li><p>æ•°æ®ç»è¿‡ç½‘ç»œä¼ è¾“ï¼Œåˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯ 5 å’Œ 6 å¤„çš„ handler å…ˆåè¢«è§¦å‘ï¼Œèµ°å®Œä¸€ä¸ªæµç¨‹</p></li></ul><h4 id="4ã€æ¢³ç†æµç¨‹"><a href="#4ã€æ¢³ç†æµç¨‹" class="headerlink" title="4ã€æ¢³ç†æµç¨‹"></a>4ã€æ¢³ç†æµç¨‹</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209171028505.png"></p><h4 id="5ã€è¯¦ç»†è§£è¯»"><a href="#5ã€è¯¦ç»†è§£è¯»" class="headerlink" title="5ã€è¯¦ç»†è§£è¯»"></a>5ã€è¯¦ç»†è§£è¯»</h4><blockquote><ul><li>æŠŠ channel ç†è§£ä¸ºæ•°æ®çš„é€šé“</li><li>æŠŠ msg ç†è§£ä¸ºæµåŠ¨çš„æ•°æ®ï¼Œæœ€å¼€å§‹è¾“å…¥æ˜¯ ByteBufï¼Œä½†ç»è¿‡ pipeline çš„åŠ å·¥ï¼Œä¼šå˜æˆå…¶å®ƒç±»å‹å¯¹è±¡ï¼Œæœ€åè¾“å‡ºåˆå˜æˆ ByteBuf</li><li>æŠŠ handler ç†è§£ä¸ºæ•°æ®çš„å¤„ç†å·¥åº<ul><li>å·¥åºæœ‰å¤šé“ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯ pipelineï¼Œpipeline è´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼ˆè¯»ã€è¯»å–å®Œæˆâ€¦ï¼‰ä¼ æ’­ç»™æ¯ä¸ª handlerï¼Œ handler å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼ˆé‡å†™äº†ç›¸åº”äº‹ä»¶å¤„ç†æ–¹æ³•ï¼‰</li><li>handler åˆ† Inbound å’Œ Outbound ä¸¤ç±»</li></ul></li><li>æŠŠ eventLoop ç†è§£ä¸ºå¤„ç†æ•°æ®çš„å·¥äºº<ul><li>å·¥äººå¯ä»¥ç®¡ç†å¤šä¸ª channel çš„ io æ“ä½œï¼Œå¹¶ä¸”ä¸€æ—¦å·¥äººè´Ÿè´£äº†æŸä¸ª channelï¼Œå°±è¦è´Ÿè´£åˆ°åº•ï¼ˆç»‘å®šï¼‰</li><li>å·¥äººæ—¢å¯ä»¥æ‰§è¡Œ io æ“ä½œï¼Œä¹Ÿå¯ä»¥è¿›è¡Œä»»åŠ¡å¤„ç†ï¼Œæ¯ä½å·¥äººæœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œå¯ä»¥å †æ”¾å¤šä¸ª channel çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œä»»åŠ¡åˆ†ä¸ºæ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡</li><li>å·¥äººæŒ‰ç…§ pipeline é¡ºåºï¼Œä¾æ¬¡æŒ‰ç…§ handler çš„è§„åˆ’ï¼ˆä»£ç ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥ä¸ºæ¯é“å·¥åºæŒ‡å®šä¸åŒçš„å·¥äºº</li></ul></li></ul></blockquote><h3 id="3ã€ç»„ä»¶"><a href="#3ã€ç»„ä»¶" class="headerlink" title="3ã€ç»„ä»¶"></a>3ã€ç»„ä»¶</h3><h4 id="1ã€EventLoop"><a href="#1ã€EventLoop" class="headerlink" title="1ã€EventLoop"></a>1ã€EventLoop</h4><p>äº‹ä»¶å¾ªç¯å¯¹è±¡</p><p>EventLoop æœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼ˆåŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ª Selectorï¼‰ï¼Œé‡Œé¢æœ‰ run æ–¹æ³•å¤„ç† Channel ä¸Šæºæºä¸æ–­çš„ io äº‹ä»¶ã€‚</p><p>å®ƒçš„ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚</p><ul><li>ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª j.u.c.ScheduledExecutorService å› æ­¤åŒ…å«äº†çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ–¹æ³•</li><li>å¦ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª netty è‡ªå·±çš„ OrderedEventExecutorï¼Œ<ul><li>æä¾›äº† boolean inEventLoop(Thread thread) æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦å±äºæ­¤ EventLoop</li><li>æä¾›äº† parent æ–¹æ³•æ¥çœ‹çœ‹è‡ªå·±å±äºå“ªä¸ª EventLoopGroup</li></ul></li></ul><p>äº‹ä»¶å¾ªç¯ç»„</p><p>EventLoopGroup æ˜¯ä¸€ç»„ EventLoopï¼ŒChannel ä¸€èˆ¬ä¼šè°ƒç”¨ EventLoopGroup çš„ register æ–¹æ³•æ¥ç»‘å®šå…¶ä¸­ä¸€ä¸ª EventLoopï¼Œåç»­è¿™ä¸ª Channel ä¸Šçš„ io äº‹ä»¶éƒ½ç”±æ­¤ EventLoop æ¥å¤„ç†ï¼ˆä¿è¯äº† io äº‹ä»¶å¤„ç†æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼‰</p><ul><li>ç»§æ‰¿è‡ª netty è‡ªå·±çš„ EventExecutorGroup<ul><li>å®ç°äº† Iterable æ¥å£æä¾›éå† EventLoop çš„èƒ½åŠ›</li><li>å¦æœ‰ next æ–¹æ³•è·å–é›†åˆä¸­ä¸‹ä¸€ä¸ª EventLoop</li></ul></li></ul><p>ä»¥ä¸€ä¸ªç®€å•çš„å®ç°ä¸ºä¾‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å†…éƒ¨åˆ›å»ºäº†ä¸¤ä¸ª EventLoop, æ¯ä¸ª EventLoop ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹</span><span class="token class-name">DefaultEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">io.netty.channel.DefaultEventLoop@60f82f98io.netty.channel.DefaultEventLoop@35f983a6io.netty.channel.DefaultEventLoop@60f82f98<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ for å¾ªç¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">EventExecutor</span> eventLoop <span class="token operator">:</span> group<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>eventLoop<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">io.netty.channel.DefaultEventLoop@60f82f98io.netty.channel.DefaultEventLoop@35f983a6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">io.netty.channel.DefaultEventLoop@60f82f98io.netty.channel.DefaultEventLoop@35f983a6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="ğŸ’¡-ä¼˜é›…å…³é—­"><a href="#ğŸ’¡-ä¼˜é›…å…³é—­" class="headerlink" title="ğŸ’¡ ä¼˜é›…å…³é—­"></a>ğŸ’¡ ä¼˜é›…å…³é—­</h5><p>ä¼˜é›…å…³é—­ <code>shutdownGracefully</code> æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆåˆ‡æ¢ <code>EventLoopGroup</code> åˆ°å…³é—­çŠ¶æ€ä»è€Œæ‹’ç»æ–°çš„ä»»åŠ¡çš„åŠ å…¥ï¼Œç„¶ååœ¨ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæˆåï¼Œåœæ­¢çº¿ç¨‹çš„è¿è¡Œã€‚ä»è€Œç¡®ä¿æ•´ä½“åº”ç”¨æ˜¯åœ¨æ­£å¸¸æœ‰åºçš„çŠ¶æ€ä¸‹é€€å‡ºçš„</p><h5 id="2ã€NioEventLoop-å¤„ç†æ™®é€šä»»åŠ¡"><a href="#2ã€NioEventLoop-å¤„ç†æ™®é€šä»»åŠ¡" class="headerlink" title="2ã€NioEventLoop å¤„ç†æ™®é€šä»»åŠ¡"></a>2ã€NioEventLoop å¤„ç†æ™®é€šä»»åŠ¡</h5><p>NioEventLoop é™¤äº†å¯ä»¥å¤„ç† io äº‹ä»¶ï¼ŒåŒæ ·å¯ä»¥å‘å®ƒæäº¤æ™®é€šä»»åŠ¡</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">NioEventLoopGroup</span> nioWorkers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"server start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>nioWorkers<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"normal task..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">22:30:36 [DEBUG] [main] c.i.o.EventLoopTest2 - server start...22:30:38 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - normal task...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>å¯ä»¥ç”¨æ¥æ‰§è¡Œè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡</p></blockquote><h5 id="3ã€NioEventLoop-å¤„ç†å®šæ—¶ä»»åŠ¡"><a href="#3ã€NioEventLoop-å¤„ç†å®šæ—¶ä»»åŠ¡" class="headerlink" title="3ã€NioEventLoop å¤„ç†å®šæ—¶ä»»åŠ¡"></a>3ã€NioEventLoop å¤„ç†å®šæ—¶ä»»åŠ¡</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">NioEventLoopGroup</span> nioWorkers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"server start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>nioWorkers<span class="token punctuation">.</span><span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"running..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">22:35:15 [DEBUG] [main] c.i.o.EventLoopTest2 - server start...22:35:17 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...22:35:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...22:35:19 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...22:35:20 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running......<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å¯ä»¥ç”¨æ¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡</p></blockquote><h4 id="2ã€Channel"><a href="#2ã€Channel" class="headerlink" title="2ã€Channel"></a>2ã€Channel</h4><p>channel çš„ä¸»è¦ä½œç”¨</p><ul><li>close() å¯ä»¥ç”¨æ¥å…³é—­ channel</li><li>closeFuture() ç”¨æ¥å¤„ç† channel çš„å…³é—­<ul><li>sync æ–¹æ³•ä½œç”¨æ˜¯åŒæ­¥ç­‰å¾… channel å…³é—­</li><li>è€Œ addListener æ–¹æ³•æ˜¯å¼‚æ­¥ç­‰å¾… channel å…³é—­</li></ul></li><li>pipeline() æ–¹æ³•æ·»åŠ å¤„ç†å™¨</li><li>write() æ–¹æ³•å°†æ•°æ®å†™å…¥</li><li>writeAndFlush() æ–¹æ³•å°†æ•°æ®å†™å…¥å¹¶åˆ·å‡º</li></ul><h4 id="2-1ã€ChannelFuture"><a href="#2-1ã€ChannelFuture" class="headerlink" title="2.1ã€ChannelFuture"></a>2.1ã€ChannelFuture</h4><p>è¿™æ—¶åˆšæ‰çš„å®¢æˆ·ç«¯ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨æŠŠå®ƒæ‹†å¼€æ¥çœ‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>channelFuture<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>1 å¤„è¿”å›çš„æ˜¯ ChannelFuture å¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ©ç”¨ channel() æ–¹æ³•æ¥è·å– Channel å¯¹è±¡</li></ul><p><strong>æ³¨æ„</strong> connect æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ„å‘³ç€ä¸ç­‰è¿æ¥å»ºç«‹ï¼Œæ–¹æ³•æ‰§è¡Œå°±è¿”å›äº†ã€‚å› æ­¤ channelFuture å¯¹è±¡ä¸­ä¸èƒ½ã€ç«‹åˆ»ã€‘è·å¾—åˆ°æ­£ç¡®çš„ Channel å¯¹è±¡</p><p>å®éªŒå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>channelFuture<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° <code>[id: 0x2e1884dd]</code></li><li>æ‰§è¡Œåˆ° 2 æ—¶ï¼Œsync æ–¹æ³•æ˜¯åŒæ­¥ç­‰å¾…è¿æ¥å»ºç«‹å®Œæˆ</li><li>æ‰§è¡Œåˆ° 3 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° <code>[id: 0x2e1884dd, L:/127.0.0.1:57191 - R:/127.0.0.1:8080]</code></li></ul><p>é™¤äº†ç”¨ sync æ–¹æ³•å¯ä»¥è®©å¼‚æ­¥æ“ä½œåŒæ­¥ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å›è°ƒçš„æ–¹å¼ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>channelFuture<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation">)</span> future <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° <code>[id: 0x749124ba]</code></li><li>ChannelFutureListener ä¼šåœ¨è¿æ¥å»ºç«‹æ—¶è¢«è°ƒç”¨ï¼ˆå…¶ä¸­ operationComplete æ–¹æ³•ï¼‰ï¼Œå› æ­¤æ‰§è¡Œåˆ° 2 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° <code>[id: 0x749124ba, L:/127.0.0.1:57351 - R:/127.0.0.1:8080]</code></li></ul><h4 id="2-2ã€CloseFuture"><a href="#2-2ã€CloseFuture" class="headerlink" title="2.2ã€CloseFuture"></a>2.2ã€CloseFuture</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>basice<span class="token punctuation">.</span>demo2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFuture</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelFutureTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span>                <span class="token punctuation">.</span>group <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>channel <span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>handler <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        ch<span class="token punctuation">.</span>pipeline <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>addLast <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>connect <span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//channelFuture.sync ( ).channel ( ).writeAndFlush (new Date ( ) + "hello!");</span>        channelFuture<span class="token punctuation">.</span>channel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>writeAndFlush <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>channelFuture<span class="token punctuation">.</span>channel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        channelFuture.sync ();</span><span class="token comment">//        System.out.println (channelFuture.channel () );</span>        channelFuture<span class="token punctuation">.</span>addListener <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation">)</span> future <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>future<span class="token punctuation">.</span>channel <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ğŸ’¡-å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ"><a href="#ğŸ’¡-å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ" class="headerlink" title="ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ"></a>ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ</h4><ul><li>çœ‹åˆ°è¿™é‡Œä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å»æ‰§è¡Œå»ºç«‹è¿æ¥ã€å»æ‰§è¡Œå…³é—­ channelï¼Œé‚£æ ·ä¸æ˜¯ä¹Ÿå¯ä»¥å—ï¼Ÿéè¦ç”¨è¿™ä¹ˆå¤æ‚çš„å¼‚æ­¥æ–¹å¼ï¼šæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å‘èµ·å»ºç«‹è¿æ¥ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å»çœŸæ­£å»ºç«‹è¿æ¥</li><li>è¿˜æœ‰åŒå­¦ä¼šç¬¼ç»Ÿåœ°å›ç­”ï¼Œå› ä¸º netty å¼‚æ­¥æ–¹å¼ç”¨äº†å¤šçº¿ç¨‹ã€å¤šçº¿ç¨‹å°±æ•ˆç‡é«˜ã€‚å…¶å®è¿™äº›è®¤è¯†éƒ½æ¯”è¾ƒç‰‡é¢ï¼Œå¤šçº¿ç¨‹å’Œå¼‚æ­¥æ‰€æå‡çš„æ•ˆç‡å¹¶ä¸æ˜¯æ‰€è®¤ä¸ºçš„</li></ul><p>æ€è€ƒä¸‹é¢çš„åœºæ™¯ï¼Œ4 ä¸ªåŒ»ç”Ÿç»™äººçœ‹ç—…ï¼Œæ¯ä¸ªç—…äººèŠ±è´¹ 20 åˆ†é’Ÿï¼Œè€Œä¸”åŒ»ç”Ÿçœ‹ç—…çš„è¿‡ç¨‹ä¸­æ˜¯ä»¥ç—…äººä¸ºå•ä½çš„ï¼Œä¸€ä¸ªç—…äººçœ‹å®Œäº†ï¼Œæ‰èƒ½çœ‹ä¸‹ä¸€ä¸ªç—…äººã€‚å‡è®¾ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œå¯ä»¥è®¡ç®—ä¸€ä¸‹ 4 ä¸ªåŒ»ç”Ÿä¸€å¤©å·¥ä½œ 8 å°æ—¶ï¼Œå¤„ç†çš„ç—…äººæ€»æ•°æ˜¯ï¼š<code>4 * 8 * 3 = 96</code></p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209241222774.png"></p><p>ç»ç ”ç©¶å‘ç°ï¼Œçœ‹ç—…å¯ä»¥ç»†åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼Œç»æ‹†åˆ†åæ¯ä¸ªæ­¥éª¤éœ€è¦ 5 åˆ†é’Ÿï¼Œå¦‚ä¸‹</p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209241221714.png"></p><p>å› æ­¤å¯ä»¥åšå¦‚ä¸‹ä¼˜åŒ–ï¼Œåªæœ‰ä¸€å¼€å§‹ï¼ŒåŒ»ç”Ÿ 2ã€3ã€4 åˆ†åˆ«è¦ç­‰å¾… 5ã€10ã€15 åˆ†é’Ÿæ‰èƒ½æ‰§è¡Œå·¥ä½œï¼Œä½†åªè¦åç»­ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œä»–ä»¬å°±èƒ½å¤Ÿæ»¡è´Ÿè·å·¥ä½œï¼Œå¹¶ä¸”å¤„ç†ç—…äººçš„èƒ½åŠ›æé«˜åˆ°äº† <code>4 * 8 * 12</code> æ•ˆç‡å‡ ä¹æ˜¯åŸæ¥çš„å››å€</p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209241221462.png"></p><p>è¦ç‚¹</p><ul><li>å•çº¿ç¨‹æ²¡æ³•å¼‚æ­¥æé«˜æ•ˆç‡ï¼Œå¿…é¡»é…åˆå¤šçº¿ç¨‹ã€å¤šæ ¸ cpu æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„ä¼˜åŠ¿</li><li>å¼‚æ­¥å¹¶æ²¡æœ‰ç¼©çŸ­å“åº”æ—¶é—´ï¼Œåè€Œæœ‰æ‰€å¢åŠ </li><li>åˆç†è¿›è¡Œä»»åŠ¡æ‹†åˆ†ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¼‚æ­¥çš„å…³é”®</li></ul><h4 id="3ã€Future-amp-Promise"><a href="#3ã€Future-amp-Promise" class="headerlink" title="3ã€Future &amp; Promise"></a>3ã€Future &amp; Promise</h4><p>åœ¨å¼‚æ­¥å¤„ç†æ—¶ï¼Œç»å¸¸ç”¨åˆ°è¿™ä¸¤ä¸ªæ¥å£</p><p>é¦–å…ˆè¦è¯´æ˜ netty ä¸­çš„ Future ä¸ jdk ä¸­çš„ Future åŒåï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªæ¥å£ï¼Œnetty çš„ Future ç»§æ‰¿è‡ª jdk çš„ Futureï¼Œè€Œ Promise åˆå¯¹ netty Future è¿›è¡Œäº†æ‰©å±•</p><ul><li>jdk Future åªèƒ½åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼ˆæˆ–æˆåŠŸã€æˆ–å¤±è´¥ï¼‰æ‰èƒ½å¾—åˆ°ç»“æœ</li><li>netty Future å¯ä»¥åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸå¾—åˆ°ç»“æœï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥æ–¹å¼å¾—åˆ°ç»“æœï¼Œä½†éƒ½æ˜¯è¦ç­‰ä»»åŠ¡ç»“æŸ</li><li>netty Promise ä¸ä»…æœ‰ netty Future çš„åŠŸèƒ½ï¼Œè€Œä¸”è„±ç¦»äº†ä»»åŠ¡ç‹¬ç«‹å­˜åœ¨ï¼Œåªä½œä¸ºä¸¤ä¸ªçº¿ç¨‹é—´ä¼ é€’ç»“æœçš„å®¹å™¨</li></ul><table><thead><tr><th>åŠŸèƒ½/åç§°</th><th>jdk Future</th><th>netty Future</th><th>Promise</th></tr></thead><tbody><tr><td>cancel</td><td>å–æ¶ˆä»»åŠ¡</td><td>-</td><td>-</td></tr><tr><td>isCanceled</td><td>ä»»åŠ¡æ˜¯å¦å–æ¶ˆ</td><td>-</td><td>-</td></tr><tr><td>isDone</td><td>ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œä¸èƒ½åŒºåˆ†æˆåŠŸå¤±è´¥</td><td>-</td><td>-</td></tr><tr><td>get</td><td>è·å–ä»»åŠ¡ç»“æœï¼Œé˜»å¡ç­‰å¾…</td><td>-</td><td>-</td></tr><tr><td>getNow</td><td>-</td><td>è·å–ä»»åŠ¡ç»“æœï¼Œéé˜»å¡ï¼Œè¿˜æœªäº§ç”Ÿç»“æœæ—¶è¿”å› null</td><td>-</td></tr><tr><td>await</td><td>-</td><td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡ isSuccess åˆ¤æ–­</td><td>-</td></tr><tr><td>sync</td><td>-</td><td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</td><td>-</td></tr><tr><td>isSuccess</td><td>-</td><td>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ</td><td>-</td></tr><tr><td>cause</td><td>-</td><td>è·å–å¤±è´¥ä¿¡æ¯ï¼Œéé˜»å¡ï¼Œå¦‚æœæ²¡æœ‰å¤±è´¥ï¼Œè¿”å›null</td><td>-</td></tr><tr><td>addLinstener</td><td>-</td><td>æ·»åŠ å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ</td><td>-</td></tr><tr><td>setSuccess</td><td>-</td><td>-</td><td>è®¾ç½®æˆåŠŸç»“æœ</td></tr><tr><td>setFailure</td><td>-</td><td>-</td><td>è®¾ç½®å¤±è´¥ç»“æœ</td></tr></tbody></table><h4 id="3-1ã€JDK-future"><a href="#3-1ã€JDK-future" class="headerlink" title="3-1ã€JDK-future"></a>3-1ã€JDK-future</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// jdk-future</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>    <span class="token comment">// 1.çº¿ç¨‹æ± </span>    <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span>newFixedThreadPool <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 2.æäº¤ä»»åŠ¡</span>    <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> executorService<span class="token punctuation">.</span>submit <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œè®¡ç®—ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span>sleep <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">50</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 3ã€ä¸»çº¿ç¨‹é€šè¿‡ futureè·å–ç»“æœ</span>    log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"ç­‰å¾…ç»“æœä¸­......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"ç»“æœä¸ºï¼š{}"</span><span class="token punctuation">,</span> future<span class="token punctuation">.</span>get <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><blockquote><p>10:08:46.201 [main] INFO com.kk.netty.basice.demo2.FutureAndPromise - ç­‰å¾…ç»“æœä¸­â€¦â€¦<br>10:08:46.201 [pool-1-thread-1] INFO com.kk.netty.basice.demo2.FutureAndPromise - æ‰§è¡Œè®¡ç®—ï¼<br>10:08:47.205 [main] INFO com.kk.netty.basice.demo2.FutureAndPromise - ç»“æœä¸ºï¼š50</p></blockquote><h4 id="3-2ã€netty-future"><a href="#3-2ã€netty-future" class="headerlink" title="3-2ã€netty-future"></a>3-2ã€netty-future</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java">    <span class="token comment">// netty-future()</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test11</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>        <span class="token class-name">NioEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">EventLoop</span> eventLoop <span class="token operator">=</span> group<span class="token punctuation">.</span>next <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> eventLoop<span class="token punctuation">.</span>submit <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>                log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œè®¡ç®—ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span>sleep <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token number">50</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"ç­‰å¾…ç»“æœä¸­......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;åŒæ­¥&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>        <span class="token comment">// æ§åˆ¶å°æ‰“å°æ˜¯mainçº¿ç¨‹æ‰“å°</span><span class="token comment">//        log.info ("ç»“æœä¸ºï¼š{}", future.get ( ));</span>        <span class="token comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;åŒæ­¥&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>        <span class="token comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;å¼‚æ­¥&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>        future<span class="token punctuation">.</span>addListener <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericFutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>                <span class="token comment">// æ§åˆ¶å°æ‰“å°æ˜¯ nioEventLoopGroup çº¿ç¨‹ç»„æ‰“å°</span>                log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"ç»“æœä¸ºï¼š{}"</span><span class="token punctuation">,</span> future<span class="token punctuation">.</span>getNow <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;å¼‚æ­¥&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>10:40:10.185 [main] INFO com.kk.netty.basice.demo2.FutureAndPromise - ç­‰å¾…ç»“æœä¸­â€¦â€¦<br>10:40:10.189 [nioEventLoopGroup-2-1] INFO com.kk.netty.basice.demo2.FutureAndPromise - æ‰§è¡Œè®¡ç®—ï¼<br>10:40:11.190 [nioEventLoopGroup-2-1] INFO com.kk.netty.basice.demo2.FutureAndPromise - ç»“æœä¸ºï¼š50</p></blockquote><h4 id="3-1-2-å°ç»“"><a href="#3-1-2-å°ç»“" class="headerlink" title="3-(1-2)å°ç»“"></a>3-(1-2)å°ç»“</h4><p>æ— è®ºæ˜¯jucä¸­çš„ future è¿˜æ˜¯ netty ä¸­çš„ future éƒ½æ˜¯æ¥è‡ªäº juc</p><p><img src="https://v1.mykkto.cn/image/blog/2022/netty/202209251043399.png"></p><p>ä¸Šé¢ä¸¤ç§è·å–çš„ future æ–¹å¼ éƒ½æ˜¯è¢«åŠ¨è¿”å›å¾—åˆ°çš„ï¼Œè‹¥è¦ä¸»åŠ¨ï¼Œæ­¤æ—¶å¯ä»¥ç”¨ netty ä¸­çš„ Promise</p><h4 id="3-1ã€åŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ"><a href="#3-1ã€åŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ" class="headerlink" title="3.1ã€åŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ"></a>3.1ã€åŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java">    <span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span>    eventExecutors<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span>sleep <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"set success, {}"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        promise<span class="token punctuation">.</span>setSuccess <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"getNow:{}"</span><span class="token punctuation">,</span> promise<span class="token punctuation">.</span>getNow <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿˜æ²¡æœ‰ç»“æœ</span>    log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"get:{}"</span><span class="token punctuation">,</span> promise<span class="token punctuation">.</span>get <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><blockquote><p>17:15:38.604 [main] DEBUG com.kk.netty.basice.demo2.FutureAndPromise - startâ€¦<br>17:15:38.604 [main] DEBUG com.kk.netty.basice.demo2.FutureAndPromise - getNow:null<br>17:15:39.605 [defaultEventLoop-1-1] DEBUG com.kk.netty.basice.demo2.FutureAndPromise - set success, 10<br>17:15:39.605 [main] DEBUG com.kk.netty.basice.demo2.FutureAndPromise - get:10</p></blockquote><h4 id="3-2ã€å¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ"><a href="#3-2ã€å¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ" class="headerlink" title="3.2ã€å¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ"></a>3.2ã€å¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è®¾ç½®å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ</span>promise<span class="token punctuation">.</span>addListener <span class="token punctuation">(</span>future <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// è¿™é‡Œçš„ future å°±æ˜¯ä¸Šé¢çš„ promise</span>    log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"getNow:{}"</span><span class="token punctuation">,</span> future<span class="token punctuation">.</span>getNow <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>eventExecutors<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span>sleep <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"set success, {}"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    promise<span class="token punctuation">.</span>setSuccess <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><blockquote><p>11:49:30 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - startâ€¦<br>11:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set success, 10<br>11:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - 10</p></blockquote><h4 id="3-3ã€åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥-sync-amp-get"><a href="#3-3ã€åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥-sync-amp-get" class="headerlink" title="3.3ã€åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - sync &amp; get"></a>3.3ã€åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - sync &amp; get</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span>eventExecutors<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span>sleep <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token class-name">RuntimeException</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">(</span><span class="token string">"error..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"set failure, {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    promise<span class="token punctuation">.</span>setFailure <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"getNow:{}"</span><span class="token punctuation">,</span> promise<span class="token punctuation">.</span>getNow <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>promise<span class="token punctuation">.</span>get <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sync() ä¹Ÿä¼šå‡ºç°å¼‚å¸¸ï¼Œåªæ˜¯ get ä¼šå†ç”¨ ExecutionException åŒ…ä¸€å±‚å¼‚å¸¸</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><blockquote><p>12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - startâ€¦<br>12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null<br>12:11:08 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: errorâ€¦<br>Exception in thread â€œmainâ€ java.util.concurrent.ExecutionException: java.lang.RuntimeException: errorâ€¦<br>   at io.netty.util.concurrent.AbstractFuture.get(AbstractFuture.java:41)<br>   at com.itcast.oio.DefaultPromiseTest2.main(DefaultPromiseTest2.java:34)<br>Caused by: java.lang.RuntimeException: errorâ€¦<br>   at com.itcast.oio.DefaultPromiseTest2.lambda$main$0(DefaultPromiseTest2.java:27)<br>   at io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)<br>   at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)<br>   at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)<br>   at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)<br>   at java.lang.Thread.run(Thread.java:745)</p></blockquote><h4 id="3-4ã€åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥-await"><a href="#3-4ã€åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥-await" class="headerlink" title="3.4ã€åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - await"></a>3.4ã€åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - await</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span>eventExecutors<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span>sleep <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token class-name">RuntimeException</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">(</span><span class="token string">"error..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"set failure, {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    promise<span class="token punctuation">.</span>setFailure <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"getNow:{}"</span><span class="token punctuation">,</span> promise<span class="token punctuation">.</span>getNow <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>promise<span class="token punctuation">.</span>await <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸ sync å’Œ get åŒºåˆ«åœ¨äºï¼Œä¸ä¼šæŠ›å¼‚å¸¸</span>log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"result {}"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>promise<span class="token punctuation">.</span>isSuccess <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">?</span> promise<span class="token punctuation">.</span>getNow <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">:</span> promise<span class="token punctuation">.</span>cause <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><blockquote><p>12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - startâ€¦<br>12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null<br>12:18:54 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: errorâ€¦<br>12:18:54 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: errorâ€¦</p></blockquote><h4 id="3-5ã€å¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥"><a href="#3-5ã€å¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥" class="headerlink" title="3.5ã€å¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥"></a>3.5ã€å¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span> promise<span class="token punctuation">.</span>addListener <span class="token punctuation">(</span>future <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>     log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"result {}"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>promise<span class="token punctuation">.</span>isSuccess <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">?</span> promise<span class="token punctuation">.</span>getNow <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">:</span> promise<span class="token punctuation">.</span>cause <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> eventExecutors<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>     <span class="token keyword">try</span> <span class="token punctuation">{</span>         <span class="token class-name">Thread</span><span class="token punctuation">.</span>sleep <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>         e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token class-name">RuntimeException</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">(</span><span class="token string">"error..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"set failure, {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     promise<span class="token punctuation">.</span>setFailure <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> log<span class="token punctuation">.</span>debug <span class="token punctuation">(</span><span class="token string">"start..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><blockquote><p>12:04:57 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - startâ€¦<br>12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: errorâ€¦<br>12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: errorâ€¦</p></blockquote><h4 id="3-6ã€await-æ­»é”æ£€æŸ¥"><a href="#3-6ã€await-æ­»é”æ£€æŸ¥" class="headerlink" title="3.6ã€await æ­»é”æ£€æŸ¥"></a>3.6ã€await æ­»é”æ£€æŸ¥</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultEventLoop</span> eventExecutors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoop</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>eventExecutors<span class="token punctuation">)</span><span class="token punctuation">;</span> eventExecutors<span class="token punctuation">.</span>submit <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">try</span> <span class="token punctuation">{</span>         promise<span class="token punctuation">.</span>await <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// æ³¨æ„ä¸èƒ½ä»…æ•è· InterruptedException å¼‚å¸¸</span>         <span class="token comment">// å¦åˆ™ æ­»é”æ£€æŸ¥æŠ›å‡ºçš„ BlockingOperationException ä¼šç»§ç»­å‘ä¸Šä¼ æ’­</span>         <span class="token comment">// è€Œæäº¤çš„ä»»åŠ¡ä¼šè¢«åŒ…è£…ä¸º PromiseTaskï¼Œå®ƒçš„ run æ–¹æ³•ä¸­ä¼š catch æ‰€æœ‰å¼‚å¸¸ç„¶åè®¾ç½®ä¸º Promise çš„å¤±è´¥ç»“æœè€Œä¸ä¼šæŠ›å‡º</span>     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>         e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> eventExecutors<span class="token punctuation">.</span>submit <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">try</span> <span class="token punctuation">{</span>         promise<span class="token punctuation">.</span>await <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>         e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡º</p><blockquote><p>1<br>2<br>3<br>4<br>io.netty.util.concurrent.BlockingOperationException: DefaultPromise@47499c2a(incomplete)<br>at io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:384)</p></blockquote><h4 id="4ã€Handler-amp-Pipeline"><a href="#4ã€Handler-amp-Pipeline" class="headerlink" title="4ã€Handler &amp; Pipeline"></a>4ã€Handler &amp; Pipeline</h4><p>ChannelHandler ç”¨æ¥å¤„ç† Channel ä¸Šçš„å„ç§äº‹ä»¶ï¼Œåˆ†ä¸ºå…¥æ ˆã€å‡ºæ ˆä¸¤ç§ã€‚æ‰€æœ‰ ChannelHandler è¢«è¿æˆä¸€ä¸²ï¼Œå°±æ˜¯ Pipeline</p><ul><li>å…¥ç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelInboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦ç”¨æ¥<font color="red">è¯»</font>å–å®¢æˆ·ç«¯æ•°æ®ï¼Œå†™å›ç»“æœ</li><li>å‡ºç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelOutboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦å¯¹<font color="red">å†™</font>å›ç»“æœè¿›è¡ŒåŠ å·¥</li></ul><p>æ‰“ä¸ªæ¯”å–»ï¼Œæ¯ä¸ª Channel æ˜¯ä¸€ä¸ªäº§å“çš„åŠ å·¥è½¦é—´ï¼ŒPipeline æ˜¯è½¦é—´ä¸­çš„æµæ°´çº¿ï¼ŒChannelHandler å°±æ˜¯æµæ°´çº¿ä¸Šçš„å„é“å·¥åºï¼Œè€Œåé¢è¦è®²çš„ ByteBuf æ˜¯åŸææ–™ï¼Œç»è¿‡å¾ˆå¤šå·¥åºçš„åŠ å·¥ï¼šå…ˆç»è¿‡ä¸€é“é“å…¥ç«™å·¥åºï¼Œå†ç»è¿‡ä¸€é“é“å‡ºç«™å·¥åºæœ€ç»ˆå˜æˆäº§å“</p><p>å…ˆææ¸…æ¥šé¡ºåºï¼ŒæœåŠ¡ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelOutboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span>                                   <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelOutboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span>                                   <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelOutboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">,</span>                                   <span class="token class-name">ChannelPromise</span> promise<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¢æˆ·ç«¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>            ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation">)</span> future <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>        future<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">"hello,world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡å™¨ç«¯æ‰“å°ï¼š</p><pre class="line-numbers language-none"><code class="language-none">123654<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äºŒã€è¿›é˜¶"><a href="#äºŒã€è¿›é˜¶" class="headerlink" title="äºŒã€è¿›é˜¶"></a>äºŒã€è¿›é˜¶</h2><h3 id="1ã€"><a href="#1ã€" class="headerlink" title="1ã€"></a>1ã€</h3><h3 id="2ã€"><a href="#2ã€" class="headerlink" title="2ã€"></a>2ã€</h3><h3 id="3ã€"><a href="#3ã€" class="headerlink" title="3ã€"></a>3ã€</h3><h2 id="ä¸‰ã€æºç "><a href="#ä¸‰ã€æºç " class="headerlink" title="ä¸‰ã€æºç "></a>ä¸‰ã€æºç </h2><h3 id="1ã€-1"><a href="#1ã€-1" class="headerlink" title="1ã€"></a>1ã€</h3><h3 id="2ã€-1"><a href="#2ã€-1" class="headerlink" title="2ã€"></a>2ã€</h3><h3 id="3ã€-1"><a href="#3ã€-1" class="headerlink" title="3ã€"></a>3ã€</h3><h2 id="â…¢ã€å¸¸è¯†ï¼ˆé¢è¯•ï¼‰"><a href="#â…¢ã€å¸¸è¯†ï¼ˆé¢è¯•ï¼‰" class="headerlink" title="â…¢ã€å¸¸è¯†ï¼ˆé¢è¯•ï¼‰"></a>â…¢ã€å¸¸è¯†ï¼ˆé¢è¯•ï¼‰</h2><h5 id="1ã€å¤šçº¿ç¨‹ç¼ºç‚¹"><a href="#1ã€å¤šçº¿ç¨‹ç¼ºç‚¹" class="headerlink" title="1ã€å¤šçº¿ç¨‹ç¼ºç‚¹"></a>1ã€å¤šçº¿ç¨‹ç¼ºç‚¹</h5><ul><li>å†…å­˜å ç”¨é«˜</li><li>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬é«˜</li><li>åªé€‚åˆè¿æ¥æ•°å°‘çš„åœºæ™¯</li></ul><h5 id="2ã€çº¿ç¨‹æ± ç¼ºç‚¹"><a href="#2ã€çº¿ç¨‹æ± ç¼ºç‚¹" class="headerlink" title="2ã€çº¿ç¨‹æ± ç¼ºç‚¹"></a>2ã€çº¿ç¨‹æ± ç¼ºç‚¹</h5><ul><li>é˜»å¡æ¨¡å¼ä¸‹ï¼Œçº¿ç¨‹ä»…èƒ½å¤„ç†ä¸€ä¸ª socket è¿æ¥</li><li>ä»…é€‚åˆçŸ­è¿æ¥åœºæ™¯</li></ul><h5 id="3ã€FileChannel-å·¥ä½œæ¨¡å¼"><a href="#3ã€FileChannel-å·¥ä½œæ¨¡å¼" class="headerlink" title="3ã€FileChannel å·¥ä½œæ¨¡å¼"></a>3ã€FileChannel å·¥ä½œæ¨¡å¼</h5><p>FileChannel åªèƒ½å·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹</p><h5 id="4ã€"><a href="#4ã€" class="headerlink" title="4ã€"></a>4ã€</h5><h5 id="5ã€-1"><a href="#5ã€-1" class="headerlink" title="5ã€"></a>5ã€</h5><h5 id="6ã€"><a href="#6ã€" class="headerlink" title="6ã€"></a>6ã€</h5><h5 id="7ã€"><a href="#7ã€" class="headerlink" title="7ã€"></a>7ã€</h5><h5 id="8ã€"><a href="#8ã€" class="headerlink" title="8ã€"></a>8ã€</h5><h2 id="å‚è€ƒæ–‡çŒ®-â†“"><a href="#å‚è€ƒæ–‡çŒ®-â†“" class="headerlink" title="å‚è€ƒæ–‡çŒ® â†“"></a>å‚è€ƒæ–‡çŒ® â†“</h2><p>try 1.7 ï¼š<a href="https://blog.csdn.net/renvictory/article/details/108844745">https://blog.csdn.net/renvictory/article/details/108844745</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="å†…åŠ›ç¯‡" scheme="https://mykkto.github.io/categories/%E5%86%85%E5%8A%9B%E7%AF%87/"/>
    
    
    <category term="netty" scheme="https://mykkto.github.io/tags/netty/"/>
    
    <category term="nio" scheme="https://mykkto.github.io/tags/nio/"/>
    
    <category term="ç½‘ç»œç¼–ç¨‹" scheme="https://mykkto.github.io/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>éšæ€§è®°å½•ä¸€å°ç‚¹ 2021-07-15è‡³æœªæ¥</title>
    <link href="https://mykkto.github.io/posts/cfd1312a.html"/>
    <id>https://mykkto.github.io/posts/cfd1312a.html</id>
    <published>2022-08-05T15:21:33.000Z</published>
    <updated>2023-04-22T12:44:06.463Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="â€”â€”â€”â€”ç®€ä¹¦åŸå§‹åœ°å€â€”â€”â€”â€”"><a href="#â€”â€”â€”â€”ç®€ä¹¦åŸå§‹åœ°å€â€”â€”â€”â€”" class="headerlink" title="â€”â€”â€”â€”ç®€ä¹¦åŸå§‹åœ°å€â€”â€”â€”â€”"></a><a href="https://www.jianshu.com/p/ed3159f299b4">â€”â€”â€”â€”ç®€ä¹¦åŸå§‹åœ°å€â€”â€”â€”â€”</a></h3><h4 id="2021å¹´07æœˆ15æ—¥"><a href="#2021å¹´07æœˆ15æ—¥" class="headerlink" title="2021å¹´07æœˆ15æ—¥"></a>2021å¹´07æœˆ15æ—¥</h4><p>pl/sqlå®¢æˆ·ç«¯bug åˆ‡æ¢çš„ç”¨æˆ·çš„æ—¶å€™ï¼Œä¼šä¸²æ‰ï¼ˆæ„æ€æ˜¯æ˜¾ç¤ºä¸Šåˆ‡æ¢äº†ï¼Œå…¶å®å¹¶æ²¡æœ‰ï¼‰<br>è§£å†³æ–¹æ¡ˆï¼šå¿…é¡»é‡å¯å®¢æˆ·ç«¯ï¼Œåˆ‡æ¢ç”¨æˆ·<br><img src="https://upload-images.jianshu.io/upload_images/19532021-6437c5f9d76fce63.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="imag222e.png"></p><h4 id="2021å¹´07æœˆ26æ—¥"><a href="#2021å¹´07æœˆ26æ—¥" class="headerlink" title="2021å¹´07æœˆ26æ—¥"></a>2021å¹´07æœˆ26æ—¥</h4><p>idea git å°å§¿åŠ¿ï¼Œæœ¬åœ°åº“æ‹–å›<br><img src="https://upload-images.jianshu.io/upload_images/19532021-645855f6537ed9f3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="im345age.png"><br><img src="https://upload-images.jianshu.io/upload_images/19532021-d95a586472670762.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><h4 id="2021å¹´07æœˆ28æ—¥"><a href="#2021å¹´07æœˆ28æ—¥" class="headerlink" title="2021å¹´07æœˆ28æ—¥"></a>2021å¹´07æœˆ28æ—¥</h4><p>oracle å°çŸ¥è¯†ï¼šä¸å°å¿ƒåˆ é™¤äº†ä¸€å¼ è¡¨æ•°æ®ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><pre class="line-numbers language-none"><code class="language-none">select * from è¡¨å as of timestamp  sysdate-1/12  //æŸ¥è¯¢ä¸¤ä¸ªå°æ—¶å‰çš„åˆ é™¤çš„æŸå¼ è¡¨<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2021å¹´08æœˆ22æ—¥"><a href="#2021å¹´08æœˆ22æ—¥" class="headerlink" title="2021å¹´08æœˆ22æ—¥"></a>2021å¹´08æœˆ22æ—¥</h4><p>å¹¶è¡Œï¼šå¤šä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶é—´ç‚¹å‘ç”Ÿï¼Œå¹¶ç”±ä¸åŒçš„cpuè¿›è¡Œå¤„ç†ï¼Œä¸äº’ç›¸æŠ¢å èµ„æº<br>å¹¶å‘ï¼šå¤šä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶é—´ç‚¹å†…åŒæ—¶å‘ç”Ÿäº†ï¼Œä½†ç”±åŒä¸€ä¸ªcpuè¿›è¡Œå¤„ç†ï¼Œäº’ç›¸æŠ¢å èµ„æº<br>æ–‡ç« æ¨èï¼š<a href="https://www.cnblogs.com/iamqiyue/p/14184769.html">https://www.cnblogs.com/iamqiyue/p/14184769.html</a></p><h4 id="2021å¹´08æœˆ30æ—¥"><a href="#2021å¹´08æœˆ30æ—¥" class="headerlink" title="2021å¹´08æœˆ30æ—¥"></a>2021å¹´08æœˆ30æ—¥</h4><p>jsp ç”¨0åšå­—æ®µçŠ¶æ€ï¼Œåˆ—è¡¨ä¼šå‡ºé—®é¢˜ï¼Œä¼šæœ‰é»˜è®¤å€¼</p><h4 id="2021å¹´09æœˆ07æ—¥"><a href="#2021å¹´09æœˆ07æ—¥" class="headerlink" title="2021å¹´09æœˆ07æ—¥"></a>2021å¹´09æœˆ07æ—¥</h4><p>easyUI åµŒå¥—å¯¹è¯æ¡†é—®é¢˜ï¼Œå¯¹è¯æ¡†Aå¼¹å‡ºå¯¹è¯æ¡†Bï¼ŒAæ— æ³•å…³é—­ã€‚<br>éœ€è¦åœ¨Açš„å…³é—­å›è°ƒ æ‰“å¼€Bï¼Œä¹Ÿå°±æ˜¯å…³é—­Aä¸èƒ½å’Œæ‰“å¼€B å†™åœ¨ä¸€èµ·ï¼Œå¿…é¡»å…³é—­A<br>è°ƒç”¨Açš„å…³é—­å›è°ƒä¹‹åå†æ‰“å¼€Bã€‚</p><h4 id="2021å¹´09æœˆ14æ—¥"><a href="#2021å¹´09æœˆ14æ—¥" class="headerlink" title="2021å¹´09æœˆ14æ—¥"></a>2021å¹´09æœˆ14æ—¥</h4><p>oracle 11gåˆ†ç»„æ¡ˆä¾‹ï¼š<br>1ã€group by user_id,PUNCH_DATEï¼šé€šè¿‡ç”¨æˆ·idå’Œæ—¥æœŸåˆ†ç»„<br>2ã€listagg( TIME_INTERVAL ,â€™,â€™) within group (order by id) ï¼šéœ€è¦å±•ç¤ºçš„å­—æ®µï¼ˆæ²¡æœ‰çº³å…¥åˆ†ç»„è§„åˆ™çš„ï¼‰ï¼Œorder by id  é€šè¿‡ id æ’åºï¼Œæˆ–è€…å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ’åºå­—æ®µ</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> d<span class="token punctuation">.</span>id<span class="token punctuation">,</span>u<span class="token punctuation">.</span>User_Id<span class="token punctuation">,</span>u<span class="token punctuation">.</span>User_Name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>Punch_Date<span class="token punctuation">,</span>d<span class="token punctuation">.</span>Punch_Time<span class="token punctuation">,</span>de<span class="token punctuation">.</span>Dept_Name<span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token keyword">time</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span>remark<span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span>TIME_INTERVAL<span class="token punctuation">,</span>d<span class="token punctuation">.</span>PUNCH_STATUS<span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span>user_id<span class="token punctuation">,</span>PUNCH_DATEï¼Œlistagg<span class="token punctuation">(</span> TIME_INTERVAL <span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token keyword">within</span> <span class="token keyword">group</span> <span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id<span class="token punctuation">)</span> <span class="token keyword">as</span> TIME_INTERVAL<span class="token punctuation">,</span>listagg<span class="token punctuation">(</span> <span class="token keyword">STATUS</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token keyword">within</span> <span class="token keyword">group</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">STATUS</span><span class="token punctuation">,</span>listagg<span class="token punctuation">(</span> id <span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token keyword">within</span> <span class="token keyword">group</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id<span class="token punctuation">)</span> <span class="token keyword">as</span> id<span class="token punctuation">,</span>listagg<span class="token punctuation">(</span> REMARK <span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token keyword">within</span> <span class="token keyword">group</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id<span class="token punctuation">)</span> <span class="token keyword">as</span> REMARK<span class="token punctuation">,</span>listagg<span class="token punctuation">(</span> PUNCH_TIME <span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token keyword">within</span> <span class="token keyword">group</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id<span class="token punctuation">)</span> <span class="token keyword">as</span> PUNCH_TIME<span class="token punctuation">,</span>listagg<span class="token punctuation">(</span> PUNCH_STATUS <span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token keyword">within</span> <span class="token keyword">group</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id<span class="token punctuation">)</span> <span class="token keyword">as</span> PUNCH_STATUS<span class="token punctuation">,</span>listagg<span class="token punctuation">(</span> <span class="token keyword">time</span> <span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token keyword">within</span> <span class="token keyword">group</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> id<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">time</span> <span class="token keyword">from</span> KQ_PUNCH_DAILY <span class="token keyword">group</span> <span class="token keyword">by</span> user_id<span class="token punctuation">,</span>PUNCH_DATE<span class="token punctuation">)</span> d <span class="token keyword">inner</span> <span class="token keyword">join</span>  tbl_sys_user  u  <span class="token keyword">on</span> d<span class="token punctuation">.</span>User_Id<span class="token operator">=</span>u<span class="token punctuation">.</span>USER_ID <span class="token keyword">inner</span> <span class="token keyword">join</span> tbl_sys_department de  <span class="token keyword">on</span> de<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>u<span class="token punctuation">.</span>dept_id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2021å¹´09æœˆ23æ—¥"><a href="#2021å¹´09æœˆ23æ—¥" class="headerlink" title="2021å¹´09æœˆ23æ—¥"></a>2021å¹´09æœˆ23æ—¥</h4><p>ä¸€ã€oracle 11g å­˜å‚¨è¿‡ç¨‹åˆ†å‰²å­—ç¬¦ä¸²æ¡ˆä¾‹ï¼šçº¯åˆ†å‰²</p><p>æµ‹è¯•ä»£ç ï¼ˆå…ˆè¿è¡Œå­˜å‚¨è¿‡ç¨‹ä»£ç ï¼‰</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">TABLE</span><span class="token punctuation">(</span> FUNC_ISM_GETSPLITSTR<span class="token punctuation">(</span><span class="token string">'_FUNC_CTP_LG_GEsss_s_ssssTSPNG_'</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…ˆåˆ›å»ºå˜é‡</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">--åˆ›å»ºå˜é‡</span><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">TYPE</span> <span class="token string">"ARRYTYPE1"</span> <span class="token operator">IS</span> VARRAY<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token keyword">OF</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å­˜å‚¨è¿‡ç¨‹ä»£ç </p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> FUNC_ISM_GETSPLITSTR <span class="token punctuation">(</span>in_str <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> <span class="token comment">--éœ€åˆ†å‰²çš„å­—ç¬¦ä¸²</span>in_split <span class="token operator">IN</span> VARCHAR2 <span class="token comment">--åˆ†éš”ç¬¦</span><span class="token punctuation">)</span><span class="token keyword">RETURN</span> arrytype1<span class="token keyword">AS</span>v_count1 <span class="token keyword">INTEGER</span><span class="token punctuation">;</span>v_count2 <span class="token keyword">INTEGER</span><span class="token punctuation">;</span>v_strlist arrytype1<span class="token punctuation">;</span>v_node VARCHAR2 <span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">BEGIN</span>v_count2 :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>v_strlist :<span class="token operator">=</span> arrytype1 <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">IF</span> <span class="token punctuation">(</span>in_str <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token punctuation">(</span>LENGTH <span class="token punctuation">(</span>in_str<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">THEN</span><span class="token keyword">RETURN</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span><span class="token keyword">FOR</span> v_i <span class="token operator">IN</span> <span class="token number">1</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> LENGTH <span class="token punctuation">(</span>in_str<span class="token punctuation">)</span><span class="token keyword">LOOP</span>v_count1 :<span class="token operator">=</span> INSTRB <span class="token punctuation">(</span>in_str<span class="token punctuation">,</span> in_split<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> v_i<span class="token punctuation">)</span><span class="token punctuation">;</span>v_count2 :<span class="token operator">=</span> INSTRB <span class="token punctuation">(</span>in_str<span class="token punctuation">,</span> in_split<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> v_i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>v_node :<span class="token operator">=</span> SUBSTRB <span class="token punctuation">(</span>in_str<span class="token punctuation">,</span> v_count1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> v_count2 <span class="token operator">-</span> v_count1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">IF</span> v_node <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token keyword">THEN</span>v_node :<span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span><span class="token keyword">IF</span> <span class="token punctuation">(</span>v_count2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token punctuation">(</span>v_count2 <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token keyword">THEN</span><span class="token keyword">EXIT</span><span class="token punctuation">;</span><span class="token keyword">ELSE</span>v_strlist<span class="token punctuation">.</span>EXTEND <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>v_strlist <span class="token punctuation">(</span>v_i<span class="token punctuation">)</span> :<span class="token operator">=</span> v_node<span class="token punctuation">;</span>v_node :<span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span><span class="token keyword">RETURN</span> v_strlist<span class="token punctuation">;</span><span class="token keyword">END</span> FUNC_ISM_GETSPLITSTR<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¾“å‡ºç»“æœ<br><img src="https://upload-images.jianshu.io/upload_images/19532021-51b5e892eeb7e588.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>äºŒã€oracle 11g å­˜å‚¨è¿‡ç¨‹åˆ†å‰²å­—ç¬¦ä¸²æ¡ˆä¾‹ï¼šåˆ†å‰²+åˆ¤æ–­<br>ç¼–å†™è¯­å¥<br><img src="https://upload-images.jianshu.io/upload_images/19532021-1cf3ff85786ef508.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> FUNC_ISM_GETSPLITSTR2 <span class="token punctuation">(</span><span class="token comment">-- æœ€ç»ˆè¿”å› 1 å‘èµ·éƒ¨é—¨ï¼Œ2 ä¸»åŠéƒ¨é—¨ï¼Œ3 ååŠéƒ¨é—¨ </span><span class="token comment">--  å†™æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨å¼€å§‹èŠ‚ç‚¹å’Œç»“æŸèŠ‚ç‚¹åŠ ä¸Šåˆ†éš”ç¬¦å¦åˆ™å¨¶ä¸åˆ°</span><span class="token comment">-- _FUNC_CTP_LG_GEsss_s_ssssTSPNG_ ç±»ä¼¼ è¿™ç§æ ¼å¼</span>in_str <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> <span class="token comment">--éœ€åˆ†å‰²çš„å­—ç¬¦ä¸²</span>in_split <span class="token operator">IN</span> VARCHAR2 <span class="token comment">--åˆ†éš”ç¬¦</span><span class="token punctuation">)</span><span class="token keyword">RETURN</span> VARCHAR2<span class="token keyword">AS</span>v_count1 <span class="token keyword">INTEGER</span><span class="token punctuation">;</span>v_count2 <span class="token keyword">INTEGER</span><span class="token punctuation">;</span>v_count3 <span class="token keyword">INTEGER</span><span class="token punctuation">;</span><span class="token comment">--è®¡æ•°å™¨</span>v_node VARCHAR2 <span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>v_result VARCHAR2 <span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>v_resulttep VARCHAR2 <span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>in_strtep VARCHAR2 <span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">BEGIN</span>in_strtep :<span class="token operator">=</span> in_split<span class="token operator">||</span>in_str<span class="token operator">||</span>in_split<span class="token punctuation">;</span>v_count2 :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>v_count3 :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>v_result :<span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span>v_resulttep :<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span><span class="token keyword">IF</span> <span class="token punctuation">(</span>in_strtep <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token punctuation">(</span>LENGTH <span class="token punctuation">(</span>in_strtep<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">THEN</span><span class="token keyword">RETURN</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span><span class="token keyword">FOR</span> v_i <span class="token operator">IN</span> <span class="token number">1</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> LENGTH <span class="token punctuation">(</span>in_strtep<span class="token punctuation">)</span><span class="token keyword">LOOP</span>v_count1 :<span class="token operator">=</span> INSTRB <span class="token punctuation">(</span>in_strtep<span class="token punctuation">,</span> in_split<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> v_i<span class="token punctuation">)</span><span class="token punctuation">;</span>v_count2 :<span class="token operator">=</span> INSTRB <span class="token punctuation">(</span>in_strtep<span class="token punctuation">,</span> in_split<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> v_i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>v_node :<span class="token operator">=</span> SUBSTRB <span class="token punctuation">(</span>in_strtep<span class="token punctuation">,</span> v_count1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> v_count2 <span class="token operator">-</span> v_count1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">IF</span> v_node <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token keyword">THEN</span>v_node :<span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> elsif <span class="token punctuation">(</span>v_node<span class="token operator">=</span> <span class="token string">'2'</span><span class="token punctuation">)</span> <span class="token keyword">then</span> v_count3 :<span class="token operator">=</span> v_count3 <span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">;</span><span class="token comment">-- è®°å¾—å¯¹èŠ‚ç‚¹åˆ¤ç©ºï¼Œå†™åœ¨åå¤´</span><span class="token keyword">ELSE</span> v_resulttep :<span class="token operator">=</span> v_resulttep <span class="token operator">||</span> v_node<span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span><span class="token keyword">IF</span> <span class="token punctuation">(</span>v_count2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token punctuation">(</span>v_count2 <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token keyword">THEN</span><span class="token keyword">EXIT</span><span class="token punctuation">;</span><span class="token keyword">ELSE</span>v_strlist<span class="token punctuation">.</span>EXTEND <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>v_strlist <span class="token punctuation">(</span>v_i<span class="token punctuation">)</span> :<span class="token operator">=</span> v_node<span class="token punctuation">;</span>v_node :<span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>LENGTH <span class="token punctuation">(</span>in_str<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span> <span class="token operator">=</span> v_count3<span class="token punctuation">)</span> <span class="token keyword">then</span> v_result :<span class="token operator">=</span> <span class="token string">'2'</span><span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span><span class="token keyword">RETURN</span> v_result<span class="token punctuation">;</span><span class="token keyword">END</span> FUNC_ISM_GETSPLITSTR2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœå¯¹æ¯”è¾“å‡ºï¼šå¦‚æœæœ‰ä¸€ä¸ª 1æ‰€æœ‰éƒ½æ˜¯1 ï¼Œå¦‚æœ æ‰€æœ‰ä¸º 2 æ‰èƒ½å…¨éƒ¨ä¸º2<br><img src="https://upload-images.jianshu.io/upload_images/19532021-09ca25205c2486ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>ä¸‰ã€å•æ¡SQL æ˜ å°„è¾“å‡ºï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸èƒ½æ˜¯å¤šæ¡ç»“æœé›†ï¼Œè¿™ä¸ªåªæ˜¯å•æ¡ï¼Œæ¥å—ç±»å‹ä¸º varchar2 ï¼‰</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span>        <span class="token string">"FUNC_ISM_GETSPLITSTR2_TODAY2"</span> <span class="token punctuation">(</span><span class="token comment">-- è®¡ç®—åŠ 3å¤©åï¼ˆè·³è¿‡éåŒæ˜¨æ—¥ï¼‰ï¼Œå¾—åˆ°å®é™…çš„ æ—¥æœŸï¼‰</span><span class="token comment">--  å†™æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨å¼€å§‹èŠ‚ç‚¹å’Œç»“æŸèŠ‚ç‚¹åŠ ä¸Šåˆ†éš”ç¬¦å¦åˆ™å¨¶ä¸åˆ°</span><span class="token comment">-- _FUNC_CTP_LG_GEsss_s_ssssTSPNG_ ç±»ä¼¼ è¿™ç§æ ¼å¼</span>in_str <span class="token operator">IN</span> VARCHAR2 <span class="token comment">--éœ€è¦è¢«è®¡ç®—çš„æ—¥æœŸ</span><span class="token punctuation">)</span><span class="token keyword">RETURN</span> VARCHAR2<span class="token keyword">AS</span>in_result VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- </span>in_temp VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>in_year VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>in_month VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>in_day VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">BEGIN</span>in_temp :<span class="token operator">=</span> SUBSTR<span class="token punctuation">(</span>in_str<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">sql</span><span class="token keyword">select</span> ID <span class="token keyword">into</span> in_result <span class="token keyword">from</span> TBL_TASKS_PERSONAL_SIDE <span class="token keyword">WHERE</span> ID<span class="token operator">=</span><span class="token string">'402881e57c968139017c969805df00d9'</span><span class="token punctuation">;</span><span class="token keyword">RETURN</span> in_temp<span class="token punctuation">;</span><span class="token keyword">END</span> FUNC_ISM_GETSPLITSTR2_TODAY2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ä»£ç ï¼š<code>SELECT FUNC_ISM_GETSPLITSTR2_TODAY2('2021-04-22') as aaa  FROM TBL_TASKS_PERSONAL_MAIN</code></p><p><img src="https://upload-images.jianshu.io/upload_images/19532021-0128b15034cd5d45.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p><strong>ORACLE å­˜å‚¨è¿‡ç¨‹INTO å¤šä¸ªå˜é‡</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> f1<span class="token punctuation">,</span>f2<span class="token punctuation">,</span>f3 <span class="token keyword">into</span> v1<span class="token punctuation">,</span>v2<span class="token punctuation">,</span>v3 <span class="token keyword">from</span> tab1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2021å¹´09æœˆ29æ—¥"><a href="#2021å¹´09æœˆ29æ—¥" class="headerlink" title="2021å¹´09æœˆ29æ—¥"></a>2021å¹´09æœˆ29æ—¥</h4><p>æœ‰çš„æ—¶å€™Java catch ç”¨ <code>e.getStackTrace ( );</code>ä¸å‡ºå¼‚å¸¸æ ˆä¿¡æ¯ï¼Œ<br>å¯ä»¥ä½¿ç”¨<code>e.printStackTrace ( );</code>è§£å†³</p><h4 id="2021å¹´10æœˆ26æ—¥"><a href="#2021å¹´10æœˆ26æ—¥" class="headerlink" title="2021å¹´10æœˆ26æ—¥"></a>2021å¹´10æœˆ26æ—¥</h4><p>ï¼ˆ1ï¼‰oracle åˆ†é¡µ</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> A<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>ROWNUM RN <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> DEP_TASK_VIEW<span class="token punctuation">)</span> A  <span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> ROWNUM <span class="token operator">&lt;=</span><span class="token number">10</span> <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> RN <span class="token operator">&gt;=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ï¼ˆ2ï¼‰ä¸ä»…å¦‚æ­¤ RNè¿˜å¯ä»¥å½“åšå”¯ä¸€è®°å½•æ•°IDä½¿ç”¨ï¼Œå› è§†å›¾åˆå¹¶å‡ºæ¥çš„æ•°æ®IDä¸æ˜¯å”¯ä¸€çš„</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> A<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>ROWNUM RN <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> DEP_TASK_VIEW<span class="token punctuation">)</span> A  <span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> ROWNUM <span class="token operator">&lt;=</span><span class="token number">10</span> <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> RN <span class="token operator">&gt;=</span> <span class="token number">1</span>  <span class="token operator">and</span> RN <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2021å¹´10æœˆ29æ—¥"><a href="#2021å¹´10æœˆ29æ—¥" class="headerlink" title="2021å¹´10æœˆ29æ—¥"></a>2021å¹´10æœˆ29æ—¥</h4><p>æ—¥æœŸæœŸé™è®¡ç®—èŠ‚å‡æ—¥çš„å­˜å‚¨è¿‡ç¨‹ï¼Œå¥—ç”¨ä¸¤ä¸ªè§†å›¾<br>ï¼ˆ1ï¼‰å‡½æ•°</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> <span class="token string">"FUNC_ISM_GETSPLITSTR2_TODAY2"</span> <span class="token punctuation">(</span><span class="token comment">-- è®¡ç®—åŠ 3å¤©åï¼ˆè·³è¿‡éåŒæ˜¨æ—¥ï¼‰ï¼Œå¾—åˆ°å®é™…çš„ æ—¥æœŸï¼‰æ‰æœ‰è¯¥è·³çš„ç¬¬ä¸‰æ¡è®°å½•è·å–ï¼Œè€Œä¸æ˜¯æ—¥æœŸç›´æ¥+3ï¼Œç­›é€‰å‡ºåªæœ‰å·¥ä½œæ—¥</span>in_str <span class="token operator">IN</span> VARCHAR2 <span class="token comment">--éœ€è¦è¢«è®¡ç®—çš„æ—¥æœŸ</span><span class="token punctuation">)</span><span class="token keyword">RETURN</span> VARCHAR2<span class="token keyword">AS</span>in_result VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- æœ€ç»ˆç»“æœ</span>in_temp VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- è¾…åŠ©ç­›é€‰å¹´</span>in_temp2 NUMBER<span class="token punctuation">;</span><span class="token comment">-- è¾…åŠ©ç­›é€‰å¹´ +1</span>in_temp3 VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- è¾…åŠ©ç­›é€‰æœˆ</span>in_temp33 NUMBER<span class="token punctuation">;</span><span class="token comment">-- è¾…åŠ©ç­›é€‰æœˆ --å¤„ç†ç²¾åº¦</span>in_temp4 VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- è¾…åŠ©ç­›é€‰æ—¥</span>in_temp44 NUMBER<span class="token punctuation">;</span><span class="token comment">-- è¾…åŠ©ç­›é€‰æ—¥ --å¤„ç†ç²¾åº¦</span>in_year VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--è®¡ç®—çš„å¹´</span>in_month VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--è®¡ç®—çš„æœˆ</span>in_day VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--è®¡ç®—çš„æ—¥</span>in_rn1 VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--å…ˆæ‰¾åˆ°è¯æ¡æ—¥å†çš„rownum,ç„¶ååŠ 3çš„è®°å½•æ•°å°±æ˜¯</span>in_rn12 VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- è¯æ¡äºŒï¼ˆæœ€ç»ˆçš„ï¼‰ï¼Œé…åˆè§†å›¾äºŒ</span>in_rn122 NUMBER<span class="token punctuation">;</span>in_time VARCHAR2 <span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- åç¼€çš„æ—¶é—´</span><span class="token keyword">BEGIN</span>in_temp :<span class="token operator">=</span> SUBSTR<span class="token punctuation">(</span>in_str<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>in_temp2 :<span class="token operator">=</span> <span class="token string">"TO_NUMBER"</span><span class="token punctuation">(</span>in_temp<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>in_temp3 :<span class="token operator">=</span> SUBSTR<span class="token punctuation">(</span>in_str<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>in_temp33 :<span class="token operator">=</span> <span class="token string">"TO_NUMBER"</span><span class="token punctuation">(</span>in_temp3<span class="token punctuation">)</span><span class="token punctuation">;</span>in_temp4 :<span class="token operator">=</span> SUBSTR<span class="token punctuation">(</span>in_str<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>in_temp44 :<span class="token operator">=</span> <span class="token string">"TO_NUMBER"</span><span class="token punctuation">(</span>in_temp4<span class="token punctuation">)</span><span class="token punctuation">;</span>in_time :<span class="token operator">=</span> SUBSTR<span class="token punctuation">(</span>in_str<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> RNN <span class="token keyword">into</span> in_rn1 <span class="token keyword">from</span> TASK_TEMP_DAY1 <span class="token keyword">WHERE</span> CALYEAR <span class="token operator">=</span> in_temp <span class="token operator">AND</span> CALENDAR_MONTH <span class="token operator">=</span> in_temp33 <span class="token operator">AND</span> CALENDAR_DAY <span class="token operator">=</span> in_temp44<span class="token punctuation">;</span><span class="token keyword">SELECT</span> RNN2 <span class="token keyword">into</span> in_rn12 <span class="token keyword">from</span> TASK_TEMP_DAY2 <span class="token keyword">WHERE</span> RNN <span class="token operator">=</span> in_rn1<span class="token punctuation">;</span>in_rn122 :<span class="token operator">=</span> <span class="token string">"TO_NUMBER"</span><span class="token punctuation">(</span>in_rn12<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> CALYEAR<span class="token punctuation">,</span>CALENDAR_MONTH<span class="token punctuation">,</span>CALENDAR_DAY <span class="token keyword">into</span> in_year<span class="token punctuation">,</span>in_month<span class="token punctuation">,</span>in_day <span class="token keyword">from</span> TASK_TEMP_DAY2 <span class="token keyword">WHERE</span> RNN2 <span class="token operator">=</span> in_rn122<span class="token punctuation">;</span>in_result :<span class="token operator">=</span> in_year<span class="token operator">||</span><span class="token string">'-'</span><span class="token punctuation">;</span><span class="token keyword">IF</span><span class="token punctuation">(</span>in_month<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> in_result :<span class="token operator">=</span> in_result <span class="token operator">||</span> <span class="token string">'0'</span><span class="token operator">||</span>in_month<span class="token operator">||</span><span class="token string">'-'</span><span class="token punctuation">;</span><span class="token keyword">ELSE</span> in_result :<span class="token operator">=</span> in_result <span class="token operator">||</span>in_month<span class="token operator">||</span><span class="token string">'-'</span><span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span><span class="token keyword">IF</span><span class="token punctuation">(</span>in_day<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> in_result :<span class="token operator">=</span> in_result <span class="token operator">||</span> <span class="token string">'0'</span><span class="token operator">||</span>in_day<span class="token punctuation">;</span><span class="token keyword">ELSE</span> in_result :<span class="token operator">=</span> in_result <span class="token operator">||</span>in_day<span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>in_result :<span class="token operator">=</span> in_result <span class="token operator">||</span>in_time<span class="token punctuation">;</span><span class="token keyword">RETURN</span> in_result<span class="token punctuation">;</span><span class="token keyword">END</span> FUNC_ISM_GETSPLITSTR2_TODAY2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ï¼ˆ2ï¼‰TASK_TEMP_DAY1</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span>ROWNUM RNN<span class="token punctuation">,</span><span class="token string">"CALYEAR"</span><span class="token punctuation">,</span><span class="token string">"ID"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_ID"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_MONTH"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_DAY"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_DATE_TYPE"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_MODIFY_PERSON"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_MODIFY_TIME"</span><span class="token punctuation">,</span><span class="token string">"BLANK0"</span><span class="token punctuation">,</span><span class="token string">"BLANK1"</span><span class="token keyword">FROM</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span>DE<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> CA<span class="token punctuation">.</span>CALENDAR_YEAR CALYEAR<span class="token keyword">FROM</span>KQ_CALENDAR CA<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> KQ_CALENDAR_DETAIL DE <span class="token keyword">ON</span> CA<span class="token punctuation">.</span>CALENDAR_ID <span class="token operator">=</span> DE<span class="token punctuation">.</span>CALENDAR_ID<span class="token keyword">WHERE</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">AND</span> CA<span class="token punctuation">.</span>CALENDAR_CREATOR <span class="token operator">=</span> <span class="token string">'4028811d7057520301705756b3ca0050'</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span>CA<span class="token punctuation">.</span>CALENDAR_YEAR <span class="token keyword">ASC</span><span class="token punctuation">,</span>DE<span class="token punctuation">.</span>CALENDAR_MONTH <span class="token keyword">ASC</span><span class="token punctuation">,</span>DE<span class="token punctuation">.</span>CALENDAR_DAY <span class="token keyword">ASC</span><span class="token punctuation">)</span> <span class="token comment">-- å·¥ä½œä»»åŠ¡é€¾æœŸè®¡ç®—èŠ‚å‡æ—¥é…åˆå‡½æ•°çš„è§†å›¾(è¢«æŸ¥è¯¢çš„è§†å›¾)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ï¼ˆ3ï¼‰TASK_TEMP_DAY2</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span>ROWNUM RNN2<span class="token punctuation">,</span><span class="token string">"RNN"</span><span class="token punctuation">,</span><span class="token string">"CALYEAR"</span><span class="token punctuation">,</span><span class="token string">"ID"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_ID"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_MONTH"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_DAY"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_DATE_TYPE"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_MODIFY_PERSON"</span><span class="token punctuation">,</span><span class="token string">"CALENDAR_MODIFY_TIME"</span><span class="token punctuation">,</span><span class="token string">"BLANK0"</span><span class="token punctuation">,</span><span class="token string">"BLANK1"</span><span class="token keyword">FROM</span>TASK_TEMP_DAY1<span class="token keyword">WHERE</span>CALENDAR_DATE_TYPE <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token comment">-- å·¥ä½œä»»åŠ¡é€¾æœŸè®¡ç®—èŠ‚å‡æ—¥é…åˆå‡½æ•°çš„è§†å›¾(è¢«è®¡ç®—çš„è§†å›¾)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2021å¹´11æœˆ04æ—¥"><a href="#2021å¹´11æœˆ04æ—¥" class="headerlink" title="2021å¹´11æœˆ04æ—¥"></a>2021å¹´11æœˆ04æ—¥</h4><p>oracle 11g å†™å­˜å‚¨è¿‡ç¨‹æŠ¥é”™ï¼š<code>ORA-00972 identifier is too long</code><br>åŸå› å­˜å‚¨è¿‡ç¨‹çš„å‘½åè¿‡é•¿ï¼Œæ”¹çŸ­å³å¯ã€‚</p><h4 id="2021å¹´11æœˆ05æ—¥"><a href="#2021å¹´11æœˆ05æ—¥" class="headerlink" title="2021å¹´11æœˆ05æ—¥"></a>2021å¹´11æœˆ05æ—¥</h4><p>oracle 11g å†™å­˜å‚¨è¿‡ç¨‹ æ‹¼æ¥å•å¼•å·è½¬ä¹‰é—®é¢˜ï¼š</p><pre class="line-numbers language-none"><code class="language-none">in_str := '1';   -- è¾“å‡º  1in_str := '''1''';  -- è¾“å‡º '1'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="2021å¹´11æœˆ05æ—¥-1"><a href="#2021å¹´11æœˆ05æ—¥-1" class="headerlink" title="2021å¹´11æœˆ05æ—¥"></a>2021å¹´11æœˆ05æ—¥</h4><p>oracle 11g å†™å­˜å‚¨è¿‡ç¨‹ SQLå­—ç¬¦ä¸² è¿è¡Œåèµ‹å€¼ï¼š</p><pre class="line-numbers language-none"><code class="language-none">v_idsaaa := SUBSTR(v_idsaaa,1,"LENGTH"(v_idsaaa)-1);in_timesiov := 'SELECT createTe_  from (SELECT listagg (createTe_, '','') WITHIN GROUP (ORDER BY ID_) AS createTe_ from (select TO_CHAR (create_,''yyyy-mm-dd hh24:mi:ss'') createTe_ ,COMMITUSERID_,BUSINESSID_,NAME_,ID_from jbpm_taskinstance WHERE BUSINESSID_=''402881f47ce4b52d017ce4bc73d30026'' and NAME_ =''è¿›ç¨‹1'' and  COMMITUSERID_ in ('||v_idsaaa||'))  GROUP BY BUSINESSID_,NAME_)' ;execute immediate in_timesiov into v_flag;-- execute immediate ç”¨äºæ‰§è¡Œ SQLè¯­å¥-- in_timesiov  æ˜¯æ‹¼æ¥å‡ºæ¥çš„SQLè¯­å¥-- v_flag æ¥æ”¶è¯­å¥è¿”å›çš„æ•°æ®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2021å¹´11æœˆ15æ—¥"><a href="#2021å¹´11æœˆ15æ—¥" class="headerlink" title="2021å¹´11æœˆ15æ—¥"></a>2021å¹´11æœˆ15æ—¥</h4><p>è®°å½•ä¸€ä¸ª echarts æŸ±å½¢å›¾çš„å‘<br>ï¼ˆ1ï¼‰æ¸²æŸ“keyçš„æ—¶å€™å¦‚æœæ˜¯æ•´ä¸ªæ•°ç»„è¿‡æ¥ï¼Œå°±ä¼šå˜æˆä¸€å¨</p><pre class="line-numbers language-none"><code class="language-none">xAxis: {    //data: ["ä¸€èˆ¬","å¥½","éå¸¸å¥½"]    data: dataKeyList},<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://upload-images.jianshu.io/upload_images/19532021-9d9f204d4db6b2b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>ï¼ˆ2ï¼‰æ‰€ä»¥è¦ä½¿ç”¨éå†å‡ºæ¥</p><pre class="line-numbers language-none"><code class="language-none">xAxis: {    data: ["ä¸€èˆ¬","å¥½","éå¸¸å¥½"]},<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="2021å¹´11æœˆ30æ—¥"><a href="#2021å¹´11æœˆ30æ—¥" class="headerlink" title="2021å¹´11æœˆ30æ—¥"></a>2021å¹´11æœˆ30æ—¥</h4><p>SQL è‡ªå®šä¹‰æ’åº</p><pre class="line-numbers language-none"><code class="language-none">select * from tbl_duty_user decode(u.postType,'1',4,'2',3,'3',2,'4',1) asc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>oracle</strong> <strong>å­—æ®µå·²é€—å·éš”å¼€åˆ†è§£ä¸ºå¤šæ¡æ•°æ®</strong></p><p><a href="https://blog.csdn.net/sofeien/article/details/80534557">https://blog.csdn.net/sofeien/article/details/80534557</a></p><p><strong>No row with the given identifier exists: [com.jh.jcs.business.duty.model.TblDutyDetail#402881e57c7df2e5017c7df8d7c20138]</strong></p><p>HQLå¤šå°ä¸€è„æ•°æ®é—®é¢˜</p><h4 id="2021å¹´12æœˆ13æ—¥"><a href="#2021å¹´12æœˆ13æ—¥" class="headerlink" title="2021å¹´12æœˆ13æ—¥"></a>2021å¹´12æœˆ13æ—¥</h4><p>å…³äºSQL æœç´¢æ—¶é—´æ—¥æœŸèŒƒå›´ä¸å¯ç”¨ or </p><pre class="line-numbers language-none"><code class="language-none">String hql2 = "from KqPunchDaily where  punchDate like '%" + DailyUtil.sameMonth ( )+ "%' or punchDate like '%" + DailyUtil.lastMonth ( )+ "%' and punchStatus !=0  and userId in ("+idstemp+")   ";<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä»¥ä¸Š3wæ•°æ®<br>è¦ç”¨ beginTime ï¼Œæˆ–è€… &gt;,  &lt;é”å®šèŒƒå›´æ—¶é—´</p><pre class="line-numbers language-none"><code class="language-none">String hql1 = "from KqLeaveForm where  beginTime BETWEEN '" + DailyUtil.sameMonth ( ) + "' and   '" + DailyUtil.lastMonth ( ) + "'  and status ='1'  and deptId = '"+deptId+"' ";<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2021å¹´12æœˆ17æ—¥"><a href="#2021å¹´12æœˆ17æ—¥" class="headerlink" title="2021å¹´12æœˆ17æ—¥"></a>2021å¹´12æœˆ17æ—¥</h4><p>pl/SQLå®¢æˆ·ç«¯ä¹±ç <br><a href="https://blog.csdn.net/gm371200587/article/details/81381825">https://blog.csdn.net/gm371200587/article/details/81381825</a></p><h4 id="2021å¹´12æœˆ17æ—¥-1"><a href="#2021å¹´12æœˆ17æ—¥-1" class="headerlink" title="2021å¹´12æœˆ17æ—¥"></a>2021å¹´12æœˆ17æ—¥</h4><p>oracleåˆå¹¶è¡¨å‡½æ•°</p><pre class="line-numbers language-none"><code class="language-none">ã€€ã€€Unionï¼šå¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œå¹¶é›†æ“ä½œï¼Œä¸åŒ…æ‹¬é‡å¤è¡Œï¼ŒåŒæ—¶è¿›è¡Œé»˜è®¤è§„åˆ™çš„æ’åºï¼›ã€€ã€€Union Allï¼šå¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œå¹¶é›†æ“ä½œï¼ŒåŒ…æ‹¬é‡å¤è¡Œï¼Œä¸è¿›è¡Œæ’åºï¼›ã€€ã€€Intersectï¼šå¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œäº¤é›†æ“ä½œï¼Œä¸åŒ…æ‹¬é‡å¤è¡Œï¼ŒåŒæ—¶è¿›è¡Œé»˜è®¤è§„åˆ™çš„æ’åºï¼›ã€€ã€€Minusï¼šå¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œå·®æ“ä½œï¼Œä¸åŒ…æ‹¬é‡å¤è¡Œï¼ŒåŒæ—¶è¿›è¡Œé»˜è®¤è§„åˆ™çš„æ’åºã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2021å¹´12æœˆ20æ—¥"><a href="#2021å¹´12æœˆ20æ—¥" class="headerlink" title="2021å¹´12æœˆ20æ—¥"></a>2021å¹´12æœˆ20æ—¥</h4><p>å®šåˆ¶æ’åºï¼šè¡¨ï¼Œå­¦ç”Ÿæ ¹æ®æ€§åˆ«æ’åºï¼Œå¦‚æœæ˜¯ç”·çš„æ ¹æ®å¹´é¾„å‡åºï¼Œå¦‚æœæ˜¯å¥³çš„æ ¹æ®ä½“é‡descï¼Œç”·çš„æ’åœ¨å¥³çš„å‰é¢</p><pre class="line-numbers language-none"><code class="language-none">order by æ€§åˆ«ï¼Œcase when æ€§åˆ«=ç”· then å¹´é¾„ end,case when æ€§åˆ«=å¥³ then ä½“é‡ end desc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>###å‚è€ƒåšå®¢<br><a href="https://www.cnblogs.com/sunice/p/10436725.html">https://www.cnblogs.com/sunice/p/10436725.html</a></p><h4 id="2022-08-01"><a href="#2022-08-01" class="headerlink" title="2022-08-01"></a>2022-08-01</h4><p>dea  sql æœªè¿æ¥æ£€æŸ¥ çˆ†çº¢å–æ¶ˆæ ·å¼é…ç½®ï¼š<a href="https://blog.csdn.net/a907691592/article/details/94724090">https://blog.csdn.net/a907691592/article/details/94724090</a></p><p>idea è‡ªåŠ¨ç”Ÿæˆåºåˆ—å·ï¼š<a href="https://www.jianshu.com/p/b4807c3efcb6">https://www.jianshu.com/p/b4807c3efcb6</a></p><p>idea é…ç½® åŒ…æ’åºâ€“ sort by type</p><p>idea ä¹¦ç­¾æŠ€å·§ï¼š<a href="https://www.studyweb.cn/detail/java_174180.html">https://www.studyweb.cn/detail/java_174180.html</a></p><p>oracle å­—ç¬¦ä¸²åˆ†å‰²ï¼š<a href="https://blog.csdn.net/qq_40230848/article/details/123417714">https://blog.csdn.net/qq_40230848/article/details/123417714</a></p><p>oracle é•¿å­—ç¬¦ä¸²æ— æ³•æ’å…¥é—®é¢˜ï¼š</p><p><a href="https://blog.csdn.net/weixin_46266448/article/details/124351040">https://blog.csdn.net/weixin_46266448/article/details/124351040</a></p><p><a href="https://www.ssfiction.com/sqljc/630238.html">https://www.ssfiction.com/sqljc/630238.html</a></p><p>æ‰§è¡Œæ³¨æ„å† update åé¢åŠ  commit;</p><h4 id="2022-08-21"><a href="#2022-08-21" class="headerlink" title="2022-08-21"></a>2022-08-21</h4><p>ideaè°ƒè¯•å°æŠ€å·§ï¼Œevaluateï¼š<a href="https://blog.csdn.net/xue_xiaofei/article/details/113197181">https://blog.csdn.net/xue_xiaofei/article/details/113197181</a></p><h4 id="2022-11-05"><a href="#2022-11-05" class="headerlink" title="2022-11-05"></a>2022-11-05</h4><p>ä»Šå¤©åœ¨åšblog é™æ€ç§»æ¤ï¼Œé‡åˆ°ä¸€æ¡linux å‘½ä»¤ï¼ˆåˆ é™¤å­æ–‡ä»¶ï¼Œé™¤äº†æŸä¸ªæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> -rf <span class="token operator">!</span><span class="token punctuation">(</span>static<span class="token operator">|</span>rmnotstatic.sh<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ¡ä¼šåˆ é™¤å½“å‰ç›®å½•çš„æ‰€æœ‰ï¼Œé™¤äº†æ‹¬å·ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œè¿è¡Œæ²¡é—®é¢˜ï¼Œä½†æ˜¯æ”¾åˆ° shell è„šæœ¬ä¸­</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@VM-4-7-centos www<span class="token punctuation">]</span><span class="token comment"># sh rmnotstatic.sh </span>rmnotstatic.sh: line <span class="token number">2</span>: syntax error near unexpected token <span class="token variable"><span class="token variable">`</span><span class="token punctuation">(</span>'rmnotstatic.sh: line <span class="token number">2</span>: <span class="token variable">`</span></span><span class="token function">rm</span> -rf <span class="token operator">!</span><span class="token punctuation">(</span>static<span class="token operator">|</span>mnotstatic.sh<span class="token punctuation">)</span>'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªæ„æ€æ˜¯ï¼šæ„å¤–æ ‡è®°â€œï¼ˆâ€é™„è¿‘å‡ºç°è¯­æ³•é”™è¯¯ï¼Œä½†æ˜¯è¯­æ³•æ˜¯æ²¡é”™çš„ï¼ŒçŒœæƒ³åº”è¯¥æ˜¯æ²¡æœ‰è½¬ä¹‰ï¼Œäºæ˜¯æ”¹æˆ</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token function">rm</span> -rf <span class="token operator">!</span><span class="token punctuation">\</span><span class="token punctuation">(</span>static<span class="token punctuation">\</span><span class="token operator">|</span>rmnotstatic.sh<span class="token punctuation">\</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å°±å¯ä»¥ï¼</p><h4 id="2022-11-22"><a href="#2022-11-22" class="headerlink" title="2022-11-22"></a>2022-11-22</h4><p>tnsnames.ora æ–‡ä»¶è§£æè¯´æ˜ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">DB_NAME<span class="token operator">=</span>  <span class="token punctuation">(</span>DESCRIPTION <span class="token operator">=</span>    <span class="token punctuation">(</span>ADDRESS <span class="token operator">=</span> <span class="token punctuation">(</span>PROTOCOL <span class="token operator">=</span> TCP<span class="token punctuation">)</span><span class="token punctuation">(</span>HOST <span class="token operator">=</span> IP<span class="token punctuation">)</span><span class="token punctuation">(</span>PORT <span class="token operator">=</span> ç«¯å£å·<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">(</span>CONNECT_DATA <span class="token operator">=</span>      <span class="token punctuation">(</span>SERVER <span class="token operator">=</span> DEDICATED<span class="token punctuation">)</span>      <span class="token punctuation">(</span>SERVICE_NAME <span class="token operator">=</span> å®ä¾‹åç§°<span class="token punctuation">)</span>    <span class="token punctuation">)</span>  <span class="token punctuation">)</span>æœ€ç»ˆç­‰äºï¼šip ç«¯å£<span class="token operator">/</span>å®ä¾‹åç§°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/wml-it/p/15175753.html">https://www.cnblogs.com/wml-it/p/15175753.html</a></p><h4 id="2022-11-23"><a href="#2022-11-23" class="headerlink" title="2022-11-23"></a>2022-11-23</h4><p>mybatis å£°æ˜å®ä½“å­—æ®µæ³¨è§£ç”¨  @tablefield  ä¸è¦ç”¨jdkçš„@cloumn </p><h4 id="2022-12-20"><a href="#2022-12-20" class="headerlink" title="2022-12-20"></a>2022-12-20</h4><p>springbooté›†æˆnutzdao :<a href="https://www.codenong.com/cs106644689/">https://www.codenong.com/cs106644689/</a></p><p>nutzæ‰©å±•æ–‡æ¡£ï¼š<a href="https://www.wenjiangs.com/doc/nutz-dao-create">https://www.wenjiangs.com/doc/nutz-dao-create</a></p><p>nutzæœ¬åœ°ï¼Œmavenæœ¬åœ°å¼•ç”¨jarï¼š<br><a href="http://t.zoukankan.com/iceywu-p-12284695.html">http://t.zoukankan.com/iceywu-p-12284695.html</a><br><a href="https://blog.csdn.net/weixin_43606226/article/details/124021874">https://blog.csdn.net/weixin_43606226/article/details/124021874</a></p><h4 id="2022-12-21"><a href="#2022-12-21" class="headerlink" title="2022-12-21"></a>2022-12-21</h4><p>idea sqlè¡¨çˆ†çº¢è§£å†³ï¼š<a href="https://blog.csdn.net/qq_62497280/article/details/123741808">https://blog.csdn.net/qq_62497280/article/details/123741808</a></p><h4 id="æ•£è£…çš„ç–‘éš¾æ‚ç—‡"><a href="#æ•£è£…çš„ç–‘éš¾æ‚ç—‡" class="headerlink" title="æ•£è£…çš„ç–‘éš¾æ‚ç—‡"></a>æ•£è£…çš„ç–‘éš¾æ‚ç—‡</h4><p>1ã€é“¾è·¯Aæ²¡é—®é¢˜ï¼Œé“¾è·¯Cæ²¡é—®é¢˜ï¼Œå®Œæ•´ABCæœ‰é—®é¢˜ï¼Œåœ¨æ²¡æœ‰æ—¥å¿—å¯ä»¥çœ‹çš„æƒ…å†µä¸‹ï¼Œè€ƒè™‘æ˜¯å¦Aå¼‚æ­¥ï¼Œå»¶è¿Ÿï¼Œå¯¼è‡´Cæ‹¿ä¸åˆ°Aé“¾è·¯åº”è¯¥æä¾›ç»™Cçš„æ¶ˆæ¯ï¼ˆå…³äºç¬¬ä¸‰æ–¹äº¤äº’å»¶è¿Ÿä¹Ÿéœ€è¦è€ƒè™‘ï¼Œç‰¹åˆ«æ˜¯é‡åˆ°å¼‚æ­¥çš„æƒ…å†µä¸‹ï¼‰</p><p>2ã€æ–°æ¥å£Aæ…¢ï¼ŒåŸå§‹æ¥å£Aå¿«ï¼Œè€ƒè™‘æ˜¯å¦å“ªé‡Œæœ‰å®šæ—¶åˆ·æ–°ç¼“å­˜äº†ä¸€äº›æ•°æ®</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="docker" scheme="https://mykkto.github.io/categories/docker/"/>
    
    
    <category term="æŠ€æœ¯" scheme="https://mykkto.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="è®°å½•" scheme="https://mykkto.github.io/tags/%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>docker æ“ä½œç¯‡</title>
    <link href="https://mykkto.github.io/posts/abdfa13a.html"/>
    <id>https://mykkto.github.io/posts/abdfa13a.html</id>
    <published>2022-07-05T15:17:13.000Z</published>
    <updated>2022-11-12T15:07:08.072Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="â€”â€”â€”â€”â€”â€”â€”â€”â€”-Docker-éƒ¨ç½²ç¯‡-â€”â€”â€”â€”â€”â€”â€”â€”â€“"><a href="#â€”â€”â€”â€”â€”â€”â€”â€”â€”-Docker-éƒ¨ç½²ç¯‡-â€”â€”â€”â€”â€”â€”â€”â€”â€“" class="headerlink" title="â€”â€”â€”â€”â€”â€”â€”â€”â€”  Docker éƒ¨ç½²ç¯‡  â€”â€”â€”â€”â€”â€”â€”â€”â€“"></a><a href="/posts/caff0950">â€”â€”â€”â€”â€”â€”â€”â€”â€”  Docker éƒ¨ç½²ç¯‡  â€”â€”â€”â€”â€”â€”â€”â€”â€“</a></h2><h2 id="ã€‡ã€æœ¬ç« æºä»£ç "><a href="#ã€‡ã€æœ¬ç« æºä»£ç " class="headerlink" title="ã€‡ã€æœ¬ç« æºä»£ç "></a>ã€‡ã€æœ¬ç« æºä»£ç </h2><p><a href="https://gitee.com/TK_LIMR/springcloud2021To2021.git">https://gitee.com/TK_LIMR/springcloud2021To2021.git</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207172321968.png"></p><h2 id="â… ã€DockerFile"><a href="#â… ã€DockerFile" class="headerlink" title="â… ã€DockerFile"></a>â… ã€DockerFile</h2><h3 id="ä¸€ã€æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€æ˜¯ä»€ä¹ˆ</h3><h4 id="1ã€å®˜ç½‘"><a href="#1ã€å®˜ç½‘" class="headerlink" title="1ã€å®˜ç½‘"></a>1ã€å®˜ç½‘</h4><p><a href="https://docs.docker.com/engine/reference/builder">https://docs.docker.com/engine/reference/builder</a></p><h4 id="2ã€æ¦‚è¿°"><a href="#2ã€æ¦‚è¿°" class="headerlink" title="2ã€æ¦‚è¿°"></a>2ã€æ¦‚è¿°</h4><p>Dockerfileæ˜¯ç”¨æ¥æ„å»ºDockeré•œåƒçš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ˜¯ç”±ä¸€æ¡æ¡æ„å»ºé•œåƒæ‰€éœ€çš„æŒ‡ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207071619187.png"></p><h4 id="3ã€æ­¥éª¤"><a href="#3ã€æ­¥éª¤" class="headerlink" title="3ã€æ­¥éª¤"></a>3ã€æ­¥éª¤</h4><ol><li>ç¼–å†™Dockerfileæ–‡ä»¶</li><li>docker buildå‘½ä»¤æ„å»ºé•œåƒ</li><li>docker runä¾é•œåƒè¿è¡Œå®¹å™¨å®ä¾‹</li></ol><h3 id="äºŒã€DockerFileæ„å»ºè¿‡ç¨‹è§£æ"><a href="#äºŒã€DockerFileæ„å»ºè¿‡ç¨‹è§£æ" class="headerlink" title="äºŒã€DockerFileæ„å»ºè¿‡ç¨‹è§£æ"></a>äºŒã€DockerFileæ„å»ºè¿‡ç¨‹è§£æ</h3><h4 id="1ã€Dockerfileå†…å®¹åŸºç¡€çŸ¥è¯†"><a href="#1ã€Dockerfileå†…å®¹åŸºç¡€çŸ¥è¯†" class="headerlink" title="1ã€Dockerfileå†…å®¹åŸºç¡€çŸ¥è¯†"></a>1ã€Dockerfileå†…å®¹åŸºç¡€çŸ¥è¯†</h4><ol><li>æ¯æ¡ä¿ç•™å­—æŒ‡ä»¤éƒ½å¿…é¡»ä¸ºå¤§å†™å­—æ¯ä¸”åé¢è¦è·Ÿéšè‡³å°‘ä¸€ä¸ªå‚æ•°</li><li>æŒ‡ä»¤æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹ï¼Œé¡ºåºæ‰§è¡Œ</li><li>#è¡¨ç¤ºæ³¨é‡Š</li><li>æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚å¹¶å¯¹é•œåƒè¿›è¡Œæäº¤</li></ol><h4 id="2ã€Dockeræ‰§è¡ŒDockerfileçš„å¤§è‡´æµç¨‹"><a href="#2ã€Dockeræ‰§è¡ŒDockerfileçš„å¤§è‡´æµç¨‹" class="headerlink" title="2ã€Dockeræ‰§è¡ŒDockerfileçš„å¤§è‡´æµç¨‹"></a>2ã€Dockeræ‰§è¡ŒDockerfileçš„å¤§è‡´æµç¨‹</h4><ol><li>dockerä»åŸºç¡€é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨</li><li>æ‰§è¡Œä¸€æ¡æŒ‡ä»¤å¹¶å¯¹å®¹å™¨ä½œå‡ºä¿®æ”¹</li><li>æ‰§è¡Œç±»ä¼¼docker commitçš„æ“ä½œæäº¤ä¸€ä¸ªæ–°çš„é•œåƒå±‚</li><li>dockerå†åŸºäºåˆšæäº¤çš„é•œåƒè¿è¡Œä¸€ä¸ªæ–°å®¹å™¨</li><li>æ‰§è¡Œdockerfileä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ç›´åˆ°æ‰€æœ‰æŒ‡ä»¤éƒ½æ‰§è¡Œå®Œæˆ</li></ol><h4 id="3ã€å°æ€»ç»“"><a href="#3ã€å°æ€»ç»“" class="headerlink" title="3ã€å°æ€»ç»“"></a>3ã€å°æ€»ç»“</h4><p>ä»åº”ç”¨è½¯ä»¶çš„è§’åº¦æ¥çœ‹ï¼ŒDockerfileã€Dockeré•œåƒä¸Dockerå®¹å™¨åˆ†åˆ«ä»£è¡¨è½¯ä»¶çš„ä¸‰ä¸ªä¸åŒé˜¶æ®µï¼Œ</p><ul><li>Dockerfileæ˜¯è½¯ä»¶çš„åŸææ–™</li><li>Dockeré•œåƒæ˜¯è½¯ä»¶çš„äº¤ä»˜å“</li><li>Dockerå®¹å™¨åˆ™å¯ä»¥è®¤ä¸ºæ˜¯è½¯ä»¶é•œåƒçš„è¿è¡Œæ€ï¼Œä¹Ÿå³ä¾ç…§é•œåƒè¿è¡Œçš„å®¹å™¨å®ä¾‹</li></ul><p>Dockerfileé¢å‘å¼€å‘ï¼ŒDockeré•œåƒæˆä¸ºäº¤ä»˜æ ‡å‡†ï¼ŒDockerå®¹å™¨åˆ™æ¶‰åŠéƒ¨ç½²ä¸è¿ç»´ï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ï¼ŒåˆåŠ›å……å½“Dockerä½“ç³»çš„åŸºçŸ³ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207072105501.png"></p><ol><li>Dockerfileï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªDockerfileï¼ŒDockerfileå®šä¹‰äº†è¿›ç¨‹éœ€è¦çš„ä¸€åˆ‡ä¸œè¥¿ã€‚Dockerfileæ¶‰åŠçš„å†…å®¹åŒ…æ‹¬æ‰§è¡Œä»£ç æˆ–è€…æ˜¯æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€ä¾èµ–åŒ…ã€è¿è¡Œæ—¶ç¯å¢ƒã€åŠ¨æ€é“¾æ¥åº“ã€æ“ä½œç³»ç»Ÿçš„å‘è¡Œç‰ˆã€æœåŠ¡è¿›ç¨‹å’Œå†…æ ¸è¿›ç¨‹(å½“åº”ç”¨è¿›ç¨‹éœ€è¦å’Œç³»ç»ŸæœåŠ¡å’Œå†…æ ¸è¿›ç¨‹æ‰“äº¤é“ï¼Œè¿™æ—¶éœ€è¦è€ƒè™‘å¦‚ä½•è®¾è®¡namespaceçš„æƒé™æ§åˆ¶)ç­‰ç­‰;</li><li>Dockeré•œåƒï¼Œåœ¨ç”¨Dockerfileå®šä¹‰ä¸€ä¸ªæ–‡ä»¶ä¹‹åï¼Œdocker buildæ—¶ä¼šäº§ç”Ÿä¸€ä¸ªDockeré•œåƒï¼Œå½“è¿è¡Œ Dockeré•œåƒæ—¶ä¼šçœŸæ­£å¼€å§‹æä¾›æœåŠ¡;</li><li>Dockerå®¹å™¨ï¼Œå®¹å™¨æ˜¯ç›´æ¥æä¾›æœåŠ¡çš„ã€‚</li></ol><h3 id="ä¸‰ã€DockerFileå¸¸ç”¨ä¿ç•™å­—æŒ‡ä»¤"><a href="#ä¸‰ã€DockerFileå¸¸ç”¨ä¿ç•™å­—æŒ‡ä»¤" class="headerlink" title="ä¸‰ã€DockerFileå¸¸ç”¨ä¿ç•™å­—æŒ‡ä»¤"></a>ä¸‰ã€DockerFileå¸¸ç”¨ä¿ç•™å­—æŒ‡ä»¤</h3><ul><li><p>FROMï¼šåŸºç¡€é•œåƒï¼Œå½“å‰æ–°é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„ï¼ŒæŒ‡å®šä¸€ä¸ªå·²ç»å­˜åœ¨çš„é•œåƒä½œä¸ºæ¨¡æ¿ï¼Œç¬¬ä¸€æ¡å¿…é¡»æ˜¯from</p></li><li><p>MAINTAINERï¼šé•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€</p></li><li><p>RUNï¼šå®¹å™¨æ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤ï¼ŒRUNæ˜¯åœ¨ docker buildæ—¶è¿è¡Œ</p><ul><li>shellæ ¼å¼ï¼š<code>RUN yum -y install vim</code></li><li>execæ ¼å¼ï¼š</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207072127945.png"></p></li><li><p>EXPOSEï¼šå½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£</p></li><li><p>WORKDIRï¼šæŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»é™†çš„è¿›æ¥å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹</p></li><li><p>USERï¼šæŒ‡å®šè¯¥é•œåƒä»¥ä»€ä¹ˆæ ·çš„ç”¨æˆ·å»æ‰§è¡Œï¼Œå¦‚æœéƒ½ä¸æŒ‡å®šï¼Œé»˜è®¤æ˜¯root</p></li><li><p>ENVï¼šç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡</p><ul><li>ENV MY_PATH /usr/mytest</li><li>è¿™ä¸ªç¯å¢ƒå˜é‡å¯ä»¥åœ¨åç»­çš„ä»»ä½•RUNæŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œè¿™å°±å¦‚åŒåœ¨å‘½ä»¤å‰é¢æŒ‡å®šäº†ç¯å¢ƒå˜é‡å‰ç¼€ä¸€æ ·ï¼›<br>ä¹Ÿå¯ä»¥åœ¨å…¶å®ƒæŒ‡ä»¤ä¸­ç›´æ¥ä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡</li><li>æ¯”å¦‚ï¼šWORKDIR $MY_PATH</li></ul></li><li><p>ADDï¼šå°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹tarå‹ç¼©åŒ…</p></li><li><p>COPYï¼šç±»ä¼¼ADDï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­ã€‚å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ &lt;æºè·¯å¾„&gt; çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„ &lt;ç›®æ ‡è·¯å¾„&gt; ä½ç½®</p><ul><li>COPY src dest</li><li>COPY [â€œsrcâ€, â€œdestâ€]</li><li>&lt;srcæºè·¯å¾„&gt;ï¼šæºæ–‡ä»¶æˆ–è€…æºç›®å½•</li><li>&lt;destç›®æ ‡è·¯å¾„&gt;ï¼šå®¹å™¨å†…çš„æŒ‡å®šè·¯å¾„ï¼Œè¯¥è·¯å¾„ä¸ç”¨äº‹å…ˆå»ºå¥½ï¼Œè·¯å¾„ä¸å­˜åœ¨çš„è¯ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚</li></ul></li><li><p>VOLUMEï¼šå®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œ</p></li><li><p>CMDï¼šæŒ‡å®šå®¹å™¨å¯åŠ¨åçš„è¦å¹²çš„äº‹æƒ…</p><ul><li>æ³¨æ„ï¼š<ul><li>Dockerfile ä¸­å¯ä»¥æœ‰å¤šä¸ª CMD æŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMD ä¼šè¢« docker run ä¹‹åçš„å‚æ•°æ›¿æ¢</li><li><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207072139655.png"></li></ul></li><li>å®ƒå’Œå‰é¢RUNå‘½ä»¤çš„åŒºåˆ«<ul><li>CMDæ˜¯åœ¨docker run æ—¶è¿è¡Œã€‚</li><li>RUNæ˜¯åœ¨ docker buildæ—¶è¿è¡Œã€‚</li></ul></li></ul></li><li><p>ENTRYPOINTï¼šä¹Ÿæ˜¯ç”¨æ¥æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤</p><ul><li>ç±»ä¼¼äº CMD æŒ‡ä»¤ï¼Œä½†æ˜¯ENTRYPOINTä¸ä¼šè¢«docker runåé¢çš„å‘½ä»¤è¦†ç›–ï¼Œ<br>è€Œä¸”è¿™äº›å‘½ä»¤è¡Œå‚æ•°ä¼šè¢«å½“ä½œå‚æ•°é€ç»™ ENTRYPOINT æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åº</li></ul></li></ul><p>å°æ€»ç»“</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207072142349.png"></p><h3 id="å››ã€æ¡ˆä¾‹"><a href="#å››ã€æ¡ˆä¾‹" class="headerlink" title="å››ã€æ¡ˆä¾‹"></a>å››ã€æ¡ˆä¾‹</h3><h4 id="1ã€è‡ªå®šä¹‰é•œåƒmyCentosJava8"><a href="#1ã€è‡ªå®šä¹‰é•œåƒmyCentosJava8" class="headerlink" title="1ã€è‡ªå®šä¹‰é•œåƒmyCentosJava8"></a>1ã€è‡ªå®šä¹‰é•œåƒmyCentosJava8</h4><h5 id="1ã€è¦æ±‚"><a href="#1ã€è¦æ±‚" class="headerlink" title="1ã€è¦æ±‚"></a>1ã€è¦æ±‚</h5><p>Centos7é•œåƒå…·å¤‡vim+ifconfig+jdk8</p><p><strong>å‡†å¤‡ï¼šJDK8ä¸‹è½½ä½ç½®</strong></p><p><a href="https://mirrors.yangxingzhen.com/jdk/">https://mirrors.yangxingzhen.com/jdk/</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112143176.png"></p><h5 id="2ã€ç¼–å†™"><a href="#2ã€ç¼–å†™" class="headerlink" title="2ã€ç¼–å†™"></a>2ã€ç¼–å†™</h5><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile"><span class="token keyword">FROM</span> centos<span class="token punctuation">:</span>7<span class="token keyword">MAINTAINER</span> jack&lt;mykkto.cn<span class="token punctuation">&gt;</span> <span class="token keyword">ENV</span> MYPATH /usr/local<span class="token keyword">WORKDIR</span> $MYPATH <span class="token comment">#å®‰è£…vimç¼–è¾‘å™¨</span><span class="token keyword">RUN</span> yum <span class="token punctuation">-</span>y install vim<span class="token comment">#å®‰è£…ifconfigå‘½ä»¤æŸ¥çœ‹ç½‘ç»œIP</span><span class="token keyword">RUN</span> yum <span class="token punctuation">-</span>y install net<span class="token punctuation">-</span>tools<span class="token comment">#å®‰è£…java8åŠlibåº“</span><span class="token keyword">RUN</span> yum <span class="token punctuation">-</span>y install glibc.i686<span class="token keyword">RUN</span> mkdir /usr/local/java<span class="token comment">#ADD æ˜¯ç›¸å¯¹è·¯å¾„jar,æŠŠjdk-8u171-linux-x64.tar.gzæ·»åŠ åˆ°å®¹å™¨ä¸­,å®‰è£…åŒ…å¿…é¡»è¦å’ŒDockerfileæ–‡ä»¶åœ¨åŒä¸€ä½ç½®</span><span class="token keyword">ADD</span> jdk<span class="token punctuation">-</span>8u171<span class="token punctuation">-</span>linux<span class="token punctuation">-</span>x64.tar.gz /usr/local/java/<span class="token comment">#é…ç½®javaç¯å¢ƒå˜é‡</span><span class="token keyword">ENV</span> JAVA_HOME /usr/local/java/jdk1.8.0_171<span class="token keyword">ENV</span> JRE_HOME $JAVA_HOME/jre<span class="token keyword">ENV</span> CLASSPATH $JAVA_HOME/lib/dt.jar<span class="token punctuation">:</span>$JAVA_HOME/lib/tools.jar<span class="token punctuation">:</span>$JRE_HOME/lib<span class="token punctuation">:</span>$CLASSPATH<span class="token keyword">ENV</span> PATH $JAVA_HOME/bin<span class="token punctuation">:</span>$PATH <span class="token keyword">EXPOSE</span> 80 <span class="token keyword">CMD</span> echo $MYPATH<span class="token keyword">CMD</span> echo <span class="token string">"success--------------ok"</span><span class="token keyword">CMD</span> /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€æ„å»º"><a href="#3ã€æ„å»º" class="headerlink" title="3ã€æ„å»º"></a>3ã€æ„å»º</h5><p>docker build -t æ–°é•œåƒåå­—:TAG </p><p><code>docker build -t centosjava8:1.5 .</code></p><p><font color="red">æ³¨æ„ï¼šä¸Šé¢TAGåé¢æœ‰ä¸ªç©ºæ ¼ï¼Œæœ‰ä¸ªç‚¹</font></p><p>å‘½ä»¤ï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112154614.png"></p><p>æˆåŠŸï¼š<img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112154465.png"></p><h5 id="4ã€è¿è¡Œ"><a href="#4ã€è¿è¡Œ" class="headerlink" title="4ã€è¿è¡Œ"></a>4ã€è¿è¡Œ</h5><p><code>docker run -it æ–°é•œåƒåå­—:TAG </code></p><p><code>docker run -it centosjava8:1.5 /bin/bash</code></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112157315.png"></p><h5 id="5ã€æ€»ç»“"><a href="#5ã€æ€»ç»“" class="headerlink" title="5ã€æ€»ç»“"></a>5ã€æ€»ç»“</h5><p>UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼šUnionæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹(unite several directories into a single virtual filesystem)ã€‚Union æ–‡ä»¶ç³»ç»Ÿæ˜¯ Docker é•œåƒçš„åŸºç¡€ã€‚é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿ï¼ŒåŸºäºåŸºç¡€é•œåƒï¼ˆæ²¡æœ‰çˆ¶é•œåƒï¼‰ï¼Œå¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒã€‚</p><p>ç‰¹æ€§ï¼šä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½•</p><h4 id="2ã€è™šæ‚¬é•œåƒ"><a href="#2ã€è™šæ‚¬é•œåƒ" class="headerlink" title="2ã€è™šæ‚¬é•œåƒ"></a>2ã€è™šæ‚¬é•œåƒ</h4><h5 id="1ã€æ˜¯ä»€ä¹ˆ"><a href="#1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h5><p>ä»“åº“åã€æ ‡ç­¾éƒ½æ˜¯<none>çš„é•œåƒï¼Œä¿—ç§°dangling image</none></p><p>å†™ä¸€ä¸ª</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112209211.png"></p><h5 id="2ã€æŸ¥çœ‹"><a href="#2ã€æŸ¥çœ‹" class="headerlink" title="2ã€æŸ¥çœ‹"></a>2ã€æŸ¥çœ‹</h5><p><code>docker image ls -f dangling=true</code></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112211864.png"></p><h5 id="3ã€åˆ é™¤"><a href="#3ã€åˆ é™¤" class="headerlink" title="3ã€åˆ é™¤"></a>3ã€åˆ é™¤</h5><p><code>docker image prune</code></p><p>è™šæ‚¬é•œåƒå·²ç»å¤±å»å­˜åœ¨ä»·å€¼ï¼Œå¯ä»¥åˆ </p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112220390.png"></p><h3 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112222733.png"></p><h2 id="â…¡ã€Docker-ç½‘ç»œ"><a href="#â…¡ã€Docker-ç½‘ç»œ" class="headerlink" title="â…¡ã€Docker ç½‘ç»œ"></a>â…¡ã€Docker ç½‘ç»œ</h2><h3 id="ä¸€ã€æ˜¯ä»€ä¹ˆ-1"><a href="#ä¸€ã€æ˜¯ä»€ä¹ˆ-1" class="headerlink" title="ä¸€ã€æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€æ˜¯ä»€ä¹ˆ</h3><h4 id="1ã€é»˜è®¤"><a href="#1ã€é»˜è®¤" class="headerlink" title="1ã€é»˜è®¤"></a>1ã€é»˜è®¤</h4><p><strong>dockerä¸å¯åŠ¨ï¼Œé»˜è®¤ç½‘ç»œæƒ…å†µ</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112239583.png"></p><h4 id="2ã€å¯åŠ¨"><a href="#2ã€å¯åŠ¨" class="headerlink" title="2ã€å¯åŠ¨"></a>2ã€å¯åŠ¨</h4><p><strong>dockerå¯åŠ¨åï¼Œç½‘ç»œæƒ…å†µ</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112238959.png"></p><h3 id="äºŒã€å‘½ä»¤"><a href="#äºŒã€å‘½ä»¤" class="headerlink" title="äºŒã€å‘½ä»¤"></a>äºŒã€å‘½ä»¤</h3><h5 id="1ã€Allå‘½ä»¤"><a href="#1ã€Allå‘½ä»¤" class="headerlink" title="1ã€Allå‘½ä»¤"></a>1ã€Allå‘½ä»¤</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112247058.png"></p><h5 id="2ã€ä¸»æŸ¥çœ‹ç½‘ç»œ"><a href="#2ã€ä¸»æŸ¥çœ‹ç½‘ç»œ" class="headerlink" title="2ã€ä¸»æŸ¥çœ‹ç½‘ç»œ"></a>2ã€ä¸»æŸ¥çœ‹ç½‘ç»œ</h5><p><code>docker network ls</code></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112247338.png"></p><h5 id="3ã€æŸ¥çœ‹ç½‘ç»œæºæ•°æ®"><a href="#3ã€æŸ¥çœ‹ç½‘ç»œæºæ•°æ®" class="headerlink" title="3ã€æŸ¥çœ‹ç½‘ç»œæºæ•°æ®"></a>3ã€æŸ¥çœ‹ç½‘ç»œæºæ•°æ®</h5><p>docker network inspect  XXXç½‘ç»œåå­—</p><h5 id="4ã€åˆ é™¤ç½‘ç»œ"><a href="#4ã€åˆ é™¤ç½‘ç»œ" class="headerlink" title="4ã€åˆ é™¤ç½‘ç»œ"></a>4ã€åˆ é™¤ç½‘ç»œ</h5><p>docker network rm XXXç½‘ç»œåå­—</p><h5 id="5ã€æ¡ˆä¾‹"><a href="#5ã€æ¡ˆä¾‹" class="headerlink" title="5ã€æ¡ˆä¾‹"></a>5ã€æ¡ˆä¾‹</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207112250806.png"></p><h3 id="ä¸‰ã€èƒ½å¹²å˜›"><a href="#ä¸‰ã€èƒ½å¹²å˜›" class="headerlink" title="ä¸‰ã€èƒ½å¹²å˜›"></a>ä¸‰ã€èƒ½å¹²å˜›</h3><ul><li>å®¹å™¨é—´çš„äº’è”å’Œé€šä¿¡ä»¥åŠç«¯å£æ˜ å°„</li><li>å®¹å™¨IPå˜åŠ¨æ—¶å€™å¯ä»¥é€šè¿‡æœåŠ¡åç›´æ¥ç½‘ç»œé€šä¿¡è€Œä¸å—åˆ°å½±å“</li></ul><h3 id="å››ã€ç½‘ç»œæ¨¡å¼"><a href="#å››ã€ç½‘ç»œæ¨¡å¼" class="headerlink" title="å››ã€ç½‘ç»œæ¨¡å¼"></a>å››ã€ç½‘ç»œæ¨¡å¼</h3><h4 id="1ã€åˆ—è¡¨"><a href="#1ã€åˆ—è¡¨" class="headerlink" title="1ã€åˆ—è¡¨"></a>1ã€åˆ—è¡¨</h4><h5 id="1ã€æ˜¯ä»€ä¹ˆ-1"><a href="#1ã€æ˜¯ä»€ä¹ˆ-1" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h5><ul><li>bridgeæ¨¡å¼ï¼šä½¿ç”¨â€“network  bridgeæŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨docker0</li><li>hostæ¨¡å¼ï¼šä½¿ç”¨â€“network hostæŒ‡å®š</li><li>noneæ¨¡å¼ï¼šä½¿ç”¨â€“network noneæŒ‡å®š</li><li>containeræ¨¡å¼ï¼šä½¿ç”¨â€“network container:NAMEæˆ–è€…å®¹å™¨IDæŒ‡å®š</li></ul><h4 id="2ã€è§„åˆ™"><a href="#2ã€è§„åˆ™" class="headerlink" title="2ã€è§„åˆ™"></a>2ã€è§„åˆ™</h4><p>dockerå®¹å™¨å†…éƒ¨çš„ipæ˜¯æœ‰å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜çš„</p><p><strong>è¯´æ˜</strong></p><p>1ã€å¯åŠ¨ä¸¤ä¸ªå®¹å™¨è¯´æ˜</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207122237578.png"></p><p>2ã€docker inspect å®¹å™¨ID or å®¹å™¨åå­—</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207122240639.png"></p><h4 id="3ã€æ¡ˆä¾‹ï¼š"><a href="#3ã€æ¡ˆä¾‹ï¼š" class="headerlink" title="3ã€æ¡ˆä¾‹ï¼š"></a>3ã€æ¡ˆä¾‹ï¼š</h4><h4 id="3-1ã€bridge"><a href="#3-1ã€bridge" class="headerlink" title="3-1ã€bridge"></a>3-1ã€bridge</h4><h5 id="1ã€æ˜¯ä»€ä¹ˆ-2"><a href="#1ã€æ˜¯ä»€ä¹ˆ-2" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h5><p>Docker æœåŠ¡é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª docker0 ç½‘æ¡¥ï¼ˆå…¶ä¸Šæœ‰ä¸€ä¸ª docker0 å†…éƒ¨æ¥å£ï¼‰ï¼Œè¯¥æ¡¥æ¥ç½‘ç»œçš„åç§°ä¸ºdocker0ï¼Œå®ƒåœ¨<font color="red">å†…æ ¸å±‚</font>è¿é€šäº†å…¶ä»–çš„ç‰©ç†æˆ–è™šæ‹Ÿç½‘å¡ï¼Œè¿™å°±å°†æ‰€æœ‰å®¹å™¨å’Œæœ¬åœ°ä¸»æœºéƒ½æ”¾åˆ°<font color="red">åŒä¸€ä¸ªç‰©ç†ç½‘ç»œ</font>ã€‚Docker é»˜è®¤æŒ‡å®šäº† docker0 æ¥å£ çš„ IP åœ°å€å’Œå­ç½‘æ©ç ï¼Œ<font color="red">è®©ä¸»æœºå’Œå®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ç½‘æ¡¥ç›¸äº’é€šä¿¡</font>ã€‚</p><p>#æŸ¥çœ‹ bridge ç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ grep è·å–åç§°é¡¹</p><p><code>docker network inspect bridge | grep name</code></p><p><code>ifconfig | grep docker </code></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207122244593.png"></p><h5 id="2ã€æ¡ˆä¾‹"><a href="#2ã€æ¡ˆä¾‹" class="headerlink" title="2ã€æ¡ˆä¾‹"></a>2ã€æ¡ˆä¾‹</h5><p>(1ï¼‰è¯´æ˜ï¼š</p><ul><li>Dockerä½¿ç”¨Linuxæ¡¥æ¥ï¼Œåœ¨å®¿ä¸»æœºè™šæ‹Ÿä¸€ä¸ªDockerå®¹å™¨ç½‘æ¡¥(docker0)ï¼ŒDockerå¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶ä¼šæ ¹æ®Dockerç½‘æ¡¥çš„ç½‘æ®µåˆ†é…ç»™å®¹å™¨ä¸€ä¸ªIPåœ°å€ï¼Œç§°ä¸ºContainer-IPï¼ŒåŒæ—¶Dockerç½‘æ¡¥æ˜¯æ¯ä¸ªå®¹å™¨çš„é»˜è®¤ç½‘å…³ã€‚å› ä¸ºåœ¨åŒä¸€å®¿ä¸»æœºå†…çš„å®¹å™¨éƒ½æ¥å…¥åŒä¸€ä¸ªç½‘æ¡¥ï¼Œè¿™æ ·å®¹å™¨ä¹‹é—´å°±èƒ½å¤Ÿé€šè¿‡å®¹å™¨çš„Container-IPç›´æ¥é€šä¿¡ã€‚</li><li>docker run çš„æ—¶å€™ï¼Œæ²¡æœ‰æŒ‡å®šnetworkçš„è¯é»˜è®¤ä½¿ç”¨çš„ç½‘æ¡¥æ¨¡å¼å°±æ˜¯bridgeï¼Œä½¿ç”¨çš„å°±æ˜¯docker0ã€‚åœ¨å®¿ä¸»æœºifconfig,å°±å¯ä»¥çœ‹åˆ°docker0å’Œè‡ªå·±createçš„network(åé¢è®²)eth0ï¼Œeth1ï¼Œeth2â€¦â€¦ä»£è¡¨ç½‘å¡ä¸€ï¼Œç½‘å¡äºŒï¼Œç½‘å¡ä¸‰â€¦â€¦ï¼Œloä»£è¡¨127.0.0.1ï¼Œå³localhostï¼Œinet addrç”¨æ¥è¡¨ç¤ºç½‘å¡çš„IPåœ°å€</li><li>ç½‘æ¡¥docker0åˆ›å»ºä¸€å¯¹å¯¹ç­‰è™šæ‹Ÿè®¾å¤‡æ¥å£ä¸€ä¸ªå«vethï¼Œå¦ä¸€ä¸ªå«eth0ï¼Œæˆå¯¹åŒ¹é…ã€‚<br>   3.1 æ•´ä¸ªå®¿ä¸»æœºçš„ç½‘æ¡¥æ¨¡å¼éƒ½æ˜¯docker0ï¼Œç±»ä¼¼ä¸€ä¸ªäº¤æ¢æœºæœ‰ä¸€å †æ¥å£ï¼Œæ¯ä¸ªæ¥å£å«vethï¼Œåœ¨æœ¬åœ°ä¸»æœºå’Œå®¹å™¨å†…åˆ†åˆ«åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ¥å£ï¼Œå¹¶è®©ä»–ä»¬å½¼æ­¤è”é€šï¼ˆè¿™æ ·ä¸€å¯¹æ¥å£å«veth pairï¼‰ï¼›<br>   3.2 æ¯ä¸ªå®¹å™¨å®ä¾‹å†…éƒ¨ä¹Ÿæœ‰ä¸€å—ç½‘å¡ï¼Œæ¯ä¸ªæ¥å£å«eth0ï¼›<br>   3.3 docker0ä¸Šé¢çš„æ¯ä¸ªvethåŒ¹é…æŸä¸ªå®¹å™¨å®ä¾‹å†…éƒ¨çš„eth0ï¼Œä¸¤ä¸¤é…å¯¹ï¼Œä¸€ä¸€åŒ¹é…ã€‚<br> é€šè¿‡ä¸Šè¿°ï¼Œå°†å®¿ä¸»æœºä¸Šçš„æ‰€æœ‰å®¹å™¨éƒ½è¿æ¥åˆ°è¿™ä¸ªå†…éƒ¨ç½‘ç»œä¸Šï¼Œä¸¤ä¸ªå®¹å™¨åœ¨åŒä¸€ä¸ªç½‘ç»œä¸‹,ä¼šä»è¿™ä¸ªç½‘å…³ä¸‹å„è‡ªæ‹¿åˆ°åˆ†é…çš„ipï¼Œæ­¤æ—¶ä¸¤ä¸ªå®¹å™¨çš„ç½‘ç»œæ˜¯äº’é€šçš„ã€‚</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207122248655.png"></p><p>(2ï¼‰å‘½ä»¤ï¼š</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 8081<span class="token punctuation">:</span>8080   <span class="token punctuation">-</span><span class="token punctuation">-</span>name tomcat81 billygoo/tomcat8<span class="token punctuation">-</span>jdk8docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 8082<span class="token punctuation">:</span>8080   <span class="token punctuation">-</span><span class="token punctuation">-</span>name tomcat82 billygoo/tomcat8<span class="token punctuation">-</span>jdk8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>(3ï¼‰éªŒè¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@VM-0-13-centos ~<span class="token punctuation">]</span><span class="token comment"># ip addr| tail -n 8</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> <img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207132212867.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207132216184.png"></p><h4 id="3-2ã€"><a href="#3-2ã€" class="headerlink" title="3-2ã€"></a>3-2ã€</h4><h5 id="1ã€æ˜¯ä»€ä¹ˆ-3"><a href="#1ã€æ˜¯ä»€ä¹ˆ-3" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h5><p><strong>ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ IP åœ°å€ä¸å¤–ç•Œè¿›è¡Œé€šä¿¡ï¼Œä¸å†éœ€è¦é¢å¤–è¿›è¡ŒNAT è½¬æ¢ã€‚</strong></p><h5 id="2ã€æ¡ˆä¾‹-1"><a href="#2ã€æ¡ˆä¾‹-1" class="headerlink" title="2ã€æ¡ˆä¾‹"></a>2ã€æ¡ˆä¾‹</h5><p>(1)è¯´æ˜</p><p>å®¹å™¨å°†<font color="red">ä¸ä¼šè·å¾—</font>ä¸€ä¸ªç‹¬ç«‹çš„Network Namespaceï¼Œ è€Œæ˜¯å’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ªNetwork Namespaceã€‚<font color="red">å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡è€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£ã€‚</font></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207132223740.png"></p><p>ï¼ˆ2ï¼‰å‘½ä»¤</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d     <span class="token punctuation">-</span><span class="token punctuation">-</span>network host <span class="token punctuation">-</span><span class="token punctuation">-</span>name tomcat83 billygoo/tomcat8<span class="token punctuation">-</span>jdk8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>(3)æ— ä¹‹å‰çš„é…å¯¹æ˜¾ç¤ºäº†ï¼Œçœ‹å®¹å™¨å®ä¾‹å†…éƒ¨</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207132241253.png"></p><p>(4)æ²¡æœ‰è®¾ç½®-pçš„ç«¯å£æ˜ å°„äº†ï¼Œå¦‚ä½•è®¿é—®å¯åŠ¨çš„tomcat83 ?</p><p>å°±æ˜¯é»˜è®¤ç«¯å£ï¼Œhttp://å®¿ä¸»æœºIP:8080/</p><p>æ¯”å¦‚ï¼štomcat æ˜¯ 8080ï¼Œnginx æ˜¯ 80 ï¼Œmysql æ˜¯3306</p><h4 id="3-3ã€none"><a href="#3-3ã€none" class="headerlink" title="3-3ã€none"></a>3-3ã€none</h4><h5 id="1ã€æ˜¯ä»€ä¹ˆ-4"><a href="#1ã€æ˜¯ä»€ä¹ˆ-4" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h5><p>ç¦ç”¨ç½‘ç»œåŠŸèƒ½ï¼Œåªæœ‰loæ ‡è¯†(å°±æ˜¯127.0.0.1è¡¨ç¤ºæœ¬åœ°å›ç¯)</p><h5 id="2ã€æ¡ˆä¾‹-2"><a href="#2ã€æ¡ˆä¾‹-2" class="headerlink" title="2ã€æ¡ˆä¾‹"></a>2ã€æ¡ˆä¾‹</h5><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 8084<span class="token punctuation">:</span>8080 <span class="token punctuation">-</span><span class="token punctuation">-</span>network none <span class="token punctuation">-</span><span class="token punctuation">-</span>name tomcat84 billygoo/tomcat8<span class="token punctuation">-</span>jdk8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207132256020.png"></p><h4 id="3-4ã€container"><a href="#3-4ã€container" class="headerlink" title="3-4ã€container"></a>3-4ã€container</h4><h5 id="1ã€æ˜¯ä»€ä¹ˆ-5"><a href="#1ã€æ˜¯ä»€ä¹ˆ-5" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h5><p>æ–°å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªç½‘ç»œipé…ç½®è€Œä¸æ˜¯å’Œå®¿ä¸»æœºå…±äº«ã€‚æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„IPï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº«IPã€ç«¯å£èŒƒå›´ç­‰ã€‚åŒæ ·ï¼Œä¸¤ä¸ªå®¹å™¨é™¤äº†ç½‘ç»œæ–¹é¢ï¼Œå…¶ä»–çš„å¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯éš”ç¦»çš„ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207132257038.png"></p><h5 id="2ã€æ¡ˆä¾‹-3"><a href="#2ã€æ¡ˆä¾‹-3" class="headerlink" title="2ã€æ¡ˆä¾‹"></a>2ã€æ¡ˆä¾‹</h5><p>Alpine Linux æ˜¯ä¸€æ¬¾ç‹¬ç«‹çš„ã€éå•†ä¸šçš„é€šç”¨ Linux å‘è¡Œç‰ˆï¼Œä¸“ä¸ºè¿½æ±‚å®‰å…¨æ€§ã€ç®€å•æ€§å’Œèµ„æºæ•ˆç‡çš„ç”¨æˆ·è€Œè®¾è®¡ã€‚ å¯èƒ½å¾ˆå¤šäººæ²¡å¬è¯´è¿‡è¿™ä¸ª Linux å‘è¡Œç‰ˆæœ¬ï¼Œä½†æ˜¯ç»å¸¸ç”¨ Docker çš„æœ‹å‹å¯èƒ½éƒ½ç”¨è¿‡ï¼Œå› ä¸ºä»–å°ï¼Œç®€å•ï¼Œå®‰å…¨è€Œè‘—ç§°ï¼Œæ‰€ä»¥ä½œä¸ºåŸºç¡€é•œåƒæ˜¯éå¸¸å¥½çš„ä¸€ä¸ªé€‰æ‹©ï¼Œå¯è°“æ˜¯éº»é›€è™½å°ä½†äº”è„ä¿±å…¨ï¼Œé•œåƒéå¸¸å°å·§ï¼Œä¸åˆ° 6Mçš„å¤§å°ï¼Œæ‰€ä»¥ç‰¹åˆ«é€‚åˆå®¹å™¨æ‰“åŒ…ã€‚</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>it       <span class="token punctuation">-</span>d                              <span class="token punctuation">-</span><span class="token punctuation">-</span>name alpine1  alpine /bin/shdocker run <span class="token punctuation">-</span>it  <span class="token punctuation">-</span>d <span class="token punctuation">-</span><span class="token punctuation">-</span>network container<span class="token punctuation">:</span>alpine1 <span class="token punctuation">-</span><span class="token punctuation">-</span>name alpine2  alpine /bin/sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207161032214.png"></p><p><strong>å…³é—­alpine1ï¼Œå†çœ‹çœ‹alpine2</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207161039429.png"></p><h4 id="3-5ã€â˜…-è‡ªå®šä¹‰ç½‘ç»œ"><a href="#3-5ã€â˜…-è‡ªå®šä¹‰ç½‘ç»œ" class="headerlink" title="3-5ã€â˜… è‡ªå®šä¹‰ç½‘ç»œ"></a>3-5ã€â˜… è‡ªå®šä¹‰ç½‘ç»œ</h4><h5 id="1ã€æ˜¯ä»€ä¹ˆ-6"><a href="#1ã€æ˜¯ä»€ä¹ˆ-6" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h5><p>å­—é¢æ„æ€ï¼Œè‡ªå®šä¹‰çš„ç½‘ç»œ</p><h5 id="2ã€æ¡ˆä¾‹-4"><a href="#2ã€æ¡ˆä¾‹-4" class="headerlink" title="2ã€æ¡ˆä¾‹"></a>2ã€æ¡ˆä¾‹</h5><p><strong>ä¸€ç±»ï¼šbefore</strong></p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 8081<span class="token punctuation">:</span>8080   <span class="token punctuation">-</span><span class="token punctuation">-</span>name tomcat81 billygoo/tomcat8<span class="token punctuation">-</span>jdk8docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 8082<span class="token punctuation">:</span>8080   <span class="token punctuation">-</span><span class="token punctuation">-</span>name tomcat82 billygoo/tomcat8<span class="token punctuation">-</span>jdk8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸Šè¿°æˆåŠŸå¯åŠ¨å¹¶ç”¨docker execè¿›å…¥å„è‡ªå®¹å™¨å®ä¾‹å†…éƒ¨</p><p><strong>å­˜åœ¨çš„é—®é¢˜ï¼š</strong>å¯ä»¥æŒ‰ç…§IP ping é€šï¼Œä½†æ˜¯æ— æ³•ç”¨æœåŠ¡å ping é€š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207161129303.png"></p><p><strong>äºŒç±»ï¼šafter</strong></p><p>1ã€æ–°å»ºæ¡¥æ¥ç½‘ç»œ</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker network create jack_network<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2ã€æ–°å»ºå®¹å™¨åŠ å…¥ä¸Šä¸€æ­¥æ–°å»ºçš„è‡ªå®šä¹‰ç½‘ç»œ</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 8081<span class="token punctuation">:</span>8080 <span class="token punctuation">-</span><span class="token punctuation">-</span>network jack_network  <span class="token punctuation">-</span><span class="token punctuation">-</span>name tomcat81 billygoo/tomcat8<span class="token punctuation">-</span>jdk8docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 8082<span class="token punctuation">:</span>8080 <span class="token punctuation">-</span><span class="token punctuation">-</span>network jack_network  <span class="token punctuation">-</span><span class="token punctuation">-</span>name tomcat82 billygoo/tomcat8<span class="token punctuation">-</span>jdk8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>3ã€æµ‹è¯•äº’ ping</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207161722508.png"></p><p><strong>4ã€ç»“è®º</strong></p><ul><li><font color="red">è‡ªå®šä¹‰ç½‘ç»œæœ¬èº«å°±ç»´æŠ¤å¥½äº†ä¸»æœºåå’Œipçš„å¯¹åº”å…³ç³»ï¼ˆipå’ŒåŸŸåéƒ½èƒ½é€šï¼‰</font></li></ul><h3 id="äº”ã€Dockeræ¶æ„å›¾è§£"><a href="#äº”ã€Dockeræ¶æ„å›¾è§£" class="headerlink" title="äº”ã€Dockeræ¶æ„å›¾è§£"></a>äº”ã€Dockeræ¶æ„å›¾è§£</h3><h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>ä»å…¶æ¶æ„å’Œè¿è¡Œæµç¨‹æ¥çœ‹ï¼ŒDocker æ˜¯ä¸€ä¸ª C/S æ¨¡å¼çš„æ¶æ„ï¼Œåç«¯æ˜¯ä¸€ä¸ªæ¾è€¦åˆæ¶æ„ï¼Œä¼—å¤šæ¨¡å—å„å¸å…¶èŒã€‚ </p><p>Docker è¿è¡Œçš„åŸºæœ¬æµç¨‹ä¸ºï¼š</p><p>1 ç”¨æˆ·æ˜¯ä½¿ç”¨ Docker Client ä¸ Docker Daemon å»ºç«‹é€šä¿¡ï¼Œå¹¶å‘é€è¯·æ±‚ç»™åè€…ã€‚<br>2 Docker Daemon ä½œä¸º Docker æ¶æ„ä¸­çš„ä¸»ä½“éƒ¨åˆ†ï¼Œé¦–å…ˆæä¾› Docker Server çš„åŠŸèƒ½ä½¿å…¶å¯ä»¥æ¥å— Docker Client çš„è¯·æ±‚ã€‚<br>3 Docker Engine æ‰§è¡Œ Docker å†…éƒ¨çš„ä¸€ç³»åˆ—å·¥ä½œï¼Œæ¯ä¸€é¡¹å·¥ä½œéƒ½æ˜¯ä»¥ä¸€ä¸ª Job çš„å½¢å¼çš„å­˜åœ¨ã€‚<br>4 Job çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦å®¹å™¨é•œåƒæ—¶ï¼Œåˆ™ä» Docker Registry ä¸­ä¸‹è½½é•œåƒï¼Œå¹¶é€šè¿‡é•œåƒç®¡ç†é©±åŠ¨ Graph driverå°†ä¸‹è½½é•œåƒä»¥Graphçš„å½¢å¼å­˜å‚¨ã€‚<br>5 å½“éœ€è¦ä¸º Docker åˆ›å»ºç½‘ç»œç¯å¢ƒæ—¶ï¼Œé€šè¿‡ç½‘ç»œç®¡ç†é©±åŠ¨ Network driver åˆ›å»ºå¹¶é…ç½® Docker å®¹å™¨ç½‘ç»œç¯å¢ƒã€‚<br>6 å½“éœ€è¦é™åˆ¶ Docker å®¹å™¨è¿è¡Œèµ„æºæˆ–æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤ç­‰æ“ä½œæ—¶ï¼Œåˆ™é€šè¿‡ Execdriver æ¥å®Œæˆã€‚<br>7 Libcontaineræ˜¯ä¸€é¡¹ç‹¬ç«‹çš„å®¹å™¨ç®¡ç†åŒ…ï¼ŒNetwork driverä»¥åŠExec driveréƒ½æ˜¯é€šè¿‡Libcontaineræ¥å®ç°å…·ä½“å¯¹å®¹å™¨è¿›è¡Œçš„æ“ä½œã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207161729655.png"></p><h2 id="â…¢ã€Dockerå¾®æœåŠ¡å®æˆ˜"><a href="#â…¢ã€Dockerå¾®æœåŠ¡å®æˆ˜" class="headerlink" title="â…¢ã€Dockerå¾®æœåŠ¡å®æˆ˜"></a>â…¢ã€Dockerå¾®æœåŠ¡å®æˆ˜</h2><h3 id="ä¸€ã€åˆ›å»ºä¸€ä¸ªæ™®é€šæ¨¡å—"><a href="#ä¸€ã€åˆ›å»ºä¸€ä¸ªæ™®é€šæ¨¡å—" class="headerlink" title="ä¸€ã€åˆ›å»ºä¸€ä¸ªæ™®é€šæ¨¡å—"></a>ä¸€ã€åˆ›å»ºä¸€ä¸ªæ™®é€šæ¨¡å—</h3><h4 id="1ã€å»ºmodel"><a href="#1ã€å»ºmodel" class="headerlink" title="1ã€å»ºmodel"></a>1ã€å»ºmodel</h4><p>docker_boot</p><h4 id="2ã€æ”¹pom"><a href="#2ã€æ”¹pom" class="headerlink" title="2ã€æ”¹pom"></a>2ã€æ”¹pom</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>docker_boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>junit.version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>junit.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log4j.version</span><span class="token punctuation">&gt;</span></span>1.2.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log4j.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lombok.version</span><span class="token punctuation">&gt;</span></span>1.16.18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lombok.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mysql.version</span><span class="token punctuation">&gt;</span></span>5.1.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mysql.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>druid.version</span><span class="token punctuation">&gt;</span></span>1.1.16<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>druid.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper.version</span><span class="token punctuation">&gt;</span></span>4.1.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis.spring.boot.version</span><span class="token punctuation">&gt;</span></span>1.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis.spring.boot.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringBooté€šç”¨ä¾èµ–æ¨¡å—--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--test--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- &lt;build &gt; ä¸»è¦ç”¨äºç¼–è¯‘è®¾ç½® --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å®šä¹‰æ‰“åŒ…æˆjarçš„åå­— --&gt;</span>        <span class="token comment">&lt;!-- è¿™é‡Œå¦‚æœä¸å®šä¹‰ , æ‰“åŒ…æˆçš„jaråå­—æ ¼å¼ä¸º : &lt;artifactId&gt; + &lt;version&gt; --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>docker_jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--SpringBoot mavenæ’ä»¶--&gt;</span>            <span class="token comment">&lt;!-- å¯ä»¥å°†åº”ç”¨æ‰“æˆä¸€ä¸ªå¯æ‰§è¡Œçš„jaråŒ… --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!-- è®¾ç½®å¯åŠ¨å…¥å£ --&gt;</span>                <span class="token comment">&lt;!-- manClasså³ä½¿ä¸é…ç½® , SprinBootä¹Ÿåœ¨æ‰“åŒ…çš„æ—¶å€™ä¹Ÿæ¸…æ¥šå…¥å£æ˜¯å“ªä¸ª , å…¶å®ä¸ç”¨é…ç½® --&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">&gt;</span></span>com.kk.DockerBootApplication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€å†™yml"><a href="#3ã€å†™yml" class="headerlink" title="3ã€å†™yml"></a>3ã€å†™yml</h4><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6001</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="4ã€ä¸»å¯åŠ¨"><a href="#4ã€ä¸»å¯åŠ¨" class="headerlink" title="4ã€ä¸»å¯åŠ¨"></a>4ã€ä¸»å¯åŠ¨</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DockerBootApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span>run <span class="token punctuation">(</span><span class="token class-name">DockerBootApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€ä¸šåŠ¡ç±»"><a href="#5ã€ä¸šåŠ¡ç±»" class="headerlink" title="5ã€ä¸šåŠ¡ç±»"></a>5ã€ä¸šåŠ¡ç±»</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMethod</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>UUID<span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${server.port}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> port<span class="token punctuation">;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/order/docker"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">helloDocker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"hello docker"</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> port <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span>randomUUID <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/order/index"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"æœåŠ¡ç«¯å£å·: "</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> port <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span>randomUUID <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="äºŒã€æ‰“-jar-dockerfile"><a href="#äºŒã€æ‰“-jar-dockerfile" class="headerlink" title="äºŒã€æ‰“ jar + dockerfile"></a>äºŒã€æ‰“ jar + dockerfile</h3><h4 id="1ã€æ‰“åŒ…"><a href="#1ã€æ‰“åŒ…" class="headerlink" title="1ã€æ‰“åŒ…"></a>1ã€æ‰“åŒ…</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207170017227.png"></p><h4 id="2ã€ç¼–å†™Dockerfile"><a href="#2ã€ç¼–å†™Dockerfile" class="headerlink" title="2ã€ç¼–å†™Dockerfile"></a>2ã€ç¼–å†™Dockerfile</h4><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile"><span class="token comment"># åŸºç¡€é•œåƒä½¿ç”¨java</span><span class="token keyword">FROM</span> java<span class="token punctuation">:</span>8<span class="token comment"># ä½œè€…</span><span class="token keyword">MAINTAINER</span> jack<span class="token comment"># VOLUME æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸º/tmpï¼Œåœ¨ä¸»æœº/var/lib/dockerç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶é“¾æ¥åˆ°å®¹å™¨çš„/tmp</span><span class="token keyword">VOLUME</span> /tmp<span class="token comment"># å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸º jack_docker.jar</span><span class="token keyword">ADD</span> docker_jar.jar jack_docker.jar<span class="token comment"># è¿è¡ŒjaråŒ…</span><span class="token keyword">RUN</span> bash <span class="token punctuation">-</span>c <span class="token string">'touch /jack_docker.jar'</span><span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">"java"</span><span class="token punctuation">,</span><span class="token string">"-jar"</span><span class="token punctuation">,</span><span class="token string">"/jack_docker.jar"</span><span class="token punctuation">]</span><span class="token comment">#æš´éœ²6001ç«¯å£ä½œä¸ºå¾®æœåŠ¡</span><span class="token keyword">EXPOSE</span> 6001<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207170932494.png"></p><h4 id="3ã€æ„å»ºé•œåƒ"><a href="#3ã€æ„å»ºé•œåƒ" class="headerlink" title="3ã€æ„å»ºé•œåƒ"></a>3ã€æ„å»ºé•œåƒ</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker build <span class="token punctuation">-</span>t jack_docker<span class="token punctuation">:</span>1.6 .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207170932570.png"></p><h4 id="4ã€è¿è¡Œå®¹å™¨"><a href="#4ã€è¿è¡Œå®¹å™¨" class="headerlink" title="4ã€è¿è¡Œå®¹å™¨"></a>4ã€è¿è¡Œå®¹å™¨</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 6001<span class="token punctuation">:</span>6001 jack_docker<span class="token punctuation">:</span>1.6<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="5ã€è®¿é—®æµ‹è¯•"><a href="#5ã€è®¿é—®æµ‹è¯•" class="headerlink" title="5ã€è®¿é—®æµ‹è¯•"></a>5ã€è®¿é—®æµ‹è¯•</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207170936037.png"></p><h2 id="â…£ã€Docker-composeå®¹å™¨ç¼–æ’"><a href="#â…£ã€Docker-composeå®¹å™¨ç¼–æ’" class="headerlink" title="â…£ã€Docker-composeå®¹å™¨ç¼–æ’"></a>â…£ã€Docker-composeå®¹å™¨ç¼–æ’</h2><h3 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h3><h4 id="1ã€æ˜¯ä»€ä¹ˆ-7"><a href="#1ã€æ˜¯ä»€ä¹ˆ-7" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h4><p>Docker-Composeæ˜¯Dockerå®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œå¿«é€Ÿæ„å»ºå¤šä¸ªå®¹å™¨ï¼Œè´Ÿè´£å®ç°å¯¹Dockerå®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚</p><h4 id="2ã€å®‰è£…"><a href="#2ã€å®‰è£…" class="headerlink" title="2ã€å®‰è£…"></a>2ã€å®‰è£…</h4><p>1ã€ä¸‹è½½ï¼šå¿«é€Ÿå›½å†…é•œåƒ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">curl</span> -L https://get.daocloud.io/docker/compose/releases/download/1.25.1/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> -o /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2ã€å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>3ã€æµ‹è¯•</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker<span class="token punctuation">-</span>compose <span class="token punctuation">-</span><span class="token punctuation">-</span>version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3ã€æ ¸å¿ƒ"><a href="#3ã€æ ¸å¿ƒ" class="headerlink" title="3ã€æ ¸å¿ƒ"></a>3ã€æ ¸å¿ƒ</h4><p>1ã€æ–‡ä»¶</p><p>docker-compose.yml</p><p>2ã€æœåŠ¡ï¼ˆserviceï¼‰</p><p>ä¸€ä¸ªä¸ªåº”ç”¨å®¹å™¨å®ä¾‹ï¼Œæ¯”å¦‚è®¢å•å¾®æœåŠ¡ã€åº“å­˜å¾®æœåŠ¡ã€mysqlå®¹å™¨ã€nginxå®¹å™¨æˆ–è€…rediså®¹å™¨</p><p>3ã€å·¥ç¨‹ï¼ˆprojectï¼‰</p><p>ç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ docker-compose.yml æ–‡ä»¶ä¸­å®šä¹‰ã€‚</p><h3 id="äºŒã€æ­¥éª¤"><a href="#äºŒã€æ­¥éª¤" class="headerlink" title="äºŒã€æ­¥éª¤"></a>äºŒã€æ­¥éª¤</h3><ol><li>ç¼–å†™Dockerfileå®šä¹‰å„ä¸ªå¾®æœåŠ¡åº”ç”¨å¹¶æ„å»ºå‡ºå¯¹åº”çš„é•œåƒæ–‡ä»¶</li><li>ä½¿ç”¨ docker-compose.yml å®šä¹‰ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œå®‰æ’å¥½æ•´ä½“åº”ç”¨ä¸­çš„å„ä¸ªå®¹å™¨æœåŠ¡ã€‚</li><li>æœ€åï¼Œæ‰§è¡Œdocker-compose upå‘½ä»¤ æ¥å¯åŠ¨å¹¶è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œå®Œæˆä¸€é”®éƒ¨ç½²ä¸Šçº¿</li></ol><h3 id="ä¸‰ã€å‘½ä»¤"><a href="#ä¸‰ã€å‘½ä»¤" class="headerlink" title="ä¸‰ã€å‘½ä»¤"></a>ä¸‰ã€å‘½ä»¤</h3><blockquote><p>Composeå¸¸ç”¨å‘½ä»¤<br>docker-compose -h                           # æŸ¥çœ‹å¸®åŠ©<br>docker-compose up                           # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡<br><font color="red">docker-compose up -d                        # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡å¹¶åå°è¿è¡Œ</font><br><font color="red">docker-compose down                         # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€ç½‘ç»œã€å·ã€é•œåƒã€‚</font><br>docker-compose exec  ymlé‡Œé¢çš„æœåŠ¡id                 # è¿›å…¥å®¹å™¨å®ä¾‹å†…éƒ¨  docker-compose exec docker-compose.ymlæ–‡ä»¶ä¸­å†™çš„æœåŠ¡id /bin/bash<br>docker-compose ps                      # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨<br>docker-compose top                     # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„å®¹å™¨è¿›ç¨‹docker-compose logs  ymlé‡Œé¢çš„æœåŠ¡id     # æŸ¥çœ‹å®¹å™¨è¾“å‡ºæ—¥å¿—<br><font color="red">docker-compose config     # æ£€æŸ¥é…ç½®</font><br><font color="red">docker-compose config -q  # æ£€æŸ¥é…ç½®ï¼Œæœ‰é—®é¢˜æ‰æœ‰è¾“å‡º</font><br>docker-compose restart   # é‡å¯æœåŠ¡<br>docker-compose start     # å¯åŠ¨æœåŠ¡<br>docker-compose stop      # åœæ­¢æœåŠ¡</p></blockquote><h3 id="å››ã€æ¡ˆä¾‹-1"><a href="#å››ã€æ¡ˆä¾‹-1" class="headerlink" title="å››ã€æ¡ˆä¾‹"></a>å››ã€æ¡ˆä¾‹</h3><h4 id="1ã€æ”¹é€ å¾®æœåŠ¡"><a href="#1ã€æ”¹é€ å¾®æœåŠ¡" class="headerlink" title="1ã€æ”¹é€ å¾®æœåŠ¡"></a>1ã€æ”¹é€ å¾®æœåŠ¡</h4><p>1ã€å»ºè¡¨</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t_user<span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>username<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'ç”¨æˆ·å'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'å¯†ç '</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>sex<span class="token punctuation">`</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'æ€§åˆ« 0=å¥³ 1=ç”· '</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>deleted<span class="token punctuation">`</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'æ›´æ–°æ—¶é—´'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'åˆ›å»ºæ—¶é—´'</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'ç”¨æˆ·è¡¨'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€æ”¹pom</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>docker_boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>junit.version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>junit.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log4j.version</span><span class="token punctuation">&gt;</span></span>1.2.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log4j.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lombok.version</span><span class="token punctuation">&gt;</span></span>1.16.18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lombok.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mysql.version</span><span class="token punctuation">&gt;</span></span>5.1.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mysql.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>druid.version</span><span class="token punctuation">&gt;</span></span>1.1.16<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>druid.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper.version</span><span class="token punctuation">&gt;</span></span>4.1.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis.spring.boot.version</span><span class="token punctuation">&gt;</span></span>1.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis.spring.boot.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--guava Google å¼€æºçš„ Guava ä¸­è‡ªå¸¦çš„å¸ƒéš†è¿‡æ»¤å™¨--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.guava<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>guava<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>23.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- redisson --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.13.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringBooté€šç”¨ä¾èµ–æ¨¡å—--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--swagger2--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringBootä¸Redisæ•´åˆä¾èµ–--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--springCache--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--springCacheè¿æ¥æ± ä¾èµ–åŒ…--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- jedis --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--Mysqlæ•°æ®åº“é©±åŠ¨--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringBooté›†æˆdruidè¿æ¥æ± --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${druid.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--mybatiså’Œspringbootæ•´åˆ--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mybatis.spring.boot.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ·»åŠ springbootå¯¹amqpçš„æ”¯æŒ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--é€šç”¨åŸºç¡€é…ç½®junit/devtools/test/log4j/lombok/hutool--&gt;</span>        <span class="token comment">&lt;!--hutool--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${junit.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${log4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${lombok.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--persistence--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.persistence<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>persistence-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--é€šç”¨Mapper--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tk.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mapper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mapper.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- &lt;build &gt; ä¸»è¦ç”¨äºç¼–è¯‘è®¾ç½® --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å®šä¹‰æ‰“åŒ…æˆjarçš„åå­— --&gt;</span>        <span class="token comment">&lt;!-- è¿™é‡Œå¦‚æœä¸å®šä¹‰ , æ‰“åŒ…æˆçš„jaråå­—æ ¼å¼ä¸º : &lt;artifactId&gt; + &lt;version&gt; --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>docker_jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--SpringBoot mavenæ’ä»¶--&gt;</span>            <span class="token comment">&lt;!-- å¯ä»¥å°†åº”ç”¨æ‰“æˆä¸€ä¸ªå¯æ‰§è¡Œçš„jaråŒ… --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!-- è®¾ç½®å¯åŠ¨å…¥å£ --&gt;</span>                <span class="token comment">&lt;!-- manClasså³ä½¿ä¸é…ç½® , SprinBootä¹Ÿåœ¨æ‰“åŒ…çš„æ—¶å€™ä¹Ÿæ¸…æ¥šå…¥å£æ˜¯å“ªä¸ª , å…¶å®ä¸ç”¨é…ç½® --&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">&gt;</span></span>com.kk.DockerBootApplication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€application.properties.properties</p><pre class="line-numbers language-boostrap.properties" data-language="boostrap.properties"><code class="language-boostrap.properties">server.port=6001# ========================alibaba.druidç›¸å…³é…ç½®=====================spring.datasource.type=com.alibaba.druid.pool.DruidDataSourcespring.datasource.driver-class-name=com.mysql.jdbc.Driverspring.datasource.url=jdbc:mysql://106.52.23.202:3306/db2022?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=falsespring.datasource.username=rootspring.datasource.password=rootspring.datasource.druid.test-while-idle=false# ========================redisç›¸å…³é…ç½®=====================spring.redis.database=0spring.redis.host=106.12.159.22spring.redis.port=6379spring.redis.password=spring.redis.lettuce.pool.max-active=8spring.redis.lettuce.pool.max-wait=-1msspring.redis.lettuce.pool.max-idle=8spring.redis.lettuce.pool.min-idle=0# ========================mybatisç›¸å…³é…ç½®===================mybatis.mapper-locations=classpath:mapper/*.xmlmybatis.type-aliases-package=com.kk.docker.entities# ========================swagger=====================spring.swagger2.enabled=true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4ã€ä¸»å¯åŠ¨</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">tk<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span><span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"com.kk.docker.mapper"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DockerBootApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span>run <span class="token punctuation">(</span><span class="token class-name">DockerBootApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5ã€ä¸šåŠ¡ç±»</p><p>5-1ã€configé…ç½®ç±»</p><p><strong>RedisConfig</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>lettuce<span class="token punctuation">.</span></span><span class="token class-name">LettuceConnectionFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * @param lettuceConnectionFactory     * @return redisåºåˆ—åŒ–çš„å·¥å…·é…ç½®ç±»ï¼Œä¸‹é¢è¿™ä¸ªè¯·ä¸€å®šå¼€å¯é…ç½®     * 127.0.0.1:6379&gt; keys *     * 1) "ord:102"  åºåˆ—åŒ–è¿‡     * 2) "\xac\xed\x00\x05t\x00\aord:102"   é‡ç”Ÿï¼Œæ²¡æœ‰åºåˆ—åŒ–è¿‡     */</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">LettuceConnectionFactory</span> lettuceConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span>setConnectionFactory <span class="token punctuation">(</span>lettuceConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®keyåºåˆ—åŒ–æ–¹å¼string</span>        redisTemplate<span class="token punctuation">.</span>setKeySerializer <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®valueçš„åºåˆ—åŒ–æ–¹å¼json</span>        redisTemplate<span class="token punctuation">.</span>setValueSerializer <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span>setHashKeySerializer <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span>setHashValueSerializer <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span>afterPropertiesSet <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>SwaggerConfig</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">PathSelectors</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">RequestHandlerSelectors</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ApiInfo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">DocumentationType</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>web<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span></span><span class="token class-name">Docket</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>swagger2<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">EnableSwagger2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableSwagger2</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.swagger2.enabled}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> enabled<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">Docket</span> <span class="token function">createRestApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span> <span class="token punctuation">(</span><span class="token class-name">DocumentationType</span><span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>                <span class="token punctuation">.</span>apiInfo <span class="token punctuation">(</span>apiInfo <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>enable <span class="token punctuation">(</span>enabled<span class="token punctuation">)</span>                <span class="token punctuation">.</span>select <span class="token punctuation">(</span> <span class="token punctuation">)</span>                <span class="token punctuation">.</span>apis <span class="token punctuation">(</span><span class="token class-name">RequestHandlerSelectors</span><span class="token punctuation">.</span>basePackage <span class="token punctuation">(</span><span class="token string">"com.kk.docker"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//ä½ è‡ªå·±çš„package</span>                <span class="token punctuation">.</span>paths <span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span>any <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>build <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">ApiInfo</span> <span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span>                <span class="token punctuation">.</span>title <span class="token punctuation">(</span><span class="token string">"java å­¦ä¹  docker"</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span> <span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>format <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>description <span class="token punctuation">(</span><span class="token string">"docker-compose"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>version <span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>termsOfServiceUrl <span class="token punctuation">(</span><span class="token string">"https://www.mykkto.cn"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>build <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5-2ã€æ–°å»ºentity</p><p><strong>User</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>entirys</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Column</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">GeneratedValue</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Id</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">Table</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"t_user"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Id</span>    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>generator <span class="token operator">=</span> <span class="token string">"JDBC"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>    <span class="token comment">/**     * ç”¨æˆ·å     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token comment">/**     * å¯†ç      */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token comment">/**     * æ€§åˆ« 0=å¥³ 1=ç”·     */</span>    <span class="token keyword">private</span> <span class="token class-name">Byte</span> sex<span class="token punctuation">;</span>    <span class="token comment">/**     * åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤     */</span>    <span class="token keyword">private</span> <span class="token class-name">Byte</span> deleted<span class="token punctuation">;</span>    <span class="token comment">/**     * æ›´æ–°æ—¶é—´     */</span>    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"update_time"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>    <span class="token comment">/**     * åˆ›å»ºæ—¶é—´     */</span>    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"create_time"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>    <span class="token comment">/**     * @return id     */</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * @param id     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–ç”¨æˆ·å     *     * @return username - ç”¨æˆ·å     */</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> username<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®ç”¨æˆ·å     *     * @param username ç”¨æˆ·å     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–å¯†ç      *     * @return password - å¯†ç      */</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> password<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®å¯†ç      *     * @param password å¯†ç      */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–æ€§åˆ« 0=å¥³ 1=ç”·     *     * @return sex - æ€§åˆ« 0=å¥³ 1=ç”·     */</span>    <span class="token keyword">public</span> <span class="token class-name">Byte</span> <span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> sex<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®æ€§åˆ« 0=å¥³ 1=ç”·     *     * @param sex æ€§åˆ« 0=å¥³ 1=ç”·     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSex</span><span class="token punctuation">(</span><span class="token class-name">Byte</span> sex<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤     *     * @return deleted - åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤     */</span>    <span class="token keyword">public</span> <span class="token class-name">Byte</span> <span class="token function">getDeleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> deleted<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤     *     * @param deleted åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDeleted</span><span class="token punctuation">(</span><span class="token class-name">Byte</span> deleted<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>deleted <span class="token operator">=</span> deleted<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–æ›´æ–°æ—¶é—´     *     * @return update_time - æ›´æ–°æ—¶é—´     */</span>    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getUpdateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> updateTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®æ›´æ–°æ—¶é—´     *     * @param updateTime æ›´æ–°æ—¶é—´     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token class-name">Date</span> updateTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>updateTime <span class="token operator">=</span> updateTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–åˆ›å»ºæ—¶é—´     *     * @return create_time - åˆ›å»ºæ—¶é—´     */</span>    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> createTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®åˆ›å»ºæ—¶é—´     *     * @param createTime åˆ›å»ºæ—¶é—´     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">Date</span> createTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>createTime <span class="token operator">=</span> createTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>UserDTO</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>entirys</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiModel</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiModelProperty</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@ApiModel</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"ç”¨æˆ·ä¿¡æ¯"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ToString</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDTO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"ç”¨æˆ·ID"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"ç”¨æˆ·å"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"å¯†ç "</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ€§åˆ« 0=å¥³ 1=ç”· "</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Byte</span> sex<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Byte</span> deleted<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ›´æ–°æ—¶é—´"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"åˆ›å»ºæ—¶é—´"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>    <span class="token comment">/**     * @return id     */</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * @param id     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–ç”¨æˆ·å     *     * @return username - ç”¨æˆ·å     */</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> username<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®ç”¨æˆ·å     *     * @param username ç”¨æˆ·å     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–å¯†ç      *     * @return password - å¯†ç      */</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> password<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®å¯†ç      *     * @param password å¯†ç      */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–æ€§åˆ« 0=å¥³ 1=ç”·     *     * @return sex - æ€§åˆ« 0=å¥³ 1=ç”·     */</span>    <span class="token keyword">public</span> <span class="token class-name">Byte</span> <span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> sex<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®æ€§åˆ« 0=å¥³ 1=ç”·     *     * @param sex æ€§åˆ« 0=å¥³ 1=ç”·     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSex</span><span class="token punctuation">(</span><span class="token class-name">Byte</span> sex<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤     *     * @return deleted - åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤     */</span>    <span class="token keyword">public</span> <span class="token class-name">Byte</span> <span class="token function">getDeleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> deleted<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤     *     * @param deleted åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDeleted</span><span class="token punctuation">(</span><span class="token class-name">Byte</span> deleted<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>deleted <span class="token operator">=</span> deleted<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–æ›´æ–°æ—¶é—´     *     * @return update_time - æ›´æ–°æ—¶é—´     */</span>    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getUpdateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> updateTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®æ›´æ–°æ—¶é—´     *     * @param updateTime æ›´æ–°æ—¶é—´     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token class-name">Date</span> updateTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>updateTime <span class="token operator">=</span> updateTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–åˆ›å»ºæ—¶é—´     *     * @return create_time - åˆ›å»ºæ—¶é—´     */</span>    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> createTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®åˆ›å»ºæ—¶é—´     *     * @param createTime åˆ›å»ºæ—¶é—´     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">Date</span> createTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>createTime <span class="token operator">=</span> createTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5-3 æ–°å»ºmapper</p><p><strong>æ–°å»ºæ¥å£UserMapper</strong> </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>entirys<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">tk<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>src\main\resourcesè·¯å¾„ä¸‹æ–°å»ºmapperæ–‡ä»¶å¤¹å¹¶æ–°å¢UserMapper.xml</strong></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.atguigu.docker.mapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk.docker.entirys.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--          WARNING - @mbg.generated        --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TINYINT<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sex<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleted<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TINYINT<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleted<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>update_time<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TIMESTAMP<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateTime<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>create_time<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TIMESTAMP<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>createTime<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5-4 æ–°å»ºservice</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>entirys<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">UserMapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> CACHE_KEY_USER <span class="token operator">=</span> <span class="token string">"user:"</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>    <span class="token comment">/**     * addUser     *     * @param user     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">//1 å…ˆæ’å…¥mysqlå¹¶æˆåŠŸ</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> userMapper<span class="token punctuation">.</span>insertSelective <span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//2 éœ€è¦å†æ¬¡æŸ¥è¯¢ä¸€ä¸‹mysqlå°†æ•°æ®æå›æ¥å¹¶ok</span>            user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span>selectByPrimaryKey <span class="token punctuation">(</span>user<span class="token punctuation">.</span>getId <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//3 å°†æå‡ºæ¥çš„userå­˜è¿›redisï¼Œå®Œæˆæ–°å¢åŠŸèƒ½çš„æ•°æ®ä¸€è‡´æ€§ã€‚</span>            <span class="token class-name">String</span> key <span class="token operator">=</span> CACHE_KEY_USER <span class="token operator">+</span> user<span class="token punctuation">.</span>getId <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            redisTemplate<span class="token punctuation">.</span>opsForValue <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>set <span class="token punctuation">(</span>key<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**F     * findUserById     *     * @param id     * @return     */</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> key <span class="token operator">=</span> CACHE_KEY_USER <span class="token operator">+</span> id<span class="token punctuation">;</span>        <span class="token comment">//1 å…ˆä»redisé‡Œé¢æŸ¥è¯¢ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ç»“æœï¼Œå¦‚æœæ²¡æœ‰å†å»æŸ¥è¯¢mysql</span>        user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span>opsForValue <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>get <span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//2 redisé‡Œé¢æ— ï¼Œç»§ç»­æŸ¥è¯¢mysql</span>            user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span>selectByPrimaryKey <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">//3.1 redis+mysql éƒ½æ— æ•°æ®</span>                <span class="token comment">//ä½ å…·ä½“ç»†åŒ–ï¼Œé˜²æ­¢å¤šæ¬¡ç©¿é€ï¼Œæˆ‘ä»¬è§„å®šï¼Œè®°å½•ä¸‹å¯¼è‡´ç©¿é€çš„è¿™ä¸ªkeyå›å†™redis</span>                <span class="token keyword">return</span> user<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token comment">//3.2 mysqlæœ‰ï¼Œéœ€è¦å°†æ•°æ®å†™å›redisï¼Œä¿è¯ä¸‹ä¸€æ¬¡çš„ç¼“å­˜å‘½ä¸­ç‡</span>                redisTemplate<span class="token punctuation">.</span>opsForValue <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>set <span class="token punctuation">(</span>key<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> user<span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findUserById2</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5-5 æ–°å»ºcontroller</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">IdUtil</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>entirys<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>entirys<span class="token punctuation">.</span></span><span class="token class-name">UserDTO</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserService</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Api</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">ApiOperation</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeanUtils</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>description <span class="token operator">=</span> <span class="token string">"ç”¨æˆ·Useræ¥å£"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åº“æ–°å¢3æ¡è®°å½•"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/user/add"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            user<span class="token punctuation">.</span>setUsername <span class="token punctuation">(</span><span class="token string">"jack"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>            user<span class="token punctuation">.</span>setPassword <span class="token punctuation">(</span><span class="token class-name">IdUtil</span><span class="token punctuation">.</span>simpleUUID <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>substring <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            user<span class="token punctuation">.</span>setSex <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">Random</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>nextInt <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            userService<span class="token punctuation">.</span>addUser <span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤1æ¡è®°å½•"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/user/delete/{id}"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        userService<span class="token punctuation">.</span>deleteUser <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"ä¿®æ”¹1æ¡è®°å½•"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/user/update"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">UserDTO</span> userDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span>copyProperties <span class="token punctuation">(</span>userDTO<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>        userService<span class="token punctuation">.</span>updateUser <span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"æŸ¥è¯¢1æ¡è®°å½•"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/user/find/{id}"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">findUserById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> userService<span class="token punctuation">.</span>findUserById2 <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>6ã€æ‰“åŒ…</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207182254361.png"></p><p>7ã€ç¼–å†™ Dockerfile</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile"><span class="token comment"># åŸºç¡€é•œåƒä½¿ç”¨java</span><span class="token keyword">FROM</span> java<span class="token punctuation">:</span>8<span class="token comment"># ä½œè€…</span><span class="token keyword">MAINTAINER</span> jack<span class="token comment"># VOLUME æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸º/tmpï¼Œåœ¨ä¸»æœº/var/lib/dockerç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶é“¾æ¥åˆ°å®¹å™¨çš„/tmp</span><span class="token keyword">VOLUME</span> /tmp<span class="token comment"># å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸º jack_docker.jar</span><span class="token keyword">ADD</span> docker_jar.jar jack_docker.jar<span class="token comment"># è¿è¡ŒjaråŒ…</span><span class="token keyword">RUN</span> bash <span class="token punctuation">-</span>c <span class="token string">'touch /jack_docker.jar'</span><span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">"java"</span><span class="token punctuation">,</span><span class="token string">"-jar"</span><span class="token punctuation">,</span><span class="token string">"/jack_docker.jar"</span><span class="token punctuation">]</span><span class="token comment">#æš´éœ²6001ç«¯å£ä½œä¸ºå¾®æœåŠ¡</span><span class="token keyword">EXPOSE</span> 6001<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>8ã€æ„å»ºé•œåƒ</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker build  <span class="token punctuation">-</span>t  jack_docker<span class="token punctuation">:</span>1.7 . <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207182303132.png"></p><p>9ã€è¿è¡Œ</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 6001<span class="token punctuation">:</span>6001 <span class="token punctuation">-</span><span class="token punctuation">-</span>name  jackto17   jack_docker<span class="token punctuation">:</span>1.7 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>10ã€è®¿é—® swageer</p><p><a href="http://106.xx.xx.xxx:6001/swagger-ui.html">http://106.XX.XX.XXX:6001/swagger-ui.html</a></p><h4 id="2ã€ä¸ç”¨Compose"><a href="#2ã€ä¸ç”¨Compose" class="headerlink" title="2ã€ä¸ç”¨Compose"></a>2ã€ä¸ç”¨Compose</h4><ol><li>å•ç‹¬å¯åŠ¨å®¹å™¨ redis</li><li>å•ç‹¬å¯åŠ¨å®¹å™¨ mysql</li><li>å•ç‹¬å¯åŠ¨å®¹å™¨ å¾®æœåŠ¡</li></ol><h4 id="3ã€å­˜åœ¨çš„é—®é¢˜"><a href="#3ã€å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="3ã€å­˜åœ¨çš„é—®é¢˜"></a>3ã€å­˜åœ¨çš„é—®é¢˜</h4><ul><li>å…ˆåé¡ºåºè¦æ±‚å›ºå®šï¼Œå…ˆmysql+redisæ‰èƒ½å¾®æœåŠ¡è®¿é—®æˆåŠŸ</li><li>å¤šä¸ªrunå‘½ä»¤â€¦â€¦</li><li>å®¹å™¨é—´çš„å¯åœæˆ–å®•æœºï¼Œæœ‰å¯èƒ½å¯¼è‡´IPåœ°å€å¯¹åº”çš„å®¹å™¨å®ä¾‹å˜åŒ–ï¼Œæ˜ å°„å‡ºé”™ï¼Œ<br>è¦ä¹ˆç”Ÿäº§IPå†™æ­»(å¯ä»¥ä½†æ˜¯ä¸æ¨è)ï¼Œè¦ä¹ˆé€šè¿‡æœåŠ¡è°ƒç”¨</li></ul><h4 id="4ã€ä½¿ç”¨Compose"><a href="#4ã€ä½¿ç”¨Compose" class="headerlink" title="4ã€ä½¿ç”¨Compose"></a>4ã€ä½¿ç”¨Compose</h4><p><strong>1ã€ç¼–å†™ docker-compose.ymlæ–‡ä»¶</strong></p><pre class="line-numbers language-Dockerfile" data-language="Dockerfile"><code class="language-Dockerfile">version: "3"services:  microService:    image: jack_docker:1.8    container_name: ms01    ports:      - "6001:6001"    volumes:      - /app/microService:/data    networks:      - mykk_net    depends_on:      - redis      - mysql  redis:    image: redis:6.0.8    ports:      - "6379:6379"    volumes:      - /app/redis/redis.conf:/etc/redis/redis.conf      - /app/redis/data:/data    networks:      - mykk_net    command: redis-server /etc/redis/redis.conf  mysql:    image: mysql:5.7    environment:      MYSQL_ROOT_PASSWORD: 'a1b2c3'      MYSQL_ALLOW_EMPTY_PASSWORD: 'no'      MYSQL_DATABASE: 'db2022'      MYSQL_USER: 'jack'      MYSQL_PASSWORD: 'a1b2c3'    ports:       - "3306:3306"    volumes:       - /app/mysql/db:/var/lib/mysql       - /app/mysql/conf/my.cnf:/etc/my.cnf       - /app/mysql/init:/docker-entrypoint-initdb.d    networks:      - mykk_net    command: --default-authentication-plugin=mysql_native_password #è§£å†³å¤–éƒ¨æ— æ³•è®¿é—®networks:   mykk_net:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2ã€ç¬¬äºŒæ¬¡ä¿®æ”¹å¾®æœåŠ¡å·¥ç¨‹ docker_boot</strong></p><p>2-1 æ”¹ YMLï¼šé€šè¿‡æœåŠ¡åè®¿é—®ï¼ŒIPæ— å…³</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207192321216.png"></p><p>2-2 æ‰“åŒ…ï¼Œç¼–å†™ Dockerfile</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207192336342.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207192335353.png"></p><p>2-3 æ„å»ºé•œåƒ</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker build <span class="token punctuation">-</span>t  jack_docker<span class="token punctuation">:</span>1.8 . <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207192348732.png"></p><p><strong>3ã€æ‰§è¡Œ docker-compose</strong></p><p>æ‰§è¡Œ <code>docker-compose up</code><br>æˆ–è€…<br>æ‰§è¡Œ <code>docker-compose up -d</code></p><h4 id="4ã€åˆ›å»ºè¡¨"><a href="#4ã€åˆ›å»ºè¡¨" class="headerlink" title="4ã€åˆ›å»ºè¡¨"></a>4ã€åˆ›å»ºè¡¨</h4><blockquote><p>docker exec -it å®¹å™¨å®ä¾‹id /bin/bash</p><br><p>mysql -uroot -p</p><br><p>create database db2022;</p><br><p>use db2022;</p><br><p>CREATE TABLE <code>t_user</code> (<br>  <code>id</code> INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,<br>  <code>username</code> VARCHAR(50) NOT NULL DEFAULT â€˜â€™ COMMENT â€˜ç”¨æˆ·åâ€™,<br>  <code>password</code> VARCHAR(50) NOT NULL DEFAULT â€˜â€™ COMMENT â€˜å¯†ç â€™,<br>  <code>sex</code> TINYINT(4) NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜æ€§åˆ« 0=å¥³ 1=ç”· â€˜,<br>  <code>deleted</code> TINYINT(4) UNSIGNED NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤â€™,<br>  <code>update_time</code> TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT â€˜æ›´æ–°æ—¶é—´â€™,<br>  <code>create_time</code> TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT â€˜åˆ›å»ºæ—¶é—´â€™,<br>  PRIMARY KEY (<code>id</code>)<br>) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT=â€™ç”¨æˆ·è¡¨â€™;</p></blockquote><h4 id="5ã€å…³åœ"><a href="#5ã€å…³åœ" class="headerlink" title="5ã€å…³åœ"></a>5ã€å…³åœ</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker<span class="token punctuation">-</span>compose stop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202207202134367.png"></p><h3 id="äº”ã€å‘½ä»¤-docker-compose"><a href="#äº”ã€å‘½ä»¤-docker-compose" class="headerlink" title="äº”ã€å‘½ä»¤(docker-compose)"></a>äº”ã€å‘½ä»¤(docker-compose)</h3><blockquote><p>Composeå¸¸ç”¨å‘½ä»¤<br>docker-compose -h                           # æŸ¥çœ‹å¸®åŠ©<br><font color="red">docker-compose up     </font>                      # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡<br><font color="red">docker-compose up -d      </font>                  # å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡å¹¶åå°è¿è¡Œ<br><font color="red">docker-compose down </font>                        # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€ç½‘ç»œã€å·ã€é•œåƒã€‚<br>docker-compose exec  ymlé‡Œé¢çš„æœåŠ¡id                 # è¿›å…¥å®¹å™¨å®ä¾‹å†…éƒ¨  docker-compose exec docker-compose.ymlæ–‡ä»¶ä¸­å†™çš„æœåŠ¡id /bin/bash<br>docker-compose ps                      # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨<br>docker-compose top                     # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„å®¹å™¨è¿›ç¨‹docker-compose logs  ymlé‡Œé¢çš„æœåŠ¡id     # æŸ¥çœ‹å®¹å™¨è¾“å‡ºæ—¥å¿—<br><font color="red">dokcer-compose config </font>    # æ£€æŸ¥é…ç½®<br><font color="red">dokcer-compose config -q </font> # æ£€æŸ¥é…ç½®ï¼Œæœ‰é—®é¢˜æ‰æœ‰è¾“å‡º<br>docker-compose restart   # é‡å¯æœåŠ¡<br>docker-compose start     # å¯åŠ¨æœåŠ¡<br><font color="red">docker-compose stop  </font>    # åœæ­¢æœåŠ¡</p></blockquote><h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><h2 id="å‚è€ƒåœ°å€-â†“"><a href="#å‚è€ƒåœ°å€-â†“" class="headerlink" title="å‚è€ƒåœ°å€ â†“"></a>å‚è€ƒåœ°å€ â†“</h2><h3 id="1ã€docker-åŠ é€Ÿï¼ˆåšä¸»ç®€ä¹¦ï¼‰"><a href="#1ã€docker-åŠ é€Ÿï¼ˆåšä¸»ç®€ä¹¦ï¼‰" class="headerlink" title="1ã€docker åŠ é€Ÿï¼ˆåšä¸»ç®€ä¹¦ï¼‰"></a>1ã€docker åŠ é€Ÿï¼ˆåšä¸»ç®€ä¹¦ï¼‰</h3><p>urlï¼š<a href="https://www.jianshu.com/p/f554c85b25c1">https://www.jianshu.com/p/f554c85b25c1</a></p><h3 id="2ã€DockerBuildæŠ¥é”™ï¼šThe-command-â€˜-bin-sh-c-yum-install-y-vimâ€˜-returned-a-non-zero-code-1"><a href="#2ã€DockerBuildæŠ¥é”™ï¼šThe-command-â€˜-bin-sh-c-yum-install-y-vimâ€˜-returned-a-non-zero-code-1" class="headerlink" title="2ã€DockerBuildæŠ¥é”™ï¼šThe command â€˜/bin/sh -c yum install -y vimâ€˜ returned a non-zero code: 1"></a>2ã€DockerBuildæŠ¥é”™ï¼šThe command â€˜/bin/sh -c yum install -y vimâ€˜ returned a non-zero code: 1</h3><p>urlï¼š<a href="https://blog.csdn.net/weixin_53402685/article/details/125296621">https://blog.csdn.net/weixin_53402685/article/details/125296621</a></p><h3 id="3ã€docker-compose-æ—¥å¿—è¾“å‡º"><a href="#3ã€docker-compose-æ—¥å¿—è¾“å‡º" class="headerlink" title="3ã€docker-compose æ—¥å¿—è¾“å‡º"></a>3ã€docker-compose æ—¥å¿—è¾“å‡º</h3><p>urlï¼š<a href="https://www.cnblogs.com/sunstudy/articles/16340509.html">https://www.cnblogs.com/sunstudy/articles/16340509.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="docker" scheme="https://mykkto.github.io/categories/docker/"/>
    
    
    <category term="docker-compose" scheme="https://mykkto.github.io/tags/docker-compose/"/>
    
    <category term="dockerfile" scheme="https://mykkto.github.io/tags/dockerfile/"/>
    
    <category term="dockerç½‘ç»œ" scheme="https://mykkto.github.io/tags/docker%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>å¤§æ•°æ®-Flinkæµå¼è®¡ç®—æ¡†æ¶(JAVA)</title>
    <link href="https://mykkto.github.io/posts/1b79564d.html"/>
    <id>https://mykkto.github.io/posts/1b79564d.html</id>
    <published>2022-05-17T14:17:13.000Z</published>
    <updated>2023-04-10T14:35:35.049Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>â€‹    </p><h2 id="0ï¸âƒ£ä»£ç åœ°å€"><a href="#0ï¸âƒ£ä»£ç åœ°å€" class="headerlink" title="0ï¸âƒ£ä»£ç åœ°å€"></a>0ï¸âƒ£ä»£ç åœ°å€</h2><p><a href="https://github.com/mykkTo/Flink_java.git">https://github.com/mykkTo/Flink_java.git</a></p><h2 id="â… ã€Flink-åˆè¯†"><a href="#â… ã€Flink-åˆè¯†" class="headerlink" title="â… ã€Flink åˆè¯†"></a>â… ã€Flink åˆè¯†</h2><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><h3 id="1ã€å°ç¬”è®°"><a href="#1ã€å°ç¬”è®°" class="headerlink" title="1ã€å°ç¬”è®°"></a>1ã€å°ç¬”è®°</h3><blockquote><p>1ã€åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä½¿ç”¨äº†lambdaè¡¨è¾¾å¼éœ€è¦æ³¨æ„æ³›å‹æ“¦é™¤ï¼Œæ²¡æœ‰æŒ‡æ˜çš„è¯flinkä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºå¯¹æ•°æ®æœ‰ä¸¥æ ¼è¦æ±‚  </p><p>.returns(Types.String); è¿›è¡Œæ˜ç¡®å£°æ˜</p><p>2ã€æ•°æ®å€¾æ–œï¼šå°±æ˜¯æœ‰çš„çº¿ç¨‹å¿™çš„å¿™æ­»ï¼Œæœ‰ç‚¹çº¿ç¨‹é—²çš„é—²æ­»ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦è°ƒç”¨ç‰©ç†åˆ†åŒºçš„ç®—å­ï¼ˆé»˜è®¤flinkåº•å±‚ä¼šè°ƒç”¨ï¼‰ï¼Œæ‰‹åŠ¨çš„è¯è°ƒç”¨ shuffle() æ–¹æ³•ï¼ˆæ´—ç‰Œï¼Œéšæœºåˆ†åŒºï¼‰ï¼Œæ‰‹åŠ¨è°ƒç”¨ rebalance() æ–¹æ³•ï¼ˆè½®è®­åˆ†åŒºï¼‰ï¼Œç„¶è€Œéœ€è¦æ³¨æ„çš„æ˜¯ keyByï¼ˆï¼‰æ–¹æ³•æ˜¯é€»è¾‘åˆ†åŒºï¼Œæ€»çš„6ç§è¿˜æœ‰è‡ªå®šä¹‰çš„ï¼Œå¦‚æœç”Ÿäº§æ²¡æœ‰ä¸¥é‡å€¾æ–œå°±ä¸éœ€è¦ç”¨è¿™äº›ã€‚</p><p>3ã€æœ‰ä¸¤ä¸ªsetParallelism(N) </p><p>â€‹          env.setParallelism(N) æ˜¯è®¾ç½®Nä¸ªç‰©ç†åˆ†åŒº</p><p>â€‹          print ().setParallelism(N)æ˜¯è®¾ç½®Nä¸ªçº¿ç¨‹åœ¨è·‘ï¼Œå¯Œå‡½æ•°çš„è¯å°±ä¼šæœ‰4æ¬¡ç”Ÿå‘½å‘¨æœŸ</p><p>4ã€</p></blockquote><h3 id="ä¸€ã€åŸºæœ¬æ¦‚è¿°"><a href="#ä¸€ã€åŸºæœ¬æ¦‚è¿°" class="headerlink" title="ä¸€ã€åŸºæœ¬æ¦‚è¿°"></a>ä¸€ã€åŸºæœ¬æ¦‚è¿°</h3><h4 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h4><p>Flink æ˜¯ Apache åŸºé‡‘ä¼šæ——ä¸‹çš„ä¸€ä¸ªå¼€æºå¤§æ•°æ®å¤„ç†æ¡†æ¶ã€‚ç›®å‰ï¼ŒFlink å·²ç»æˆä¸ºå„å¤§å…¬å¸å¤§æ•°æ®å®æ—¶å¤„ç†çš„å‘åŠ›é‡ç‚¹ï¼Œç‰¹åˆ«æ˜¯å›½å†…ä»¥é˜¿é‡Œä¸ºä»£è¡¨çš„ä¸€ä¼—äº’è”ç½‘å¤§å‚éƒ½åœ¨å…¨åŠ›æŠ•å…¥ï¼Œä¸º Flink ç¤¾åŒºè´¡çŒ®äº†å¤§é‡æºç ã€‚å¦‚ä»Š Flink å·²è¢«å¾ˆå¤šäººè®¤ä¸ºæ˜¯å¤§æ•°æ®å®æ—¶å¤„ç†çš„æ–¹å‘å’Œæœªæ¥ï¼Œè®¸å¤šå…¬å¸ä¹Ÿéƒ½åœ¨æ‹›è˜å’Œå‚¨å¤‡æŒæ¡ Flink æŠ€æœ¯çš„äººæ‰ã€‚ </p><h4 id="2ã€æºèµ·å’Œè®¾è®¡ç†å¿µ"><a href="#2ã€æºèµ·å’Œè®¾è®¡ç†å¿µ" class="headerlink" title="2ã€æºèµ·å’Œè®¾è®¡ç†å¿µ"></a>2ã€æºèµ·å’Œè®¾è®¡ç†å¿µ</h4><p>Flink èµ·æºäºä¸€ä¸ªå«ä½œ Stratosphere çš„é¡¹ç›®ï¼Œå®ƒæ˜¯ç”± 3 æ‰€åœ°å¤„æŸæ—çš„å¤§å­¦å’Œæ¬§æ´²å…¶ä»–ä¸€äº›å¤§ å­¦åœ¨ 2010~2014 å¹´å…±åŒè¿›è¡Œçš„ç ”ç©¶é¡¹ç›®ï¼Œç”±æŸæ—ç†å·¥å¤§å­¦çš„æ•™æˆæ²ƒå…‹å°”Â·é©¬å°”ç§‘ï¼ˆVolker Marklï¼‰ é¢†è¡”å¼€å‘ã€‚2014 å¹´ 4 æœˆï¼ŒStratosphere çš„ä»£ç è¢«å¤åˆ¶å¹¶æèµ ç»™äº† Apache è½¯ä»¶åŸºé‡‘ä¼šï¼ŒFlink å°± æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šè¢«é‡æ–°è®¾è®¡å‡ºæ¥çš„ã€‚ åœ¨å¾·è¯­ä¸­ï¼Œâ€œflinkâ€ä¸€è¯è¡¨ç¤ºâ€œå¿«é€Ÿã€çµå·§â€ã€‚é¡¹ç›®çš„ logo æ˜¯ä¸€åªå½©è‰²çš„æ¾é¼ ï¼Œå½“ç„¶äº†ï¼Œ è¿™ä¸ä»…æ˜¯å› ä¸º Apache å¤§æ•°æ®é¡¹ç›®å¯¹åŠ¨ç‰©çš„å–œå¥½ï¼ˆæ˜¯å¦è”æƒ³åˆ°äº† Hadoopã€Hiveï¼Ÿï¼‰ï¼Œæ›´æ˜¯å› ä¸º æ¾é¼ è¿™ç§å°åŠ¨ç‰©å®Œç¾åœ°ä½“ç°äº†â€œå¿«é€Ÿã€çµå·§â€çš„ç‰¹ç‚¹ã€‚å…³äº logo çš„é¢œè‰²ï¼Œè¿˜ä¸€ä¸ªæœ‰è¶£çš„ç¼˜ç”±ï¼š æŸæ—å½“åœ°çš„æ¾é¼ éå¸¸æ¼‚äº®ï¼Œé¢œè‰²æ˜¯è¿·äººçš„çº¢æ£•è‰²ï¼›è€Œ Apache è½¯ä»¶åŸºé‡‘ä¼šçš„ logoï¼Œåˆšå¥½ä¹Ÿæ˜¯ä¸€ æ ¹ä»¥çº¢æ£•è‰²ä¸ºä¸»çš„æ¸å˜è‰²ç¾½æ¯›ã€‚äºæ˜¯ï¼ŒFlink çš„æ¾é¼  Logo å°±è®¾è®¡æˆäº†çº¢æ£•è‰²ï¼Œè€Œä¸”æ‹¥æœ‰ä¸€ä¸ªæ¼‚ äº®çš„æ¸å˜è‰²å°¾å·´ï¼Œå°¾å·´çš„é…è‰²ä¸ Apache è½¯ä»¶åŸºé‡‘ä¼šçš„ logo ä¸€è‡´ã€‚è¿™åªæ¾é¼ è‰²å½©ç‚«ç›®ï¼Œæ—¢å‘¼åº” äº† Apache çš„é£æ ¼ï¼Œä¼¼ä¹ä¹Ÿé¢„ç¤ºç€ Flink æœªæ¥å°†è¦å¤§æ”¾å¼‚å½©ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205182118661.png"></p><h3 id="äºŒã€Flink-çš„åº”ç”¨"><a href="#äºŒã€Flink-çš„åº”ç”¨" class="headerlink" title="äºŒã€Flink çš„åº”ç”¨"></a>äºŒã€Flink çš„åº”ç”¨</h3><p>Flink æ˜¯ä¸€ä¸ªå¤§æ•°æ®æµå¤„ç†å¼•æ“ï¼Œå®ƒå¯ä»¥ä¸ºä¸åŒçš„è¡Œä¸šæä¾›å¤§æ•°æ®å®æ—¶å¤„ç†çš„è§£å†³æ–¹æ¡ˆã€‚ éšç€ Flink çš„å¿«é€Ÿå‘å±•å®Œå–„ï¼Œå¦‚ä»Šåœ¨ä¸–ç•ŒèŒƒå›´è®¸å¤šå…¬å¸éƒ½å¯ä»¥è§åˆ° Flink çš„èº«å½±ã€‚ ç›®å‰åœ¨å…¨çƒèŒƒå›´å†…ï¼ŒåŒ—ç¾ã€æ¬§æ´²å’Œé‡‘ç –å›½å®¶å‡æ˜¯ Flink çš„åº”ç”¨çƒ­é—¨åŒºåŸŸã€‚å½“ç„¶ï¼Œè¿™äº›åœ°åŒº å…¶å®ä¹Ÿå°±æ˜¯ ITã€äº’è”ç½‘è¡Œä¸šè¾ƒå‘è¾¾çš„åœ°åŒºã€‚ </p><p>Flink åœ¨å›½å†…çƒ­åº¦å°¤å…¶é«˜ï¼Œä¸€æ–¹é¢æ˜¯å› ä¸ºé˜¿é‡Œçš„è´¡çŒ®å’Œå¸¦å¤´æ•ˆåº”ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿè·Ÿä¸­å›½çš„åº” ç”¨åœºæ™¯å¯†åˆ‡ç›¸å…³ã€‚ä¸­å›½çš„äººå£è§„æ¨¡ä¸äº’è”ç½‘ä½¿ç”¨æ™®åŠç¨‹åº¦ï¼Œå†³å®šäº†å¯¹å¤§æ•°æ®å¤„ç†çš„é€Ÿåº¦è¦æ±‚è¶Š æ¥è¶Šé«˜ï¼Œä¹Ÿè¿«ä½¿ä¸­å›½çš„äº’è”ç½‘ä¼ä¸šå»è¿½é€æ›´é«˜çš„æ•°æ®å¤„ç†æ•ˆç‡ã€‚è¯•æƒ³åœ¨ä¸­å›½ï¼Œä¸€ä¸ªç½‘ç«™å¯èƒ½è¦ é¢å¯¹æ•°äº¿çš„æ—¥æ´»ç”¨æˆ·ã€æ¯ç§’æ•°äº¿æ¬¡çš„è®¡ç®—å³°å€¼ï¼Œè¿™å¯¹å¾ˆå¤šå›½å¤–çš„å…¬å¸æ¥è¯´æ˜¯æ— æ³•æƒ³è±¡çš„ã€‚è€Œ  Flink æ°å¥½ç»™æˆ‘ä»¬é«˜é€Ÿå‡†ç¡®çš„å¤„ç†æµ·é‡æµå¼æ•°æ®æä¾›äº†å¯èƒ½ã€‚ </p><h4 id="1ã€ä¼ä¸šä¸­çš„åº”ç”¨"><a href="#1ã€ä¼ä¸šä¸­çš„åº”ç”¨" class="headerlink" title="1ã€ä¼ä¸šä¸­çš„åº”ç”¨"></a>1ã€ä¼ä¸šä¸­çš„åº”ç”¨</h4><p>Flink ä¸ºå…¨çƒè®¸å¤šå…¬å¸å’Œä¼ä¸šçš„å…³é”®ä¸šåŠ¡åº”ç”¨æä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚ å¯¹äºæ•°æ®å¤„ç†è€Œè¨€ï¼Œä»»ä½•è¡Œä¸šã€ä»»ä½•å…¬å¸çš„éœ€æ±‚å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ï¼šæ•°æ®è§„æ¨¡å¤§ã€å®æ—¶æ€§è¦ æ±‚é«˜ã€ç¡®ä¿ç»“æœå‡†ç¡®ã€æ–¹ä¾¿æ‰©å±•ã€æ•…éšœåå¯æ¢å¤â€”â€”è€Œè¿™äº›è¦æ±‚ï¼Œä½œä¸ºæ–°ä¸€ä»£å¤§æ•°æ®æµå¼å¤„ç† å¼•æ“çš„ Flink ç»Ÿç»Ÿå¯ä»¥æ»¡è¶³ï¼è¿™ä¹Ÿæ­£æ˜¯ Flink åœ¨å…¨ä¸–ç•ŒèŒƒå›´å¾—åˆ°å¹¿æ³›åº”ç”¨çš„åŸå› ã€‚ </p><h4 id="2ã€ä¸»è¦çš„åº”ç”¨åœºæ™¯"><a href="#2ã€ä¸»è¦çš„åº”ç”¨åœºæ™¯" class="headerlink" title="2ã€ä¸»è¦çš„åº”ç”¨åœºæ™¯"></a>2ã€ä¸»è¦çš„åº”ç”¨åœºæ™¯</h4><ol><li><strong>ç”µå•†å’Œå¸‚åœºè¥é”€</strong></li></ol><p>ä¸¾ä¾‹ï¼šå®æ—¶æ•°æ®æŠ¥è¡¨ã€å¹¿å‘ŠæŠ•æ”¾ã€å®æ—¶æ¨è </p><p>åœ¨ç”µå•†è¡Œä¸šä¸­ï¼Œç½‘ç«™ç‚¹å‡»é‡æ˜¯ç»Ÿè®¡ PVã€UV çš„é‡è¦æ¥æºï¼Œä¹Ÿæ˜¯å¦‚ä»Šâ€œæµé‡ç»æµâ€çš„æœ€ä¸»è¦ æ•°æ®æŒ‡æ ‡ã€‚å¾ˆå¤šå…¬å¸çš„è¥é”€ç­–ç•¥ï¼Œæ¯”å¦‚å¹¿å‘Šçš„æŠ•æ”¾ï¼Œä¹Ÿæ˜¯åŸºäºç‚¹å‡»é‡æ¥å†³å®šçš„ã€‚å¦å¤–ï¼Œåœ¨ç½‘ç«™ä¸Šæä¾›ç»™ç”¨æˆ·çš„å®æ—¶æ¨èï¼Œå¾€å¾€ä¹Ÿæ˜¯åŸºäºå½“å‰ç”¨æˆ·çš„ç‚¹å‡»è¡Œä¸ºåšå‡ºçš„ã€‚ ç½‘ç«™è·å¾—çš„ç‚¹å‡»æ•°æ®å¯èƒ½æ˜¯è¿ç»­ä¸”ä¸å‡åŒ€çš„ï¼Œè¿˜å¯èƒ½åœ¨åŒä¸€æ—¶é—´å¤§é‡äº§ç”Ÿï¼Œè¿™æ˜¯å…¸å‹çš„æ•° æ®æµã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æŠŠå®ƒä»¬å…¨éƒ¨æ”¶é›†èµ·æ¥ï¼Œå†å»åˆ†æå¤„ç†ï¼Œå°±ä¼šé¢ä¸´å¾ˆå¤šé—®é¢˜ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬éœ€ è¦å¾ˆå¤§çš„ç©ºé—´æ¥å­˜å‚¨æ•°æ®ï¼›å…¶æ¬¡ï¼Œæ”¶é›†æ•°æ®çš„è¿‡ç¨‹è€—å»äº†å¤§é‡æ—¶é—´ï¼Œç»Ÿè®¡åˆ†æç»“æœçš„å®æ—¶æ€§å°± å¤§å¤§é™ä½äº†ï¼›å¦å¤–ï¼Œåˆ†å¸ƒå¼å¤„ç†æ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºï¼Œå¦‚æœæˆ‘ä»¬åªä»¥æ•°æ®è¿›å…¥ç³»ç»Ÿçš„æ—¶é—´ä¸ºå‡†ï¼Œ å¯èƒ½å¯¼è‡´æœ€ç»ˆç»“æœè®¡ç®—é”™è¯¯ã€‚ æˆ‘ä»¬éœ€è¦çš„æ˜¯ç›´æ¥å¤„ç†æ•°æ®æµï¼Œè€Œ Flink å°±å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ </p><ol start="2"><li><strong>ç‰©è”ç½‘ï¼ˆIOTï¼‰</strong></li></ol><p>ä¸¾ä¾‹ï¼šä¼ æ„Ÿå™¨å®æ—¶æ•°æ®é‡‡é›†å’Œæ˜¾ç¤ºã€å®æ—¶æŠ¥è­¦ï¼Œäº¤é€šè¿è¾“ä¸š </p><p>ç‰©è”ç½‘æ˜¯æµæ•°æ®è¢«æ™®éåº”ç”¨çš„é¢†åŸŸã€‚å„ç§ä¼ æ„Ÿå™¨ä¸åœè·å¾—æµ‹é‡æ•°æ®ï¼Œå¹¶å°†å®ƒä»¬ä»¥æµçš„å½¢å¼ ä¼ è¾“è‡³æ•°æ®ä¸­å¿ƒã€‚è€Œæ•°æ®ä¸­å¿ƒä¼šå°†æ•°æ®å¤„ç†åˆ†æä¹‹åï¼Œå¾—åˆ°è¿è¡ŒçŠ¶æ€æˆ–è€…æŠ¥è­¦ä¿¡æ¯ï¼Œå®æ—¶åœ°æ˜¾ ç¤ºåœ¨ç›‘æ§å±å¹•ä¸Šã€‚æ‰€ä»¥åœ¨ç‰©è”ç½‘ä¸­ï¼Œä½å»¶è¿Ÿçš„æ•°æ®ä¼ è¾“å’Œå¤„ç†ï¼Œä»¥åŠå‡†ç¡®çš„æ•°æ®åˆ†æé€šå¸¸å¾ˆå…³ é”®ã€‚ äº¤é€šè¿è¾“ä¸šä¹Ÿä½“ç°äº†æµå¤„ç†çš„é‡è¦æ€§ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚ä»Šé«˜é“è¿è¡Œä¸»è¦å°±æ˜¯ä¾é ä¼ æ„Ÿå™¨æ£€æµ‹æ•° æ®ï¼Œæµ‹é‡æ•°æ®åŒ…æ‹¬åˆ—è½¦çš„é€Ÿåº¦å’Œä½ç½®ï¼Œä»¥åŠè½¨é“å‘¨è¾¹çš„çŠ¶å†µã€‚è¿™äº›æ•°æ®ä¼šä»è½¨é“ä¼ ç»™åˆ—è½¦ï¼Œå† ä»åˆ—è½¦ä¼ åˆ°æ²¿é€”çš„å…¶ä»–ä¼ æ„Ÿå™¨ï¼›ä¸æ­¤åŒæ—¶ï¼Œæ•°æ®æŠ¥å‘Šä¹Ÿè¢«å‘é€å›æ§åˆ¶ä¸­å¿ƒã€‚å› ä¸ºåˆ—è½¦å¤„äºé«˜é€Ÿ è¡Œé©¶çŠ¶æ€ï¼Œå› æ­¤æ•°æ®å¤„ç†çš„å®æ—¶æ€§è¦æ±‚æ˜¯æé«˜çš„ã€‚å¦‚æœæµæ•°æ®æ²¡æœ‰è¢«åŠæ—¶æ­£ç¡®å¤„ç†ï¼Œè°ƒæ•´æ„è§ å’Œè­¦å‘Šå°±ä¸èƒ½ç›¸åº”äº§ç”Ÿï¼Œåæœå¯èƒ½ä¼šéå¸¸ä¸¥é‡ã€‚ </p><ol start="3"><li><strong>ç‰©æµé…é€å’ŒæœåŠ¡ä¸š</strong></li></ol><p>ä¸¾ä¾‹ï¼šè®¢å•çŠ¶æ€å®æ—¶æ›´æ–°ã€é€šçŸ¥ä¿¡æ¯æ¨é€ </p><p>åœ¨å¾ˆå¤šæœåŠ¡å‹åº”ç”¨ä¸­ï¼Œéƒ½ä¼šæ¶‰åŠè®¢å•çŠ¶æ€çš„æ›´æ–°å’Œé€šçŸ¥çš„æ¨é€ã€‚è¿™äº›ä¿¡æ¯åŸºäºäº‹ä»¶è§¦å‘ï¼Œ ä¸å‡åŒ€åœ°è¿ç»­ä¸æ–­ç”Ÿæˆï¼Œå¤„ç†ä¹‹åéœ€è¦åŠæ—¶ä¼ é€’ç»™ç”¨æˆ·ã€‚è¿™ä¹Ÿæ˜¯éå¸¸å…¸å‹çš„æ•°æ®æµçš„å¤„ç†ã€‚ </p><ol start="4"><li><strong>é“¶è¡Œå’Œé‡‘èä¸š</strong></li></ol><p>ä¸¾ä¾‹ï¼šå®æ—¶ç»“ç®—å’Œé€šçŸ¥æ¨é€ï¼Œå®æ—¶æ£€æµ‹å¼‚å¸¸è¡Œä¸º </p><p>é“¶è¡Œå’Œé‡‘èä¸šæ˜¯å¦ä¸€ä¸ªå…¸å‹çš„åº”ç”¨è¡Œä¸šã€‚ç”¨æˆ·çš„äº¤æ˜“è¡Œä¸ºæ˜¯è¿ç»­å¤§é‡å‘ç”Ÿçš„ï¼Œé“¶è¡Œé¢å¯¹çš„ æ˜¯æµ·é‡çš„æµå¼æ•°æ®ã€‚ç”±äºè¦å¤„ç†çš„äº¤æ˜“æ•°æ®é‡å¤ªå¤§ï¼Œä»¥å‰çš„é“¶è¡Œæ˜¯æŒ‰å¤©ç»“ç®—çš„ï¼Œæ±‡æ¬¾ä¸€èˆ¬éƒ½è¦ éš”å¤©æ‰èƒ½åˆ°è´¦ã€‚æ‰€ä»¥æœ‰ä¸€ä¸ªè¯´æ³•å«ä½œâ€œé“¶è¡Œå®¶å·¥ä½œæ—¶é—´â€ï¼Œè¯´çš„å°±æ˜¯é“¶è¡Œå®¶ä¸ä»…ä¸éœ€è¦ 996ï¼Œç”š è‡³ä¸‹åˆæ—©æ—©å°±ä¸‹ç­äº†ï¼šå› ä¸ºé“¶è¡Œéœ€è¦æ—©ç‚¹å…³é—¨è¿›è¡Œç»“ç®—ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ç¬¬äºŒå¤©è¥ä¸šä¹‹å‰ç®—å‡ºå‡† ç¡®çš„è´¦ã€‚è¿™æ˜¾ç„¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬å¿«é€Ÿäº¤æ˜“çš„éœ€æ±‚ã€‚åœ¨å…¨çƒåŒ–ç»æµä¸­ï¼Œèƒ½å¤Ÿæä¾› 24 å°æ—¶æœåŠ¡å˜å¾— è¶Šæ¥è¶Šé‡è¦ã€‚ç°åœ¨äº¤æ˜“å’ŒæŠ¥è¡¨éƒ½ä¼šå¿«é€Ÿå‡†ç¡®åœ°ç”Ÿæˆï¼Œæˆ‘ä»¬è·¨è¡Œè½¬è´¦ä¹Ÿå¯ä»¥åšåˆ°ç¬é—´åˆ°è´¦ï¼Œè¿˜å¯ä»¥æ¥åˆ°å®æ—¶çš„æ¨é€é€šçŸ¥ã€‚è¿™å°±éœ€è¦æˆ‘ä»¬èƒ½å¤Ÿå®æ—¶å¤„ç†æ•°æ®æµã€‚ å¦å¤–ï¼Œä¿¡ç”¨å¡æ¬ºè¯ˆçš„æ£€æµ‹ä¹Ÿéœ€è¦åŠæ—¶çš„ç›‘æ§å’ŒæŠ¥è­¦ã€‚ä¸€äº›é‡‘èäº¤æ˜“å¸‚åœºï¼Œå¯¹å¼‚å¸¸äº¤æ˜“è¡Œä¸º çš„åŠæ—¶æ£€æµ‹å¯ä»¥æ›´å¥½åœ°è¿›è¡Œé£é™©æ§åˆ¶ï¼›è¿˜å¯ä»¥å¯¹å¼‚å¸¸ç™»å½•è¿›è¡Œæ£€æµ‹ï¼Œä»è€Œå‘ç°é’“é±¼å¼æ”»å‡»ï¼Œä» è€Œé¿å…å·¨å¤§çš„æŸå¤±ã€‚</p><h3 id="ä¸‰ã€æµå¼è®¡ç®—æ¼”å˜"><a href="#ä¸‰ã€æµå¼è®¡ç®—æ¼”å˜" class="headerlink" title="ä¸‰ã€æµå¼è®¡ç®—æ¼”å˜"></a>ä¸‰ã€æµå¼è®¡ç®—æ¼”å˜</h3><p>æˆ‘ä»¬å·²ç»äº†è§£ï¼ŒFlink çš„ä¸»è¦åº”ç”¨åœºæ™¯ï¼Œå°±æ˜¯ <font color="red">å¤„ç†å¤§è§„æ¨¡çš„æ•°æ®æµ</font>ã€‚é‚£ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨ Flink å‘¢ï¼Ÿæ•°æ®å¤„ç†è¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„æ–¹å¼ï¼Ÿè¦è§£ç­”è¿™ä¸ªç–‘æƒ‘ï¼Œæˆ‘ä»¬å°±éœ€è¦å…ˆä»æµå¤„ç†å’Œæ‰¹å¤„ç†çš„æ¦‚å¿µ è®²èµ·ã€‚ </p><h4 id="1ã€æµå¤„ç†å’Œæ‰¹å¤„ç†"><a href="#1ã€æµå¤„ç†å’Œæ‰¹å¤„ç†" class="headerlink" title="1ã€æµå¤„ç†å’Œæ‰¹å¤„ç†"></a>1ã€æµå¤„ç†å’Œæ‰¹å¤„ç†</h4><p>æ•°æ®å¤„ç†æœ‰ä¸åŒçš„æ–¹å¼ã€‚ </p><p>å¯¹äºå…·ä½“åº”ç”¨æ¥è¯´ï¼Œæœ‰äº›åœºæ™¯æ•°æ®æ˜¯ä¸€ä¸ªä¸€ä¸ªæ¥çš„ï¼Œæ˜¯ä¸€ç»„æœ‰åºçš„æ•°æ®åºåˆ—ï¼Œæˆ‘ä»¬æŠŠå®ƒå«ä½œâ€œæ•°æ®æµâ€ï¼›è€Œæœ‰äº›åœºæ™¯çš„æ•°æ®ï¼Œæœ¬èº«å°±æ˜¯ä¸€æ‰¹åŒæ—¶åˆ°æ¥ï¼Œæ˜¯ä¸€ä¸ªæœ‰é™çš„æ•°æ®é›†ï¼Œè¿™å°±æ˜¯æ‰¹é‡æ•°æ®ï¼ˆæœ‰æ—¶ä¹Ÿç›´æ¥å«æ•°æ®é›†ï¼‰ã€‚ </p><p>å®¹æ˜“æƒ³åˆ°ï¼Œå¤„ç†æ•°æ®æµï¼Œå½“ç„¶åº”è¯¥â€œæ¥ä¸€ä¸ªå°±å¤„ç†ä¸€ä¸ªâ€ï¼Œè¿™ç§æ•°æ®å¤„ç†æ¨¡å¼å°±å«ä½œæµå¤„ç†ï¼›å› ä¸ºè¿™ç§å¤„ç†æ˜¯å³æ—¶çš„ï¼Œæ‰€ä»¥ä¹Ÿå«å®æ—¶å¤„ç†ã€‚ä¸ä¹‹å¯¹åº”ï¼Œå¤„ç†æ‰¹é‡æ•°æ®è‡ªç„¶å°±åº”è¯¥ä¸€æ‰¹è¯»å…¥ã€ä¸€èµ·è®¡ç®—ï¼Œè¿™ç§æ–¹å¼å°±å«ä½œ<font color="red">æ‰¹å¤„ç†ï¼Œä¹Ÿå«ä½œç¦»çº¿å¤„ç†</font>ã€‚ </p><p>é‚£çœŸå®çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œåˆ°åº•æ˜¯æ•°æ®æµæ›´å¸¸è§ã€è¿˜æ˜¯æ‰¹é‡æ•°æ®æ›´å¸¸è§å‘¢ï¼Ÿ </p><p>ç”Ÿæ´»ä¸­ï¼Œè¿™ä¸¤ç§å½¢å¼çš„æ•°æ®éƒ½æœ‰ï¼Œå¦‚å›¾ 1-4 æ‰€ç¤ºã€‚æ¯”å¦‚æˆ‘ä»¬æ—¥å¸¸å‘ä¿¡æ¯ï¼Œå¯ä»¥ä¸€å¥ä¸€å¥åœ° è¯´ï¼Œä¹Ÿå¯ä»¥å†™ä¸€å¤§æ®µä¸€èµ·å‘è¿‡å»ã€‚ä¸€å¥ä¸€å¥çš„ä¿¡æ¯ï¼Œå°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„æ•°æ®ï¼Œå®ƒä»¬æ„æˆçš„åºåˆ—å°±æ˜¯ä¸€ä¸ªæ•°æ®æµï¼›è€Œä¸€å¤§æ®µä¿¡æ¯ï¼Œæ˜¯ä¸€ç»„æ•°æ®çš„é›†åˆï¼Œå¯¹åº”å°±æ˜¯æ‰¹é‡æ•°æ®ï¼ˆæ•°æ®é›†ï¼‰ã€‚ </p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205182129352.png"></p><p>å½“ç„¶ï¼Œæœ‰ç»éªŒçš„äººéƒ½ä¼šçŸ¥é“ï¼Œä¸€å¥ä¸€å¥åœ°å‘ï¼Œä½ ä¸€è¨€æˆ‘ä¸€è¯­ï¼Œæœ‰æ¥æœ‰å¾€è¿™æ‰å«èŠå¤©ï¼›ä¸€å¤§ æ®µä¿¡æ¯ç›´æ¥ç ¸è¿‡å»ï¼Œåˆ«äººçœ‹ç€éƒ½çœ¼æ™•ï¼Œå¾ˆå®¹æ˜“å°±æ²¡ä¸‹æ–‡äº†â€”â€”å¦‚æœæ˜¯å¾ˆé‡è¦çš„æ•´ç¯‡å†…å®¹ï¼ˆæ¯”å¦‚ è¡¨ç™½ä¿¡ï¼‰ï¼Œå†™æˆæ–‡æ¡£æˆ–è€…é‚®ä»¶å‘è¿‡å»å¯èƒ½æ•ˆæœä¼šæ›´å¥½ã€‚ æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°ï¼Œâ€œèŠå¤©â€è¿™ä¸ªç”Ÿæ´»åœºæ™¯ï¼Œæ•°æ®çš„ç”Ÿæˆã€ä¼ é€’å’Œæ¥æ”¶å¤„ç†ï¼Œéƒ½æ˜¯æµå¼çš„ï¼›è€Œ â€œå†™ä¿¡â€çš„åœºæ™¯ï¼Œæ•°æ®çš„ç”Ÿæˆå°½ç®¡åº”è¯¥ä¹Ÿæ˜¯æµå¼çš„ï¼ˆå­—æ€»å¾—ä¸€ä¸ªä¸ªå†™ï¼‰ï¼Œä½†æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æ”¶é›†èµ·æ¥ï¼Œç»Ÿä¸€ä¼ è¾“ã€ç»Ÿä¸€å¤„ç†ï¼ˆå½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥è¾ƒçœŸï¼šå¤„ç†ä¹Ÿæ˜¯æµå¼çš„ï¼Œå­—å¾—ä¸€ä¸ªä¸€ä¸ªè¯»ï¼‰ã€‚ ä¸è®ºä¼ è¾“å¤„ç†çš„æ–¹å¼æ˜¯æ€æ ·çš„ï¼Œæ•°æ®çš„ç”Ÿæˆï¼Œä¸€èˆ¬éƒ½æ˜¯æµå¼çš„ã€‚ </p><h4 id="2ã€ä¼ ç»Ÿäº‹åŠ¡å¤„ç†"><a href="#2ã€ä¼ ç»Ÿäº‹åŠ¡å¤„ç†" class="headerlink" title="2ã€ä¼ ç»Ÿäº‹åŠ¡å¤„ç†"></a>2ã€ä¼ ç»Ÿäº‹åŠ¡å¤„ç†</h4><p>IT äº’è”ç½‘å…¬å¸å¾€å¾€ä¼šç”¨ä¸åŒçš„åº”ç”¨ç¨‹åºæ¥å¤„ç†å„ç§ä¸šåŠ¡ã€‚æ¯”å¦‚å†…éƒ¨ä½¿ç”¨çš„ä¼ä¸šèµ„æºè§„åˆ’ ï¼ˆERPï¼‰ç³»ç»Ÿã€å®¢æˆ·å…³ç³»ç®¡ç†ï¼ˆCRMï¼‰ç³»ç»Ÿï¼Œè¿˜æœ‰é¢å‘å®¢æˆ·çš„ Web åº”ç”¨ç¨‹åºã€‚è¿™äº›ç³»ç»Ÿä¸€èˆ¬éƒ½ ä¼šè¿›è¡Œåˆ†å±‚è®¾è®¡ï¼šâ€œè®¡ç®—å±‚â€å°±æ˜¯åº”ç”¨ç¨‹åºæœ¬èº«ï¼Œç”¨äºæ•°æ®è®¡ç®—å’Œå¤„ç†ï¼›è€Œâ€œå­˜å‚¨å±‚â€å¾€å¾€æ˜¯ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼Œç”¨äºæ•°æ®å­˜å‚¨ï¼Œå¦‚å›¾</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205182136879.png"></p><p>æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œçš„åº”ç”¨ç¨‹åºåœ¨å¤„ç†æ•°æ®çš„æ¨¡å¼ä¸Šæœ‰å…±åŒä¹‹å¤„ï¼šæ¥æ”¶çš„æ•°æ®æ˜¯æŒç»­ç”Ÿæˆçš„äº‹ ä»¶ï¼Œæ¯”å¦‚ç”¨æˆ·çš„ç‚¹å‡»è¡Œä¸ºï¼Œå®¢æˆ·ä¸‹çš„è®¢å•ï¼Œæˆ–è€…æ“ä½œäººå‘˜å‘å‡ºçš„è¯·æ±‚ã€‚å¤„ç†äº‹ä»¶æ—¶ï¼Œåº”ç”¨ç¨‹åº éœ€è¦å…ˆè¯»å–è¿œç¨‹æ•°æ®åº“çš„çŠ¶æ€ï¼Œç„¶åæŒ‰ç…§å¤„ç†é€»è¾‘å¾—åˆ°ç»“æœï¼Œå°†å“åº”è¿”å›ç»™ç”¨æˆ·ï¼Œå¹¶æ›´æ–°æ•°æ®åº“çŠ¶æ€ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªæ•°æ®åº“ç³»ç»Ÿå¯ä»¥æœåŠ¡äºå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒä»¬æœ‰æ—¶ä¼šè®¿é—®ç›¸åŒçš„æ•°æ®åº“æˆ–è¡¨</p><p>å¯¹äºå„ç§äº‹ä»¶è¯·æ±‚ï¼Œäº‹åŠ¡å¤„ç†çš„æ–¹å¼èƒ½å¤Ÿä¿è¯å®æ—¶å“åº”ï¼Œå¥½å¤„æ˜¯ä¸€ç›®äº†ç„¶çš„ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œè¿™æ ·çš„æ¶æ„å¯¹è¡¨å’Œæ•°æ®åº“çš„è®¾è®¡è¦æ±‚å¾ˆé«˜ï¼›å½“æ•°æ®è§„æ¨¡è¶Šæ¥è¶Šåºå¤§ã€ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚æ—¶ï¼Œå¯èƒ½éœ€è¦å¯¹è¡¨è¿›è¡Œé‡æ„ï¼Œè€Œä¸”ä¸€æ¬¡è”è¡¨æŸ¥è¯¢ä¹Ÿä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ï¼Œç”šè‡³ä¸èƒ½åŠæ—¶å¾—åˆ°è¿”å›ç»“æœã€‚äºæ˜¯ï¼Œä½œä¸ºç¨‹åºå‘˜å°±åªå¥½å°†æ›´å¤šçš„ç²¾åŠ›æ”¾åœ¨è¡¨çš„è®¾è®¡å’Œé‡æ„ï¼Œä»¥åŠ SQL çš„è°ƒä¼˜ä¸Šï¼Œè€Œæ— æ³•ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°äº†â€”â€”æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè¿™ç§å·¥ä½œè´¹åŠ›è´¹æ—¶ï¼Œå´æ²¡æ³•ç›´æ¥ä½“ç°åœ¨äº§å“ä¸Šç»™è€æ¿çœ‹ï¼Œç®€ç›´å°±æ˜¯å™©æ¢¦ã€‚</p><p>é‚£æœ‰æ²¡æœ‰æ›´åˆç†ã€æ›´é«˜æ•ˆçš„å¤„ç†æ¶æ„å‘¢ï¼Ÿ<strong>â†“</strong></p><h4 id="3ã€æœ‰çŠ¶æ€çš„æµå¤„ç†"><a href="#3ã€æœ‰çŠ¶æ€çš„æµå¤„ç†" class="headerlink" title="3ã€æœ‰çŠ¶æ€çš„æµå¤„ç†"></a>3ã€æœ‰çŠ¶æ€çš„æµå¤„ç†</h4><p>ä¸éš¾æƒ³åˆ°ï¼Œå¦‚æœæˆ‘ä»¬å¯¹äºäº‹ä»¶æµçš„å¤„ç†éå¸¸ç®€å•ï¼Œä¾‹å¦‚æ”¶åˆ°ä¸€æ¡è¯·æ±‚å°±è¿”å›ä¸€ä¸ªâ€œæ”¶åˆ°â€ï¼Œé‚£å°±å¯ä»¥çœå»æ•°æ®åº“çš„æŸ¥è¯¢å’Œæ›´æ–°äº†ã€‚ä½†æ˜¯è¿™æ ·çš„å¤„ç†æ˜¯æ²¡ä»€ä¹ˆå®é™…æ„ä¹‰çš„ã€‚åœ¨ç°å®çš„åº”ç”¨ä¸­ï¼Œå¾€å¾€éœ€è¦è¿˜å…¶ä»–ä¸€äº›é¢å¤–æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥æŠŠéœ€è¦çš„é¢å¤–æ•°æ®ä¿å­˜æˆä¸€ä¸ªâ€œçŠ¶æ€â€ï¼Œç„¶åé’ˆå¯¹è¿™æ¡æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”æ›´æ–°çŠ¶æ€ã€‚åœ¨ä¼ ç»Ÿæ¶æ„ä¸­ï¼Œè¿™ä¸ªçŠ¶æ€å°±æ˜¯ä¿å­˜åœ¨æ•°æ®åº“é‡Œçš„ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œæœ‰çŠ¶æ€çš„æµå¤„ç†â€ã€‚ </p><p>ä¸ºäº†åŠ å¿«è®¿é—®é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†çŠ¶æ€ä¿å­˜åœ¨æœ¬åœ°å†…å­˜ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205182141239.png"></p><p>å½“åº”ç”¨æ”¶åˆ°ä¸€ä¸ªæ–°äº‹ä»¶æ—¶ï¼Œå®ƒå¯ä»¥ä»çŠ¶æ€ä¸­è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ›´æ–°çŠ¶æ€ã€‚è€Œå½“çŠ¶æ€æ˜¯ä»å†…å­˜ä¸­è¯»å†™çš„æ—¶å€™ï¼Œè¿™å°±å’Œè®¿é—®æœ¬åœ°å˜é‡æ²¡ä»€ä¹ˆåŒºåˆ«äº†ï¼Œå®æ—¶æ€§å¯ä»¥å¾—åˆ°æå¤§çš„æå‡ã€‚ å¦å¤–ï¼Œæ•°æ®è§„æ¨¡å¢å¤§æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦åšé‡æ„ï¼Œåªéœ€è¦æ„å»ºåˆ†å¸ƒå¼é›†ç¾¤ï¼Œå„è‡ªåœ¨æœ¬åœ°è®¡ç®—å°±å¯ä»¥äº†ï¼Œå¯æ‰©å±•æ€§ä¹Ÿå˜å¾—æ›´å¥½ã€‚</p><p>å› ä¸ºé‡‡ç”¨çš„æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¿æŠ¤æœ¬åœ°çŠ¶æ€ï¼Œé˜²æ­¢åœ¨æ•…éšœæ—¶æ•°æ®ä¸¢å¤±ã€‚æˆ‘ä»¬å¯ä»¥å®šæœŸåœ°å°†åº”ç”¨çŠ¶æ€çš„ä¸€è‡´æ€§æ£€æŸ¥ç‚¹ï¼ˆcheckpointï¼‰å­˜ç›˜ï¼Œå†™å…¥è¿œç¨‹çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œé‡åˆ°æ•…éšœæ—¶å†å»è¯»å–è¿›è¡Œæ¢å¤ï¼Œè¿™æ ·å°±ä¿è¯äº†æ›´å¥½çš„å®¹é”™æ€§ã€‚ </p><h5 id=""><a href="#" class="headerlink" title=""></a></h5><h4 id="4ã€æœ‰çŠ¶æ€æµæ¶æ„"><a href="#4ã€æœ‰çŠ¶æ€æµæ¶æ„" class="headerlink" title="4ã€æœ‰çŠ¶æ€æµæ¶æ„"></a>4ã€æœ‰çŠ¶æ€æµæ¶æ„</h4><h5 id="1ã€äº‹ä»¶é©±åŠ¨å‹ï¼ˆEvent-Drivenï¼‰åº”ç”¨"><a href="#1ã€äº‹ä»¶é©±åŠ¨å‹ï¼ˆEvent-Drivenï¼‰åº”ç”¨" class="headerlink" title="1ã€äº‹ä»¶é©±åŠ¨å‹ï¼ˆEvent-Drivenï¼‰åº”ç”¨"></a>1ã€äº‹ä»¶é©±åŠ¨å‹ï¼ˆEvent-Drivenï¼‰åº”ç”¨</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205182143210.png"></p><ul><li>äº‹ä»¶é©±åŠ¨å‹åº”ç”¨æ˜¯ä¸€ç±»å…·æœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œå®ƒä»ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶æµæå–æ•°æ®ï¼Œå¹¶æ ¹æ®åˆ°æ¥çš„ </li></ul><p>äº‹ä»¶è§¦å‘è®¡ç®—ã€çŠ¶æ€æ›´æ–°æˆ–å…¶ä»–å¤–éƒ¨åŠ¨ä½œã€‚æ¯”è¾ƒå…¸å‹çš„å°±æ˜¯ä»¥ Kafka ä¸ºä»£è¡¨çš„æ¶ˆæ¯é˜Ÿåˆ—å‡ ä¹éƒ½ </p><p>æ˜¯äº‹ä»¶é©±åŠ¨å‹åº”ç”¨ã€‚ </p><ul><li>è¿™å…¶å®è·Ÿä¼ ç»Ÿäº‹åŠ¡å¤„ç†æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºåŸºäºæœ‰çŠ¶æ€æµå¤„ç†çš„äº‹ä»¶é©±åŠ¨åº”ç”¨ï¼Œä¸ </li></ul><p>å†éœ€è¦æŸ¥è¯¢è¿œç¨‹æ•°æ®åº“ï¼Œè€Œæ˜¯åœ¨æœ¬åœ°è®¿é—®å®ƒä»¬çš„æ•°æ®ï¼Œå¦‚å›¾ä¸Šæ‰€ç¤ºï¼Œè¿™æ ·åœ¨ååé‡å’Œå»¶è¿Ÿæ–¹ </p><p>é¢å°±å¯ä»¥æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚ </p><ul><li>å¦å¤–è¿œç¨‹æŒä¹…æ€§å­˜å‚¨çš„æ£€æŸ¥ç‚¹ä¿è¯äº†åº”ç”¨å¯ä»¥ä»æ•…éšœä¸­æ¢å¤ã€‚æ£€æŸ¥ç‚¹å¯ä»¥å¼‚æ­¥å’Œå¢é‡åœ°å®Œ </li></ul><p>æˆï¼Œå› æ­¤å¯¹æ­£å¸¸è®¡ç®—çš„å½±å“éå¸¸å°</p><h5 id="-1"><a href="#-1" class="headerlink" title=""></a></h5><h5 id="2ã€æ•°æ®åˆ†æï¼ˆData-Analysisï¼‰å‹åº”ç”¨"><a href="#2ã€æ•°æ®åˆ†æï¼ˆData-Analysisï¼‰å‹åº”ç”¨" class="headerlink" title="2ã€æ•°æ®åˆ†æï¼ˆData Analysisï¼‰å‹åº”ç”¨"></a>2ã€æ•°æ®åˆ†æï¼ˆData Analysisï¼‰å‹åº”ç”¨</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205182152243.png"></p><ul><li>æ‰€è°“çš„æ•°æ®åˆ†æï¼Œå°±æ˜¯ä»åŸå§‹æ•°æ®ä¸­æå–ä¿¡æ¯å’Œå‘æ˜è§„å¾‹ã€‚ä¼ ç»Ÿä¸Šï¼Œæ•°æ®åˆ†æä¸€èˆ¬æ˜¯å…ˆå°† </li></ul><p>æ•°æ®å¤åˆ¶åˆ°æ•°æ®ä»“åº“ï¼ˆData Warehouseï¼‰ï¼Œç„¶åè¿›è¡Œæ‰¹é‡æŸ¥è¯¢ã€‚å¦‚æœæ•°æ®æœ‰äº†æ›´æ–°ï¼Œå¿…é¡»å°†æœ€ </p><p>æ–°æ•°æ®æ·»åŠ åˆ°è¦åˆ†æçš„æ•°æ®é›†ä¸­ï¼Œç„¶åé‡æ–°è¿è¡ŒæŸ¥è¯¢æˆ–åº”ç”¨ç¨‹åºã€‚ </p><ul><li>å¦‚ä»Šï¼ŒApache Hadoop ç”Ÿæ€ç³»ç»Ÿçš„ç»„ä»¶ï¼Œå·²ç»æ˜¯è®¸å¤šä¼ä¸šå¤§æ•°æ®æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„ç»„æˆéƒ¨ </li></ul><p>åˆ†ã€‚ç°åœ¨çš„åšæ³•ä¸€èˆ¬æ˜¯å°†å¤§é‡æ•°æ®ï¼ˆå¦‚æ—¥å¿—æ–‡ä»¶ï¼‰å†™å…¥ Hadoop çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆHDFSï¼‰ã€ </p><p>S3 æˆ– HBase ç­‰æ‰¹é‡å­˜å‚¨æ•°æ®åº“ï¼Œä»¥è¾ƒä½çš„æˆæœ¬è¿›è¡Œå¤§å®¹é‡å­˜å‚¨ã€‚ç„¶åå¯ä»¥é€šè¿‡ SQL-on-Hadoop </p><p>ç±»çš„å¼•æ“æŸ¥è¯¢å’Œå¤„ç†æ•°æ®ï¼Œæ¯”å¦‚å¤§å®¶ç†Ÿæ‚‰çš„ Hiveã€‚è¿™ç§å¤„ç†æ–¹å¼ï¼Œæ˜¯å…¸å‹çš„æ‰¹å¤„ç†ï¼Œç‰¹ç‚¹æ˜¯ </p><p>å¯ä»¥å¤„ç†æµ·é‡æ•°æ®ï¼Œä½†å®æ—¶æ€§è¾ƒå·®ï¼Œæ‰€ä»¥ä¹Ÿå«ç¦»çº¿åˆ†æã€‚ </p><ul><li>å¦‚æœæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå¤æ‚çš„æµå¤„ç†å¼•æ“ï¼Œæ•°æ®åˆ†æå…¶å®ä¹Ÿå¯ä»¥å®æ—¶æ‰§è¡Œã€‚æµå¼æŸ¥è¯¢æˆ–åº”ç”¨ç¨‹ </li></ul><p>åºä¸æ˜¯è¯»å–æœ‰é™çš„æ•°æ®é›†ï¼Œè€Œæ˜¯æ¥æ”¶å®æ—¶äº‹ä»¶æµï¼Œä¸æ–­ç”Ÿæˆå’Œæ›´æ–°ç»“æœã€‚ç»“æœè¦ä¹ˆå†™å…¥å¤–éƒ¨æ•° </p><p>æ®åº“ï¼Œè¦ä¹ˆä½œä¸ºå†…éƒ¨çŠ¶æ€è¿›è¡Œç»´æŠ¤ã€‚ </p><ul><li><p>Apache Flink åŒæ—¶æ”¯æŒæµå¼ä¸æ‰¹å¤„ç†çš„æ•°æ®åˆ†æåº”ç”¨</p></li><li><p>ä¸æ‰¹å¤„ç†åˆ†æç›¸æ¯”ï¼Œæµå¤„ç†åˆ†ææœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯ä½å»¶è¿Ÿï¼ŒçœŸæ­£å®ç°äº†å®æ—¶ã€‚å¦å¤–ï¼Œæµå¤„ç† </p></li></ul><p>ä¸éœ€è¦å»å•ç‹¬è€ƒè™‘æ–°æ•°æ®çš„å¯¼å…¥å’Œå¤„ç†ï¼Œå®æ—¶æ›´æ–°æœ¬æ¥å°±æ˜¯æµå¤„ç†çš„åŸºæœ¬æ¨¡å¼ã€‚å½“å‰ä¼ä¸šå¯¹æµ </p><p>å¼æ•°æ®å¤„ç†çš„ä¸€ä¸ªçƒ­ç‚¹åº”ç”¨å°±æ˜¯å®æ—¶æ•°ä»“ï¼Œå¾ˆå¤šå…¬å¸æ­£æ˜¯åŸºäº Flink æ¥å®ç°çš„ã€‚ </p><h5 id="3ã€æ•°æ®ç®¡é“ï¼ˆData-Pipelineï¼‰å‹åº”ç”¨"><a href="#3ã€æ•°æ®ç®¡é“ï¼ˆData-Pipelineï¼‰å‹åº”ç”¨" class="headerlink" title="3ã€æ•°æ®ç®¡é“ï¼ˆData Pipelineï¼‰å‹åº”ç”¨"></a>3ã€æ•°æ®ç®¡é“ï¼ˆData Pipelineï¼‰å‹åº”ç”¨</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205182155443.png"></p><ul><li><p>å¦‚å›¾ï¼ŒETL ä¸æ•°æ®ç®¡é“ä¹‹é—´çš„åŒºåˆ«</p></li><li><p>ETL ä¹Ÿå°±æ˜¯æ•°æ®çš„æå–ã€è½¬æ¢ã€åŠ è½½ï¼Œæ˜¯åœ¨å­˜å‚¨ç³»ç»Ÿä¹‹é—´è½¬æ¢å’Œç§»åŠ¨æ•°æ®çš„å¸¸ç”¨æ–¹æ³•ã€‚ </p></li></ul><p>åœ¨æ•°æ®åˆ†æçš„åº”ç”¨ä¸­ï¼Œé€šå¸¸ä¼šå®šæœŸè§¦å‘ ETL ä»»åŠ¡ï¼Œå°†æ•°æ®ä»äº‹åŠ¡æ•°æ®åº“ç³»ç»Ÿå¤åˆ¶åˆ°åˆ†ææ•°æ® </p><p>åº“æˆ–æ•°æ®ä»“åº“ã€‚ </p><ul><li>æ‰€è°“æ•°æ®ç®¡é“çš„ä½œç”¨ä¸ ETL ç±»ä¼¼ã€‚å®ƒä»¬å¯ä»¥è½¬æ¢å’Œæ‰©å±•æ•°æ®ï¼Œä¹Ÿå¯ä»¥åœ¨å­˜å‚¨ç³»ç»Ÿä¹‹é—´ç§» </li></ul><p>åŠ¨æ•°æ®ã€‚ä¸è¿‡å¦‚æœæˆ‘ä»¬ç”¨æµå¤„ç†æ¶æ„æ¥æ­å»ºæ•°æ®ç®¡é“ï¼Œè¿™äº›å·¥ä½œå°±å¯ä»¥è¿ç»­è¿è¡Œï¼Œè€Œä¸éœ€è¦å† </p><p>å»å‘¨æœŸæ€§è§¦å‘äº†ã€‚æ¯”å¦‚ï¼Œæ•°æ®ç®¡é“å¯ä»¥ç”¨æ¥ç›‘æ§æ–‡ä»¶ç³»ç»Ÿç›®å½•ä¸­çš„æ–°æ–‡ä»¶ï¼Œå°†æ•°æ®å†™å…¥äº‹ä»¶æ—¥</p><p>å¿—ã€‚è¿ç»­æ•°æ®ç®¡é“çš„æ˜æ˜¾ä¼˜åŠ¿æ˜¯å‡å°‘äº†å°†æ•°æ®ç§»åŠ¨åˆ°ç›®çš„åœ°çš„å»¶è¿Ÿï¼Œè€Œä¸”æ›´åŠ é€šç”¨ï¼Œå¯ä»¥ç”¨äº </p><p>æ›´å¤šçš„åœºæ™¯ã€‚</p><h5 id="4ã€Lambda-æ¶æ„"><a href="#4ã€Lambda-æ¶æ„" class="headerlink" title="4ã€Lambda æ¶æ„"></a>4ã€Lambda æ¶æ„</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205182156240.png"></p><ul><li>å¯¹äºæœ‰çŠ¶æ€çš„æµå¤„ç†ï¼Œå½“æ•°æ®è¶Šæ¥è¶Šå¤šæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»ç”¨åˆ†å¸ƒå¼çš„é›†ç¾¤æ¶æ„æ¥è·å–æ›´å¤§çš„å </li></ul><p>åé‡ã€‚ä½†æ˜¯åˆ†å¸ƒå¼æ¶æ„ä¼šå¸¦æ¥å¦ä¸€ä¸ªé—®é¢˜ï¼šæ€æ ·ä¿è¯æ•°æ®å¤„ç†çš„é¡ºåºæ˜¯æ­£ç¡®çš„å‘¢ï¼Ÿ </p><ul><li>å¯¹äºæ‰¹å¤„ç†æ¥è¯´ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å› ä¸ºæ‰€æœ‰æ•°æ®éƒ½å·²æ”¶é›†å®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦é€‰ </li></ul><p>æ‹©ã€æ’åˆ—æ•°æ®ï¼Œå¾—åˆ°æƒ³è¦çš„ç»“æœã€‚å¯å¦‚æœæˆ‘ä»¬é‡‡ç”¨â€œæ¥ä¸€ä¸ªå¤„ç†ä¸€ä¸ªâ€çš„æµå¤„ç†ï¼Œå°±å¯èƒ½å‡ºç° </p><p>â€œä¹±åºâ€çš„ç°è±¡ï¼šæœ¬æ¥å…ˆå‘ç”Ÿçš„äº‹ä»¶ï¼Œå› ä¸ºåˆ†å¸ƒå¤„ç†çš„åŸå› æ»åäº†ã€‚æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ </p><ul><li>ä»¥ Storm ä¸ºä»£è¡¨çš„ç¬¬ä¸€ä»£åˆ†å¸ƒå¼å¼€æºæµå¤„ç†å™¨ï¼Œä¸»è¦ä¸“æ³¨äºå…·æœ‰æ¯«ç§’å»¶è¿Ÿçš„äº‹ä»¶å¤„ç†ï¼Œç‰¹ </li></ul><p>ç‚¹å°±æ˜¯ä¸€ä¸ªå­—â€œå¿«â€ï¼›è€Œå¯¹äºå‡†ç¡®æ€§å’Œç»“æœçš„ä¸€è‡´æ€§ï¼Œæ˜¯ä¸æä¾›å†…ç½®æ”¯æŒçš„ï¼Œå› ä¸ºç»“æœæœ‰å¯èƒ½ </p><p>å–å†³äºåˆ°è¾¾äº‹ä»¶çš„æ—¶é—´å’Œé¡ºåºã€‚å¦å¤–ï¼Œç¬¬ä¸€ä»£æµå¤„ç†å™¨é€šè¿‡æ£€æŸ¥ç‚¹æ¥ä¿è¯å®¹é”™æ€§ï¼Œä½†æ˜¯æ•…éšœæ¢ </p><p>å¤çš„æ—¶å€™ï¼Œå³ä½¿äº‹ä»¶ä¸ä¼šä¸¢å¤±ï¼Œä¹Ÿæœ‰å¯èƒ½è¢«é‡å¤å¤„ç†â€”â€”æ‰€ä»¥æ— æ³•ä¿è¯ exactly-onceã€‚</p><ul><li>ä¸æ‰¹å¤„ç†å™¨ç›¸æ¯”ï¼Œå¯ä»¥è¯´ç¬¬ä¸€ä»£æµå¤„ç†å™¨ç‰ºç‰²äº†ç»“æœçš„å‡†ç¡®æ€§ï¼Œç”¨æ¥æ¢å–æ›´ä½çš„å»¶è¿Ÿã€‚è€Œ </li></ul><p>æ‰¹å¤„ç†å™¨æ°å¥½åè¿‡æ¥ï¼Œç‰ºç‰²äº†å®æ—¶æ€§ï¼Œæ¢å–äº†ç»“æœçš„å‡†ç¡®</p><ul><li>æˆ‘ä»¬è‡ªç„¶æƒ³åˆ°ï¼Œå¦‚æœå¯ä»¥è®©äºŒè€…åšä¸ªç»“åˆï¼Œä¸å°±å¯ä»¥åŒæ—¶æä¾›å¿«é€Ÿå’Œå‡†ç¡®çš„ç»“æœäº†å—ï¼Ÿæ­£ </li></ul><p>æ˜¯åŸºäºè¿™æ ·çš„æ€æƒ³ï¼ŒLambda æ¶æ„è¢«è®¾è®¡å‡ºæ¥ï¼Œå¦‚ä¸Šå›¾ã€‚æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™æ˜¯ç¬¬äºŒä»£æµå¤„ </p><p>ç†æ¶æ„ï¼Œä½†äº‹å®ä¸Šï¼Œå®ƒåªæ˜¯ç¬¬ä¸€ä»£æµå¤„ç†å™¨å’Œæ‰¹å¤„ç†å™¨çš„ç®€å•åˆå¹¶ã€‚ </p><h4 id="5ã€æ–°ä¸€ä»£æµå¤„ç†å™¨"><a href="#5ã€æ–°ä¸€ä»£æµå¤„ç†å™¨" class="headerlink" title="5ã€æ–°ä¸€ä»£æµå¤„ç†å™¨"></a>5ã€æ–°ä¸€ä»£æµå¤„ç†å™¨</h4><ul><li>ä¹‹å‰çš„åˆ†å¸ƒå¼æµå¤„ç†æ¶æ„ï¼Œéƒ½æœ‰æ˜æ˜¾çš„ç¼ºé™·ï¼Œäººä»¬ä¹Ÿä¸€ç›´æ²¡æœ‰æ”¾å¼ƒå¯¹æµå¤„ç†å™¨çš„æ”¹è¿›å’Œå®Œ </li></ul><p>å–„ã€‚ç»ˆäºï¼Œåœ¨åŸæœ‰æµå¤„ç†å™¨çš„åŸºç¡€ä¸Šï¼Œæ–°ä¸€ä»£åˆ†å¸ƒå¼å¼€æºæµå¤„ç†å™¨è¯ç”Ÿäº†ã€‚ä¸ºäº†ä¸ä¹‹å‰çš„ç³»ç»Ÿ </p><p>åŒºåˆ†ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºç¬¬ä¸‰ä»£æµå¤„ç†å™¨ï¼Œä»£è¡¨å½“ç„¶å°±æ˜¯ Flinkã€‚ </p><ul><li>ç¬¬ä¸‰ä»£æµå¤„ç†å™¨é€šè¿‡å·§å¦™çš„è®¾è®¡ï¼Œå®Œç¾è§£å†³äº†ä¹±åºæ•°æ®å¯¹ç»“æœæ­£ç¡®æ€§çš„å½±å“ã€‚è¿™ä¸€ä»£ç³»ç»Ÿ </li></ul><p>è¿˜åšåˆ°äº†ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly-onceï¼‰çš„ä¸€è‡´æ€§ä¿éšœï¼Œæ˜¯ç¬¬ä¸€ä¸ªå…·æœ‰ä¸€è‡´æ€§å’Œå‡†ç¡®ç»“æœçš„å¼€æºæµ </p><p>å¤„ç†å™¨ã€‚å¦å¤–ï¼Œå…ˆå‰çš„æµå¤„ç†å™¨ä»…èƒ½åœ¨é«˜ååå’Œä½å»¶è¿Ÿä¸­äºŒé€‰ä¸€ï¼Œè€Œæ–°ä¸€ä»£ç³»ç»Ÿèƒ½å¤ŸåŒæ—¶æä¾› </p><p>è¿™ä¸¤ä¸ªç‰¹æ€§ã€‚æ‰€ä»¥å¯ä»¥è¯´ï¼Œè¿™ä¸€ä»£æµå¤„ç†å™¨ä»…å‡­ä¸€å¥—ç³»ç»Ÿå°±å®Œæˆäº† Lambda æ¶æ„ä¸¤å¥—ç³»ç»Ÿçš„å·¥ </p><p>ä½œï¼Œå®ƒçš„å‡ºç°ä½¿å¾— Lambda æ¶æ„é»¯ç„¶å¤±è‰²ã€‚ </p><ul><li>é™¤äº†ä½å»¶è¿Ÿã€å®¹é”™å’Œç»“æœå‡†ç¡®æ€§ä¹‹å¤–ï¼Œæ–°ä¸€ä»£æµå¤„ç†å™¨è¿˜åœ¨ä¸æ–­æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œä¾‹å¦‚é«˜å¯ </li></ul><p>ç”¨çš„è®¾ç½®ï¼Œä»¥åŠä¸èµ„æºç®¡ç†å™¨ï¼ˆå¦‚ YARN æˆ– Kubernetesï¼‰çš„ç´§å¯†é›†æˆç­‰ç­‰ã€‚ </p><h3 id="å››ã€Flink-çš„ç‰¹æ€§æ€»ç»“"><a href="#å››ã€Flink-çš„ç‰¹æ€§æ€»ç»“" class="headerlink" title="å››ã€Flink çš„ç‰¹æ€§æ€»ç»“"></a>å››ã€Flink çš„ç‰¹æ€§æ€»ç»“</h3><p><strong>Flink æ˜¯ç¬¬ä¸‰ä»£åˆ†å¸ƒå¼æµå¤„ç†å™¨ï¼Œå®ƒçš„åŠŸèƒ½ä¸°å¯Œè€Œå¼ºå¤§ã€‚</strong></p><h5 id="-2"><a href="#-2" class="headerlink" title=""></a></h5><h4 id="1ã€æ ¸å¿ƒç‰¹æ€§"><a href="#1ã€æ ¸å¿ƒç‰¹æ€§" class="headerlink" title="1ã€æ ¸å¿ƒç‰¹æ€§"></a>1ã€æ ¸å¿ƒç‰¹æ€§</h4><h5 id="-3"><a href="#-3" class="headerlink" title=""></a></h5><ul><li><p>é«˜ååå’Œä½å»¶è¿Ÿã€‚æ¯ç§’å¤„ç†æ•°ç™¾ä¸‡ä¸ªäº‹ä»¶ï¼Œæ¯«ç§’çº§å»¶è¿Ÿã€‚</p></li><li><p>ç»“æœçš„å‡†ç¡®æ€§ã€‚Flink æä¾›äº†äº‹ä»¶æ—¶é—´ï¼ˆevent-timeï¼‰å’Œå¤„ç†æ—¶é—´ï¼ˆprocessing-timeï¼‰ </p><p>è¯­ä¹‰ã€‚å¯¹äºä¹±åºäº‹ä»¶æµï¼Œäº‹ä»¶æ—¶é—´è¯­ä¹‰ä»ç„¶èƒ½æä¾›ä¸€è‡´ä¸”å‡†ç¡®çš„ç»“æœã€‚</p></li><li><p>ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly-onceï¼‰çš„çŠ¶æ€ä¸€è‡´æ€§ä¿è¯ã€‚</p></li><li><p>å¯ä»¥è¿æ¥åˆ°æœ€å¸¸ç”¨çš„å­˜å‚¨ç³»ç»Ÿï¼Œå¦‚ Apache Kafkaã€Apache Cassandraã€Elasticsearchã€ </p><p>JDBCã€Kinesis å’Œï¼ˆåˆ†å¸ƒå¼ï¼‰æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ HDFS å’Œ S3ã€‚</p></li><li><p>é«˜å¯ç”¨ã€‚æœ¬èº«é«˜å¯ç”¨çš„è®¾ç½®ï¼ŒåŠ ä¸Šä¸ K8sï¼ŒYARN å’Œ Mesos çš„ç´§å¯†é›†æˆï¼Œå†åŠ ä¸Šä»æ•… </p><p>éšœä¸­å¿«é€Ÿæ¢å¤å’ŒåŠ¨æ€æ‰©å±•ä»»åŠ¡çš„èƒ½åŠ›ï¼ŒFlink èƒ½åšåˆ°ä»¥æå°‘çš„åœæœºæ—¶é—´ 7Ã—24 å…¨å¤©å€™ </p><p>è¿è¡Œ</p></li><li><p>èƒ½å¤Ÿæ›´æ–°åº”ç”¨ç¨‹åºä»£ç å¹¶å°†ä½œä¸šï¼ˆjobsï¼‰è¿ç§»åˆ°ä¸åŒçš„ Flink é›†ç¾¤ï¼Œè€Œä¸ä¼šä¸¢å¤±åº”ç”¨ </p><p>ç¨‹åºçš„çŠ¶æ€ã€‚ </p></li></ul><h4 id="2ã€åˆ†å±‚-API"><a href="#2ã€åˆ†å±‚-API" class="headerlink" title="2ã€åˆ†å±‚ API"></a>2ã€åˆ†å±‚ API</h4><p>é™¤äº†ä¸Šè¿°è¿™äº›ç‰¹æ€§ä¹‹å¤–ï¼ŒFlink è¿˜æ˜¯ä¸€ä¸ªéå¸¸æ˜“äºå¼€å‘çš„æ¡†æ¶ï¼Œå› ä¸ºå®ƒæ‹¥æœ‰æ˜“äºä½¿ç”¨çš„åˆ†å±‚ APIï¼Œæ•´ä½“ API åˆ†å±‚å¦‚å›¾ï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205182203484.png"></p><p>æœ€åº•å±‚çº§çš„æŠ½è±¡ä»…ä»…æä¾›äº†æœ‰çŠ¶æ€æµï¼Œå®ƒå°†å¤„ç†å‡½æ•°ï¼ˆProcess Functionï¼‰åµŒå…¥åˆ°äº† </p><p>DataStream API ä¸­ã€‚åº•å±‚å¤„ç†å‡½æ•°ï¼ˆProcess Functionï¼‰ä¸ DataStream API ç›¸é›†æˆï¼Œå¯ä»¥å¯¹æŸ </p><p>äº›æ“ä½œè¿›è¡ŒæŠ½è±¡ï¼Œå®ƒå…è®¸ç”¨æˆ·å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çŠ¶æ€å¤„ç†æ¥è‡ªä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®æµçš„äº‹ä»¶ï¼Œä¸”çŠ¶æ€ </p><p>å…·æœ‰ä¸€è‡´æ€§å’Œå®¹é”™ä¿è¯ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œäº‹ä»¶æ—¶é—´å¹¶å¤„ç†æ—¶é—´å›è°ƒï¼Œä»è€Œä½¿ç¨‹åºå¯ä»¥ </p><p>å¤„ç†å¤æ‚çš„è®¡ç®—ã€‚ </p><p>å®é™…ä¸Šï¼Œå¤§å¤šæ•°åº”ç”¨å¹¶ä¸éœ€è¦ä¸Šè¿°çš„åº•å±‚æŠ½è±¡ï¼Œè€Œæ˜¯ç›´æ¥é’ˆå¯¹æ ¸å¿ƒ APIï¼ˆCore APIsï¼‰ è¿› </p><p>è¡Œç¼–ç¨‹ï¼Œæ¯”å¦‚ DataStream APIï¼ˆç”¨äºå¤„ç†æœ‰ç•Œæˆ–æ— ç•Œæµæ•°æ®ï¼‰ä»¥åŠ DataSet APIï¼ˆç”¨äºå¤„ç†æœ‰ç•Œ </p><p>æ•°æ®é›†ï¼‰ã€‚è¿™äº› API ä¸ºæ•°æ®å¤„ç†æä¾›äº†é€šç”¨çš„æ„å»ºæ¨¡å—ï¼Œæ¯”å¦‚ç”±ç”¨æˆ·å®šä¹‰çš„å¤šç§å½¢å¼çš„è½¬æ¢ </p><p>ï¼ˆtransformationsï¼‰ã€è¿æ¥ï¼ˆjoinsï¼‰ã€èšåˆï¼ˆaggregationsï¼‰ã€çª—å£ï¼ˆwindowsï¼‰æ“ä½œç­‰ã€‚</p><h3 id="äº”ã€Flink-vs-Spark"><a href="#äº”ã€Flink-vs-Spark" class="headerlink" title="äº”ã€Flink vs Spark"></a>äº”ã€Flink vs Spark</h3><h4 id="1ã€æ•°æ®å¤„ç†æ¶æ„"><a href="#1ã€æ•°æ®å¤„ç†æ¶æ„" class="headerlink" title="1ã€æ•°æ®å¤„ç†æ¶æ„"></a>1ã€æ•°æ®å¤„ç†æ¶æ„</h4><p>æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œæ•°æ®å¤„ç†çš„åŸºæœ¬æ–¹å¼ï¼Œå¯ä»¥åˆ†ä¸ºæ‰¹å¤„ç†å’Œæµå¤„ç†ä¸¤ç§ã€‚</p><p><font color="red">æ‰¹å¤„ç†</font>é’ˆå¯¹çš„æ˜¯<font color="red">æœ‰ç•Œæ•°æ®é›†</font>ï¼Œéå¸¸é€‚åˆéœ€è¦è®¿é—®æµ·é‡çš„å…¨éƒ¨æ•°æ®æ‰èƒ½å®Œæˆçš„è®¡ç®—å·¥ä½œï¼Œä¸€ èˆ¬ç”¨äºç¦»çº¿ç»Ÿè®¡ã€‚ </p><p><font color="red">æµå¤„ç†</font>ä¸»è¦é’ˆå¯¹çš„æ˜¯æ•°æ®æµï¼Œç‰¹ç‚¹æ˜¯<font color="red">æ— ç•Œ</font>ã€å®æ—¶, å¯¹ç³»ç»Ÿä¼ è¾“çš„æ¯ä¸ªæ•°æ®ä¾æ¬¡æ‰§è¡Œæ“ä½œï¼Œ ä¸€èˆ¬ç”¨äºå®æ—¶ç»Ÿè®¡ã€‚ </p><p>ä»æ ¹æœ¬ä¸Šè¯´ï¼ŒSpark å’Œ Flink é‡‡ç”¨äº†å®Œå…¨ä¸åŒçš„æ•°æ®å¤„ç†æ–¹å¼ã€‚å¯ä»¥è¯´ï¼Œä¸¤è€…çš„ä¸–ç•Œè§‚æ˜¯ æˆªç„¶ç›¸åçš„ã€‚ </p><p>Spark ä»¥æ‰¹å¤„ç†ä¸ºæ ¹æœ¬ï¼Œå¹¶å°è¯•åœ¨æ‰¹å¤„ç†ä¹‹ä¸Šæ”¯æŒæµè®¡ç®—ï¼›åœ¨ Spark çš„ä¸–ç•Œè§‚ä¸­ï¼Œä¸‡ç‰©çš†æ‰¹æ¬¡ï¼Œç¦»çº¿æ•°æ®æ˜¯ä¸€ä¸ªå¤§æ‰¹æ¬¡ï¼Œè€Œå®æ—¶æ•°æ®åˆ™æ˜¯ç”±ä¸€ä¸ªä¸€ä¸ªæ— é™çš„å°æ‰¹æ¬¡ç»„æˆçš„ã€‚æ‰€ä»¥å¯¹äºæµå¤„ç†æ¡†æ¶ Spark Streaming è€Œè¨€ï¼Œå…¶å®å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„â€œæµâ€å¤„ç†ï¼Œè€Œæ˜¯â€œå¾®æ‰¹æ¬¡â€ ï¼ˆmicro-batchingï¼‰å¤„ç†</p><h5 id="-4"><a href="#-4" class="headerlink" title=""></a></h5><h5 id="1-æ— ç•Œæ•°æ®æµ"><a href="#1-æ— ç•Œæ•°æ®æµ" class="headerlink" title="1.æ— ç•Œæ•°æ®æµ"></a>1.æ— ç•Œæ•°æ®æµ</h5><p>æ‰€è°“æ— ç•Œæ•°æ®æµï¼Œå°±æ˜¯æœ‰å¤´æ²¡å°¾ï¼Œæ•°æ®çš„ç”Ÿæˆå’Œä¼ é€’ä¼šå¼€å§‹ä½†æ°¸è¿œä¸ä¼šç»“æŸï¼Œæˆ‘ä»¬æ— æ³•ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½åˆ°è¾¾ï¼Œå› ä¸ºè¾“å…¥æ˜¯æ— ç•Œçš„ï¼Œæ°¸æ— æ­¢å¢ƒï¼Œæ•°æ®æ²¡æœ‰â€œéƒ½åˆ°è¾¾â€çš„ æ—¶å€™ã€‚æ‰€ä»¥å¯¹äºæ— ç•Œæ•°æ®æµï¼Œå¿…é¡»è¿ç»­å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»åœ¨è·å–æ•°æ®åç«‹å³å¤„ç†ã€‚åœ¨å¤„ç†æ— ç•Œæµæ—¶ï¼Œä¸ºäº†ä¿è¯ç»“æœçš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬å¿…é¡»èƒ½å¤Ÿåšåˆ°æŒ‰ç…§é¡ºåºå¤„ç†æ•°æ®ã€‚ </p><h5 id="2-æ— ç•Œæ•°æ®æµ"><a href="#2-æ— ç•Œæ•°æ®æµ" class="headerlink" title="2.æ— ç•Œæ•°æ®æµ"></a>2.æ— ç•Œæ•°æ®æµ</h5><p>æœ‰ç•Œæ•°æ®æµæœ‰æ˜ç¡®å®šä¹‰çš„å¼€å§‹å’Œç»“æŸï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è·å–æ‰€æœ‰æ•°æ®æ¥å¤„ç†æœ‰ç•Œæµã€‚å¤„ç†æœ‰ç•Œæµå°±ä¸éœ€è¦ä¸¥æ ¼ä¿è¯æ•°æ®çš„é¡ºåºäº†ï¼Œå› ä¸ºæ€»å¯ä»¥å¯¹æœ‰ç•Œæ•°æ®é›†è¿›è¡Œæ’åºã€‚æœ‰ç•Œæµçš„å¤„ç†ä¹Ÿå°±æ˜¯æ‰¹å¤„ç†ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205182208414.png"></p><p>æ­£å› ä¸ºè¿™ç§æ¶æ„ä¸Šçš„ä¸åŒï¼ŒSpark å’Œ Flink åœ¨ä¸åŒçš„åº”ç”¨é¢†åŸŸä¸Šè¡¨ç°ä¼šæœ‰å·®åˆ«ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒSpark åŸºäºå¾®æ‰¹å¤„ç†çš„æ–¹å¼åšåŒæ­¥æ€»æœ‰ä¸€ä¸ªâ€œæ”’æ‰¹â€çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¼šæœ‰é¢å¤–å¼€é”€ï¼Œå› æ­¤æ— æ³•åœ¨æµå¤„ç†çš„ä½å»¶è¿Ÿä¸Šåšåˆ°æè‡´ã€‚åœ¨ä½å»¶è¿Ÿæµå¤„ç†åœºæ™¯ï¼ŒFlink å·²ç»æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚è€Œåœ¨æµ·é‡æ•°æ®çš„æ‰¹å¤„ç†é¢†åŸŸï¼ŒSpark èƒ½å¤Ÿå¤„ç†çš„ååé‡æ›´å¤§ï¼ŒåŠ ä¸Šå…¶å®Œå–„çš„ç”Ÿæ€å’Œæˆç†Ÿæ˜“ç”¨çš„ APIï¼Œç›®å‰åŒæ ·ä¼˜åŠ¿æ¯”è¾ƒæ˜æ˜¾ã€‚ </p><h4 id="2ã€æ•°æ®æ¨¡å‹å’Œè¿è¡Œæ¶æ„"><a href="#2ã€æ•°æ®æ¨¡å‹å’Œè¿è¡Œæ¶æ„" class="headerlink" title="2ã€æ•°æ®æ¨¡å‹å’Œè¿è¡Œæ¶æ„"></a>2ã€æ•°æ®æ¨¡å‹å’Œè¿è¡Œæ¶æ„</h4><ul><li><p>é™¤äº†ä¸‰è§‚ä¸åˆï¼ŒSpark å’Œ Flink åœ¨åº•å±‚å®ç°æœ€ä¸»è¦çš„å·®åˆ«å°±åœ¨äºæ•°æ®æ¨¡å‹ä¸åŒã€‚</p></li><li><p>Spark åº•å±‚æ•°æ®æ¨¡å‹æ˜¯å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆRDDï¼‰ï¼ŒSpark Streaming è¿›è¡Œå¾®æ‰¹å¤„ç†çš„åº•å±‚ </p></li></ul><p>æ¥å£ DStreamï¼Œå®é™…ä¸Šå¤„ç†çš„ä¹Ÿæ˜¯ä¸€ç»„ç»„å°æ‰¹æ•°æ® RDD çš„é›†åˆã€‚å¯ä»¥çœ‹å‡ºï¼ŒSpark åœ¨è®¾è®¡ä¸Šæœ¬ </p><p>èº«å°±æ˜¯ä»¥æ‰¹é‡çš„æ•°æ®é›†ä½œä¸ºåŸºå‡†çš„ï¼Œæ›´åŠ é€‚åˆæ‰¹å¤„ç†çš„åœºæ™¯ã€‚ </p><ul><li>è€Œ Flink çš„åŸºæœ¬æ•°æ®æ¨¡å‹æ˜¯æ•°æ®æµï¼ˆDataFlowï¼‰ï¼Œä»¥åŠäº‹ä»¶ï¼ˆEventï¼‰åºåˆ—ã€‚Flink åŸºæœ¬ä¸Šæ˜¯ </li></ul><p>å®Œå…¨æŒ‰ç…§ Google çš„ DataFlow æ¨¡å‹å®ç°çš„ï¼Œæ‰€ä»¥ä»åº•å±‚æ•°æ®æ¨¡å‹ä¸Šçœ‹ï¼ŒFlink æ˜¯ä»¥å¤„ç†æµå¼æ•° </p><p>æ®ä½œä¸ºè®¾è®¡ç›®æ ‡çš„ï¼Œæ›´åŠ é€‚åˆæµå¤„ç†çš„åœºæ™¯ã€‚ </p><ul><li>æ•°æ®æ¨¡å‹ä¸åŒï¼Œå¯¹åº”åœ¨è¿è¡Œå¤„ç†çš„æµç¨‹ä¸Šï¼Œè‡ªç„¶ä¹Ÿä¼šæœ‰ä¸åŒçš„æ¶æ„ã€‚Spark åšæ‰¹è®¡ç®—ï¼Œéœ€ </li></ul><p>è¦å°†ä»»åŠ¡å¯¹åº”çš„ DAG åˆ’åˆ†é˜¶æ®µï¼ˆStageï¼‰ï¼Œä¸€ä¸ªå®Œæˆåç»è¿‡ shuffle å†è¿›è¡Œä¸‹ä¸€é˜¶æ®µçš„è®¡ç®—ã€‚è€Œ </p><p>Flink æ˜¯æ ‡å‡†çš„æµå¼æ‰§è¡Œæ¨¡å¼ï¼Œä¸€ä¸ªäº‹ä»¶åœ¨ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†å®Œåå¯ä»¥ç›´æ¥å‘å¾€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œå¤„ç†ã€‚ </p><h4 id="3ã€Spark-è¿˜æ˜¯-Flink"><a href="#3ã€Spark-è¿˜æ˜¯-Flink" class="headerlink" title="3ã€Spark è¿˜æ˜¯ Flink"></a>3ã€Spark è¿˜æ˜¯ Flink</h4><p>Spark å’Œ Flink å¯ä»¥è¯´ç›®å‰æ˜¯å„æ“…èƒœåœºï¼Œæ‰¹å¤„ç†é¢†åŸŸ Spark ç§°ç‹ï¼Œè€Œåœ¨æµå¤„ç†æ–¹é¢ Flink å½“ä»ä¸è®©ã€‚å…·ä½“åˆ°é¡¹ç›®åº”ç”¨ä¸­ï¼Œä¸ä»…è¦çœ‹æ˜¯æµå¤„ç†è¿˜æ˜¯ </p><p>æ‰¹å¤„ç†ï¼Œè¿˜éœ€è¦åœ¨å»¶è¿Ÿã€ååé‡ã€å¯é æ€§ï¼Œä»¥åŠå¼€å‘å®¹æ˜“åº¦ç­‰å¤šä¸ªæ–¹é¢è¿›è¡Œæƒè¡¡ã€‚</p><p>å¦‚æœåœ¨å·¥ä½œä¸­éœ€è¦ä» Spark å’Œ Flink è¿™ä¸¤ä¸ªä¸»æµæ¡†æ¶ä¸­é€‰æ‹©ä¸€ä¸ªæ¥è¿›è¡Œå®æ—¶æµå¤„ç†ï¼Œæˆ‘ä»¬æ›´åŠ æ¨èä½¿ç”¨ Flinkï¼Œä¸»è¦çš„åŸå› æœ‰ï¼š </p><ul><li>Flink çš„å»¶è¿Ÿæ˜¯æ¯«ç§’çº§åˆ«ï¼Œè€Œ Spark Streaming çš„å»¶è¿Ÿæ˜¯ç§’çº§å»¶è¿Ÿã€‚</li><li>Flink æä¾›äº†ä¸¥æ ¼çš„ç²¾ç¡®ä¸€æ¬¡æ€§è¯­ä¹‰ä¿è¯ã€‚</li><li>Flink çš„çª—å£ API æ›´åŠ çµæ´»ã€è¯­ä¹‰æ›´ä¸°å¯Œã€‚</li><li>Flink æä¾›äº‹ä»¶æ—¶é—´è¯­ä¹‰ï¼Œå¯ä»¥æ­£ç¡®å¤„ç†å»¶è¿Ÿæ•°æ®ã€‚</li><li>Flink æä¾›äº†æ›´åŠ çµæ´»çš„å¯¹çŠ¶æ€ç¼–ç¨‹çš„ APIã€‚</li></ul><h2 id="â…¡ã€Flink-éƒ¨ç½²"><a href="#â…¡ã€Flink-éƒ¨ç½²" class="headerlink" title="â…¡ã€Flink éƒ¨ç½²"></a>â…¡ã€Flink éƒ¨ç½²</h2><h3 id="ä¸€ã€Flink-å¿«é€Ÿä¸Šæ‰‹"><a href="#ä¸€ã€Flink-å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="ä¸€ã€Flink å¿«é€Ÿä¸Šæ‰‹"></a>ä¸€ã€Flink å¿«é€Ÿä¸Šæ‰‹</h3><h4 id="1ã€åˆ›å»ºé¡¹ç›®-1-8"><a href="#1ã€åˆ›å»ºé¡¹ç›®-1-8" class="headerlink" title="1ã€åˆ›å»ºé¡¹ç›®(1.8)"></a>1ã€åˆ›å»ºé¡¹ç›®(1.8)</h4><h5 id="1ã€maven"><a href="#1ã€maven" class="headerlink" title="1ã€maven"></a>1ã€maven</h5><p>åœ¨é¡¹ç›®çš„ pom æ–‡ä»¶ä¸­ï¼Œå¢åŠ <properties>æ ‡ç­¾è®¾ç½®å±æ€§ï¼Œç„¶åå¢åŠ <denpendencies>æ ‡ç­¾å¼•å…¥éœ€è¦çš„ä¾èµ–ã€‚æˆ‘ä»¬éœ€è¦æ·»åŠ çš„ä¾èµ–æœ€é‡è¦çš„å°±æ˜¯ Flink çš„ç›¸å…³ç»„ä»¶ï¼ŒåŒ…æ‹¬ flink-javaã€ flink-streaming-javaï¼Œä»¥åŠ flink-clientsï¼ˆå®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥çœç•¥ï¼‰ã€‚å¦å¤–ï¼Œä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼Œ æˆ‘ä»¬å¼•å…¥ slf4j å’Œ log4j è¿›è¡Œæ—¥å¿—ç†ã€‚ </denpendencies></properties></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flink.version</span><span class="token punctuation">&gt;</span></span>1.13.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flink.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scala.binary.version</span><span class="token punctuation">&gt;</span></span>2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scala.binary.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>1.7.30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slf4j.version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- å¼•å…¥ Flink ç›¸å…³ä¾èµ–--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-streaming-java_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-clients_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- å¼•å…¥æ—¥å¿—ç®¡ç†ç›¸å…³ä¾èµ–--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-to-slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.14.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å±æ€§ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†&lt;scala.binary.version&gt;ï¼Œè¿™æŒ‡ä»£çš„æ˜¯æ‰€ä¾èµ–çš„ Scala ç‰ˆæœ¬ã€‚è¿™æœ‰ä¸€ç‚¹å¥‡æ€ªï¼šFlink åº•å±‚æ˜¯ Javaï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿåªç”¨ Java APIï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šä¾èµ– Scala å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º Flinkçš„æ¶æ„ä¸­ä½¿ç”¨äº† Akka æ¥å®ç°åº•å±‚çš„åˆ†å¸ƒå¼é€šä¿¡ï¼Œè€Œ Akka æ˜¯ç”¨ Scala å¼€å‘çš„</p><h5 id="2ã€é…ç½®æ—¥å¿—ç®¡ç†"><a href="#2ã€é…ç½®æ—¥å¿—ç®¡ç†" class="headerlink" title="2ã€é…ç½®æ—¥å¿—ç®¡ç†"></a>2ã€é…ç½®æ—¥å¿—ç®¡ç†</h5><p>åœ¨ç›®å½• src/main/resources ä¸‹æ·»åŠ æ–‡ä»¶:log4j.propertiesï¼Œå†…å®¹é…ç½®å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token attr-value">error, stdout</span><span class="token attr-name">log4j.appender.stdout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.ConsoleAppender</span><span class="token attr-name">log4j.appender.stdout.layout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.PatternLayout</span><span class="token attr-name">log4j.appender.stdout.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token attr-value">%-4r [%t] %-5p %c %x - %m%n</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€ç¼–å†™ä»£ç "><a href="#2ã€ç¼–å†™ä»£ç " class="headerlink" title="2ã€ç¼–å†™ä»£ç "></a>2ã€ç¼–å†™ä»£ç </h4><p>æ­å¥½é¡¹ç›®æ¡†æ¶ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒå·¥ä½œâ€”â€”å¾€é‡Œé¢å¡«å……ä»£ç ã€‚æˆ‘ä»¬ä¼šç”¨ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹æ¥è¯´æ˜ Flink ä»£ç æ€æ ·ç¼–å†™ï¼š<code>ç»Ÿè®¡ä¸€æ®µæ–‡å­—ä¸­ï¼Œæ¯ä¸ªå•è¯å‡ºç°çš„é¢‘æ¬¡</code>ã€‚è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ WordCount ç¨‹åºâ€”â€”å®ƒæ˜¯å¤§æ•°æ®é¢†åŸŸéå¸¸ç»å…¸çš„å…¥é—¨æ¡ˆä¾‹ï¼Œåœ°ä½ç­‰åŒäºåˆå­¦ç¼–ç¨‹è¯­è¨€æ—¶çš„Hello Worldã€‚</p><h5 id="1ã€æ‰¹å¤„ç†"><a href="#1ã€æ‰¹å¤„ç†" class="headerlink" title="1ã€æ‰¹å¤„ç†"></a>1ã€æ‰¹å¤„ç†</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205182231937.png"></p><p>1ã€æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª txtæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">hello worldhello flinkhello java<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>2ã€æ€è·¯</p><p>å…ˆé€è¡Œè¯»å…¥æ–‡ä»¶æ•°æ®ï¼Œç„¶åå°†æ¯ä¸€è¡Œæ–‡å­—æ‹†åˆ†æˆå•è¯ï¼›æ¥ç€æŒ‰ç…§å•è¯åˆ†ç»„ï¼Œç»Ÿè®¡æ¯ç»„æ•°æ®çš„ä¸ªæ•°ï¼Œå°±æ˜¯å¯¹åº”å•è¯çš„é¢‘æ¬¡ã€‚</p><p>3ã€Java ç±» BatchWordCount</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>wc</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>typeinfo<span class="token punctuation">.</span></span><span class="token class-name">Types</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span></span><span class="token class-name">ExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>operators<span class="token punctuation">.</span></span><span class="token class-name">AggregateOperator</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>operators<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>operators<span class="token punctuation">.</span></span><span class="token class-name">FlatMapOperator</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>operators<span class="token punctuation">.</span></span><span class="token class-name">UnsortedGrouping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>tuple<span class="token punctuation">.</span></span><span class="token class-name">Tuple2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collector</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BatchWordCount</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// 1. åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span>        <span class="token class-name">ExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">ExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2. ä»æ–‡ä»¶è¯»å–æ•°æ® æŒ‰è¡Œè¯»å–(å­˜å‚¨çš„å…ƒç´ å°±æ˜¯æ¯è¡Œçš„æ–‡æœ¬)</span>        <span class="token class-name">DataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> listDateSource <span class="token operator">=</span> env<span class="token punctuation">.</span>readTextFile <span class="token punctuation">(</span><span class="token string">"input/words.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3. å°†æ¯è¡Œæ•°æ®è¿›è¡Œåˆ†è¯ï¼Œè½¬æ¢æˆäºŒå…ƒç»„ç±»å‹</span>        <span class="token comment">// Collector: flink å®šä¹‰çš„æ”¶é›†å™¨</span>        <span class="token comment">// Tuple: äºŒå…ƒç»„ç±»å‹ &lt;String,Long&gt;,K å°±æ˜¯å…·ä½“çš„å•è¯ï¼ŒV å°±æ˜¯ä¸ªæ•°</span>        <span class="token class-name">FlatMapOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> wordAndOneTuple <span class="token operator">=</span> listDateSource<span class="token punctuation">.</span>flatMap <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span> line<span class="token punctuation">,</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// æ¯è¡Œæ ¹æ®ç©ºæ ¼åˆ†éš”å‡ºï¼Œå•è¯</span>            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> words <span class="token operator">=</span> line<span class="token punctuation">.</span>split <span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// out.collect  å°±æ˜¯è¾“å‡ºçš„æ„æ€</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> word <span class="token operator">:</span> words<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// Tuple2.of æ„å»ºäºŒå…ƒç»„å®ä¾‹</span>                out<span class="token punctuation">.</span>collect <span class="token punctuation">(</span><span class="token class-name">Tuple2</span><span class="token punctuation">.</span>of <span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token comment">// returns è§£å†³ scala æ³›å‹æ“¦é™¤é—®é¢˜</span>                <span class="token punctuation">.</span>returns <span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span>TUPLE <span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span>LONG<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ ¹æ®è½¬æ¢å¾—åˆ°çš„è¿ç®—å­  wordAndOneTuple</span>        <span class="token comment">// 4. æŒ‰ç…§ word è¿›è¡Œåˆ†ç»„, 0 è¡¨ç¤ºç¬¬ 1 ä¸ªå­—æ®µç´¢å¼•ï¼Œå°±æ˜¯ä¸Šé¢æ³›å‹&lt;k,v&gt; ä¸­çš„ k ä¸º word å­—æ®µ</span>        <span class="token class-name">UnsortedGrouping</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> wordAndOneGroup <span class="token operator">=</span> wordAndOneTuple<span class="token punctuation">.</span>groupBy <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 5. åˆ†ç»„è¿›è¡Œèšåˆ(æ±‚å’Œ)ç»Ÿè®¡ï¼Œ1 è¡¨ç¤ºç¬¬ 2 ä¸ªå­—æ®µç´¢å¼•ï¼Œå°±æ˜¯ä¸Šé¢æ³›å‹&lt;k,v&gt; ä¸­çš„ v ä¸º 1L æ•°å€¼çš„å­—æ®µ</span>        <span class="token class-name">AggregateOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> sum <span class="token operator">=</span> wordAndOneGroup<span class="token punctuation">.</span>sum <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 6. æ‰“å°</span>        sum<span class="token punctuation">.</span>print <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€æµå¤„ç†ï¼ˆæœ‰ç•Œï¼‰"><a href="#2ã€æµå¤„ç†ï¼ˆæœ‰ç•Œï¼‰" class="headerlink" title="2ã€æµå¤„ç†ï¼ˆæœ‰ç•Œï¼‰"></a>2ã€æµå¤„ç†ï¼ˆæœ‰ç•Œï¼‰</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>wc</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>typeinfo<span class="token punctuation">.</span></span><span class="token class-name">Types</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>tuple<span class="token punctuation">.</span></span><span class="token class-name">Tuple2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">KeyedStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">SingleOutputStreamOperator</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collector</span><span class="token punctuation">;</span><span class="token comment">/* * @Description:    æµå¤„ç†æœ‰ç•Œæµ * @Author:         é˜¿K * @CreateDate:     2022/5/19 21:14 * @Param: * @Return:**/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BoundedStreamWordCount</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>        <span class="token comment">// 1. åˆ›å»ºæµå¼æ‰§è¡Œç¯å¢ƒ</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2. ä»æ–‡ä»¶è¯»å–æ•°æ® æŒ‰è¡Œè¯»å–(å­˜å‚¨çš„å…ƒç´ å°±æ˜¯æ¯è¡Œçš„æ–‡æœ¬)</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> listDateSource <span class="token operator">=</span> env<span class="token punctuation">.</span>readTextFile <span class="token punctuation">(</span><span class="token string">"input/words.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3. å°†æ¯è¡Œæ•°æ®è¿›è¡Œåˆ†è¯ï¼Œè½¬æ¢æˆäºŒå…ƒç»„ç±»å‹</span>        <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> wordAndOne <span class="token operator">=</span> listDateSource<span class="token punctuation">.</span>flatMap <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span> line<span class="token punctuation">,</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> words <span class="token operator">=</span> line<span class="token punctuation">.</span>split <span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> word <span class="token operator">:</span> words<span class="token punctuation">)</span> <span class="token punctuation">{</span>                out<span class="token punctuation">.</span>collect <span class="token punctuation">(</span><span class="token class-name">Tuple2</span><span class="token punctuation">.</span>of <span class="token punctuation">(</span>word<span class="token punctuation">,</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>returns <span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span>TUPLE <span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span>LONG<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4. åˆ†ç»„(keyBy æŒ‰ç…§ key åˆ†ç»„</span>        <span class="token class-name">KeyedStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> wordAndOneKS <span class="token operator">=</span> wordAndOne<span class="token punctuation">.</span>keyBy <span class="token punctuation">(</span>data <span class="token operator">-&gt;</span> data<span class="token punctuation">.</span>f0<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 5. æ±‚å’Œ</span>        <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> wordAndOneKS<span class="token punctuation">.</span>sum <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 6. æ‰“å°</span>        result<span class="token punctuation">.</span>print <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 7. æ‰§è¡Œ</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€æµå¤„ç†ï¼ˆæ— ç•Œï¼‰"><a href="#3ã€æµå¤„ç†ï¼ˆæ— ç•Œï¼‰" class="headerlink" title="3ã€æµå¤„ç†ï¼ˆæ— ç•Œï¼‰"></a>3ã€æµå¤„ç†ï¼ˆæ— ç•Œï¼‰</h5><p>åˆ©ç”¨ nc æ¨¡æ‹Ÿå®æ—¶æ¨é€ï¼Œå¯ä»¥å‚è€ƒåº•ä¸‹ ã€5ã€‘</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>wc</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>typeinfo<span class="token punctuation">.</span></span><span class="token class-name">Types</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>tuple<span class="token punctuation">.</span></span><span class="token class-name">Tuple2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">KeyedStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">SingleOutputStreamOperator</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collector</span><span class="token punctuation">;</span><span class="token comment">/* * @Description:    æµå¼è®¡ç®—ï¼ˆnc æµ‹è¯•æ— ç•Œæµï¼‰ * @Author:         é˜¿K * @CreateDate:     2022/5/19 22:43 * @Param: * @Return:**/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamWordCount</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>        <span class="token comment">// 1. åˆ›å»ºæµå¼æ‰§è¡Œç¯å¢ƒ</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2. è¯»å–æ–‡æœ¬æµ(è¿œç¨‹æœº)</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lineDataStream <span class="token operator">=</span> env<span class="token punctuation">.</span>socketTextStream <span class="token punctuation">(</span><span class="token string">"101.34.180.133"</span><span class="token punctuation">,</span> <span class="token number">7777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3. å°†æ¯è¡Œæ•°æ®è¿›è¡Œåˆ†è¯ï¼Œè½¬æ¢æˆäºŒå…ƒç»„ç±»å‹</span>        <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> wordAndOne <span class="token operator">=</span> lineDataStream<span class="token punctuation">.</span>flatMap <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span> line<span class="token punctuation">,</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> out<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> words <span class="token operator">=</span> line<span class="token punctuation">.</span>split <span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> word <span class="token operator">:</span> words<span class="token punctuation">)</span> <span class="token punctuation">{</span>                out<span class="token punctuation">.</span>collect <span class="token punctuation">(</span><span class="token class-name">Tuple2</span><span class="token punctuation">.</span>of <span class="token punctuation">(</span>word<span class="token punctuation">,</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>returns <span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span>TUPLE <span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span>LONG<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4. åˆ†ç»„(keyBy æŒ‰ç…§ key åˆ†ç»„</span>        <span class="token class-name">KeyedStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> wordAndOneKS <span class="token operator">=</span> wordAndOne<span class="token punctuation">.</span>keyBy <span class="token punctuation">(</span>data <span class="token operator">-&gt;</span> data<span class="token punctuation">.</span>f0<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 5. æ±‚å’Œ</span>        <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> wordAndOneKS<span class="token punctuation">.</span>sum <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 6. æ‰“å°</span>        result<span class="token punctuation">.</span>print <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 7. æ‰§è¡Œ</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ä¸Šé¢å¯ä»¥ç”¨ nc æµ‹è¯•ï¼ˆå®æ—¶æ¨¡æ‹Ÿæ•°æ®å‘é€ï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205212248685.png"></p><h3 id="äºŒã€ä½œä¸šéƒ¨ç½²"><a href="#äºŒã€ä½œä¸šéƒ¨ç½²" class="headerlink" title="äºŒã€ä½œä¸šéƒ¨ç½²"></a>äºŒã€ä½œä¸šéƒ¨ç½²</h3><h4 id="1ã€æ­å»ºFlink"><a href="#1ã€æ­å»ºFlink" class="headerlink" title="1ã€æ­å»ºFlink"></a>1ã€æ­å»ºFlink</h4><p>Flink æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¤„ç†æ¡†æ¶ï¼Œæ‰€ä»¥å®é™…åº”ç”¨ä¸€èˆ¬éƒ½éœ€è¦æ­å»ºé›†ç¾¤ç¯å¢ƒã€‚ä½œè€…åˆå­¦å°±æ­å»ºå•æœºå¥½äº†</p><p><strong>æœ‰æ¡ä»¶å°±ç”¨ docker å¿«é€Ÿå ç”¨å°ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢ç¬¬å…­</strong></p><h5 id="1-å®˜ç½‘ä¸‹è½½"><a href="#1-å®˜ç½‘ä¸‹è½½" class="headerlink" title="1.å®˜ç½‘ä¸‹è½½"></a>1.å®˜ç½‘ä¸‹è½½</h5><p>flink-1.13.0-bin-scala_2.12.tgz</p><h5 id="2-è§£å‹"><a href="#2-è§£å‹" class="headerlink" title="2.è§£å‹"></a>2.è§£å‹</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> /opt/module/<span class="token function">tar</span> -zxvf flink-1.13.0-bin-scala_2.12.tgz -C /opt/module/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="3-å¯åŠ¨"><a href="#3-å¯åŠ¨" class="headerlink" title="3.å¯åŠ¨"></a>3.å¯åŠ¨</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> flink-1.13.0/<span class="token comment"># å¯åŠ¨</span>bin/start-cluster.sh<span class="token comment"># åœæ­¢</span>bin/stop-cluster.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€æ‰“åŒ…"><a href="#2ã€æ‰“åŒ…" class="headerlink" title="2ã€æ‰“åŒ…"></a>2ã€æ‰“åŒ…</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>FlinkTutorial<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flink.version</span><span class="token punctuation">&gt;</span></span>1.13.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flink.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scala.binary.version</span><span class="token punctuation">&gt;</span></span>2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scala.binary.version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>1.7.30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å¼•å…¥Flinkç›¸å…³ä¾èµ–--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-streaming-java_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-clients_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-kafka_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.bahir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-redis_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-elasticsearch6_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-jdbc_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-statebackend-rocksdb_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.13.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-table-api-java-bridge_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-table-planner-blink_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-streaming-scala_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-csv<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-cep_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å¼•å…¥æ—¥å¿—ç®¡ç†ç›¸å…³ä¾èµ–--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-to-slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.14.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.7.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-assembly-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRefs</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRef</span><span class="token punctuation">&gt;</span></span>jar-with-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRef</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRefs</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>make-assembly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>single<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>${java.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>${java.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¼šç”Ÿæˆä¸¤ä¸ª jar ï¼Œä¸€ä¸ªæœ‰ flinkä¾èµ–çš„æ¯”è¾ƒå¤§ï¼Œä¸€ä¸ªæ²¡æœ‰ä¾èµ–çš„æ¯”è¾ƒå°</p><h4 id="3ã€æäº¤ä½œä¸š"><a href="#3ã€æäº¤ä½œä¸š" class="headerlink" title="3ã€æäº¤ä½œä¸š"></a>3ã€æäº¤ä½œä¸š</h4><p>1ã€é€‰æ‹©ä¸€ä¸ª jar  å°çš„é‚£ä¸ªæ²¡æœ‰ä¾èµ–çš„</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205212240022.png"></p><p>2ã€ä¸Šä¼ ï¼Œç™»å½•UIé¢æ¿ï¼š<a href="http://101.34.180.133:8081/">http://101.34.180.133:8081/</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205212242404.png"></p><p>3ã€é…ç½®å¯åŠ¨ç±»</p><p>ä¸€ä¸ªèŠ‚ç‚¹é€‰æ‹© 1ï¼Œä¸¤ä¸ªèŠ‚ç‚¹é€‰æ‹© 2</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205220012706.png"></p><p>4ã€å¯åŠ¨ nc æ¨¡æ‹Ÿ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205212248685.png"></p><p>5ã€ä»»åŠ¡æäº¤æˆåŠŸä¹‹åï¼Œå¯ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ çš„â€œRunning Jobsâ€æŸ¥çœ‹ç¨‹åºè¿è¡Œåˆ—è¡¨æƒ…å†µ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205220014860.png"></p><h3 id="ä¸‰ã€æ­å»ºkafka"><a href="#ä¸‰ã€æ­å»ºkafka" class="headerlink" title="ä¸‰ã€æ­å»ºkafka"></a>ä¸‰ã€æ­å»ºkafka</h3><p>dockerç‰ˆæœ¬æ­å»º zookeeper and kafka</p><h4 id="1ã€zookeeper"><a href="#1ã€zookeeper" class="headerlink" title="1ã€zookeeper"></a>1ã€zookeeper</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run -d --name zookeeper -p <span class="token number">2181</span>:2181 -v /etc/localtime:/etc/localtime wurstmeister/zookeeper<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€kafka"><a href="#2ã€kafka" class="headerlink" title="2ã€kafka"></a>2ã€kafka</h4><p>è¿™è¾¹éœ€è¦æ³¨æ„ç½‘æ®µï¼Œ192.168.16.4</p><p><code>ifconfig</code> æŸ¥çœ‹ä¸‹ï¼Œå¦‚æœç”¨127.0.0.1 å¯èƒ½ä¼šé—ªé€€</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run  -d --name kafka -p <span class="token number">9092</span>:9092 -e <span class="token assign-left variable">KAFKA_BROKER_ID</span><span class="token operator">=</span><span class="token number">0</span> -e <span class="token assign-left variable">KAFKA_ZOOKEEPER_CONNECT</span><span class="token operator">=</span><span class="token number">192.168</span>.16.4:2181 -e <span class="token assign-left variable">KAFKA_ADVERTISED_LISTENERS</span><span class="token operator">=</span>PLAINTEXT://106.12.159.22:9092 -e <span class="token assign-left variable">KAFKA_LISTENERS</span><span class="token operator">=</span>PLAINTEXT://0.0.0.0:9092 -t wurstmeister/kafka<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>-e KAFKA_BROKER_ID=0 åœ¨kafkaé›†ç¾¤ä¸­ï¼Œæ¯ä¸ªkafkaéƒ½æœ‰ä¸€ä¸ªBROKER_IDæ¥åŒºåˆ†è‡ªå·±</p><p>-e KAFKA_ZOOKEEPER_CONNECT=192.168.16.4:2181/kafka é…ç½®zookeeperç®¡ç†kafkaçš„è·¯å¾„10.9.44.11:2181/kafka</p><p>-e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://192.168.16.4:9092 æŠŠkafkaçš„åœ°å€ç«¯å£æ³¨å†Œç»™zookeeper</p><p>-e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 é…ç½®kafkaçš„ç›‘å¬ç«¯å£</p><p>-v /etc/localtime:/etc/localtime å®¹å™¨æ—¶é—´åŒæ­¥è™šæ‹Ÿæœºçš„æ—¶é—´</p><p>å…¬ç½‘é…ç½®æ˜ å°„å‚æ•°ï¼šæ‰èƒ½è®©ä½ çš„kafkaè¢«è¿œç¨‹è®¿é—®ï¼Œåº•ä¸‹é…ç½®åªæœ‰ KAFKA_ADVERTISED_LISTENERS å¿…é¡»æ˜¯å…¬ç½‘æ˜ å°„</p><p>docker run -d â€“restart=always â€“name kafka <br>-p 9092:9092 <br>-e KAFKA_BROKER_ID=1 <br>-e KAFKA_auto_create_topics_enable=true \<br>-e KAFKA_HEAP_OPTS=â€-Xmx256M -Xms128Mâ€ <br>-e KAFKA_ZOOKEEPER_CONNECT=å…¬ç½‘ip:2181 <br>-e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://å…¬ç½‘ip:9092 <br>-e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 \</p><h4 id="3ã€æ£€éªŒkafka"><a href="#3ã€æ£€éªŒkafka" class="headerlink" title="3ã€æ£€éªŒkafka"></a>3ã€æ£€éªŒkafka</h4><h5 id="1ã€è¿›å…¥å®¹å™¨"><a href="#1ã€è¿›å…¥å®¹å™¨" class="headerlink" title="1ã€è¿›å…¥å®¹å™¨"></a>1ã€è¿›å…¥å®¹å™¨</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker <span class="token builtin class-name">exec</span> -it kafka /bin/sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="2ã€åˆ‡æ¢åˆ°è·¯å¾„"><a href="#2ã€åˆ‡æ¢åˆ°è·¯å¾„" class="headerlink" title="2ã€åˆ‡æ¢åˆ°è·¯å¾„"></a>2ã€åˆ‡æ¢åˆ°è·¯å¾„</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /opt/kafka/bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="3ã€è¿è¡Œkafkaç”Ÿäº§è€…å‘½ä»¤"><a href="#3ã€è¿è¡Œkafkaç”Ÿäº§è€…å‘½ä»¤" class="headerlink" title="3ã€è¿è¡Œkafkaç”Ÿäº§è€…å‘½ä»¤"></a>3ã€è¿è¡Œkafkaç”Ÿäº§è€…å‘½ä»¤</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./kafka-console-producer.sh --broker-list localhost:9092 --topic clicks<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="4ã€è¿è¡Œæ¶ˆè´¹è€…å‘½ä»¤"><a href="#4ã€è¿è¡Œæ¶ˆè´¹è€…å‘½ä»¤" class="headerlink" title="4ã€è¿è¡Œæ¶ˆè´¹è€…å‘½ä»¤"></a>4ã€è¿è¡Œæ¶ˆè´¹è€…å‘½ä»¤</h5><p>æ³¨æ„ï¼štopic ä¸»é¢˜è¦ä¸€è‡´ï¼Œæ–¹èƒ½æ¶ˆè´¹åˆ°</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic clicks<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="5ã€å‘é€æ•°æ®"><a href="#5ã€å‘é€æ•°æ®" class="headerlink" title="5ã€å‘é€æ•°æ®"></a>5ã€å‘é€æ•°æ®</h5><pre class="line-numbers language-bsh" data-language="bsh"><code class="language-bsh">aaabbb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="6ã€æ•ˆæœå›¾"><a href="#6ã€æ•ˆæœå›¾" class="headerlink" title="6ã€æ•ˆæœå›¾"></a>6ã€æ•ˆæœå›¾</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303261226499.png"></p><h2 id="â…¢ã€DataStream-API"><a href="#â…¢ã€DataStream-API" class="headerlink" title="â…¢ã€DataStream API"></a>â…¢ã€DataStream API</h2><h3 id="ä¸€ã€æ¦‚å¿µ"><a href="#ä¸€ã€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€æ¦‚å¿µ"></a>ä¸€ã€æ¦‚å¿µ</h3><p>DataStreamï¼ˆæ•°æ®æµï¼‰æœ¬èº«æ˜¯ Flink ä¸­ä¸€ä¸ªç”¨æ¥è¡¨ç¤ºæ•°æ®é›†åˆçš„ç±»ï¼Œè¿™å¥—æ ¸å¿ƒ API å¯ä»¥åš<code>æµå¤„ç†</code>ä»¥åŠ<code>æ‰¹å¤„ç†</code>,è¿™å¥—API ä¸»è¦åšçš„æ˜¯æ•°æ®çš„è½¬æ¢</p><p>ä¸€ä¸ª Flink ç¨‹åºï¼Œå…¶å®å°±æ˜¯å¯¹ DataStream çš„å„ç§è½¬æ¢ã€‚å…·ä½“æ¥è¯´ï¼Œä»£ç åŸºæœ¬ä¸Šéƒ½ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†æ„æˆ</p><ul><li>è·å–æ‰§è¡Œç¯å¢ƒ</li><li>è¯»å–æ•°æ®æº</li><li>å®šä¹‰åŸºäºæ•°æ®çš„è½¬æ¢æ“ä½œ</li><li>å®šä¹‰è®¡ç®—ç»“æœçš„è¾“å‡ºä½ç½®</li><li>è§¦å‘ç¨‹åºæ‰§è¡Œ</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205232214873.png"></p><h3 id="äºŒã€æ‰§è¡Œç¯å¢ƒ"><a href="#äºŒã€æ‰§è¡Œç¯å¢ƒ" class="headerlink" title="äºŒã€æ‰§è¡Œç¯å¢ƒ"></a>äºŒã€æ‰§è¡Œç¯å¢ƒ</h3><p>è¿è¡Œç¯å¢ƒï¼šæœ¬åœ° JVM ä¸­æ‰§è¡Œç¨‹åºï¼Œä¹Ÿå¯ä»¥æäº¤åˆ°è¿œç¨‹é›†ç¾¤ä¸Šè¿è¡Œã€‚</p><h4 id="1ã€åˆ›å»ºæ‰§è¡Œç¯å¢ƒ"><a href="#1ã€åˆ›å»ºæ‰§è¡Œç¯å¢ƒ" class="headerlink" title="1ã€åˆ›å»ºæ‰§è¡Œç¯å¢ƒ"></a>1ã€åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</h4><p>æˆ‘ ä»¬ è¦ è· å– çš„ æ‰§ è¡Œ ç¯ å¢ƒ ï¼Œ æ˜¯ StreamExecutionEnvironment ç±»çš„å¯¹è±¡ï¼Œè¿™æ˜¯æ‰€æœ‰ Flink ç¨‹åºçš„åŸºç¡€ã€‚</p><p>åˆ›å»ºæ‰§è¡Œç¯å¢ƒçš„æ–¹å¼ï¼Œå°±æ˜¯è°ƒç”¨è¿™ä¸ªç±»çš„é™æ€æ–¹æ³•ï¼Œå…·ä½“æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li><p><strong>getExecutionEnvironment</strong></p><ul><li><pre><code class="java">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( );<pre class="line-numbers language-none"><code class="language-none">  - æ™ºèƒ½åˆ¤æ–­ï¼šå¦‚æœå½“å‰ç¨‹åºæ˜¯ç‹¬ç«‹è¿è¡Œï¼Œåˆ™è¿”å›ä¸€ä¸ªæœ¬åœ°ç¯å¢ƒï¼›å¦‚æœæ˜¯é›†ç¾¤ç¯å¢ƒï¼Œåˆ™è¿”å›é›†ç¾¤ç¯å¢ƒ- **createLocalEnvironment**  - ```java            StreamExecutionEnvironment localEnv = StreamExecutionEnvironment.createLocalEnvironment ( );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></code></pre></li><li><p>è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªæœ¬åœ°æ‰§è¡Œç¯å¢ƒã€‚å¯ä»¥åœ¨è°ƒç”¨æ—¶ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šé»˜è®¤çš„å¹¶è¡Œåº¦ï¼›å¦‚æœä¸ä¼ å…¥ï¼Œåˆ™é»˜è®¤å¹¶è¡Œåº¦å°±æ˜¯æœ¬åœ°çš„ CPU æ ¸å¿ƒæ•°ã€‚</p></li></ul></li><li><p><strong>createRemoteEnvironment</strong></p><ul><li><pre><code class="java">      StreamExecutionEnvironment remoteEnv = StreamExecutionEnvironment                .createRemoteEnvironment (                        "host", // JobManager ä¸»æœºå                        1234, // JobManager è¿›ç¨‹ç«¯å£å·                        "path/to/jarFile.jar" // æäº¤ç»™ JobManager çš„ JAR åŒ…                );<pre class="line-numbers language-none"><code class="language-none">  - åœ¨è·å–åˆ°ç¨‹åºæ‰§è¡Œç¯å¢ƒåï¼Œè¿˜å¯ä»¥å¯¹æ‰§è¡Œç¯å¢ƒè¿›è¡Œçµæ´»çš„è®¾ç½®ã€‚æ¯”å¦‚å¯ä»¥å…¨å±€è®¾ç½®ç¨‹åºçš„å¹¶è¡Œåº¦ã€ç¦ç”¨ç®—å­é“¾ï¼Œè¿˜å¯ä»¥å®šä¹‰ç¨‹åºçš„æ—¶é—´è¯­ä¹‰ã€é…ç½®å®¹é”™æœºåˆ¶ã€‚å…³äºæ—¶é—´è¯­ä¹‰å’Œå®¹é”™æœºåˆ¶#### 2ã€æ‰§è¡Œæ¨¡å¼```java        // æ‰¹å¤„ç†ç¯å¢ƒ        ExecutionEnvironment batchEnv = ExecutionEnvironment.getExecutionEnvironment ( );        // æµå¤„ç†ç¯å¢ƒ        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment ( );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></code></pre></li></ul></li></ul><h4 id="3ã€è§¦å‘ç¨‹åºæ‰§è¡Œ"><a href="#3ã€è§¦å‘ç¨‹åºæ‰§è¡Œ" class="headerlink" title="3ã€è§¦å‘ç¨‹åºæ‰§è¡Œ"></a>3ã€è§¦å‘ç¨‹åºæ‰§è¡Œ</h4><p>1ã€å½“ main()æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå…¶å®åªæ˜¯å®šä¹‰äº†ä½œä¸šçš„æ¯ä¸ªæ‰§è¡Œæ“ä½œï¼Œç„¶åæ·»åŠ åˆ°æ•°æ®æµå›¾ä¸­ï¼›è¿™æ—¶å¹¶æ²¡æœ‰çœŸæ­£å¤„ç†æ•°æ®ã€å› ä¸ºæ•°æ®å¯èƒ½è¿˜æ²¡æ¥ã€‘</p><p>2ã€åªæœ‰ç­‰åˆ°æ•°æ®åˆ°æ¥ï¼Œæ‰ä¼šè§¦å‘çœŸæ­£çš„è®¡ç®—ï¼Œè¿™ä¹Ÿè¢«ç§°ä¸ºâ€œå»¶è¿Ÿæ‰§è¡Œâ€æˆ–â€œæ‡’æ‰§è¡Œâ€</p><p>3ã€æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°è°ƒç”¨æ‰§è¡Œç¯å¢ƒçš„ execute()æ–¹æ³•ï¼Œæ¥è§¦å‘ç¨‹åºæ‰§è¡Œã€‚execute()æ–¹æ³•å°†ä¸€ç›´ç­‰å¾…ä½œä¸šå®Œæˆï¼Œç„¶åè¿”å›ä¸€ä¸ªæ‰§è¡Œç»“æœ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ä¸‰ã€æºç®—å­"><a href="#ä¸‰ã€æºç®—å­" class="headerlink" title="ä¸‰ã€æºç®—å­"></a>ä¸‰ã€æºç®—å­</h3><h4 id="1ã€å‡†å¤‡å·¥ä½œ"><a href="#1ã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="1ã€å‡†å¤‡å·¥ä½œ"></a>1ã€å‡†å¤‡å·¥ä½œ</h4><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬å…ˆæ„å»ºä¸€ä¸ªå®é™…åº”ç”¨åœºæ™¯ã€‚æ¯”å¦‚ç½‘ç«™çš„è®¿é—®æ“ä½œï¼Œå¯ä»¥æŠ½è±¡æˆä¸€ä¸ªä¸‰å…ƒç»„ï¼ˆç”¨æˆ·åï¼Œç”¨æˆ·è®¿é—®çš„ urrlï¼Œç”¨æˆ·è®¿é—® url çš„æ—¶é—´æˆ³ï¼‰ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç±» Eventï¼Œå°†ç”¨æˆ·è¡Œä¸ºåŒ…è£…æˆå®ƒçš„ä¸€ä¸ªå¯¹è±¡ã€‚Event åŒ…å«äº†ä»¥ä¸‹ä¸€äº›å­—æ®µ</p><table><thead><tr><th align="center">å­—æ®µå</th><th align="center">æ•°æ®ç±»å‹</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">user</td><td align="center">String</td><td align="center">ç”¨æˆ·å</td></tr><tr><td align="center">url</td><td align="center">String</td><td align="center">ç”¨æˆ·è®¿é—®çš„url</td></tr><tr><td align="center">timeStamp</td><td align="center">Long</td><td align="center">ç”¨æˆ·è®¿é—®urlçš„æ—¶é—´æˆ³</td></tr></tbody></table><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span><span class="token punctuation">;</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@ToString</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Event</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> user<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Long</span> timestamp<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><font color="red">è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬å®šä¹‰çš„ Eventï¼Œæœ‰è¿™æ ·å‡ ä¸ªç‰¹ç‚¹ï¼š</font></p><ul><li>ç±»æ˜¯å…¬æœ‰ï¼ˆpublicï¼‰çš„</li><li>æœ‰ä¸€ä¸ªæ— å‚çš„æ„é€ æ–¹æ³•</li><li>æ‰€æœ‰å±æ€§éƒ½æ˜¯å…¬æœ‰ï¼ˆpublicï¼‰çš„</li><li>æ‰€æœ‰å±æ€§çš„ç±»å‹éƒ½æ˜¯å¯ä»¥åºåˆ—åŒ–çš„</li></ul><p>Flink ä¼šæŠŠè¿™æ ·çš„ç±»ä½œä¸ºä¸€ç§ç‰¹æ®Šçš„ POJO æ•°æ®ç±»å‹æ¥å¯¹å¾…ï¼Œæ–¹ä¾¿æ•°æ®çš„è§£æå’Œåºåˆ—åŒ–ã€‚</p><h4 id="2ã€å¸¸è§„è¯»æ•°æ®"><a href="#2ã€å¸¸è§„è¯»æ•°æ®" class="headerlink" title="2ã€å¸¸è§„è¯»æ•°æ®"></a>2ã€å¸¸è§„è¯»æ•°æ®</h4><p>é›†åˆè¯»æ•°æ®-æ–‡ä»¶è¯»æ•°æ®-Socket è¯»æ•°æ®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span><span class="token comment">/* * @Description:    é›†åˆä¸­è¯»å–æ•°æ® * @Author:         é˜¿K * @CreateDate:     2022/5/24 22:04 * @Param: * @Return: **/</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SourceTest1</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®å¹¶è¡Œåº¦ä¸º 1 ï¼Œä¿è¯æœ‰åºè¿è¡Œ</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1.ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream1 <span class="token operator">=</span> env<span class="token punctuation">.</span>readTextFile <span class="token punctuation">(</span><span class="token string">"input/clicks.csv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2.ä»é›†åˆä¸­è¯»å–æ•°æ®</span>        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> nums <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        nums<span class="token punctuation">.</span>add <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        nums<span class="token punctuation">.</span>add <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> numStream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromCollection <span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> events <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        events<span class="token punctuation">.</span>add <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        events<span class="token punctuation">.</span>add <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./cart"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream2 <span class="token operator">=</span> env<span class="token punctuation">.</span>fromCollection <span class="token punctuation">(</span>events<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3.ä»å…ƒç´ è¯»å–æ•°æ®</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream3 <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./cart"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä»Socketæ–‡æœ¬æµè¯»å–</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream4 <span class="token operator">=</span> env<span class="token punctuation">.</span>socketTextStream <span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">7777</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        stream1.print("1");</span><span class="token comment">//        numStream.print("nums");</span><span class="token comment">//        stream2.print("2");</span><span class="token comment">//        stream3.print("3");</span>        stream4<span class="token punctuation">.</span>print <span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€Kafka-è¯»æ•°æ®-â˜…"><a href="#3ã€Kafka-è¯»æ•°æ®-â˜…" class="headerlink" title="3ã€Kafka è¯»æ•°æ® â˜…"></a>3ã€Kafka è¯»æ•°æ® â˜…</h4><p>Flink å®˜æ–¹æä¾›çš„æ˜¯ä¸€ä¸ªé€šç”¨çš„ Kafka è¿æ¥å™¨ï¼Œå®ƒä¼šè‡ªåŠ¨è·Ÿè¸ªæœ€æ–°ç‰ˆæœ¬çš„ Kafka å®¢æˆ·ç«¯</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-kafka_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åè°ƒç”¨ env.addSource()ï¼Œä¼ å…¥ FlinkKafkaConsumer çš„å¯¹è±¡å®ä¾‹å°±å¯ä»¥äº†</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>serialization<span class="token punctuation">.</span></span><span class="token class-name">SimpleStringSchema</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span></span><span class="token class-name">FlinkKafkaConsumer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SourceKafkaTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        properties<span class="token punctuation">.</span>setProperty <span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token string">"106.12.159.22:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        properties.setProperty("group.id", "consumer-group");</span><span class="token comment">//        properties.setProperty("key.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");</span><span class="token comment">//        properties.setProperty("value.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");</span><span class="token comment">//        properties.setProperty("auto.offset.reset", "latest");</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>addSource <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlinkKafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>                <span class="token string">"sun"</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">SimpleStringSchema</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>                properties        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stream<span class="token punctuation">.</span>print <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>åˆ›å»º FlinkKafkaConsumer æ—¶éœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š</strong> </p><p>âš« ç¬¬ä¸€ä¸ªå‚æ•° topicï¼Œå®šä¹‰äº†ä»å“ªäº›ä¸»é¢˜ä¸­è¯»å–æ•°æ®ã€‚å¯ä»¥æ˜¯ä¸€ä¸ª topicï¼Œä¹Ÿå¯ä»¥æ˜¯ topicåˆ—è¡¨ï¼Œè¿˜å¯ä»¥æ˜¯åŒ¹é…æ‰€æœ‰æƒ³è¦è¯»å–çš„ topic çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å½“ä»å¤šä¸ª topic ä¸­è¯»å–æ•°æ®æ—¶ï¼ŒKafka è¿æ¥å™¨å°†ä¼šå¤„ç†æ‰€æœ‰ topic çš„åˆ†åŒºï¼Œå°†è¿™äº›åˆ†åŒºçš„æ•°æ®æ”¾åˆ°ä¸€æ¡æµä¸­å»ã€‚ </p><p>âš« ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª DeserializationSchema æˆ–è€… KeyedDeserializationSchemaã€‚Kafka æ¶ˆæ¯è¢«å­˜å‚¨ä¸ºåŸå§‹çš„å­—èŠ‚æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ååºåˆ—åŒ–æˆ Java æˆ–è€… Scala å¯¹è±¡ã€‚ä¸Šé¢ä»£ç ä¸­ä½¿ç”¨çš„ SimpleStringSchemaï¼Œæ˜¯ä¸€ä¸ªå†…ç½®çš„ DeserializationSchemaï¼Œå®ƒåªæ˜¯å°†å­—èŠ‚æ•°ç»„ç®€å•åœ°ååºåˆ—åŒ–æˆå­—ç¬¦ä¸²ã€‚DeserializationSchema å’Œ KeyedDeserializationSchema æ˜¯å…¬å…±æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘ã€‚ </p><p>âš« ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª Properties å¯¹è±¡ï¼Œè®¾ç½®äº† Kafka å®¢æˆ·ç«¯çš„ä¸€äº›å±æ€§ã€‚ </p><p><strong>ç»“æœï¼š</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202205302348183.png"></p><h4 id="4ã€è‡ªå®šä¹‰-Source"><a href="#4ã€è‡ªå®šä¹‰-Source" class="headerlink" title="4ã€è‡ªå®šä¹‰ Source"></a>4ã€è‡ªå®šä¹‰ Source</h4><p>æƒ³è¦è¯»å–çš„æ•°æ®æºæ¥è‡ªæŸä¸ªå¤–éƒ¨ç³»ç»Ÿï¼Œè€Œ flink æ—¢æ²¡æœ‰é¢„å®ç°çš„æ–¹æ³•ã€ä¹Ÿæ²¡æœ‰æä¾›è¿æ¥å™¨ï¼Œ</p><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æ•°æ®æºï¼Œå®ç° SourceFunction æ¥å£</p><p>âš« run()æ–¹æ³•ï¼šä½¿ç”¨è¿è¡Œæ—¶ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆSourceContextï¼‰å‘ä¸‹æ¸¸å‘é€æ•°æ®ï¼› </p><p>âš« cancel()æ–¹æ³•ï¼šé€šè¿‡æ ‡è¯†ä½æ§åˆ¶é€€å‡ºå¾ªç¯ï¼Œæ¥è¾¾åˆ°ä¸­æ–­æ•°æ®æºçš„æ•ˆæœã€‚     </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>source<span class="token punctuation">.</span></span><span class="token class-name">SourceFunction</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Calendar</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClickSource</span> <span class="token keyword">implements</span> <span class="token class-name">SourceFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token comment">// å£°æ˜ä¸€ä¸ªå¸ƒå°”å˜é‡ï¼Œä½œä¸ºæ§åˆ¶æ•°æ®ç”Ÿæˆçš„æ ‡è¯†ä½</span>    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> running <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SourceContext</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// åœ¨æŒ‡å®šçš„æ•°æ®é›†ä¸­éšæœºé€‰å–æ•°æ®</span>        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> users <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"Cary"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> urls <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token string">"./cart"</span><span class="token punctuation">,</span> <span class="token string">"./fav"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=1"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=2"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>            ctx<span class="token punctuation">.</span>collect <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span>                    users<span class="token punctuation">[</span>random<span class="token punctuation">.</span>nextInt <span class="token punctuation">(</span>users<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    urls<span class="token punctuation">[</span>random<span class="token punctuation">.</span>nextInt <span class="token punctuation">(</span>urls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token class-name">Calendar</span><span class="token punctuation">.</span>getInstance <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>getTimeInMillis <span class="token punctuation">(</span> <span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// éš” 1 ç§’ç”Ÿæˆä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œæ–¹ä¾¿è§‚æµ‹</span>            <span class="token class-name">Thread</span><span class="token punctuation">.</span>sleep <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        running <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªæ•°æ®æºï¼Œæˆ‘ä»¬åé¢ä¼šé¢‘ç¹ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨åé¢çš„ä»£ç ä¸­æ¶‰åŠåˆ° ClickSource()æ•°æ®æºï¼Œä½¿ç”¨ä¸Šé¢çš„ä»£ç å°±å¯ä»¥äº†ã€‚</p><p>ä¸‹é¢çš„ä»£ç æˆ‘ä»¬æ¥è¯»å–ä¸€ä¸‹è‡ªå®šä¹‰çš„æ•°æ®æºã€‚æœ‰äº†è‡ªå®šä¹‰çš„ source functionï¼Œæ¥ä¸‹æ¥åªè¦è°ƒç”¨ addSource()å°±å¯ä»¥äº†</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>    <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æœ‰äº†è‡ªå®šä¹‰çš„ source functionï¼Œè°ƒç”¨ addSource æ–¹æ³•</span>    <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">addSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClickSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    stream<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"SourceCustom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰å¹¶è¡Œçš„æ•°æ®æºçš„è¯ï¼Œéœ€è¦ä½¿ç”¨ ParallelSourceFunction</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>    <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    env<span class="token punctuation">.</span>addSource <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomSource</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CustomSource</span> <span class="token keyword">implements</span> <span class="token class-name">ParallelSourceFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> running <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SourceContext</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> sourceContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>            sourceContext<span class="token punctuation">.</span>collect <span class="token punctuation">(</span>random<span class="token punctuation">.</span>nextInt <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        running <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€Flink-æ”¯æŒçš„æ•°æ®ç±»å‹"><a href="#5ã€Flink-æ”¯æŒçš„æ•°æ®ç±»å‹" class="headerlink" title="5ã€Flink æ”¯æŒçš„æ•°æ®ç±»å‹"></a>5ã€Flink æ”¯æŒçš„æ•°æ®ç±»å‹</h4><h5 id="1-Flink-çš„ç±»å‹ç³»ç»Ÿ"><a href="#1-Flink-çš„ç±»å‹ç³»ç»Ÿ" class="headerlink" title="1. Flink çš„ç±»å‹ç³»ç»Ÿ"></a>1. <strong>Flink</strong> <strong>çš„ç±»å‹ç³»ç»Ÿ</strong></h5><p>Flink æœ‰è‡ªå·±ä¸€æ•´å¥—ç±»å‹ç³»ç»Ÿã€‚Flink ä½¿ç”¨â€œç±»å‹ä¿¡æ¯â€ ï¼ˆTypeInformationï¼‰æ¥ç»Ÿä¸€è¡¨ç¤ºæ•°æ®ç±»å‹ã€‚TypeInformation ç±»æ˜¯ Flink ä¸­æ‰€æœ‰ç±»å‹æè¿°ç¬¦çš„åŸºç±»ã€‚ </p><p>å®ƒæ¶µç›–äº†ç±»å‹çš„ä¸€äº›åŸºæœ¬å±æ€§ï¼Œå¹¶ä¸ºæ¯ä¸ªæ•°æ®ç±»å‹ç”Ÿæˆç‰¹å®šçš„åºåˆ—åŒ–å™¨ã€ååºåˆ—åŒ–å™¨å’Œæ¯”è¾ƒå™¨ã€‚</p><h5 id="2-Flink-æ”¯æŒçš„æ•°æ®ç±»å‹"><a href="#2-Flink-æ”¯æŒçš„æ•°æ®ç±»å‹" class="headerlink" title="2. Flink æ”¯æŒçš„æ•°æ®ç±»å‹"></a>2. <strong>Flink</strong> <strong>æ”¯æŒçš„æ•°æ®ç±»å‹</strong></h5><p>ï¼ˆ1ï¼‰åŸºæœ¬ç±»å‹ </p><p>æ‰€æœ‰ Java åŸºæœ¬ç±»å‹åŠå…¶åŒ…è£…ç±»ï¼Œå†åŠ ä¸Š Voidã€Stringã€Dateã€BigDecimal å’Œ BigIntegerã€‚</p><p>ï¼ˆ2ï¼‰æ•°ç»„ç±»å‹ </p><p>åŒ…æ‹¬åŸºæœ¬ç±»å‹æ•°ç»„ï¼ˆPRIMITIVE_ARRAYï¼‰å’Œå¯¹è±¡æ•°ç»„(OBJECT_ARRAY)</p><p>ï¼ˆ3ï¼‰å¤åˆæ•°æ®ç±»å‹ </p><p>âš« Java å…ƒç»„ç±»å‹ï¼ˆTUPLEï¼‰ï¼šè¿™æ˜¯ Flink å†…ç½®çš„å…ƒç»„ç±»å‹ï¼Œæ˜¯ Java API çš„ä¸€éƒ¨åˆ†ã€‚æœ€å¤š 25 ä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯ä» Tuple0~Tuple25ï¼Œä¸æ”¯æŒç©ºå­—æ®µ </p><p>âš« Scala æ ·ä¾‹ç±»åŠ Scala å…ƒç»„ï¼šä¸æ”¯æŒç©ºå­—æ®µ </p><p>âš« è¡Œç±»å‹ï¼ˆROWï¼‰ï¼šå¯ä»¥è®¤ä¸ºæ˜¯å…·æœ‰ä»»æ„ä¸ªå­—æ®µçš„å…ƒç»„,å¹¶æ”¯æŒç©ºå­—æ®µ </p><p>âš« POJOï¼šFlink è‡ªå®šä¹‰çš„ç±»ä¼¼äº Java bean æ¨¡å¼çš„ç±» </p><p>ï¼ˆ4ï¼‰è¾…åŠ©ç±»å‹ </p><p>Optionã€Eitherã€Listã€Map ç­‰ </p><p>ï¼ˆ5ï¼‰æ³›å‹ç±»å‹ï¼ˆGENERICï¼‰ </p><p>Flink æ”¯æŒæ‰€æœ‰çš„ Java ç±»å’Œ Scala ç±»ã€‚ä¸è¿‡å¦‚æœæ²¡æœ‰æŒ‰ç…§ä¸Šé¢ POJO ç±»å‹çš„è¦æ±‚æ¥å®šä¹‰ï¼Œå°±ä¼šè¢« Flink å½“ä½œæ³›å‹ç±»æ¥å¤„ç†ã€‚Flink ä¼šæŠŠæ³›å‹ç±»å‹å½“ä½œé»‘ç›’ï¼Œæ— æ³•è·å–å®ƒä»¬å†…éƒ¨çš„å±æ€§ï¼›å®ƒä»¬ä¹Ÿä¸æ˜¯ç”± Flink æœ¬èº«åºåˆ—åŒ–çš„ï¼Œè€Œæ˜¯ç”± Kryo åºåˆ—åŒ–çš„ã€‚åœ¨è¿™äº›ç±»å‹ä¸­ï¼Œå…ƒç»„ç±»å‹å’Œ POJO ç±»å‹æœ€ä¸ºçµæ´»ï¼Œå› ä¸ºå®ƒä»¬æ”¯æŒåˆ›å»ºå¤æ‚ç±»å‹ã€‚è€Œç›¸æ¯”ä¹‹ä¸‹ï¼ŒPOJO è¿˜æ”¯æŒåœ¨é”®ï¼ˆkeyï¼‰çš„å®šä¹‰ä¸­ç›´æ¥ä½¿ç”¨å­—æ®µåï¼Œè¿™ä¼šè®©æˆ‘ä»¬çš„ä»£ç å¯è¯»æ€§å¤§å¤§å¢åŠ ã€‚æ‰€ä»¥ï¼Œåœ¨é¡¹ç›®å®è·µä¸­ï¼Œå¾€å¾€ä¼šå°†æµå¤„ç†ç¨‹åºä¸­çš„å…ƒç´ ç±»å‹å®šä¸º Flink çš„ POJO ç±»å‹ã€‚ </p><p>Flink å¯¹ POJO ç±»å‹çš„è¦æ±‚å¦‚ä¸‹ï¼š </p><p>âš« ç±»æ˜¯å…¬å…±çš„ï¼ˆpublicï¼‰å’Œç‹¬ç«‹çš„ï¼ˆstandaloneï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰éé™æ€çš„å†…éƒ¨ç±»ï¼‰ï¼› </p><p>âš« ç±»æœ‰ä¸€ä¸ªå…¬å…±çš„æ— å‚æ„é€ æ–¹æ³•ï¼› </p><p>âš« ç±»ä¸­çš„æ‰€æœ‰å­—æ®µæ˜¯ public ä¸”é final çš„ï¼›æˆ–è€…æœ‰ä¸€ä¸ªå…¬å…±çš„ getter å’Œ setter æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éœ€è¦ç¬¦åˆ Java bean çš„å‘½åè§„èŒƒã€‚ </p><p>æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°ï¼Œä¹‹å‰çš„ UserBehaviorï¼Œå°±æ˜¯æˆ‘ä»¬åˆ›å»ºçš„ç¬¦åˆ Flink POJO å®šä¹‰çš„æ•°æ®ç±»å‹ã€‚</p><h5 id="3-ç±»å‹æç¤ºï¼ˆType-Hintsï¼‰"><a href="#3-ç±»å‹æç¤ºï¼ˆType-Hintsï¼‰" class="headerlink" title="3. ç±»å‹æç¤ºï¼ˆType Hintsï¼‰"></a>3. ç±»å‹æç¤ºï¼ˆType Hintsï¼‰</h5><p>ç”±äº Java ä¸­æ³›å‹æ“¦é™¤çš„å­˜åœ¨ï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼ˆæ¯”å¦‚ Lambda è¡¨è¾¾å¼ä¸­ï¼‰ï¼Œä¸ºäº†è§£å†³è¿™ç±»é—®é¢˜ï¼ŒJava API æä¾›äº†ä¸“é—¨çš„â€œç±»å‹æç¤ºâ€ï¼ˆtype hintsï¼‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>word <span class="token operator">-&gt;</span> <span class="token class-name">Tuple2</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token function">TUPLE</span><span class="token punctuation">(</span><span class="token class-name">Types</span><span class="token punctuation">.</span>STRING<span class="token punctuation">,</span> <span class="token class-name">Types</span><span class="token punctuation">.</span>LONG<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token function">returns</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeHint</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">SomeType</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å››ã€è½¬æ¢ç®—å­"><a href="#å››ã€è½¬æ¢ç®—å­" class="headerlink" title="å››ã€è½¬æ¢ç®—å­"></a>å››ã€è½¬æ¢ç®—å­</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202206012345924.png"></p><h4 id="1ã€åŸºæœ¬è½¬æ¢ç®—å­"><a href="#1ã€åŸºæœ¬è½¬æ¢ç®—å­" class="headerlink" title="1ã€åŸºæœ¬è½¬æ¢ç®—å­"></a>1ã€åŸºæœ¬è½¬æ¢ç®—å­</h4><h5 id="1-æ˜ å°„ï¼ˆmapï¼‰"><a href="#1-æ˜ å°„ï¼ˆmapï¼‰" class="headerlink" title="1. æ˜ å°„ï¼ˆmapï¼‰"></a><strong>1. æ˜ å°„</strong>ï¼ˆmapï¼‰</h5><p>ä¸»è¦ç”¨äºå°†æ•°æ®æµä¸­çš„æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œå½¢æˆæ–°çš„æ•°æ®æµã€‚ç®€å•æ¥è¯´ï¼Œæ¶ˆè´¹ä¸€ä¸ªå…ƒç´ å°±äº§å‡ºä¸€ä¸ªå…ƒç´ </p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202206012359042.png"></p><p>æˆ‘ä»¬åªéœ€è¦åŸºäº DataStrema è°ƒç”¨ map()æ–¹æ³•å°±å¯ä»¥è¿›è¡Œè½¬æ¢å¤„ç†ã€‚æ–¹æ³•éœ€è¦ä¼ å…¥çš„å‚æ•°æ˜¯æ¥å£ MapFunction çš„å®ç°ï¼›è¿”å›å€¼ç±»å‹è¿˜æ˜¯ DataStream</p><p>egï¼šæå– Event ä¸­çš„ user å­—æ®µçš„åŠŸèƒ½</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">MapFunction</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransMapTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ›é€ æ‰§è¡Œç¯å¢ƒ</span>        <span class="token comment">// å¹¶è¡Œä¸º 1</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ„å»ºæ•°æ®</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./cart"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å†™æ³•ä¸€ï¼šä¼ å…¥åŒ¿åç±»ï¼Œå®ç° MapFunction</span>        stream<span class="token punctuation">.</span>map <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MapFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Event</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> e<span class="token punctuation">.</span>user<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å†™æ³•äºŒï¼š ä¼ å…¥ MapFunction çš„å®ç°ç±»</span>        <span class="token comment">//stream.map (new UserExtractor ()).print ();</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UserExtractor</span> <span class="token keyword">implements</span> <span class="token class-name">MapFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Event</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> e<span class="token punctuation">.</span>user<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒMapFunction å®ç°ç±»çš„æ³›å‹ç±»å‹ï¼Œä¸è¾“å…¥æ•°æ®ç±»å‹å’Œè¾“å‡ºæ•°æ®çš„ç±»å‹æœ‰å…³ã€‚åœ¨å®ç° MapFunction æ¥å£çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šä¸¤ä¸ªæ³›å‹ï¼Œåˆ†åˆ«æ˜¯è¾“å…¥äº‹ä»¶å’Œè¾“å‡ºäº‹ä»¶çš„ç±»å‹ï¼Œè¿˜éœ€è¦é‡å†™ä¸€ä¸ª map()æ–¹æ³•ï¼Œå®šä¹‰ä»ä¸€ä¸ªè¾“å…¥äº‹ä»¶è½¬æ¢ä¸ºå¦ä¸€ä¸ªè¾“å‡ºäº‹ä»¶çš„å…·ä½“é€»è¾‘ã€‚ </p><h5 id="2-è¿‡æ»¤ï¼ˆfilterï¼‰"><a href="#2-è¿‡æ»¤ï¼ˆfilterï¼‰" class="headerlink" title="2. è¿‡æ»¤ï¼ˆfilterï¼‰"></a><strong>2. è¿‡æ»¤ï¼ˆfilterï¼‰</strong></h5><p>filter è½¬æ¢æ“ä½œï¼Œé¡¾åæ€ä¹‰æ˜¯å¯¹æ•°æ®æµæ‰§è¡Œä¸€ä¸ªè¿‡æ»¤ï¼Œé€šè¿‡ä¸€ä¸ªå¸ƒå°”æ¡ä»¶è¡¨è¾¾å¼è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œå¯¹äºæ¯ä¸€ä¸ªæµå†…å…ƒç´ è¿›è¡Œåˆ¤æ–­ï¼Œè‹¥ä¸º true åˆ™å…ƒç´ æ­£å¸¸è¾“å‡ºï¼Œè‹¥ä¸º false åˆ™å…ƒç´ è¢«è¿‡æ»¤æ‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202206072208877.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">FilterFunction</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransFilterTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ›é€ æ‰§è¡Œç¯å¢ƒ</span>        <span class="token comment">// å¹¶è¡Œä¸º 1</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ„å»ºæ•°æ®</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./cart"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å†™æ³•ä¸€ï¼šä¼ å…¥åŒ¿åç±»å®ç° FilterFunction</span>        stream<span class="token punctuation">.</span>filter <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FilterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">Event</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> e<span class="token punctuation">.</span>user<span class="token punctuation">.</span>equals <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å†™æ³•äºŒï¼šä¼ å…¥ FilterFunction å®ç°ç±»</span>        stream<span class="token punctuation">.</span>filter <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserFilter</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UserFilter</span> <span class="token keyword">implements</span> <span class="token class-name">FilterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">Event</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> e<span class="token punctuation">.</span>user<span class="token punctuation">.</span>equals <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿›è¡Œ filter è½¬æ¢ä¹‹åçš„æ–°æ•°æ®æµçš„æ•°æ®ç±»å‹ä¸åŸæ•°æ®æµæ˜¯ç›¸åŒçš„ã€‚filter è½¬æ¢éœ€è¦ä¼ å…¥çš„å‚æ•°éœ€è¦å®ç° FilterFunction æ¥å£ï¼Œè€Œ FilterFunction å†…è¦å®ç° filter()æ–¹æ³•ï¼Œå°±ç›¸å½“äºä¸€ä¸ªè¿”å›å¸ƒå°”ç±»å‹çš„æ¡ä»¶è¡¨è¾¾å¼ã€‚ </p><h5 id="3ã€æ‰å¹³æ˜ å°„ï¼ˆflatMapï¼‰"><a href="#3ã€æ‰å¹³æ˜ å°„ï¼ˆflatMapï¼‰" class="headerlink" title="3ã€æ‰å¹³æ˜ å°„ï¼ˆflatMapï¼‰"></a><strong>3ã€æ‰å¹³æ˜ å°„ï¼ˆflatMapï¼‰</strong></h5><p>flatMap æ“ä½œåˆç§°ä¸ºæ‰å¹³æ˜ å°„ï¼Œä¸»è¦æ˜¯å°†æ•°æ®æµä¸­çš„æ•´ä½“ï¼ˆä¸€èˆ¬æ˜¯é›†åˆç±»å‹ï¼‰æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„ä¸ªä½“ä½¿ç”¨ã€‚æ¶ˆè´¹ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥äº§ç”Ÿ 0 åˆ°å¤šä¸ªå…ƒç´ ,ä¹Ÿå°±æ˜¯å…ˆæŒ‰ç…§æŸç§è§„åˆ™å¯¹æ•°æ®è¿›è¡Œæ‰“æ•£æ‹†åˆ†ï¼Œå†å¯¹æ‹†åˆ†åçš„å…ƒç´ åšè½¬æ¢å¤„ç†</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202206072215902.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">FlatMapFunction</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collector</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransFlatmapTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ›é€ æ‰§è¡Œç¯å¢ƒ</span>        <span class="token comment">// å¹¶è¡Œä¸º 1</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ„å»ºæ•°æ®</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./cart"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        stream<span class="token punctuation">.</span>flatMap <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlatMapFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">Event</span> e<span class="token punctuation">,</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> collector<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>user<span class="token punctuation">.</span>equals <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    collector<span class="token punctuation">.</span>collect <span class="token punctuation">(</span>e<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>user<span class="token punctuation">.</span>equals <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    collector<span class="token punctuation">.</span>collect <span class="token punctuation">(</span>e<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>                    collector<span class="token punctuation">.</span>collect <span class="token punctuation">(</span>e<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// print () æ‰“å°</span>        <span class="token comment">// æ‰§è¡Œ</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>flatMap æ“ä½œä¼šåº”ç”¨åœ¨æ¯ä¸€ä¸ªè¾“å…¥äº‹ä»¶ä¸Šé¢ï¼ŒFlatMapFunction æ¥å£ä¸­å®šä¹‰äº† flatMap æ–¹æ³•ï¼Œ ç”¨æˆ·å¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¯¹è¾“å…¥æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶å†³å®šæ˜¯è¿”å› 0 ä¸ªã€1 ä¸ªæˆ–å¤šä¸ªç»“æœæ•°æ®ã€‚å› æ­¤ flatMap å¹¶æ²¡æœ‰ç›´æ¥å®šä¹‰è¿”å›å€¼ç±»å‹ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªâ€œæ”¶é›†å™¨â€ï¼ˆCollectorï¼‰æ¥æŒ‡å®šè¾“å‡ºã€‚å¸Œæœ›è¾“å‡ºç»“æœæ—¶ï¼Œåªè¦è°ƒç”¨æ”¶é›†å™¨çš„.collect()æ–¹æ³•å°±å¯ä»¥äº†ï¼›è¿™ä¸ªæ–¹æ³•å¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥ä¸è°ƒç”¨ã€‚æ‰€ä»¥ flatMap æ–¹æ³•ä¹Ÿå¯ä»¥å®ç° map æ–¹æ³•å’Œ filter æ–¹æ³•çš„åŠŸèƒ½ï¼Œå½“è¿”å›ç»“æœæ˜¯ 0 ä¸ªçš„æ—¶å€™ï¼Œå°±ç›¸å½“äºå¯¹æ•°æ®è¿›è¡Œäº†è¿‡æ»¤ï¼Œå½“è¿”å›ç»“æœæ˜¯ 1 ä¸ªçš„æ—¶å€™ï¼Œç›¸å½“äºå¯¹æ•°æ®è¿›è¡Œäº†ç®€å•çš„è½¬æ¢æ“ä½œã€‚ </p><h4 id="2ã€èšåˆç®—å­"><a href="#2ã€èšåˆç®—å­" class="headerlink" title="2ã€èšåˆç®—å­"></a>2ã€èšåˆç®—å­</h4><h5 id="1-æŒ‰é”®åˆ†åŒº"><a href="#1-æŒ‰é”®åˆ†åŒº" class="headerlink" title="1. æŒ‰é”®åˆ†åŒº"></a>1. æŒ‰é”®åˆ†åŒº</h5><p>keyBy æ˜¯èšåˆå‰å¿…é¡»è¦ç”¨åˆ°çš„ä¸€ä¸ªç®—å­ã€‚keyBy é€šè¿‡æŒ‡å®šé”®ï¼ˆkeyï¼‰ï¼Œå¯ä»¥å°†ä¸€æ¡æµä»é€»è¾‘ä¸Šåˆ’åˆ†æˆä¸åŒçš„åˆ†åŒºï¼ˆpartitionsï¼‰ã€‚è¿™é‡Œæ‰€è¯´çš„åˆ†åŒºï¼Œå…¶å®å°±æ˜¯å¹¶è¡Œå¤„ç†çš„å­ä»»åŠ¡ï¼Œä¹Ÿå°±å¯¹åº”ç€ä»»åŠ¡æ§½</p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202206072326233.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSink</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransKeyByTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ›é€ æ‰§è¡Œç¯å¢ƒ</span>        <span class="token comment">// å¹¶è¡Œä¸º 1</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ„å»ºæ•°æ®</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./cart"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// lambda</span>        <span class="token class-name">DataStreamSink</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> byKeyStream <span class="token operator">=</span> stream<span class="token punctuation">.</span>keyBy <span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-ç®€å•èšåˆ"><a href="#2-ç®€å•èšåˆ" class="headerlink" title="2. ç®€å•èšåˆ"></a>2. <strong>ç®€å•èšåˆ</strong></h5><p>âš« sum()ï¼šåœ¨è¾“å…¥æµä¸Šï¼Œå¯¹æŒ‡å®šçš„å­—æ®µåšå åŠ æ±‚å’Œçš„æ“ä½œã€‚ </p><p>âš« min()ï¼šåœ¨è¾“å…¥æµä¸Šï¼Œå¯¹æŒ‡å®šçš„å­—æ®µæ±‚æœ€å°å€¼ã€‚ </p><p>âš« max()ï¼šåœ¨è¾“å…¥æµä¸Šï¼Œå¯¹æŒ‡å®šçš„å­—æ®µæ±‚æœ€å¤§å€¼ã€‚ </p><p>âš« minBy()ï¼šä¸ min()ç±»ä¼¼ï¼Œåœ¨è¾“å…¥æµä¸Šé’ˆå¯¹æŒ‡å®šå­—æ®µæ±‚æœ€å°å€¼ã€‚ä¸åŒçš„æ˜¯ï¼Œmin()åªè®¡ç®—æŒ‡å®šå­—æ®µçš„æœ€å°å€¼ï¼Œå…¶ä»–å­—æ®µä¼šä¿ç•™æœ€åˆç¬¬ä¸€ä¸ªæ•°æ®çš„å€¼ï¼›è€Œ minBy()åˆ™ä¼šè¿”å›åŒ… å«å­—æ®µæœ€å°å€¼çš„æ•´æ¡æ•°æ®ã€‚ </p><p>âš« maxBy()ï¼šä¸ max()ç±»ä¼¼ï¼Œåœ¨è¾“å…¥æµä¸Šé’ˆå¯¹æŒ‡å®šå­—æ®µæ±‚æœ€å¤§å€¼ã€‚ä¸¤è€…åŒºåˆ«ä¸ min()/minBy()å®Œå…¨ä¸€è‡´ã€‚ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>tuple<span class="token punctuation">.</span></span><span class="token class-name">Tuple2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransTupleAggreationTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ›é€ æ‰§è¡Œç¯å¢ƒ</span>        <span class="token comment">// å¹¶è¡Œä¸º 1</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ„å»ºæ•°æ®</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>                <span class="token class-name">Tuple2</span><span class="token punctuation">.</span>of <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token class-name">Tuple2</span><span class="token punctuation">.</span>of <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token class-name">Tuple2</span><span class="token punctuation">.</span>of <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token class-name">Tuple2</span><span class="token punctuation">.</span>of <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token class-name">Tuple2</span><span class="token punctuation">.</span>of <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token class-name">Tuple2</span><span class="token punctuation">.</span>of <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//     stream.keyBy(r -&gt; r.f0).sum(1).print("SUM:");</span><span class="token comment">//        stream.keyBy(r -&gt; r.f0).sum("f1").print();</span>        stream<span class="token punctuation">.</span><span class="token function">keyBy</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span>f0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"MAX"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        stream.keyBy(r -&gt; r.f0).max("f1").print();</span><span class="token comment">//        stream.keyBy(r -&gt; r.f0).min(1).print();</span><span class="token comment">//        stream.keyBy(r -&gt; r.f0).min("f1").print();</span><span class="token comment">//        stream.keyBy(r -&gt; r.f0).maxBy(1).print();</span><span class="token comment">//        stream.keyBy(r -&gt; r.f0).maxBy("f1").print();</span><span class="token comment">//        stream.keyBy(r -&gt; r.f0).minBy(1).print();</span><span class="token comment">//        stream.keyBy(r -&gt; r.f0).minBy("f1").print();</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202206082139500.png"></p><p>è€Œå¦‚æœæ•°æ®æµçš„ç±»å‹æ˜¯ POJO ç±»ï¼Œé‚£ä¹ˆå°±åªèƒ½é€šè¿‡å­—æ®µåç§°æ¥æŒ‡å®šï¼Œä¸èƒ½é€šè¿‡ä½ç½®æ¥æŒ‡å®šäº†</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model3</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransformSimpleaggTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"/home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/cart"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"/prod?id=100"</span><span class="token punctuation">,</span> <span class="token number">3000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/prod?id=1"</span><span class="token punctuation">,</span> <span class="token number">3300L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/home?id=2"</span><span class="token punctuation">,</span> <span class="token number">3800L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"/prod?id=200"</span><span class="token punctuation">,</span> <span class="token number">3200L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/home?id=3"</span><span class="token punctuation">,</span> <span class="token number">4000L</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æŒ‰é”®åˆ†ç»„ä¹‹åè¿›è¡Œèšåˆï¼Œæå–å½“å‰ç”¨æˆ·æœ€è¿‘ä¸€æ¬¡è®¿é—®æ•°æ®ï¼ˆæœ€å¤§æ—¶é—´æ•°å€¼ï¼‰</span>        <span class="token comment">/*stream.keyBy (new KeySelector&lt;Event, String&gt; ( ) {            @Override            public String getKey(Event val) {                return val.user;            }        });*/</span>        <span class="token comment">// ä»¥å user ä½œä¸º key,timestamp ä½œä¸ºæ’åºå€¼</span>        stream<span class="token punctuation">.</span>keyBy <span class="token punctuation">(</span>val <span class="token operator">-&gt;</span>val<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>max <span class="token punctuation">(</span><span class="token string">"timestamp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span><span class="token string">"max:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stream<span class="token punctuation">.</span>keyBy <span class="token punctuation">(</span>val <span class="token operator">-&gt;</span>val<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>maxBy <span class="token punctuation">(</span><span class="token string">"timestamp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span><span class="token string">"maxBy:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ€»ç»“ï¼šåŒæ ·ï¼Œmaxå’ŒmaxByçš„åŒºåˆ«åœ¨äºï¼Œmaxç®—å­å¯¹æŸå­—æ®µæ±‚æœ€å¤§å€¼ï¼ŒmaxByè¿”å›å…·æœ‰æœ€å¤§å€¼çš„å…ƒç´ ã€‚</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ€»ç»“ï¼šåŒæ ·ï¼Œmaxå’ŒmaxByçš„åŒºåˆ«åœ¨äºï¼Œmaxç®—å­å¯¹æŸå­—æ®µæ±‚æœ€å¤§å€¼ï¼ŒmaxByè¿”å›å…·æœ‰æœ€å¤§å€¼çš„å…ƒç´ ã€‚</p><h5 id="3-å½’çº¦èšåˆï¼ˆreduceï¼‰"><a href="#3-å½’çº¦èšåˆï¼ˆreduceï¼‰" class="headerlink" title="3. å½’çº¦èšåˆï¼ˆreduceï¼‰"></a>3. <strong>å½’çº¦èšåˆï¼ˆ</strong>reduce<strong>ï¼‰</strong></h5><p>éœ€æ±‚ï¼šç»Ÿè®¡å‡ºç”¨æˆ·è®¿é—®é¢‘ç‡æœ€é«˜çš„</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model3</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">MapFunction</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">ReduceFunction</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>tuple<span class="token punctuation">.</span></span><span class="token class-name">Tuple2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">SingleOutputStreamOperator</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransformReduceTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"/home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/cart"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"/prod?id=100"</span><span class="token punctuation">,</span> <span class="token number">3000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/prod?id=1"</span><span class="token punctuation">,</span> <span class="token number">3300L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"/prod?id=200"</span><span class="token punctuation">,</span> <span class="token number">3200L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/home?id=2"</span><span class="token punctuation">,</span> <span class="token number">3800L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/home?id=3"</span><span class="token punctuation">,</span> <span class="token number">4000L</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1ã€ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„è®¿é—®é¢‘ç‡</span>        <span class="token comment">// ä¾ç„¶æ˜¯ä¸€ä¸ªDataStream</span>        <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> clicksByUser <span class="token operator">=</span> stream<span class="token punctuation">.</span>map <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MapFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">,</span> <span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">Tuple2</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Event</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token class-name">Tuple2</span><span class="token punctuation">.</span>of <span class="token punctuation">(</span>val<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å°†pojoè½¬æˆäºŒå…ƒç»„ï¼Œæ¯æ¬¡ç”¨æˆ·+1æ¬¡,ç›¸å½“äºèµ‹å€¼Listä¸­çš„å…ƒç´ </span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keyBy <span class="token punctuation">(</span>data <span class="token operator">-&gt;</span> data<span class="token punctuation">.</span>f0<span class="token punctuation">)</span><span class="token comment">// æŒ‰é”®åˆ†åŒº(ç»„</span>                <span class="token punctuation">.</span>reduce <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ReduceFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">public</span> <span class="token class-name">Tuple2</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Tuple2</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> val1<span class="token punctuation">,</span> <span class="token class-name">Tuple2</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> val2<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>                        <span class="token comment">// æ–°äºŒå…ƒç»„ å‚1ä¸ºkey,å‚2ä¸ºæ¯æ¬¡çš„å åŠ </span>                        <span class="token keyword">return</span> <span class="token class-name">Tuple2</span><span class="token punctuation">.</span>of <span class="token punctuation">(</span>val1<span class="token punctuation">.</span>f0<span class="token punctuation">,</span> val1<span class="token punctuation">.</span>f1 <span class="token operator">+</span> val2<span class="token punctuation">.</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2ã€è·å–å½“å‰æœ€æ´»è·ƒçš„ç”¨æˆ·</span>        <span class="token comment">// æ‰€æœ‰çš„æ•°æ®éƒ½æœ‰ç›¸åŒçš„keyï¼Œéƒ½ä¼šåˆ†é…åˆ°åŒä¸€ä¸ªåˆ†åŒºï¼ˆç”Ÿäº§æ…ç”¨ï¼ŒåŒä¸€ä¸ªåˆ†åŒºåˆ™ä¸ºä¸²è¡Œï¼ˆå•çº¿ç¨‹ï¼‰ï¼‰</span>        <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> clicksByUser<span class="token punctuation">.</span>keyBy <span class="token punctuation">(</span>data <span class="token operator">-&gt;</span> <span class="token string">"key"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>reduce <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ReduceFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">public</span> <span class="token class-name">Tuple2</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Tuple2</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> val1<span class="token punctuation">,</span> <span class="token class-name">Tuple2</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> val2<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>                        <span class="token comment">// åˆ¤æ–­è°çš„æ•°å€¼å¤§ï¼Œè¾“å‡ºå®Œæ•´å®ä½“</span>                        <span class="token keyword">return</span> val1<span class="token punctuation">.</span>f1 <span class="token operator">&gt;</span> val2<span class="token punctuation">.</span>f1 <span class="token operator">?</span> val1 <span class="token operator">:</span> val2<span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        result<span class="token punctuation">.</span>print <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡º</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰"><a href="#3ã€è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰" class="headerlink" title="3ã€è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰"></a>3ã€è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰</h4><h5 id="1ã€å‡½æ•°ç±»"><a href="#1ã€å‡½æ•°ç±»" class="headerlink" title="1ã€å‡½æ•°ç±»"></a>1ã€å‡½æ•°ç±»</h5><p>å…¶å®ä¸Šé¢å·²ç»ä»‹ç»è¿‡</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303252125554.png"></p><h5 id="2ã€åŒ¿åç±»"><a href="#2ã€åŒ¿åç±»" class="headerlink" title="2ã€åŒ¿åç±»"></a>2ã€åŒ¿åç±»</h5><p>å…¶å®ä¸Šé¢å·²ç»ä»‹ç»è¿‡</p><p><a href="https://v1.mykkto.cn/image/blog/2022/Interview/202303252125554.png">https://v1.mykkto.cn/image/blog/2022/Interview/202303252125554.png</a></p><h5 id="3ã€å¯Œå‡½æ•°"><a href="#3ã€å¯Œå‡½æ•°" class="headerlink" title="3ã€å¯Œå‡½æ•°"></a>3ã€å¯Œå‡½æ•°</h5><p>ç”Ÿå‘½å‘¨æœŸï¼š</p><p>open()æ–¹æ³•ï¼Œæ˜¯ Rich Function çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¼šå¼€å¯ä¸€ä¸ªç®—å­çš„ç”Ÿå‘½å‘¨æœŸã€‚å½“ä¸€ä¸ªç®—å­çš„å®é™…å·¥ä½œæ–¹æ³•ä¾‹å¦‚ map()æˆ–è€… filter()æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰ï¼Œ</p><p>close()æ–¹æ³•ï¼Œæ˜¯ç”Ÿå‘½å‘¨æœŸä¸­çš„æœ€åä¸€ä¸ªè°ƒç”¨çš„æ–¹æ³•ï¼Œç±»ä¼¼äºè§£æ„æ–¹æ³•ã€‚ä¸€èˆ¬ç”¨æ¥åšä¸€äº›æ¸…ç†å·¥ä½œã€‚ </p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºä¸€ä¸ªå¹¶è¡Œå­ä»»åŠ¡æ¥è¯´åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼›è€Œå¯¹åº”çš„ï¼Œ å®é™…å·¥ä½œæ–¹æ³•ï¼Œåœ¨æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šè§¦å‘ä¸€æ¬¡è°ƒç”¨ã€‚ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ¯”å¦‚1æ˜¯ä¸²è¡Œï¼Œå°±ä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå¼€å…³æ–¹æ³•å°±è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœ setParallelism ä¸º2å°±æ˜¯ä¸¤æ¬¡å¼€å…³ç”Ÿå‘½å‘¨æœŸ</p><p>ä¸Šæ¡ˆä¾‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model3</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">RichMapFunction</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransformRichFunctionTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span>                <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ³¨æ„ï¼šè¿™è¾¹çº¿ç¨‹1ä¸ªç”Ÿå‘½å‘¨æœŸå¼€å…³ä¸€æ¬¡ï¼Œ2ä¸ªä¾¿æœ‰2é</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Tom"</span><span class="token punctuation">,</span> <span class="token string">"./cart"</span><span class="token punctuation">,</span> <span class="token number">3000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./cart?id=1"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®å¹¶è¡Œåº¦=ç”Ÿå‘½å‘¨æœŸæ¬¡æ•°</span>        stream<span class="token punctuation">.</span>map <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyRichMapper</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyRichMapper</span> <span class="token keyword">extends</span> <span class="token class-name">RichMapFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> parameters<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">open</span> <span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è·å–å½“å‰ç´¢å¼•å·</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"openç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š"</span> <span class="token operator">+</span> getRuntimeContext <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>getIndexOfThisSubtask <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å·ä»»åŠ¡å¯åŠ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Event</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> value<span class="token punctuation">.</span>url<span class="token punctuation">.</span>length <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>            <span class="token keyword">super</span><span class="token punctuation">.</span>close <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"closeç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š"</span> <span class="token operator">+</span> getRuntimeContext <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>getIndexOfThisSubtask <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å·ä»»åŠ¡å¯åŠ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-print" data-language="print"><code class="language-print">openç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š1å·ä»»åŠ¡å¯åŠ¨openç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š0å·ä»»åŠ¡å¯åŠ¨closeç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š0å·ä»»åŠ¡å¯åŠ¨closeç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨ï¼š1å·ä»»åŠ¡å¯åŠ¨6116<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›è¿æ¥åˆ°ä¸€ä¸ªå¤–éƒ¨æ•°æ®åº“è¿›è¡Œè¯»å†™æ“ä½œï¼Œé‚£ä¹ˆå°†è¿æ¥æ“ä½œæ”¾åœ¨ map()ä¸­æ˜¾ç„¶ä¸æ˜¯ä¸ªå¥½é€‰æ‹©â€”â€”å› ä¸ºæ¯æ¥ä¸€æ¡æ•°æ®å°±ä¼šé‡æ–°è¿æ¥ä¸€æ¬¡æ•°æ®åº“ï¼›æ‰€ä»¥ æˆ‘ä»¬å¯ä»¥åœ¨ open()ä¸­å»ºç«‹è¿æ¥ï¼Œåœ¨ map()ä¸­è¯»å†™æ•°æ®ï¼Œè€Œåœ¨ close()ä¸­å…³é—­è¿æ¥ã€‚æ‰€ä»¥æˆ‘ä»¬æ¨èçš„æœ€ä½³å®è·µå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFlatMap</span> <span class="token keyword">extends</span> <span class="token class-name">RichFlatMapFunction</span><span class="token generics"><span class="token punctuation">&lt;</span>IN<span class="token punctuation">,</span> OUT<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span> configuration<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// åšä¸€äº›åˆå§‹åŒ–å·¥ä½œ</span> <span class="token comment">// ä¾‹å¦‚å»ºç«‹ä¸€ä¸ªå’Œ MySQL çš„è¿æ¥</span> <span class="token punctuation">}</span> <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">IN</span> in<span class="token punctuation">,</span> <span class="token class-name">Collector</span><span class="token operator">&lt;</span><span class="token class-name">OUT</span> out<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¯¹æ•°æ®åº“è¿›è¡Œè¯»å†™</span> <span class="token punctuation">}</span> <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// æ¸…ç†å·¥ä½œï¼Œå…³é—­å’Œ MySQL æ•°æ®åº“çš„è¿æ¥ã€‚</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€ç‰©ç†åˆ†åŒº"><a href="#4ã€ç‰©ç†åˆ†åŒº" class="headerlink" title="4ã€ç‰©ç†åˆ†åŒº"></a>4ã€ç‰©ç†åˆ†åŒº</h4><h5 id="1ã€éšæœºåˆ†åŒº"><a href="#1ã€éšæœºåˆ†åŒº" class="headerlink" title="1ã€éšæœºåˆ†åŒº"></a>1ã€éšæœºåˆ†åŒº</h5><h5 id="2ã€è½®è®­åˆ†åŒºï¼ˆé»˜è®¤ï¼‰"><a href="#2ã€è½®è®­åˆ†åŒºï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="2ã€è½®è®­åˆ†åŒºï¼ˆé»˜è®¤ï¼‰"></a>2ã€è½®è®­åˆ†åŒºï¼ˆé»˜è®¤ï¼‰</h5><h5 id="3ã€rescale-é‡ç¼©æ”¾åˆ†åŒº"><a href="#3ã€rescale-é‡ç¼©æ”¾åˆ†åŒº" class="headerlink" title="3ã€rescale é‡ç¼©æ”¾åˆ†åŒº"></a>3ã€rescale é‡ç¼©æ”¾åˆ†åŒº</h5><h5 id="4ã€å¹¿æ’­ï¼ˆå‘ç»™æ¯ä¸ªçº¿ç¨‹ï¼‰"><a href="#4ã€å¹¿æ’­ï¼ˆå‘ç»™æ¯ä¸ªçº¿ç¨‹ï¼‰" class="headerlink" title="4ã€å¹¿æ’­ï¼ˆå‘ç»™æ¯ä¸ªçº¿ç¨‹ï¼‰"></a>4ã€å¹¿æ’­ï¼ˆå‘ç»™æ¯ä¸ªçº¿ç¨‹ï¼‰</h5><h5 id="5ã€å…¨å±€åˆ†åŒºï¼ˆå¼ºè¡Œè®¾ç½®æˆ-1-ä¸²è¡Œï¼‰"><a href="#5ã€å…¨å±€åˆ†åŒºï¼ˆå¼ºè¡Œè®¾ç½®æˆ-1-ä¸²è¡Œï¼‰" class="headerlink" title="5ã€å…¨å±€åˆ†åŒºï¼ˆå¼ºè¡Œè®¾ç½®æˆ 1 ä¸²è¡Œï¼‰"></a>5ã€å…¨å±€åˆ†åŒºï¼ˆå¼ºè¡Œè®¾ç½®æˆ 1 ä¸²è¡Œï¼‰</h5><h5 id="6ã€è‡ªå®šä¹‰é‡åˆ†åŒºï¼ˆæœ‰ç‚¹åƒ4ï¼‰"><a href="#6ã€è‡ªå®šä¹‰é‡åˆ†åŒºï¼ˆæœ‰ç‚¹åƒ4ï¼‰" class="headerlink" title="6ã€è‡ªå®šä¹‰é‡åˆ†åŒºï¼ˆæœ‰ç‚¹åƒ4ï¼‰"></a>6ã€è‡ªå®šä¹‰é‡åˆ†åŒºï¼ˆæœ‰ç‚¹åƒ4ï¼‰</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model3</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">Partitioner</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">KeySelector</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>source<span class="token punctuation">.</span></span><span class="token class-name">RichParallelSourceFunction</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransformPartitionTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span>  <span class="token punctuation">{</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"/home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/cart"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"/prod?id=100"</span><span class="token punctuation">,</span> <span class="token number">3000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/prod?id=1"</span><span class="token punctuation">,</span> <span class="token number">3300L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"/prod?id=200"</span><span class="token punctuation">,</span> <span class="token number">3200L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/home?id=2"</span><span class="token punctuation">,</span> <span class="token number">3800L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"/home?id=3"</span><span class="token punctuation">,</span> <span class="token number">4000L</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        m6 <span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token class-name">DataStreamSource</span> stream<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// 1ã€éšæœºåˆ†åŒº</span>        stream<span class="token punctuation">.</span>shuffle <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m2</span><span class="token punctuation">(</span><span class="token class-name">DataStreamSource</span> stream<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// 2ã€è½®è®­åˆ†åŒº</span>        stream<span class="token punctuation">.</span>print <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        stream.rebalance ().print ().setParallelism (3);</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m3</span><span class="token punctuation">(</span><span class="token class-name">StreamExecutionEnvironment</span> env<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// 3ã€rescale é‡ç¼©æ”¾åˆ†åŒº(ä½¿ç”¨åˆç†çš„è¯æ•ˆç‡æ›´é«˜</span>        <span class="token comment">// RichParallelSourceFunction æŠ½è±¡çˆ¶å‡½æ•°çš„å­å®ç°</span>        env<span class="token punctuation">.</span>addSource <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RichParallelSourceFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SourceContext</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ctx<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment">// å°†å¥‡å¶æ•°åˆ†åˆ«å‘é€åˆ°0å·æˆ–1å·åˆ†åŒº</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span>getRuntimeContext <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getIndexOfThisSubtask <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        ctx<span class="token punctuation">.</span>collect <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token string">","</span><span class="token operator">+</span>getRuntimeContext <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getIndexOfThisSubtask <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rescale <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m4</span><span class="token punctuation">(</span><span class="token class-name">DataStreamSource</span> stream<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// 4ã€å¹¿æ’­ï¼ˆå‘ç»™æ¯ä¸ªçº¿ç¨‹ï¼‰</span>        stream<span class="token punctuation">.</span>broadcast <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m5</span><span class="token punctuation">(</span><span class="token class-name">DataStreamSource</span> stream<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// 5ã€å…¨å±€åˆ†åŒºï¼ˆå¼ºè¡Œè®¾ç½®æˆ 1 ä¸²è¡Œï¼‰</span>        stream<span class="token punctuation">.</span>global <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>print <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m6</span><span class="token punctuation">(</span><span class="token class-name">StreamExecutionEnvironment</span> env<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// 6ã€è‡ªå®šä¹‰é‡åˆ†åŒºï¼ˆè‡ªå®šä¹‰åˆ†åŒºå™¨ï¼Œæ•°æ®é•¿ä»€ä¹ˆæ ·ï¼Œå°±åˆ†é…åˆ°å“ªé‡Œï¼‰</span>        env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>partitionCustom <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Partitioner</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment">// æŒ‡å®šåˆ†åŒºç­–ç•¥</span>                        <span class="token keyword">return</span> key <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">KeySelector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> value<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>                        <span class="token keyword">return</span> value<span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>print <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="äº”ã€è¾“å‡ºç®—å­"><a href="#äº”ã€è¾“å‡ºç®—å­" class="headerlink" title="äº”ã€è¾“å‡ºç®—å­"></a>äº”ã€è¾“å‡ºç®—å­</h3><h4 id="1ã€è¾“å‡ºåˆ°æ–‡ä»¶"><a href="#1ã€è¾“å‡ºåˆ°æ–‡ä»¶" class="headerlink" title="1ã€è¾“å‡ºåˆ°æ–‡ä»¶"></a>1ã€è¾“å‡ºåˆ°æ–‡ä»¶</h4><p>æ¯”å¦‚æˆ‘ä»¬ç»å¸¸ç”¨çš„æ—¥å¿—æ–‡ä»¶ï¼Œå°±æ˜¯ç±»ä¼¼äºè¿™ç§æ»šåŠ¨è¾“å‡º</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model4</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span></span><span class="token class-name">BaseUtil</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>serialization<span class="token punctuation">.</span></span><span class="token class-name">SimpleStringEncoder</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>core<span class="token punctuation">.</span>fs<span class="token punctuation">.</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>sink<span class="token punctuation">.</span>filesystem<span class="token punctuation">.</span></span><span class="token class-name">StreamingFileSink</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>sink<span class="token punctuation">.</span>filesystem<span class="token punctuation">.</span>rollingpolicies<span class="token punctuation">.</span></span><span class="token class-name">DefaultRollingPolicy</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SinkToFileTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">// 1ã€å®šä¹‰Stringç±»å‹æ–¹ä¾¿è¾“å‡º</span>        <span class="token class-name">StreamingFileSink</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> streamingFileSink <span class="token operator">=</span> <span class="token class-name">StreamingFileSink</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>forRowFormat <span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Path</span> <span class="token punctuation">(</span><span class="token string">"./output"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// è¾“å‡ºè·¯å¾„</span>                <span class="token keyword">new</span> <span class="token class-name">SimpleStringEncoder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//å­—ç¬¦é›†</span>                <span class="token comment">// æŒ‡å®šæ»šåŠ¨ç­–ç•¥ï¼š</span>                <span class="token comment">//   æ¯”å¦‚æ—¥å¿—æ–‡ä»¶ä¸åœå†™å…¥ï¼Œæ–‡ä»¶ä¸åœå¢å¤§ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªç­–ç•¥è®¾ç½®ä¸€ä¸ªæ–‡ä»¶å¤šå¤§åœæ­¢å†™å…¥ï¼Œ</span>                <span class="token comment">//   å¼€å¯ä¸€ä¸ªæ–°çš„æ–‡ä»¶ç»§ç»­å†™å…¥</span>                <span class="token punctuation">.</span>withRollingPolicy <span class="token punctuation">(</span>                        <span class="token class-name">DefaultRollingPolicy</span><span class="token punctuation">.</span>builder <span class="token punctuation">(</span> <span class="token punctuation">)</span>                                <span class="token punctuation">.</span>withMaxPartSize <span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token comment">// æ»šåŠ¨å¤§å°ï¼š1G</span>                                <span class="token comment">// æ»šåŠ¨æ—¶é—´ï¼Œ15åˆ†é’Ÿå¼€å¯ä¸€ä¸ªæ–°çš„</span>                                <span class="token punctuation">.</span>withRolloverInterval <span class="token punctuation">(</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">.</span>toMinutes <span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                                <span class="token comment">// æ»šåŠ¨å‘¨æœŸï¼ˆå¦‚æœ5åˆ†é’Ÿæ²¡æœ‰æ•°æ®å†™å…¥ï¼Œåˆ™å¼€å¯ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼‰</span>                                <span class="token punctuation">.</span>withInactivityInterval <span class="token punctuation">(</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">.</span>toMinutes <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                                <span class="token punctuation">.</span>build <span class="token punctuation">(</span> <span class="token punctuation">)</span>                <span class="token punctuation">)</span>                <span class="token punctuation">.</span>build <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ„å»ºè¿”å›å¯¹è±¡</span>        <span class="token class-name">BaseUtil</span><span class="token punctuation">.</span>stream<span class="token punctuation">.</span>map <span class="token punctuation">(</span>data <span class="token operator">-&gt;</span> data<span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>addSink <span class="token punctuation">(</span>streamingFileSink<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BaseUtil</span><span class="token punctuation">.</span>env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BaseUtil</span><span class="token punctuation">.</span>env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€è¾“å‡ºåˆ°kafka"><a href="#2ã€è¾“å‡ºåˆ°kafka" class="headerlink" title="2ã€è¾“å‡ºåˆ°kafka"></a>2ã€è¾“å‡ºåˆ°kafka</h4><p>ï¼ˆ1ï¼‰åˆ›å»ºç”Ÿäº§è€…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>ã€è¿›å…¥å®¹å™¨docker <span class="token builtin class-name">exec</span> -it kafka /bin/sh<span class="token number">2</span>ã€è¿›å…¥é©±åŠ¨æ–‡ä»¶è·¯å¾„<span class="token builtin class-name">cd</span> opt/kafka/bin<span class="token number">3</span>ã€åˆ›å»ºç”Ÿäº§è€… ./kafka-console-producer.sh --broker-list localhost:9092 --topic clicks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ï¼ˆ2ï¼‰åˆ›å»ºæ¶ˆè´¹è€…</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">.</span>/kafka<span class="token operator">-</span>console<span class="token operator">-</span>consumer<span class="token punctuation">.</span>sh <span class="token operator">--</span>bootstrap<span class="token operator">-</span>server localhost<span class="token operator">:</span><span class="token number">9092</span> <span class="token operator">--</span>from<span class="token operator">-</span>beginning <span class="token operator">--</span>topic events<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ï¼ˆ3ï¼‰ç¼–ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model4</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span></span><span class="token class-name">BaseUtil</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">MapFunction</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>serialization<span class="token punctuation">.</span></span><span class="token class-name">SimpleStringSchema</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">SingleOutputStreamOperator</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span></span><span class="token class-name">FlinkKafkaConsumer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span></span><span class="token class-name">FlinkKafkaProducer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SinkToKafka</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        properties<span class="token punctuation">.</span>setProperty <span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token class-name">BaseUtil</span><span class="token punctuation">.</span>KAFKAURL<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1ã€ä»kafkaä¸­è¯»å–æ•°æ®</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kafkaStream <span class="token operator">=</span> env<span class="token punctuation">.</span>addSource <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlinkKafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>                <span class="token string">"clicks"</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">SimpleStringSchema</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>                properties        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        kafkaStream<span class="token punctuation">.</span>print <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2ã€ç”¨flinkè¿›è¡Œè½¬æ¢å¤„ç†</span>        <span class="token class-name">SingleOutputStreamOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> kafkaStream<span class="token punctuation">.</span>map <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MapFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> value<span class="token punctuation">.</span>split <span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trim <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> fields<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>trim <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span>valueOf <span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toString <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3ã€ç»“æœæ•°æ®å†™å…¥ kafka</span>        result<span class="token punctuation">.</span>addSink <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlinkKafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token class-name">BaseUtil</span><span class="token punctuation">.</span>KAFKAURL<span class="token punctuation">,</span><span class="token string">"events"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">SimpleStringSchema</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>(4)æµç¨‹</p><p>ç”Ÿäº§è€…å‘é€ -ã€‹ flink æ¥æ”¶å¤„ç† -ã€‹ kafka æ¶ˆè´¹è€…æ¶ˆè´¹</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202303262114955.png"></p><p>ï¼ˆXï¼‰è¡¥å……ï¼škafka å¯¹å¤–è¿œç¨‹æ˜ å°„</p><p>docker å¯åŠ¨éœ€è¦æŒ‡å®šå…¬ç½‘é…ç½®ï¼Œå¦‚æœæ²¡æœ‰é…ç½®çš„è¯ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶é…ç½®(é‡å¯æœ‰è‡ªåŠ¨é‡åˆ·å›åŸå§‹çš„é—®é¢˜)</p><p>é…ç½®è·¯å¾„ï¼š<code>opt/kafka/conf/services.properties</code></p><h4 id="3ã€è¾“å‡ºåˆ°Redis"><a href="#3ã€è¾“å‡ºåˆ°Redis" class="headerlink" title="3ã€è¾“å‡ºåˆ°Redis"></a>3ã€è¾“å‡ºåˆ°Redis</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.bahir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-redis_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éœ€è¦å®ç°ä¸€ä¸ªå­ç±»å®ç°æ¥å£ RedisMapperï¼Œè¿™è¾¹ä½¿ç”¨åŒ¿åç±»ï¼Œä¸»è¦æ˜¯ RedisCommandDescription çš„ä¸¤ä¸ªå‚æ•°ï¼Œä»¥åŠå…¶ä»–ä¸¤ä¸ªå‡½æ•°keyï¼Œvalueçš„é‡å†™</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model4</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span></span><span class="token class-name">ClickSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>redis<span class="token punctuation">.</span></span><span class="token class-name">RedisSink</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>common<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">FlinkJedisPoolConfig</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>common<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">RedisCommand</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>common<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">RedisCommandDescription</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>common<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">RedisMapper</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SinkToRedis</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Event æ˜¯æˆ‘ä»¬å°è£…çš„ç±»å®ä½“</span>        <span class="token class-name">FlinkJedisPoolConfig</span> conf <span class="token operator">=</span> <span class="token keyword">new</span>                <span class="token class-name">FlinkJedisPoolConfig</span><span class="token punctuation">.</span><span class="token class-name">Builder</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>setHost <span class="token punctuation">(</span><span class="token class-name">IpUtil</span><span class="token punctuation">.</span>IPREDIS<span class="token punctuation">)</span><span class="token punctuation">.</span>build <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>addSource <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClickSource</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token comment">// åŒ¿åå†…éƒ¨ç±»å®ç° RedisMapperæ¥å£</span>                <span class="token punctuation">.</span>addSink <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RedisSink</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RedisMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getKeyFromData</span><span class="token punctuation">(</span><span class="token class-name">Event</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">return</span> e<span class="token punctuation">.</span>user<span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getValueFromData</span><span class="token punctuation">(</span><span class="token class-name">Event</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">return</span> event<span class="token punctuation">.</span>url<span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token annotation punctuation">@Override</span>                    <span class="token keyword">public</span> <span class="token class-name">RedisCommandDescription</span> <span class="token function">getCommandDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment">// å‚æ•°1ï¼šredis å­˜å‚¨çš„æ•°æ®ç»“æ„ç±»å‹ hset æ•£åˆ—å‡½æ•°</span>                        <span class="token comment">// å‚æ•°2ï¼šredis çš„ key  clicks</span>                        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedisCommandDescription</span> <span class="token punctuation">(</span><span class="token class-name">RedisCommand</span><span class="token punctuation">.</span>HSET<span class="token punctuation">,</span> <span class="token string">"clicks"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// è‡ªå®šä¹‰å®ç°RedisMapperæ¥å£</span>    <span class="token comment">//public static class MyRedisMapper implements RedisMapper&lt;Event&gt;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€è¾“å‡ºåˆ°ElasticecSearch"><a href="#4ã€è¾“å‡ºåˆ°ElasticecSearch" class="headerlink" title="4ã€è¾“å‡ºåˆ°ElasticecSearch"></a>4ã€è¾“å‡ºåˆ°ElasticecSearch</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-elasticsearch7_${scala.binary.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model4</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">RuntimeContext</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchSinkFunction</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span></span><span class="token class-name">RequestIndexer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>elasticsearch6<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchSink</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHost</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span>index<span class="token punctuation">.</span></span><span class="token class-name">IndexRequest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Requests</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SinkToElasticSearch</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span>                <span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>setParallelism <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Event</span><span class="token punctuation">[</span><span class="token punctuation">]</span> events <span class="token operator">=</span> <span class="token punctuation">{</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./cart"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=100"</span><span class="token punctuation">,</span> <span class="token number">3000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=200"</span><span class="token punctuation">,</span> <span class="token number">3500L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=2"</span><span class="token punctuation">,</span> <span class="token number">2500L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=300"</span><span class="token punctuation">,</span> <span class="token number">3600L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token number">3000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=1"</span><span class="token punctuation">,</span> <span class="token number">2300L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=3"</span><span class="token punctuation">,</span> <span class="token number">3300L</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment">// å‚æ•°æ˜¯ä¸ªå¯å˜æ•°ç»„</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>events<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpHost</span><span class="token punctuation">&gt;</span></span> httpHosts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        httpHosts<span class="token punctuation">.</span>add <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpHost</span> <span class="token punctuation">(</span><span class="token class-name">IpUtil</span><span class="token punctuation">.</span>IPES<span class="token punctuation">,</span> <span class="token number">9200</span><span class="token punctuation">,</span> <span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ›å»ºä¸€ä¸ª ElasticsearchSinkFunction</span>        <span class="token class-name">ElasticsearchSinkFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> elasticsearchSinkFunction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ElasticsearchSinkFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">Event</span> event<span class="token punctuation">,</span> <span class="token class-name">RuntimeContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">RequestIndexer</span> indexer<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                data<span class="token punctuation">.</span>put <span class="token punctuation">(</span>event<span class="token punctuation">.</span>user<span class="token punctuation">,</span> event<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">IndexRequest</span> request <span class="token operator">=</span> <span class="token class-name">Requests</span><span class="token punctuation">.</span>indexRequest <span class="token punctuation">(</span> <span class="token punctuation">)</span>                        <span class="token punctuation">.</span>index <span class="token punctuation">(</span><span class="token string">"clicks"</span><span class="token punctuation">)</span> <span class="token comment">// keyå</span>                        <span class="token punctuation">.</span>type <span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">)</span><span class="token comment">// Es 6 å¿…é¡»å®šä¹‰ type</span>                        <span class="token punctuation">.</span>source <span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                indexer<span class="token punctuation">.</span>add <span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        stream<span class="token punctuation">.</span>addSink <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ElasticsearchSink</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>httpHosts<span class="token punctuation">,</span> elasticsearchSinkFunction<span class="token punctuation">)</span><span class="token punctuation">.</span>build <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>esæ”¯æŒ resté£æ ¼ï¼Œæ‰€ä»¥ç›´æ¥è®¿é—®æŸ¥çœ‹æ˜¯å¦æœ‰æ•°æ®äº†</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202304092230369.png"></p><h4 id="5ã€è¾“å‡ºåˆ°MySQL-JDBC"><a href="#5ã€è¾“å‡ºåˆ°MySQL-JDBC" class="headerlink" title="5ã€è¾“å‡ºåˆ°MySQL(JDBC)"></a>5ã€è¾“å‡ºåˆ°MySQL(JDBC)</h4><pre class="line-numbers language-ddl" data-language="ddl"><code class="language-ddl">create table clicks(user varchar(20) not null,url varchar(100) not null);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model4</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>model2<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">JdbcConnectionOptions</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">JdbcExecutionOptions</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">JdbcSink</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SinkToMySQL</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span>                <span class="token punctuation">.</span>getExecutionEnvironment <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements <span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Mary"</span><span class="token punctuation">,</span> <span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./cart"</span><span class="token punctuation">,</span> <span class="token number">2000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=100"</span><span class="token punctuation">,</span> <span class="token number">3000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=200"</span><span class="token punctuation">,</span> <span class="token number">3500L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=2"</span><span class="token punctuation">,</span> <span class="token number">2500L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=300"</span><span class="token punctuation">,</span> <span class="token number">3600L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./home"</span><span class="token punctuation">,</span> <span class="token number">3000L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=1"</span><span class="token punctuation">,</span> <span class="token number">2300L</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Event</span> <span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"./prod?id=3"</span><span class="token punctuation">,</span> <span class="token number">3300L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        stream<span class="token punctuation">.</span>addSink <span class="token punctuation">(</span>                <span class="token class-name">JdbcSink</span><span class="token punctuation">.</span>sink <span class="token punctuation">(</span>                        <span class="token string">"INSERT INTO clicks (user, url) VALUES (?, ?)"</span><span class="token punctuation">,</span>                        <span class="token punctuation">(</span>statement<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                            statement<span class="token punctuation">.</span>setString <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>                            statement<span class="token punctuation">.</span>setString <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span><span class="token punctuation">,</span>                        <span class="token class-name">JdbcExecutionOptions</span><span class="token punctuation">.</span>builder <span class="token punctuation">(</span> <span class="token punctuation">)</span>                                <span class="token punctuation">.</span>withBatchSize <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>                                <span class="token punctuation">.</span>withBatchIntervalMs <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>                                <span class="token punctuation">.</span>withMaxRetries <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>                                <span class="token punctuation">.</span>build <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token keyword">new</span>                                <span class="token class-name">JdbcConnectionOptions</span><span class="token punctuation">.</span><span class="token class-name">JdbcConnectionOptionsBuilder</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span>                                <span class="token punctuation">.</span>withUrl <span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/book"</span><span class="token punctuation">)</span>                                                <span class="token comment">// å¯¹äº MySQL 5.7ï¼Œç”¨"com.mysql.jdbc.Driver"</span>                                                <span class="token punctuation">.</span>withDriverName <span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span>                                                <span class="token punctuation">.</span>withUsername <span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span>                                                <span class="token punctuation">.</span>withPassword <span class="token punctuation">(</span><span class="token string">"a1b2c3"</span><span class="token punctuation">)</span>                                                <span class="token punctuation">.</span>build <span class="token punctuation">(</span> <span class="token punctuation">)</span>                                <span class="token punctuation">)</span>                <span class="token punctuation">)</span><span class="token punctuation">;</span>        env<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ã€è‡ªå®šä¹‰Sinkè¾“å‡º"><a href="#6ã€è‡ªå®šä¹‰Sinkè¾“å‡º" class="headerlink" title="6ã€è‡ªå®šä¹‰Sinkè¾“å‡º"></a>6ã€è‡ªå®šä¹‰Sinkè¾“å‡º</h4><p>Flink ä¸ºæˆ‘ä»¬æä¾›äº†é€šç”¨çš„ SinkFunction æ¥å£å’Œå¯¹åº”çš„ RichSinkDunction æŠ½è±¡ç±»ï¼Œåªè¦å®ç°å®ƒï¼Œé€šè¿‡ç®€å•åœ°è°ƒç”¨ DataStream çš„.addSink()æ–¹æ³•å°±å¯ä»¥è‡ªå®šä¹‰å†™å…¥ä»»ä½•å¤–éƒ¨å­˜å‚¨ã€‚</p><p>ä¾‹å¦‚ï¼ŒFlink å¹¶æ²¡æœ‰æä¾› HBase çš„è¿æ¥å™¨ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªå·±å†™</p><p>åœ¨å®ç° SinkFunction çš„æ—¶å€™ï¼Œéœ€è¦é‡å†™çš„ä¸€ä¸ªå…³é”®æ–¹æ³• invoke(),</p><p>åˆ›å»º HBase çš„è¿æ¥ä»¥åŠå…³é—­ HBase çš„è¿æ¥éœ€è¦åˆ†åˆ«æ”¾åœ¨ open()æ–¹æ³•å’Œ close()æ–¹æ³•ä¸­ã€‚ </p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>itd <span class="token punctuation">-</span>h hbase.dev.xhyun.vip <span class="token punctuation">-</span><span class="token punctuation">-</span>name hbase2.1 <span class="token punctuation">-</span>p 2181<span class="token punctuation">:</span>2181 <span class="token punctuation">-</span>p 8080<span class="token punctuation">:</span>8080 <span class="token punctuation">-</span>p 8085<span class="token punctuation">:</span>8085 <span class="token punctuation">-</span>p 9090<span class="token punctuation">:</span>9090 <span class="token punctuation">-</span>p 9095<span class="token punctuation">:</span>9095 <span class="token punctuation">-</span>p 16000<span class="token punctuation">:</span>16000 <span class="token punctuation">-</span>p 16010<span class="token punctuation">:</span>16010 <span class="token punctuation">-</span>p 16201<span class="token punctuation">:</span>16201 <span class="token punctuation">-</span>p 16301<span class="token punctuation">:</span>16301 harisekhon/hbase<span class="token punctuation">:</span>2.1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¿é—®åœ°å€ï¼š<code>http://mykkto.cn:16010/master-status</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="â…£ã€Flink-æ—¶é—´å’Œçª—å£"><a href="#â…£ã€Flink-æ—¶é—´å’Œçª—å£" class="headerlink" title="â…£ã€Flink æ—¶é—´å’Œçª—å£"></a>â…£ã€Flink æ—¶é—´å’Œçª—å£</h2><h3 id="ä¸€ã€æ—¶é—´è¯­ä¹‰"><a href="#ä¸€ã€æ—¶é—´è¯­ä¹‰" class="headerlink" title="ä¸€ã€æ—¶é—´è¯­ä¹‰"></a>ä¸€ã€æ—¶é—´è¯­ä¹‰</h3><h3 id="äºŒã€æ°´ä½çº¿"><a href="#äºŒã€æ°´ä½çº¿" class="headerlink" title="äºŒã€æ°´ä½çº¿"></a>äºŒã€æ°´ä½çº¿</h3><h3 id="ä¸‰ã€çª—å£"><a href="#ä¸‰ã€çª—å£" class="headerlink" title="ä¸‰ã€çª—å£"></a>ä¸‰ã€çª—å£</h3><h3 id="å››ã€è¿Ÿåˆ°æ•°æ®çš„å¤„ç†"><a href="#å››ã€è¿Ÿåˆ°æ•°æ®çš„å¤„ç†" class="headerlink" title="å››ã€è¿Ÿåˆ°æ•°æ®çš„å¤„ç†"></a>å››ã€è¿Ÿåˆ°æ•°æ®çš„å¤„ç†</h3><h3 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h3><h2 id="â…¤ã€å¤„ç†å‡½æ•°"><a href="#â…¤ã€å¤„ç†å‡½æ•°" class="headerlink" title="â…¤ã€å¤„ç†å‡½æ•°"></a>â…¤ã€å¤„ç†å‡½æ•°</h2><h2 id="â…¥ã€å¤šæµè½¬æ¢"><a href="#â…¥ã€å¤šæµè½¬æ¢" class="headerlink" title="â…¥ã€å¤šæµè½¬æ¢"></a>â…¥ã€å¤šæµè½¬æ¢</h2><h2 id="â…¦ã€çŠ¶æ€ç¼–ç¨‹"><a href="#â…¦ã€çŠ¶æ€ç¼–ç¨‹" class="headerlink" title="â…¦ã€çŠ¶æ€ç¼–ç¨‹"></a>â…¦ã€çŠ¶æ€ç¼–ç¨‹</h2><h2 id="â…§ã€å®¹é”™æœºåˆ¶"><a href="#â…§ã€å®¹é”™æœºåˆ¶" class="headerlink" title="â…§ã€å®¹é”™æœºåˆ¶"></a>â…§ã€å®¹é”™æœºåˆ¶</h2><h2 id="â…¨ã€Table-API-and-SQL"><a href="#â…¨ã€Table-API-and-SQL" class="headerlink" title="â…¨ã€Table API and SQL"></a>â…¨ã€Table API and SQL</h2><h2 id="â…©ã€Flink-CEP"><a href="#â…©ã€Flink-CEP" class="headerlink" title="â…©ã€Flink CEP"></a>â…©ã€Flink CEP</h2><h2 id="å‚è€ƒåœ°å€-â†“"><a href="#å‚è€ƒåœ°å€-â†“" class="headerlink" title="å‚è€ƒåœ°å€ â†“"></a>å‚è€ƒåœ°å€ â†“</h2><h3 id="1ã€docker-åŠ é€Ÿï¼ˆåšä¸»ç®€ä¹¦ï¼‰"><a href="#1ã€docker-åŠ é€Ÿï¼ˆåšä¸»ç®€ä¹¦ï¼‰" class="headerlink" title="1ã€docker åŠ é€Ÿï¼ˆåšä¸»ç®€ä¹¦ï¼‰"></a>1ã€docker åŠ é€Ÿï¼ˆåšä¸»ç®€ä¹¦ï¼‰</h3><p>urlï¼š<a href="https://www.jianshu.com/p/f554c85b25c1">https://www.jianshu.com/p/f554c85b25c1</a></p><h3 id="2ã€Hadoop-å•æœºå®‰è£…"><a href="#2ã€Hadoop-å•æœºå®‰è£…" class="headerlink" title="2ã€Hadoop å•æœºå®‰è£…"></a>2ã€Hadoop å•æœºå®‰è£…</h3><p>urlï¼š<a href="https://blog.51cto.com/u_15187242/4760802">https://blog.51cto.com/u_15187242/4760802</a></p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>i <span class="token punctuation">-</span>t <span class="token punctuation">-</span><span class="token punctuation">-</span>network host <span class="token punctuation">-</span>p 50070<span class="token punctuation">:</span>50070 <span class="token punctuation">-</span>p 9000<span class="token punctuation">:</span>9000 <span class="token punctuation">-</span>p 8088<span class="token punctuation">:</span>8088 <span class="token punctuation">-</span>p 8040<span class="token punctuation">:</span>8040 <span class="token punctuation">-</span>p 8042<span class="token punctuation">:</span>8042 <span class="token punctuation">-</span>p 49707<span class="token punctuation">:</span>49707 <span class="token punctuation">-</span>p 50010<span class="token punctuation">:</span>50010 <span class="token punctuation">-</span>p 50075<span class="token punctuation">:</span>50075 <span class="token punctuation">-</span>p 50090<span class="token punctuation">:</span>50090 sequenceiq/hadoop<span class="token punctuation">-</span>docker<span class="token punctuation">:</span>2.7.0 /etc/bootstrap.sh <span class="token punctuation">-</span>bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3ã€Hadoopé›†ç¾¤"><a href="#3ã€Hadoopé›†ç¾¤" class="headerlink" title="3ã€Hadoopé›†ç¾¤"></a>3ã€Hadoopé›†ç¾¤</h3><p>urlï¼š<a href="https://dhcp.cn/k8s/docker/deploy_hadoop.html#reference">https://dhcp.cn/k8s/docker/deploy_hadoop.html#reference</a></p><h3 id="4ã€Hadoopå¸¸ç”¨ç«¯å£"><a href="#4ã€Hadoopå¸¸ç”¨ç«¯å£" class="headerlink" title="4ã€Hadoopå¸¸ç”¨ç«¯å£"></a>4ã€Hadoopå¸¸ç”¨ç«¯å£</h3><p>urlï¼š<a href="https://blog.csdn.net/qq_36816848/article/details/113106441">https://blog.csdn.net/qq_36816848/article/details/113106441</a></p><h3 id="5ã€nc-lk-æ¨¡æ‹Ÿå®æ—¶æ•°æ®"><a href="#5ã€nc-lk-æ¨¡æ‹Ÿå®æ—¶æ•°æ®" class="headerlink" title="5ã€nc -lk æ¨¡æ‹Ÿå®æ—¶æ•°æ®"></a>5ã€nc -lk æ¨¡æ‹Ÿå®æ—¶æ•°æ®</h3><p>urlï¼š<a href="https://www.csdn.net/tags/MtzakgwsODA4NjktYmxvZwO0O0OO0O0O.html">https://www.csdn.net/tags/MtzakgwsODA4NjktYmxvZwO0O0OO0O0O.html</a></p><h3 id="6ã€Flinkï¼ˆdockerï¼‰å¿«é€Ÿæ­å»º"><a href="#6ã€Flinkï¼ˆdockerï¼‰å¿«é€Ÿæ­å»º" class="headerlink" title="6ã€Flinkï¼ˆdockerï¼‰å¿«é€Ÿæ­å»º"></a>6ã€Flinkï¼ˆdockerï¼‰å¿«é€Ÿæ­å»º</h3><p>urlï¼š<a href="https://blog.csdn.net/weixin_42357472/article/details/118223101">https://blog.csdn.net/weixin_42357472/article/details/118223101</a></p><h3 id="7ã€Zookeeper-docker-å¿«é€Ÿæ­å»º"><a href="#7ã€Zookeeper-docker-å¿«é€Ÿæ­å»º" class="headerlink" title="7ã€Zookeeper(docker)å¿«é€Ÿæ­å»º"></a>7ã€Zookeeper(docker)å¿«é€Ÿæ­å»º</h3><p>æ‹‰å–urlï¼š<a href="https://blog.csdn.net/u010416101/article/details/122803105">https://blog.csdn.net/u010416101/article/details/122803105</a></p><p>å¯åŠ¨urlï¼š<a href="https://www.cnblogs.com/shanfeng1000/p/14488665.html">https://www.cnblogs.com/shanfeng1000/p/14488665.html</a></p><h3 id="8ã€kafka-docker-å¿«é€Ÿæ­å»º"><a href="#8ã€kafka-docker-å¿«é€Ÿæ­å»º" class="headerlink" title="8ã€kafka(docker)å¿«é€Ÿæ­å»º"></a>8ã€kafka(docker)å¿«é€Ÿæ­å»º</h3><p>æ­å»ºurlï¼š<a href="https://www.cnblogs.com/shanfeng1000/p/14638455.html">https://www.cnblogs.com/shanfeng1000/p/14638455.html</a></p><p>ä½¿ç”¨urlï¼š<a href="https://blog.csdn.net/qq_22041375/article/details/106180415">https://blog.csdn.net/qq_22041375/article/details/106180415</a></p><h3 id="9ã€ESï¼ˆdockerï¼‰å¿«é€Ÿæ­å»º"><a href="#9ã€ESï¼ˆdockerï¼‰å¿«é€Ÿæ­å»º" class="headerlink" title="9ã€ESï¼ˆdockerï¼‰å¿«é€Ÿæ­å»º"></a>9ã€ESï¼ˆdockerï¼‰å¿«é€Ÿæ­å»º</h3><p>urlï¼š<a href="https://www.cnblogs.com/nesn/p/15898123.html">https://www.cnblogs.com/nesn/p/15898123.html</a></p><h3 id="10ã€Hbase-docker-æ­å»ºå’Œæµ‹è¯•"><a href="#10ã€Hbase-docker-æ­å»ºå’Œæµ‹è¯•" class="headerlink" title="10ã€Hbase(docker)æ­å»ºå’Œæµ‹è¯•"></a>10ã€Hbase(docker)æ­å»ºå’Œæµ‹è¯•</h3><p>urlï¼š<a href="https://www.cnblogs.com/user-sunli/p/16362500.html">https://www.cnblogs.com/user-sunli/p/16362500.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="å¤§æ•°æ®" scheme="https://mykkto.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
    <category term="Flink" scheme="https://mykkto.github.io/tags/Flink/"/>
    
    <category term="hadoop" scheme="https://mykkto.github.io/tags/hadoop/"/>
    
    <category term="kafka" scheme="https://mykkto.github.io/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>é¡¹ç›®-é‡‘èèƒŒæ™¯åŠå…¶åç«¯æ­å»º</title>
    <link href="https://mykkto.github.io/posts/a6407b24.html"/>
    <id>https://mykkto.github.io/posts/a6407b24.html</id>
    <published>2022-04-26T15:11:33.000Z</published>
    <updated>2023-02-26T14:08:44.233Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ã€‡ã€ä¸»ç›®å½•æ€»çº²"><a href="#ã€‡ã€ä¸»ç›®å½•æ€»çº²" class="headerlink" title="ã€‡ã€ä¸»ç›®å½•æ€»çº²"></a>ã€‡ã€<a href="/posts/73b5f9d8">ä¸»ç›®å½•æ€»çº²</a></h2><h2 id="â… ã€é¡¹ç›®æ¦‚å¿µ"><a href="#â… ã€é¡¹ç›®æ¦‚å¿µ" class="headerlink" title="â… ã€é¡¹ç›®æ¦‚å¿µ"></a>â… ã€é¡¹ç›®æ¦‚å¿µ</h2><h3 id="ä¸€ã€é¡¹ç›®ç®€ä»‹"><a href="#ä¸€ã€é¡¹ç›®ç®€ä»‹" class="headerlink" title="ä¸€ã€é¡¹ç›®ç®€ä»‹"></a>ä¸€ã€é¡¹ç›®ç®€ä»‹</h3><h4 id="1ã€é¡¹ç›®è¯´æ˜"><a href="#1ã€é¡¹ç›®è¯´æ˜" class="headerlink" title="1ã€é¡¹ç›®è¯´æ˜"></a>1ã€é¡¹ç›®è¯´æ˜</h4><p>å°šèå®æ˜¯ä¸€ä¸ªç½‘ç»œå€Ÿè´·ä¿¡æ¯ä¸­ä»‹æœåŠ¡å¹³å°ï¼Œä¸ºä¸ªäººæŠ•èµ„è€…ã€ä¸ªäººèèµ„ç”¨æˆ·å’Œå°å¾®ä¼ä¸šæä¾›ä¸“ä¸šçš„çº¿ä¸Šä¿¡è´·åŠå‡ºå€Ÿæ’®åˆæœåŠ¡ã€‚</p><p>è¡Œä¸šæ¡ˆä¾‹ï¼šäººäººè´· <a href="https://www.renrendai.com/">https://www.renrendai.com/</a>ã€æ‹æ‹è´· <a href="https://www.paipaidai.com/">https://www.paipaidai.com/</a></p><h4 id="2ã€é¡¹ç›®æ¶æ„å›¾"><a href="#2ã€é¡¹ç›®æ¶æ„å›¾" class="headerlink" title="2ã€é¡¹ç›®æ¶æ„å›¾"></a>2ã€é¡¹ç›®æ¶æ„å›¾</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/0d2630acf4428d33859d89e8f78be575.png"></p><h4 id="3ã€ä¸šåŠ¡æµç¨‹å›¾"><a href="#3ã€ä¸šåŠ¡æµç¨‹å›¾" class="headerlink" title="3ã€ä¸šåŠ¡æµç¨‹å›¾"></a>3ã€ä¸šåŠ¡æµç¨‹å›¾</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/27528777bac0634fd778ca60094057b4.png"></p><h3 id="äºŒã€å¼€å‘ç¯å¢ƒå’ŒæŠ€æœ¯æ ˆ"><a href="#äºŒã€å¼€å‘ç¯å¢ƒå’ŒæŠ€æœ¯æ ˆ" class="headerlink" title="äºŒã€å¼€å‘ç¯å¢ƒå’ŒæŠ€æœ¯æ ˆ"></a>äºŒã€å¼€å‘ç¯å¢ƒå’ŒæŠ€æœ¯æ ˆ</h3><h4 id="1ã€æŠ€æœ¯æ ˆ-åç«¯"><a href="#1ã€æŠ€æœ¯æ ˆ-åç«¯" class="headerlink" title="1ã€æŠ€æœ¯æ ˆ-åç«¯"></a>1ã€æŠ€æœ¯æ ˆ-åç«¯</h4><ul><li>SpringBoot 2.3.4.RELEASE</li><li>SpringCloud Hoxton.SR8ï¼šå¾®æœåŠ¡åŸºç¡€è®¾æ–½ - æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡ç†”æ–­ã€å¾®æœåŠ¡ç½‘å…³ã€é…ç½®ä¸­å¿ƒç­‰</li><li>SpringCloud Alibaba 2.2.2.RELEASE</li><li>MyBatis Plusï¼šæŒä¹…å±‚æ¡†æ¶å’Œä»£ç ç”Ÿæˆå™¨</li><li>Lombokï¼šç®€åŒ–å®ä½“ç±»å¼€å‘</li><li>Swagger2ï¼šApiæ¥å£æ–‡æ¡£ç”Ÿæˆå·¥å…·</li><li>Logbackï¼šæ—¥å¿—ç³»ç»Ÿ</li><li>alibaba-easyexcelï¼šExcelè¯»å†™</li><li>Spring Data Redisï¼šSpringé¡¹ç›®ä¸­è®¿é—®Redisç¼“å­˜</li><li>HTTPClient: åŸºäºHttpåè®®çš„å®¢æˆ·ç«¯ï¼Œç”¨æ¥å®ç°è¿œç¨‹è°ƒç”¨</li><li>Spring Taskï¼šå®šæ—¶ä»»åŠ¡</li></ul><h4 id="2ã€æŠ€æœ¯æ ˆ-å‰ç«¯"><a href="#2ã€æŠ€æœ¯æ ˆ-å‰ç«¯" class="headerlink" title="2ã€æŠ€æœ¯æ ˆ-å‰ç«¯"></a>2ã€æŠ€æœ¯æ ˆ-å‰ç«¯</h4><ul><li>Node.jsï¼š JavaScript è¿è¡Œç¯å¢ƒ</li><li>ES6ï¼šJavaScriptçš„æ¨¡å—åŒ–ç‰ˆæœ¬</li><li>axiosï¼šä¸€ä¸ªå‘é€Ajaxè¯·æ±‚çš„å·¥å…·</li><li>Vue.jsï¼šweb ç•Œé¢çš„æ¸è¿›å¼æ¡†æ¶</li><li>Element-UIï¼šå‰ç«¯ç»„ä»¶åº“</li><li>æ¨¡å—åŒ–å¼€å‘ï¼šè§£å†³javascriptå˜é‡å…¨å±€ç©ºé—´æ±¡æŸ“çš„é—®é¢˜</li><li>NPMï¼šæ¨¡å—èµ„æºç®¡ç†å™¨</li><li>vue-element-adminï¼šåŸºäºVue.jsçš„åå°ç®¡ç†ç³»ç»ŸUIé›†æˆæ–¹æ¡ˆ</li><li>NuxtJSï¼šåŸºäºVue.jsæ„å»ºçš„æœåŠ¡å™¨ç«¯æ¸²æŸ“åº”ç”¨çš„è½»é‡çº§æ¡†æ¶</li></ul><h4 id="3ã€ä¸­é—´ä»¶"><a href="#3ã€ä¸­é—´ä»¶" class="headerlink" title="3ã€ä¸­é—´ä»¶"></a>3ã€ä¸­é—´ä»¶</h4><ul><li>MySQL 5.7ï¼šå…³ç³»å‹æ•°æ®åº“     </li><li>Redis 5.0ï¼šç¼“å­˜æŠ€æœ¯     </li><li>RabbitMQ 3.8ï¼šæ¶ˆæ¯ä¸­é—´ä»¶</li></ul><h4 id="4ã€ç¬¬ä¸‰æ–¹æ¥å£"><a href="#4ã€ç¬¬ä¸‰æ–¹æ¥å£" class="headerlink" title="4ã€ç¬¬ä¸‰æ–¹æ¥å£"></a>4ã€ç¬¬ä¸‰æ–¹æ¥å£</h4><ul><li>é˜¿é‡Œäº‘çŸ­ä¿¡ï¼šçŸ­ä¿¡ç½‘å…³</li><li>é˜¿é‡Œäº‘OSSï¼šåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨</li><li>èµ„é‡‘æ‰˜ç®¡å¹³å°APIå¯¹æ¥ï¼šæ±‡ä»˜å®</li></ul><h4 id="5ã€å¼€å‘ç¯å¢ƒ"><a href="#5ã€å¼€å‘ç¯å¢ƒ" class="headerlink" title="5ã€å¼€å‘ç¯å¢ƒ"></a>5ã€å¼€å‘ç¯å¢ƒ</h4><ul><li><p>jdk 1.8</p></li><li><p>maven 3.6</p></li><li><p>ideaIU-2020.2.3ï¼š</p></li><li><p>æ’ä»¶ï¼šlombokã€MyBatisX</p></li></ul><h3 id="ä¸‰ã€é‡‘èçŸ¥è¯†æ™®åŠ"><a href="#ä¸‰ã€é‡‘èçŸ¥è¯†æ™®åŠ" class="headerlink" title="ä¸‰ã€é‡‘èçŸ¥è¯†æ™®åŠ"></a>ä¸‰ã€é‡‘èçŸ¥è¯†æ™®åŠ</h3><h4 id="1ã€ä¿¡ç”¨è´·æ¬¾å¹³å°çš„ç±»åˆ«"><a href="#1ã€ä¿¡ç”¨è´·æ¬¾å¹³å°çš„ç±»åˆ«" class="headerlink" title="1ã€ä¿¡ç”¨è´·æ¬¾å¹³å°çš„ç±»åˆ«"></a>1ã€ä¿¡ç”¨è´·æ¬¾å¹³å°çš„ç±»åˆ«</h4><h5 id="1ã€é“¶è¡Œç³»"><a href="#1ã€é“¶è¡Œç³»" class="headerlink" title="1ã€é“¶è¡Œç³»"></a>1ã€é“¶è¡Œç³»</h5><ul><li>ä¼˜åŠ¿ï¼š<ul><li>ç¬¬ä¸€ï¼Œèµ„é‡‘é›„åšï¼ŒæµåŠ¨æ€§å……è¶³ï¼›</li><li>ç¬¬äºŒï¼Œé¡¹ç›®æºè´¨åœ°ä¼˜è‰¯ï¼Œå¤§å¤šæ¥è‡ªäºé“¶è¡ŒåŸæœ‰ä¸­å°å‹å®¢æˆ·ï¼›</li><li>ç¬¬ä¸‰ï¼Œé£é™©æ§åˆ¶èƒ½åŠ›å¼ºã€‚å¦‚æ’ä¸°é“¶è¡Œã€æ‹›å•†é“¶è¡Œç­‰æ——ä¸‹éƒ½æœ‰ä¿¡ç”¨è´·æ¬¾å¹³å°ã€‚</li></ul></li><li>åŠ£åŠ¿ï¼šæ”¶ç›Šç‡åä½ï¼Œé¢„æœŸå¹´åŒ–æ”¶ç›Šç‡å¤„äº5.5%-8.6%ä¹‹é—´ï¼Œç•¥é«˜äºé“¶è¡Œå…¶ä»–ç†è´¢äº§å“ï¼Œå¯¹æŠ•èµ„äººå¸å¼•åŠ›æœ‰é™ã€‚</li></ul><h5 id="2ã€å›½èµ„ç³»"><a href="#2ã€å›½èµ„ç³»" class="headerlink" title="2ã€å›½èµ„ç³»"></a>2ã€å›½èµ„ç³»</h5><ul><li>ä¼˜åŠ¿ï¼š<ul><li>æ‹¥æœ‰å›½æœ‰èƒŒæ™¯è‚¡ä¸œçš„éšæ€§èƒŒä¹¦ï¼Œå…‘ä»˜èƒ½åŠ›æœ‰ä¿éšœï¼Œä¸šåŠ¡æ¨¡å¼è¾ƒä¸ºè§„èŒƒï¼Œä»ä¸šäººå‘˜é‡‘èä¸“ä¸šç´ å…»è¾ƒé«˜ã€‚</li></ul></li><li>åŠ£åŠ¿ï¼š<ul><li>ç¼ºä¹äº’è”ç½‘åŸºå› ï¼›é¡¹ç›®æ ‡çš„è¾ƒå¤§ï¼Œèµ·æŠ•é—¨æ§›è¾ƒé«˜ï¼›ä¸”äº§å“ç§ç±»æœ‰é™ï¼Œå¤šä¸ºä¼ä¸šä¿¡ç”¨è´·ï¼›</li><li>è¾ƒä¸ºè°¨æ…ï¼Œå±‚å±‚å®¡æ ¸çš„æœºåˆ¶ä¸¥é‡å½±å“äº†å¹³å°è¿è¥æ•ˆç‡ï¼›æ”¶ç›Šç‡ä¸å…·æœ‰å¸å¼•åŠ›ã€‚</li></ul></li></ul><h5 id="3ã€æ°‘è¥ç³»"><a href="#3ã€æ°‘è¥ç³»" class="headerlink" title="3ã€æ°‘è¥ç³»"></a>3ã€æ°‘è¥ç³»</h5><p>æ°‘è¥ç³»å¹³å°æ•°é‡æœ€å¤šï¼Œèµ·æ­¥æœ€æ—©ï¼Œä½†é±¼é¾™æ··æ‚ï¼Œä¸èƒœæšä¸¾ã€‚</p><ul><li>ä¼˜åŠ¿ï¼š<ul><li>æ™®æƒ é‡‘èï¼Œæ‰‹ç»­ä¾¿æ·ï¼›é—¨æ§›æä½ï¼ŒæŠ•èµ„èµ·ç‚¹ä½æœ€ä½èµ·æŠ•é—¨æ§›ç”šè‡³50å…ƒï¼›</li><li>å¼ºå¤§çš„äº’è”ç½‘æ€ç»´ï¼Œäº§å“åˆ›æ–°èƒ½åŠ›é«˜ï¼Œå¸‚åœºåŒ–ç¨‹åº¦é«˜ï¼›æ”¶ç›Šç‡é«˜ï¼ŒæŠ•èµ„æ”¶ç›Šç‡å…·æœ‰å¸å¼•åŠ›ã€‚</li></ul></li><li>åŠ£åŠ¿ï¼š<ul><li>é£é™©åé«˜ï¼Œèµ„æœ¬å®åŠ›åŠé£æ§èƒ½åŠ›åå¼±ï¼Œè·‘è·¯åŠå€’é—­çš„é«˜å‘åŒºã€‚</li></ul></li></ul><h4 id="2ã€ä¸šåŠ¡æµç¨‹"><a href="#2ã€ä¸šåŠ¡æµç¨‹" class="headerlink" title="2ã€ä¸šåŠ¡æµç¨‹"></a>2ã€ä¸šåŠ¡æµç¨‹</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/20220427203134.png"></p><h5 id="1ã€æŠ•èµ„äºº"><a href="#1ã€æŠ•èµ„äºº" class="headerlink" title="1ã€æŠ•èµ„äºº"></a>1ã€æŠ•èµ„äºº</h5><p>å¸Œæœ›åœ¨å¹³å°ä¸Šæ‰¾åˆ°åˆé€‚çš„æŠ•èµ„é¡¹ç›®ï¼Œè·å–åˆ©æ¶¦å›æŠ¥çš„ç”¨æˆ·</p><h5 id="2ã€å€Ÿæ¬¾äºº"><a href="#2ã€å€Ÿæ¬¾äºº" class="headerlink" title="2ã€å€Ÿæ¬¾äºº"></a>2ã€å€Ÿæ¬¾äºº</h5><p>éœ€è¦èµ„é‡‘å‘¨è½¬çš„ç”¨æˆ·</p><h5 id="3ã€èµ„é‡‘æ± é£é™©"><a href="#3ã€èµ„é‡‘æ± é£é™©" class="headerlink" title="3ã€èµ„é‡‘æ± é£é™©"></a>3ã€èµ„é‡‘æ± é£é™©</h5><ul><li><p>èµ„é‡‘æ± ï¼šä¸€ä¸ªå¤§æ± å­æ”¾é’±ï¼Œä¸€è¾¹å­˜è¿›æ¥ï¼ˆå…¥æ°´ç®¡ï¼‰ï¼Œä¸€è¾¹è´·å‡ºå»ï¼ˆå‡ºæ°´ç®¡ï¼‰ã€‚ä¸ç®¡æ˜¯å¼ ä¸‰çš„é’±ã€æå››çš„é’±ã€è¿˜æ˜¯ç‹äº”çš„é’±ï¼Œåªè¦è¿›åˆ°æ± å­é‡Œï¼Œå°±éƒ½å«æ± å­çš„é’±äº†ã€‚é“¶è¡Œå°±æ˜¯å…¸å‹çš„èµ„é‡‘æ± ã€‚</p></li><li><p>èµ„é‡‘æ± é£é™©ï¼š</p></li><li><ul><li>ç¬¬ä¸€ç§æƒ…å†µï¼šæŠ•èµ„å…¥æ°´ç®¡æµé‡è¿‡å¤§ï¼Œæ± å­é‡Œå…¨æ˜¯æ°´ã€‚è¿™ç§æƒ…å†µï¼Œå¹³å°äºé’±ï¼Œå¹²ä¸é•¿ã€‚åŸå› å¾ˆç®€å•ï¼Œæ± å­é‡Œçš„é’±æ˜¯æœ‰æˆæœ¬çš„ï¼Œåªè¿›ä¸å‡ºï¼Œæ²¡æœ‰åˆ©å·®ï¼Œæ‹¿ä»€ä¹ˆé’±ä»˜æŠ•èµ„äººçš„åˆ©æ¯ï¼Œæ—¶é—´é•¿äº†ï¼Œå°±åªèƒ½ç”¨æŠ•èµ„äººçš„æœ¬é‡‘è¿˜æŠ•èµ„äººçš„åˆ©æ¯ï¼Œå€Ÿæ–°è¿˜æ—§ï¼Œåºæ°éª—å±€ã€‚<font color="red">è¿™ä¸ªè¿‡ç¨‹å°±ç›´æ¥èƒŒç¦»äº†å¹³å°ä¿¡æ¯ä¸­ä»‹çš„èº«ä»½ï¼Œè€Œæˆäº†ä¸é“¶è¡Œç±»ä¼¼çš„é‡‘èæœºæ„ã€‚</font></li><li>ç¬¬äºŒç§æƒ…å†µï¼šçªç„¶æ¥äº†è¿™ä¹ˆå¤šé’±ï¼Œæ€ä¹ˆåŠï¼Ÿåªèƒ½æŠŠæ”¾è´·å‡ºæ°´ç®¡çš„æµé‡è°ƒå¤§ã€‚æ”¾è´·çš„è¿™æ¡å‡ºæ°´ç®¡ä¸Šæœ‰ä¸¤ä¸ªé˜€é—¨ï¼Œä¸€ä¸ªå«æ‰¾é¡¹ç›®ï¼Œä¸€ä¸ªå«åš<font color="red">é£æ§</font>ã€‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œç»å¸¸å°±æ˜¯ä¸¤ä¸ªé˜€é—¨ä¸€å—å„¿æ”¾ï¼Œé’±æ˜¯è´·å‡ºå»äº†ï¼Œä½†ç”±äºæ”¾æ¾äº†å¯¹é£é™©çš„æŠŠæ§ï¼Œèƒ½ä¸èƒ½å†æµå›æ¥ï¼Œå°±ä¸å¥½è¯´äº†ï¼Œå±é™©ã€‚</li><li>ç¬¬ä¸‰ç§æƒ…å†µï¼šææ¬¾çš„å‡ºæ°´ç®¡æµé‡å˜å¤§ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªé»‘å¤©é¹…äº‹ä»¶ï¼Œä¸€ä¸ªè´Ÿé¢æ–°é—»ï¼Œä¸€ä¸ªå¹³å°å®äº†ï¼Œéƒ½å¯èƒ½è¯±å‘è¿™ç§æƒ…å†µï¼Œè¿™å°±æ˜¯<font color="red">æŒ¤å…‘</font>ã€‚æ¯”å¦‚è¯´æŸç§Ÿå®äº‹ä»¶åï¼Œä¸åªè¿™ä¸€å®¶å¹³å°ï¼Œå¾ˆå¤šå…¶ä»–å¹³å°çš„ç”¨æˆ·ï¼Œä¹Ÿåœ¨ç–¯ç‹‚çš„æç°ï¼Œæœ‰å¯èƒ½ä¸€ç›´æåˆ°å…³é—¨ä¸ºæ­¢ã€‚</li><li>ç¬¬å››ç§æƒ…å†µæœ€æç«¯ï¼šå¹³å°æŠŠæ± å­é‡Œçš„é’±éƒ½æå‡ºæ¥ï¼Œèµ°äººã€‚è¿™ä¸ªå°±ä¸ç”¨è§£é‡Šäº†ï¼Œå°±æ˜¯ <font style="color: #FF0000;">è·‘è·¯ã€‚</font></li><li> <font style="color: #FF0000;">ä»¥ä¸Šå››ç§æƒ…å†µå°±æ˜¯èµ„é‡‘æ± æœ€ä¸»è¦çš„å‡ ä¸ªé£é™©â€”â€”ç»è¥ä¸å–„ï¼Œé£é™©å¤±æ§ï¼ŒæŒ¤å…‘å’Œè·‘è·¯ã€‚é“¶ç›‘ä¼šå‘å¸ƒçš„ã€Šç½‘ç»œå€Ÿè´·ä¿¡æ¯ä¸­ä»‹æœºæ„ä¸šåŠ¡æ´»åŠ¨ç®¡ç†æš‚è¡ŒåŠæ³•ã€‹è®©èµ„é‡‘å­˜ç®¡æˆä¸ºç½‘è´·å¹³å°çš„ç¡¬æ€§è¦æ±‚ï¼ŒåŒæ—¶é™ä½äº†å¹³å°å»ºç«‹èµ„é‡‘æ± ã€æŒªç”¨ç”¨æˆ·èµ„é‡‘çš„é£é™©ã€‚</font></li></ul></li></ul><h5 id="4ã€èµ„é‡‘æ‰˜ç®¡å¹³å°"><a href="#4ã€èµ„é‡‘æ‰˜ç®¡å¹³å°" class="headerlink" title="4ã€èµ„é‡‘æ‰˜ç®¡å¹³å°"></a>4ã€èµ„é‡‘æ‰˜ç®¡å¹³å°</h5><ul><li>ç¬¬ä¸‰æ–¹å­˜ç®¡æ¨¡å¼ï¼šâ€œç¬¬ä¸‰æ–¹å­˜ç®¡â€çš„å…¨ç§°æ˜¯â€œå®¢æˆ·äº¤æ˜“ç»“ç®—èµ„é‡‘ç¬¬ä¸‰æ–¹å­˜ç®¡â€ã€‚è¿™é‡Œçš„ç¬¬ä¸‰æ–¹å­˜ç®¡æœºæ„ï¼Œç›®å‰æ˜¯æŒ‡å…·å¤‡ç¬¬ä¸‰æ–¹å­˜ç®¡èµ„æ ¼çš„å•†ä¸šé“¶è¡Œã€‚é“¶è¡Œçš„æµå…¥èµ„é‡‘æˆæœ¬ä½ï¼Œé£æ§ä½“ç³»è¾ƒå®Œå–„ï¼Œèµ„é‡‘æ± å­è¶³å¤Ÿå¤§ï¼Œè€Œä¸”æ˜¯å›½å®¶èƒŒä¹¦ï¼Œä¸ä¼šè·‘è·¯ã€‚</li><li><font style="color: #FF0000;">è¯´æ˜ï¼šç”±äºæˆ‘ä»¬æ˜¯æ•™å­¦ä½¿ç”¨ï¼Œæ— æ³•ç”³è¯·åˆ°æ­£å¼çš„èµ„é‡‘æ‰˜ç®¡å¹³å°çš„æ”¯æŒï¼Œæ‰€ä»¥æˆ‘ä»¬æ ¹æ®èµ„é‡‘æ‰˜ç®¡å¹³å°APIæ¥å£æ–‡æ¡£ï¼Œè‡ªè¡Œå¼€å‘æ¨¡æ‹Ÿä¸€å¥—APIæ¥å£æ¥æ»¡è¶³ä¸šåŠ¡éœ€è¦ï¼Œä¸šåŠ¡è¿‡ç¨‹ä¸å®é™…å¼€å‘åŸºæœ¬ä¸€è‡´ã€‚</font></li></ul><h2 id="â…¡ã€åç«¯æ¶æ„æ­å»º"><a href="#â…¡ã€åç«¯æ¶æ„æ­å»º" class="headerlink" title="â…¡ã€åç«¯æ¶æ„æ­å»º"></a>â…¡ã€åç«¯æ¶æ„æ­å»º</h2><h3 id="ä¸€ã€æ¥å£å·¥ç¨‹åˆ›å»º"><a href="#ä¸€ã€æ¥å£å·¥ç¨‹åˆ›å»º" class="headerlink" title="ä¸€ã€æ¥å£å·¥ç¨‹åˆ›å»º"></a>ä¸€ã€æ¥å£å·¥ç¨‹åˆ›å»º</h3><h4 id="1ã€åˆ›å»ºçˆ¶å·¥ç¨‹-BackEndCode"><a href="#1ã€åˆ›å»ºçˆ¶å·¥ç¨‹-BackEndCode" class="headerlink" title="1ã€åˆ›å»ºçˆ¶å·¥ç¨‹ BackEndCode"></a>1ã€åˆ›å»ºçˆ¶å·¥ç¨‹ BackEndCode</h4><h5 id="1ã€åˆ›å»º-maven-é¡¹ç›®"><a href="#1ã€åˆ›å»º-maven-é¡¹ç›®" class="headerlink" title="1ã€åˆ›å»º maven é¡¹ç›®"></a>1ã€åˆ›å»º maven é¡¹ç›®</h5><p><font color="red">Groupï¼šcom.kk</font></p><p><font color="red">Artifactï¼šBackEndCode</font></p><h5 id="2ã€åˆ é™¤srcç›®å½•"><a href="#2ã€åˆ é™¤srcç›®å½•" class="headerlink" title="2ã€åˆ é™¤srcç›®å½•"></a>2ã€åˆ é™¤srcç›®å½•</h5><h5 id="3ã€é…ç½®SpringBootç‰ˆæœ¬"><a href="#3ã€é…ç½®SpringBootç‰ˆæœ¬" class="headerlink" title="3ã€é…ç½®SpringBootç‰ˆæœ¬"></a>3ã€é…ç½®SpringBootç‰ˆæœ¬</h5><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€é…ç½®pomä¾èµ–ç‰ˆæœ¬å·"><a href="#4ã€é…ç½®pomä¾èµ–ç‰ˆæœ¬å·" class="headerlink" title="4ã€é…ç½®pomä¾èµ–ç‰ˆæœ¬å·"></a>4ã€<strong>é…ç½®pomä¾èµ–ç‰ˆæœ¬å·</strong></h5><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span>2.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>Hoxton.SR8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis-plus.version</span><span class="token punctuation">&gt;</span></span>3.4.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis-plus.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>velocity.version</span><span class="token punctuation">&gt;</span></span>2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>velocity.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swagger.version</span><span class="token punctuation">&gt;</span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swagger.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swagger-bootstrap-ui.version</span><span class="token punctuation">&gt;</span></span>1.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swagger-bootstrap-ui.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-lang3.version</span><span class="token punctuation">&gt;</span></span>3.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-lang3.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-fileupload.version</span><span class="token punctuation">&gt;</span></span>1.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-fileupload.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-io.version</span><span class="token punctuation">&gt;</span></span>2.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-io.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>alibaba.easyexcel.version</span><span class="token punctuation">&gt;</span></span>2.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>alibaba.easyexcel.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>apache.xmlbeans.version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>apache.xmlbeans.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fastjson.version</span><span class="token punctuation">&gt;</span></span>1.2.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fastjson.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gson.version</span><span class="token punctuation">&gt;</span></span>2.8.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gson.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>json.version</span><span class="token punctuation">&gt;</span></span>20170516<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>json.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-java-sdk-core.version</span><span class="token punctuation">&gt;</span></span>4.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-java-sdk-core.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aliyun-sdk-oss.version</span><span class="token punctuation">&gt;</span></span>3.10.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aliyun-sdk-oss.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jodatime.version</span><span class="token punctuation">&gt;</span></span>2.10.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jodatime.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jwt.version</span><span class="token punctuation">&gt;</span></span>0.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jwt.version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>httpclient.version</span><span class="token punctuation">&gt;</span></span>4.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>httpclient.version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="5ã€é…ç½®pomä¾èµ–"><a href="#5ã€é…ç½®pomä¾èµ–" class="headerlink" title="5ã€é…ç½®pomä¾èµ–"></a>5ã€é…ç½®pomä¾èµ–</h5><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--Spring Cloud--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--Spring Cloud Alibaba--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud-alibaba.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--mybatis-plus--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mybatis-plus.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--mybatis-plus ä»£ç ç”Ÿæˆå™¨--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-generator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mybatis-plus.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- Mybatis Plus ä»£ç ç”Ÿæˆå™¨æ¨¡æ¿å¼•æ“,  --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.velocity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>velocity-engine-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${velocity.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--swagger--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${swagger.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--swagger ui--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${swagger.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--swagger-bootstrap-ui--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.xiaoymin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>swagger-bootstrap-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${swagger-bootstrap-ui.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--commons-lang3--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-lang3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${commons-lang3.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ–‡ä»¶ä¸Šä¼ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${commons-fileupload.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--commons-io--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${commons-io.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--excelè§£æ--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>easyexcel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${alibaba.easyexcel.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--excelè§£æä¾èµ–--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.xmlbeans<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>xmlbeans<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${apache.xmlbeans.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--json--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${fastjson.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${json.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.code.gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${gson.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--é˜¿é‡Œäº‘SDKè¿œç¨‹è°ƒç”¨--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-java-sdk-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-java-sdk-core.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--é˜¿é‡Œäº‘æ–‡ä»¶ç®¡ç†--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${aliyun-sdk-oss.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥æœŸæ—¶é—´å·¥å…·--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>joda-time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>joda-time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${jodatime.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--jwtå·¥å…·--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.jsonwebtoken<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jjwt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${jwt.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--httpclient--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.httpcomponents<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${httpclient.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€åˆ›å»ºæ¨¡å—kk-common"><a href="#2ã€åˆ›å»ºæ¨¡å—kk-common" class="headerlink" title="2ã€åˆ›å»ºæ¨¡å—kk-common"></a>2ã€åˆ›å»ºæ¨¡å—kk-common</h4><h5 id="1ã€åˆ›å»ºMavenæ¨¡å—"><a href="#1ã€åˆ›å»ºMavenæ¨¡å—" class="headerlink" title="1ã€åˆ›å»ºMavenæ¨¡å—"></a>1ã€åˆ›å»ºMavenæ¨¡å—</h5><p>åœ¨ <font color="red">çˆ¶å·¥ç¨‹</font> ä¸‹åˆ›å»ºæ™®é€šmavenæ¨¡å—</p><p><font color="red">Groupï¼šcom.kk</font></p><p><font color="red">Artifactï¼škk-common</font></p><h5 id="2ã€é…ç½®pom"><a href="#2ã€é…ç½®pom" class="headerlink" title="2ã€é…ç½®pom"></a>2ã€é…ç½®pom</h5><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--lombokç”¨æ¥ç®€åŒ–å®ä½“ç±»ï¼šéœ€è¦å®‰è£…lombokæ’ä»¶--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€åˆ›å»ºæ¨¡å—service-base"><a href="#3ã€åˆ›å»ºæ¨¡å—service-base" class="headerlink" title="3ã€åˆ›å»ºæ¨¡å—service-base"></a>3ã€åˆ›å»ºæ¨¡å—service-base</h4><h5 id="1ã€åˆ›å»ºMavenæ¨¡å—-1"><a href="#1ã€åˆ›å»ºMavenæ¨¡å—-1" class="headerlink" title="1ã€åˆ›å»ºMavenæ¨¡å—"></a>1ã€åˆ›å»ºMavenæ¨¡å—</h5><p>åœ¨ <font color="red">çˆ¶å·¥ç¨‹</font> ä¸‹åˆ›å»ºæ™®é€šmavenæ¨¡å—</p><p><font color="red">Groupï¼šcom.kk</font></p><p><font color="red">Artifactï¼šservice-base</font></p><h5 id="2ã€é…ç½®pom-1"><a href="#2ã€é…ç½®pom-1" class="headerlink" title="2ã€é…ç½®pom"></a>2ã€é…ç½®pom</h5><p><font color="red">æ³¨æ„ï¼š</font>ä¾èµ–kk-common</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>service-base<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--swagger--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--swagger ui--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€åˆ›å»ºæ¨¡å—service-core"><a href="#4ã€åˆ›å»ºæ¨¡å—service-core" class="headerlink" title="4ã€åˆ›å»ºæ¨¡å—service-core"></a>4ã€åˆ›å»ºæ¨¡å—service-core</h4><h5 id="1ã€åˆ›å»ºMavenæ¨¡å—-2"><a href="#1ã€åˆ›å»ºMavenæ¨¡å—-2" class="headerlink" title="1ã€åˆ›å»ºMavenæ¨¡å—"></a>1ã€åˆ›å»ºMavenæ¨¡å—</h5><p>åœ¨ <font color="red">çˆ¶å·¥ç¨‹</font> ä¸‹åˆ›å»ºæ™®é€šmavenæ¨¡å—</p><p><font color="red">Groupï¼šcom.kk</font></p><p><font color="red">Artifactï¼šservice-core</font></p><h5 id="2ã€é…ç½®pom-2"><a href="#2ã€é…ç½®pom-2" class="headerlink" title="2ã€é…ç½®pom"></a>2ã€é…ç½®pom</h5><p><font color="red">æ³¨æ„ï¼š</font>ä¾èµ–kk-common</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>service-base<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--mysql--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--mybatis-plus--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--mybatis-plus ä»£ç ç”Ÿæˆå™¨--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-generator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- Mybatis Plus ä»£ç ç”Ÿæˆå™¨æ¨¡æ¿å¼•æ“,  --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.velocity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>velocity-engine-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€ä»£ç ç”Ÿæˆå™¨"><a href="#5ã€ä»£ç ç”Ÿæˆå™¨" class="headerlink" title="5ã€ä»£ç ç”Ÿæˆå™¨"></a>5ã€ä»£ç ç”Ÿæˆå™¨</h4><h5 id="1ã€åˆ›å»ºæ•°æ®åº“"><a href="#1ã€åˆ›å»ºæ•°æ®åº“" class="headerlink" title="1ã€åˆ›å»ºæ•°æ®åº“"></a>1ã€åˆ›å»ºæ•°æ®åº“</h5><p><font color="red">åˆ›å»ºæ•°æ®åº“srb_core</font></p><p><font color="red">å¹¶æ‰§è¡Œsqlè„šæœ¬åˆå§‹åŒ–æ•°æ®ç»“æ„å’Œæ•°æ®</font></p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/20220427223135.png"></p><h5 id="2ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨"><a href="#2ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨" class="headerlink" title="2ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨"></a>2ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨</h5><p>åœ¨testç›®å½•ä¸­åˆ›å»ºæµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶æ‰§è¡Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>srb<span class="token punctuation">.</span>core</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">DbType</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">IdType</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span></span><span class="token class-name">AutoGenerator</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">DataSourceConfig</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">GlobalConfig</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">PackageConfig</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">StrategyConfig</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>generator<span class="token punctuation">.</span>config<span class="token punctuation">.</span>rules<span class="token punctuation">.</span></span><span class="token class-name">NamingStrategy</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CodeGenerator</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">genCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 1ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨</span>        <span class="token class-name">AutoGenerator</span> mpg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AutoGenerator</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2ã€å…¨å±€é…ç½®</span>        <span class="token class-name">GlobalConfig</span> gc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobalConfig</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> projectPath <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span>getProperty <span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gc<span class="token punctuation">.</span>setOutputDir <span class="token punctuation">(</span>projectPath <span class="token operator">+</span> <span class="token string">"/src/main/java"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gc<span class="token punctuation">.</span>setAuthor <span class="token punctuation">(</span><span class="token string">"mykk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gc<span class="token punctuation">.</span>setOpen <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç”Ÿæˆåæ˜¯å¦æ‰“å¼€èµ„æºç®¡ç†å™¨</span>        gc<span class="token punctuation">.</span>setServiceName <span class="token punctuation">(</span><span class="token string">"%sService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å»æ‰Serviceæ¥å£çš„é¦–å­—æ¯I</span>        gc<span class="token punctuation">.</span>setIdType <span class="token punctuation">(</span><span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ä¸»é”®ç­–ç•¥</span>        gc<span class="token punctuation">.</span>setSwagger2 <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼€å¯Swagger2æ¨¡å¼</span>        mpg<span class="token punctuation">.</span>setGlobalConfig <span class="token punctuation">(</span>gc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3ã€æ•°æ®æºé…ç½®</span>        <span class="token class-name">DataSourceConfig</span> dsc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceConfig</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span>setUrl <span class="token punctuation">(</span><span class="token string">"jdbc:mysql://121.4.120.62:3306/srb_core?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span>setDriverName <span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span>setUsername <span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span>setPassword <span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsc<span class="token punctuation">.</span>setDbType <span class="token punctuation">(</span><span class="token class-name">DbType</span><span class="token punctuation">.</span>MYSQL<span class="token punctuation">)</span><span class="token punctuation">;</span>        mpg<span class="token punctuation">.</span>setDataSource <span class="token punctuation">(</span>dsc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4ã€åŒ…é…ç½®</span>        <span class="token class-name">PackageConfig</span> pc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PackageConfig</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span>setParent <span class="token punctuation">(</span><span class="token string">"com.kk.srb.core"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pc<span class="token punctuation">.</span>setEntity <span class="token punctuation">(</span><span class="token string">"pojo.entity"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ­¤å¯¹è±¡ä¸æ•°æ®åº“è¡¨ç»“æ„ä¸€ä¸€å¯¹åº”ï¼Œé€šè¿‡ DAO å±‚å‘ä¸Šä¼ è¾“æ•°æ®æºå¯¹è±¡ã€‚</span>        mpg<span class="token punctuation">.</span>setPackageInfo <span class="token punctuation">(</span>pc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 5ã€ç­–ç•¥é…ç½®</span>        <span class="token class-name">StrategyConfig</span> strategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StrategyConfig</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        strategy<span class="token punctuation">.</span>setNaming <span class="token punctuation">(</span><span class="token class-name">NamingStrategy</span><span class="token punctuation">.</span>underline_to_camel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®åº“è¡¨æ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span>        strategy<span class="token punctuation">.</span>setColumnNaming <span class="token punctuation">(</span><span class="token class-name">NamingStrategy</span><span class="token punctuation">.</span>underline_to_camel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ•°æ®åº“è¡¨å­—æ®µæ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span>        strategy<span class="token punctuation">.</span>setEntityLombokModel <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lombok</span>        strategy<span class="token punctuation">.</span>setLogicDeleteFieldName <span class="token punctuation">(</span><span class="token string">"is_deleted"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€»è¾‘åˆ é™¤å­—æ®µå</span>        strategy<span class="token punctuation">.</span>setEntityBooleanColumnRemoveIsPrefix <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å»æ‰å¸ƒå°”å€¼çš„is_å‰ç¼€ï¼ˆç¡®ä¿tinyint(1)ï¼‰</span>        strategy<span class="token punctuation">.</span>setRestControllerStyle <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//restful apié£æ ¼æ§åˆ¶å™¨</span>        mpg<span class="token punctuation">.</span>setStrategy <span class="token punctuation">(</span>strategy<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 6ã€æ‰§è¡Œ</span>        mpg<span class="token punctuation">.</span>execute <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id=""><a href="#" class="headerlink" title=""></a></h5><h4 id="6ã€å¯åŠ¨åº”ç”¨ç¨‹åº"><a href="#6ã€å¯åŠ¨åº”ç”¨ç¨‹åº" class="headerlink" title="6ã€å¯åŠ¨åº”ç”¨ç¨‹åº"></a>6ã€å¯åŠ¨åº”ç”¨ç¨‹åº</h4><h5 id="1ã€åˆ›å»ºapplication-yml"><a href="#1ã€åˆ›å»ºapplication-yml" class="headerlink" title="1ã€åˆ›å»ºapplication.yml"></a>1ã€åˆ›å»ºapplication.yml</h5><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8110</span> <span class="token comment"># æœåŠ¡ç«¯å£</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev <span class="token comment"># ç¯å¢ƒè®¾ç½®</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> service<span class="token punctuation">-</span>core <span class="token comment"># æœåŠ¡å</span>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span> <span class="token comment"># mysqlæ•°æ®åº“è¿æ¥</span>    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//121.4.120.62<span class="token punctuation">:</span>3306/srb_core<span class="token punctuation">?</span>serverTimezone=GMT%2B8<span class="token important">&amp;characterEncoding=utf-</span><span class="token number">8</span>    <span class="token key atrule">username</span><span class="token punctuation">:</span> root    <span class="token key atrule">password</span><span class="token punctuation">:</span> root<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span> <span class="token comment">#mybatis</span>  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>com/kk/srb/core/mapper/xml/<span class="token important">*.xml</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€åˆ›å»ºSpringBooté…ç½®æ–‡ä»¶"><a href="#2ã€åˆ›å»ºSpringBooté…ç½®æ–‡ä»¶" class="headerlink" title="2ã€åˆ›å»ºSpringBooté…ç½®æ–‡ä»¶"></a>2ã€åˆ›å»ºSpringBooté…ç½®æ–‡ä»¶</h5><p>åœ¨service-coreä¸­åˆ›å»ºconfigåŒ…ï¼Œåˆ›å»ºMybatisPlusConfigç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>srb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">DbType</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span></span><span class="token class-name">MybatisPlusInterceptor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>inner<span class="token punctuation">.</span></span><span class="token class-name">PaginationInnerInterceptor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableTransactionManagement</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"com.kk.srb.core.mapper"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableTransactionManagement</span> <span class="token comment">//äº‹åŠ¡å¤„ç†</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisPlusConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">MybatisPlusInterceptor</span> <span class="token function">mybatisPlusInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">MybatisPlusInterceptor</span> interceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MybatisPlusInterceptor</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        interceptor<span class="token punctuation">.</span>addInnerInterceptor <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PaginationInnerInterceptor</span> <span class="token punctuation">(</span><span class="token class-name">DbType</span><span class="token punctuation">.</span>MYSQL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ†é¡µ</span>        <span class="token keyword">return</span> interceptor<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€åˆ›å»ºSpringBootå¯åŠ¨ç±»"><a href="#3ã€åˆ›å»ºSpringBootå¯åŠ¨ç±»" class="headerlink" title="3ã€åˆ›å»ºSpringBootå¯åŠ¨ç±»"></a>3ã€åˆ›å»ºSpringBootå¯åŠ¨ç±»</h5><p><font color="red">æ³¨æ„ï¼š</font>æ‰«æcom.kk.srb</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>srb<span class="token punctuation">.</span>core</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"com.kk.srb"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceCoreApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span>run <span class="token punctuation">(</span><span class="token class-name">ServiceCoreApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€è¿è¡Œå¯åŠ¨ç±»"><a href="#4ã€è¿è¡Œå¯åŠ¨ç±»" class="headerlink" title="4ã€è¿è¡Œå¯åŠ¨ç±»"></a>4ã€è¿è¡Œå¯åŠ¨ç±»</h5><p>æŸ¥çœ‹æ§åˆ¶å°8110ç«¯å£æ˜¯å¦æˆåŠŸå¯åŠ¨</p><h4 id="7ã€æ•´ä½“ä»£ç ç»“æ„å›¾"><a href="#7ã€æ•´ä½“ä»£ç ç»“æ„å›¾" class="headerlink" title="7ã€æ•´ä½“ä»£ç ç»“æ„å›¾"></a>7ã€æ•´ä½“ä»£ç ç»“æ„å›¾</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/20220427223747.png"></p><h3 id="äºŒã€ç§¯åˆ†ç­‰çº§CRUD"><a href="#äºŒã€ç§¯åˆ†ç­‰çº§CRUD" class="headerlink" title="äºŒã€ç§¯åˆ†ç­‰çº§CRUD"></a>äºŒã€ç§¯åˆ†ç­‰çº§CRUD</h3><h4 id="1ã€ç§¯åˆ†ç­‰çº§åˆ—è¡¨æ¥å£"><a href="#1ã€ç§¯åˆ†ç­‰çº§åˆ—è¡¨æ¥å£" class="headerlink" title="1ã€ç§¯åˆ†ç­‰çº§åˆ—è¡¨æ¥å£"></a>1ã€ç§¯åˆ†ç­‰çº§åˆ—è¡¨æ¥å£</h4><h5 id="1ã€ç¼–å†™ç§¯åˆ†ç­‰çº§ç®¡ç†æ¥å£"><a href="#1ã€ç¼–å†™ç§¯åˆ†ç­‰çº§ç®¡ç†æ¥å£" class="headerlink" title="1ã€ç¼–å†™ç§¯åˆ†ç­‰çº§ç®¡ç†æ¥å£"></a>1ã€ç¼–å†™ç§¯åˆ†ç­‰çº§ç®¡ç†æ¥å£</h5><p>åœ¨controllerä¸­æ·»åŠ adminåŒ…ï¼Œæ·»åŠ AdminIntegralGradeControllerç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>srb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>admin</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>srb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">IntegralGrade</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>srb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IntegralGradeService</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">CrossOrigin</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token annotation punctuation">@CrossOrigin</span><span class="token comment">//å…è®¸å¯è®¿é—®çš„åŸŸåˆ—è¡¨</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/admin/core/integralGrade"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminIntegralGradeController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">IntegralGradeService</span> integralGradeService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntegralGrade</span><span class="token punctuation">&gt;</span></span> <span class="token function">listAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> integralGradeService<span class="token punctuation">.</span>list <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€æµ‹è¯•"><a href="#2ã€æµ‹è¯•" class="headerlink" title="2ã€æµ‹è¯•"></a>2ã€æµ‹è¯•</h5><p>é‡å¯æœåŠ¡ï¼Œè®¿é—®ï¼š <a href="http://localhost:8110/admin/core/integralGrade/list">http://localhost:8110/admin/core/integralGrade/list</a>  æŸ¥çœ‹ç»“æœjsonæ•°æ®</p><h4 id="2ã€é€»è¾‘åˆ é™¤æ¥å£"><a href="#2ã€é€»è¾‘åˆ é™¤æ¥å£" class="headerlink" title="2ã€é€»è¾‘åˆ é™¤æ¥å£"></a>2ã€é€»è¾‘åˆ é™¤æ¥å£</h4><h5 id="1ã€æ·»åŠ åˆ é™¤æ–¹æ³•"><a href="#1ã€æ·»åŠ åˆ é™¤æ–¹æ³•" class="headerlink" title="1ã€æ·»åŠ åˆ é™¤æ–¹æ³•"></a>1ã€æ·»åŠ åˆ é™¤æ–¹æ³•</h5><p>AdminIntegralGradeControlleræ·»åŠ removeByIdæ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"/remove/{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">removeById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> integralGradeService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€ä½¿ç”¨postmanæµ‹è¯•åˆ é™¤"><a href="#2ã€ä½¿ç”¨postmanæµ‹è¯•åˆ é™¤" class="headerlink" title="2ã€ä½¿ç”¨postmanæµ‹è¯•åˆ é™¤"></a>2ã€ä½¿ç”¨postmanæµ‹è¯•åˆ é™¤</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202204282149807.png"></p><h4 id="3ã€é…ç½®Swagger2"><a href="#3ã€é…ç½®Swagger2" class="headerlink" title="3ã€é…ç½®Swagger2"></a>3ã€é…ç½®Swagger2</h4><h5 id="1ã€Swagger2é…ç½®æ–‡ä»¶"><a href="#1ã€Swagger2é…ç½®æ–‡ä»¶" class="headerlink" title="1ã€Swagger2é…ç½®æ–‡ä»¶"></a>1ã€Swagger2é…ç½®æ–‡ä»¶</h5><p>åœ¨service-baseä¸­åˆ›å»ºSwagger2Config</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>srb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>base<span class="token punctuation">.</span></span><span class="token class-name">Predicates</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">PathSelectors</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ApiInfo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">Contact</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">DocumentationType</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>web<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span></span><span class="token class-name">Docket</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>swagger2<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">EnableSwagger2</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableSwagger2</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Swagger2Config</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">Docket</span> <span class="token function">adminApiConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span> <span class="token punctuation">(</span><span class="token class-name">DocumentationType</span><span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>                <span class="token punctuation">.</span>groupName <span class="token punctuation">(</span><span class="token string">"adminApi"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>apiInfo <span class="token punctuation">(</span>adminApiInfo <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>select <span class="token punctuation">(</span> <span class="token punctuation">)</span>                <span class="token comment">//åªæ˜¾ç¤ºadminè·¯å¾„ä¸‹çš„é¡µé¢</span>                <span class="token punctuation">.</span>paths <span class="token punctuation">(</span><span class="token class-name">Predicates</span><span class="token punctuation">.</span>and <span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span>regex <span class="token punctuation">(</span><span class="token string">"/admin/.*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>build <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token class-name">ApiInfo</span> <span class="token function">adminApiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span>                <span class="token punctuation">.</span>title <span class="token punctuation">(</span><span class="token string">"å°šèå®åå°ç®¡ç†ç³»ç»Ÿ-APIæ–‡æ¡£"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>description <span class="token punctuation">(</span><span class="token string">"æœ¬æ–‡æ¡£æè¿°äº†å°šèå®åå°ç®¡ç†ç³»ç»Ÿæ¥å£"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>version <span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>contact <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Contact</span> <span class="token punctuation">(</span><span class="token string">"Helen"</span><span class="token punctuation">,</span> <span class="token string">"http://mykkto.cn"</span><span class="token punctuation">,</span> <span class="token string">"763856958@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span>build <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€æŸ¥çœ‹Swaggeræ–‡æ¡£"><a href="#2ã€æŸ¥çœ‹Swaggeræ–‡æ¡£" class="headerlink" title="2ã€æŸ¥çœ‹Swaggeræ–‡æ¡£"></a>2ã€æŸ¥çœ‹Swaggeræ–‡æ¡£</h5><p>é‡å¯æœåŠ¡å™¨æŸ¥çœ‹æ¥å£æ–‡æ¡£ï¼š<a href="http://localhost:8101/swagger-ui.html">http://localhost:8110/swagger-ui.html</a></p><h5 id="3ã€å¸¸è§æ³¨è§£"><a href="#3ã€å¸¸è§æ³¨è§£" class="headerlink" title="3ã€å¸¸è§æ³¨è§£"></a>3ã€å¸¸è§æ³¨è§£</h5><p><strong>å®ä½“ç±»æ³¨è§£ï¼š</strong>entityçš„å®ä½“ç±»ä¸­å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå®šä¹‰è®¾ç½®ï¼Œä¾‹å¦‚ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"åˆ›å»ºæ—¶é—´"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"2019-01-01 8:00:00"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createTime<span class="token punctuation">;</span><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ›´æ–°æ—¶é—´"</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"2019-01-01 8:00:00"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> updateTime<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>controlleræ³¨è§£ï¼š</strong></p><p>å®šä¹‰åœ¨ç±»ä¸Š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags <span class="token operator">=</span> <span class="token string">"ç§¯åˆ†ç­‰çº§ç®¡ç†"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®šä¹‰åœ¨æ–¹æ³•ä¸Š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"ç§¯åˆ†ç­‰çº§åˆ—è¡¨"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ ¹æ®idåˆ é™¤ç§¯åˆ†ç­‰çº§"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"é€»è¾‘åˆ é™¤"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å®šä¹‰åœ¨å‚æ•°ä¸Š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ•°æ®id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"100"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ä¸‰ã€ç»Ÿä¸€è¿”å›ç»“æœ"><a href="#ä¸‰ã€ç»Ÿä¸€è¿”å›ç»“æœ" class="headerlink" title="ä¸‰ã€ç»Ÿä¸€è¿”å›ç»“æœ"></a>ä¸‰ã€ç»Ÿä¸€è¿”å›ç»“æœ</h3><h4 id="1ã€æ•°æ®æ ¼å¼çš„å®šä¹‰"><a href="#1ã€æ•°æ®æ ¼å¼çš„å®šä¹‰" class="headerlink" title="1ã€æ•°æ®æ ¼å¼çš„å®šä¹‰"></a>1ã€æ•°æ®æ ¼å¼çš„å®šä¹‰</h4><p>é¡¹ç›®ä¸­æˆ‘ä»¬ä¼šå°†å“åº”å°è£…æˆjsonè¿”å›ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå°†æ‰€æœ‰æ¥å£çš„æ•°æ®æ ¼å¼ç»Ÿä¸€ï¼Œ ä½¿å‰ç«¯å¯¹æ•°æ®çš„æ“ä½œæ›´ä¸€è‡´ã€è½»æ¾ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼æ²¡æœ‰å›ºå®šçš„æ ¼å¼ï¼Œåªè¦èƒ½æè¿°æ¸…æ¥šè¿”å›çš„æ•°æ®çŠ¶æ€ä»¥åŠè¦è¿”å›çš„å…·ä½“æ•°æ®å°±å¯ä»¥ã€‚ä½†æ˜¯ä¸€èˆ¬ä¼šåŒ…å«çŠ¶æ€ç ã€è¿”å›æ¶ˆæ¯ã€æ•°æ®è¿™å‡ éƒ¨åˆ†å†…å®¹</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿè¦æ±‚è¿”å›çš„åŸºæœ¬æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</p><p><strong>æˆåŠŸï¼š</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>   <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">,</span>   <span class="token property">"data"</span><span class="token operator">:</span> æ•°æ® <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¤±è´¥ï¼š</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">-1</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"å¤±è´¥"</span><span class="token punctuation">,</span>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰ç»Ÿä¸€ç»“æœ</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"code"</span><span class="token operator">:</span> æ•°å­—<span class="token punctuation">,</span> <span class="token comment">//ä¸šåŠ¡å“åº”ç </span>  <span class="token property">"message"</span><span class="token operator">:</span> å­—ç¬¦ä¸²<span class="token punctuation">,</span> <span class="token comment">//è¿”å›æ¶ˆæ¯</span>  <span class="token property">"data"</span><span class="token operator">:</span> å¯¹è±¡ <span class="token comment">//è¿”å›æ•°æ®</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€åˆ›å»ºæšä¸¾"><a href="#2ã€åˆ›å»ºæšä¸¾" class="headerlink" title="2ã€åˆ›å»ºæšä¸¾"></a>2ã€åˆ›å»ºæšä¸¾</h4><p>åœ¨kk-commonä¸­åˆ›å»ºresultåŒ…ï¼Œåˆ›å»ºæšä¸¾ ResponseEnum</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>common<span class="token punctuation">.</span>result</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Getter</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@ToString</span><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ResponseEnum</span> <span class="token punctuation">{</span>    SUCCESS <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å“åº”çŠ¶æ€ç </span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token comment">// å“åº”ä¿¡æ¯</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€å®šä¹‰åŒç»Ÿä¸€ç»“æœç±»"><a href="#3ã€å®šä¹‰åŒç»Ÿä¸€ç»“æœç±»" class="headerlink" title="3ã€å®šä¹‰åŒç»Ÿä¸€ç»“æœç±»"></a>3ã€å®šä¹‰åŒç»Ÿä¸€ç»“æœç±»</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>common<span class="token punctuation">.</span>result</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">R</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * æ„é€ å™¨ç§æœ‰     */</span>    <span class="token keyword">private</span> <span class="token class-name">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è¿”å›æˆåŠŸ     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">R</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">R</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">R</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span>setCode <span class="token punctuation">(</span><span class="token class-name">ResponseEnum</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">.</span>getCode <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span>setMessage <span class="token punctuation">(</span><span class="token class-name">ResponseEnum</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">.</span>getMessage <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> r<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è¿”å›å¤±è´¥     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">R</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">R</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">R</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span>setCode <span class="token punctuation">(</span><span class="token class-name">ResponseEnum</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">.</span>getCode <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span>setMessage <span class="token punctuation">(</span><span class="token class-name">ResponseEnum</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">.</span>getMessage <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> r<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è®¾ç½®ç‰¹å®šç»“æœ     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">R</span> <span class="token function">setResult</span><span class="token punctuation">(</span><span class="token class-name">ResponseEnum</span> responseEnum<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">R</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">R</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span>setCode <span class="token punctuation">(</span>responseEnum<span class="token punctuation">.</span>getCode <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        r<span class="token punctuation">.</span>setMessage <span class="token punctuation">(</span>responseEnum<span class="token punctuation">.</span>getMessage <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> r<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>setMessage <span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">code</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>setCode <span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>put <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>setData <span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€ä½¿ç”¨ç»Ÿä¸€è¿”å›ç»“æœ"><a href="#4ã€ä½¿ç”¨ç»Ÿä¸€è¿”å›ç»“æœ" class="headerlink" title="4ã€ä½¿ç”¨ç»Ÿä¸€è¿”å›ç»“æœ"></a>4ã€ä½¿ç”¨ç»Ÿä¸€è¿”å›ç»“æœ</h4><h5 id="1ã€ä¿®æ”¹listAll"><a href="#1ã€ä¿®æ”¹listAll" class="headerlink" title="1ã€ä¿®æ”¹listAll"></a>1ã€ä¿®æ”¹listAll</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"ç§¯åˆ†ç­‰çº§åˆ—è¡¨"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntegralGrade</span><span class="token punctuation">&gt;</span></span> <span class="token function">listAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> integralGradeService<span class="token punctuation">.</span>list <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€ä¿®æ”¹removeById"><a href="#2ã€ä¿®æ”¹removeById" class="headerlink" title="2ã€ä¿®æ”¹removeById"></a>2ã€ä¿®æ”¹removeById</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ ¹æ®idåˆ é™¤ç§¯åˆ†ç­‰çº§"</span><span class="token punctuation">,</span> notes <span class="token operator">=</span> <span class="token string">"é€»è¾‘åˆ é™¤"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"/remove/{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">removeById</span><span class="token punctuation">(</span>        <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ•°æ®id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">)</span>        <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">boolean</span> result <span class="token operator">=</span> integralGradeService<span class="token punctuation">.</span>removeById <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">//return R.setResult(ResponseEnum.UPLOAD_ERROR);</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>ok <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>message <span class="token punctuation">(</span><span class="token string">"åˆ é™¤æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>error <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>message <span class="token punctuation">(</span><span class="token string">"åˆ é™¤å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€æ–°å¢æ•°æ®"><a href="#3ã€æ–°å¢æ•°æ®" class="headerlink" title="3ã€æ–°å¢æ•°æ®"></a>3ã€æ–°å¢æ•°æ®</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"æ–°å¢ç§¯åˆ†ç­‰çº§"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/save"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">save</span><span class="token punctuation">(</span>        <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"ç§¯åˆ†ç­‰çº§å¯¹è±¡"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>        <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">IntegralGrade</span> integralGrade<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">boolean</span> result <span class="token operator">=</span> integralGradeService<span class="token punctuation">.</span>save <span class="token punctuation">(</span>integralGrade<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>ok <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>message <span class="token punctuation">(</span><span class="token string">"ä¿å­˜æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>error <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>message <span class="token punctuation">(</span><span class="token string">"ä¿å­˜å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€æ ¹æ®idæŸ¥è¯¢"><a href="#4ã€æ ¹æ®idæŸ¥è¯¢" class="headerlink" title="4ã€æ ¹æ®idæŸ¥è¯¢"></a>4ã€æ ¹æ®idæŸ¥è¯¢</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"æ ¹æ®idè·å–ç§¯åˆ†ç­‰çº§"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/get/{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getById</span><span class="token punctuation">(</span>        <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ•°æ®id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> example <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">)</span>        <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">IntegralGrade</span> integralGrade <span class="token operator">=</span> integralGradeService<span class="token punctuation">.</span>getById <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>integralGrade <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>ok <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>data <span class="token punctuation">(</span><span class="token string">"record"</span><span class="token punctuation">,</span> integralGrade<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>error <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>message <span class="token punctuation">(</span><span class="token string">"æ•°æ®ä¸å­˜åœ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="5ã€æ ¹æ®idä¿®æ”¹"><a href="#5ã€æ ¹æ®idä¿®æ”¹" class="headerlink" title="5ã€æ ¹æ®idä¿®æ”¹"></a>5ã€æ ¹æ®idä¿®æ”¹</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"æ›´æ–°ç§¯åˆ†ç­‰çº§"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">"/update"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">updateById</span><span class="token punctuation">(</span>        <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"ç§¯åˆ†ç­‰çº§å¯¹è±¡"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>        <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">IntegralGrade</span> integralGrade<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">boolean</span> result <span class="token operator">=</span> integralGradeService<span class="token punctuation">.</span>updateById <span class="token punctuation">(</span>integralGrade<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>ok <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>message <span class="token punctuation">(</span><span class="token string">"ä¿®æ”¹æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>error <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>message <span class="token punctuation">(</span><span class="token string">"ä¿®æ”¹å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å››ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#å››ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="å››ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a>å››ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†</h3><h4 id="1ã€é¡¹ç›®ä¸­çš„å¼‚å¸¸"><a href="#1ã€é¡¹ç›®ä¸­çš„å¼‚å¸¸" class="headerlink" title="1ã€é¡¹ç›®ä¸­çš„å¼‚å¸¸"></a>1ã€<strong>é¡¹ç›®ä¸­çš„å¼‚å¸¸</strong></h4><h5 id="1ã€åˆ¶é€ å¼‚å¸¸"><a href="#1ã€åˆ¶é€ å¼‚å¸¸" class="headerlink" title="1ã€åˆ¶é€ å¼‚å¸¸"></a>1ã€åˆ¶é€ å¼‚å¸¸</h5><p>å±è”½ IntegralGrade ä¸­çš„ @TableFieldæ³¨è§£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"é€»è¾‘åˆ é™¤(1:å·²åˆ é™¤ï¼Œ0:æœªåˆ é™¤)"</span><span class="token punctuation">)</span><span class="token comment">//@TableField("is_deleted")</span><span class="token annotation punctuation">@TableLogic</span><span class="token keyword">private</span> <span class="token class-name">Boolean</span> deleted<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€Swaggerä¸­æµ‹è¯•"><a href="#2ã€Swaggerä¸­æµ‹è¯•" class="headerlink" title="2ã€Swaggerä¸­æµ‹è¯•"></a>2ã€Swaggerä¸­æµ‹è¯•</h5><p>æµ‹è¯•åˆ—è¡¨æŸ¥è¯¢åŠŸèƒ½ï¼ŒæŸ¥çœ‹ç»“æœï¼Œ<font color="red">å‘ç”Ÿé”™è¯¯ï¼Œæ˜¾ç¤ºå“åº”å¤±è´¥</font></p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205042147886.png"></p><h4 id="2ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#2ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="2ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a>2ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†</h4><p><font color="red">ç›®æ ‡ï¼šæˆ‘ä»¬æƒ³è®©å¼‚å¸¸ç»“æœä¹Ÿæ˜¾ç¤ºä¸ºç»Ÿä¸€çš„è¿”å›ç»“æœå¯¹è±¡ï¼Œå¹¶ä¸”ç»Ÿä¸€å¤„ç†ç³»ç»Ÿçš„å¼‚å¸¸ä¿¡æ¯ï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œç»Ÿä¸€å¼‚å¸¸å¤„ç†ã€‚</font></p><h5 id="1ã€åˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨"><a href="#1ã€åˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="1ã€åˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨"></a>1ã€åˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨</h5><p>kk-commonä¸­åˆ›å»ºexceptionåŒ…ï¼Œåˆ›å»ºç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨ç±»UnifiedExceptionHandler</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>common<span class="token punctuation">.</span>result<span class="token punctuation">.</span></span><span class="token class-name">R</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExceptionHandler</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestControllerAdvice</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span> <span class="token comment">//Springå®¹æ˜“è‡ªåŠ¨ç®¡ç†</span><span class="token annotation punctuation">@RestControllerAdvice</span> <span class="token comment">//åœ¨controllerå±‚æ·»åŠ é€šçŸ¥ã€‚å¦‚æœä½¿ç”¨@ControllerAdviceï¼Œåˆ™æ–¹æ³•ä¸Šéœ€è¦æ·»åŠ @ResponseBody</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnifiedExceptionHandler</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æœªå®šä¹‰å¼‚å¸¸     */</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">//å½“controllerä¸­æŠ›å‡ºExceptionï¼Œåˆ™æ•è·</span>    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span>error <span class="token punctuation">(</span>e<span class="token punctuation">.</span>getMessage <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>error <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€service-coreæ·»åŠ æ‰«æ"><a href="#2ã€service-coreæ·»åŠ æ‰«æ" class="headerlink" title="2ã€service-coreæ·»åŠ æ‰«æ"></a>2ã€service-coreæ·»åŠ æ‰«æ</h5><p>æ·»åŠ  â€œcom.kk.commonâ€</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token comment">//@MapperScan({"com.kk.srb"})// éœ€è¦æŒ‡å®šæŒ‡å®šè·¯å¾„</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"com.kk.srb"</span><span class="token punctuation">,</span><span class="token string">"com.kk.common"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceCoreApplication</span> <span class="token punctuation">{</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h5><p>è¿”å›ç»Ÿä¸€é”™è¯¯ç»“æœ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205042244964.png"></p><h4 id="3ã€å¤„ç†ç‰¹å®šå¼‚å¸¸"><a href="#3ã€å¤„ç†ç‰¹å®šå¼‚å¸¸" class="headerlink" title="3ã€å¤„ç†ç‰¹å®šå¼‚å¸¸"></a>3ã€å¤„ç†ç‰¹å®šå¼‚å¸¸</h4><p><font color="red">å¦‚æœæˆ‘ä»¬ä¸æƒ³æ˜¾ç¤ºç»Ÿä¸€çš„â€œæœåŠ¡å™¨å†…éƒ¨é”™è¯¯â€ï¼Œéœ€è¦ä¸ªæ€§åŒ–çš„æ˜¾ç¤ºå¼‚å¸¸ä¿¡æ¯ï¼Œé‚£ä¹ˆéœ€è¦é’ˆå¯¹ç‰¹å®šçš„å¼‚å¸¸åšå¤„ç†</font></p><h5 id="1ã€æ·»åŠ ä¾èµ–"><a href="#1ã€æ·»åŠ ä¾èµ–" class="headerlink" title="1ã€æ·»åŠ ä¾èµ–"></a>1ã€<strong>æ·»åŠ ä¾èµ–</strong></h5><p>åœ¨kk-commonä¸­æ·»åŠ jdbcä¾èµ–</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•"><a href="#2ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•" class="headerlink" title="2ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•"></a>2ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•</h5><p>åœ¨ UnifiedExceptionHandler ä¸­æ·»åŠ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç‰¹å®šå¼‚å¸¸ */</span><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">BadSqlGrammarException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">handleBadSqlGrammarException</span><span class="token punctuation">(</span><span class="token class-name">BadSqlGrammarException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span><span class="token class-name">ResponseEnum</span><span class="token punctuation">.</span>BAD_SQL_GRAMMAR_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®Œæ•´æšä¸¾</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>common<span class="token punctuation">.</span>result</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">ToString</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Getter</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@ToString</span><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ResponseEnum</span> <span class="token punctuation">{</span>    SUCCESS <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">//-1xx æœåŠ¡å™¨é”™è¯¯</span>    BAD_SQL_GRAMMAR_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">"sqlè¯­æ³•é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    SERVLET_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token string">"servletè¯·æ±‚å¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//-2xx å‚æ•°æ ¡éªŒ</span>    UPLOAD_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">103</span><span class="token punctuation">,</span> <span class="token string">"æ–‡ä»¶ä¸Šä¼ é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    EXPORT_DATA_ERROR <span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token string">"æ•°æ®å¯¼å‡ºå¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">//-2xx å‚æ•°æ ¡éªŒ</span>    BORROW_AMOUNT_NULL_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">201</span><span class="token punctuation">,</span> <span class="token string">"å€Ÿæ¬¾é¢åº¦ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    MOBILE_NULL_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">202</span><span class="token punctuation">,</span> <span class="token string">"æ‰‹æœºå·ç ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    MOBILE_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">203</span><span class="token punctuation">,</span> <span class="token string">"æ‰‹æœºå·ç ä¸æ­£ç¡®"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    PASSWORD_NULL_ERROR <span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">,</span> <span class="token string">"å¯†ç ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    CODE_NULL_ERROR <span class="token punctuation">(</span><span class="token number">205</span><span class="token punctuation">,</span> <span class="token string">"éªŒè¯ç ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    CODE_ERROR <span class="token punctuation">(</span><span class="token number">206</span><span class="token punctuation">,</span> <span class="token string">"éªŒè¯ç é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    MOBILE_EXIST_ERROR <span class="token punctuation">(</span><span class="token number">207</span><span class="token punctuation">,</span> <span class="token string">"æ‰‹æœºå·å·²è¢«æ³¨å†Œ"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    LOGIN_MOBILE_ERROR <span class="token punctuation">(</span><span class="token number">208</span><span class="token punctuation">,</span> <span class="token string">"ç”¨æˆ·ä¸å­˜åœ¨"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    LOGIN_PASSWORD_ERROR <span class="token punctuation">(</span><span class="token number">209</span><span class="token punctuation">,</span> <span class="token string">"å¯†ç é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    LOGIN_LOKED_ERROR <span class="token punctuation">(</span><span class="token number">210</span><span class="token punctuation">,</span> <span class="token string">"ç”¨æˆ·è¢«é”å®š"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    LOGIN_AUTH_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">211</span><span class="token punctuation">,</span> <span class="token string">"æœªç™»å½•"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    USER_BIND_IDCARD_EXIST_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">301</span><span class="token punctuation">,</span> <span class="token string">"èº«ä»½è¯å·ç å·²ç»‘å®š"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    USER_NO_BIND_ERROR <span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"ç”¨æˆ·æœªç»‘å®š"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    USER_NO_AMOUNT_ERROR <span class="token punctuation">(</span><span class="token number">303</span><span class="token punctuation">,</span> <span class="token string">"ç”¨æˆ·ä¿¡æ¯æœªå®¡æ ¸"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    USER_AMOUNT_LESS_ERROR <span class="token punctuation">(</span><span class="token number">304</span><span class="token punctuation">,</span> <span class="token string">"æ‚¨çš„å€Ÿæ¬¾é¢åº¦ä¸è¶³"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    LEND_INVEST_ERROR <span class="token punctuation">(</span><span class="token number">305</span><span class="token punctuation">,</span> <span class="token string">"å½“å‰çŠ¶æ€æ— æ³•æŠ•æ ‡"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    LEND_FULL_SCALE_ERROR <span class="token punctuation">(</span><span class="token number">306</span><span class="token punctuation">,</span> <span class="token string">"å·²æ»¡æ ‡ï¼Œæ— æ³•æŠ•æ ‡"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    NOT_SUFFICIENT_FUNDS_ERROR <span class="token punctuation">(</span><span class="token number">307</span><span class="token punctuation">,</span> <span class="token string">"ä½™é¢ä¸è¶³ï¼Œè¯·å……å€¼"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    PAY_UNIFIEDORDER_ERROR <span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">,</span> <span class="token string">"ç»Ÿä¸€ä¸‹å•é”™è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    ALIYUN_SMS_LIMIT_CONTROL_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">502</span><span class="token punctuation">,</span> <span class="token string">"çŸ­ä¿¡å‘é€è¿‡äºé¢‘ç¹"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//ä¸šåŠ¡é™æµ</span>    ALIYUN_SMS_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">503</span><span class="token punctuation">,</span> <span class="token string">"çŸ­ä¿¡å‘é€å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//å…¶ä»–å¤±è´¥</span>    WEIXIN_CALLBACK_PARAM_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">601</span><span class="token punctuation">,</span> <span class="token string">"å›è°ƒå‚æ•°ä¸æ­£ç¡®"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    WEIXIN_FETCH_ACCESSTOKEN_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">602</span><span class="token punctuation">,</span> <span class="token string">"è·å–access_tokenå¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    WEIXIN_FETCH_USERINFO_ERROR <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">603</span><span class="token punctuation">,</span> <span class="token string">"è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å“åº”çŠ¶æ€ç </span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token comment">// å“åº”ä¿¡æ¯</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€æ¢å¤åˆ¶é€ çš„å¼‚å¸¸"><a href="#3ã€æ¢å¤åˆ¶é€ çš„å¼‚å¸¸" class="headerlink" title="3ã€æ¢å¤åˆ¶é€ çš„å¼‚å¸¸"></a>3ã€æ¢å¤åˆ¶é€ çš„å¼‚å¸¸</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"is_deleted"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4ã€è‡ªå®šä¹‰å¼‚å¸¸"><a href="#4ã€è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="4ã€è‡ªå®šä¹‰å¼‚å¸¸"></a>4ã€è‡ªå®šä¹‰å¼‚å¸¸</h4><p><font color="red">ç›®æ ‡</font>ï¼šä½¿ç”¨ä¸€ä¸ªæˆ–è¾ƒå°‘çš„å¼‚å¸¸ç±»ï¼Œå¯ä»¥æ•è·å’Œæ˜¾ç¤ºæ‰€æœ‰çš„å¼‚å¸¸ä¿¡æ¯ã€‚</p><p><font color="red">æ–¹æ¡ˆ</font>ï¼šå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼ˆå¿…é¡»æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ï¼‰ï¼Œåœ¨ç¨‹åºä¸­æŠ›å‡ºè¿™ä¸ªè‡ªå®šä¹‰å¼‚å¸¸å¯¹è±¡ï¼Œå¹¶åœ¨ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨ä¸­æ•è·è‡ªå®šä¹‰å¼‚å¸¸å¯¹è±¡</p><h5 id="1ã€åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»"><a href="#1ã€åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»" class="headerlink" title="1ã€åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»"></a>1ã€åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»</h5><p>å®Œæ•´æŸ¥çœ‹githubæºç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BusinessException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">{</span>    <span class="token comment">//çŠ¶æ€ç </span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token comment">//é”™è¯¯æ¶ˆæ¯</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•-1"><a href="#2ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•-1" class="headerlink" title="2ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•"></a>2ã€æ·»åŠ å¼‚å¸¸å¤„ç†æ–¹æ³•</h5><p>UnifiedExceptionHandlerç±»ä¸­æ·»åŠ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è‡ªå®šä¹‰å¼‚å¸¸ */</span><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">BusinessException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">handleBusinessException</span><span class="token punctuation">(</span><span class="token class-name">BusinessException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€ä¿®æ”¹Controller"><a href="#3ã€ä¿®æ”¹Controller" class="headerlink" title="3ã€ä¿®æ”¹Controller"></a>3ã€ä¿®æ”¹Controller</h5><p>åœ¨AdminIntegralGradeControllerçš„æ–¹æ³•ä¸­æ·»åŠ å¼‚å¸¸å¤„ç†ï¼Œä¸šåŠ¡ä¸­éœ€è¦çš„ä½ç½®æŠ›å‡ºBusinessExceptionè‡ªå®šä¹‰å¼‚å¸¸ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"æ–°å¢ç§¯åˆ†ç­‰çº§"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/save"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">save</span><span class="token punctuation">(</span>    <span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"ç§¯åˆ†ç­‰çº§å¯¹è±¡"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">IntegralGrade</span> integralGrade<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//å¦‚æœå€Ÿæ¬¾é¢åº¦ä¸ºç©ºå°±æ‰‹åŠ¨æŠ›å‡ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¼‚å¸¸ï¼</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>integralGrade<span class="token punctuation">.</span><span class="token function">getBorrowAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">//BORROW_AMOUNT_NULL_ERROR(-201, "å€Ÿæ¬¾é¢åº¦ä¸èƒ½ä¸ºç©º"),</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token class-name">ResponseEnum</span><span class="token punctuation">.</span>BORROW_AMOUNT_NULL_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">boolean</span> result <span class="token operator">=</span> integrationService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>integralGrade<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"ä¿å­˜æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"ä¿å­˜å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€æµ‹è¯•"><a href="#4ã€æµ‹è¯•" class="headerlink" title="4ã€æµ‹è¯•"></a>4ã€æµ‹è¯•</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205052210065.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205052210621.png"></p><h4 id="5ã€å¼‚å¸¸å¤„ç†ä¼˜åŒ–"><a href="#5ã€å¼‚å¸¸å¤„ç†ä¼˜åŒ–" class="headerlink" title="5ã€å¼‚å¸¸å¤„ç†ä¼˜åŒ–"></a>5ã€å¼‚å¸¸å¤„ç†ä¼˜åŒ–</h4><p><font color="red">ç›®æ ‡</font>ï¼šä»¥ä¼˜é›…çš„ Assert(æ–­è¨€) æ–¹å¼æ¥æ ¡éªŒä¸šåŠ¡çš„å¼‚å¸¸æƒ…å†µï¼Œæ¶ˆé™¤ if else</p><h5 id="1ã€ä»€ä¹ˆæ˜¯æ–­è¨€"><a href="#1ã€ä»€ä¹ˆæ˜¯æ–­è¨€" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯æ–­è¨€"></a>1ã€ä»€ä¹ˆæ˜¯æ–­è¨€</h5><p>ç”¨æ–­è¨€çš„æ–¹å¼å°è£…å¼‚å¸¸çš„æŠ›å‡º</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>srb<span class="token punctuation">.</span>core</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Assert</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AssertTests</span> <span class="token punctuation">{</span>    <span class="token comment">//if elseçš„ç”¨æ³•</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span> <span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·ä¸å­˜åœ¨."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">//æ–­è¨€çš„ç”¨æ³•ï¼šæ›´ä¸ºç®€æ´</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// å¦ä¸€ç§å†™æ³•</span>        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">Assert</span><span class="token punctuation">.</span>notNull <span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">"ç”¨æˆ·ä¸å­˜åœ¨."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€è‡ªå®šä¹‰æ–­è¨€"><a href="#2ã€è‡ªå®šä¹‰æ–­è¨€" class="headerlink" title="2ã€è‡ªå®šä¹‰æ–­è¨€"></a>2ã€è‡ªå®šä¹‰æ–­è¨€</h5><p>å¼•å…¥è‡ªå®šä¹‰æ–­è¨€ï¼Œç±»è·¯å¾„ï¼š<code>com.kk.common.exception.Assert</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Assert</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æ–­è¨€å¯¹è±¡ä¸ä¸ºç©º     * obj ä¸ºç©ºåˆ™æŠ›å¼‚å¸¸     *     * @param obj     * @param responseEnum     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">notNull</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">ResponseEnum</span> responseEnum<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"obj is null....................."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span> <span class="token punctuation">(</span>responseEnum<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><font color="red">å®Œæ•´çš„æºä»£ç </font>ï¼šAssert.java</p><h5 id="3ã€ä¿®æ”¹controller"><a href="#3ã€ä¿®æ”¹controller" class="headerlink" title="3ã€ä¿®æ”¹controller"></a>3ã€ä¿®æ”¹controller</h5><p>åœ¨controllerä¸­ç”¨æ–­è¨€æ›¿æ¢if else</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>integralGrade<span class="token punctuation">.</span><span class="token function">getBorrowAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ResponseEnum</span><span class="token punctuation">.</span>BORROW_AMOUNT_NULL_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="6ã€Controllerä¸Šå±‚å¼‚å¸¸"><a href="#6ã€Controllerä¸Šå±‚å¼‚å¸¸" class="headerlink" title="6ã€Controllerä¸Šå±‚å¼‚å¸¸"></a>6ã€Controllerä¸Šå±‚å¼‚å¸¸</h4><h5 id="1ã€å¼‚å¸¸åˆ†ç±»"><a href="#1ã€å¼‚å¸¸åˆ†ç±»" class="headerlink" title="1ã€å¼‚å¸¸åˆ†ç±»"></a>1ã€å¼‚å¸¸åˆ†ç±»</h5><p>å¯¹å¼‚å¸¸æŒ‰é˜¶æ®µè¿›è¡Œåˆ†ç±»ï¼Œå¤§ä½“å¯ä»¥åˆ†æˆï¼šè¿›å…¥Controllerå‰çš„å¼‚å¸¸ å’Œ ä¸šåŠ¡å±‚å¼‚å¸¸ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205052240355.png"></p><h5 id="2ã€å¤„ç†Controllerä¸Šå±‚å¼‚å¸¸"><a href="#2ã€å¤„ç†Controllerä¸Šå±‚å¼‚å¸¸" class="headerlink" title="2ã€å¤„ç†Controllerä¸Šå±‚å¼‚å¸¸"></a>2ã€å¤„ç†Controllerä¸Šå±‚å¼‚å¸¸</h5><p>UnifiedExceptionHandlerä¸­æ·»åŠ </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**     * Controllerä¸Šä¸€å±‚ç›¸å…³å¼‚å¸¸     */</span><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token class-name">NoHandlerFoundException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">HttpRequestMethodNotSupportedException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">HttpMediaTypeNotSupportedException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">MissingPathVariableException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">MissingServletRequestParameterException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">TypeMismatchException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">HttpMessageNotReadableException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">HttpMessageNotWritableException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">MethodArgumentNotValidException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">HttpMediaTypeNotAcceptableException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">ServletRequestBindingException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">ConversionNotSupportedException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">MissingServletRequestPartException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>    <span class="token class-name">AsyncRequestTimeoutException</span><span class="token punctuation">.</span><span class="token keyword">class</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">handleServletException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//SERVLET_ERROR(-102, "servletè¯·æ±‚å¼‚å¸¸"),</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token class-name">ResponseEnum</span><span class="token punctuation">.</span>SERVLET_ERROR<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token class-name">ResponseEnum</span><span class="token punctuation">.</span>SERVLET_ERROR<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€æµ‹è¯•-1"><a href="#3ã€æµ‹è¯•-1" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h5><p>åœ¨saveæµ‹è¯•ç”¨ä¾‹ä¸­è¾“å…¥éæ³•çš„jsonå‚æ•°ï¼Œåˆ™å¾—åˆ°ä¸‹é¢çš„ç»“æœã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°æ—¥å¿—ä¸­æŸ¥çœ‹å…·ä½“çš„é”™è¯¯åŸå› ã€‚å‰ç«¯åªéœ€è¦è¿”å›ç›¸å¯¹ç®€å•å‹å¥½çš„æç¤ºå³å¯ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205052245586.png"></p><h3 id="äº”ã€ç»Ÿä¸€æ—¥å¿—å¤„ç†"><a href="#äº”ã€ç»Ÿä¸€æ—¥å¿—å¤„ç†" class="headerlink" title="äº”ã€ç»Ÿä¸€æ—¥å¿—å¤„ç†"></a>äº”ã€ç»Ÿä¸€æ—¥å¿—å¤„ç†</h3><h4 id="1ã€Logbackæ—¥å¿—"><a href="#1ã€Logbackæ—¥å¿—" class="headerlink" title="1ã€Logbackæ—¥å¿—"></a>1ã€Logbackæ—¥å¿—</h4><h5 id="1-ä»€ä¹ˆæ˜¯æ—¥å¿—"><a href="#1-ä»€ä¹ˆæ˜¯æ—¥å¿—" class="headerlink" title="1.ä»€ä¹ˆæ˜¯æ—¥å¿—"></a>1.ä»€ä¹ˆæ˜¯æ—¥å¿—</h5><p>é€šè¿‡æ—¥å¿—æŸ¥çœ‹ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ï¼Œè¿è¡Œä¿¡æ¯ï¼Œå¼‚å¸¸ä¿¡æ¯ç­‰</p><h5 id="2-æ—¥å¿—çº§åˆ«"><a href="#2-æ—¥å¿—çº§åˆ«" class="headerlink" title="2.æ—¥å¿—çº§åˆ«"></a>2.æ—¥å¿—çº§åˆ«</h5><p>æ—¥å¿—è®°å½•å™¨ï¼ˆLoggerï¼‰çš„è¡Œä¸ºæ˜¯åˆ†ç­‰çº§çš„ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p>åˆ†ä¸ºï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFF</p><p><font color="red">é»˜è®¤</font>æƒ…å†µä¸‹ï¼Œspring bootä»æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„æ—¥å¿—çº§åˆ«åªæœ‰<font color="red">INFOåŠä»¥ä¸Šçº§åˆ«</font>ï¼Œå¯ä»¥é…ç½®æ—¥å¿—çº§åˆ«</p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># è®¾ç½®æ—¥å¿—çº§åˆ«</span><span class="token key atrule">logging</span><span class="token punctuation">:</span>  <span class="token key atrule">level</span><span class="token punctuation">:</span>    <span class="token key atrule">root</span><span class="token punctuation">:</span> ERROR<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§æ–¹å¼èƒ½å°†ERRORçº§åˆ«ä»¥åŠä»¥ä¸Šçº§åˆ«çš„æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ä¸Šï¼Œå…¶ä»–çº§åˆ«å°†ä¸ä¼šè¾“å‡º</p><h5 id="3-åˆ›å»ºæ—¥å¿—æ–‡ä»¶"><a href="#3-åˆ›å»ºæ—¥å¿—æ–‡ä»¶" class="headerlink" title="3.åˆ›å»ºæ—¥å¿—æ–‡ä»¶"></a>3.åˆ›å»ºæ—¥å¿—æ–‡ä»¶</h5><p>spring bootå†…éƒ¨ä½¿ç”¨Logbackä½œä¸ºæ—¥å¿—å®ç°çš„æ¡†æ¶ã€‚</p><p><font color="red">å…ˆåˆ é™¤å‰é¢åœ¨application.ymlä¸­çš„æ—¥å¿—çº§åˆ«é…ç½®</font></p><p>resources ä¸­åˆ›å»º logback-spring.xml ï¼ˆé»˜è®¤æ—¥å¿—æ–‡ä»¶çš„åå­—ï¼‰</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205062025917.png"></p><h5 id="4ã€åˆ›å»ºæµ‹è¯•æ—¥å¿—è¾“å‡º"><a href="#4ã€åˆ›å»ºæµ‹è¯•æ—¥å¿—è¾“å‡º" class="headerlink" title="4ã€åˆ›å»ºæµ‹è¯•æ—¥å¿—è¾“å‡º"></a>4ã€åˆ›å»ºæµ‹è¯•æ—¥å¿—è¾“å‡º</h5><p>å°†ä»¥ä¸‹æ—¥å¿—è¾“å‡ºåˆ°ä»»æ„controllerçš„æ–¹æ³•ä¸­å³å¯ï¼Œä¾‹å¦‚listæ–¹æ³•ä¸­</p><p>å‰æï¼šç±»ä¸Šè®°å¾—åŠ  <code>@Slf4j</code>ï¼Œæ³¨å…¥ log.info </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"ç§¯åˆ†ç­‰çº§åˆ—è¡¨"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">listAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"hi i'm helen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span>warn <span class="token punctuation">(</span><span class="token string">"warning!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span>error <span class="token punctuation">(</span><span class="token string">"it's a error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntegralGrade</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> integralGradeService<span class="token punctuation">.</span>list <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>ok <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>data <span class="token punctuation">(</span><span class="token string">"list"</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€åŸºæœ¬é…ç½®è¯´æ˜"><a href="#2ã€åŸºæœ¬é…ç½®è¯´æ˜" class="headerlink" title="2ã€åŸºæœ¬é…ç½®è¯´æ˜"></a>2ã€åŸºæœ¬é…ç½®è¯´æ˜</h4><h5 id="1-configuration"><a href="#1-configuration" class="headerlink" title="1.configuration"></a>1.configuration</h5><p>æ—¥å¿—é…ç½®çš„æ ¹èŠ‚ç‚¹</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="2-contextName"><a href="#2-contextName" class="headerlink" title="2.contextName"></a>2.contextName</h5><p><contextname>æ˜¯    <configuration>çš„å­èŠ‚ç‚¹ã€‚</configuration></contextname></p><p>æ¯ä¸ªloggeréƒ½å…³è”åˆ°loggerä¸Šä¸‹æ–‡ï¼Œé»˜è®¤ä¸Šä¸‹æ–‡åç§°ä¸ºâ€œdefaultâ€ã€‚ä½†å¯ä»¥ä½¿ç”¨<contextname>è®¾ç½®æˆå…¶ä»–åå­—ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„åº”ç”¨ç¨‹åºã€‚</contextname></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contextName</span><span class="token punctuation">&gt;</span></span>kkSrb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contextName</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="3-property"><a href="#3-property" class="headerlink" title="3.property"></a>3.property</h5><p><property>æ˜¯    <configuration>çš„å­èŠ‚ç‚¹ï¼Œç”¨æ¥å®šä¹‰å˜é‡ã€‚</configuration></property></p><p><property>     æœ‰ä¸¤ä¸ªå±æ€§ï¼Œnameå’Œvalueï¼šnameçš„å€¼æ˜¯å˜é‡çš„åç§°ï¼Œvalueæ˜¯å˜é‡çš„å€¼ã€‚</property></p><p>é€šè¿‡<property>    å®šä¹‰çš„å€¼ä¼šè¢«æ’å…¥åˆ°loggerä¸Šä¸‹æ–‡ä¸­ã€‚å®šä¹‰å˜é‡åï¼Œå¯ä»¥ä½¿â€œ${}â€æ¥ä½¿ç”¨å˜é‡ã€‚</property></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- æ—¥å¿—çš„è¾“å‡ºç›®å½• --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>log.path<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>D:/project/finance/srb_log/core<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--æ§åˆ¶å°æ—¥å¿—æ ¼å¼ï¼šå½©è‰²æ—¥å¿—--&gt;</span><span class="token comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span><span class="token comment">&lt;!-- boldMagenta:ç²—çº¢--&gt;</span><span class="token comment">&lt;!-- cyan:é’è‰² --&gt;</span><span class="token comment">&lt;!-- white:ç™½è‰² --&gt;</span><span class="token comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE_LOG_PATTERN<span class="token punctuation">"</span></span>          <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%yellow(%date{yyyy-MM-dd HH:mm:ss}) %highlight([%-5level]) %green(%logger) %msg%n<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--æ–‡ä»¶æ—¥å¿—æ ¼å¼--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FILE_LOG_PATTERN<span class="token punctuation">"</span></span>          <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%date{yyyy-MM-dd HH:mm:ss} [%-5level] %thread %file:%line %logger %msg%n<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--ç¼–ç --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ENCODING<span class="token punctuation">"</span></span>          <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€appender"><a href="#4ã€appender" class="headerlink" title="4ã€appender"></a>4ã€appender</h5><p><appender>     æ˜¯<configuration>çš„å­èŠ‚ç‚¹ï¼Œæ˜¯è´Ÿè´£å†™æ—¥å¿—çš„ç»„ä»¶</configuration></appender></p><p><appender>    æœ‰ä¸¤ä¸ªå¿…è¦å±æ€§nameå’Œclassï¼šnameæŒ‡å®šappenderåç§°ï¼ŒclassæŒ‡å®šappenderçš„å…¨é™å®šå</appender></p><p><encoder>       å¯¹æ—¥å¿—è¿›è¡Œæ ¼å¼åŒ–</encoder></p><p><pattern>        å®šä¹‰æ—¥å¿—çš„å…·ä½“è¾“å‡ºæ ¼å¼</pattern></p><p><charset>        ç¼–ç æ–¹å¼</charset></p><p><strong>4.1æ§åˆ¶å°æ—¥å¿—é…ç½®</strong></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- æ§åˆ¶å°æ—¥å¿— --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>${CONSOLE_LOG_PATTERN}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>${ENCODING}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>4.2æ–‡ä»¶æ—¥å¿—é…ç½®</strong> </p><p><file>è¡¨ç¤ºæ—¥å¿—æ–‡ä»¶çš„ä½ç½®ï¼Œå¦‚æœä¸Šçº§ç›®å½•ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ²¡æœ‰é»˜è®¤å€¼ã€‚</file></p><p><append>é»˜è®¤ trueï¼Œæ—¥å¿—è¢«è¿½åŠ åˆ°æ–‡ä»¶ç»“å°¾ï¼Œå¦‚æœæ˜¯ falseï¼ŒæœåŠ¡é‡å¯åæ¸…ç©ºç°å­˜æ–‡ä»¶ã€‚</append></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- æ–‡ä»¶æ—¥å¿— --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.FileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${log.path}/log.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>${FILE_LOG_PATTERN}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>${ENCODING}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="5ã€logger"><a href="#5ã€logger" class="headerlink" title="5ã€logger"></a>5ã€logger</h5><p><logger>å¯ä»¥æ˜¯    <configuration>çš„å­èŠ‚ç‚¹ï¼Œç”¨æ¥è®¾ç½®æŸä¸€ä¸ªåŒ…æˆ–å…·ä½“æŸä¸€ä¸ªç±»çš„æ—¥å¿—æ‰“å°çº§åˆ«ã€æŒ‡å®š<appender></appender></configuration></logger></p><p>nameï¼š    ç”¨æ¥æŒ‡å®šå—æ­¤loggerçº¦æŸçš„æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»</p><p>levelï¼š    ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFã€‚é»˜è®¤ç»§æ‰¿ä¸Šçº§çš„çº§åˆ«</p><p><logger>    å¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ª<appender-ref>å…ƒç´ ï¼Œæ ‡è¯†è¿™ä¸ªappenderå°†ä¼šæ·»åŠ åˆ°è¿™ä¸ªlogger</appender-ref></logger></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- æ—¥å¿—è®°å½•å™¨  --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="6ã€æµ‹è¯•"><a href="#6ã€æµ‹è¯•" class="headerlink" title="6ã€æµ‹è¯•"></a>6ã€æµ‹è¯•</h5><p>æµ‹è¯•æ—¥å¿—è®°å½•çš„æ§åˆ¶å°è¾“å‡ºã€æ–‡ä»¶è¾“å‡ºã€ä»¥åŠæ—¥å¿—çº§åˆ«</p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205062051381.png"></p><h4 id="3ã€å¤šç¯å¢ƒé…ç½®"><a href="#3ã€å¤šç¯å¢ƒé…ç½®" class="headerlink" title="3ã€å¤šç¯å¢ƒé…ç½®"></a>3ã€å¤šç¯å¢ƒé…ç½®</h4><h5 id="springProfile"><a href="#springProfile" class="headerlink" title="springProfile"></a>springProfile</h5><p>åœ¨ä¸€ä¸ªåŸºäºSpring bootå¼€å‘çš„é¡¹ç›®é‡Œï¼Œå¸¸å¸¸éœ€è¦æœ‰å¤šå¥—ç¯å¢ƒçš„é…ç½®ï¼šå¼€å‘ï¼Œæµ‹è¯•ä»¥åŠäº§å“ã€‚</p><p>ä½¿ç”¨springProfile å¯ä»¥åˆ†åˆ«é…ç½®å¼€å‘ï¼ˆdevï¼‰ï¼Œæµ‹è¯•ï¼ˆtestï¼‰ä»¥åŠç”Ÿäº§ï¼ˆprodï¼‰ç­‰ä¸åŒçš„ç¯å¢ƒ</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dev,test<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- ç”Ÿäº§ç¯å¢ƒ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prod<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ERROR<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FILE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><font color="red">æ³¨æ„</font>ï¼šéœ€è¦æ³¨é‡ŠåŸå§‹é…ç½®</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- æ—¥å¿—è®°å½•å™¨  --&gt;</span><span class="token comment">&lt;!--&lt;logger name="com.kk" level="INFO"&gt;--&gt;</span>    <span class="token comment">&lt;!--&lt;appender-ref ref="CONSOLE"/&gt;--&gt;</span>    <span class="token comment">&lt;!--&lt;appender-ref ref="FILE"/&gt;--&gt;</span><span class="token comment">&lt;!--&lt;/logger&gt;--&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€æ»šåŠ¨æ—¥å¿—-â˜…"><a href="#4ã€æ»šåŠ¨æ—¥å¿—-â˜…" class="headerlink" title="4ã€æ»šåŠ¨æ—¥å¿— â˜…"></a>4ã€æ»šåŠ¨æ—¥å¿— â˜…</h4><p><font color="red">é—®é¢˜</font>ï¼šç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œå¦‚æœç³»ç»Ÿé•¿æ—¶é—´è¿è¡Œï¼Œé‚£ä¹ˆæ—¥å¿—æ–‡ä»¶ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œç³»ç»Ÿè¯»å–å’Œå†™å…¥æ—¥å¿—çš„æ—¶é—´ä¼šè¶Šæ¥è¶Šæ…¢ï¼Œä¸¥é‡çš„æƒ…å†µä¼šè€—å°½ç³»ç»Ÿå†…å­˜ï¼Œå¯¼è‡´ç³»ç»Ÿå®•æœºã€‚</p><p><font color="red">è§£å†³æ–¹æ¡ˆ</font>ï¼šå¯ä»¥è®¾ç½®æ»šåŠ¨æ—¥å¿—ã€‚</p><h5 id="1-è®¾ç½®æ—¶é—´æ»šåŠ¨ç­–ç•¥"><a href="#1-è®¾ç½®æ—¶é—´æ»šåŠ¨ç­–ç•¥" class="headerlink" title="1.è®¾ç½®æ—¶é—´æ»šåŠ¨ç­–ç•¥"></a>1.è®¾ç½®æ—¶é—´æ»šåŠ¨ç­–ç•¥</h5><p>RollingFileAppenderæ˜¯    Appenderçš„å¦ä¸€ä¸ªå®ç°ï¼Œè¡¨ç¤ºæ»šåŠ¨è®°å½•æ–‡ä»¶ï¼Œå…ˆå°†æ—¥å¿—è®°å½•åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œå½“ç¬¦åˆæŸä¸ªæ¡ä»¶æ—¶ï¼Œå°†æ—§æ—¥å¿—å¤‡ä»½åˆ°å…¶ä»–æ–‡ä»¶</p><p><rollingpolicy>æ˜¯    <appender>çš„å­èŠ‚ç‚¹ï¼Œç”¨æ¥å®šä¹‰æ»šåŠ¨ç­–ç•¥ã€‚</appender></rollingpolicy></p><p>TimeBasedRollingPolicyï¼š    æœ€å¸¸ç”¨çš„æ»šåŠ¨ç­–ç•¥ï¼Œæ ¹æ®æ—¶é—´æ¥åˆ¶å®šæ»šåŠ¨ç­–ç•¥ã€‚</p><p><filenamepattern>ï¼š    åŒ…å«æ–‡ä»¶ååŠè½¬æ¢ç¬¦ï¼Œ â€œ%dâ€å¯ä»¥åŒ…å«æŒ‡å®šçš„æ—¶é—´æ ¼å¼ï¼Œå¦‚ï¼š%d{yyyy-MM-dd}ã€‚å¦‚æœç›´æ¥ä½¿ç”¨ %dï¼Œé»˜è®¤æ ¼å¼æ˜¯ yyyy-MM-ddã€‚</filenamepattern></p><p><maxhistory>ï¼š    å¯é€‰èŠ‚ç‚¹ï¼Œæ§åˆ¶ä¿ç•™çš„å½’æ¡£æ–‡ä»¶çš„æœ€å¤§æ•°é‡ï¼Œè¶…å‡ºæ•°é‡å°±åˆ é™¤æ—§æ–‡ä»¶ã€‚å‡è®¾è®¾ç½®æ¯ä¸ªæœˆæ»šåŠ¨ï¼Œä¸”<maxhistory>æ˜¯6ï¼Œåˆ™åªä¿å­˜æœ€è¿‘6ä¸ªæœˆçš„æ–‡ä»¶ï¼Œåˆ é™¤ä¹‹å‰çš„æ—§æ–‡ä»¶ã€‚æ³¨æ„ï¼Œåˆ é™¤æ—§æ–‡ä»¶æ˜¯ï¼Œé‚£äº›ä¸ºäº†å½’æ¡£è€Œåˆ›å»ºçš„ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</maxhistory></maxhistory></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ROLLING_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--  è¦åŒºåˆ«äºå…¶ä»–çš„appenderä¸­çš„æ–‡ä»¶åå­—  --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${log.path}/log-rolling.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>${FILE_LOG_PATTERN}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>${ENCODING}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- è®¾ç½®æ»šåŠ¨æ—¥å¿—è®°å½•çš„æ»šåŠ¨ç­–ç•¥ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${log.path}/info/log-rolling-%d{yyyy-MM-dd}.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--å½’æ¡£æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æœ€å¤§æ•°é‡--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-è®¾ç½®è§¦å‘æ»šåŠ¨æ—¶æœº"><a href="#2-è®¾ç½®è§¦å‘æ»šåŠ¨æ—¶æœº" class="headerlink" title="2.è®¾ç½®è§¦å‘æ»šåŠ¨æ—¶æœº"></a>2.è®¾ç½®è§¦å‘æ»šåŠ¨æ—¶æœº</h5><p>æ”¾åœ¨<rollingpolicy>çš„å­èŠ‚ç‚¹çš„ä½ç½®é‡Œé¢ï¼ŒåŸºäºå®è·µç­–ç•¥çš„è§¦å‘æ»šåŠ¨ç­–ç•¥</rollingpolicy></p><p><maxfilesize>è®¾ç½®è§¦å‘æ»šåŠ¨æ¡ä»¶ï¼šå•ä¸ªæ–‡ä»¶å¤§äº100Mæ—¶ç”Ÿæˆæ–°çš„æ–‡ä»¶</maxfilesize></p><p><font color="red"><strong>æ³¨æ„ï¼šä¿®æ”¹æ—¥å¿—æ–‡ä»¶å</strong>  </font>æ­¤æ—¶ <filenamepattern>${log.path}/info/log-rolling-%d{yyyy-MM-dd}<font color="red"><strong>.%i</strong></font>.log</filenamepattern></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>1KB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="5ã€å®Œæ•´çš„æ—¥å¿—é…ç½®æ–‡ä»¶"><a href="#5ã€å®Œæ•´çš„æ—¥å¿—é…ç½®æ–‡ä»¶" class="headerlink" title="5ã€å®Œæ•´çš„æ—¥å¿—é…ç½®æ–‡ä»¶"></a>5ã€å®Œæ•´çš„æ—¥å¿—é…ç½®æ–‡ä»¶</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contextName</span><span class="token punctuation">&gt;</span></span>kkSrb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contextName</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- æ—¥å¿—çš„è¾“å‡ºç›®å½• --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>log.path<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>D:/project/test/srb_log/core<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!--æ§åˆ¶å°æ—¥å¿—æ ¼å¼ï¼šå½©è‰²æ—¥å¿—--&gt;</span>    <span class="token comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span>    <span class="token comment">&lt;!-- boldMagenta:ç²—çº¢--&gt;</span>    <span class="token comment">&lt;!-- cyan:é’è‰² --&gt;</span>    <span class="token comment">&lt;!-- white:ç™½è‰² --&gt;</span>    <span class="token comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE_LOG_PATTERN<span class="token punctuation">"</span></span>              <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%yellow(%date{yyyy-MM-dd HH:mm:ss}) %highlight([%-5level]) %green(%logger) %msg%n<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!--æ–‡ä»¶æ—¥å¿—æ ¼å¼--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FILE_LOG_PATTERN<span class="token punctuation">"</span></span>              <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>%date{yyyy-MM-dd HH:mm:ss} [%-5level] %thread %file:%line %logger %msg%n<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!--ç¼–ç --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ENCODING<span class="token punctuation">"</span></span>              <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- æ§åˆ¶å°æ—¥å¿— --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>${CONSOLE_LOG_PATTERN}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>${ENCODING}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- æ–‡ä»¶æ—¥å¿— --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.FileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${log.path}/log.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>${FILE_LOG_PATTERN}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>${ENCODING}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ROLLING_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--  è¦åŒºåˆ«äºå…¶ä»–çš„appenderä¸­çš„æ–‡ä»¶åå­—  --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${log.path}/log-rolling.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>${FILE_LOG_PATTERN}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>${ENCODING}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- è®¾ç½®æ»šåŠ¨æ—¥å¿—è®°å½•çš„æ»šåŠ¨ç­–ç•¥ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${log.path}/info/log-rolling-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!--å½’æ¡£æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æœ€å¤§æ•°é‡--&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>1KB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--    &lt;logger name="com.kk" level="INFO"&gt;--&gt;</span>    <span class="token comment">&lt;!--        &lt;appender-ref ref="CONSOLE" /&gt;--&gt;</span>    <span class="token comment">&lt;!--        &lt;appender-ref ref="FILE" /&gt;--&gt;</span>    <span class="token comment">&lt;!--    &lt;/logger&gt;--&gt;</span>    <span class="token comment">&lt;!-- å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dev,test<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- ç”Ÿäº§ç¯å¢ƒ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prod<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ERROR<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONSOLE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ROLLING_FILE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="â…¢ã€å‰ç«¯æ¶æ„æ­å»º"><a href="#â…¢ã€å‰ç«¯æ¶æ„æ­å»º" class="headerlink" title="â…¢ã€å‰ç«¯æ¶æ„æ­å»º"></a>â…¢ã€å‰ç«¯æ¶æ„æ­å»º</h2><h3 id="ä¸€ã€æ­å»ºå‰ç«¯å¹³å°"><a href="#ä¸€ã€æ­å»ºå‰ç«¯å¹³å°" class="headerlink" title="ä¸€ã€æ­å»ºå‰ç«¯å¹³å°"></a>ä¸€ã€æ­å»ºå‰ç«¯å¹³å°</h3><h4 id="1ã€vue-element-admin"><a href="#1ã€vue-element-admin" class="headerlink" title="1ã€vue-element-admin"></a>1ã€<strong>vue-element-admin</strong></h4><p>vue-element-adminæ˜¯åŸºäºelement-ui çš„ä¸€å¥—åå°ç®¡ç†<font color="red">ç³»ç»Ÿé›†æˆæ–¹æ¡ˆ</font>ã€‚</p><p><strong>GitHubåœ°å€ï¼š</strong><a href="https://github.com/PanJiaChen/vue-element-admin">https://github.com/PanJiaChen/vue-element-admin</a></p><p><strong>é¡¹ç›®åœ¨çº¿é¢„è§ˆï¼š</strong><a href="https://panjiachen.gitee.io/vue-element-admin/#/login?redirect=%2Fdashboard">https://panjiachen.gitee.io/vue-element-admin</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205062135460.png"></p><h4 id="2ã€vue-admin-template"><a href="#2ã€vue-admin-template" class="headerlink" title="2ã€vue-admin-template"></a>2ã€<strong>vue-admin-template</strong></h4><h5 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h5><p>vueAdmin-templateæ˜¯åŸºäºvue-element-adminçš„ä¸€å¥—åå°ç®¡ç†ç³»ç»ŸåŸºç¡€æ¨¡æ¿<font color="red">ï¼ˆæœ€å°‘ç²¾ç®€ç‰ˆï¼‰</font>ï¼Œå¯ä½œä¸ºæ¨¡æ¿è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚</p><p><strong>GitHubåœ°å€ï¼š</strong><a href="https://github.com/PanJiaChen/vue-admin-template">https://github.com/PanJiaChen/vue-admin-template</a></p><p><strong>æ ¹æ®ç”¨æˆ·è§’è‰²æ¥åŠ¨æ€ç”Ÿæˆä¾§è¾¹æ çš„åˆ†æ”¯ï¼š</strong><a href="https://github.com/PanJiaChen/vue-admin-template/tree/permission-control">https://github.com/PanJiaChen/vue-admin-template/tree/permission-control</a></p><h5 id="2ã€å®‰è£…å’Œè¿è¡Œ"><a href="#2ã€å®‰è£…å’Œè¿è¡Œ" class="headerlink" title="2ã€å®‰è£…å’Œè¿è¡Œ"></a>2ã€å®‰è£…å’Œè¿è¡Œ</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># clone é¡¹ç›®</span><span class="token function">git</span> clone https<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token comment"># é‡å‘½å,åˆ æ‰è‡ªå¸¦çš„ .gitæ–‡ä»¶å¤¹</span><span class="token comment"># è¿›å…¥ç›®å½•</span><span class="token builtin class-name">cd</span> FrontEndCode<span class="token comment"># å®‰è£…ä¾èµ–</span><span class="token function">npm</span> <span class="token function">install</span><span class="token comment"># å¯åŠ¨ã€‚æ‰§è¡Œåï¼Œæµè§ˆå™¨è‡ªåŠ¨å¼¹å‡ºå¹¶è®¿é—®http://localhost:9528/</span><span class="token function">npm</span> run dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205062156091.png"></p><h4 id="3ã€å‰ç«¯é…ç½®"><a href="#3ã€å‰ç«¯é…ç½®" class="headerlink" title="3ã€å‰ç«¯é…ç½®"></a>3ã€å‰ç«¯é…ç½®</h4><h5 id="1ã€ç¦ç”¨ESLintè¯­æ³•æ£€æŸ¥"><a href="#1ã€ç¦ç”¨ESLintè¯­æ³•æ£€æŸ¥" class="headerlink" title="1ã€ç¦ç”¨ESLintè¯­æ³•æ£€æŸ¥"></a>1ã€ç¦ç”¨ESLintè¯­æ³•æ£€æŸ¥</h5><p>vue.config.js ç¬¬30è¡Œå¤„ç¦ç”¨ESLintè¯­æ³•æ£€æŸ¥</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">lintOnSave<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="2ã€æ·»åŠ prettieræ ¼å¼åŒ–é…ç½®"><a href="#2ã€æ·»åŠ prettieræ ¼å¼åŒ–é…ç½®" class="headerlink" title="2ã€æ·»åŠ prettieræ ¼å¼åŒ–é…ç½®"></a>2ã€æ·»åŠ prettieræ ¼å¼åŒ–é…ç½®</h5><p>åœ¨vueé¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶.prettierrc</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">{</span>  <span class="token string">"semi"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token string">"singleQuote"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token string">"htmlWhitespaceSensitivity"</span><span class="token operator">:</span> <span class="token string">"ignore"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€ä¿®æ”¹é¡µé¢æ ‡é¢˜"><a href="#3ã€ä¿®æ”¹é¡µé¢æ ‡é¢˜" class="headerlink" title="3ã€ä¿®æ”¹é¡µé¢æ ‡é¢˜"></a>3ã€ä¿®æ”¹é¡µé¢æ ‡é¢˜</h5><p>src/settings.js ç¬¬3è¡Œå¤„ä¿®æ”¹é¡µé¢æ ‡é¢˜</p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205062211618.png"></p><h5 id="4ã€å›½é™…åŒ–è®¾ç½®"><a href="#4ã€å›½é™…åŒ–è®¾ç½®" class="headerlink" title="4ã€å›½é™…åŒ–è®¾ç½®"></a>4ã€å›½é™…åŒ–è®¾ç½®</h5><p>src/main.js ç¬¬7è¡Œå¤„ä¿®æ”¹è¯­è¨€</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> locale <span class="token keyword">from</span> <span class="token string">'element-ui/lib/locale/lang/zh-CN'</span> <span class="token comment">// lang i18n</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æµ‹è¯•å¹³å°è¯­è¨€çš„ä¿®æ”¹</p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205062329256.png"></p><h5 id="5ã€ä¸‹æ‹‰èœå•ä¿®æ”¹"><a href="#5ã€ä¸‹æ‹‰èœå•ä¿®æ”¹" class="headerlink" title="5ã€ä¸‹æ‹‰èœå•ä¿®æ”¹"></a>5ã€ä¸‹æ‹‰èœå•ä¿®æ”¹</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205062331557.png"></p><h5 id="6ã€ç™»å½•é¡µä¿®æ”¹"><a href="#6ã€ç™»å½•é¡µä¿®æ”¹" class="headerlink" title="6ã€ç™»å½•é¡µä¿®æ”¹"></a>6ã€ç™»å½•é¡µä¿®æ”¹</h5><p>src/views/login/index.vue</p><p>ä¿®æ”¹é¡µé¢æ ‡é¢˜ã€ç™»å½•æŒ‰é’®ç­‰</p><h3 id="äºŒã€ç³»ç»Ÿè·¯ç”±é…ç½®"><a href="#äºŒã€ç³»ç»Ÿè·¯ç”±é…ç½®" class="headerlink" title="äºŒã€ç³»ç»Ÿè·¯ç”±é…ç½®"></a>äºŒã€ç³»ç»Ÿè·¯ç”±é…ç½®</h3><h4 id="1ã€ç»„ä»¶å®šä¹‰"><a href="#1ã€ç»„ä»¶å®šä¹‰" class="headerlink" title="1ã€ç»„ä»¶å®šä¹‰"></a>1ã€<strong>ç»„ä»¶å®šä¹‰</strong></h4><h5 id="1ã€åˆ›å»ºvueç»„ä»¶"><a href="#1ã€åˆ›å»ºvueç»„ä»¶" class="headerlink" title="1ã€åˆ›å»ºvueç»„ä»¶"></a>1ã€åˆ›å»ºvueç»„ä»¶</h5><p>åœ¨src/viewsæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä»¥ä¸‹æ–‡ä»¶å¤¹å’Œæ–‡ä»¶</p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205062339340.png"></p><h5 id="2ã€list-vue"><a href="#2ã€list-vue" class="headerlink" title="2ã€list.vue"></a>2ã€list.vue</h5><p>core/integral-grade/list.vue</p><p>æ³¨æ„ï¼Œæœ€åº•ä¸‹ä¿ç•™ä¸€è¡Œï¼Œä¸ç„¶vscodeæŠ¥é”™</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;  &lt;div class="app-container"&gt;ç§¯åˆ†ç­‰çº§åˆ—è¡¨&lt;/div&gt;&lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="3ã€form-vue"><a href="#3ã€form-vue" class="headerlink" title="3ã€form.vue"></a>3ã€form.vue</h5><p>core/integral-grade/orm.vue</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;  &lt;div class="app-container"&gt;    ç§¯åˆ†ç­‰çº§è¡¨å•  &lt;/div&gt;&lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€è·¯ç”±å®šä¹‰"><a href="#2ã€è·¯ç”±å®šä¹‰" class="headerlink" title="2ã€è·¯ç”±å®šä¹‰"></a>2ã€è·¯ç”±å®šä¹‰</h4><p>ä¿®æ”¹ src/router/index.js æ–‡ä»¶ï¼Œé‡æ–°å®šä¹‰constantRoutesï¼Œæ‹·è´åˆ° dashboardè·¯ç”±èŠ‚ç‚¹ ä¸‹é¢</p><p><font color="red"><strong>æ³¨æ„ï¼š</strong>æ¯ä¸ªè·¯ç”±çš„nameä¸èƒ½ç›¸åŒ</font></p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">{</span>    path<span class="token operator">:</span> <span class="token string">'/core/integral-grade'</span><span class="token punctuation">,</span>    component<span class="token operator">:</span> Layout<span class="token punctuation">,</span>    redirect<span class="token operator">:</span> <span class="token string">'/core/integral-grade/list'</span><span class="token punctuation">,</span>    name<span class="token operator">:</span> <span class="token string">'coreIntegralGrade'</span><span class="token punctuation">,</span>    meta<span class="token operator">:</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">'ç§¯åˆ†ç­‰çº§ç®¡ç†'</span><span class="token punctuation">,</span> icon<span class="token operator">:</span> <span class="token string">'el-icon-s-marketing'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    alwaysShow<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    children<span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">{</span>        path<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>        name<span class="token operator">:</span> <span class="token string">'coreIntegralGradeList'</span><span class="token punctuation">,</span>        <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/core/integral-grade/list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        meta<span class="token operator">:</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">'ç§¯åˆ†ç­‰çº§åˆ—è¡¨'</span> <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>        path<span class="token operator">:</span> <span class="token string">'create'</span><span class="token punctuation">,</span>        name<span class="token operator">:</span> <span class="token string">'coreIntegralGradeCreate'</span><span class="token punctuation">,</span>        <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/core/integral-grade/form'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        meta<span class="token operator">:</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">'æ–°å¢ç§¯åˆ†ç­‰çº§'</span> <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>        path<span class="token operator">:</span> <span class="token string">'edit/:id'</span><span class="token punctuation">,</span>        name<span class="token operator">:</span> <span class="token string">'coreIntegralGradeEdit'</span><span class="token punctuation">,</span>        <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/core/integral-grade/form'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        meta<span class="token operator">:</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">'ç¼–è¾‘ç§¯åˆ†ç­‰çº§'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        hidden<span class="token operator">:</span> <span class="token boolean">true</span>      <span class="token punctuation">}</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸‰ã€å‰ç«¯å¼€å‘æµç¨‹"><a href="#ä¸‰ã€å‰ç«¯å¼€å‘æµç¨‹" class="headerlink" title="ä¸‰ã€å‰ç«¯å¼€å‘æµç¨‹"></a>ä¸‰ã€å‰ç«¯å¼€å‘æµç¨‹</h3><h4 id="1ã€å…¨æ ˆå¼€å‘æµç¨‹"><a href="#1ã€å…¨æ ˆå¼€å‘æµç¨‹" class="headerlink" title="1ã€å…¨æ ˆå¼€å‘æµç¨‹"></a>1ã€å…¨æ ˆå¼€å‘æµç¨‹</h4><h5 id="1ã€å‰ç«¯è°ƒç”¨æµç¨‹"><a href="#1ã€å‰ç«¯è°ƒç”¨æµç¨‹" class="headerlink" title="1ã€å‰ç«¯è°ƒç”¨æµç¨‹"></a>1ã€å‰ç«¯è°ƒç”¨æµç¨‹</h5><p>ä¸‹å›¾æ˜¯å¼€å‘è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°å’Œå‡ ä¸ªæ ¸å¿ƒçš„æ¨¡å—ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†è·¯ç”±çš„é…ç½®å’Œé¡µé¢ç»„ä»¶çš„åˆ›å»ºï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥å®Œå–„é¡µé¢ç»„ä»¶çš„æ¨¡æ¿ &lt;template&gt;éƒ¨åˆ†ï¼Œä»¥åŠè„šæœ¬&lt;script&gt;ç­‰éƒ¨åˆ†çš„å¼€å‘ï¼Œç„¶ååˆ›å»ºå‰åç«¯å¯¹æ¥éœ€è¦çš„apiæ¨¡å—ï¼Œæœ€åé€šè¿‡apiæ¨¡å—å‘åç«¯æ¥å£å‘èµ·è°ƒç”¨ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205072259818.png"></p><h5 id="2ã€nginxåå‘ä»£ç†é…ç½®"><a href="#2ã€nginxåå‘ä»£ç†é…ç½®" class="headerlink" title="2ã€nginxåå‘ä»£ç†é…ç½®"></a>2ã€nginxåå‘ä»£ç†é…ç½®</h5><p>ç›®å‰ï¼Œåº”ç”¨ç¨‹åºçš„å‰åç«¯åŸºæœ¬æ¶æ„å¦‚ä¸‹ï¼šsrb-adminæ˜¯å‰ç«¯ç¨‹åºï¼Œç›´æ¥è°ƒç”¨åç«¯çš„srb-coreå¾®æœåŠ¡</p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205080942459.png"></p><p>ä¸ºäº†èƒ½å¤Ÿè®©å‰ç«¯ç¨‹åºèƒ½å¤ŸåŒæ—¶å¯¹æ¥å¤šä¸ªåç«¯æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šç§è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚nginxåå‘ä»£ç†ã€å¾®æœåŠ¡ç½‘å…³ç­‰ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨nginxä½œä¸ºå‰åç«¯ä¸­é—´çš„åå‘ä»£ç†å±‚ï¼Œæ¶æ„å¦‚ä¸‹</p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205080956814.png"></p><p>nginxçš„é…ç½®</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">{</span><span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span><span class="token keyword">server_name</span>  localhost<span class="token punctuation">;</span><span class="token keyword">location</span> <span class="token operator">~</span> <span class="token operator">/</span>core<span class="token operator">/</span> <span class="token punctuation">{</span>               <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8110</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">location</span> <span class="token operator">~</span> <span class="token operator">/</span>sms<span class="token operator">/</span> <span class="token punctuation">{</span>               <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8120</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">location</span> <span class="token operator">~</span> <span class="token operator">/</span>oss<span class="token operator">/</span> <span class="token punctuation">{</span>                       <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8130</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>nginxçš„å‘½ä»¤</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx">start nginx <span class="token comment">#å¯åŠ¨</span>nginx <span class="token operator">-</span>s stop <span class="token comment">#åœæ­¢</span>nginx <span class="token operator">-</span>s reload <span class="token comment">#é‡æ–°åŠ è½½é…ç½®</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å‰ç«¯çš„é…ç½®ï¼š .env.development</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"># base apiï¼šè¿æ¥åˆ°nginx<span class="token constant">VUE_APP_BASE_API</span> <span class="token operator">=</span> <span class="token string">'http://localhost'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="3ã€mock-server"><a href="#3ã€mock-server" class="headerlink" title="3ã€mock-server"></a>3ã€mock-server</h5><p>VUE_APP_BASE_API çš„ ä¿®æ”¹ä¼šå½±å“åˆ°å¹³å°æ¨¡æ‹Ÿç™»å½•åŠŸèƒ½çš„mockæ•°æ®ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹mock-serverçš„åœ°å€</p><p>ä¿®æ”¹ mock/mock-server.js æ–‡ä»¶ ç¬¬37è¡Œ</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">url<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/dev-api</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹ src/api/user.jsä¸­çš„æ¥å£è°ƒç”¨ï¼Œä¸ºæ¯ä¸€ä¸ªè¿œç¨‹è°ƒç”¨æ·»åŠ é…ç½®</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">baseURL<span class="token operator">:</span> <span class="token string">'/dev-api'</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205081822995.png"></p><h4 id="2ã€å‰ç«¯ç»„ä»¶å¼€å‘"><a href="#2ã€å‰ç«¯ç»„ä»¶å¼€å‘" class="headerlink" title="2ã€å‰ç«¯ç»„ä»¶å¼€å‘"></a>2ã€å‰ç«¯ç»„ä»¶å¼€å‘</h4><h5 id="1ã€å®šä¹‰apiæ¨¡å—"><a href="#1ã€å®šä¹‰apiæ¨¡å—" class="headerlink" title="1ã€å®šä¹‰apiæ¨¡å—"></a>1ã€å®šä¹‰apiæ¨¡å—</h5><p>åˆ›å»ºæ–‡ä»¶ src/api/core/integral-grade.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// @ ç¬¦å·åœ¨vue.config.js ä¸­é…ç½®ï¼Œ è¡¨ç¤º 'src' è·¯å¾„çš„åˆ«å</span><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>  <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      url<span class="token operator">:</span> <span class="token string">'/admin/core/integralGrade/list'</span><span class="token punctuation">,</span>      method<span class="token operator">:</span> <span class="token string">'get'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€å®šä¹‰é¡µé¢ç»„ä»¶è„šæœ¬"><a href="#2ã€å®šä¹‰é¡µé¢ç»„ä»¶è„šæœ¬" class="headerlink" title="2ã€å®šä¹‰é¡µé¢ç»„ä»¶è„šæœ¬"></a>2ã€å®šä¹‰é¡µé¢ç»„ä»¶è„šæœ¬</h5><p>src/views/core/integral-grade/list.vue</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script&gt;import integralGradeApi from '@/api/core/integral-grade'export default {  // å®šä¹‰æ•°æ®æ¨¡å‹  data() {    return {      list: [] // æ•°æ®åˆ—è¡¨    }  },  // é¡µé¢æ¸²æŸ“æˆåŠŸåè·å–æ•°æ®  created() {    this.fetchData()  },  // å®šä¹‰æ–¹æ³•  methods: {    fetchData() {      // è°ƒç”¨api      integralGradeApi.list().then(response =&gt; {        this.list = response.data.list      })    }  }}&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€å®šä¹‰é¡µé¢ç»„ä»¶æ¨¡æ¿"><a href="#3ã€å®šä¹‰é¡µé¢ç»„ä»¶æ¨¡æ¿" class="headerlink" title="3ã€å®šä¹‰é¡µé¢ç»„ä»¶æ¨¡æ¿"></a>3ã€å®šä¹‰é¡µé¢ç»„ä»¶æ¨¡æ¿</h5><p>src/views/core/integral-grade/list.vue</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;  &lt;div class="app-container"&gt;    &lt;!-- è¡¨æ ¼ --&gt;    &lt;el-table :data="list" border stripe&gt;      &lt;el-table-column type="index" width="50" /&gt;      &lt;el-table-column prop="borrowAmount" label="å€Ÿæ¬¾é¢åº¦" /&gt;      &lt;el-table-column prop="integralStart" label="ç§¯åˆ†åŒºé—´å¼€å§‹" /&gt;      &lt;el-table-column prop="integralEnd" label="ç§¯åˆ†åŒºé—´ç»“æŸ" /&gt;    &lt;/el-table&gt;  &lt;/div&gt;&lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€axioså“åº”æ‹¦æˆªå™¨ä¿®æ”¹"><a href="#4ã€axioså“åº”æ‹¦æˆªå™¨ä¿®æ”¹" class="headerlink" title="4ã€axioså“åº”æ‹¦æˆªå™¨ä¿®æ”¹"></a>4ã€axioså“åº”æ‹¦æˆªå™¨ä¿®æ”¹</h5><p>src/utils/request.js ä¸­ å°†ç¬¬49è¡Œçš„ </p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">20000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹æˆ</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">20000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å› ä¸ºæˆ‘ä»¬çš„åç«¯æ¥å£ç»Ÿä¸€ç»“æœåˆ¤æ–­0ä¸ºæˆåŠŸçš„å“åº”ç»“æœï¼Œè€Œmockæ•°æ®åˆ¤æ–­20000ä½æ­£ç¡®çš„ç»“æœ</p><h5 id="-1"><a href="#-1" class="headerlink" title=""></a></h5><h3 id="å››ã€å®Œå–„ç§¯åˆ†æ¨¡å—"><a href="#å››ã€å®Œå–„ç§¯åˆ†æ¨¡å—" class="headerlink" title="å››ã€å®Œå–„ç§¯åˆ†æ¨¡å—"></a>å››ã€å®Œå–„ç§¯åˆ†æ¨¡å—</h3><h4 id="1ã€åˆ é™¤æ•°æ®"><a href="#1ã€åˆ é™¤æ•°æ®" class="headerlink" title="1ã€åˆ é™¤æ•°æ®"></a>1ã€<strong>åˆ é™¤æ•°æ®</strong></h4><h5 id="1-å®šä¹‰api"><a href="#1-å®šä¹‰api" class="headerlink" title="1.å®šä¹‰api"></a>1.å®šä¹‰api</h5><p> src/api/core/integral-grade.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">removeById</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/admin/core/integralGrade/remove/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>        method<span class="token operator">:</span> <span class="token string">'delete'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-é¡µé¢ç»„ä»¶æ¨¡æ¿"><a href="#2-é¡µé¢ç»„ä»¶æ¨¡æ¿" class="headerlink" title="2.é¡µé¢ç»„ä»¶æ¨¡æ¿"></a>2.é¡µé¢ç»„ä»¶æ¨¡æ¿</h5><p>src/views/core/integral-grade/list.vueï¼Œåœ¨tableç»„ä»¶ä¸­æ·»åŠ <font color="red">åˆ é™¤åˆ—</font></p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;el-table-column label="æ“ä½œ" width="200" align="center"&gt;    &lt;template slot-scope="scope"&gt;        &lt;el-button                   type="danger"                   size="mini"                   icon="el-icon-delete"                   @click="removeById(scope.row.id)"                   &gt;            åˆ é™¤        &lt;/el-button&gt;    &lt;/template&gt;&lt;/el-table-column&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-åˆ é™¤æ•°æ®è„šæœ¬"><a href="#3-åˆ é™¤æ•°æ®è„šæœ¬" class="headerlink" title="3.åˆ é™¤æ•°æ®è„šæœ¬"></a>3.åˆ é™¤æ•°æ®è„šæœ¬</h5><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// æ ¹æ®idåˆ é™¤æ•°æ®</span>    <span class="token function">removeById</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// debugger</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$confirm</span><span class="token punctuation">(</span><span class="token string">'æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤è¯¥è®°å½•, æ˜¯å¦ç»§ç»­?'</span><span class="token punctuation">,</span> <span class="token string">'æç¤º'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>        confirmButtonText<span class="token operator">:</span> <span class="token string">'ç¡®å®š'</span><span class="token punctuation">,</span>        cancelButtonText<span class="token operator">:</span> <span class="token string">'å–æ¶ˆ'</span><span class="token punctuation">,</span>        type<span class="token operator">:</span> <span class="token string">'warning'</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> integralGradeApi<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            message<span class="token operator">:</span> response<span class="token punctuation">.</span>message<span class="token punctuation">,</span>            type<span class="token operator">:</span> <span class="token string">'success'</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catchçš„error'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">===</span> <span class="token string">'cancel'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>              type<span class="token operator">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span>              message<span class="token operator">:</span> <span class="token string">'å·²å–æ¶ˆåˆ é™¤'</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€æ–°å¢æ•°æ®"><a href="#2ã€æ–°å¢æ•°æ®" class="headerlink" title="2ã€æ–°å¢æ•°æ®"></a>2ã€æ–°å¢æ•°æ®</h4><h5 id="1-å®šä¹‰api-1"><a href="#1-å®šä¹‰api-1" class="headerlink" title="1.å®šä¹‰api"></a>1.å®šä¹‰api</h5><p> src/api/core/integral-grade.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">save</span><span class="token punctuation">(</span><span class="token parameter">integralGrade</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token operator">:</span> <span class="token string">'/admin/core/integralGrade/save'</span><span class="token punctuation">,</span>        method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>        data<span class="token operator">:</span> integralGrade    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-å®šä¹‰é¡µé¢data"><a href="#2-å®šä¹‰é¡µé¢data" class="headerlink" title="2.å®šä¹‰é¡µé¢data"></a>2.å®šä¹‰é¡µé¢data</h5><p>src/views/core/integral-grade/form.vueï¼Œå®Œå–„dataå®šä¹‰</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script&gt;export default {  data() {    return {      integralGrade: {}, // åˆå§‹åŒ–æ•°æ®      saveBtnDisabled: false // ä¿å­˜æŒ‰é’®æ˜¯å¦ç¦ç”¨ï¼Œé˜²æ­¢è¡¨å•é‡å¤æäº¤    }  }}&lt;/script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-é¡µé¢ç»„ä»¶æ¨¡æ¿"><a href="#3-é¡µé¢ç»„ä»¶æ¨¡æ¿" class="headerlink" title="3.é¡µé¢ç»„ä»¶æ¨¡æ¿"></a>3.é¡µé¢ç»„ä»¶æ¨¡æ¿</h5><p>src/views/core/integral-grade/form.vueï¼Œå®Œå–„template</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;  &lt;div class="app-container"&gt;    &lt;!-- è¾“å…¥è¡¨å• --&gt;    &lt;el-form label-width="120px"&gt;      &lt;el-form-item label="å€Ÿæ¬¾é¢åº¦"&gt;        &lt;el-input-number v-model="integralGrade.borrowAmount" :min="0" /&gt;      &lt;/el-form-item&gt;      &lt;el-form-item label="ç§¯åˆ†åŒºé—´å¼€å§‹"&gt;        &lt;el-input-number v-model="integralGrade.integralStart" :min="0" /&gt;      &lt;/el-form-item&gt;      &lt;el-form-item label="ç§¯åˆ†åŒºé—´ç»“æŸ"&gt;        &lt;el-input-number v-model="integralGrade.integralEnd" :min="0" /&gt;      &lt;/el-form-item&gt;      &lt;el-form-item&gt;        &lt;el-button :disabled="saveBtnDisabled" type="primary" @click="saveOrUpdate()"&gt;          ä¿å­˜        &lt;/el-button&gt;      &lt;/el-form-item&gt;    &lt;/el-form&gt;  &lt;/div&gt;&lt;/template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4-æ–°å¢æ•°æ®è„šæœ¬"><a href="#4-æ–°å¢æ•°æ®è„šæœ¬" class="headerlink" title="4.æ–°å¢æ•°æ®è„šæœ¬"></a>4.æ–°å¢æ•°æ®è„šæœ¬</h5><p>src/views/core/integral-grade/form.vueï¼Œå¼•å…¥api</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> integralGradeApi <span class="token keyword">from</span> <span class="token string">'@/api/core/integral-grade'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®šä¹‰ä¿å­˜æ–¹æ³•</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">methods<span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token function">saveOrUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// ç¦ç”¨ä¿å­˜æŒ‰é’®</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>saveBtnDisabled <span class="token operator">=</span> <span class="token boolean">true</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">// æ–°å¢æ•°æ®</span>    <span class="token function">saveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// debugger</span>      integralGradeApi<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>integralGrade<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          type<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>          message<span class="token operator">:</span> response<span class="token punctuation">.</span>message        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/core/integral-grade/list'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€å›æ˜¾æ•°æ®"><a href="#3ã€å›æ˜¾æ•°æ®" class="headerlink" title="3ã€å›æ˜¾æ•°æ®"></a>3ã€å›æ˜¾æ•°æ®</h4><h5 id="1-åˆ—è¡¨é¡µç¼–è¾‘æŒ‰é’®"><a href="#1-åˆ—è¡¨é¡µç¼–è¾‘æŒ‰é’®" class="headerlink" title="1.åˆ—è¡¨é¡µç¼–è¾‘æŒ‰é’®"></a>1.åˆ—è¡¨é¡µç¼–è¾‘æŒ‰é’®</h5><p>src/views/core/integral-grade/list.vueï¼Œè¡¨æ ¼â€œæ“ä½œâ€åˆ—ä¸­å¢åŠ â€œä¿®æ”¹â€æŒ‰é’®</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;router-link :to="'/core/integral-grade/edit/' + scope.row.id" style="margin-right:5px;" &gt;&lt;el-button type="primary" size="mini" icon="el-icon-edit"&gt;ä¿®æ”¹&lt;/el-button&gt;&lt;/router-link&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-å®šä¹‰api"><a href="#2-å®šä¹‰api" class="headerlink" title="2.å®šä¹‰api"></a>2.å®šä¹‰api</h5><p>src/api/core/integral-grade.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">getById</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/admin/core/integralGrade/get/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>        method<span class="token operator">:</span> <span class="token string">'get'</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3-è·å–æ•°æ®è„šæœ¬"><a href="#3-è·å–æ•°æ®è„šæœ¬" class="headerlink" title="3.è·å–æ•°æ®è„šæœ¬"></a>3.è·å–æ•°æ®è„šæœ¬</h5><p>src/views/core/integral-grade/form.vueï¼Œmethodsä¸­å®šä¹‰å›æ˜¾æ–¹æ³•</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// æ ¹æ®idæŸ¥è¯¢è®°å½•</span><span class="token function">fetchDataById</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    integralGradeApi<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>integralGrade <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>record    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¡µé¢æ¸²æŸ“æˆåŠŸåè·å–æ•°æ®</p><p>å› ä¸ºå·²åœ¨è·¯ç”±ä¸­å®šä¹‰å¦‚ä¸‹å†…å®¹ï¼š<font color="red">path: â€˜edit/:idâ€™</font>/ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ <font color="red">this.$route.params.id</font> è·å–è·¯ç”±ä¸­çš„id</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//é¡µé¢æ¸²æŸ“æˆåŠŸ</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchDataById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€æ›´æ–°æ•°æ®"><a href="#4ã€æ›´æ–°æ•°æ®" class="headerlink" title="4ã€æ›´æ–°æ•°æ®"></a>4ã€æ›´æ–°æ•°æ®</h4><h5 id="1-å®šä¹‰api-2"><a href="#1-å®šä¹‰api-2" class="headerlink" title="1.å®šä¹‰api"></a>1.å®šä¹‰api</h5><p>src/api/core/integral-grade.js</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">updateById</span><span class="token punctuation">(</span><span class="token parameter">integralGrade</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      url<span class="token operator">:</span> <span class="token string">'/admin/core/integralGrade/update'</span><span class="token punctuation">,</span>      method<span class="token operator">:</span> <span class="token string">'put'</span><span class="token punctuation">,</span>      data<span class="token operator">:</span> integralGrade    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2-æ›´æ–°æ•°æ®è„šæœ¬"><a href="#2-æ›´æ–°æ•°æ®è„šæœ¬" class="headerlink" title="2.æ›´æ–°æ•°æ®è„šæœ¬"></a>2.æ›´æ–°æ•°æ®è„šæœ¬</h5><p>src/views/core/integral-grade/form.vueï¼Œmethodsä¸­å®šä¹‰updateData</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// æ ¹æ®idæ›´æ–°è®°å½•</span><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// æ•°æ®çš„è·å–</span>    integralGradeApi<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>integralGrade<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            type<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>            message<span class="token operator">:</span> response<span class="token punctuation">.</span>message        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/core/integral-grade/list'</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®Œå–„saveOrUpdateæ–¹æ³•</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">saveOrUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// ç¦ç”¨ä¿å­˜æŒ‰é’®</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>saveBtnDisabled <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>integralGrade<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="-2"><a href="#-2" class="headerlink" title=""></a></h5><h2 id="å‚è€ƒåœ°å€-â†“"><a href="#å‚è€ƒåœ°å€-â†“" class="headerlink" title="å‚è€ƒåœ°å€ â†“"></a>å‚è€ƒåœ°å€ â†“</h2><p>1ã€Springboot å¯åŠ¨æ³¨è§£æ‰«æï¼š<a href="https://blog.csdn.net/m0_50932526/article/details/122936434">https://blog.csdn.net/m0_50932526/article/details/122936434</a></p><br><p>2ã€å¼‚å¸¸ï¼šorg.apache.ibatis.binding.BindingException: Invalid bound statement (not fou</p><p>éœ€è¦æŒ‡å®šæ‰«æåŒ…è·¯å¾„ä¸ºå…·ä½“è·¯å¾„ï¼Œä¹‹å‰æ˜¯ <strong>@MapperScan({â€œcom.kk.srbâ€})</strong>,ç°åœ¨æ˜¯**@MapperScan({â€œcom.kk.srb.core.mapperâ€})**</p><p><a href="https://www.freesion.com/article/7476436940/">https://www.freesion.com/article/7476436940/</a></p><br><p>3ã€vueé¡¹ç›® å‡ºç° <code>Failed to compile.</code></p><p>ç¼–è¯‘é”™è¯¯ï¼Œå¯èƒ½æ˜¯æŒ‡å®šçš„è·¯å¾„å’Œæ–‡ä»¶ä¸åŒ¹é…</p><p><img src="https://v1.mykkto.cn/image/blog/2022/project/shangrongbao/202205062355727.png"></p><br><p>4ã€ &lt; æ ‡ç­¾å¼€å¤´å¦‚æœä¸æ˜¯æˆå¯¹å­˜åœ¨ï¼Œéœ€ç”¨  <code>\</code> è½¬ä¹‰ </p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="é¡¹ç›®-é‡‘è" scheme="https://mykkto.github.io/categories/%E9%A1%B9%E7%9B%AE-%E9%87%91%E8%9E%8D/"/>
    
    
    <category term="nginx" scheme="https://mykkto.github.io/tags/nginx/"/>
    
    <category term="springboot" scheme="https://mykkto.github.io/tags/springboot/"/>
    
    <category term="vue" scheme="https://mykkto.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>JVM-01-å­—èŠ‚ç </title>
    <link href="https://mykkto.github.io/posts/6ae84987.html"/>
    <id>https://mykkto.github.io/posts/6ae84987.html</id>
    <published>2022-04-16T13:00:12.000Z</published>
    <updated>2022-11-12T15:07:08.023Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä¸€ã€JVMæ¦‚è¿°"><a href="#ä¸€ã€JVMæ¦‚è¿°" class="headerlink" title="ä¸€ã€JVMæ¦‚è¿°"></a>ä¸€ã€JVMæ¦‚è¿°</h2><h3 id="1ã€Javaçš„ç”Ÿæ€"><a href="#1ã€Javaçš„ç”Ÿæ€" class="headerlink" title="1ã€Javaçš„ç”Ÿæ€"></a>1ã€Javaçš„ç”Ÿæ€</h3><h4 id="1ã€Oracle-JDKä¸Open-JDK-å…³ç³»"><a href="#1ã€Oracle-JDKä¸Open-JDK-å…³ç³»" class="headerlink" title="1ã€Oracle JDKä¸Open JDK å…³ç³»"></a>1ã€Oracle JDKä¸Open JDK å…³ç³»</h4><h5 id="Oracleä¸OpenJDKä¹‹é—´çš„ä¸»è¦åŒºåˆ«ï¼š"><a href="#Oracleä¸OpenJDKä¹‹é—´çš„ä¸»è¦åŒºåˆ«ï¼š" class="headerlink" title="Oracleä¸OpenJDKä¹‹é—´çš„ä¸»è¦åŒºåˆ«ï¼š"></a>Oracleä¸OpenJDKä¹‹é—´çš„ä¸»è¦åŒºåˆ«ï¼š</h5><ol><li>Oracle JDKç‰ˆæœ¬å°†æ¯ä¸‰å¹´å‘å¸ƒä¸€æ¬¡LTSç‰ˆæœ¬ï¼Œè€ŒOpenJDKç‰ˆæœ¬æ¯ä¸‰ä¸ªæœˆå‘å¸ƒä¸€æ¬¡ã€‚</li><li>Oracle JDKå°†æ›´å¤šåœ°å…³æ³¨ç¨³å®šæ€§ï¼Œå®ƒé‡è§†æ›´å¤šçš„ä¼ä¸šçº§ç”¨æˆ·ï¼Œè€ŒOpenJDKç»å¸¸å‘å¸ƒä»¥æ”¯æŒå…¶ä»–æ€§èƒ½ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸ç¨³å®šã€‚</li><li>Oracle JDKæ”¯æŒé•¿æœŸå‘å¸ƒçš„æ›´æ”¹ï¼Œè€ŒOpen JDKä»…æ”¯æŒè®¡åˆ’å’Œå®Œæˆä¸‹ä¸€ä¸ªå‘è¡Œç‰ˆã€‚</li><li>Oracle JDKæ ¹æ®äºŒè¿›åˆ¶ä»£ç è®¸å¯åè®®è·å¾—è®¸å¯ï¼Œè€ŒOpenJDKæ ¹æ®GPL v2è®¸å¯è·å¾—è®¸å¯ã€‚ ä½¿ç”¨Oracleå¹³å°æ—¶ä¼šäº§ç”Ÿä¸€äº›è®¸å¯å½±å“ã€‚å¦‚Oracle å®£å¸ƒçš„é‚£æ ·ï¼Œåœ¨æ²¡æœ‰å•†ä¸šè®¸å¯çš„æƒ…å†µä¸‹ï¼Œåœ¨2019å¹´1æœˆä¹‹åå‘å¸ƒçš„Oracle Java SE 8çš„å…¬å¼€æ›´æ–°å°†æ— æ³•ç”¨äºå•†ä¸šï¼Œå•†ä¸šæˆ–ç”Ÿäº§ç”¨é€”ã€‚ä½†æ˜¯ï¼ŒOpenJDKæ˜¯å®Œå…¨å¼€æºçš„ï¼Œå¯ä»¥è‡ªç”±ä½¿ç”¨ã€‚</li><li>Oracle JDKçš„æ„å»ºè¿‡ç¨‹åŸºäºOpenJDKï¼Œå› æ­¤OpenJDKä¸Oracle JDKä¹‹é—´æ²¡æœ‰æŠ€æœ¯å·®å¼‚ã€‚</li><li>é¡¶çº§å…¬å¸æ­£åœ¨ä½¿ç”¨Oracle JDKï¼Œä¾‹å¦‚Android Studioï¼ŒMinecraftå’ŒIntelliJ IDEAå¼€å‘å·¥å…·ï¼Œå…¶ä¸­Open JDKä¸å¤ªå—æ¬¢è¿ã€‚</li><li>Oracle JDKå…·æœ‰Flight Recorderï¼ŒJava Mission Controlå’ŒApplication Class-Data SharingåŠŸèƒ½ï¼ŒOpen JDKå…·æœ‰Font RendereråŠŸèƒ½ï¼Œè¿™æ˜¯OpenJDKä¸Oracle JDKä¹‹é—´çš„æ˜¾ç€å·®å¼‚ã€‚</li><li>Oracle JDKå…·æœ‰è‰¯å¥½çš„GCé€‰é¡¹å’Œæ›´å¥½çš„æ¸²æŸ“å™¨ï¼Œè€ŒOpenJDKå…·æœ‰æ›´å°‘çš„GCé€‰é¡¹ï¼Œå¹¶ä¸”ç”±äºå…¶åŒ…å«è‡ªå·±çš„æ¸²æŸ“å™¨çš„åˆ†å¸ƒï¼Œå› æ­¤å…·æœ‰è¾ƒæ…¢çš„å›¾å½¢æ¸²æŸ“å™¨é€‰é¡¹ã€‚</li><li>åœ¨å“åº”æ€§å’ŒJVMæ€§èƒ½æ–¹é¢ï¼ŒOracle JDKä¸OpenJDKç›¸æ¯”æä¾›äº†æ›´å¥½çš„æ€§èƒ½ã€‚</li><li>ä¸OpenJDKç›¸æ¯”ï¼ŒOracle JDKçš„å¼€æºç¤¾åŒºè¾ƒå°‘ï¼ŒOpenJDKç¤¾åŒºç”¨æˆ·çš„è¡¨ç°ä¼˜äºOracle JDKå‘å¸ƒçš„åŠŸèƒ½ï¼Œä»¥æé«˜æ€§èƒ½ã€‚</li><li>å¦‚æœä½¿ç”¨Oracle JDKä¼šäº§ç”Ÿè®¸å¯å½±å“ï¼Œè€ŒOpenJDKæ²¡æœ‰è¿™æ ·çš„é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ä»¥ä»»ä½•æ–¹å¼ä½¿ç”¨ï¼Œä»¥æ»¡è¶³å®Œå…¨å¼€æºå’Œå…è´¹ä½¿ç”¨ã€‚</li><li>Oracle JDKåœ¨è¿è¡ŒJDKæ—¶ä¸ä¼šäº§ç”Ÿä»»ä½•é—®é¢˜ï¼Œè€ŒOpenJDKåœ¨ä¸ºæŸäº›ç”¨æˆ·è¿è¡ŒJDKæ—¶ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ã€‚</li><li>æ ¹æ®ä½¿ç”¨æ–¹çš„ä½¿ç”¨å’Œè®¸å¯åè®®ï¼Œç°æœ‰åº”ç”¨ç¨‹åºå¯ä»¥ä»Oracle JDKè¿ç§»åˆ°Open JDKï¼Œåä¹‹äº¦ç„¶ã€‚</li><li>Oracle JDKå°†ä»å…¶10.0.Xç‰ˆæœ¬å°†æ”¶è´¹ï¼Œç”¨æˆ·å¿…é¡»ä»˜è´¹æˆ–å¿…é¡»ä¾èµ–OpenJDKæ‰èƒ½ä½¿ç”¨å…¶å…è´¹ç‰ˆæœ¬ã€‚</li><li>Oracle JDKä¸ä¼šä¸ºå³å°†å‘å¸ƒçš„ç‰ˆæœ¬æä¾›é•¿æœŸæ”¯æŒï¼Œç”¨æˆ·æ¯æ¬¡éƒ½å¿…é¡»é€šè¿‡æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬è·å¾—æ”¯æŒæ¥è·å–æœ€æ–°ç‰ˆæœ¬ã€‚</li><li>Oracle JDKä»¥å‰çš„1.0ç‰ˆä»¥å‰çš„ç‰ˆæœ¬æ˜¯ç”±Sunå¼€å‘çš„ï¼Œåæ¥è¢«Oracleæ”¶è´­å¹¶ä¸ºå…¶ä»–ç‰ˆæœ¬ç»´æŠ¤ï¼Œè€ŒOpenJDKæœ€åˆåªåŸºäºJava SDKæˆ–JDKç‰ˆæœ¬7ã€‚</li><li>Oracle JDKå‘å¸ƒæ—¶å¤§å¤šæ•°åŠŸèƒ½éƒ½æ˜¯å¼€æºçš„ï¼Œå…¶ä¸­ä¸€äº›åŠŸèƒ½å…äºå¼€æºï¼Œå¹¶ä¸”æ ¹æ®Sunçš„è®¸å¯æˆæƒï¼Œè€ŒOpenJDKå‘å¸ƒäº†æ‰€æœ‰åŠŸèƒ½ï¼Œå¦‚å¼€æºå’Œå…è´¹ã€‚</li><li>Oracle JDKå®Œå…¨ç”±Oracleå…¬å¸å¼€å‘ï¼Œè€ŒOpen JDKé¡¹ç›®ç”±IBMï¼ŒAppleï¼ŒSAP AGï¼ŒRedhatç­‰é¡¶çº§å…¬å¸åŠ å…¥å’Œåˆä½œã€‚</li></ol><h4 id="2ã€JDKä¸JVMæ˜¯ä»€ä¹ˆå…³ç³»"><a href="#2ã€JDKä¸JVMæ˜¯ä»€ä¹ˆå…³ç³»" class="headerlink" title="2ã€JDKä¸JVMæ˜¯ä»€ä¹ˆå…³ç³»"></a>2ã€JDKä¸JVMæ˜¯ä»€ä¹ˆå…³ç³»</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220416210355.png"></p><h5 id="1ã€å¦‚ä½•ç†è§£Javaæ˜¯è·¨å¹³å°çš„è¯­è¨€"><a href="#1ã€å¦‚ä½•ç†è§£Javaæ˜¯è·¨å¹³å°çš„è¯­è¨€" class="headerlink" title="1ã€å¦‚ä½•ç†è§£Javaæ˜¯è·¨å¹³å°çš„è¯­è¨€"></a>1ã€å¦‚ä½•ç†è§£Javaæ˜¯è·¨å¹³å°çš„è¯­è¨€</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220416210431.png"></p><p>å½“Javaæºä»£ç æˆåŠŸç¼–è¯‘æˆå­—èŠ‚ç åï¼Œå¦‚æœæƒ³åœ¨ä¸åŒçš„å¹³å°ä¸Šé¢è¿è¡Œï¼Œåˆ™æ— é¡»å†æ¬¡ç¼–è¯‘<br>è¿™ä¸ªä¼˜åŠ¿ä¸å†é‚£ä¹ˆå¸å¼•äººäº†ã€‚Pythonã€PHPã€Perlã€Rubyã€Lispç­‰æœ‰å¼ºå¤§çš„è§£é‡Šå™¨ã€‚è·¨å¹³å°ä¼¼ä¹å·²ç»å¿«æˆä¸ºä¸€é—¨è¯­è¨€å¿…é€‰çš„ç‰¹æ€§ã€‚</p><h5 id="2ã€å¦‚ä½•ç†è§£JVMè·¨è¯­è¨€çš„å¹³å°"><a href="#2ã€å¦‚ä½•ç†è§£JVMè·¨è¯­è¨€çš„å¹³å°" class="headerlink" title="2ã€å¦‚ä½•ç†è§£JVMè·¨è¯­è¨€çš„å¹³å°"></a>2ã€å¦‚ä½•ç†è§£JVMè·¨è¯­è¨€çš„å¹³å°</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220416210508.png"></p><p>Javaè™šæ‹Ÿæœºæ ¹æœ¬ä¸å…³å¿ƒè¿è¡Œåœ¨å…¶å†…éƒ¨çš„ç¨‹åºåˆ°åº•æ˜¯ä½¿ç”¨ä½•ç§ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ï¼Œ<code>å®ƒåªå…³å¿ƒâ€œå­—èŠ‚ç â€æ–‡ä»¶ã€‚</code></p><p><strong>Javaä¸æ˜¯æœ€å¼ºå¤§çš„è¯­è¨€ï¼Œä½†æ˜¯JVMæ˜¯æœ€å¼ºå¤§çš„è™šæ‹Ÿæœºã€‚</strong></p><h4 id="3ã€Javaå‘å±•çš„å‡ ä¸ªé‡å¤§äº‹ä»¶"><a href="#3ã€Javaå‘å±•çš„å‡ ä¸ªé‡å¤§äº‹ä»¶" class="headerlink" title="3ã€Javaå‘å±•çš„å‡ ä¸ªé‡å¤§äº‹ä»¶"></a>3ã€Javaå‘å±•çš„å‡ ä¸ªé‡å¤§äº‹ä»¶</h4><p>2000å¹´ï¼ŒJDK 1.3å‘å¸ƒï¼Œ<code>Java HotSpot Virtual Machineæ­£å¼å‘å¸ƒï¼Œæˆä¸ºJavaçš„é»˜è®¤è™šæ‹Ÿæœºã€‚</code><br>2002å¹´ï¼ŒJDK 1.4å‘å¸ƒï¼Œå¤è€çš„Classicè™šæ‹Ÿæœºé€€å‡ºå†å²èˆå°ã€‚<br>2003å¹´å¹´åº•ï¼Œ<code>Javaå¹³å°çš„Scalaæ­£å¼å‘å¸ƒï¼ŒåŒå¹´Groovyä¹ŸåŠ å…¥äº† Javaé˜µè¥ã€‚</code><br>2006å¹´ï¼ŒJDK 6å‘å¸ƒã€‚åŒå¹´ï¼Œ<code>Javaå¼€æºå¹¶å»ºç«‹äº† OpenJDK</code>ã€‚é¡ºç†æˆç« ï¼Œ<code>Hotspotè™šæ‹Ÿæœºä¹Ÿæˆä¸ºäº† OpenJDKä¸­çš„é»˜è®¤è™šæ‹Ÿæœºã€‚</code><br>2007å¹´ï¼Œ<code>Javaå¹³å°è¿æ¥äº†æ–°ä¼™ä¼´Clojureã€‚</code><br>2008 å¹´ï¼ŒOracle æ”¶è´­äº† BEA,å¾—åˆ°äº† <code>JRockit è™šæ‹Ÿæœº</code>ã€‚<br>2009å¹´ï¼ŒTwitterå®£å¸ƒæŠŠåå°å¤§éƒ¨åˆ†ç¨‹åºä»Rubyè¿ç§»åˆ°Scalaï¼Œè¿™æ˜¯Javaå¹³å°çš„åˆä¸€æ¬¡å¤§è§„æ¨¡åº”ç”¨ã€‚<br>2010å¹´ï¼ŒOracleæ”¶è´­äº†Sunï¼Œ<code>è·å¾—Javaå•†æ ‡å’Œæœ€å…·ä»·å€¼çš„HotSpotè™šæ‹Ÿæœº</code>ã€‚æ­¤æ—¶ï¼ŒOracleæ‹¥æœ‰å¸‚åœºå ç”¨ç‡æœ€é«˜çš„ä¸¤æ¬¾è™šæ‹ŸæœºHotSpotå’ŒJRockitï¼Œå¹¶è®¡åˆ’åœ¨æœªæ¥å¯¹å®ƒä»¬è¿›è¡Œæ•´åˆï¼šHotRockit.  JCPç»„ç»‡ç®¡ç†ï¼šJavaè¯­è¨€<br>2011å¹´ï¼ŒJDK7å‘å¸ƒã€‚åœ¨JDK 1.7u4ä¸­ï¼Œ<code>æ­£å¼å¯ç”¨äº†æ–°çš„åƒåœ¾å›æ”¶å™¨G1</code>ã€‚<br>2017å¹´ï¼ŒJDK9å‘å¸ƒã€‚<code>å°†G1è®¾ç½®ä¸ºé»˜è®¤GCï¼Œæ›¿ä»£CMS (è¢«æ ‡è®°ä¸ºDeprecated)</code><br>åŒå¹´ï¼Œ<code>IBMçš„J9å¼€æº</code>ï¼Œå½¢æˆäº†ç°åœ¨çš„Open J9ç¤¾åŒº<br>2018å¹´ï¼ŒAndroidçš„Javaä¾µæƒæ¡ˆåˆ¤å†³ï¼ŒGoogleèµ”å¿Oracleè®¡88äº¿ç¾å…ƒ<br>åŒå¹´ï¼ŒJDK11å‘å¸ƒï¼ŒLTSç‰ˆæœ¬çš„JDK<code>,å‘å¸ƒé©å‘½æ€§çš„ZGC,è°ƒæ•´JDKæˆæƒè®¸å¯</code><br>2019å¹´ï¼ŒJDK12å‘å¸ƒï¼ŒåŠ å…¥RedHaté¢†å¯¼å¼€å‘çš„<code>Shenandoah GC</code></p><h3 id="2ã€JVMçš„æ¶æ„"><a href="#2ã€JVMçš„æ¶æ„" class="headerlink" title="2ã€JVMçš„æ¶æ„"></a>2ã€JVMçš„æ¶æ„</h3><h4 id="1ã€JVMæ¶æ„å›¾"><a href="#1ã€JVMæ¶æ„å›¾" class="headerlink" title="1ã€JVMæ¶æ„å›¾"></a>1ã€JVMæ¶æ„å›¾</h4><h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417095344.png"></h3><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417095602.png"></p><p><strong>è¿™ä¸ªæ¶æ„å¯ä»¥åˆ†æˆä¸‰å±‚çœ‹ï¼š</strong></p><p>æœ€ä¸Šå±‚ï¼šjavacç¼–è¯‘å™¨å°†ç¼–è¯‘å¥½çš„å­—èŠ‚ç classæ–‡ä»¶ï¼Œé€šè¿‡java ç±»è£…è½½å™¨æ‰§è¡Œæœºåˆ¶ï¼ŒæŠŠå¯¹è±¡æˆ–classæ–‡ä»¶å­˜æ”¾åœ¨ jvmåˆ’åˆ†å†…å­˜åŒºåŸŸã€‚<br>ä¸­é—´å±‚ï¼šç§°ä¸ºRuntime Data Areaï¼Œä¸»è¦æ˜¯åœ¨Javaä»£ç è¿è¡Œæ—¶ç”¨äºå­˜æ”¾æ•°æ®çš„ï¼Œä»å·¦è‡³å³ä¸ºæ–¹æ³•åŒº(æ°¸ä¹…ä»£ã€å…ƒæ•°æ®åŒº)ã€å †(å…±äº«,GCå›æ”¶å¯¹è±¡åŒºåŸŸ)ã€æ ˆã€ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨ã€æœ¬åœ°æ–¹æ³•æ ˆ(ç§æœ‰)ã€‚<br>æœ€ä¸‹å±‚ï¼šè§£é‡Šå™¨ã€JIT(just in time)ç¼–è¯‘å™¨å’Œ GCï¼ˆGarbage Collectionï¼Œåƒåœ¾å›æ”¶å™¨ï¼‰</p><h4 id="2ã€JVMè„‰ç»œ"><a href="#2ã€JVMè„‰ç»œ" class="headerlink" title="2ã€JVMè„‰ç»œ"></a>2ã€JVMè„‰ç»œ</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417095808.png"></p><h2 id="äºŒã€å­—èŠ‚ç æ–‡ä»¶æ¦‚è¿°"><a href="#äºŒã€å­—èŠ‚ç æ–‡ä»¶æ¦‚è¿°" class="headerlink" title="äºŒã€å­—èŠ‚ç æ–‡ä»¶æ¦‚è¿°"></a>äºŒã€å­—èŠ‚ç æ–‡ä»¶æ¦‚è¿°</h2><h3 id="1ã€å­—èŠ‚ç æ–‡ä»¶è·¨å¹³å°"><a href="#1ã€å­—èŠ‚ç æ–‡ä»¶è·¨å¹³å°" class="headerlink" title="1ã€å­—èŠ‚ç æ–‡ä»¶è·¨å¹³å°"></a>1ã€å­—èŠ‚ç æ–‡ä»¶è·¨å¹³å°</h3><p><strong>Classæ–‡ä»¶ç»“æ„ä¸ä»…ä»…æ˜¯Javaè™šæ‹Ÿæœºçš„æ‰§è¡Œå…¥å£ï¼Œæ›´æ˜¯Javaç”Ÿæ€åœˆçš„åŸºç¡€å’Œæ ¸å¿ƒã€‚</strong></p><h4 id="1ã€classæ–‡ä»¶é‡Œæ˜¯ä»€ä¹ˆ"><a href="#1ã€classæ–‡ä»¶é‡Œæ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€classæ–‡ä»¶é‡Œæ˜¯ä»€ä¹ˆ"></a>1ã€classæ–‡ä»¶é‡Œæ˜¯ä»€ä¹ˆ</h4><p><strong>å­—èŠ‚ç æ–‡ä»¶é‡Œæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>æºä»£ç ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘ä¹‹åä¾¿ä¼šç”Ÿæˆä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶ï¼Œå­—èŠ‚ç æ˜¯ä¸€ç§äºŒè¿›åˆ¶çš„ç±»æ–‡ä»¶ï¼Œå®ƒçš„å†…å®¹æ˜¯JVMçš„æŒ‡ä»¤ï¼Œè€Œä¸åƒCã€C++ç»ç”±ç¼–è¯‘å™¨ç›´æ¥ç”Ÿæˆæœºå™¨ç ã€‚</p><p>éšç€Javaå¹³å°çš„ä¸æ–­å‘å±•ï¼Œåœ¨å°†æ¥ï¼ŒClassæ–‡ä»¶çš„å†…å®¹ä¹Ÿä¸€å®šä¼šåšè¿›ä¸€æ­¥çš„æ‰©å……ï¼Œä½†æ˜¯å…¶åŸºæœ¬çš„æ ¼å¼å’Œç»“æ„ä¸ä¼šåšé‡å¤§è°ƒæ•´ã€‚</p><h4 id="2ã€â˜†-classæ–‡ä»¶çš„ç¼–è¯‘å™¨"><a href="#2ã€â˜†-classæ–‡ä»¶çš„ç¼–è¯‘å™¨" class="headerlink" title="2ã€â˜† classæ–‡ä»¶çš„ç¼–è¯‘å™¨"></a>2ã€â˜† classæ–‡ä»¶çš„ç¼–è¯‘å™¨</h4><h5 id="1ã€ä»ä½ç½®ä¸Šç†è§£"><a href="#1ã€ä»ä½ç½®ä¸Šç†è§£" class="headerlink" title="1ã€ä»ä½ç½®ä¸Šç†è§£"></a>1ã€ä»ä½ç½®ä¸Šç†è§£</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417101023.png"></p><h5 id="2ã€å‰ç«¯ç¼–è¯‘å™¨çš„ç§ç±»"><a href="#2ã€å‰ç«¯ç¼–è¯‘å™¨çš„ç§ç±»" class="headerlink" title="2ã€å‰ç«¯ç¼–è¯‘å™¨çš„ç§ç±»"></a>2ã€å‰ç«¯ç¼–è¯‘å™¨çš„ç§ç±»</h5><p>Javaæºä»£ç çš„ç¼–è¯‘ç»“æœæ˜¯å­—èŠ‚ç ï¼Œé‚£ä¹ˆè‚¯å®šéœ€è¦æœ‰ä¸€ç§ç¼–è¯‘å™¨èƒ½å¤Ÿå°†Javaæºç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œæ‰¿æ‹…è¿™ä¸ªé‡è¦è´£ä»»çš„å°±æ˜¯é…ç½®åœ¨pathç¯å¢ƒå˜é‡ä¸­çš„<code>javacç¼–è¯‘å™¨</code>ã€‚javacæ˜¯ä¸€ç§èƒ½å¤Ÿå°†Javaæºç ç¼–è¯‘ä¸ºå­—èŠ‚ç çš„<code>å‰ç«¯ç¼–è¯‘å™¨</code>ã€‚</p><p>HotSpot VMå¹¶æ²¡æœ‰å¼ºåˆ¶è¦æ±‚å‰ç«¯ç¼–è¯‘å™¨åªèƒ½ä½¿ç”¨javacæ¥ç¼–è¯‘å­—èŠ‚ç ï¼Œå…¶å®åªè¦ç¼–è¯‘ç»“æœç¬¦åˆJVMè§„èŒƒéƒ½å¯ä»¥è¢«JVMæ‰€è¯†åˆ«å³å¯ã€‚<br>åœ¨Javaçš„å‰ç«¯ç¼–è¯‘å™¨é¢†åŸŸï¼Œé™¤äº†javacä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§è¢«å¤§å®¶ç»å¸¸ç”¨åˆ°çš„å‰ç«¯ç¼–è¯‘å™¨ï¼Œé‚£å°±æ˜¯å†…ç½®åœ¨Eclipseä¸­çš„<code>ECJ (Eclipse Compiler for Java)</code>ç¼–è¯‘å™¨ã€‚å’ŒJavacçš„å…¨é‡å¼ç¼–è¯‘ä¸åŒï¼ŒECJæ˜¯ä¸€ç§å¢é‡å¼ç¼–è¯‘å™¨ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒIntelliJ IDEA ä½¿ç”¨ javac ç¼–è¯‘å™¨ã€‚(è¿˜å¯ä»¥è‡ªå·±è®¾ç½®ä¸ºAspectJç¼–è¯‘å™¨ ajc)</p><h5 id="3ã€å‰ç«¯ç¼–è¯‘å™¨çš„ä»»åŠ¡"><a href="#3ã€å‰ç«¯ç¼–è¯‘å™¨çš„ä»»åŠ¡" class="headerlink" title="3ã€å‰ç«¯ç¼–è¯‘å™¨çš„ä»»åŠ¡"></a>3ã€å‰ç«¯ç¼–è¯‘å™¨çš„ä»»åŠ¡</h5><p>å‰ç«¯ç¼–è¯‘å™¨çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯è´Ÿè´£å°†ç¬¦åˆJavaè¯­æ³•è§„èŒƒçš„<code>Javaä»£ç </code>è½¬æ¢ä¸ºç¬¦åˆJVMè§„èŒƒçš„<code>å­—èŠ‚ç æ–‡ä»¶</code>ã€‚</p><h4 id="3ã€å‰ç«¯ç¼–è¯‘å™¨çš„å±€é™æ€§"><a href="#3ã€å‰ç«¯ç¼–è¯‘å™¨çš„å±€é™æ€§" class="headerlink" title="3ã€å‰ç«¯ç¼–è¯‘å™¨çš„å±€é™æ€§"></a>3ã€å‰ç«¯ç¼–è¯‘å™¨çš„å±€é™æ€§</h4><p>å‰ç«¯ç¼–è¯‘å™¨å¹¶ä¸ä¼šç›´æ¥æ¶‰åŠç¼–è¯‘ä¼˜åŒ–ç­‰æ–¹é¢çš„æŠ€æœ¯ï¼Œè€Œæ˜¯å°†è¿™äº›å…·ä½“ä¼˜åŒ–ç»†èŠ‚ç§»äº¤ç»™HotSpotçš„JITç¼–è¯‘å™¨è´Ÿè´£ã€‚</p><p>å¤ä¹ ï¼šAOT(é™æ€æå‰ç¼–è¯‘å™¨ï¼ŒAhead Of Time Compiler)</p><p>jdk9å¼•å…¥äº†AOTç¼–è¯‘å™¨(é™æ€æå‰ç¼–è¯‘å™¨ï¼ŒAhead Of Time Compiler)</p><p>Java 9 å¼•å…¥äº†å®éªŒæ€§ AOT ç¼–è¯‘å·¥å…·jaotcã€‚å®ƒå€ŸåŠ©äº† Graal ç¼–è¯‘å™¨ï¼Œå°†æ‰€è¾“å…¥çš„ Java ç±»æ–‡ä»¶è½¬æ¢ä¸ºæœºå™¨ç ï¼Œå¹¶å­˜æ”¾è‡³ç”Ÿæˆçš„åŠ¨æ€å…±äº«åº“ä¹‹ä¸­ã€‚</p><p>æ‰€è°“ AOT ç¼–è¯‘ï¼Œæ˜¯ä¸å³æ—¶ç¼–è¯‘ç›¸å¯¹ç«‹çš„ä¸€ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå³æ—¶ç¼–è¯‘æŒ‡çš„æ˜¯åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†å­—èŠ‚ç è½¬æ¢ä¸ºå¯åœ¨ç¡¬ä»¶ä¸Šç›´æ¥è¿è¡Œçš„æœºå™¨ç ï¼Œå¹¶éƒ¨ç½²è‡³æ‰˜ç®¡ç¯å¢ƒä¸­çš„è¿‡ç¨‹ã€‚è€Œ AOT ç¼–è¯‘æŒ‡çš„åˆ™æ˜¯ï¼Œåœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œä¾¿å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç çš„è¿‡ç¨‹ã€‚<br>.java -&gt; .class -&gt; .so</p><p>æœ€å¤§å¥½å¤„ï¼šJavaè™šæ‹ŸæœºåŠ è½½å·²ç»é¢„ç¼–è¯‘æˆäºŒè¿›åˆ¶åº“ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œã€‚ä¸å¿…ç­‰å¾…å³æ—¶ç¼–è¯‘å™¨çš„é¢„çƒ­ï¼Œå‡å°‘Javaåº”ç”¨ç»™äººå¸¦æ¥â€œç¬¬ä¸€æ¬¡è¿è¡Œæ…¢â€çš„ä¸è‰¯ä½“éªŒã€‚</p><p>ç¼ºç‚¹ï¼š<br>ç ´åäº†javaâ€œä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œâ€ï¼Œå¿…é¡»ä¸ºæ¯ä¸ªä¸åŒç¡¬ä»¶ã€OSç¼–è¯‘å¯¹åº”çš„å‘è¡ŒåŒ…ã€‚<br>é™ä½äº†Javaé“¾æ¥è¿‡ç¨‹çš„åŠ¨æ€æ€§ï¼ŒåŠ è½½çš„ä»£ç åœ¨ç¼–è¯‘æœŸå°±å¿…é¡»å…¨éƒ¨å·²çŸ¥ã€‚</p><p>è¿˜éœ€è¦ç»§ç»­ä¼˜åŒ–ä¸­ï¼Œæœ€åˆåªæ”¯æŒLinux x64 java base</p><h3 id="2ã€Classå¯¹è±¡å¯¹åº”ç±»å‹"><a href="#2ã€Classå¯¹è±¡å¯¹åº”ç±»å‹" class="headerlink" title="2ã€Classå¯¹è±¡å¯¹åº”ç±»å‹"></a>2ã€Classå¯¹è±¡å¯¹åº”ç±»å‹</h3><blockquote><p>ï¼ˆ1ï¼‰classï¼š<br>å¤–éƒ¨ç±»ï¼Œæˆå‘˜(æˆå‘˜å†…éƒ¨ç±»ï¼Œé™æ€å†…éƒ¨ç±»)ï¼Œå±€éƒ¨å†…éƒ¨ç±»ï¼ŒåŒ¿åå†…éƒ¨ç±»<br>ï¼ˆ2ï¼‰interfaceï¼šæ¥å£<br>ï¼ˆ3ï¼‰[]ï¼šæ•°ç»„<br>ï¼ˆ4ï¼‰enumï¼šæšä¸¾<br>ï¼ˆ5ï¼‰annotationï¼šæ³¨è§£@interface<br>ï¼ˆ6ï¼‰primitive typeï¼šåŸºæœ¬æ•°æ®ç±»å‹<br>ï¼ˆ7ï¼‰void</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token class-name">Class</span> c1 <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span> c2 <span class="token operator">=</span> <span class="token class-name">Comparable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span> c3 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span> c4 <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span> c5 <span class="token operator">=</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span> c6 <span class="token operator">=</span> <span class="token class-name">Override</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span> c7 <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span> c8 <span class="token operator">=</span> <span class="token keyword">void</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span> c9 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>     <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span> c10 <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span> c11 <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åªè¦å…ƒç´ ç±»å‹ä¸ç»´åº¦ä¸€æ ·ï¼Œå°±æ˜¯åŒä¸€ä¸ªClass</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c10 <span class="token operator">==</span> c11<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€å­—èŠ‚ç æŒ‡ä»¤"><a href="#3ã€å­—èŠ‚ç æŒ‡ä»¤" class="headerlink" title="3ã€å­—èŠ‚ç æŒ‡ä»¤"></a>3ã€å­—èŠ‚ç æŒ‡ä»¤</h3><h4 id="1ã€ä»€ä¹ˆæ˜¯å­—èŠ‚ç æŒ‡ä»¤"><a href="#1ã€ä»€ä¹ˆæ˜¯å­—èŠ‚ç æŒ‡ä»¤" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯å­—èŠ‚ç æŒ‡ä»¤"></a>1ã€ä»€ä¹ˆæ˜¯å­—èŠ‚ç æŒ‡ä»¤</h4><p>Javaè™šæ‹Ÿæœºçš„æŒ‡ä»¤ç”±ä¸€ä¸ªå­—èŠ‚é•¿åº¦çš„ã€ä»£è¡¨ç€æŸç§ç‰¹å®šæ“ä½œå«ä¹‰çš„<code>æ“ä½œç ï¼ˆopcodeï¼‰</code>ä»¥åŠè·Ÿéšå…¶åçš„é›¶è‡³å¤šä¸ªä»£è¡¨æ­¤æ“ä½œæ‰€éœ€å‚æ•°çš„<code>æ“ä½œæ•°ï¼ˆoperandï¼‰</code>æ‰€æ„æˆã€‚è™šæ‹Ÿæœºä¸­è®¸å¤šæŒ‡ä»¤å¹¶ä¸åŒ…å«æ“ä½œæ•°ï¼Œåªæœ‰ä¸€ä¸ªæ“ä½œç ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417101919.png"></p><h4 id="2ã€â˜†-é¢è¯•é¢˜"><a href="#2ã€â˜†-é¢è¯•é¢˜" class="headerlink" title="2ã€â˜† é¢è¯•é¢˜"></a>2ã€â˜† é¢è¯•é¢˜</h4><p><strong>i++å’Œ++iæœ‰ä»€ä¹ˆåŒºåˆ«</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ByteCodeInterview</span> <span class="token punctuation">{</span>    <span class="token comment">//é¢è¯•é¢˜ï¼š i++å’Œ++iæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        i<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token comment">//++i;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        i <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>        i <span class="token operator">*=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        k <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token punctuation">(</span>k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">//åŒ…è£…ç±»å¯¹è±¡çš„ç¼“å­˜é—®é¢˜</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//        Integer x = 5;</span><span class="token comment">//        int y = 5;</span>        <span class="token class-name">Integer</span> i1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> i2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1 <span class="token operator">==</span> i2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> i3 <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>        <span class="token class-name">Integer</span> i4 <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i3 <span class="token operator">==</span> i4<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Boolean</span> b1 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token class-name">Boolean</span> b2 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b1 <span class="token operator">==</span> b2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">"helloworld"</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str <span class="token operator">==</span> str1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417102212.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        x <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Father.x = "</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Father</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        x <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Son.x = "</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SonTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Father</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4ã€å¦‚ä½•è§£è¯»classæ–‡ä»¶"><a href="#4ã€å¦‚ä½•è§£è¯»classæ–‡ä»¶" class="headerlink" title="4ã€å¦‚ä½•è§£è¯»classæ–‡ä»¶"></a>4ã€å¦‚ä½•è§£è¯»classæ–‡ä»¶</h3><p>æ–¹å¼ä¸€ï¼šä¸€ä¸ªä¸€ä¸ªäºŒè¿›åˆ¶çš„çœ‹ã€‚è¿™é‡Œç”¨åˆ°çš„æ˜¯Notepad++,éœ€è¦å®‰è£…ä¸€ä¸ªHEX-Editoræ’ä»¶ï¼Œæˆ–è€…ä½¿ç”¨Binary Viewer</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417102826.png"></p><p>æ–¹å¼äºŒï¼šä½¿ç”¨javapæŒ‡ä»¤ï¼šjdkè‡ªå¸¦çš„åè§£æå·¥å…·<br>æ–¹å¼ä¸‰ï¼šä½¿ç”¨IDEAæ’ä»¶ï¼šjclasslib æˆ–jclasslib bytecode viewerå®¢æˆ·ç«¯å·¥å…·ã€‚ï¼ˆå¯è§†åŒ–æ›´å¥½ï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417102924.png"></p><h2 id="ä¸‰ã€Classæ–‡ä»¶ç»“æ„ç»†èŠ‚"><a href="#ä¸‰ã€Classæ–‡ä»¶ç»“æ„ç»†èŠ‚" class="headerlink" title="ä¸‰ã€Classæ–‡ä»¶ç»“æ„ç»†èŠ‚"></a>ä¸‰ã€Classæ–‡ä»¶ç»“æ„ç»†èŠ‚</h2><h3 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h3><h4 id="1ã€classæ–‡ä»¶ç»“æ„æ¦‚è¿°"><a href="#1ã€classæ–‡ä»¶ç»“æ„æ¦‚è¿°" class="headerlink" title="1ã€classæ–‡ä»¶ç»“æ„æ¦‚è¿°"></a>1ã€classæ–‡ä»¶ç»“æ„æ¦‚è¿°</h4><p>Classæ–‡ä»¶çš„ç»“æ„å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œéšç€Javaè™šæ‹Ÿæœºçš„ä¸æ–­å‘å±•ï¼Œæ€»æ˜¯ä¸å¯é¿å…åœ°ä¼šå¯¹Classæ–‡ä»¶ç»“æ„åšå‡ºä¸€äº›è°ƒæ•´ï¼Œä½†æ˜¯å…¶åŸºæœ¬ç»“æ„å’Œæ¡†æ¶æ˜¯éå¸¸ç¨³å®šçš„ã€‚<br>Classæ–‡ä»¶çš„æ€»ä½“ç»“æ„å¦‚ä¸‹ï¼š</p><ul><li>é­”æ•°</li><li>Classæ–‡ä»¶ç‰ˆæœ¬</li><li>å¸¸é‡æ± </li><li>è®¿é—®æ ‡è¯†(æˆ–æ ‡å¿—)</li><li>ç±»ç´¢å¼•ï¼Œçˆ¶ç±»ç´¢å¼•ï¼Œæ¥å£ç´¢å¼•é›†åˆ</li><li>å­—æ®µè¡¨é›†åˆ</li><li>æ–¹æ³•è¡¨é›†åˆ</li><li>å±æ€§è¡¨é›†åˆ</li></ul><h4 id="2ã€ç»“æ„å›¾è¡¨"><a href="#2ã€ç»“æ„å›¾è¡¨" class="headerlink" title="2ã€ç»“æ„å›¾è¡¨"></a>2ã€ç»“æ„å›¾è¡¨</h4><p> è¿™æ˜¯ä¸€å¼ Javaå­—èŠ‚ç æ€»çš„ç»“æ„è¡¨ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸Šé¢çš„é¡ºåºé€ä¸€è¿›è¡Œè§£è¯»å°±å¯ä»¥äº†ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417103240.png"></p><h3 id="2ã€é­”æ•°"><a href="#2ã€é­”æ•°" class="headerlink" title="2ã€é­”æ•°"></a>2ã€é­”æ•°</h3><p><strong>Magic Numberï¼ˆé­”æ•°ï¼‰ï¼šclassæ–‡ä»¶çš„æ ‡å¿—</strong></p><ul><li><p>æ¯ä¸ª Class æ–‡ä»¶å¼€å¤´çš„4ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•´æ•°ç§°ä¸ºé­”æ•°ï¼ˆMagic Numberï¼‰</p></li><li><p>å®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥å—çš„æœ‰æ•ˆåˆæ³•çš„Classæ–‡ä»¶ã€‚å³ï¼šé­”æ•°æ˜¯Classæ–‡ä»¶çš„æ ‡è¯†ç¬¦ã€‚</p></li><li><p>é­”æ•°å€¼å›ºå®šä¸º0xCAFEBABEã€‚ä¸ä¼šæ”¹å˜ã€‚</p></li><li><p>å¦‚æœä¸€ä¸ªClassæ–‡ä»¶ä¸ä»¥0xCAFEBABEå¼€å¤´ï¼Œè™šæ‹Ÿæœºåœ¨è¿›è¡Œæ–‡ä»¶æ ¡éªŒçš„æ—¶å€™å°±ä¼šç›´æ¥æŠ›å‡ºä»¥ä¸‹é”™è¯¯ï¼š</p><blockquote><p>Error: A JNI error has occurred, please check your installation and try again<br>Exception in thread â€œmainâ€ java.lang.ClassFormatError: Incompatible magic value 1885430635 in class file StringTest</p></blockquote></li><li><p>ä½¿ç”¨é­”æ•°è€Œä¸æ˜¯æ‰©å±•åæ¥è¿›è¡Œè¯†åˆ«ä¸»è¦æ˜¯åŸºäºå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼Œå› ä¸ºæ–‡ä»¶æ‰©å±•åå¯ä»¥éšæ„åœ°æ”¹åŠ¨ã€‚</p></li></ul><h3 id="3ã€é«˜ç‰ˆæœ¬æ‰§è¡Œä½ç‰ˆæœ¬Class"><a href="#3ã€é«˜ç‰ˆæœ¬æ‰§è¡Œä½ç‰ˆæœ¬Class" class="headerlink" title="3ã€é«˜ç‰ˆæœ¬æ‰§è¡Œä½ç‰ˆæœ¬Class"></a>3ã€é«˜ç‰ˆæœ¬æ‰§è¡Œä½ç‰ˆæœ¬Class</h3><p><strong>ä¸åŒç‰ˆæœ¬çš„Javaç¼–è¯‘å™¨ç¼–è¯‘çš„Classæ–‡ä»¶å¯¹åº”çš„ç‰ˆæœ¬æ˜¯ä¸ä¸€æ ·çš„ã€‚ç›®å‰ï¼Œé«˜ç‰ˆæœ¬çš„Javaè™šæ‹Ÿæœºå¯ä»¥æ‰§è¡Œç”±ä½ç‰ˆæœ¬ç¼–è¯‘å™¨ç”Ÿæˆçš„Classæ–‡ä»¶,ä½†æ˜¯ä½ç‰ˆæœ¬çš„Javaè™šæ‹Ÿæœºä¸èƒ½æ‰§è¡Œç”±é«˜ç‰ˆæœ¬ç¼–è¯‘å™¨ç”Ÿæˆçš„Classæ–‡ä»¶ã€‚å¦åˆ™JVMä¼šæŠ›å‡ºjava.lang.UnsupportedClassVersionErrorå¼‚å¸¸ã€‚ ï¼ˆå‘ä¸‹å…¼å®¹ï¼‰</strong></p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”±äºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ä¸åŒï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯¥é—®é¢˜çš„å‘ç”Ÿã€‚å› æ­¤ï¼Œéœ€è¦æˆ‘ä»¬åœ¨å¼€å‘æ—¶ï¼Œç‰¹åˆ«æ³¨æ„å¼€å‘ç¼–è¯‘çš„JDKç‰ˆæœ¬å’Œç”Ÿäº§ç¯å¢ƒä¸­çš„JDKç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ã€‚</p><h4 id="classæ–‡ä»¶ç‰ˆæœ¬å·"><a href="#classæ–‡ä»¶ç‰ˆæœ¬å·" class="headerlink" title="classæ–‡ä»¶ç‰ˆæœ¬å·"></a>classæ–‡ä»¶ç‰ˆæœ¬å·</h4><ul><li>ç´§æ¥ç€é­”æ•°çš„ 4 ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯ Class æ–‡ä»¶çš„ç‰ˆæœ¬å·ã€‚åŒæ ·ä¹Ÿæ˜¯4ä¸ªå­—èŠ‚ã€‚ç¬¬5ä¸ªå’Œç¬¬6ä¸ªå­—èŠ‚æ‰€ä»£è¡¨çš„å«ä¹‰å°±æ˜¯ç¼–è¯‘çš„å‰¯ç‰ˆæœ¬å·minor_versionï¼Œè€Œç¬¬7ä¸ªå’Œç¬¬8ä¸ªå­—èŠ‚å°±æ˜¯ç¼–è¯‘çš„ä¸»ç‰ˆæœ¬å·major_versionã€‚</li><li>å®ƒä»¬å…±åŒæ„æˆäº†classæ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬å·ã€‚è­¬å¦‚æŸä¸ª Class æ–‡ä»¶çš„ä¸»ç‰ˆæœ¬å·ä¸º Mï¼Œå‰¯ç‰ˆæœ¬å·ä¸º mï¼Œé‚£ä¹ˆè¿™ä¸ªClass æ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬å·å°±ç¡®å®šä¸º M.mã€‚</li><li>ç‰ˆæœ¬å·å’ŒJavaç¼–è¯‘å™¨çš„å¯¹åº”å…³ç³»å¦‚ä¸‹è¡¨ï¼š</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417162510.png"></p><ul><li><p>Java çš„ç‰ˆæœ¬å·æ˜¯ä»45å¼€å§‹çš„ï¼ŒJDK 1.1ä¹‹åçš„æ¯ä¸ªJDKå¤§ç‰ˆæœ¬å‘å¸ƒä¸»ç‰ˆæœ¬å·å‘ä¸ŠåŠ 1ã€‚</p></li><li><p>è™šæ‹ŸæœºJDKç‰ˆæœ¬ä¸º1.k ï¼ˆk &gt;= 2ï¼‰æ—¶ï¼Œå¯¹åº”çš„classæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬å·çš„èŒƒå›´ä¸º45.0 - 44+k.0 ï¼ˆå«ä¸¤ç«¯ï¼‰ã€‚</p></li></ul><h3 id="4ã€â˜†-å¸¸é‡æ± "><a href="#4ã€â˜†-å¸¸é‡æ± " class="headerlink" title="4ã€â˜† å¸¸é‡æ± "></a>4ã€â˜† å¸¸é‡æ± </h3><p><strong>å¸¸é‡æ± ï¼šclassæ–‡ä»¶çš„åŸºçŸ³ï¼Ÿä½œç”¨æ˜¯ï¼Ÿ</strong></p><h4 id="1ã€ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± è®¡æ•°å™¨"><a href="#1ã€ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± è®¡æ•°å™¨" class="headerlink" title="1ã€ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± è®¡æ•°å™¨"></a>1ã€ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± è®¡æ•°å™¨</h4><p><strong>constant_pool_count ï¼ˆå¸¸é‡æ± è®¡æ•°å™¨ï¼‰</strong></p><ul><li><p>ç”±äºå¸¸é‡æ± çš„æ•°é‡ä¸å›ºå®šï¼Œæ—¶é•¿æ—¶çŸ­ï¼Œæ‰€ä»¥éœ€è¦æ”¾ç½®ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ã€‚</p></li><li><p>å¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ï¼ˆu2ç±»å‹ï¼‰ï¼šä»1å¼€å§‹ï¼Œè¡¨ç¤ºå¸¸é‡æ± ä¸­æœ‰å¤šå°‘é¡¹å¸¸é‡ã€‚å³constant_pool_count=1è¡¨ç¤ºå¸¸é‡æ± ä¸­æœ‰0ä¸ªå¸¸é‡é¡¹ã€‚</p></li><li><p>Demoçš„å€¼ä¸ºï¼š</p><ul><li><p>å…¶å€¼ä¸º0x0016,ææŒ‡ä¸€ç®—ï¼Œä¹Ÿå°±æ˜¯22ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å®é™…ä¸Šåªæœ‰21é¡¹å¸¸é‡ã€‚ç´¢å¼•ä¸ºèŒƒå›´æ˜¯1-21ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br>é€šå¸¸æˆ‘ä»¬å†™ä»£ç æ—¶éƒ½æ˜¯ä»0å¼€å§‹çš„ï¼Œä½†æ˜¯è¿™é‡Œçš„å¸¸é‡æ± å´æ˜¯ä»1å¼€å§‹ï¼Œå› ä¸ºå®ƒæŠŠç¬¬0é¡¹å¸¸é‡ç©ºå‡ºæ¥äº†ã€‚è¿™æ˜¯ä¸ºäº†æ»¡è¶³åé¢æŸäº›æŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•å€¼çš„æ•°æ®åœ¨ç‰¹å®šæƒ…å†µä¸‹éœ€è¦è¡¨è¾¾â€œä¸å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡æ± é¡¹ç›®â€çš„å«ä¹‰ï¼Œè¿™ç§æƒ…å†µå¯ç”¨ç´¢å¼•å€¼0æ¥è¡¨ç¤ºã€‚</p></li><li><pre><code class="java">int[] arr = new int[10];arr[0];arr[1];ar[10 - 1];<pre class="line-numbers language-none"><code class="language-none">    #### 2ã€å¸¸é‡æ± è¡¨**constant_pool []ï¼ˆå¸¸é‡æ± ï¼‰**- constant_poolæ˜¯ä¸€ç§è¡¨ç»“æ„ï¼Œä»¥ 1 ~ constant_pool_count - 1ä¸ºç´¢å¼•ã€‚è¡¨æ˜äº†åé¢æœ‰å¤šå°‘ä¸ªå¸¸é‡é¡¹ã€‚- å¸¸é‡æ± ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼š`å­—é¢é‡ï¼ˆLiteralï¼‰`å’Œ`ç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰`- å®ƒåŒ…å«äº†classæ–‡ä»¶ç»“æ„åŠå…¶å­ç»“æ„ä¸­å¼•ç”¨çš„æ‰€æœ‰å­—ç¬¦ä¸²å¸¸é‡ã€ç±»æˆ–æ¥å£åã€å­—æ®µåå’Œå…¶ä»–å¸¸é‡ã€‚å¸¸é‡æ± ä¸­çš„æ¯ä¸€é¡¹éƒ½å…·å¤‡ç›¸åŒçš„ç‰¹å¾ã€‚ç¬¬1ä¸ªå­—èŠ‚ä½œä¸ºç±»å‹æ ‡è®°ï¼Œç”¨äºç¡®å®šè¯¥é¡¹çš„æ ¼å¼ï¼Œè¿™ä¸ªå­—èŠ‚ç§°ä¸ºtag byte ï¼ˆæ ‡è®°å­—èŠ‚ã€æ ‡ç­¾å­—èŠ‚ï¼‰ã€‚![](https://v1.mykkto.cn/image/blog/2022/jvm/20220417163310.png)##### 1ã€å­—é¢é‡å’Œç¬¦å·å¼•ç”¨1ã€å­—é¢é‡å’Œç¬¦å·å¼•ç”¨åœ¨å¯¹è¿™äº›å¸¸é‡è§£è¯»å‰ï¼Œæˆ‘ä»¬éœ€è¦ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µã€‚å¸¸é‡æ± ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰ã€‚å¦‚ä¸‹è¡¨ï¼š![](https://v1.mykkto.cn/image/blog/2022/jvm/20220417164111.png)```javaString str = "mykk";final int NUM = 10;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></code></pre></li></ul></li></ul><p>2ã€å…¨é™å®šå<br>com/kk/test/Demoè¿™ä¸ªå°±æ˜¯ç±»çš„å…¨é™å®šåï¼Œä»…ä»…æ˜¯æŠŠåŒ…åçš„â€.â€æ›¿æ¢æˆâ€/â€œï¼Œä¸ºäº†ä½¿è¿ç»­çš„å¤šä¸ªå…¨é™å®šåä¹‹é—´ä¸äº§ç”Ÿæ··æ·†ï¼Œåœ¨ä½¿ç”¨æ—¶æœ€åä¸€èˆ¬ä¼šåŠ å…¥ä¸€ä¸ªâ€œ;â€è¡¨ç¤ºå…¨é™å®šåç»“æŸã€‚</p><p>3ã€ç®€å•åç§°<br>ç®€å•åç§°æ˜¯æŒ‡æ²¡æœ‰ç±»å‹å’Œå‚æ•°ä¿®é¥°çš„æ–¹æ³•æˆ–è€…å­—æ®µåç§°ï¼Œä¸Šé¢ä¾‹å­ä¸­çš„ç±»çš„add()æ–¹æ³•å’Œnumå­—æ®µçš„ç®€å•åç§°åˆ†åˆ«æ˜¯addå’Œnumã€‚</p><p>4ã€æè¿°ç¬¦<br><code>æè¿°ç¬¦çš„ä½œç”¨æ˜¯ç”¨æ¥æè¿°å­—æ®µçš„æ•°æ®ç±»å‹ã€æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼ˆåŒ…æ‹¬æ•°é‡ã€ç±»å‹ä»¥åŠé¡ºåºï¼‰å’Œè¿”å›å€¼ã€‚</code>æ ¹æ®æè¿°ç¬¦è§„åˆ™ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbyteã€charã€doubleã€floatã€intã€longã€shortã€booleanï¼‰ä»¥åŠä»£è¡¨æ— è¿”å›å€¼çš„voidç±»å‹éƒ½ç”¨ä¸€ä¸ªå¤§å†™å­—ç¬¦æ¥è¡¨ç¤ºï¼Œè€Œå¯¹è±¡ç±»å‹åˆ™ç”¨å­—ç¬¦LåŠ å¯¹è±¡çš„å…¨é™å®šåæ¥è¡¨ç¤ºï¼Œè¯¦è§ä¸‹è¡¨:   ï¼ˆæ•°æ®ç±»å‹ï¼šåŸºæœ¬æ•°æ®ç±»å‹ ã€ å¼•ç”¨æ•°æ®ç±»å‹ï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417164344.png"></p><p>ç”¨æè¿°ç¬¦æ¥æè¿°æ–¹æ³•æ—¶ï¼ŒæŒ‰ç…§å…ˆå‚æ•°åˆ—è¡¨ï¼Œåè¿”å›å€¼çš„é¡ºåºæè¿°ï¼Œå‚æ•°åˆ—è¡¨æŒ‰ç…§å‚æ•°çš„ä¸¥æ ¼é¡ºåºæ”¾åœ¨ä¸€ç»„å°æ‹¬å·â€œ()â€ä¹‹å†…ã€‚å¦‚ï¼š<br>æ–¹æ³•java.lang.String toString()çš„æè¿°ç¬¦ä¸º() Ljava/lang/String;ï¼Œ<br>æ–¹æ³•int abc(int[] x, int y)çš„æè¿°ç¬¦ä¸º([II) Iã€‚</p><h5 id="2ã€è°ˆè°ˆä½ å¯¹ç¬¦å·å¼•ç”¨ã€ç›´æ¥å¼•ç”¨çš„ç†è§£ï¼Ÿ"><a href="#2ã€è°ˆè°ˆä½ å¯¹ç¬¦å·å¼•ç”¨ã€ç›´æ¥å¼•ç”¨çš„ç†è§£ï¼Ÿ" class="headerlink" title="2ã€è°ˆè°ˆä½ å¯¹ç¬¦å·å¼•ç”¨ã€ç›´æ¥å¼•ç”¨çš„ç†è§£ï¼Ÿ"></a>2ã€è°ˆè°ˆä½ å¯¹ç¬¦å·å¼•ç”¨ã€ç›´æ¥å¼•ç”¨çš„ç†è§£ï¼Ÿ</h5><p>è¿™é‡Œè¯´æ˜ä¸‹ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„åŒºåˆ«ä¸å…³è”ï¼š<br>ç¬¦å·å¼•ç”¨ï¼šç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šå·²ç»åŠ è½½åˆ°äº†å†…å­˜ä¸­ã€‚<br>ç›´æ¥å¼•ç”¨ï¼šç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨æ˜¯ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›¸å…³çš„ï¼ŒåŒä¸€ä¸ªç¬¦å·å¼•ç”¨åœ¨ä¸åŒè™šæ‹Ÿæœºå®ä¾‹ä¸Šç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¸€èˆ¬ä¸ä¼šç›¸åŒã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£è¯´æ˜å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»å­˜åœ¨äºå†…å­˜ä¹‹ä¸­äº†ã€‚</p><h5 id="3ã€å¸¸é‡ç±»å‹å’Œç»“æ„"><a href="#3ã€å¸¸é‡ç±»å‹å’Œç»“æ„" class="headerlink" title="3ã€å¸¸é‡ç±»å‹å’Œç»“æ„"></a>3ã€å¸¸é‡ç±»å‹å’Œç»“æ„</h5><p>å¸¸é‡æ± ä¸­æ¯ä¸€é¡¹å¸¸é‡éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼ŒJDK1.7ä¹‹åå…±æœ‰14ç§ä¸åŒçš„è¡¨ç»“æ„æ•°æ®ã€‚å¦‚ä¸‹è¡¨æ ¼æ‰€ç¤ºï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417165020.png"></p><p>è¿™14ç§è¡¨ï¼ˆæˆ–è€…å¸¸é‡é¡¹ç»“æ„ï¼‰çš„å…±åŒç‚¹æ˜¯ï¼šè¡¨å¼€å§‹çš„ç¬¬ä¸€ä½æ˜¯ä¸€ä¸ªu1ç±»å‹çš„æ ‡å¿—ä½ï¼ˆtagï¼‰ï¼Œä»£è¡¨å½“å‰è¿™ä¸ªå¸¸é‡é¡¹ä½¿ç”¨çš„æ˜¯å“ªç§è¡¨ç»“æ„ï¼Œå³å“ªç§å¸¸é‡ç±»å‹ã€‚</p><p>åœ¨å¸¸é‡æ± åˆ—è¡¨ä¸­ï¼ŒCONSTANT_Utf8_infoå¸¸é‡é¡¹æ˜¯ä¸€ç§ä½¿ç”¨æ”¹è¿›è¿‡çš„UTF-8ç¼–ç æ ¼å¼æ¥å­˜å‚¨è¯¸å¦‚æ–‡å­—å­—ç¬¦ä¸²ã€ç±»æˆ–è€…æ¥å£çš„å…¨é™å®šåã€å­—æ®µæˆ–è€…æ–¹æ³•çš„ç®€å•åç§°ä»¥åŠæè¿°ç¬¦ç­‰å¸¸é‡å­—ç¬¦ä¸²ä¿¡æ¯ã€‚</p><p>è¿™14ç§å¸¸é‡é¡¹ç»“æ„è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œå…¶ä¸­13ä¸ªå¸¸é‡é¡¹å ç”¨çš„å­—èŠ‚å›ºå®šï¼Œåªæœ‰CONSTANT_Utf8_infoå ç”¨å­—èŠ‚ä¸å›ºå®šï¼Œå…¶å¤§å°ç”±lengthå†³å®šã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä»å¸¸é‡æ± å­˜æ”¾çš„å†…å®¹å¯çŸ¥ï¼Œå…¶å­˜æ”¾çš„æ˜¯å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œæœ€ç»ˆè¿™äº›å†…å®¹éƒ½ä¼šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²çš„å¤§å°æ˜¯åœ¨ç¼–å†™ç¨‹åºæ—¶æ‰ç¡®å®šï¼Œæ¯”å¦‚ä½ å®šä¹‰ä¸€ä¸ªç±»ï¼Œç±»åå¯ä»¥å–é•¿å–çŸ­ï¼Œæ‰€ä»¥åœ¨æ²¡ç¼–è¯‘å‰ï¼Œå¤§å°ä¸å›ºå®šï¼Œç¼–è¯‘åï¼Œé€šè¿‡utf-8ç¼–ç ï¼Œå°±å¯ä»¥çŸ¥é“å…¶é•¿åº¦ã€‚</p><h4 id="3ã€è®¿é—®æ ‡è¯†"><a href="#3ã€è®¿é—®æ ‡è¯†" class="headerlink" title="3ã€è®¿é—®æ ‡è¯†"></a>3ã€è®¿é—®æ ‡è¯†</h4><p><strong>è®¿é—®æ ‡è¯†(access_flagã€è®¿é—®æ ‡å¿—ã€è®¿é—®æ ‡è®°)</strong></p><ul><li><p>åœ¨å¸¸é‡æ± åï¼Œç´§è·Ÿç€è®¿é—®æ ‡è®°ã€‚è¯¥æ ‡è®°ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè¿™ä¸ª Class æ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼›æ˜¯å¦å®šä¹‰ä¸º public ç±»å‹ï¼›æ˜¯å¦å®šä¹‰ä¸º abstract ç±»å‹ï¼›å¦‚æœæ˜¯ç±»çš„è¯ï¼Œæ˜¯å¦è¢«å£°æ˜ä¸º final ç­‰ã€‚å„ç§è®¿é—®æ ‡è®°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417165620.png"></p></li><li><p>ç±»çš„è®¿é—®æƒé™é€šå¸¸ä¸º ACC_ å¼€å¤´çš„å¸¸é‡ã€‚</p></li><li><p>æ¯ä¸€ç§ç±»å‹çš„è¡¨ç¤ºéƒ½æ˜¯é€šè¿‡è®¾ç½®è®¿é—®æ ‡è®°çš„32ä½ä¸­çš„ç‰¹å®šä½æ¥å®ç°çš„ã€‚æ¯”å¦‚ï¼Œè‹¥æ˜¯public finalçš„ç±»ï¼Œåˆ™è¯¥æ ‡è®°ä¸ºACC_PUBLIC | ACC_FINALã€‚</p></li><li><p>ä½¿ç”¨ACC_SUPERå¯ä»¥è®©ç±»æ›´å‡†ç¡®åœ°å®šä½åˆ°çˆ¶ç±»çš„æ–¹æ³•super.method(),ç°ä»£ç¼–è¯‘å™¨éƒ½ä¼šè®¾ç½®å¹¶ä¸”ä½¿ç”¨è¿™ä¸ªæ ‡è®°ã€‚</p></li></ul><h4 id="4ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆ"><a href="#4ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆ" class="headerlink" title="4ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆ"></a>4ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆ</h4><ul><li><p>åœ¨è®¿é—®æ ‡è®°åï¼Œä¼šæŒ‡å®šè¯¥ç±»çš„ç±»åˆ«ã€çˆ¶ç±»ç±»åˆ«ä»¥åŠå®ç°çš„æ¥å£ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417165738.png"></p></li><li><p>è¿™ä¸‰é¡¹æ•°æ®æ¥ç¡®å®šè¿™ä¸ªç±»çš„ç»§æ‰¿å…³ç³»ã€‚</p><ul><li>ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šå</li><li>çˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚ç”±äº Javaè¯­è¨€ä¸å…è®¸å¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº†java.lang.Object ä¹‹å¤–ï¼Œæ‰€æœ‰çš„Javaç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº†java.lang.Object å¤–ï¼Œæ‰€æœ‰Javaç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º 0ã€‚</li><li>æ¥å£ç´¢å¼•é›†åˆå°±ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†å“ªäº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰ implements è¯­å¥ï¼ˆå¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåˆ™åº”å½“æ˜¯ extends è¯­å¥ï¼‰åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚</li></ul></li><li><p>this_classï¼ˆç±»ç´¢å¼•ï¼‰</p><ul><li>å­—èŠ‚æ— ç¬¦å·æ•´æ•°ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ã€‚å®ƒæä¾›äº†ç±»çš„å…¨é™å®šå,å¦‚com/kk/java1/Demoã€‚this_classçš„å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± è¡¨ä¸­æŸé¡¹çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚å¸¸é‡æ± åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„æˆå‘˜å¿…é¡»ä¸ºCONSTANT_Class_infoç±»å‹ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“è¡¨ç¤ºè¿™ä¸ªclassæ–‡ä»¶æ‰€å®šä¹‰çš„ç±»æˆ–æ¥å£ã€‚</li></ul></li><li><p>super_class ï¼ˆçˆ¶ç±»ç´¢å¼•ï¼‰</p><ul><li>2å­—èŠ‚æ— ç¬¦å·æ•´æ•°ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•ã€‚å®ƒæä¾›äº†å½“å‰ç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰ç»§æ‰¿ä»»ä½•ç±»ï¼Œå…¶é»˜è®¤ç»§æ‰¿çš„æ˜¯java/lang/Objectç±»ã€‚åŒæ—¶ï¼Œç”±äºJavaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œæ‰€ä»¥å…¶çˆ¶ç±»åªæœ‰ä¸€ä¸ªã€‚</li><li>superclassæŒ‡å‘çš„çˆ¶ç±»ä¸èƒ½æ˜¯finalã€‚</li></ul></li><li><p>interfaces</p><ul><li>æŒ‡å‘å¸¸é‡æ± ç´¢å¼•é›†åˆï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç¬¦å·å¼•ç”¨åˆ°æ‰€æœ‰å·²å®ç°çš„æ¥å£</li><li>ç”±äºä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œå› æ­¤éœ€è¦ä»¥æ•°ç»„å½¢å¼ä¿å­˜å¤šä¸ªæ¥å£çš„ç´¢å¼•ï¼Œè¡¨ç¤ºæ¥å£çš„æ¯ä¸ªç´¢å¼•ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± çš„CONSTANT_Class (å½“ç„¶è¿™é‡Œå°±å¿…é¡»æ˜¯æ¥å£ï¼Œè€Œä¸æ˜¯ç±»)ã€‚</li><li>interfaces_count (æ¥å£è®¡æ•°å™¨)<ul><li>interfaces_counté¡¹çš„å€¼è¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£çš„ç›´æ¥è¶…æ¥å£æ•°é‡ã€‚</li></ul></li><li>interfaces [](æ¥å£ç´¢å¼•é›†åˆ)<ul><li>interfaces []ä¸­æ¯ä¸ªæˆå‘˜çš„å€¼å¿…é¡»æ˜¯å¯¹å¸¸é‡æ± è¡¨ä¸­æŸé¡¹çš„æœ‰æ•ˆç´¢å¼•å€¼ï¼Œå®ƒçš„é•¿åº¦ä¸º interfaces_countã€‚ æ¯ä¸ªæˆå‘˜ interfaces[i]å¿…é¡»ä¸º CONSTANT_Class_infoç»“æ„ï¼Œå…¶ä¸­ 0 &lt;= i &lt; interfaces_countã€‚åœ¨ interfaces[]ä¸­ï¼Œå„æˆå‘˜æ‰€è¡¨ç¤ºçš„æ¥å£é¡ºåºå’Œå¯¹åº”çš„æºä»£ç ä¸­ç»™å®šçš„æ¥å£é¡ºåºï¼ˆä»å·¦è‡³å³ï¼‰ä¸€æ ·ï¼Œå³<code> interfaces[0]å¯¹åº”çš„æ˜¯æºä»£ç ä¸­æœ€å·¦è¾¹çš„æ¥å£ã€‚</code></li></ul></li></ul></li></ul><h4 id="5ã€å­—æ®µè¡¨é›†åˆ"><a href="#5ã€å­—æ®µè¡¨é›†åˆ" class="headerlink" title="5ã€å­—æ®µè¡¨é›†åˆ"></a>5ã€å­—æ®µè¡¨é›†åˆ</h4><h5 id="1ã€å­—æ®µè®¡æ•°å™¨"><a href="#1ã€å­—æ®µè®¡æ•°å™¨" class="headerlink" title="1ã€å­—æ®µè®¡æ•°å™¨"></a>1ã€å­—æ®µè®¡æ•°å™¨</h5><ul><li>fields_countçš„å€¼è¡¨ç¤ºå½“å‰classæ–‡ä»¶fieldsè¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚</li><li>fieldsè¡¨ä¸­æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªfield_infoç»“æ„ï¼Œç”¨äºè¡¨ç¤ºè¯¥ç±»æˆ–æ¥å£æ‰€å£°æ˜çš„æ‰€æœ‰ç±»å­—æ®µæˆ–è€…å®ä¾‹å­—æ®µï¼Œä¸åŒ…æ‹¬æ–¹æ³•å†…éƒ¨å£°æ˜çš„å˜é‡ï¼Œä¹Ÿä¸åŒ…æ‹¬ä»çˆ¶ç±»æˆ–çˆ¶æ¥å£ç»§æ‰¿çš„é‚£äº›å­—æ®µ</li></ul><h5 id="2ã€å­—æ®µè¡¨ï¼Œfields"><a href="#2ã€å­—æ®µè¡¨ï¼Œfields" class="headerlink" title="2ã€å­—æ®µè¡¨ï¼Œfields []"></a>2ã€å­—æ®µè¡¨ï¼Œfields []</h5><ul><li><p>fieldsè¡¨ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªfields_infoç»“æ„çš„æ•°æ®é¡¹ï¼Œç”¨äºè¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£ä¸­æŸä¸ªå­—æ®µçš„å®Œæ•´æè¿°ã€‚</p></li><li><p>ä¸€ä¸ªå­—æ®µçš„ä¿¡æ¯åŒ…æ‹¬å¦‚ä¸‹è¿™äº›ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯ä¸­ï¼Œ<code>å„ä¸ªä¿®é¥°ç¬¦éƒ½æ˜¯å¸ƒå°”å€¼ï¼Œè¦ä¹ˆæœ‰ï¼Œè¦ä¹ˆæ²¡æœ‰</code>ã€‚</p><ul><li>ä½œç”¨åŸŸï¼ˆpublicã€privateã€protectedä¿®é¥°ç¬¦ï¼‰</li><li>æ˜¯å®ä¾‹å˜é‡è¿˜æ˜¯ç±»å˜é‡ï¼ˆstaticä¿®é¥°ç¬¦ï¼‰</li><li>å¯å˜æ€§ï¼ˆfinalï¼‰</li><li>å¹¶å‘å¯è§æ€§ï¼ˆvolatileä¿®é¥°ç¬¦ï¼Œæ˜¯å¦å¼ºåˆ¶ä»ä¸»å†…å­˜è¯»å†™ï¼‰</li><li>å¯å¦åºåˆ—åŒ–ï¼ˆtransientä¿®é¥°ç¬¦ï¼‰</li><li>å­—æ®µæ•°æ®ç±»å‹ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡ã€æ•°ç»„ï¼‰</li><li>å­—æ®µåç§°</li></ul></li><li><p>å­—æ®µè¡¨ç»“æ„</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417171658.png"></p></li></ul><h4 id="6ã€æ–¹æ³•è¡¨é›†åˆ"><a href="#6ã€æ–¹æ³•è¡¨é›†åˆ" class="headerlink" title="6ã€æ–¹æ³•è¡¨é›†åˆ"></a>6ã€æ–¹æ³•è¡¨é›†åˆ</h4><h5 id="1ã€æ–¹æ³•è®¡æ•°å™¨"><a href="#1ã€æ–¹æ³•è®¡æ•°å™¨" class="headerlink" title="1ã€æ–¹æ³•è®¡æ•°å™¨"></a>1ã€æ–¹æ³•è®¡æ•°å™¨</h5><ul><li>methods_countçš„å€¼è¡¨ç¤ºå½“å‰classæ–‡ä»¶methodsè¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºã€‚</li><li>methods è¡¨ä¸­æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªmethod_infoç»“æ„ã€‚</li></ul><h5 id="2ã€æ–¹æ³•è¡¨"><a href="#2ã€æ–¹æ³•è¡¨" class="headerlink" title="2ã€æ–¹æ³•è¡¨"></a>2ã€æ–¹æ³•è¡¨</h5><ul><li><p>methodsè¡¨ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªmethod_infoç»“æ„ï¼Œç”¨äºè¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£ä¸­æŸä¸ªæ–¹æ³•çš„å®Œæ•´æè¿°ã€‚å¦‚æœæŸä¸ªmethod_infoç»“æ„çš„access_flagsé¡¹æ—¢æ²¡æœ‰è®¾ç½® ACC_NATIVE æ ‡å¿—ä¹Ÿæ²¡æœ‰è®¾ç½®ACC_ABSTRACTæ ‡å¿—ï¼Œé‚£ä¹ˆè¯¥ç»“æ„ä¸­ä¹Ÿåº”åŒ…å«å®ç°è¿™ä¸ªæ–¹æ³•æ‰€ç”¨çš„Javaè™šæ‹ŸæœºæŒ‡ä»¤ã€‚</p></li><li><p>method_infoç»“æ„å¯ä»¥è¡¨ç¤ºç±»å’Œæ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬å®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•å’Œç±»æˆ–æ¥å£åˆå§‹åŒ–æ–¹æ³•</p></li><li><p>æ–¹æ³•è¡¨çš„ç»“æ„å®é™…è·Ÿå­—æ®µè¡¨æ˜¯ä¸€æ ·çš„ï¼Œæ–¹æ³•è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417211001.png"></p></li></ul><h4 id="7ã€å±æ€§è¡¨é›†åˆ"><a href="#7ã€å±æ€§è¡¨é›†åˆ" class="headerlink" title="7ã€å±æ€§è¡¨é›†åˆ"></a>7ã€å±æ€§è¡¨é›†åˆ</h4><h5 id="1ã€å±æ€§è®¡æ•°å™¨"><a href="#1ã€å±æ€§è®¡æ•°å™¨" class="headerlink" title="1ã€å±æ€§è®¡æ•°å™¨"></a>1ã€å±æ€§è®¡æ•°å™¨</h5><p>attributes_countçš„å€¼è¡¨ç¤ºå½“å‰classæ–‡ä»¶å±æ€§è¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚å±æ€§è¡¨ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªattribute_infoç»“æ„ã€‚</p><h5 id="2ã€å±æ€§è¡¨"><a href="#2ã€å±æ€§è¡¨" class="headerlink" title="2ã€å±æ€§è¡¨"></a>2ã€å±æ€§è¡¨</h5><ul><li><p>ConstantValue å±æ€§</p><ul><li><p>ConstantValue å±æ€§è¡¨ç¤ºä¸€ä¸ªå¸¸é‡å­—æ®µçš„å€¼ã€‚ä½äº field_infoç»“æ„çš„å±æ€§è¡¨ä¸­ã€‚</p></li><li><pre><code class="java">ConstantValue_attribute {    u2 attribute_name_index;    u4 attribute_length;    u2 constantvalue_index;//å­—æ®µå€¼åœ¨å¸¸é‡æ± ä¸­çš„ç´¢å¼•ï¼Œå¸¸é‡æ± åœ¨è¯¥ç´¢å¼•å¤„çš„é¡¹ç»™å‡ºè¯¥å±æ€§è¡¨ç¤ºçš„å¸¸é‡å€¼ã€‚ï¼ˆä¾‹å¦‚ï¼Œå€¼æ˜¯longå‹çš„ï¼Œåœ¨å¸¸é‡æ± ä¸­ä¾¿æ˜¯CONSTANT_Longï¼‰}<pre class="line-numbers language-none"><code class="language-none">- Deprecated å±æ€§  - Deprecated å±æ€§æ˜¯åœ¨ JDK 1.1 ä¸ºäº†æ”¯æŒæ³¨é‡Šä¸­çš„å…³é”®è¯@deprecated è€Œå¼•å…¥çš„ã€‚    ```java    Deprecated_attribute {        u2 attribute_name_index;         u4 attribute_length;    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></code></pre></li></ul></li><li><p>Code å±æ€§</p><ul><li><p>Codeå±æ€§å°±æ˜¯å­˜æ”¾æ–¹æ³•ä½“é‡Œé¢çš„ä»£ç ã€‚ä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰æ–¹æ³•è¡¨éƒ½æœ‰Codeå±æ€§ã€‚åƒæ¥å£æˆ–è€…æŠ½è±¡æ–¹æ³•ï¼Œä»–ä»¬æ²¡æœ‰å…·ä½“çš„æ–¹æ³•ä½“ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šæœ‰Codeå±æ€§äº†ã€‚<br>Codeå±æ€§è¡¨çš„ç»“æ„,å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417213251.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼šCodeå±æ€§è¡¨çš„å‰ä¸¤é¡¹è·Ÿå±æ€§è¡¨æ˜¯ä¸€è‡´çš„ï¼Œå³Codeå±æ€§è¡¨éµå¾ªå±æ€§è¡¨çš„ç»“æ„ï¼Œåé¢é‚£äº›åˆ™æ˜¯ä»–è‡ªå®šä¹‰çš„ç»“æ„ã€‚</p></li></ul></li><li><p>InnerClasses å±æ€§</p><ul><li>ä¸ºäº†æ–¹ä¾¿è¯´æ˜ç‰¹åˆ«å®šä¹‰ä¸€ä¸ªè¡¨ç¤ºç±»æˆ–æ¥å£çš„ Class æ ¼å¼ä¸º Cã€‚å¦‚æœ C çš„å¸¸é‡æ± ä¸­åŒ…å«æŸä¸ªCONSTANT_Class_info æˆå‘˜ï¼Œä¸”è¿™ä¸ªæˆå‘˜æ‰€è¡¨ç¤ºçš„ç±»æˆ–æ¥å£ä¸å±äºä»»ä½•ä¸€ä¸ªåŒ…ï¼Œé‚£ä¹ˆ C çš„ClassFile ç»“æ„çš„å±æ€§è¡¨ä¸­å°±å¿…é¡»å«æœ‰å¯¹åº”çš„ InnerClasses å±æ€§ã€‚InnerClasses å±æ€§æ˜¯åœ¨ JDK 1.1 ä¸­ä¸ºäº†æ”¯æŒå†…éƒ¨ç±»å’Œå†…éƒ¨æ¥å£è€Œå¼•å…¥çš„,ä½äº ClassFileç»“æ„çš„å±æ€§è¡¨ã€‚</li></ul></li><li><p>LineNumberTable å±æ€§</p><ul><li><p>LineNumberTable å±æ€§æ˜¯å¯é€‰å˜é•¿å±æ€§ï¼Œä½äº Codeç»“æ„çš„å±æ€§è¡¨ã€‚</p></li><li><p>LineNumberTableå±æ€§æ˜¯ç”¨æ¥æè¿°Javaæºç è¡Œå·ä¸å­—èŠ‚ç è¡Œå·ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚è¿™ä¸ªå±æ€§å¯ä»¥ç”¨æ¥åœ¨è°ƒè¯•çš„æ—¶å€™å®šä½ä»£ç æ‰§è¡Œçš„è¡Œæ•°ã€‚</p></li><li><p>start_pc,å³å­—èŠ‚ç è¡Œå·;line_numberï¼Œå³Javaæºä»£ç è¡Œå·ã€‚</p></li><li><p>åœ¨ Code å±æ€§çš„å±æ€§è¡¨ä¸­,LineNumberTable å±æ€§å¯ä»¥æŒ‰ç…§ä»»æ„é¡ºåºå‡ºç°ï¼Œæ­¤å¤–ï¼Œå¤šä¸ª LineNumberTableå±æ€§å¯ä»¥å…±åŒè¡¨ç¤ºä¸€ä¸ªè¡Œå·åœ¨æºæ–‡ä»¶ä¸­è¡¨ç¤ºçš„å†…å®¹ï¼Œå³ LineNumberTable å±æ€§ä¸éœ€è¦ä¸æºæ–‡ä»¶çš„è¡Œä¸€ä¸€å¯¹åº”ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417220235.png"></p></li></ul></li><li><p>LocalVariableTable å±æ€§</p><ul><li><p> LocalVariableTable æ˜¯å¯é€‰å˜é•¿å±æ€§ï¼Œä½äº Codeå±æ€§çš„å±æ€§è¡¨ä¸­ã€‚å®ƒè¢«è°ƒè¯•å™¨ç”¨äºç¡®å®šæ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å±€éƒ¨å˜é‡çš„ä¿¡æ¯ã€‚åœ¨ Code å±æ€§çš„å±æ€§è¡¨ä¸­ï¼ŒLocalVariableTable å±æ€§å¯ä»¥æŒ‰ç…§ä»»æ„é¡ºåºå‡ºç°ã€‚ Code å±æ€§ä¸­çš„æ¯ä¸ªå±€éƒ¨å˜é‡æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ª LocalVariableTable å±æ€§ã€‚</p></li><li><p>start pc + lengthè¡¨ç¤ºè¿™ä¸ªå˜é‡åœ¨å­—èŠ‚ç ä¸­çš„ç”Ÿå‘½å‘¨æœŸèµ·å§‹å’Œç»“æŸçš„åç§»ä½ç½®ï¼ˆthisç”Ÿå‘½å‘¨æœŸä»å¤´0åˆ°ç»“å°¾ï¼‰</p></li><li><p>indexå°±æ˜¯è¿™ä¸ªå˜é‡åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½ï¼ˆæ§½ä½å¯å¤ç”¨ï¼‰</p></li><li><p>nameå°±æ˜¯å˜é‡åç§°</p></li><li><p>Descriptorè¡¨ç¤ºå±€éƒ¨å˜é‡ç±»å‹æè¿°</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417220124.png"></p></li></ul></li><li><p>Signature å±æ€§</p><ul><li>Signature å±æ€§æ˜¯å¯é€‰çš„å®šé•¿å±æ€§ï¼Œä½äº ClassFileï¼Œ field_info<br>æˆ– method_infoç»“æ„çš„å±æ€§è¡¨ä¸­ã€‚åœ¨ Java è¯­è¨€ä¸­ï¼Œä»»ä½•ç±»ã€ æ¥å£ã€ åˆå§‹åŒ–æ–¹æ³•æˆ–æˆå‘˜çš„æ³›å‹ç­¾åå¦‚æœåŒ…å«äº†ç±»å‹å˜é‡ï¼ˆ Type Variablesï¼‰ æˆ–å‚æ•°åŒ–ç±»å‹ï¼ˆ Parameterized Typesï¼‰ï¼Œåˆ™ Signature å±æ€§ä¼šä¸ºå®ƒè®°å½•æ³›å‹ç­¾åä¿¡æ¯ã€‚</li></ul></li><li><p>SourceFileå±æ€§</p><ul><li><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417213613.png"></li></ul></li><li><p>å…¶ä»–å±æ€§</p><ul><li>Javaè™šæ‹Ÿæœºä¸­é¢„å®šä¹‰çš„å±æ€§æœ‰20å¤šä¸ªï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œé€šè¿‡ä¸Šé¢å‡ ä¸ªå±æ€§çš„ä»‹ç»ï¼Œåªè¦é¢†ä¼šå…¶ç²¾é«“ï¼Œå…¶ä»–å±æ€§çš„è§£è¯»ä¹Ÿæ˜¯æ˜“å¦‚åæŒã€‚</li></ul></li></ul><h3 id="5ã€"><a href="#5ã€" class="headerlink" title="5ã€"></a>5ã€</h3><h2 id="å››ã€javap"><a href="#å››ã€javap" class="headerlink" title="å››ã€javap"></a>å››ã€javap</h2><p><strong>oracleå®˜æ–¹çš„åè§£æå·¥å…·ï¼šjavap</strong></p><h3 id="1ã€è§£æå­—èŠ‚ç çš„ä½œç”¨"><a href="#1ã€è§£æå­—èŠ‚ç çš„ä½œç”¨" class="headerlink" title="1ã€è§£æå­—èŠ‚ç çš„ä½œç”¨"></a>1ã€è§£æå­—èŠ‚ç çš„ä½œç”¨</h3><p>é€šè¿‡åç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ·±å…¥çš„äº†è§£javaä»£ç çš„å·¥ä½œæœºåˆ¶ã€‚ä½†æ˜¯ï¼Œè‡ªå·±åˆ†æç±»æ–‡ä»¶ç»“æ„å¤ªéº»çƒ¦äº†ï¼é™¤äº†ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„jclasslibå·¥å…·ä¹‹å¤–ï¼Œoracleå®˜æ–¹ä¹Ÿæä¾›äº†å·¥å…·ï¼šjavapã€‚</p><p>javapæ˜¯jdkè‡ªå¸¦çš„åè§£æå·¥å…·ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯æ ¹æ®classå­—èŠ‚ç æ–‡ä»¶ï¼Œåè§£æå‡ºå½“å‰ç±»å¯¹åº”çš„codeåŒºï¼ˆå­—èŠ‚ç æŒ‡ä»¤ï¼‰ã€å±€éƒ¨å˜é‡è¡¨ã€å¼‚å¸¸è¡¨å’Œä»£ç è¡Œåç§»é‡æ˜ å°„è¡¨ã€å¸¸é‡æ± ç­‰ä¿¡æ¯ã€‚</p><p>é€šè¿‡å±€éƒ¨å˜é‡è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸèŒƒå›´ã€æ‰€åœ¨æ§½ä½ç­‰ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥çœ‹åˆ°æ§½ä½å¤ç”¨ç­‰ä¿¡æ¯ã€‚</p><h3 id="2ã€javac-gæ“ä½œ"><a href="#2ã€javac-gæ“ä½œ" class="headerlink" title="2ã€javac -gæ“ä½œ"></a>2ã€javac -gæ“ä½œ</h3><p>è§£æå­—èŠ‚ç æ–‡ä»¶å¾—åˆ°çš„ä¿¡æ¯ä¸­ï¼Œæœ‰äº›ä¿¡æ¯ï¼ˆå¦‚å±€éƒ¨å˜é‡è¡¨ã€æŒ‡ä»¤å’Œä»£ç è¡Œåç§»é‡æ˜ å°„è¡¨ã€å¸¸é‡æ± ä¸­æ–¹æ³•çš„å‚æ•°åç§°ç­‰ç­‰ï¼‰éœ€è¦åœ¨ä½¿ç”¨javacç¼–è¯‘æˆclassæ–‡ä»¶æ—¶ï¼ŒæŒ‡å®šå‚æ•°æ‰èƒ½è¾“å‡ºã€‚</p><p>æ¯”å¦‚ï¼Œä½ ç›´æ¥javac xx.javaï¼Œå°±ä¸ä¼šåœ¨ç”Ÿæˆå¯¹åº”çš„å±€éƒ¨å˜é‡è¡¨ç­‰ä¿¡æ¯ï¼Œå¦‚æœä½ ä½¿ç”¨<code>javac -g xx.java</code>å°±å¯ä»¥ç”Ÿæˆæ‰€æœ‰ç›¸å…³ä¿¡æ¯äº†ã€‚å¦‚æœä½ ä½¿ç”¨çš„eclipseæˆ–IDEAï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ï¼Œeclipseã€IDEAåœ¨ç¼–è¯‘æ—¶ä¼šå¸®ä½ ç”Ÿæˆå±€éƒ¨å˜é‡è¡¨ã€æŒ‡ä»¤å’Œä»£ç è¡Œåç§»é‡æ˜ å°„è¡¨ç­‰ä¿¡æ¯çš„ã€‚</p><h3 id="3ã€javapçš„ç”¨æ³•"><a href="#3ã€javapçš„ç”¨æ³•" class="headerlink" title="3ã€javapçš„ç”¨æ³•"></a>3ã€javapçš„ç”¨æ³•</h3><p>javapçš„ç”¨æ³•æ ¼å¼ï¼š<br><strong>javap <options> <classes></classes></options></strong></p><p>å…¶ä¸­ï¼Œclasseså°±æ˜¯ä½ è¦åç¼–è¯‘çš„classæ–‡ä»¶ã€‚</p><p>åœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥è¾“å…¥javapæˆ–javap -helpå¯ä»¥çœ‹åˆ°javapçš„optionsæœ‰å¦‚ä¸‹é€‰é¡¹ï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/jvm/20220417224639.png"></p><p> -help  â€“help  -?      è¾“å‡ºæ­¤ç”¨æ³•æ¶ˆæ¯<br> -version               ç‰ˆæœ¬ä¿¡æ¯ï¼Œå…¶å®æ˜¯å½“å‰javapæ‰€åœ¨jdkçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¸æ˜¯classåœ¨å“ªä¸ªjdkä¸‹ç”Ÿæˆçš„ã€‚<br> -public                ä»…æ˜¾ç¤ºå…¬å…±ç±»å’Œæˆå‘˜<br> -protected             æ˜¾ç¤ºå—ä¿æŠ¤çš„/å…¬å…±ç±»å’Œæˆå‘˜<br> -p  -private           æ˜¾ç¤ºæ‰€æœ‰ç±»å’Œæˆå‘˜<br> -package               æ˜¾ç¤ºç¨‹åºåŒ…/å—ä¿æŠ¤çš„/å…¬å…±ç±» å’Œæˆå‘˜ (é»˜è®¤)<br> -sysinfo               æ˜¾ç¤ºæ­£åœ¨å¤„ç†çš„ç±»çš„ç³»ç»Ÿä¿¡æ¯ (è·¯å¾„, å¤§å°, æ—¥æœŸ, MD5 æ•£åˆ—,æºæ–‡ä»¶å)<br> -constants             æ˜¾ç¤ºé™æ€æœ€ç»ˆå¸¸é‡</p><p> -s                     è¾“å‡ºå†…éƒ¨ç±»å‹ç­¾å<br> -l                     è¾“å‡ºè¡Œå·å’Œæœ¬åœ°å˜é‡è¡¨<br> -c                     å¯¹ä»£ç è¿›è¡Œåæ±‡ç¼–<br> -v  -verbose           è¾“å‡ºé™„åŠ ä¿¡æ¯ï¼ˆåŒ…æ‹¬è¡Œå·ã€æœ¬åœ°å˜é‡è¡¨ï¼Œåæ±‡ç¼–ç­‰è¯¦ç»†ä¿¡æ¯ï¼‰</p><p> -classpath <path>      æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½®<br> -cp <path>             æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½®<br> -bootclasspath <path>  è¦†ç›–å¼•å¯¼ç±»æ–‡ä»¶çš„ä½ç½®</path></path></path></p><p><strong>ä¸€èˆ¬å¸¸ç”¨çš„æ˜¯-v -l -cä¸‰ä¸ªé€‰é¡¹ã€‚</strong></p><p>javap -l ä¼šè¾“å‡ºè¡Œå·å’Œæœ¬åœ°å˜é‡è¡¨ä¿¡æ¯ã€‚<br>javap -c ä¼šå¯¹å½“å‰classå­—èŠ‚ç è¿›è¡Œåç¼–è¯‘ç”Ÿæˆæ±‡ç¼–ä»£ç ã€‚<br>javap -v classxx é™¤äº†åŒ…å«-cå†…å®¹å¤–ï¼Œè¿˜ä¼šè¾“å‡ºè¡Œå·ã€å±€éƒ¨å˜é‡è¡¨ä¿¡æ¯ã€å¸¸é‡æ± ç­‰ä¿¡æ¯ã€‚</p><h3 id="4ã€ä½¿ç”¨ä¸¾ä¾‹"><a href="#4ã€ä½¿ç”¨ä¸¾ä¾‹" class="headerlink" title="4ã€ä½¿ç”¨ä¸¾ä¾‹"></a>4ã€ä½¿ç”¨ä¸¾ä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavapTest</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> num<span class="token punctuation">;</span>    <span class="token keyword">boolean</span> flag<span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token keyword">char</span> gender<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> info<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> COUNTS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">static</span><span class="token punctuation">{</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"www.mykkto.com"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token punctuation">{</span>        info <span class="token operator">=</span> <span class="token string">"java"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">JavapTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token class-name">JavapTest</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> flag<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>flag <span class="token operator">=</span> flag<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">methodPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> <span class="token function">getNum</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> num <span class="token operator">+</span> i<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">protected</span> <span class="token keyword">char</span> <span class="token function">showGender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> gender<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¸Œæœ›è¾“å‡ºçš„ä¿¡æ¯æ¯”è¾ƒå®Œæ•´çš„è¯ï¼Œä½¿ç”¨å¦‚ä¸‹æ“ä½œï¼š</p><p><strong>javac JavapTest.java</strong></p><p><strong>javap -v -p JavapTest.class</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">J:<span class="token punctuation">\</span><span class="token number">0</span> å¤§å‚ç´ æ<span class="token punctuation">\</span>jvm<span class="token punctuation">\</span>00Test<span class="token operator">&gt;</span>javac JavapTest.javaJ:<span class="token punctuation">\</span><span class="token number">0</span> å¤§å‚ç´ æ<span class="token punctuation">\</span>jvm<span class="token punctuation">\</span>00Test<span class="token operator">&gt;</span>javap -v -p JavapTest.classClassfile /J:/0 å¤§å‚ç´ æ/jvm/00Test/JavapTest.class  Last modified <span class="token number">2022</span>-4-17<span class="token punctuation">;</span> size <span class="token number">1141</span> bytes  MD5 checksum 16833cad2e0187d03ccf1baecaa23808  Compiled from <span class="token string">"JavapTest.java"</span>public class com.kk.test.JavapTest  minor version: <span class="token number">0</span>  major version: <span class="token number">52</span>  flags: ACC_PUBLIC, ACC_SUPERConstant pool:   <span class="token comment">#1 = Methodref          #16.#42        // java/lang/Object."&lt;init&gt;":()V</span>   <span class="token comment">#2 = String             #43            // java</span>   <span class="token comment">#3 = Fieldref           #15.#44        // com/kk/test/JavapTest.info:Ljava/lang/String;</span>   <span class="token comment">#4 = Fieldref           #15.#45        // com/kk/test/JavapTest.flag:Z</span>   <span class="token comment">#5 = Fieldref           #15.#46        // com/kk/test/JavapTest.num:I</span>   <span class="token comment">#6 = Fieldref           #15.#47        // com/kk/test/JavapTest.gender:C</span>   <span class="token comment">#7 = Fieldref           #48.#49        // java/lang/System.out:Ljava/io/PrintStream;</span>   <span class="token comment">#8 = Class              #50            // java/lang/StringBuilder</span>   <span class="token comment">#9 = Methodref          #8.#42         // java/lang/StringBuilder."&lt;init&gt;":()V</span>  <span class="token comment">#10 = Methodref          #8.#51         // java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>  <span class="token comment">#11 = Methodref          #8.#52         // java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</span>  <span class="token comment">#12 = Methodref          #8.#53         // java/lang/StringBuilder.toString:()Ljava/lang/String;</span>  <span class="token comment">#13 = Methodref          #54.#55        // java/io/PrintStream.println:(Ljava/lang/String;)V</span>  <span class="token comment">#14 = String             #56            // www.mykkto.com</span>  <span class="token comment">#15 = Class              #57            // com/kk/test/JavapTest</span>  <span class="token comment">#16 = Class              #58            // java/lang/Object</span>  <span class="token comment">#17 = Utf8               num</span>  <span class="token comment">#18 = Utf8               I</span>  <span class="token comment">#19 = Utf8               flag</span>  <span class="token comment">#20 = Utf8               Z</span>  <span class="token comment">#21 = Utf8               gender</span>  <span class="token comment">#22 = Utf8               C</span>  <span class="token comment">#23 = Utf8               info</span>  <span class="token comment">#24 = Utf8               Ljava/lang/String;</span>  <span class="token comment">#25 = Utf8               COUNTS</span>  <span class="token comment">#26 = Utf8               ConstantValue</span>  <span class="token comment">#27 = Integer            1</span>  <span class="token comment">#28 = Utf8               &lt;init&gt;</span>  <span class="token comment">#29 = Utf8               ()V</span>  <span class="token comment">#30 = Utf8               Code</span>  <span class="token comment">#31 = Utf8               LineNumberTable</span>  <span class="token comment">#32 = Utf8               (Z)V</span>  <span class="token comment">#33 = Utf8               methodPrivate</span>  <span class="token comment">#34 = Utf8               getNum</span>  <span class="token comment">#35 = Utf8               (I)I</span>  <span class="token comment">#36 = Utf8               showGender</span>  <span class="token comment">#37 = Utf8               ()C</span>  <span class="token comment">#38 = Utf8               showInfo</span>  <span class="token comment">#39 = Utf8               &lt;clinit&gt;</span>  <span class="token comment">#40 = Utf8               SourceFile</span>  <span class="token comment">#41 = Utf8               JavapTest.java</span>  <span class="token comment">#42 = NameAndType        #28:#29        // "&lt;init&gt;":()V</span>  <span class="token comment">#43 = Utf8               java</span>  <span class="token comment">#44 = NameAndType        #23:#24        // info:Ljava/lang/String;</span>  <span class="token comment">#45 = NameAndType        #19:#20        // flag:Z</span>  <span class="token comment">#46 = NameAndType        #17:#18        // num:I</span>  <span class="token comment">#47 = NameAndType        #21:#22        // gender:C</span>  <span class="token comment">#48 = Class              #59            // java/lang/System</span>  <span class="token comment">#49 = NameAndType        #60:#61        // out:Ljava/io/PrintStream;</span>  <span class="token comment">#50 = Utf8               java/lang/StringBuilder</span>  <span class="token comment">#51 = NameAndType        #62:#63        // append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>  <span class="token comment">#52 = NameAndType        #62:#64        // append:(I)Ljava/lang/StringBuilder;</span>  <span class="token comment">#53 = NameAndType        #65:#66        // toString:()Ljava/lang/String;</span>  <span class="token comment">#54 = Class              #67            // java/io/PrintStream</span>  <span class="token comment">#55 = NameAndType        #68:#69        // println:(Ljava/lang/String;)V</span>  <span class="token comment">#56 = Utf8               www.mykkto.com</span>  <span class="token comment">#57 = Utf8               com/kk/test/JavapTest</span>  <span class="token comment">#58 = Utf8               java/lang/Object</span>  <span class="token comment">#59 = Utf8               java/lang/System</span>  <span class="token comment">#60 = Utf8               out</span>  <span class="token comment">#61 = Utf8               Ljava/io/PrintStream;</span>  <span class="token comment">#62 = Utf8               append</span>  <span class="token comment">#63 = Utf8               (Ljava/lang/String;)Ljava/lang/StringBuilder;</span>  <span class="token comment">#64 = Utf8               (I)Ljava/lang/StringBuilder;</span>  <span class="token comment">#65 = Utf8               toString</span>  <span class="token comment">#66 = Utf8               ()Ljava/lang/String;</span>  <span class="token comment">#67 = Utf8               java/io/PrintStream</span>  <span class="token comment">#68 = Utf8               println</span>  <span class="token comment">#69 = Utf8               (Ljava/lang/String;)V</span><span class="token punctuation">{</span>  private int num<span class="token punctuation">;</span>    descriptor: I    flags: ACC_PRIVATE  boolean flag<span class="token punctuation">;</span>    descriptor: Z    flags:  protected char gender<span class="token punctuation">;</span>    descriptor: C    flags: ACC_PROTECTED  public java.lang.String info<span class="token punctuation">;</span>    descriptor: Ljava/lang/String<span class="token punctuation">;</span>    flags: ACC_PUBLIC  public static final int COUNTS<span class="token punctuation">;</span>    descriptor: I    flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL    ConstantValue: int <span class="token number">1</span>  public com.kk.test.JavapTest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    descriptor: <span class="token punctuation">(</span><span class="token punctuation">)</span>V    flags: ACC_PUBLIC    Code:      <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">locals</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">args_size</span><span class="token operator">=</span><span class="token number">1</span>         <span class="token number">0</span>: aload_0         <span class="token number">1</span>: invokespecial <span class="token comment">#1                  // Method java/lang/Object."&lt;init&gt;":()V</span>         <span class="token number">4</span>: aload_0         <span class="token number">5</span>: ldc           <span class="token comment">#2                  // String java</span>         <span class="token number">7</span>: putfield      <span class="token comment">#3                  // Field info:Ljava/lang/String;</span>        <span class="token number">10</span>: <span class="token builtin class-name">return</span>      LineNumberTable:        line <span class="token number">16</span>: <span class="token number">0</span>        line <span class="token number">14</span>: <span class="token number">4</span>        line <span class="token number">18</span>: <span class="token number">10</span>  private com.kk.test.JavapTest<span class="token punctuation">(</span>boolean<span class="token punctuation">)</span><span class="token punctuation">;</span>    descriptor: <span class="token punctuation">(</span>Z<span class="token punctuation">)</span>V    flags: ACC_PRIVATE    Code:      <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">locals</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">args_size</span><span class="token operator">=</span><span class="token number">2</span>         <span class="token number">0</span>: aload_0         <span class="token number">1</span>: invokespecial <span class="token comment">#1                  // Method java/lang/Object."&lt;init&gt;":()V</span>         <span class="token number">4</span>: aload_0         <span class="token number">5</span>: ldc           <span class="token comment">#2                  // String java</span>         <span class="token number">7</span>: putfield      <span class="token comment">#3                  // Field info:Ljava/lang/String;</span>        <span class="token number">10</span>: aload_0        <span class="token number">11</span>: iload_1        <span class="token number">12</span>: putfield      <span class="token comment">#4                  // Field flag:Z</span>        <span class="token number">15</span>: <span class="token builtin class-name">return</span>      LineNumberTable:        line <span class="token number">19</span>: <span class="token number">0</span>        line <span class="token number">14</span>: <span class="token number">4</span>        line <span class="token number">20</span>: <span class="token number">10</span>        line <span class="token number">21</span>: <span class="token number">15</span>  private void methodPrivate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    descriptor: <span class="token punctuation">(</span><span class="token punctuation">)</span>V    flags: ACC_PRIVATE    Code:      <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">locals</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">args_size</span><span class="token operator">=</span><span class="token number">1</span>         <span class="token number">0</span>: <span class="token builtin class-name">return</span>      LineNumberTable:        line <span class="token number">24</span>: <span class="token number">0</span>  int getNum<span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token punctuation">;</span>    descriptor: <span class="token punctuation">(</span>I<span class="token punctuation">)</span>I    flags:    Code:      <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">locals</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">args_size</span><span class="token operator">=</span><span class="token number">2</span>         <span class="token number">0</span>: aload_0         <span class="token number">1</span>: getfield      <span class="token comment">#5                  // Field num:I</span>         <span class="token number">4</span>: iload_1         <span class="token number">5</span>: iadd         <span class="token number">6</span>: ireturn      LineNumberTable:        line <span class="token number">26</span>: <span class="token number">0</span>  protected char showGender<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    descriptor: <span class="token punctuation">(</span><span class="token punctuation">)</span>C    flags: ACC_PROTECTED    Code:      <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">locals</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">args_size</span><span class="token operator">=</span><span class="token number">1</span>         <span class="token number">0</span>: aload_0         <span class="token number">1</span>: getfield      <span class="token comment">#6                  // Field gender:C</span>         <span class="token number">4</span>: ireturn      LineNumberTable:        line <span class="token number">29</span>: <span class="token number">0</span>  public void showInfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    descriptor: <span class="token punctuation">(</span><span class="token punctuation">)</span>V    flags: ACC_PUBLIC    Code:      <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token number">3</span>, <span class="token assign-left variable">locals</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">args_size</span><span class="token operator">=</span><span class="token number">1</span>         <span class="token number">0</span>: bipush        <span class="token number">10</span>         <span class="token number">2</span>: istore_1         <span class="token number">3</span>: getstatic     <span class="token comment">#7                  // Field java/lang/System.out:Ljava/io/PrintStream;</span>         <span class="token number">6</span>: new           <span class="token comment">#8                  // class java/lang/StringBuilder</span>         <span class="token number">9</span>: dup        <span class="token number">10</span>: invokespecial <span class="token comment">#9                  // Method java/lang/StringBuilder."&lt;init&gt;":()V</span>        <span class="token number">13</span>: aload_0        <span class="token number">14</span>: getfield      <span class="token comment">#3                  // Field info:Ljava/lang/String;</span>        <span class="token number">17</span>: invokevirtual <span class="token comment">#10                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>        <span class="token number">20</span>: iload_1        <span class="token number">21</span>: invokevirtual <span class="token comment">#11                 // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</span>        <span class="token number">24</span>: invokevirtual <span class="token comment">#12                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span>        <span class="token number">27</span>: invokevirtual <span class="token comment">#13                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>        <span class="token number">30</span>: <span class="token builtin class-name">return</span>      LineNumberTable:        line <span class="token number">32</span>: <span class="token number">0</span>        line <span class="token number">33</span>: <span class="token number">3</span>        line <span class="token number">34</span>: <span class="token number">30</span>  static <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    descriptor: <span class="token punctuation">(</span><span class="token punctuation">)</span>V    flags: ACC_STATIC    Code:      <span class="token assign-left variable">stack</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">locals</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">args_size</span><span class="token operator">=</span><span class="token number">0</span>         <span class="token number">0</span>: ldc           <span class="token comment">#14                 // String www.mykkto.com</span>         <span class="token number">2</span>: astore_0         <span class="token number">3</span>: <span class="token builtin class-name">return</span>      LineNumberTable:        line <span class="token number">11</span>: <span class="token number">0</span>        line <span class="token number">12</span>: <span class="token number">3</span><span class="token punctuation">}</span>SourceFile: <span class="token string">"JavapTest.java"</span>J:<span class="token punctuation">\</span><span class="token number">0</span> å¤§å‚ç´ æ<span class="token punctuation">\</span>jvm<span class="token punctuation">\</span>00Test<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5ã€æ€»ç»“"><a href="#5ã€æ€»ç»“" class="headerlink" title="5ã€æ€»ç»“"></a>5ã€æ€»ç»“</h3><p>1ã€é€šè¿‡javapå‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªjavaç±»åæ±‡ç¼–å¾—åˆ°çš„Classæ–‡ä»¶ç‰ˆæœ¬å·ã€å¸¸é‡æ± ã€è®¿é—®æ ‡è¯†ã€å˜é‡è¡¨ã€æŒ‡ä»¤ä»£ç è¡Œå·è¡¨ç­‰ç­‰ä¿¡æ¯ã€‚ä¸æ˜¾ç¤ºç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆã€<clinit>()ã€<init>()ç­‰ç»“æ„</init></clinit></p><p>2ã€é€šè¿‡å¯¹å‰é¢ä¾‹å­ä»£ç åæ±‡ç¼–æ–‡ä»¶çš„ç®€å•åˆ†æï¼Œå¯ä»¥å‘ç°ï¼Œä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œé€šå¸¸ä¼šæ¶‰åŠä¸‹é¢å‡ å—å†…å­˜çš„æ“ä½œï¼š<br>ï¼ˆ1ï¼‰javaæ ˆä¸­ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€‚<br>ï¼ˆ2ï¼‰javaå †ã€‚é€šè¿‡å¯¹è±¡çš„åœ°å€å¼•ç”¨å»æ“ä½œã€‚<br>ï¼ˆ3ï¼‰å¸¸é‡æ± ã€‚<br>ï¼ˆ4ï¼‰å…¶ä»–å¦‚å¸§æ•°æ®åŒºã€æ–¹æ³•åŒºçš„å‰©ä½™éƒ¨åˆ†ç­‰æƒ…å†µï¼Œæµ‹è¯•ä¸­æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™é‡Œè¯´æ˜ä¸€ä¸‹ã€‚</p><p>3ã€å¹³å¸¸ï¼Œæˆ‘ä»¬æ¯”è¾ƒå…³æ³¨çš„æ˜¯javaç±»ä¸­æ¯ä¸ªæ–¹æ³•çš„åæ±‡ç¼–ä¸­çš„æŒ‡ä»¤æ“ä½œè¿‡ç¨‹ï¼Œè¿™äº›æŒ‡ä»¤éƒ½æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£æŸ¥çœ‹æ¯ä¸ªæŒ‡ä»¤çš„å«ä¹‰ï¼Œå¾ˆç®€å•ï¼š<br><a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html">https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html</a></p><h2 id="äº”ã€å­—èŠ‚ç æŒ‡ä»¤é›†ä¸è§£ææ¦‚è¿°"><a href="#äº”ã€å­—èŠ‚ç æŒ‡ä»¤é›†ä¸è§£ææ¦‚è¿°" class="headerlink" title="äº”ã€å­—èŠ‚ç æŒ‡ä»¤é›†ä¸è§£ææ¦‚è¿°"></a>äº”ã€å­—èŠ‚ç æŒ‡ä»¤é›†ä¸è§£ææ¦‚è¿°</h2><p>Javaå­—èŠ‚ç å¯¹äºè™šæ‹Ÿæœºï¼Œå°±å¥½åƒæ±‡ç¼–è¯­è¨€å¯¹äºè®¡ç®—æœºï¼Œå±äºåŸºæœ¬æ‰§è¡ŒæŒ‡ä»¤ã€‚</p><p>Java è™šæ‹Ÿæœºçš„æŒ‡ä»¤ç”±ä¸€ä¸ªå­—èŠ‚é•¿åº¦çš„ã€ä»£è¡¨ç€æŸç§ç‰¹å®šæ“ä½œå«ä¹‰çš„æ•°å­—ï¼ˆç§°ä¸ºæ“ä½œç ï¼ŒOpcodeï¼‰ä»¥åŠè·Ÿéšå…¶åçš„é›¶è‡³å¤šä¸ªä»£è¡¨æ­¤æ“ä½œæ‰€éœ€å‚æ•°ï¼ˆç§°ä¸ºæ“ä½œæ•°ï¼ŒOperandsï¼‰è€Œæ„æˆã€‚ç”±äº Java è™šæ‹Ÿæœºé‡‡ç”¨é¢å‘æ“ä½œæ•°æ ˆè€Œä¸æ˜¯å¯„å­˜å™¨çš„ç»“æ„ï¼Œæ‰€ä»¥å¤§å¤šæ•°çš„æŒ‡ä»¤éƒ½ä¸åŒ…å«æ“ä½œæ•°ï¼Œåªæœ‰ä¸€ä¸ªæ“ä½œç ã€‚</p><p>ç”±äºé™åˆ¶äº† Java è™šæ‹Ÿæœºæ“ä½œç çš„é•¿åº¦ä¸ºä¸€ä¸ªå­—èŠ‚ï¼ˆå³ 0ï½255ï¼‰ï¼Œè¿™æ„å‘³ç€æŒ‡ä»¤é›†çš„æ“ä½œç æ€»æ•°ä¸å¯èƒ½è¶…è¿‡ 256 æ¡ã€‚</p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html</a></p><p>ç†Ÿæ‚‰è™šæ‹Ÿæœºçš„æŒ‡ä»¤å¯¹äºåŠ¨æ€å­—èŠ‚ç ç”Ÿæˆã€åç¼–è¯‘Classæ–‡ä»¶ã€Classæ–‡ä»¶ä¿®è¡¥éƒ½æœ‰ç€éå¸¸é‡è¦çš„ä»·å€¼ã€‚å› æ­¤ï¼Œé˜…è¯»å­—èŠ‚ç ä½œä¸ºäº†è§£ Java è™šæ‹Ÿæœºçš„åŸºç¡€æŠ€èƒ½ï¼Œéœ€è¦ç†Ÿç»ƒæŒæ¡å¸¸è§æŒ‡ä»¤ã€‚</p><h3 id="1ã€å­—èŠ‚ç ä¸æ•°æ®ç±»å‹"><a href="#1ã€å­—èŠ‚ç ä¸æ•°æ®ç±»å‹" class="headerlink" title="1ã€å­—èŠ‚ç ä¸æ•°æ®ç±»å‹"></a>1ã€å­—èŠ‚ç ä¸æ•°æ®ç±»å‹</h3><p>åœ¨Javaè™šæ‹Ÿæœºçš„æŒ‡ä»¤é›†ä¸­ï¼Œå¤§å¤šæ•°çš„æŒ‡ä»¤éƒ½åŒ…å«äº†å…¶æ“ä½œæ‰€å¯¹åº”çš„æ•°æ®ç±»å‹ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼ŒiloadæŒ‡ä»¤ç”¨äºä»å±€éƒ¨å˜é‡è¡¨ä¸­åŠ è½½intå‹çš„æ•°æ®åˆ°æ“ä½œæ•°æ ˆä¸­ï¼Œè€ŒfloadæŒ‡ä»¤åŠ è½½çš„åˆ™æ˜¯floatç±»å‹çš„æ•°æ®ã€‚</p><p>å¯¹äºå¤§éƒ¨åˆ†ä¸æ•°æ®ç±»å‹ç›¸å…³çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œå®ƒä»¬çš„æ“ä½œç åŠ©è®°ç¬¦ä¸­éƒ½æœ‰ç‰¹æ®Šçš„å­—ç¬¦æ¥è¡¨æ˜ä¸“é—¨ä¸ºå“ªç§æ•°æ®ç±»å‹æœåŠ¡ï¼š</p><ul><li>iä»£è¡¨å¯¹intç±»å‹çš„æ•°æ®æ“ä½œ</li><li>lä»£è¡¨longç±»å‹çš„æ•°æ®æ“ä½œ</li><li>sä»£è¡¨shortç±»å‹çš„æ•°æ®æ“ä½œ</li><li>bä»£è¡¨byteç±»å‹çš„æ•°æ®æ“ä½œ</li><li>cä»£è¡¨charç±»å‹çš„æ•°æ®æ“ä½œ</li><li>fä»£è¡¨floatç±»å‹çš„æ•°æ®æ“ä½œ</li><li>dä»£è¡¨doubleç±»å‹çš„æ•°æ®æ“ä½œ</li></ul><p>ä¹Ÿæœ‰ä¸€äº›æŒ‡ä»¤çš„åŠ©è®°ç¬¦ä¸­æ²¡æœ‰æ˜ç¡®åœ°æŒ‡æ˜æ“ä½œç±»å‹çš„å­—æ¯ï¼Œå¦‚arraylengthæŒ‡ä»¤ï¼Œå®ƒæ²¡æœ‰ä»£è¡¨æ•°æ®ç±»å‹çš„ç‰¹æ®Šå­—ç¬¦ï¼Œä½†æ“ä½œæ•°æ°¸è¿œåªèƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹çš„å¯¹è±¡ã€‚</p><p>è¿˜æœ‰å¦å¤–ä¸€äº›æŒ‡ä»¤ï¼Œå¦‚æ— æ¡ä»¶è·³è½¬æŒ‡ä»¤gotoåˆ™æ˜¯ä¸æ•°æ®ç±»å‹æ— å…³çš„ã€‚</p><p>å¤§éƒ¨åˆ†çš„æŒ‡ä»¤éƒ½æ²¡æœ‰æ”¯æŒæ•´æ•°ç±»å‹byteã€charå’Œshortï¼Œç”šè‡³æ²¡æœ‰ä»»ä½•æŒ‡ä»¤æ”¯æŒbooleanç±»å‹ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸæˆ–è¿è¡ŒæœŸå°†byteå’Œshortç±»å‹çš„æ•°æ®å¸¦ç¬¦å·æ‰©å±•ï¼ˆSign-Extendï¼‰ä¸ºç›¸åº”çš„intç±»å‹æ•°æ®ï¼Œå°†booleanå’Œcharç±»å‹æ•°æ®é›¶ä½æ‰©å±•ï¼ˆZero-Extendï¼‰ä¸ºç›¸åº”çš„intç±»å‹æ•°æ®ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œåœ¨å¤„ç†booleanã€byteã€shortå’Œcharç±»å‹çš„æ•°ç»„æ—¶ï¼Œä¹Ÿä¼šè½¬æ¢ä¸ºä½¿ç”¨å¯¹åº”çš„intç±»å‹çš„å­—èŠ‚ç æŒ‡ä»¤æ¥å¤„ç†ã€‚å› æ­¤ï¼Œå¤§å¤šæ•°å¯¹äºbooleanã€byteã€shortå’Œcharç±»å‹æ•°æ®çš„æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯ä½¿ç”¨ç›¸åº”çš„intç±»å‹ä½œä¸ºè¿ç®—ç±»å‹ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">byte</span> b1 <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span><span class="token keyword">short</span> s1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">int</span> i <span class="token operator">=</span> b1 <span class="token operator">+</span> s1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="2ã€æŒ‡ä»¤åˆ†ç±»"><a href="#2ã€æŒ‡ä»¤åˆ†ç±»" class="headerlink" title="2ã€æŒ‡ä»¤åˆ†ç±»"></a>2ã€æŒ‡ä»¤åˆ†ç±»</h3><p>ç”±äºå®Œå…¨ä»‹ç»å’Œå­¦ä¹ è¿™äº›æŒ‡ä»¤éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´ã€‚ä¸ºäº†è®©å¤§å®¶èƒ½å¤Ÿæ›´å¿«åœ°ç†Ÿæ‚‰å’Œäº†è§£è¿™äº›åŸºæœ¬æŒ‡ä»¤ï¼Œè¿™é‡Œå°†JVMä¸­çš„å­—èŠ‚ç æŒ‡ä»¤é›†æŒ‰ç”¨é€”å¤§è‡´åˆ†æˆ 9 ç±»ã€‚</p><ul><li>åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤</li><li>ç®—æœ¯æŒ‡ä»¤</li><li>ç±»å‹è½¬æ¢æŒ‡ä»¤</li><li>å¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤</li><li>æ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤</li><li>æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤</li><li>æ§åˆ¶è½¬ç§»æŒ‡ä»¤</li><li>å¼‚å¸¸å¤„ç†æŒ‡ä»¤</li><li>åŒæ­¥æ§åˆ¶æŒ‡ä»¤</li></ul><p>(è¯´åœ¨å‰é¢)åœ¨åšå€¼ç›¸å…³æ“ä½œæ—¶ï¼š</p><ul><li>ä¸€ä¸ªæŒ‡ä»¤ï¼Œå¯ä»¥ä»å±€éƒ¨å˜é‡è¡¨ã€å¸¸é‡æ± ã€å †ä¸­å¯¹è±¡ã€æ–¹æ³•è°ƒç”¨ã€ç³»ç»Ÿè°ƒç”¨ä¸­ç­‰å–å¾—æ•°æ®ï¼Œè¿™äº›æ•°æ®ï¼ˆå¯èƒ½æ˜¯å€¼ï¼Œå¯èƒ½æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼‰è¢«å‹å…¥æ“ä½œæ•°æ ˆã€‚</li><li>ä¸€ä¸ªæŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥ä»æ“ä½œæ•°æ ˆä¸­å–å‡ºä¸€åˆ°å¤šä¸ªå€¼ï¼ˆpopå¤šæ¬¡ï¼‰ï¼Œå®Œæˆèµ‹å€¼ã€åŠ å‡ä¹˜é™¤ã€æ–¹æ³•ä¼ å‚ã€ç³»ç»Ÿè°ƒç”¨ç­‰ç­‰æ“ä½œã€‚</li></ul><h2 id="å…­ã€â˜…-å­—èŠ‚ç æŒ‡ä»¤"><a href="#å…­ã€â˜…-å­—èŠ‚ç æŒ‡ä»¤" class="headerlink" title="å…­ã€â˜… å­—èŠ‚ç æŒ‡ä»¤"></a>å…­ã€â˜… å­—èŠ‚ç æŒ‡ä»¤</h2><h3 id="1ã€åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤"><a href="#1ã€åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤" class="headerlink" title="1ã€åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤"></a>1ã€åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤</h3><h3 id="2ã€ç®—æœ¯æŒ‡ä»¤"><a href="#2ã€ç®—æœ¯æŒ‡ä»¤" class="headerlink" title="2ã€ç®—æœ¯æŒ‡ä»¤"></a>2ã€ç®—æœ¯æŒ‡ä»¤</h3><h3 id="3ã€ç±»å‹è½¬æ¢æŒ‡ä»¤"><a href="#3ã€ç±»å‹è½¬æ¢æŒ‡ä»¤" class="headerlink" title="3ã€ç±»å‹è½¬æ¢æŒ‡ä»¤"></a>3ã€ç±»å‹è½¬æ¢æŒ‡ä»¤</h3><h3 id="4ã€å¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤"><a href="#4ã€å¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤" class="headerlink" title="4ã€å¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤"></a>4ã€å¯¹è±¡çš„åˆ›å»ºä¸è®¿é—®æŒ‡ä»¤</h3><h3 id="5ã€æ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤"><a href="#5ã€æ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤" class="headerlink" title="5ã€æ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤"></a>5ã€æ–¹æ³•è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤</h3><h3 id="6ã€æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤"><a href="#6ã€æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤" class="headerlink" title="6ã€æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤"></a>6ã€æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤</h3><h3 id="7ã€æ§åˆ¶è½¬ç§»æŒ‡ä»¤"><a href="#7ã€æ§åˆ¶è½¬ç§»æŒ‡ä»¤" class="headerlink" title="7ã€æ§åˆ¶è½¬ç§»æŒ‡ä»¤"></a>7ã€æ§åˆ¶è½¬ç§»æŒ‡ä»¤</h3><h3 id="8ã€å¼‚å¸¸å¤„ç†æŒ‡ä»¤"><a href="#8ã€å¼‚å¸¸å¤„ç†æŒ‡ä»¤" class="headerlink" title="8ã€å¼‚å¸¸å¤„ç†æŒ‡ä»¤"></a>8ã€å¼‚å¸¸å¤„ç†æŒ‡ä»¤</h3><h3 id="9ã€åŒæ­¥æ§åˆ¶æŒ‡ä»¤"><a href="#9ã€åŒæ­¥æ§åˆ¶æŒ‡ä»¤" class="headerlink" title="9ã€åŒæ­¥æ§åˆ¶æŒ‡ä»¤"></a>9ã€åŒæ­¥æ§åˆ¶æŒ‡ä»¤</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="é«˜é˜¶ç¯‡" scheme="https://mykkto.github.io/categories/%E9%AB%98%E9%98%B6%E7%AF%87/"/>
    
    
    <category term="jvm" scheme="https://mykkto.github.io/tags/jvm/"/>
    
    <category term="å­—èŠ‚ç " scheme="https://mykkto.github.io/tags/%E5%AD%97%E8%8A%82%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>å†æ¥é¢åŸºé¢˜ã€é•¿æœŸã€‘</title>
    <link href="https://mykkto.github.io/posts/c1193e28.html"/>
    <id>https://mykkto.github.io/posts/c1193e28.html</id>
    <published>2022-04-09T03:06:12.000Z</published>
    <updated>2022-11-12T15:07:08.031Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h2><h3 id="1ã€è¯´æ˜"><a href="#1ã€è¯´æ˜" class="headerlink" title="1ã€è¯´æ˜"></a>1ã€è¯´æ˜</h3><p>åˆç¨¿æ²¡æƒ³å¥½æ€ä¹ˆå®šä¹‰ï¼ŒæŠŠæœ€è¿‘é‡åˆ°çš„é¢è¯•é¢˜å¤§æ¦‚æ¢³ç†ä¸‹ï¼ˆå¯èƒ½æ¯”è¾ƒæ½¦è‰ï¼Œæš‚æ—¶æ²¡èŠ±æ—¶é—´æ’ç‰ˆï¼‰</p><h2 id="äºŒã€é¢˜ç›®"><a href="#äºŒã€é¢˜ç›®" class="headerlink" title="äºŒã€é¢˜ç›®"></a>äºŒã€é¢˜ç›®</h2><p>ä¸€äº›é¢˜ç›®ä¼šè´´å‡ºé—®é¢˜æ–¹æ¡ˆï¼Œéƒ¨åˆ†æš‚æ—¶æ²¡æœ‰å½’çº³ï¼Œä¸è¿‡åœ¨æ­¤ç«™éƒ½èƒ½æœç´¢å¾—åˆ°ï¼Œæä¸‹</p><p>æœ¬ç«™é‡‡ç”¨<strong>å…¨æ–‡æœç´¢</strong>ï¼Œå¯ä»¥æ–¹ä¾¿çš„æ£€ç´¢åˆ°é—®é¢˜ä»¥åŠæ–¹æ¡ˆã€‚</p><ul><li>æ•°æ®åº“ä¸‰èŒƒå¼ï¼ˆæ”¶é›†éœ€æ±‚å’Œæ€ä¹ˆè®¾è®¡æ•°æ®åº“çš„ï¼‰</li><li>Springã€SpringBootã€SpringCloudåŒºåˆ«ï¼Œå±•å¼€<ul><li>Springç‰¹æ€§ç”¨æ³•ï¼Œäº‹åŠ¡ï¼Œjdbcæ¨¡æ¿ä¹‹ç±»</li><li>SpringBooté›¶é…ç½®â€¦â€¦å¯ä»¥çš„è¯è‡ªå®šä¹‰é…ç½®èŠä¸‹</li><li>SpringCloudåˆ†ä¸¤éƒ¨åˆ†è¯´ï¼ˆnetfix,alibabaï¼‰ï¼Œæ¯ä¸ªç»„ä»¶ç”¨æ³•è¯´ä¸‹ï¼Œå¯ä»¥çš„è¯åŸç†å±•å¼€ä¸‹</li></ul></li><li>Seata ID(1)+ç»„ä»¶(3)æ‰©å±•è¯´æ˜ï¼Œç”¨æ³•åŠåŒºåˆ«<ul><li>è¿™è¾¹IDç”¨åˆ°çš„é›ªèŠ±ç®—æ³•ï¼Œæ‡‚çš„è¯å¯ä»¥å±•å¼€ï¼Œå¦‚æœä¼šå†™çš„è¯ï¼Œè¯´å‡ºå®ç°ç®—æ³•çš„åŸç†æœ€ä½³ï¼Œä»¥åŠé›ªèŠ±çš„ç¼ºé™·ï¼ˆæ—¶é’Ÿé—®é¢˜ï¼‰ï¼Œè§£å†³æ–¹æ¡ˆ</li><li>ä¸‰ä¸ªç»„ä»¶åŸç†æœ¬ç«™ä¹Ÿæœ‰å†™</li></ul></li><li>æ•°æ®åº“ä¼˜åŒ–ï¼Œç´¢å¼•å¤±æ•ˆå“ªäº›æƒ…å†µ</li><li>æ•°æ®åº“ï¼Œç‰©åŒ–è§†å›¾<ul><li>ç‰©åŒ–è§†å›¾ä¸æ™®é€šçš„è§†å›¾ç›¸æ¯”çš„åŒºåˆ«æ˜¯ç‰©åŒ–è§†å›¾æ˜¯å»ºç«‹çš„å‰¯æœ¬ï¼Œå®ƒç±»ä¼¼äºä¸€å¼ è¡¨ï¼Œéœ€è¦å ç”¨å­˜å‚¨ç©ºé—´ã€‚è€Œå¯¹ä¸€ä¸ªç‰©åŒ–è§†å›¾æŸ¥è¯¢çš„æ‰§è¡Œæ•ˆç‡ä¸æŸ¥è¯¢ä¸€ä¸ªè¡¨æ˜¯ä¸€æ ·çš„ã€‚</li><li>å…¶å®å°±æ˜¯å­˜åœ¨ç‰©ç†å†…å­˜çš„å‰¯æœ¬è¡¨ï¼Œä½†æ˜¯æ€§èƒ½å’Œè§†å›¾ä¸€æ ·</li></ul></li><li>æœ€è¿‘é¡¹ç›®æè¿°åŠå…¶å±•å¼€è¯´æ˜ï¼ˆè¿™ä¸ªä¸ç”¨å¤šè¯´äº†å§ï¼‰</li><li>åŒæ­¥é›†åˆç”¨è¿‡å“ªäº›ï¼Œè¯´æ˜ï¼Œä»¥åŠåˆ†å¸ƒå¼é”è¯´æ˜<ul><li>è¿™è¾¹ä¹‹å‰æƒ³å±•å¼€AQSè¯´æ˜ä½†æ˜¯è®²äº†å¾ˆå¤šäº†å£å¹²èˆŒç‡¥çš„ï¼Œæ°´ä¹Ÿä¸å¤Ÿå–äº†</li><li>ä¸€æ–¹é¢å¯¹åº•å±‚ä¹Ÿæ˜¯å¤§æ¦‚äº†è§£ï¼ŒFIFOå†…çš„Nodeæ·±å…¥APIçš„è¯æœªå¿…ç­”çš„å…¨é¢</li><li>åˆ†å¸ƒé”å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªå®ç°å±•å¼€ï¼ˆluaã€redissionã€zookeeperï¼‰ï¼Œluaåˆåˆ†ä¸ºå•ä½“å’Œé›†ç¾¤éƒ½å¯ä»¥å±•å¼€è¯´æ˜</li><li>lua é›†ç¾¤å®ç°åˆ†å¸ƒå¼é”ï¼Œå¯ä»¥èŠä¸‹redlockï¼Œredissionåº•å±‚å°±æ˜¯â€¦..</li><li>redission åº•å±‚è‡ªæ—‹çš„çœ‹é—¨å£ç‹—(watchdog)æœºåˆ¶å¯ä»¥è¯´ä¸‹</li></ul></li><li>esç”¨è¿‡è¯´ä¸‹ï¼Œå€’æ’ç´¢å¼•æœºåˆ¶åŸç†è¯´ä¸‹</li><li>å¤šçº¿ç¨‹æ‰©å±•èŠäº†CAS<ul><li>åŸºæœ¬ä»‹ç»ä¸‹CASï¼Œä¼˜ç¼ºç‚¹ï¼Œç¼ºç‚¹æ–¹æ¡ˆè§£å†³</li><li>å‡ ç§åŸå­ç±»è¯´æ˜ï¼Œè·Ÿvolatileå¯è§æ€§æ¯”è¾ƒ</li><li>å¯ä»¥çš„è¯åŸå­ç±»åŸç†å±•å¼€ï¼ŒLongAdderå¿«çš„åŸå› </li></ul></li><li>Synchronizedç”¨è¿‡å—<ul><li>å¯ä»¥çš„è¯è¯´æ˜ä¸‹ç”¨æ³•ï¼Œç„¶åå±•å¼€ä¸‹é”å‡çº§ï¼ˆæ— é”-åé”-è½»é”-é‡é”ï¼‰</li><li>å¯ä»¥æä¸‹JUCä¸­çš„è¯»å†™é”ï¼ˆReentrantReadWriteLockï¼‰ï¼Œå¤§æ¦‚è¯´ä¸‹è¯»å†™å››ç§æƒ…å†µä»¥åŠé”é™çº§</li><li>è‡ªè¿°å®Œè¯»å†™é”ï¼Œå¯ä»¥æä¸‹æ›´é«˜æ•ˆçš„é‚®æˆ³é”ï¼ˆStampedLockï¼‰ï¼Œä¼˜ç¼ºç‚¹è¯´ä¸‹ï¼Œç‰¹ç‚¹è¯´ä¸‹ï¼ˆåå­—å°±å¯ä»¥çœ‹å‡ºæ˜¯ä¸é‡å…¥é”ï¼‰</li></ul></li><li>rediså‡»ç©¿ã€ç©¿é€ã€é›ªå´©<ul><li>è¯´ä¸‹æ˜¯ä»€ä¹ˆï¼Œè§£å†³æ–¹æ¡ˆ</li><li>å¸ƒéš†è¿‡æ»¤å™¨å®ç°åŸç†</li></ul></li></ul><h2 id="å‚è€ƒæ–‡æ¡£-â†“"><a href="#å‚è€ƒæ–‡æ¡£-â†“" class="headerlink" title="å‚è€ƒæ–‡æ¡£ â†“"></a>å‚è€ƒæ–‡æ¡£ â†“</h2><p>ç‰©åŒ–è§†å›¾ï¼š<a href="https://baijiahao.baidu.com/s?id=1709212821591222829&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1709212821591222829&amp;wfr=spider&amp;for=pc</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/bigdata/flink/202206271903615.jpg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="é¢è¯•é¢˜" scheme="https://mykkto.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
    
    <category term="åŸç†" scheme="https://mykkto.github.io/tags/%E5%8E%9F%E7%90%86/"/>
    
    <category term="java" scheme="https://mykkto.github.io/tags/java/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://mykkto.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="æ•°æ®åº“" scheme="https://mykkto.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>ShardingSphereåˆ†åº“åˆ†è¡¨ã€ä½œåºŸã€‘</title>
    <link href="https://mykkto.github.io/posts/97bfaea3.html"/>
    <id>https://mykkto.github.io/posts/97bfaea3.html</id>
    <published>2022-04-09T01:01:02.000Z</published>
    <updated>2022-11-12T15:07:08.042Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><h3 id="1ã€å­¦è‹±è¯­"><a href="#1ã€å­¦è‹±è¯­" class="headerlink" title="1ã€å­¦è‹±è¯­"></a>1ã€å­¦è‹±è¯­</h3><p>åšä¸»æ˜¯ä¸ªäºŒæµå­ï¼Œè‹±è¯­ä¸ä¼šä½†åˆæ ¼å¤–å–œæ¬¢</p><p>ShardingSphere(å¡è…š-è²å„¿)ã€åˆ†ç‰‡-çƒã€‘ã€Proxy(æ™®æ‹‰å…‹è°)ã€ä»£ç†ã€‘</p><h3 id="2ã€åˆ†åº“åˆ†è¡¨"><a href="#2ã€åˆ†åº“åˆ†è¡¨" class="headerlink" title="2ã€åˆ†åº“åˆ†è¡¨"></a>2ã€åˆ†åº“åˆ†è¡¨</h3><h4 id="1ã€ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨"><a href="#1ã€ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨"></a>1ã€ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨</h4><p><strong>åˆ†åº“åˆ†è¡¨å°±æ˜¯ä¸ºäº†è§£å†³ç”±äºæ•°æ®é‡è¿‡å¤§è€Œå¯¼è‡´æ•°æ®åº“æ€§èƒ½é™ä½çš„é—®é¢˜ï¼Œå°†åŸæ¥ç‹¬ç«‹çš„æ•°æ®åº“æ‹†åˆ†æˆè‹¥å¹²æ•°æ®åº“ç»„æˆï¼Œå°†æ•°æ®å¤§è¡¨æ‹†åˆ†æˆè‹¥å¹²æ•°æ®è¡¨ç»„æˆï¼Œä½¿å¾—å•ä¸€æ•°æ®åº“ã€å•ä¸€æ•°æ®è¡¨çš„æ•°æ®é‡å˜å°ï¼Œä»è€Œè¾¾åˆ°æå‡æ•°æ®åº“æ€§èƒ½çš„ç›®çš„ã€‚</strong></p><h4 id="2ã€åˆ†åº“åˆ†è¡¨æ–¹å¼"><a href="#2ã€åˆ†åº“åˆ†è¡¨æ–¹å¼" class="headerlink" title="2ã€åˆ†åº“åˆ†è¡¨æ–¹å¼"></a>2ã€åˆ†åº“åˆ†è¡¨æ–¹å¼</h4><p><strong>åˆ†åº“åˆ†è¡¨</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220411233301.png"></p><p>åˆ†åº“åˆ†è¡¨åŒ…æ‹¬<code>åˆ†åº“</code>å’Œ<code>åˆ†è¡¨</code>ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><p>åœ¨ç”Ÿäº§ä¸­é€šå¸¸åŒ…æ‹¬ï¼š<strong>å‚ç›´åˆ†åº“ã€æ°´å¹³åˆ†åº“ã€å‚ç›´åˆ†è¡¨ã€æ°´å¹³åˆ†è¡¨</strong>å››ç§æ–¹å¼ã€‚</p><p><strong>æ°´å¹³æ‹†åˆ†ï¼š</strong>æ ¹æ®è¡¨ä¸­æ•°æ®çš„é€»è¾‘å…³ç³»ï¼Œå°†è¡¨ä¸­çš„æ•°æ®æŒ‰ç…§æŸç§æ¡ä»¶æ‹†åˆ†åˆ°å¤šå°æ•°æ®åº“ä¸Šã€‚</p><p><strong>å‚ç›´æ‹†åˆ†ï¼š</strong>æŠŠå•ä¸€çš„è¡¨æ‹†åˆ†æˆå¤šä¸ªè¡¨ï¼Œå¹¶åˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“ï¼ˆä¸»æœºï¼‰ä¸Š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220411233652.png"></p><h4 id="2-1-å‚ç›´åˆ†åº“"><a href="#2-1-å‚ç›´åˆ†åº“" class="headerlink" title="2.1 å‚ç›´åˆ†åº“"></a>2.1 å‚ç›´åˆ†åº“</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/%E5%9B%BE3png.png"></p><h4 id="2-2-å‚ç›´åˆ†è¡¨"><a href="#2-2-å‚ç›´åˆ†è¡¨" class="headerlink" title="2.2 å‚ç›´åˆ†è¡¨"></a>2.2 å‚ç›´åˆ†è¡¨</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/%E5%9B%BE2.png"></p><h4 id="2-3-æ°´å¹³åˆ†è¡¨"><a href="#2-3-æ°´å¹³åˆ†è¡¨" class="headerlink" title="2.3 æ°´å¹³åˆ†è¡¨"></a>2.3 æ°´å¹³åˆ†è¡¨</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220411232915.png"></p><h4 id="2-4-æ°´å¹³åˆ†åº“"><a href="#2-4-æ°´å¹³åˆ†åº“" class="headerlink" title="2.4 æ°´å¹³åˆ†åº“"></a>2.4 æ°´å¹³åˆ†åº“</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/%E5%9B%BE4.png"></p><h4 id="3ã€ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨"><a href="#3ã€ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨" class="headerlink" title="3ã€ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨"></a>3ã€ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨</h4><p>ä¸€èˆ¬çš„æœºå™¨ï¼ˆ4æ ¸16Gï¼‰ï¼Œå•åº“çš„MySQLå¹¶å‘ï¼ˆQPS+TPSï¼‰è¶…è¿‡äº†2kï¼Œç³»ç»ŸåŸºæœ¬å°±å®•æœºäº†ã€‚æœ€å¥½æ˜¯å¹¶å‘é‡æ§åˆ¶åœ¨1kå·¦å³ã€‚</p><ul><li>QPSï¼šæ¯ç§’å¹¶å‘é‡</li><li>TPSï¼šæ¯ç§’ååé‡</li></ul><p>åˆ†åº“åˆ†è¡¨ç›®çš„ï¼šè§£å†³é«˜å¹¶å‘ï¼Œå’Œæ•°æ®é‡å¤§çš„é—®é¢˜ã€‚</p><h4 id="4ã€åˆ†åº“åˆ†è¡¨çš„åœºæ™¯"><a href="#4ã€åˆ†åº“åˆ†è¡¨çš„åœºæ™¯" class="headerlink" title="4ã€åˆ†åº“åˆ†è¡¨çš„åœºæ™¯"></a>4ã€åˆ†åº“åˆ†è¡¨çš„åœºæ™¯</h4><p>ï¼ˆ1ï¼‰åœ¨æ•°æ®åº“è®¾è®¡æ—¶å€™è€ƒè™‘å‚ç›´åˆ†åº“å’Œå‚ç›´åˆ†è¡¨ </p><p>ï¼ˆ2ï¼‰éšç€æ•°æ®åº“æ•°æ®é‡å¢åŠ ï¼Œä¸è¦é©¬ä¸Šè€ƒè™‘åšæ°´å¹³åˆ‡åˆ†ï¼Œé¦–<code>å…ˆè€ƒè™‘ç¼“å­˜å¤„ç†ï¼Œè¯»å†™åˆ†ç¦»ï¼Œä½¿ç”¨ç´¢å¼•</code>ç­‰ç­‰æ–¹å¼ï¼Œå¦‚æœè¿™äº›æ–¹å¼ä¸èƒ½æ ¹æœ¬è§£å†³é—®é¢˜äº†ï¼Œ</p><p>å†è€ƒè™‘åšæ°´å¹³åˆ†åº“å’Œæ°´å¹³åˆ†è¡¨</p><h4 id="5ã€åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„é—®é¢˜"><a href="#5ã€åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="5ã€åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„é—®é¢˜"></a>5ã€åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„é—®é¢˜</h4><p>â€¢ äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜</p><p>â€¢ è·¨èŠ‚ç‚¹å…³è”æŸ¥è¯¢çš„é—®é¢˜ ( Join )ã€‚ </p><p>â€¢ è·¨èŠ‚ç‚¹åˆ†é¡µã€åˆ†ç»„ã€æ’åºé—®é¢˜ã€‚ </p><p>â€¢ å­˜åœ¨å¤šæ•°æ®æºç®¡ç†çš„é—®é¢˜</p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="äºŒã€Sharding-JDBCå¿«é€Ÿå…¥é—¨"><a href="#äºŒã€Sharding-JDBCå¿«é€Ÿå…¥é—¨" class="headerlink" title="äºŒã€Sharding-JDBCå¿«é€Ÿå…¥é—¨"></a>äºŒã€Sharding-JDBCå¿«é€Ÿå…¥é—¨</h2><h3 id="å®˜ç½‘"><a href="#å®˜ç½‘" class="headerlink" title="å®˜ç½‘"></a>å®˜ç½‘</h3><p><a href="http://shardingsphere.apache.org/index_zh.html">http://shardingsphere.apache.org/index_zh.html</a></p><h3 id="1ã€åŸºæœ¬ä»‹ç»"><a href="#1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="1ã€åŸºæœ¬ä»‹ç»"></a>1ã€åŸºæœ¬ä»‹ç»</h3><p>Sharding-JDBCæ˜¯å½“å½“ç½‘ç ”å‘çš„å¼€æºåˆ†å¸ƒå¼æ•°æ®åº“ä¸­é—´ä»¶ï¼Œä»3.0 å¼€å§‹Sharding-JDBC è¢«åŒ…å«åœ¨Sharding-Sphereä¸­ï¼Œ</p><p>ä¹‹åè¯¥é¡¹ç›®è¿›å…¥è¿›å…¥Apacheå­µåŒ–å™¨ï¼Œ4.ç‰ˆæœ¬ä¹‹åçš„ç‰ˆæœ¬ä¸ºApacheç‰ˆæœ¬ã€‚</p><p>å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p><h4 id="Sharding-JDBCæ¶æ„å›¾ï¼š"><a href="#Sharding-JDBCæ¶æ„å›¾ï¼š" class="headerlink" title="Sharding-JDBCæ¶æ„å›¾ï¼š"></a><strong>Sharding-JDBCæ¶æ„å›¾ï¼š</strong></h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220412141303.png"></p><h4 id="Sharding-Proxyæ¶æ„å›¾ï¼š"><a href="#Sharding-Proxyæ¶æ„å›¾ï¼š" class="headerlink" title="Sharding-Proxyæ¶æ„å›¾ï¼š"></a><strong>Sharding-Proxyæ¶æ„å›¾ï¼š</strong></h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220412141632.png"></p><h4 id="Sharding-Jdbcæ··åˆæ¶æ„ï¼š"><a href="#Sharding-Jdbcæ··åˆæ¶æ„ï¼š" class="headerlink" title="Sharding-Jdbcæ··åˆæ¶æ„ï¼š"></a>Sharding-Jdbcæ··åˆæ¶æ„ï¼š</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220412142051.png"></p><p>ShardingSphere-JDBC é‡‡ç”¨æ— ä¸­å¿ƒåŒ–æ¶æ„ï¼Œé€‚ç”¨äº Java å¼€å‘çš„é«˜æ€§èƒ½çš„è½»é‡çº§ OLTPï¼ˆè¿æ¥äº‹åŠ¡å¤„ç†ï¼‰ åº”ç”¨ï¼›ShardingSphere-Proxy æä¾›é™æ€å…¥å£ä»¥åŠå¼‚æ„è¯­è¨€çš„æ”¯æŒï¼Œé€‚ç”¨äº OLAPï¼ˆè¿æ¥æ•°æ®åˆ†æï¼‰ åº”ç”¨ä»¥åŠå¯¹åˆ†ç‰‡æ•°æ®åº“è¿›è¡Œç®¡ç†å’Œè¿ç»´çš„åœºæ™¯ã€‚</p><p>Apache ShardingSphere æ˜¯å¤šæ¥å…¥ç«¯å…±åŒç»„æˆçš„ç”Ÿæ€åœˆã€‚ é€šè¿‡æ··åˆä½¿ç”¨ ShardingSphere-JDBC å’Œ ShardingSphere-Proxyï¼Œå¹¶é‡‡ç”¨åŒä¸€æ³¨å†Œä¸­å¿ƒç»Ÿä¸€é…ç½®åˆ†ç‰‡ç­–ç•¥ï¼Œèƒ½å¤Ÿçµæ´»çš„æ­å»ºé€‚ç”¨äºå„ç§åœºæ™¯çš„åº”ç”¨ç³»ç»Ÿï¼Œä½¿å¾—æ¶æ„å¸ˆæ›´åŠ è‡ªç”±åœ°è°ƒæ•´é€‚åˆä¸å½“å‰ä¸šåŠ¡çš„æœ€ä½³ç³»ç»Ÿæ¶æ„ã€‚</p><h4 id="ä¸jdbcæ€§èƒ½å¯¹æ¯”"><a href="#ä¸jdbcæ€§èƒ½å¯¹æ¯”" class="headerlink" title="ä¸jdbcæ€§èƒ½å¯¹æ¯”"></a>ä¸jdbcæ€§èƒ½å¯¹æ¯”</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220413201213.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220413201228.png"></p><h3 id="2ã€éœ€æ±‚è¯´æ˜"><a href="#2ã€éœ€æ±‚è¯´æ˜" class="headerlink" title="2ã€éœ€æ±‚è¯´æ˜"></a>2ã€éœ€æ±‚è¯´æ˜</h3><h4 id="1ã€æ¡ˆä¾‹ä¸€ï¼šæ°´å¹³åˆ†è¡¨"><a href="#1ã€æ¡ˆä¾‹ä¸€ï¼šæ°´å¹³åˆ†è¡¨" class="headerlink" title="1ã€æ¡ˆä¾‹ä¸€ï¼šæ°´å¹³åˆ†è¡¨"></a>1ã€æ¡ˆä¾‹ä¸€ï¼šæ°´å¹³åˆ†è¡¨</h4><p>æ‰‹åŠ¨åˆ›å»ºä¸¤å¼ è¡¨ï¼Œt_order_1å’Œt_order_2ï¼Œè¿™ä¸¤å¼ è¡¨æ˜¯è®¢å•è¡¨ï¼Œæ‹†åˆ†åçš„è¡¨ï¼Œé€šè¿‡Sharding-Jdbcå‘è¯¾ç¨‹è¡¨æ’å…¥æ•°æ®ï¼ŒæŒ‰ç…§ä¸€å®šçš„åˆ†ç‰‡è§„åˆ™ï¼Œ<strong>ä¸»é”®ä¸ºå¶æ•°çš„è¿›å…¥t_order_1ï¼Œå¦ä¸€éƒ¨åˆ†æ•°æ®è¿›å…¥t_order_2</strong>ï¼Œé€šè¿‡Sharding-Jdbc æŸ¥è¯¢æ•°æ®ï¼Œæ ¹æ® SQLè¯­å¥çš„å†…å®¹ä»t_order_1æˆ–t_order_2æŸ¥è¯¢æ•°æ®ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220413232842.png"></p><h4 id="2ã€æ¡ˆä¾‹äºŒã€æ°´å¹³åˆ†åº“"><a href="#2ã€æ¡ˆä¾‹äºŒã€æ°´å¹³åˆ†åº“" class="headerlink" title="2ã€æ¡ˆä¾‹äºŒã€æ°´å¹³åˆ†åº“"></a>2ã€æ¡ˆä¾‹äºŒã€æ°´å¹³åˆ†åº“</h4><p>åœ¨æ¡ˆä¾‹ä¸€çš„åŸºç¡€ä¸Šï¼Œæ‰©å±•å‡ºä¸¤ä¸ªæ•°æ®åº“ï¼Œæ ¹æ® user_id </p><p>å¶æ•°å…¥åº“ï¼Œsharding_jdbc1</p><p>å¥‡æ•°å…¥åº“ï¼Œsharding_jdbc2</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220413233510.png"></p><h4 id="3ã€æ¡ˆä¾‹ä¸‰ã€å‚ç›´åˆ†åº“"><a href="#3ã€æ¡ˆä¾‹ä¸‰ã€å‚ç›´åˆ†åº“" class="headerlink" title="3ã€æ¡ˆä¾‹ä¸‰ã€å‚ç›´åˆ†åº“"></a>3ã€æ¡ˆä¾‹ä¸‰ã€å‚ç›´åˆ†åº“</h4><p>æŒ‰ç…§ä¸šä½™å»åŒºåˆ†åº“</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220416204322.png"></p><h3 id="3ã€é¡¹ç›®æ­å»º"><a href="#3ã€é¡¹ç›®æ­å»º" class="headerlink" title="3ã€é¡¹ç›®æ­å»º"></a>3ã€é¡¹ç›®æ­å»º</h3><h4 id="1ã€æŠ€æœ¯é€‰å‹"><a href="#1ã€æŠ€æœ¯é€‰å‹" class="headerlink" title="1ã€æŠ€æœ¯é€‰å‹"></a>1ã€æŠ€æœ¯é€‰å‹</h4><p>springboot2.2.1+MybatisPlus+Sharding-JDBC+Druidè¿æ¥æ± </p><p>é˜¿é‡Œé•œåƒï¼šæ¯”è¾ƒå¿«</p><p><a href="https://start.aliyun.com/">https://start.aliyun.com/</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220413200217.png"></p><p><strong>å»ºè¡¨</strong></p><p>ä¸¤å¼ ç»“æ„ä¸€æ ·</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220413214847.png"></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>course_1<span class="token punctuation">`</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>course_1<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>cid<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'è¯¾ç¨‹id'</span><span class="token punctuation">,</span><span class="token punctuation">`</span>cname<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'è¯¾ç¨‹å'</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'è¯¾ç¨‹è€å¸ˆ'</span><span class="token punctuation">,</span><span class="token punctuation">`</span>cstatus<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'è¯¾ç¨‹çŠ¶æ€'</span><span class="token punctuation">,</span><span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>cid<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>course_2<span class="token punctuation">`</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>course_2<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>cid<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'è¯¾ç¨‹id'</span><span class="token punctuation">,</span><span class="token punctuation">`</span>cname<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'è¯¾ç¨‹å'</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'è¯¾ç¨‹è€å¸ˆ'</span><span class="token punctuation">,</span><span class="token punctuation">`</span>cstatus<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'è¯¾ç¨‹çŠ¶æ€'</span><span class="token punctuation">,</span><span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>cid<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€å»ºmodel"><a href="#2ã€å»ºmodel" class="headerlink" title="2ã€å»ºmodel"></a>2ã€å»ºmodel</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220413200115.png"></p><h4 id="3ã€å¯¼pom"><a href="#3ã€å¯¼pom" class="headerlink" title="3ã€å¯¼pom"></a>3ã€å¯¼pom</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.0.0-RC1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€åŸºç¡€ä¸šåŠ¡ä»£ç "><a href="#4ã€åŸºç¡€ä¸šåŠ¡ä»£ç " class="headerlink" title="4ã€åŸºç¡€ä¸šåŠ¡ä»£ç "></a>4ã€åŸºç¡€ä¸šåŠ¡ä»£ç </h4><h5 id="1ã€entiry"><a href="#1ã€entiry" class="headerlink" title="1ã€entiry"></a>1ã€entiry</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>entiry</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Course</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> cid<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> cname<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> cstatus<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€mapper"><a href="#2ã€mapper" class="headerlink" title="2ã€mapper"></a>2ã€mapper</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">BaseMapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CourseMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CourseMapper</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€æ‰«æé…ç½®"><a href="#3ã€æ‰«æé…ç½®" class="headerlink" title="3ã€æ‰«æé…ç½®"></a>3ã€æ‰«æé…ç½®</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>shardingjdbc</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"com.kk.shardingjdbc.entiry.mapper"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShardingjdbcApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span>run <span class="token punctuation">(</span><span class="token class-name">ShardingjdbcApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€å†™-application-properties"><a href="#5ã€å†™-application-properties" class="headerlink" title="5ã€å†™ application.properties"></a>5ã€å†™ application.properties</h4><h5 id="mysql-æ•°æ®æº-8-0çš„è¯"><a href="#mysql-æ•°æ®æº-8-0çš„è¯" class="headerlink" title="mysql æ•°æ®æº 8.0çš„è¯"></a>mysql æ•°æ®æº 8.0çš„è¯</h5><p>é©±åŠ¨åŒ…è·¯å¾„è¦åŠ  <strong>cj</strong>ï¼Œ<code>com.mysql.cj.jdbc.Driver</code></p><p>urlè¦åŠ **æ—¶åŒº[?serverTimezone=GMT%2B8]**ï¼Œ<code>jdbc:mysql://localhost:3306/sharding_jdbc1?serverTimezone=GMT%2B8</code></p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># shardingåˆ†ç‰‡ç­–ç•¥</span><span class="token comment"># é…ç½®æ•°æ®æºï¼Œç»™æ•°æ®æºèµ·åˆ«å</span>spring.shardingsphere.datasource.names=s1<span class="token comment"># é…ç½®æ•°æ®æºå…·ä½“å†…å®¹ï¼ŒåŒ…å«è¿æ¥æ± ï¼Œé©±åŠ¨ï¼Œåœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç </span>spring.shardingsphere.datasource.s1.type=com.alibaba.druid.pool.DruidDataSourcespring.shardingsphere.datasource.s1.driver<span class="token punctuation">-</span>class<span class="token punctuation">-</span>name=com.mysql.jdbc.Driverspring.shardingsphere.datasource.s1.url=jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/sharding_jdbc1spring.shardingsphere.datasource.s1.username=rootspring.shardingsphere.datasource.s1.password=a1b2c3<span class="token comment"># æŒ‡å®š course è¡¨åˆ†å¸ƒæƒ…å†µï¼Œé…ç½®è¡¨åœ¨å“ªä¸ªæ•°æ®åº“é‡Œé¢ï¼Œè¡¨åç§°éƒ½æ˜¯ä»€ä¹ˆ s1.course_1 , s1.course_2</span><span class="token comment">#course æ˜¯è¡¨çš„å‰ç¼€ï¼Œ  {1,2}æ˜¯è¡¨çš„åç¼€ï¼Œè¡¨ç¤ºæœ‰course1 å’Œ course2</span>spring.shardingsphere.sharding.tables.course.actual<span class="token punctuation">-</span>data<span class="token punctuation">-</span>nodes=s1.course_$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>1..2<span class="token punctuation">}</span><span class="token comment"># æŒ‡å®š ä»¥courseä¸ºå‰ç¼€çš„è¡¨é‡Œé¢ä¸»é”® cid ã€‚ç”Ÿæˆç­–ç•¥ SNOWFLAKEï¼ˆé›ªèŠ±ç®—æ³•ï¼‰</span>spring.shardingsphere.sharding.tables.course.key<span class="token punctuation">-</span>generator.column=cidspring.shardingsphere.sharding.tables.course.key<span class="token punctuation">-</span>generator.type=SNOWFLAKE<span class="token comment"># æŒ‡å®šåˆ†ç‰‡ç­–ç•¥ï¼Œçº¦å®š cidå€¼ä¸ºå¶æ•°æ·»åŠ åˆ°è¡¨ course_1, å¥‡æ•°åˆ° course_2</span><span class="token comment">#course æ˜¯è¡¨çš„å‰ç¼€</span><span class="token comment">#ç¬¬äºŒè¡Œçš„å–æ¨¡åï¼Œ+1 æ“ä½œé˜²æ­¢å–æ¨¡åä¸º 0</span>spring.shardingsphere.sharding.tables.course.table<span class="token punctuation">-</span>strategy.inline.sharding<span class="token punctuation">-</span>column=cidspring.shardingsphere.sharding.tables.course.table<span class="token punctuation">-</span>strategy.inline.algorithm<span class="token punctuation">-</span>expression=course_$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>cid % 2 + 1<span class="token punctuation">}</span><span class="token comment"># æ‰“å¼€sql è¾“å‡ºæ—¥å¿—</span>spring.shardingsphere.props.sql.show=true<span class="token comment"># è§£å†³ä¸€ä¸ªå®ä½“å¯¹åº”ä¸¤ä¸ªè¡¨é—®é¢˜</span>spring.main.allow<span class="token punctuation">-</span>bean<span class="token punctuation">-</span>definition<span class="token punctuation">-</span>overriding=true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ã€æµ‹è¯•ç±»"><a href="#6ã€æµ‹è¯•ç±»" class="headerlink" title="6ã€æµ‹è¯•ç±»"></a>6ã€æµ‹è¯•ç±»</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>shardingjdbc</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>entiry<span class="token punctuation">.</span></span><span class="token class-name">Course</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">CourseMapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SpringBootTest</span><span class="token keyword">class</span> <span class="token class-name">ShardingjdbcApplicationTests</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">CourseMapper</span> courseMapper<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCourse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">Course</span> course <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Course</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            course<span class="token punctuation">.</span>setCname <span class="token punctuation">(</span><span class="token string">"java"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            course<span class="token punctuation">.</span>setUserId <span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            course<span class="token punctuation">.</span>setCstatus <span class="token punctuation">(</span><span class="token string">"Normal"</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            courseMapper<span class="token punctuation">.</span>insert <span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>        <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">searchCourse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Course</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        wrapper<span class="token punctuation">.</span>eq <span class="token punctuation">(</span><span class="token string">"cid"</span><span class="token punctuation">,</span><span class="token number">721132131354411008L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Course</span> course <span class="token operator">=</span> courseMapper<span class="token punctuation">.</span>selectOne <span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>course <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220413224245.png"></p><h3 id="4ã€æ¡ˆä¾‹äºŒ"><a href="#4ã€æ¡ˆä¾‹äºŒ" class="headerlink" title="4ã€æ¡ˆä¾‹äºŒ"></a>4ã€æ¡ˆä¾‹äºŒ</h3><p>åŸºäºæ¡ˆä¾‹ä¸€æ‰©å±•</p><h4 id="1ã€å½“å‰åº“ç»“æ„"><a href="#1ã€å½“å‰åº“ç»“æ„" class="headerlink" title="1ã€å½“å‰åº“ç»“æ„"></a>1ã€å½“å‰åº“ç»“æ„</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220414205043.png"></p><h4 id="2ã€application-properties"><a href="#2ã€application-properties" class="headerlink" title="2ã€application.properties"></a>2ã€application.properties</h4><pre class="line-numbers language-application.properties" data-language="application.properties"><code class="language-application.properties"># shardingåˆ†ç‰‡ç­–ç•¥# é…ç½®æ•°æ®æºï¼Œç»™æ•°æ®æºèµ·åˆ«åspring.shardingsphere.datasource.names=s1,s2# é…ç½®æ•°æ®æºå…·ä½“å†…å®¹ï¼ŒåŒ…å«è¿æ¥æ± ï¼Œé©±åŠ¨ï¼Œåœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç spring.shardingsphere.datasource.s1.type=com.alibaba.druid.pool.DruidDataSourcespring.shardingsphere.datasource.s1.driver-class-name=com.mysql.cj.jdbc.Driverspring.shardingsphere.datasource.s1.url=jdbc:mysql://localhost:3306/sharding_jdbc1?serverTimezone=GMT%2B8spring.shardingsphere.datasource.s1.username=rootspring.shardingsphere.datasource.s1.password=a1b2c3# é…ç½®æ•°æ®æºå…·ä½“å†…å®¹ï¼ŒåŒ…å«è¿æ¥æ± ï¼Œé©±åŠ¨ï¼Œåœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç spring.shardingsphere.datasource.s2.type=com.alibaba.druid.pool.DruidDataSourcespring.shardingsphere.datasource.s2.driver-class-name=com.mysql.cj.jdbc.Driverspring.shardingsphere.datasource.s2.url=jdbc:mysql://localhost:3306/sharding_jdbc2?serverTimezone=GMT%2B8spring.shardingsphere.datasource.s2.username=rootspring.shardingsphere.datasource.s2.password=a1b2c3#---------------------------------------------------------------------------------------------------# æŒ‡å®š course è¡¨åˆ†å¸ƒæƒ…å†µï¼Œé…ç½®è¡¨åœ¨å“ªä¸ªæ•°æ®åº“é‡Œé¢ï¼Œè¡¨åç§°éƒ½æ˜¯ä»€ä¹ˆ s1.course_1 , s1.course_2#course æ˜¯è¡¨çš„å‰ç¼€ï¼Œ  {1,2}æ˜¯è¡¨çš„åç¼€ï¼Œè¡¨ç¤ºæœ‰course1 å’Œ course2#spring.shardingsphere.sharding.tables.course.actual-data-nodes=s1.course_$-&gt;{1..2}# é…ç½®ä¸¤ä¸ªæ•°æ®åº“spring.shardingsphere.sharding.tables.course.actual-data-nodes=s$-&gt;{1..2}.course_$-&gt;{1..2}# æŒ‡å®š ä»¥courseä¸ºå‰ç¼€çš„è¡¨é‡Œé¢ä¸»é”® cid ã€‚ç”Ÿæˆç­–ç•¥ SNOWFLAKEï¼ˆé›ªèŠ±ç®—æ³•ï¼‰spring.shardingsphere.sharding.tables.course.key-generator.column=cidspring.shardingsphere.sharding.tables.course.key-generator.type=SNOWFLAKE# æŒ‡å®šåˆ†ç‰‡ç­–ç•¥ï¼Œçº¦å®š cidå€¼ä¸ºå¶æ•°æ·»åŠ åˆ°è¡¨ course_1, å¥‡æ•°åˆ° course_2#course æ˜¯è¡¨çš„å‰ç¼€#ç¬¬äºŒè¡Œçš„å–æ¨¡åï¼Œ+1 æ“ä½œé˜²æ­¢å–æ¨¡åä¸º 0spring.shardingsphere.sharding.tables.course.table-strategy.inline.sharding-column=cidspring.shardingsphere.sharding.tables.course.table-strategy.inline.algorithm-expression=course_$-&gt;{cid % 2 + 1}# æŒ‡å®šæ•°æ®åº“åˆ†ç‰‡ç­–ç•¥#çº¦å®šuser_idæ˜¯å¶æ•°æ·»åŠ m1ï¼Œæ˜¯å¥‡æ•°æ·»åŠ m2spring.shardingsphere.sharding.tables.course.database-strategy.inline.sharding-column=user_idspring.shardingsphere.sharding.tables.course.database-strategy.inline.algorithm-expression=s$-&gt;{user_id % 2 + 1}# æ‰“å¼€sql è¾“å‡ºæ—¥å¿—spring.shardingsphere.props.sql.show=true# è§£å†³ä¸€ä¸ªå®ä½“å¯¹åº”ä¸¤ä¸ªè¡¨é—®é¢˜spring.main.allow-bean-definition-overriding=true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>shardingjdbc</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">QueryWrapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>entiry<span class="token punctuation">.</span></span><span class="token class-name">Course</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>shardingjdbc<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">CourseMapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SpringBootTest</span><span class="token keyword">class</span> <span class="token class-name">ShardingjdbcApplicationTests</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">CourseMapper</span> courseMapper<span class="token punctuation">;</span>    <span class="token comment">//----------------ä»¥ä¸‹æ˜¯æ°´å¹³åˆ†åº“æµ‹è¯•</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">Course</span> course <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Course</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            course<span class="token punctuation">.</span>setUserId <span class="token punctuation">(</span><span class="token number">0L</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>            course<span class="token punctuation">.</span>setCname <span class="token punctuation">(</span><span class="token string">"java"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>            course<span class="token punctuation">.</span>setCstatus <span class="token punctuation">(</span><span class="token string">"Normal"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>            courseMapper<span class="token punctuation">.</span>insert <span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Course</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        wrapper<span class="token punctuation">.</span>isNotNull <span class="token punctuation">(</span><span class="token string">"cid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        courseMapper<span class="token punctuation">.</span>delete <span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">//----------------ä»¥ä¸‹æ˜¯æ°´å¹³åˆ†è¡¨æµ‹è¯•</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCourse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">Course</span> course <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Course</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            course<span class="token punctuation">.</span>setCname <span class="token punctuation">(</span><span class="token string">"java"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>            course<span class="token punctuation">.</span>setUserId <span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            course<span class="token punctuation">.</span>setCstatus <span class="token punctuation">(</span><span class="token string">"Normal"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>            courseMapper<span class="token punctuation">.</span>insert <span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">searchCourse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Course</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        wrapper<span class="token punctuation">.</span>eq <span class="token punctuation">(</span><span class="token string">"cid"</span><span class="token punctuation">,</span> <span class="token number">721132131354411008L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Course</span> course <span class="token operator">=</span> courseMapper<span class="token punctuation">.</span>selectOne <span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5ã€æ¡ˆä¾‹ä¸‰"><a href="#5ã€æ¡ˆä¾‹ä¸‰" class="headerlink" title="5ã€æ¡ˆä¾‹ä¸‰"></a>5ã€æ¡ˆä¾‹ä¸‰</h3><h4 id="1ã€å»ºè¡¨"><a href="#1ã€å»ºè¡¨" class="headerlink" title="1ã€å»ºè¡¨"></a>1ã€å»ºè¡¨</h4><h4 id="2ã€"><a href="#2ã€" class="headerlink" title="2ã€"></a>2ã€</h4><h2 id="ä¸‰ã€Sharding-JDBCæ‰§è¡ŒåŸç†"><a href="#ä¸‰ã€Sharding-JDBCæ‰§è¡ŒåŸç†" class="headerlink" title="ä¸‰ã€Sharding-JDBCæ‰§è¡ŒåŸç†"></a>ä¸‰ã€Sharding-JDBCæ‰§è¡ŒåŸç†</h2><h3 id="1ã€"><a href="#1ã€" class="headerlink" title="1ã€"></a>1ã€</h3><h3 id="2ã€-1"><a href="#2ã€-1" class="headerlink" title="2ã€"></a>2ã€</h3><h3 id="3ã€"><a href="#3ã€" class="headerlink" title="3ã€"></a>3ã€</h3><h3 id="4ã€"><a href="#4ã€" class="headerlink" title="4ã€"></a>4ã€</h3><h3 id="5ã€"><a href="#5ã€" class="headerlink" title="5ã€"></a>5ã€</h3><h2 id="å››ã€åˆ†åº“åˆ†è¡¨åˆ†ç±»"><a href="#å››ã€åˆ†åº“åˆ†è¡¨åˆ†ç±»" class="headerlink" title="å››ã€åˆ†åº“åˆ†è¡¨åˆ†ç±»"></a>å››ã€åˆ†åº“åˆ†è¡¨åˆ†ç±»</h2><h3 id="1ã€-1"><a href="#1ã€-1" class="headerlink" title="1ã€"></a>1ã€</h3><h3 id="2ã€-2"><a href="#2ã€-2" class="headerlink" title="2ã€"></a>2ã€</h3><h3 id="3ã€-1"><a href="#3ã€-1" class="headerlink" title="3ã€"></a>3ã€</h3><h3 id="4ã€-1"><a href="#4ã€-1" class="headerlink" title="4ã€"></a>4ã€</h3><h3 id="5ã€-1"><a href="#5ã€-1" class="headerlink" title="5ã€"></a>5ã€</h3><h2 id="äº”ã€Mysqlä¸»ä»æ­å»º"><a href="#äº”ã€Mysqlä¸»ä»æ­å»º" class="headerlink" title="äº”ã€Mysqlä¸»ä»æ­å»º"></a>äº”ã€Mysqlä¸»ä»æ­å»º</h2><h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><p><strong><a href="/posts/d9c3bea0#toc-heading-4">è·¯ç”±ï¼šnacosé«˜å¯ç”¨æ­å»º</a></strong></p><h2 id="å…­ã€è¯»å†™åˆ†ç¦»"><a href="#å…­ã€è¯»å†™åˆ†ç¦»" class="headerlink" title="å…­ã€è¯»å†™åˆ†ç¦»"></a>å…­ã€è¯»å†™åˆ†ç¦»</h2><h3 id="1ã€-2"><a href="#1ã€-2" class="headerlink" title="1ã€"></a>1ã€</h3><h3 id="2ã€-3"><a href="#2ã€-3" class="headerlink" title="2ã€"></a>2ã€</h3><h3 id="3ã€-2"><a href="#3ã€-2" class="headerlink" title="3ã€"></a>3ã€</h3><h3 id="4ã€-2"><a href="#4ã€-2" class="headerlink" title="4ã€"></a>4ã€</h3><h3 id="5ã€-2"><a href="#5ã€-2" class="headerlink" title="5ã€"></a>5ã€</h3><h2 id="å‚è€ƒæ–‡æ¡£-â†“"><a href="#å‚è€ƒæ–‡æ¡£-â†“" class="headerlink" title="å‚è€ƒæ–‡æ¡£ â†“"></a>å‚è€ƒæ–‡æ¡£ â†“</h2><p><a href="https://blog.csdn.net/unique_perfect/article/details/116134490">https://blog.csdn.net/unique_perfect/article/details/116134490</a></p><p><a href="https://www.kuangstudy.com/zl/sharding#1369532356595126274">https://www.kuangstudy.com/zl/sharding#1369532356595126274</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ä¸­é—´ä»¶" scheme="https://mykkto.github.io/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
    <category term="ShardingSphere" scheme="https://mykkto.github.io/tags/ShardingSphere/"/>
    
    <category term="åˆ†åº“åˆ†è¡¨" scheme="https://mykkto.github.io/tags/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/"/>
    
    <category term="jdbc" scheme="https://mykkto.github.io/tags/jdbc/"/>
    
  </entry>
  
  <entry>
    <title>Luaè„šæœ¬è¯­è¨€åŸºç¡€</title>
    <link href="https://mykkto.github.io/posts/fafe363a.html"/>
    <id>https://mykkto.github.io/posts/fafe363a.html</id>
    <published>2022-04-03T15:17:13.000Z</published>
    <updated>2022-11-12T15:07:08.042Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><h3 id="1ã€æ¦‚å¿µ"><a href="#1ã€æ¦‚å¿µ" class="headerlink" title="1ã€æ¦‚å¿µ"></a>1ã€æ¦‚å¿µ</h3><p>Luaæ˜¯ä¸€ç§è½»é‡ã€å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ã€‚è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åˆ°å…¶ä»–åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚</p><h3 id="2ã€ç‰¹æ€§"><a href="#2ã€ç‰¹æ€§" class="headerlink" title="2ã€ç‰¹æ€§"></a>2ã€ç‰¹æ€§</h3><p>è·Ÿå…¶ä»–è¯­è¨€è¿›è¡Œæ¯”è¾ƒï¼ŒLuaæœ‰å…¶è‡ªèº«çš„ç‰¹ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰è½»é‡çº§</p><pre class="line-numbers language-none"><code class="language-none">Luaç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ï¼Œç¼–è¯‘åä»…ä»…ä¸€ç™¾ä½™åƒå­—èŠ‚ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åµŒå…¥åˆ°å…¶ä»–ç¨‹åºä¸­ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ï¼ˆ2ï¼‰å¯æ‰©å±•</p><pre class="line-numbers language-none"><code class="language-none">Luaæä¾›éå¸¸ä¸°å¯Œæ˜“äºä½¿ç”¨çš„æ‰©å±•æ¥å£å’Œæœºåˆ¶ï¼Œç”±å®¿ä¸»è¯­è¨€(é€šå¸¸æ˜¯Cæˆ–C++)æä¾›åŠŸèƒ½ï¼ŒLuaå¯ä»¥ä½¿ç”¨å®ƒä»¬ï¼Œå°±åƒå†…ç½®çš„åŠŸèƒ½ä¸€æ ·ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ï¼ˆ3ï¼‰æ”¯æŒé¢å‘è¿‡ç¨‹ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹</p><h3 id="3ã€åº”ç”¨åœºæ™¯"><a href="#3ã€åº”ç”¨åœºæ™¯" class="headerlink" title="3ã€åº”ç”¨åœºæ™¯"></a>3ã€åº”ç”¨åœºæ™¯</h3><p>Luaåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­å¾—åˆ°å¤§é‡åº”ç”¨ï¼Œåœºæ™¯çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹:</p><p>æ¸¸æˆå¼€å‘ã€ç‹¬ç«‹åº”ç”¨è„šæœ¬ã€webåº”ç”¨è„šæœ¬ã€æ‰©å±•å’Œæ•°æ®åº“æ’ä»¶ã€ç³»ç»Ÿå®‰å…¨ä¸Šã€‚</p><h2 id="äºŒã€å®‰è£…"><a href="#äºŒã€å®‰è£…" class="headerlink" title="äºŒã€å®‰è£…"></a>äºŒã€å®‰è£…</h2><h3 id="1ã€å®˜ç½‘"><a href="#1ã€å®˜ç½‘" class="headerlink" title="1ã€å®˜ç½‘"></a>1ã€å®˜ç½‘</h3><p>åœ¨linuxä¸Šå®‰è£…Luaéå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸‹è½½æºç åŒ…å¹¶åœ¨ç»ˆç«¯è§£å‹ã€ç¼–è¯‘å³å¯ä½¿ç”¨ã€‚</p><p>Luaçš„å®˜ç½‘åœ°å€ä¸º:<code>https://www.lua.org</code></p><h3 id="2ã€ä¸‹è½½å¹¶ä¸”è§£å‹"><a href="#2ã€ä¸‹è½½å¹¶ä¸”è§£å‹" class="headerlink" title="2ã€ä¸‹è½½å¹¶ä¸”è§£å‹"></a>2ã€ä¸‹è½½å¹¶ä¸”è§£å‹</h3><h4 id="1ã€ä¸‹è½½"><a href="#1ã€ä¸‹è½½" class="headerlink" title="1ã€ä¸‹è½½"></a>1ã€ä¸‹è½½</h4><pre class="line-numbers language-none"><code class="language-none">wget https://www.lua.org/ftp/lua-5.4.1.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€å®‰è£…ä¾èµ–"><a href="#2ã€å®‰è£…ä¾èµ–" class="headerlink" title="2ã€å®‰è£…ä¾èµ–"></a>2ã€å®‰è£…ä¾èµ–</h4><p>libreadline-devä¾èµ–åŒ…ï¼Œéœ€è¦é€šè¿‡å‘½ä»¤æ¥è¿›è¡Œå®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> -y readline-devel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3ã€è§£å‹"><a href="#3ã€è§£å‹" class="headerlink" title="3ã€è§£å‹"></a>3ã€è§£å‹</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> zxvf lua-5.4.1.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4ã€ç¼–è¯‘å®‰è£…"><a href="#4ã€ç¼–è¯‘å®‰è£…" class="headerlink" title="4ã€ç¼–è¯‘å®‰è£…"></a>4ã€ç¼–è¯‘å®‰è£…</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> lua-5.4.1<span class="token function">make</span> linux<span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€éªŒè¯"><a href="#5ã€éªŒè¯" class="headerlink" title="5ã€éªŒè¯"></a>5ã€éªŒè¯</h4><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua">lua <span class="token operator">-</span>v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä¸‰ã€Luaçš„è¯­æ³•"><a href="#ä¸‰ã€Luaçš„è¯­æ³•" class="headerlink" title="ä¸‰ã€Luaçš„è¯­æ³•"></a>ä¸‰ã€Luaçš„è¯­æ³•</h2><h3 id="1ã€ç¬¬ä¸€ä¸ªç¨‹åº"><a href="#1ã€ç¬¬ä¸€ä¸ªç¨‹åº" class="headerlink" title="1ã€ç¬¬ä¸€ä¸ªç¨‹åº"></a>1ã€ç¬¬ä¸€ä¸ªç¨‹åº</h3><h4 id="1ã€è¿›å…¥æ§åˆ¶å°æ“ä½œ"><a href="#1ã€è¿›å…¥æ§åˆ¶å°æ“ä½œ" class="headerlink" title="1ã€è¿›å…¥æ§åˆ¶å°æ“ä½œ"></a>1ã€è¿›å…¥æ§åˆ¶å°æ“ä½œ</h4><p>1ã€ç”¨ <code>lua</code>è¿›å…¥</p><p>2ã€ç¼–å†™è¾“å‡ºè¯­å¥ï¼Œprint(â€œxxxxâ€)</p><p>3ã€ctrl+D é€€å‡ºæ§åˆ¶å°</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220404120524.png"></p><h4 id="2ã€lua-æ–‡ä»¶è¿è¡Œ"><a href="#2ã€lua-æ–‡ä»¶è¿è¡Œ" class="headerlink" title="2ã€lua æ–‡ä»¶è¿è¡Œ"></a>2ã€lua æ–‡ä»¶è¿è¡Œ</h4><p>1ã€åˆ›å»º test.lua</p><p>2ã€ç¼–å†™è¯­å¥ï¼Œä¿å­˜</p><p>3ã€è¿è¡Œ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220404121521.png"></p><p>3ã€luaç›´æ¥è¿è¡Œ</p><p>1ã€åˆ›å»º test2.lua</p><p>2ã€ç¼–å†™è¯­å¥çš„æ—¶å€™å‰ç¼€åŠ ä¸Šå£°æ˜ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ</p><p><code>#!/usr/local/bin/lua</code></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220404121846.png"></p><p>3ã€æ–‡ä»¶èµ‹æƒé™ï¼Œè¿è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token number">755</span> test2.lua./test2.lua<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220404122053.png"></p><h3 id="2ã€æ³¨é‡Š"><a href="#2ã€æ³¨é‡Š" class="headerlink" title="2ã€æ³¨é‡Š"></a>2ã€æ³¨é‡Š</h3><h4 id="1ã€å•è¡Œæ³¨é‡Šçš„è¯­æ³•ä¸ºï¼š"><a href="#1ã€å•è¡Œæ³¨é‡Šçš„è¯­æ³•ä¸ºï¼š" class="headerlink" title="1ã€å•è¡Œæ³¨é‡Šçš„è¯­æ³•ä¸ºï¼š"></a>1ã€å•è¡Œæ³¨é‡Šçš„è¯­æ³•ä¸ºï¼š</h4><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token comment">--æ³¨é‡Šå†…å®¹</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€å¤šè¡Œæ³¨é‡Šçš„è¯­æ³•ä¸º"><a href="#2ã€å¤šè¡Œæ³¨é‡Šçš„è¯­æ³•ä¸º" class="headerlink" title="2ã€å¤šè¡Œæ³¨é‡Šçš„è¯­æ³•ä¸º:"></a>2ã€å¤šè¡Œæ³¨é‡Šçš„è¯­æ³•ä¸º:</h4><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token comment">--[[æ³¨é‡Šå†…å®¹æ³¨é‡Šå†…å®¹--]]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€å–æ¶ˆå¤šè¡Œ"><a href="#3ã€å–æ¶ˆå¤šè¡Œ" class="headerlink" title="3ã€å–æ¶ˆå¤šè¡Œ"></a>3ã€å–æ¶ˆå¤šè¡Œ</h4><p>å¦‚æœæƒ³å–æ¶ˆå¤šè¡Œæ³¨é‡Šï¼Œåªéœ€è¦åœ¨ç¬¬ä¸€ä¸ªâ€“ä¹‹å‰åœ¨åŠ ä¸€ä¸ª-å³å¯ï¼Œå¦‚ï¼š</p><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token comment">---[[</span>æ³¨é‡Šå†…å®¹æ³¨é‡Šå†…å®¹<span class="token comment">--]]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€æ ‡è¯†ç¬¦"><a href="#3ã€æ ‡è¯†ç¬¦" class="headerlink" title="3ã€æ ‡è¯†ç¬¦"></a>3ã€æ ‡è¯†ç¬¦</h3><p>æ¢å¥è¯è¯´æ ‡è¯†ç¬¦å°±æ˜¯æˆ‘ä»¬çš„<strong>å˜é‡å</strong>ï¼ŒLuaå®šä¹‰å˜é‡åä»¥ä¸€ä¸ªå­—æ¯ A åˆ° Z æˆ– a åˆ° z æˆ–ä¸‹åˆ’çº¿ _ å¼€å¤´ååŠ ä¸Š0ä¸ªæˆ–å¤šä¸ªå­—æ¯ï¼Œä¸‹åˆ’çº¿ï¼Œæ•°å­—ï¼ˆ0åˆ°9ï¼‰ã€‚è¿™å—å»ºè®®å¤§å®¶æœ€å¥½ä¸è¦ä½¿ç”¨ä¸‹åˆ’çº¿åŠ å¤§å†™å­—æ¯çš„æ ‡è¯†ç¬¦ï¼Œå› ä¸ºLuaçš„ä¿ç•™å­—ä¹Ÿæ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œå®¹æ˜“å‘ç”Ÿå†²çªã€‚æ³¨æ„Luaæ˜¯åŒºåˆ†å¤§å°å†™å­—æ¯çš„ã€‚</p><p>ç®€å•æ¥è¯´å‚è€ƒjavaè§„èŒƒå°±å¥½</p><h3 id="4ã€å…³é”®å­—"><a href="#4ã€å…³é”®å­—" class="headerlink" title="4ã€å…³é”®å­—"></a>4ã€å…³é”®å­—</h3><p>ä¸‹åˆ—æ˜¯Luaçš„å…³é”®å­—ï¼Œå¤§å®¶åœ¨å®šä¹‰å¸¸é‡ã€å˜é‡æˆ–å…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰æ ‡è¯†ç¬¦éƒ½è¦é¿å…ä½¿ç”¨ä»¥ä¸‹è¿™äº›å…³é”®å­—ï¼š</p><table><thead><tr><th>and</th><th>break</th><th>do</th><th>else</th></tr></thead><tbody><tr><td>elseif</td><td>end</td><td>false</td><td>for</td></tr><tr><td>function</td><td>if</td><td>in</td><td>local</td></tr><tr><td>nil</td><td>not</td><td>or</td><td>repeat</td></tr><tr><td>return</td><td>then</td><td>true</td><td>until</td></tr><tr><td>while</td><td>goto</td><td></td><td></td></tr></tbody></table><p>ä¸€èˆ¬çº¦å®šï¼Œä»¥ä¸‹åˆ’çº¿å¼€å¤´è¿æ¥ä¸€ä¸²å¤§å†™å­—æ¯çš„åå­—ï¼ˆæ¯”å¦‚ _VERSIONï¼‰è¢«ä¿ç•™ç”¨äº Lua å†…éƒ¨å…¨å±€å˜é‡ã€‚è¿™ä¸ªä¹Ÿæ˜¯ä¸Šé¢æˆ‘ä»¬ä¸å»ºè®®è¿™ä¹ˆå®šä¹‰æ ‡è¯†ç¬¦çš„åŸå› ã€‚</p><h3 id="5ã€è¿ç®—ç¬¦"><a href="#5ã€è¿ç®—ç¬¦" class="headerlink" title="5ã€è¿ç®—ç¬¦"></a>5ã€è¿ç®—ç¬¦</h3><p>Luaä¸­æ”¯æŒçš„è¿ç®—ç¬¦æœ‰ç®—æœ¯è¿ç®—ç¬¦ã€å…³ç³»è¿ç®—ç¬¦ã€é€»è¾‘è¿ç®—ç¬¦ã€å…¶ä»–è¿ç®—ç¬¦ã€‚</p><p>ç®—æœ¯è¿ç®—ç¬¦:</p><pre class="line-numbers language-none"><code class="language-none">+   åŠ æ³•-å‡æ³•*ä¹˜æ³•/é™¤æ³•%å–ä½™^ä¹˜å¹‚-è´Ÿå·<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚:</p><pre class="line-numbers language-none"><code class="language-none">10+20--&gt;3020-10--&gt;1010*20--&gt;20020/10--&gt;23%2--&gt;110^2--&gt;100-10--&gt;-10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³ç³»è¿ç®—ç¬¦</p><pre class="line-numbers language-none"><code class="language-none">==ç­‰äº~=ä¸ç­‰äº&gt;å¤§äº&lt;å°äº&gt;=å¤§äºç­‰äº&lt;=å°äºç­‰äº<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¾‹å¦‚:</p><pre class="line-numbers language-none"><code class="language-none">10==10--&gt;true10~=10--&gt;false20&gt;10--&gt;true20&lt;10--&gt;false20&gt;=10--&gt;true20&lt;=10--&gt;false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€»è¾‘è¿ç®—ç¬¦</p><pre class="line-numbers language-none"><code class="language-none">andé€»è¾‘ä¸ A and B     &amp;&amp;   oré€»è¾‘æˆ– A or B     ||noté€»è¾‘é  å–åï¼Œå¦‚æœä¸ºtrue,åˆ™è¿”å›false  !<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é€»è¾‘è¿ç®—ç¬¦å¯ä»¥ä½œä¸ºifçš„åˆ¤æ–­æ¡ä»¶ï¼Œè¿”å›çš„ç»“æœå¦‚ä¸‹:</p><pre class="line-numbers language-none"><code class="language-none">A = trueB = trueA and B--&gt;trueA or  B --&gt;truenot A --&gt;false------------------------------------------------------------------------------------------------A = trueB = falseA and B--&gt;falseA or  B --&gt;truenot A --&gt;false------------------------------------------------------------------------------------------------A = falseB = trueA and B--&gt;falseA or  B --&gt;truenot A --&gt;true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä»–è¿ç®—ç¬¦</p><pre class="line-numbers language-none"><code class="language-none">..è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²#ä¸€å…ƒé¢„ç®—æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²æˆ–è¡¨çš„é•¿åº¦<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¾‹å¦‚:</p><pre class="line-numbers language-none"><code class="language-none">&gt; "HELLO ".."WORLD"--&gt;HELLO WORLD&gt; #"HELLO"--&gt;5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h3 id="6ã€å…¨å±€å˜é‡-amp-å±€éƒ¨å˜é‡"><a href="#6ã€å…¨å±€å˜é‡-amp-å±€éƒ¨å˜é‡" class="headerlink" title="6ã€å…¨å±€å˜é‡&amp;å±€éƒ¨å˜é‡"></a>6ã€å…¨å±€å˜é‡&amp;å±€éƒ¨å˜é‡</h3><p>åœ¨Luaè¯­è¨€ä¸­ï¼Œå…¨å±€å˜é‡æ— é¡»å£°æ˜å³å¯ä½¿ç”¨ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ€»æ˜¯è®¤ä¸ºæ˜¯å…¨å±€çš„ï¼Œå¦‚æœæœªæå‰èµ‹å€¼ï¼Œé»˜è®¤ä¸ºnil:</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220404123008.png"></p><p>è¦æƒ³å£°æ˜ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œéœ€è¦ä½¿ç”¨localæ¥å£°æ˜</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220404123115.png"></p><h3 id="7ã€Luaæ•°æ®ç±»å‹"><a href="#7ã€Luaæ•°æ®ç±»å‹" class="headerlink" title="7ã€Luaæ•°æ®ç±»å‹"></a>7ã€Luaæ•°æ®ç±»å‹</h3><p>Luaæœ‰8ä¸ªæ•°æ®ç±»å‹</p><pre class="line-numbers language-none"><code class="language-none">nil(ç©ºï¼Œæ— æ•ˆå€¼)boolean(å¸ƒå°”ï¼Œtrue/false)number(æ•°å€¼)string(å­—ç¬¦ä¸²)function(å‡½æ•°)tableï¼ˆè¡¨ï¼‰thread(çº¿ç¨‹)userdataï¼ˆç”¨æˆ·æ•°æ®ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥ä½¿ç”¨typeå‡½æ•°æµ‹è¯•ç»™å®šå˜é‡æˆ–è€…çš„ç±»å‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">print(type(nil))--&gt;nilprint(type(true))               --&gt; booleanprint(type(1.1*1.1))             --&gt; numberprint(type("Hello world"))      --&gt; stringprint(type(type(X)))            --&gt; string  ï¼Œtypeå‡½æ•°è¿”å›çš„ä¹Ÿæ˜¯å­—ç¬¦ä¸²ç±»å‹print(type(print))              --&gt; functionprint(type(type))               --&gt;functionprint(type{})--&gt;tableprint(type(io.stdin))--&gt;userdata<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="nil"><a href="#nil" class="headerlink" title="nil"></a>nil</h5><p>nilæ˜¯ä¸€ç§åªæœ‰ä¸€ä¸ªnilå€¼çš„ç±»å‹ï¼Œå®ƒçš„ä½œç”¨å¯ä»¥ç”¨æ¥ä¸å…¶ä»–æ‰€æœ‰å€¼è¿›è¡ŒåŒºåˆ†ï¼Œä¹Ÿå¯ä»¥å½“æƒ³è¦ç§»é™¤ä¸€ä¸ªå˜é‡æ—¶ï¼Œåªéœ€è¦å°†è¯¥å˜é‡åèµ‹å€¼ä¸ºnil,åƒåœ¾å›æ”¶å°±ä¼šä¼šé‡Šæ”¾è¯¥å˜é‡æ‰€å ç”¨çš„å†…å­˜ã€‚</p><h5 id="boolean"><a href="#boolean" class="headerlink" title="boolean"></a>boolean</h5><p>booleanç±»å‹å…·æœ‰ä¸¤ä¸ªå€¼ï¼Œtrueå’Œfalseã€‚booleanç±»å‹ä¸€èˆ¬è¢«ç”¨æ¥åšæ¡ä»¶åˆ¤æ–­çš„çœŸä¸å‡ã€‚åœ¨Luaè¯­è¨€ä¸­ï¼Œåªä¼šå°†falseå’Œnilè§†ä¸ºå‡ï¼Œå…¶ä»–çš„éƒ½è§†ä¸ºçœŸï¼Œç‰¹åˆ«æ˜¯åœ¨æ¡ä»¶æ£€æµ‹ä¸­0å’Œç©ºå­—ç¬¦ä¸²éƒ½ä¼šè®¤ä¸ºæ˜¯çœŸï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„å¤§å¤šæ•°è¯­è¨€ä¸å¤ªä¸€æ ·ã€‚</p><h5 id="number"><a href="#number" class="headerlink" title="number"></a>number</h5><p>åœ¨Lua5.3ç‰ˆæœ¬å¼€å§‹ï¼ŒLuaè¯­è¨€ä¸ºæ•°å€¼æ ¼å¼æä¾›äº†ä¸¤ç§é€‰æ‹©:integer(æ•´å‹)å’Œfloat(åŒç²¾åº¦æµ®ç‚¹å‹)[å’Œå…¶ä»–è¯­è¨€ä¸å¤ªä¸€æ ·ï¼Œfloatä¸ä»£è¡¨å•ç²¾åº¦ç±»å‹]ã€‚</p><p>æ•°å€¼å¸¸é‡çš„è¡¨ç¤ºæ–¹å¼:</p><pre class="line-numbers language-none"><code class="language-none">&gt;4--&gt;4&gt;0.4--&gt;0.4&gt;4.75e-3--&gt;0.00475&gt;4.75e3--&gt;4750<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ç®¡æ˜¯æ•´å‹è¿˜æ˜¯åŒç²¾åº¦æµ®ç‚¹å‹ï¼Œä½¿ç”¨type()å‡½æ•°æ¥å–å…¶ç±»å‹ï¼Œéƒ½ä¼šè¿”å›çš„æ˜¯number</p><pre class="line-numbers language-none"><code class="language-none">&gt;type(3)--&gt;number&gt;type(3.3)--&gt;number<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‰€ä»¥å®ƒä»¬ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ï¼ŒåŒæ—¶ï¼Œå…·æœ‰ç›¸åŒç®—æœ¯å€¼çš„æ•´å‹å€¼å’Œæµ®ç‚¹å‹å€¼åœ¨Luaè¯­è¨€ä¸­æ˜¯ç›¸ç­‰çš„</p><h5 id="string"><a href="#string" class="headerlink" title="string"></a>string</h5><p>Luaè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å³å¯ä»¥è¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€æ•´æœ¬ä¹¦ç±ã€‚åœ¨Luaè¯­è¨€ä¸­ï¼Œæ“ä½œ100Kæˆ–è€…1Mä¸ªå­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²çš„ç¨‹åºå¾ˆå¸¸è§ã€‚</p><p>å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·æ¥å£°æ˜å­—ç¬¦ä¸²</p><pre class="line-numbers language-none"><code class="language-none">&gt;a = "hello"&gt;b = 'world'&gt;print(a)--&gt;hello&gt;print(b) --&gt;world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœå£°æ˜çš„å­—ç¬¦ä¸²æ¯”è¾ƒé•¿æˆ–è€…æœ‰å¤šè¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œå£°æ˜</p><pre class="line-numbers language-none"><code class="language-none">html = [[&lt;html&gt;&lt;head&gt;&lt;title&gt;Lua-string&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;a href="http://www.lua.org"&gt;Lua&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;]]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="table"><a href="#table" class="headerlink" title="table"></a>table</h5><p>â€‹    tableæ˜¯Luaè¯­è¨€ä¸­æœ€ä¸»è¦å’Œå¼ºå¤§çš„æ•°æ®ç»“æ„ã€‚ä½¿ç”¨è¡¨ï¼Œ Lua è¯­è¨€å¯ä»¥ä»¥ä¸€ç§ç®€å•ã€ç»Ÿä¸€ä¸”é«˜æ•ˆçš„æ–¹å¼è¡¨ç¤ºæ•°ç»„ã€é›†åˆã€è®°å½•å’Œå…¶ä»–å¾ˆå¤šæ•°æ®ç»“æ„ã€‚ Luaè¯­è¨€ä¸­çš„è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è¾…åŠ©æ•°ç»„ã€‚è¿™ç§æ•°ç»„æ¯”Javaä¸­çš„æ•°ç»„æ›´åŠ çµæ´»ï¼Œå¯ä»¥ä½¿ç”¨æ•°å€¼åšç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æˆ–å…¶ä»–ä»»æ„ç±»å‹çš„å€¼ä½œç´¢å¼•(é™¤nilå¤–)ã€‚</p><p>åˆ›å»ºè¡¨çš„æœ€ç®€å•æ–¹å¼:</p><pre class="line-numbers language-none"><code class="language-none">&gt; a = {}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ›å»ºæ•°ç»„:</p><p>â€‹    æˆ‘ä»¬éƒ½çŸ¥é“æ•°ç»„å°±æ˜¯ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ æŒ‰ç…§ä¸€å®šé¡ºåºæ’åˆ—çš„é›†åˆï¼Œé‚£ä¹ˆä½¿ç”¨tableå¦‚ä½•åˆ›å»ºä¸€ä¸ªæ•°ç»„å‘¢?</p><pre class="line-numbers language-none"><code class="language-none">&gt;arr = {"TOM","JERRY","ROSE"}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>â€‹    è¦æƒ³è·å–æ•°ç»„ä¸­çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å†…å®¹æ¥è·å–:</p><pre class="line-numbers language-none"><code class="language-none">print(arr[0])nilprint(arr[1])TOMprint(arr[2])JERRYprint(arr[3])ROSE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>â€‹    ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ•°ç»„çš„ä¸‹æ ‡é»˜è®¤æ˜¯ä»1å¼€å§‹çš„ã€‚æ‰€ä»¥ä¸Šè¿°åˆ›å»ºæ•°ç»„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥åˆ›å»º</p><pre class="line-numbers language-none"><code class="language-none">&gt;arr = {}&gt;arr[1] = "TOM"&gt;arr[2] = "JERRY"&gt;arr[3] = "ROSE"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œè¡¨çš„ç´¢å¼•å³å¯ä»¥æ˜¯æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç­‰å…¶ä»–çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç´¢å¼•æ›´æ”¹ä¸ºå­—ç¬¦ä¸²æ¥åˆ›å»º</p><pre class="line-numbers language-none"><code class="language-none">&gt;arr = {}&gt;arr["X"] = 10&gt;arr["Y"] = 20&gt;arr["Z"] = 30<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ç„¶ï¼Œå¦‚æœæƒ³è¦è·å–è¿™äº›æ•°ç»„ä¸­çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼</p><pre class="line-numbers language-none"><code class="language-none">æ–¹å¼ä¸€&gt;print(arr["X"])&gt;print(arr["Y"])&gt;print(arr["Z"])æ–¹å¼äºŒ&gt;print(arr.X)&gt;print(arr.Y)&gt;print(arr.Z)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“å‰tableçš„çµæ´»ä¸è¿›äºæ­¤ï¼Œè¿˜æœ‰æ›´çµæ´»çš„å£°æ˜æ–¹å¼</p><pre class="line-numbers language-none"><code class="language-none">&gt;arr = {"TOM",X=10,"JERRY",Y=20,"ROSE",Z=30}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚ä½•è·å–ä¸Šé¢çš„å€¼?</p><pre class="line-numbers language-none"><code class="language-none">TOM :  arr[1]10  :  arr["X"] | arr.XJERRY: arr[2]20  :  arr["Y"] | arr.YROESE?<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="function"><a href="#function" class="headerlink" title="function"></a>function</h5><p>åœ¨ Luaè¯­è¨€ä¸­ï¼Œå‡½æ•°ï¼ˆ Function ï¼‰æ˜¯å¯¹è¯­å¥å’Œè¡¨è¾¾å¼è¿›è¡ŒæŠ½è±¡çš„ä¸»è¦æ–¹å¼ã€‚</p><p>å®šä¹‰å‡½æ•°çš„è¯­æ³•ä¸º:</p><pre class="line-numbers language-none"><code class="language-none">function functionName(params)end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ä¸ªæ•°ä¸å®šä¹‰å‡½æ•°æ—¶ä½¿ç”¨çš„å‚æ•°ä¸ªæ•°ä¸ä¸€è‡´çš„æ—¶å€™ï¼ŒLua è¯­è¨€ä¼šé€šè¿‡ æŠ›å¼ƒå¤šä½™å‚æ•°å’Œå°†ä¸è¶³çš„å‚æ•°è®¾ä¸º nil çš„æ–¹å¼æ¥è°ƒæ•´å‚æ•°çš„ä¸ªæ•°ã€‚</p><pre class="line-numbers language-none"><code class="language-none">function  f(a,b)print(a,b)endf()--&gt; nil  nilf(2)--&gt; 2 nilf(2,6)--&gt; 2 6f(2.6.8)--&gt; 2 6 (8è¢«ä¸¢å¼ƒ)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯å˜é•¿å‚æ•°å‡½æ•°</p><pre class="line-numbers language-none"><code class="language-none">function add(...)a,b,c=...print(a)print(b)print(c)endadd(1,2,3)  --&gt; 1 2 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‡½æ•°è¿”å›å€¼å¯ä»¥æœ‰å¤šä¸ªï¼Œè¿™ç‚¹å’ŒJavaä¸å¤ªä¸€æ ·</p><pre class="line-numbers language-none"><code class="language-none">function f(a,b)return a,bendx,y=f(11,22)--&gt; x=11,y=22<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="thread"><a href="#thread" class="headerlink" title="thread"></a>thread</h5><p>threadç¿»è¯‘è¿‡æ¥æ˜¯çº¿ç¨‹çš„æ„æ€ï¼Œåœ¨Luaä¸­ï¼Œthreadç”¨æ¥è¡¨ç¤ºæ‰§è¡Œçš„ç‹¬ç«‹çº¿è·¯ï¼Œç”¨æ¥æ‰§è¡ŒååŒç¨‹åºã€‚</p><h5 id="userdata"><a href="#userdata" class="headerlink" title="userdata"></a>userdata</h5><p>userdataæ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œç”¨äºè¡¨ç¤ºä¸€ç§ç”±åº”ç”¨ç¨‹åºæˆ–C/C++è¯­è¨€åº“æ‰€åˆ›å»ºçš„ç±»å‹ã€‚</p><h3 id="8ã€Luaæ§åˆ¶ç»“æ„"><a href="#8ã€Luaæ§åˆ¶ç»“æ„" class="headerlink" title="8ã€Luaæ§åˆ¶ç»“æ„"></a>8ã€Luaæ§åˆ¶ç»“æ„</h3><p>Lua è¯­è¨€æä¾›äº†ä¸€ç»„ç²¾ç®€ä¸”å¸¸ç”¨çš„æ§åˆ¶ç»“æ„ï¼ŒåŒ…æ‹¬ç”¨äºæ¡ä»¶æ‰§è¡Œçš„è¯ ä»¥åŠç”¨äºå¾ªç¯çš„ whileã€ repeat å’Œ forã€‚ æ‰€æœ‰çš„æ§åˆ¶ç»“æ„è¯­æ³•ä¸Šéƒ½æœ‰ä¸€ä¸ªæ˜¾å¼çš„ç»ˆç»“ç¬¦ï¼š end ç”¨äºç»ˆç»“ ifã€ for åŠ while ç»“æ„ï¼Œ until ç”¨äºç»ˆç»“ repeat ç»“æ„ã€‚</p><h5 id="if-then-elseif-else"><a href="#if-then-elseif-else" class="headerlink" title="if then elseif else"></a>if then elseif else</h5><p>ifè¯­å¥å…ˆæµ‹è¯•å…¶æ¡ä»¶ï¼Œå¹¶æ ¹æ®æ¡ä»¶æ˜¯å¦æ»¡è¶³æ‰§è¡Œç›¸åº”çš„ then éƒ¨åˆ†æˆ– else éƒ¨åˆ†ã€‚ else éƒ¨åˆ† æ˜¯å¯é€‰çš„ã€‚</p><pre class="line-numbers language-none"><code class="language-none">function testif(a) if a&gt;0 then print("aæ˜¯æ­£æ•°") endendfunction testif(a) if a&gt;0 then print("aæ˜¯æ­£æ•°") else print("aæ˜¯è´Ÿæ•°") endend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœè¦ç¼–å†™åµŒå¥—çš„ if è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨ elseifã€‚ å®ƒç±»ä¼¼äºåœ¨ else åé¢ç´§è·Ÿä¸€ä¸ªifã€‚æ ¹æ®ä¼ å…¥çš„å¹´é¾„è¿”å›ä¸åŒçš„ç»“æœï¼Œå¦‚</p><pre class="line-numbers language-none"><code class="language-none">age&lt;=18 é’å°‘å¹´ï¼Œage&gt;18 , age &lt;=45 é’å¹´age&gt;45 , age&lt;=60 ä¸­å¹´äººage&gt;60 è€å¹´äººfunction show(age)if age&lt;=18 then return "é’å°‘å¹´"elseif age&gt;18 and age&lt;=45 then return "é’å¹´"elseif age&gt;45 and age&lt;=60 then return "ä¸­å¹´äºº"elseif age&gt;60 then return "è€å¹´äºº"endend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="whileå¾ªç¯"><a href="#whileå¾ªç¯" class="headerlink" title="whileå¾ªç¯"></a>whileå¾ªç¯</h5><p>é¡¾åæ€ä¹‰ï¼Œå½“æ¡ä»¶ä¸ºçœŸæ—¶ while å¾ªç¯ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ã€‚ Lua è¯­è¨€å…ˆæµ‹è¯• while è¯­å¥ çš„æ¡ä»¶ï¼Œè‹¥æ¡ä»¶ä¸ºå‡åˆ™å¾ªç¯ç»“æŸï¼›å¦åˆ™ï¼Œ Lua ä¼šæ‰§è¡Œå¾ªç¯ä½“å¹¶ä¸æ–­åœ°é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚</p><p>è¯­æ³•ï¼š</p><pre class="line-numbers language-none"><code class="language-none">while æ¡ä»¶ do  å¾ªç¯ä½“end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¾‹å­:å®ç°æ•°ç»„çš„å¾ªç¯</p><pre class="line-numbers language-none"><code class="language-none">function testWhile() local i = 1 while i&lt;=10 do  print(i)  i=i+1 endend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="repeatå¾ªç¯"><a href="#repeatå¾ªç¯" class="headerlink" title="repeatå¾ªç¯"></a>repeatå¾ªç¯</h5><p>é¡¾åæ€ä¹‰ï¼Œ repeat-untilè¯­å¥ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ç›´åˆ°æ¡ä»¶ä¸ºçœŸæ—¶ç»“æŸã€‚ ç”±äºæ¡ä»¶æµ‹è¯•åœ¨å¾ªç¯ä½“ä¹‹åæ‰§è¡Œï¼Œæ‰€ä»¥å¾ªç¯ä½“è‡³å°‘ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p><p>è¯­æ³•</p><pre class="line-numbers language-none"><code class="language-none">repeat å¾ªç¯ä½“ until æ¡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">function testRepeat() local i = 10 repeat  print(i)  i=i-1 until i &lt; 1end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="forå¾ªç¯"><a href="#forå¾ªç¯" class="headerlink" title="forå¾ªç¯"></a>forå¾ªç¯</h5><p>æ•°å€¼å‹forå¾ªç¯</p><p>è¯­æ³•</p><pre class="line-numbers language-none"><code class="language-none">for param=exp1,exp2,exp3 do å¾ªç¯ä½“end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>paramçš„å€¼ä»exp1å˜åŒ–åˆ°exp2ä¹‹å‰çš„æ¯æ¬¡å¾ªç¯ä¼šæ‰§è¡Œ å¾ªç¯ä½“ï¼Œå¹¶åœ¨æ¯æ¬¡å¾ªç¯ç»“æŸåå°†æ­¥é•¿(step)exp3å¢åŠ åˆ°paramä¸Šã€‚exp3å¯é€‰ï¼Œå¦‚æœä¸è®¾ç½®é»˜è®¤ä¸º1</p><p>äººè¯ï¼šä»è¾“å‡º1å¼€å§‹ï¼Œæ¯æ¬¡ +10ï¼Œå°äº100ï¼ˆ1ï¼Œ11ï¼Œ21ï¼Œâ€¦,91ï¼‰</p><pre class="line-numbers language-none"><code class="language-none">for i = 1,100,10 doprint(i)end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ³›å‹forå¾ªç¯</p><p>æ³›å‹forå¾ªç¯é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°æ¥éå†æ‰€æœ‰å€¼ï¼Œç±»ä¼¼äºjavaä¸­çš„foreachè¯­å¥ã€‚</p><p>è¯­æ³•</p><pre class="line-numbers language-none"><code class="language-none">for i,v in ipairs(x) doå¾ªç¯ä½“end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>iæ˜¯æ•°ç»„ç´¢å¼•å€¼ï¼Œvæ˜¯å¯¹åº”ç´¢å¼•çš„æ•°ç»„å…ƒç´ å€¼ï¼Œipairsæ˜¯Luaæä¾›çš„ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°ï¼Œç”¨æ¥è¿­ä»£æ•°ç»„ï¼Œxæ˜¯è¦éå†çš„æ•°ç»„ã€‚</p><p>ä¾‹å¦‚:</p><pre class="line-numbers language-none"><code class="language-none">arr = {"TOME","JERRY","ROWS","LUCY"}for i,v in ipairs(arr) do print(i,v)end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šè¿°å®ä¾‹è¾“å‡ºçš„ç»“æœä¸º</p><pre class="line-numbers language-none"><code class="language-none">1TOM2JERRY3ROWS4LUCY<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯å¦‚æœå°†arrçš„å€¼è¿›è¡Œä¿®æ”¹ä¸º</p><pre class="line-numbers language-none"><code class="language-none">arr = {"TOME","JERRY","ROWS",x="JACK","LUCY"}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŒæ ·çš„ä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±åªèƒ½çœ‹åˆ°å’Œä¹‹å‰ä¸€æ ·çš„ç»“æœï¼Œè€Œå…¶ä¸­çš„xä¸ºJACKå°±æ— æ³•éå†å‡ºæ¥ï¼Œç¼ºå¤±äº†æ•°æ®ï¼Œå¦‚æœè§£å†³å‘¢?</p><p>æˆ‘ä»¬å¯ä»¥å°†è¿­ä»£å™¨å‡½æ•°å˜æˆpairs,å¦‚</p><pre class="line-numbers language-none"><code class="language-none">for i,v in pairs(arr) do print(i,v)end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¸Šè¿°å®ä¾‹å°±è¾“å‡ºçš„ç»“æœä¸º</p><pre class="line-numbers language-none"><code class="language-none">1TOM2JERRY3ROWS4LUCYxJACK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å››ã€OpenResty"><a href="#å››ã€OpenResty" class="headerlink" title="å››ã€OpenResty"></a>å››ã€OpenResty</h2><h3 id="1ã€åŸºæœ¬æ“ä½œ"><a href="#1ã€åŸºæœ¬æ“ä½œ" class="headerlink" title="1ã€åŸºæœ¬æ“ä½œ"></a>1ã€åŸºæœ¬æ“ä½œ</h3><h4 id="1ã€æ˜¯ä»€ä¹ˆ"><a href="#1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h4><p>OpenRestyæ˜¯ä¸€ä¸ªåŸºäºNginxä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚æ‰€ä»¥æœ¬èº«OpenRestyå†…éƒ¨å°±å·²ç»é›†æˆäº†Nginxå’ŒLuaï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ã€‚</p><h4 id="2ã€å®‰è£…"><a href="#2ã€å®‰è£…" class="headerlink" title="2ã€å®‰è£…"></a>2ã€å®‰è£…</h4><p><strong><a href="/posts/829b453d">è¯¦æƒ…å¯è§ã€OpenRestyã€‘</a></strong></p><h5 id="1ã€æ‹‰å–"><a href="#1ã€æ‹‰å–" class="headerlink" title="1ã€æ‹‰å–"></a>1ã€æ‹‰å–</h5><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker pull openresty/openresty<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="2ã€æŒ‚è½½å¹¶å¯åŠ¨"><a href="#2ã€æŒ‚è½½å¹¶å¯åŠ¨" class="headerlink" title="2ã€æŒ‚è½½å¹¶å¯åŠ¨"></a>2ã€æŒ‚è½½å¹¶å¯åŠ¨</h5><p><strong>è¯´æ˜ä¸‹ï¼š</strong></p><ul><li>å®Œå…¨åŸºäºä¸Šé¢çš„nginxé…ç½®çš„ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå”¯ä¸€ä¿®æ”¹çš„æ˜¯ <code>nginx.conf</code>é…ç½®æ–‡ä»¶ï¼Œè¿™è¾¹æŒ‚è½½æ”¹æˆäº† <code>nginx2.conf</code>ï¼Œç”¨äºä¿ç•™ä¹‹å‰çš„ï¼ˆè‡ªå·±æ‡’è€Œå·²ï¼‰</li><li>æ–°å¢äº†ï¼Œluaæ–‡ä»¶æŒ‚è½½</li><li>ä¿®æ”¹äº†å®¹å™¨å†…çš„æŒ‚è½½ä½ç½®ï¼Œå› ä¸º openrestyå®¹å™¨ä½ç½®ä¸ä¸€æ ·äº†(å¤–éƒ¨è¿˜æ˜¯ä¸å˜ï¼Œå®¹å™¨å†…çš„ä½ç½®å˜äº†)</li></ul><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 443<span class="token punctuation">:</span>443 <span class="token punctuation">-</span>p 80<span class="token punctuation">:</span>80 <span class="token punctuation">-</span><span class="token punctuation">-</span>name openresty <span class="token punctuation">-</span>v /root/nginx/www<span class="token punctuation">:</span>/usr/local/openresty/nginx/html <span class="token punctuation">-</span>v /root/nginx/conf/nginx2.conf<span class="token punctuation">:</span>/usr/local/openresty/nginx/conf/nginx.conf <span class="token punctuation">-</span>v /root/nginx/logs<span class="token punctuation">:</span>/usr/local/openresty/nginx/logs <span class="token punctuation">-</span>v  /root/nginx/lls/<span class="token punctuation">:</span>/usr/local/openresty/nginx/ssl <span class="token punctuation">-</span>v  /root/nginx/lua/<span class="token punctuation">:</span>/usr/local/openresty/nginx/lua  openresty/openresty<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2ã€ngx-luaçš„ä½¿ç”¨"><a href="#2ã€ngx-luaçš„ä½¿ç”¨" class="headerlink" title="2ã€ngx_luaçš„ä½¿ç”¨"></a>2ã€ngx_luaçš„ä½¿ç”¨</h3><p>ä½¿ç”¨Luaç¼–å†™Nginxè„šæœ¬çš„åŸºæœ¬æ„å»ºå—æ˜¯æŒ‡ä»¤ã€‚æŒ‡ä»¤ç”¨äºæŒ‡å®šä½•æ—¶è¿è¡Œç”¨æˆ·Luaä»£ç ä»¥åŠå¦‚ä½•ä½¿ç”¨ç»“æœã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æ‰§è¡ŒæŒ‡ä»¤çš„é¡ºåºã€‚ </p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220404144653.png"></p><p>å…ˆæ¥è§£é‡Šä¸‹*çš„ä½œç”¨</p><pre class="line-numbers language-none"><code class="language-none">*ï¼šæ—  ï¼Œ å³ xxx_by_lua ,æŒ‡ä»¤åé¢è·Ÿçš„æ˜¯ luaæŒ‡ä»¤*:_fileï¼Œå³ xxx_by_lua_file æŒ‡ä»¤åé¢è·Ÿçš„æ˜¯ luaæ–‡ä»¶*:_block,å³ xxx_by_lua_block åœ¨0.9.17ç‰ˆåæ›¿æ¢init_by_lua_file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="init-by-lua"><a href="#init-by-lua" class="headerlink" title="init_by_lua*"></a>init_by_lua*</h4><pre class="line-numbers language-none"><code class="language-none">è¯¥æŒ‡ä»¤åœ¨æ¯æ¬¡Nginxé‡æ–°åŠ è½½é…ç½®æ—¶æ‰§è¡Œï¼Œå¯ä»¥ç”¨æ¥å®Œæˆä¸€äº›è€—æ—¶æ¨¡å—çš„åŠ è½½ï¼Œæˆ–è€…åˆå§‹åŒ–ä¸€äº›å…¨å±€é…ç½®ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="init-worker-by-lua"><a href="#init-worker-by-lua" class="headerlink" title="init_worker_by_lua*"></a>init_worker_by_lua*</h4><pre class="line-numbers language-none"><code class="language-none">è¯¥æŒ‡ä»¤ç”¨äºå¯åŠ¨ä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œå¦‚å¿ƒè·³æ£€æŸ¥ã€å®šæ—¶æ‹‰å–æœåŠ¡å™¨é…ç½®ç­‰ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="set-by-lua"><a href="#set-by-lua" class="headerlink" title="set_by_lua*"></a>set_by_lua*</h4><pre class="line-numbers language-none"><code class="language-none">è¯¥æŒ‡ä»¤åªè¦ç”¨æ¥åšå˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¸€æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶å°†ç»“æœèµ‹å€¼ç»™Nginxä¸­æŒ‡å®šçš„å˜é‡ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="rewrite-by-lua"><a href="#rewrite-by-lua" class="headerlink" title="rewrite_by_lua*"></a>rewrite_by_lua*</h4><pre class="line-numbers language-none"><code class="language-none">è¯¥æŒ‡ä»¤ç”¨äºæ‰§è¡Œå†…éƒ¨URLé‡å†™æˆ–è€…å¤–éƒ¨é‡å®šå‘ï¼Œå…¸å‹çš„å¦‚ä¼ªé™æ€åŒ–URLé‡å†™ï¼Œæœ¬é˜¶æ®µåœ¨rewriteå¤„ç†é˜¶æ®µçš„æœ€åé»˜è®¤æ‰§è¡Œã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="access-by-lua"><a href="#access-by-lua" class="headerlink" title="access_by_lua*"></a>access_by_lua*</h4><pre class="line-numbers language-none"><code class="language-none">è¯¥æŒ‡ä»¤ç”¨äºè®¿é—®æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªå…è®¸å†…ç½‘IPè®¿é—®ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="content-by-lua"><a href="#content-by-lua" class="headerlink" title="content_by_lua*"></a>content_by_lua*</h4><pre class="line-numbers language-none"><code class="language-none">è¯¥æŒ‡ä»¤æ˜¯åº”ç”¨æœ€å¤šçš„æŒ‡ä»¤ï¼Œå¤§éƒ¨åˆ†ä»»åŠ¡æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µå®Œæˆçš„ï¼Œå…¶ä»–çš„è¿‡ç¨‹å¾€å¾€ä¸ºè¿™ä¸ªé˜¶æ®µå‡†å¤‡æ•°æ®ï¼Œæ­£å¼å¤„ç†åŸºæœ¬éƒ½åœ¨æœ¬é˜¶æ®µã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="header-filter-by-lua"><a href="#header-filter-by-lua" class="headerlink" title="header_filter_by_lua*"></a>header_filter_by_lua*</h4><pre class="line-numbers language-none"><code class="language-none">è¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®åº”ç­”æ¶ˆæ¯çš„å¤´éƒ¨ä¿¡æ¯ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="body-filter-by-lua"><a href="#body-filter-by-lua" class="headerlink" title="body_filter_by_lua*"></a>body_filter_by_lua*</h4><pre class="line-numbers language-none"><code class="language-none">è¯¥æŒ‡ä»¤æ˜¯å¯¹å“åº”æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æˆªæ–­ã€æ›¿æ¢ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="log-by-lua"><a href="#log-by-lua" class="headerlink" title="log_by_lua*"></a>log_by_lua*</h4><pre class="line-numbers language-none"><code class="language-none">è¯¥æŒ‡ä»¤ç”¨äºåœ¨logè¯·æ±‚å¤„ç†é˜¶æ®µï¼Œç”¨Luaä»£ç å¤„ç†æ—¥å¿—ï¼Œä½†å¹¶ä¸æ›¿æ¢åŸæœ‰logå¤„ç†ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="balancer-by-lua"><a href="#balancer-by-lua" class="headerlink" title="balancer_by_lua*"></a>balancer_by_lua*</h4><pre class="line-numbers language-none"><code class="language-none">è¯¥æŒ‡ä»¤ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç°ä¸Šæ¸¸æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å™¨ç®—æ³•<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="ssl-certificate-by"><a href="#ssl-certificate-by" class="headerlink" title="ssl_certificate_by_*"></a>ssl_certificate_by_*</h4><pre class="line-numbers language-none"><code class="language-none">è¯¥æŒ‡ä»¤ä½œç”¨åœ¨Nginxå’Œä¸‹æ¸¸æœåŠ¡å¼€å§‹ä¸€ä¸ªSSLæ¡æ‰‹æ“ä½œæ—¶å°†å…è®¸æœ¬é…ç½®é¡¹çš„Luaä»£ç ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚:"></a>éœ€æ±‚:</h4><pre class="line-numbers language-none"><code class="language-none">http://192.168.200.133?name=å¼ ä¸‰&amp;gender=1Nginxæ¥æ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ®genderä¼ å…¥çš„å€¼ï¼Œå¦‚æœgenderä¼ å…¥çš„æ˜¯1ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰å…ˆç”Ÿ,å¦‚æœgenderä¼ å…¥çš„æ˜¯0ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰å¥³å£«,å¦‚æœæœªä¼ æˆ–è€…ä¼ å…¥çš„ä¸æ˜¯1å’Œ2åˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å®ç°ä»£ç </p><p><strong>æ³¨æ„</strong>ï¼šåŠ å…¥é…ç½®æ–‡ä»¶çš„æ—¶å€™ #å†…å®¹è¦å»æ‰</p><pre class="line-numbers language-none"><code class="language-none">location /getByGender {default_type 'text/html';set_by_lua $name "#è·å–è¯·æ±‚urlä¸Šçš„å€¼ nameï¼Œgenderlocal uri_args = ngx.req.get_uri_args()gender = uri_args['gender']name = uri_args['name']if gender=='1' thenreturn name..'å…ˆç”Ÿ'elseif gender=='0' thenreturn name..'å¥³å£«'elsereturn nameend";#è§£å†³ä¹±ç é—®é¢˜charset utf-8;return 200 $name;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1649073290089.png" alt="1649073290089"></p><h3 id="3ã€ngx-luaæ“ä½œRedis"><a href="#3ã€ngx-luaæ“ä½œRedis" class="headerlink" title="3ã€ngx_luaæ“ä½œRedis"></a>3ã€ngx_luaæ“ä½œRedis</h3><h4 id="1ã€ApiåŠå…¶è¯­å¥è¯´æ˜"><a href="#1ã€ApiåŠå…¶è¯­å¥è¯´æ˜" class="headerlink" title="1ã€ApiåŠå…¶è¯­å¥è¯´æ˜"></a>1ã€ApiåŠå…¶è¯­å¥è¯´æ˜</h4><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua">lua<span class="token operator">-</span>resty<span class="token operator">-</span>redisæä¾›äº†è®¿é—®Redisçš„è¯¦ç»†APIï¼ŒåŒ…æ‹¬åˆ›å»ºå¯¹æ¥ã€è¿æ¥ã€æ“ä½œã€æ•°æ®å¤„ç†ç­‰ã€‚è¿™äº›APIåŸºæœ¬ä¸Šä¸Redisçš„æ“ä½œä¸€ä¸€å¯¹åº”ã€‚ï¼ˆ<span class="token number">1</span>ï¼‰redis <span class="token operator">=</span> require <span class="token string">"resty.redis"</span>ï¼ˆ<span class="token number">2</span>ï¼‰newè¯­æ³•<span class="token punctuation">:</span> redis<span class="token punctuation">,</span>err <span class="token operator">=</span> redis<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>åˆ›å»ºä¸€ä¸ªRediså¯¹è±¡ã€‚ï¼ˆ<span class="token number">3</span>ï¼‰connectè¯­æ³•<span class="token punctuation">:</span>ok<span class="token punctuation">,</span>err<span class="token operator">=</span>redis<span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">[</span><span class="token punctuation">,</span>options_table<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>è®¾ç½®è¿æ¥Redisçš„è¿æ¥ä¿¡æ¯ã€‚ok<span class="token punctuation">:</span>è¿æ¥æˆåŠŸè¿”å› <span class="token number">1</span>ï¼Œè¿æ¥å¤±è´¥è¿”å›<span class="token keyword">nil</span>err<span class="token punctuation">:</span>è¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ï¼ˆ<span class="token number">4</span>ï¼‰set_timeoutè¯­æ³•<span class="token punctuation">:</span> redis<span class="token punctuation">:</span><span class="token function">set_timeout</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span> ï¼Œè®¾ç½®è¯·æ±‚æ“ä½œRedisçš„è¶…æ—¶æ—¶é—´ã€‚ï¼ˆ<span class="token number">5</span>ï¼‰closeè¯­æ³•<span class="token punctuation">:</span> ok<span class="token punctuation">,</span>err <span class="token operator">=</span> redis<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>å…³é—­å½“å‰è¿æ¥ï¼ŒæˆåŠŸè¿”å›<span class="token number">1</span>ï¼Œå¤±è´¥è¿”å›<span class="token keyword">nil</span>å’Œé”™è¯¯ä¿¡æ¯ï¼ˆ<span class="token number">6</span>ï¼‰rediså‘½ä»¤å¯¹åº”çš„æ–¹æ³•åœ¨lua<span class="token operator">-</span>resty<span class="token operator">-</span>redisä¸­ï¼Œæ‰€æœ‰çš„Rediså‘½ä»¤éƒ½æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œæ–¹æ³•åå­—å’Œå‘½ä»¤åå­—ç›¸åŒï¼Œåªæ˜¯å…¨éƒ¨ä¸ºå°å†™ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€å®ç°"><a href="#2ã€å®ç°" class="headerlink" title="2ã€å®ç°"></a>2ã€å®ç°</h4><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua">location <span class="token operator">/</span><span class="token function">testRedis</span> <span class="token punctuation">{</span>    default_type <span class="token string">"text/html"</span><span class="token punctuation">;</span>    <span class="token function">content_by_lua_block</span><span class="token punctuation">{</span>        <span class="token keyword">local</span> redis <span class="token operator">=</span> require <span class="token string">"resty.redis"</span> <span class="token comment">-- å¼•å…¥Redis</span>        <span class="token keyword">local</span> redisObj <span class="token operator">=</span> redis<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">--åˆ›å»ºRediså¯¹è±¡</span>        redisObj<span class="token punctuation">:</span><span class="token function">set_timeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">--è®¾ç½®è¶…æ—¶æ•°æ®ä¸º1s</span>        <span class="token keyword">local</span> ok<span class="token punctuation">,</span>err <span class="token operator">=</span> redisObj<span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"10.0.4.7"</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span> <span class="token comment">--è®¾ç½®redisè¿æ¥ä¿¡æ¯ï¼Œè¿™è¾¹ä¸è¦ç”¨127.0.0.1</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> ok <span class="token keyword">then</span> <span class="token comment">--åˆ¤æ–­æ˜¯å¦è¿æ¥æˆåŠŸ</span>         ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"failed to connection redis"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>         <span class="token keyword">return</span>        <span class="token keyword">end</span>        ok<span class="token punctuation">,</span>err <span class="token operator">=</span> redisObj<span class="token punctuation">:</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span><span class="token string">"TOM"</span><span class="token punctuation">)</span><span class="token comment">--å­˜å…¥æ•°æ®</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> ok <span class="token keyword">then</span> <span class="token comment">--åˆ¤æ–­æ˜¯å¦å­˜å…¥æˆåŠŸ</span>         ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"failed to set username"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>         <span class="token keyword">return</span>        <span class="token keyword">end</span>        <span class="token keyword">local</span> res<span class="token punctuation">,</span>err <span class="token operator">=</span> redisObj<span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token comment">--ä»redisä¸­è·å–æ•°æ®</span>        ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment">--å°†æ•°æ®å†™ä¼šæ¶ˆæ¯ä½“ä¸­</span>        redisObj<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220404220444.png"></p><h3 id="4ã€ngx-luaæ“ä½œMysql"><a href="#4ã€ngx-luaæ“ä½œMysql" class="headerlink" title="4ã€ngx_luaæ“ä½œMysql"></a>4ã€ngx_luaæ“ä½œMysql</h3><h4 id="1ã€æŸ¥è¯¢"><a href="#1ã€æŸ¥è¯¢" class="headerlink" title="1ã€æŸ¥è¯¢"></a>1ã€æŸ¥è¯¢</h4><h5 id="1ã€å‡†å¤‡"><a href="#1ã€å‡†å¤‡" class="headerlink" title="1ã€å‡†å¤‡"></a>1ã€å‡†å¤‡</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">driverClass</span><span class="token operator">=</span>com.mysql.jdbc.Driver<span class="token assign-left variable">url</span><span class="token operator">=</span>jdbc:mysql://10.0.4.7:3306/nginx_db<span class="token assign-left variable">username</span><span class="token operator">=</span>root<span class="token assign-left variable">password</span><span class="token operator">=</span>root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€å»ºåº“"><a href="#2ã€å»ºåº“" class="headerlink" title="2ã€å»ºåº“"></a>2ã€å»ºåº“</h5><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> users<span class="token punctuation">(</span>   id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>   username <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   birthday <span class="token keyword">date</span><span class="token punctuation">,</span>   salary <span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> users<span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>birthday<span class="token punctuation">,</span>salary<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">"TOM"</span><span class="token punctuation">,</span><span class="token string">"1988-11-11"</span><span class="token punctuation">,</span><span class="token number">10000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> users<span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>birthday<span class="token punctuation">,</span>salary<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">"JERRY"</span><span class="token punctuation">,</span><span class="token string">"1989-11-11"</span><span class="token punctuation">,</span><span class="token number">20000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> users<span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>birthday<span class="token punctuation">,</span>salary<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">"ROWS"</span><span class="token punctuation">,</span><span class="token string">"1990-11-11"</span><span class="token punctuation">,</span><span class="token number">30000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> users<span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>birthday<span class="token punctuation">,</span>salary<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">"LUCY"</span><span class="token punctuation">,</span><span class="token string">"1991-11-11"</span><span class="token punctuation">,</span><span class="token number">40000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> users<span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>birthday<span class="token punctuation">,</span>salary<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">"JACK"</span><span class="token punctuation">,</span><span class="token string">"1992-11-11"</span><span class="token punctuation">,</span><span class="token number">50000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€Apiè¯¦è§£"><a href="#3ã€Apiè¯¦è§£" class="headerlink" title="3ã€Apiè¯¦è§£"></a>3ã€Apiè¯¦è§£</h5><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua">ï¼ˆ<span class="token number">1</span>ï¼‰å¼•å…¥<span class="token string">"resty.mysql"</span>æ¨¡å—<span class="token keyword">local</span> mysql <span class="token operator">=</span> require <span class="token string">"resty.mysql"</span>ï¼ˆ<span class="token number">2</span>ï¼‰newåˆ›å»ºä¸€ä¸ªMySQLè¿æ¥å¯¹è±¡ï¼Œé‡åˆ°é”™è¯¯æ—¶ï¼Œdbä¸º<span class="token keyword">nil</span>ï¼Œerrä¸ºé”™è¯¯æè¿°ä¿¡æ¯è¯­æ³•<span class="token punctuation">:</span> db<span class="token punctuation">,</span>err <span class="token operator">=</span> mysql<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼ˆ<span class="token number">3</span>ï¼‰connectå°è¯•è¿æ¥åˆ°ä¸€ä¸ªMySQLæœåŠ¡å™¨è¯­æ³•<span class="token punctuation">:</span>ok<span class="token punctuation">,</span>err<span class="token operator">=</span>db<span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">,</span>optionsæ˜¯ä¸€ä¸ªå‚æ•°çš„Luaè¡¨ç»“æ„ï¼Œé‡Œé¢åŒ…å«æ•°æ®åº“è¿æ¥çš„ç›¸å…³ä¿¡æ¯    host<span class="token punctuation">:</span>æœåŠ¡å™¨ä¸»æœºåæˆ–IPåœ°å€    port<span class="token punctuation">:</span>æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º<span class="token number">3306</span>    user<span class="token punctuation">:</span>ç™»å½•çš„ç”¨æˆ·å    password<span class="token punctuation">:</span>ç™»å½•å¯†ç     database<span class="token punctuation">:</span>ä½¿ç”¨çš„æ•°æ®åº“åï¼ˆ<span class="token number">4</span>ï¼‰set_timeoutè®¾ç½®å­è¯·æ±‚çš„è¶…æ—¶æ—¶é—´<span class="token punctuation">(</span>ms<span class="token punctuation">)</span>ï¼ŒåŒ…æ‹¬connectæ–¹æ³•è¯­æ³•<span class="token punctuation">:</span>db<span class="token punctuation">:</span><span class="token function">set_timeout</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>ï¼ˆ<span class="token number">5</span>ï¼‰closeå…³é—­å½“å‰MySQLè¿æ¥å¹¶è¿”å›çŠ¶æ€ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›<span class="token number">1</span>ï¼›å¦‚æœå‡ºç°ä»»ä½•é”™è¯¯ï¼Œåˆ™å°†è¿”å›<span class="token keyword">nil</span>å’Œé”™è¯¯æè¿°ã€‚è¯­æ³•<span class="token punctuation">:</span>db<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ï¼ˆ<span class="token number">6</span>ï¼‰send_queryå¼‚æ­¥å‘è¿œç¨‹MySQLå‘é€ä¸€ä¸ªæŸ¥è¯¢ã€‚å¦‚æœæˆåŠŸåˆ™è¿”å›æˆåŠŸå‘é€çš„å­—èŠ‚æ•°ï¼›å¦‚æœé”™è¯¯ï¼Œåˆ™è¿”å›<span class="token keyword">nil</span>å’Œé”™è¯¯æè¿°è¯­æ³•<span class="token punctuation">:</span>bytes<span class="token punctuation">,</span>err<span class="token operator">=</span>db<span class="token punctuation">:</span><span class="token function">send_query</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span>ï¼ˆ<span class="token number">7</span>ï¼‰read_resultä»MySQLæœåŠ¡å™¨è¿”å›ç»“æœä¸­è¯»å–ä¸€è¡Œæ•°æ®ã€‚resè¿”å›ä¸€ä¸ªæè¿°OKåŒ…æˆ–ç»“æœé›†åŒ…çš„Luaè¡¨<span class="token punctuation">,</span>è¯­æ³•<span class="token punctuation">:</span>res<span class="token punctuation">,</span> err<span class="token punctuation">,</span> errcode<span class="token punctuation">,</span> sqlstate <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">read_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> res<span class="token punctuation">,</span> err<span class="token punctuation">,</span> errcode<span class="token punctuation">,</span> sqlstate <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">read_result</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span> <span class="token punctuation">:</span>rowsæŒ‡å®šè¿”å›ç»“æœé›†çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ä¸º<span class="token number">4</span>å¦‚æœæ˜¯æŸ¥è¯¢ï¼Œåˆ™è¿”å›ä¸€ä¸ªå®¹çº³å¤šè¡Œçš„æ•°ç»„ã€‚æ¯è¡Œæ˜¯ä¸€ä¸ªæ•°æ®åˆ—çš„key<span class="token operator">-</span>valueå¯¹ï¼Œå¦‚    <span class="token punctuation">{</span>      <span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token string">"TOM"</span><span class="token punctuation">,</span>birthday<span class="token operator">=</span><span class="token string">"1988-11-11"</span><span class="token punctuation">,</span>salary<span class="token operator">=</span><span class="token number">10000.0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token string">"JERRY"</span><span class="token punctuation">,</span>birthday<span class="token operator">=</span><span class="token string">"1989-11-11"</span><span class="token punctuation">,</span>salary<span class="token operator">=</span><span class="token number">20000.0</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span>å¦‚æœæ˜¯å¢åˆ æ”¹ï¼Œåˆ™è¿”å›ç±»ä¸Šå¦‚ä¸‹æ•°æ®    <span class="token punctuation">{</span>    insert_id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    server_status<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>    warning_count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>    affected_rows<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>    message<span class="token operator">=</span><span class="token keyword">nil</span>    <span class="token punctuation">}</span>è¿”å›å€¼<span class="token punctuation">:</span>res<span class="token punctuation">:</span>æ“ä½œçš„ç»“æœé›†err<span class="token punctuation">:</span>é”™è¯¯ä¿¡æ¯errcode<span class="token punctuation">:</span>MySQLçš„é”™è¯¯ç ï¼Œæ¯”å¦‚<span class="token number">1064</span>sqlstate<span class="token punctuation">:</span>è¿”å›ç”±<span class="token number">5</span>ä¸ªå­—ç¬¦ç»„æˆçš„æ ‡å‡†SQLé”™è¯¯ç ï¼Œæ¯”å¦‚<span class="token number">42000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€å®ç°"><a href="#4ã€å®ç°" class="headerlink" title="4ã€å®ç°"></a>4ã€å®ç°</h5><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua">location <span class="token operator">/</span><span class="token function">mysqlSearch</span><span class="token punctuation">{</span>    default_type <span class="token string">'text/html'</span><span class="token punctuation">;</span>    <span class="token function">content_by_lua_block</span><span class="token punctuation">{</span>        <span class="token keyword">local</span> mysql <span class="token operator">=</span> require <span class="token string">"resty.mysql"</span>        <span class="token keyword">local</span> db <span class="token operator">=</span> mysql<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">local</span> ok<span class="token punctuation">,</span>err <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">{</span>            host<span class="token operator">=</span><span class="token string">"10.0.4.7"</span><span class="token punctuation">,</span> <span class="token operator">#</span>ä¸è¦ç”¨<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>            port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>            user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>            password<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>            database<span class="token operator">=</span><span class="token string">"lua_db"</span>        <span class="token punctuation">}</span>        db<span class="token punctuation">:</span><span class="token function">set_timeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>        db<span class="token punctuation">:</span><span class="token function">send_query</span><span class="token punctuation">(</span><span class="token string">"select * from users where id =1"</span><span class="token punctuation">)</span>        <span class="token keyword">local</span> res<span class="token punctuation">,</span>err<span class="token punctuation">,</span>errcode<span class="token punctuation">,</span>sqlstate <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">read_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>username<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>birthday<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>salary<span class="token punctuation">)</span>    db<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="5ã€-baby-chick-ä¼˜åŒ–"><a href="#5ã€-baby-chick-ä¼˜åŒ–" class="headerlink" title="5ã€:baby_chick:ä¼˜åŒ–:"></a>5ã€<span class="github-emoji"><span>ğŸ¤</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f424.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ä¼˜åŒ–:</h5><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua">location <span class="token operator">/</span><span class="token function">mysqlSearch</span> <span class="token punctuation">{</span>    default_type <span class="token string">'text/html'</span><span class="token punctuation">;</span>    <span class="token function">content_by_lua_block</span><span class="token punctuation">{</span>        <span class="token keyword">local</span> mysql <span class="token operator">=</span> require <span class="token string">"resty.mysql"</span>        <span class="token keyword">local</span> db <span class="token operator">=</span> mysql<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">local</span> ok<span class="token punctuation">,</span>err <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">{</span>            host<span class="token operator">=</span><span class="token string">"10.0.4.7"</span><span class="token punctuation">,</span>            port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>            user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>            password<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>            database<span class="token operator">=</span><span class="token string">"lua_db"</span>        <span class="token punctuation">}</span>        db<span class="token punctuation">:</span><span class="token function">set_timeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>        <span class="token keyword">local</span> uri_args <span class="token operator">=</span> ngx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">get_uri_args</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">local</span> reqId <span class="token operator">=</span> uri_args<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>        db<span class="token punctuation">:</span><span class="token function">send_query</span><span class="token punctuation">(</span><span class="token string">"select * from users where id ="</span><span class="token operator">..</span>reqId<span class="token punctuation">)</span>        <span class="token keyword">local</span> res<span class="token punctuation">,</span>err<span class="token punctuation">,</span>errcode<span class="token punctuation">,</span>sqlstate <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">read_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>username<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>birthday<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>salary<span class="token punctuation">)</span>        db<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220404233016.png"></p><h5 id="6ã€-artificial-satellite-lua-cjson"><a href="#6ã€-artificial-satellite-lua-cjson" class="headerlink" title="6ã€:artificial_satellite:lua-cjson"></a>6ã€<span class="github-emoji"><span>ğŸ›°</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f6f0.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>lua-cjson</h5><p>read_result()å¾—åˆ°çš„ç»“æœreséƒ½æ˜¯tableç±»å‹ï¼Œè¦æƒ³åœ¨é¡µé¢ä¸Šå±•ç¤ºï¼Œå°±å¿…é¡»çŸ¥é“tableçš„å…·ä½“æ•°æ®ç»“æ„æ‰èƒ½è¿›è¡Œéå†è·å–ã€‚å¤„ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸€ç§ç®€å•æ–¹å¼cjsonï¼Œä½¿ç”¨å®ƒå°±å¯ä»¥å°†tableç±»å‹çš„æ•°æ®è½¬æ¢æˆjsonå­—ç¬¦ä¸²ï¼ŒæŠŠjsonå­—ç¬¦ä¸²å±•ç¤ºåœ¨é¡µé¢ä¸Šå³å¯ã€‚</p><p>æ­¥éª¤ä¸€ï¼šå¼•å…¥cjson</p><pre class="line-numbers language-none"><code class="language-none">local cjson = require "cjson"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¥éª¤äºŒï¼šè°ƒç”¨cjsonçš„encodeæ–¹æ³•è¿›è¡Œç±»å‹è½¬æ¢</p><pre class="line-numbers language-none"><code class="language-none">cjson.encode(res) <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¼˜åŒ–ä»£ç ï¼š</p><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua">location <span class="token operator">/</span><span class="token function">mysqlSearch</span> <span class="token punctuation">{</span>    default_type <span class="token string">'text/html'</span><span class="token punctuation">;</span>    <span class="token function">content_by_lua_block</span><span class="token punctuation">{</span>        <span class="token keyword">local</span> mysql <span class="token operator">=</span> require <span class="token string">"resty.mysql"</span>        <span class="token keyword">local</span> db <span class="token operator">=</span> mysql<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">local</span> cjson <span class="token operator">=</span> require <span class="token string">"cjson"</span>        <span class="token keyword">local</span> ok<span class="token punctuation">,</span>err <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">{</span>            host<span class="token operator">=</span><span class="token string">"10.0.4.7"</span><span class="token punctuation">,</span>            port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>            user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>            password<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>            database<span class="token operator">=</span><span class="token string">"lua_db"</span>        <span class="token punctuation">}</span>        db<span class="token punctuation">:</span><span class="token function">set_timeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>        <span class="token keyword">local</span> uri_args <span class="token operator">=</span> ngx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">get_uri_args</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">local</span> reqId <span class="token operator">=</span> uri_args<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>        db<span class="token punctuation">:</span><span class="token function">send_query</span><span class="token punctuation">(</span><span class="token string">"select * from users where id ="</span><span class="token operator">..</span>reqId<span class="token punctuation">)</span>        <span class="token keyword">local</span> res<span class="token punctuation">,</span>err<span class="token punctuation">,</span>errcode<span class="token punctuation">,</span>sqlstate <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">read_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span>cjson<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token keyword">for</span> i<span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token keyword">do</span>       ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>id<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>v<span class="token punctuation">.</span>username<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>v<span class="token punctuation">.</span>birthday<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>v<span class="token punctuation">.</span>salary<span class="token punctuation">)</span>        <span class="token keyword">end</span>        db<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220404234615.png"></p><h4 id="2ã€å¢åˆ æ”¹"><a href="#2ã€å¢åˆ æ”¹" class="headerlink" title="2ã€å¢åˆ æ”¹"></a>2ã€å¢åˆ æ”¹</h4><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua">location <span class="token operator">/</span><span class="token function">mysql</span> <span class="token punctuation">{</span>    default_type <span class="token string">'text/html'</span><span class="token punctuation">;</span>    <span class="token function">content_by_lua_block</span><span class="token punctuation">{</span>        <span class="token keyword">local</span> mysql <span class="token operator">=</span> require <span class="token string">"resty.mysql"</span>        <span class="token keyword">local</span> db <span class="token operator">=</span> mysql<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">local</span> cjson <span class="token operator">=</span> require <span class="token string">"cjson"</span>        <span class="token keyword">local</span> ok<span class="token punctuation">,</span>err <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">{</span>            host<span class="token operator">=</span><span class="token string">"10.0.4.7"</span><span class="token punctuation">,</span>            port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>            user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>            password<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>            database<span class="token operator">=</span><span class="token string">"lua_db"</span>        <span class="token punctuation">}</span>        db<span class="token punctuation">:</span><span class="token function">set_timeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>        <span class="token keyword">local</span> uri_args <span class="token operator">=</span> ngx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">get_uri_args</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">local</span> reqId <span class="token operator">=</span> uri_args<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>        <span class="token keyword">local</span> reqType <span class="token operator">=</span> uri_args<span class="token punctuation">[</span><span class="token string">'reqType'</span><span class="token punctuation">]</span>        db<span class="token punctuation">:</span><span class="token function">send_query</span><span class="token punctuation">(</span><span class="token string">"select * from users where id ="</span><span class="token operator">..</span>reqId<span class="token punctuation">)</span>        <span class="token keyword">if</span> reqType <span class="token operator">==</span> <span class="token string">'search'</span> <span class="token keyword">then</span>         <span class="token keyword">local</span> res<span class="token punctuation">,</span>err<span class="token punctuation">,</span>errcode<span class="token punctuation">,</span>sqlstate <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">read_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span>cjson<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> i<span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token keyword">do</span>        ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>id<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>v<span class="token punctuation">.</span>username<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>v<span class="token punctuation">.</span>birthday<span class="token operator">..</span><span class="token string">","</span><span class="token operator">..</span>v<span class="token punctuation">.</span>salary<span class="token punctuation">)</span>         <span class="token keyword">end</span>        <span class="token keyword">elseif</span> reqType <span class="token operator">==</span> <span class="token string">'add'</span>  <span class="token keyword">then</span>            <span class="token keyword">local</span> res<span class="token punctuation">,</span>err<span class="token punctuation">,</span>errcode<span class="token punctuation">,</span>sqlstate <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"insert into users(id,username,birthday,salary) values(6,'zhangsan','2023-11-11',32222.0)"</span><span class="token punctuation">)</span>        <span class="token keyword">elseif</span> reqType <span class="token operator">==</span> <span class="token string">'update'</span> <span class="token keyword">then</span>             <span class="token keyword">local</span> res<span class="token punctuation">,</span>err<span class="token punctuation">,</span>errcode<span class="token punctuation">,</span>sqlstate <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"update users set username='lisi' where id = 6"</span><span class="token punctuation">)</span>        <span class="token keyword">elseif</span> reqType <span class="token operator">==</span> <span class="token string">'delete'</span>  <span class="token keyword">then</span>            <span class="token keyword">local</span> res<span class="token punctuation">,</span>err<span class="token punctuation">,</span>errcode<span class="token punctuation">,</span>sqlstate <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"delete from users where id = 6"</span><span class="token punctuation">)</span>        <span class="token keyword">end</span>            db<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5ã€Rdisç¼“å­˜é¢„çƒ­"><a href="#5ã€Rdisç¼“å­˜é¢„çƒ­" class="headerlink" title="5ã€Rdisç¼“å­˜é¢„çƒ­"></a>5ã€Rdisç¼“å­˜é¢„çƒ­</h3><p>ä½¿ç”¨ngx_luaæ¨¡å—å®ŒæˆRedisç¼“å­˜é¢„çƒ­ã€‚</p><p>æ­¥éª¤: </p><p>ï¼ˆ1ï¼‰å…ˆå¾—æœ‰ä¸€å¼ è¡¨(users)</p><p>ï¼ˆ2ï¼‰æµè§ˆå™¨è¾“å…¥å¦‚ä¸‹åœ°å€</p><pre class="line-numbers language-none"><code class="language-none">http://10.0.4.7?username=TOM<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ï¼ˆ3ï¼‰ä»è¡¨ä¸­æŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œæ­¤æ—¶è·å–çš„ç»“æœä¸ºtableç±»å‹</p><p>ï¼ˆ4ï¼‰ä½¿ç”¨cjsonå°†tableæ•°æ®è½¬æ¢æˆjsonå­—ç¬¦ä¸²</p><p>ï¼ˆ5ï¼‰å°†æŸ¥è¯¢çš„ç»“æœæ•°æ®å­˜å…¥Redisä¸­</p><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token function">init_by_lua_block</span><span class="token punctuation">{</span>redis <span class="token operator">=</span> require <span class="token string">"resty.redis"</span>    mysql <span class="token operator">=</span> require <span class="token string">"resty.mysql"</span>    cjson <span class="token operator">=</span> require <span class="token string">"cjson"</span><span class="token punctuation">}</span>location <span class="token operator">/</span><span class="token function">redisPreheat</span><span class="token punctuation">{</span>default_type <span class="token string">"text/html"</span><span class="token punctuation">;</span><span class="token function">content_by_lua_block</span><span class="token punctuation">{</span><span class="token comment">--è·å–è¯·æ±‚çš„å‚æ•°username</span><span class="token keyword">local</span> param <span class="token operator">=</span> ngx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">get_uri_args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span><span class="token comment">--å»ºç«‹mysqlæ•°æ®åº“çš„è¿æ¥</span><span class="token keyword">local</span> db <span class="token operator">=</span> mysql<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">local</span> ok<span class="token punctuation">,</span>err <span class="token operator">=</span> db<span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">{</span>host<span class="token operator">=</span><span class="token string">"10.0.4.7"</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>password<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>database<span class="token operator">=</span><span class="token string">"lua_db"</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token keyword">not</span> ok <span class="token keyword">then</span> ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"failed connect to mysql:"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token keyword">end</span><span class="token comment">--è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´</span>db<span class="token punctuation">:</span><span class="token function">set_timeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token comment">--æŸ¥è¯¢æ•°æ®</span><span class="token keyword">local</span> sql <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token keyword">not</span> param <span class="token keyword">then</span>sql<span class="token operator">=</span><span class="token string">"select * from users"</span><span class="token keyword">else</span>sql<span class="token operator">=</span><span class="token string">"select * from users where username="</span><span class="token operator">..</span><span class="token string">"'"</span><span class="token operator">..</span>param<span class="token operator">..</span><span class="token string">"'"</span><span class="token keyword">end</span><span class="token keyword">local</span> res<span class="token punctuation">,</span>err<span class="token punctuation">,</span>errcode<span class="token punctuation">,</span>sqlstate<span class="token operator">=</span>db<span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token keyword">not</span> res <span class="token keyword">then</span> ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"failed to query from mysql:"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token keyword">end</span><span class="token comment">--è¿æ¥redis</span><span class="token keyword">local</span> rd <span class="token operator">=</span> redis<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>ok<span class="token punctuation">,</span>err <span class="token operator">=</span> rd<span class="token punctuation">:</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"10.0.4.7"</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token keyword">not</span> ok <span class="token keyword">then</span> ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"failed to connect to redis:"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token keyword">end</span>rd<span class="token punctuation">:</span><span class="token function">set_timeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token comment">--å¾ªç¯éå†æ•°æ®</span><span class="token keyword">for</span> i<span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token keyword">do</span> rd<span class="token punctuation">:</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user_"</span><span class="token operator">..</span>v<span class="token punctuation">.</span>username<span class="token punctuation">,</span>cjson<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">end</span>ngx<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>rd<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>db<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‘ç°"><a href="#å‘ç°" class="headerlink" title="å‘ç°"></a>å‘ç°</h2><p><code>:</code>  + è‹±æ–‡å­—æ¯æœ‰å°å›¾æ ‡</p><p><code>:c</code> â€”&gt;  <span class="github-emoji"><span>â°</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/23f0.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><span class="github-emoji"><span>ğŸ¤</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f424.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p><p>å…³äºæ’¤å›ï¼Œvim</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220404233431.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="è®¡ç®—æœºè¯­è¨€" scheme="https://mykkto.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/"/>
    
    
    <category term="nginx" scheme="https://mykkto.github.io/tags/nginx/"/>
    
    <category term="lua" scheme="https://mykkto.github.io/tags/lua/"/>
    
    <category term="openresty" scheme="https://mykkto.github.io/tags/openresty/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-Alibaba-Seata å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡</title>
    <link href="https://mykkto.github.io/posts/e1138fa5.html"/>
    <id>https://mykkto.github.io/posts/e1138fa5.html</id>
    <published>2022-03-25T12:11:33.000Z</published>
    <updated>2022-11-12T15:07:08.072Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä¸€ã€åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"><a href="#ä¸€ã€åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜" class="headerlink" title="ä¸€ã€åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"></a>ä¸€ã€åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h2><h3 id="1ã€åˆ†å¸ƒå¼å‰"><a href="#1ã€åˆ†å¸ƒå¼å‰" class="headerlink" title="1ã€åˆ†å¸ƒå¼å‰"></a>1ã€åˆ†å¸ƒå¼å‰</h3><ul><li>å•æœºå•åº“æ²¡è¿™ä¸ªé—®é¢˜</li><li>ä»1ï¼š1  -&gt;  1ï¼šN  -&gt;  Nï¼šN</li></ul><h3 id="2ã€åˆ†å¸ƒå¼ä¹‹å"><a href="#2ã€åˆ†å¸ƒå¼ä¹‹å" class="headerlink" title="2ã€åˆ†å¸ƒå¼ä¹‹å"></a>2ã€åˆ†å¸ƒå¼ä¹‹å</h3><p>å•ä½“åº”ç”¨è¢«æ‹†åˆ†æˆå¾®æœåŠ¡åº”ç”¨ï¼ŒåŸæ¥çš„<code>ä¸‰ä¸ªæ¨¡å—</code>è¢«æ‹†åˆ†æˆ<code>ä¸‰ä¸ªç‹¬ç«‹çš„åº”ç”¨</code>ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸‰<code>ä¸ªç‹¬ç«‹çš„æ•°æ®æº</code>ï¼Œ<br>ä¸šåŠ¡æ“ä½œéœ€è¦è°ƒç”¨ä¸‰ä¸ªæœåŠ¡æ¥å®Œæˆã€‚æ­¤æ—¶<strong>æ¯ä¸ªæœåŠ¡å†…éƒ¨çš„æ•°æ®ä¸€è‡´æ€§ç”±<code>æœ¬åœ°</code>**äº‹åŠ¡æ¥ä¿è¯ï¼Œä½†æ˜¯<code>å…¨å±€</code>**çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜æ²¡æ³•ä¿è¯</strong>ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324225229.png"></p><h3 id="3ã€ä¸€å¥è¯"><a href="#3ã€ä¸€å¥è¯" class="headerlink" title="3ã€ä¸€å¥è¯"></a>3ã€ä¸€å¥è¯</h3><p>ä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå°±ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</p><h2 id="äºŒã€Seataç®€ä»‹"><a href="#äºŒã€Seataç®€ä»‹" class="headerlink" title="äºŒã€Seataç®€ä»‹"></a>äºŒã€Seataç®€ä»‹</h2><h3 id="1ã€æ˜¯ä»€ä¹ˆ"><a href="#1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h3><p>Seataæ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºåœ¨å¾®æœåŠ¡æ¶æ„ä¸‹æä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚</p><h3 id="2ã€èƒ½å¹²å˜›ï¼ˆâ˜…ï¼‰"><a href="#2ã€èƒ½å¹²å˜›ï¼ˆâ˜…ï¼‰" class="headerlink" title="2ã€èƒ½å¹²å˜›ï¼ˆâ˜…ï¼‰"></a>2ã€èƒ½å¹²å˜›ï¼ˆâ˜…ï¼‰</h3><h4 id="1ã€ID-1-ç»„ä»¶-3"><a href="#1ã€ID-1-ç»„ä»¶-3" class="headerlink" title="1ã€ID(1)+ç»„ä»¶(3)"></a>1ã€ID(1)+ç»„ä»¶(3)</h4><h5 id="1ã€ID"><a href="#1ã€ID" class="headerlink" title="1ã€ID"></a>1ã€ID</h5><p>å…¨å±€å”¯ä¸€çš„äº‹åŠ¡IDï¼šTransaction ID XID</p><h5 id="2ã€ç»„ä»¶"><a href="#2ã€ç»„ä»¶" class="headerlink" title="2ã€ç»„ä»¶"></a>2ã€ç»„ä»¶</h5><p>Transaction Coordinator (TC)<strong>ã€æ‰“å·¥äººã€‘</strong></p><p><code>äº‹åŠ¡åè°ƒå™¨</code>ï¼Œç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»šï¼›</p><p>Transaction Manager (TM)<strong>ã€è€æ¿ã€‘</strong></p><p><code>æ§åˆ¶å…¨å±€äº‹åŠ¡çš„è¾¹ç•Œ</code>ï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›æ»šçš„å†³è®®ï¼›</p><p>Resource Manager (RM)<strong>ã€ä»»åŠ¡ã€‘</strong></p><p><code>æ§åˆ¶åˆ†æ”¯äº‹åŠ¡</code>ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œã€çŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æ¥æ”¶äº‹åŠ¡åè°ƒå™¨çš„æŒ‡ä»¤ï¼Œé©±åŠ¨åˆ†æ”¯ï¼ˆæœ¬åœ°ï¼‰äº‹åŠ¡çš„æäº¤å’Œå›æ»š</p><h4 id="2ã€å¤„ç†è¿‡ç¨‹"><a href="#2ã€å¤„ç†è¿‡ç¨‹" class="headerlink" title="2ã€å¤„ç†è¿‡ç¨‹"></a>2ã€å¤„ç†è¿‡ç¨‹</h4><p>1ã€TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XIDï¼›</p><p>2ã€XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ï¼›</p><p>3ã€RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ï¼›</p><p>4ã€TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®®ï¼›</p><p>5ã€TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220325203440.png"></p><h3 id="3ã€æ€ä¹ˆç”¨"><a href="#3ã€æ€ä¹ˆç”¨" class="headerlink" title="3ã€æ€ä¹ˆç”¨"></a>3ã€æ€ä¹ˆç”¨</h3><h4 id="1ã€æœ¬åœ°"><a href="#1ã€æœ¬åœ°" class="headerlink" title="1ã€æœ¬åœ°"></a>1ã€æœ¬åœ°</h4><p>å•ä½“æ¶æ„ä¸Šï¼Œæœ¬åœ°ä½¿ç”¨springï¼š<code>@Transactional</code></p><h4 id="2ã€å…¨å±€"><a href="#2ã€å…¨å±€" class="headerlink" title="2ã€å…¨å±€"></a>2ã€å…¨å±€</h4><p>åˆ†å¸ƒå¼ä¸Šï¼Œå…¨å±€ä½¿ç”¨Seataï¼š<code>@GlobalTransactional</code></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220325203650.png"></p><h2 id="ä¸‰ã€Seata-Serverå®‰è£…"><a href="#ä¸‰ã€Seata-Serverå®‰è£…" class="headerlink" title="ä¸‰ã€Seata-Serverå®‰è£…"></a>ä¸‰ã€Seata-Serverå®‰è£…</h2><h3 id="1ã€å®˜ç½‘"><a href="#1ã€å®˜ç½‘" class="headerlink" title="1ã€å®˜ç½‘"></a>1ã€å®˜ç½‘</h3><h4 id="1ã€åœ°å€"><a href="#1ã€åœ°å€" class="headerlink" title="1ã€åœ°å€"></a>1ã€åœ°å€</h4><p><a href="http://seata.io/zh-cn/">http://seata.io/zh-cn/</a></p><h4 id="2ã€ä¸‹è½½åœ°å€"><a href="#2ã€ä¸‹è½½åœ°å€" class="headerlink" title="2ã€ä¸‹è½½åœ°å€"></a>2ã€ä¸‹è½½åœ°å€</h4><p><a href="https://github.com/seata/seata/releases">https://github.com/seata/seata/releases</a></p><p>é€‰æ‹© 1.0.0 GA ç¨³å®šç‰ˆ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220325210759.png"></p><h3 id="2ã€é…ç½®"><a href="#2ã€é…ç½®" class="headerlink" title="2ã€é…ç½®"></a>2ã€é…ç½®</h3><p>seata-server-1.0.0.zip è§£å‹åˆ°æŒ‡å®šç›®å½•å¹¶ä¿®æ”¹confç›®å½•ä¸‹çš„file.confé…ç½®æ–‡ä»¶</p><h4 id="1ã€file-confï¼ˆserviceæ¨¡å—ï¼‰"><a href="#1ã€file-confï¼ˆserviceæ¨¡å—ï¼‰" class="headerlink" title="1ã€file.confï¼ˆserviceæ¨¡å—ï¼‰"></a>1ã€file.confï¼ˆserviceæ¨¡å—ï¼‰</h4><pre class="line-numbers language-file.conf" data-language="file.conf"><code class="language-file.conf">vgroup_mapping.my_test_tx_group = "fsp_tx_group"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220325222219.png"></p><h4 id="2ã€file-confï¼ˆstoreæ¨¡å—ï¼‰"><a href="#2ã€file-confï¼ˆstoreæ¨¡å—ï¼‰" class="headerlink" title="2ã€file.confï¼ˆstoreæ¨¡å—ï¼‰"></a>2ã€file.confï¼ˆstoreæ¨¡å—ï¼‰</h4><pre class="line-numbers language-file.conf" data-language="file.conf"><code class="language-file.conf">mode = "db"url = "jdbc:mysql://127.0.0.1:3306/seata"user = "root"password = "ä½ è‡ªå·±å¯†ç "<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220325222634.png"></p><h3 id="3ã€å¯¼å…¥å»ºè¡¨sql"><a href="#3ã€å¯¼å…¥å»ºè¡¨sql" class="headerlink" title="3ã€å¯¼å…¥å»ºè¡¨sql"></a>3ã€å¯¼å…¥å»ºè¡¨sql</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- -------------------------------- The script used when storeMode is 'db' --------------------------------</span><span class="token comment">-- the table to store GlobalSession data</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>global_table<span class="token punctuation">`</span><span class="token punctuation">(</span>    <span class="token punctuation">`</span>xid<span class="token punctuation">`</span>                       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span>            <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span><span class="token keyword">status</span><span class="token punctuation">`</span>                    <span class="token keyword">TINYINT</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>application_id<span class="token punctuation">`</span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>timeout<span class="token punctuation">`</span>                   <span class="token keyword">INT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span>                <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>application_data<span class="token punctuation">`</span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span>                <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span>              <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>xid<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_gmt_modified_status<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span><span class="token keyword">status</span><span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span><span class="token comment">-- the table to store BranchSession data</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span><span class="token punctuation">(</span>    <span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span>         <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>xid<span class="token punctuation">`</span>               <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span>    <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span><span class="token keyword">status</span><span class="token punctuation">`</span>            <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>client_id<span class="token punctuation">`</span>         <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>application_data<span class="token punctuation">`</span>  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span>        <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span>      <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>xid<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span><span class="token comment">-- the table to store lock data</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span><span class="token punctuation">(</span>    <span class="token punctuation">`</span>row_key<span class="token punctuation">`</span>        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>xid<span class="token punctuation">`</span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span>      <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span>    <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>table_name<span class="token punctuation">`</span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>pk<span class="token punctuation">`</span>             <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span>     <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>    <span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span>   <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">KEY</span> <span class="token punctuation">`</span>idx_branch_id<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4ã€å¯åŠ¨"><a href="#4ã€å¯åŠ¨" class="headerlink" title="4ã€å¯åŠ¨"></a>4ã€å¯åŠ¨</h3><p>1ã€å¯åŠ¨cacosï¼Œseate </p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220326194029.png"></p><p>2ã€æŸ¥çœ‹ nacos æ§åˆ¶å°</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220326194117.png"></p><h2 id="å››ã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡"><a href="#å››ã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡" class="headerlink" title="å››ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡"></a>å››ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡æ•°æ®åº“å‡†å¤‡</h2><h3 id="1ã€å®æˆ˜ä¸šåŠ¡è¯´æ˜"><a href="#1ã€å®æˆ˜ä¸šåŠ¡è¯´æ˜" class="headerlink" title="1ã€å®æˆ˜ä¸šåŠ¡è¯´æ˜"></a>1ã€å®æˆ˜ä¸šåŠ¡è¯´æ˜</h3><h4 id="1ã€è¯¦ç»†"><a href="#1ã€è¯¦ç»†" class="headerlink" title="1ã€è¯¦ç»†"></a>1ã€è¯¦ç»†</h4><p><strong>è¿™é‡Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸‰ä¸ªæœåŠ¡ï¼Œä¸€ä¸ªè®¢å•æœåŠ¡ï¼Œä¸€ä¸ªåº“å­˜æœåŠ¡ï¼Œä¸€ä¸ªè´¦æˆ·æœåŠ¡ã€‚</strong></p><p>å½“ç”¨æˆ·ä¸‹å•æ—¶ï¼Œä¼šåœ¨è®¢å•æœåŠ¡ä¸­åˆ›å»ºä¸€ä¸ªè®¢å•ï¼Œç„¶åé€šè¿‡è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ¥æ‰£å‡ä¸‹å•å•†å“çš„åº“å­˜ï¼Œ<br>å†é€šè¿‡è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ¥æ‰£å‡ç”¨æˆ·è´¦æˆ·é‡Œé¢çš„ä½™é¢ï¼Œ<br>æœ€ååœ¨è®¢å•æœåŠ¡ä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆã€‚</p><p>è¯¥æ“ä½œè·¨è¶Šä¸‰ä¸ªæ•°æ®åº“ï¼Œæœ‰ä¸¤æ¬¡è¿œç¨‹è°ƒç”¨ï¼Œå¾ˆæ˜æ˜¾ä¼šæœ‰åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</p><h4 id="2ã€è°ƒç”¨æµç¨‹"><a href="#2ã€è°ƒç”¨æµç¨‹" class="headerlink" title="2ã€è°ƒç”¨æµç¨‹"></a>2ã€è°ƒç”¨æµç¨‹</h4><p>ä¸‹è®¢å•â€”&gt;æ‰£åº“å­˜â€”&gt;å‡è´¦æˆ·(ä½™é¢)</p><h3 id="2ã€å»ºåº“å»ºè¡¨"><a href="#2ã€å»ºåº“å»ºè¡¨" class="headerlink" title="2ã€å»ºåº“å»ºè¡¨"></a>2ã€å»ºåº“å»ºè¡¨</h3><h4 id="0ã€å»ºåº“"><a href="#0ã€å»ºåº“" class="headerlink" title="0ã€å»ºåº“"></a>0ã€å»ºåº“</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> seata_order<span class="token punctuation">;</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> seata_storage<span class="token punctuation">;</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> seata_account<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1ã€è®¢å•"><a href="#1ã€è®¢å•" class="headerlink" title="1ã€è®¢å•"></a>1ã€è®¢å•</h4><p>seata_orderï¼šå­˜å‚¨è®¢å•çš„æ•°æ®åº“ï¼›</p><p><strong>è¡¨è¯­å¥ï¼š</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_order <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'ç”¨æˆ·id'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>product_id<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'äº§å“id'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>count<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'æ•°é‡'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>money<span class="token punctuation">`</span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'é‡‘é¢'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span><span class="token keyword">status</span><span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'è®¢å•çŠ¶æ€ï¼š0ï¼šåˆ›å»ºä¸­ï¼›1ï¼šå·²å®Œç»“'</span> <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">7</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_order<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€åº“å­˜"><a href="#2ã€åº“å­˜" class="headerlink" title="2ã€åº“å­˜"></a>2ã€åº“å­˜</h4><p>seata_storageï¼šå­˜å‚¨åº“å­˜çš„æ•°æ®åº“ï¼›</p><p><strong>è¡¨è¯­å¥ï¼š</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_storage <span class="token punctuation">(</span> <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>product_id<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'äº§å“id'</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>total<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'æ€»åº“å­˜'</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>used<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'å·²ç”¨åº“å­˜'</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>residue<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'å‰©ä½™åº“å­˜'</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>  <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> seata_storage<span class="token punctuation">.</span>t_storage<span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>product_id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>total<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>used<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>residue<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'100'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_storage<span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€è´¦æˆ·ä¿¡æ¯"><a href="#3ã€è´¦æˆ·ä¿¡æ¯" class="headerlink" title="3ã€è´¦æˆ·ä¿¡æ¯"></a>3ã€è´¦æˆ·ä¿¡æ¯</h4><p>seata_accountï¼šå­˜å‚¨è´¦æˆ·ä¿¡æ¯çš„æ•°æ®åº“ã€‚</p><p><strong>è¡¨è¯­å¥ï¼š</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t_account <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">COMMENT</span> <span class="token string">'id'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'ç”¨æˆ·id'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>total<span class="token punctuation">`</span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'æ€»é¢åº¦'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>used<span class="token punctuation">`</span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'å·²ç”¨ä½™é¢'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>residue<span class="token punctuation">`</span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'å‰©ä½™å¯ç”¨é¢åº¦'</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> seata_account<span class="token punctuation">.</span>t_account<span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>total<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>used<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>residue<span class="token punctuation">`</span><span class="token punctuation">)</span>  <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'1000'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'1000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_account<span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€å›æ»šæ—¥å¿—è¡¨"><a href="#4ã€å›æ»šæ—¥å¿—è¡¨" class="headerlink" title="4ã€å›æ»šæ—¥å¿—è¡¨"></a>4ã€å›æ»šæ—¥å¿—è¡¨</h4><p><strong>æŒ‰ç…§ä¸Šè¿°3åº“åˆ†åˆ«å»ºå¯¹åº”çš„å›æ»šæ—¥å¿—è¡¨</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- the table to store seata xid data</span><span class="token comment">-- 0.7.0+ add context</span><span class="token comment">-- you must to init this sql for you business databese. the seata server not need it.</span><span class="token comment">-- æ­¤è„šæœ¬å¿…é¡»åˆå§‹åŒ–åœ¨ä½ å½“å‰çš„ä¸šåŠ¡æ•°æ®åº“ä¸­ï¼Œç”¨äºAT æ¨¡å¼XIDè®°å½•ã€‚ä¸serverç«¯æ— å…³ï¼ˆæ³¨ï¼šä¸šåŠ¡æ•°æ®åº“ï¼‰</span><span class="token comment">-- æ³¨æ„æ­¤å¤„0.3.0+ å¢åŠ å”¯ä¸€ç´¢å¼• ux_undo_log</span><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span><span class="token punctuation">;</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>xid<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>context<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>rollback_info<span class="token punctuation">`</span> <span class="token keyword">LONGBLOB</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>log_status<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>log_created<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>log_modified<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>ext<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>ux_undo_log<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>xid<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€æ•ˆæœ"><a href="#5ã€æ•ˆæœ" class="headerlink" title="5ã€æ•ˆæœ"></a>5ã€æ•ˆæœ</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220326200400.png"></p><h2 id="äº”ã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡"><a href="#äº”ã€è®¢å•-åº“å­˜-è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡" class="headerlink" title="äº”ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡"></a>äº”ã€è®¢å•/åº“å­˜/è´¦æˆ·ä¸šåŠ¡å¾®æœåŠ¡å‡†å¤‡</h2><h3 id="1ã€ä¸šåŠ¡éœ€æ±‚"><a href="#1ã€ä¸šåŠ¡éœ€æ±‚" class="headerlink" title="1ã€ä¸šåŠ¡éœ€æ±‚"></a>1ã€ä¸šåŠ¡éœ€æ±‚</h3><p><strong>ä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;æ‰£ä½™é¢-&gt;æ”¹(è®¢å•)çŠ¶æ€</strong></p><h3 id="2ã€æ–°å»ºè®¢å•Order-Module"><a href="#2ã€æ–°å»ºè®¢å•Order-Module" class="headerlink" title="2ã€æ–°å»ºè®¢å•Order-Module"></a>2ã€æ–°å»ºè®¢å•Order-Module</h3><h4 id="1ã€model"><a href="#1ã€model" class="headerlink" title="1ã€model"></a>1ã€model</h4><p>seata-order-service2001</p><h4 id="2ã€pom"><a href="#2ã€pom" class="headerlink" title="2ã€pom"></a>2ã€pom</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springcloud2021to2022<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-order-service2001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--nacos--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--seata--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--feign--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--web-actuator--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--mysql-druid--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.37<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€yml"><a href="#3ã€yml" class="headerlink" title="3ã€yml"></a>3ã€yml</h4><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2001</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>order<span class="token punctuation">-</span>service  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">alibaba</span><span class="token punctuation">:</span>      <span class="token key atrule">seata</span><span class="token punctuation">:</span>        <span class="token comment">#è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°éœ€è¦ä¸seata-serverä¸­çš„å¯¹åº”</span>        <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> fsp_tx_group    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 106.52.23.202<span class="token punctuation">:</span><span class="token number">8848</span>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//106.52.23.202<span class="token punctuation">:</span>3306/seata_order    <span class="token key atrule">username</span><span class="token punctuation">:</span> root    <span class="token key atrule">password</span><span class="token punctuation">:</span> root<span class="token key atrule">feign</span><span class="token punctuation">:</span>  <span class="token key atrule">hystrix</span><span class="token punctuation">:</span>    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">logging</span><span class="token punctuation">:</span>  <span class="token key atrule">level</span><span class="token punctuation">:</span>    <span class="token key atrule">io</span><span class="token punctuation">:</span>      <span class="token key atrule">seata</span><span class="token punctuation">:</span> info<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>  <span class="token key atrule">mapperLocations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€file-conf"><a href="#4ã€file-conf" class="headerlink" title="4ã€file.conf"></a>4ã€file.conf</h4><p>yml åŒå±‚ç›®å½•ä¸‹</p><p>éœ€è¦ä¿®æ”¹çš„æ˜¯ mysql url,username,password</p><pre class="line-numbers language-file.conf" data-language="file.conf"><code class="language-file.conf">transport {  # tcp udt unix-domain-socket  type = "TCP"  #NIO NATIVE  server = "NIO"  #enable heartbeat  heartbeat = true  #thread factory for netty  thread-factory {    boss-thread-prefix = "NettyBoss"    worker-thread-prefix = "NettyServerNIOWorker"    server-executor-thread-prefix = "NettyServerBizHandler"    share-boss-worker = false    client-selector-thread-prefix = "NettyClientSelector"    client-selector-thread-size = 1    client-worker-thread-prefix = "NettyClientWorkerThread"    # netty boss thread size,will not be used for UDT    boss-thread-size = 1    #auto default pin or 8    worker-thread-size = 8  }  shutdown {    # when destroy server, wait seconds    wait = 3  }  serialization = "seata"  compressor = "none"}service {  vgroup_mapping.fsp_tx_group = "default" #ä¿®æ”¹è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°  default.grouplist = "127.0.0.1:8091"  enableDegrade = false  disable = false  max.commit.retry.timeout = "-1"  max.rollback.retry.timeout = "-1"  disableGlobalTransaction = false}client {  async.commit.buffer.limit = 10000  lock {    retry.internal = 10    retry.times = 30  }  report.retry.count = 5  tm.commit.retry.count = 1  tm.rollback.retry.count = 1}## transaction log storestore {  ## store mode: fileã€db  mode = "db"  ## file store  file {    dir = "sessionStore"    # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions    max-branch-session-size = 16384    # globe session size , if exceeded throws exceptions    max-global-session-size = 512    # file buffer size , if exceeded allocate new buffer    file-write-buffer-cache-size = 16384    # when recover batch read size    session.reload.read_size = 100    # async, sync    flush-disk-mode = async  }  ## database store  db {    ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc.    datasource = "dbcp"    ## mysql/oracle/h2/oceanbase etc.    db-type = "mysql"    driver-class-name = "com.mysql.jdbc.Driver"    url = "jdbc:mysql://106.52.23.202:3306/seata"    user = "root"    password = "root"    min-conn = 1    max-conn = 3    global.table = "global_table"    branch.table = "branch_table"    lock-table = "lock_table"    query-limit = 100  }}lock {  ## the lock store mode: localã€remote  mode = "remote"  local {    ## store locks in user's database  }  remote {    ## store locks in the seata's server  }}recovery {  #schedule committing retry period in milliseconds  committing-retry-period = 1000  #schedule asyn committing retry period in milliseconds  asyn-committing-retry-period = 1000  #schedule rollbacking retry period in milliseconds  rollbacking-retry-period = 1000  #schedule timeout retry period in milliseconds  timeout-retry-period = 1000}transaction {  undo.data.validation = true  undo.log.serialization = "jackson"  undo.log.save.days = 7  #schedule delete expired undo_log in milliseconds  undo.log.delete.period = 86400000  undo.log.table = "undo_log"}## metrics settingsmetrics {  enabled = false  registry-type = "compact"  # multi exporters use comma divided  exporter-list = "prometheus"  exporter-prometheus-port = 9898}support {  ## spring  spring {    # auto proxy the DataSource bean    datasource.autoproxy = false  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€registry-conf"><a href="#5ã€registry-conf" class="headerlink" title="5ã€registry.conf"></a>5ã€registry.conf</h4><pre class="line-numbers language-registry.conf" data-language="registry.conf"><code class="language-registry.conf">registry {  # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa  type = "nacos"  nacos {    serverAddr = "106.52.23.202:8848"    namespace = ""    cluster = "default"  }  eureka {    serviceUrl = "http://localhost:8761/eureka"    application = "default"    weight = "1"  }  redis {    serverAddr = "localhost:6379"    db = "0"  }  zk {    cluster = "default"    serverAddr = "127.0.0.1:2181"    session.timeout = 6000    connect.timeout = 2000  }  consul {    cluster = "default"    serverAddr = "127.0.0.1:8500"  }  etcd3 {    cluster = "default"    serverAddr = "http://localhost:2379"  }  sofa {    serverAddr = "127.0.0.1:9603"    application = "default"    region = "DEFAULT_ZONE"    datacenter = "DefaultDataCenter"    cluster = "default"    group = "SEATA_GROUP"    addressWaitTime = "3000"  }  file {    name = "file.conf"  }}config {  # fileã€nacos ã€apolloã€zkã€consulã€etcd3  type = "file"  nacos {    serverAddr = "localhost"    namespace = ""  }  consul {    serverAddr = "127.0.0.1:8500"  }  apollo {    app.id = "seata-server"    apollo.meta = "http://192.168.1.204:8801"  }  zk {    serverAddr = "127.0.0.1:2181"    session.timeout = 6000    connect.timeout = 2000  }  etcd3 {    serverAddr = "http://localhost:2379"  }  file {    name = "file.conf"  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ã€ä¸šåŠ¡ç±»"><a href="#6ã€ä¸šåŠ¡ç±»" class="headerlink" title="6ã€ä¸šåŠ¡ç±»"></a>6ã€ä¸šåŠ¡ç±»</h4><h5 id="1ã€domain"><a href="#1ã€domain" class="headerlink" title="1ã€domain"></a>1ã€domain</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span> <span class="token punctuation">(</span>code<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> productId<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> count<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">;</span>    <span class="token comment">/**     * è®¢å•çŠ¶æ€ï¼š0ï¼šåˆ›å»ºä¸­ï¼›1ï¼šå·²å®Œç»“     */</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€dao"><a href="#2ã€dao" class="headerlink" title="2ã€dao"></a>2ã€dao</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Order</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Mapper</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderDao</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * åˆ›å»ºè®¢å•     */</span>    <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * ä¿®æ”¹è®¢å•é‡‘é¢     */</span>    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>OrderMapper.xml</strong></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk.springcloud.dao.OrderDao<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk.springcloud.domain.Order<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BIGINT<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userId<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BIGINT<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>product_id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>productId<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BIGINT<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>count<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>count<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>money<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>money<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DECIMAL<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>status<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>status<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>create<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        INSERT INTO `t_order` (`id`, `user_id`, `product_id`, `count`, `money`, `status`)        VALUES (NULL, #{userId}, #{productId}, #{count}, #{money}, 0);    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>update<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        UPDATE `t_order`        SET status = 1        WHERE user_id = #{userId} AND status = #{status};    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€serivce"><a href="#3ã€serivce" class="headerlink" title="3ã€serivce"></a>3ã€serivce</h5><ul><li>OrderService<ul><li>OrderServiceImpl </li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Order</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * åˆ›å»ºè®¢å•     */</span>    <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">OrderDao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Order</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GlobalTransactional</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">OrderDao</span> orderDao<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">StorageService</span> storageService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">AccountService</span> accountService<span class="token punctuation">;</span>    <span class="token comment">/**     * åˆ›å»ºè®¢å•-&gt;è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜-&gt;è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡è´¦æˆ·ä½™é¢-&gt;ä¿®æ”¹è®¢å•çŠ¶æ€     * ç®€å•è¯´ï¼š     * ä¸‹è®¢å•-&gt;å‡åº“å­˜-&gt;å‡ä½™é¢-&gt;æ”¹çŠ¶æ€     * rollbackFor = Exception.class ,ä»»ä½•å¼‚å¸¸éƒ½å›æ»š     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token annotation punctuation">@GlobalTransactional</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"fsp-create-order"</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"===å¼€å§‹ä¸‹å•==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æœ¬åº”ç”¨åˆ›å»ºè®¢å•</span>        orderDao<span class="token punctuation">.</span>create <span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿œç¨‹è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜</span>        log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"-------&gt;order-serviceä¸­æ‰£å‡åº“å­˜å¼€å§‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        storageService<span class="token punctuation">.</span>decrease <span class="token punctuation">(</span>order<span class="token punctuation">.</span>getProductId <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span>getCount <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"-------&gt;order-serviceä¸­æ‰£å‡åº“å­˜ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿œç¨‹è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡ä½™é¢</span>        log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"-------&gt;order-serviceä¸­æ‰£å‡ä½™é¢å¼€å§‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        accountService<span class="token punctuation">.</span>decrease <span class="token punctuation">(</span>order<span class="token punctuation">.</span>getUserId <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span>getMoney <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"-------&gt;order-serviceä¸­æ‰£å‡ä½™é¢ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å®Œæˆ</span>        log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€å¼€å§‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        orderDao<span class="token punctuation">.</span>update <span class="token punctuation">(</span>order<span class="token punctuation">.</span>getUserId <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"-------&gt;order-serviceä¸­ä¿®æ”¹è®¢å•çŠ¶æ€ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"-------&gt;ä¸‹å•ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>  AccountService</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span><span class="token punctuation">;</span><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"seata-account-service"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æ‰£å‡è´¦æˆ·ä½™é¢     */</span>    <span class="token comment">//@RequestMapping(value = "/account/decrease", method = RequestMethod.POST, produces = "application/json; charset=UTF-8")</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/account/decrease"</span><span class="token punctuation">)</span>    <span class="token class-name">CommonResult</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>StorageService</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span><span class="token punctuation">;</span><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"seata-storage-service"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StorageService</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æ‰£å‡åº“å­˜     */</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/storage/decrease"</span><span class="token punctuation">)</span>    <span class="token class-name">CommonResult</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"productId"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€controller"><a href="#4ã€controller" class="headerlink" title="4ã€controller"></a>4ã€controller</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Order</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">OrderService</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>    <span class="token comment">/**     * åˆ›å»ºè®¢å•     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/order/create"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>        orderService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"è®¢å•åˆ›å»ºæˆåŠŸ!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="7ã€Configé…ç½®"><a href="#7ã€Configé…ç½®" class="headerlink" title="7ã€Configé…ç½®"></a>7ã€Configé…ç½®</h4><ul><li>MybatisConfig</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"com.kk.springcloud.dao"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>DataSourceProxyConfig</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>rm<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span></span><span class="token class-name">DataSourceProxy</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">SpringManagedTransactionFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span><span class="token punctuation">;</span><span class="token comment">/* * @Description:    ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç† * @Author:         é˜¿K * @CreateDate:     2022/3/27 13:31 * @Param: * @Return: **/</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceProxyConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${mybatis.mapperLocations}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> mapperLocations<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"spring.datasource"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">druidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">DataSourceProxy</span> <span class="token function">dataSourceProxy</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceProxy</span> <span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">sqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token class-name">DataSourceProxy</span> dataSourceProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">SqlSessionFactoryBean</span> sqlSessionFactoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSessionFactoryBean<span class="token punctuation">.</span>setDataSource <span class="token punctuation">(</span>dataSourceProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSessionFactoryBean<span class="token punctuation">.</span>setMapperLocations <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathMatchingResourcePatternResolver</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>getResources <span class="token punctuation">(</span>mapperLocations<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSessionFactoryBean<span class="token punctuation">.</span>setTransactionFactory <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SpringManagedTransactionFactory</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> sqlSessionFactoryBean<span class="token punctuation">.</span>getObject <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="8ã€ä¸»å¯åŠ¨"><a href="#8ã€ä¸»å¯åŠ¨" class="headerlink" title="8ã€ä¸»å¯åŠ¨"></a>8ã€ä¸»å¯åŠ¨</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">EnableFeignClients</span><span class="token punctuation">;</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token annotation punctuation">@EnableFeignClients</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token comment">//å–æ¶ˆæ•°æ®æºçš„è‡ªåŠ¨åˆ›å»º</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeataOrderMainApp2001</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span>run <span class="token punctuation">(</span><span class="token class-name">SeataOrderMainApp2001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€æ–°å»ºåº“å­˜Storage-Module"><a href="#3ã€æ–°å»ºåº“å­˜Storage-Module" class="headerlink" title="3ã€æ–°å»ºåº“å­˜Storage-Module"></a>3ã€æ–°å»ºåº“å­˜Storage-Module</h3><h4 id="1ã€model-1"><a href="#1ã€model-1" class="headerlink" title="1ã€model"></a>1ã€model</h4><p>seata-storage-service2002</p><h4 id="2ã€pom-1"><a href="#2ã€pom-1" class="headerlink" title="2ã€pom"></a>2ã€pom</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springcloud2021to2022<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-order-service2001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--nacos--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--seata--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--feign--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--web-actuator--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--mysql-druid--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.37<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€yml-1"><a href="#3ã€yml-1" class="headerlink" title="3ã€yml"></a>3ã€yml</h4><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2002</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>storage<span class="token punctuation">-</span>service  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">alibaba</span><span class="token punctuation">:</span>      <span class="token key atrule">seata</span><span class="token punctuation">:</span>        <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> fsp_tx_group    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 106.52.23.202<span class="token punctuation">:</span><span class="token number">8848</span>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//106.52.23.202<span class="token punctuation">:</span>3306/seata_storage    <span class="token key atrule">username</span><span class="token punctuation">:</span> root    <span class="token key atrule">password</span><span class="token punctuation">:</span> root<span class="token key atrule">logging</span><span class="token punctuation">:</span>  <span class="token key atrule">level</span><span class="token punctuation">:</span>    <span class="token key atrule">io</span><span class="token punctuation">:</span>      <span class="token key atrule">seata</span><span class="token punctuation">:</span> info<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>  <span class="token key atrule">mapperLocations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€file-conf-1"><a href="#4ã€file-conf-1" class="headerlink" title="4ã€file.conf"></a>4ã€file.conf</h4><pre class="line-numbers language-æ”¹åŠ¨" data-language="æ”¹åŠ¨"><code class="language-æ”¹åŠ¨">vgroup_mapping.fsp_tx_group = "default"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-file.conf" data-language="file.conf"><code class="language-file.conf">transport {  # tcp udt unix-domain-socket  type = "TCP"  #NIO NATIVE  server = "NIO"  #enable heartbeat  heartbeat = true  #thread factory for netty  thread-factory {    boss-thread-prefix = "NettyBoss"    worker-thread-prefix = "NettyServerNIOWorker"    server-executor-thread-prefix = "NettyServerBizHandler"    share-boss-worker = false    client-selector-thread-prefix = "NettyClientSelector"    client-selector-thread-size = 1    client-worker-thread-prefix = "NettyClientWorkerThread"    # netty boss thread size,will not be used for UDT    boss-thread-size = 1    #auto default pin or 8    worker-thread-size = 8  }  shutdown {    # when destroy server, wait seconds    wait = 3  }  serialization = "seata"  compressor = "none"}service {  #vgroup-&gt;rgroup  vgroup_mapping.fsp_tx_group = "default"  #only support single node  default.grouplist = "127.0.0.1:8091"  #degrade current not support  enableDegrade = false  #disable  disable = false  #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, default permanent  max.commit.retry.timeout = "-1"  max.rollback.retry.timeout = "-1"  disableGlobalTransaction = false}client {  async.commit.buffer.limit = 10000  lock {    retry.internal = 10    retry.times = 30  }  report.retry.count = 5  tm.commit.retry.count = 1  tm.rollback.retry.count = 1}transaction {  undo.data.validation = true  undo.log.serialization = "jackson"  undo.log.save.days = 7  #schedule delete expired undo_log in milliseconds  undo.log.delete.period = 86400000  undo.log.table = "undo_log"}support {  ## spring  spring {    # auto proxy the DataSource bean    datasource.autoproxy = false  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€registry-conf-1"><a href="#5ã€registry-conf-1" class="headerlink" title="5ã€registry.conf"></a>5ã€registry.conf</h4><pre class="line-numbers language-registry.conf\" data-language="registry.conf\"><code class="language-registry.conf\">registry {  # file ã€nacos ã€eurekaã€redisã€zk  type = "nacos"  nacos {    serverAddr = "106.52.23.202:8848"    namespace = ""    cluster = "default"  }  eureka {    serviceUrl = "http://localhost:8761/eureka"    application = "default"    weight = "1"  }  redis {    serverAddr = "localhost:6381"    db = "0"  }  zk {    cluster = "default"    serverAddr = "127.0.0.1:2181"    session.timeout = 6000    connect.timeout = 2000  }  file {    name = "file.conf"  }}config {  # fileã€nacos ã€apolloã€zk  type = "file"  nacos {    serverAddr = "localhost"    namespace = ""    cluster = "default"  }  apollo {    app.id = "fescar-server"    apollo.meta = "http://192.168.1.204:8801"  }  zk {    serverAddr = "127.0.0.1:2181"    session.timeout = 6000    connect.timeout = 2000  }  file {    name = "file.conf"  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ã€ä¸šåŠ¡ç±»-1"><a href="#6ã€ä¸šåŠ¡ç±»-1" class="headerlink" title="6ã€ä¸šåŠ¡ç±»"></a>6ã€ä¸šåŠ¡ç±»</h4><h5 id="1ã€domain-1"><a href="#1ã€domain-1" class="headerlink" title="1ã€domain"></a>1ã€domain</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Storage</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>    <span class="token comment">/**     * äº§å“id     */</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> productId<span class="token punctuation">;</span>    <span class="token comment">/**     * æ€»åº“å­˜     */</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> total<span class="token punctuation">;</span>    <span class="token comment">/**     * å·²ç”¨åº“å­˜     */</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> used<span class="token punctuation">;</span>    <span class="token comment">/**     * å‰©ä½™åº“å­˜     */</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> residue<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€dao-1"><a href="#2ã€dao-1" class="headerlink" title="2ã€dao"></a>2ã€dao</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Mapper</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StorageDao</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æ‰£å‡åº“å­˜     */</span>    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"productId"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk.springcloud.dao.StorageDao<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk.springcloud.domain.Storage<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BIGINT<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>product_id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>productId<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BIGINT<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>total<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>total<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>used<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>used<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>residue<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>residue<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>decrease<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        UPDATE t_storage        SET used    = used + #{count},            residue = residue - #{count}        WHERE product_id = #{productId}    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€serivce-1"><a href="#3ã€serivce-1" class="headerlink" title="3ã€serivce"></a>3ã€serivce</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StorageService</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æ‰£å‡åº“å­˜     */</span>    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">StorageDao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StorageServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">StorageService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">StorageDao</span> storageDao<span class="token punctuation">;</span>    <span class="token comment">/**     * æ‰£å‡åº“å­˜     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"-------&gt;storage-serviceä¸­æ‰£å‡åº“å­˜å¼€å§‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        storageDao<span class="token punctuation">.</span>decrease <span class="token punctuation">(</span>productId<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"-------&gt;storage-serviceä¸­æ‰£å‡åº“å­˜ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€controller-1"><a href="#4ã€controller-1" class="headerlink" title="4ã€controller"></a>4ã€controller</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">StorageService</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StorageController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">StorageService</span> storageService<span class="token punctuation">;</span>    <span class="token comment">/**     * æ‰£å‡åº“å­˜     */</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/storage/decrease"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>        storageService<span class="token punctuation">.</span>decrease <span class="token punctuation">(</span>productId<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"æ‰£å‡åº“å­˜æˆåŠŸï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="7ã€Configé…ç½®-1"><a href="#7ã€Configé…ç½®-1" class="headerlink" title="7ã€Configé…ç½®"></a>7ã€Configé…ç½®</h4><ul><li>MybatisConfig</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"com.kk.springcloud.dao"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>DataSourceProxyConfig</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>rm<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span></span><span class="token class-name">DataSourceProxy</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">SpringManagedTransactionFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span><span class="token punctuation">;</span><span class="token comment">/* * @Description:    ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç† * @Author:         é˜¿K * @CreateDate:     2022/3/27 13:31 * @Param: * @Return: **/</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceProxyConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${mybatis.mapperLocations}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> mapperLocations<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"spring.datasource"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">druidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">DataSourceProxy</span> <span class="token function">dataSourceProxy</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceProxy</span> <span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">sqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token class-name">DataSourceProxy</span> dataSourceProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">SqlSessionFactoryBean</span> sqlSessionFactoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSessionFactoryBean<span class="token punctuation">.</span>setDataSource <span class="token punctuation">(</span>dataSourceProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSessionFactoryBean<span class="token punctuation">.</span>setMapperLocations <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathMatchingResourcePatternResolver</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>getResources <span class="token punctuation">(</span>mapperLocations<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSessionFactoryBean<span class="token punctuation">.</span>setTransactionFactory <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SpringManagedTransactionFactory</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> sqlSessionFactoryBean<span class="token punctuation">.</span>getObject <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="8ã€ä¸»å¯åŠ¨-1"><a href="#8ã€ä¸»å¯åŠ¨-1" class="headerlink" title="8ã€ä¸»å¯åŠ¨"></a>8ã€ä¸»å¯åŠ¨</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">EnableFeignClients</span><span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token annotation punctuation">@EnableFeignClients</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeataStorageServiceApplication2002</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span>run <span class="token punctuation">(</span><span class="token class-name">SeataStorageServiceApplication2002</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4ã€æ–°å»ºè´¦æˆ·Account-Module"><a href="#4ã€æ–°å»ºè´¦æˆ·Account-Module" class="headerlink" title="4ã€æ–°å»ºè´¦æˆ·Account-Module"></a>4ã€æ–°å»ºè´¦æˆ·Account-Module</h3><h4 id="1ã€model-2"><a href="#1ã€model-2" class="headerlink" title="1ã€model"></a>1ã€model</h4><p>seata-account-service2003</p><h4 id="2ã€pom-2"><a href="#2ã€pom-2" class="headerlink" title="2ã€pom"></a>2ã€pom</h4><pre class="line-numbers language-XML" data-language="XML"><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0"         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;    &lt;parent&gt;        &lt;artifactId&gt;springcloud2021to2022&lt;/artifactId&gt;        &lt;groupId&gt;com.kk&lt;/groupId&gt;        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;    &lt;/parent&gt;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;    &lt;artifactId&gt;seata-account-service2003&lt;/artifactId&gt;    &lt;dependencies&gt;        &lt;!--nacos--&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;!--seata--&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;            &lt;artifactId&gt;spring-cloud-starter-alibaba-seata&lt;/artifactId&gt;            &lt;exclusions&gt;                &lt;exclusion&gt;                    &lt;artifactId&gt;seata-all&lt;/artifactId&gt;                    &lt;groupId&gt;io.seata&lt;/groupId&gt;                &lt;/exclusion&gt;            &lt;/exclusions&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;io.seata&lt;/groupId&gt;            &lt;artifactId&gt;seata-all&lt;/artifactId&gt;            &lt;version&gt;1.0.0&lt;/version&gt;        &lt;/dependency&gt;        &lt;!--feign--&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;            &lt;scope&gt;test&lt;/scope&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;            &lt;version&gt;2.0.0&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;mysql&lt;/groupId&gt;            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;            &lt;version&gt;5.1.37&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;            &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;            &lt;version&gt;1.1.10&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;            &lt;artifactId&gt;lombok&lt;/artifactId&gt;            &lt;optional&gt;true&lt;/optional&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;&lt;/project&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€yml-2"><a href="#3ã€yml-2" class="headerlink" title="3ã€yml"></a>3ã€yml</h4><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2003</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">application</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>account<span class="token punctuation">-</span>service  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>    <span class="token key atrule">alibaba</span><span class="token punctuation">:</span>      <span class="token key atrule">seata</span><span class="token punctuation">:</span>        <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> fsp_tx_group    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 106.52.23.202<span class="token punctuation">:</span><span class="token number">8848</span>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//106.52.23.202<span class="token punctuation">:</span>3306/seata_account    <span class="token key atrule">username</span><span class="token punctuation">:</span> root    <span class="token key atrule">password</span><span class="token punctuation">:</span> root<span class="token key atrule">feign</span><span class="token punctuation">:</span>  <span class="token key atrule">hystrix</span><span class="token punctuation">:</span>    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">logging</span><span class="token punctuation">:</span>  <span class="token key atrule">level</span><span class="token punctuation">:</span>    <span class="token key atrule">io</span><span class="token punctuation">:</span>      <span class="token key atrule">seata</span><span class="token punctuation">:</span> info<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>  <span class="token key atrule">mapperLocations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€file-conf-2"><a href="#4ã€file-conf-2" class="headerlink" title="4ã€file.conf"></a>4ã€file.conf</h4><pre class="line-numbers language-file.conf" data-language="file.conf"><code class="language-file.conf">transport {  # tcp udt unix-domain-socket  type = "TCP"  #NIO NATIVE  server = "NIO"  #enable heartbeat  heartbeat = true  #thread factory for netty  thread-factory {    boss-thread-prefix = "NettyBoss"    worker-thread-prefix = "NettyServerNIOWorker"    server-executor-thread-prefix = "NettyServerBizHandler"    share-boss-worker = false    client-selector-thread-prefix = "NettyClientSelector"    client-selector-thread-size = 1    client-worker-thread-prefix = "NettyClientWorkerThread"    # netty boss thread size,will not be used for UDT    boss-thread-size = 1    #auto default pin or 8    worker-thread-size = 8  }  shutdown {    # when destroy server, wait seconds    wait = 3  }  serialization = "seata"  compressor = "none"}service {  vgroup_mapping.fsp_tx_group = "default" #ä¿®æ”¹è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°  default.grouplist = "127.0.0.1:8091"  enableDegrade = false  disable = false  max.commit.retry.timeout = "-1"  max.rollback.retry.timeout = "-1"  disableGlobalTransaction = false}client {  async.commit.buffer.limit = 10000  lock {    retry.internal = 10    retry.times = 30  }  report.retry.count = 5  tm.commit.retry.count = 1  tm.rollback.retry.count = 1}## transaction log storestore {  ## store mode: fileã€db  mode = "db"  ## file store  file {    dir = "sessionStore"    # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions    max-branch-session-size = 16384    # globe session size , if exceeded throws exceptions    max-global-session-size = 512    # file buffer size , if exceeded allocate new buffer    file-write-buffer-cache-size = 16384    # when recover batch read size    session.reload.read_size = 100    # async, sync    flush-disk-mode = async  }  ## database store  db {    ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc.    datasource = "dbcp"    ## mysql/oracle/h2/oceanbase etc.    db-type = "mysql"    driver-class-name = "com.mysql.jdbc.Driver"    url = "jdbc:mysql://106.52.23.202:3306/seata"    user = "root"    password = "root"    min-conn = 1    max-conn = 3    global.table = "global_table"    branch.table = "branch_table"    lock-table = "lock_table"    query-limit = 100  }}lock {  ## the lock store mode: localã€remote  mode = "remote"  local {    ## store locks in user's database  }  remote {    ## store locks in the seata's server  }}recovery {  #schedule committing retry period in milliseconds  committing-retry-period = 1000  #schedule asyn committing retry period in milliseconds  asyn-committing-retry-period = 1000  #schedule rollbacking retry period in milliseconds  rollbacking-retry-period = 1000  #schedule timeout retry period in milliseconds  timeout-retry-period = 1000}transaction {  undo.data.validation = true  undo.log.serialization = "jackson"  undo.log.save.days = 7  #schedule delete expired undo_log in milliseconds  undo.log.delete.period = 86400000  undo.log.table = "undo_log"}## metrics settingsmetrics {  enabled = false  registry-type = "compact"  # multi exporters use comma divided  exporter-list = "prometheus"  exporter-prometheus-port = 9898}support {  ## spring  spring {    # auto proxy the DataSource bean    datasource.autoproxy = false  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€registry-conf-2"><a href="#5ã€registry-conf-2" class="headerlink" title="5ã€registry.conf"></a>5ã€registry.conf</h4><pre class="line-numbers language-registry.conf" data-language="registry.conf"><code class="language-registry.conf">registry {  # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa  type = "nacos"  nacos {    serverAddr = "106.52.23.202:8848"    namespace = ""    cluster = "default"  }  eureka {    serviceUrl = "http://localhost:8761/eureka"    application = "default"    weight = "1"  }  redis {    serverAddr = "localhost:6379"    db = "0"  }  zk {    cluster = "default"    serverAddr = "127.0.0.1:2181"    session.timeout = 6000    connect.timeout = 2000  }  consul {    cluster = "default"    serverAddr = "127.0.0.1:8500"  }  etcd3 {    cluster = "default"    serverAddr = "http://localhost:2379"  }  sofa {    serverAddr = "127.0.0.1:9603"    application = "default"    region = "DEFAULT_ZONE"    datacenter = "DefaultDataCenter"    cluster = "default"    group = "SEATA_GROUP"    addressWaitTime = "3000"  }  file {    name = "file.conf"  }}config {  # fileã€nacos ã€apolloã€zkã€consulã€etcd3  type = "file"  nacos {    serverAddr = "localhost"    namespace = ""  }  consul {    serverAddr = "127.0.0.1:8500"  }  apollo {    app.id = "seata-server"    apollo.meta = "http://192.168.1.204:8801"  }  zk {    serverAddr = "127.0.0.1:2181"    session.timeout = 6000    connect.timeout = 2000  }  etcd3 {    serverAddr = "http://localhost:2379"  }  file {    name = "file.conf"  }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ã€ä¸šåŠ¡ç±»-2"><a href="#6ã€ä¸šåŠ¡ç±»-2" class="headerlink" title="6ã€ä¸šåŠ¡ç±»"></a>6ã€ä¸šåŠ¡ç±»</h4><h5 id="1ã€domain-2"><a href="#1ã€domain-2" class="headerlink" title="1ã€domain"></a>1ã€domain</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springclpid<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>    <span class="token comment">/**     * ç”¨æˆ·id     */</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>    <span class="token comment">/**     * æ€»é¢åº¦     */</span>    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> total<span class="token punctuation">;</span>    <span class="token comment">/**     * å·²ç”¨é¢åº¦     */</span>    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> used<span class="token punctuation">;</span>    <span class="token comment">/**     * å‰©ä½™é¢åº¦     */</span>    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> residue<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€dao-2"><a href="#2ã€dao-2" class="headerlink" title="2ã€dao"></a>2ã€dao</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Param</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Mapper</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountDao</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æ‰£å‡è´¦æˆ·ä½™é¢     */</span>    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk.springcloud.dao.AccountDao<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kk.springcloud.domain.Account<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BIGINT<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userId<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BIGINT<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>total<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>total<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DECIMAL<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>used<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>used<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DECIMAL<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>residue<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>residue<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DECIMAL<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>decrease<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        UPDATE t_account        SET          residue = residue - #{money},used = used + #{money}        WHERE          user_id = #{userId};    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€serivce-2"><a href="#3ã€serivce-2" class="headerlink" title="3ã€serivce"></a>3ã€serivce</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æ‰£å‡è´¦æˆ·ä½™é¢     *     * @param userId ç”¨æˆ·id     * @param money  é‡‘é¢     */</span>    <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">AccountDao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> LOGGER <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span>getLogger <span class="token punctuation">(</span><span class="token class-name">AccountServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token class-name">AccountDao</span> accountDao<span class="token punctuation">;</span>    <span class="token comment">/**     * æ‰£å‡è´¦æˆ·ä½™é¢     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>        LOGGER<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢å¼€å§‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ¨¡æ‹Ÿè¶…æ—¶å¼‚å¸¸ï¼Œå…¨å±€äº‹åŠ¡å›æ»š</span>        <span class="token comment">//æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span>sleep <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        accountDao<span class="token punctuation">.</span>decrease <span class="token punctuation">(</span>userId<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>        LOGGER<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"-------&gt;account-serviceä¸­æ‰£å‡è´¦æˆ·ä½™é¢ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€controller-2"><a href="#4ã€controller-2" class="headerlink" title="4ã€controller"></a>4ã€controller</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">AccountService</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token class-name">AccountService</span> accountService<span class="token punctuation">;</span>    <span class="token comment">/**     * æ‰£å‡è´¦æˆ·ä½™é¢     */</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/account/decrease"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>        accountService<span class="token punctuation">.</span>decrease <span class="token punctuation">(</span>userId<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"æ‰£å‡è´¦æˆ·ä½™é¢æˆåŠŸï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="7ã€Configé…ç½®-2"><a href="#7ã€Configé…ç½®-2" class="headerlink" title="7ã€Configé…ç½®"></a>7ã€Configé…ç½®</h4><ul><li>MybatisConfig</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MapperScan</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"com.kk.springcloud.dao"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisConfig</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>DataSourceProxyConfig</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>seata<span class="token punctuation">.</span>rm<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span></span><span class="token class-name">DataSourceProxy</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">SpringManagedTransactionFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span><span class="token punctuation">;</span><span class="token comment">/* * @Description:    ä½¿ç”¨Seataå¯¹æ•°æ®æºè¿›è¡Œä»£ç† * @Author:         é˜¿K * @CreateDate:     2022/3/27 13:31 * @Param: * @Return: **/</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceProxyConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${mybatis.mapperLocations}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> mapperLocations<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"spring.datasource"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">druidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">DataSourceProxy</span> <span class="token function">dataSourceProxy</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceProxy</span> <span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">sqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token class-name">DataSourceProxy</span> dataSourceProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">SqlSessionFactoryBean</span> sqlSessionFactoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSessionFactoryBean<span class="token punctuation">.</span>setDataSource <span class="token punctuation">(</span>dataSourceProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSessionFactoryBean<span class="token punctuation">.</span>setMapperLocations <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathMatchingResourcePatternResolver</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>getResources <span class="token punctuation">(</span>mapperLocations<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sqlSessionFactoryBean<span class="token punctuation">.</span>setTransactionFactory <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SpringManagedTransactionFactory</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> sqlSessionFactoryBean<span class="token punctuation">.</span>getObject <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="8ã€ä¸»å¯åŠ¨-2"><a href="#8ã€ä¸»å¯åŠ¨-2" class="headerlink" title="8ã€ä¸»å¯åŠ¨"></a>8ã€ä¸»å¯åŠ¨</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">EnableFeignClients</span><span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token annotation punctuation">@EnableFeignClients</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SeataAccountMainApp2003</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span>run <span class="token punctuation">(</span><span class="token class-name">SeataAccountMainApp2003</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å…­ã€Test"><a href="#å…­ã€Test" class="headerlink" title="å…­ã€Test"></a>å…­ã€Test</h2><h3 id="1ã€åˆå§‹æƒ…å†µ"><a href="#1ã€åˆå§‹æƒ…å†µ" class="headerlink" title="1ã€åˆå§‹æƒ…å†µ"></a>1ã€åˆå§‹æƒ…å†µ</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220327221856.png"></p><h3 id="2ã€æ­£å¸¸ä¸‹å•"><a href="#2ã€æ­£å¸¸ä¸‹å•" class="headerlink" title="2ã€æ­£å¸¸ä¸‹å•"></a>2ã€æ­£å¸¸ä¸‹å•</h3><h4 id="1ã€è¯·æ±‚"><a href="#1ã€è¯·æ±‚" class="headerlink" title="1ã€è¯·æ±‚"></a>1ã€è¯·æ±‚</h4><p><a href="http://localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100">http://localhost:2001/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100</a></p><h4 id="2ã€æ•°æ®åº“æƒ…å†µ"><a href="#2ã€æ•°æ®åº“æƒ…å†µ" class="headerlink" title="2ã€æ•°æ®åº“æƒ…å†µ"></a>2ã€æ•°æ®åº“æƒ…å†µ</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220327235131.png"></p><h3 id="3ã€æ— æ³¨è§£"><a href="#3ã€æ— æ³¨è§£" class="headerlink" title="3ã€æ— æ³¨è§£"></a>3ã€æ— æ³¨è§£</h3><p><strong>è¶…æ—¶å¼‚å¸¸ï¼Œæ²¡åŠ @GlobalTransactional</strong></p><p>1ã€AccountServiceImplæ·»åŠ è¶…æ—¶</p><p>2ã€æ•°æ®åº“æƒ…å†µ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220327235239.png"></p><p>3ã€æ•…éšœæƒ…å†µ</p><ul><li>å½“åº“å­˜å’Œè´¦æˆ·é‡‘é¢æ‰£å‡åï¼Œè®¢å•çŠ¶æ€å¹¶æ²¡æœ‰è®¾ç½®ä¸ºå·²ç»å®Œæˆï¼Œæ²¡æœ‰ä»é›¶æ”¹ä¸º1</li><li>è€Œä¸”ç”±äºfeignçš„é‡è¯•æœºåˆ¶ï¼Œè´¦æˆ·ä½™é¢è¿˜æœ‰å¯èƒ½è¢«å¤šæ¬¡æ‰£å‡</li></ul><h3 id="4ã€æœ‰æ³¨è§£"><a href="#4ã€æœ‰æ³¨è§£" class="headerlink" title="4ã€æœ‰æ³¨è§£"></a>4ã€æœ‰æ³¨è§£</h3><p><strong>è¶…æ—¶å¼‚å¸¸ï¼Œæ·»åŠ @GlobalTransactional</strong></p><p>1ã€AccountServiceImplæ·»åŠ è¶…æ—¶</p><p>2ã€OrderServiceImpl@GlobalTransactional</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GlobalTransactional</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"fsp-create-order"</span><span class="token punctuation">,</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span><span class="token punctuation">{</span>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3ã€ç»“æœ</p><ul><li>ä¸‹å•åæ•°æ®åº“æ•°æ®å¹¶æ²¡æœ‰ä»»ä½•æ”¹å˜</li><li>è®°å½•éƒ½æ·»åŠ ä¸è¿›æ¥</li></ul><h2 id="ä¸ƒã€ä¸€éƒ¨åˆ†è¡¥å……"><a href="#ä¸ƒã€ä¸€éƒ¨åˆ†è¡¥å……" class="headerlink" title="ä¸ƒã€ä¸€éƒ¨åˆ†è¡¥å……"></a>ä¸ƒã€ä¸€éƒ¨åˆ†è¡¥å……</h2><h3 id="1ã€å†çœ‹TC-TM-RMä¸‰å¤§ç»„ä»¶"><a href="#1ã€å†çœ‹TC-TM-RMä¸‰å¤§ç»„ä»¶" class="headerlink" title="1ã€å†çœ‹TC/TM/RMä¸‰å¤§ç»„ä»¶"></a>1ã€å†çœ‹TC/TM/RMä¸‰å¤§ç»„ä»¶</h3><p><strong>åˆ†å¸ƒå¼äº‹åŠ¡çš„æ‰§è¡Œæµç¨‹</strong></p><p>1ã€TM å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆTM å‘ TC æ³¨å†Œå…¨å±€äº‹åŠ¡è®°å½•ï¼‰ï¼›</p><p>2ã€æŒ‰ä¸šåŠ¡åœºæ™¯ï¼Œç¼–æ’æ•°æ®åº“ã€æœåŠ¡ç­‰äº‹åŠ¡å†…èµ„æºï¼ˆRM å‘ TC æ±‡æŠ¥èµ„æºå‡†å¤‡çŠ¶æ€ ï¼‰ï¼›</p><p>3ã€TM ç»“æŸåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸€é˜¶æ®µç»“æŸï¼ˆTM é€šçŸ¥ TC æäº¤/å›æ»šåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ï¼›</p><p>4ã€TC æ±‡æ€»äº‹åŠ¡ä¿¡æ¯ï¼Œå†³å®šåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æäº¤è¿˜æ˜¯å›æ»šï¼›</p><p>5ã€TC é€šçŸ¥æ‰€æœ‰ RM æäº¤/å›æ»š èµ„æºï¼Œäº‹åŠ¡äºŒé˜¶æ®µç»“æŸã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220328000204.png"></p><h3 id="2ã€ATæ¨¡å¼å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥"><a href="#2ã€ATæ¨¡å¼å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥" class="headerlink" title="2ã€ATæ¨¡å¼å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥"></a>2ã€ATæ¨¡å¼å¦‚ä½•åšåˆ°å¯¹ä¸šåŠ¡çš„æ— ä¾µå…¥</h3><h4 id="1ã€æ˜¯ä»€ä¹ˆ-1"><a href="#1ã€æ˜¯ä»€ä¹ˆ-1" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220328000223.png"></p><h4 id="2ã€ä¸€é˜¶æ®µåŠ è½½"><a href="#2ã€ä¸€é˜¶æ®µåŠ è½½" class="headerlink" title="2ã€ä¸€é˜¶æ®µåŠ è½½"></a>2ã€ä¸€é˜¶æ®µåŠ è½½</h4><p>åœ¨ä¸€é˜¶æ®µï¼ŒSeata ä¼šæ‹¦æˆªâ€œä¸šåŠ¡ SQLâ€ï¼Œ<br>1  è§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œä¸šåŠ¡ SQLâ€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€œbefore imageâ€ï¼Œ<br>2  æ‰§è¡Œâ€œä¸šåŠ¡ SQLâ€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹åï¼Œ<br>3  å…¶ä¿å­˜æˆâ€œafter imageâ€ï¼Œæœ€åç”Ÿæˆè¡Œé”ã€‚<br>ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220328000410.png"></p><h4 id="3ã€äºŒé˜¶æ®µæäº¤"><a href="#3ã€äºŒé˜¶æ®µæäº¤" class="headerlink" title="3ã€äºŒé˜¶æ®µæäº¤"></a>3ã€äºŒé˜¶æ®µæäº¤</h4><p>äºŒé˜¶æ®µå¦‚æ˜¯é¡ºåˆ©æäº¤çš„è¯ï¼Œ<br>å› ä¸ºâ€œä¸šåŠ¡ SQLâ€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œæ‰€ä»¥Seataæ¡†æ¶åªéœ€å°†<code>ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯</code>ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220328000347.png"></p><h4 id="3ã€äºŒé˜¶æ®µå›æ»š"><a href="#3ã€äºŒé˜¶æ®µå›æ»š" class="headerlink" title="3ã€äºŒé˜¶æ®µå›æ»š"></a>3ã€äºŒé˜¶æ®µå›æ»š</h4><p>äºŒé˜¶æ®µå›æ»šï¼š<br>äºŒé˜¶æ®µå¦‚æœæ˜¯å›æ»šçš„è¯ï¼ŒSeata å°±éœ€è¦å›æ»šä¸€é˜¶æ®µå·²ç»æ‰§è¡Œçš„â€œä¸šåŠ¡ SQLâ€ï¼Œè¿˜åŸä¸šåŠ¡æ•°æ®ã€‚<br>å›æ»šæ–¹å¼ä¾¿æ˜¯ç”¨â€œbefore imageâ€è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œ â€œafter imageâ€ï¼Œ<br>å¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰è„å†™ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220328000322.png"></p><h3 id="3ã€è¡¥å……"><a href="#3ã€è¡¥å……" class="headerlink" title="3ã€è¡¥å……"></a>3ã€è¡¥å……</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220328000437.png"></p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="å‚è€ƒæ–‡æ¡£-â†“"><a href="#å‚è€ƒæ–‡æ¡£-â†“" class="headerlink" title="å‚è€ƒæ–‡æ¡£ â†“"></a>å‚è€ƒæ–‡æ¡£ â†“</h2><p>docker å®‰è£…é—®é¢˜ï¼š<a href="https://www.cnblogs.com/youngyajun/p/14002547.html">https://www.cnblogs.com/youngyajun/p/14002547.html</a></p><p>docker ç½‘ç»œé—®é¢˜ï¼š<a href="https://blog.csdn.net/tilyp/article/details/103371360">https://blog.csdn.net/tilyp/article/details/103371360</a></p><p>docker è¿è¡Œé—®é¢˜ï¼š<a href="https://www.manongdao.com/article-2421258.html">https://www.manongdao.com/article-2421258.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ" scheme="https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"/>
    
    
    <category term="springcloud-alibaba" scheme="https://mykkto.github.io/tags/springcloud-alibaba/"/>
    
    <category term="seata" scheme="https://mykkto.github.io/tags/seata/"/>
    
    <category term="åˆ†å¸ƒå¼äº‹åŠ¡" scheme="https://mykkto.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>äº‘ä¸»æœºéƒ¨ç½²å¹¶åŒæ­¥æ›´æ–°äºŒçº§åŸŸå</title>
    <link href="https://mykkto.github.io/posts/829b453d.html"/>
    <id>https://mykkto.github.io/posts/829b453d.html</id>
    <published>2022-03-20T08:17:13.000Z</published>
    <updated>2022-11-22T15:05:04.625Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä¸€ã€æœ¬åœ°æ‹‰å–é…ç½®"><a href="#ä¸€ã€æœ¬åœ°æ‹‰å–é…ç½®" class="headerlink" title="ä¸€ã€æœ¬åœ°æ‹‰å–é…ç½®"></a>ä¸€ã€æœ¬åœ°æ‹‰å–é…ç½®</h2><h3 id="1ã€åˆ›å»ºå¹¶å¯åŠ¨"><a href="#1ã€åˆ›å»ºå¹¶å¯åŠ¨" class="headerlink" title="1ã€åˆ›å»ºå¹¶å¯åŠ¨"></a>1ã€åˆ›å»ºå¹¶å¯åŠ¨</h3><h4 id="1ã€æ‹‰å–"><a href="#1ã€æ‹‰å–" class="headerlink" title="1ã€æ‹‰å–"></a>1ã€æ‹‰å–</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker pull nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€å¯åŠ¨"><a href="#2ã€å¯åŠ¨" class="headerlink" title="2ã€å¯åŠ¨"></a>2ã€å¯åŠ¨</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span><span class="token punctuation">-</span>name nginx<span class="token punctuation">-</span>test <span class="token punctuation">-</span>p 80<span class="token punctuation">:</span>80 <span class="token punctuation">-</span>d nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>â€“ name å®¹å™¨å‘½å</p><p>-v æ˜ å°„ç›®å½•</p><p>-d è®¾ç½®å®¹å™¨åå°è¿è¡Œ</p><p>-p æœ¬æœºç«¯å£æ˜ å°„ å°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„80ç«¯å£</p><h3 id="2ã€æ˜ å°„åˆ°æœ¬åœ°"><a href="#2ã€æ˜ å°„åˆ°æœ¬åœ°" class="headerlink" title="2ã€æ˜ å°„åˆ°æœ¬åœ°"></a>2ã€æ˜ å°„åˆ°æœ¬åœ°</h3><h4 id="1ã€åˆ›å»º"><a href="#1ã€åˆ›å»º" class="headerlink" title="1ã€åˆ›å»º"></a>1ã€åˆ›å»º</h4><p>é¦–å…ˆåœ¨æœ¬æœºåˆ›å»ºnginxçš„ä¸€äº›æ–‡ä»¶å­˜å‚¨ç›®å½•</p><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">mkdir -p /root/nginx/www /root/nginx/logs /root/nginx/conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>www</strong>: nginxå­˜å‚¨ç½‘ç«™ç½‘é¡µçš„ç›®å½•</p><p><strong>logs</strong>: nginxæ—¥å¿—ç›®å½•</p><p><strong>conf</strong>: nginxé…ç½®æ–‡ä»¶ç›®å½•</p><h4 id="2ã€æ˜ å°„"><a href="#2ã€æ˜ å°„" class="headerlink" title="2ã€æ˜ å°„"></a>2ã€æ˜ å°„</h4><p>ï¼ˆ1ï¼‰å…ˆæŸ¥çœ‹å®¹å™¨</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker ps <span class="token punctuation">-</span>a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ï¼ˆ2ï¼‰æ˜ å°„</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker cp 481e121fb29f<span class="token punctuation">:</span>/etc/nginx/nginx.conf /root/nginx/conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3ã€å¯åŠ¨å®¹å™¨"><a href="#3ã€å¯åŠ¨å®¹å™¨" class="headerlink" title="3ã€å¯åŠ¨å®¹å™¨"></a>3ã€å¯åŠ¨å®¹å™¨</h3><p>éœ€è¦è¯´æ˜ä¸‹ï¼Œngxin-test å®¹å™¨æ˜¯ä¸ºäº†è·å¾—å®¹å™¨çš„é…ç½®æ–‡ä»¶ï¼Œæœ€ç»ˆä½¿ç”¨çš„æ˜¯ nginx-web</p><p>ç›®å‰å·²ç»å¯åŠ¨ nginx-test 80ç«¯å£ï¼Œè‹¥æ˜¯ nginx-webæŒ‡å®šçš„ä¹Ÿæ˜¯ 80ï¼Œå°±éœ€è¦å…³é—­ nginx-testäº†</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker stop nginx<span class="token punctuation">-</span>test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1ã€æ–°å®¹å™¨æ˜ å°„"><a href="#1ã€æ–°å®¹å™¨æ˜ å°„" class="headerlink" title="1ã€æ–°å®¹å™¨æ˜ å°„"></a>1ã€æ–°å®¹å™¨æ˜ å°„</h4><p>åˆ›å»ºæ–°nginxå®¹å™¨nginx-web,å¹¶å°†<strong>www,logs,conf</strong>ç›®å½•æ˜ å°„åˆ°æœ¬åœ°</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 80<span class="token punctuation">:</span>80 <span class="token punctuation">-</span><span class="token punctuation">-</span>name nginx<span class="token punctuation">-</span>web <span class="token punctuation">-</span>v /root/nginx/www<span class="token punctuation">:</span>/usr/share/nginx/html <span class="token punctuation">-</span>v /root/nginx/conf/nginx.conf<span class="token punctuation">:</span>/etc/nginx/nginx.conf <span class="token punctuation">-</span>v /root/nginx/logs<span class="token punctuation">:</span>/var/log/nginx nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€å¯åŠ¨-1"><a href="#2ã€å¯åŠ¨-1" class="headerlink" title="2ã€å¯åŠ¨"></a>2ã€å¯åŠ¨</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker start nginx<span class="token punctuation">-</span>web<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="äºŒã€ä¸‹è½½git"><a href="#äºŒã€ä¸‹è½½git" class="headerlink" title="äºŒã€ä¸‹è½½git"></a>äºŒã€ä¸‹è½½git</h2><h3 id="1ã€ä¸‹è½½"><a href="#1ã€ä¸‹è½½" class="headerlink" title="1ã€ä¸‹è½½"></a>1ã€ä¸‹è½½</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token function">git</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2ã€é…ç½®github-ä»£ç†"><a href="#2ã€é…ç½®github-ä»£ç†" class="headerlink" title="2ã€é…ç½®github ä»£ç†"></a>2ã€é…ç½®github ä»£ç†</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git">git config --global url.<span class="token string">"https://ghproxy.com/https://github.com"</span>.insteadOf <span class="token string">"https://github.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3ã€æ‹‰å–"><a href="#3ã€æ‹‰å–" class="headerlink" title="3ã€æ‹‰å–"></a>3ã€æ‹‰å–</h3><pre class="line-numbers language-git" data-language="git"><code class="language-git">git clone  https://github.com/mykkTo/mykkTo.github.io.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4ã€å‰ªåˆ‡æ–‡ä»¶"><a href="#4ã€å‰ªåˆ‡æ–‡ä»¶" class="headerlink" title="4ã€å‰ªåˆ‡æ–‡ä»¶"></a>4ã€å‰ªåˆ‡æ–‡ä»¶</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mv</span> /root/nginx/www/mykkTo.github.io/* /root/nginx/www<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä¸‰ã€å®šæ—¶ä»»åŠ¡"><a href="#ä¸‰ã€å®šæ—¶ä»»åŠ¡" class="headerlink" title="ä¸‰ã€å®šæ—¶ä»»åŠ¡"></a>ä¸‰ã€å®šæ—¶ä»»åŠ¡</h2><h3 id="1ã€ç¼–å†™shellè„šæœ¬"><a href="#1ã€ç¼–å†™shellè„šæœ¬" class="headerlink" title="1ã€ç¼–å†™shellè„šæœ¬"></a>1ã€ç¼–å†™shellè„šæœ¬</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token comment">#åˆ é™¤åŸå§‹é™æ€é¡µé¢æ•°æ®ä»¥åŠæ‹‰å–çš„æ–‡ä»¶å¤¹</span><span class="token function">rm</span> -rf /root/nginx/www/*<span class="token function">rm</span> -rf /root/nginx/mykkTo.github.iopwd<span class="token comment">#æ‹‰å–ï¼Œå‰ªåˆ‡åˆ°80æ˜ å°„ä¸‹</span><span class="token builtin class-name">cd</span>  /root/nginx/<span class="token function">git</span> clone https://github.com/mykkTo/mykkTo.github.io.git<span class="token function">mv</span> /root/nginx/mykkTo.github.io/* /root/nginx/www<span class="token comment">#å¤åˆ¶ä»¤ç‰Œç”¨æˆ·ç™¾åº¦ç«™é•¿éªŒè¯ä½¿ç”¨</span><span class="token function">cp</span> /root/nginx/baidu_verify_code-Os7hLX61vV.html /root/nginx/www/baidu_verify_code-Os7hLX61vV.html<span class="token comment">#æ›¿æ¢æ–‡æœ¬ï¼Œç”¨äºç™¾åº¦ç«™é•¿seoæ˜ å°„</span><span class="token function">sed</span> <span class="token string">'s/github.io/cn/g'</span> /root/nginx/www/baidu_urls.txt<span class="token operator">&gt;</span>/root/nginx/www/baidu_urls1.txt<span class="token function">sed</span> <span class="token string">'s/https/http/g'</span> /root/nginx/www/baidu_urls1.txt<span class="token operator">&gt;</span>/root/nginx/www/baidu_urls2.txt<span class="token builtin class-name">echo</span> <span class="token string">"============æˆåŠŸ========="</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2ã€åˆ›å»ºå®šæ—¶ä»»åŠ¡"><a href="#2ã€åˆ›å»ºå®šæ—¶ä»»åŠ¡" class="headerlink" title="2ã€åˆ›å»ºå®šæ—¶ä»»åŠ¡"></a>2ã€åˆ›å»ºå®šæ—¶ä»»åŠ¡</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">crontab</span> -e<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220321202335.png"></p><p><strong>è¡¥å……ï¼š</strong></p><p>linux é»‘æ´ï¼Œé˜²æ­¢èµ„æºå ç”¨</p><p><code>/dev/null 2&gt;&amp;1</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#åç¼€åŠ ä¸Š</span>/root/nginx/synblog.sh /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>å¯åŠ¨ï¼š</strong></p><p>è¿™è¾¹è®¾ç½®æ²¡ä¸€ä¸ªå°æ—¶æ›´æ–°ä¸€æ¬¡ï¼ˆéœ€è¦æ³¨æ„centos7.6å†™æ³•å¯åŠ¨ï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> crond start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å››ã€SSLè¯ä¹¦"><a href="#å››ã€SSLè¯ä¹¦" class="headerlink" title="å››ã€SSLè¯ä¹¦"></a>å››ã€SSLè¯ä¹¦</h2><h3 id="1ã€æ˜¯ä»€ä¹ˆ"><a href="#1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h3><p>æ•°æ®åŠ å¯†ï¼šå¼€å¯ HTTPS ç»¿è‰²åŠ å¯†é€šé“ï¼Œç½‘ç«™æ•°æ®çš„åŠ å¯†ä¼ è¾“ï¼Œé˜²æ­¢ç½‘ç«™æ ¸å¿ƒæ•°æ®è¢«çªƒå–æˆ–ç¯¡æ”¹ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠ http è®¿é—®çš„å˜æˆ httpsï¼Œå¹¶ä¸”æµè§ˆå™¨æ˜¾ç¤ºå®‰å…¨ï¼Œä¸åœ¨æ˜¯ä¸å®‰å…¨äº†</p><h3 id="2ã€è·å–è¯ä¹¦"><a href="#2ã€è·å–è¯ä¹¦" class="headerlink" title="2ã€è·å–è¯ä¹¦"></a>2ã€è·å–è¯ä¹¦</h3><h4 id="1ã€ä¸‹è½½-1"><a href="#1ã€ä¸‹è½½-1" class="headerlink" title="1ã€ä¸‹è½½"></a>1ã€ä¸‹è½½</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220331205350.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220331205411.png"></p><h4 id="2ã€ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹"><a href="#2ã€ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹" class="headerlink" title="2ã€ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹"></a>2ã€ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220331205527.png"></p><h3 id="3ã€é‡æŒ‚è½½"><a href="#3ã€é‡æŒ‚è½½" class="headerlink" title="3ã€é‡æŒ‚è½½"></a>3ã€é‡æŒ‚è½½</h3><h4 id="1ã€åˆ æ‰ä¹‹å‰çš„å®¹å™¨"><a href="#1ã€åˆ æ‰ä¹‹å‰çš„å®¹å™¨" class="headerlink" title="1ã€åˆ æ‰ä¹‹å‰çš„å®¹å™¨"></a>1ã€åˆ æ‰ä¹‹å‰çš„å®¹å™¨</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker rm <span class="token punctuation">-</span>f nginx<span class="token punctuation">-</span>web<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€é‡æ–°æŒ‚è½½"><a href="#2ã€é‡æ–°æŒ‚è½½" class="headerlink" title="2ã€é‡æ–°æŒ‚è½½"></a>2ã€é‡æ–°æŒ‚è½½</h4><p>1ã€æ–°å¢äº† 443ç«¯å£æ˜ å°„ï¼Œç›®å½•æŒ‚è½½</p><p>2ã€å®¹å™¨å¤–ï¼Œåœ¨nginxåº•ä¸‹ï¼Œåˆ›å»ºæ–°ç›®å½•</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span>   lls<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220331204305.png"></p><p>3ã€åˆ›å»ºå®¹å™¨</p><p>å¤šåŠ äº†ä¸¤ä¸ªé…ç½®</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 443<span class="token punctuation">:</span>443 <span class="token punctuation">-</span>p 80<span class="token punctuation">:</span>80 <span class="token punctuation">-</span><span class="token punctuation">-</span>name nginx<span class="token punctuation">-</span>web <span class="token punctuation">-</span>v /root/nginx/www<span class="token punctuation">:</span>/usr/share/nginx/html <span class="token punctuation">-</span>v /root/nginx/conf/nginx.conf<span class="token punctuation">:</span>/etc/nginx/nginx.conf <span class="token punctuation">-</span>v /root/nginx/logs<span class="token punctuation">:</span>/var/log/nginx <span class="token punctuation">-</span>v /root/nginx/lls/<span class="token punctuation">:</span>/etc/nginx/ssl nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4ã€ä¿®æ”¹é…ç½®"><a href="#4ã€ä¿®æ”¹é…ç½®" class="headerlink" title="4ã€ä¿®æ”¹é…ç½®"></a>4ã€ä¿®æ”¹é…ç½®</h3><p>nginx.conf</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">user</span>  nginx<span class="token punctuation">;</span><span class="token keyword">worker_processes</span>  auto<span class="token punctuation">;</span><span class="token keyword">error_log</span>  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>error<span class="token punctuation">.</span>log notice<span class="token punctuation">;</span><span class="token keyword">pid</span>        <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>nginx<span class="token punctuation">.</span><span class="token keyword">pid</span><span class="token punctuation">;</span><span class="token keyword">events</span> <span class="token punctuation">{</span>    <span class="token keyword">worker_connections</span>  <span class="token number">1024</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">http</span> <span class="token punctuation">{</span><span class="token keyword">limit_req_zone</span> <span class="token variable">$binary_remote_addr</span> zone<span class="token operator">=</span>mylimit<span class="token punctuation">:</span><span class="token number">10</span>m rate<span class="token operator">=</span><span class="token number">2</span>r<span class="token operator">/</span>s<span class="token punctuation">;</span><span class="token keyword">include</span>       <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>mime<span class="token punctuation">.</span><span class="token keyword">types</span><span class="token punctuation">;</span>    <span class="token keyword">default_type</span>  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>    <span class="token keyword">log_format</span>  main  <span class="token string">'$remote_addr - $remote_user [$time_local] "$request" '</span>                      <span class="token string">'$status $body_bytes_sent "$http_referer" '</span>                      <span class="token string">'"$http_user_agent" "$http_x_forwarded_for"'</span><span class="token punctuation">;</span>    <span class="token keyword">access_log</span>  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>    <span class="token keyword">sendfile</span>        on<span class="token punctuation">;</span>    <span class="token comment">#tcp_nopush     on;</span>    <span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span><span class="token punctuation">;</span>    <span class="token comment">#gzip  on;</span>   <span class="token keyword">include</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>conf<span class="token punctuation">;</span>  <span class="token keyword">server</span><span class="token punctuation">{</span>        <span class="token keyword">listen</span> <span class="token number">443</span> <span class="token keyword">ssl</span><span class="token punctuation">;</span>        <span class="token comment">#å¯¹åº”çš„åŸŸåï¼ŒæŠŠmykkto.cnæ”¹æˆä½ ä»¬è‡ªå·±çš„åŸŸåå°±å¯ä»¥äº†</span>        <span class="token keyword">server_name</span> mykkto<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>        <span class="token comment">#è¯ä¹¦çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶</span>        <span class="token keyword">ssl_certificate</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token operator">/</span><span class="token number">7526194</span>_www<span class="token punctuation">.</span>mykkto<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>        <span class="token keyword">ssl_certificate_key</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span><span class="token keyword">ssl</span><span class="token operator">/</span><span class="token number">7526194</span>_www<span class="token punctuation">.</span>mykkto<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>key<span class="token punctuation">;</span><span class="token comment">#ä»¥ä¸‹éƒ½æ˜¯ä¸€äº›åŠ å¯†è§„åˆ™</span>        <span class="token keyword">ssl_session_timeout</span> <span class="token number">5</span>m<span class="token punctuation">;</span>        <span class="token keyword">ssl_protocols</span> TLSv1 TLSv1<span class="token punctuation">.</span><span class="token number">1</span> TLSv1<span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">ssl_ciphers</span> ECDHE<span class="token operator">-</span>RSA<span class="token operator">-</span>AES128<span class="token operator">-</span>GCM<span class="token operator">-</span>SHA256<span class="token punctuation">:</span>HIGH<span class="token punctuation">:</span><span class="token operator">!</span>aNULL<span class="token punctuation">:</span><span class="token operator">!</span>MD5<span class="token punctuation">:</span><span class="token operator">!</span>RC4<span class="token punctuation">:</span><span class="token operator">!</span>DHE<span class="token punctuation">;</span>        <span class="token keyword">ssl_prefer_server_ciphers</span> on<span class="token punctuation">;</span>        <span class="token comment">#è¿™æ˜¯æˆ‘çš„ä¸»é¡µè®¿é—®åœ°å€ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯é™æ€çš„htmlç½‘é¡µï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨locationå°±å¯ä»¥å®Œæˆäº†ã€‚</span>        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>                <span class="token comment">#æ–‡ä»¶å¤¹ï¼ˆè¿™ä¸ªå…¶å®æŒ‚è½½çš„å°±æ˜¯å¤–éƒ¨çš„wwwç›®å½•ä¸‹çš„é™æ€èµ„æºï¼‰</span>                <span class="token keyword">root</span> <span class="token operator">/</span><span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>                <span class="token comment">#ä¸»é¡µæ–‡ä»¶</span>                <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">server</span> <span class="token punctuation">{</span>   <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>        <span class="token comment">#è¿™è¾¹ç©ºæ ¼éš”å¼€ï¼Œé…ç½®äº†ä¸¤ä¸ªï¼Œå› ä¸ºåŠ äº†wwwä¹Ÿè¦é…ç½®</span>       <span class="token keyword">server_name</span> mykkto<span class="token punctuation">.</span>cn www<span class="token punctuation">.</span>mykkto<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>       <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>$ <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mykkto<span class="token punctuation">.</span>cn<span class="token punctuation">:</span><span class="token number">443</span><span class="token operator">/</span>$<span class="token number">1</span> permanent<span class="token punctuation">;</span>  <span class="token comment"># location / {</span>  <span class="token comment">#     limit_req zone=mylimit;</span>  <span class="token comment">#}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5ã€é‡å¯å¹¶æµ‹è¯•"><a href="#5ã€é‡å¯å¹¶æµ‹è¯•" class="headerlink" title="5ã€é‡å¯å¹¶æµ‹è¯•"></a>5ã€é‡å¯å¹¶æµ‹è¯•</h3><h4 id="1ã€é‡å¯"><a href="#1ã€é‡å¯" class="headerlink" title="1ã€é‡å¯"></a>1ã€é‡å¯</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker restart nginx<span class="token punctuation">-</span>web<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€æµ‹è¯•"><a href="#2ã€æµ‹è¯•" class="headerlink" title="2ã€æµ‹è¯•"></a>2ã€æµ‹è¯•</h4><p>1ã€è®¿é—®ï¼Œ<a href="http://www.mykkto.cnm,è‡ªåŠ¨è·³è½¬/">www.mykkto.cnmï¼Œè‡ªåŠ¨è·³è½¬</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220331204859.png"></p><p>2ã€è®¿é—®ï¼Œmykkto.cnï¼Œè‡ªåŠ¨è·³è½¬</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220331204919.png"></p><h2 id="äº”ã€IPé»‘åå•é™åˆ¶"><a href="#äº”ã€IPé»‘åå•é™åˆ¶" class="headerlink" title="äº”ã€IPé»‘åå•é™åˆ¶"></a>äº”ã€IPé»‘åå•é™åˆ¶</h2><h3 id="1ã€å‰è¨€"><a href="#1ã€å‰è¨€" class="headerlink" title="1ã€å‰è¨€"></a>1ã€å‰è¨€</h3><h4 id="1ã€ç”¨åˆ°ä»€ä¹ˆæŠ€æœ¯æ ˆ"><a href="#1ã€ç”¨åˆ°ä»€ä¹ˆæŠ€æœ¯æ ˆ" class="headerlink" title="1ã€ç”¨åˆ°ä»€ä¹ˆæŠ€æœ¯æ ˆ"></a>1ã€ç”¨åˆ°ä»€ä¹ˆæŠ€æœ¯æ ˆ</h4><p>é¦–å…ˆï¼ŒåŸºæœ¬æ¶æ„æ˜¯  docker+nginx+lua+mysqlè¿™æ˜¯æœ€åˆçš„æƒ³æ³•ï¼Œä½†æ˜¯ä½œè€…ç”¨äº†dockeræ­å»ºçš„nginxï¼Œluaæ¨¡å—é›†æˆä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥æ›¿æ¢æˆäº†ï¼ŒOpenRestyã€‚</p><h4 id="2ã€ä»€ä¹ˆæ˜¯-OpenResty"><a href="#2ã€ä»€ä¹ˆæ˜¯-OpenResty" class="headerlink" title="2ã€ä»€ä¹ˆæ˜¯ OpenResty"></a>2ã€ä»€ä¹ˆæ˜¯ OpenResty</h4><p>ç®€å•æ¥è¯´å°±æ˜¯ lua + nginxï¼Œå½“ç„¶è¿˜æœ‰æ›´å¤šåŠŸèƒ½ï¼Œè‡ªå·±ç™¾åº¦å§</p><h4 id="3ã€é‡åˆ°çš„é—®é¢˜"><a href="#3ã€é‡åˆ°çš„é—®é¢˜" class="headerlink" title="3ã€é‡åˆ°çš„é—®é¢˜"></a>3ã€é‡åˆ°çš„é—®é¢˜</h4><p>ç®€å•æè¿°ä¸‹ï¼Œä¸Šé¢ç”¨åˆ°çš„ <code>nginx.conf</code>å†™æ³•ï¼Œå‰ç¼€ <code>user  nginx;</code> ä¼šå¯¼è‡´æ— æ³•è¿è¡Œï¼Œå› ä¸ºopenrestyæ²¡æœ‰è¿™ä¸ªç”¨æˆ·ï¼Œå¯ä»¥è‡ªå·±æ–°å»ºï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯æ”¹å†™é…ç½®ã€‚</p><h3 id="2ã€æ­å»º-OpenResty"><a href="#2ã€æ­å»º-OpenResty" class="headerlink" title="2ã€æ­å»º OpenResty"></a>2ã€æ­å»º OpenResty</h3><h4 id="1ã€æ‹‰å–-1"><a href="#1ã€æ‹‰å–-1" class="headerlink" title="1ã€æ‹‰å–"></a>1ã€æ‹‰å–</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker pull openresty/openresty<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€æŒ‚è½½å¹¶å¯åŠ¨"><a href="#2ã€æŒ‚è½½å¹¶å¯åŠ¨" class="headerlink" title="2ã€æŒ‚è½½å¹¶å¯åŠ¨"></a>2ã€æŒ‚è½½å¹¶å¯åŠ¨</h4><p><strong>è¯´æ˜ä¸‹ï¼š</strong></p><ul><li>å®Œå…¨åŸºäºä¸Šé¢çš„nginxé…ç½®çš„ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå”¯ä¸€ä¿®æ”¹çš„æ˜¯ <code>nginx.conf</code>é…ç½®æ–‡ä»¶ï¼Œè¿™è¾¹æŒ‚è½½æ”¹æˆäº† <code>nginx2.conf</code>ï¼Œç”¨äºä¿ç•™ä¹‹å‰çš„ï¼ˆè‡ªå·±æ‡’è€Œå·²ï¼‰</li><li>æ–°å¢äº†ï¼Œluaæ–‡ä»¶æŒ‚è½½</li><li>ä¿®æ”¹äº†å®¹å™¨å†…çš„æŒ‚è½½ä½ç½®ï¼Œå› ä¸º openrestyå®¹å™¨ä½ç½®ä¸ä¸€æ ·äº†(å¤–éƒ¨è¿˜æ˜¯ä¸å˜ï¼Œå®¹å™¨å†…çš„ä½ç½®å˜äº†)</li></ul><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 443<span class="token punctuation">:</span>443 <span class="token punctuation">-</span>p 80<span class="token punctuation">:</span>80 <span class="token punctuation">-</span><span class="token punctuation">-</span>name openresty <span class="token punctuation">-</span>v /root/nginx/www<span class="token punctuation">:</span>/usr/local/openresty/nginx/html <span class="token punctuation">-</span>v /root/nginx/conf/nginx2.conf<span class="token punctuation">:</span>/usr/local/openresty/nginx/conf/nginx.conf <span class="token punctuation">-</span>v /root/nginx/logs<span class="token punctuation">:</span>/usr/local/openresty/nginx/logs <span class="token punctuation">-</span>v  /root/nginx/lls/<span class="token punctuation">:</span>/usr/local/openresty/nginx/ssl <span class="token punctuation">-</span>v  /root/nginx/lua/<span class="token punctuation">:</span>/usr/local/openresty/nginx/lua  openresty/openresty<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3ã€é…ç½®æ–‡ä»¶ä¿®æ”¹"><a href="#3ã€é…ç½®æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="3ã€é…ç½®æ–‡ä»¶ä¿®æ”¹"></a>3ã€é…ç½®æ–‡ä»¶ä¿®æ”¹</h3><h4 id="1ã€åˆå§‹åŒ–"><a href="#1ã€åˆå§‹åŒ–" class="headerlink" title="1ã€åˆå§‹åŒ–"></a>1ã€åˆå§‹åŒ–</h4><p>è¿™æ˜¯è‡ªå¸¦çš„ï¼Œå¯ä»¥è‡ªå·±  DIY</p><pre class="line-numbers language-nginx.conf" data-language="nginx.conf"><code class="language-nginx.conf"># nginx.conf  --  docker-openresty## This file is installed to:#   `/usr/local/openresty/nginx/conf/nginx.conf`# and is the file loaded by nginx at startup,# unless the user specifies otherwise.## It tracks the upstream OpenResty's `nginx.conf`, but removes the `server`# section and adds this directive:#     `include /etc/nginx/conf.d/*.conf;`## The `docker-openresty` file `nginx.vh.default.conf` is copied to# `/etc/nginx/conf.d/default.conf`.  It contains the `server section# of the upstream `nginx.conf`.## See https://github.com/openresty/docker-openresty/blob/master/README.md#nginx-config-files##user  nobody;#worker_processes 1;# Enables the use of JIT for regular expressions to speed-up their processing.pcre_jit on;#error_log  logs/error.log;#error_log  logs/error.log  notice;#error_log  logs/error.log  info;#pid        logs/nginx.pid;events {    worker_connections  1024;}http {    include       mime.types;    default_type  application/octet-stream;    # Enables or disables the use of underscores in client request header fields.    # When the use of underscores is disabled, request header fields whose names contain underscores are marked as invalid and become subject to the ignore_invalid_headers directive.    # underscores_in_headers off;    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '    #                  '$status $body_bytes_sent "$http_referer" '    #                  '"$http_user_agent" "$http_x_forwarded_for"';    #access_log  logs/access.log  main;        # Log in JSON Format        # log_format nginxlog_json escape=json '{ "timestamp": "$time_iso8601", '        # '"remote_addr": "$remote_addr", '        #  '"body_bytes_sent": $body_bytes_sent, '        #  '"request_time": $request_time, '        #  '"response_status": $status, '        #  '"request": "$request", '        #  '"request_method": "$request_method", '        #  '"host": "$host",'        #  '"upstream_addr": "$upstream_addr",'        #  '"http_x_forwarded_for": "$http_x_forwarded_for",'        #  '"http_referrer": "$http_referer", '        #  '"http_user_agent": "$http_user_agent", '        #  '"http_version": "$server_protocol", '        #  '"nginx_access": true }';        # access_log /dev/stdout nginxlog_json;    # See Move default writable paths to a dedicated directory (#119)    # https://github.com/openresty/docker-openresty/issues/119    client_body_temp_path /var/run/openresty/nginx-client-body;    proxy_temp_path       /var/run/openresty/nginx-proxy;    fastcgi_temp_path     /var/run/openresty/nginx-fastcgi;    uwsgi_temp_path       /var/run/openresty/nginx-uwsgi;    scgi_temp_path        /var/run/openresty/nginx-scgi;    sendfile        on;    #tcp_nopush     on;    #keepalive_timeout  0;    keepalive_timeout  65;    #gzip  on;    include /etc/nginx/conf.d/*.conf;    # Don't reveal OpenResty version to clients.    # server_tokens off;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€å¼•å…¥ä¹‹å‰çš„é…ç½®"><a href="#2ã€å¼•å…¥ä¹‹å‰çš„é…ç½®" class="headerlink" title="2ã€å¼•å…¥ä¹‹å‰çš„é…ç½®"></a>2ã€å¼•å…¥ä¹‹å‰çš„é…ç½®</h4><p>åœ¨åˆå§‹çš„åŸºç¡€ä¸ŠåŠ ä¸Šï¼Œä¸¤ä¸ªä¹‹å‰å†™å¥½çš„ server å—ï¼Œä»¥åŠluaè„šæœ¬ç”¨äºæµ‹è¯•</p><pre class="line-numbers language-lua" data-language="lua"><code class="language-lua"><span class="token operator">#</span> nginx<span class="token punctuation">.</span>conf  <span class="token comment">--  docker-openresty</span><span class="token operator">#</span><span class="token operator">#</span> This file is installed to<span class="token punctuation">:</span><span class="token operator">#</span>   `<span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>openresty<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">/</span>nginx<span class="token punctuation">.</span>conf`<span class="token operator">#</span> <span class="token keyword">and</span> is the file loaded by nginx at startup<span class="token punctuation">,</span><span class="token operator">#</span> unless the user specifies otherwise<span class="token punctuation">.</span><span class="token operator">#</span><span class="token operator">#</span> It tracks the upstream OpenResty's `nginx<span class="token punctuation">.</span>conf`<span class="token punctuation">,</span> but removes the `server`<span class="token operator">#</span> section <span class="token keyword">and</span> adds this directive<span class="token punctuation">:</span><span class="token operator">#</span>     `include <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>conf<span class="token punctuation">;</span>`<span class="token operator">#</span><span class="token operator">#</span> The `docker<span class="token operator">-</span>openresty` file `nginx<span class="token punctuation">.</span>vh<span class="token punctuation">.</span>default<span class="token punctuation">.</span>conf` is copied to<span class="token operator">#</span> `<span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span>default<span class="token punctuation">.</span>conf`<span class="token punctuation">.</span>  It contains the `server section<span class="token operator">#</span> of the upstream `nginx<span class="token punctuation">.</span>conf`<span class="token punctuation">.</span><span class="token operator">#</span><span class="token operator">#</span> See https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>openresty<span class="token operator">/</span>docker<span class="token operator">-</span>openresty<span class="token operator">/</span>blob<span class="token operator">/</span>master<span class="token operator">/</span>README<span class="token punctuation">.</span>md<span class="token operator">#</span>nginx<span class="token operator">-</span>config<span class="token operator">-</span>files<span class="token operator">#</span><span class="token operator">#</span>user  nobody<span class="token punctuation">;</span><span class="token operator">#</span>worker_processes <span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">#</span> Enables the use of JIT <span class="token keyword">for</span> regular expressions to speed<span class="token operator">-</span>up their processing<span class="token punctuation">.</span>pcre_jit on<span class="token punctuation">;</span><span class="token operator">#</span>error_log  logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log<span class="token punctuation">;</span><span class="token operator">#</span>error_log  logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log  notice<span class="token punctuation">;</span><span class="token operator">#</span>error_log  logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log  info<span class="token punctuation">;</span><span class="token operator">#</span>pid        logs<span class="token operator">/</span>nginx<span class="token punctuation">.</span>pid<span class="token punctuation">;</span><span class="token function">events</span> <span class="token punctuation">{</span>    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">http</span> <span class="token punctuation">{</span>    include       mime<span class="token punctuation">.</span>types<span class="token punctuation">;</span>    default_type  application<span class="token operator">/</span>octet<span class="token operator">-</span>stream<span class="token punctuation">;</span>    <span class="token operator">#</span> Enables <span class="token keyword">or</span> disables the use of underscores <span class="token keyword">in</span> client request header fields<span class="token punctuation">.</span>    <span class="token operator">#</span> When the use of underscores is disabled<span class="token punctuation">,</span> request header fields whose names contain underscores are marked as invalid <span class="token keyword">and</span> become subject to the ignore_invalid_headers directive<span class="token punctuation">.</span>    <span class="token operator">#</span> underscores_in_headers off<span class="token punctuation">;</span>    <span class="token operator">#</span>log_format  main  <span class="token string">'$remote_addr - $remote_user [$time_local] "$request" '</span>    <span class="token operator">#</span>                  <span class="token string">'$status $body_bytes_sent "$http_referer" '</span>    <span class="token operator">#</span>                  <span class="token string">'"$http_user_agent" "$http_x_forwarded_for"'</span><span class="token punctuation">;</span>    <span class="token operator">#</span>access_log  logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>        <span class="token operator">#</span> Log <span class="token keyword">in</span> JSON Format        <span class="token operator">#</span> log_format nginxlog_json escape<span class="token operator">=</span>json <span class="token string">'{ "timestamp": "$time_iso8601", '</span>        <span class="token operator">#</span> <span class="token string">'"remote_addr": "$remote_addr", '</span>        <span class="token operator">#</span>  <span class="token string">'"body_bytes_sent": $body_bytes_sent, '</span>        <span class="token operator">#</span>  <span class="token string">'"request_time": $request_time, '</span>        <span class="token operator">#</span>  <span class="token string">'"response_status": $status, '</span>        <span class="token operator">#</span>  <span class="token string">'"request": "$request", '</span>        <span class="token operator">#</span>  <span class="token string">'"request_method": "$request_method", '</span>        <span class="token operator">#</span>  <span class="token string">'"host": "$host",'</span>        <span class="token operator">#</span>  <span class="token string">'"upstream_addr": "$upstream_addr",'</span>        <span class="token operator">#</span>  <span class="token string">'"http_x_forwarded_for": "$http_x_forwarded_for",'</span>        <span class="token operator">#</span>  <span class="token string">'"http_referrer": "$http_referer", '</span>        <span class="token operator">#</span>  <span class="token string">'"http_user_agent": "$http_user_agent", '</span>        <span class="token operator">#</span>  <span class="token string">'"http_version": "$server_protocol", '</span>        <span class="token operator">#</span>  <span class="token string">'"nginx_access": true }'</span><span class="token punctuation">;</span>        <span class="token operator">#</span> access_log <span class="token operator">/</span>dev<span class="token operator">/</span>stdout nginxlog_json<span class="token punctuation">;</span>    <span class="token operator">#</span> See Move default writable paths to a dedicated <span class="token function">directory</span> <span class="token punctuation">(</span><span class="token operator">#</span><span class="token number">119</span><span class="token punctuation">)</span>    <span class="token operator">#</span> https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>openresty<span class="token operator">/</span>docker<span class="token operator">-</span>openresty<span class="token operator">/</span>issues<span class="token operator">/</span><span class="token number">119</span>    client_body_temp_path <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>openresty<span class="token operator">/</span>nginx<span class="token operator">-</span>client<span class="token operator">-</span>body<span class="token punctuation">;</span>    proxy_temp_path       <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>openresty<span class="token operator">/</span>nginx<span class="token operator">-</span>proxy<span class="token punctuation">;</span>    fastcgi_temp_path     <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>openresty<span class="token operator">/</span>nginx<span class="token operator">-</span>fastcgi<span class="token punctuation">;</span>    uwsgi_temp_path       <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>openresty<span class="token operator">/</span>nginx<span class="token operator">-</span>uwsgi<span class="token punctuation">;</span>    scgi_temp_path        <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>openresty<span class="token operator">/</span>nginx<span class="token operator">-</span>scgi<span class="token punctuation">;</span>    sendfile        on<span class="token punctuation">;</span>    <span class="token operator">#</span>tcp_nopush     on<span class="token punctuation">;</span>    <span class="token operator">#</span>keepalive_timeout  <span class="token number">0</span><span class="token punctuation">;</span>    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>    <span class="token operator">#</span>gzip  on<span class="token punctuation">;</span>    include <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>conf<span class="token punctuation">;</span>  <span class="token function">server</span><span class="token punctuation">{</span>        listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>        <span class="token operator">#</span>å¯¹åº”çš„åŸŸåï¼ŒæŠŠmykkto<span class="token punctuation">.</span>cnæ”¹æˆä½ ä»¬è‡ªå·±çš„åŸŸåå°±å¯ä»¥äº†        server_name mykkto<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>        <span class="token operator">#</span>è¯ä¹¦çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶        ssl_certificate <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>openresty<span class="token operator">/</span>nginx<span class="token operator">/</span>ssl<span class="token operator">/</span>7526194_www<span class="token punctuation">.</span>mykkto<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>pem<span class="token punctuation">;</span>        ssl_certificate_key <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>openresty<span class="token operator">/</span>nginx<span class="token operator">/</span>ssl<span class="token operator">/</span>7526194_www<span class="token punctuation">.</span>mykkto<span class="token punctuation">.</span>cn<span class="token punctuation">.</span>key<span class="token punctuation">;</span><span class="token operator">#</span>ä»¥ä¸‹éƒ½æ˜¯ä¸€äº›åŠ å¯†è§„åˆ™        ssl_session_timeout 5m<span class="token punctuation">;</span>        ssl_protocols TLSv1 TLSv1<span class="token punctuation">.</span><span class="token number">1</span> TLSv1<span class="token punctuation">.</span><span class="token number">2</span><span class="token punctuation">;</span>        ssl_ciphers ECDHE<span class="token operator">-</span>RSA<span class="token operator">-</span>AES128<span class="token operator">-</span>GCM<span class="token operator">-</span>SHA256<span class="token punctuation">:</span>HIGH<span class="token punctuation">:</span>!aNULL<span class="token punctuation">:</span>!MD5<span class="token punctuation">:</span>!RC4<span class="token punctuation">:</span>!DHE<span class="token punctuation">;</span>        ssl_prefer_server_ciphers on<span class="token punctuation">;</span>        <span class="token operator">#</span>è¿™æ˜¯æˆ‘çš„ä¸»é¡µè®¿é—®åœ°å€ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯é™æ€çš„htmlç½‘é¡µï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨locationå°±å¯ä»¥å®Œæˆäº†ã€‚        location <span class="token operator">/</span> <span class="token punctuation">{</span>                <span class="token operator">#</span>æ–‡ä»¶å¤¹ï¼ˆè¿™ä¸ªå…¶å®æŒ‚è½½çš„å°±æ˜¯å¤–éƒ¨çš„wwwç›®å½•ä¸‹çš„é™æ€èµ„æºï¼‰                root <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>openresty<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>                <span class="token operator">#</span>ä¸»é¡µæ–‡ä»¶                index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token operator">#</span>luaè„šæœ¬ç”¨äºæµ‹è¯•location <span class="token operator">/</span><span class="token function">lua</span> <span class="token punctuation">{</span>   default_type <span class="token string">'text/html'</span><span class="token punctuation">;</span>   content_by_lua <span class="token string">'ngx.say("&lt;h1&gt; hello,openrestry&lt;/h1&gt;")'</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token function">server</span> <span class="token punctuation">{</span>   listen <span class="token number">80</span><span class="token punctuation">;</span>        <span class="token operator">#</span>è¿™è¾¹ç©ºæ ¼éš”å¼€ï¼Œé…ç½®äº†ä¸¤ä¸ªï¼Œå› ä¸ºåŠ äº†wwwä¹Ÿè¦é…ç½®       server_name mykkto<span class="token punctuation">.</span>cn www<span class="token punctuation">.</span>mykkto<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>       rewrite <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>$ https<span class="token punctuation">:</span><span class="token operator">//</span>mykkto<span class="token punctuation">.</span>cn<span class="token punctuation">:</span><span class="token number">443</span><span class="token operator">/</span>$<span class="token number">1</span> permanent<span class="token punctuation">;</span>  <span class="token operator">#</span> location <span class="token operator">/</span> <span class="token punctuation">{</span>  <span class="token operator">#</span>     limit_req zone<span class="token operator">=</span>mylimit<span class="token punctuation">;</span>  <span class="token operator">#</span><span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token operator">#</span> Don't reveal OpenResty version to clients<span class="token punctuation">.</span>    <span class="token operator">#</span> server_tokens off<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€æµ‹è¯•luaè„šæœ¬"><a href="#3ã€æµ‹è¯•luaè„šæœ¬" class="headerlink" title="3ã€æµ‹è¯•luaè„šæœ¬"></a>3ã€æµ‹è¯•luaè„šæœ¬</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220403120349.png"></p><h2 id="å…­ã€é™æµ"><a href="#å…­ã€é™æµ" class="headerlink" title="å…­ã€é™æµ"></a>å…­ã€é™æµ</h2><h3 id="1ã€é…ç½®"><a href="#1ã€é…ç½®" class="headerlink" title="1ã€é…ç½®"></a>1ã€é…ç½®</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">http <span class="token punctuation">{</span>    limit_req_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>one:10m <span class="token assign-left variable">rate</span><span class="token operator">=</span>5r/s<span class="token punctuation">;</span>    server <span class="token punctuation">{</span>        location /search/ <span class="token punctuation">{</span>            limit_req <span class="token assign-left variable">zone</span><span class="token operator">=</span>one <span class="token assign-left variable">burst</span><span class="token operator">=</span><span class="token number">5</span> nodelay<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;</strong></p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼š<code>$binary_remote_addr</code> è¡¨ç¤ºé€šè¿‡remote_addrè¿™ä¸ªæ ‡è¯†æ¥åšé™åˆ¶ï¼Œâ€œbinary_â€çš„ç›®çš„æ˜¯ç¼©å†™å†…å­˜å ç”¨é‡ï¼Œæ˜¯é™åˆ¶åŒä¸€å®¢æˆ·ç«¯ipåœ°å€ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°ï¼š<code>zone=one:10m</code>è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º10Mï¼Œåå­—ä¸ºoneçš„å†…å­˜åŒºåŸŸï¼Œç”¨æ¥å­˜å‚¨è®¿é—®çš„é¢‘æ¬¡ä¿¡æ¯ã€‚</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š<code>rate=5r/s</code>è¡¨ç¤ºå…è®¸ç›¸åŒæ ‡è¯†çš„å®¢æˆ·ç«¯çš„è®¿é—®é¢‘æ¬¡ï¼Œè¿™é‡Œé™åˆ¶çš„æ˜¯æ¯ç§’ 5 æ¬¡ï¼Œè¿˜å¯ä»¥æœ‰æ¯”å¦‚30r/mçš„ã€‚</li></ul><p><strong>limit_req zone=one burst=5 nodelay;</strong></p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼š<code>zone=one</code> è®¾ç½®ä½¿ç”¨å“ªä¸ªé…ç½®åŒºåŸŸæ¥åšé™åˆ¶ï¼Œä¸ä¸Šé¢limit_req_zone é‡Œçš„nameå¯¹åº”ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°ï¼š<code>burst=5</code>ï¼Œé‡ç‚¹è¯´æ˜ä¸€ä¸‹è¿™ä¸ªé…ç½®ï¼Œburstçˆ†å‘çš„æ„æ€ï¼Œè¿™ä¸ªé…ç½®çš„æ„æ€æ˜¯è®¾ç½®ä¸€ä¸ªå¤§å°ä¸º5çš„ç¼“å†²åŒºå½“æœ‰å¤§é‡è¯·æ±‚ï¼ˆçˆ†å‘ï¼‰è¿‡æ¥æ—¶ï¼Œè¶…è¿‡äº†è®¿é—®é¢‘æ¬¡é™åˆ¶çš„è¯·æ±‚å¯ä»¥å…ˆæ”¾åˆ°è¿™ä¸ªç¼“å†²åŒºå†…ã€‚</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š<code>nodelay</code>ï¼Œå¦‚æœè®¾ç½®ï¼Œè¶…è¿‡è®¿é—®é¢‘æ¬¡è€Œä¸”ç¼“å†²åŒºä¹Ÿæ»¡äº†çš„æ—¶å€™å°±ä¼šç›´æ¥è¿”å›503ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™æ‰€æœ‰è¯·æ±‚ä¼šç­‰å¾…æ’é˜Ÿã€‚</li></ul><h3 id="2ã€ç½‘ç«™é…ç½®æºç "><a href="#2ã€ç½‘ç«™é…ç½®æºç " class="headerlink" title="2ã€ç½‘ç«™é…ç½®æºç "></a>2ã€ç½‘ç«™é…ç½®æºç </h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#user  nobody;</span><span class="token comment">#worker_processes 1;</span><span class="token comment"># Enables the use of JIT for regular expressions to speed-up their processing.</span>pcre_jit on<span class="token punctuation">;</span><span class="token comment">#error_log  logs/error.log;</span><span class="token comment">#error_log  logs/error.log  notice;</span><span class="token comment">#error_log  logs/error.log  info;</span><span class="token comment">#pid        logs/nginx.pid;</span>events <span class="token punctuation">{</span>    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span><span class="token punctuation">}</span>http <span class="token punctuation">{</span>    include       mime.types<span class="token punctuation">;</span>    default_type  application/octet-stream<span class="token punctuation">;</span>        server_tokens off<span class="token punctuation">;</span>        <span class="token comment">#å¼•å…¥libåŒ…</span>    lua_package_path <span class="token string">"/usr/local/openresty/lualib/?.lua;;"</span><span class="token punctuation">;</span>        <span class="token comment">#å¼€è¾Ÿä¸€å—å†…å­˜åŒºåŸŸ</span>        lua_shared_dict ip_blacklist 4m<span class="token punctuation">;</span>    <span class="token comment"># Enables or disables the use of underscores in client request header fields.</span>    <span class="token comment"># When the use of underscores is disabled, request header fields whose names contain underscores are marked as invalid and become subject to the ignore_invalid_headers directive.</span>    <span class="token comment"># underscores_in_headers off;</span>    <span class="token comment">#log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span>    <span class="token comment">#                  '$status $body_bytes_sent "$http_referer" '</span>    <span class="token comment">#                  '"$http_user_agent" "$http_x_forwarded_for"';</span>    <span class="token comment">#access_log  logs/access.log  main;</span>        <span class="token comment"># Log in JSON Format</span>        <span class="token comment"># log_format nginxlog_json escape=json '{ "timestamp": "$time_iso8601", '</span>        <span class="token comment"># '"remote_addr": "$remote_addr", '</span>        <span class="token comment">#  '"body_bytes_sent": $body_bytes_sent, '</span>        <span class="token comment">#  '"request_time": $request_time, '</span>        <span class="token comment">#  '"response_status": $status, '</span>        <span class="token comment">#  '"request": "$request", '</span>        <span class="token comment">#  '"request_method": "$request_method", '</span>        <span class="token comment">#  '"host": "$host",'</span>        <span class="token comment">#  '"upstream_addr": "$upstream_addr",'</span>        <span class="token comment">#  '"http_x_forwarded_for": "$http_x_forwarded_for",'</span>        <span class="token comment">#  '"http_referrer": "$http_referer", '</span>        <span class="token comment">#  '"http_user_agent": "$http_user_agent", '</span>        <span class="token comment">#  '"http_version": "$server_protocol", '</span>        <span class="token comment">#  '"nginx_access": true }';</span>        <span class="token comment"># access_log /dev/stdout nginxlog_json;</span>    <span class="token comment"># See Move default writable paths to a dedicated directory (#119)</span>    <span class="token comment"># https://github.com/openresty/docker-openresty/issues/119</span>    client_body_temp_path /var/run/openresty/nginx-client-body<span class="token punctuation">;</span>    proxy_temp_path       /var/run/openresty/nginx-proxy<span class="token punctuation">;</span>    fastcgi_temp_path     /var/run/openresty/nginx-fastcgi<span class="token punctuation">;</span>    uwsgi_temp_path       /var/run/openresty/nginx-uwsgi<span class="token punctuation">;</span>    scgi_temp_path        /var/run/openresty/nginx-scgi<span class="token punctuation">;</span>    sendfile        on<span class="token punctuation">;</span>    <span class="token comment">#tcp_nopush     on;</span>    <span class="token comment">#keepalive_timeout  0;</span>    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>    <span class="token comment">#gzip  on;</span>    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span><span class="token comment">#é™æµè®¾ç½®</span>limit_req_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>one:30m <span class="token assign-left variable">rate</span><span class="token operator">=</span>10r/s<span class="token punctuation">;</span>         server<span class="token punctuation">{</span>        listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>        <span class="token comment">#å¯¹åº”çš„åŸŸåï¼ŒæŠŠmykkto.cnæ”¹æˆä½ ä»¬è‡ªå·±çš„åŸŸåå°±å¯ä»¥äº†</span>        server_name mykkto.cn<span class="token punctuation">;</span>        <span class="token comment">#è¯ä¹¦çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶</span>        ssl_certificate /usr/local/openresty/nginx/ssl/7526194_www.mykkto.cn.pem<span class="token punctuation">;</span>        ssl_certificate_key /usr/local/openresty/nginx/ssl/7526194_www.mykkto.cn.key<span class="token punctuation">;</span>                <span class="token comment">#ä»¥ä¸‹éƒ½æ˜¯ä¸€äº›åŠ å¯†è§„åˆ™</span>        ssl_session_timeout 5m<span class="token punctuation">;</span>        ssl_protocols TLSv1 TLSv1.1 TLSv1.2<span class="token punctuation">;</span>        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:<span class="token operator">!</span>aNULL:<span class="token operator">!</span>MD5:<span class="token operator">!</span>RC4:<span class="token operator">!</span>DHE<span class="token punctuation">;</span>        ssl_prefer_server_ciphers on<span class="token punctuation">;</span>        <span class="token comment">#è¿™æ˜¯æˆ‘çš„ä¸»é¡µè®¿é—®åœ°å€ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯é™æ€çš„htmlç½‘é¡µï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨locationå°±å¯ä»¥å®Œæˆäº†ã€‚</span>                <span class="token builtin class-name">set</span> <span class="token variable">$real_ip</span> <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$http_x_forwarded_for</span> ~ <span class="token string">"^(\d+\.\d+\.\d+\.\d+)"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token builtin class-name">set</span> <span class="token variable">$real_ip</span> <span class="token variable">$1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>          <span class="token comment"># ç®¡ç†ä¿¡æ¯ï¼Œè®¿é—®è¯¥URLå¯ä»¥æŸ¥çœ‹nginxä¸­çš„IPé»‘åå•ä¿¡æ¯</span>  location /get-ipblacklist-info <span class="token punctuation">{</span>    access_by_lua_file /usr/local/openresty/nginx/lua/get_ipblacklist_info.lua<span class="token punctuation">;</span>  <span class="token punctuation">}</span>        <span class="token comment"># åŒæ­¥URLï¼Œé€šè¿‡å®šæ—¶ä»»åŠ¡è°ƒç”¨è¯¥URL,å®ç°IPé»‘åå•ä»mysqlåˆ°nginxçš„å®šæ—¶åˆ·æ–°</span>  location /sync-ipblacklist <span class="token punctuation">{</span>   access_by_lua_file /usr/local/openresty/nginx/lua/sync_ipblacklist.lua<span class="token punctuation">;</span>  <span class="token punctuation">}</span>        location / <span class="token punctuation">{</span><span class="token comment">#é™æµ</span>limit_req <span class="token assign-left variable">zone</span><span class="token operator">=</span>one <span class="token assign-left variable">burst</span><span class="token operator">=</span><span class="token number">10</span> nodelay<span class="token punctuation">;</span>                                <span class="token comment"># æ‰€æœ‰IPè¿›æ¥éƒ½è¦æ ¡éªŒ</span>                                access_by_lua_file /usr/local/openresty/nginx/lua/check_realip.lua<span class="token punctuation">;</span><span class="token comment">#                               proxy_read_timeout  60s;</span><span class="token comment">#                               proxy_set_header    Host $http_host;</span><span class="token comment">#                               proxy_set_header    X-Real_IP $remote_addr;</span><span class="token comment">#                               proxy_set_header    X-Forwarded-for $remote_addr;</span><span class="token comment">#                               proxy_http_version  1.1;</span>                <span class="token comment">#æ–‡ä»¶å¤¹ï¼ˆè¿™ä¸ªå…¶å®æŒ‚è½½çš„å°±æ˜¯å¤–éƒ¨çš„wwwç›®å½•ä¸‹çš„é™æ€èµ„æºï¼‰</span>                root /usr/local/openresty/nginx/html<span class="token punctuation">;</span>                <span class="token comment">#ä¸»é¡µæ–‡ä»¶</span>                index index.html<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token punctuation">}</span>   server <span class="token punctuation">{</span>   listen <span class="token number">80</span><span class="token punctuation">;</span>        <span class="token comment">#è¿™è¾¹ç©ºæ ¼éš”å¼€ï¼Œé…ç½®äº†ä¸¤ä¸ªï¼Œå› ä¸ºåŠ äº†wwwä¹Ÿè¦é…ç½®</span>       server_name mykkto.cn www.mykkto.cn<span class="token punctuation">;</span>       rewrite ^/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ https://mykkto.cn:443/<span class="token variable">$1</span> permanent<span class="token punctuation">;</span>  <span class="token comment"># location / {</span>  <span class="token comment">#     limit_req zone=mylimit;</span>  <span class="token comment">#}</span><span class="token punctuation">}</span>    <span class="token comment"># Don't reveal OpenResty version to clients.</span>    <span class="token comment"># server_tokens off;</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h3><p>QPSï¼š3000å‹æµ‹ 5æ¬¡</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220410235912.png"></p><p>å‹æµ‹çš„IPä¸º  Aï¼Œé€šè¿‡ï¼ŒåŒç½‘æ®µçš„æœºå™¨è®¿é—®ï¼ˆæ‰‹æœºæ¨¡æ‹Ÿï¼‰ï¼Œ503å¼‚å¸¸ï¼Œç»“è®ºè¢«é™æµæˆåŠŸ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/testfsjhdgjdhfjk1.jpg"></p><p>åˆ‡æ¢ç½‘æ®µB ï¼Œéå‹æµ‹IP ä¸é™æµï¼Œæµ‹è¯•æˆåŠŸ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/fkdgjgdhjf56jh7j6h.jpg"></p><h2 id="ä¸ƒã€DNSè§£æ-Github-Pagesï¼ˆæ— æœåŠ¡å™¨åŒ–ï¼‰"><a href="#ä¸ƒã€DNSè§£æ-Github-Pagesï¼ˆæ— æœåŠ¡å™¨åŒ–ï¼‰" class="headerlink" title="ä¸ƒã€DNSè§£æ+Github Pagesï¼ˆæ— æœåŠ¡å™¨åŒ–ï¼‰"></a>ä¸ƒã€DNSè§£æ+Github Pagesï¼ˆæ— æœåŠ¡å™¨åŒ–ï¼‰</h2><p>å‰æï¼šå…ˆä¹°ä¸ªDNSè§£æï¼Œåšä¸»ç›®å‰åŸŸåå’ŒDNSè§£æéƒ½æ˜¯ä¹°é˜¿é‡Œäº‘çš„</p><h3 id="1ã€DNSè§£æåŸŸå"><a href="#1ã€DNSè§£æåŸŸå" class="headerlink" title="1ã€DNSè§£æåŸŸå"></a>1ã€DNSè§£æåŸŸå</h3><p>è¿™ä¸ªæ˜¯åˆç‰ˆ1.0ï¼Œé”™è¯¯çš„ï¼Œå› ä¸º ä¸»æœºè®°å½•è§£æ  * å¯èƒ½è¦†ç›–åé¢åºŠå›¾æŒ‡å‘çš„ v1 é…ç½®</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202211051308830.png"></p><p>æ­£ç¡®é…ç½®ï¼šæœ€æ–°ç‰ˆï¼ï¼ï¼</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202211222248798.png"></p><h3 id="2ã€Github-Pages"><a href="#2ã€Github-Pages" class="headerlink" title="2ã€Github Pages"></a>2ã€Github Pages</h3><p>è¿›å…¥è‡ªå·±äºŒçº§é™æ€ç½‘ç«™ä»“åº“ï¼Œé…ç½®ï¼ˆå¦‚æœæœ‰é…SSLè¯ä¹¦çš„æ‰“å‹¾ï¼Œæ²¡æœ‰ä¸éœ€è¦æ‰“å‹¾ HTTPSï¼‰</p><p>å…³äºè¯ä¹¦ï¼šåé¢æ­å»ºåºŠå›¾ä¹Ÿéœ€è¦æŒ‡å‘ï¼Œä¸ç„¶æ— æ³•åŠ è½½å›¾ç‰‡ï¼ˆå°å‘ï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202211051309517.png"></p><h2 id="å…«ã€Nginxæ­å»ºåºŠå›¾"><a href="#å…«ã€Nginxæ­å»ºåºŠå›¾" class="headerlink" title="å…«ã€Nginxæ­å»ºåºŠå›¾"></a>å…«ã€Nginxæ­å»ºåºŠå›¾</h2><p>åŸºäºdnsè§£æ  +  Github pages æ˜ å°„é€‚é…</p><p>ä¼ ç»Ÿæ­å»ºæ–¹å¼ï¼ˆhttpï¼‰,ä¼šå¯¼è‡´åœ¨  img ä¸Šæ¸²æŸ“å›¾ç‰‡çš„æ—¶å€™æ— æ³•æ˜¾ç¤ºï¼ˆè°·æ­Œæµè§ˆå™¨ï¼ŒIEæµè§ˆå™¨ä¼šï¼Œ360æé€Ÿä¸ä¼šâ€“å…·ä½“ä¸æ¸…æ¥šï¼‰ï¼Œ</p><p>å› ä¸º pages å¼€å¯äº† https æ‰€ä»¥ï¼Œè‡ªå·±æ­å»ºçš„åºŠå›¾ä¹Ÿè¦æ˜¯  https ï¼ˆæˆ‘æ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œç„¶åå®ç°ï¼Œç¡®å®å¯ä»¥äº†ï¼‰</p><p>åˆ†æï¼šä¸€å¼€å§‹çœ‹åˆ° console æ§åˆ¶å°ï¼Œ ä¸€å †å›¾ç‰‡æŠ¥é”™ ï¼Œäºæ˜¯æ‹¿è¿æ¥å»è¯·æ±‚ï¼Œå‘ç°ä¸å¯ä»¥è®¿é—®ï¼ˆå¸¦httpï¼Œæ—  sï¼‰</p><h3 id="1ã€é…ç½®åŸŸåè§£æ"><a href="#1ã€é…ç½®åŸŸåè§£æ" class="headerlink" title="1ã€é…ç½®åŸŸåè§£æ"></a>1ã€é…ç½®åŸŸåè§£æ</h3><p>åˆç‰ˆ1.0ï¼ŒåºŸå¼ƒï¼Œæœ€å¥½ä¸è¦ç”¨  _  ä¸ºå‰ç¼€ï¼Œå› ä¸ºåé¢è¦æ˜¯æœ‰é…ç½®SSLè¯ä¹¦ï¼Œå°±æ— æ³•é€šè¿‡</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202211121142179.png"></p><p>æœ€æ–°2.0é…ç½®ï¼Œå®Œç¾è§£å†³äº†æ‰€æœ‰é—®é¢˜</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202211222248798.png"></p><h3 id="2ã€é…ç½®SSLè¯ä¹¦"><a href="#2ã€é…ç½®SSLè¯ä¹¦" class="headerlink" title="2ã€é…ç½®SSLè¯ä¹¦"></a>2ã€é…ç½®SSLè¯ä¹¦</h3><p>è´­ä¹°è¯ä¹¦ï¼Œè¿™è¾¹ä½œè€…ç”¨çš„æ˜¯å…è´¹çš„</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202211222259557.png"></p><p>ç„¶åä¸‹è½½éƒ¨ç½²ï¼Œå…·ä½“é…ç½®ä¿¡æ¯ 4  nginx.conf</p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202211222301426.png"></p><h3 id="3ã€æ­å»ºå…·ä½“å‚è€ƒ-ä¸€ã€å››"><a href="#3ã€æ­å»ºå…·ä½“å‚è€ƒ-ä¸€ã€å››" class="headerlink" title="3ã€æ­å»ºå…·ä½“å‚è€ƒ ä¸€ã€å››"></a>3ã€æ­å»ºå…·ä½“å‚è€ƒ ä¸€ã€å››</h3><p>ç”¨äº†docker</p><h3 id="4ã€è¡¥å……"><a href="#4ã€è¡¥å……" class="headerlink" title="4ã€è¡¥å……"></a>4ã€è¡¥å……</h3><h4 id="1ã€nginx-é…ç½®"><a href="#1ã€nginx-é…ç½®" class="headerlink" title="1ã€nginx é…ç½®"></a>1ã€nginx é…ç½®</h4><pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">user  nginx;worker_processes  auto;error_log  /var/log/nginx/error.log notice;pid        /var/run/nginx.pid;events {    worker_connections  1024;}http {limit_req_zone $binary_remote_addr zone=mylimit:10m rate=2r/s;include       /etc/nginx/mime.types;    default_type  application/octet-stream;    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '                      '$status $body_bytes_sent "$http_referer" '                      '"$http_user_agent" "$http_x_forwarded_for"';    access_log  /var/log/nginx/access.log  main;    sendfile        on;    #tcp_nopush     on;    keepalive_timeout  65;    #gzip  on;   include /etc/nginx/conf.d/*.conf;  server{        listen 443 ssl;        #å¯¹åº”çš„åŸŸåï¼ŒæŠŠmykkto.cnæ”¹æˆä½ ä»¬è‡ªå·±çš„åŸŸåå°±å¯ä»¥äº†        server_name mykkto.cn;        #è¯ä¹¦çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶        ssl_certificate /etc/nginx/ssl/8799443_v1.mykkto.cn.pem;        ssl_certificate_key /etc/nginx/ssl/8799443_v1.mykkto.cn.key;#ä»¥ä¸‹éƒ½æ˜¯ä¸€äº›åŠ å¯†è§„åˆ™        ssl_session_timeout 5m;        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;        ssl_prefer_server_ciphers on;        #è¿™æ˜¯æˆ‘çš„ä¸»é¡µè®¿é—®åœ°å€ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯é™æ€çš„htmlç½‘é¡µï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨locationå°±å¯ä»¥å®Œæˆäº†ã€‚        location / {                #æ–‡ä»¶å¤¹ï¼ˆè¿™ä¸ªå…¶å®æŒ‚è½½çš„å°±æ˜¯å¤–éƒ¨çš„wwwç›®å½•ä¸‹çš„é™æ€èµ„æºï¼‰                root //usr/share/nginx/html;                #ä¸»é¡µæ–‡ä»¶                index index.html;        }    }server {   listen 80;        #è¿™è¾¹ç©ºæ ¼éš”å¼€ï¼Œé…ç½®äº†ä¸¤ä¸ªï¼Œå› ä¸ºåŠ äº†wwwä¹Ÿè¦é…ç½®       server_name mykkto.cn;       rewrite ^/(.*)$ https://mykkto.cn:443/$1 permanent;  # location / {  #     limit_req zone=mylimit;  #}}}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€æ›´æ–°åºŠå›¾è„šæœ¬"><a href="#2ã€æ›´æ–°åºŠå›¾è„šæœ¬" class="headerlink" title="2ã€æ›´æ–°åºŠå›¾è„šæœ¬"></a>2ã€æ›´æ–°åºŠå›¾è„šæœ¬</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202211222303115.png"></p><h4 id="3ã€PICGO-é…ç½®"><a href="#3ã€PICGO-é…ç½®" class="headerlink" title="3ã€PICGO é…ç½®"></a>3ã€PICGO é…ç½®</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202211222304590.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/Interview/202211222303839.png"></p><h2 id="å‚è€ƒ-â†“"><a href="#å‚è€ƒ-â†“" class="headerlink" title="å‚è€ƒ â†“"></a>å‚è€ƒ â†“</h2><p>â€”â€” ã€ä¸€åˆ°ä¸‰ã€‘å‚è€ƒâ€”â€”â€”â€“</p><p><a href="https://www.cnblogs.com/zltech/p/13517231.html">https://www.cnblogs.com/zltech/p/13517231.html</a></p><p><a href="https://www.cnblogs.com/thepoy/p/14848080.html">https://www.cnblogs.com/thepoy/p/14848080.html</a></p><p><a href="https://www.cnblogs.com/jianqingwang/p/6726589.html">https://www.cnblogs.com/jianqingwang/p/6726589.html</a></p><p>â€”â€” ã€ä¸€åˆ°ä¸‰ã€‘å‚è€ƒâ€”â€”â€”â€“</p><p>SSLè¯ä¹¦å‚è€ƒ&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</p><p><a href="https://www.cnblogs.com/zeussbook/p/11231820.html">https://www.cnblogs.com/zeussbook/p/11231820.html</a></p><p><a href="https://www.cnblogs.com/yuyeblog/p/13582127.html">https://www.cnblogs.com/yuyeblog/p/13582127.html</a></p><p><a href="https://www.cnblogs.com/makalochen/p/14241052.html#%E5%A4%9A%E7%9B%AE%E5%BD%95%E6%8C%82%E8%BD%BD">https://www.cnblogs.com/makalochen/p/14241052.html#%E5%A4%9A%E7%9B%AE%E5%BD%95%E6%8C%82%E8%BD%BD</a></p><p>IPé»‘åå•å‚è€ƒ&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</p><p><a href="https://www.jb51.net/article/168907.htm">https://www.jb51.net/article/168907.htm</a></p><p><a href="https://blog.csdn.net/weixin_33971205/article/details/89861486">https://blog.csdn.net/weixin_33971205/article/details/89861486</a></p><p><a href="https://www.csdn.net/tags/MtTaIgzsNDYzNDUtYmxvZwO0O0OO0O0O.html">https://www.csdn.net/tags/MtTaIgzsNDYzNDUtYmxvZwO0O0OO0O0O.html</a></p><p>é™æµ&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</p><p><a href="https://www.cnblogs.com/biglittleant/p/8979915.html">https://www.cnblogs.com/biglittleant/p/8979915.html</a></p><p>DNSè§£æ+Github Pagesï¼ˆæ— æœåŠ¡å™¨ï¼‰</p><p><a href="https://cloud.tencent.com/developer/article/2019284">https://cloud.tencent.com/developer/article/2019284</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="åšå®¢" scheme="https://mykkto.github.io/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
    <category term="blog" scheme="https://mykkto.github.io/tags/blog/"/>
    
    <category term="éƒ¨ç½²" scheme="https://mykkto.github.io/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="å°å§¿åŠ¿" scheme="https://mykkto.github.io/tags/%E5%B0%8F%E5%A7%BF%E5%8A%BF/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-Alibaba-Sentinel å®ç°ç†”æ–­ä¸é™æµ</title>
    <link href="https://mykkto.github.io/posts/32724da3.html"/>
    <id>https://mykkto.github.io/posts/32724da3.html</id>
    <published>2022-03-13T07:17:13.000Z</published>
    <updated>2022-11-12T15:07:08.061Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><h3 id="1ã€å®˜ç½‘"><a href="#1ã€å®˜ç½‘" class="headerlink" title="1ã€å®˜ç½‘"></a>1ã€å®˜ç½‘</h3><p><a href="https://github.com/alibaba/Sentinel">https://github.com/alibaba/Sentinel</a></p><p><a href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D">https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D</a></p><h3 id="2ã€æ˜¯ä»€ä¹ˆ"><a href="#2ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="2ã€æ˜¯ä»€ä¹ˆ"></a>2ã€æ˜¯ä»€ä¹ˆ</h3><p>ä¸€å¥è¯è§£é‡Šï¼Œå°±æ˜¯ç±»ä¼¼äº Hystrix</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312233839.png"></p><h3 id="3ã€å»å“ªä¸‹"><a href="#3ã€å»å“ªä¸‹" class="headerlink" title="3ã€å»å“ªä¸‹"></a>3ã€å»å“ªä¸‹</h3><p><a href="https://github.com/alibaba/Sentinel/releases">https://github.com/alibaba/Sentinel/releases</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312233941.png"></p><h3 id="4ã€èƒ½å¹²å˜›"><a href="#4ã€èƒ½å¹²å˜›" class="headerlink" title="4ã€èƒ½å¹²å˜›"></a>4ã€èƒ½å¹²å˜›</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312234011.png"></p><p><strong>æœåŠ¡ä½¿ç”¨ä¸­çš„å„ç§é—®é¢˜</strong></p><ul><li>æœåŠ¡é›ªå´©</li><li>æœåŠ¡é™çº§</li><li>æœåŠ¡ç†”æ–­</li><li>æœåŠ¡é™æµ</li></ul><h2 id="äºŒã€å®‰è£…æ§åˆ¶å°"><a href="#äºŒã€å®‰è£…æ§åˆ¶å°" class="headerlink" title="äºŒã€å®‰è£…æ§åˆ¶å°"></a>äºŒã€å®‰è£…æ§åˆ¶å°</h2><h3 id="1ã€sentinelç»„ä»¶ç”±ä¸¤éƒ¨åˆ†æ„æˆ"><a href="#1ã€sentinelç»„ä»¶ç”±ä¸¤éƒ¨åˆ†æ„æˆ" class="headerlink" title="1ã€sentinelç»„ä»¶ç”±ä¸¤éƒ¨åˆ†æ„æˆ"></a>1ã€sentinelç»„ä»¶ç”±ä¸¤éƒ¨åˆ†æ„æˆ</h3><ul><li>åå°</li><li>å‰å°8080</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220313211351.png"></p><h3 id="2ã€å®‰è£…æ­¥éª¤"><a href="#2ã€å®‰è£…æ­¥éª¤" class="headerlink" title="2ã€å®‰è£…æ­¥éª¤"></a>2ã€å®‰è£…æ­¥éª¤</h3><h4 id="1ã€æ‹‰å–é•œåƒ"><a href="#1ã€æ‹‰å–é•œåƒ" class="headerlink" title="1ã€æ‹‰å–é•œåƒ"></a>1ã€æ‹‰å–é•œåƒ</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker pull bladex/sentinel<span class="token punctuation">-</span>dashboard<span class="token punctuation">:</span>1.7.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€å¯åŠ¨å¹¶åˆ›å»ºå®¹å™¨"><a href="#2ã€å¯åŠ¨å¹¶åˆ›å»ºå®¹å™¨" class="headerlink" title="2ã€å¯åŠ¨å¹¶åˆ›å»ºå®¹å™¨"></a>2ã€å¯åŠ¨å¹¶åˆ›å»ºå®¹å™¨</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span><span class="token punctuation">-</span>name sentinel <span class="token punctuation">-</span>d  <span class="token punctuation">-</span>p 8858<span class="token punctuation">:</span>8858  bladex/sentinel<span class="token punctuation">-</span>dashboard<span class="token punctuation">:</span>1.7.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3ã€è®¿é—®"><a href="#3ã€è®¿é—®" class="headerlink" title="3ã€è®¿é—®"></a>3ã€è®¿é—®</h3><p><code>ip:8858</code></p><p>ç™»å½•è´¦å·å¯†ç å‡ä¸º<code>sentinel</code></p><h2 id="ä¸‰ã€åˆå§‹åŒ–å·¥ç¨‹"><a href="#ä¸‰ã€åˆå§‹åŒ–å·¥ç¨‹" class="headerlink" title="ä¸‰ã€åˆå§‹åŒ–å·¥ç¨‹"></a>ä¸‰ã€åˆå§‹åŒ–å·¥ç¨‹</h2><h3 id="1ã€å¯åŠ¨å‡†å¤‡å·¥ä½œ"><a href="#1ã€å¯åŠ¨å‡†å¤‡å·¥ä½œ" class="headerlink" title="1ã€å¯åŠ¨å‡†å¤‡å·¥ä½œ"></a>1ã€å¯åŠ¨å‡†å¤‡å·¥ä½œ</h3><p>å¯åŠ¨ sentinel ï¼ˆ8858ï¼‰ï¼Œnacosï¼ˆ8848ï¼‰</p><h3 id="2ã€model"><a href="#2ã€model" class="headerlink" title="2ã€model"></a>2ã€model</h3><h4 id="1ã€å»ºmodel"><a href="#1ã€å»ºmodel" class="headerlink" title="1ã€å»ºmodel"></a>1ã€å»ºmodel</h4><p>cloudalibaba-sentinel-service8401</p><h4 id="2ã€pom"><a href="#2ã€pom" class="headerlink" title="2ã€pom"></a>2ã€pom</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springcloud2021to2022<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-sentinel-service8401<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--openfeign--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶+actuator --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.6.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€yml"><a href="#3ã€yml" class="headerlink" title="3ã€yml"></a>3ã€yml</h4><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">server:  port: 8401spring:  application:    name: cloudalibaba-sentinel-service  cloud:    nacos:      discovery:        #NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€        server-addr: 101.34.180.133:8848    sentinel:      transport:        #é…ç½®Sentinel dashboardåœ°å€#        dashboard: 101.34.180.133:8858#        dashboard: 106.52.23.202:8080        # é¡¹ç›®å’Œ sentinel ä¸åœ¨åŒä¸€å°æœºå™¨æ— æ³•æŸ¥çœ‹å®æ—¶ç›‘æ§        dashboard: localhost:8080        #é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£        port: 8719        # æœ¬åœ°æœºå™¨ip(dockerå®¹å™¨å¿…é¡»åŠ ä¸Š)#        client-ip: 169.254.135.77management:  endpoints:    web:      exposure:        include: '*'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€ä¸»å¯åŠ¨"><a href="#4ã€ä¸»å¯åŠ¨" class="headerlink" title="4ã€ä¸»å¯åŠ¨"></a>4ã€ä¸»å¯åŠ¨</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span><span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringCloudSentinelMain8401</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span>run <span class="token punctuation">(</span><span class="token class-name">SpringCloudSentinelMain8401</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€ä¸šåŠ¡ç±»"><a href="#5ã€ä¸šåŠ¡ç±»" class="headerlink" title="5ã€ä¸šåŠ¡ç±»"></a>5ã€ä¸šåŠ¡ç±»</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowLimitController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testA"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"------testA"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testB"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"------testB"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€æ“ä½œ-sentinelæ§åˆ¶å°"><a href="#3ã€æ“ä½œ-sentinelæ§åˆ¶å°" class="headerlink" title="3ã€æ“ä½œ sentinelæ§åˆ¶å°"></a>3ã€æ“ä½œ sentinelæ§åˆ¶å°</h3><h4 id="1ã€åˆšè¿›æ¥"><a href="#1ã€åˆšè¿›æ¥" class="headerlink" title="1ã€åˆšè¿›æ¥"></a>1ã€åˆšè¿›æ¥</h4><p>ç©ºç©ºå¦‚ä¹Ÿï¼Œå•¥éƒ½æ²¡æœ‰</p><h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220313224347.png"></h3><h4 id="2ã€æ‡’åŠ è½½è¯´æ˜"><a href="#2ã€æ‡’åŠ è½½è¯´æ˜" class="headerlink" title="2ã€æ‡’åŠ è½½è¯´æ˜"></a>2ã€æ‡’åŠ è½½è¯´æ˜</h4><ul><li>Sentinelé‡‡ç”¨çš„æ‡’åŠ è½½è¯´æ˜</li><li>éœ€è¦æ‰§è¡Œä¸€æ¬¡<ul><li><a href="http://localhost:8401/testA">http://localhost:8401/testA</a></li><li><a href="http://localhost:8401/testB">http://localhost:8401/testB</a></li></ul></li><li><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220314002216.png"></li><li>è¿™è¾¹éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šå¦‚æœä½ çš„<code>å®æ—¶ç›‘æ§</code>æ²¡æœ‰æ•°æ®ï¼Œå¯èƒ½æ˜¯å› ä¸º sentinel å’Œé¡¹ç›®ä¸å†<code>åŒä¸€ä¸ª æœºå™¨</code>æˆ–è€… <code>sentinelè®¿é—®ä¸åˆ°</code> é¡¹ç›®å°±ç›‘æ§ä¸åˆ°äº†</li></ul><h2 id="å››ã€æµæ§åˆ¶è§„åˆ™"><a href="#å››ã€æµæ§åˆ¶è§„åˆ™" class="headerlink" title="å››ã€æµæ§åˆ¶è§„åˆ™"></a>å››ã€æµæ§åˆ¶è§„åˆ™</h2><h3 id="1ã€åŸºæœ¬ä»‹ç»"><a href="#1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="1ã€åŸºæœ¬ä»‹ç»"></a>1ã€åŸºæœ¬ä»‹ç»</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220314222312.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220314222329.png"></p><h3 id="2ã€æµæ§æ¨¡å¼"><a href="#2ã€æµæ§æ¨¡å¼" class="headerlink" title="2ã€æµæ§æ¨¡å¼"></a>2ã€æµæ§æ¨¡å¼</h3><h4 id="1ã€ç›´æ¥-é»˜è®¤"><a href="#1ã€ç›´æ¥-é»˜è®¤" class="headerlink" title="1ã€ç›´æ¥(é»˜è®¤)"></a>1ã€ç›´æ¥(é»˜è®¤)</h4><p>è¡¨ç¤ºï¼š1ç§’é’Ÿå†…æŸ¥è¯¢1æ¬¡å°±æ˜¯OKï¼Œè‹¥è¶…è¿‡æ¬¡æ•°1ï¼Œå°±ç›´æ¥-å¿«é€Ÿå¤±è´¥ï¼ŒæŠ¥é»˜è®¤é”™è¯¯</p><h5 id="1ã€é…ç½®å†…å®¹"><a href="#1ã€é…ç½®å†…å®¹" class="headerlink" title="1ã€é…ç½®å†…å®¹"></a>1ã€é…ç½®å†…å®¹</h5><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1647528650781.png" alt="1647528650781"></p><h5 id="2ã€æµ‹è¯•æ•ˆæœ"><a href="#2ã€æµ‹è¯•æ•ˆæœ" class="headerlink" title="2ã€æµ‹è¯•æ•ˆæœ"></a>2ã€æµ‹è¯•æ•ˆæœ</h5><p>è®¿é—®ï¼š<a href="http://localhost:8401/testA">http://localhost:8401/testA</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220318194405.png"></p><h5 id="3ã€ç»“è®ºæ€è€ƒ"><a href="#3ã€ç»“è®ºæ€è€ƒ" class="headerlink" title="3ã€ç»“è®ºæ€è€ƒ"></a>3ã€ç»“è®ºæ€è€ƒ</h5><p>ç›´æ¥è°ƒç”¨é»˜è®¤æŠ¥é”™ä¿¡æ¯ï¼ŒæŠ€æœ¯æ–¹é¢OKï¼Œ</p><p>ä½†æ˜¯å¦åº”è¯¥æœ‰æˆ‘ä»¬è‡ªå·±çš„åç»­å¤„ç†ï¼Œç±»ä¼¼æœ‰ä¸ªfallbackçš„å…œåº•æ–¹æ³•</p><h4 id="2ã€å…³è”"><a href="#2ã€å…³è”" class="headerlink" title="2ã€å…³è”"></a>2ã€å…³è”</h4><h5 id="1ã€æ˜¯ä»€ä¹ˆ"><a href="#1ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h5><ul><li>å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±</li><li>å½“ä¸Aå…³è”çš„èµ„æºBè¾¾åˆ°é˜€å€¼åï¼Œå°±é™æµAè‡ªå·±</li><li>Bæƒ¹äº‹ï¼ŒAæŒ‚äº†</li></ul><h5 id="2ã€é…ç½®A"><a href="#2ã€é…ç½®A" class="headerlink" title="2ã€é…ç½®A"></a>2ã€é…ç½®A</h5><p>å½“å…³è”èµ„æº /testB çš„ qps é˜€å€¼è¶…è¿‡1æ—¶ï¼Œå°±é™æµ /testA çš„Restè®¿é—®åœ°å€ï¼Œå½“å…³è”èµ„æºåˆ°é˜ˆå€¼åé™åˆ¶é…ç½®å¥½çš„èµ„æºå</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220318194759.png"></p><h5 id="3ã€postmanæ¨¡æ‹Ÿå¹¶å‘å¯†é›†è®¿é—®testB"><a href="#3ã€postmanæ¨¡æ‹Ÿå¹¶å‘å¯†é›†è®¿é—®testB" class="headerlink" title="3ã€postmanæ¨¡æ‹Ÿå¹¶å‘å¯†é›†è®¿é—®testB"></a>3ã€postmanæ¨¡æ‹Ÿå¹¶å‘å¯†é›†è®¿é—®testB</h5><p>åˆ›å»ºä¸€ä¸ªé›†åˆå¹¶å‘æµ‹è¯•æ–‡ä»¶å¤¹</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220318195358.png"></p><p>å°†æµ‹è¯•çš„urlæ”¾è¿›æ–‡ä»¶å¤¹</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220318200022.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220318200053.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220318200149.png"></p><h5 id="4ã€æµ‹è¯•"><a href="#4ã€æµ‹è¯•" class="headerlink" title="4ã€æµ‹è¯•"></a>4ã€æµ‹è¯•</h5><p>å¯åŠ¨å¹¶å‘å¯¹ /testB runï¼Œå†æ¬¡è¿‡ç¨‹ä¸­è®¿é—®  /testB  å‘ç°å‡ºé”™</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220318200544.png"></p><h4 id="3ã€é“¾è·¯"><a href="#3ã€é“¾è·¯" class="headerlink" title="3ã€é“¾è·¯"></a>3ã€é“¾è·¯</h4><ul><li>å¤šä¸ªè¯·æ±‚è°ƒç”¨äº†åŒä¸€ä¸ªå¾®æœåŠ¡</li></ul><h3 id="2Xï¼ˆæµæ§æ¨¡å¼æ€»ç»“ï¼‰"><a href="#2Xï¼ˆæµæ§æ¨¡å¼æ€»ç»“ï¼‰" class="headerlink" title="2Xï¼ˆæµæ§æ¨¡å¼æ€»ç»“ï¼‰"></a>2Xï¼ˆæµæ§æ¨¡å¼æ€»ç»“ï¼‰</h3><ul><li>ç›´æ¥ï¼šå¯¹å½“å‰èµ„æºé™æµ</li><li>å…³è”ï¼šé«˜ä¼˜å…ˆçº§èµ„æºè§¦å‘é˜ˆå€¼ï¼Œå¯¹ä½ä¼˜å…ˆçº§èµ„æºé™æµã€‚</li><li>é“¾è·¯ï¼šé˜ˆå€¼ç»Ÿè®¡æ—¶ï¼Œåªç»Ÿè®¡ä»æŒ‡å®šèµ„æºè¿›å…¥å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œæ˜¯å¯¹è¯·æ±‚æ¥æºçš„é™æµ</li></ul><h3 id="3ã€æµæ§æ•ˆæœ"><a href="#3ã€æµæ§æ•ˆæœ" class="headerlink" title="3ã€æµæ§æ•ˆæœ"></a>3ã€æµæ§æ•ˆæœ</h3><h4 id="1ã€å¿«é€Ÿå¤±è´¥"><a href="#1ã€å¿«é€Ÿå¤±è´¥" class="headerlink" title="1ã€å¿«é€Ÿå¤±è´¥"></a>1ã€å¿«é€Ÿå¤±è´¥</h4><p>è¾¾åˆ°å³°å€¼ï¼Œç›´æ¥å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼ˆBlocked by Sentinel (flow limiting)ï¼‰</p><p>æºç ï¼ˆä¿®æ”¹æ‰©å±•ä½ç½®ï¼‰ï¼šcom.alibaba.csp.sentinel.slots.block.flow.controller.DefaultController</p><h4 id="2ã€WarmUpï¼ˆé¢„çƒ­ï¼‰"><a href="#2ã€WarmUpï¼ˆé¢„çƒ­ï¼‰" class="headerlink" title="2ã€WarmUpï¼ˆé¢„çƒ­ï¼‰"></a>2ã€WarmUpï¼ˆé¢„çƒ­ï¼‰</h4><h5 id="1ã€å…¬å¼"><a href="#1ã€å…¬å¼" class="headerlink" title="1ã€å…¬å¼"></a>1ã€å…¬å¼</h5><p>é˜ˆå€¼é™¤ä»¥coldFactor(é»˜è®¤å€¼ä¸º3),ç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜ˆå€¼</p><h5 id="2ã€å®˜ç½‘"><a href="#2ã€å®˜ç½‘" class="headerlink" title="2ã€å®˜ç½‘"></a>2ã€å®˜ç½‘</h5><ul><li>é»˜è®¤coldFactorä¸º3ï¼Œå³è¯·æ±‚ QPS ä» threshold / 3 å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„ QPS é˜ˆå€¼ã€‚</li><li>é™æµï¼Œå†·å¯åŠ¨<ul><li><a href="https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8">https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8</a></li></ul></li></ul><h5 id="3ã€æºç "><a href="#3ã€æºç " class="headerlink" title="3ã€æºç "></a>3ã€æºç </h5><p>com.alibaba.csp.sentinel.slots.block.flow.controller.WarmUpController</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220319093823.png"></p><h5 id="4ã€WarmUpé…ç½®"><a href="#4ã€WarmUpé…ç½®" class="headerlink" title="4ã€WarmUpé…ç½®"></a>4ã€WarmUpé…ç½®</h5><ul><li>é»˜è®¤ coldFactor ä¸º 3ï¼Œå³è¯·æ±‚QPSä»(threshold / 3) å¼€å§‹ï¼Œç»å¤šå°‘é¢„çƒ­æ—¶é•¿æ‰é€æ¸å‡è‡³è®¾å®šçš„ QPS é˜ˆå€¼ã€‚</li><li>æ¡ˆä¾‹ï¼Œé˜€å€¼ä¸º10+é¢„çƒ­æ—¶é•¿è®¾ç½®5ç§’ã€‚<br>ç³»ç»Ÿåˆå§‹åŒ–çš„é˜€å€¼ä¸º10 / 3 çº¦ç­‰äº3,å³é˜€å€¼åˆšå¼€å§‹ä¸º3ï¼›ç„¶åè¿‡äº†5ç§’åé˜€å€¼æ‰æ…¢æ…¢å‡é«˜æ¢å¤åˆ°10</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220319094044.png"></p><h5 id="5ã€ç‚¹å‡»æµ‹è¯•"><a href="#5ã€ç‚¹å‡»æµ‹è¯•" class="headerlink" title="5ã€ç‚¹å‡»æµ‹è¯•"></a>5ã€ç‚¹å‡»æµ‹è¯•</h5><p>å¤šæ¬¡ç‚¹å‡»<a href="http://localhost:8401/testB">http://localhost:8401/testB</a></p><p>åˆšå¼€å§‹ä¸è¡Œï¼Œåç»­æ…¢æ…¢OK</p><h5 id="6ã€åº”ç”¨åœºæ™¯"><a href="#6ã€åº”ç”¨åœºæ™¯" class="headerlink" title="6ã€åº”ç”¨åœºæ™¯"></a>6ã€åº”ç”¨åœºæ™¯</h5><p>å¦‚ï¼šç§’æ€ç³»ç»Ÿåœ¨å¼€å¯çš„ç¬é—´ï¼Œä¼šæœ‰å¾ˆå¤šæµé‡ä¸Šæ¥ï¼Œå¾ˆæœ‰å¯èƒ½æŠŠç³»ç»Ÿæ‰“æ­»ï¼Œé¢„çƒ­æ–¹å¼å°±æ˜¯æŠŠä¸ºäº†ä¿æŠ¤ç³»ç»Ÿï¼Œå¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾è¿›æ¥ï¼Œæ…¢æ…¢çš„æŠŠé˜€å€¼å¢é•¿åˆ°è®¾ç½®çš„é˜€å€¼ã€‚</p><h4 id="3ã€æ’é˜Ÿç­‰å¾…"><a href="#3ã€æ’é˜Ÿç­‰å¾…" class="headerlink" title="3ã€æ’é˜Ÿç­‰å¾…"></a>3ã€æ’é˜Ÿç­‰å¾…</h4><h5 id="1ã€è¯´æ˜"><a href="#1ã€è¯´æ˜" class="headerlink" title="1ã€è¯´æ˜"></a>1ã€è¯´æ˜</h5><p>åŒ€é€Ÿæ’é˜Ÿï¼Œé˜ˆå€¼å¿…é¡»è®¾ç½®ä¸ºQPS</p><h5 id="2ã€å®˜ç½‘-1"><a href="#2ã€å®˜ç½‘-1" class="headerlink" title="2ã€å®˜ç½‘"></a>2ã€å®˜ç½‘</h5><p><a href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6">https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220319094259.png"></p><h5 id="3ã€æºç -1"><a href="#3ã€æºç -1" class="headerlink" title="3ã€æºç "></a>3ã€æºç </h5><p>com.alibaba.csp.sentinel.slots.block.flow.controller.RateLimiterController</p><h5 id="4ã€é…ç½®"><a href="#4ã€é…ç½®" class="headerlink" title="4ã€é…ç½®"></a>4ã€é…ç½®</h5><ul><li>åŒ€é€Ÿæ’é˜Ÿï¼Œè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜€å€¼ç±»å‹å¿…é¡»è®¾æˆQPSï¼Œå¦åˆ™æ— æ•ˆã€‚</li><li>è®¾ç½®å«ä¹‰ï¼š /testB  æ¯ç§’1æ¬¡è¯·æ±‚ï¼Œè¶…è¿‡çš„è¯å°±æ’é˜Ÿç­‰å¾…ï¼Œç­‰å¾…çš„è¶…æ—¶æ—¶é—´ä¸º20000æ¯«ç§’ã€‚</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220319094533.png"></p><h5 id="5ã€æµ‹è¯•"><a href="#5ã€æµ‹è¯•" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220319095241.png"></p><h2 id="äº”ã€é™çº§è§„åˆ™"><a href="#äº”ã€é™çº§è§„åˆ™" class="headerlink" title="äº”ã€é™çº§è§„åˆ™"></a>äº”ã€é™çº§è§„åˆ™</h2><h3 id="1ã€å®˜ç½‘-1"><a href="#1ã€å®˜ç½‘-1" class="headerlink" title="1ã€å®˜ç½‘"></a>1ã€å®˜ç½‘</h3><p><a href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7">https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7</a></p><h3 id="2ã€åŸºæœ¬ä»‹ç»"><a href="#2ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="2ã€åŸºæœ¬ä»‹ç»"></a>2ã€åŸºæœ¬ä»‹ç»</h3><h4 id="1ã€è¯´æ˜-1"><a href="#1ã€è¯´æ˜-1" class="headerlink" title="1ã€è¯´æ˜"></a>1ã€è¯´æ˜</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220319095912.png"></p><p>Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçŠ¶æ€æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…æ—¶æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ï¼Œå¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œ<br>è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶å®ƒçš„èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ã€‚</p><p>å½“èµ„æºè¢«é™çº§åï¼Œåœ¨æ¥ä¸‹æ¥çš„é™çº§æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¯¥èµ„æºçš„è°ƒç”¨éƒ½è‡ªåŠ¨ç†”æ–­ï¼ˆé»˜è®¤è¡Œä¸ºæ˜¯æŠ›å‡º DegradeExceptionï¼‰</p><h4 id="2ã€hystrixæ¯”è¾ƒ"><a href="#2ã€hystrixæ¯”è¾ƒ" class="headerlink" title="2ã€hystrixæ¯”è¾ƒ"></a>2ã€hystrixæ¯”è¾ƒ</h4><p>Sentinelçš„æ–­è·¯å™¨æ˜¯<code>æ²¡æœ‰åŠå¼€</code>çŠ¶æ€çš„</p><p>åŠå¼€çš„çŠ¶æ€ç³»ç»Ÿè‡ªåŠ¨å»æ£€æµ‹æ˜¯å¦è¯·æ±‚æœ‰å¼‚å¸¸ï¼Œ<br>æ²¡æœ‰å¼‚å¸¸å°±<code>å…³é—­æ–­è·¯å™¨</code>æ¢å¤ä½¿ç”¨ï¼Œ<br>æœ‰å¼‚å¸¸åˆ™<code>ç»§ç»­æ‰“å¼€</code>æ–­è·¯å™¨ä¸å¯ç”¨ã€‚å…·ä½“å¯ä»¥å‚è€ƒHystrix</p><p>ä»¥ä¸‹æ˜¯hystrixæ–­è·¯å™¨ç»“æ„å›¾</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220319100840.png"></p><h3 id="3ã€é™çº§ç­–ç•¥å®æˆ˜"><a href="#3ã€é™çº§ç­–ç•¥å®æˆ˜" class="headerlink" title="3ã€é™çº§ç­–ç•¥å®æˆ˜"></a>3ã€é™çº§ç­–ç•¥å®æˆ˜</h3><h4 id="1ã€RT"><a href="#1ã€RT" class="headerlink" title="1ã€RT"></a>1ã€RT</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220319225244.png"></p><h5 id="1ã€ä»£ç "><a href="#1ã€ä»£ç " class="headerlink" title="1ã€ä»£ç "></a>1ã€ä»£ç </h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testD"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span>sleep <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        e<span class="token punctuation">.</span>printStackTrace <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"testD æµ‹è¯•RT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"------testD"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€é…ç½®"><a href="#2ã€é…ç½®" class="headerlink" title="2ã€é…ç½®"></a>2ã€é…ç½®</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220319225631.png"></p><h5 id="3ã€jmeterå‹æµ‹"><a href="#3ã€jmeterå‹æµ‹" class="headerlink" title="3ã€jmeterå‹æµ‹"></a>3ã€jmeterå‹æµ‹</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220321223309.png"></p><h5 id="4ã€ç»“æœ"><a href="#4ã€ç»“æœ" class="headerlink" title="4ã€ç»“æœ"></a>4ã€ç»“æœ</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220321223653.png"></p><h4 id="2ã€å¼‚å¸¸æ¯”ä¾‹"><a href="#2ã€å¼‚å¸¸æ¯”ä¾‹" class="headerlink" title="2ã€å¼‚å¸¸æ¯”ä¾‹"></a>2ã€å¼‚å¸¸æ¯”ä¾‹</h4><p>1ã€æ˜¯ä»€ä¹ˆ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220321223744.png"></p><h5 id="2ã€ä»£ç "><a href="#2ã€ä»£ç " class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testD"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"testD æµ‹è¯•å¼‚å¸¸æ¯”ä¾‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"------testD"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€é…ç½®"><a href="#3ã€é…ç½®" class="headerlink" title="3ã€é…ç½®"></a>3ã€é…ç½®</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220321223956.png"></p><h5 id="4ã€jmeter"><a href="#4ã€jmeter" class="headerlink" title="4ã€jmeter"></a>4ã€jmeter</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220321224035.png"></p><h5 id="5ã€ç»“è®º"><a href="#5ã€ç»“è®º" class="headerlink" title="5ã€ç»“è®º"></a>5ã€ç»“è®º</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220321224157.png"></p><h4 id="3ã€å¼‚å¸¸æ•°"><a href="#3ã€å¼‚å¸¸æ•°" class="headerlink" title="3ã€å¼‚å¸¸æ•°"></a>3ã€å¼‚å¸¸æ•°</h4><h5 id="1ã€æ˜¯ä»€ä¹ˆ-1"><a href="#1ã€æ˜¯ä»€ä¹ˆ-1" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220321224235.png"></p><h5 id="2ã€éœ€çŸ¥"><a href="#2ã€éœ€çŸ¥" class="headerlink" title="2ã€éœ€çŸ¥"></a>2ã€éœ€çŸ¥</h5><p>å¼‚å¸¸æ•°æ˜¯æŒ‰ç…§åˆ†é’Ÿç»Ÿè®¡çš„</p><h5 id="3ã€ä»£ç "><a href="#3ã€ä»£ç " class="headerlink" title="3ã€ä»£ç "></a>3ã€ä»£ç </h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testE"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    log<span class="token punctuation">.</span>info <span class="token punctuation">(</span><span class="token string">"testE æµ‹è¯•å¼‚å¸¸æ¯”ä¾‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"------testE æµ‹è¯•å¼‚å¸¸æ¯”ä¾‹"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€é…ç½®-1"><a href="#4ã€é…ç½®-1" class="headerlink" title="4ã€é…ç½®"></a>4ã€é…ç½®</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220321224436.png"></p><h5 id="5ã€jmeter"><a href="#5ã€jmeter" class="headerlink" title="5ã€jmeter"></a>5ã€jmeter</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220321224523.png"></p><h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h3 id="-2"><a href="#-2" class="headerlink" title=""></a></h3><h2 id="å…­ã€çƒ­ç‚¹keyé™æµ"><a href="#å…­ã€çƒ­ç‚¹keyé™æµ" class="headerlink" title="å…­ã€çƒ­ç‚¹keyé™æµ"></a>å…­ã€çƒ­ç‚¹keyé™æµ</h2><h3 id="1ã€åŸºæœ¬ä»‹ç»-1"><a href="#1ã€åŸºæœ¬ä»‹ç»-1" class="headerlink" title="1ã€åŸºæœ¬ä»‹ç»"></a>1ã€åŸºæœ¬ä»‹ç»</h3><h4 id="1ã€æ˜¯ä»€ä¹ˆ-2"><a href="#1ã€æ˜¯ä»€ä¹ˆ-2" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h4><p><strong>ä½•ä¸ºçƒ­ç‚¹</strong></p><p>çƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æˆ–è€…é™åˆ¶æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„TopNæ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™æµæˆ–è€…å…¶å®ƒæ“ä½œ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220321225130.png"></p><h4 id="2ã€å®˜ç½‘-2"><a href="#2ã€å®˜ç½‘-2" class="headerlink" title="2ã€å®˜ç½‘"></a>2ã€å®˜ç½‘</h4><p><a href="https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81">https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81</a></p><h4 id="3ã€å…œåº•æ–¹æ³•"><a href="#3ã€å…œåº•æ–¹æ³•" class="headerlink" title="3ã€å…œåº•æ–¹æ³•"></a>3ã€å…œåº•æ–¹æ³•</h4><p>sentinelç³»ç»Ÿé»˜è®¤çš„æç¤ºï¼šBlocked by Sentinel (flow limiting)</p><p>å¯ä»¥æŒ‡å®šï¼Œè‡ªå®šä¹‰å…œåº•æ–¹æ³•</p><p> ä»HystrixCommand åˆ°@SentinelResource</p><h3 id="2ã€æ¡ˆä¾‹"><a href="#2ã€æ¡ˆä¾‹" class="headerlink" title="2ã€æ¡ˆä¾‹"></a>2ã€æ¡ˆä¾‹</h3><h4 id="1ã€ä»£ç -1"><a href="#1ã€ä»£ç -1" class="headerlink" title="1ã€ä»£ç "></a>1ã€ä»£ç </h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testHotKey"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"testHotKey"</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">"dealHandler_testHotKey"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testHotKey</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"p1"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> p1<span class="token punctuation">,</span>                         <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"p2"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> p2<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"------testHotKey"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">dealHandler_testHotKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> p1<span class="token punctuation">,</span> <span class="token class-name">String</span> p2<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">"-----dealHandler_testHotKey"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€é…ç½®è¯´æ˜"><a href="#2ã€é…ç½®è¯´æ˜" class="headerlink" title="2ã€é…ç½®è¯´æ˜"></a>2ã€é…ç½®è¯´æ˜</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220322212525.png"></p><p><strong>é™æµæ¨¡å¼åªæ”¯æŒQPSæ¨¡å¼ï¼Œå›ºå®šå†™æ­»äº†ã€‚ï¼ˆè¿™æ‰å«çƒ­ç‚¹ï¼‰<br><code>@SentinelResource</code>æ³¨è§£çš„æ–¹æ³•å‚æ•°ç´¢å¼•ï¼Œ0ä»£è¡¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ1ä»£è¡¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨<br>å•æœºé˜€å€¼ä»¥åŠç»Ÿè®¡çª—å£æ—¶é•¿è¡¨ç¤ºåœ¨æ­¤çª—å£æ—¶é—´è¶…è¿‡é˜€å€¼å°±é™æµã€‚</strong><br><code>ä¸Šé¢çš„æŠ“å›¾å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æœ‰å€¼çš„è¯ï¼Œ1ç§’çš„QPSä¸º1ï¼Œè¶…è¿‡å°±é™æµï¼Œé™æµåè°ƒç”¨</code> dealHandler_testHotKeyæ”¯æŒæ–¹æ³•ã€‚</p><h4 id="3ã€é…ç½®-1"><a href="#3ã€é…ç½®-1" class="headerlink" title="3ã€é…ç½®"></a>3ã€é…ç½®</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220322213124.png"></p><p><code>@SentinelResource(value = "testHotKey",blockHandler = "dealHandler_testHotKey")</code></p><p>æ–¹æ³•testHotKeyé‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°åªè¦QPSè¶…è¿‡æ¯ç§’1æ¬¡ï¼Œé©¬ä¸Šé™çº§å¤„ç†</p><h4 id="4ã€æµ‹è¯•-1"><a href="#4ã€æµ‹è¯•-1" class="headerlink" title="4ã€æµ‹è¯•"></a>4ã€æµ‹è¯•</h4><p><a href="http://localhost:8401/testHotKey?p1=abc">http://localhost:8401/testHotKey?p1=abc</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220322213413.png"></p><p><a href="http://localhost:8401/testHotKey?p1=abc&amp;p2=33">http://localhost:8401/testHotKey?p1=abc&amp;p2=33</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220322213432.png"></p><p><a href="http://localhost:8401/testHotKey?p2=33">http://localhost:8401/testHotKey?p2=33</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220322213506.png"></p><h3 id="3ã€å‚æ•°é«˜çº§é€‰é¡¹"><a href="#3ã€å‚æ•°é«˜çº§é€‰é¡¹" class="headerlink" title="3ã€å‚æ•°é«˜çº§é€‰é¡¹"></a>3ã€å‚æ•°é«˜çº§é€‰é¡¹</h3><h4 id="1ã€ä½œç”¨"><a href="#1ã€ä½œç”¨" class="headerlink" title="1ã€ä½œç”¨"></a>1ã€ä½œç”¨</h4><p>ä¸Šè¿°æ¡ˆä¾‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°p1ï¼Œå½“QPSè¶…è¿‡1ç§’1æ¬¡ç‚¹å‡»åé©¬ä¸Šè¢«é™æµ</p><p>è‹¥æ˜¯æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œp1ç‰¹ä¾‹ä¸º5 ï¼ŒQPS é˜ˆå€¼ä¸º 200å°±å¯ä»¥é€šè¿‡ è¿™ä¸ªå®ç°</p><h4 id="2ã€é…ç½®-1"><a href="#2ã€é…ç½®-1" class="headerlink" title="2ã€é…ç½®"></a>2ã€é…ç½®</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220322213926.png"></p><h4 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h4><p><a href="http://localhost:8401/testHotKey?p1=5">http://localhost:8401/testHotKey?p1=5</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220322214044.png"></p><p><a href="http://localhost:8401/testHotKey?p1=3">http://localhost:8401/testHotKey?p1=3</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220322214058.png"></p><h4 id="4ã€ç»“è®º"><a href="#4ã€ç»“è®º" class="headerlink" title="4ã€ç»“è®º"></a>4ã€ç»“è®º</h4><p>å½“p1ç­‰äº5çš„æ—¶å€™ï¼Œé˜ˆå€¼å˜ä¸º 200</p><p>å½“p1ä¸ç­‰äº5çš„æ—¶å€™ï¼Œé˜ˆå€¼ä¸ºå¹³å¸¸çš„ 1</p><p>çƒ­ç‚¹å‚æ•°çš„æ³¨æ„ç‚¹ï¼Œå‚æ•°å¿…é¡»æ˜¯åŸºæœ¬ç±»å‹æˆ–è€…String</p><h2 id="ä¸ƒã€-SentinelResource"><a href="#ä¸ƒã€-SentinelResource" class="headerlink" title="ä¸ƒã€@SentinelResource"></a>ä¸ƒã€@SentinelResource</h2><h3 id="1ã€æŒ‰èµ„æºåç§°é™æµ-åç»­å¤„ç†"><a href="#1ã€æŒ‰èµ„æºåç§°é™æµ-åç»­å¤„ç†" class="headerlink" title="1ã€æŒ‰èµ„æºåç§°é™æµ+åç»­å¤„ç†"></a>1ã€æŒ‰èµ„æºåç§°é™æµ+åç»­å¤„ç†</h3><h4 id="1ã€ä»£ç -2"><a href="#1ã€ä»£ç -2" class="headerlink" title="1ã€ä»£ç "></a>1ã€ä»£ç </h4><p>1ã€ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">SentinelResource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RateLimitController</span><span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/byResource"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"byResource"</span><span class="token punctuation">,</span>blockHandler <span class="token operator">=</span> <span class="token string">"handleException"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">byResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">"æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Payment</span> <span class="token punctuation">(</span><span class="token number">2020L</span><span class="token punctuation">,</span><span class="token string">"serial001"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span>exception<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t æœåŠ¡ä¸å¯ç”¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ã€pom</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2ã€é…ç½®æµæ§è§„åˆ™"><a href="#2ã€é…ç½®æµæ§è§„åˆ™" class="headerlink" title="2ã€é…ç½®æµæ§è§„åˆ™"></a>2ã€é…ç½®æµæ§è§„åˆ™</h4><h5 id="1ã€æ­¥éª¤"><a href="#1ã€æ­¥éª¤" class="headerlink" title="1ã€æ­¥éª¤"></a>1ã€æ­¥éª¤</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323102223.png"></p><h5 id="2ã€å›¾å½¢é…ç½®å’Œä»£ç å…³ç³»"><a href="#2ã€å›¾å½¢é…ç½®å’Œä»£ç å…³ç³»" class="headerlink" title="2ã€å›¾å½¢é…ç½®å’Œä»£ç å…³ç³»"></a>2ã€å›¾å½¢é…ç½®å’Œä»£ç å…³ç³»</h5><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323102301.png"></p><h5 id="3ã€é…ç½®è¯´æ˜"><a href="#3ã€é…ç½®è¯´æ˜" class="headerlink" title="3ã€é…ç½®è¯´æ˜"></a>3ã€é…ç½®è¯´æ˜</h5><p>è¡¨ç¤º1ç§’é’Ÿå†…æŸ¥è¯¢æ¬¡æ•°å¤§äº1ï¼Œå°±è·‘åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„å¤„æµï¼Œé™æµ</p><h4 id="3ã€æµ‹è¯•-1"><a href="#3ã€æµ‹è¯•-1" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h4><p>1ç§’é’Ÿç‚¹å‡»1ä¸‹ï¼ŒOK</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323103703.png"></p><p>è¶…è¿‡ä¸Šè¿°ï¼Œç–¯ç‹‚ç‚¹å‡»ï¼Œè¿”å›äº†è‡ªå·±å®šä¹‰çš„é™æµå¤„ç†ä¿¡æ¯ï¼Œé™æµå‘ç”Ÿ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323103648.png"></p><h3 id="2ã€æŒ‰ç…§Urlåœ°å€é™æµ-åç»­å¤„ç†"><a href="#2ã€æŒ‰ç…§Urlåœ°å€é™æµ-åç»­å¤„ç†" class="headerlink" title="2ã€æŒ‰ç…§Urlåœ°å€é™æµ+åç»­å¤„ç†"></a>2ã€æŒ‰ç…§Urlåœ°å€é™æµ+åç»­å¤„ç†</h3><h4 id="1ã€ä½œç”¨-1"><a href="#1ã€ä½œç”¨-1" class="headerlink" title="1ã€ä½œç”¨"></a>1ã€ä½œç”¨</h4><p>é€šè¿‡è®¿é—®çš„URLæ¥é™æµï¼Œä¼šè¿”å›Sentinelè‡ªå¸¦é»˜è®¤çš„é™æµå¤„ç†ä¿¡æ¯</p><h4 id="2ã€ä»£ç -1"><a href="#2ã€ä»£ç -1" class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/rateLimit/byUrl"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"byUrl"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">byUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"æŒ‰urlé™æµæµ‹è¯•OK"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span> <span class="token punctuation">(</span><span class="token number">2020L</span><span class="token punctuation">,</span> <span class="token string">"serial002"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€è®¿é—®ï¼ˆ1æ¬¡ï¼‰"><a href="#3ã€è®¿é—®ï¼ˆ1æ¬¡ï¼‰" class="headerlink" title="3ã€è®¿é—®ï¼ˆ1æ¬¡ï¼‰"></a>3ã€è®¿é—®ï¼ˆ1æ¬¡ï¼‰</h4><p>ä¸ºäº†åˆ·æ–°å®æ—¶é…ç½®ï¼Œçº¿ä¸Šå°±æ²¡å¿…è¦è¿™ä¸ªæ“ä½œäº†</p><p><a href="http://localhost:8401//rateLimit/byUrl">http://localhost:8401//rateLimit/byUrl</a></p><h4 id="4ã€é…ç½®-2"><a href="#4ã€é…ç½®-2" class="headerlink" title="4ã€é…ç½®"></a>4ã€é…ç½®</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323105553.png"></p><h4 id="5ã€è®¿é—®ï¼ˆç‹‚ç‚¹ï¼‰"><a href="#5ã€è®¿é—®ï¼ˆç‹‚ç‚¹ï¼‰" class="headerlink" title="5ã€è®¿é—®ï¼ˆç‹‚ç‚¹ï¼‰"></a>5ã€è®¿é—®ï¼ˆç‹‚ç‚¹ï¼‰</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323105616.png"></p><h3 id="3ã€å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜"><a href="#3ã€å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜" class="headerlink" title="3ã€å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜"></a>3ã€å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜</h3><p>1  ç³»ç»Ÿé»˜è®¤çš„ï¼Œæ²¡æœ‰ä½“ç°æˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡è¦æ±‚ã€‚</p><p>2  ä¾ç…§ç°æœ‰æ¡ä»¶ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„å¤„ç†æ–¹æ³•åˆå’Œä¸šåŠ¡ä»£ç è€¦åˆåœ¨ä¸€å—ï¼Œä¸ç›´è§‚ã€‚</p><p>3  æ¯ä¸ªä¸šåŠ¡æ–¹æ³•éƒ½æ·»åŠ ä¸€ä¸ªå…œåº•çš„ï¼Œé‚£ä»£ç è†¨èƒ€åŠ å‰§ã€‚</p><p>4  å…¨å±€ç»Ÿä¸€çš„å¤„ç†æ–¹æ³•æ²¡æœ‰ä½“ç°</p><h3 id="4ã€ç”¨æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘"><a href="#4ã€ç”¨æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘" class="headerlink" title="4ã€ç”¨æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘"></a>4ã€ç”¨æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘</h3><h4 id="1ã€è‡ªå®šä¹‰é™æµå¤„ç†ç±»"><a href="#1ã€è‡ªå®šä¹‰é™æµå¤„ç†ç±»" class="headerlink" title="1ã€è‡ªå®šä¹‰é™æµå¤„ç†ç±»"></a>1ã€è‡ªå®šä¹‰é™æµå¤„ç†ç±»</h4><p>åˆ›å»ºCustomerBlockHandlerç±»ç”¨äºè‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>handler</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerBlockHandler</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CommonResult</span> <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span> <span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token string">"è‡ªå®šä¹‰çš„é™æµå¤„ç†ä¿¡æ¯......CustomerBlockHandler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323115746.png"></p><h4 id="2ã€ä½¿ç”¨"><a href="#2ã€ä½¿ç”¨" class="headerlink" title="2ã€ä½¿ç”¨"></a>2ã€ä½¿ç”¨</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è‡ªå®šä¹‰é€šç”¨çš„é™æµå¤„ç†é€»è¾‘ï¼Œ blockHandlerClass = CustomerBlockHandler.class blockHandler = handleException ä¸Šè¿°é…ç½®ï¼šæ‰¾CustomerBlockHandlerç±»é‡Œçš„handleException2æ–¹æ³•è¿›è¡Œå…œåº•å¤„ç† */</span><span class="token comment">/** * è‡ªå®šä¹‰é€šç”¨çš„é™æµå¤„ç†é€»è¾‘ */</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/rateLimit/customerBlockHandler"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"customerBlockHandler"</span><span class="token punctuation">,</span>        blockHandlerClass <span class="token operator">=</span> <span class="token class-name">CustomerBlockHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">"handleException"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">customerBlockHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"æŒ‰å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€é…ç½®-2"><a href="#3ã€é…ç½®-2" class="headerlink" title="3ã€é…ç½®"></a>3ã€é…ç½®</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323120859.png"></p><h4 id="4ã€é…ç½®è¯´æ˜"><a href="#4ã€é…ç½®è¯´æ˜" class="headerlink" title="4ã€é…ç½®è¯´æ˜"></a>4ã€é…ç½®è¯´æ˜</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323121020.png"></p><h4 id="5ã€æµ‹è¯•-1"><a href="#5ã€æµ‹è¯•-1" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323121049.png"></p><h3 id="5ã€æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜"><a href="#5ã€æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜" class="headerlink" title="5ã€æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜"></a>5ã€æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323121421.png"></p><h2 id="å…«ã€æœåŠ¡ç†”æ–­åŠŸèƒ½"><a href="#å…«ã€æœåŠ¡ç†”æ–­åŠŸèƒ½" class="headerlink" title="å…«ã€æœåŠ¡ç†”æ–­åŠŸèƒ½"></a>å…«ã€æœåŠ¡ç†”æ–­åŠŸèƒ½</h2><h3 id="1ã€æ•´åˆ"><a href="#1ã€æ•´åˆ" class="headerlink" title="1ã€æ•´åˆ"></a>1ã€æ•´åˆ</h3><p>sentinelæ•´åˆribbon+openFeign+fallback</p><h3 id="2ã€Ribbon"><a href="#2ã€Ribbon" class="headerlink" title="2ã€Ribbon"></a>2ã€Ribbon</h3><h4 id="1ã€ç”Ÿäº§è€…"><a href="#1ã€ç”Ÿäº§è€…" class="headerlink" title="1ã€ç”Ÿäº§è€…"></a>1ã€ç”Ÿäº§è€…</h4><h5 id="1ã€å»ºmodel-1"><a href="#1ã€å»ºmodel-1" class="headerlink" title="1ã€å»ºmodel"></a>1ã€å»ºmodel</h5><p>cloudalibaba-provider-payment9003</p><h5 id="2ã€pom-1"><a href="#2ã€pom-1" class="headerlink" title="2ã€pom"></a>2ã€pom</h5><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springcloud2021to2022<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-provider-payment9003<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€yml-1"><a href="#3ã€yml-1" class="headerlink" title="3ã€yml"></a>3ã€yml</h5><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">server:  port: 9003spring:  application:    name: nacos-payment-provider  cloud:    nacos:      discovery:        server-addr: localhost:8848 #é…ç½®Nacosåœ°å€management:  endpoints:    web:      exposure:        include: '*'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€ä¸»å¯åŠ¨-1"><a href="#4ã€ä¸»å¯åŠ¨-1" class="headerlink" title="4ã€ä¸»å¯åŠ¨"></a>4ã€ä¸»å¯åŠ¨</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span><span class="token punctuation">;</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentMain9003</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span>run <span class="token punctuation">(</span><span class="token class-name">PaymentMain9003</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="5ã€ä¸šåŠ¡ç±»-1"><a href="#5ã€ä¸šåŠ¡ç±»-1" class="headerlink" title="5ã€ä¸šåŠ¡ç±»"></a>5ã€ä¸šåŠ¡ç±»</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${server.port}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> serverPort<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        hashMap<span class="token punctuation">.</span>put <span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span> <span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">"28a8c1e3bc2742d8848569891fb42181"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        hashMap<span class="token punctuation">.</span>put <span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span> <span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">,</span> <span class="token string">"bba8c1e3bc2742d8848569891ac32182"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        hashMap<span class="token punctuation">.</span>put <span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span> <span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">,</span> <span class="token string">"6ua8c1e3bc2742d8848569891xt92183"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/paymentSQL/{id}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Payment</span> payment <span class="token operator">=</span> hashMap<span class="token punctuation">.</span>get <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"from mysql,serverPort:  "</span> <span class="token operator">+</span> serverPort<span class="token punctuation">,</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="6ã€å¯åŠ¨"><a href="#6ã€å¯åŠ¨" class="headerlink" title="6ã€å¯åŠ¨"></a>6ã€å¯åŠ¨</h5><p>åŒä¸€ä¸ªæœåŠ¡ï¼Œå¯åŠ¨9003ï¼Œ9004</p><p><code>-Dserver.port=9004</code></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324000149.png"></p><h5 id="7ã€æµ‹è¯•"><a href="#7ã€æµ‹è¯•" class="headerlink" title="7ã€æµ‹è¯•"></a>7ã€æµ‹è¯•</h5><p><a href="http://localhost:9003/paymentSQL/1">http://localhost:9003/paymentSQL/1</a></p><p><a href="http://localhost:9004/paymentSQL/1">http://localhost:9004/paymentSQL/1</a></p><h4 id="2ã€æ¶ˆè´¹è€…"><a href="#2ã€æ¶ˆè´¹è€…" class="headerlink" title="2ã€æ¶ˆè´¹è€…"></a>2ã€æ¶ˆè´¹è€…</h4><h5 id="1ã€model"><a href="#1ã€model" class="headerlink" title="1ã€model"></a>1ã€model</h5><p>æ–°å»ºcloudalibaba-consumer-nacos-order84</p><h5 id="2ã€pom-2"><a href="#2ã€pom-2" class="headerlink" title="2ã€pom"></a>2ã€pom</h5><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springcloud2021to2022<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-consumer-nacos-order84<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€yml-2"><a href="#3ã€yml-2" class="headerlink" title="3ã€yml"></a>3ã€yml</h5><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">server:  port: 84spring:  application:    name: nacos-order-consumer  cloud:    nacos:      discovery:        server-addr: localhost:8848    sentinel:      transport:        #é…ç½®Sentinel dashboardåœ°å€        dashboard: localhost:8080        #é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£        port: 8719#æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…)service-url:  nacos-user-service: http://nacos-payment-provider <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4ã€ä¸»å¯åŠ¨-2"><a href="#4ã€ä¸»å¯åŠ¨-2" class="headerlink" title="4ã€ä¸»å¯åŠ¨"></a>4ã€ä¸»å¯åŠ¨</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span><span class="token punctuation">;</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosMain84</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span>run <span class="token punctuation">(</span><span class="token class-name">OrderNacosMain84</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="5ã€é…ç½®ç±»"><a href="#5ã€é…ç½®ç±»" class="headerlink" title="5ã€é…ç½®ç±»"></a>5ã€é…ç½®ç±»</h5><p>1ã€rabbion è´Ÿè½½é…ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span></span><span class="token class-name">LoadBalanced</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@LoadBalanced</span>    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">getRestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span> <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="6ã€ä¸šåŠ¡ç±»"><a href="#6ã€ä¸šåŠ¡ç±»" class="headerlink" title="6ã€ä¸šåŠ¡ç±»"></a>6ã€ä¸šåŠ¡ç±»</h5><p>1ã€åªé…ç½®fallbackï¼ˆæœ¬ä¾‹sentinelæ— é…ç½®ï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324205223.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324210258.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324210320.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324210332.png"></p><p>2ã€åªé…ç½®blockHandler</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">SentinelResource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CircleBreakerController</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SERVICE_URL <span class="token operator">=</span> <span class="token string">"http://nacos-payment-provider"</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/consumer/fallback/{id}"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"fallback"</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">"blockHandler"</span><span class="token punctuation">)</span> <span class="token comment">//blockHandlerè´Ÿè´£åœ¨sentinelé‡Œé¢é…ç½®çš„é™çº§é™æµ</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span>getForObject <span class="token punctuation">(</span>SERVICE_URL <span class="token operator">+</span> <span class="token string">"/paymentSQL/"</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span> <span class="token punctuation">(</span><span class="token string">"éæ³•å‚æ•°å¼‚å¸¸...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>getData <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span> <span class="token punctuation">(</span><span class="token string">"NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// å…œåº•</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerFallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">"null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span> <span class="token string">"å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹  "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>getMessage <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// é™çº§</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">blockHandler</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> blockException<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">"null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token number">445</span><span class="token punctuation">,</span> <span class="token string">"blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException  "</span> <span class="token operator">+</span> blockException<span class="token punctuation">.</span>getMessage <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324211100.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324211322.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324211510.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324211427.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324211443.png"></p><p>3ã€fallbackå’ŒblockHandleréƒ½é…ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">SentinelResource</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestTemplate</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CircleBreakerController</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SERVICE_URL <span class="token operator">=</span> <span class="token string">"http://nacos-payment-provider"</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/consumer/fallback/{id}"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"fallback"</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> <span class="token string">"handlerFallback"</span><span class="token punctuation">,</span> blockHandler <span class="token operator">=</span> <span class="token string">"blockHandler"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span>getForObject <span class="token punctuation">(</span>SERVICE_URL <span class="token operator">+</span> <span class="token string">"/paymentSQL/"</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span> <span class="token punctuation">(</span><span class="token string">"éæ³•å‚æ•°å¼‚å¸¸...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>getData <span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span> <span class="token punctuation">(</span><span class="token string">"NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// å…œåº•</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">handlerFallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">"null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span> <span class="token string">"fallback,æ— æ­¤æµæ°´,exception  "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>getMessage <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// é™çº§</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">blockHandler</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> blockException<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Payment</span> payment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">"null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token number">445</span><span class="token punctuation">,</span> <span class="token string">"blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException  "</span> <span class="token operator">+</span> blockException<span class="token punctuation">.</span>getMessage <span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> payment<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324211706.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324211811.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324212202.png"></p><p><strong>é™çº§ä¼˜å…ˆäºé™æµï¼šè‹¥ blockHandler å’Œ fallback éƒ½è¿›è¡Œäº†é…ç½®ï¼Œåˆ™è¢«é™æµé™çº§è€ŒæŠ›å‡º BlockException æ—¶åªä¼šè¿›å…¥ blockHandler å¤„ç†é€»è¾‘ã€‚</strong></p><p>4ã€å±æ€§å¿½ç•¥</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324212355.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324212430.png"></p><p><strong>ç›´æ¥æŠ›åˆ°å‰å°å¯¹ç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œç»†èŠ‚æ³¨æ„</strong></p><h3 id="3ã€Feign"><a href="#3ã€Feign" class="headerlink" title="3ã€Feign"></a>3ã€Feign</h3><h4 id="1ã€model-1"><a href="#1ã€model-1" class="headerlink" title="1ã€model"></a>1ã€model</h4><p>ä¿®æ”¹84æ¨¡å—</p><h4 id="2ã€pom-3"><a href="#2ã€pom-3" class="headerlink" title="2ã€pom"></a>2ã€pom</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!--SpringCloud openfeign --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324214128.png"></p><h4 id="3ã€yml-3"><a href="#3ã€yml-3" class="headerlink" title="3ã€yml"></a>3ã€yml</h4><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"># æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒfeign:  sentinel:    enabled: true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324214015.png"></p><h4 id="4ã€ä¸»å¯åŠ¨-3"><a href="#4ã€ä¸»å¯åŠ¨-3" class="headerlink" title="4ã€ä¸»å¯åŠ¨"></a>4ã€ä¸»å¯åŠ¨</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">EnableFeignClients</span><span class="token punctuation">;</span><span class="token annotation punctuation">@EnableDiscoveryClient</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableFeignClients</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderNacosMain84</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span>run <span class="token punctuation">(</span><span class="token class-name">OrderNacosMain84</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5ã€ä¸šåŠ¡ç±»-2"><a href="#5ã€ä¸šåŠ¡ç±»-2" class="headerlink" title="5ã€ä¸šåŠ¡ç±»"></a>5ã€ä¸šåŠ¡ç±»</h4><h5 id="1ã€è¿œç¨‹è°ƒæœåŠ¡æ¥å£"><a href="#1ã€è¿œç¨‹è°ƒæœåŠ¡æ¥å£" class="headerlink" title="1ã€è¿œç¨‹è°ƒæœåŠ¡æ¥å£"></a>1ã€è¿œç¨‹è°ƒæœåŠ¡æ¥å£</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>serivice</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>openfeign<span class="token punctuation">.</span></span><span class="token class-name">FeignClient</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span><span class="token punctuation">;</span><span class="token comment">/** * @auther mykk * @create 2022å¹´3æœˆ24æ—¥ 21:45:49 * ä½¿ç”¨ fallback æ–¹å¼æ˜¯æ— æ³•è·å–å¼‚å¸¸ä¿¡æ¯çš„ï¼Œ * å¦‚æœæƒ³è¦è·å–å¼‚å¸¸ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ fallbackFactoryå‚æ•° */</span><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"nacos-payment-provider"</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> <span class="token class-name">PaymentFallbackService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token comment">//è°ƒç”¨ä¸­å…³é—­9003æœåŠ¡æä¾›è€…</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PaymentService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/paymentSQL/{id}"</span><span class="token punctuation">)</span>    <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="2ã€å…œåº•å®ç°"><a href="#2ã€å…œåº•å®ç°" class="headerlink" title="2ã€å…œåº•å®ç°"></a>2ã€å…œåº•å®ç°</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>serivice</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">CommonResult</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kk<span class="token punctuation">.</span>springcloud<span class="token punctuation">.</span>entities<span class="token punctuation">.</span></span><span class="token class-name">Payment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentFallbackService</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">,</span> <span class="token string">"æœåŠ¡é™çº§è¿”å›,æ²¡æœ‰è¯¥æµæ°´ä¿¡æ¯"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Payment</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">"errorSerial......"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="3ã€Controller"><a href="#3ã€Controller" class="headerlink" title="3ã€Controller"></a>3ã€Controller</h5><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//==================OpenFeign</span><span class="token annotation punctuation">@Resource</span><span class="token keyword">private</span> <span class="token class-name">PaymentService</span> paymentService<span class="token punctuation">;</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/consumer/openfeign/{id}"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">&gt;</span></span> <span class="token function">paymentSQL</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">(</span><span class="token string">"æ²¡æœ‰è¯¥id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> paymentService<span class="token punctuation">.</span>paymentSQL <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6ã€æµ‹è¯•"><a href="#6ã€æµ‹è¯•" class="headerlink" title="6ã€æµ‹è¯•"></a>6ã€æµ‹è¯•</h4><p>æµ‹è¯•84è°ƒç”¨9003ï¼Œæ­¤æ—¶<code>æ•…æ„å…³é—­9003/9004å¾®æœåŠ¡æä¾›è€…ï¼Œçœ‹84æ¶ˆè´¹ä¾§è‡ªåŠ¨é™çº§</code>ï¼Œä¸ä¼šè¢«è€—æ­»</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324221753.png"></p><h3 id="4ã€ç†”æ–­æ¡†æ¶æ¯”è¾ƒ"><a href="#4ã€ç†”æ–­æ¡†æ¶æ¯”è¾ƒ" class="headerlink" title="4ã€ç†”æ–­æ¡†æ¶æ¯”è¾ƒ"></a>4ã€ç†”æ–­æ¡†æ¶æ¯”è¾ƒ</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220323170940.png"></p><h2 id="ä¹ã€æŒä¹…åŒ–è§„åˆ™"><a href="#ä¹ã€æŒä¹…åŒ–è§„åˆ™" class="headerlink" title="ä¹ã€æŒä¹…åŒ–è§„åˆ™"></a>ä¹ã€æŒä¹…åŒ–è§„åˆ™</h2><h3 id="1ã€æ˜¯ä»€ä¹ˆ-3"><a href="#1ã€æ˜¯ä»€ä¹ˆ-3" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆ"></a>1ã€æ˜¯ä»€ä¹ˆ</h3><p>ä¸€æ—¦æˆ‘ä»¬é‡å¯åº”ç”¨ï¼Œsentinelè§„åˆ™å°†æ¶ˆå¤±ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦å°†é…ç½®è§„åˆ™è¿›è¡ŒæŒä¹…åŒ–</p><h3 id="2ã€æ€ä¹ˆç©"><a href="#2ã€æ€ä¹ˆç©" class="headerlink" title="2ã€æ€ä¹ˆç©"></a>2ã€æ€ä¹ˆç©</h3><p>å°†é™æµé…ç½®è§„åˆ™æŒä¹…åŒ–è¿›Nacosä¿å­˜ï¼Œåªè¦åˆ·æ–°8401æŸä¸ªreståœ°å€ï¼Œsentinelæ§åˆ¶å°<br>çš„æµæ§è§„åˆ™å°±èƒ½çœ‹åˆ°ï¼Œåªè¦Nacosé‡Œé¢çš„é…ç½®ä¸åˆ é™¤ï¼Œé’ˆå¯¹8401ä¸Šsentinelä¸Šçš„æµæ§è§„åˆ™æŒç»­æœ‰æ•ˆ</p><h3 id="3ã€å®æˆ˜"><a href="#3ã€å®æˆ˜" class="headerlink" title="3ã€å®æˆ˜"></a>3ã€å®æˆ˜</h3><h4 id="1ã€model-2"><a href="#1ã€model-2" class="headerlink" title="1ã€model"></a>1ã€model</h4><p>ä¿®æ”¹cloudalibaba-sentinel-service8401</p><h4 id="2ã€pom-4"><a href="#2ã€pom-4" class="headerlink" title="2ã€pom"></a>2ã€pom</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324223255.png"></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springcloud2021to2022<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloudalibaba-sentinel-service8401<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.kk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${project.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--openfeign--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶+actuator --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.6.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3ã€yml-4"><a href="#3ã€yml-4" class="headerlink" title="3ã€yml"></a>3ã€yml</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324223733.png"></p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">server:  port: 8401spring:  application:    name: cloudalibaba-sentinel-service  cloud:    nacos:      discovery:        #NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€        server-addr: 101.34.180.133:8848    sentinel:      transport:        #é…ç½®Sentinel dashboardåœ°å€        #        dashboard: 101.34.180.133:8858        #        dashboard: 106.52.23.202:8080        # é¡¹ç›®å’Œ sentinel ä¸åœ¨åŒä¸€å°æœºå™¨æ— æ³•æŸ¥çœ‹å®æ—¶ç›‘æ§        dashboard: localhost:8080        #é»˜è®¤8719ç«¯å£ï¼Œå‡å¦‚è¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ,ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£        port: 8719      datasource:        ds1:          nacos:            server-addr: 101.34.180.133:8848            dataId: cloudalibaba-sentinel-service            groupId: DEFAULT_GROUP            data-type: json            rule-type: flow        # æœ¬åœ°æœºå™¨ip(dockerå®¹å™¨å¿…é¡»åŠ ä¸Š)#        client-ip: 169.254.135.77feign:  sentinel:    enabled: true # æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒmanagement:  endpoints:    web:      exposure:        include: '*'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4ã€æ·»åŠ Nacosä¸šåŠ¡è§„åˆ™é…ç½®"><a href="#4ã€æ·»åŠ Nacosä¸šåŠ¡è§„åˆ™é…ç½®" class="headerlink" title="4ã€æ·»åŠ Nacosä¸šåŠ¡è§„åˆ™é…ç½®"></a>4ã€æ·»åŠ Nacosä¸šåŠ¡è§„åˆ™é…ç½®</h4><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>    <span class="token punctuation">{</span>        <span class="token property">"resource"</span><span class="token operator">:</span> <span class="token string">"/rateLimit/byUrl"</span><span class="token punctuation">,</span>        <span class="token property">"limitApp"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>        <span class="token property">"grade"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"count"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"strategy"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"controlBehavior"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"clusterMode"</span><span class="token operator">:</span> <span class="token boolean">false</span>    <span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324224003.png"></p><h4 id="5ã€å¯åŠ¨"><a href="#5ã€å¯åŠ¨" class="headerlink" title="5ã€å¯åŠ¨"></a>5ã€å¯åŠ¨</h4><p><strong>å¯åŠ¨8401ååˆ·æ–°sentinelå‘ç°ä¸šåŠ¡è§„åˆ™æœ‰äº†</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324224338.png"></p><h4 id="6ã€æµ‹è¯•ï¼ˆè®¿é—®ï¼‰"><a href="#6ã€æµ‹è¯•ï¼ˆè®¿é—®ï¼‰" class="headerlink" title="6ã€æµ‹è¯•ï¼ˆè®¿é—®ï¼‰"></a>6ã€æµ‹è¯•ï¼ˆè®¿é—®ï¼‰</h4><p>å¿«é€Ÿè®¿é—®æµ‹è¯•æ¥å£</p><p><a href="http://localhost:8401/rateLimit/byUrl">http://localhost:8401/rateLimit/byUrl</a></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220324224436.png"></p><h2 id="åäºŒã€å‚è€ƒæ–‡æ¡£-â†“"><a href="#åäºŒã€å‚è€ƒæ–‡æ¡£-â†“" class="headerlink" title="åäºŒã€å‚è€ƒæ–‡æ¡£ â†“"></a>åäºŒã€å‚è€ƒæ–‡æ¡£ â†“</h2><p><a href="https://www.cnblogs.com/linjiqin/p/15369091.html">https://www.cnblogs.com/linjiqin/p/15369091.html</a></p><p><a href="https://www.jianshu.com/p/373eb512ec48">https://www.jianshu.com/p/373eb512ec48</a></p><p><a href="https://m.imooc.com/article/details?article_id=289384">https://m.imooc.com/article/details?article_id=289384</a></p><p><a href="https://www.cnblogs.com/yunqing/p/11406225.html">https://www.cnblogs.com/yunqing/p/11406225.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ" scheme="https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"/>
    
    
    <category term="springcloud-alibaba" scheme="https://mykkto.github.io/tags/springcloud-alibaba/"/>
    
    <category term="ç†”æ–­å™¨" scheme="https://mykkto.github.io/tags/%E7%86%94%E6%96%AD%E5%99%A8/"/>
    
    <category term="sentinel" scheme="https://mykkto.github.io/tags/sentinel/"/>
    
    <category term="é™æµ" scheme="https://mykkto.github.io/tags/%E9%99%90%E6%B5%81/"/>
    
  </entry>
  
  <entry>
    <title>Nacos é«˜å¯ç”¨é›†ç¾¤ï¼ˆdocker-composeï¼‰</title>
    <link href="https://mykkto.github.io/posts/d9c3bea0.html"/>
    <id>https://mykkto.github.io/posts/d9c3bea0.html</id>
    <published>2022-03-12T03:17:13.000Z</published>
    <updated>2022-11-12T15:07:08.072Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä¸€ã€æ¶æ„"><a href="#ä¸€ã€æ¶æ„" class="headerlink" title="ä¸€ã€æ¶æ„"></a>ä¸€ã€æ¶æ„</h2><h3 id="1ã€å‰è¨€"><a href="#1ã€å‰è¨€" class="headerlink" title="1ã€å‰è¨€"></a>1ã€å‰è¨€</h3><p>æœ¬æ¥è¿™éƒ¨åˆ†æ˜¯è¦åœ¨  <a href="/posts/af0a257d">Spring-nacos æ‰‹å†Œ</a>ä¸­ ï¼Œä½†æ˜¯åé¢æ­å»ºé‡åˆ°å¾ˆå¤šå‘æ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œå°±å•ç‹¬æ•´ç†åå†™å‡ºè¿™ç¯‡ã€‚</p><h3 id="2ã€æ¶æ„å›¾"><a href="#2ã€æ¶æ„å›¾" class="headerlink" title="2ã€æ¶æ„å›¾"></a>2ã€æ¶æ„å›¾</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312143557.png"></p><p>ä¸€ä¸ªngxin è´Ÿè½½ ä¸‰ä¸ª nacosèŠ‚ç‚¹ï¼Œmysql ä¸»ä»ä¸¤ä¸ªèŠ‚ç‚¹</p><h2 id="äºŒã€æ­å»º-mysql-ä¸»ä»"><a href="#äºŒã€æ­å»º-mysql-ä¸»ä»" class="headerlink" title="äºŒã€æ­å»º mysql ä¸»ä»"></a>äºŒã€æ­å»º mysql ä¸»ä»</h2><h3 id="1ã€æ‹‰å–å’Œåˆ›å»º"><a href="#1ã€æ‹‰å–å’Œåˆ›å»º" class="headerlink" title="1ã€æ‹‰å–å’Œåˆ›å»º"></a>1ã€æ‹‰å–å’Œåˆ›å»º</h3><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token comment"># 1ã€æ‹‰å–</span><span class="token punctuation">[</span>root@VM_0_17_centos ~<span class="token punctuation">]</span>docker pull mysql<span class="token punctuation">:</span>5.7.13<span class="token comment"># 2ã€å¯åŠ¨</span><span class="token punctuation">[</span>root@VM_0_17_centos ~<span class="token punctuation">]</span>docker run <span class="token punctuation">-</span><span class="token punctuation">-</span>name master <span class="token punctuation">-</span>p 3306<span class="token punctuation">:</span>3306 <span class="token punctuation">-</span>e MYSQL_ROOT_PASSWORD=root <span class="token punctuation">-</span>d mysql<span class="token punctuation">:</span>5.7.13<span class="token comment"># å‚æ•°è¯´æ˜</span><span class="token punctuation">-</span><span class="token punctuation">-</span>name ä¸ºå®¹å™¨æŒ‡å®šåç§°ï¼Œè¿™é‡Œæ˜¯master<span class="token punctuation">-</span>p å°†å®¹å™¨çš„æŒ‡å®šç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„æŒ‡å®šç«¯å£ï¼Œè¿™é‡Œæ˜¯å°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306ç«¯å£<span class="token punctuation">-</span>e è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œæ˜¯æŒ‡å®šrootè´¦å·çš„å¯†ç ä¸ºroot<span class="token punctuation">-</span>d åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDmysql<span class="token punctuation">:</span>5.7.13 æŒ‡å®šè¿è¡Œçš„mysqlç‰ˆ<span class="token comment"># 3ã€æŸ¥çœ‹æ˜¯å¦å¯åŠ¨,ä»¥æœ‰å®¹å™¨</span><span class="token punctuation">[</span>root@VM_0_17_centos ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2ã€å¼€æ”¾ç«¯å£"><a href="#2ã€å¼€æ”¾ç«¯å£" class="headerlink" title="2ã€å¼€æ”¾ç«¯å£"></a>2ã€å¼€æ”¾ç«¯å£</h3><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">firewall-cmd --zone=public --add-port=3306/tcp --permanentfirewall-cmd --reload# è¯´æ˜--permanent æ°¸ä¹…å¼€å¯ï¼Œé¿å…ä¸‹æ¬¡å¼€æœºéœ€è¦å†æ¬¡æ‰‹åŠ¨å¼€å¯ç«¯å£<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3ã€åˆ›å»º-ä¸»å®¹å™¨-çš„å¤åˆ¶è´¦å·"><a href="#3ã€åˆ›å»º-ä¸»å®¹å™¨-çš„å¤åˆ¶è´¦å·" class="headerlink" title="3ã€åˆ›å»º[ä¸»å®¹å™¨]çš„å¤åˆ¶è´¦å·"></a>3ã€åˆ›å»º[ä¸»å®¹å™¨]çš„å¤åˆ¶è´¦å·</h3><p>ä½¿ç”¨Navicatå‹å¥½çš„å›¾åƒåŒ–ç•Œé¢æ‰§è¡ŒSQL</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">REPLICATION</span> SLAVE <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'backup'</span><span class="token variable">@'%'</span> identified <span class="token keyword">by</span> <span class="token string">'backup'</span><span class="token punctuation">;</span><span class="token keyword">show</span> grants <span class="token keyword">for</span> <span class="token string">'backup'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="4ã€ä¿®æ”¹MySQL-ä¸»å®¹å™¨-é…ç½®ç¯å¢ƒ"><a href="#4ã€ä¿®æ”¹MySQL-ä¸»å®¹å™¨-é…ç½®ç¯å¢ƒ" class="headerlink" title="4ã€ä¿®æ”¹MySQL[ä¸»å®¹å™¨]é…ç½®ç¯å¢ƒ"></a>4ã€ä¿®æ”¹MySQL[ä¸»å®¹å™¨]é…ç½®ç¯å¢ƒ</h3><h4 id="1ã€åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š"><a href="#1ã€åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š" class="headerlink" title="1ã€åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š"></a>1ã€åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</h4><p>/usr/local/mysql/master<br>/usr/local/mysql/slave1<br>/usr/local/mysql/slave2</p><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">[root@VM_0_17_centos ~]# mkdir -p /usr/local/mysql/master /usr/local/mysql/slave1 /usr/local/mysql/slave2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€æ‹·è´ä¸€ä»½MySQLé…ç½®æ–‡ä»¶"><a href="#2ã€æ‹·è´ä¸€ä»½MySQLé…ç½®æ–‡ä»¶" class="headerlink" title="2ã€æ‹·è´ä¸€ä»½MySQLé…ç½®æ–‡ä»¶"></a>2ã€æ‹·è´ä¸€ä»½MySQLé…ç½®æ–‡ä»¶</h4><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">[root@VM_0_17_centos local]# docker cp master:/etc/mysql/my.cnf /usr/local/mysql/master/my.cnf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3ã€è¿›åˆ°masterç›®å½•ä¸‹ï¼Œå·²å­˜åœ¨æ‹·è´çš„my-cnf"><a href="#3ã€è¿›åˆ°masterç›®å½•ä¸‹ï¼Œå·²å­˜åœ¨æ‹·è´çš„my-cnf" class="headerlink" title="3ã€è¿›åˆ°masterç›®å½•ä¸‹ï¼Œå·²å­˜åœ¨æ‹·è´çš„my.cnf"></a>3ã€è¿›åˆ°masterç›®å½•ä¸‹ï¼Œå·²å­˜åœ¨æ‹·è´çš„my.cnf</h4><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">[root@VM_0_17_centos master]# lltotal 4-rw-r--r-- 1 root root 1801 May 10 10:27 my.cnf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="4ã€ä¿®æ”¹my-cnfï¼Œåœ¨-mysqld-èŠ‚ç‚¹æœ€ååŠ ä¸Šåä¿å­˜"><a href="#4ã€ä¿®æ”¹my-cnfï¼Œåœ¨-mysqld-èŠ‚ç‚¹æœ€ååŠ ä¸Šåä¿å­˜" class="headerlink" title="4ã€ä¿®æ”¹my.cnfï¼Œåœ¨ [mysqld] èŠ‚ç‚¹æœ€ååŠ ä¸Šåä¿å­˜"></a>4ã€ä¿®æ”¹my.cnfï¼Œåœ¨ [mysqld] èŠ‚ç‚¹æœ€ååŠ ä¸Šåä¿å­˜</h4><pre class="line-numbers language-my.cnf" data-language="my.cnf"><code class="language-my.cnf">log-bin=mysql-binserver-id=1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>log-bin=mysql-bin</code> ä½¿ç”¨binary loggingï¼Œmysql-binæ˜¯logæ–‡ä»¶åçš„å‰ç¼€</p><p><code>server-id=1</code> å”¯ä¸€æœåŠ¡å™¨IDï¼Œé0æ•´æ•°ï¼Œä¸èƒ½å’Œå…¶ä»–æœåŠ¡å™¨çš„server-idé‡å¤</p><h4 id="5ã€å°†ä¿®æ”¹åçš„æ–‡ä»¶è¦†ç›–Dockerä¸­MySQLä¸­çš„é…ç½®æ–‡ä»¶"><a href="#5ã€å°†ä¿®æ”¹åçš„æ–‡ä»¶è¦†ç›–Dockerä¸­MySQLä¸­çš„é…ç½®æ–‡ä»¶" class="headerlink" title="5ã€å°†ä¿®æ”¹åçš„æ–‡ä»¶è¦†ç›–Dockerä¸­MySQLä¸­çš„é…ç½®æ–‡ä»¶"></a>5ã€å°†ä¿®æ”¹åçš„æ–‡ä»¶è¦†ç›–Dockerä¸­MySQLä¸­çš„é…ç½®æ–‡ä»¶</h4><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">docker cp /usr/local/mysql/master/my.cnf master:/etc/mysql/my.cnf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="6ã€é‡å¯-mysql-çš„docker-è®©é…ç½®ç”Ÿæ•ˆ"><a href="#6ã€é‡å¯-mysql-çš„docker-è®©é…ç½®ç”Ÿæ•ˆ" class="headerlink" title="6ã€é‡å¯ mysql çš„docker , è®©é…ç½®ç”Ÿæ•ˆ"></a>6ã€é‡å¯ mysql çš„docker , è®©é…ç½®ç”Ÿæ•ˆ</h4><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">[root@VM_0_17_centos master]# docker restart master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="5ã€è¿è¡ŒMySQL-ä»-å®¹å™¨"><a href="#5ã€è¿è¡ŒMySQL-ä»-å®¹å™¨" class="headerlink" title="5ã€è¿è¡ŒMySQL [ä»]å®¹å™¨"></a>5ã€è¿è¡ŒMySQL [ä»]å®¹å™¨</h3><h4 id="1ã€é¦–å…ˆè¿è¡Œä»å®¹å™¨"><a href="#1ã€é¦–å…ˆè¿è¡Œä»å®¹å™¨" class="headerlink" title="1ã€é¦–å…ˆè¿è¡Œä»å®¹å™¨"></a>1ã€é¦–å…ˆè¿è¡Œä»å®¹å™¨</h4><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">[root@VM_0_17_centos ~]# docker run --name slave1 -p 3307:3306 -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7.13<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€ä¸ä¸»å®¹å™¨ç›¸ä¼¼ï¼Œæ‹·è´é…ç½®æ–‡ä»¶è‡³slave1ç›®å½•ä¿®æ”¹åè¦†ç›–å›Dockerä¸­"><a href="#2ã€ä¸ä¸»å®¹å™¨ç›¸ä¼¼ï¼Œæ‹·è´é…ç½®æ–‡ä»¶è‡³slave1ç›®å½•ä¿®æ”¹åè¦†ç›–å›Dockerä¸­" class="headerlink" title="2ã€ä¸ä¸»å®¹å™¨ç›¸ä¼¼ï¼Œæ‹·è´é…ç½®æ–‡ä»¶è‡³slave1ç›®å½•ä¿®æ”¹åè¦†ç›–å›Dockerä¸­"></a>2ã€ä¸ä¸»å®¹å™¨ç›¸ä¼¼ï¼Œæ‹·è´é…ç½®æ–‡ä»¶è‡³slave1ç›®å½•ä¿®æ”¹åè¦†ç›–å›Dockerä¸­</h4><pre class="line-numbers language-my.cof" data-language="my.cof"><code class="language-my.cof">log-bin=mysql-binserver-id=2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="3ã€åˆ«å¿˜è®°ï¼Œé‡å¯slave1å®¹å™¨ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ"><a href="#3ã€åˆ«å¿˜è®°ï¼Œé‡å¯slave1å®¹å™¨ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ" class="headerlink" title="3ã€åˆ«å¿˜è®°ï¼Œé‡å¯slave1å®¹å™¨ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ"></a>3ã€åˆ«å¿˜è®°ï¼Œé‡å¯slave1å®¹å™¨ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ</h4><h4 id=""><a href="#" class="headerlink" title=""></a></h4><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">[root@VM_0_17_centos master]# docker slave1 master<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="6ã€é…ç½®ä¸»ä»å¤åˆ¶"><a href="#6ã€é…ç½®ä¸»ä»å¤åˆ¶" class="headerlink" title="6ã€é…ç½®ä¸»ä»å¤åˆ¶"></a>6ã€é…ç½®ä¸»ä»å¤åˆ¶</h3><h4 id="1ã€ä½¿ç”¨Navicatè¿æ¥-slave1-åæ–°å»ºæŸ¥è¯¢ï¼Œæ‰§è¡Œä»¥ä¸‹SQL"><a href="#1ã€ä½¿ç”¨Navicatè¿æ¥-slave1-åæ–°å»ºæŸ¥è¯¢ï¼Œæ‰§è¡Œä»¥ä¸‹SQL" class="headerlink" title="1ã€ä½¿ç”¨Navicatè¿æ¥ [slave1]åæ–°å»ºæŸ¥è¯¢ï¼Œæ‰§è¡Œä»¥ä¸‹SQL"></a>1ã€ä½¿ç”¨Navicatè¿æ¥ [slave1]åæ–°å»ºæŸ¥è¯¢ï¼Œæ‰§è¡Œä»¥ä¸‹SQL</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">CHANGE MASTER <span class="token keyword">TO</span> MASTER_HOST<span class="token operator">=</span><span class="token string">'è¿æ¥Navicatçš„ip'</span><span class="token punctuation">,</span>MASTER_PORT<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>MASTER_USER<span class="token operator">=</span><span class="token string">'backup'</span><span class="token punctuation">,</span>MASTER_PASSWORD<span class="token operator">=</span><span class="token string">'backup'</span><span class="token punctuation">;</span><span class="token keyword">START</span> SLAVE<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>MASTER_HOST å¡«Navicatè¿æ¥é…ç½®ä¸­çš„ipåº”è¯¥å°±å¯ä»¥</p><p>MASTER_PORT ä¸»å®¹å™¨çš„ç«¯å£</p><p>MASTER_USER åŒæ­¥è´¦å·çš„ç”¨æˆ·å</p><p>MASTER_PASSWORD åŒæ­¥è´¦å·çš„å¯†ç </p><h4 id="2ã€æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ"><a href="#2ã€æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ" class="headerlink" title="2ã€æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ"></a>2ã€æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> slave <span class="token keyword">status</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312161305.png"></p><h3 id="7ã€æ£€æŸ¥ä¸»ä»"><a href="#7ã€æ£€æŸ¥ä¸»ä»" class="headerlink" title="7ã€æ£€æŸ¥ä¸»ä»"></a>7ã€æ£€æŸ¥ä¸»ä»</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312161712.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312161734.png"></p><h2 id="ä¸‰ã€æ­å»º-nacos-é›†ç¾¤"><a href="#ä¸‰ã€æ­å»º-nacos-é›†ç¾¤" class="headerlink" title="ä¸‰ã€æ­å»º nacos é›†ç¾¤"></a>ä¸‰ã€æ­å»º nacos é›†ç¾¤</h2><h3 id="1ã€å‰è¨€-1"><a href="#1ã€å‰è¨€-1" class="headerlink" title="1ã€å‰è¨€"></a>1ã€å‰è¨€</h3><p>docker-composeé…ç½®çš„æºç ï¼Œå·²ç»ä¸Šä¼ åˆ° github,å¯ç›´æ¥clone ï¼š</p><p><a href="https://github.com/mykkTo/nacos-cluster-docker.git">https://github.com/mykkTo/nacos-cluster-docker.git</a></p><h3 id="2ã€é…ç½®æ–‡ä»¶è¯´æ˜"><a href="#2ã€é…ç½®æ–‡ä»¶è¯´æ˜" class="headerlink" title="2ã€é…ç½®æ–‡ä»¶è¯´æ˜"></a>2ã€é…ç½®æ–‡ä»¶è¯´æ˜</h3><p>1ã€Nacoså…±ç”¨çš„<code>init.d/custom.properties</code>ï¼Œä¸å®˜æ–¹ä¿æŒä¸€è‡´ï¼ŒæŒ‰éœ€ä½¿ç”¨</p><p>2ã€docker-compose-nacos1.yml</p><p>ä»¥ 1ä¸ºä¾‹ï¼Œ å¸¦ä¸ªéƒ½å¤§åŒå°å¼‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312163817.png"></p><h3 id="3ã€å¯åŠ¨-nacos-é›†ç¾¤"><a href="#3ã€å¯åŠ¨-nacos-é›†ç¾¤" class="headerlink" title="3ã€å¯åŠ¨ nacos é›†ç¾¤"></a>3ã€å¯åŠ¨ nacos é›†ç¾¤</h3><h4 id="1ã€å°†æºä»£ç é…ç½®ä¿®æ”¹åï¼Œåˆ†åˆ«ä¸Šä¼ åˆ°ä¸‰å°ä¸»æœº"><a href="#1ã€å°†æºä»£ç é…ç½®ä¿®æ”¹åï¼Œåˆ†åˆ«ä¸Šä¼ åˆ°ä¸‰å°ä¸»æœº" class="headerlink" title="1ã€å°†æºä»£ç é…ç½®ä¿®æ”¹åï¼Œåˆ†åˆ«ä¸Šä¼ åˆ°ä¸‰å°ä¸»æœº"></a>1ã€å°†æºä»£ç é…ç½®ä¿®æ”¹åï¼Œåˆ†åˆ«ä¸Šä¼ åˆ°ä¸‰å°ä¸»æœº</h4><ul><li><strong>101.34.180.133 å¯¹åº” nacos-1</strong></li><li><strong>106.52.23.202 å¯¹åº” nacos-2</strong></li><li><strong>119.45.122.161 å¯¹åº” nacos-3</strong></li></ul><h4 id="2ã€å¯åŠ¨å®¹å™¨"><a href="#2ã€å¯åŠ¨å®¹å™¨" class="headerlink" title="2ã€å¯åŠ¨å®¹å™¨"></a>2ã€å¯åŠ¨å®¹å™¨</h4><p>åˆ†åˆ«åœ¨å„ä¸»æœºä¸Šè¿›å…¥å„è‡ªå¯¹åº”çš„nacosç›®å½•ä¸­ï¼Œå¯åŠ¨å®¹å™¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><p>133æœåŠ¡å™¨ï¼š</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">$ cd nacos<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>docker/nacos<span class="token punctuation">-</span>1$ docker<span class="token punctuation">-</span>compose <span class="token punctuation">-</span>f docker<span class="token punctuation">-</span>compose<span class="token punctuation">-</span>nacos1.yml up <span class="token punctuation">-</span>d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>202æœåŠ¡å™¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> nacos-cluster-docker/nacos-2$ docker-compose -f docker-compose-nacos2.yml up -d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>161æœåŠ¡å™¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> nacos-cluster-docker/nacos-3$ docker-compose -f docker-compose-nacos3.yml up -d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h4 id="3ã€æŸ¥çœ‹æ—¥å¿—"><a href="#3ã€æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="3ã€æŸ¥çœ‹æ—¥å¿—"></a>3ã€æŸ¥çœ‹æ—¥å¿—</h4><p>æŸ¥çœ‹æ—¥å¿—åˆ†åˆ«åœ¨å¯¹åº”çš„nacos-*ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ</p><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">tail -f cluster-logs/nacos*/nacos.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4ã€åœæ­¢å®¹å™¨"><a href="#4ã€åœæ­¢å®¹å™¨" class="headerlink" title="4ã€åœæ­¢å®¹å™¨"></a>4ã€åœæ­¢å®¹å™¨</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">$ docker<span class="token punctuation">-</span>compose <span class="token punctuation">-</span>f docker<span class="token punctuation">-</span>compose<span class="token punctuation">-</span>nacos1.yml stop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="5ã€è®¿é—®Nacos-UIç•Œé¢"><a href="#5ã€è®¿é—®Nacos-UIç•Œé¢" class="headerlink" title="5ã€è®¿é—®Nacos UIç•Œé¢"></a>5ã€è®¿é—®Nacos UIç•Œé¢</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/P9RM@BX1BNB%7D%8_G%7B7UT9SQ.png"></p><p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°Nacosé›†ç¾¤å„èŠ‚ç‚¹å·²ç»æ­£å¸¸äº†ï¼ŒLEADERä¸FOLLOWERå·²ç»é€‰å‡ºï¼Œä¸€åˆ‡æ­£å¸¸äº†</p><h2 id="å››ã€nginx-è´Ÿè½½"><a href="#å››ã€nginx-è´Ÿè½½" class="headerlink" title="å››ã€nginx  è´Ÿè½½"></a>å››ã€nginx  è´Ÿè½½</h2><h3 id="1ã€åˆ›å»ºå¹¶å¯åŠ¨"><a href="#1ã€åˆ›å»ºå¹¶å¯åŠ¨" class="headerlink" title="1ã€åˆ›å»ºå¹¶å¯åŠ¨"></a>1ã€åˆ›å»ºå¹¶å¯åŠ¨</h3><h4 id="1ã€æ‹‰å–"><a href="#1ã€æ‹‰å–" class="headerlink" title="1ã€æ‹‰å–"></a>1ã€æ‹‰å–</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker pull nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€å¯åŠ¨"><a href="#2ã€å¯åŠ¨" class="headerlink" title="2ã€å¯åŠ¨"></a>2ã€å¯åŠ¨</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span><span class="token punctuation">-</span>name nginx<span class="token punctuation">-</span>test <span class="token punctuation">-</span>p 80<span class="token punctuation">:</span>80 <span class="token punctuation">-</span>d nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>â€“ name å®¹å™¨å‘½å</p><p>-v æ˜ å°„ç›®å½•</p><p>-d è®¾ç½®å®¹å™¨åå°è¿è¡Œ</p><p>-p æœ¬æœºç«¯å£æ˜ å°„ å°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„80ç«¯å£</p><h3 id="2ã€æ˜ å°„åˆ°æœ¬åœ°"><a href="#2ã€æ˜ å°„åˆ°æœ¬åœ°" class="headerlink" title="2ã€æ˜ å°„åˆ°æœ¬åœ°"></a>2ã€æ˜ å°„åˆ°æœ¬åœ°</h3><h4 id="1ã€åˆ›å»º"><a href="#1ã€åˆ›å»º" class="headerlink" title="1ã€åˆ›å»º"></a>1ã€åˆ›å»º</h4><p>é¦–å…ˆåœ¨æœ¬æœºåˆ›å»ºnginxçš„ä¸€äº›æ–‡ä»¶å­˜å‚¨ç›®å½•</p><pre class="line-numbers language-linux" data-language="linux"><code class="language-linux">mkdir -p /root/nginx/www /root/nginx/logs /root/nginx/conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>www</strong>: nginxå­˜å‚¨ç½‘ç«™ç½‘é¡µçš„ç›®å½•</p><p><strong>logs</strong>: nginxæ—¥å¿—ç›®å½•</p><p><strong>conf</strong>: nginxé…ç½®æ–‡ä»¶ç›®å½•</p><h4 id="2ã€æ˜ å°„"><a href="#2ã€æ˜ å°„" class="headerlink" title="2ã€æ˜ å°„"></a>2ã€æ˜ å°„</h4><p>ï¼ˆ1ï¼‰å…ˆæŸ¥çœ‹å®¹å™¨</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker ps <span class="token punctuation">-</span>a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ï¼ˆ2ï¼‰æ˜ å°„</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker cp 481e121fb29f<span class="token punctuation">:</span>/etc/nginx/nginx.conf /root/nginx/conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3ã€å¯åŠ¨å®¹å™¨"><a href="#3ã€å¯åŠ¨å®¹å™¨" class="headerlink" title="3ã€å¯åŠ¨å®¹å™¨"></a>3ã€å¯åŠ¨å®¹å™¨</h3><p>éœ€è¦è¯´æ˜ä¸‹ï¼Œngxin-test å®¹å™¨æ˜¯ä¸ºäº†è·å¾—å®¹å™¨çš„é…ç½®æ–‡ä»¶ï¼Œæœ€ç»ˆä½¿ç”¨çš„æ˜¯ nginx-web</p><p>ç›®å‰å·²ç»å¯åŠ¨ nginx-test 80ç«¯å£ï¼Œè‹¥æ˜¯ nginx-webæŒ‡å®šçš„ä¹Ÿæ˜¯ 80ï¼Œå°±éœ€è¦å…³é—­ nginx-testäº†</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker stop nginx<span class="token punctuation">-</span>test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1ã€æ–°å®¹å™¨æ˜ å°„"><a href="#1ã€æ–°å®¹å™¨æ˜ å°„" class="headerlink" title="1ã€æ–°å®¹å™¨æ˜ å°„"></a>1ã€æ–°å®¹å™¨æ˜ å°„</h4><p>åˆ›å»ºæ–°nginxå®¹å™¨nginx-web,å¹¶å°†<strong>www,logs,conf</strong>ç›®å½•æ˜ å°„åˆ°æœ¬åœ°</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker run <span class="token punctuation">-</span>d <span class="token punctuation">-</span>p 80<span class="token punctuation">:</span>80 <span class="token punctuation">-</span><span class="token punctuation">-</span>name nginx<span class="token punctuation">-</span>web <span class="token punctuation">-</span>v /root/nginx/www<span class="token punctuation">:</span>/usr/share/nginx/html <span class="token punctuation">-</span>v /root/nginx/conf/nginx.conf<span class="token punctuation">:</span>/etc/nginx/nginx.conf <span class="token punctuation">-</span>v /root/nginx/logs<span class="token punctuation">:</span>/var/log/nginx nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2ã€å¯åŠ¨-1"><a href="#2ã€å¯åŠ¨-1" class="headerlink" title="2ã€å¯åŠ¨"></a>2ã€å¯åŠ¨</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker start nginx<span class="token punctuation">-</span>web<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4ã€é…ç½®è´Ÿè½½å‡è¡¡"><a href="#4ã€é…ç½®è´Ÿè½½å‡è¡¡" class="headerlink" title="4ã€é…ç½®è´Ÿè½½å‡è¡¡"></a>4ã€é…ç½®è´Ÿè½½å‡è¡¡</h3><h4 id="1ã€è¿›å…¥-é…ç½®"><a href="#1ã€è¿›å…¥-é…ç½®" class="headerlink" title="1ã€è¿›å…¥ é…ç½®"></a>1ã€è¿›å…¥ é…ç½®</h4><p>åœ¨ root åº•ä¸‹</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312210733.png"></p><h4 id="2ã€é…ç½®æºç "><a href="#2ã€é…ç½®æºç " class="headerlink" title="2ã€é…ç½®æºç "></a>2ã€é…ç½®æºç </h4><pre class="line-numbers language-nginx.conf" data-language="nginx.conf"><code class="language-nginx.conf">user  nginx;worker_processes  auto;error_log  /var/log/nginx/error.log notice;pid        /var/run/nginx.pid;events {    worker_connections  1024;}http {    #gzip  on;upstream nacos-cluster { server 101.34.180.133:8848;server 106.52.23.202:8848;server 119.45.122.161:8848;}server {listen 80;location /{proxy_pass http://nacos-cluster;}}}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸»è¦çš„æ˜¯è¿™å—</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312210843.png"></p><p>è¯´æ˜ä¸‹ï¼š</p><p>æ–°æ‰‹å¯èƒ½ä¸å¤ªä¼šnginxï¼Œlisten ä¸º 80 æ˜¯å› ä¸ºä½ å®¹å™¨å¯åŠ¨æ—¶å€™æ˜¯ 80ï¼Œå½“è®¿é—® 80çš„æ—¶å€™è½¬åˆ° ä»¥ä¸Šä¸‰ä¸ª ip è´Ÿè½½è½®è®­ï¼Œè¿˜å¯ä»¥è®¾ç½®æƒé‡å¯ä»¥å»çœ‹æ–‡æ¡£</p><h4 id="3ã€é‡å¯"><a href="#3ã€é‡å¯" class="headerlink" title="3ã€é‡å¯"></a>3ã€é‡å¯</h4><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker">docker restart nginx<span class="token punctuation">-</span>web<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="äº”ã€Spring-bootè¿æ¥"><a href="#äº”ã€Spring-bootè¿æ¥" class="headerlink" title="äº”ã€Spring-bootè¿æ¥"></a>äº”ã€Spring-bootè¿æ¥</h2><h4 id="1ã€ymlé…ç½®"><a href="#1ã€ymlé…ç½®" class="headerlink" title="1ã€ymlé…ç½®"></a>1ã€ymlé…ç½®</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312211044.png"></p><h4 id="2ã€æŸ¥çœ‹å®¢æˆ·ç«¯"><a href="#2ã€æŸ¥çœ‹å®¢æˆ·ç«¯" class="headerlink" title="2ã€æŸ¥çœ‹å®¢æˆ·ç«¯"></a>2ã€æŸ¥çœ‹å®¢æˆ·ç«¯</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220312211146.png"></p><h2 id="å…­ã€é—®é¢˜æ±‡æ€»"><a href="#å…­ã€é—®é¢˜æ±‡æ€»" class="headerlink" title="å…­ã€é—®é¢˜æ±‡æ€»"></a>å…­ã€é—®é¢˜æ±‡æ€»</h2><h3 id="1ã€å…³äº-503"><a href="#1ã€å…³äº-503" class="headerlink" title="1ã€å…³äº 503"></a>1ã€å…³äº 503</h3><p>å¼‚å¸¸ä¿¡æ¯ï¼šjava.lang.IllegalStateException: failed to req API:/nacos/v1/ns/instance after all servers([101.34.180.133:8848]) tried: failed to req API:101.34.180.133:8848/nacos/v1/ns/instance. code:503 msg: server is DOWN now, please try again later!</p><p>ä¸ªäººè§è§£ï¼šè¿™ä¸ªé—®é¢˜åšä¸»è®¤ä¸ºæ˜¯é›†ç¾¤èŠ‚ç‚¹å°‘äº3ä¸ªå‡ºç°çš„ï¼Œå› ä¸ºæœåŠ¡å™¨è¿‡æœŸäº†ä¸€å°å‰©ä¸‹äº† ä¸¤å°ï¼Œæ‰€ä»¥æŠ¥è¿™ä¸ªé”™è¯¯ï¼Œä¸‰å°æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="ä¸ƒã€å‚è€ƒæ–‡æ¡£-â†“"><a href="#ä¸ƒã€å‚è€ƒæ–‡æ¡£-â†“" class="headerlink" title="ä¸ƒã€å‚è€ƒæ–‡æ¡£ â†“"></a>ä¸ƒã€å‚è€ƒæ–‡æ¡£ â†“</h2><p><a href="https://www.cnblogs.com/hellxz/p/nacos-cluster-docker.html">https://www.cnblogs.com/hellxz/p/nacos-cluster-docker.html</a></p><p><a href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></p><p><a href="https://www.cnblogs.com/bigband/p/13515219.html">https://www.cnblogs.com/bigband/p/13515219.html</a></p><p><a href="https://my.oschina.net/u/3773384/blog/1810111">https://my.oschina.net/u/3773384/blog/1810111</a></p><p><a href="https://www.jianshu.com/p/658911a8cff3">https://www.jianshu.com/p/658911a8cff3</a></p><p><a href="https://www.yht7.com/news/92162">https://www.yht7.com/news/92162</a></p><p><a href="https://blog.csdn.net/weixin_40461281/article/details/92586378">https://blog.csdn.net/weixin_40461281/article/details/92586378</a></p><p><a href="https://www.cnblogs.com/ilinuxer/p/6916969.html">https://www.cnblogs.com/ilinuxer/p/6916969.html</a></p><p><a href="https://blog.csdn.net/weixin_40461281/article/details/92586378">https://blog.csdn.net/weixin_40461281/article/details/92586378</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="åˆ†å¸ƒå¼æŠ€æœ¯æ ˆ" scheme="https://mykkto.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E6%A0%88/"/>
    
    
    <category term="springcloud-alibaba" scheme="https://mykkto.github.io/tags/springcloud-alibaba/"/>
    
    <category term="nacos" scheme="https://mykkto.github.io/tags/nacos/"/>
    
    <category term="é›†ç¾¤" scheme="https://mykkto.github.io/tags/%E9%9B%86%E7%BE%A4/"/>
    
    <category term="docker-compose" scheme="https://mykkto.github.io/tags/docker-compose/"/>
    
  </entry>
  
  <entry>
    <title>é«˜é˜¶é¢è¯•é¢˜ï¼šJUC-AQS</title>
    <link href="https://mykkto.github.io/posts/3fb37166.html"/>
    <id>https://mykkto.github.io/posts/3fb37166.html</id>
    <published>2022-03-09T13:32:10.000Z</published>
    <updated>2022-11-12T15:07:08.031Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ä¸€ã€æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€æ˜¯ä»€ä¹ˆ</h2><h3 id="1ã€å­—é¢æ„æ€"><a href="#1ã€å­—é¢æ„æ€" class="headerlink" title="1ã€å­—é¢æ„æ€"></a>1ã€å­—é¢æ„æ€</h3><p>æŠ½è±¡çš„é˜Ÿåˆ—åŒæ­¥å™¨</p><p>ç»“æ„å…³ç³»å›¾ï¼š</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220221163441.png"></p><h3 id="2ã€æŠ€æœ¯è§£é‡Š"><a href="#2ã€æŠ€æœ¯è§£é‡Š" class="headerlink" title="2ã€æŠ€æœ¯è§£é‡Š"></a>2ã€æŠ€æœ¯è§£é‡Š</h3><ul><li>ç”¨æ¥æ„å»ºé”æˆ–è€…å…¶å®ƒåŒæ­¥å™¨ç»„ä»¶çš„<code>é‡é‡çº§åŸºç¡€æ¡†æ¶åŠæ•´ä¸ªJUCä½“ç³»çš„åŸºçŸ³</code>ã€‚</li><li>é€šè¿‡å†…ç½®çš„FIFO1<code>é˜Ÿåˆ—</code>æ¥å®Œæˆèµ„æºè·å–çº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œï¼Œå¹¶é€šè¿‡ä¸€ä¸ª<code>intç±»å˜é‡</code><br>è¡¨ç¤ºæŒæœ‰é”çš„çŠ¶æ€</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220221163706.png"></p><p>CLHï¼šCraigã€Landin and Hagersten é˜Ÿåˆ—ï¼Œæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼ŒAQSä¸­çš„é˜Ÿåˆ—æ˜¯CLHå˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—FIFO</p><h2 id="äºŒã€AQS-JUCï¼ˆåŸºçŸ³ï¼‰"><a href="#äºŒã€AQS-JUCï¼ˆåŸºçŸ³ï¼‰" class="headerlink" title="äºŒã€AQS=JUCï¼ˆåŸºçŸ³ï¼‰"></a>äºŒã€AQS=JUCï¼ˆåŸºçŸ³ï¼‰</h2><p>AQSä¸ºä»€ä¹ˆæ˜¯JUCå†…å®¹ä¸­æœ€é‡è¦çš„åŸºçŸ³</p><h3 id="1ã€AQSæœ‰å…³çš„é”"><a href="#1ã€AQSæœ‰å…³çš„é”" class="headerlink" title="1ã€AQSæœ‰å…³çš„é”"></a>1ã€AQSæœ‰å…³çš„é”</h3><ul><li>ReentrantLock</li></ul><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220221144606.png"></p><ul><li>CountDownLatch</li><li>ReentrantReadWriteLock</li><li>Semaphore</li><li>â€¦â€¦â€¦â€¦â€¦ç­‰ç­‰</li></ul><h3 id="2ã€è¿›ä¸€æ­¥ç†è§£é”å’ŒåŒæ­¥å™¨çš„å…³ç³»"><a href="#2ã€è¿›ä¸€æ­¥ç†è§£é”å’ŒåŒæ­¥å™¨çš„å…³ç³»" class="headerlink" title="2ã€è¿›ä¸€æ­¥ç†è§£é”å’ŒåŒæ­¥å™¨çš„å…³ç³»"></a>2ã€è¿›ä¸€æ­¥ç†è§£é”å’ŒåŒæ­¥å™¨çš„å…³ç³»</h3><ul><li>é”ï¼Œé¢å‘é”çš„ä½¿ç”¨è€…ï¼š<ul><li>å®šä¹‰äº†ç¨‹åºå‘˜å’Œé”äº¤äº’çš„ä½¿ç”¨å±‚APIï¼Œéšè—äº†å®ç°ç»†èŠ‚ï¼Œä½ è°ƒç”¨å³å¯ã€‚</li></ul></li><li>åŒæ­¥å™¨ï¼Œé¢å‘é”çš„å®ç°è€…<ul><li>æ¯”å¦‚Javaå¹¶å‘å¤§ç¥DougLeeï¼Œæå‡ºç»Ÿä¸€è§„èŒƒå¹¶ç®€åŒ–äº†é”çš„å®ç°ï¼Œ<br>å±è”½äº†åŒæ­¥çŠ¶æ€ç®¡ç†ã€é˜»å¡çº¿ç¨‹æ’é˜Ÿå’Œé€šçŸ¥ã€å”¤é†’æœºåˆ¶ç­‰ã€‚</li></ul></li></ul><h2 id="ä¸‰ã€èƒ½å¹²å˜›"><a href="#ä¸‰ã€èƒ½å¹²å˜›" class="headerlink" title="ä¸‰ã€èƒ½å¹²å˜›"></a>ä¸‰ã€èƒ½å¹²å˜›</h2><h3 id="1ã€åŠ é”ä¼šå¯¼è‡´é˜»å¡"><a href="#1ã€åŠ é”ä¼šå¯¼è‡´é˜»å¡" class="headerlink" title="1ã€åŠ é”ä¼šå¯¼è‡´é˜»å¡"></a>1ã€åŠ é”ä¼šå¯¼è‡´é˜»å¡</h3><p>æœ‰é˜»å¡å°±éœ€è¦æ’é˜Ÿï¼Œå®ç°æ’é˜Ÿå¿…ç„¶éœ€è¦é˜Ÿåˆ—</p><h3 id="2ã€è¯´æ˜è§£é‡Š"><a href="#2ã€è¯´æ˜è§£é‡Š" class="headerlink" title="2ã€è¯´æ˜è§£é‡Š"></a>2ã€è¯´æ˜è§£é‡Š</h3><p>æŠ¢åˆ°èµ„æºçš„çº¿ç¨‹ç›´æ¥ä½¿ç”¨å¤„ç†ä¸šåŠ¡ï¼ŒæŠ¢ä¸åˆ°èµ„æºçš„å¿…ç„¶æ¶‰åŠä¸€ç§<code>æ’é˜Ÿç­‰å€™æœºåˆ¶</code>ã€‚æŠ¢å èµ„æºå¤±è´¥çš„çº¿ç¨‹ç»§ç»­å»ç­‰å¾…(ç±»ä¼¼é“¶è¡Œä¸šåŠ¡åŠç†çª—å£éƒ½æ»¡äº†ï¼Œæš‚æ—¶æ²¡æœ‰å—ç†çª—å£çš„é¡¾å®¢åªèƒ½å»<code>å€™å®¢åŒºæ’é˜Ÿç­‰å€™</code>)ï¼Œä½†ç­‰å€™çº¿ç¨‹ä»ç„¶ä¿ç•™è·å–é”çš„å¯èƒ½ä¸”è·å–é”æµç¨‹ä»åœ¨ç»§ç»­(å€™å®¢åŒºçš„é¡¾å®¢ä¹Ÿåœ¨ç­‰ç€å«å·ï¼Œè½®åˆ°äº†å†å»å—ç†çª—å£åŠç†ä¸šåŠ¡)ã€‚</p><p>æ—¢ç„¶è¯´åˆ°äº†<code>æ’é˜Ÿç­‰å€™æœºåˆ¶</code>ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¼šæœ‰æŸç§é˜Ÿåˆ—å½¢æˆï¼Œè¿™æ ·çš„é˜Ÿåˆ—æ˜¯ä»€ä¹ˆæ•°æ®ç»“æ„å‘¢ï¼Ÿ</p><p>å¦‚æœå…±äº«èµ„æºè¢«å ç”¨ï¼Œ<code>å°±éœ€è¦ä¸€å®šçš„é˜»å¡ç­‰å¾…å”¤é†’æœºåˆ¶æ¥ä¿è¯é”åˆ†é…</code>ã€‚è¿™ä¸ªæœºåˆ¶ä¸»è¦ç”¨çš„æ˜¯CLHé˜Ÿåˆ—çš„å˜ä½“å®ç°çš„ï¼Œå°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°±æ˜¯AQSçš„æŠ½è±¡è¡¨ç°ã€‚å®ƒå°†è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆé˜Ÿåˆ—çš„ç»“ç‚¹ï¼ˆ<code>Node</code>ï¼‰ï¼Œé€šè¿‡<code>CASã€è‡ªæ—‹ä»¥åŠLockSupport.park()</code>çš„æ–¹å¼ï¼Œç»´æŠ¤stateå˜é‡çš„çŠ¶æ€ï¼Œä½¿å¹¶å‘è¾¾åˆ°åŒæ­¥çš„æ•ˆæœã€‚</p><p>LockSupport.park()ï¼šé˜»å¡å½“å‰çº¿ç¨‹çš„æ‰§è¡Œï¼Œä¸”<strong>éƒ½ä¸ä¼šé‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„é”èµ„æº</strong>ï¼›</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220222105221.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220222125213.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220222131031.png"></p><h2 id="å››ã€AQS-è§£è¯»"><a href="#å››ã€AQS-è§£è¯»" class="headerlink" title="å››ã€AQS è§£è¯»"></a>å››ã€AQS è§£è¯»</h2><h3 id="1ã€AQSæ¦‚è¿°"><a href="#1ã€AQSæ¦‚è¿°" class="headerlink" title="1ã€AQSæ¦‚è¿°"></a>1ã€AQSæ¦‚è¿°</h3><h4 id="1ã€å®˜ç½‘è§£é‡Š"><a href="#1ã€å®˜ç½‘è§£é‡Š" class="headerlink" title="1ã€å®˜ç½‘è§£é‡Š"></a>1ã€å®˜ç½‘è§£é‡Š</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220224111756.png"></p><h4 id="2ã€é˜»å¡-gt-é˜Ÿåˆ—"><a href="#2ã€é˜»å¡-gt-é˜Ÿåˆ—" class="headerlink" title="2ã€é˜»å¡->é˜Ÿåˆ—"></a>2ã€é˜»å¡-&gt;é˜Ÿåˆ—</h4><p>æœ‰é˜»å¡å°±éœ€è¦æ’é˜Ÿï¼Œå®ç°æ’é˜Ÿå¿…ç„¶éœ€è¦é˜Ÿåˆ—</p><p>AQSä½¿ç”¨ä¸€ä¸ªvolatileçš„intç±»å‹çš„æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„<br>FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çš„æ’é˜Ÿå·¥ä½œå°†æ¯æ¡è¦å»æŠ¢å èµ„æºçš„çº¿ç¨‹å°è£…æˆ<br>ä¸€ä¸ªNodeèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ï¼Œé€šè¿‡CASå®Œæˆå¯¹Stateå€¼çš„ä¿®æ”¹ã€‚</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220224112845.png"></p><h3 id="2ã€AQSå†…éƒ¨ä½“ç³»æ¶æ„"><a href="#2ã€AQSå†…éƒ¨ä½“ç³»æ¶æ„" class="headerlink" title="2ã€AQSå†…éƒ¨ä½“ç³»æ¶æ„"></a>2ã€AQSå†…éƒ¨ä½“ç³»æ¶æ„</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220224114013.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220224113957.png"></p><h4 id="1ã€AQSè‡ªèº«"><a href="#1ã€AQSè‡ªèº«" class="headerlink" title="1ã€AQSè‡ªèº«"></a>1ã€AQSè‡ªèº«</h4><h5 id="1ã€AQSçš„intå˜é‡-â˜…"><a href="#1ã€AQSçš„intå˜é‡-â˜…" class="headerlink" title="1ã€AQSçš„intå˜é‡ â˜…"></a>1ã€AQSçš„intå˜é‡ â˜…</h5><p>1ã€AQSçš„åŒæ­¥çŠ¶æ€Stateæˆå‘˜å˜é‡</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220224155656.png"></p><p>2ã€é“¶è¡ŒåŠç†ä¸šåŠ¡çš„å—ç†çª—å£çŠ¶æ€ï¼ˆé€šä¿—ç†è§£ï¼‰</p><ul><li>é›¶å°±æ˜¯æ²¡äººï¼ˆè‡ªç”±çŠ¶æ€ï¼‰ï¼Œå¯ä»¥åŠç†</li><li>å¤§äºç­‰äº1ï¼Œæœ‰äººå ç”¨çª—å£ï¼Œç­‰ç€å»</li></ul><h5 id="2ã€AQSçš„CLHé˜Ÿåˆ—"><a href="#2ã€AQSçš„CLHé˜Ÿåˆ—" class="headerlink" title="2ã€AQSçš„CLHé˜Ÿåˆ—"></a>2ã€AQSçš„CLHé˜Ÿåˆ—</h5><p>1ã€CLHé˜Ÿåˆ—(ä¸‰ä¸ªå¤§ç‰›çš„åå­—ç»„æˆ)ï¼Œä¸ºä¸€ä¸ªåŒå‘é˜Ÿåˆ—</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220224161127.png"></p><p>2ã€é“¶è¡Œå€™å®¢åŒºçš„ç­‰å¾…é¡¾å®¢ï¼ˆé€šä¿—ç†è§£ï¼‰</p><h5 id="3ã€å°æ€»ç»“"><a href="#3ã€å°æ€»ç»“" class="headerlink" title="3ã€å°æ€»ç»“"></a>3ã€å°æ€»ç»“</h5><ul><li>æœ‰é˜»å¡å°±éœ€è¦æ’é˜Ÿï¼Œå®ç°æ’é˜Ÿå¿…ç„¶éœ€è¦é˜Ÿåˆ—</li><li>stateå˜é‡+CLHåŒç«¯é˜Ÿåˆ—</li></ul><h4 id="2ã€å†…éƒ¨ç±»Node"><a href="#2ã€å†…éƒ¨ç±»Node" class="headerlink" title="2ã€å†…éƒ¨ç±»Node"></a>2ã€å†…éƒ¨ç±»Node</h4><p>å†…éƒ¨ç±»Node(Nodeç±»åœ¨AQSç±»å†…éƒ¨)</p><h5 id="1ã€Nodeçš„intå˜é‡-â˜…"><a href="#1ã€Nodeçš„intå˜é‡-â˜…" class="headerlink" title="1ã€Nodeçš„intå˜é‡ â˜…"></a>1ã€Nodeçš„intå˜é‡ â˜…</h5><p>1ã€Nodeçš„ç­‰å¾…çŠ¶æ€waitStateæˆå‘˜å˜é‡</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220224161754.png"></p><p>2ã€è¯´æ˜</p><ul><li>ç­‰å€™åŒºå…¶å®ƒé¡¾å®¢(å…¶å®ƒçº¿ç¨‹)çš„ç­‰å¾…çŠ¶æ€</li><li>é˜Ÿåˆ—ä¸­æ¯ä¸ªæ’é˜Ÿçš„ä¸ªä½“å°±æ˜¯ä¸€ä¸ª  Node</li></ul><h5 id="2ã€Nodeæ­¤ç±»è¯¦è§£"><a href="#2ã€Nodeæ­¤ç±»è¯¦è§£" class="headerlink" title="2ã€Nodeæ­¤ç±»è¯¦è§£"></a>2ã€Nodeæ­¤ç±»è¯¦è§£</h5><p>1ã€å†…éƒ¨ç»“æ„</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220224162501.png"></p><p>2ã€å±æ€§è¯´æ˜</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220224162531.png"></p><h3 id="3ã€AQSåŒæ­¥é˜Ÿåˆ—çš„åŸºæœ¬ç»“æ„"><a href="#3ã€AQSåŒæ­¥é˜Ÿåˆ—çš„åŸºæœ¬ç»“æ„" class="headerlink" title="3ã€AQSåŒæ­¥é˜Ÿåˆ—çš„åŸºæœ¬ç»“æ„"></a>3ã€AQSåŒæ­¥é˜Ÿåˆ—çš„åŸºæœ¬ç»“æ„</h3><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220301135124.png"></p><p>CLHï¼šCraigã€Landin and Hagersten é˜Ÿåˆ—ï¼Œæ˜¯ä¸ªå•å‘é“¾è¡¨ï¼ŒAQSä¸­çš„é˜Ÿåˆ—æ˜¯CLHå˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—ï¼ˆFIFOï¼‰</p><p>FIFOï¼šé˜Ÿåˆ—ä¸­ç”¨åˆ°äº†å“¨å…µèŠ‚ç‚¹ï¼ˆå‚€å„¡èŠ‚ç‚¹ï¼‰æ—¢ï¼Œå¤´èŠ‚ç‚¹ï¼ˆå¥½å¤„å°±æ˜¯ä¸ç”¨å»åˆ¤ç©ºï¼Œå› ä¸ºæœ‰å¤´èŠ‚ç‚¹ï¼‰</p><h2 id="äº”ã€ä»ReentrantLockå¼€å§‹è§£è¯»AQS"><a href="#äº”ã€ä»ReentrantLockå¼€å§‹è§£è¯»AQS" class="headerlink" title="äº”ã€ä»ReentrantLockå¼€å§‹è§£è¯»AQS"></a>äº”ã€ä»ReentrantLockå¼€å§‹è§£è¯»AQS</h2><h3 id="1ã€è¯´æ˜"><a href="#1ã€è¯´æ˜" class="headerlink" title="1ã€è¯´æ˜"></a>1ã€è¯´æ˜</h3><p><strong>Lockæ¥å£çš„å®ç°ç±»ï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ã€èšåˆã€‘äº†ä¸€ä¸ªã€é˜Ÿåˆ—åŒæ­¥å™¨ã€‘çš„å­ç±»å®Œæˆçº¿ç¨‹è®¿é—®æ§åˆ¶çš„</strong></p><p>1ã€å¯ä»¥çœ‹å‡ºå†…éƒ¨å­ç±» Syncï¼Œç»§æ‰¿äº† AQS </p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329210645.png"></p><p>2ã€çœ‹ä¸‹ç±» UMLå›¾ï¼ŒSync åº•ä¸‹åˆæœ‰ä¸¤ä¸ªå­ç±»ï¼ˆåˆ†åˆ«ä¸ºå…¬å¹³å’Œéå…¬å¹³ï¼‰</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329211351.png"></p><h3 id="2ã€å…¬å¹³é”å’Œéå…¬å¹³é”"><a href="#2ã€å…¬å¹³é”å’Œéå…¬å¹³é”" class="headerlink" title="2ã€å…¬å¹³é”å’Œéå…¬å¹³é”"></a>2ã€å…¬å¹³é”å’Œéå…¬å¹³é”</h3><h4 id="1ã€å…ˆä»åˆ›å»ºå…¥æ‰‹"><a href="#1ã€å…ˆä»åˆ›å»ºå…¥æ‰‹" class="headerlink" title="1ã€å…ˆä»åˆ›å»ºå…¥æ‰‹"></a>1ã€å…ˆä»åˆ›å»ºå…¥æ‰‹</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329211608.png"></p><h4 id="2ã€è¿½æº¯"><a href="#2ã€è¿½æº¯" class="headerlink" title="2ã€è¿½æº¯"></a>2ã€è¿½æº¯</h4><p>1ã€é»˜è®¤æ„é€ æ–¹æ³•ï¼Œé»˜è®¤ä¸ä¼ å‚æ„é€ </p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329213723.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329213641.png"></p><p>2ã€å¸¦å‚ä¼ å…¥ï¼Œæ­¤æ—¶åˆ¤æ–­æ˜¯éå…¬å¹³è¿˜æ˜¯å…¬å¹³</p><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1648561077377.png" alt="1648561077377"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329213816.png"></p><p>3ã€å¾ˆæ˜æ˜¾è¿™æ˜¯ä¸¤ä¸ªç±»ï¼Œåˆ†åˆ«ç»§æ‰¿ä¸Syncï¼Œä¸Šé¢æœ‰æåˆ°</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329213915.png"></p><h4 id="3ã€çœ‹æºç "><a href="#3ã€çœ‹æºç " class="headerlink" title="3ã€çœ‹æºç "></a>3ã€çœ‹æºç </h4><h5 id="1ã€çœ‹å·®å¼‚"><a href="#1ã€çœ‹å·®å¼‚" class="headerlink" title="1ã€çœ‹å·®å¼‚"></a>1ã€çœ‹å·®å¼‚</h5><p>1ã€å¯ä»¥æ˜æ˜¾çœ‹å‡ºå…¬å¹³é”ä¸éå…¬å¹³é”çš„lock()æ–¹æ³•å”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºå…¬å¹³é”åœ¨è·å–åŒæ­¥çŠ¶æ€æ—¶å¤šäº†ä¸€ä¸ªé™åˆ¶æ¡ä»¶ <code>hasQueuedPredecessors()</code></p><p><strong>hasQueuedPredecessorsæ˜¯å…¬å¹³é”åŠ é”æ—¶åˆ¤æ–­ç­‰å¾…é˜Ÿåˆ—ä¸­æ˜¯å¦å­˜åœ¨æœ‰æ•ˆèŠ‚ç‚¹çš„æ–¹æ³•</strong></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329214203.png"></p><h5 id="2ã€å¯¹æ¯”"><a href="#2ã€å¯¹æ¯”" class="headerlink" title="2ã€å¯¹æ¯”"></a>2ã€å¯¹æ¯”</h5><p>å…¬å¹³é”ï¼šå…¬å¹³é”è®²ç©¶å…ˆæ¥å…ˆåˆ°ï¼Œçº¿ç¨‹åœ¨è·å–é”æ—¶ï¼Œå¦‚æœè¿™ä¸ªé”çš„ç­‰å¾…é˜Ÿåˆ—ä¸­å·²ç»æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼›</p><p>éå…¬å¹³é”ï¼šä¸ç®¡æ˜¯å¦æœ‰ç­‰å¾…é˜Ÿåˆ—ï¼Œå¦‚æœå¯ä»¥è·å–é”ï¼Œåˆ™ç«‹åˆ»å æœ‰é”å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªæ’é˜Ÿçº¿ç¨‹åœ¨unpark()ï¼Œä¹‹åè¿˜æ˜¯éœ€è¦ç«äº‰é”ï¼ˆå­˜åœ¨çº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼‰</p><h5 id="3ã€å¿…è°ƒ-lock"><a href="#3ã€å¿…è°ƒ-lock" class="headerlink" title="3ã€å¿…è°ƒ lock()"></a>3ã€å¿…è°ƒ lock()</h5><p>åœ¨åˆ›å»ºå®Œå…¬å¹³/éå…¬å¹³é”ï¼Œè°ƒç”¨<code>lock</code>æ–¹æ³•è¿›è¡ŒåŠ é”ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨ <code>acquire</code> æ–¹æ³•</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329221223.png"></p><h3 id="3ã€æºç Apiè§£è¯»"><a href="#3ã€æºç Apiè§£è¯»" class="headerlink" title="3ã€æºç Apiè§£è¯»"></a>3ã€æºç Apiè§£è¯»</h3><h4 id="1ã€lock"><a href="#1ã€lock" class="headerlink" title="1ã€lock()"></a>1ã€lock()</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329221703.png"></p><h4 id="2ã€acquire"><a href="#2ã€acquire" class="headerlink" title="2ã€acquire()"></a>2ã€acquire()</h4><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329223153.png"></p><p><strong>ä¸‰ä¸ªèµ°å‘</strong></p><p>1ã€tryAcquire() -&gt; tryAcquire () ç”±äºå­ç±» <code>FairSync</code> å®ç°</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329223909.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329223835.png"></p><p>2ã€è°ƒç”¨ addWaiter() -&gt; enq() å…¥é˜Ÿæ“ä½œ</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329224108.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329224256.png"></p><p>3ã€acquireQueued() -&gt; cancelAcquire()</p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329225026.png"></p><p><img src="https://v1.mykkto.cn/image/blog/2022/springcloud/20220329225124.png"></p><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a href="https://www.cnblogs.com/tong-yuan/p/11768904.html">https://www.cnblogs.com/tong-yuan/p/11768904.html</a></p><p><a href="https://baijiahao.baidu.com/s?id=1718317852417206951&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1718317852417206951&amp;wfr=spider&amp;for=pc</a></p><p><a href="https://blog.csdn.net/hengyunabc/article/details/28126139">https://blog.csdn.net/hengyunabc/article/details/28126139</a></p><p>å“¨å…µèŠ‚ç‚¹è§£è¯»ï¼š<a href="https://www.cnblogs.com/litexy/p/9749544.html">https://www.cnblogs.com/litexy/p/9749544.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="é¢è¯•é¢˜" scheme="https://mykkto.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
    
    <category term="AQS" scheme="https://mykkto.github.io/tags/AQS/"/>
    
    <category term="å¤šçº¿ç¨‹" scheme="https://mykkto.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
    <category term="JUC" scheme="https://mykkto.github.io/tags/JUC/"/>
    
  </entry>
  
</feed>
